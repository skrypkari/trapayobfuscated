'use strict';const a40_0x6c4f38=a40_0x18fd;(function(_0x4c0087,_0x2119e3){const _0x361fb7=a40_0x18fd,_0x48f98d=_0x4c0087();while(!![]){try{const _0x169675=-parseInt(_0x361fb7(0x1fa))/0x1+parseInt(_0x361fb7(0x188))/0x2*(parseInt(_0x361fb7(0x1b6))/0x3)+-parseInt(_0x361fb7(0x1de))/0x4*(parseInt(_0x361fb7(0x1d3))/0x5)+parseInt(_0x361fb7(0x191))/0x6+-parseInt(_0x361fb7(0x1ae))/0x7+parseInt(_0x361fb7(0x190))/0x8+parseInt(_0x361fb7(0x18a))/0x9;if(_0x169675===_0x2119e3)break;else _0x48f98d['push'](_0x48f98d['shift']());}catch(_0x30b72d){_0x48f98d['push'](_0x48f98d['shift']());}}}(a40_0x5a59,0xca4c8));Object[a40_0x6c4f38(0x186)](exports,a40_0x6c4f38(0x1d8),{'value':!![]}),exports[a40_0x6c4f38(0x183)]=void 0x0;function a40_0x18fd(_0x2a36c4,_0x5b3c3e){const _0x5a59c8=a40_0x5a59();return a40_0x18fd=function(_0x18fdb4,_0x21fc63){_0x18fdb4=_0x18fdb4-0x17b;let _0x10480e=_0x5a59c8[_0x18fdb4];return _0x10480e;},a40_0x18fd(_0x2a36c4,_0x5b3c3e);}const loggerService_1=require(a40_0x6c4f38(0x1b3));function a40_0x5a59(){const _0x28fab7=['/status','Status:','logWhiteDomainRequest','POST','processWebhook','data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','coinAddress','Raw\x20Response\x20Body:','log','Amount:','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20status\x20API\x20error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','gateway_payment_id','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20Text:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','40HueCuU','PENDING','Error\x20stack:','https://tesoft.uk/gateway/cointopay/',',\x20body:\x20','__esModule','created','failed','not\x20confirmed','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Headers:','467956fFuUFQ','statusUrl','text','Response\x20data:','üìä\x20Status\x20check\x20URL:','Business\x20Error:\x20','order_id','üè¶\x20Payment\x20Detail:','HTTP\x20Status:','result','paid','payment_url','Error\x20message:','toLowerCase','loggerService','Response\x20Body:','logWhiteDomainError','PAID','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','error','verifyPayment','TesSoft\x20Payment\x20System/1.0','cointopay','parse','PaymentDetail','Response\x20Time:','Unknown\x20error','1629261OenZco','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','success','fromEntries','Gateway\x20Payment\x20ID:','statusText','expired','stringify','HTTP\x20error!\x20status:\x20','FAILED','CoinToPayService','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','defineProperty','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','2HKYrGt','Error\x20Message:','26889435Bttolh','application/json','JSON\x20Parse\x20Error:\x20','Amount','not\x20found','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','6231704QhMOap','2812968htDqWm','inputCurrency','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','checkPaymentStatus','logWhiteDomainResponse','status','QRCodeURL','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','EXPIRED','apiUrl','\x20EUR','URL:','Status\x20Code:','timeout','message','CreatedOn','stack','merchant_reference_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','currency','Currency:','/create','===\x20COINTOPAY\x20API\x20ERROR\x20===','pending','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','TransactionID','EUR','Incomplete\x20response:\x20missing\x20data','6384630VgZMQM','now','awaiting\x20fiat','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ExpiryTime','../loggerService','waiting','Unknown\x20error\x20from\x20CoinToPay\x20API','211119jyXBLm','Confirmed\x20On:','Status','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','headers','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','match','status_code'];a40_0x5a59=function(){return _0x28fab7;};return a40_0x5a59();}class CoinToPayService{constructor(){const _0x21069f=a40_0x6c4f38;this[_0x21069f(0x19b)]=_0x21069f(0x1d6),this[_0x21069f(0x1df)]=_0x21069f(0x1f0),console[_0x21069f(0x1c8)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x21069f(0x1c8)](_0x21069f(0x1e2),this[_0x21069f(0x1df)]);}async['createPaymentLink'](_0x4e30e0){const _0xfc54e7=a40_0x6c4f38,{orderId:_0x3dbe4e,amount:_0x3d86b9}=_0x4e30e0;console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1cd)+_0x3d86b9+_0xfc54e7(0x19c));const _0x54c9ea={'amount':_0x3d86b9},_0x700d07=Date['now']();try{console[_0xfc54e7(0x1c8)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x19d),this[_0xfc54e7(0x19b)]),console[_0xfc54e7(0x1c8)]('Request\x20Body:',JSON['stringify'](_0x54c9ea,null,0x2)),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1c9),_0x3d86b9,_0xfc54e7(0x1ce)),loggerService_1[_0xfc54e7(0x1ec)][_0xfc54e7(0x1c1)](_0xfc54e7(0x1f5),_0xfc54e7(0x1a7),_0xfc54e7(0x1c2),_0x54c9ea);const _0x12dec7=await fetch(this[_0xfc54e7(0x19b)],{'method':_0xfc54e7(0x1c2),'headers':{'Content-Type':_0xfc54e7(0x18b),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xfc54e7(0x180)](_0x54c9ea)}),_0x1d61cb=Date['now']()-_0x700d07;console[_0xfc54e7(0x1c8)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1c0),_0x12dec7[_0xfc54e7(0x196)]),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1d1),_0x12dec7[_0xfc54e7(0x17e)]),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1dd),Object[_0xfc54e7(0x17c)](_0x12dec7[_0xfc54e7(0x1ba)]['entries']())),console['log']('Response\x20Time:',_0x1d61cb+'ms');const _0x476358=await _0x12dec7[_0xfc54e7(0x1e0)]();console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1c7),_0x476358);if(!_0x12dec7['ok']){console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1a8)),console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1e6),_0x12dec7['status']),console['error'](_0xfc54e7(0x1ed),_0x476358),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xfc54e7(0x1f5),_0xfc54e7(0x1a7),_0x12dec7[_0xfc54e7(0x196)],_0x476358,_0x1d61cb),loggerService_1[_0xfc54e7(0x1ec)]['logWhiteDomainError'](_0xfc54e7(0x1f5),'/create',_0xfc54e7(0x185)+_0x12dec7[_0xfc54e7(0x196)]+':\x20'+_0x476358);throw new Error(_0xfc54e7(0x181)+_0x12dec7[_0xfc54e7(0x196)]+_0xfc54e7(0x1d7)+_0x476358);}let _0x14c2cd;try{_0x14c2cd=JSON[_0xfc54e7(0x1f6)](_0x476358);}catch(_0x50f095){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x50f095),loggerService_1[_0xfc54e7(0x1ec)][_0xfc54e7(0x1ee)](_0xfc54e7(0x1f5),'/create',_0xfc54e7(0x18c)+_0x50f095);throw new Error(_0xfc54e7(0x1cb)+_0x476358);}console[_0xfc54e7(0x1c8)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0xfc54e7(0x1c8)]('Parsed\x20Result:',JSON[_0xfc54e7(0x180)](_0x14c2cd,null,0x2)),loggerService_1[_0xfc54e7(0x1ec)][_0xfc54e7(0x195)](_0xfc54e7(0x1f5),'/create',_0x12dec7[_0xfc54e7(0x196)],_0x14c2cd,_0x1d61cb);if(_0x14c2cd[_0xfc54e7(0x1f2)]){const _0x38bfd5=_0x14c2cd[_0xfc54e7(0x1a0)]||_0x14c2cd[_0xfc54e7(0x1f2)]||_0xfc54e7(0x1b5);console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1fc)),console[_0xfc54e7(0x1f2)](_0xfc54e7(0x189),_0x38bfd5),loggerService_1[_0xfc54e7(0x1ec)][_0xfc54e7(0x1ee)](_0xfc54e7(0x1f5),_0xfc54e7(0x1a7),_0xfc54e7(0x1e3)+_0x38bfd5);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x38bfd5);}if(!_0x14c2cd[_0xfc54e7(0x1e9)]||!_0x14c2cd[_0xfc54e7(0x1cf)]){console[_0xfc54e7(0x1f2)](_0xfc54e7(0x184)),console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1b1)),console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1e1),_0x14c2cd),loggerService_1[_0xfc54e7(0x1ec)][_0xfc54e7(0x1ee)]('cointopay',_0xfc54e7(0x1a7),_0xfc54e7(0x187));throw new Error(_0xfc54e7(0x1b9));}return console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1d0)),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x17d),_0x14c2cd['gateway_payment_id']),console[_0xfc54e7(0x1c8)]('Payment\x20URL:',_0x14c2cd[_0xfc54e7(0x1e9)]),console[_0xfc54e7(0x1c8)](_0xfc54e7(0x1c9),_0x3d86b9,_0xfc54e7(0x1ac)),{'gateway_payment_id':_0x14c2cd[_0xfc54e7(0x1cf)],'payment_url':_0x14c2cd[_0xfc54e7(0x1e9)]};}catch(_0x34e7fd){console[_0xfc54e7(0x1f2)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0xfc54e7(0x1f2)]('Error\x20details:',_0x34e7fd),loggerService_1['loggerService'][_0xfc54e7(0x1ee)]('cointopay',_0xfc54e7(0x1a7),_0x34e7fd);if(_0x34e7fd instanceof Error){console['error'](_0xfc54e7(0x1ea),_0x34e7fd['message']),console[_0xfc54e7(0x1f2)](_0xfc54e7(0x1d5),_0x34e7fd[_0xfc54e7(0x1a2)]);throw new Error(_0xfc54e7(0x199)+_0x34e7fd['message']);}throw new Error(_0xfc54e7(0x1f1));}}async[a40_0x6c4f38(0x194)](_0x374d02){const _0x3257c0=a40_0x6c4f38,_0x16e380=Date['now']();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x374d02);const _0x5bd69e={'gatewayPaymentId':_0x374d02};loggerService_1['loggerService'][_0x3257c0(0x1c1)](_0x3257c0(0x1f5),_0x3257c0(0x1bf),_0x3257c0(0x1c2),_0x5bd69e);const _0x37ed2e=await fetch(this[_0x3257c0(0x1df)],{'method':_0x3257c0(0x1c2),'headers':{'Content-Type':'application/json','Accept':_0x3257c0(0x18b),'User-Agent':_0x3257c0(0x1f4)},'body':JSON['stringify'](_0x5bd69e)}),_0x439a71=Date[_0x3257c0(0x1af)]()-_0x16e380;console[_0x3257c0(0x1c8)](_0x3257c0(0x18f)),console[_0x3257c0(0x1c8)]('Status:',_0x37ed2e[_0x3257c0(0x196)]),console[_0x3257c0(0x1c8)](_0x3257c0(0x1f8),_0x439a71+'ms');if(!_0x37ed2e['ok']){const _0x24ab53=await _0x37ed2e['text']();console[_0x3257c0(0x1f2)](_0x3257c0(0x1e6),_0x37ed2e['status']),console[_0x3257c0(0x1f2)]('Response\x20Body:',_0x24ab53),loggerService_1['loggerService'][_0x3257c0(0x195)](_0x3257c0(0x1f5),_0x3257c0(0x1bf),_0x37ed2e[_0x3257c0(0x196)],_0x24ab53,_0x439a71),loggerService_1['loggerService'][_0x3257c0(0x1ee)]('cointopay',_0x3257c0(0x1bf),_0x3257c0(0x185)+_0x37ed2e['status']+':\x20'+_0x24ab53);throw new Error(_0x3257c0(0x181)+_0x37ed2e[_0x3257c0(0x196)]);}const _0x5d201a=await _0x37ed2e[_0x3257c0(0x1e0)]();console[_0x3257c0(0x1c8)](_0x3257c0(0x1c7),_0x5d201a);let _0xb43ab1;try{_0xb43ab1=JSON[_0x3257c0(0x1f6)](_0x5d201a);}catch(_0x1c3526){console[_0x3257c0(0x1f2)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1c3526),loggerService_1['loggerService'][_0x3257c0(0x1ee)](_0x3257c0(0x1f5),_0x3257c0(0x1bf),_0x3257c0(0x18c)+_0x1c3526);throw new Error(_0x3257c0(0x1a4)+_0x5d201a);}loggerService_1['loggerService'][_0x3257c0(0x195)](_0x3257c0(0x1f5),_0x3257c0(0x1bf),_0x37ed2e[_0x3257c0(0x196)],_0xb43ab1,_0x439a71),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x3257c0(0x1c8)]('Result:',_0xb43ab1[_0x3257c0(0x1e7)]),console['log'](_0x3257c0(0x19e),_0xb43ab1[_0x3257c0(0x1be)]),console[_0x3257c0(0x1c8)]('Payment\x20Status:',_0xb43ab1[_0x3257c0(0x1c4)]?.[_0x3257c0(0x1b8)]),console[_0x3257c0(0x1c8)]('Amount:',_0xb43ab1[_0x3257c0(0x1c4)]?.[_0x3257c0(0x18d)]),console['log'](_0x3257c0(0x1a6),_0xb43ab1['data']?.[_0x3257c0(0x192)]);if(_0xb43ab1[_0x3257c0(0x1e7)]!==_0x3257c0(0x17b)||_0xb43ab1[_0x3257c0(0x1be)]!==0xc8){const _0x5c7144=_0xb43ab1['message']||_0x3257c0(0x1c5);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x3257c0(0x1f2)]('Error\x20Message:',_0x5c7144),loggerService_1[_0x3257c0(0x1ec)]['logWhiteDomainError']('cointopay',_0x3257c0(0x1bf),'Status\x20API\x20Error:\x20'+_0x5c7144);throw new Error(_0x3257c0(0x1cc)+_0x5c7144);}if(!_0xb43ab1[_0x3257c0(0x1c4)]){console['error'](_0x3257c0(0x1d2)),console[_0x3257c0(0x1f2)](_0x3257c0(0x1fb)),loggerService_1[_0x3257c0(0x1ec)]['logWhiteDomainError'](_0x3257c0(0x1f5),'/status',_0x3257c0(0x1ad));throw new Error(_0x3257c0(0x1aa));}let _0x4f9135=_0x3257c0(0x1d4);switch(_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1b8)]?.[_0x3257c0(0x1eb)]()){case _0x3257c0(0x1e8):_0x4f9135=_0x3257c0(0x1ef);break;case'cancelled':case _0x3257c0(0x1da):case'error':_0x4f9135=_0x3257c0(0x182);break;case _0x3257c0(0x17f):case _0x3257c0(0x19f):_0x4f9135=_0x3257c0(0x19a);break;case _0x3257c0(0x1b4):case _0x3257c0(0x1b0):case'pending':case'created':default:_0x4f9135='PENDING';break;}let _0x4dbffd,_0x389549;if(_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1f7)]){const _0x1bebce=_0xb43ab1[_0x3257c0(0x1c4)]['PaymentDetail'];console[_0x3257c0(0x1c8)](_0x3257c0(0x1e5),_0x1bebce);const _0x282d9a=_0x1bebce[_0x3257c0(0x1bd)](/IBAN\s+([A-Z0-9]+)/i);_0x282d9a&&(_0x4dbffd=_0x282d9a[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x4dbffd)),_0x389549=_0x1bebce;}const _0x45cee5={'iban':_0x4dbffd,'bankDetails':_0x389549,'transactionId':_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1ab)],'coinAddress':_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1c6)],'qrCodeUrl':_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x197)],'expiryTime':_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1b2)],'createdOn':_0xb43ab1[_0x3257c0(0x1c4)]['CreatedOn'],'confirmedOn':_0xb43ab1[_0x3257c0(0x1c4)]['TransactionConfirmedOn']};console[_0x3257c0(0x1c8)](_0x3257c0(0x193)),console[_0x3257c0(0x1c8)](_0x3257c0(0x1c0),_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1b8)],'->',_0x4f9135),console[_0x3257c0(0x1c8)](_0x3257c0(0x1c9),_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x18d)],_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x192)]),console[_0x3257c0(0x1c8)]('Transaction\x20ID:',_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1ab)]),console['log']('IBAN:',_0x4dbffd||_0x3257c0(0x18e)),console[_0x3257c0(0x1c8)]('Created\x20On:',_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1a1)]),console[_0x3257c0(0x1c8)](_0x3257c0(0x1b7),_0xb43ab1[_0x3257c0(0x1c4)]['TransactionConfirmedOn']||_0x3257c0(0x1db));if(_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1b8)]?.[_0x3257c0(0x1eb)]()==='awaiting\x20fiat')console[_0x3257c0(0x1c8)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x1b8)]?.[_0x3257c0(0x1eb)]()===_0x3257c0(0x1e8)&&console[_0x3257c0(0x1c8)](_0x3257c0(0x1bc));return{'status':_0x4f9135,'amount':parseFloat(_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x18d)])||undefined,'currency':_0xb43ab1[_0x3257c0(0x1c4)][_0x3257c0(0x192)]||'EUR','paymentDetails':_0x45cee5};}catch(_0x1bc528){console[_0x3257c0(0x1f2)](_0x3257c0(0x198),_0x1bc528),loggerService_1[_0x3257c0(0x1ec)][_0x3257c0(0x1ee)](_0x3257c0(0x1f5),_0x3257c0(0x1bf),_0x1bc528);throw new Error(_0x3257c0(0x1bb)+(_0x1bc528 instanceof Error?_0x1bc528[_0x3257c0(0x1a0)]:_0x3257c0(0x1f9)));}}async[a40_0x6c4f38(0x1f3)](_0x4f9275){const _0x5b8e22=a40_0x6c4f38,_0x1498e8=await this[_0x5b8e22(0x194)](_0x4f9275);return{'status':_0x1498e8[_0x5b8e22(0x196)],'amount':_0x1498e8[_0x5b8e22(0x1ca)],'currency':_0x1498e8[_0x5b8e22(0x1a5)]};}async[a40_0x6c4f38(0x1c3)](_0x67f849){const _0x218b7c=a40_0x6c4f38;console[_0x218b7c(0x1c8)](_0x218b7c(0x1dc),_0x67f849);let _0x59b1e0=_0x218b7c(0x1d4);switch(_0x67f849['status']?.['toLowerCase']()){case'paid':_0x59b1e0=_0x218b7c(0x1ef);break;case'cancelled':case _0x218b7c(0x1da):case'error':_0x59b1e0='FAILED';break;case'expired':case _0x218b7c(0x19f):_0x59b1e0=_0x218b7c(0x19a);break;case _0x218b7c(0x1a9):case'waiting':case _0x218b7c(0x1b0):case _0x218b7c(0x1d9):default:_0x59b1e0=_0x218b7c(0x1d4);break;}return{'paymentId':_0x67f849[_0x218b7c(0x1e4)]||_0x67f849[_0x218b7c(0x1a3)]||'','status':_0x59b1e0,'amount':_0x67f849[_0x218b7c(0x1ca)],'currency':_0x67f849['currency']||'EUR'};}}exports[a40_0x6c4f38(0x183)]=CoinToPayService;