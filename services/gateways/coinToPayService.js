'use strict';const a41_0x23ca0d=a41_0x3fe5;(function(_0x3f5047,_0x110066){const _0x642f9b=a41_0x3fe5,_0x186a63=_0x3f5047();while(!![]){try{const _0x227911=parseInt(_0x642f9b(0x188))/0x1*(-parseInt(_0x642f9b(0x164))/0x2)+parseInt(_0x642f9b(0x1a2))/0x3+-parseInt(_0x642f9b(0x169))/0x4+parseInt(_0x642f9b(0x19d))/0x5+-parseInt(_0x642f9b(0x144))/0x6+-parseInt(_0x642f9b(0x15a))/0x7+-parseInt(_0x642f9b(0x163))/0x8*(-parseInt(_0x642f9b(0x134))/0x9);if(_0x227911===_0x110066)break;else _0x186a63['push'](_0x186a63['shift']());}catch(_0x52fc07){_0x186a63['push'](_0x186a63['shift']());}}}(a41_0x1056,0xd69ea));Object[a41_0x23ca0d(0x18f)](exports,a41_0x23ca0d(0x15c),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a41_0x3fe5(_0x2ffaf2,_0x1229c3){const _0x1056b0=a41_0x1056();return a41_0x3fe5=function(_0x3fe5e0,_0x310e65){_0x3fe5e0=_0x3fe5e0-0x12f;let _0xb1f554=_0x1056b0[_0x3fe5e0];return _0xb1f554;},a41_0x3fe5(_0x2ffaf2,_0x1229c3);}function a41_0x1056(){const _0x343c7a=['created','336180CGjiIa','error','TransactionConfirmedOn','Response\x20Body:','currency','\x20EUR','Status:','PENDING','success','https://tesoft.uk/gateway/cointopay/status.php','EUR','message','Amount','Missing\x20data\x20in\x20response','Currency:','üè¶\x20Payment\x20Detail:','Raw\x20Response\x20Body:','9mInkhM','fromEntries','CoinToPay\x20payment\x20status\x20check\x20error:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PaymentDetail','failed','statusUrl','not\x20found','Transaction\x20ID:','Status\x20Code:','üè¶\x20Extracted\x20IBAN:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','../loggerService','Error\x20message:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CreatedOn','1559274ROFVmQ','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===',',\x20body:\x20','HTTP\x20','Request\x20Body:','now','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','QRCodeURL','not\x20confirmed','timeout','awaiting\x20fiat','parse','stringify','Error\x20stack:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','inputCurrency','gateway_payment_id','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status\x20Text:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','pending','logWhiteDomainRequest','8070356ZpCWdb','ExpiryTime','__esModule','text','status','CoinToPayService','processWebhook','Result:','PAID','31636392EZIyfO','1970412OdCrFF','/create','waiting','Status\x20API\x20Error:\x20','/status','4254904aUHKBn','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Payment\x20Status:','Unknown\x20error','createPaymentLink','order_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20SUCCESS\x20===','logWhiteDomainError','logWhiteDomainResponse','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','status_code','headers','URL:','TesSoft\x20Payment\x20System/1.0','data','log','entries','HTTP\x20Status:','Amount:','Status','Headers:','EXPIRED','POST','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','loggerService','checkPaymentStatus','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','TransactionID','1seVfmY','application/json','payment_url','expired','Gateway\x20Payment\x20ID:','Error\x20Message:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','defineProperty','cointopay','statusText','FAILED','apiUrl','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Time:','Business\x20Error:\x20','result','paid','toLowerCase','amount','Response\x20data:','match','1370960HyAMwt','Error\x20details:','===\x20COINTOPAY\x20API\x20ERROR\x20===','üìä\x20Status\x20check\x20URL:'];a41_0x1056=function(){return _0x343c7a;};return a41_0x1056();}const loggerService_1=require(a41_0x23ca0d(0x140));class CoinToPayService{constructor(){const _0x4a22c4=a41_0x23ca0d;this[_0x4a22c4(0x193)]='https://tesoft.uk/gateway/cointopay/',this[_0x4a22c4(0x13a)]=_0x4a22c4(0x1ab),console[_0x4a22c4(0x17b)](_0x4a22c4(0x137)),console[_0x4a22c4(0x17b)](_0x4a22c4(0x1a0),this[_0x4a22c4(0x13a)]);}async[a41_0x23ca0d(0x16e)](_0x22b7d8){const _0x213071=a41_0x23ca0d,{orderId:_0x4f36a1,amount:_0x52bd62}=_0x22b7d8;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x52bd62+_0x213071(0x1a7));const _0x14dbb6={'amount':_0x52bd62},_0xcf7071=Date[_0x213071(0x149)]();try{console['log'](_0x213071(0x145)),console['log'](_0x213071(0x178),this['apiUrl']),console['log'](_0x213071(0x148),JSON[_0x213071(0x150)](_0x14dbb6,null,0x2)),console[_0x213071(0x17b)](_0x213071(0x17e),_0x52bd62,_0x213071(0x175)),loggerService_1[_0x213071(0x184)][_0x213071(0x159)]('cointopay',_0x213071(0x165),'POST',_0x14dbb6);const _0x1c771c=await fetch(this['apiUrl'],{'method':_0x213071(0x182),'headers':{'Content-Type':_0x213071(0x189),'Accept':'application/json','User-Agent':_0x213071(0x179)},'body':JSON['stringify'](_0x14dbb6)}),_0x366f0f=Date[_0x213071(0x149)]()-_0xcf7071;console[_0x213071(0x17b)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x213071(0x17b)](_0x213071(0x1a8),_0x1c771c[_0x213071(0x15e)]),console[_0x213071(0x17b)](_0x213071(0x156),_0x1c771c[_0x213071(0x191)]),console[_0x213071(0x17b)](_0x213071(0x180),Object[_0x213071(0x135)](_0x1c771c[_0x213071(0x177)][_0x213071(0x17c)]())),console[_0x213071(0x17b)](_0x213071(0x195),_0x366f0f+'ms');const _0x8d4390=await _0x1c771c[_0x213071(0x15d)]();console[_0x213071(0x17b)](_0x213071(0x133),_0x8d4390);if(!_0x1c771c['ok']){console['error'](_0x213071(0x19f)),console[_0x213071(0x1a3)](_0x213071(0x17d),_0x1c771c[_0x213071(0x15e)]),console[_0x213071(0x1a3)]('Response\x20Body:',_0x8d4390),loggerService_1[_0x213071(0x184)][_0x213071(0x173)](_0x213071(0x190),_0x213071(0x165),_0x1c771c[_0x213071(0x15e)],_0x8d4390,_0x366f0f),loggerService_1[_0x213071(0x184)][_0x213071(0x172)](_0x213071(0x190),_0x213071(0x165),_0x213071(0x147)+_0x1c771c[_0x213071(0x15e)]+':\x20'+_0x8d4390);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c771c[_0x213071(0x15e)]+_0x213071(0x146)+_0x8d4390);}let _0x56f72f;try{_0x56f72f=JSON[_0x213071(0x14f)](_0x8d4390);}catch(_0x59b768){console[_0x213071(0x1a3)](_0x213071(0x16a),_0x59b768),loggerService_1[_0x213071(0x184)]['logWhiteDomainError'](_0x213071(0x190),_0x213071(0x165),'JSON\x20Parse\x20Error:\x20'+_0x59b768);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x8d4390);}console[_0x213071(0x17b)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON['stringify'](_0x56f72f,null,0x2)),loggerService_1[_0x213071(0x184)][_0x213071(0x173)]('cointopay',_0x213071(0x165),_0x1c771c[_0x213071(0x15e)],_0x56f72f,_0x366f0f);if(_0x56f72f[_0x213071(0x1a3)]){const _0x317c5f=_0x56f72f[_0x213071(0x1ad)]||_0x56f72f[_0x213071(0x1a3)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x213071(0x1a3)](_0x213071(0x157)),console['error'](_0x213071(0x18d),_0x317c5f),loggerService_1[_0x213071(0x184)][_0x213071(0x172)](_0x213071(0x190),_0x213071(0x165),_0x213071(0x196)+_0x317c5f);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x317c5f);}if(!_0x56f72f['payment_url']||!_0x56f72f[_0x213071(0x154)]){console[_0x213071(0x1a3)](_0x213071(0x152)),console[_0x213071(0x1a3)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x213071(0x1a3)](_0x213071(0x19b),_0x56f72f),loggerService_1[_0x213071(0x184)][_0x213071(0x172)](_0x213071(0x190),_0x213071(0x165),_0x213071(0x13f));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x213071(0x171)),console[_0x213071(0x17b)](_0x213071(0x18c),_0x56f72f['gateway_payment_id']),console[_0x213071(0x17b)]('Payment\x20URL:',_0x56f72f[_0x213071(0x18a)]),console[_0x213071(0x17b)]('Amount:',_0x52bd62,_0x213071(0x1ac)),{'gateway_payment_id':_0x56f72f[_0x213071(0x154)],'payment_url':_0x56f72f[_0x213071(0x18a)]};}catch(_0x5193fc){console[_0x213071(0x1a3)](_0x213071(0x186)),console[_0x213071(0x1a3)](_0x213071(0x19e),_0x5193fc),loggerService_1[_0x213071(0x184)]['logWhiteDomainError']('cointopay',_0x213071(0x165),_0x5193fc);if(_0x5193fc instanceof Error){console[_0x213071(0x1a3)](_0x213071(0x141),_0x5193fc[_0x213071(0x1ad)]),console[_0x213071(0x1a3)](_0x213071(0x151),_0x5193fc['stack']);throw new Error(_0x213071(0x14a)+_0x5193fc[_0x213071(0x1ad)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a41_0x23ca0d(0x185)](_0x410f8a){const _0x1c9e35=a41_0x23ca0d,_0x18c6a8=Date[_0x1c9e35(0x149)]();try{console[_0x1c9e35(0x17b)](_0x1c9e35(0x174)+_0x410f8a);const _0x28e9df={'gatewayPaymentId':_0x410f8a};loggerService_1['loggerService'][_0x1c9e35(0x159)]('cointopay',_0x1c9e35(0x168),'POST',_0x28e9df);const _0x3d490d=await fetch(this[_0x1c9e35(0x13a)],{'method':_0x1c9e35(0x182),'headers':{'Content-Type':_0x1c9e35(0x189),'Accept':_0x1c9e35(0x189),'User-Agent':_0x1c9e35(0x179)},'body':JSON[_0x1c9e35(0x150)](_0x28e9df)}),_0x3694d5=Date['now']()-_0x18c6a8;console[_0x1c9e35(0x17b)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1c9e35(0x17b)](_0x1c9e35(0x1a8),_0x3d490d[_0x1c9e35(0x15e)]),console[_0x1c9e35(0x17b)]('Response\x20Time:',_0x3694d5+'ms');if(!_0x3d490d['ok']){const _0x5483e7=await _0x3d490d[_0x1c9e35(0x15d)]();console[_0x1c9e35(0x1a3)](_0x1c9e35(0x17d),_0x3d490d[_0x1c9e35(0x15e)]),console['error'](_0x1c9e35(0x1a5),_0x5483e7),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1c9e35(0x190),_0x1c9e35(0x168),_0x3d490d[_0x1c9e35(0x15e)],_0x5483e7,_0x3694d5),loggerService_1['loggerService'][_0x1c9e35(0x172)](_0x1c9e35(0x190),_0x1c9e35(0x168),_0x1c9e35(0x147)+_0x3d490d[_0x1c9e35(0x15e)]+':\x20'+_0x5483e7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3d490d[_0x1c9e35(0x15e)]);}const _0x211a05=await _0x3d490d[_0x1c9e35(0x15d)]();console[_0x1c9e35(0x17b)](_0x1c9e35(0x133),_0x211a05);let _0xd6f2b4;try{_0xd6f2b4=JSON[_0x1c9e35(0x14f)](_0x211a05);}catch(_0xd276aa){console['error'](_0x1c9e35(0x16a),_0xd276aa),loggerService_1[_0x1c9e35(0x184)]['logWhiteDomainError'](_0x1c9e35(0x190),'/status','JSON\x20Parse\x20Error:\x20'+_0xd276aa);throw new Error(_0x1c9e35(0x183)+_0x211a05);}loggerService_1[_0x1c9e35(0x184)][_0x1c9e35(0x173)](_0x1c9e35(0x190),_0x1c9e35(0x168),_0x3d490d[_0x1c9e35(0x15e)],_0xd6f2b4,_0x3694d5),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x1c9e35(0x161),_0xd6f2b4[_0x1c9e35(0x197)]),console[_0x1c9e35(0x17b)](_0x1c9e35(0x13d),_0xd6f2b4[_0x1c9e35(0x176)]),console[_0x1c9e35(0x17b)](_0x1c9e35(0x16c),_0xd6f2b4[_0x1c9e35(0x17a)]?.[_0x1c9e35(0x17f)]),console[_0x1c9e35(0x17b)](_0x1c9e35(0x17e),_0xd6f2b4[_0x1c9e35(0x17a)]?.[_0x1c9e35(0x12f)]),console[_0x1c9e35(0x17b)](_0x1c9e35(0x131),_0xd6f2b4[_0x1c9e35(0x17a)]?.[_0x1c9e35(0x153)]);if(_0xd6f2b4[_0x1c9e35(0x197)]!==_0x1c9e35(0x1aa)||_0xd6f2b4['status_code']!==0xc8){const _0x3ee11c=_0xd6f2b4[_0x1c9e35(0x1ad)]||_0x1c9e35(0x194);console['error'](_0x1c9e35(0x16b)),console['error'](_0x1c9e35(0x18d),_0x3ee11c),loggerService_1['loggerService'][_0x1c9e35(0x172)](_0x1c9e35(0x190),_0x1c9e35(0x168),_0x1c9e35(0x167)+_0x3ee11c);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x3ee11c);}if(!_0xd6f2b4['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1c9e35(0x1a3)](_0x1c9e35(0x130)),loggerService_1[_0x1c9e35(0x184)][_0x1c9e35(0x172)](_0x1c9e35(0x190),_0x1c9e35(0x168),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x52c251=_0x1c9e35(0x1a9);switch(_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x17f)]?.[_0x1c9e35(0x199)]()){case _0x1c9e35(0x198):_0x52c251=_0x1c9e35(0x162);break;case'cancelled':case _0x1c9e35(0x139):case'error':_0x52c251=_0x1c9e35(0x192);break;case _0x1c9e35(0x18b):case _0x1c9e35(0x14d):_0x52c251=_0x1c9e35(0x181);break;case _0x1c9e35(0x166):case _0x1c9e35(0x14e):case _0x1c9e35(0x158):case'created':default:_0x52c251='PENDING';break;}let _0x192c1c,_0x463eca;if(_0xd6f2b4['data']['PaymentDetail']){const _0x45abb3=_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x138)];console[_0x1c9e35(0x17b)](_0x1c9e35(0x132),_0x45abb3);const _0x4eb3e6=_0x45abb3[_0x1c9e35(0x19c)](/IBAN\s+([A-Z0-9]+)/i);_0x4eb3e6&&(_0x192c1c=_0x4eb3e6[0x1],console[_0x1c9e35(0x17b)](_0x1c9e35(0x13e),_0x192c1c)),_0x463eca=_0x45abb3;}const _0x3e1aac={'iban':_0x192c1c,'bankDetails':_0x463eca,'transactionId':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x187)],'coinAddress':_0xd6f2b4[_0x1c9e35(0x17a)]['coinAddress'],'qrCodeUrl':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x14b)],'expiryTime':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x15b)],'createdOn':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x143)],'confirmedOn':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x1a4)]};console['log'](_0x1c9e35(0x18e)),console[_0x1c9e35(0x17b)](_0x1c9e35(0x1a8),_0xd6f2b4['data']['Status'],'->',_0x52c251),console[_0x1c9e35(0x17b)](_0x1c9e35(0x17e),_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x12f)],_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x153)]),console[_0x1c9e35(0x17b)](_0x1c9e35(0x13c),_0xd6f2b4[_0x1c9e35(0x17a)]['TransactionID']),console[_0x1c9e35(0x17b)]('IBAN:',_0x192c1c||_0x1c9e35(0x13b)),console[_0x1c9e35(0x17b)]('Created\x20On:',_0xd6f2b4['data'][_0x1c9e35(0x143)]),console['log']('Confirmed\x20On:',_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x1a4)]||_0x1c9e35(0x14c));if(_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x17f)]?.[_0x1c9e35(0x199)]()===_0x1c9e35(0x14e))console['log'](_0x1c9e35(0x170));else _0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x17f)]?.['toLowerCase']()===_0x1c9e35(0x198)&&console[_0x1c9e35(0x17b)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x52c251,'amount':parseFloat(_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x12f)])||undefined,'currency':_0xd6f2b4[_0x1c9e35(0x17a)][_0x1c9e35(0x153)]||_0x1c9e35(0x1ac),'paymentDetails':_0x3e1aac};}catch(_0x58859e){console[_0x1c9e35(0x1a3)](_0x1c9e35(0x136),_0x58859e),loggerService_1[_0x1c9e35(0x184)][_0x1c9e35(0x172)]('cointopay','/status',_0x58859e);throw new Error(_0x1c9e35(0x155)+(_0x58859e instanceof Error?_0x58859e[_0x1c9e35(0x1ad)]:_0x1c9e35(0x16d)));}}async['verifyPayment'](_0x506de4){const _0x4fa89f=a41_0x23ca0d,_0x28f097=await this[_0x4fa89f(0x185)](_0x506de4);return{'status':_0x28f097[_0x4fa89f(0x15e)],'amount':_0x28f097[_0x4fa89f(0x19a)],'currency':_0x28f097[_0x4fa89f(0x1a6)]};}async[a41_0x23ca0d(0x160)](_0x2b9672){const _0x479b26=a41_0x23ca0d;console[_0x479b26(0x17b)](_0x479b26(0x142),_0x2b9672);let _0x4cad2d='PENDING';switch(_0x2b9672[_0x479b26(0x15e)]?.[_0x479b26(0x199)]()){case _0x479b26(0x198):_0x4cad2d=_0x479b26(0x162);break;case'cancelled':case _0x479b26(0x139):case _0x479b26(0x1a3):_0x4cad2d='FAILED';break;case'expired':case _0x479b26(0x14d):_0x4cad2d=_0x479b26(0x181);break;case _0x479b26(0x158):case _0x479b26(0x166):case'awaiting\x20fiat':case _0x479b26(0x1a1):default:_0x4cad2d='PENDING';break;}return{'paymentId':_0x2b9672[_0x479b26(0x16f)]||_0x2b9672['merchant_reference_id']||'','status':_0x4cad2d,'amount':_0x2b9672['amount'],'currency':_0x2b9672[_0x479b26(0x1a6)]||'EUR'};}}exports[a41_0x23ca0d(0x15f)]=CoinToPayService;