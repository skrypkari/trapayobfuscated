'use strict';const a55_0x495dff=a55_0x30b4;(function(_0x3413ed,_0x54f972){const _0x330adb=a55_0x30b4,_0x11e0d3=_0x3413ed();while(!![]){try{const _0x3ba0ae=-parseInt(_0x330adb(0x20d))/0x1*(-parseInt(_0x330adb(0x213))/0x2)+parseInt(_0x330adb(0x257))/0x3*(parseInt(_0x330adb(0x225))/0x4)+parseInt(_0x330adb(0x202))/0x5*(-parseInt(_0x330adb(0x23d))/0x6)+parseInt(_0x330adb(0x232))/0x7*(parseInt(_0x330adb(0x1f1))/0x8)+-parseInt(_0x330adb(0x204))/0x9*(-parseInt(_0x330adb(0x220))/0xa)+parseInt(_0x330adb(0x23a))/0xb+parseInt(_0x330adb(0x25b))/0xc*(-parseInt(_0x330adb(0x203))/0xd);if(_0x3ba0ae===_0x54f972)break;else _0x11e0d3['push'](_0x11e0d3['shift']());}catch(_0x12e4fd){_0x11e0d3['push'](_0x11e0d3['shift']());}}}(a55_0x209a,0x1acbb));Object[a55_0x495dff(0x21d)](exports,a55_0x495dff(0x250),{'value':!![]}),exports[a55_0x495dff(0x26e)]=void 0x0;function a55_0x209a(){const _0x3910d5=['PAID','entries','ðŸ¦\x20Extracted\x20IBAN:','Confirmed\x20On:','Status\x20Text:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','885896cIRBxK','result','Result:','9342VbHGOW','Headers:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','waiting','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','IBAN:','Error\x20details:','PaymentDetail','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay\x20API\x20error:\x20','Raw\x20Response\x20Body:','logWhiteDomainResponse','EUR','PENDING','Status','Error\x20stack:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20Message:','text','__esModule','/status','===\x20COINTOPAY\x20SUCCESS\x20===','Response\x20data:','gateway_payment_id','QRCodeURL','log','3eSRsHB','error','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20API\x20ERROR\x20===','4141284bSauYX','../loggerService','Created\x20On:','HTTP\x20error!\x20status:\x20','coinAddress','currency','Status\x20Code:','Response\x20Body:','created','stack','Payment\x20URL\x20(original):','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','ExpiryTime','order_id','merchant_reference_id','message','statusUrl','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPay\x20status\x20API\x20error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Amount','Parsed\x20Result:','parse','processWebhook','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainRequest','TransactionID','checkPaymentStatus','EXPIRED','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','timeout','Status\x20API\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','153056TNlToh','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','pending','TransactionConfirmedOn','HTTP\x20','failed','Amount:','now','headers','apiUrl','JSON\x20Parse\x20Error:\x20','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','expired','toLowerCase','Response\x20Time:',',\x20body:\x20','55FDBuLJ','13iuNgJz','153UqCfQP','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Incomplete\x20response:\x20missing\x20data','cointopay','\x20EUR','Payment\x20URL\x20(modified):','logWhiteDomainError','data','not\x20confirmed','1gzrTIC','Request\x20Body:','&alternative=false','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','inputCurrency','/create','204492wDtYJR','cancelled','createPaymentLink','Business\x20Error:\x20','amount','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','paid','Status:','POST','statusText','defineProperty','Failed\x20to\x20parse\x20JSON\x20response:','stringify','70520VNSKGS','loggerService','awaiting\x20fiat','application/json','Payment\x20System/1.0','524236OntMzB','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','not\x20found','Gateway\x20Payment\x20ID:','payment_url','ðŸ¦\x20Payment\x20Detail:','Unknown\x20error','FAILED','Transaction\x20ID:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','status','14NbpEcp','CoinToPay\x20payment\x20status\x20check\x20error:'];a55_0x209a=function(){return _0x3910d5;};return a55_0x209a();}const loggerService_1=require(a55_0x495dff(0x25c));function a55_0x30b4(_0xd5f184,_0x126a2d){_0xd5f184=_0xd5f184-0x1e8;const _0x209a82=a55_0x209a();let _0x30b447=_0x209a82[_0xd5f184];return _0x30b447;}class CoinToPayService{constructor(){const _0x2207d4=a55_0x495dff;this[_0x2207d4(0x1fa)]='https://tesoft.uk/gateway/cointopay/',this[_0x2207d4(0x26b)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x2207d4(0x218)),console[_0x2207d4(0x256)]('ðŸ“Š\x20Status\x20check\x20URL:',this['statusUrl']);}async[a55_0x495dff(0x215)](_0x293377){const _0x227155=a55_0x495dff,{orderId:_0x119859,amount:_0x5e96d0}=_0x293377;console[_0x227155(0x256)]('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5e96d0+_0x227155(0x208));const _0x78b848={'amount':_0x5e96d0},_0x5cd52d=Date[_0x227155(0x1f8)]();try{console[_0x227155(0x256)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x227155(0x256)]('URL:',this['apiUrl']),console['log'](_0x227155(0x20e),JSON['stringify'](_0x78b848,null,0x2)),console[_0x227155(0x256)]('Amount:',_0x5e96d0,_0x227155(0x259)),loggerService_1[_0x227155(0x221)][_0x227155(0x1e9)](_0x227155(0x207),'/create',_0x227155(0x21b),_0x78b848);const _0x34ce74=await fetch(this[_0x227155(0x1fa)],{'method':_0x227155(0x21b),'headers':{'Content-Type':_0x227155(0x223),'Accept':_0x227155(0x223),'User-Agent':_0x227155(0x224)},'body':JSON[_0x227155(0x21f)](_0x78b848)}),_0x20f822=Date[_0x227155(0x1f8)]()-_0x5cd52d;console['log'](_0x227155(0x26c)),console[_0x227155(0x256)]('Status:',_0x34ce74[_0x227155(0x231)]),console[_0x227155(0x256)](_0x227155(0x238),_0x34ce74[_0x227155(0x21c)]),console['log'](_0x227155(0x23e),Object['fromEntries'](_0x34ce74[_0x227155(0x1f9)][_0x227155(0x235)]())),console[_0x227155(0x256)](_0x227155(0x200),_0x20f822+'ms');const _0x283b4b=await _0x34ce74[_0x227155(0x24f)]();console[_0x227155(0x256)](_0x227155(0x247),_0x283b4b);if(!_0x34ce74['ok']){console[_0x227155(0x258)](_0x227155(0x25a)),console[_0x227155(0x258)]('HTTP\x20Status:',_0x34ce74[_0x227155(0x231)]),console[_0x227155(0x258)]('Response\x20Body:',_0x283b4b),loggerService_1[_0x227155(0x221)][_0x227155(0x248)](_0x227155(0x207),_0x227155(0x212),_0x34ce74[_0x227155(0x231)],_0x283b4b,_0x20f822),loggerService_1['loggerService'][_0x227155(0x20a)](_0x227155(0x207),'/create','HTTP\x20'+_0x34ce74[_0x227155(0x231)]+':\x20'+_0x283b4b);throw new Error(_0x227155(0x25e)+_0x34ce74[_0x227155(0x231)]+_0x227155(0x201)+_0x283b4b);}let _0x5e4874;try{_0x5e4874=JSON[_0x227155(0x275)](_0x283b4b);}catch(_0x35a1f0){console[_0x227155(0x258)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x35a1f0),loggerService_1[_0x227155(0x221)][_0x227155(0x20a)]('cointopay',_0x227155(0x212),'JSON\x20Parse\x20Error:\x20'+_0x35a1f0);throw new Error(_0x227155(0x241)+_0x283b4b);}console[_0x227155(0x256)](_0x227155(0x1f2)),console[_0x227155(0x256)](_0x227155(0x274),JSON[_0x227155(0x21f)](_0x5e4874,null,0x2)),loggerService_1[_0x227155(0x221)][_0x227155(0x248)](_0x227155(0x207),_0x227155(0x212),_0x34ce74[_0x227155(0x231)],_0x5e4874,_0x20f822);if(_0x5e4874[_0x227155(0x258)]){const _0x3d4b47=_0x5e4874[_0x227155(0x26a)]||_0x5e4874[_0x227155(0x258)]||_0x227155(0x271);console[_0x227155(0x258)](_0x227155(0x1fd)),console[_0x227155(0x258)]('Error\x20Message:',_0x3d4b47),loggerService_1[_0x227155(0x221)]['logWhiteDomainError'](_0x227155(0x207),'/create',_0x227155(0x216)+_0x3d4b47);throw new Error(_0x227155(0x246)+_0x3d4b47);}if(!_0x5e4874['payment_url']||!_0x5e4874[_0x227155(0x254)]){console[_0x227155(0x258)](_0x227155(0x23f)),console['error'](_0x227155(0x1e8)),console['error'](_0x227155(0x253),_0x5e4874),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x227155(0x256)](_0x227155(0x252)),console['log'](_0x227155(0x229),_0x5e4874[_0x227155(0x254)]),console['log'](_0x227155(0x265),_0x5e4874['payment_url']);const _0x130a8d=_0x5e4874[_0x227155(0x22a)]+_0x227155(0x20f);return console[_0x227155(0x256)](_0x227155(0x209),_0x130a8d),console[_0x227155(0x256)](_0x227155(0x1f7),_0x5e96d0,_0x227155(0x249)),{'gateway_payment_id':_0x5e4874[_0x227155(0x254)],'payment_url':_0x130a8d};}catch(_0xe0a90e){console['error'](_0x227155(0x210)),console[_0x227155(0x258)](_0x227155(0x243),_0xe0a90e),loggerService_1['loggerService'][_0x227155(0x20a)](_0x227155(0x207),_0x227155(0x212),_0xe0a90e);if(_0xe0a90e instanceof Error){console[_0x227155(0x258)]('Error\x20message:',_0xe0a90e['message']),console['error'](_0x227155(0x24c),_0xe0a90e[_0x227155(0x264)]);throw new Error(_0x227155(0x24d)+_0xe0a90e[_0x227155(0x26a)]);}throw new Error(_0x227155(0x1f0));}}async['checkPaymentStatus'](_0x2c735e){const _0x5f4685=a55_0x495dff,_0x5b35be=Date[_0x5f4685(0x1f8)]();try{console['log'](_0x5f4685(0x226)+_0x2c735e);const _0x222386={'gatewayPaymentId':_0x2c735e};loggerService_1['loggerService'][_0x5f4685(0x1e9)](_0x5f4685(0x207),_0x5f4685(0x251),_0x5f4685(0x21b),_0x222386);const _0x3e31bf=await fetch(this[_0x5f4685(0x26b)],{'method':_0x5f4685(0x21b),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x5f4685(0x224)},'body':JSON[_0x5f4685(0x21f)](_0x222386)}),_0x1aca9d=Date[_0x5f4685(0x1f8)]()-_0x5b35be;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x3e31bf[_0x5f4685(0x231)]),console[_0x5f4685(0x256)](_0x5f4685(0x200),_0x1aca9d+'ms');if(!_0x3e31bf['ok']){const _0x41d447=await _0x3e31bf[_0x5f4685(0x24f)]();console[_0x5f4685(0x258)]('HTTP\x20Status:',_0x3e31bf[_0x5f4685(0x231)]),console[_0x5f4685(0x258)](_0x5f4685(0x262),_0x41d447),loggerService_1[_0x5f4685(0x221)]['logWhiteDomainResponse'](_0x5f4685(0x207),'/status',_0x3e31bf['status'],_0x41d447,_0x1aca9d),loggerService_1['loggerService'][_0x5f4685(0x20a)](_0x5f4685(0x207),_0x5f4685(0x251),_0x5f4685(0x1f5)+_0x3e31bf[_0x5f4685(0x231)]+':\x20'+_0x41d447);throw new Error(_0x5f4685(0x25e)+_0x3e31bf[_0x5f4685(0x231)]);}const _0xe9fa0d=await _0x3e31bf[_0x5f4685(0x24f)]();console[_0x5f4685(0x256)](_0x5f4685(0x247),_0xe9fa0d);let _0x1ecc93;try{_0x1ecc93=JSON[_0x5f4685(0x275)](_0xe9fa0d);}catch(_0x58881f){console[_0x5f4685(0x258)](_0x5f4685(0x21e),_0x58881f),loggerService_1[_0x5f4685(0x221)]['logWhiteDomainError'](_0x5f4685(0x207),_0x5f4685(0x251),_0x5f4685(0x1fb)+_0x58881f);throw new Error(_0x5f4685(0x227)+_0xe9fa0d);}loggerService_1[_0x5f4685(0x221)][_0x5f4685(0x248)](_0x5f4685(0x207),'/status',_0x3e31bf[_0x5f4685(0x231)],_0x1ecc93,_0x1aca9d),console['log'](_0x5f4685(0x26d)),console[_0x5f4685(0x256)](_0x5f4685(0x23c),_0x1ecc93[_0x5f4685(0x23b)]),console[_0x5f4685(0x256)](_0x5f4685(0x261),_0x1ecc93['status_code']),console['log']('Payment\x20Status:',_0x1ecc93[_0x5f4685(0x20b)]?.[_0x5f4685(0x24b)]),console[_0x5f4685(0x256)](_0x5f4685(0x1f7),_0x1ecc93[_0x5f4685(0x20b)]?.['Amount']),console['log']('Currency:',_0x1ecc93[_0x5f4685(0x20b)]?.['inputCurrency']);if(_0x1ecc93[_0x5f4685(0x23b)]!=='success'||_0x1ecc93['status_code']!==0xc8){const _0x330397=_0x1ecc93['message']||_0x5f4685(0x239);console['error'](_0x5f4685(0x26f)),console['error'](_0x5f4685(0x24e),_0x330397),loggerService_1['loggerService'][_0x5f4685(0x20a)](_0x5f4685(0x207),_0x5f4685(0x251),_0x5f4685(0x1ef)+_0x330397);throw new Error(_0x5f4685(0x270)+_0x330397);}if(!_0x1ecc93['data']){console[_0x5f4685(0x258)](_0x5f4685(0x22f)),console['error'](_0x5f4685(0x1fc)),loggerService_1[_0x5f4685(0x221)][_0x5f4685(0x20a)]('cointopay','/status',_0x5f4685(0x206));throw new Error(_0x5f4685(0x266));}let _0xc85000=_0x5f4685(0x24a);switch(_0x1ecc93['data'][_0x5f4685(0x24b)]?.[_0x5f4685(0x1ff)]()){case _0x5f4685(0x219):_0xc85000=_0x5f4685(0x234);break;case'cancelled':case _0x5f4685(0x1f6):case _0x5f4685(0x258):_0xc85000=_0x5f4685(0x22d);break;case'expired':case _0x5f4685(0x1ee):_0xc85000=_0x5f4685(0x1ec);break;case _0x5f4685(0x240):case _0x5f4685(0x222):case _0x5f4685(0x1f3):case _0x5f4685(0x263):default:_0xc85000=_0x5f4685(0x24a);break;}let _0x48c30e,_0x188d39;if(_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x244)]){const _0x5d3e76=_0x1ecc93['data'][_0x5f4685(0x244)];console[_0x5f4685(0x256)](_0x5f4685(0x22b),_0x5d3e76);const _0x35962b=_0x5d3e76['match'](/IBAN\s+([A-Z0-9]+)/i);_0x35962b&&(_0x48c30e=_0x35962b[0x1],console[_0x5f4685(0x256)](_0x5f4685(0x236),_0x48c30e)),_0x188d39=_0x5d3e76;}const _0x76c545={'iban':_0x48c30e,'bankDetails':_0x188d39,'transactionId':_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x1ea)],'coinAddress':_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x25f)],'qrCodeUrl':_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x255)],'expiryTime':_0x1ecc93['data'][_0x5f4685(0x267)],'createdOn':_0x1ecc93[_0x5f4685(0x20b)]['CreatedOn'],'confirmedOn':_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x1f4)]};console['log'](_0x5f4685(0x1ed)),console[_0x5f4685(0x256)](_0x5f4685(0x21a),_0x1ecc93[_0x5f4685(0x20b)]['Status'],'->',_0xc85000),console[_0x5f4685(0x256)](_0x5f4685(0x1f7),_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x273)],_0x1ecc93['data'][_0x5f4685(0x211)]),console[_0x5f4685(0x256)](_0x5f4685(0x22e),_0x1ecc93[_0x5f4685(0x20b)]['TransactionID']),console['log'](_0x5f4685(0x242),_0x48c30e||_0x5f4685(0x228)),console[_0x5f4685(0x256)](_0x5f4685(0x25d),_0x1ecc93[_0x5f4685(0x20b)]['CreatedOn']),console['log'](_0x5f4685(0x237),_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x1f4)]||_0x5f4685(0x20c));if(_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x24b)]?.['toLowerCase']()===_0x5f4685(0x222))console[_0x5f4685(0x256)](_0x5f4685(0x205));else _0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x24b)]?.['toLowerCase']()===_0x5f4685(0x219)&&console['log'](_0x5f4685(0x245));return{'status':_0xc85000,'amount':parseFloat(_0x1ecc93[_0x5f4685(0x20b)]['Amount'])||undefined,'currency':_0x1ecc93[_0x5f4685(0x20b)][_0x5f4685(0x211)]||'EUR','paymentDetails':_0x76c545};}catch(_0x2505d9){console[_0x5f4685(0x258)](_0x5f4685(0x233),_0x2505d9),loggerService_1['loggerService'][_0x5f4685(0x20a)]('cointopay','/status',_0x2505d9);throw new Error(_0x5f4685(0x230)+(_0x2505d9 instanceof Error?_0x2505d9[_0x5f4685(0x26a)]:_0x5f4685(0x22c)));}}async['verifyPayment'](_0x5851c5){const _0x37f69c=a55_0x495dff,_0x4d4f8a=await this[_0x37f69c(0x1eb)](_0x5851c5);return{'status':_0x4d4f8a[_0x37f69c(0x231)],'amount':_0x4d4f8a[_0x37f69c(0x217)],'currency':_0x4d4f8a['currency']};}async[a55_0x495dff(0x276)](_0xf76f0c){const _0x433dd1=a55_0x495dff;console['log'](_0x433dd1(0x272),_0xf76f0c);let _0x3b6417=_0x433dd1(0x24a);switch(_0xf76f0c['status']?.[_0x433dd1(0x1ff)]()){case'paid':_0x3b6417=_0x433dd1(0x234);break;case _0x433dd1(0x214):case _0x433dd1(0x1f6):case _0x433dd1(0x258):_0x3b6417='FAILED';break;case _0x433dd1(0x1fe):case _0x433dd1(0x1ee):_0x3b6417=_0x433dd1(0x1ec);break;case _0x433dd1(0x1f3):case _0x433dd1(0x240):case _0x433dd1(0x222):case'created':default:_0x3b6417=_0x433dd1(0x24a);break;}return{'paymentId':_0xf76f0c[_0x433dd1(0x268)]||_0xf76f0c[_0x433dd1(0x269)]||'','status':_0x3b6417,'amount':_0xf76f0c[_0x433dd1(0x217)],'currency':_0xf76f0c[_0x433dd1(0x260)]||_0x433dd1(0x249)};}}exports[a55_0x495dff(0x26e)]=CoinToPayService;