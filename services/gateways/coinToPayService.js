'use strict';const a65_0x1f2921=a65_0x4bda;function a65_0x4bda(_0x54306a,_0x2f98e6){_0x54306a=_0x54306a-0x165;const _0x4f1a09=a65_0x4f1a();let _0x4bdaff=_0x4f1a09[_0x54306a];return _0x4bdaff;}(function(_0x274413,_0x27b577){const _0x561ab3=a65_0x4bda,_0x258c96=_0x274413();while(!![]){try{const _0x2a0286=-parseInt(_0x561ab3(0x17e))/0x1*(parseInt(_0x561ab3(0x1e4))/0x2)+-parseInt(_0x561ab3(0x16f))/0x3+-parseInt(_0x561ab3(0x1b2))/0x4*(-parseInt(_0x561ab3(0x165))/0x5)+parseInt(_0x561ab3(0x1b5))/0x6*(-parseInt(_0x561ab3(0x1ac))/0x7)+-parseInt(_0x561ab3(0x1de))/0x8+-parseInt(_0x561ab3(0x199))/0x9*(parseInt(_0x561ab3(0x1af))/0xa)+parseInt(_0x561ab3(0x174))/0xb;if(_0x2a0286===_0x27b577)break;else _0x258c96['push'](_0x258c96['shift']());}catch(_0x135579){_0x258c96['push'](_0x258c96['shift']());}}}(a65_0x4f1a,0xd6bf7));function a65_0x4f1a(){const _0x58445d=['Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20data:','data','/create','HTTP\x20Status:','EUR','Status','statusUrl','Error\x20message:','cancelled','56MzowoS','&alternative=false','Error\x20stack:','77270pGDaVm','Business\x20Error:\x20','Headers:','5403384hjnmqM','awaiting\x20fiat','statusText','672042vLwEWC','https://tesoft.uk/gateway/cointopay/','application/json','/status','FAILED','POST','Amount:','Status:','IBAN:','pending','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20Text:','Parsed\x20Result:','URL:','__esModule','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','paid','stack','Incomplete\x20response:\x20missing\x20data','expired','waiting','currency','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','gateway_payment_id','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','ExpiryTime','TransactionConfirmedOn','payment_url','defineProperty','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','JSON\x20Parse\x20Error:\x20','Raw\x20Response\x20Body:','Created\x20On:','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','Unknown\x20error','12846224JkLgcs','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','HTTP\x20','HTTP\x20error!\x20status:\x20','createPaymentLink','text','22onSefy','result','Request\x20Body:','5svALdc','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','log','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','inputCurrency','Result:','Unknown\x20error\x20from\x20CoinToPay\x20API','failed','toLowerCase','4766706IYRTuC','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','loggerService','order_id','Payment\x20Status:','56277375tAWaOU','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20Message:','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Response\x20Time:','logWhiteDomainError','QRCodeURL','apiUrl','37011IIjGTA','TransactionID','ðŸ¦\x20Extracted\x20IBAN:','logWhiteDomainRequest','verifyPayment','../loggerService','CoinToPay\x20API\x20error:\x20','\x20EUR','CoinToPayService','entries','logWhiteDomainResponse','Gateway\x20Payment\x20ID:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','timeout','message','CreatedOn','now','https://tesoft.uk/gateway/cointopay/status.php','fromEntries','Currency:','Transaction\x20ID:','Confirmed\x20On:','coinAddress','parse','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','cointopay','checkPaymentStatus','1269hPXmiy','PaymentDetail','created','error','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','Amount','ðŸ“Š\x20Status\x20check\x20URL:','status','Missing\x20data\x20in\x20response'];a65_0x4f1a=function(){return _0x58445d;};return a65_0x4f1a();}Object[a65_0x1f2921(0x1d4)](exports,a65_0x1f2921(0x1c3),{'value':!![]}),exports[a65_0x1f2921(0x186)]=void 0x0;const loggerService_1=require(a65_0x1f2921(0x183));class CoinToPayService{constructor(){const _0x77d321=a65_0x1f2921;this[_0x77d321(0x17d)]=_0x77d321(0x1b6),this['statusUrl']=_0x77d321(0x18f),console['log']('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x77d321(0x168)](_0x77d321(0x19f),this['statusUrl']);}async[a65_0x1f2921(0x1e2)](_0x452d7a){const _0x109f95=a65_0x1f2921,{orderId:_0x3c03d7,amount:_0xaa9d2d}=_0x452d7a;console['log'](_0x109f95(0x19d)+_0xaa9d2d+_0x109f95(0x185));const _0x4c9a22={'amount':_0xaa9d2d},_0x34ca48=Date[_0x109f95(0x18e)]();try{console[_0x109f95(0x168)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x109f95(0x1c2),this[_0x109f95(0x17d)]),console[_0x109f95(0x168)](_0x109f95(0x1e6),JSON[_0x109f95(0x167)](_0x4c9a22,null,0x2)),console['log'](_0x109f95(0x1bb),_0xaa9d2d,_0x109f95(0x169)),loggerService_1[_0x109f95(0x171)][_0x109f95(0x181)](_0x109f95(0x197),_0x109f95(0x1a5),_0x109f95(0x1ba),_0x4c9a22);const _0x5c78da=await fetch(this['apiUrl'],{'method':_0x109f95(0x1ba),'headers':{'Content-Type':'application/json','Accept':_0x109f95(0x1b7),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x109f95(0x167)](_0x4c9a22)}),_0x58ef1a=Date[_0x109f95(0x18e)]()-_0x34ca48;console[_0x109f95(0x168)](_0x109f95(0x175)),console[_0x109f95(0x168)](_0x109f95(0x1bc),_0x5c78da[_0x109f95(0x1a0)]),console[_0x109f95(0x168)](_0x109f95(0x1c0),_0x5c78da[_0x109f95(0x1b4)]),console[_0x109f95(0x168)](_0x109f95(0x1b1),Object[_0x109f95(0x190)](_0x5c78da['headers'][_0x109f95(0x187)]())),console[_0x109f95(0x168)](_0x109f95(0x17a),_0x58ef1a+'ms');const _0x255116=await _0x5c78da[_0x109f95(0x1e3)]();console[_0x109f95(0x168)](_0x109f95(0x1d7),_0x255116);if(!_0x5c78da['ok']){console[_0x109f95(0x19c)](_0x109f95(0x1da)),console[_0x109f95(0x19c)](_0x109f95(0x1a6),_0x5c78da[_0x109f95(0x1a0)]),console[_0x109f95(0x19c)]('Response\x20Body:',_0x255116),loggerService_1['loggerService'][_0x109f95(0x188)](_0x109f95(0x197),'/create',_0x5c78da[_0x109f95(0x1a0)],_0x255116,_0x58ef1a),loggerService_1['loggerService']['logWhiteDomainError'](_0x109f95(0x197),_0x109f95(0x1a5),_0x109f95(0x1e0)+_0x5c78da[_0x109f95(0x1a0)]+':\x20'+_0x255116);throw new Error(_0x109f95(0x1e1)+_0x5c78da[_0x109f95(0x1a0)]+',\x20body:\x20'+_0x255116);}let _0x2e6b35;try{_0x2e6b35=JSON[_0x109f95(0x195)](_0x255116);}catch(_0x59eb03){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x59eb03),loggerService_1[_0x109f95(0x171)][_0x109f95(0x17b)](_0x109f95(0x197),_0x109f95(0x1a5),_0x109f95(0x1d6)+_0x59eb03);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x255116);}console[_0x109f95(0x168)](_0x109f95(0x1cd)),console['log'](_0x109f95(0x1c1),JSON[_0x109f95(0x167)](_0x2e6b35,null,0x2)),loggerService_1[_0x109f95(0x171)][_0x109f95(0x188)](_0x109f95(0x197),_0x109f95(0x1a5),_0x5c78da[_0x109f95(0x1a0)],_0x2e6b35,_0x58ef1a);if(_0x2e6b35[_0x109f95(0x19c)]){const _0x12123b=_0x2e6b35[_0x109f95(0x18c)]||_0x2e6b35[_0x109f95(0x19c)]||_0x109f95(0x16c);console[_0x109f95(0x19c)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x109f95(0x176),_0x12123b),loggerService_1[_0x109f95(0x171)][_0x109f95(0x17b)]('cointopay',_0x109f95(0x1a5),_0x109f95(0x1b0)+_0x12123b);throw new Error(_0x109f95(0x184)+_0x12123b);}if(!_0x2e6b35[_0x109f95(0x1d3)]||!_0x2e6b35[_0x109f95(0x1cf)]){console[_0x109f95(0x19c)](_0x109f95(0x1db)),console[_0x109f95(0x19c)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x109f95(0x19c)](_0x109f95(0x1a3),_0x2e6b35),loggerService_1[_0x109f95(0x171)][_0x109f95(0x17b)](_0x109f95(0x197),_0x109f95(0x1a5),_0x109f95(0x1c5));throw new Error(_0x109f95(0x178));}console[_0x109f95(0x168)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x109f95(0x189),_0x2e6b35['gateway_payment_id']),console['log'](_0x109f95(0x1d9),_0x2e6b35['payment_url']);const _0x2ccb72=_0x2e6b35[_0x109f95(0x1d3)]+_0x109f95(0x1ad);return console[_0x109f95(0x168)]('Payment\x20URL\x20(modified):',_0x2ccb72),console['log'](_0x109f95(0x1bb),_0xaa9d2d,_0x109f95(0x1a7)),{'gateway_payment_id':_0x2e6b35[_0x109f95(0x1cf)],'payment_url':_0x2ccb72};}catch(_0x3b500a){console[_0x109f95(0x19c)](_0x109f95(0x1d0)),console['error']('Error\x20details:',_0x3b500a),loggerService_1[_0x109f95(0x171)][_0x109f95(0x17b)](_0x109f95(0x197),'/create',_0x3b500a);if(_0x3b500a instanceof Error){console['error'](_0x109f95(0x1aa),_0x3b500a[_0x109f95(0x18c)]),console[_0x109f95(0x19c)](_0x109f95(0x1ae),_0x3b500a[_0x109f95(0x1c8)]);throw new Error(_0x109f95(0x179)+_0x3b500a[_0x109f95(0x18c)]);}throw new Error(_0x109f95(0x1bf));}}async[a65_0x1f2921(0x198)](_0x39fb42){const _0x25925b=a65_0x1f2921,_0x8003e8=Date[_0x25925b(0x18e)]();try{console[_0x25925b(0x168)](_0x25925b(0x1d5)+_0x39fb42);const _0x2e7243={'gatewayPaymentId':_0x39fb42};loggerService_1[_0x25925b(0x171)][_0x25925b(0x181)]('cointopay','/status',_0x25925b(0x1ba),_0x2e7243);const _0x3ec0c8=await fetch(this[_0x25925b(0x1a9)],{'method':_0x25925b(0x1ba),'headers':{'Content-Type':'application/json','Accept':_0x25925b(0x1b7),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x25925b(0x167)](_0x2e7243)}),_0x419096=Date[_0x25925b(0x18e)]()-_0x8003e8;console[_0x25925b(0x168)](_0x25925b(0x1df)),console['log'](_0x25925b(0x1bc),_0x3ec0c8[_0x25925b(0x1a0)]),console['log'](_0x25925b(0x17a),_0x419096+'ms');if(!_0x3ec0c8['ok']){const _0x4297cd=await _0x3ec0c8[_0x25925b(0x1e3)]();console['error'](_0x25925b(0x1a6),_0x3ec0c8[_0x25925b(0x1a0)]),console[_0x25925b(0x19c)]('Response\x20Body:',_0x4297cd),loggerService_1[_0x25925b(0x171)][_0x25925b(0x188)]('cointopay',_0x25925b(0x1b8),_0x3ec0c8[_0x25925b(0x1a0)],_0x4297cd,_0x419096),loggerService_1[_0x25925b(0x171)][_0x25925b(0x17b)](_0x25925b(0x197),_0x25925b(0x1b8),_0x25925b(0x1e0)+_0x3ec0c8[_0x25925b(0x1a0)]+':\x20'+_0x4297cd);throw new Error(_0x25925b(0x1e1)+_0x3ec0c8[_0x25925b(0x1a0)]);}const _0x49f187=await _0x3ec0c8[_0x25925b(0x1e3)]();console[_0x25925b(0x168)](_0x25925b(0x1d7),_0x49f187);let _0x7163c2;try{_0x7163c2=JSON[_0x25925b(0x195)](_0x49f187);}catch(_0x1c789c){console[_0x25925b(0x19c)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1c789c),loggerService_1[_0x25925b(0x171)][_0x25925b(0x17b)](_0x25925b(0x197),_0x25925b(0x1b8),_0x25925b(0x1d6)+_0x1c789c);throw new Error(_0x25925b(0x170)+_0x49f187);}loggerService_1[_0x25925b(0x171)][_0x25925b(0x188)]('cointopay',_0x25925b(0x1b8),_0x3ec0c8[_0x25925b(0x1a0)],_0x7163c2,_0x419096),console[_0x25925b(0x168)](_0x25925b(0x196)),console[_0x25925b(0x168)](_0x25925b(0x16b),_0x7163c2[_0x25925b(0x1e5)]),console[_0x25925b(0x168)]('Status\x20Code:',_0x7163c2['status_code']),console[_0x25925b(0x168)](_0x25925b(0x173),_0x7163c2[_0x25925b(0x1a4)]?.[_0x25925b(0x1a8)]),console['log'](_0x25925b(0x1bb),_0x7163c2['data']?.[_0x25925b(0x19e)]),console[_0x25925b(0x168)](_0x25925b(0x191),_0x7163c2[_0x25925b(0x1a4)]?.['inputCurrency']);if(_0x7163c2[_0x25925b(0x1e5)]!=='success'||_0x7163c2['status_code']!==0xc8){const _0xda60d6=_0x7163c2['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x25925b(0x19c)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x25925b(0x176),_0xda60d6),loggerService_1[_0x25925b(0x171)][_0x25925b(0x17b)](_0x25925b(0x197),_0x25925b(0x1b8),_0x25925b(0x1c4)+_0xda60d6);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0xda60d6);}if(!_0x7163c2['data']){console[_0x25925b(0x19c)](_0x25925b(0x166)),console[_0x25925b(0x19c)](_0x25925b(0x1a1)),loggerService_1[_0x25925b(0x171)][_0x25925b(0x17b)](_0x25925b(0x197),'/status',_0x25925b(0x1c9));throw new Error(_0x25925b(0x1a2));}let _0x5535e1=_0x25925b(0x1c6);switch(_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1a8)]?.['toLowerCase']()){case'paid':_0x5535e1='PAID';break;case _0x25925b(0x1ab):case _0x25925b(0x16d):case _0x25925b(0x19c):_0x5535e1=_0x25925b(0x1b9);break;case _0x25925b(0x1ca):case _0x25925b(0x18b):_0x5535e1=_0x25925b(0x1dc);break;case _0x25925b(0x1cb):case _0x25925b(0x1b3):case _0x25925b(0x1be):case _0x25925b(0x19b):default:_0x5535e1=_0x25925b(0x1c6);break;}let _0x26b3cd,_0x313188;if(_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x19a)]){const _0x383470=_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x19a)];console[_0x25925b(0x168)]('ðŸ¦\x20Payment\x20Detail:',_0x383470);const _0x43b9e3=_0x383470['match'](/IBAN\s+([A-Z0-9]+)/i);_0x43b9e3&&(_0x26b3cd=_0x43b9e3[0x1],console[_0x25925b(0x168)](_0x25925b(0x180),_0x26b3cd)),_0x313188=_0x383470;}const _0x3543d1={'iban':_0x26b3cd,'bankDetails':_0x313188,'transactionId':_0x7163c2['data'][_0x25925b(0x17f)],'coinAddress':_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x194)],'qrCodeUrl':_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x17c)],'expiryTime':_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1d1)],'createdOn':_0x7163c2['data'][_0x25925b(0x18d)],'confirmedOn':_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1d2)]};console[_0x25925b(0x168)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x25925b(0x168)](_0x25925b(0x1bc),_0x7163c2['data'][_0x25925b(0x1a8)],'->',_0x5535e1),console[_0x25925b(0x168)]('Amount:',_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x19e)],_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x16a)]),console['log'](_0x25925b(0x192),_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x17f)]),console[_0x25925b(0x168)](_0x25925b(0x1bd),_0x26b3cd||'not\x20found'),console['log'](_0x25925b(0x1d8),_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x18d)]),console[_0x25925b(0x168)](_0x25925b(0x193),_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1d2)]||'not\x20confirmed');if(_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1a8)]?.[_0x25925b(0x16e)]()===_0x25925b(0x1b3))console[_0x25925b(0x168)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x1a8)]?.[_0x25925b(0x16e)]()===_0x25925b(0x1c7)&&console[_0x25925b(0x168)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5535e1,'amount':parseFloat(_0x7163c2['data']['Amount'])||undefined,'currency':_0x7163c2[_0x25925b(0x1a4)][_0x25925b(0x16a)]||_0x25925b(0x1a7),'paymentDetails':_0x3543d1};}catch(_0x356fa8){console[_0x25925b(0x19c)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x356fa8),loggerService_1[_0x25925b(0x171)][_0x25925b(0x17b)]('cointopay','/status',_0x356fa8);throw new Error(_0x25925b(0x1ce)+(_0x356fa8 instanceof Error?_0x356fa8['message']:_0x25925b(0x1dd)));}}async[a65_0x1f2921(0x182)](_0x2df358){const _0x5175fd=a65_0x1f2921,_0x4da292=await this[_0x5175fd(0x198)](_0x2df358);return{'status':_0x4da292['status'],'amount':_0x4da292['amount'],'currency':_0x4da292[_0x5175fd(0x1cc)]};}async['processWebhook'](_0x3b8654){const _0x4c7c21=a65_0x1f2921;console['log'](_0x4c7c21(0x18a),_0x3b8654);let _0x110aa6=_0x4c7c21(0x1c6);switch(_0x3b8654[_0x4c7c21(0x1a0)]?.[_0x4c7c21(0x16e)]()){case _0x4c7c21(0x1c7):_0x110aa6='PAID';break;case _0x4c7c21(0x1ab):case'failed':case _0x4c7c21(0x19c):_0x110aa6='FAILED';break;case _0x4c7c21(0x1ca):case'timeout':_0x110aa6=_0x4c7c21(0x1dc);break;case _0x4c7c21(0x1be):case'waiting':case _0x4c7c21(0x1b3):case _0x4c7c21(0x19b):default:_0x110aa6=_0x4c7c21(0x1c6);break;}return{'paymentId':_0x3b8654[_0x4c7c21(0x172)]||_0x3b8654[_0x4c7c21(0x177)]||'','status':_0x110aa6,'amount':_0x3b8654['amount'],'currency':_0x3b8654['currency']||_0x4c7c21(0x1a7)};}}exports[a65_0x1f2921(0x186)]=CoinToPayService;