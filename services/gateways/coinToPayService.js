'use strict';const a49_0x18d2e3=a49_0x4429;(function(_0x23f40e,_0x53782c){const _0x4da1a2=a49_0x4429,_0x2ecc86=_0x23f40e();while(!![]){try{const _0x34039b=parseInt(_0x4da1a2(0x1f4))/0x1*(-parseInt(_0x4da1a2(0x1c1))/0x2)+parseInt(_0x4da1a2(0x1da))/0x3+-parseInt(_0x4da1a2(0x1dc))/0x4*(parseInt(_0x4da1a2(0x19f))/0x5)+parseInt(_0x4da1a2(0x1f6))/0x6+-parseInt(_0x4da1a2(0x1e9))/0x7*(parseInt(_0x4da1a2(0x1d8))/0x8)+-parseInt(_0x4da1a2(0x18d))/0x9*(-parseInt(_0x4da1a2(0x188))/0xa)+parseInt(_0x4da1a2(0x1b7))/0xb*(-parseInt(_0x4da1a2(0x1b0))/0xc);if(_0x34039b===_0x53782c)break;else _0x2ecc86['push'](_0x2ecc86['shift']());}catch(_0x1c03c2){_0x2ecc86['push'](_0x2ecc86['shift']());}}}(a49_0x5655,0xb3334));function a49_0x4429(_0x28d046,_0x4aca9e){const _0x565509=a49_0x5655();return a49_0x4429=function(_0x4429ed,_0x1a7fbe){_0x4429ed=_0x4429ed-0x180;let _0x4dc54f=_0x565509[_0x4429ed];return _0x4dc54f;},a49_0x4429(_0x28d046,_0x4aca9e);}Object[a49_0x18d2e3(0x1d5)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a49_0x18d2e3(0x1d7));class CoinToPayService{constructor(){const _0x21a08d=a49_0x18d2e3;this[_0x21a08d(0x1d9)]=_0x21a08d(0x1af),this['statusUrl']=_0x21a08d(0x1a2),console[_0x21a08d(0x1d6)](_0x21a08d(0x203)),console[_0x21a08d(0x1d6)](_0x21a08d(0x1a1),this[_0x21a08d(0x1dd)]);}async[a49_0x18d2e3(0x1cc)](_0xa5c6bd){const _0x4049ef=a49_0x18d2e3,{orderId:_0x58ecd7,amount:_0x31b04f}=_0xa5c6bd;console['log'](_0x4049ef(0x1a9)+_0x31b04f+'\x20EUR');const _0x311971={'amount':_0x31b04f},_0x1c46d1=Date['now']();try{console[_0x4049ef(0x1d6)](_0x4049ef(0x19d)),console['log']('URL:',this[_0x4049ef(0x1d9)]),console[_0x4049ef(0x1d6)]('Request\x20Body:',JSON[_0x4049ef(0x189)](_0x311971,null,0x2)),console[_0x4049ef(0x1d6)](_0x4049ef(0x1e3),_0x31b04f,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x4049ef(0x1c3)][_0x4049ef(0x205)]('cointopay',_0x4049ef(0x1f7),_0x4049ef(0x1ff),_0x311971);const _0x3a2b56=await fetch(this[_0x4049ef(0x1d9)],{'method':_0x4049ef(0x1ff),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x4049ef(0x19a)},'body':JSON['stringify'](_0x311971)}),_0x4b8ea3=Date[_0x4049ef(0x18a)]()-_0x1c46d1;console[_0x4049ef(0x1d6)](_0x4049ef(0x1fd)),console[_0x4049ef(0x1d6)](_0x4049ef(0x1bd),_0x3a2b56['status']),console[_0x4049ef(0x1d6)](_0x4049ef(0x19b),_0x3a2b56['statusText']),console[_0x4049ef(0x1d6)](_0x4049ef(0x18e),Object[_0x4049ef(0x1ca)](_0x3a2b56['headers'][_0x4049ef(0x183)]())),console[_0x4049ef(0x1d6)](_0x4049ef(0x1b2),_0x4b8ea3+'ms');const _0x2a0df0=await _0x3a2b56[_0x4049ef(0x202)]();console['log'](_0x4049ef(0x187),_0x2a0df0);if(!_0x3a2b56['ok']){console[_0x4049ef(0x1ce)](_0x4049ef(0x208)),console[_0x4049ef(0x1ce)](_0x4049ef(0x1b3),_0x3a2b56['status']),console[_0x4049ef(0x1ce)]('Response\x20Body:',_0x2a0df0),loggerService_1['loggerService'][_0x4049ef(0x1f2)]('cointopay',_0x4049ef(0x1f7),_0x3a2b56['status'],_0x2a0df0,_0x4b8ea3),loggerService_1[_0x4049ef(0x1c3)][_0x4049ef(0x1b8)](_0x4049ef(0x1a7),'/create','HTTP\x20'+_0x3a2b56['status']+':\x20'+_0x2a0df0);throw new Error(_0x4049ef(0x1c9)+_0x3a2b56[_0x4049ef(0x181)]+_0x4049ef(0x20a)+_0x2a0df0);}let _0x3c0a3e;try{_0x3c0a3e=JSON[_0x4049ef(0x180)](_0x2a0df0);}catch(_0x4c1f7a){console[_0x4049ef(0x1ce)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4c1f7a),loggerService_1[_0x4049ef(0x1c3)][_0x4049ef(0x1b8)](_0x4049ef(0x1a7),_0x4049ef(0x1f7),_0x4049ef(0x1a4)+_0x4c1f7a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2a0df0);}console[_0x4049ef(0x1d6)](_0x4049ef(0x1ab)),console[_0x4049ef(0x1d6)](_0x4049ef(0x1c5),JSON[_0x4049ef(0x189)](_0x3c0a3e,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4049ef(0x1a7),'/create',_0x3a2b56['status'],_0x3c0a3e,_0x4b8ea3);if(_0x3c0a3e[_0x4049ef(0x1ce)]){const _0x2dbcb5=_0x3c0a3e[_0x4049ef(0x1de)]||_0x3c0a3e[_0x4049ef(0x1ce)]||_0x4049ef(0x1c7);console['error'](_0x4049ef(0x1f0)),console[_0x4049ef(0x1ce)](_0x4049ef(0x1ac),_0x2dbcb5),loggerService_1['loggerService'][_0x4049ef(0x1b8)](_0x4049ef(0x1a7),_0x4049ef(0x1f7),_0x4049ef(0x1a8)+_0x2dbcb5);throw new Error(_0x4049ef(0x1fa)+_0x2dbcb5);}if(!_0x3c0a3e[_0x4049ef(0x18c)]||!_0x3c0a3e[_0x4049ef(0x204)]){console[_0x4049ef(0x1ce)](_0x4049ef(0x1a0)),console[_0x4049ef(0x1ce)](_0x4049ef(0x1e1)),console[_0x4049ef(0x1ce)](_0x4049ef(0x1bb),_0x3c0a3e),loggerService_1[_0x4049ef(0x1c3)][_0x4049ef(0x1b8)](_0x4049ef(0x1a7),_0x4049ef(0x1f7),_0x4049ef(0x186));throw new Error(_0x4049ef(0x1c4));}console[_0x4049ef(0x1d6)](_0x4049ef(0x1d4)),console[_0x4049ef(0x1d6)](_0x4049ef(0x182),_0x3c0a3e[_0x4049ef(0x204)]),console['log']('Payment\x20URL\x20(original):',_0x3c0a3e[_0x4049ef(0x18c)]);const _0x28aecf=_0x3c0a3e[_0x4049ef(0x18c)]+'&alternative=false';return console['log'](_0x4049ef(0x196),_0x28aecf),console[_0x4049ef(0x1d6)](_0x4049ef(0x1e3),_0x31b04f,_0x4049ef(0x199)),{'gateway_payment_id':_0x3c0a3e['gateway_payment_id'],'payment_url':_0x28aecf};}catch(_0x25eabc){console['error'](_0x4049ef(0x190)),console['error']('Error\x20details:',_0x25eabc),loggerService_1[_0x4049ef(0x1c3)]['logWhiteDomainError'](_0x4049ef(0x1a7),_0x4049ef(0x1f7),_0x25eabc);if(_0x25eabc instanceof Error){console[_0x4049ef(0x1ce)](_0x4049ef(0x1be),_0x25eabc[_0x4049ef(0x1de)]),console['error'](_0x4049ef(0x19e),_0x25eabc[_0x4049ef(0x184)]);throw new Error(_0x4049ef(0x1e8)+_0x25eabc[_0x4049ef(0x1de)]);}throw new Error(_0x4049ef(0x1ef));}}async[a49_0x18d2e3(0x1d3)](_0x1b513e){const _0x504fe1=a49_0x18d2e3,_0x2f8200=Date[_0x504fe1(0x18a)]();try{console[_0x504fe1(0x1d6)](_0x504fe1(0x1f8)+_0x1b513e);const _0x54ec3d={'gatewayPaymentId':_0x1b513e};loggerService_1[_0x504fe1(0x1c3)]['logWhiteDomainRequest']('cointopay',_0x504fe1(0x1cb),_0x504fe1(0x1ff),_0x54ec3d);const _0x56d923=await fetch(this[_0x504fe1(0x1dd)],{'method':_0x504fe1(0x1ff),'headers':{'Content-Type':_0x504fe1(0x194),'Accept':_0x504fe1(0x194),'User-Agent':_0x504fe1(0x19a)},'body':JSON['stringify'](_0x54ec3d)}),_0x1d0dba=Date['now']()-_0x2f8200;console[_0x504fe1(0x1d6)](_0x504fe1(0x1e7)),console[_0x504fe1(0x1d6)]('Status:',_0x56d923['status']),console[_0x504fe1(0x1d6)]('Response\x20Time:',_0x1d0dba+'ms');if(!_0x56d923['ok']){const _0x5d0b5d=await _0x56d923[_0x504fe1(0x202)]();console['error']('HTTP\x20Status:',_0x56d923[_0x504fe1(0x181)]),console['error'](_0x504fe1(0x1ea),_0x5d0b5d),loggerService_1[_0x504fe1(0x1c3)]['logWhiteDomainResponse']('cointopay',_0x504fe1(0x1cb),_0x56d923['status'],_0x5d0b5d,_0x1d0dba),loggerService_1[_0x504fe1(0x1c3)]['logWhiteDomainError'](_0x504fe1(0x1a7),_0x504fe1(0x1cb),_0x504fe1(0x1aa)+_0x56d923[_0x504fe1(0x181)]+':\x20'+_0x5d0b5d);throw new Error(_0x504fe1(0x1c9)+_0x56d923[_0x504fe1(0x181)]);}const _0x5eb040=await _0x56d923[_0x504fe1(0x202)]();console[_0x504fe1(0x1d6)]('Raw\x20Response\x20Body:',_0x5eb040);let _0xcec510;try{_0xcec510=JSON['parse'](_0x5eb040);}catch(_0x425110){console['error'](_0x504fe1(0x1e5),_0x425110),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x504fe1(0x1cb),_0x504fe1(0x1a4)+_0x425110);throw new Error(_0x504fe1(0x1b4)+_0x5eb040);}loggerService_1[_0x504fe1(0x1c3)]['logWhiteDomainResponse'](_0x504fe1(0x1a7),_0x504fe1(0x1cb),_0x56d923['status'],_0xcec510,_0x1d0dba),console[_0x504fe1(0x1d6)](_0x504fe1(0x1ed)),console[_0x504fe1(0x1d6)](_0x504fe1(0x1bf),_0xcec510[_0x504fe1(0x1df)]),console[_0x504fe1(0x1d6)](_0x504fe1(0x1f9),_0xcec510[_0x504fe1(0x1fc)]),console[_0x504fe1(0x1d6)](_0x504fe1(0x1d1),_0xcec510[_0x504fe1(0x1f1)]?.[_0x504fe1(0x185)]),console['log'](_0x504fe1(0x1e3),_0xcec510[_0x504fe1(0x1f1)]?.[_0x504fe1(0x18b)]),console[_0x504fe1(0x1d6)]('Currency:',_0xcec510['data']?.[_0x504fe1(0x1c0)]);if(_0xcec510['result']!==_0x504fe1(0x1f3)||_0xcec510['status_code']!==0xc8){const _0x3bf50d=_0xcec510[_0x504fe1(0x1de)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x504fe1(0x1ce)](_0x504fe1(0x1b6)),console[_0x504fe1(0x1ce)](_0x504fe1(0x1ac),_0x3bf50d),loggerService_1['loggerService'][_0x504fe1(0x1b8)](_0x504fe1(0x1a7),'/status',_0x504fe1(0x1e0)+_0x3bf50d);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x3bf50d);}if(!_0xcec510['data']){console[_0x504fe1(0x1ce)](_0x504fe1(0x1e6)),console[_0x504fe1(0x1ce)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x504fe1(0x1c3)][_0x504fe1(0x1b8)]('cointopay',_0x504fe1(0x1cb),_0x504fe1(0x1e2));throw new Error(_0x504fe1(0x1a6));}let _0x5f4037=_0x504fe1(0x1d2);switch(_0xcec510[_0x504fe1(0x1f1)]['Status']?.[_0x504fe1(0x1c8)]()){case'paid':_0x5f4037=_0x504fe1(0x1bc);break;case _0x504fe1(0x209):case _0x504fe1(0x1d0):case _0x504fe1(0x1ce):_0x5f4037=_0x504fe1(0x19c);break;case _0x504fe1(0x198):case _0x504fe1(0x1fe):_0x5f4037='EXPIRED';break;case _0x504fe1(0x1cf):case _0x504fe1(0x1b9):case _0x504fe1(0x1ee):case _0x504fe1(0x1fb):default:_0x5f4037='PENDING';break;}let _0x49a507,_0x7f7300;if(_0xcec510[_0x504fe1(0x1f1)]['PaymentDetail']){const _0x52602e=_0xcec510['data'][_0x504fe1(0x1e4)];console[_0x504fe1(0x1d6)](_0x504fe1(0x207),_0x52602e);const _0x3bf707=_0x52602e[_0x504fe1(0x1c2)](/IBAN\s+([A-Z0-9]+)/i);_0x3bf707&&(_0x49a507=_0x3bf707[0x1],console[_0x504fe1(0x1d6)](_0x504fe1(0x206),_0x49a507)),_0x7f7300=_0x52602e;}const _0x115822={'iban':_0x49a507,'bankDetails':_0x7f7300,'transactionId':_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1a5)],'coinAddress':_0xcec510[_0x504fe1(0x1f1)]['coinAddress'],'qrCodeUrl':_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1eb)],'expiryTime':_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x192)],'createdOn':_0xcec510[_0x504fe1(0x1f1)]['CreatedOn'],'confirmedOn':_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1b5)]};console[_0x504fe1(0x1d6)](_0x504fe1(0x200)),console[_0x504fe1(0x1d6)]('Status:',_0xcec510['data']['Status'],'->',_0x5f4037),console[_0x504fe1(0x1d6)]('Amount:',_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x18b)],_0xcec510['data']['inputCurrency']),console['log'](_0x504fe1(0x193),_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1a5)]),console['log']('IBAN:',_0x49a507||_0x504fe1(0x1ad)),console[_0x504fe1(0x1d6)](_0x504fe1(0x1f5),_0xcec510['data'][_0x504fe1(0x18f)]),console[_0x504fe1(0x1d6)]('Confirmed\x20On:',_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1b5)]||_0x504fe1(0x197));if(_0xcec510[_0x504fe1(0x1f1)]['Status']?.['toLowerCase']()===_0x504fe1(0x1b9))console[_0x504fe1(0x1d6)](_0x504fe1(0x195));else _0xcec510['data'][_0x504fe1(0x185)]?.[_0x504fe1(0x1c8)]()===_0x504fe1(0x1b1)&&console[_0x504fe1(0x1d6)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5f4037,'amount':parseFloat(_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x18b)])||undefined,'currency':_0xcec510[_0x504fe1(0x1f1)][_0x504fe1(0x1c0)]||_0x504fe1(0x199),'paymentDetails':_0x115822};}catch(_0x5f47e6){console[_0x504fe1(0x1ce)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x5f47e6),loggerService_1['loggerService'][_0x504fe1(0x1b8)](_0x504fe1(0x1a7),_0x504fe1(0x1cb),_0x5f47e6);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x5f47e6 instanceof Error?_0x5f47e6[_0x504fe1(0x1de)]:'Unknown\x20error'));}}async[a49_0x18d2e3(0x1c6)](_0x3d92ab){const _0x8c1f9d=a49_0x18d2e3,_0x1b1620=await this[_0x8c1f9d(0x1d3)](_0x3d92ab);return{'status':_0x1b1620[_0x8c1f9d(0x181)],'amount':_0x1b1620[_0x8c1f9d(0x1db)],'currency':_0x1b1620['currency']};}async[a49_0x18d2e3(0x191)](_0x4c246f){const _0x55ec11=a49_0x18d2e3;console[_0x55ec11(0x1d6)](_0x55ec11(0x1ba),_0x4c246f);let _0x149443=_0x55ec11(0x1d2);switch(_0x4c246f[_0x55ec11(0x181)]?.[_0x55ec11(0x1c8)]()){case _0x55ec11(0x1b1):_0x149443=_0x55ec11(0x1bc);break;case _0x55ec11(0x209):case _0x55ec11(0x1d0):case'error':_0x149443=_0x55ec11(0x19c);break;case _0x55ec11(0x198):case'timeout':_0x149443=_0x55ec11(0x1ec);break;case'pending':case'waiting':case _0x55ec11(0x1b9):case _0x55ec11(0x1fb):default:_0x149443=_0x55ec11(0x1d2);break;}return{'paymentId':_0x4c246f[_0x55ec11(0x1ae)]||_0x4c246f[_0x55ec11(0x1cd)]||'','status':_0x149443,'amount':_0x4c246f[_0x55ec11(0x1db)],'currency':_0x4c246f[_0x55ec11(0x1a3)]||_0x55ec11(0x199)};}}exports[a49_0x18d2e3(0x201)]=CoinToPayService;function a49_0x5655(){const _0x14bcdc=['HTTP\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Error\x20Message:','not\x20found','order_id','https://tesoft.uk/gateway/cointopay/','4668qLfbhE','paid','Response\x20Time:','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','9746ZSCUvm','logWhiteDomainError','awaiting\x20fiat','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20data:','PAID','Status:','Error\x20message:','Result:','inputCurrency','58ilwuUV','match','loggerService','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Parsed\x20Result:','verifyPayment','Unknown\x20error\x20from\x20CoinToPay\x20API','toLowerCase','HTTP\x20error!\x20status:\x20','fromEntries','/status','createPaymentLink','merchant_reference_id','error','waiting','failed','Payment\x20Status:','PENDING','checkPaymentStatus','===\x20COINTOPAY\x20SUCCESS\x20===','defineProperty','log','../loggerService','5016ZJEjSM','apiUrl','766284rgDgKy','amount','34260UJGpPc','statusUrl','message','result','Status\x20API\x20Error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Incomplete\x20response:\x20missing\x20data','Amount:','PaymentDetail','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','4641UHONHW','Response\x20Body:','QRCodeURL','EXPIRED','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','pending','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','data','logWhiteDomainResponse','success','16973AnbPNP','Created\x20On:','8389284alUfXd','/create','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status\x20Code:','CoinToPay\x20API\x20error:\x20','created','status_code','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','timeout','POST','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','CoinToPayService','text','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','gateway_payment_id','logWhiteDomainRequest','🏦\x20Extracted\x20IBAN:','🏦\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20ERROR\x20===','cancelled',',\x20body:\x20','parse','status','Gateway\x20Payment\x20ID:','entries','stack','Status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Raw\x20Response\x20Body:','220LhPqQI','stringify','now','Amount','payment_url','143208EvgWUa','Headers:','CreatedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','processWebhook','ExpiryTime','Transaction\x20ID:','application/json','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Payment\x20URL\x20(modified):','not\x20confirmed','expired','EUR','Payment\x20System/1.0','Status\x20Text:','FAILED','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20stack:','10HqdlzV','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','📊\x20Status\x20check\x20URL:','https://tesoft.uk/gateway/cointopay/status.php','currency','JSON\x20Parse\x20Error:\x20','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','cointopay','Business\x20Error:\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20'];a49_0x5655=function(){return _0x14bcdc;};return a49_0x5655();}