'use strict';const a49_0x448a65=a49_0x587f;(function(_0x3cdf9c,_0x2515e5){const _0x31ed9a=a49_0x587f,_0x1c65fd=_0x3cdf9c();while(!![]){try{const _0x4f3c96=parseInt(_0x31ed9a(0x14f))/0x1+-parseInt(_0x31ed9a(0x15f))/0x2*(-parseInt(_0x31ed9a(0x126))/0x3)+-parseInt(_0x31ed9a(0xec))/0x4*(-parseInt(_0x31ed9a(0xfd))/0x5)+-parseInt(_0x31ed9a(0x103))/0x6*(parseInt(_0x31ed9a(0x14e))/0x7)+parseInt(_0x31ed9a(0x167))/0x8*(parseInt(_0x31ed9a(0x168))/0x9)+parseInt(_0x31ed9a(0x100))/0xa*(parseInt(_0x31ed9a(0x163))/0xb)+parseInt(_0x31ed9a(0x160))/0xc*(-parseInt(_0x31ed9a(0x166))/0xd);if(_0x4f3c96===_0x2515e5)break;else _0x1c65fd['push'](_0x1c65fd['shift']());}catch(_0x194278){_0x1c65fd['push'](_0x1c65fd['shift']());}}}(a49_0xdf59,0x8fca6));function a49_0xdf59(){const _0x164276=['failed','Parsed\x20Result:','error','log','logWhiteDomainResponse','apiUrl','not\x20confirmed','Payment\x20Status:','checkPaymentStatus','HTTP\x20Status:','fromEntries','message',',\x20body:\x20','status_code','CoinToPay\x20payment\x20status\x20check\x20error:','Headers:','application/json','HTTP\x20error!\x20status:\x20','Currency:','920967MyivBt','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','PaymentDetail','parse','logWhiteDomainRequest','coinAddress','Response\x20Body:','QRCodeURL','success','Response\x20Time:','awaiting\x20fiat','stringify','Status\x20Text:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20','loggerService','data','&alternative=false','inputCurrency','Status','payment_url','Payment\x20URL\x20(original):','PAID','IBAN:','waiting','TransactionID','/status','Error\x20details:','pending','defineProperty','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','https://tesoft.uk/gateway/cointopay/','__esModule','toLowerCase','Amount:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','1267GVSbmx','1133815CUPWNa','Unknown\x20error\x20from\x20CoinToPay\x20API','Raw\x20Response\x20Body:','stack','Status:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Confirmed\x20On:','statusText','statusUrl','status','POST','Status\x20Code:','created','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Incomplete\x20response:\x20missing\x20data','CoinToPayService','2OmnfsC','2081208egmTeC','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','22yvPDxc','logWhiteDomainError','createPaymentLink','169USpSel','32552EiPWny','1629XLucHo','verifyPayment','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','ExpiryTime','Error\x20message:','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','292hfgcuw','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','FAILED','===\x20COINTOPAY\x20SUCCESS\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','EUR','Missing\x20data\x20in\x20response','Amount','Request\x20Body:','CreatedOn','currency','expired','paid','Payment\x20System/1.0','URL:','PENDING','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','64910hnPRmE','order_id','Business\x20Error:\x20','3544400oYfBdO','Result:','/create','32826QVlYiN','EXPIRED','../loggerService','headers','processWebhook','Error\x20Message:','üìä\x20Status\x20check\x20URL:','now','Unknown\x20error','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','entries','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','gateway_payment_id','merchant_reference_id','TransactionConfirmedOn'];a49_0xdf59=function(){return _0x164276;};return a49_0xdf59();}Object[a49_0x448a65(0x145)](exports,a49_0x448a65(0x14a),{'value':!![]}),exports[a49_0x448a65(0x15e)]=void 0x0;const loggerService_1=require(a49_0x448a65(0x105));class CoinToPayService{constructor(){const _0x3e5990=a49_0x448a65;this[_0x3e5990(0x118)]=_0x3e5990(0x149),this[_0x3e5990(0x157)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3e5990(0x116)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x3e5990(0x116)](_0x3e5990(0x109),this[_0x3e5990(0x157)]);}async[a49_0x448a65(0x165)](_0x3d486b){const _0xde7708=a49_0x448a65,{orderId:_0x232736,amount:_0x364e6d}=_0x3d486b;console[_0xde7708(0x116)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x364e6d+'\x20EUR');const _0x25afcc={'amount':_0x364e6d},_0x14bdb6=Date[_0xde7708(0x10a)]();try{console[_0xde7708(0x116)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xde7708(0x116)](_0xde7708(0xfa),this[_0xde7708(0x118)]),console[_0xde7708(0x116)](_0xde7708(0xf4),JSON[_0xde7708(0x133)](_0x25afcc,null,0x2)),console['log'](_0xde7708(0x14c),_0x364e6d,_0xde7708(0x127)),loggerService_1['loggerService'][_0xde7708(0x12c)](_0xde7708(0x16f),_0xde7708(0x102),_0xde7708(0x159),_0x25afcc);const _0x55aa42=await fetch(this[_0xde7708(0x118)],{'method':_0xde7708(0x159),'headers':{'Content-Type':_0xde7708(0x123),'Accept':_0xde7708(0x123),'User-Agent':_0xde7708(0xf9)},'body':JSON[_0xde7708(0x133)](_0x25afcc)}),_0xb505e1=Date['now']()-_0x14bdb6;console[_0xde7708(0x116)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xde7708(0x153),_0x55aa42[_0xde7708(0x158)]),console['log'](_0xde7708(0x134),_0x55aa42[_0xde7708(0x156)]),console['log'](_0xde7708(0x122),Object[_0xde7708(0x11d)](_0x55aa42[_0xde7708(0x106)][_0xde7708(0x10e)]())),console[_0xde7708(0x116)](_0xde7708(0x131),_0xb505e1+'ms');const _0x174491=await _0x55aa42['text']();console['log']('Raw\x20Response\x20Body:',_0x174491);if(!_0x55aa42['ok']){console[_0xde7708(0x115)](_0xde7708(0x129)),console[_0xde7708(0x115)](_0xde7708(0x11c),_0x55aa42[_0xde7708(0x158)]),console[_0xde7708(0x115)](_0xde7708(0x12e),_0x174491),loggerService_1[_0xde7708(0x137)][_0xde7708(0x117)]('cointopay',_0xde7708(0x102),_0x55aa42[_0xde7708(0x158)],_0x174491,_0xb505e1),loggerService_1['loggerService']['logWhiteDomainError'](_0xde7708(0x16f),_0xde7708(0x102),_0xde7708(0x136)+_0x55aa42[_0xde7708(0x158)]+':\x20'+_0x174491);throw new Error(_0xde7708(0x124)+_0x55aa42[_0xde7708(0x158)]+_0xde7708(0x11f)+_0x174491);}let _0x410be9;try{_0x410be9=JSON['parse'](_0x174491);}catch(_0x4fe20f){console['error'](_0xde7708(0x16e),_0x4fe20f),loggerService_1[_0xde7708(0x137)][_0xde7708(0x164)](_0xde7708(0x16f),_0xde7708(0x102),'JSON\x20Parse\x20Error:\x20'+_0x4fe20f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x174491);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0xde7708(0x116)](_0xde7708(0x114),JSON[_0xde7708(0x133)](_0x410be9,null,0x2)),loggerService_1[_0xde7708(0x137)][_0xde7708(0x117)](_0xde7708(0x16f),'/create',_0x55aa42[_0xde7708(0x158)],_0x410be9,_0xb505e1);if(_0x410be9[_0xde7708(0x115)]){const _0x137982=_0x410be9['message']||_0x410be9[_0xde7708(0x115)]||_0xde7708(0x150);console[_0xde7708(0x115)](_0xde7708(0x16b)),console[_0xde7708(0x115)](_0xde7708(0x108),_0x137982),loggerService_1['loggerService'][_0xde7708(0x164)](_0xde7708(0x16f),_0xde7708(0x102),_0xde7708(0xff)+_0x137982);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x137982);}if(!_0x410be9[_0xde7708(0x13c)]||!_0x410be9[_0xde7708(0x110)]){console[_0xde7708(0x115)](_0xde7708(0x162)),console[_0xde7708(0x115)](_0xde7708(0x148)),console['error']('Response\x20data:',_0x410be9),loggerService_1[_0xde7708(0x137)]['logWhiteDomainError'](_0xde7708(0x16f),_0xde7708(0x102),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0xde7708(0x10d));}console[_0xde7708(0x116)](_0xde7708(0xef)),console[_0xde7708(0x116)](_0xde7708(0x16a),_0x410be9[_0xde7708(0x110)]),console[_0xde7708(0x116)](_0xde7708(0x13d),_0x410be9[_0xde7708(0x13c)]);const _0x44b43c=_0x410be9['payment_url']+_0xde7708(0x139);return console['log']('Payment\x20URL\x20(modified):',_0x44b43c),console['log'](_0xde7708(0x14c),_0x364e6d,_0xde7708(0xf1)),{'gateway_payment_id':_0x410be9[_0xde7708(0x110)],'payment_url':_0x44b43c};}catch(_0xa665){console['error'](_0xde7708(0xea)),console[_0xde7708(0x115)](_0xde7708(0x143),_0xa665),loggerService_1[_0xde7708(0x137)][_0xde7708(0x164)]('cointopay','/create',_0xa665);if(_0xa665 instanceof Error){console[_0xde7708(0x115)](_0xde7708(0x16d),_0xa665[_0xde7708(0x11e)]),console[_0xde7708(0x115)]('Error\x20stack:',_0xa665[_0xde7708(0x152)]);throw new Error(_0xde7708(0xed)+_0xa665[_0xde7708(0x11e)]);}throw new Error(_0xde7708(0x14d));}}async['checkPaymentStatus'](_0x3e521a){const _0x30f2d6=a49_0x448a65,_0x5ddc7f=Date[_0x30f2d6(0x10a)]();try{console['log'](_0x30f2d6(0x15c)+_0x3e521a);const _0x4041bf={'gatewayPaymentId':_0x3e521a};loggerService_1[_0x30f2d6(0x137)][_0x30f2d6(0x12c)]('cointopay','/status',_0x30f2d6(0x159),_0x4041bf);const _0x45119d=await fetch(this['statusUrl'],{'method':_0x30f2d6(0x159),'headers':{'Content-Type':_0x30f2d6(0x123),'Accept':_0x30f2d6(0x123),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x30f2d6(0x133)](_0x4041bf)}),_0x2ae848=Date[_0x30f2d6(0x10a)]()-_0x5ddc7f;console[_0x30f2d6(0x116)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x45119d[_0x30f2d6(0x158)]),console[_0x30f2d6(0x116)](_0x30f2d6(0x131),_0x2ae848+'ms');if(!_0x45119d['ok']){const _0x457149=await _0x45119d['text']();console[_0x30f2d6(0x115)](_0x30f2d6(0x11c),_0x45119d[_0x30f2d6(0x158)]),console[_0x30f2d6(0x115)](_0x30f2d6(0x12e),_0x457149),loggerService_1[_0x30f2d6(0x137)][_0x30f2d6(0x117)](_0x30f2d6(0x16f),'/status',_0x45119d[_0x30f2d6(0x158)],_0x457149,_0x2ae848),loggerService_1[_0x30f2d6(0x137)][_0x30f2d6(0x164)]('cointopay','/status','HTTP\x20'+_0x45119d[_0x30f2d6(0x158)]+':\x20'+_0x457149);throw new Error(_0x30f2d6(0x124)+_0x45119d['status']);}const _0x5e0ddc=await _0x45119d['text']();console[_0x30f2d6(0x116)](_0x30f2d6(0x151),_0x5e0ddc);let _0x12b62e;try{_0x12b62e=JSON[_0x30f2d6(0x12b)](_0x5e0ddc);}catch(_0x431b8c){console[_0x30f2d6(0x115)](_0x30f2d6(0x16e),_0x431b8c),loggerService_1[_0x30f2d6(0x137)]['logWhiteDomainError']('cointopay',_0x30f2d6(0x142),'JSON\x20Parse\x20Error:\x20'+_0x431b8c);throw new Error(_0x30f2d6(0x135)+_0x5e0ddc);}loggerService_1['loggerService'][_0x30f2d6(0x117)]('cointopay',_0x30f2d6(0x142),_0x45119d[_0x30f2d6(0x158)],_0x12b62e,_0x2ae848),console[_0x30f2d6(0x116)](_0x30f2d6(0x10f)),console['log'](_0x30f2d6(0x101),_0x12b62e['result']),console['log'](_0x30f2d6(0x15a),_0x12b62e[_0x30f2d6(0x120)]),console[_0x30f2d6(0x116)](_0x30f2d6(0x11a),_0x12b62e[_0x30f2d6(0x138)]?.['Status']),console['log']('Amount:',_0x12b62e['data']?.['Amount']),console['log'](_0x30f2d6(0x125),_0x12b62e[_0x30f2d6(0x138)]?.[_0x30f2d6(0x13a)]);if(_0x12b62e['result']!==_0x30f2d6(0x130)||_0x12b62e['status_code']!==0xc8){const _0xf7dd14=_0x12b62e[_0x30f2d6(0x11e)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x30f2d6(0x115)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x30f2d6(0x115)](_0x30f2d6(0x108),_0xf7dd14),loggerService_1['loggerService'][_0x30f2d6(0x164)](_0x30f2d6(0x16f),'/status','Status\x20API\x20Error:\x20'+_0xf7dd14);throw new Error(_0x30f2d6(0x128)+_0xf7dd14);}if(!_0x12b62e[_0x30f2d6(0x138)]){console[_0x30f2d6(0x115)](_0x30f2d6(0xeb)),console['error'](_0x30f2d6(0xf2)),loggerService_1[_0x30f2d6(0x137)][_0x30f2d6(0x164)](_0x30f2d6(0x16f),_0x30f2d6(0x142),_0x30f2d6(0x15d));throw new Error(_0x30f2d6(0xf0));}let _0x1b2c0d=_0x30f2d6(0xfb);switch(_0x12b62e['data']['Status']?.[_0x30f2d6(0x14b)]()){case _0x30f2d6(0xf8):_0x1b2c0d=_0x30f2d6(0x13e);break;case _0x30f2d6(0x10c):case _0x30f2d6(0x113):case _0x30f2d6(0x115):_0x1b2c0d=_0x30f2d6(0xee);break;case _0x30f2d6(0xf7):case'timeout':_0x1b2c0d=_0x30f2d6(0x104);break;case _0x30f2d6(0x140):case _0x30f2d6(0x132):case _0x30f2d6(0x144):case _0x30f2d6(0x15b):default:_0x1b2c0d=_0x30f2d6(0xfb);break;}let _0x5af1c0,_0x51ec29;if(_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x12a)]){const _0x378076=_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x12a)];console[_0x30f2d6(0x116)](_0x30f2d6(0x161),_0x378076);const _0x43444c=_0x378076[_0x30f2d6(0x147)](/IBAN\s+([A-Z0-9]+)/i);_0x43444c&&(_0x5af1c0=_0x43444c[0x1],console[_0x30f2d6(0x116)]('üè¶\x20Extracted\x20IBAN:',_0x5af1c0)),_0x51ec29=_0x378076;}const _0x1da6de={'iban':_0x5af1c0,'bankDetails':_0x51ec29,'transactionId':_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x141)],'coinAddress':_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x12d)],'qrCodeUrl':_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x12f)],'expiryTime':_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x16c)],'createdOn':_0x12b62e['data']['CreatedOn'],'confirmedOn':_0x12b62e['data'][_0x30f2d6(0x112)]};console[_0x30f2d6(0x116)](_0x30f2d6(0xfc)),console[_0x30f2d6(0x116)](_0x30f2d6(0x153),_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x13b)],'->',_0x1b2c0d),console[_0x30f2d6(0x116)](_0x30f2d6(0x14c),_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0xf3)],_0x12b62e[_0x30f2d6(0x138)]['inputCurrency']),console[_0x30f2d6(0x116)]('Transaction\x20ID:',_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x141)]),console[_0x30f2d6(0x116)](_0x30f2d6(0x13f),_0x5af1c0||'not\x20found'),console[_0x30f2d6(0x116)]('Created\x20On:',_0x12b62e['data'][_0x30f2d6(0xf5)]),console[_0x30f2d6(0x116)](_0x30f2d6(0x155),_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0x112)]||_0x30f2d6(0x119));if(_0x12b62e['data'][_0x30f2d6(0x13b)]?.[_0x30f2d6(0x14b)]()===_0x30f2d6(0x132))console[_0x30f2d6(0x116)](_0x30f2d6(0x154));else _0x12b62e[_0x30f2d6(0x138)]['Status']?.['toLowerCase']()===_0x30f2d6(0xf8)&&console[_0x30f2d6(0x116)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x1b2c0d,'amount':parseFloat(_0x12b62e[_0x30f2d6(0x138)][_0x30f2d6(0xf3)])||undefined,'currency':_0x12b62e[_0x30f2d6(0x138)]['inputCurrency']||_0x30f2d6(0xf1),'paymentDetails':_0x1da6de};}catch(_0x34a611){console['error'](_0x30f2d6(0x121),_0x34a611),loggerService_1[_0x30f2d6(0x137)][_0x30f2d6(0x164)]('cointopay',_0x30f2d6(0x142),_0x34a611);throw new Error(_0x30f2d6(0x146)+(_0x34a611 instanceof Error?_0x34a611[_0x30f2d6(0x11e)]:_0x30f2d6(0x10b)));}}async[a49_0x448a65(0x169)](_0x2591b8){const _0x1d28df=a49_0x448a65,_0x2ea709=await this[_0x1d28df(0x11b)](_0x2591b8);return{'status':_0x2ea709['status'],'amount':_0x2ea709['amount'],'currency':_0x2ea709[_0x1d28df(0xf6)]};}async[a49_0x448a65(0x107)](_0x249a95){const _0x8229e5=a49_0x448a65;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x249a95);let _0x4a779d='PENDING';switch(_0x249a95[_0x8229e5(0x158)]?.[_0x8229e5(0x14b)]()){case _0x8229e5(0xf8):_0x4a779d='PAID';break;case _0x8229e5(0x10c):case _0x8229e5(0x113):case _0x8229e5(0x115):_0x4a779d='FAILED';break;case _0x8229e5(0xf7):case'timeout':_0x4a779d=_0x8229e5(0x104);break;case _0x8229e5(0x144):case _0x8229e5(0x140):case _0x8229e5(0x132):case _0x8229e5(0x15b):default:_0x4a779d=_0x8229e5(0xfb);break;}return{'paymentId':_0x249a95[_0x8229e5(0xfe)]||_0x249a95[_0x8229e5(0x111)]||'','status':_0x4a779d,'amount':_0x249a95['amount'],'currency':_0x249a95[_0x8229e5(0xf6)]||_0x8229e5(0xf1)};}}function a49_0x587f(_0x20f8e3,_0x53ca23){const _0xdf590=a49_0xdf59();return a49_0x587f=function(_0x587f00,_0xd720a2){_0x587f00=_0x587f00-0xea;let _0x1b29b3=_0xdf590[_0x587f00];return _0x1b29b3;},a49_0x587f(_0x20f8e3,_0x53ca23);}exports[a49_0x448a65(0x15e)]=CoinToPayService;