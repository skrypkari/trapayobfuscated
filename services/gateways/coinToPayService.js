'use strict';const a38_0x40cd64=a38_0x851b;function a38_0x851b(_0x437cbc,_0x1abfe8){const _0x1b4d62=a38_0x1b4d();return a38_0x851b=function(_0x851b2a,_0x1e0e99){_0x851b2a=_0x851b2a-0xae;let _0x4005c8=_0x1b4d62[_0x851b2a];return _0x4005c8;},a38_0x851b(_0x437cbc,_0x1abfe8);}(function(_0xbc9464,_0x19c888){const _0x113628=a38_0x851b,_0x1918c7=_0xbc9464();while(!![]){try{const _0x648841=parseInt(_0x113628(0xc3))/0x1*(parseInt(_0x113628(0x108))/0x2)+parseInt(_0x113628(0xf3))/0x3*(-parseInt(_0x113628(0x118))/0x4)+parseInt(_0x113628(0xcd))/0x5+parseInt(_0x113628(0xfc))/0x6*(-parseInt(_0x113628(0xb0))/0x7)+parseInt(_0x113628(0xc4))/0x8*(-parseInt(_0x113628(0xd7))/0x9)+-parseInt(_0x113628(0xe2))/0xa*(parseInt(_0x113628(0xe8))/0xb)+parseInt(_0x113628(0x12d))/0xc;if(_0x648841===_0x19c888)break;else _0x1918c7['push'](_0x1918c7['shift']());}catch(_0x40e15a){_0x1918c7['push'](_0x1918c7['shift']());}}}(a38_0x1b4d,0xa7bde));Object[a38_0x40cd64(0x101)](exports,a38_0x40cd64(0x115),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a38_0x1b4d(){const _0x3a9ebe=['===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','FAILED','PAID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','426AfIMjf','Status','Result:','Created\x20On:','HTTP\x20','defineProperty','Business\x20Error:\x20','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','logWhiteDomainRequest','Amount','amount','689880ecWrfM','stringify','URL:','verifyPayment','order_id','===\x20COINTOPAY\x20SUCCESS\x20===','parse','headers','merchant_reference_id','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','üè¶\x20Payment\x20Detail:','error','Unknown\x20error','__esModule','data','TransactionConfirmedOn','2341140ysCBLP','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','IBAN:','Response\x20Body:','createPaymentLink','pending','QRCodeURL','===\x20COINTOPAY\x20API\x20ERROR\x20===','logWhiteDomainError','status','awaiting\x20fiat','log','not\x20confirmed','CoinToPay\x20payment\x20status\x20check\x20error:','paid','TesSoft\x20Payment\x20System/1.0','failed','application/json','CreatedOn','created','30564396cgtGyk','/status','logWhiteDomainResponse','Transaction\x20ID:','text','checkPaymentStatus','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','match','/create','apiUrl','result','92554MQtjZR','HTTP\x20error!\x20status:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Headers:','../loggerService','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','Status\x20Text:','PaymentDetail',',\x20body:\x20','Payment\x20Status:','üè¶\x20Extracted\x20IBAN:','loggerService','Amount:','CoinToPayService','statusUrl','1UODmtJ','48lEmSTB','waiting','expired','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20Message:','Gateway\x20Payment\x20ID:','3459530YHCbVA','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','fromEntries','inputCurrency','statusText','status_code','Response\x20Time:','840636VuDrLe','coinAddress','toLowerCase','PENDING','Status:','now','success','timeout','cointopay','CoinToPay\x20API\x20error:\x20','gateway_payment_id','2270530DtZKoy','payment_url','Currency:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','11iRoikG','Incomplete\x20response:\x20missing\x20data','cancelled','Error\x20message:','message','\x20EUR','Parsed\x20Result:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','POST','currency','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','6YdBkwp','JSON\x20Parse\x20Error:\x20','Error\x20details:','EUR'];a38_0x1b4d=function(){return _0x3a9ebe;};return a38_0x1b4d();}const loggerService_1=require(a38_0x40cd64(0xb6));class CoinToPayService{constructor(){const _0x4d827b=a38_0x40cd64;this[_0x4d827b(0xae)]='https://tesoft.uk/gateway/cointopay/',this[_0x4d827b(0xc2)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x4d827b(0xb2)),console['log']('üìä\x20Status\x20check\x20URL:',this[_0x4d827b(0xc2)]);}async[a38_0x40cd64(0x11d)](_0x3615e0){const _0x31e01a=a38_0x40cd64,{orderId:_0x1e145a,amount:_0x271aba}=_0x3615e0;console['log'](_0x31e01a(0xc7)+_0x271aba+_0x31e01a(0xed));const _0x4c2c32={'amount':_0x271aba},_0x3d0bd5=Date[_0x31e01a(0xdc)]();try{console[_0x31e01a(0x124)](_0x31e01a(0xe7)),console[_0x31e01a(0x124)](_0x31e01a(0x10a),this[_0x31e01a(0xae)]),console[_0x31e01a(0x124)]('Request\x20Body:',JSON[_0x31e01a(0x109)](_0x4c2c32,null,0x2)),console[_0x31e01a(0x124)](_0x31e01a(0xc0),_0x271aba,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x31e01a(0x105)]('cointopay','/create',_0x31e01a(0xf0),_0x4c2c32);const _0x2896a2=await fetch(this[_0x31e01a(0xae)],{'method':_0x31e01a(0xf0),'headers':{'Content-Type':_0x31e01a(0x12a),'Accept':_0x31e01a(0x12a),'User-Agent':_0x31e01a(0x128)},'body':JSON['stringify'](_0x4c2c32)}),_0x19f610=Date[_0x31e01a(0xdc)]()-_0x3d0bd5;console['log'](_0x31e01a(0x133)),console[_0x31e01a(0x124)](_0x31e01a(0xdb),_0x2896a2[_0x31e01a(0x122)]),console[_0x31e01a(0x124)](_0x31e01a(0xba),_0x2896a2[_0x31e01a(0xd4)]),console[_0x31e01a(0x124)](_0x31e01a(0xb5),Object[_0x31e01a(0xd2)](_0x2896a2[_0x31e01a(0x10f)]['entries']())),console[_0x31e01a(0x124)](_0x31e01a(0xd6),_0x19f610+'ms');const _0x5eaf70=await _0x2896a2[_0x31e01a(0x131)]();console[_0x31e01a(0x124)](_0x31e01a(0xd0),_0x5eaf70);if(!_0x2896a2['ok']){console[_0x31e01a(0x113)](_0x31e01a(0x120)),console['error']('HTTP\x20Status:',_0x2896a2[_0x31e01a(0x122)]),console[_0x31e01a(0x113)](_0x31e01a(0x11c),_0x5eaf70),loggerService_1[_0x31e01a(0xbf)][_0x31e01a(0x12f)]('cointopay',_0x31e01a(0x135),_0x2896a2['status'],_0x5eaf70,_0x19f610),loggerService_1[_0x31e01a(0xbf)][_0x31e01a(0x121)]('cointopay',_0x31e01a(0x135),_0x31e01a(0x100)+_0x2896a2[_0x31e01a(0x122)]+':\x20'+_0x5eaf70);throw new Error(_0x31e01a(0xb1)+_0x2896a2[_0x31e01a(0x122)]+_0x31e01a(0xbc)+_0x5eaf70);}let _0x23aa49;try{_0x23aa49=JSON[_0x31e01a(0x10e)](_0x5eaf70);}catch(_0x469c5e){console[_0x31e01a(0x113)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x469c5e),loggerService_1[_0x31e01a(0xbf)]['logWhiteDomainError']('cointopay',_0x31e01a(0x135),_0x31e01a(0xf4)+_0x469c5e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5eaf70);}console[_0x31e01a(0x124)](_0x31e01a(0xb8)),console[_0x31e01a(0x124)](_0x31e01a(0xee),JSON['stringify'](_0x23aa49,null,0x2)),loggerService_1[_0x31e01a(0xbf)][_0x31e01a(0x12f)](_0x31e01a(0xdf),'/create',_0x2896a2['status'],_0x23aa49,_0x19f610);if(_0x23aa49['error']){const _0x588b7b=_0x23aa49[_0x31e01a(0xec)]||_0x23aa49[_0x31e01a(0x113)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x31e01a(0xef)),console[_0x31e01a(0x113)](_0x31e01a(0xcb),_0x588b7b),loggerService_1[_0x31e01a(0xbf)]['logWhiteDomainError'](_0x31e01a(0xdf),_0x31e01a(0x135),_0x31e01a(0x102)+_0x588b7b);throw new Error(_0x31e01a(0xe0)+_0x588b7b);}if(!_0x23aa49[_0x31e01a(0xe3)]||!_0x23aa49['gateway_payment_id']){console[_0x31e01a(0x113)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x31e01a(0xe5)),console[_0x31e01a(0x113)]('Response\x20data:',_0x23aa49),loggerService_1['loggerService'][_0x31e01a(0x121)](_0x31e01a(0xdf),'/create',_0x31e01a(0xca));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x31e01a(0x124)](_0x31e01a(0x10d)),console[_0x31e01a(0x124)](_0x31e01a(0xcc),_0x23aa49[_0x31e01a(0xe1)]),console[_0x31e01a(0x124)]('Payment\x20URL:',_0x23aa49[_0x31e01a(0xe3)]),console[_0x31e01a(0x124)](_0x31e01a(0xc0),_0x271aba,_0x31e01a(0xf6)),{'gateway_payment_id':_0x23aa49['gateway_payment_id'],'payment_url':_0x23aa49[_0x31e01a(0xe3)]};}catch(_0xc444fc){console[_0x31e01a(0x113)](_0x31e01a(0xb7)),console[_0x31e01a(0x113)](_0x31e01a(0xf5),_0xc444fc),loggerService_1[_0x31e01a(0xbf)][_0x31e01a(0x121)]('cointopay',_0x31e01a(0x135),_0xc444fc);if(_0xc444fc instanceof Error){console[_0x31e01a(0x113)](_0x31e01a(0xeb),_0xc444fc[_0x31e01a(0xec)]),console[_0x31e01a(0x113)]('Error\x20stack:',_0xc444fc[_0x31e01a(0xb3)]);throw new Error(_0x31e01a(0xc8)+_0xc444fc[_0x31e01a(0xec)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a38_0x40cd64(0x132)](_0x15a3a7){const _0x497157=a38_0x40cd64,_0x36b14f=Date[_0x497157(0xdc)]();try{console[_0x497157(0x124)](_0x497157(0x111)+_0x15a3a7);const _0x3c5314={'gatewayPaymentId':_0x15a3a7};loggerService_1[_0x497157(0xbf)][_0x497157(0x105)]('cointopay',_0x497157(0x12e),'POST',_0x3c5314);const _0x182da0=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x497157(0x12a),'Accept':_0x497157(0x12a),'User-Agent':_0x497157(0x128)},'body':JSON[_0x497157(0x109)](_0x3c5314)}),_0xf2fa7=Date[_0x497157(0xdc)]()-_0x36b14f;console[_0x497157(0x124)](_0x497157(0xf2)),console['log'](_0x497157(0xdb),_0x182da0[_0x497157(0x122)]),console[_0x497157(0x124)](_0x497157(0xd6),_0xf2fa7+'ms');if(!_0x182da0['ok']){const _0x395ccc=await _0x182da0['text']();console[_0x497157(0x113)](_0x497157(0xc9),_0x182da0[_0x497157(0x122)]),console[_0x497157(0x113)](_0x497157(0x11c),_0x395ccc),loggerService_1[_0x497157(0xbf)][_0x497157(0x12f)]('cointopay',_0x497157(0x12e),_0x182da0['status'],_0x395ccc,_0xf2fa7),loggerService_1['loggerService']['logWhiteDomainError'](_0x497157(0xdf),_0x497157(0x12e),_0x497157(0x100)+_0x182da0[_0x497157(0x122)]+':\x20'+_0x395ccc);throw new Error(_0x497157(0xb1)+_0x182da0[_0x497157(0x122)]);}const _0xafb5db=await _0x182da0[_0x497157(0x131)]();console[_0x497157(0x124)](_0x497157(0xd0),_0xafb5db);let _0x21c8e7;try{_0x21c8e7=JSON[_0x497157(0x10e)](_0xafb5db);}catch(_0x1110a1){console[_0x497157(0x113)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1110a1),loggerService_1[_0x497157(0xbf)]['logWhiteDomainError'](_0x497157(0xdf),_0x497157(0x12e),_0x497157(0xf4)+_0x1110a1);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0xafb5db);}loggerService_1[_0x497157(0xbf)][_0x497157(0x12f)](_0x497157(0xdf),_0x497157(0x12e),_0x182da0[_0x497157(0x122)],_0x21c8e7,_0xf2fa7),console['log'](_0x497157(0xfb)),console['log'](_0x497157(0xfe),_0x21c8e7[_0x497157(0xaf)]),console['log']('Status\x20Code:',_0x21c8e7['status_code']),console[_0x497157(0x124)](_0x497157(0xbd),_0x21c8e7[_0x497157(0x116)]?.['Status']),console[_0x497157(0x124)](_0x497157(0xc0),_0x21c8e7[_0x497157(0x116)]?.['Amount']),console[_0x497157(0x124)](_0x497157(0xe4),_0x21c8e7[_0x497157(0x116)]?.[_0x497157(0xd3)]);if(_0x21c8e7[_0x497157(0xaf)]!==_0x497157(0xdd)||_0x21c8e7[_0x497157(0xd5)]!==0xc8){const _0x34990b=_0x21c8e7[_0x497157(0xec)]||_0x497157(0xd1);console['error'](_0x497157(0x104)),console['error'](_0x497157(0xcb),_0x34990b),loggerService_1['loggerService'][_0x497157(0x121)](_0x497157(0xdf),_0x497157(0x12e),_0x497157(0xb9)+_0x34990b);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x34990b);}if(!_0x21c8e7[_0x497157(0x116)]){console['error'](_0x497157(0xf7)),console[_0x497157(0x113)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x497157(0xbf)][_0x497157(0x121)](_0x497157(0xdf),_0x497157(0x12e),_0x497157(0xe9));throw new Error(_0x497157(0xcf));}let _0x548202=_0x497157(0xda);switch(_0x21c8e7[_0x497157(0x116)]['Status']?.[_0x497157(0xd9)]()){case _0x497157(0x127):_0x548202='PAID';break;case'cancelled':case'failed':case'error':_0x548202=_0x497157(0xf9);break;case _0x497157(0xc6):case _0x497157(0xde):_0x548202=_0x497157(0xf8);break;case _0x497157(0xc5):case _0x497157(0x123):case _0x497157(0x11e):case _0x497157(0x12c):default:_0x548202='PENDING';break;}let _0x286adb,_0x3ca6aa;if(_0x21c8e7[_0x497157(0x116)][_0x497157(0xbb)]){const _0x2a93ec=_0x21c8e7[_0x497157(0x116)]['PaymentDetail'];console[_0x497157(0x124)](_0x497157(0x112),_0x2a93ec);const _0x35304a=_0x2a93ec[_0x497157(0x134)](/IBAN\s+([A-Z0-9]+)/i);_0x35304a&&(_0x286adb=_0x35304a[0x1],console[_0x497157(0x124)](_0x497157(0xbe),_0x286adb)),_0x3ca6aa=_0x2a93ec;}const _0xd40372={'iban':_0x286adb,'bankDetails':_0x3ca6aa,'transactionId':_0x21c8e7[_0x497157(0x116)]['TransactionID'],'coinAddress':_0x21c8e7['data'][_0x497157(0xd8)],'qrCodeUrl':_0x21c8e7[_0x497157(0x116)][_0x497157(0x11f)],'expiryTime':_0x21c8e7['data'][_0x497157(0x103)],'createdOn':_0x21c8e7[_0x497157(0x116)][_0x497157(0x12b)],'confirmedOn':_0x21c8e7[_0x497157(0x116)][_0x497157(0x117)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x497157(0xdb),_0x21c8e7[_0x497157(0x116)][_0x497157(0xfd)],'->',_0x548202),console[_0x497157(0x124)](_0x497157(0xc0),_0x21c8e7[_0x497157(0x116)][_0x497157(0x106)],_0x21c8e7[_0x497157(0x116)][_0x497157(0xd3)]),console[_0x497157(0x124)](_0x497157(0x130),_0x21c8e7[_0x497157(0x116)][_0x497157(0xce)]),console[_0x497157(0x124)](_0x497157(0x11b),_0x286adb||'not\x20found'),console['log'](_0x497157(0xff),_0x21c8e7[_0x497157(0x116)][_0x497157(0x12b)]),console[_0x497157(0x124)]('Confirmed\x20On:',_0x21c8e7[_0x497157(0x116)]['TransactionConfirmedOn']||_0x497157(0x125));if(_0x21c8e7[_0x497157(0x116)][_0x497157(0xfd)]?.[_0x497157(0xd9)]()===_0x497157(0x123))console[_0x497157(0x124)](_0x497157(0x11a));else _0x21c8e7[_0x497157(0x116)][_0x497157(0xfd)]?.['toLowerCase']()===_0x497157(0x127)&&console['log'](_0x497157(0xe6));return{'status':_0x548202,'amount':parseFloat(_0x21c8e7['data'][_0x497157(0x106)])||undefined,'currency':_0x21c8e7['data']['inputCurrency']||'EUR','paymentDetails':_0xd40372};}catch(_0xe5c378){console[_0x497157(0x113)](_0x497157(0x126),_0xe5c378),loggerService_1['loggerService'][_0x497157(0x121)](_0x497157(0xdf),_0x497157(0x12e),_0xe5c378);throw new Error(_0x497157(0x119)+(_0xe5c378 instanceof Error?_0xe5c378[_0x497157(0xec)]:_0x497157(0x114)));}}async[a38_0x40cd64(0x10b)](_0x8389f){const _0x299bee=a38_0x40cd64,_0x434ef6=await this[_0x299bee(0x132)](_0x8389f);return{'status':_0x434ef6['status'],'amount':_0x434ef6[_0x299bee(0x107)],'currency':_0x434ef6[_0x299bee(0xf1)]};}async['processWebhook'](_0x22b65d){const _0x4225fe=a38_0x40cd64;console[_0x4225fe(0x124)](_0x4225fe(0xb4),_0x22b65d);let _0x6d799c=_0x4225fe(0xda);switch(_0x22b65d['status']?.['toLowerCase']()){case _0x4225fe(0x127):_0x6d799c=_0x4225fe(0xfa);break;case _0x4225fe(0xea):case _0x4225fe(0x129):case'error':_0x6d799c='FAILED';break;case _0x4225fe(0xc6):case _0x4225fe(0xde):_0x6d799c='EXPIRED';break;case _0x4225fe(0x11e):case _0x4225fe(0xc5):case _0x4225fe(0x123):case _0x4225fe(0x12c):default:_0x6d799c=_0x4225fe(0xda);break;}return{'paymentId':_0x22b65d[_0x4225fe(0x10c)]||_0x22b65d[_0x4225fe(0x110)]||'','status':_0x6d799c,'amount':_0x22b65d[_0x4225fe(0x107)],'currency':_0x22b65d['currency']||_0x4225fe(0xf6)};}}exports[a38_0x40cd64(0xc1)]=CoinToPayService;