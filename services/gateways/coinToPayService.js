'use strict';const a43_0x5eabb3=a43_0x4e6a;(function(_0x322f46,_0xb0af5e){const _0x52aee3=a43_0x4e6a,_0x195a97=_0x322f46();while(!![]){try{const _0x3b9280=-parseInt(_0x52aee3(0x23e))/0x1*(-parseInt(_0x52aee3(0x213))/0x2)+-parseInt(_0x52aee3(0x20b))/0x3+-parseInt(_0x52aee3(0x226))/0x4+parseInt(_0x52aee3(0x24f))/0x5*(-parseInt(_0x52aee3(0x22a))/0x6)+parseInt(_0x52aee3(0x1f4))/0x7+parseInt(_0x52aee3(0x224))/0x8+parseInt(_0x52aee3(0x1f9))/0x9*(parseInt(_0x52aee3(0x1ee))/0xa);if(_0x3b9280===_0xb0af5e)break;else _0x195a97['push'](_0x195a97['shift']());}catch(_0x5961f0){_0x195a97['push'](_0x195a97['shift']());}}}(a43_0x513d,0x445c1));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x5eabb3(0x1fc)]=void 0x0;const loggerService_1=require(a43_0x5eabb3(0x222));function a43_0x4e6a(_0x28bf99,_0x1d4ada){const _0x513da9=a43_0x513d();return a43_0x4e6a=function(_0x4e6a53,_0x552a83){_0x4e6a53=_0x4e6a53-0x1c7;let _0xd37884=_0x513da9[_0x4e6a53];return _0xd37884;},a43_0x4e6a(_0x28bf99,_0x1d4ada);}function a43_0x513d(){const _0x22f061=['logWhiteDomainError','message','PaymentDetail','CoinToPay\x20status\x20API\x20error:\x20','now','JSON\x20Parse\x20Error:\x20','inputCurrency','error','status_code','Raw\x20Response\x20Body:','Status\x20Text:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','365773DlobFK','Error\x20details:','üè¶\x20Payment\x20Detail:','pending','CoinToPay\x20payment\x20status\x20check\x20error:','success','result','QRCodeURL','PAID','Confirmed\x20On:','paid','Error\x20stack:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','logWhiteDomainRequest','toLowerCase','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20data:','65RPeCnm','currency','CoinToPay\x20API\x20error:\x20','üè¶\x20Extracted\x20IBAN:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Response\x20Body:','data','entries','TransactionConfirmedOn','HTTP\x20Status:','Error\x20message:','gateway_payment_id','FAILED','URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','cointopay','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','match','amount','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','statusText','Payment\x20Status:','logWhiteDomainResponse','merchant_reference_id','loggerService','Status\x20Code:','TesSoft\x20Payment\x20System/1.0','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EUR','stack','Amount:','Response\x20Time:','Failed\x20to\x20parse\x20JSON\x20response:','POST','PENDING','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','\x20EUR','Gateway\x20Payment\x20ID:','stringify','processWebhook','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status','not\x20found','1810RgFPnx','Amount','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20SUCCESS\x20===','cancelled','HTTP\x20error!\x20status:\x20','567259stqDjM','Transaction\x20ID:','not\x20confirmed','payment_url','statusUrl','33903dMfNpI','Business\x20Error:\x20','Payment\x20URL:','CoinToPayService','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','üìä\x20Status\x20check\x20URL:','createPaymentLink','timeout','IBAN:',',\x20body:\x20','Error\x20Message:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TransactionID','expired','checkPaymentStatus','/status','application/json','apiUrl','650553AxxTYk','/create','Headers:','parse','Parsed\x20Result:','failed','Result:','Status','2VqgINm','https://tesoft.uk/gateway/cointopay/status.php','EXPIRED','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CreatedOn','awaiting\x20fiat','Incomplete\x20response:\x20missing\x20data','Currency:','https://tesoft.uk/gateway/cointopay/','Status:','order_id','verifyPayment','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','../loggerService','log','1627080UrCpkM','Created\x20On:','2095384EmMhAQ','Missing\x20data\x20in\x20response','Unknown\x20error','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','143688uREflS','headers','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20API\x20Error:\x20','text','coinAddress','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='];a43_0x513d=function(){return _0x22f061;};return a43_0x513d();}class CoinToPayService{constructor(){const _0xeef4e3=a43_0x5eabb3;this[_0xeef4e3(0x20a)]=_0xeef4e3(0x21d),this[_0xeef4e3(0x1f8)]=_0xeef4e3(0x214),console[_0xeef4e3(0x223)](_0xeef4e3(0x218)),console['log'](_0xeef4e3(0x1fe),this['statusUrl']);}async[a43_0x5eabb3(0x1ff)](_0x1e0e43){const _0x3842c6=a43_0x5eabb3,{orderId:_0x5da6b0,amount:_0x5ecdce}=_0x1e0e43;console[_0x3842c6(0x223)](_0x3842c6(0x253)+_0x5ecdce+_0x3842c6(0x1e7));const _0x3f5cf3={'amount':_0x5ecdce},_0x4ad1b9=Date[_0x3842c6(0x235)]();try{console[_0x3842c6(0x223)](_0x3842c6(0x230)),console[_0x3842c6(0x223)](_0x3842c6(0x1cf),this[_0x3842c6(0x20a)]),console[_0x3842c6(0x223)]('Request\x20Body:',JSON[_0x3842c6(0x1e9)](_0x3f5cf3,null,0x2)),console['log']('Amount:',_0x5ecdce,_0x3842c6(0x23d)),loggerService_1[_0x3842c6(0x1db)][_0x3842c6(0x24b)](_0x3842c6(0x1d2),_0x3842c6(0x20c),_0x3842c6(0x1e4),_0x3f5cf3);const _0x90f69b=await fetch(this['apiUrl'],{'method':_0x3842c6(0x1e4),'headers':{'Content-Type':_0x3842c6(0x209),'Accept':'application/json','User-Agent':_0x3842c6(0x1dd)},'body':JSON[_0x3842c6(0x1e9)](_0x3f5cf3)}),_0x587194=Date[_0x3842c6(0x235)]()-_0x4ad1b9;console['log'](_0x3842c6(0x1eb)),console[_0x3842c6(0x223)](_0x3842c6(0x21e),_0x90f69b[_0x3842c6(0x1ec)]),console[_0x3842c6(0x223)](_0x3842c6(0x23b),_0x90f69b[_0x3842c6(0x1d7)]),console[_0x3842c6(0x223)](_0x3842c6(0x20d),Object['fromEntries'](_0x90f69b[_0x3842c6(0x22b)][_0x3842c6(0x1c9)]())),console[_0x3842c6(0x223)](_0x3842c6(0x1e2),_0x587194+'ms');const _0x2d5616=await _0x90f69b['text']();console['log'](_0x3842c6(0x23a),_0x2d5616);if(!_0x90f69b['ok']){console[_0x3842c6(0x238)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x3842c6(0x1cb),_0x90f69b[_0x3842c6(0x1ec)]),console[_0x3842c6(0x238)](_0x3842c6(0x1c7),_0x2d5616),loggerService_1[_0x3842c6(0x1db)]['logWhiteDomainResponse']('cointopay',_0x3842c6(0x20c),_0x90f69b[_0x3842c6(0x1ec)],_0x2d5616,_0x587194),loggerService_1['loggerService'][_0x3842c6(0x231)]('cointopay',_0x3842c6(0x20c),_0x3842c6(0x217)+_0x90f69b[_0x3842c6(0x1ec)]+':\x20'+_0x2d5616);throw new Error(_0x3842c6(0x1f3)+_0x90f69b[_0x3842c6(0x1ec)]+_0x3842c6(0x202)+_0x2d5616);}let _0x212063;try{_0x212063=JSON[_0x3842c6(0x20e)](_0x2d5616);}catch(_0x38d4e4){console[_0x3842c6(0x238)](_0x3842c6(0x1e3),_0x38d4e4),loggerService_1[_0x3842c6(0x1db)][_0x3842c6(0x231)](_0x3842c6(0x1d2),_0x3842c6(0x20c),_0x3842c6(0x236)+_0x38d4e4);throw new Error(_0x3842c6(0x1d0)+_0x2d5616);}console[_0x3842c6(0x223)](_0x3842c6(0x23c)),console[_0x3842c6(0x223)](_0x3842c6(0x20f),JSON[_0x3842c6(0x1e9)](_0x212063,null,0x2)),loggerService_1[_0x3842c6(0x1db)][_0x3842c6(0x1d9)](_0x3842c6(0x1d2),_0x3842c6(0x20c),_0x90f69b[_0x3842c6(0x1ec)],_0x212063,_0x587194);if(_0x212063['error']){const _0x4845cc=_0x212063[_0x3842c6(0x232)]||_0x212063[_0x3842c6(0x238)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x3842c6(0x238)](_0x3842c6(0x221)),console[_0x3842c6(0x238)]('Error\x20Message:',_0x4845cc),loggerService_1[_0x3842c6(0x1db)][_0x3842c6(0x231)](_0x3842c6(0x1d2),_0x3842c6(0x20c),_0x3842c6(0x1fa)+_0x4845cc);throw new Error(_0x3842c6(0x251)+_0x4845cc);}if(!_0x212063['payment_url']||!_0x212063[_0x3842c6(0x1cd)]){console[_0x3842c6(0x238)](_0x3842c6(0x216)),console[_0x3842c6(0x238)](_0x3842c6(0x1d3)),console[_0x3842c6(0x238)](_0x3842c6(0x24e),_0x212063),loggerService_1[_0x3842c6(0x1db)]['logWhiteDomainError']('cointopay',_0x3842c6(0x20c),_0x3842c6(0x229));throw new Error(_0x3842c6(0x1d6));}return console[_0x3842c6(0x223)](_0x3842c6(0x1f1)),console['log'](_0x3842c6(0x1e8),_0x212063[_0x3842c6(0x1cd)]),console['log'](_0x3842c6(0x1fb),_0x212063[_0x3842c6(0x1f7)]),console['log']('Amount:',_0x5ecdce,_0x3842c6(0x1df)),{'gateway_payment_id':_0x212063['gateway_payment_id'],'payment_url':_0x212063[_0x3842c6(0x1f7)]};}catch(_0x42f871){console['error'](_0x3842c6(0x1fd)),console[_0x3842c6(0x238)](_0x3842c6(0x23f),_0x42f871),loggerService_1['loggerService'][_0x3842c6(0x231)]('cointopay','/create',_0x42f871);if(_0x42f871 instanceof Error){console[_0x3842c6(0x238)](_0x3842c6(0x1cc),_0x42f871[_0x3842c6(0x232)]),console['error'](_0x3842c6(0x249),_0x42f871[_0x3842c6(0x1e0)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x42f871[_0x3842c6(0x232)]);}throw new Error(_0x3842c6(0x24d));}}async[a43_0x5eabb3(0x207)](_0x352894){const _0x316f45=a43_0x5eabb3,_0x329cb7=Date['now']();try{console[_0x316f45(0x223)](_0x316f45(0x1de)+_0x352894);const _0x547968={'gatewayPaymentId':_0x352894};loggerService_1[_0x316f45(0x1db)][_0x316f45(0x24b)]('cointopay',_0x316f45(0x208),_0x316f45(0x1e4),_0x547968);const _0x53c92b=await fetch(this[_0x316f45(0x1f8)],{'method':_0x316f45(0x1e4),'headers':{'Content-Type':'application/json','Accept':_0x316f45(0x209),'User-Agent':_0x316f45(0x1dd)},'body':JSON[_0x316f45(0x1e9)](_0x547968)}),_0x35c4e3=Date['now']()-_0x329cb7;console[_0x316f45(0x223)](_0x316f45(0x1e6)),console[_0x316f45(0x223)](_0x316f45(0x21e),_0x53c92b[_0x316f45(0x1ec)]),console[_0x316f45(0x223)](_0x316f45(0x1e2),_0x35c4e3+'ms');if(!_0x53c92b['ok']){const _0x43dd84=await _0x53c92b[_0x316f45(0x22e)]();console[_0x316f45(0x238)](_0x316f45(0x1cb),_0x53c92b['status']),console['error'](_0x316f45(0x1c7),_0x43dd84),loggerService_1[_0x316f45(0x1db)][_0x316f45(0x1d9)](_0x316f45(0x1d2),_0x316f45(0x208),_0x53c92b[_0x316f45(0x1ec)],_0x43dd84,_0x35c4e3),loggerService_1[_0x316f45(0x1db)]['logWhiteDomainError'](_0x316f45(0x1d2),_0x316f45(0x208),'HTTP\x20'+_0x53c92b[_0x316f45(0x1ec)]+':\x20'+_0x43dd84);throw new Error('HTTP\x20error!\x20status:\x20'+_0x53c92b[_0x316f45(0x1ec)]);}const _0x4df1ac=await _0x53c92b['text']();console[_0x316f45(0x223)]('Raw\x20Response\x20Body:',_0x4df1ac);let _0x341d6a;try{_0x341d6a=JSON[_0x316f45(0x20e)](_0x4df1ac);}catch(_0x998526){console[_0x316f45(0x238)](_0x316f45(0x1e3),_0x998526),loggerService_1[_0x316f45(0x1db)][_0x316f45(0x231)](_0x316f45(0x1d2),_0x316f45(0x208),'JSON\x20Parse\x20Error:\x20'+_0x998526);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4df1ac);}loggerService_1['loggerService'][_0x316f45(0x1d9)](_0x316f45(0x1d2),_0x316f45(0x208),_0x53c92b[_0x316f45(0x1ec)],_0x341d6a,_0x35c4e3),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x316f45(0x223)](_0x316f45(0x211),_0x341d6a[_0x316f45(0x244)]),console[_0x316f45(0x223)](_0x316f45(0x1dc),_0x341d6a[_0x316f45(0x239)]),console[_0x316f45(0x223)](_0x316f45(0x1d8),_0x341d6a[_0x316f45(0x1c8)]?.['Status']),console[_0x316f45(0x223)]('Amount:',_0x341d6a[_0x316f45(0x1c8)]?.[_0x316f45(0x1ef)]),console[_0x316f45(0x223)](_0x316f45(0x21c),_0x341d6a[_0x316f45(0x1c8)]?.['inputCurrency']);if(_0x341d6a[_0x316f45(0x244)]!==_0x316f45(0x243)||_0x341d6a[_0x316f45(0x239)]!==0xc8){const _0x123f5c=_0x341d6a[_0x316f45(0x232)]||_0x316f45(0x24a);console[_0x316f45(0x238)](_0x316f45(0x1d1)),console['error'](_0x316f45(0x203),_0x123f5c),loggerService_1[_0x316f45(0x1db)][_0x316f45(0x231)](_0x316f45(0x1d2),'/status',_0x316f45(0x22d)+_0x123f5c);throw new Error(_0x316f45(0x234)+_0x123f5c);}if(!_0x341d6a['data']){console['error'](_0x316f45(0x204)),console['error'](_0x316f45(0x227)),loggerService_1[_0x316f45(0x1db)][_0x316f45(0x231)](_0x316f45(0x1d2),_0x316f45(0x208),_0x316f45(0x21b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x28f849=_0x316f45(0x1e5);switch(_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x212)]?.[_0x316f45(0x24c)]()){case'paid':_0x28f849=_0x316f45(0x246);break;case'cancelled':case _0x316f45(0x210):case _0x316f45(0x238):_0x28f849='FAILED';break;case _0x316f45(0x206):case _0x316f45(0x200):_0x28f849=_0x316f45(0x215);break;case'waiting':case _0x316f45(0x21a):case _0x316f45(0x241):case'created':default:_0x28f849='PENDING';break;}let _0x348582,_0x5c9a6c;if(_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x233)]){const _0x103b2f=_0x341d6a[_0x316f45(0x1c8)]['PaymentDetail'];console[_0x316f45(0x223)](_0x316f45(0x240),_0x103b2f);const _0x26cc71=_0x103b2f[_0x316f45(0x1d4)](/IBAN\s+([A-Z0-9]+)/i);_0x26cc71&&(_0x348582=_0x26cc71[0x1],console[_0x316f45(0x223)](_0x316f45(0x252),_0x348582)),_0x5c9a6c=_0x103b2f;}const _0x3bdb41={'iban':_0x348582,'bankDetails':_0x5c9a6c,'transactionId':_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x205)],'coinAddress':_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x22f)],'qrCodeUrl':_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x245)],'expiryTime':_0x341d6a[_0x316f45(0x1c8)]['ExpiryTime'],'createdOn':_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x219)],'confirmedOn':_0x341d6a['data'][_0x316f45(0x1ca)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x316f45(0x223)](_0x316f45(0x21e),_0x341d6a[_0x316f45(0x1c8)]['Status'],'->',_0x28f849),console[_0x316f45(0x223)](_0x316f45(0x1e1),_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x1ef)],_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x237)]),console[_0x316f45(0x223)](_0x316f45(0x1f5),_0x341d6a['data'][_0x316f45(0x205)]),console[_0x316f45(0x223)](_0x316f45(0x201),_0x348582||_0x316f45(0x1ed)),console[_0x316f45(0x223)](_0x316f45(0x225),_0x341d6a[_0x316f45(0x1c8)]['CreatedOn']),console[_0x316f45(0x223)](_0x316f45(0x247),_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x1ca)]||_0x316f45(0x1f6));if(_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x212)]?.[_0x316f45(0x24c)]()===_0x316f45(0x21a))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x341d6a['data'][_0x316f45(0x212)]?.['toLowerCase']()===_0x316f45(0x248)&&console['log'](_0x316f45(0x1f0));return{'status':_0x28f849,'amount':parseFloat(_0x341d6a[_0x316f45(0x1c8)][_0x316f45(0x1ef)])||undefined,'currency':_0x341d6a['data']['inputCurrency']||_0x316f45(0x1df),'paymentDetails':_0x3bdb41};}catch(_0x10bd5b){console[_0x316f45(0x238)](_0x316f45(0x242),_0x10bd5b),loggerService_1['loggerService']['logWhiteDomainError'](_0x316f45(0x1d2),'/status',_0x10bd5b);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x10bd5b instanceof Error?_0x10bd5b[_0x316f45(0x232)]:_0x316f45(0x228)));}}async[a43_0x5eabb3(0x220)](_0x57692c){const _0x18d5af=a43_0x5eabb3,_0x3cf1dd=await this[_0x18d5af(0x207)](_0x57692c);return{'status':_0x3cf1dd['status'],'amount':_0x3cf1dd[_0x18d5af(0x1d5)],'currency':_0x3cf1dd[_0x18d5af(0x250)]};}async[a43_0x5eabb3(0x1ea)](_0x1885c8){const _0x1d8896=a43_0x5eabb3;console[_0x1d8896(0x223)](_0x1d8896(0x22c),_0x1885c8);let _0x12c4c8=_0x1d8896(0x1e5);switch(_0x1885c8[_0x1d8896(0x1ec)]?.['toLowerCase']()){case'paid':_0x12c4c8=_0x1d8896(0x246);break;case _0x1d8896(0x1f2):case _0x1d8896(0x210):case _0x1d8896(0x238):_0x12c4c8=_0x1d8896(0x1ce);break;case _0x1d8896(0x206):case _0x1d8896(0x200):_0x12c4c8=_0x1d8896(0x215);break;case _0x1d8896(0x241):case'waiting':case'awaiting\x20fiat':case'created':default:_0x12c4c8=_0x1d8896(0x1e5);break;}return{'paymentId':_0x1885c8[_0x1d8896(0x21f)]||_0x1885c8[_0x1d8896(0x1da)]||'','status':_0x12c4c8,'amount':_0x1885c8['amount'],'currency':_0x1885c8[_0x1d8896(0x250)]||_0x1d8896(0x1df)};}}exports[a43_0x5eabb3(0x1fc)]=CoinToPayService;