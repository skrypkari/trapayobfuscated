'use strict';const a44_0x422ae4=a44_0x21ec;function a44_0x21ec(_0xf01b53,_0x353449){const _0xabbce5=a44_0xabbc();return a44_0x21ec=function(_0x21ec8f,_0x4acf25){_0x21ec8f=_0x21ec8f-0x1bf;let _0x257e95=_0xabbce5[_0x21ec8f];return _0x257e95;},a44_0x21ec(_0xf01b53,_0x353449);}(function(_0x506562,_0x50d3fb){const _0x219c21=a44_0x21ec,_0xbe547=_0x506562();while(!![]){try{const _0x5a0d30=parseInt(_0x219c21(0x20e))/0x1+-parseInt(_0x219c21(0x1cf))/0x2+parseInt(_0x219c21(0x21f))/0x3+-parseInt(_0x219c21(0x1cd))/0x4*(parseInt(_0x219c21(0x1e5))/0x5)+-parseInt(_0x219c21(0x1f6))/0x6*(-parseInt(_0x219c21(0x1cc))/0x7)+parseInt(_0x219c21(0x222))/0x8+-parseInt(_0x219c21(0x22e))/0x9;if(_0x5a0d30===_0x50d3fb)break;else _0xbe547['push'](_0xbe547['shift']());}catch(_0x1d323d){_0xbe547['push'](_0xbe547['shift']());}}}(a44_0xabbc,0x39124));function a44_0xabbc(){const _0x49ee2e=['===\x20COINTOPAY\x20SUCCESS\x20===','Unknown\x20error','Incomplete\x20response:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Headers:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','üè¶\x20Payment\x20Detail:','loggerService','EUR','Currency:','Failed\x20to\x20parse\x20JSON\x20response:','/create','Status\x20API\x20Error:\x20','Created\x20On:','Amount','Error\x20stack:','verifyPayment','created','logWhiteDomainError','failed','101560qhWRRN','Confirmed\x20On:','headers','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','HTTP\x20','Response\x20Body:','createPaymentLink','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','\x20EUR','CreatedOn','POST','application/json','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','cancelled','inputCurrency','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','2634084GIpnJW','CoinToPayService','timeout','expired','stringify','Status:','data','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Request\x20Body:','Status\x20Code:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status_code','ExpiryTime','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','/status','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','error','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Result:','Status\x20Text:','currency','TransactionID','318148UKegMS',',\x20body:\x20','logWhiteDomainResponse','amount','coinAddress','QRCodeURL','message','Amount:','Payment\x20Status:','not\x20confirmed','defineProperty','URL:','status','toLowerCase','CoinToPay\x20status\x20API\x20error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','869256SVrPit','statusUrl','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','1241040aUaVlw','FAILED','EXPIRED','now','PaymentDetail','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','success','HTTP\x20error!\x20status:\x20','TesSoft\x20Payment\x20System/1.0','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','awaiting\x20fiat','Error\x20message:','6455592Nzycsk','Response\x20Time:','Status','waiting','log','Unknown\x20error\x20from\x20CoinToPay\x20API','cointopay','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','checkPaymentStatus','payment_url','fromEntries','PENDING','pending','Business\x20Error:\x20','Missing\x20data\x20in\x20response','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','result','https://tesoft.uk/gateway/cointopay/status.php','paid','TransactionConfirmedOn','merchant_reference_id','IBAN:','processWebhook','===\x20COINTOPAY\x20API\x20ERROR\x20===','apiUrl','PAID','7wGpsgO','16PSVhzk','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','339488LTsFDv','entries'];a44_0xabbc=function(){return _0x49ee2e;};return a44_0xabbc();}Object[a44_0x422ae4(0x218)](exports,'__esModule',{'value':!![]}),exports[a44_0x422ae4(0x1f7)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x32feae=a44_0x422ae4;this[_0x32feae(0x1ca)]='https://tesoft.uk/gateway/cointopay/',this[_0x32feae(0x220)]=_0x32feae(0x1c3),console[_0x32feae(0x232)](_0x32feae(0x1ce)),console[_0x32feae(0x232)]('üìä\x20Status\x20check\x20URL:',this[_0x32feae(0x220)]);}async[a44_0x422ae4(0x1eb)](_0x15472d){const _0x46294c=a44_0x422ae4,{orderId:_0x42464f,amount:_0x470f79}=_0x15472d;console['log'](_0x46294c(0x1f1)+_0x470f79+_0x46294c(0x1ed));const _0x1b5b5b={'amount':_0x470f79},_0x11ee7a=Date[_0x46294c(0x225)]();try{console[_0x46294c(0x232)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x46294c(0x232)](_0x46294c(0x219),this['apiUrl']),console['log'](_0x46294c(0x1fe),JSON['stringify'](_0x1b5b5b,null,0x2)),console['log'](_0x46294c(0x215),_0x470f79,_0x46294c(0x1e8)),loggerService_1[_0x46294c(0x1d8)][_0x46294c(0x1f4)]('cointopay',_0x46294c(0x1dc),_0x46294c(0x1ef),_0x1b5b5b);const _0x48065e=await fetch(this[_0x46294c(0x1ca)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x46294c(0x1f0),'User-Agent':_0x46294c(0x22a)},'body':JSON[_0x46294c(0x1fa)](_0x1b5b5b)}),_0x400576=Date[_0x46294c(0x225)]()-_0x11ee7a;console[_0x46294c(0x232)](_0x46294c(0x200)),console['log']('Status:',_0x48065e[_0x46294c(0x21a)]),console[_0x46294c(0x232)](_0x46294c(0x20b),_0x48065e['statusText']),console[_0x46294c(0x232)](_0x46294c(0x1d5),Object[_0x46294c(0x23a)](_0x48065e[_0x46294c(0x1e7)][_0x46294c(0x1d0)]())),console[_0x46294c(0x232)]('Response\x20Time:',_0x400576+'ms');const _0x2bf19c=await _0x48065e['text']();console[_0x46294c(0x232)]('Raw\x20Response\x20Body:',_0x2bf19c);if(!_0x48065e['ok']){console[_0x46294c(0x208)](_0x46294c(0x1c9)),console[_0x46294c(0x208)]('HTTP\x20Status:',_0x48065e[_0x46294c(0x21a)]),console[_0x46294c(0x208)]('Response\x20Body:',_0x2bf19c),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x46294c(0x234),_0x46294c(0x1dc),_0x48065e[_0x46294c(0x21a)],_0x2bf19c,_0x400576),loggerService_1[_0x46294c(0x1d8)][_0x46294c(0x1e3)]('cointopay','/create',_0x46294c(0x1e9)+_0x48065e[_0x46294c(0x21a)]+':\x20'+_0x2bf19c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x48065e[_0x46294c(0x21a)]+_0x46294c(0x20f)+_0x2bf19c);}let _0x1bff0c;try{_0x1bff0c=JSON['parse'](_0x2bf19c);}catch(_0x40e472){console['error'](_0x46294c(0x1db),_0x40e472),loggerService_1[_0x46294c(0x1d8)][_0x46294c(0x1e3)](_0x46294c(0x234),_0x46294c(0x1dc),_0x46294c(0x21e)+_0x40e472);throw new Error(_0x46294c(0x1d4)+_0x2bf19c);}console[_0x46294c(0x232)](_0x46294c(0x21d)),console['log']('Parsed\x20Result:',JSON[_0x46294c(0x1fa)](_0x1bff0c,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x46294c(0x1dc),_0x48065e[_0x46294c(0x21a)],_0x1bff0c,_0x400576);if(_0x1bff0c[_0x46294c(0x208)]){const _0x365c1f=_0x1bff0c[_0x46294c(0x214)]||_0x1bff0c[_0x46294c(0x208)]||_0x46294c(0x233);console[_0x46294c(0x208)](_0x46294c(0x205)),console['error']('Error\x20Message:',_0x365c1f),loggerService_1[_0x46294c(0x1d8)]['logWhiteDomainError'](_0x46294c(0x234),_0x46294c(0x1dc),_0x46294c(0x1bf)+_0x365c1f);throw new Error(_0x46294c(0x203)+_0x365c1f);}if(!_0x1bff0c[_0x46294c(0x239)]||!_0x1bff0c['gateway_payment_id']){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x46294c(0x208)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x46294c(0x208)]('Response\x20data:',_0x1bff0c),loggerService_1[_0x46294c(0x1d8)][_0x46294c(0x1e3)](_0x46294c(0x234),_0x46294c(0x1dc),_0x46294c(0x1c1));throw new Error(_0x46294c(0x209));}return console[_0x46294c(0x232)](_0x46294c(0x1d1)),console[_0x46294c(0x232)]('Gateway\x20Payment\x20ID:',_0x1bff0c[_0x46294c(0x235)]),console[_0x46294c(0x232)]('Payment\x20URL:',_0x1bff0c[_0x46294c(0x239)]),console[_0x46294c(0x232)](_0x46294c(0x215),_0x470f79,_0x46294c(0x1d9)),{'gateway_payment_id':_0x1bff0c[_0x46294c(0x235)],'payment_url':_0x1bff0c[_0x46294c(0x239)]};}catch(_0x56f8ba){console[_0x46294c(0x208)](_0x46294c(0x1ec)),console[_0x46294c(0x208)]('Error\x20details:',_0x56f8ba),loggerService_1[_0x46294c(0x1d8)][_0x46294c(0x1e3)](_0x46294c(0x234),_0x46294c(0x1dc),_0x56f8ba);if(_0x56f8ba instanceof Error){console['error'](_0x46294c(0x22d),_0x56f8ba[_0x46294c(0x214)]),console[_0x46294c(0x208)](_0x46294c(0x1e0),_0x56f8ba['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x56f8ba[_0x46294c(0x214)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x422ae4(0x238)](_0x28aa43){const _0x487e97=a44_0x422ae4,_0x292dfe=Date['now']();try{console[_0x487e97(0x232)](_0x487e97(0x22b)+_0x28aa43);const _0x32c906={'gatewayPaymentId':_0x28aa43};loggerService_1[_0x487e97(0x1d8)][_0x487e97(0x1f4)](_0x487e97(0x234),_0x487e97(0x206),'POST',_0x32c906);const _0x3646d1=await fetch(this['statusUrl'],{'method':_0x487e97(0x1ef),'headers':{'Content-Type':_0x487e97(0x1f0),'Accept':'application/json','User-Agent':_0x487e97(0x22a)},'body':JSON['stringify'](_0x32c906)}),_0x3dc5f9=Date[_0x487e97(0x225)]()-_0x292dfe;console[_0x487e97(0x232)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x487e97(0x232)](_0x487e97(0x1fb),_0x3646d1[_0x487e97(0x21a)]),console['log'](_0x487e97(0x22f),_0x3dc5f9+'ms');if(!_0x3646d1['ok']){const _0x4b1740=await _0x3646d1[_0x487e97(0x237)]();console[_0x487e97(0x208)]('HTTP\x20Status:',_0x3646d1[_0x487e97(0x21a)]),console[_0x487e97(0x208)](_0x487e97(0x1ea),_0x4b1740),loggerService_1[_0x487e97(0x1d8)][_0x487e97(0x210)](_0x487e97(0x234),_0x487e97(0x206),_0x3646d1['status'],_0x4b1740,_0x3dc5f9),loggerService_1[_0x487e97(0x1d8)][_0x487e97(0x1e3)](_0x487e97(0x234),'/status','HTTP\x20'+_0x3646d1[_0x487e97(0x21a)]+':\x20'+_0x4b1740);throw new Error(_0x487e97(0x229)+_0x3646d1[_0x487e97(0x21a)]);}const _0x329396=await _0x3646d1['text']();console[_0x487e97(0x232)]('Raw\x20Response\x20Body:',_0x329396);let _0x9cd5fa;try{_0x9cd5fa=JSON['parse'](_0x329396);}catch(_0x31ae8c){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x31ae8c),loggerService_1[_0x487e97(0x1d8)][_0x487e97(0x1e3)](_0x487e97(0x234),_0x487e97(0x206),_0x487e97(0x21e)+_0x31ae8c);throw new Error(_0x487e97(0x227)+_0x329396);}loggerService_1[_0x487e97(0x1d8)]['logWhiteDomainResponse'](_0x487e97(0x234),_0x487e97(0x206),_0x3646d1[_0x487e97(0x21a)],_0x9cd5fa,_0x3dc5f9),console['log'](_0x487e97(0x221)),console[_0x487e97(0x232)](_0x487e97(0x20a),_0x9cd5fa[_0x487e97(0x1c2)]),console[_0x487e97(0x232)](_0x487e97(0x1ff),_0x9cd5fa[_0x487e97(0x201)]),console[_0x487e97(0x232)](_0x487e97(0x216),_0x9cd5fa[_0x487e97(0x1fc)]?.[_0x487e97(0x230)]),console[_0x487e97(0x232)](_0x487e97(0x215),_0x9cd5fa[_0x487e97(0x1fc)]?.[_0x487e97(0x1df)]),console['log'](_0x487e97(0x1da),_0x9cd5fa[_0x487e97(0x1fc)]?.[_0x487e97(0x1f3)]);if(_0x9cd5fa[_0x487e97(0x1c2)]!==_0x487e97(0x228)||_0x9cd5fa[_0x487e97(0x201)]!==0xc8){const _0x172f57=_0x9cd5fa[_0x487e97(0x214)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x487e97(0x208)](_0x487e97(0x1f5)),console[_0x487e97(0x208)]('Error\x20Message:',_0x172f57),loggerService_1[_0x487e97(0x1d8)]['logWhiteDomainError']('cointopay',_0x487e97(0x206),_0x487e97(0x1dd)+_0x172f57);throw new Error(_0x487e97(0x21c)+_0x172f57);}if(!_0x9cd5fa[_0x487e97(0x1fc)]){console[_0x487e97(0x208)](_0x487e97(0x236)),console['error'](_0x487e97(0x1c0)),loggerService_1[_0x487e97(0x1d8)][_0x487e97(0x1e3)]('cointopay','/status',_0x487e97(0x1d3));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x3e7fc1=_0x487e97(0x23b);switch(_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x230)]?.[_0x487e97(0x21b)]()){case _0x487e97(0x1c4):_0x3e7fc1=_0x487e97(0x1cb);break;case'cancelled':case'failed':case _0x487e97(0x208):_0x3e7fc1='FAILED';break;case'expired':case _0x487e97(0x1f8):_0x3e7fc1=_0x487e97(0x224);break;case _0x487e97(0x231):case'awaiting\x20fiat':case _0x487e97(0x23c):case _0x487e97(0x1e2):default:_0x3e7fc1=_0x487e97(0x23b);break;}let _0x1a3e91,_0x36fdd3;if(_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x226)]){const _0x44ed9f=_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x226)];console[_0x487e97(0x232)](_0x487e97(0x1d7),_0x44ed9f);const _0xbc25ef=_0x44ed9f['match'](/IBAN\s+([A-Z0-9]+)/i);_0xbc25ef&&(_0x1a3e91=_0xbc25ef[0x1],console[_0x487e97(0x232)]('üè¶\x20Extracted\x20IBAN:',_0x1a3e91)),_0x36fdd3=_0x44ed9f;}const _0x23fbac={'iban':_0x1a3e91,'bankDetails':_0x36fdd3,'transactionId':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x20d)],'coinAddress':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x212)],'qrCodeUrl':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x213)],'expiryTime':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x202)],'createdOn':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x1ee)],'confirmedOn':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x1c5)]};console[_0x487e97(0x232)](_0x487e97(0x204)),console[_0x487e97(0x232)]('Status:',_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x230)],'->',_0x3e7fc1),console['log'](_0x487e97(0x215),_0x9cd5fa[_0x487e97(0x1fc)]['Amount'],_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x1f3)]),console[_0x487e97(0x232)]('Transaction\x20ID:',_0x9cd5fa[_0x487e97(0x1fc)]['TransactionID']),console[_0x487e97(0x232)](_0x487e97(0x1c7),_0x1a3e91||'not\x20found'),console[_0x487e97(0x232)](_0x487e97(0x1de),_0x9cd5fa['data'][_0x487e97(0x1ee)]),console[_0x487e97(0x232)](_0x487e97(0x1e6),_0x9cd5fa[_0x487e97(0x1fc)]['TransactionConfirmedOn']||_0x487e97(0x217));if(_0x9cd5fa['data'][_0x487e97(0x230)]?.[_0x487e97(0x21b)]()===_0x487e97(0x22c))console[_0x487e97(0x232)](_0x487e97(0x1fd));else _0x9cd5fa['data'][_0x487e97(0x230)]?.[_0x487e97(0x21b)]()===_0x487e97(0x1c4)&&console[_0x487e97(0x232)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3e7fc1,'amount':parseFloat(_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x1df)])||undefined,'currency':_0x9cd5fa[_0x487e97(0x1fc)][_0x487e97(0x1f3)]||'EUR','paymentDetails':_0x23fbac};}catch(_0x7e62d7){console[_0x487e97(0x208)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x7e62d7),loggerService_1[_0x487e97(0x1d8)]['logWhiteDomainError'](_0x487e97(0x234),_0x487e97(0x206),_0x7e62d7);throw new Error(_0x487e97(0x207)+(_0x7e62d7 instanceof Error?_0x7e62d7[_0x487e97(0x214)]:_0x487e97(0x1d2)));}}async[a44_0x422ae4(0x1e1)](_0x40e1f9){const _0x58fd71=a44_0x422ae4,_0x57de3a=await this[_0x58fd71(0x238)](_0x40e1f9);return{'status':_0x57de3a[_0x58fd71(0x21a)],'amount':_0x57de3a[_0x58fd71(0x211)],'currency':_0x57de3a[_0x58fd71(0x20c)]};}async[a44_0x422ae4(0x1c8)](_0x134602){const _0xb13522=a44_0x422ae4;console[_0xb13522(0x232)](_0xb13522(0x1d6),_0x134602);let _0x529389='PENDING';switch(_0x134602[_0xb13522(0x21a)]?.[_0xb13522(0x21b)]()){case _0xb13522(0x1c4):_0x529389=_0xb13522(0x1cb);break;case _0xb13522(0x1f2):case _0xb13522(0x1e4):case _0xb13522(0x208):_0x529389=_0xb13522(0x223);break;case _0xb13522(0x1f9):case _0xb13522(0x1f8):_0x529389=_0xb13522(0x224);break;case _0xb13522(0x23c):case'waiting':case _0xb13522(0x22c):case'created':default:_0x529389=_0xb13522(0x23b);break;}return{'paymentId':_0x134602['order_id']||_0x134602[_0xb13522(0x1c6)]||'','status':_0x529389,'amount':_0x134602[_0xb13522(0x211)],'currency':_0x134602['currency']||_0xb13522(0x1d9)};}}exports[a44_0x422ae4(0x1f7)]=CoinToPayService;