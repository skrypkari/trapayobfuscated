'use strict';const a38_0x20eb0d=a38_0x1304;(function(_0x26c746,_0x150d4d){const _0x33d28c=a38_0x1304,_0x4da3d1=_0x26c746();while(!![]){try{const _0x5b3ae6=parseInt(_0x33d28c(0x1e7))/0x1*(-parseInt(_0x33d28c(0x1a1))/0x2)+-parseInt(_0x33d28c(0x1b8))/0x3*(parseInt(_0x33d28c(0x1c8))/0x4)+parseInt(_0x33d28c(0x1c4))/0x5+-parseInt(_0x33d28c(0x221))/0x6*(-parseInt(_0x33d28c(0x217))/0x7)+parseInt(_0x33d28c(0x1cf))/0x8+parseInt(_0x33d28c(0x1c2))/0x9+parseInt(_0x33d28c(0x1aa))/0xa*(-parseInt(_0x33d28c(0x1bd))/0xb);if(_0x5b3ae6===_0x150d4d)break;else _0x4da3d1['push'](_0x4da3d1['shift']());}catch(_0x3d11f5){_0x4da3d1['push'](_0x4da3d1['shift']());}}}(a38_0x5c25,0x36b1b));Object[a38_0x20eb0d(0x1f5)](exports,'__esModule',{'value':!![]}),exports[a38_0x20eb0d(0x219)]=void 0x0;function a38_0x5c25(){const _0x45dbe5=['not\x20found','logWhiteDomainError','fromEntries','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','110qvklLu','message','data','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','application/json','coinAddress','CoinToPay\x20API\x20error:\x20','inputCurrency','Amount','HTTP\x20error!\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','text','Status\x20API\x20Error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','12KLCzcB','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','log','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','57838ilLKNJ','ðŸ¦\x20Extracted\x20IBAN:','URL:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','573345SrWUtI','../loggerService','991805kQlrZI','Error\x20message:','statusText','FAILED','151784LyGaGc','/status','TesSoft\x20Payment\x20System/1.0','result','PAID','verifyPayment','Raw\x20Response\x20Body:','3180976SQmYxS','logWhiteDomainResponse','paid','Result:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','headers',',\x20body:\x20','EXPIRED','expired','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20Text:','timeout','statusUrl','Payment\x20Status:','Status:','Missing\x20data\x20in\x20response','cointopay','waiting','Error\x20Message:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','IBAN:','2XXXpIj','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','/create','Transaction\x20ID:','logWhiteDomainRequest','apiUrl','toLowerCase','Incomplete\x20response:\x20missing\x20data','TransactionConfirmedOn','Amount:','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Payment\x20URL:','ExpiryTime','defineProperty','success','Response\x20Body:','merchant_reference_id','cancelled','===\x20COINTOPAY\x20SUCCESS\x20===','created','awaiting\x20fiat','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','Response\x20Time:','parse','Status','payment_url','HTTP\x20Status:','QRCodeURL','TransactionID','now','Error\x20details:','order_id','Business\x20Error:\x20','PENDING','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','createPaymentLink','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','gateway_payment_id','\x20EUR','amount','Error\x20stack:','ðŸ“Š\x20Status\x20check\x20URL:','status','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','7hUUAQF','match','CoinToPayService','failed','HTTP\x20','Status\x20Code:','ðŸ¦\x20Payment\x20Detail:','Headers:','checkPaymentStatus','POST','375378yjddrb','status_code','currency','EUR','CreatedOn','Parsed\x20Result:','stringify','288602jwwZqH','loggerService','https://tesoft.uk/gateway/cointopay/','Created\x20On:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='];a38_0x5c25=function(){return _0x45dbe5;};return a38_0x5c25();}const loggerService_1=require(a38_0x20eb0d(0x1c3));function a38_0x1304(_0x5427bd,_0x526401){const _0x5c2585=a38_0x5c25();return a38_0x1304=function(_0x13047f,_0xfb0ce7){_0x13047f=_0x13047f-0x1a0;let _0x1ed637=_0x5c2585[_0x13047f];return _0x1ed637;},a38_0x1304(_0x5427bd,_0x526401);}class CoinToPayService{constructor(){const _0x4e5619=a38_0x20eb0d;this[_0x4e5619(0x1ec)]=_0x4e5619(0x1a3),this[_0x4e5619(0x1de)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4e5619(0x1bb)]('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x4e5619(0x1bb)](_0x4e5619(0x214),this['statusUrl']);}async[a38_0x20eb0d(0x20d)](_0x3518a4){const _0x41028a=a38_0x20eb0d,{orderId:_0x317ee4,amount:_0x9a8f65}=_0x3518a4;console[_0x41028a(0x1bb)](_0x41028a(0x20c)+_0x9a8f65+_0x41028a(0x211));const _0x7ac446={'amount':_0x9a8f65},_0x1a7e51=Date[_0x41028a(0x207)]();try{console[_0x41028a(0x1bb)](_0x41028a(0x1da)),console['log'](_0x41028a(0x1bf),this[_0x41028a(0x1ec)]),console[_0x41028a(0x1bb)]('Request\x20Body:',JSON[_0x41028a(0x1a0)](_0x7ac446,null,0x2)),console[_0x41028a(0x1bb)](_0x41028a(0x1f0),_0x9a8f65,_0x41028a(0x1b7)),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1eb)](_0x41028a(0x1e2),_0x41028a(0x1e9),'POST',_0x7ac446);const _0x5ef794=await fetch(this[_0x41028a(0x1ec)],{'method':'POST','headers':{'Content-Type':_0x41028a(0x1ae),'Accept':_0x41028a(0x1ae),'User-Agent':_0x41028a(0x1ca)},'body':JSON[_0x41028a(0x1a0)](_0x7ac446)}),_0x551e17=Date[_0x41028a(0x207)]()-_0x1a7e51;console[_0x41028a(0x1bb)](_0x41028a(0x1e5)),console[_0x41028a(0x1bb)](_0x41028a(0x1e0),_0x5ef794[_0x41028a(0x215)]),console[_0x41028a(0x1bb)](_0x41028a(0x1dc),_0x5ef794[_0x41028a(0x1c6)]),console[_0x41028a(0x1bb)](_0x41028a(0x21e),Object[_0x41028a(0x1a8)](_0x5ef794[_0x41028a(0x1d4)]['entries']())),console[_0x41028a(0x1bb)](_0x41028a(0x200),_0x551e17+'ms');const _0x484749=await _0x5ef794['text']();console[_0x41028a(0x1bb)](_0x41028a(0x1ce),_0x484749);if(!_0x5ef794['ok']){console[_0x41028a(0x1f1)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x41028a(0x204),_0x5ef794[_0x41028a(0x215)]),console[_0x41028a(0x1f1)](_0x41028a(0x1f7),_0x484749),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1d0)](_0x41028a(0x1e2),_0x41028a(0x1e9),_0x5ef794[_0x41028a(0x215)],_0x484749,_0x551e17),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1a7)](_0x41028a(0x1e2),_0x41028a(0x1e9),_0x41028a(0x21b)+_0x5ef794['status']+':\x20'+_0x484749);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5ef794[_0x41028a(0x215)]+_0x41028a(0x1d5)+_0x484749);}let _0xad9531;try{_0xad9531=JSON[_0x41028a(0x201)](_0x484749);}catch(_0x553863){console[_0x41028a(0x1f1)](_0x41028a(0x20f),_0x553863),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1a7)]('cointopay',_0x41028a(0x1e9),_0x41028a(0x1ff)+_0x553863);throw new Error(_0x41028a(0x1f2)+_0x484749);}console['log'](_0x41028a(0x1db)),console['log'](_0x41028a(0x226),JSON[_0x41028a(0x1a0)](_0xad9531,null,0x2)),loggerService_1['loggerService'][_0x41028a(0x1d0)]('cointopay',_0x41028a(0x1e9),_0x5ef794[_0x41028a(0x215)],_0xad9531,_0x551e17);if(_0xad9531[_0x41028a(0x1f1)]){const _0x4f6a2d=_0xad9531[_0x41028a(0x1ab)]||_0xad9531[_0x41028a(0x1f1)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x41028a(0x1f1)](_0x41028a(0x1a5)),console[_0x41028a(0x1f1)](_0x41028a(0x1e4),_0x4f6a2d),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1a7)](_0x41028a(0x1e2),'/create',_0x41028a(0x20a)+_0x4f6a2d);throw new Error(_0x41028a(0x1b0)+_0x4f6a2d);}if(!_0xad9531[_0x41028a(0x203)]||!_0xad9531[_0x41028a(0x210)]){console[_0x41028a(0x1f1)](_0x41028a(0x1bc)),console[_0x41028a(0x1f1)](_0x41028a(0x1d8)),console[_0x41028a(0x1f1)]('Response\x20data:',_0xad9531),loggerService_1[_0x41028a(0x1a2)][_0x41028a(0x1a7)](_0x41028a(0x1e2),_0x41028a(0x1e9),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x41028a(0x1fd));}return console[_0x41028a(0x1bb)](_0x41028a(0x1fa)),console[_0x41028a(0x1bb)](_0x41028a(0x1d9),_0xad9531['gateway_payment_id']),console['log'](_0x41028a(0x1f3),_0xad9531[_0x41028a(0x203)]),console[_0x41028a(0x1bb)]('Amount:',_0x9a8f65,'EUR'),{'gateway_payment_id':_0xad9531[_0x41028a(0x210)],'payment_url':_0xad9531[_0x41028a(0x203)]};}catch(_0x3aad18){console[_0x41028a(0x1f1)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x41028a(0x1f1)](_0x41028a(0x208),_0x3aad18),loggerService_1['loggerService'][_0x41028a(0x1a7)]('cointopay',_0x41028a(0x1e9),_0x3aad18);if(_0x3aad18 instanceof Error){console[_0x41028a(0x1f1)](_0x41028a(0x1c5),_0x3aad18['message']),console['error'](_0x41028a(0x213),_0x3aad18['stack']);throw new Error(_0x41028a(0x1b9)+_0x3aad18[_0x41028a(0x1ab)]);}throw new Error(_0x41028a(0x1a9));}}async[a38_0x20eb0d(0x21f)](_0x486a78){const _0x383d9b=a38_0x20eb0d,_0x16927b=Date[_0x383d9b(0x207)]();try{console[_0x383d9b(0x1bb)](_0x383d9b(0x1ad)+_0x486a78);const _0x5a0fac={'gatewayPaymentId':_0x486a78};loggerService_1[_0x383d9b(0x1a2)][_0x383d9b(0x1eb)]('cointopay',_0x383d9b(0x1c9),_0x383d9b(0x220),_0x5a0fac);const _0x75c5b3=await fetch(this[_0x383d9b(0x1de)],{'method':_0x383d9b(0x220),'headers':{'Content-Type':_0x383d9b(0x1ae),'Accept':_0x383d9b(0x1ae),'User-Agent':_0x383d9b(0x1ca)},'body':JSON[_0x383d9b(0x1a0)](_0x5a0fac)}),_0x35a044=Date['now']()-_0x16927b;console[_0x383d9b(0x1bb)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x75c5b3[_0x383d9b(0x215)]),console[_0x383d9b(0x1bb)](_0x383d9b(0x200),_0x35a044+'ms');if(!_0x75c5b3['ok']){const _0xe29fc2=await _0x75c5b3[_0x383d9b(0x1b5)]();console[_0x383d9b(0x1f1)](_0x383d9b(0x204),_0x75c5b3[_0x383d9b(0x215)]),console['error'](_0x383d9b(0x1f7),_0xe29fc2),loggerService_1[_0x383d9b(0x1a2)]['logWhiteDomainResponse'](_0x383d9b(0x1e2),_0x383d9b(0x1c9),_0x75c5b3[_0x383d9b(0x215)],_0xe29fc2,_0x35a044),loggerService_1[_0x383d9b(0x1a2)][_0x383d9b(0x1a7)](_0x383d9b(0x1e2),_0x383d9b(0x1c9),_0x383d9b(0x21b)+_0x75c5b3[_0x383d9b(0x215)]+':\x20'+_0xe29fc2);throw new Error(_0x383d9b(0x1b3)+_0x75c5b3['status']);}const _0x396ffc=await _0x75c5b3[_0x383d9b(0x1b5)]();console[_0x383d9b(0x1bb)](_0x383d9b(0x1ce),_0x396ffc);let _0x4aa304;try{_0x4aa304=JSON[_0x383d9b(0x201)](_0x396ffc);}catch(_0xd7a4d5){console['error'](_0x383d9b(0x20f),_0xd7a4d5),loggerService_1['loggerService'][_0x383d9b(0x1a7)](_0x383d9b(0x1e2),_0x383d9b(0x1c9),'JSON\x20Parse\x20Error:\x20'+_0xd7a4d5);throw new Error(_0x383d9b(0x1ba)+_0x396ffc);}loggerService_1['loggerService'][_0x383d9b(0x1d0)](_0x383d9b(0x1e2),'/status',_0x75c5b3[_0x383d9b(0x215)],_0x4aa304,_0x35a044),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x383d9b(0x1d2),_0x4aa304[_0x383d9b(0x1cb)]),console[_0x383d9b(0x1bb)](_0x383d9b(0x21c),_0x4aa304[_0x383d9b(0x222)]),console['log'](_0x383d9b(0x1df),_0x4aa304['data']?.[_0x383d9b(0x202)]),console[_0x383d9b(0x1bb)](_0x383d9b(0x1f0),_0x4aa304[_0x383d9b(0x1ac)]?.[_0x383d9b(0x1b2)]),console[_0x383d9b(0x1bb)]('Currency:',_0x4aa304[_0x383d9b(0x1ac)]?.['inputCurrency']);if(_0x4aa304[_0x383d9b(0x1cb)]!==_0x383d9b(0x1f6)||_0x4aa304[_0x383d9b(0x222)]!==0xc8){const _0x4ebe0e=_0x4aa304[_0x383d9b(0x1ab)]||_0x383d9b(0x1c0);console[_0x383d9b(0x1f1)](_0x383d9b(0x1d3)),console['error']('Error\x20Message:',_0x4ebe0e),loggerService_1[_0x383d9b(0x1a2)][_0x383d9b(0x1a7)](_0x383d9b(0x1e2),_0x383d9b(0x1c9),_0x383d9b(0x1b6)+_0x4ebe0e);throw new Error(_0x383d9b(0x20e)+_0x4ebe0e);}if(!_0x4aa304['data']){console[_0x383d9b(0x1f1)](_0x383d9b(0x1fe)),console[_0x383d9b(0x1f1)](_0x383d9b(0x1e1)),loggerService_1[_0x383d9b(0x1a2)]['logWhiteDomainError'](_0x383d9b(0x1e2),_0x383d9b(0x1c9),_0x383d9b(0x1ee));throw new Error(_0x383d9b(0x1b4));}let _0x4ae4e4=_0x383d9b(0x20b);switch(_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x202)]?.[_0x383d9b(0x1ed)]()){case'paid':_0x4ae4e4='PAID';break;case _0x383d9b(0x1f9):case _0x383d9b(0x21a):case _0x383d9b(0x1f1):_0x4ae4e4=_0x383d9b(0x1c7);break;case'expired':case _0x383d9b(0x1dd):_0x4ae4e4=_0x383d9b(0x1d6);break;case'waiting':case _0x383d9b(0x1fc):case'pending':case _0x383d9b(0x1fb):default:_0x4ae4e4=_0x383d9b(0x20b);break;}let _0x50767d,_0x372b93;if(_0x4aa304[_0x383d9b(0x1ac)]['PaymentDetail']){const _0x4bf1eb=_0x4aa304[_0x383d9b(0x1ac)]['PaymentDetail'];console[_0x383d9b(0x1bb)](_0x383d9b(0x21d),_0x4bf1eb);const _0x3a08f8=_0x4bf1eb[_0x383d9b(0x218)](/IBAN\s+([A-Z0-9]+)/i);_0x3a08f8&&(_0x50767d=_0x3a08f8[0x1],console['log'](_0x383d9b(0x1be),_0x50767d)),_0x372b93=_0x4bf1eb;}const _0x483abf={'iban':_0x50767d,'bankDetails':_0x372b93,'transactionId':_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x206)],'coinAddress':_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1af)],'qrCodeUrl':_0x4aa304['data'][_0x383d9b(0x205)],'expiryTime':_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1f4)],'createdOn':_0x4aa304[_0x383d9b(0x1ac)]['CreatedOn'],'confirmedOn':_0x4aa304[_0x383d9b(0x1ac)]['TransactionConfirmedOn']};console['log'](_0x383d9b(0x1c1)),console[_0x383d9b(0x1bb)](_0x383d9b(0x1e0),_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x202)],'->',_0x4ae4e4),console[_0x383d9b(0x1bb)]('Amount:',_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1b2)],_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1b1)]),console['log'](_0x383d9b(0x1ea),_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x206)]),console[_0x383d9b(0x1bb)](_0x383d9b(0x1e6),_0x50767d||_0x383d9b(0x1a6)),console[_0x383d9b(0x1bb)](_0x383d9b(0x1a4),_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x225)]),console[_0x383d9b(0x1bb)]('Confirmed\x20On:',_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1ef)]||'not\x20confirmed');if(_0x4aa304[_0x383d9b(0x1ac)]['Status']?.[_0x383d9b(0x1ed)]()===_0x383d9b(0x1fc))console[_0x383d9b(0x1bb)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x202)]?.[_0x383d9b(0x1ed)]()===_0x383d9b(0x1d1)&&console[_0x383d9b(0x1bb)](_0x383d9b(0x1e8));return{'status':_0x4ae4e4,'amount':parseFloat(_0x4aa304[_0x383d9b(0x1ac)][_0x383d9b(0x1b2)])||undefined,'currency':_0x4aa304['data'][_0x383d9b(0x1b1)]||_0x383d9b(0x224),'paymentDetails':_0x483abf};}catch(_0x175850){console[_0x383d9b(0x1f1)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x175850),loggerService_1[_0x383d9b(0x1a2)][_0x383d9b(0x1a7)](_0x383d9b(0x1e2),_0x383d9b(0x1c9),_0x175850);throw new Error(_0x383d9b(0x216)+(_0x175850 instanceof Error?_0x175850[_0x383d9b(0x1ab)]:'Unknown\x20error'));}}async[a38_0x20eb0d(0x1cd)](_0x4fa1ff){const _0x5f3db5=a38_0x20eb0d,_0x7e6f66=await this['checkPaymentStatus'](_0x4fa1ff);return{'status':_0x7e6f66[_0x5f3db5(0x215)],'amount':_0x7e6f66[_0x5f3db5(0x212)],'currency':_0x7e6f66[_0x5f3db5(0x223)]};}async['processWebhook'](_0x336238){const _0x580f81=a38_0x20eb0d;console[_0x580f81(0x1bb)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x336238);let _0x5aef51=_0x580f81(0x20b);switch(_0x336238[_0x580f81(0x215)]?.[_0x580f81(0x1ed)]()){case'paid':_0x5aef51=_0x580f81(0x1cc);break;case'cancelled':case _0x580f81(0x21a):case'error':_0x5aef51=_0x580f81(0x1c7);break;case _0x580f81(0x1d7):case _0x580f81(0x1dd):_0x5aef51=_0x580f81(0x1d6);break;case'pending':case _0x580f81(0x1e3):case _0x580f81(0x1fc):case _0x580f81(0x1fb):default:_0x5aef51=_0x580f81(0x20b);break;}return{'paymentId':_0x336238[_0x580f81(0x209)]||_0x336238[_0x580f81(0x1f8)]||'','status':_0x5aef51,'amount':_0x336238[_0x580f81(0x212)],'currency':_0x336238['currency']||'EUR'};}}exports[a38_0x20eb0d(0x219)]=CoinToPayService;