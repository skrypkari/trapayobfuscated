'use strict';function a41_0x59ba(){const _0x2efcd1=['üè¶\x20Extracted\x20IBAN:','message','PAID','Currency:','üè¶\x20Payment\x20Detail:','Error\x20message:','3382896iyljtu','stack','currency','\x20EUR','expired','log','waiting','application/json','cointopay','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','../loggerService','cancelled','Raw\x20Response\x20Body:','EUR','1438083SQShGe','data','headers','Amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','success','Transaction\x20ID:','paid','defineProperty','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Headers:','not\x20found','Confirmed\x20On:','Error\x20Message:','TesSoft\x20Payment\x20System/1.0','Response\x20Body:','Status\x20Code:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','/status','Amount:','POST','gateway_payment_id','apiUrl','loggerService','statusText','JSON\x20Parse\x20Error:\x20','HTTP\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Error\x20details:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','62sEQSod','Parsed\x20Result:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','Payment\x20Status:','payment_url','parse','status','createPaymentLink','Response\x20Time:','failed','220cdNkEZ','24130QXruxK','result','https://tesoft.uk/gateway/cointopay/status.php','CoinToPay\x20status\x20API\x20error:\x20','Status','Gateway\x20Payment\x20ID:','Created\x20On:','status_code','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','37197PAyXrU','checkPaymentStatus','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','inputCurrency','PaymentDetail','now','text','4722PtQJLj','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20stack:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','3128XXQmxy','amount','HTTP\x20Status:','429044pmfbwr','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','created','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','timeout','FAILED','PENDING','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','logWhiteDomainRequest','Status\x20Text:','https://tesoft.uk/gateway/cointopay/','awaiting\x20fiat','logWhiteDomainResponse','IBAN:','CoinToPayService','merchant_reference_id','TransactionConfirmedOn','===\x20COINTOPAY\x20SUCCESS\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','statusUrl','3346WIFUjM','/create',',\x20body:\x20','TransactionID','coinAddress','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Result:','EXPIRED','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','QRCodeURL','2838meghtS','__esModule','toLowerCase','error','Payment\x20URL:','logWhiteDomainError','stringify','CoinToPay\x20API\x20error:\x20','Business\x20Error:\x20','Status:'];a41_0x59ba=function(){return _0x2efcd1;};return a41_0x59ba();}const a41_0x8323be=a41_0x3ce1;(function(_0x3d3427,_0x2dc177){const _0x116f2a=a41_0x3ce1,_0x2e2f23=_0x3d3427();while(!![]){try{const _0x49ce28=parseInt(_0x116f2a(0x1e4))/0x1+-parseInt(_0x116f2a(0x1bf))/0x2*(-parseInt(_0x116f2a(0x1d5))/0x3)+parseInt(_0x116f2a(0x1e1))/0x4*(-parseInt(_0x116f2a(0x1ca))/0x5)+-parseInt(_0x116f2a(0x1dc))/0x6*(-parseInt(_0x116f2a(0x175))/0x7)+-parseInt(_0x116f2a(0x191))/0x8+parseInt(_0x116f2a(0x19f))/0x9+-parseInt(_0x116f2a(0x1cb))/0xa*(parseInt(_0x116f2a(0x181))/0xb);if(_0x49ce28===_0x2dc177)break;else _0x2e2f23['push'](_0x2e2f23['shift']());}catch(_0xf9a494){_0x2e2f23['push'](_0x2e2f23['shift']());}}}(a41_0x59ba,0x41cfa));function a41_0x3ce1(_0x305c21,_0x5e2107){const _0x59ba40=a41_0x59ba();return a41_0x3ce1=function(_0x3ce1ef,_0x1b2033){_0x3ce1ef=_0x3ce1ef-0x16f;let _0x22d5dd=_0x59ba40[_0x3ce1ef];return _0x22d5dd;},a41_0x3ce1(_0x305c21,_0x5e2107);}Object[a41_0x8323be(0x1a7)](exports,a41_0x8323be(0x182),{'value':!![]}),exports[a41_0x8323be(0x16f)]=void 0x0;const loggerService_1=require(a41_0x8323be(0x19b));class CoinToPayService{constructor(){const _0x3ffba2=a41_0x8323be;this[_0x3ffba2(0x1b7)]=_0x3ffba2(0x1f0),this[_0x3ffba2(0x174)]=_0x3ffba2(0x1cd),console[_0x3ffba2(0x196)](_0x3ffba2(0x1e5)),console[_0x3ffba2(0x196)]('üìä\x20Status\x20check\x20URL:',this[_0x3ffba2(0x174)]);}async[a41_0x8323be(0x1c7)](_0x235128){const _0x14f1b9=a41_0x8323be,{orderId:_0x2ada61,amount:_0x5a2ec1}=_0x235128;console[_0x14f1b9(0x196)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5a2ec1+_0x14f1b9(0x194));const _0x19d144={'amount':_0x5a2ec1},_0x33437a=Date[_0x14f1b9(0x1da)]();try{console[_0x14f1b9(0x196)](_0x14f1b9(0x1b0)),console['log']('URL:',this['apiUrl']),console[_0x14f1b9(0x196)]('Request\x20Body:',JSON[_0x14f1b9(0x187)](_0x19d144,null,0x2)),console[_0x14f1b9(0x196)](_0x14f1b9(0x1b4),_0x5a2ec1,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x1ee)](_0x14f1b9(0x199),'/create',_0x14f1b9(0x1b5),_0x19d144);const _0x2a466d=await fetch(this[_0x14f1b9(0x1b7)],{'method':_0x14f1b9(0x1b5),'headers':{'Content-Type':_0x14f1b9(0x198),'Accept':_0x14f1b9(0x198),'User-Agent':_0x14f1b9(0x1ad)},'body':JSON[_0x14f1b9(0x187)](_0x19d144)}),_0x4a3eae=Date[_0x14f1b9(0x1da)]()-_0x33437a;console[_0x14f1b9(0x196)](_0x14f1b9(0x19a)),console[_0x14f1b9(0x196)](_0x14f1b9(0x18a),_0x2a466d[_0x14f1b9(0x1c6)]),console['log'](_0x14f1b9(0x1ef),_0x2a466d[_0x14f1b9(0x1b9)]),console[_0x14f1b9(0x196)](_0x14f1b9(0x1a9),Object['fromEntries'](_0x2a466d[_0x14f1b9(0x1a1)]['entries']())),console['log'](_0x14f1b9(0x1c8),_0x4a3eae+'ms');const _0x49c7e7=await _0x2a466d[_0x14f1b9(0x1db)]();console[_0x14f1b9(0x196)]('Raw\x20Response\x20Body:',_0x49c7e7);if(!_0x2a466d['ok']){console['error'](_0x14f1b9(0x1d4)),console[_0x14f1b9(0x184)]('HTTP\x20Status:',_0x2a466d[_0x14f1b9(0x1c6)]),console[_0x14f1b9(0x184)](_0x14f1b9(0x1ae),_0x49c7e7),loggerService_1['loggerService'][_0x14f1b9(0x1f2)](_0x14f1b9(0x199),'/create',_0x2a466d[_0x14f1b9(0x1c6)],_0x49c7e7,_0x4a3eae),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x186)]('cointopay',_0x14f1b9(0x176),_0x14f1b9(0x1bb)+_0x2a466d[_0x14f1b9(0x1c6)]+':\x20'+_0x49c7e7);throw new Error(_0x14f1b9(0x1c2)+_0x2a466d['status']+_0x14f1b9(0x177)+_0x49c7e7);}let _0xbecdb6;try{_0xbecdb6=JSON['parse'](_0x49c7e7);}catch(_0x212b60){console[_0x14f1b9(0x184)](_0x14f1b9(0x1b2),_0x212b60),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x186)]('cointopay','/create',_0x14f1b9(0x1ba)+_0x212b60);throw new Error(_0x14f1b9(0x1a3)+_0x49c7e7);}console[_0x14f1b9(0x196)](_0x14f1b9(0x1d7)),console[_0x14f1b9(0x196)](_0x14f1b9(0x1c0),JSON[_0x14f1b9(0x187)](_0xbecdb6,null,0x2)),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x1f2)](_0x14f1b9(0x199),_0x14f1b9(0x176),_0x2a466d[_0x14f1b9(0x1c6)],_0xbecdb6,_0x4a3eae);if(_0xbecdb6[_0x14f1b9(0x184)]){const _0x448df5=_0xbecdb6[_0x14f1b9(0x18c)]||_0xbecdb6[_0x14f1b9(0x184)]||_0x14f1b9(0x17f);console[_0x14f1b9(0x184)](_0x14f1b9(0x17b)),console['error']('Error\x20Message:',_0x448df5),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x186)](_0x14f1b9(0x199),_0x14f1b9(0x176),_0x14f1b9(0x189)+_0x448df5);throw new Error(_0x14f1b9(0x188)+_0x448df5);}if(!_0xbecdb6[_0x14f1b9(0x1c4)]||!_0xbecdb6[_0x14f1b9(0x1b6)]){console[_0x14f1b9(0x184)](_0x14f1b9(0x1c1)),console[_0x14f1b9(0x184)](_0x14f1b9(0x1e0)),console[_0x14f1b9(0x184)]('Response\x20data:',_0xbecdb6),loggerService_1[_0x14f1b9(0x1b8)][_0x14f1b9(0x186)](_0x14f1b9(0x199),_0x14f1b9(0x176),_0x14f1b9(0x1e8));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x14f1b9(0x196)](_0x14f1b9(0x172)),console['log'](_0x14f1b9(0x1d0),_0xbecdb6[_0x14f1b9(0x1b6)]),console[_0x14f1b9(0x196)](_0x14f1b9(0x185),_0xbecdb6[_0x14f1b9(0x1c4)]),console[_0x14f1b9(0x196)]('Amount:',_0x5a2ec1,'EUR'),{'gateway_payment_id':_0xbecdb6[_0x14f1b9(0x1b6)],'payment_url':_0xbecdb6[_0x14f1b9(0x1c4)]};}catch(_0x2f520d){console[_0x14f1b9(0x184)](_0x14f1b9(0x1d3)),console[_0x14f1b9(0x184)](_0x14f1b9(0x1bd),_0x2f520d),loggerService_1[_0x14f1b9(0x1b8)]['logWhiteDomainError']('cointopay',_0x14f1b9(0x176),_0x2f520d);if(_0x2f520d instanceof Error){console[_0x14f1b9(0x184)](_0x14f1b9(0x190),_0x2f520d[_0x14f1b9(0x18c)]),console[_0x14f1b9(0x184)](_0x14f1b9(0x1df),_0x2f520d[_0x14f1b9(0x192)]);throw new Error(_0x14f1b9(0x1de)+_0x2f520d[_0x14f1b9(0x18c)]);}throw new Error(_0x14f1b9(0x1a8));}}async[a41_0x8323be(0x1d6)](_0x438164){const _0x4ba285=a41_0x8323be,_0x3cf6d6=Date['now']();try{console[_0x4ba285(0x196)](_0x4ba285(0x173)+_0x438164);const _0x22c46d={'gatewayPaymentId':_0x438164};loggerService_1[_0x4ba285(0x1b8)][_0x4ba285(0x1ee)](_0x4ba285(0x199),_0x4ba285(0x1b3),'POST',_0x22c46d);const _0x44e09d=await fetch(this[_0x4ba285(0x174)],{'method':_0x4ba285(0x1b5),'headers':{'Content-Type':_0x4ba285(0x198),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x22c46d)}),_0x2eb903=Date[_0x4ba285(0x1da)]()-_0x3cf6d6;console['log'](_0x4ba285(0x1b1)),console['log'](_0x4ba285(0x18a),_0x44e09d[_0x4ba285(0x1c6)]),console['log'](_0x4ba285(0x1c8),_0x2eb903+'ms');if(!_0x44e09d['ok']){const _0xdcaf20=await _0x44e09d[_0x4ba285(0x1db)]();console['error'](_0x4ba285(0x1e3),_0x44e09d['status']),console[_0x4ba285(0x184)](_0x4ba285(0x1ae),_0xdcaf20),loggerService_1[_0x4ba285(0x1b8)][_0x4ba285(0x1f2)](_0x4ba285(0x199),_0x4ba285(0x1b3),_0x44e09d[_0x4ba285(0x1c6)],_0xdcaf20,_0x2eb903),loggerService_1[_0x4ba285(0x1b8)][_0x4ba285(0x186)](_0x4ba285(0x199),_0x4ba285(0x1b3),_0x4ba285(0x1bb)+_0x44e09d[_0x4ba285(0x1c6)]+':\x20'+_0xdcaf20);throw new Error(_0x4ba285(0x1c2)+_0x44e09d[_0x4ba285(0x1c6)]);}const _0x205e9d=await _0x44e09d[_0x4ba285(0x1db)]();console['log'](_0x4ba285(0x19d),_0x205e9d);let _0x5749c0;try{_0x5749c0=JSON[_0x4ba285(0x1c5)](_0x205e9d);}catch(_0x29540f){console['error'](_0x4ba285(0x1b2),_0x29540f),loggerService_1[_0x4ba285(0x1b8)][_0x4ba285(0x186)](_0x4ba285(0x199),_0x4ba285(0x1b3),_0x4ba285(0x1ba)+_0x29540f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x205e9d);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4ba285(0x199),_0x4ba285(0x1b3),_0x44e09d['status'],_0x5749c0,_0x2eb903),console['log'](_0x4ba285(0x1ed)),console['log'](_0x4ba285(0x17c),_0x5749c0[_0x4ba285(0x1cc)]),console['log'](_0x4ba285(0x1af),_0x5749c0[_0x4ba285(0x1d2)]),console['log'](_0x4ba285(0x1c3),_0x5749c0[_0x4ba285(0x1a0)]?.[_0x4ba285(0x1cf)]),console[_0x4ba285(0x196)](_0x4ba285(0x1b4),_0x5749c0[_0x4ba285(0x1a0)]?.[_0x4ba285(0x1a2)]),console[_0x4ba285(0x196)](_0x4ba285(0x18e),_0x5749c0[_0x4ba285(0x1a0)]?.[_0x4ba285(0x1d8)]);if(_0x5749c0[_0x4ba285(0x1cc)]!==_0x4ba285(0x1a4)||_0x5749c0[_0x4ba285(0x1d2)]!==0xc8){const _0x82e399=_0x5749c0['message']||_0x4ba285(0x1dd);console['error'](_0x4ba285(0x17e)),console[_0x4ba285(0x184)](_0x4ba285(0x1ac),_0x82e399),loggerService_1['loggerService'][_0x4ba285(0x186)](_0x4ba285(0x199),_0x4ba285(0x1b3),_0x4ba285(0x1e7)+_0x82e399);throw new Error(_0x4ba285(0x1ce)+_0x82e399);}if(!_0x5749c0[_0x4ba285(0x1a0)]){console['error'](_0x4ba285(0x1ec)),console[_0x4ba285(0x184)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x4ba285(0x1b8)][_0x4ba285(0x186)](_0x4ba285(0x199),_0x4ba285(0x1b3),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x4ba285(0x1be));}let _0x2ccd1b=_0x4ba285(0x1eb);switch(_0x5749c0[_0x4ba285(0x1a0)]['Status']?.['toLowerCase']()){case'paid':_0x2ccd1b='PAID';break;case'cancelled':case'failed':case _0x4ba285(0x184):_0x2ccd1b=_0x4ba285(0x1ea);break;case'expired':case _0x4ba285(0x1e9):_0x2ccd1b=_0x4ba285(0x17d);break;case _0x4ba285(0x197):case _0x4ba285(0x1f1):case'pending':case _0x4ba285(0x1e6):default:_0x2ccd1b=_0x4ba285(0x1eb);break;}let _0x504a26,_0x399395;if(_0x5749c0['data'][_0x4ba285(0x1d9)]){const _0x5d5102=_0x5749c0['data'][_0x4ba285(0x1d9)];console[_0x4ba285(0x196)](_0x4ba285(0x18f),_0x5d5102);const _0x56571a=_0x5d5102['match'](/IBAN\s+([A-Z0-9]+)/i);_0x56571a&&(_0x504a26=_0x56571a[0x1],console[_0x4ba285(0x196)](_0x4ba285(0x18b),_0x504a26)),_0x399395=_0x5d5102;}const _0x56ef3e={'iban':_0x504a26,'bankDetails':_0x399395,'transactionId':_0x5749c0[_0x4ba285(0x1a0)]['TransactionID'],'coinAddress':_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x179)],'qrCodeUrl':_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x180)],'expiryTime':_0x5749c0[_0x4ba285(0x1a0)]['ExpiryTime'],'createdOn':_0x5749c0[_0x4ba285(0x1a0)]['CreatedOn'],'confirmedOn':_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x171)]};console['log'](_0x4ba285(0x17a)),console[_0x4ba285(0x196)](_0x4ba285(0x18a),_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x1cf)],'->',_0x2ccd1b),console['log']('Amount:',_0x5749c0['data']['Amount'],_0x5749c0[_0x4ba285(0x1a0)]['inputCurrency']),console[_0x4ba285(0x196)](_0x4ba285(0x1a5),_0x5749c0['data'][_0x4ba285(0x178)]),console['log'](_0x4ba285(0x1f3),_0x504a26||_0x4ba285(0x1aa)),console[_0x4ba285(0x196)](_0x4ba285(0x1d1),_0x5749c0[_0x4ba285(0x1a0)]['CreatedOn']),console[_0x4ba285(0x196)](_0x4ba285(0x1ab),_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x171)]||'not\x20confirmed');if(_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x1cf)]?.[_0x4ba285(0x183)]()===_0x4ba285(0x1f1))console[_0x4ba285(0x196)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x1cf)]?.[_0x4ba285(0x183)]()==='paid'&&console[_0x4ba285(0x196)](_0x4ba285(0x1bc));return{'status':_0x2ccd1b,'amount':parseFloat(_0x5749c0[_0x4ba285(0x1a0)][_0x4ba285(0x1a2)])||undefined,'currency':_0x5749c0['data'][_0x4ba285(0x1d8)]||_0x4ba285(0x19e),'paymentDetails':_0x56ef3e};}catch(_0x542929){console[_0x4ba285(0x184)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x542929),loggerService_1[_0x4ba285(0x1b8)]['logWhiteDomainError']('cointopay','/status',_0x542929);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x542929 instanceof Error?_0x542929[_0x4ba285(0x18c)]:'Unknown\x20error'));}}async['verifyPayment'](_0x301296){const _0x235d9a=a41_0x8323be,_0x27687c=await this[_0x235d9a(0x1d6)](_0x301296);return{'status':_0x27687c['status'],'amount':_0x27687c['amount'],'currency':_0x27687c[_0x235d9a(0x193)]};}async['processWebhook'](_0x363d92){const _0x18d87=a41_0x8323be;console[_0x18d87(0x196)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x363d92);let _0xf45407=_0x18d87(0x1eb);switch(_0x363d92['status']?.[_0x18d87(0x183)]()){case _0x18d87(0x1a6):_0xf45407=_0x18d87(0x18d);break;case _0x18d87(0x19c):case _0x18d87(0x1c9):case _0x18d87(0x184):_0xf45407=_0x18d87(0x1ea);break;case _0x18d87(0x195):case'timeout':_0xf45407=_0x18d87(0x17d);break;case'pending':case _0x18d87(0x197):case _0x18d87(0x1f1):case _0x18d87(0x1e6):default:_0xf45407=_0x18d87(0x1eb);break;}return{'paymentId':_0x363d92['order_id']||_0x363d92[_0x18d87(0x170)]||'','status':_0xf45407,'amount':_0x363d92[_0x18d87(0x1e2)],'currency':_0x363d92[_0x18d87(0x193)]||_0x18d87(0x19e)};}}exports[a41_0x8323be(0x16f)]=CoinToPayService;