'use strict';const a41_0x205e07=a41_0xc5c8;(function(_0x2eadb0,_0x19bae2){const _0x4e62b7=a41_0xc5c8,_0x20128e=_0x2eadb0();while(!![]){try{const _0x5cac35=parseInt(_0x4e62b7(0x1d1))/0x1*(-parseInt(_0x4e62b7(0x192))/0x2)+parseInt(_0x4e62b7(0x1e9))/0x3*(parseInt(_0x4e62b7(0x1cf))/0x4)+-parseInt(_0x4e62b7(0x1bc))/0x5+parseInt(_0x4e62b7(0x194))/0x6*(parseInt(_0x4e62b7(0x1b9))/0x7)+parseInt(_0x4e62b7(0x1f8))/0x8+-parseInt(_0x4e62b7(0x19f))/0x9*(-parseInt(_0x4e62b7(0x1f6))/0xa)+parseInt(_0x4e62b7(0x1ef))/0xb*(-parseInt(_0x4e62b7(0x204))/0xc);if(_0x5cac35===_0x19bae2)break;else _0x20128e['push'](_0x20128e['shift']());}catch(_0x2b58fe){_0x20128e['push'](_0x20128e['shift']());}}}(a41_0x1a10,0xa05c6));function a41_0xc5c8(_0x10196b,_0x3aed6b){const _0x1a106d=a41_0x1a10();return a41_0xc5c8=function(_0xc5c818,_0x952307){_0xc5c818=_0xc5c818-0x17c;let _0x33f971=_0x1a106d[_0xc5c818];return _0x33f971;},a41_0xc5c8(_0x10196b,_0x3aed6b);}Object[a41_0x205e07(0x1ba)](exports,a41_0x205e07(0x1ec),{'value':!![]}),exports[a41_0x205e07(0x1fa)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x46a514=a41_0x205e07;this['apiUrl']=_0x46a514(0x1c1),this[_0x46a514(0x1f2)]=_0x46a514(0x1b2),console[_0x46a514(0x1e5)](_0x46a514(0x1e4)),console[_0x46a514(0x1e5)](_0x46a514(0x1a1),this[_0x46a514(0x1f2)]);}async[a41_0x205e07(0x1b5)](_0x36a874){const _0x21faa3=a41_0x205e07,{orderId:_0x36c8bd,amount:_0x4a6a82}=_0x36a874;console[_0x21faa3(0x1e5)](_0x21faa3(0x1f1)+_0x4a6a82+_0x21faa3(0x186));const _0x3f3a5a={'amount':_0x4a6a82},_0x48bda2=Date[_0x21faa3(0x199)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x21faa3(0x1e5)](_0x21faa3(0x190),this[_0x21faa3(0x1e1)]),console[_0x21faa3(0x1e5)](_0x21faa3(0x1b4),JSON['stringify'](_0x3f3a5a,null,0x2)),console[_0x21faa3(0x1e5)](_0x21faa3(0x1d5),_0x4a6a82,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x21faa3(0x187)](_0x21faa3(0x1eb),_0x21faa3(0x1ae),_0x21faa3(0x17f),_0x3f3a5a);const _0x5dbf04=await fetch(this['apiUrl'],{'method':_0x21faa3(0x17f),'headers':{'Content-Type':_0x21faa3(0x1b1),'Accept':_0x21faa3(0x1b1),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x21faa3(0x18d)](_0x3f3a5a)}),_0x1ab0fa=Date[_0x21faa3(0x199)]()-_0x48bda2;console['log'](_0x21faa3(0x1dc)),console[_0x21faa3(0x1e5)](_0x21faa3(0x1ad),_0x5dbf04[_0x21faa3(0x1d7)]),console['log'](_0x21faa3(0x1c8),_0x5dbf04['statusText']),console[_0x21faa3(0x1e5)](_0x21faa3(0x181),Object[_0x21faa3(0x1ea)](_0x5dbf04['headers']['entries']())),console[_0x21faa3(0x1e5)](_0x21faa3(0x200),_0x1ab0fa+'ms');const _0x599938=await _0x5dbf04[_0x21faa3(0x1c4)]();console[_0x21faa3(0x1e5)](_0x21faa3(0x201),_0x599938);if(!_0x5dbf04['ok']){console[_0x21faa3(0x19a)](_0x21faa3(0x1dd)),console[_0x21faa3(0x19a)](_0x21faa3(0x1f5),_0x5dbf04[_0x21faa3(0x1d7)]),console[_0x21faa3(0x19a)]('Response\x20Body:',_0x599938),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x1b3)](_0x21faa3(0x1eb),_0x21faa3(0x1ae),_0x5dbf04[_0x21faa3(0x1d7)],_0x599938,_0x1ab0fa),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x182)](_0x21faa3(0x1eb),_0x21faa3(0x1ae),_0x21faa3(0x1bf)+_0x5dbf04[_0x21faa3(0x1d7)]+':\x20'+_0x599938);throw new Error(_0x21faa3(0x1bb)+_0x5dbf04[_0x21faa3(0x1d7)]+_0x21faa3(0x1f0)+_0x599938);}let _0x324196;try{_0x324196=JSON['parse'](_0x599938);}catch(_0x1a5153){console[_0x21faa3(0x19a)](_0x21faa3(0x1fe),_0x1a5153),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x182)](_0x21faa3(0x1eb),_0x21faa3(0x1ae),'JSON\x20Parse\x20Error:\x20'+_0x1a5153);throw new Error(_0x21faa3(0x1c3)+_0x599938);}console['log'](_0x21faa3(0x1c5)),console[_0x21faa3(0x1e5)](_0x21faa3(0x1a5),JSON['stringify'](_0x324196,null,0x2)),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x1b3)]('cointopay',_0x21faa3(0x1ae),_0x5dbf04[_0x21faa3(0x1d7)],_0x324196,_0x1ab0fa);if(_0x324196['error']){const _0x57904c=_0x324196[_0x21faa3(0x183)]||_0x324196[_0x21faa3(0x19a)]||_0x21faa3(0x1b6);console[_0x21faa3(0x19a)](_0x21faa3(0x1d4)),console[_0x21faa3(0x19a)]('Error\x20Message:',_0x57904c),loggerService_1[_0x21faa3(0x18f)]['logWhiteDomainError'](_0x21faa3(0x1eb),'/create','Business\x20Error:\x20'+_0x57904c);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x57904c);}if(!_0x324196[_0x21faa3(0x1b7)]||!_0x324196[_0x21faa3(0x203)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x21faa3(0x1f4)),console[_0x21faa3(0x19a)]('Response\x20data:',_0x324196),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x182)](_0x21faa3(0x1eb),'/create',_0x21faa3(0x1fb));throw new Error(_0x21faa3(0x1b8));}return console[_0x21faa3(0x1e5)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x21faa3(0x1e5)](_0x21faa3(0x1e6),_0x324196[_0x21faa3(0x203)]),console[_0x21faa3(0x1e5)]('Payment\x20URL:',_0x324196[_0x21faa3(0x1b7)]),console['log'](_0x21faa3(0x1d5),_0x4a6a82,_0x21faa3(0x191)),{'gateway_payment_id':_0x324196[_0x21faa3(0x203)],'payment_url':_0x324196['payment_url']};}catch(_0xb64239){console[_0x21faa3(0x19a)](_0x21faa3(0x17e)),console['error'](_0x21faa3(0x1d2),_0xb64239),loggerService_1[_0x21faa3(0x18f)][_0x21faa3(0x182)](_0x21faa3(0x1eb),'/create',_0xb64239);if(_0xb64239 instanceof Error){console[_0x21faa3(0x19a)](_0x21faa3(0x1d3),_0xb64239['message']),console[_0x21faa3(0x19a)](_0x21faa3(0x1b0),_0xb64239[_0x21faa3(0x1a7)]);throw new Error(_0x21faa3(0x1c6)+_0xb64239[_0x21faa3(0x183)]);}throw new Error(_0x21faa3(0x18b));}}async[a41_0x205e07(0x1ce)](_0x1f83b5){const _0x13d23f=a41_0x205e07,_0x1fe15c=Date[_0x13d23f(0x199)]();try{console[_0x13d23f(0x1e5)](_0x13d23f(0x1ff)+_0x1f83b5);const _0x5c8a4c={'gatewayPaymentId':_0x1f83b5};loggerService_1[_0x13d23f(0x18f)]['logWhiteDomainRequest'](_0x13d23f(0x1eb),_0x13d23f(0x193),_0x13d23f(0x17f),_0x5c8a4c);const _0x7e4296=await fetch(this[_0x13d23f(0x1f2)],{'method':_0x13d23f(0x17f),'headers':{'Content-Type':'application/json','Accept':_0x13d23f(0x1b1),'User-Agent':_0x13d23f(0x189)},'body':JSON[_0x13d23f(0x18d)](_0x5c8a4c)}),_0x4ee5da=Date[_0x13d23f(0x199)]()-_0x1fe15c;console['log'](_0x13d23f(0x1a6)),console[_0x13d23f(0x1e5)]('Status:',_0x7e4296[_0x13d23f(0x1d7)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x200),_0x4ee5da+'ms');if(!_0x7e4296['ok']){const _0x339e81=await _0x7e4296[_0x13d23f(0x1c4)]();console[_0x13d23f(0x19a)](_0x13d23f(0x1f5),_0x7e4296[_0x13d23f(0x1d7)]),console['error'](_0x13d23f(0x1a3),_0x339e81),loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x1b3)](_0x13d23f(0x1eb),_0x13d23f(0x193),_0x7e4296['status'],_0x339e81,_0x4ee5da),loggerService_1['loggerService'][_0x13d23f(0x182)]('cointopay','/status',_0x13d23f(0x1bf)+_0x7e4296['status']+':\x20'+_0x339e81);throw new Error(_0x13d23f(0x1bb)+_0x7e4296['status']);}const _0x398427=await _0x7e4296[_0x13d23f(0x1c4)]();console[_0x13d23f(0x1e5)]('Raw\x20Response\x20Body:',_0x398427);let _0x1ad406;try{_0x1ad406=JSON[_0x13d23f(0x1c9)](_0x398427);}catch(_0x517617){console['error'](_0x13d23f(0x1fe),_0x517617),loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x182)](_0x13d23f(0x1eb),_0x13d23f(0x193),_0x13d23f(0x17c)+_0x517617);throw new Error(_0x13d23f(0x198)+_0x398427);}loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x1b3)]('cointopay',_0x13d23f(0x193),_0x7e4296[_0x13d23f(0x1d7)],_0x1ad406,_0x4ee5da),console[_0x13d23f(0x1e5)](_0x13d23f(0x1c2)),console[_0x13d23f(0x1e5)]('Result:',_0x1ad406[_0x13d23f(0x1e7)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x1e3),_0x1ad406['status_code']),console[_0x13d23f(0x1e5)](_0x13d23f(0x1d0),_0x1ad406[_0x13d23f(0x180)]?.[_0x13d23f(0x1c7)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x1d5),_0x1ad406[_0x13d23f(0x180)]?.[_0x13d23f(0x1e2)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x1cd),_0x1ad406['data']?.[_0x13d23f(0x1f9)]);if(_0x1ad406[_0x13d23f(0x1e7)]!==_0x13d23f(0x1ee)||_0x1ad406[_0x13d23f(0x1aa)]!==0xc8){const _0x23805d=_0x1ad406[_0x13d23f(0x183)]||_0x13d23f(0x19d);console[_0x13d23f(0x19a)](_0x13d23f(0x1ac)),console['error'](_0x13d23f(0x205),_0x23805d),loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x182)](_0x13d23f(0x1eb),_0x13d23f(0x193),_0x13d23f(0x19c)+_0x23805d);throw new Error(_0x13d23f(0x1fd)+_0x23805d);}if(!_0x1ad406['data']){console['error'](_0x13d23f(0x1a4)),console['error'](_0x13d23f(0x1f7)),loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x182)](_0x13d23f(0x1eb),_0x13d23f(0x193),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x13d23f(0x1e8));}let _0x44cc51='PENDING';switch(_0x1ad406['data'][_0x13d23f(0x1c7)]?.[_0x13d23f(0x188)]()){case'paid':_0x44cc51=_0x13d23f(0x1cc);break;case'cancelled':case _0x13d23f(0x202):case'error':_0x44cc51=_0x13d23f(0x197);break;case'expired':case _0x13d23f(0x17d):_0x44cc51=_0x13d23f(0x185);break;case'waiting':case _0x13d23f(0x1f3):case _0x13d23f(0x18e):case'created':default:_0x44cc51=_0x13d23f(0x19b);break;}let _0x296230,_0x53ee36;if(_0x1ad406[_0x13d23f(0x180)]['PaymentDetail']){const _0x21a08c=_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1cb)];console['log'](_0x13d23f(0x1be),_0x21a08c);const _0x348427=_0x21a08c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x348427&&(_0x296230=_0x348427[0x1],console[_0x13d23f(0x1e5)](_0x13d23f(0x1ed),_0x296230)),_0x53ee36=_0x21a08c;}const _0x430f45={'iban':_0x296230,'bankDetails':_0x53ee36,'transactionId':_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1c0)],'coinAddress':_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1a9)],'qrCodeUrl':_0x1ad406[_0x13d23f(0x180)]['QRCodeURL'],'expiryTime':_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1df)],'createdOn':_0x1ad406['data']['CreatedOn'],'confirmedOn':_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1e0)]};console[_0x13d23f(0x1e5)](_0x13d23f(0x1ab)),console[_0x13d23f(0x1e5)]('Status:',_0x1ad406['data'][_0x13d23f(0x1c7)],'->',_0x44cc51),console[_0x13d23f(0x1e5)](_0x13d23f(0x1d5),_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1e2)],_0x1ad406['data'][_0x13d23f(0x1f9)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x1fc),_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1c0)]),console[_0x13d23f(0x1e5)](_0x13d23f(0x18a),_0x296230||_0x13d23f(0x1a0)),console[_0x13d23f(0x1e5)]('Created\x20On:',_0x1ad406[_0x13d23f(0x180)]['CreatedOn']),console[_0x13d23f(0x1e5)](_0x13d23f(0x19e),_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1e0)]||_0x13d23f(0x184));if(_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1c7)]?.[_0x13d23f(0x188)]()==='awaiting\x20fiat')console[_0x13d23f(0x1e5)](_0x13d23f(0x1d9));else _0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1c7)]?.[_0x13d23f(0x188)]()===_0x13d23f(0x18c)&&console[_0x13d23f(0x1e5)](_0x13d23f(0x1d6));return{'status':_0x44cc51,'amount':parseFloat(_0x1ad406[_0x13d23f(0x180)]['Amount'])||undefined,'currency':_0x1ad406[_0x13d23f(0x180)][_0x13d23f(0x1f9)]||_0x13d23f(0x191),'paymentDetails':_0x430f45};}catch(_0x5784f8){console[_0x13d23f(0x19a)](_0x13d23f(0x1ca),_0x5784f8),loggerService_1[_0x13d23f(0x18f)][_0x13d23f(0x182)](_0x13d23f(0x1eb),_0x13d23f(0x193),_0x5784f8);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x5784f8 instanceof Error?_0x5784f8[_0x13d23f(0x183)]:_0x13d23f(0x1db)));}}async[a41_0x205e07(0x195)](_0x22b9d6){const _0x329bd4=a41_0x205e07,_0x3c3769=await this[_0x329bd4(0x1ce)](_0x22b9d6);return{'status':_0x3c3769['status'],'amount':_0x3c3769[_0x329bd4(0x1de)],'currency':_0x3c3769[_0x329bd4(0x1af)]};}async['processWebhook'](_0x59e31f){const _0x4653e5=a41_0x205e07;console[_0x4653e5(0x1e5)](_0x4653e5(0x1bd),_0x59e31f);let _0x569b27=_0x4653e5(0x19b);switch(_0x59e31f[_0x4653e5(0x1d7)]?.[_0x4653e5(0x188)]()){case _0x4653e5(0x18c):_0x569b27=_0x4653e5(0x1cc);break;case'cancelled':case _0x4653e5(0x202):case _0x4653e5(0x19a):_0x569b27=_0x4653e5(0x197);break;case _0x4653e5(0x1a8):case _0x4653e5(0x17d):_0x569b27='EXPIRED';break;case'pending':case _0x4653e5(0x1d8):case'awaiting\x20fiat':case _0x4653e5(0x1a2):default:_0x569b27='PENDING';break;}return{'paymentId':_0x59e31f[_0x4653e5(0x1da)]||_0x59e31f[_0x4653e5(0x196)]||'','status':_0x569b27,'amount':_0x59e31f['amount'],'currency':_0x59e31f[_0x4653e5(0x1af)]||_0x4653e5(0x191)};}}exports[a41_0x205e07(0x1fa)]=CoinToPayService;function a41_0x1a10(){const _0x5d034e=['application/json','https://tesoft.uk/gateway/cointopay/status.php','logWhiteDomainResponse','Request\x20Body:','createPaymentLink','Unknown\x20error\x20from\x20CoinToPay\x20API','payment_url','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','42LLKhWt','defineProperty','HTTP\x20error!\x20status:\x20','5864115KDBfbg','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','🏦\x20Payment\x20Detail:','HTTP\x20','TransactionID','https://tesoft.uk/gateway/cointopay/','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','text','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Status','Status\x20Text:','parse','CoinToPay\x20payment\x20status\x20check\x20error:','PaymentDetail','PAID','Currency:','checkPaymentStatus','452SUIwKR','Payment\x20Status:','3791gCjQtS','Error\x20details:','Error\x20message:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Amount:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status','waiting','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','order_id','Unknown\x20error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','amount','ExpiryTime','TransactionConfirmedOn','apiUrl','Amount','Status\x20Code:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','log','Gateway\x20Payment\x20ID:','result','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','29487kWbBEi','fromEntries','cointopay','__esModule','🏦\x20Extracted\x20IBAN:','success','11umVfNu',',\x20body:\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20','statusUrl','awaiting\x20fiat','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20Status:','12020ZJfdgI','Missing\x20data\x20in\x20response','4943376OtIeUU','inputCurrency','CoinToPayService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Transaction\x20ID:','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Response\x20Time:','Raw\x20Response\x20Body:','failed','gateway_payment_id','6031548naTMSU','Error\x20Message:','JSON\x20Parse\x20Error:\x20','timeout','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','POST','data','Headers:','logWhiteDomainError','message','not\x20confirmed','EXPIRED','\x20EUR','logWhiteDomainRequest','toLowerCase','TesSoft\x20Payment\x20System/1.0','IBAN:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','paid','stringify','pending','loggerService','URL:','EUR','254gtZeGv','/status','1081542JFhrdT','verifyPayment','merchant_reference_id','FAILED','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','now','error','PENDING','Status\x20API\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Confirmed\x20On:','27XjVvMG','not\x20found','📊\x20Status\x20check\x20URL:','created','Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','stack','expired','coinAddress','status_code','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Status:','/create','currency','Error\x20stack:'];a41_0x1a10=function(){return _0x5d034e;};return a41_0x1a10();}