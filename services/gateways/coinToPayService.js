'use strict';const a40_0xcce6a1=a40_0x3716;(function(_0x50e542,_0x18ee0b){const _0x35d286=a40_0x3716,_0x56b13b=_0x50e542();while(!![]){try{const _0x24a737=-parseInt(_0x35d286(0x171))/0x1+-parseInt(_0x35d286(0x156))/0x2*(parseInt(_0x35d286(0x136))/0x3)+-parseInt(_0x35d286(0x10d))/0x4+-parseInt(_0x35d286(0x134))/0x5*(-parseInt(_0x35d286(0x14e))/0x6)+-parseInt(_0x35d286(0x141))/0x7*(parseInt(_0x35d286(0x15e))/0x8)+parseInt(_0x35d286(0x13b))/0x9*(parseInt(_0x35d286(0x123))/0xa)+parseInt(_0x35d286(0x17b))/0xb;if(_0x24a737===_0x18ee0b)break;else _0x56b13b['push'](_0x56b13b['shift']());}catch(_0x3c7bb0){_0x56b13b['push'](_0x56b13b['shift']());}}}(a40_0x1b52,0xb858a));function a40_0x3716(_0x3cc2fa,_0x3bcd6a){const _0x1b52a4=a40_0x1b52();return a40_0x3716=function(_0x37160a,_0x24f56a){_0x37160a=_0x37160a-0x10b;let _0x69d535=_0x1b52a4[_0x37160a];return _0x69d535;},a40_0x3716(_0x3cc2fa,_0x3bcd6a);}Object['defineProperty'](exports,a40_0xcce6a1(0x130),{'value':!![]}),exports[a40_0xcce6a1(0x127)]=void 0x0;const loggerService_1=require(a40_0xcce6a1(0x10c));class CoinToPayService{constructor(){const _0x557af5=a40_0xcce6a1;this[_0x557af5(0x15c)]=_0x557af5(0x14d),this[_0x557af5(0x13f)]=_0x557af5(0x121),console[_0x557af5(0x18a)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x557af5(0x18a)](_0x557af5(0x11c),this[_0x557af5(0x13f)]);}async['createPaymentLink'](_0x3e6dae){const _0x3bacde=a40_0xcce6a1,{orderId:_0x473584,amount:_0x41bdb6}=_0x3e6dae;console['log']('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x41bdb6+_0x3bacde(0x167));const _0xb04f86={'amount':_0x41bdb6},_0x31847f=Date[_0x3bacde(0x188)]();try{console[_0x3bacde(0x18a)](_0x3bacde(0x151)),console[_0x3bacde(0x18a)]('URL:',this[_0x3bacde(0x15c)]),console[_0x3bacde(0x18a)]('Request\x20Body:',JSON[_0x3bacde(0x118)](_0xb04f86,null,0x2)),console[_0x3bacde(0x18a)](_0x3bacde(0x176),_0x41bdb6,_0x3bacde(0x163)),loggerService_1[_0x3bacde(0x13a)]['logWhiteDomainRequest']('cointopay',_0x3bacde(0x183),'POST',_0xb04f86);const _0x3b7741=await fetch(this[_0x3bacde(0x15c)],{'method':_0x3bacde(0x16a),'headers':{'Content-Type':_0x3bacde(0x17f),'Accept':'application/json','User-Agent':_0x3bacde(0x159)},'body':JSON[_0x3bacde(0x118)](_0xb04f86)}),_0x2349cc=Date[_0x3bacde(0x188)]()-_0x31847f;console[_0x3bacde(0x18a)](_0x3bacde(0x172)),console[_0x3bacde(0x18a)](_0x3bacde(0x13e),_0x3b7741[_0x3bacde(0x11e)]),console['log'](_0x3bacde(0x14b),_0x3b7741[_0x3bacde(0x155)]),console['log']('Headers:',Object['fromEntries'](_0x3b7741[_0x3bacde(0x14a)][_0x3bacde(0x13c)]())),console[_0x3bacde(0x18a)](_0x3bacde(0x187),_0x2349cc+'ms');const _0x267650=await _0x3b7741[_0x3bacde(0x16b)]();console[_0x3bacde(0x18a)](_0x3bacde(0x131),_0x267650);if(!_0x3b7741['ok']){console[_0x3bacde(0x147)](_0x3bacde(0x117)),console[_0x3bacde(0x147)](_0x3bacde(0x17c),_0x3b7741[_0x3bacde(0x11e)]),console[_0x3bacde(0x147)](_0x3bacde(0x17a),_0x267650),loggerService_1[_0x3bacde(0x13a)][_0x3bacde(0x160)](_0x3bacde(0x11f),_0x3bacde(0x183),_0x3b7741['status'],_0x267650,_0x2349cc),loggerService_1['loggerService']['logWhiteDomainError'](_0x3bacde(0x11f),_0x3bacde(0x183),_0x3bacde(0x113)+_0x3b7741['status']+':\x20'+_0x267650);throw new Error(_0x3bacde(0x178)+_0x3b7741[_0x3bacde(0x11e)]+_0x3bacde(0x16c)+_0x267650);}let _0x1393b8;try{_0x1393b8=JSON['parse'](_0x267650);}catch(_0x4f2bb1){console[_0x3bacde(0x147)](_0x3bacde(0x165),_0x4f2bb1),loggerService_1[_0x3bacde(0x13a)][_0x3bacde(0x12c)](_0x3bacde(0x11f),'/create',_0x3bacde(0x145)+_0x4f2bb1);throw new Error(_0x3bacde(0x14f)+_0x267650);}console[_0x3bacde(0x18a)](_0x3bacde(0x12d)),console['log'](_0x3bacde(0x164),JSON['stringify'](_0x1393b8,null,0x2)),loggerService_1['loggerService'][_0x3bacde(0x160)](_0x3bacde(0x11f),'/create',_0x3b7741[_0x3bacde(0x11e)],_0x1393b8,_0x2349cc);if(_0x1393b8[_0x3bacde(0x147)]){const _0x373e0e=_0x1393b8[_0x3bacde(0x185)]||_0x1393b8[_0x3bacde(0x147)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x3bacde(0x114)),console['error'](_0x3bacde(0x144),_0x373e0e),loggerService_1[_0x3bacde(0x13a)][_0x3bacde(0x12c)](_0x3bacde(0x11f),_0x3bacde(0x183),'Business\x20Error:\x20'+_0x373e0e);throw new Error(_0x3bacde(0x18d)+_0x373e0e);}if(!_0x1393b8[_0x3bacde(0x18c)]||!_0x1393b8[_0x3bacde(0x152)]){console[_0x3bacde(0x147)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x3bacde(0x147)]('Response\x20data:',_0x1393b8),loggerService_1[_0x3bacde(0x13a)][_0x3bacde(0x12c)](_0x3bacde(0x11f),_0x3bacde(0x183),_0x3bacde(0x12b));throw new Error(_0x3bacde(0x122));}return console[_0x3bacde(0x18a)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x3bacde(0x18a)](_0x3bacde(0x16e),_0x1393b8[_0x3bacde(0x152)]),console[_0x3bacde(0x18a)](_0x3bacde(0x186),_0x1393b8[_0x3bacde(0x18c)]),console[_0x3bacde(0x18a)]('Amount:',_0x41bdb6,_0x3bacde(0x12a)),{'gateway_payment_id':_0x1393b8[_0x3bacde(0x152)],'payment_url':_0x1393b8[_0x3bacde(0x18c)]};}catch(_0x5cf35f){console[_0x3bacde(0x147)](_0x3bacde(0x174)),console[_0x3bacde(0x147)]('Error\x20details:',_0x5cf35f),loggerService_1['loggerService'][_0x3bacde(0x12c)]('cointopay','/create',_0x5cf35f);if(_0x5cf35f instanceof Error){console['error'](_0x3bacde(0x170),_0x5cf35f[_0x3bacde(0x185)]),console[_0x3bacde(0x147)](_0x3bacde(0x179),_0x5cf35f[_0x3bacde(0x169)]);throw new Error(_0x3bacde(0x110)+_0x5cf35f[_0x3bacde(0x185)]);}throw new Error(_0x3bacde(0x139));}}async[a40_0xcce6a1(0x168)](_0x43a613){const _0x1083ae=a40_0xcce6a1,_0x6f148d=Date[_0x1083ae(0x188)]();try{console[_0x1083ae(0x18a)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x43a613);const _0x5d851c={'gatewayPaymentId':_0x43a613};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay','/status',_0x1083ae(0x16a),_0x5d851c);const _0x48dcb1=await fetch(this[_0x1083ae(0x13f)],{'method':_0x1083ae(0x16a),'headers':{'Content-Type':_0x1083ae(0x17f),'Accept':'application/json','User-Agent':_0x1083ae(0x159)},'body':JSON[_0x1083ae(0x118)](_0x5d851c)}),_0x403345=Date[_0x1083ae(0x188)]()-_0x6f148d;console['log'](_0x1083ae(0x12e)),console[_0x1083ae(0x18a)](_0x1083ae(0x13e),_0x48dcb1['status']),console[_0x1083ae(0x18a)](_0x1083ae(0x187),_0x403345+'ms');if(!_0x48dcb1['ok']){const _0x141020=await _0x48dcb1['text']();console[_0x1083ae(0x147)](_0x1083ae(0x17c),_0x48dcb1[_0x1083ae(0x11e)]),console['error'](_0x1083ae(0x17a),_0x141020),loggerService_1[_0x1083ae(0x13a)]['logWhiteDomainResponse'](_0x1083ae(0x11f),'/status',_0x48dcb1[_0x1083ae(0x11e)],_0x141020,_0x403345),loggerService_1['loggerService'][_0x1083ae(0x12c)](_0x1083ae(0x11f),_0x1083ae(0x158),'HTTP\x20'+_0x48dcb1[_0x1083ae(0x11e)]+':\x20'+_0x141020);throw new Error(_0x1083ae(0x178)+_0x48dcb1[_0x1083ae(0x11e)]);}const _0x2ef61a=await _0x48dcb1[_0x1083ae(0x16b)]();console[_0x1083ae(0x18a)]('Raw\x20Response\x20Body:',_0x2ef61a);let _0x3985b5;try{_0x3985b5=JSON[_0x1083ae(0x161)](_0x2ef61a);}catch(_0x2e0cb0){console[_0x1083ae(0x147)](_0x1083ae(0x165),_0x2e0cb0),loggerService_1[_0x1083ae(0x13a)][_0x1083ae(0x12c)]('cointopay','/status',_0x1083ae(0x145)+_0x2e0cb0);throw new Error(_0x1083ae(0x126)+_0x2ef61a);}loggerService_1[_0x1083ae(0x13a)][_0x1083ae(0x160)](_0x1083ae(0x11f),_0x1083ae(0x158),_0x48dcb1[_0x1083ae(0x11e)],_0x3985b5,_0x403345),console['log'](_0x1083ae(0x12f)),console[_0x1083ae(0x18a)](_0x1083ae(0x157),_0x3985b5[_0x1083ae(0x166)]),console['log']('Status\x20Code:',_0x3985b5['status_code']),console[_0x1083ae(0x18a)](_0x1083ae(0x111),_0x3985b5['data']?.['Status']),console[_0x1083ae(0x18a)](_0x1083ae(0x176),_0x3985b5[_0x1083ae(0x10e)]?.[_0x1083ae(0x189)]),console[_0x1083ae(0x18a)](_0x1083ae(0x15f),_0x3985b5[_0x1083ae(0x10e)]?.[_0x1083ae(0x11d)]);if(_0x3985b5['result']!==_0x1083ae(0x180)||_0x3985b5[_0x1083ae(0x17d)]!==0xc8){const _0x3c0767=_0x3985b5[_0x1083ae(0x185)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x1083ae(0x147)](_0x1083ae(0x11b)),console['error'](_0x1083ae(0x144),_0x3c0767),loggerService_1[_0x1083ae(0x13a)]['logWhiteDomainError'](_0x1083ae(0x11f),_0x1083ae(0x158),_0x1083ae(0x132)+_0x3c0767);throw new Error(_0x1083ae(0x173)+_0x3c0767);}if(!_0x3985b5[_0x1083ae(0x10e)]){console[_0x1083ae(0x147)](_0x1083ae(0x154)),console[_0x1083ae(0x147)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x1083ae(0x12c)]('cointopay',_0x1083ae(0x158),_0x1083ae(0x128));throw new Error(_0x1083ae(0x18f));}let _0x19eec8=_0x1083ae(0x10b);switch(_0x3985b5['data'][_0x1083ae(0x14c)]?.['toLowerCase']()){case _0x1083ae(0x16f):_0x19eec8='PAID';break;case _0x1083ae(0x162):case _0x1083ae(0x182):case _0x1083ae(0x147):_0x19eec8=_0x1083ae(0x129);break;case _0x1083ae(0x15d):case _0x1083ae(0x149):_0x19eec8=_0x1083ae(0x143);break;case _0x1083ae(0x175):case'awaiting\x20fiat':case'pending':case _0x1083ae(0x140):default:_0x19eec8='PENDING';break;}let _0x352070,_0x5f0997;if(_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x18b)]){const _0x3eb66b=_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x18b)];console['log'](_0x1083ae(0x133),_0x3eb66b);const _0x54b503=_0x3eb66b[_0x1083ae(0x16d)](/IBAN\s+([A-Z0-9]+)/i);_0x54b503&&(_0x352070=_0x54b503[0x1],console[_0x1083ae(0x18a)](_0x1083ae(0x112),_0x352070)),_0x5f0997=_0x3eb66b;}const _0x13c112={'iban':_0x352070,'bankDetails':_0x5f0997,'transactionId':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x15a)],'coinAddress':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x10f)],'qrCodeUrl':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x177)],'expiryTime':_0x3985b5['data']['ExpiryTime'],'createdOn':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x153)],'confirmedOn':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x181)]};console['log'](_0x1083ae(0x116)),console[_0x1083ae(0x18a)]('Status:',_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x14c)],'->',_0x19eec8),console[_0x1083ae(0x18a)]('Amount:',_0x3985b5['data'][_0x1083ae(0x189)],_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x11d)]),console[_0x1083ae(0x18a)](_0x1083ae(0x120),_0x3985b5[_0x1083ae(0x10e)]['TransactionID']),console[_0x1083ae(0x18a)](_0x1083ae(0x137),_0x352070||_0x1083ae(0x18e)),console[_0x1083ae(0x18a)](_0x1083ae(0x138),_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x153)]),console[_0x1083ae(0x18a)](_0x1083ae(0x15b),_0x3985b5['data'][_0x1083ae(0x181)]||'not\x20confirmed');if(_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x14c)]?.['toLowerCase']()===_0x1083ae(0x150))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x14c)]?.[_0x1083ae(0x125)]()===_0x1083ae(0x16f)&&console[_0x1083ae(0x18a)](_0x1083ae(0x119));return{'status':_0x19eec8,'amount':parseFloat(_0x3985b5['data'][_0x1083ae(0x189)])||undefined,'currency':_0x3985b5[_0x1083ae(0x10e)][_0x1083ae(0x11d)]||_0x1083ae(0x12a),'paymentDetails':_0x13c112};}catch(_0xc28b7c){console[_0x1083ae(0x147)](_0x1083ae(0x148),_0xc28b7c),loggerService_1[_0x1083ae(0x13a)][_0x1083ae(0x12c)]('cointopay',_0x1083ae(0x158),_0xc28b7c);throw new Error(_0x1083ae(0x184)+(_0xc28b7c instanceof Error?_0xc28b7c['message']:_0x1083ae(0x135)));}}async[a40_0xcce6a1(0x11a)](_0x45188a){const _0x5bc7cf=a40_0xcce6a1,_0xe2e63b=await this[_0x5bc7cf(0x168)](_0x45188a);return{'status':_0xe2e63b['status'],'amount':_0xe2e63b[_0x5bc7cf(0x142)],'currency':_0xe2e63b[_0x5bc7cf(0x146)]};}async[a40_0xcce6a1(0x124)](_0x542bea){const _0x5afdf4=a40_0xcce6a1;console[_0x5afdf4(0x18a)](_0x5afdf4(0x17e),_0x542bea);let _0x1c65e7=_0x5afdf4(0x10b);switch(_0x542bea[_0x5afdf4(0x11e)]?.['toLowerCase']()){case _0x5afdf4(0x16f):_0x1c65e7='PAID';break;case'cancelled':case _0x5afdf4(0x182):case _0x5afdf4(0x147):_0x1c65e7=_0x5afdf4(0x129);break;case'expired':case'timeout':_0x1c65e7=_0x5afdf4(0x143);break;case _0x5afdf4(0x13d):case _0x5afdf4(0x175):case _0x5afdf4(0x150):case _0x5afdf4(0x140):default:_0x1c65e7='PENDING';break;}return{'paymentId':_0x542bea['order_id']||_0x542bea[_0x5afdf4(0x115)]||'','status':_0x1c65e7,'amount':_0x542bea['amount'],'currency':_0x542bea[_0x5afdf4(0x146)]||_0x5afdf4(0x12a)};}}function a40_0x1b52(){const _0x136a46=['381BnyXaN','IBAN:','Created\x20On:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','loggerService','896598jaVUYk','entries','pending','Status:','statusUrl','created','4166946xJWWar','amount','EXPIRED','Error\x20Message:','JSON\x20Parse\x20Error:\x20','currency','error','CoinToPay\x20payment\x20status\x20check\x20error:','timeout','headers','Status\x20Text:','Status','https://tesoft.uk/gateway/cointopay/','98466UbLUbZ','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','gateway_payment_id','CreatedOn','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusText','18294JKtDyd','Result:','/status','TesSoft\x20Payment\x20System/1.0','TransactionID','Confirmed\x20On:','apiUrl','expired','16snFxdE','Currency:','logWhiteDomainResponse','parse','cancelled','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','result','\x20EUR','checkPaymentStatus','stack','POST','text',',\x20body:\x20','match','Gateway\x20Payment\x20ID:','paid','Error\x20message:','398431cCWELv','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','waiting','Amount:','QRCodeURL','HTTP\x20error!\x20status:\x20','Error\x20stack:','Response\x20Body:','35133846itrFbl','HTTP\x20Status:','status_code','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','application/json','success','TransactionConfirmedOn','failed','/create','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','message','Payment\x20URL:','Response\x20Time:','now','Amount','log','PaymentDetail','payment_url','CoinToPay\x20API\x20error:\x20','not\x20found','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','PENDING','../loggerService','4084028HvfVnl','data','coinAddress','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Payment\x20Status:','🏦\x20Extracted\x20IBAN:','HTTP\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','stringify','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','verifyPayment','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','📊\x20Status\x20check\x20URL:','inputCurrency','status','cointopay','Transaction\x20ID:','https://tesoft.uk/gateway/cointopay/status.php','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','30Fahgww','processWebhook','toLowerCase','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','CoinToPayService','Incomplete\x20response:\x20missing\x20data','FAILED','EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainError','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','__esModule','Raw\x20Response\x20Body:','Status\x20API\x20Error:\x20','🏦\x20Payment\x20Detail:','315CmSQWA','Unknown\x20error'];a40_0x1b52=function(){return _0x136a46;};return a40_0x1b52();}exports[a40_0xcce6a1(0x127)]=CoinToPayService;