'use strict';function a41_0x50db(){const _0x4e3247=['Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','paid','IBAN:','order_id','POST','not\x20confirmed','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Gateway\x20Payment\x20ID:','stringify','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','EXPIRED','Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','Result:','Status\x20Text:','text','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','TransactionID','Error\x20Message:','defineProperty','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','JSON\x20Parse\x20Error:\x20','checkPaymentStatus','Amount:',',\x20body:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Response\x20data:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','CoinToPay\x20status\x20API\x20error:\x20','3622536QzTXnq','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','fromEntries','logWhiteDomainRequest','CoinToPayService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','message','Status\x20Code:','gateway_payment_id','QRCodeURL','cointopay','processWebhook','failed','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Headers:','verifyPayment','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','loggerService','created','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Business\x20Error:\x20','Status:','FAILED','error','URL:','Status\x20API\x20Error:\x20','expired','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Time:','HTTP\x20','pending','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','PAID','3215MZNdPm','\x20EUR','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','data','Missing\x20data\x20in\x20response','toLowerCase','logWhiteDomainResponse','1748wPFkuE','https://tesoft.uk/gateway/cointopay/status.php','logWhiteDomainError','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Created\x20On:','üè¶\x20Extracted\x20IBAN:','payment_url','status','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Payment\x20Status:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','success','CreatedOn','/status','Currency:','cancelled','218792rKmzmn','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','match','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Incomplete\x20response:\x20missing\x20data','/create','coinAddress','542905LGUYkD','statusUrl','Confirmed\x20On:','https://tesoft.uk/gateway/cointopay/','Error\x20stack:','Payment\x20URL:','amount','currency','üè¶\x20Payment\x20Detail:','../loggerService','status_code','log','inputCurrency','1602210YiAACy','EUR','Amount','entries','parse','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ExpiryTime','PENDING','TesSoft\x20Payment\x20System/1.0','üìä\x20Status\x20check\x20URL:','3qWQacJ','apiUrl','CoinToPay\x20payment\x20status\x20check\x20error:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','awaiting\x20fiat','Error\x20message:','Transaction\x20ID:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','952420wFsOcy','PaymentDetail','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','application/json','Raw\x20Response\x20Body:','901302hmtYIP'];a41_0x50db=function(){return _0x4e3247;};return a41_0x50db();}const a41_0x1110d9=a41_0x44e8;(function(_0xe292ef,_0x3a6864){const _0x10eef4=a41_0x44e8,_0x58bd9d=_0xe292ef();while(!![]){try{const _0x3f973d=-parseInt(_0x10eef4(0x112))/0x1+-parseInt(_0x10eef4(0x138))/0x2*(-parseInt(_0x10eef4(0x12b))/0x3)+parseInt(_0x10eef4(0xfa))/0x4*(parseInt(_0x10eef4(0xf2))/0x5)+-parseInt(_0x10eef4(0x11f))/0x6+parseInt(_0x10eef4(0x133))/0x7+-parseInt(_0x10eef4(0x10b))/0x8+parseInt(_0x10eef4(0xcf))/0x9;if(_0x3f973d===_0x3a6864)break;else _0x58bd9d['push'](_0x58bd9d['shift']());}catch(_0xe98a1a){_0x58bd9d['push'](_0x58bd9d['shift']());}}}(a41_0x50db,0x69b15));Object[a41_0x1110d9(0xc5)](exports,'__esModule',{'value':!![]}),exports[a41_0x1110d9(0xd3)]=void 0x0;function a41_0x44e8(_0x45b6e6,_0x1fbe9f){const _0x50db52=a41_0x50db();return a41_0x44e8=function(_0x44e8ee,_0x400497){_0x44e8ee=_0x44e8ee-0xb4;let _0x2c6342=_0x50db52[_0x44e8ee];return _0x2c6342;},a41_0x44e8(_0x45b6e6,_0x1fbe9f);}const loggerService_1=require(a41_0x1110d9(0x11b));class CoinToPayService{constructor(){const _0x507cc1=a41_0x1110d9;this['apiUrl']=_0x507cc1(0x115),this[_0x507cc1(0x113)]=_0x507cc1(0xfb),console[_0x507cc1(0x11d)](_0x507cc1(0x125)),console[_0x507cc1(0x11d)](_0x507cc1(0x12a),this[_0x507cc1(0x113)]);}async['createPaymentLink'](_0x582c2f){const _0x9f51c0=a41_0x1110d9,{orderId:_0x519549,amount:_0x5ccca0}=_0x582c2f;console[_0x9f51c0(0x11d)](_0x9f51c0(0xcb)+_0x5ccca0+_0x9f51c0(0xf3));const _0x15a8fd={'amount':_0x5ccca0},_0x917a09=Date[_0x9f51c0(0xf5)]();try{console[_0x9f51c0(0x11d)](_0x9f51c0(0x135)),console['log'](_0x9f51c0(0xe8),this[_0x9f51c0(0x12c)]),console[_0x9f51c0(0x11d)]('Request\x20Body:',JSON[_0x9f51c0(0xb9)](_0x15a8fd,null,0x2)),console[_0x9f51c0(0x11d)](_0x9f51c0(0xc9),_0x5ccca0,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x9f51c0(0xe1)][_0x9f51c0(0xd2)](_0x9f51c0(0xd9),_0x9f51c0(0x110),_0x9f51c0(0xb5),_0x15a8fd);const _0xbdbd05=await fetch(this[_0x9f51c0(0x12c)],{'method':_0x9f51c0(0xb5),'headers':{'Content-Type':_0x9f51c0(0x136),'Accept':'application/json','User-Agent':_0x9f51c0(0x129)},'body':JSON[_0x9f51c0(0xb9)](_0x15a8fd)}),_0x152422=Date['now']()-_0x917a09;console[_0x9f51c0(0x11d)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x9f51c0(0x11d)]('Status:',_0xbdbd05[_0x9f51c0(0x101)]),console[_0x9f51c0(0x11d)](_0x9f51c0(0xc0),_0xbdbd05['statusText']),console[_0x9f51c0(0x11d)](_0x9f51c0(0xdd),Object[_0x9f51c0(0xd1)](_0xbdbd05['headers'][_0x9f51c0(0x122)]())),console['log']('Response\x20Time:',_0x152422+'ms');const _0x3ebba0=await _0xbdbd05['text']();console['log'](_0x9f51c0(0x137),_0x3ebba0);if(!_0xbdbd05['ok']){console[_0x9f51c0(0xe7)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x9f51c0(0xe7)]('HTTP\x20Status:',_0xbdbd05['status']),console['error']('Response\x20Body:',_0x3ebba0),loggerService_1[_0x9f51c0(0xe1)][_0x9f51c0(0xf9)](_0x9f51c0(0xd9),_0x9f51c0(0x110),_0xbdbd05[_0x9f51c0(0x101)],_0x3ebba0,_0x152422),loggerService_1[_0x9f51c0(0xe1)][_0x9f51c0(0xfc)](_0x9f51c0(0xd9),_0x9f51c0(0x110),'HTTP\x20'+_0xbdbd05[_0x9f51c0(0x101)]+':\x20'+_0x3ebba0);throw new Error(_0x9f51c0(0xdf)+_0xbdbd05[_0x9f51c0(0x101)]+_0x9f51c0(0xca)+_0x3ebba0);}let _0x780045;try{_0x780045=JSON[_0x9f51c0(0x123)](_0x3ebba0);}catch(_0x1bfb6d){console[_0x9f51c0(0xe7)](_0x9f51c0(0xbe),_0x1bfb6d),loggerService_1['loggerService'][_0x9f51c0(0xfc)](_0x9f51c0(0xd9),_0x9f51c0(0x110),'JSON\x20Parse\x20Error:\x20'+_0x1bfb6d);throw new Error(_0x9f51c0(0xd0)+_0x3ebba0);}console[_0x9f51c0(0x11d)](_0x9f51c0(0x132)),console['log']('Parsed\x20Result:',JSON[_0x9f51c0(0xb9)](_0x780045,null,0x2)),loggerService_1['loggerService'][_0x9f51c0(0xf9)](_0x9f51c0(0xd9),_0x9f51c0(0x110),_0xbdbd05[_0x9f51c0(0x101)],_0x780045,_0x152422);if(_0x780045[_0x9f51c0(0xe7)]){const _0xf5c15=_0x780045[_0x9f51c0(0xd5)]||_0x780045[_0x9f51c0(0xe7)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x9f51c0(0xe7)](_0x9f51c0(0xb7)),console[_0x9f51c0(0xe7)](_0x9f51c0(0xc4),_0xf5c15),loggerService_1[_0x9f51c0(0xe1)][_0x9f51c0(0xfc)](_0x9f51c0(0xd9),_0x9f51c0(0x110),_0x9f51c0(0xe4)+_0xf5c15);throw new Error(_0x9f51c0(0xef)+_0xf5c15);}if(!_0x780045['payment_url']||!_0x780045[_0x9f51c0(0xd7)]){console[_0x9f51c0(0xe7)](_0x9f51c0(0x104)),console['error'](_0x9f51c0(0x126)),console[_0x9f51c0(0xe7)](_0x9f51c0(0xcc),_0x780045),loggerService_1[_0x9f51c0(0xe1)][_0x9f51c0(0xfc)]('cointopay','/create',_0x9f51c0(0x10e));throw new Error(_0x9f51c0(0xc6));}return console[_0x9f51c0(0x11d)](_0x9f51c0(0xf0)),console[_0x9f51c0(0x11d)](_0x9f51c0(0xb8),_0x780045[_0x9f51c0(0xd7)]),console[_0x9f51c0(0x11d)](_0x9f51c0(0x117),_0x780045[_0x9f51c0(0x100)]),console['log'](_0x9f51c0(0xc9),_0x5ccca0,_0x9f51c0(0x120)),{'gateway_payment_id':_0x780045[_0x9f51c0(0xd7)],'payment_url':_0x780045[_0x9f51c0(0x100)]};}catch(_0x3be7e2){console[_0x9f51c0(0xe7)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x9f51c0(0xe7)]('Error\x20details:',_0x3be7e2),loggerService_1[_0x9f51c0(0xe1)]['logWhiteDomainError'](_0x9f51c0(0xd9),'/create',_0x3be7e2);if(_0x3be7e2 instanceof Error){console['error'](_0x9f51c0(0x130),_0x3be7e2['message']),console['error'](_0x9f51c0(0x116),_0x3be7e2['stack']);throw new Error(_0x9f51c0(0x139)+_0x3be7e2[_0x9f51c0(0xd5)]);}throw new Error(_0x9f51c0(0xd4));}}async['checkPaymentStatus'](_0x65d1ac){const _0x47eeb2=a41_0x1110d9,_0x519789=Date[_0x47eeb2(0xf5)]();try{console[_0x47eeb2(0x11d)](_0x47eeb2(0xcd)+_0x65d1ac);const _0x1de802={'gatewayPaymentId':_0x65d1ac};loggerService_1['loggerService'][_0x47eeb2(0xd2)](_0x47eeb2(0xd9),_0x47eeb2(0x108),'POST',_0x1de802);const _0x206b2b=await fetch(this['statusUrl'],{'method':_0x47eeb2(0xb5),'headers':{'Content-Type':_0x47eeb2(0x136),'Accept':_0x47eeb2(0x136),'User-Agent':_0x47eeb2(0x129)},'body':JSON[_0x47eeb2(0xb9)](_0x1de802)}),_0x1f57f1=Date[_0x47eeb2(0xf5)]()-_0x519789;console[_0x47eeb2(0x11d)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x47eeb2(0x11d)](_0x47eeb2(0xe5),_0x206b2b[_0x47eeb2(0x101)]),console[_0x47eeb2(0x11d)](_0x47eeb2(0xec),_0x1f57f1+'ms');if(!_0x206b2b['ok']){const _0x20f834=await _0x206b2b[_0x47eeb2(0xc1)]();console[_0x47eeb2(0xe7)](_0x47eeb2(0xe0),_0x206b2b[_0x47eeb2(0x101)]),console['error']('Response\x20Body:',_0x20f834),loggerService_1[_0x47eeb2(0xe1)][_0x47eeb2(0xf9)](_0x47eeb2(0xd9),_0x47eeb2(0x108),_0x206b2b['status'],_0x20f834,_0x1f57f1),loggerService_1['loggerService']['logWhiteDomainError'](_0x47eeb2(0xd9),_0x47eeb2(0x108),_0x47eeb2(0xed)+_0x206b2b[_0x47eeb2(0x101)]+':\x20'+_0x20f834);throw new Error(_0x47eeb2(0xdf)+_0x206b2b[_0x47eeb2(0x101)]);}const _0x2800a6=await _0x206b2b[_0x47eeb2(0xc1)]();console[_0x47eeb2(0x11d)]('Raw\x20Response\x20Body:',_0x2800a6);let _0x42ee3f;try{_0x42ee3f=JSON[_0x47eeb2(0x123)](_0x2800a6);}catch(_0x577f9c){console[_0x47eeb2(0xe7)](_0x47eeb2(0xbe),_0x577f9c),loggerService_1['loggerService'][_0x47eeb2(0xfc)]('cointopay',_0x47eeb2(0x108),_0x47eeb2(0xc7)+_0x577f9c);throw new Error(_0x47eeb2(0x10c)+_0x2800a6);}loggerService_1[_0x47eeb2(0xe1)][_0x47eeb2(0xf9)](_0x47eeb2(0xd9),_0x47eeb2(0x108),_0x206b2b['status'],_0x42ee3f,_0x1f57f1),console[_0x47eeb2(0x11d)](_0x47eeb2(0xc2)),console[_0x47eeb2(0x11d)](_0x47eeb2(0xbf),_0x42ee3f['result']),console[_0x47eeb2(0x11d)](_0x47eeb2(0xd6),_0x42ee3f[_0x47eeb2(0x11c)]),console[_0x47eeb2(0x11d)](_0x47eeb2(0x103),_0x42ee3f['data']?.[_0x47eeb2(0x105)]),console[_0x47eeb2(0x11d)](_0x47eeb2(0xc9),_0x42ee3f[_0x47eeb2(0xf6)]?.[_0x47eeb2(0x121)]),console[_0x47eeb2(0x11d)](_0x47eeb2(0x109),_0x42ee3f[_0x47eeb2(0xf6)]?.[_0x47eeb2(0x11e)]);if(_0x42ee3f['result']!==_0x47eeb2(0x106)||_0x42ee3f[_0x47eeb2(0x11c)]!==0xc8){const _0x1e6524=_0x42ee3f[_0x47eeb2(0xd5)]||_0x47eeb2(0xeb);console[_0x47eeb2(0xe7)](_0x47eeb2(0xbb)),console[_0x47eeb2(0xe7)](_0x47eeb2(0xc4),_0x1e6524),loggerService_1['loggerService'][_0x47eeb2(0xfc)](_0x47eeb2(0xd9),_0x47eeb2(0x108),_0x47eeb2(0xe9)+_0x1e6524);throw new Error(_0x47eeb2(0xce)+_0x1e6524);}if(!_0x42ee3f[_0x47eeb2(0xf6)]){console[_0x47eeb2(0xe7)](_0x47eeb2(0xf4)),console[_0x47eeb2(0xe7)](_0x47eeb2(0xf7)),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x47eeb2(0x108),_0x47eeb2(0x10f));throw new Error(_0x47eeb2(0x102));}let _0x5b1c56=_0x47eeb2(0x128);switch(_0x42ee3f[_0x47eeb2(0xf6)]['Status']?.[_0x47eeb2(0xf8)]()){case _0x47eeb2(0x13a):_0x5b1c56=_0x47eeb2(0xf1);break;case _0x47eeb2(0x10a):case _0x47eeb2(0xdb):case _0x47eeb2(0xe7):_0x5b1c56=_0x47eeb2(0xe6);break;case'expired':case'timeout':_0x5b1c56=_0x47eeb2(0xbc);break;case'waiting':case _0x47eeb2(0x12f):case'pending':case _0x47eeb2(0xe2):default:_0x5b1c56=_0x47eeb2(0x128);break;}let _0x5c0d6e,_0x1d3001;if(_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x134)]){const _0x29bc80=_0x42ee3f['data'][_0x47eeb2(0x134)];console['log'](_0x47eeb2(0x11a),_0x29bc80);const _0x1814d5=_0x29bc80[_0x47eeb2(0x10d)](/IBAN\s+([A-Z0-9]+)/i);_0x1814d5&&(_0x5c0d6e=_0x1814d5[0x1],console['log'](_0x47eeb2(0xff),_0x5c0d6e)),_0x1d3001=_0x29bc80;}const _0x591f9a={'iban':_0x5c0d6e,'bankDetails':_0x1d3001,'transactionId':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0xc3)],'coinAddress':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x111)],'qrCodeUrl':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0xd8)],'expiryTime':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x127)],'createdOn':_0x42ee3f['data'][_0x47eeb2(0x107)],'confirmedOn':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0xba)]};console['log'](_0x47eeb2(0x124)),console[_0x47eeb2(0x11d)](_0x47eeb2(0xe5),_0x42ee3f['data'][_0x47eeb2(0x105)],'->',_0x5b1c56),console[_0x47eeb2(0x11d)]('Amount:',_0x42ee3f[_0x47eeb2(0xf6)]['Amount'],_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x11e)]),console[_0x47eeb2(0x11d)](_0x47eeb2(0x131),_0x42ee3f['data']['TransactionID']),console[_0x47eeb2(0x11d)](_0x47eeb2(0x13b),_0x5c0d6e||'not\x20found'),console[_0x47eeb2(0x11d)](_0x47eeb2(0xfe),_0x42ee3f[_0x47eeb2(0xf6)]['CreatedOn']),console[_0x47eeb2(0x11d)](_0x47eeb2(0x114),_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0xba)]||_0x47eeb2(0xb6));if(_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x105)]?.[_0x47eeb2(0xf8)]()===_0x47eeb2(0x12f))console[_0x47eeb2(0x11d)](_0x47eeb2(0x12e));else _0x42ee3f['data'][_0x47eeb2(0x105)]?.[_0x47eeb2(0xf8)]()===_0x47eeb2(0x13a)&&console['log'](_0x47eeb2(0xe3));return{'status':_0x5b1c56,'amount':parseFloat(_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x121)])||undefined,'currency':_0x42ee3f[_0x47eeb2(0xf6)][_0x47eeb2(0x11e)]||_0x47eeb2(0x120),'paymentDetails':_0x591f9a};}catch(_0x1c9ebf){console[_0x47eeb2(0xe7)](_0x47eeb2(0x12d),_0x1c9ebf),loggerService_1['loggerService']['logWhiteDomainError'](_0x47eeb2(0xd9),_0x47eeb2(0x108),_0x1c9ebf);throw new Error(_0x47eeb2(0xfd)+(_0x1c9ebf instanceof Error?_0x1c9ebf['message']:_0x47eeb2(0xbd)));}}async[a41_0x1110d9(0xde)](_0x3864f4){const _0x3a2431=a41_0x1110d9,_0x5ee69b=await this[_0x3a2431(0xc8)](_0x3864f4);return{'status':_0x5ee69b[_0x3a2431(0x101)],'amount':_0x5ee69b[_0x3a2431(0x118)],'currency':_0x5ee69b[_0x3a2431(0x119)]};}async[a41_0x1110d9(0xda)](_0x4d9f2a){const _0x17eb15=a41_0x1110d9;console[_0x17eb15(0x11d)](_0x17eb15(0xdc),_0x4d9f2a);let _0x473805='PENDING';switch(_0x4d9f2a['status']?.['toLowerCase']()){case _0x17eb15(0x13a):_0x473805=_0x17eb15(0xf1);break;case _0x17eb15(0x10a):case'failed':case _0x17eb15(0xe7):_0x473805='FAILED';break;case _0x17eb15(0xea):case'timeout':_0x473805='EXPIRED';break;case _0x17eb15(0xee):case'waiting':case'awaiting\x20fiat':case'created':default:_0x473805=_0x17eb15(0x128);break;}return{'paymentId':_0x4d9f2a[_0x17eb15(0xb4)]||_0x4d9f2a['merchant_reference_id']||'','status':_0x473805,'amount':_0x4d9f2a[_0x17eb15(0x118)],'currency':_0x4d9f2a[_0x17eb15(0x119)]||'EUR'};}}exports[a41_0x1110d9(0xd3)]=CoinToPayService;