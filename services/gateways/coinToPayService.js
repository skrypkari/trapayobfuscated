'use strict';const a40_0xe18ab3=a40_0x5d27;(function(_0x52c8cb,_0x10fe79){const _0x4c6683=a40_0x5d27,_0x152697=_0x52c8cb();while(!![]){try{const _0x334e94=-parseInt(_0x4c6683(0x1d3))/0x1*(parseInt(_0x4c6683(0x1af))/0x2)+-parseInt(_0x4c6683(0x1e2))/0x3+parseInt(_0x4c6683(0x19b))/0x4+-parseInt(_0x4c6683(0x1bf))/0x5*(-parseInt(_0x4c6683(0x1b0))/0x6)+-parseInt(_0x4c6683(0x198))/0x7+parseInt(_0x4c6683(0x1fd))/0x8*(-parseInt(_0x4c6683(0x1f3))/0x9)+parseInt(_0x4c6683(0x1e9))/0xa;if(_0x334e94===_0x10fe79)break;else _0x152697['push'](_0x152697['shift']());}catch(_0x124ee5){_0x152697['push'](_0x152697['shift']());}}}(a40_0x1d99,0x2afda));Object[a40_0xe18ab3(0x1cf)](exports,a40_0xe18ab3(0x1dc),{'value':!![]}),exports[a40_0xe18ab3(0x1d9)]=void 0x0;const loggerService_1=require(a40_0xe18ab3(0x1bb));class CoinToPayService{constructor(){const _0x298afb=a40_0xe18ab3;this[_0x298afb(0x1ae)]=_0x298afb(0x1a6),this[_0x298afb(0x1db)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x298afb(0x1ff)),console[_0x298afb(0x20b)]('📊\x20Status\x20check\x20URL:',this[_0x298afb(0x1db)]);}async['createPaymentLink'](_0x2ab2d1){const _0xaf6808=a40_0xe18ab3,{orderId:_0x14b1e4,amount:_0x155f6a}=_0x2ab2d1;console[_0xaf6808(0x20b)](_0xaf6808(0x1ec)+_0x155f6a+'\x20EUR');const _0x51cb7e={'amount':_0x155f6a},_0x17a22a=Date[_0xaf6808(0x19f)]();try{console[_0xaf6808(0x20b)](_0xaf6808(0x1da)),console[_0xaf6808(0x20b)](_0xaf6808(0x1ad),this[_0xaf6808(0x1ae)]),console[_0xaf6808(0x20b)](_0xaf6808(0x1ab),JSON['stringify'](_0x51cb7e,null,0x2)),console[_0xaf6808(0x20b)](_0xaf6808(0x202),_0x155f6a,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0xaf6808(0x197)][_0xaf6808(0x1ef)]('cointopay','/create',_0xaf6808(0x204),_0x51cb7e);const _0x1a116f=await fetch(this['apiUrl'],{'method':_0xaf6808(0x204),'headers':{'Content-Type':'application/json','Accept':_0xaf6808(0x1b9),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x51cb7e)}),_0x4c5552=Date[_0xaf6808(0x19f)]()-_0x17a22a;console[_0xaf6808(0x20b)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xaf6808(0x20b)](_0xaf6808(0x1fb),_0x1a116f[_0xaf6808(0x1b4)]),console[_0xaf6808(0x20b)](_0xaf6808(0x19c),_0x1a116f['statusText']),console[_0xaf6808(0x20b)](_0xaf6808(0x1f7),Object[_0xaf6808(0x1d4)](_0x1a116f[_0xaf6808(0x1a4)]['entries']())),console[_0xaf6808(0x20b)]('Response\x20Time:',_0x4c5552+'ms');const _0x311687=await _0x1a116f[_0xaf6808(0x1c2)]();console['log'](_0xaf6808(0x1be),_0x311687);if(!_0x1a116f['ok']){console[_0xaf6808(0x206)](_0xaf6808(0x1b8)),console['error'](_0xaf6808(0x1c7),_0x1a116f['status']),console[_0xaf6808(0x206)]('Response\x20Body:',_0x311687),loggerService_1['loggerService'][_0xaf6808(0x1d1)]('cointopay',_0xaf6808(0x1f9),_0x1a116f[_0xaf6808(0x1b4)],_0x311687,_0x4c5552),loggerService_1['loggerService']['logWhiteDomainError'](_0xaf6808(0x1bd),_0xaf6808(0x1f9),'HTTP\x20'+_0x1a116f[_0xaf6808(0x1b4)]+':\x20'+_0x311687);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a116f['status']+_0xaf6808(0x1c4)+_0x311687);}let _0x4bbf4f;try{_0x4bbf4f=JSON[_0xaf6808(0x1fa)](_0x311687);}catch(_0x146f45){console[_0xaf6808(0x206)](_0xaf6808(0x1f5),_0x146f45),loggerService_1[_0xaf6808(0x197)][_0xaf6808(0x1f4)](_0xaf6808(0x1bd),_0xaf6808(0x1f9),_0xaf6808(0x1fc)+_0x146f45);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x311687);}console['log'](_0xaf6808(0x1ed)),console['log'](_0xaf6808(0x1d7),JSON[_0xaf6808(0x1f0)](_0x4bbf4f,null,0x2)),loggerService_1[_0xaf6808(0x197)]['logWhiteDomainResponse'](_0xaf6808(0x1bd),_0xaf6808(0x1f9),_0x1a116f[_0xaf6808(0x1b4)],_0x4bbf4f,_0x4c5552);if(_0x4bbf4f[_0xaf6808(0x206)]){const _0x12aa89=_0x4bbf4f[_0xaf6808(0x19e)]||_0x4bbf4f[_0xaf6808(0x206)]||_0xaf6808(0x193);console[_0xaf6808(0x206)](_0xaf6808(0x1ea)),console[_0xaf6808(0x206)](_0xaf6808(0x1e0),_0x12aa89),loggerService_1[_0xaf6808(0x197)][_0xaf6808(0x1f4)](_0xaf6808(0x1bd),_0xaf6808(0x1f9),'Business\x20Error:\x20'+_0x12aa89);throw new Error(_0xaf6808(0x1e4)+_0x12aa89);}if(!_0x4bbf4f[_0xaf6808(0x1a0)]||!_0x4bbf4f[_0xaf6808(0x1c0)]){console['error'](_0xaf6808(0x1f1)),console[_0xaf6808(0x206)](_0xaf6808(0x1ce)),console[_0xaf6808(0x206)](_0xaf6808(0x205),_0x4bbf4f),loggerService_1[_0xaf6808(0x197)][_0xaf6808(0x1f4)](_0xaf6808(0x1bd),'/create',_0xaf6808(0x20a));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0xaf6808(0x18f)),console[_0xaf6808(0x20b)](_0xaf6808(0x192),_0x4bbf4f[_0xaf6808(0x1c0)]),console[_0xaf6808(0x20b)](_0xaf6808(0x1aa),_0x4bbf4f[_0xaf6808(0x1a0)]),console['log'](_0xaf6808(0x202),_0x155f6a,'EUR'),{'gateway_payment_id':_0x4bbf4f[_0xaf6808(0x1c0)],'payment_url':_0x4bbf4f[_0xaf6808(0x1a0)]};}catch(_0x1159d0){console[_0xaf6808(0x206)](_0xaf6808(0x1c5)),console['error']('Error\x20details:',_0x1159d0),loggerService_1['loggerService'][_0xaf6808(0x1f4)](_0xaf6808(0x1bd),_0xaf6808(0x1f9),_0x1159d0);if(_0x1159d0 instanceof Error){console[_0xaf6808(0x206)]('Error\x20message:',_0x1159d0[_0xaf6808(0x19e)]),console['error']('Error\x20stack:',_0x1159d0[_0xaf6808(0x190)]);throw new Error(_0xaf6808(0x1de)+_0x1159d0[_0xaf6808(0x19e)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0xe18ab3(0x1ca)](_0x5809cf){const _0x3e2e2d=a40_0xe18ab3,_0x537c89=Date[_0x3e2e2d(0x19f)]();try{console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x1bc)+_0x5809cf);const _0x319ade={'gatewayPaymentId':_0x5809cf};loggerService_1[_0x3e2e2d(0x197)]['logWhiteDomainRequest'](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x3e2e2d(0x204),_0x319ade);const _0x186bb0=await fetch(this['statusUrl'],{'method':_0x3e2e2d(0x204),'headers':{'Content-Type':_0x3e2e2d(0x1b9),'Accept':_0x3e2e2d(0x1b9),'User-Agent':_0x3e2e2d(0x1f2)},'body':JSON[_0x3e2e2d(0x1f0)](_0x319ade)}),_0x5c9204=Date[_0x3e2e2d(0x19f)]()-_0x537c89;console[_0x3e2e2d(0x20b)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3e2e2d(0x20b)]('Status:',_0x186bb0[_0x3e2e2d(0x1b4)]),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x196),_0x5c9204+'ms');if(!_0x186bb0['ok']){const _0x509e67=await _0x186bb0[_0x3e2e2d(0x1c2)]();console[_0x3e2e2d(0x206)](_0x3e2e2d(0x1c7),_0x186bb0[_0x3e2e2d(0x1b4)]),console[_0x3e2e2d(0x206)](_0x3e2e2d(0x1c8),_0x509e67),loggerService_1[_0x3e2e2d(0x197)][_0x3e2e2d(0x1d1)](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x186bb0[_0x3e2e2d(0x1b4)],_0x509e67,_0x5c9204),loggerService_1['loggerService']['logWhiteDomainError'](_0x3e2e2d(0x1bd),'/status',_0x3e2e2d(0x1eb)+_0x186bb0['status']+':\x20'+_0x509e67);throw new Error(_0x3e2e2d(0x1b7)+_0x186bb0[_0x3e2e2d(0x1b4)]);}const _0x5064aa=await _0x186bb0['text']();console[_0x3e2e2d(0x20b)]('Raw\x20Response\x20Body:',_0x5064aa);let _0x288d7d;try{_0x288d7d=JSON[_0x3e2e2d(0x1fa)](_0x5064aa);}catch(_0x7a5db8){console[_0x3e2e2d(0x206)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x7a5db8),loggerService_1[_0x3e2e2d(0x197)][_0x3e2e2d(0x1f4)](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x3e2e2d(0x1fc)+_0x7a5db8);throw new Error(_0x3e2e2d(0x1a1)+_0x5064aa);}loggerService_1['loggerService'][_0x3e2e2d(0x1d1)]('cointopay',_0x3e2e2d(0x1a9),_0x186bb0['status'],_0x288d7d,_0x5c9204),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x207)),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x1cb),_0x288d7d['result']),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x1c1),_0x288d7d['status_code']),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x191),_0x288d7d[_0x3e2e2d(0x1e3)]?.[_0x3e2e2d(0x1b2)]),console['log'](_0x3e2e2d(0x202),_0x288d7d[_0x3e2e2d(0x1e3)]?.[_0x3e2e2d(0x1a2)]),console['log']('Currency:',_0x288d7d['data']?.['inputCurrency']);if(_0x288d7d['result']!==_0x3e2e2d(0x1d6)||_0x288d7d['status_code']!==0xc8){const _0x5f09f6=_0x288d7d[_0x3e2e2d(0x19e)]||_0x3e2e2d(0x1b1);console[_0x3e2e2d(0x206)](_0x3e2e2d(0x1cc)),console[_0x3e2e2d(0x206)]('Error\x20Message:',_0x5f09f6),loggerService_1[_0x3e2e2d(0x197)]['logWhiteDomainError'](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x3e2e2d(0x1a5)+_0x5f09f6);throw new Error(_0x3e2e2d(0x1d5)+_0x5f09f6);}if(!_0x288d7d[_0x3e2e2d(0x1e3)]){console[_0x3e2e2d(0x206)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3e2e2d(0x206)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x3e2e2d(0x197)][_0x3e2e2d(0x1f4)](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x3e2e2d(0x19a));throw new Error(_0x3e2e2d(0x203));}let _0x483039=_0x3e2e2d(0x1f6);switch(_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1b2)]?.[_0x3e2e2d(0x1fe)]()){case _0x3e2e2d(0x1dd):_0x483039=_0x3e2e2d(0x1e8);break;case _0x3e2e2d(0x1ba):case _0x3e2e2d(0x1e6):case _0x3e2e2d(0x206):_0x483039=_0x3e2e2d(0x201);break;case _0x3e2e2d(0x1d8):case _0x3e2e2d(0x1c3):_0x483039=_0x3e2e2d(0x1b6);break;case'waiting':case _0x3e2e2d(0x1a7):case _0x3e2e2d(0x1cd):case'created':default:_0x483039=_0x3e2e2d(0x1f6);break;}let _0x2ccb5f,_0x12dace;if(_0x288d7d[_0x3e2e2d(0x1e3)]['PaymentDetail']){const _0x48fdbd=_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x200)];console[_0x3e2e2d(0x20b)]('🏦\x20Payment\x20Detail:',_0x48fdbd);const _0x24715c=_0x48fdbd['match'](/IBAN\s+([A-Z0-9]+)/i);_0x24715c&&(_0x2ccb5f=_0x24715c[0x1],console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x199),_0x2ccb5f)),_0x12dace=_0x48fdbd;}const _0x4eb6f1={'iban':_0x2ccb5f,'bankDetails':_0x12dace,'transactionId':_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1c6)],'coinAddress':_0x288d7d[_0x3e2e2d(0x1e3)]['coinAddress'],'qrCodeUrl':_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1e5)],'expiryTime':_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x194)],'createdOn':_0x288d7d['data'][_0x3e2e2d(0x1a8)],'confirmedOn':_0x288d7d['data']['TransactionConfirmedOn']};console['log'](_0x3e2e2d(0x1ac)),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x1fb),_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1b2)],'->',_0x483039),console['log']('Amount:',_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1a2)],_0x288d7d['data'][_0x3e2e2d(0x1d0)]),console[_0x3e2e2d(0x20b)]('Transaction\x20ID:',_0x288d7d[_0x3e2e2d(0x1e3)]['TransactionID']),console[_0x3e2e2d(0x20b)]('IBAN:',_0x2ccb5f||_0x3e2e2d(0x209)),console['log'](_0x3e2e2d(0x1df),_0x288d7d['data'][_0x3e2e2d(0x1a8)]),console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x1a3),_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1e7)]||'not\x20confirmed');if(_0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1b2)]?.['toLowerCase']()===_0x3e2e2d(0x1a7))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x288d7d[_0x3e2e2d(0x1e3)][_0x3e2e2d(0x1b2)]?.[_0x3e2e2d(0x1fe)]()===_0x3e2e2d(0x1dd)&&console[_0x3e2e2d(0x20b)](_0x3e2e2d(0x19d));return{'status':_0x483039,'amount':parseFloat(_0x288d7d['data']['Amount'])||undefined,'currency':_0x288d7d['data'][_0x3e2e2d(0x1d0)]||_0x3e2e2d(0x1d2),'paymentDetails':_0x4eb6f1};}catch(_0x564ca3){console[_0x3e2e2d(0x206)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x564ca3),loggerService_1[_0x3e2e2d(0x197)][_0x3e2e2d(0x1f4)](_0x3e2e2d(0x1bd),_0x3e2e2d(0x1a9),_0x564ca3);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x564ca3 instanceof Error?_0x564ca3['message']:_0x3e2e2d(0x1ee)));}}async[a40_0xe18ab3(0x1b5)](_0x4b26fe){const _0x3ddb1f=a40_0xe18ab3,_0x31d946=await this[_0x3ddb1f(0x1ca)](_0x4b26fe);return{'status':_0x31d946[_0x3ddb1f(0x1b4)],'amount':_0x31d946['amount'],'currency':_0x31d946[_0x3ddb1f(0x1e1)]};}async[a40_0xe18ab3(0x1b3)](_0x11c629){const _0x2deb6a=a40_0xe18ab3;console[_0x2deb6a(0x20b)](_0x2deb6a(0x1c9),_0x11c629);let _0x397894=_0x2deb6a(0x1f6);switch(_0x11c629[_0x2deb6a(0x1b4)]?.[_0x2deb6a(0x1fe)]()){case'paid':_0x397894='PAID';break;case _0x2deb6a(0x1ba):case _0x2deb6a(0x1e6):case _0x2deb6a(0x206):_0x397894=_0x2deb6a(0x201);break;case'expired':case _0x2deb6a(0x1c3):_0x397894=_0x2deb6a(0x1b6);break;case'pending':case _0x2deb6a(0x195):case _0x2deb6a(0x1a7):case'created':default:_0x397894=_0x2deb6a(0x1f6);break;}return{'paymentId':_0x11c629[_0x2deb6a(0x1f8)]||_0x11c629[_0x2deb6a(0x208)]||'','status':_0x397894,'amount':_0x11c629['amount'],'currency':_0x11c629['currency']||_0x2deb6a(0x1d2)};}}function a40_0x5d27(_0x58899e,_0x1c21a0){const _0x1d99a6=a40_0x1d99();return a40_0x5d27=function(_0x5d2769,_0x4219d1){_0x5d2769=_0x5d2769-0x18f;let _0x5ac419=_0x1d99a6[_0x5d2769];return _0x5ac419;},a40_0x5d27(_0x58899e,_0x1c21a0);}function a40_0x1d99(){const _0x14e0b9=['https://tesoft.uk/gateway/cointopay/','awaiting\x20fiat','CreatedOn','/status','Payment\x20URL:','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','URL:','apiUrl','217166luEiaA','534HEMxOW','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Status','processWebhook','status','verifyPayment','EXPIRED','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','application/json','cancelled','../loggerService','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cointopay','Raw\x20Response\x20Body:','1115EUCULP','gateway_payment_id','Status\x20Code:','text','timeout',',\x20body:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','TransactionID','HTTP\x20Status:','Response\x20Body:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','checkPaymentStatus','Result:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','pending','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','defineProperty','inputCurrency','logWhiteDomainResponse','EUR','2rVNZgG','fromEntries','CoinToPay\x20status\x20API\x20error:\x20','success','Parsed\x20Result:','expired','CoinToPayService','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','statusUrl','__esModule','paid','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Created\x20On:','Error\x20Message:','currency','677304RUDrWD','data','CoinToPay\x20API\x20error:\x20','QRCodeURL','failed','TransactionConfirmedOn','PAID','7336770KkeRcc','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Unknown\x20error','logWhiteDomainRequest','stringify','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','8523JpXVix','logWhiteDomainError','Failed\x20to\x20parse\x20JSON\x20response:','PENDING','Headers:','order_id','/create','parse','Status:','JSON\x20Parse\x20Error:\x20','1112wXkhOH','toLowerCase','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PaymentDetail','FAILED','Amount:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','POST','Response\x20data:','error','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','merchant_reference_id','not\x20found','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','log','===\x20COINTOPAY\x20SUCCESS\x20===','stack','Payment\x20Status:','Gateway\x20Payment\x20ID:','Unknown\x20error\x20from\x20CoinToPay\x20API','ExpiryTime','waiting','Response\x20Time:','loggerService','801052EJlGLD','🏦\x20Extracted\x20IBAN:','Incomplete\x20response:\x20missing\x20data','446276FegzSH','Status\x20Text:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','message','now','payment_url','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Amount','Confirmed\x20On:','headers','Status\x20API\x20Error:\x20'];a40_0x1d99=function(){return _0x14e0b9;};return a40_0x1d99();}exports['CoinToPayService']=CoinToPayService;