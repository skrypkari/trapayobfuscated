'use strict';const a40_0x46a9e6=a40_0x50b6;function a40_0x406d(){const _0x177444=['Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','headers','\x20EUR','Status\x20API\x20Error:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','3020jzUIug','/create','Status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','fromEntries','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','not\x20found','/status','Amount:','currency','TransactionConfirmedOn','8IYyuxn','verifyPayment','Payment\x20Status:','inputCurrency','coinAddress','logWhiteDomainRequest','CoinToPay\x20status\x20API\x20error:\x20','408516krYVKU','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Business\x20Error:\x20','TransactionID','message','URL:','logWhiteDomainError','Payment\x20URL:','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20Status:','Transaction\x20ID:','Raw\x20Response\x20Body:','logWhiteDomainResponse','text','error','12meXyAV','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Response\x20data:','https://tesoft.uk/gateway/cointopay/status.php','JSON\x20Parse\x20Error:\x20','EXPIRED','createPaymentLink','application/json','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','timeout','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status:','amount','toLowerCase','üè¶\x20Extracted\x20IBAN:','apiUrl','status','HTTP\x20','Confirmed\x20On:','Amount','cointopay','defineProperty','Error\x20stack:','ExpiryTime','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','2333926aehsPs','data','POST','../loggerService','EUR','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','result','waiting','Headers:','statusUrl','payment_url','Parsed\x20Result:','===\x20COINTOPAY\x20SUCCESS\x20===','status_code','5625455BfgNui','now','parse','order_id','340062Oizdgn','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20message:','CoinToPayService','failed','paid','Request\x20Body:','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','gateway_payment_id','log','created','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20Code:','75rUajQS','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','entries','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','stack','loggerService','Status\x20Text:','üìä\x20Status\x20check\x20URL:','__esModule','CoinToPay\x20payment\x20status\x20check\x20error:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CoinToPay\x20API\x20error:\x20','5742233uYjpRQ','21519VDrDAw','HTTP\x20error!\x20status:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','PaymentDetail','Response\x20Time:','not\x20confirmed','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','stringify','Response\x20Body:','cancelled','Error\x20details:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','statusText','CreatedOn','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','868047cnXAfO','Missing\x20data\x20in\x20response','pending','PAID','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','checkPaymentStatus','expired','FAILED'];a40_0x406d=function(){return _0x177444;};return a40_0x406d();}(function(_0x3a50aa,_0x687ac2){const _0x3b4523=a40_0x50b6,_0x2366cf=_0x3a50aa();while(!![]){try{const _0x5b9e9e=parseInt(_0x3b4523(0x1c9))/0x1+parseInt(_0x3b4523(0x1b7))/0x2+parseInt(_0x3b4523(0x16e))/0x3*(-parseInt(_0x3b4523(0x19d))/0x4)+parseInt(_0x3b4523(0x1d7))/0x5*(-parseInt(_0x3b4523(0x18d))/0x6)+-parseInt(_0x3b4523(0x1e4))/0x7*(-parseInt(_0x3b4523(0x186))/0x8)+-parseInt(_0x3b4523(0x1e5))/0x9*(-parseInt(_0x3b4523(0x17b))/0xa)+-parseInt(_0x3b4523(0x1c5))/0xb;if(_0x5b9e9e===_0x687ac2)break;else _0x2366cf['push'](_0x2366cf['shift']());}catch(_0x343983){_0x2366cf['push'](_0x2366cf['shift']());}}}(a40_0x406d,0x9e5ec));Object[a40_0x46a9e6(0x1b3)](exports,a40_0x46a9e6(0x1e0),{'value':!![]}),exports[a40_0x46a9e6(0x1cc)]=void 0x0;const loggerService_1=require(a40_0x46a9e6(0x1ba));function a40_0x50b6(_0x441934,_0x13405c){const _0x406d8a=a40_0x406d();return a40_0x50b6=function(_0x50b671,_0x305ab5){_0x50b671=_0x50b671-0x167;let _0x173695=_0x406d8a[_0x50b671];return _0x173695;},a40_0x50b6(_0x441934,_0x13405c);}class CoinToPayService{constructor(){const _0x428eb3=a40_0x46a9e6;this[_0x428eb3(0x1ad)]='https://tesoft.uk/gateway/cointopay/',this[_0x428eb3(0x1c0)]=_0x428eb3(0x1a1),console['log'](_0x428eb3(0x1ca)),console[_0x428eb3(0x1d3)](_0x428eb3(0x1df),this[_0x428eb3(0x1c0)]);}async[a40_0x46a9e6(0x1a4)](_0x57dc5c){const _0x2abf42=a40_0x46a9e6,{orderId:_0x27013d,amount:_0xab7bc9}=_0x57dc5c;console[_0x2abf42(0x1d3)](_0x2abf42(0x169)+_0xab7bc9+_0x2abf42(0x178));const _0x544caf={'amount':_0xab7bc9},_0x51f574=Date[_0x2abf42(0x1c6)]();try{console['log'](_0x2abf42(0x1d8)),console[_0x2abf42(0x1d3)](_0x2abf42(0x192),this[_0x2abf42(0x1ad)]),console[_0x2abf42(0x1d3)](_0x2abf42(0x1cf),JSON[_0x2abf42(0x1ed)](_0x544caf,null,0x2)),console[_0x2abf42(0x1d3)](_0x2abf42(0x183),_0xab7bc9,_0x2abf42(0x1da)),loggerService_1[_0x2abf42(0x1dd)]['logWhiteDomainRequest'](_0x2abf42(0x1b2),'/create',_0x2abf42(0x1b9),_0x544caf);const _0x50fbd7=await fetch(this[_0x2abf42(0x1ad)],{'method':_0x2abf42(0x1b9),'headers':{'Content-Type':_0x2abf42(0x1a5),'Accept':_0x2abf42(0x1a5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2abf42(0x1ed)](_0x544caf)}),_0x42cb2e=Date[_0x2abf42(0x1c6)]()-_0x51f574;console[_0x2abf42(0x1d3)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2abf42(0x1d3)](_0x2abf42(0x1a9),_0x50fbd7[_0x2abf42(0x1ae)]),console[_0x2abf42(0x1d3)](_0x2abf42(0x1de),_0x50fbd7[_0x2abf42(0x16a)]),console[_0x2abf42(0x1d3)](_0x2abf42(0x1bf),Object[_0x2abf42(0x17f)](_0x50fbd7[_0x2abf42(0x177)][_0x2abf42(0x1d9)]())),console[_0x2abf42(0x1d3)](_0x2abf42(0x1e9),_0x42cb2e+'ms');const _0x1027a8=await _0x50fbd7[_0x2abf42(0x19b)]();console[_0x2abf42(0x1d3)](_0x2abf42(0x199),_0x1027a8);if(!_0x50fbd7['ok']){console['error'](_0x2abf42(0x1a8)),console[_0x2abf42(0x19c)](_0x2abf42(0x197),_0x50fbd7[_0x2abf42(0x1ae)]),console[_0x2abf42(0x19c)](_0x2abf42(0x1ee),_0x1027a8),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x19a)](_0x2abf42(0x1b2),_0x2abf42(0x17c),_0x50fbd7[_0x2abf42(0x1ae)],_0x1027a8,_0x42cb2e),loggerService_1['loggerService'][_0x2abf42(0x193)](_0x2abf42(0x1b2),_0x2abf42(0x17c),_0x2abf42(0x1af)+_0x50fbd7[_0x2abf42(0x1ae)]+':\x20'+_0x1027a8);throw new Error(_0x2abf42(0x1e6)+_0x50fbd7[_0x2abf42(0x1ae)]+',\x20body:\x20'+_0x1027a8);}let _0x420584;try{_0x420584=JSON[_0x2abf42(0x1c7)](_0x1027a8);}catch(_0x2eb30a){console[_0x2abf42(0x19c)](_0x2abf42(0x16c),_0x2eb30a),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x193)](_0x2abf42(0x1b2),'/create',_0x2abf42(0x1a2)+_0x2eb30a);throw new Error(_0x2abf42(0x168)+_0x1027a8);}console['log'](_0x2abf42(0x1bc)),console[_0x2abf42(0x1d3)](_0x2abf42(0x1c2),JSON[_0x2abf42(0x1ed)](_0x420584,null,0x2)),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x19a)](_0x2abf42(0x1b2),_0x2abf42(0x17c),_0x50fbd7[_0x2abf42(0x1ae)],_0x420584,_0x42cb2e);if(_0x420584[_0x2abf42(0x19c)]){const _0x5b234c=_0x420584[_0x2abf42(0x191)]||_0x420584[_0x2abf42(0x19c)]||_0x2abf42(0x1e7);console['error'](_0x2abf42(0x1d1)),console[_0x2abf42(0x19c)](_0x2abf42(0x19e),_0x5b234c),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x193)]('cointopay',_0x2abf42(0x17c),_0x2abf42(0x18f)+_0x5b234c);throw new Error(_0x2abf42(0x1e3)+_0x5b234c);}if(!_0x420584[_0x2abf42(0x1c1)]||!_0x420584[_0x2abf42(0x1d2)]){console[_0x2abf42(0x19c)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x2abf42(0x176)),console[_0x2abf42(0x19c)](_0x2abf42(0x1a0),_0x420584),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x193)](_0x2abf42(0x1b2),_0x2abf42(0x17c),_0x2abf42(0x17e));throw new Error(_0x2abf42(0x1d5));}return console[_0x2abf42(0x1d3)](_0x2abf42(0x1c3)),console[_0x2abf42(0x1d3)]('Gateway\x20Payment\x20ID:',_0x420584[_0x2abf42(0x1d2)]),console[_0x2abf42(0x1d3)](_0x2abf42(0x194),_0x420584[_0x2abf42(0x1c1)]),console[_0x2abf42(0x1d3)](_0x2abf42(0x183),_0xab7bc9,_0x2abf42(0x1bb)),{'gateway_payment_id':_0x420584[_0x2abf42(0x1d2)],'payment_url':_0x420584[_0x2abf42(0x1c1)]};}catch(_0x11cd6e){console[_0x2abf42(0x19c)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0x2abf42(0x167),_0x11cd6e),loggerService_1[_0x2abf42(0x1dd)][_0x2abf42(0x193)](_0x2abf42(0x1b2),'/create',_0x11cd6e);if(_0x11cd6e instanceof Error){console[_0x2abf42(0x19c)](_0x2abf42(0x1cb),_0x11cd6e[_0x2abf42(0x191)]),console[_0x2abf42(0x19c)](_0x2abf42(0x1b4),_0x11cd6e[_0x2abf42(0x1dc)]);throw new Error(_0x2abf42(0x19f)+_0x11cd6e[_0x2abf42(0x191)]);}throw new Error(_0x2abf42(0x1db));}}async[a40_0x46a9e6(0x173)](_0x4b871c){const _0x243cc1=a40_0x46a9e6,_0xfa30d7=Date['now']();try{console[_0x243cc1(0x1d3)](_0x243cc1(0x18e)+_0x4b871c);const _0x5477e7={'gatewayPaymentId':_0x4b871c};loggerService_1[_0x243cc1(0x1dd)][_0x243cc1(0x18b)](_0x243cc1(0x1b2),_0x243cc1(0x182),_0x243cc1(0x1b9),_0x5477e7);const _0xaaf508=await fetch(this[_0x243cc1(0x1c0)],{'method':'POST','headers':{'Content-Type':_0x243cc1(0x1a5),'Accept':_0x243cc1(0x1a5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x243cc1(0x1ed)](_0x5477e7)}),_0x2ca294=Date[_0x243cc1(0x1c6)]()-_0xfa30d7;console[_0x243cc1(0x1d3)](_0x243cc1(0x1ec)),console[_0x243cc1(0x1d3)](_0x243cc1(0x1a9),_0xaaf508[_0x243cc1(0x1ae)]),console[_0x243cc1(0x1d3)](_0x243cc1(0x1e9),_0x2ca294+'ms');if(!_0xaaf508['ok']){const _0x152f5d=await _0xaaf508[_0x243cc1(0x19b)]();console[_0x243cc1(0x19c)](_0x243cc1(0x197),_0xaaf508[_0x243cc1(0x1ae)]),console['error'](_0x243cc1(0x1ee),_0x152f5d),loggerService_1['loggerService'][_0x243cc1(0x19a)]('cointopay',_0x243cc1(0x182),_0xaaf508[_0x243cc1(0x1ae)],_0x152f5d,_0x2ca294),loggerService_1[_0x243cc1(0x1dd)][_0x243cc1(0x193)]('cointopay',_0x243cc1(0x182),_0x243cc1(0x1af)+_0xaaf508[_0x243cc1(0x1ae)]+':\x20'+_0x152f5d);throw new Error(_0x243cc1(0x1e6)+_0xaaf508[_0x243cc1(0x1ae)]);}const _0xd5de2f=await _0xaaf508['text']();console[_0x243cc1(0x1d3)](_0x243cc1(0x199),_0xd5de2f);let _0x521afd;try{_0x521afd=JSON[_0x243cc1(0x1c7)](_0xd5de2f);}catch(_0x17c533){console[_0x243cc1(0x19c)](_0x243cc1(0x16c),_0x17c533),loggerService_1[_0x243cc1(0x1dd)][_0x243cc1(0x193)](_0x243cc1(0x1b2),_0x243cc1(0x182),_0x243cc1(0x1a2)+_0x17c533);throw new Error(_0x243cc1(0x196)+_0xd5de2f);}loggerService_1[_0x243cc1(0x1dd)][_0x243cc1(0x19a)](_0x243cc1(0x1b2),_0x243cc1(0x182),_0xaaf508[_0x243cc1(0x1ae)],_0x521afd,_0x2ca294),console[_0x243cc1(0x1d3)](_0x243cc1(0x1b6)),console[_0x243cc1(0x1d3)]('Result:',_0x521afd[_0x243cc1(0x1bd)]),console['log'](_0x243cc1(0x1d6),_0x521afd[_0x243cc1(0x1c4)]),console[_0x243cc1(0x1d3)](_0x243cc1(0x188),_0x521afd[_0x243cc1(0x1b8)]?.[_0x243cc1(0x17d)]),console[_0x243cc1(0x1d3)](_0x243cc1(0x183),_0x521afd[_0x243cc1(0x1b8)]?.[_0x243cc1(0x1b1)]),console[_0x243cc1(0x1d3)]('Currency:',_0x521afd[_0x243cc1(0x1b8)]?.[_0x243cc1(0x189)]);if(_0x521afd[_0x243cc1(0x1bd)]!=='success'||_0x521afd['status_code']!==0xc8){const _0x5e652e=_0x521afd['message']||_0x243cc1(0x1a6);console[_0x243cc1(0x19c)](_0x243cc1(0x172)),console['error'](_0x243cc1(0x19e),_0x5e652e),loggerService_1['loggerService']['logWhiteDomainError'](_0x243cc1(0x1b2),'/status',_0x243cc1(0x179)+_0x5e652e);throw new Error(_0x243cc1(0x18c)+_0x5e652e);}if(!_0x521afd[_0x243cc1(0x1b8)]){console[_0x243cc1(0x19c)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x243cc1(0x19c)](_0x243cc1(0x16f)),loggerService_1[_0x243cc1(0x1dd)][_0x243cc1(0x193)](_0x243cc1(0x1b2),_0x243cc1(0x182),_0x243cc1(0x1eb));throw new Error(_0x243cc1(0x16d));}let _0x3e1600=_0x243cc1(0x195);switch(_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x17d)]?.[_0x243cc1(0x1ab)]()){case _0x243cc1(0x1ce):_0x3e1600='PAID';break;case _0x243cc1(0x1ef):case _0x243cc1(0x1cd):case _0x243cc1(0x19c):_0x3e1600=_0x243cc1(0x175);break;case _0x243cc1(0x174):case _0x243cc1(0x1a7):_0x3e1600='EXPIRED';break;case _0x243cc1(0x1be):case _0x243cc1(0x1d0):case _0x243cc1(0x170):case _0x243cc1(0x1d4):default:_0x3e1600=_0x243cc1(0x195);break;}let _0x990aa6,_0x231568;if(_0x521afd[_0x243cc1(0x1b8)]['PaymentDetail']){const _0x58644c=_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x1e8)];console[_0x243cc1(0x1d3)]('üè¶\x20Payment\x20Detail:',_0x58644c);const _0x4a9c8b=_0x58644c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x4a9c8b&&(_0x990aa6=_0x4a9c8b[0x1],console[_0x243cc1(0x1d3)](_0x243cc1(0x1ac),_0x990aa6)),_0x231568=_0x58644c;}const _0x2ef712={'iban':_0x990aa6,'bankDetails':_0x231568,'transactionId':_0x521afd[_0x243cc1(0x1b8)]['TransactionID'],'coinAddress':_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x18a)],'qrCodeUrl':_0x521afd[_0x243cc1(0x1b8)]['QRCodeURL'],'expiryTime':_0x521afd['data'][_0x243cc1(0x1b5)],'createdOn':_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x16b)],'confirmedOn':_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x185)]};console['log'](_0x243cc1(0x180)),console[_0x243cc1(0x1d3)](_0x243cc1(0x1a9),_0x521afd[_0x243cc1(0x1b8)]['Status'],'->',_0x3e1600),console[_0x243cc1(0x1d3)](_0x243cc1(0x183),_0x521afd['data'][_0x243cc1(0x1b1)],_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x189)]),console[_0x243cc1(0x1d3)](_0x243cc1(0x198),_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x190)]),console[_0x243cc1(0x1d3)]('IBAN:',_0x990aa6||_0x243cc1(0x181)),console['log']('Created\x20On:',_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x16b)]),console['log'](_0x243cc1(0x1b0),_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x185)]||_0x243cc1(0x1ea));if(_0x521afd[_0x243cc1(0x1b8)][_0x243cc1(0x17d)]?.[_0x243cc1(0x1ab)]()===_0x243cc1(0x1d0))console[_0x243cc1(0x1d3)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x521afd[_0x243cc1(0x1b8)]['Status']?.[_0x243cc1(0x1ab)]()==='paid'&&console[_0x243cc1(0x1d3)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3e1600,'amount':parseFloat(_0x521afd[_0x243cc1(0x1b8)]['Amount'])||undefined,'currency':_0x521afd[_0x243cc1(0x1b8)]['inputCurrency']||_0x243cc1(0x1bb),'paymentDetails':_0x2ef712};}catch(_0x47e2c4){console['error'](_0x243cc1(0x1e1),_0x47e2c4),loggerService_1['loggerService'][_0x243cc1(0x193)](_0x243cc1(0x1b2),_0x243cc1(0x182),_0x47e2c4);throw new Error(_0x243cc1(0x17a)+(_0x47e2c4 instanceof Error?_0x47e2c4[_0x243cc1(0x191)]:'Unknown\x20error'));}}async[a40_0x46a9e6(0x187)](_0x2afdd3){const _0x407393=a40_0x46a9e6,_0x74b1bf=await this[_0x407393(0x173)](_0x2afdd3);return{'status':_0x74b1bf[_0x407393(0x1ae)],'amount':_0x74b1bf[_0x407393(0x1aa)],'currency':_0x74b1bf[_0x407393(0x184)]};}async['processWebhook'](_0xde35d4){const _0x44d21f=a40_0x46a9e6;console['log'](_0x44d21f(0x1e2),_0xde35d4);let _0xc68e3c=_0x44d21f(0x195);switch(_0xde35d4[_0x44d21f(0x1ae)]?.[_0x44d21f(0x1ab)]()){case _0x44d21f(0x1ce):_0xc68e3c=_0x44d21f(0x171);break;case'cancelled':case _0x44d21f(0x1cd):case _0x44d21f(0x19c):_0xc68e3c='FAILED';break;case'expired':case'timeout':_0xc68e3c=_0x44d21f(0x1a3);break;case _0x44d21f(0x170):case _0x44d21f(0x1be):case'awaiting\x20fiat':case _0x44d21f(0x1d4):default:_0xc68e3c=_0x44d21f(0x195);break;}return{'paymentId':_0xde35d4[_0x44d21f(0x1c8)]||_0xde35d4['merchant_reference_id']||'','status':_0xc68e3c,'amount':_0xde35d4[_0x44d21f(0x1aa)],'currency':_0xde35d4[_0x44d21f(0x184)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;