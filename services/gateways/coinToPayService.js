'use strict';const a41_0x57a04e=a41_0x4642;(function(_0x13c5d6,_0xb19a91){const _0xa6d835=a41_0x4642,_0x5a22d3=_0x13c5d6();while(!![]){try{const _0x3c3b59=parseInt(_0xa6d835(0x1a5))/0x1*(parseInt(_0xa6d835(0x1e9))/0x2)+-parseInt(_0xa6d835(0x1af))/0x3+parseInt(_0xa6d835(0x1c2))/0x4+parseInt(_0xa6d835(0x1f2))/0x5+-parseInt(_0xa6d835(0x1d9))/0x6+parseInt(_0xa6d835(0x1c1))/0x7*(parseInt(_0xa6d835(0x18e))/0x8)+-parseInt(_0xa6d835(0x1d7))/0x9;if(_0x3c3b59===_0xb19a91)break;else _0x5a22d3['push'](_0x5a22d3['shift']());}catch(_0x158771){_0x5a22d3['push'](_0x5a22d3['shift']());}}}(a41_0x45a0,0xe51ba));function a41_0x45a0(){const _0x301226=['not\x20confirmed','TransactionConfirmedOn','PaymentDetail','PAID','Error\x20message:','pending','===\x20COINTOPAY\x20API\x20ERROR\x20===','parse','6863688Prwsvj','Response\x20Time:','2448846dcOPqZ','error','CoinToPay\x20status\x20API\x20error:\x20','match','gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Created\x20On:','awaiting\x20fiat','logWhiteDomainError','Payment\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','FAILED','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','paid','Request\x20Body:','checkPaymentStatus','897038UlDzty','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Transaction\x20ID:','text','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','5548480ytUeNA','Error\x20stack:','Confirmed\x20On:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','application/json','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','expired','Status\x20Code:','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','__esModule','Error\x20details:','/create','loggerService','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','/status','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Amount','Error\x20Message:','logWhiteDomainResponse','currency','Currency:','TesSoft\x20Payment\x20System/1.0','Raw\x20Response\x20Body:','statusUrl','EXPIRED','Status\x20Text:','https://tesoft.uk/gateway/cointopay/','createPaymentLink','payment_url','not\x20found','CoinToPayService','8kUcXHt','order_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Status\x20API\x20Error:\x20','POST','status','created','QRCodeURL','Status','IBAN:','apiUrl','headers','CoinToPay\x20API\x20error:\x20','TransactionID','Failed\x20to\x20parse\x20JSON\x20response:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','toLowerCase','cancelled','log','result','cointopay','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','1FoFfFo','üè¶\x20Payment\x20Detail:','Response\x20Body:','merchant_reference_id','Status:','CreatedOn','EUR','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','HTTP\x20','now','962430yAZdSy','URL:','status_code','PENDING','üìä\x20Status\x20check\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','../loggerService','amount','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','data','message','Gateway\x20Payment\x20ID:','logWhiteDomainRequest','success','stringify','Parsed\x20Result:','5426015XRReEi','386596OCbWgp','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','inputCurrency','verifyPayment','stack','entries','üè¶\x20Extracted\x20IBAN:','ExpiryTime','processWebhook','JSON\x20Parse\x20Error:\x20','timeout','statusText','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='];a41_0x45a0=function(){return _0x301226;};return a41_0x45a0();}Object['defineProperty'](exports,a41_0x57a04e(0x1fc),{'value':!![]}),exports[a41_0x57a04e(0x18d)]=void 0x0;const loggerService_1=require(a41_0x57a04e(0x1b5));function a41_0x4642(_0x274d89,_0x564425){const _0x45a099=a41_0x45a0();return a41_0x4642=function(_0x4642da,_0x2b58dc){_0x4642da=_0x4642da-0x188;let _0x315dbb=_0x45a099[_0x4642da];return _0x315dbb;},a41_0x4642(_0x274d89,_0x564425);}class CoinToPayService{constructor(){const _0x5b0afc=a41_0x57a04e;this[_0x5b0afc(0x199)]=_0x5b0afc(0x189),this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x5b0afc(0x1a1)](_0x5b0afc(0x1b7)),console[_0x5b0afc(0x1a1)](_0x5b0afc(0x1b3),this[_0x5b0afc(0x20a)]);}async[a41_0x57a04e(0x18a)](_0x43a4ca){const _0x5f2922=a41_0x57a04e,{orderId:_0x57b8bb,amount:_0x14234f}=_0x43a4ca;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x14234f+'\x20EUR');const _0x16d84a={'amount':_0x14234f},_0x332745=Date[_0x5f2922(0x1ae)]();try{console['log'](_0x5f2922(0x1fb)),console[_0x5f2922(0x1a1)](_0x5f2922(0x1b0),this[_0x5f2922(0x199)]),console[_0x5f2922(0x1a1)](_0x5f2922(0x1e7),JSON[_0x5f2922(0x1bf)](_0x16d84a,null,0x2)),console[_0x5f2922(0x1a1)](_0x5f2922(0x1b9),_0x14234f,_0x5f2922(0x1f7)),loggerService_1['loggerService'][_0x5f2922(0x1bd)](_0x5f2922(0x1a3),_0x5f2922(0x1fe),'POST',_0x16d84a);const _0x1e5e44=await fetch(this[_0x5f2922(0x199)],{'method':'POST','headers':{'Content-Type':_0x5f2922(0x1f6),'Accept':'application/json','User-Agent':_0x5f2922(0x208)},'body':JSON[_0x5f2922(0x1bf)](_0x16d84a)}),_0x36f5dd=Date['now']()-_0x332745;console[_0x5f2922(0x1a1)](_0x5f2922(0x1eb)),console[_0x5f2922(0x1a1)](_0x5f2922(0x1a9),_0x1e5e44['status']),console['log'](_0x5f2922(0x188),_0x1e5e44[_0x5f2922(0x1cd)]),console[_0x5f2922(0x1a1)]('Headers:',Object['fromEntries'](_0x1e5e44[_0x5f2922(0x19a)][_0x5f2922(0x1c7)]())),console['log'](_0x5f2922(0x1d8),_0x36f5dd+'ms');const _0x3459af=await _0x1e5e44['text']();console[_0x5f2922(0x1a1)]('Raw\x20Response\x20Body:',_0x3459af);if(!_0x1e5e44['ok']){console[_0x5f2922(0x1da)](_0x5f2922(0x1d5)),console[_0x5f2922(0x1da)]('HTTP\x20Status:',_0x1e5e44[_0x5f2922(0x194)]),console[_0x5f2922(0x1da)](_0x5f2922(0x1a7),_0x3459af),loggerService_1['loggerService'][_0x5f2922(0x205)](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x1e5e44[_0x5f2922(0x194)],_0x3459af,_0x36f5dd),loggerService_1['loggerService'][_0x5f2922(0x1e1)](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x5f2922(0x1ad)+_0x1e5e44[_0x5f2922(0x194)]+':\x20'+_0x3459af);throw new Error(_0x5f2922(0x1fa)+_0x1e5e44[_0x5f2922(0x194)]+',\x20body:\x20'+_0x3459af);}let _0x385c19;try{_0x385c19=JSON['parse'](_0x3459af);}catch(_0x58eaa6){console[_0x5f2922(0x1da)](_0x5f2922(0x19d),_0x58eaa6),loggerService_1[_0x5f2922(0x1ff)][_0x5f2922(0x1e1)](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x5f2922(0x1cb)+_0x58eaa6);throw new Error(_0x5f2922(0x1de)+_0x3459af);}console[_0x5f2922(0x1a1)](_0x5f2922(0x1f1)),console[_0x5f2922(0x1a1)](_0x5f2922(0x1c0),JSON[_0x5f2922(0x1bf)](_0x385c19,null,0x2)),loggerService_1[_0x5f2922(0x1ff)]['logWhiteDomainResponse'](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x1e5e44[_0x5f2922(0x194)],_0x385c19,_0x36f5dd);if(_0x385c19[_0x5f2922(0x1da)]){const _0x307a5d=_0x385c19[_0x5f2922(0x1bb)]||_0x385c19[_0x5f2922(0x1da)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x5f2922(0x1da)](_0x5f2922(0x1e5)),console[_0x5f2922(0x1da)]('Error\x20Message:',_0x307a5d),loggerService_1['loggerService'][_0x5f2922(0x1e1)](_0x5f2922(0x1a3),'/create','Business\x20Error:\x20'+_0x307a5d);throw new Error(_0x5f2922(0x19b)+_0x307a5d);}if(!_0x385c19[_0x5f2922(0x18b)]||!_0x385c19[_0x5f2922(0x1dd)]){console[_0x5f2922(0x1da)](_0x5f2922(0x1b8)),console['error'](_0x5f2922(0x202)),console[_0x5f2922(0x1da)]('Response\x20data:',_0x385c19),loggerService_1['loggerService'][_0x5f2922(0x1e1)](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x5f2922(0x1ef));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x5f2922(0x1a1)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x5f2922(0x1a1)](_0x5f2922(0x1bc),_0x385c19[_0x5f2922(0x1dd)]),console[_0x5f2922(0x1a1)](_0x5f2922(0x1e2),_0x385c19[_0x5f2922(0x18b)]),console['log'](_0x5f2922(0x1b9),_0x14234f,_0x5f2922(0x1ab)),{'gateway_payment_id':_0x385c19[_0x5f2922(0x1dd)],'payment_url':_0x385c19[_0x5f2922(0x18b)]};}catch(_0x2dcf2d){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x5f2922(0x1da)](_0x5f2922(0x1fd),_0x2dcf2d),loggerService_1[_0x5f2922(0x1ff)]['logWhiteDomainError'](_0x5f2922(0x1a3),_0x5f2922(0x1fe),_0x2dcf2d);if(_0x2dcf2d instanceof Error){console[_0x5f2922(0x1da)](_0x5f2922(0x1d3),_0x2dcf2d[_0x5f2922(0x1bb)]),console[_0x5f2922(0x1da)](_0x5f2922(0x1f3),_0x2dcf2d[_0x5f2922(0x1c6)]);throw new Error(_0x5f2922(0x191)+_0x2dcf2d[_0x5f2922(0x1bb)]);}throw new Error(_0x5f2922(0x1ac));}}async[a41_0x57a04e(0x1e8)](_0x165355){const _0x5f3baa=a41_0x57a04e,_0x222720=Date['now']();try{console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1c3)+_0x165355);const _0x44f0ca={'gatewayPaymentId':_0x165355};loggerService_1[_0x5f3baa(0x1ff)][_0x5f3baa(0x1bd)](_0x5f3baa(0x1a3),_0x5f3baa(0x201),_0x5f3baa(0x193),_0x44f0ca);const _0x2524ec=await fetch(this['statusUrl'],{'method':_0x5f3baa(0x193),'headers':{'Content-Type':_0x5f3baa(0x1f6),'Accept':_0x5f3baa(0x1f6),'User-Agent':_0x5f3baa(0x208)},'body':JSON[_0x5f3baa(0x1bf)](_0x44f0ca)}),_0xee4765=Date['now']()-_0x222720;console[_0x5f3baa(0x1a1)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log']('Status:',_0x2524ec['status']),console['log'](_0x5f3baa(0x1d8),_0xee4765+'ms');if(!_0x2524ec['ok']){const _0x51c8d8=await _0x2524ec[_0x5f3baa(0x1ed)]();console[_0x5f3baa(0x1da)]('HTTP\x20Status:',_0x2524ec[_0x5f3baa(0x194)]),console[_0x5f3baa(0x1da)]('Response\x20Body:',_0x51c8d8),loggerService_1[_0x5f3baa(0x1ff)][_0x5f3baa(0x205)]('cointopay',_0x5f3baa(0x201),_0x2524ec[_0x5f3baa(0x194)],_0x51c8d8,_0xee4765),loggerService_1[_0x5f3baa(0x1ff)][_0x5f3baa(0x1e1)]('cointopay',_0x5f3baa(0x201),_0x5f3baa(0x1ad)+_0x2524ec[_0x5f3baa(0x194)]+':\x20'+_0x51c8d8);throw new Error(_0x5f3baa(0x1fa)+_0x2524ec[_0x5f3baa(0x194)]);}const _0x24ae3a=await _0x2524ec[_0x5f3baa(0x1ed)]();console['log'](_0x5f3baa(0x209),_0x24ae3a);let _0x152068;try{_0x152068=JSON[_0x5f3baa(0x1d6)](_0x24ae3a);}catch(_0x32508b){console['error'](_0x5f3baa(0x19d),_0x32508b),loggerService_1[_0x5f3baa(0x1ff)][_0x5f3baa(0x1e1)](_0x5f3baa(0x1a3),_0x5f3baa(0x201),_0x5f3baa(0x1cb)+_0x32508b);throw new Error(_0x5f3baa(0x190)+_0x24ae3a);}loggerService_1['loggerService'][_0x5f3baa(0x205)](_0x5f3baa(0x1a3),_0x5f3baa(0x201),_0x2524ec[_0x5f3baa(0x194)],_0x152068,_0xee4765),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1a4)),console[_0x5f3baa(0x1a1)]('Result:',_0x152068['result']),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1f9),_0x152068[_0x5f3baa(0x1b1)]),console['log']('Payment\x20Status:',_0x152068[_0x5f3baa(0x1ba)]?.['Status']),console['log']('Amount:',_0x152068[_0x5f3baa(0x1ba)]?.[_0x5f3baa(0x203)]),console['log'](_0x5f3baa(0x207),_0x152068[_0x5f3baa(0x1ba)]?.[_0x5f3baa(0x1c4)]);if(_0x152068[_0x5f3baa(0x1a2)]!==_0x5f3baa(0x1be)||_0x152068[_0x5f3baa(0x1b1)]!==0xc8){const _0x1eab9e=_0x152068[_0x5f3baa(0x1bb)]||_0x5f3baa(0x1f5);console[_0x5f3baa(0x1da)](_0x5f3baa(0x1ce)),console[_0x5f3baa(0x1da)](_0x5f3baa(0x204),_0x1eab9e),loggerService_1['loggerService']['logWhiteDomainError'](_0x5f3baa(0x1a3),'/status',_0x5f3baa(0x192)+_0x1eab9e);throw new Error(_0x5f3baa(0x1db)+_0x1eab9e);}if(!_0x152068[_0x5f3baa(0x1ba)]){console[_0x5f3baa(0x1da)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x5f3baa(0x1ff)]['logWhiteDomainError']('cointopay',_0x5f3baa(0x201),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5f3baa(0x1e3));}let _0x39e84e='PENDING';switch(_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x197)]?.['toLowerCase']()){case'paid':_0x39e84e=_0x5f3baa(0x1d2);break;case _0x5f3baa(0x1a0):case _0x5f3baa(0x1ee):case _0x5f3baa(0x1da):_0x39e84e=_0x5f3baa(0x1e4);break;case _0x5f3baa(0x1f8):case _0x5f3baa(0x1cc):_0x39e84e=_0x5f3baa(0x20b);break;case'waiting':case _0x5f3baa(0x1e0):case _0x5f3baa(0x1d4):case _0x5f3baa(0x195):default:_0x39e84e=_0x5f3baa(0x1b2);break;}let _0x353caa,_0x12ae2f;if(_0x152068['data'][_0x5f3baa(0x1d1)]){const _0x111984=_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1d1)];console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1a6),_0x111984);const _0x5281b1=_0x111984[_0x5f3baa(0x1dc)](/IBAN\s+([A-Z0-9]+)/i);_0x5281b1&&(_0x353caa=_0x5281b1[0x1],console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1c8),_0x353caa)),_0x12ae2f=_0x111984;}const _0x4c62d2={'iban':_0x353caa,'bankDetails':_0x12ae2f,'transactionId':_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x19c)],'coinAddress':_0x152068[_0x5f3baa(0x1ba)]['coinAddress'],'qrCodeUrl':_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x196)],'expiryTime':_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1c9)],'createdOn':_0x152068['data'][_0x5f3baa(0x1aa)],'confirmedOn':_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1d0)]};console[_0x5f3baa(0x1a1)](_0x5f3baa(0x200)),console['log'](_0x5f3baa(0x1a9),_0x152068[_0x5f3baa(0x1ba)]['Status'],'->',_0x39e84e),console[_0x5f3baa(0x1a1)]('Amount:',_0x152068['data']['Amount'],_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1c4)]),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1ec),_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x19c)]),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x198),_0x353caa||_0x5f3baa(0x18c)),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1df),_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1aa)]),console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1f4),_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x1d0)]||_0x5f3baa(0x1cf));if(_0x152068[_0x5f3baa(0x1ba)][_0x5f3baa(0x197)]?.['toLowerCase']()===_0x5f3baa(0x1e0))console[_0x5f3baa(0x1a1)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x152068['data'][_0x5f3baa(0x197)]?.[_0x5f3baa(0x19f)]()==='paid'&&console[_0x5f3baa(0x1a1)](_0x5f3baa(0x1f0));return{'status':_0x39e84e,'amount':parseFloat(_0x152068['data']['Amount'])||undefined,'currency':_0x152068[_0x5f3baa(0x1ba)]['inputCurrency']||_0x5f3baa(0x1ab),'paymentDetails':_0x4c62d2};}catch(_0x434630){console[_0x5f3baa(0x1da)](_0x5f3baa(0x1b4),_0x434630),loggerService_1[_0x5f3baa(0x1ff)]['logWhiteDomainError'](_0x5f3baa(0x1a3),_0x5f3baa(0x201),_0x434630);throw new Error(_0x5f3baa(0x1ea)+(_0x434630 instanceof Error?_0x434630['message']:'Unknown\x20error'));}}async[a41_0x57a04e(0x1c5)](_0x30adc0){const _0x363dfa=a41_0x57a04e,_0x426545=await this['checkPaymentStatus'](_0x30adc0);return{'status':_0x426545['status'],'amount':_0x426545['amount'],'currency':_0x426545[_0x363dfa(0x206)]};}async[a41_0x57a04e(0x1ca)](_0xf8e91d){const _0x54d267=a41_0x57a04e;console['log'](_0x54d267(0x19e),_0xf8e91d);let _0x529dac=_0x54d267(0x1b2);switch(_0xf8e91d[_0x54d267(0x194)]?.['toLowerCase']()){case _0x54d267(0x1e6):_0x529dac=_0x54d267(0x1d2);break;case _0x54d267(0x1a0):case _0x54d267(0x1ee):case _0x54d267(0x1da):_0x529dac=_0x54d267(0x1e4);break;case _0x54d267(0x1f8):case _0x54d267(0x1cc):_0x529dac=_0x54d267(0x20b);break;case'pending':case'waiting':case _0x54d267(0x1e0):case _0x54d267(0x195):default:_0x529dac='PENDING';break;}return{'paymentId':_0xf8e91d[_0x54d267(0x18f)]||_0xf8e91d[_0x54d267(0x1a8)]||'','status':_0x529dac,'amount':_0xf8e91d[_0x54d267(0x1b6)],'currency':_0xf8e91d[_0x54d267(0x206)]||_0x54d267(0x1ab)};}}exports[a41_0x57a04e(0x18d)]=CoinToPayService;