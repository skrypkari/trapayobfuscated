'use strict';const a44_0xd2f127=a44_0x4d40;(function(_0x62a8dd,_0x4492fa){const _0x1a3c56=a44_0x4d40,_0x58efdd=_0x62a8dd();while(!![]){try{const _0x376f85=-parseInt(_0x1a3c56(0x1bb))/0x1+parseInt(_0x1a3c56(0x1cf))/0x2*(-parseInt(_0x1a3c56(0x17b))/0x3)+-parseInt(_0x1a3c56(0x18e))/0x4*(-parseInt(_0x1a3c56(0x182))/0x5)+parseInt(_0x1a3c56(0x1c4))/0x6*(parseInt(_0x1a3c56(0x1bf))/0x7)+parseInt(_0x1a3c56(0x175))/0x8+parseInt(_0x1a3c56(0x185))/0x9*(-parseInt(_0x1a3c56(0x186))/0xa)+parseInt(_0x1a3c56(0x1dc))/0xb;if(_0x376f85===_0x4492fa)break;else _0x58efdd['push'](_0x58efdd['shift']());}catch(_0x3c2a5b){_0x58efdd['push'](_0x58efdd['shift']());}}}(a44_0x5a5e,0x7b271));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a44_0xd2f127(0x1cc)]=void 0x0;function a44_0x5a5e(){const _0x4828b=['Response\x20Body:','POST','Response\x20Time:','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','currency','status','loggerService','amount','Amount','PAID','3206128FTBuHc','coinAddress','CoinToPay\x20status\x20API\x20error:\x20','PENDING','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','172980MMADGF','Status:','fromEntries','IBAN:','toLowerCase','TransactionConfirmedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','18595dQdbcW','logWhiteDomainRequest','Payment\x20URL:','54SNOLrj','1559190XyQxTp','\x20EUR','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20error!\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','üè¶\x20Payment\x20Detail:','PaymentDetail','316JWzhEe','===\x20COINTOPAY\x20API\x20ERROR\x20===','HTTP\x20Status:','error','waiting','EUR','awaiting\x20fiat','Status','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','apiUrl','Incomplete\x20response:\x20missing\x20data','payment_url','gateway_payment_id','cancelled','Error\x20stack:','https://tesoft.uk/gateway/cointopay/status.php','log','Confirmed\x20On:','application/json','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','status_code','Status\x20Text:','result','ExpiryTime','Business\x20Error:\x20','Raw\x20Response\x20Body:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Error\x20message:','EXPIRED','cointopay','expired','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','FAILED','/create','stringify','entries','Currency:','CoinToPay\x20payment\x20status\x20check\x20error:','failed','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','message','logWhiteDomainError','paid','207088vyxsoP','timeout','/status','HTTP\x20','6182575DrwTtj','CreatedOn','match','../loggerService','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','6RYsnPe','stack','TransactionID','now','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','statusUrl','Error\x20details:','parse','CoinToPayService','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','URL:','20pGuCTr','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','inputCurrency','Unknown\x20error','data','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','checkPaymentStatus','merchant_reference_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','text','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay\x20API\x20error:\x20','not\x20found','7104273AvrmDs','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Headers:','statusText','Amount:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','üè¶\x20Extracted\x20IBAN:'];a44_0x5a5e=function(){return _0x4828b;};return a44_0x5a5e();}const loggerService_1=require(a44_0xd2f127(0x1c2));function a44_0x4d40(_0x3825e8,_0x8c98b5){const _0x5a5e5e=a44_0x5a5e();return a44_0x4d40=function(_0x4d4084,_0x3ce642){_0x4d4084=_0x4d4084-0x16f;let _0x43a402=_0x5a5e5e[_0x4d4084];return _0x43a402;},a44_0x4d40(_0x3825e8,_0x8c98b5);}class CoinToPayService{constructor(){const _0x3e1227=a44_0xd2f127;this['apiUrl']=_0x3e1227(0x1e7),this[_0x3e1227(0x1c9)]=_0x3e1227(0x19e),console['log'](_0x3e1227(0x197)),console['log']('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x401d95){const _0x11b292=a44_0xd2f127,{orderId:_0xa577ec,amount:_0x439416}=_0x401d95;console[_0x11b292(0x19f)](_0x11b292(0x1a2)+_0x439416+_0x11b292(0x187));const _0x57ea88={'amount':_0x439416},_0x376c8c=Date['now']();try{console[_0x11b292(0x19f)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x11b292(0x19f)](_0x11b292(0x1ce),this[_0x11b292(0x198)]),console[_0x11b292(0x19f)]('Request\x20Body:',JSON[_0x11b292(0x1b1)](_0x57ea88,null,0x2)),console[_0x11b292(0x19f)](_0x11b292(0x1e1),_0x439416,_0x11b292(0x1d4)),loggerService_1[_0x11b292(0x171)][_0x11b292(0x183)](_0x11b292(0x1ac),_0x11b292(0x1b0),_0x11b292(0x1e5),_0x57ea88);const _0x432fc4=await fetch(this[_0x11b292(0x198)],{'method':_0x11b292(0x1e5),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x11b292(0x1b1)](_0x57ea88)}),_0xdba550=Date['now']()-_0x376c8c;console[_0x11b292(0x19f)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x11b292(0x19f)](_0x11b292(0x17c),_0x432fc4['status']),console[_0x11b292(0x19f)](_0x11b292(0x1a4),_0x432fc4[_0x11b292(0x1e0)]),console['log'](_0x11b292(0x1df),Object[_0x11b292(0x17d)](_0x432fc4['headers'][_0x11b292(0x1b2)]())),console[_0x11b292(0x19f)](_0x11b292(0x1e6),_0xdba550+'ms');const _0x5e5fa2=await _0x432fc4[_0x11b292(0x1d8)]();console[_0x11b292(0x19f)](_0x11b292(0x1a8),_0x5e5fa2);if(!_0x432fc4['ok']){console[_0x11b292(0x191)](_0x11b292(0x18f)),console['error'](_0x11b292(0x190),_0x432fc4[_0x11b292(0x170)]),console[_0x11b292(0x191)](_0x11b292(0x1e4),_0x5e5fa2),loggerService_1[_0x11b292(0x171)][_0x11b292(0x1b6)](_0x11b292(0x1ac),_0x11b292(0x1b0),_0x432fc4[_0x11b292(0x170)],_0x5e5fa2,_0xdba550),loggerService_1[_0x11b292(0x171)][_0x11b292(0x1b9)](_0x11b292(0x1ac),_0x11b292(0x1b0),_0x11b292(0x1be)+_0x432fc4[_0x11b292(0x170)]+':\x20'+_0x5e5fa2);throw new Error(_0x11b292(0x189)+_0x432fc4[_0x11b292(0x170)]+',\x20body:\x20'+_0x5e5fa2);}let _0x1f426e;try{_0x1f426e=JSON[_0x11b292(0x1cb)](_0x5e5fa2);}catch(_0x160227){console[_0x11b292(0x191)](_0x11b292(0x18a),_0x160227),loggerService_1[_0x11b292(0x171)][_0x11b292(0x1b9)](_0x11b292(0x1ac),_0x11b292(0x1b0),'JSON\x20Parse\x20Error:\x20'+_0x160227);throw new Error(_0x11b292(0x17a)+_0x5e5fa2);}console[_0x11b292(0x19f)](_0x11b292(0x1de)),console['log']('Parsed\x20Result:',JSON[_0x11b292(0x1b1)](_0x1f426e,null,0x2)),loggerService_1[_0x11b292(0x171)]['logWhiteDomainResponse'](_0x11b292(0x1ac),'/create',_0x432fc4['status'],_0x1f426e,_0xdba550);if(_0x1f426e['error']){const _0x6c777a=_0x1f426e[_0x11b292(0x1b8)]||_0x1f426e['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x11b292(0x191)](_0x11b292(0x18b)),console[_0x11b292(0x191)]('Error\x20Message:',_0x6c777a),loggerService_1[_0x11b292(0x171)]['logWhiteDomainError'](_0x11b292(0x1ac),_0x11b292(0x1b0),_0x11b292(0x1a7)+_0x6c777a);throw new Error(_0x11b292(0x1da)+_0x6c777a);}if(!_0x1f426e[_0x11b292(0x19a)]||!_0x1f426e[_0x11b292(0x19b)]){console[_0x11b292(0x191)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x11b292(0x191)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x11b292(0x191)]('Response\x20data:',_0x1f426e),loggerService_1[_0x11b292(0x171)][_0x11b292(0x1b9)](_0x11b292(0x1ac),_0x11b292(0x1b0),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x11b292(0x188));}return console[_0x11b292(0x19f)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x11b292(0x19f)]('Gateway\x20Payment\x20ID:',_0x1f426e[_0x11b292(0x19b)]),console['log'](_0x11b292(0x184),_0x1f426e[_0x11b292(0x19a)]),console[_0x11b292(0x19f)](_0x11b292(0x1e1),_0x439416,_0x11b292(0x193)),{'gateway_payment_id':_0x1f426e[_0x11b292(0x19b)],'payment_url':_0x1f426e['payment_url']};}catch(_0x23984f){console['error'](_0x11b292(0x1cd)),console[_0x11b292(0x191)](_0x11b292(0x1ca),_0x23984f),loggerService_1[_0x11b292(0x171)][_0x11b292(0x1b9)](_0x11b292(0x1ac),_0x11b292(0x1b0),_0x23984f);if(_0x23984f instanceof Error){console[_0x11b292(0x191)](_0x11b292(0x1aa),_0x23984f[_0x11b292(0x1b8)]),console[_0x11b292(0x191)](_0x11b292(0x19d),_0x23984f[_0x11b292(0x1c5)]);throw new Error(_0x11b292(0x1ae)+_0x23984f[_0x11b292(0x1b8)]);}throw new Error(_0x11b292(0x181));}}async[a44_0xd2f127(0x1d5)](_0x31b4fe){const _0x547045=a44_0xd2f127,_0x17f30d=Date['now']();try{console['log'](_0x547045(0x1a9)+_0x31b4fe);const _0x1a5160={'gatewayPaymentId':_0x31b4fe};loggerService_1[_0x547045(0x171)][_0x547045(0x183)]('cointopay',_0x547045(0x1bd),_0x547045(0x1e5),_0x1a5160);const _0x1f68bf=await fetch(this['statusUrl'],{'method':_0x547045(0x1e5),'headers':{'Content-Type':_0x547045(0x1a1),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x547045(0x1b1)](_0x1a5160)}),_0x30946f=Date[_0x547045(0x1c7)]()-_0x17f30d;console['log'](_0x547045(0x1b7)),console['log']('Status:',_0x1f68bf[_0x547045(0x170)]),console[_0x547045(0x19f)](_0x547045(0x1e6),_0x30946f+'ms');if(!_0x1f68bf['ok']){const _0x1cc1eb=await _0x1f68bf['text']();console[_0x547045(0x191)](_0x547045(0x190),_0x1f68bf[_0x547045(0x170)]),console['error']('Response\x20Body:',_0x1cc1eb),loggerService_1[_0x547045(0x171)]['logWhiteDomainResponse'](_0x547045(0x1ac),_0x547045(0x1bd),_0x1f68bf[_0x547045(0x170)],_0x1cc1eb,_0x30946f),loggerService_1[_0x547045(0x171)][_0x547045(0x1b9)](_0x547045(0x1ac),'/status',_0x547045(0x1be)+_0x1f68bf[_0x547045(0x170)]+':\x20'+_0x1cc1eb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1f68bf['status']);}const _0x49600a=await _0x1f68bf['text']();console[_0x547045(0x19f)](_0x547045(0x1a8),_0x49600a);let _0x108328;try{_0x108328=JSON['parse'](_0x49600a);}catch(_0x242aa4){console[_0x547045(0x191)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x242aa4),loggerService_1[_0x547045(0x171)]['logWhiteDomainError'](_0x547045(0x1ac),_0x547045(0x1bd),'JSON\x20Parse\x20Error:\x20'+_0x242aa4);throw new Error(_0x547045(0x1d7)+_0x49600a);}loggerService_1[_0x547045(0x171)][_0x547045(0x1b6)](_0x547045(0x1ac),_0x547045(0x1bd),_0x1f68bf[_0x547045(0x170)],_0x108328,_0x30946f),console['log'](_0x547045(0x1c3)),console[_0x547045(0x19f)]('Result:',_0x108328[_0x547045(0x1a5)]),console['log']('Status\x20Code:',_0x108328['status_code']),console[_0x547045(0x19f)]('Payment\x20Status:',_0x108328[_0x547045(0x1d3)]?.[_0x547045(0x195)]),console[_0x547045(0x19f)](_0x547045(0x1e1),_0x108328[_0x547045(0x1d3)]?.[_0x547045(0x173)]),console[_0x547045(0x19f)](_0x547045(0x1b3),_0x108328['data']?.[_0x547045(0x1d1)]);if(_0x108328[_0x547045(0x1a5)]!=='success'||_0x108328[_0x547045(0x1a3)]!==0xc8){const _0x30239d=_0x108328['message']||_0x547045(0x1c8);console['error'](_0x547045(0x1e8)),console[_0x547045(0x191)](_0x547045(0x179),_0x30239d),loggerService_1[_0x547045(0x171)][_0x547045(0x1b9)](_0x547045(0x1ac),'/status','Status\x20API\x20Error:\x20'+_0x30239d);throw new Error(_0x547045(0x177)+_0x30239d);}if(!_0x108328[_0x547045(0x1d3)]){console[_0x547045(0x191)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x547045(0x191)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x547045(0x1b9)]('cointopay',_0x547045(0x1bd),_0x547045(0x199));throw new Error(_0x547045(0x1e2));}let _0x273c94='PENDING';switch(_0x108328[_0x547045(0x1d3)][_0x547045(0x195)]?.['toLowerCase']()){case _0x547045(0x1ba):_0x273c94=_0x547045(0x174);break;case _0x547045(0x19c):case _0x547045(0x1b5):case _0x547045(0x191):_0x273c94=_0x547045(0x1af);break;case'expired':case _0x547045(0x1bc):_0x273c94=_0x547045(0x1ab);break;case _0x547045(0x192):case _0x547045(0x194):case'pending':case'created':default:_0x273c94=_0x547045(0x178);break;}let _0xd0279c,_0x3767a3;if(_0x108328['data']['PaymentDetail']){const _0x1e00ee=_0x108328[_0x547045(0x1d3)][_0x547045(0x18d)];console['log'](_0x547045(0x18c),_0x1e00ee);const _0x3740a4=_0x1e00ee[_0x547045(0x1c1)](/IBAN\s+([A-Z0-9]+)/i);_0x3740a4&&(_0xd0279c=_0x3740a4[0x1],console[_0x547045(0x19f)](_0x547045(0x1e3),_0xd0279c)),_0x3767a3=_0x1e00ee;}const _0x4f6c50={'iban':_0xd0279c,'bankDetails':_0x3767a3,'transactionId':_0x108328[_0x547045(0x1d3)][_0x547045(0x1c6)],'coinAddress':_0x108328[_0x547045(0x1d3)][_0x547045(0x176)],'qrCodeUrl':_0x108328['data']['QRCodeURL'],'expiryTime':_0x108328[_0x547045(0x1d3)][_0x547045(0x1a6)],'createdOn':_0x108328[_0x547045(0x1d3)][_0x547045(0x1c0)],'confirmedOn':_0x108328['data'][_0x547045(0x180)]};console[_0x547045(0x19f)](_0x547045(0x1dd)),console['log']('Status:',_0x108328[_0x547045(0x1d3)][_0x547045(0x195)],'->',_0x273c94),console[_0x547045(0x19f)](_0x547045(0x1e1),_0x108328[_0x547045(0x1d3)][_0x547045(0x173)],_0x108328[_0x547045(0x1d3)][_0x547045(0x1d1)]),console[_0x547045(0x19f)]('Transaction\x20ID:',_0x108328[_0x547045(0x1d3)]['TransactionID']),console['log'](_0x547045(0x17e),_0xd0279c||_0x547045(0x1db)),console[_0x547045(0x19f)]('Created\x20On:',_0x108328[_0x547045(0x1d3)][_0x547045(0x1c0)]),console['log'](_0x547045(0x1a0),_0x108328[_0x547045(0x1d3)][_0x547045(0x180)]||'not\x20confirmed');if(_0x108328['data'][_0x547045(0x195)]?.[_0x547045(0x17f)]()==='awaiting\x20fiat')console['log'](_0x547045(0x1d0));else _0x108328['data']['Status']?.['toLowerCase']()===_0x547045(0x1ba)&&console['log'](_0x547045(0x1d9));return{'status':_0x273c94,'amount':parseFloat(_0x108328[_0x547045(0x1d3)][_0x547045(0x173)])||undefined,'currency':_0x108328[_0x547045(0x1d3)]['inputCurrency']||_0x547045(0x193),'paymentDetails':_0x4f6c50};}catch(_0xea815b){console[_0x547045(0x191)](_0x547045(0x1b4),_0xea815b),loggerService_1[_0x547045(0x171)]['logWhiteDomainError']('cointopay',_0x547045(0x1bd),_0xea815b);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0xea815b instanceof Error?_0xea815b[_0x547045(0x1b8)]:_0x547045(0x1d2)));}}async['verifyPayment'](_0x3120d4){const _0x2936ab=a44_0xd2f127,_0x24a41a=await this[_0x2936ab(0x1d5)](_0x3120d4);return{'status':_0x24a41a[_0x2936ab(0x170)],'amount':_0x24a41a[_0x2936ab(0x172)],'currency':_0x24a41a[_0x2936ab(0x16f)]};}async['processWebhook'](_0x3c0cd7){const _0x20f56f=a44_0xd2f127;console[_0x20f56f(0x19f)](_0x20f56f(0x196),_0x3c0cd7);let _0x223535=_0x20f56f(0x178);switch(_0x3c0cd7[_0x20f56f(0x170)]?.['toLowerCase']()){case _0x20f56f(0x1ba):_0x223535='PAID';break;case _0x20f56f(0x19c):case _0x20f56f(0x1b5):case'error':_0x223535=_0x20f56f(0x1af);break;case _0x20f56f(0x1ad):case _0x20f56f(0x1bc):_0x223535=_0x20f56f(0x1ab);break;case'pending':case _0x20f56f(0x192):case'awaiting\x20fiat':case'created':default:_0x223535='PENDING';break;}return{'paymentId':_0x3c0cd7['order_id']||_0x3c0cd7[_0x20f56f(0x1d6)]||'','status':_0x223535,'amount':_0x3c0cd7['amount'],'currency':_0x3c0cd7[_0x20f56f(0x16f)]||_0x20f56f(0x193)};}}exports[a44_0xd2f127(0x1cc)]=CoinToPayService;