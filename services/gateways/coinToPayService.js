'use strict';function a40_0x2254(_0x35eed7,_0x34bfea){const _0xd7c070=a40_0xd7c0();return a40_0x2254=function(_0x225468,_0x541dca){_0x225468=_0x225468-0x68;let _0x13b6f8=_0xd7c070[_0x225468];return _0x13b6f8;},a40_0x2254(_0x35eed7,_0x34bfea);}function a40_0xd7c0(){const _0x53b063=['https://tesoft.uk/gateway/cointopay/','Status\x20API\x20Error:\x20','598220vcjuOm','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','1231258XhilSO','Missing\x20data\x20in\x20response','18satmdt','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','33jrFovp','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','waiting','gateway_payment_id','URL:','TransactionID','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','__esModule','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','status_code','198356NyGuUH','üè¶\x20Extracted\x20IBAN:','payment_url','POST','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','1nwIpAf','merchant_reference_id','TransactionConfirmedOn','Response\x20data:','Currency:','Incomplete\x20response:\x20missing\x20data','1085532yCoSgQ','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','cancelled','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','failed','JSON\x20Parse\x20Error:\x20','PAID','toLowerCase','Error\x20message:','Error\x20Message:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','data','üè¶\x20Payment\x20Detail:','\x20EUR','CoinToPay\x20API\x20error:\x20','statusText','/create','Unknown\x20error','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','CoinToPay\x20status\x20API\x20error:\x20','text','headers','application/json','statusUrl','Confirmed\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','logWhiteDomainRequest','not\x20confirmed','IBAN:','Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','apiUrl','entries','HTTP\x20Status:','coinAddress','Status','PaymentDetail','Created\x20On:','cointopay','logWhiteDomainResponse','expired','checkPaymentStatus','287360jkFisc','Amount','logWhiteDomainError','Status:','now','Status\x20Text:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Result:','HTTP\x20error!\x20status:\x20','EUR','paid','FAILED','Parsed\x20Result:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Error\x20details:','===\x20COINTOPAY\x20API\x20ERROR\x20===','awaiting\x20fiat','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===',',\x20body:\x20','fromEntries','stringify','Payment\x20Status:','parse','QRCodeURL','message','ExpiryTime','inputCurrency','824305wTIoCw','../loggerService','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','timeout','success','stack','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','https://tesoft.uk/gateway/cointopay/status.php','status','3LQYYae','CreatedOn','log','Request\x20Body:','Response\x20Time:','Status\x20Code:','336316WDxMpE','currency','EXPIRED','Amount:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Raw\x20Response\x20Body:','loggerService','error','processWebhook'];a40_0xd7c0=function(){return _0x53b063;};return a40_0xd7c0();}const a40_0x3ac778=a40_0x2254;(function(_0x5ddef7,_0x2e4bbe){const _0x39dbe3=a40_0x2254,_0x25879d=_0x5ddef7();while(!![]){try{const _0x5f0592=parseInt(_0x39dbe3(0xd9))/0x1*(parseInt(_0x39dbe3(0xd4))/0x2)+-parseInt(_0x39dbe3(0xb0))/0x3*(-parseInt(_0x39dbe3(0xb6))/0x4)+-parseInt(_0x39dbe3(0xa7))/0x5+parseInt(_0x39dbe3(0xdf))/0x6+parseInt(_0x39dbe3(0xc4))/0x7+-parseInt(_0x39dbe3(0x8b))/0x8*(parseInt(_0x39dbe3(0xc6))/0x9)+-parseInt(_0x39dbe3(0xc1))/0xa*(parseInt(_0x39dbe3(0xc8))/0xb);if(_0x5f0592===_0x2e4bbe)break;else _0x25879d['push'](_0x25879d['shift']());}catch(_0x4eddea){_0x25879d['push'](_0x25879d['shift']());}}}(a40_0xd7c0,0x1e402));Object['defineProperty'](exports,a40_0x3ac778(0xcf),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x3ac778(0xa8));class CoinToPayService{constructor(){const _0x434a52=a40_0x3ac778;this[_0x434a52(0x80)]=_0x434a52(0xbf),this['statusUrl']=_0x434a52(0xae),console[_0x434a52(0xb2)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x434a52(0xb2)]('üìä\x20Status\x20check\x20URL:',this[_0x434a52(0x77)]);}async['createPaymentLink'](_0xcacb0f){const _0x2c9406=a40_0x3ac778,{orderId:_0x55e9fa,amount:_0x1a1c5}=_0xcacb0f;console[_0x2c9406(0xb2)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x1a1c5+_0x2c9406(0x6c));const _0x54ab1b={'amount':_0x1a1c5},_0x1005e5=Date[_0x2c9406(0x8f)]();try{console[_0x2c9406(0xb2)](_0x2c9406(0xd8)),console[_0x2c9406(0xb2)](_0x2c9406(0xcc),this['apiUrl']),console[_0x2c9406(0xb2)](_0x2c9406(0xb3),JSON['stringify'](_0x54ab1b,null,0x2)),console['log']('Amount:',_0x1a1c5,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x7a)](_0x2c9406(0x87),_0x2c9406(0x6f),_0x2c9406(0xd7),_0x54ab1b);const _0x289dc1=await fetch(this[_0x2c9406(0x80)],{'method':_0x2c9406(0xd7),'headers':{'Content-Type':_0x2c9406(0x76),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x54ab1b)}),_0x2d4daf=Date['now']()-_0x1005e5;console[_0x2c9406(0xb2)](_0x2c9406(0xd0)),console[_0x2c9406(0xb2)](_0x2c9406(0x8e),_0x289dc1['status']),console['log'](_0x2c9406(0x90),_0x289dc1[_0x2c9406(0x6e)]),console['log']('Headers:',Object[_0x2c9406(0x9f)](_0x289dc1[_0x2c9406(0x75)][_0x2c9406(0x81)]())),console[_0x2c9406(0xb2)](_0x2c9406(0xb4),_0x2d4daf+'ms');const _0x3a80c2=await _0x289dc1[_0x2c9406(0x74)]();console[_0x2c9406(0xb2)](_0x2c9406(0xbb),_0x3a80c2);if(!_0x289dc1['ok']){console['error'](_0x2c9406(0x9b)),console[_0x2c9406(0xbd)]('HTTP\x20Status:',_0x289dc1[_0x2c9406(0xaf)]),console[_0x2c9406(0xbd)](_0x2c9406(0x7d),_0x3a80c2),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x88)](_0x2c9406(0x87),_0x2c9406(0x6f),_0x289dc1[_0x2c9406(0xaf)],_0x3a80c2,_0x2d4daf),loggerService_1[_0x2c9406(0xbc)]['logWhiteDomainError'](_0x2c9406(0x87),_0x2c9406(0x6f),'HTTP\x20'+_0x289dc1[_0x2c9406(0xaf)]+':\x20'+_0x3a80c2);throw new Error(_0x2c9406(0x93)+_0x289dc1['status']+_0x2c9406(0x9e)+_0x3a80c2);}let _0x178a7b;try{_0x178a7b=JSON[_0x2c9406(0xa2)](_0x3a80c2);}catch(_0x32b701){console[_0x2c9406(0xbd)](_0x2c9406(0xc2),_0x32b701),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x8d)](_0x2c9406(0x87),_0x2c9406(0x6f),_0x2c9406(0xe6)+_0x32b701);throw new Error(_0x2c9406(0x99)+_0x3a80c2);}console[_0x2c9406(0xb2)](_0x2c9406(0xd2)),console[_0x2c9406(0xb2)](_0x2c9406(0x97),JSON['stringify'](_0x178a7b,null,0x2)),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x88)](_0x2c9406(0x87),_0x2c9406(0x6f),_0x289dc1[_0x2c9406(0xaf)],_0x178a7b,_0x2d4daf);if(_0x178a7b['error']){const _0x15958e=_0x178a7b[_0x2c9406(0xa4)]||_0x178a7b[_0x2c9406(0xbd)]||_0x2c9406(0x7e);console[_0x2c9406(0xbd)](_0x2c9406(0x71)),console[_0x2c9406(0xbd)](_0x2c9406(0xea),_0x15958e),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x8d)](_0x2c9406(0x87),_0x2c9406(0x6f),'Business\x20Error:\x20'+_0x15958e);throw new Error(_0x2c9406(0x6d)+_0x15958e);}if(!_0x178a7b['payment_url']||!_0x178a7b[_0x2c9406(0xcb)]){console[_0x2c9406(0xbd)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2c9406(0xbd)](_0x2c9406(0x91)),console[_0x2c9406(0xbd)](_0x2c9406(0xdc),_0x178a7b),loggerService_1[_0x2c9406(0xbc)][_0x2c9406(0x8d)](_0x2c9406(0x87),_0x2c9406(0x6f),_0x2c9406(0xad));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x2c9406(0xb2)](_0x2c9406(0x69)),console[_0x2c9406(0xb2)]('Gateway\x20Payment\x20ID:',_0x178a7b[_0x2c9406(0xcb)]),console[_0x2c9406(0xb2)]('Payment\x20URL:',_0x178a7b[_0x2c9406(0xd6)]),console[_0x2c9406(0xb2)](_0x2c9406(0xb9),_0x1a1c5,_0x2c9406(0x94)),{'gateway_payment_id':_0x178a7b[_0x2c9406(0xcb)],'payment_url':_0x178a7b['payment_url']};}catch(_0x3d73e8){console['error'](_0x2c9406(0xc7)),console[_0x2c9406(0xbd)](_0x2c9406(0x9a),_0x3d73e8),loggerService_1[_0x2c9406(0xbc)]['logWhiteDomainError'](_0x2c9406(0x87),_0x2c9406(0x6f),_0x3d73e8);if(_0x3d73e8 instanceof Error){console['error'](_0x2c9406(0xe9),_0x3d73e8['message']),console[_0x2c9406(0xbd)]('Error\x20stack:',_0x3d73e8[_0x2c9406(0xac)]);throw new Error(_0x2c9406(0x98)+_0x3d73e8['message']);}throw new Error(_0x2c9406(0xe4));}}async[a40_0x3ac778(0x8a)](_0x225020){const _0xff90b7=a40_0x3ac778,_0x2bc2cb=Date['now']();try{console['log'](_0xff90b7(0xba)+_0x225020);const _0x6a7202={'gatewayPaymentId':_0x225020};loggerService_1[_0xff90b7(0xbc)][_0xff90b7(0x7a)](_0xff90b7(0x87),'/status',_0xff90b7(0xd7),_0x6a7202);const _0xbded41=await fetch(this[_0xff90b7(0x77)],{'method':'POST','headers':{'Content-Type':_0xff90b7(0x76),'Accept':_0xff90b7(0x76),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xff90b7(0xa0)](_0x6a7202)}),_0x4f66fb=Date[_0xff90b7(0x8f)]()-_0x2bc2cb;console['log'](_0xff90b7(0xd1)),console[_0xff90b7(0xb2)]('Status:',_0xbded41['status']),console[_0xff90b7(0xb2)]('Response\x20Time:',_0x4f66fb+'ms');if(!_0xbded41['ok']){const _0x119d62=await _0xbded41[_0xff90b7(0x74)]();console[_0xff90b7(0xbd)](_0xff90b7(0x82),_0xbded41[_0xff90b7(0xaf)]),console[_0xff90b7(0xbd)]('Response\x20Body:',_0x119d62),loggerService_1[_0xff90b7(0xbc)]['logWhiteDomainResponse'](_0xff90b7(0x87),'/status',_0xbded41[_0xff90b7(0xaf)],_0x119d62,_0x4f66fb),loggerService_1['loggerService'][_0xff90b7(0x8d)]('cointopay',_0xff90b7(0x7f),'HTTP\x20'+_0xbded41['status']+':\x20'+_0x119d62);throw new Error(_0xff90b7(0x93)+_0xbded41[_0xff90b7(0xaf)]);}const _0x34a4c8=await _0xbded41[_0xff90b7(0x74)]();console[_0xff90b7(0xb2)](_0xff90b7(0xbb),_0x34a4c8);let _0x49adf4;try{_0x49adf4=JSON[_0xff90b7(0xa2)](_0x34a4c8);}catch(_0x328b43){console[_0xff90b7(0xbd)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x328b43),loggerService_1[_0xff90b7(0xbc)][_0xff90b7(0x8d)]('cointopay',_0xff90b7(0x7f),_0xff90b7(0xe6)+_0x328b43);throw new Error(_0xff90b7(0x79)+_0x34a4c8);}loggerService_1[_0xff90b7(0xbc)]['logWhiteDomainResponse'](_0xff90b7(0x87),_0xff90b7(0x7f),_0xbded41['status'],_0x49adf4,_0x4f66fb),console['log'](_0xff90b7(0x9d)),console['log'](_0xff90b7(0x92),_0x49adf4['result']),console[_0xff90b7(0xb2)](_0xff90b7(0xb5),_0x49adf4[_0xff90b7(0xd3)]),console[_0xff90b7(0xb2)](_0xff90b7(0xa1),_0x49adf4[_0xff90b7(0x6a)]?.[_0xff90b7(0x84)]),console[_0xff90b7(0xb2)]('Amount:',_0x49adf4[_0xff90b7(0x6a)]?.[_0xff90b7(0x8c)]),console[_0xff90b7(0xb2)](_0xff90b7(0xdd),_0x49adf4[_0xff90b7(0x6a)]?.[_0xff90b7(0xa6)]);if(_0x49adf4['result']!==_0xff90b7(0xab)||_0x49adf4[_0xff90b7(0xd3)]!==0xc8){const _0x19672e=_0x49adf4[_0xff90b7(0xa4)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0xff90b7(0xbd)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0xff90b7(0xea),_0x19672e),loggerService_1[_0xff90b7(0xbc)][_0xff90b7(0x8d)]('cointopay',_0xff90b7(0x7f),_0xff90b7(0xc0)+_0x19672e);throw new Error(_0xff90b7(0x73)+_0x19672e);}if(!_0x49adf4[_0xff90b7(0x6a)]){console[_0xff90b7(0xbd)](_0xff90b7(0xc9)),console[_0xff90b7(0xbd)](_0xff90b7(0xc5)),loggerService_1[_0xff90b7(0xbc)][_0xff90b7(0x8d)](_0xff90b7(0x87),'/status',_0xff90b7(0xde));throw new Error(_0xff90b7(0xe2));}let _0x32fe5b=_0xff90b7(0x72);switch(_0x49adf4['data'][_0xff90b7(0x84)]?.[_0xff90b7(0xe8)]()){case _0xff90b7(0x95):_0x32fe5b=_0xff90b7(0xe7);break;case _0xff90b7(0xe3):case _0xff90b7(0xe5):case _0xff90b7(0xbd):_0x32fe5b=_0xff90b7(0x96);break;case _0xff90b7(0x89):case _0xff90b7(0xaa):_0x32fe5b=_0xff90b7(0xb8);break;case _0xff90b7(0xca):case _0xff90b7(0x9c):case'pending':case'created':default:_0x32fe5b=_0xff90b7(0x72);break;}let _0x511bb3,_0x2f5a58;if(_0x49adf4[_0xff90b7(0x6a)]['PaymentDetail']){const _0x31e4e0=_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0x85)];console[_0xff90b7(0xb2)](_0xff90b7(0x6b),_0x31e4e0);const _0x85220f=_0x31e4e0['match'](/IBAN\s+([A-Z0-9]+)/i);_0x85220f&&(_0x511bb3=_0x85220f[0x1],console[_0xff90b7(0xb2)](_0xff90b7(0xd5),_0x511bb3)),_0x2f5a58=_0x31e4e0;}const _0x553ef1={'iban':_0x511bb3,'bankDetails':_0x2f5a58,'transactionId':_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xcd)],'coinAddress':_0x49adf4['data'][_0xff90b7(0x83)],'qrCodeUrl':_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xa3)],'expiryTime':_0x49adf4['data'][_0xff90b7(0xa5)],'createdOn':_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xb1)],'confirmedOn':_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xdb)]};console[_0xff90b7(0xb2)](_0xff90b7(0xc3)),console[_0xff90b7(0xb2)](_0xff90b7(0x8e),_0x49adf4['data'][_0xff90b7(0x84)],'->',_0x32fe5b),console['log'](_0xff90b7(0xb9),_0x49adf4[_0xff90b7(0x6a)]['Amount'],_0x49adf4[_0xff90b7(0x6a)]['inputCurrency']),console[_0xff90b7(0xb2)]('Transaction\x20ID:',_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xcd)]),console[_0xff90b7(0xb2)](_0xff90b7(0x7c),_0x511bb3||'not\x20found'),console[_0xff90b7(0xb2)](_0xff90b7(0x86),_0x49adf4[_0xff90b7(0x6a)]['CreatedOn']),console[_0xff90b7(0xb2)](_0xff90b7(0x78),_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xdb)]||_0xff90b7(0x7b));if(_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0x84)]?.[_0xff90b7(0xe8)]()==='awaiting\x20fiat')console['log'](_0xff90b7(0xa9));else _0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0x84)]?.[_0xff90b7(0xe8)]()===_0xff90b7(0x95)&&console[_0xff90b7(0xb2)](_0xff90b7(0xe0));return{'status':_0x32fe5b,'amount':parseFloat(_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0x8c)])||undefined,'currency':_0x49adf4[_0xff90b7(0x6a)][_0xff90b7(0xa6)]||_0xff90b7(0x94),'paymentDetails':_0x553ef1};}catch(_0xd294f9){console['error'](_0xff90b7(0xe1),_0xd294f9),loggerService_1[_0xff90b7(0xbc)]['logWhiteDomainError'](_0xff90b7(0x87),_0xff90b7(0x7f),_0xd294f9);throw new Error(_0xff90b7(0x68)+(_0xd294f9 instanceof Error?_0xd294f9['message']:_0xff90b7(0x70)));}}async['verifyPayment'](_0x578278){const _0x30a2f1=a40_0x3ac778,_0x1b725b=await this['checkPaymentStatus'](_0x578278);return{'status':_0x1b725b[_0x30a2f1(0xaf)],'amount':_0x1b725b['amount'],'currency':_0x1b725b[_0x30a2f1(0xb7)]};}async[a40_0x3ac778(0xbe)](_0x13498e){const _0x2fe425=a40_0x3ac778;console['log'](_0x2fe425(0xce),_0x13498e);let _0x1bd8b3=_0x2fe425(0x72);switch(_0x13498e[_0x2fe425(0xaf)]?.[_0x2fe425(0xe8)]()){case _0x2fe425(0x95):_0x1bd8b3=_0x2fe425(0xe7);break;case'cancelled':case _0x2fe425(0xe5):case _0x2fe425(0xbd):_0x1bd8b3=_0x2fe425(0x96);break;case _0x2fe425(0x89):case _0x2fe425(0xaa):_0x1bd8b3=_0x2fe425(0xb8);break;case'pending':case _0x2fe425(0xca):case _0x2fe425(0x9c):case'created':default:_0x1bd8b3='PENDING';break;}return{'paymentId':_0x13498e['order_id']||_0x13498e[_0x2fe425(0xda)]||'','status':_0x1bd8b3,'amount':_0x13498e['amount'],'currency':_0x13498e[_0x2fe425(0xb7)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;