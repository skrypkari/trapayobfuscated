'use strict';const a40_0x331341=a40_0x4b5d;(function(_0x3ebf60,_0x4c934b){const _0x4dcccb=a40_0x4b5d,_0x49aea1=_0x3ebf60();while(!![]){try{const _0x183647=parseInt(_0x4dcccb(0x193))/0x1*(parseInt(_0x4dcccb(0x1d9))/0x2)+parseInt(_0x4dcccb(0x1f4))/0x3*(-parseInt(_0x4dcccb(0x1a0))/0x4)+-parseInt(_0x4dcccb(0x1cd))/0x5*(-parseInt(_0x4dcccb(0x18a))/0x6)+-parseInt(_0x4dcccb(0x209))/0x7+-parseInt(_0x4dcccb(0x207))/0x8+parseInt(_0x4dcccb(0x1c9))/0x9*(-parseInt(_0x4dcccb(0x1ca))/0xa)+-parseInt(_0x4dcccb(0x1a7))/0xb*(-parseInt(_0x4dcccb(0x1f5))/0xc);if(_0x183647===_0x4c934b)break;else _0x49aea1['push'](_0x49aea1['shift']());}catch(_0x156b4e){_0x49aea1['push'](_0x49aea1['shift']());}}}(a40_0x6aa1,0xb2f2e));function a40_0x4b5d(_0x50b6be,_0x34eb81){const _0x6aa16b=a40_0x6aa1();return a40_0x4b5d=function(_0x4b5d6a,_0x30a2a5){_0x4b5d6a=_0x4b5d6a-0x189;let _0x30b7a7=_0x6aa16b[_0x4b5d6a];return _0x30b7a7;},a40_0x4b5d(_0x50b6be,_0x34eb81);}Object[a40_0x331341(0x1e6)](exports,'__esModule',{'value':!![]}),exports[a40_0x331341(0x1f3)]=void 0x0;function a40_0x6aa1(){const _0x24b6cf=['/status','HTTP\x20error!\x20status:\x20','processWebhook','failed','text','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','log','FAILED','cancelled','data','CoinToPayService','710871wLXIra','66972xFbfcs','awaiting\x20fiat','Response\x20Time:','statusUrl','Payment\x20URL:','parse','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Payment\x20Status:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','amount','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','gateway_payment_id','Amount','Transaction\x20ID:','now','Incomplete\x20response:\x20missing\x20data','POST','5562496SQlgRm','../loggerService','527079TvFbqL','apiUrl','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','logWhiteDomainRequest','12oXlJHh','Business\x20Error:\x20','loggerService','TransactionID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Confirmed\x20On:','Error\x20message:','cointopay','Missing\x20data\x20in\x20response','4lvzcuE','EXPIRED','QRCodeURL','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status_code','Status:','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20Code:','TesSoft\x20Payment\x20System/1.0','createPaymentLink','paid','16HDLNQx','toLowerCase','üè¶\x20Extracted\x20IBAN:','TransactionConfirmedOn','Amount:','EUR','Status','5027WSLyac','payment_url','error','PaymentDetail','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','statusText','Result:','merchant_reference_id','entries','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','message','expired','not\x20found','https://tesoft.uk/gateway/cointopay/','Parsed\x20Result:','PENDING','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','logWhiteDomainError','status','Failed\x20to\x20parse\x20JSON\x20response:','success','\x20EUR','/create','currency','Status\x20Text:','Created\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20===','verifyPayment','URL:','waiting','Gateway\x20Payment\x20ID:','CoinToPay\x20payment\x20status\x20check\x20error:','54EeLkUZ','1903380yIOnYY','fromEntries','timeout','95515DnErja','checkPaymentStatus','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','inputCurrency','üè¶\x20Payment\x20Detail:','application/json','result','CreatedOn','HTTP\x20','coinAddress','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Error\x20details:','502358XMdNjb','JSON\x20Parse\x20Error:\x20','stringify','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Raw\x20Response\x20Body:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','headers','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20data:','HTTP\x20Status:','match','ExpiryTime','defineProperty',',\x20body:\x20'];a40_0x6aa1=function(){return _0x24b6cf;};return a40_0x6aa1();}const loggerService_1=require(a40_0x331341(0x208));class CoinToPayService{constructor(){const _0x11f984=a40_0x331341;this[_0x11f984(0x20a)]=_0x11f984(0x1b4),this[_0x11f984(0x1f8)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x11f984(0x197)),console['log']('üìä\x20Status\x20check\x20URL:',this[_0x11f984(0x1f8)]);}async[a40_0x331341(0x19e)](_0x1f5d44){const _0x418728=a40_0x331341,{orderId:_0x583cc5,amount:_0x48b18d}=_0x1f5d44;console[_0x418728(0x1ef)](_0x418728(0x1fe)+_0x48b18d+_0x418728(0x1be));const _0x4ddcef={'amount':_0x48b18d},_0x280549=Date[_0x418728(0x204)]();try{console['log'](_0x418728(0x1b7)),console[_0x418728(0x1ef)](_0x418728(0x1c5),this[_0x418728(0x20a)]),console[_0x418728(0x1ef)]('Request\x20Body:',JSON[_0x418728(0x1db)](_0x4ddcef,null,0x2)),console[_0x418728(0x1ef)](_0x418728(0x1a4),_0x48b18d,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x418728(0x18c)]['logWhiteDomainRequest'](_0x418728(0x191),_0x418728(0x1bf),_0x418728(0x206),_0x4ddcef);const _0x1c5c6b=await fetch(this[_0x418728(0x20a)],{'method':_0x418728(0x206),'headers':{'Content-Type':_0x418728(0x1d2),'Accept':_0x418728(0x1d2),'User-Agent':_0x418728(0x19d)},'body':JSON[_0x418728(0x1db)](_0x4ddcef)}),_0x3a7e38=Date[_0x418728(0x204)]()-_0x280549;console[_0x418728(0x1ef)](_0x418728(0x1fc)),console['log']('Status:',_0x1c5c6b['status']),console[_0x418728(0x1ef)](_0x418728(0x1c1),_0x1c5c6b[_0x418728(0x1ac)]),console['log']('Headers:',Object[_0x418728(0x1cb)](_0x1c5c6b[_0x418728(0x1e0)][_0x418728(0x1af)]())),console[_0x418728(0x1ef)]('Response\x20Time:',_0x3a7e38+'ms');const _0x3984b6=await _0x1c5c6b[_0x418728(0x1ec)]();console[_0x418728(0x1ef)]('Raw\x20Response\x20Body:',_0x3984b6);if(!_0x1c5c6b['ok']){console[_0x418728(0x1a9)](_0x418728(0x1c3)),console[_0x418728(0x1a9)](_0x418728(0x1e3),_0x1c5c6b[_0x418728(0x1bb)]),console[_0x418728(0x1a9)](_0x418728(0x1dc),_0x3984b6),loggerService_1[_0x418728(0x18c)]['logWhiteDomainResponse'](_0x418728(0x191),_0x418728(0x1bf),_0x1c5c6b[_0x418728(0x1bb)],_0x3984b6,_0x3a7e38),loggerService_1[_0x418728(0x18c)][_0x418728(0x1ba)](_0x418728(0x191),_0x418728(0x1bf),_0x418728(0x1d5)+_0x1c5c6b[_0x418728(0x1bb)]+':\x20'+_0x3984b6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c5c6b['status']+_0x418728(0x1e7)+_0x3984b6);}let _0x1cda10;try{_0x1cda10=JSON[_0x418728(0x1fa)](_0x3984b6);}catch(_0x407194){console[_0x418728(0x1a9)](_0x418728(0x1bc),_0x407194),loggerService_1[_0x418728(0x18c)][_0x418728(0x1ba)]('cointopay',_0x418728(0x1bf),_0x418728(0x1da)+_0x407194);throw new Error(_0x418728(0x1dd)+_0x3984b6);}console[_0x418728(0x1ef)](_0x418728(0x200)),console[_0x418728(0x1ef)](_0x418728(0x1b5),JSON[_0x418728(0x1db)](_0x1cda10,null,0x2)),loggerService_1['loggerService'][_0x418728(0x1ed)]('cointopay',_0x418728(0x1bf),_0x1c5c6b[_0x418728(0x1bb)],_0x1cda10,_0x3a7e38);if(_0x1cda10[_0x418728(0x1a9)]){const _0x179a68=_0x1cda10[_0x418728(0x1b1)]||_0x1cda10[_0x418728(0x1a9)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x418728(0x1a9)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x418728(0x1a9)](_0x418728(0x19a),_0x179a68),loggerService_1['loggerService']['logWhiteDomainError'](_0x418728(0x191),_0x418728(0x1bf),_0x418728(0x18b)+_0x179a68);throw new Error(_0x418728(0x1fb)+_0x179a68);}if(!_0x1cda10[_0x418728(0x1a8)]||!_0x1cda10[_0x418728(0x201)]){console['error'](_0x418728(0x1b8)),console[_0x418728(0x1a9)](_0x418728(0x1df)),console['error'](_0x418728(0x1e2),_0x1cda10),loggerService_1['loggerService'][_0x418728(0x1ba)](_0x418728(0x191),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x418728(0x1ef)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x418728(0x1ef)](_0x418728(0x1c7),_0x1cda10['gateway_payment_id']),console[_0x418728(0x1ef)](_0x418728(0x1f9),_0x1cda10[_0x418728(0x1a8)]),console[_0x418728(0x1ef)](_0x418728(0x1a4),_0x48b18d,_0x418728(0x1a5)),{'gateway_payment_id':_0x1cda10[_0x418728(0x201)],'payment_url':_0x1cda10[_0x418728(0x1a8)]};}catch(_0x20b9ed){console[_0x418728(0x1a9)](_0x418728(0x1d7)),console[_0x418728(0x1a9)](_0x418728(0x1d8),_0x20b9ed),loggerService_1[_0x418728(0x18c)]['logWhiteDomainError']('cointopay',_0x418728(0x1bf),_0x20b9ed);if(_0x20b9ed instanceof Error){console[_0x418728(0x1a9)](_0x418728(0x190),_0x20b9ed[_0x418728(0x1b1)]),console[_0x418728(0x1a9)]('Error\x20stack:',_0x20b9ed['stack']);throw new Error(_0x418728(0x1ab)+_0x20b9ed[_0x418728(0x1b1)]);}throw new Error(_0x418728(0x19b));}}async[a40_0x331341(0x1ce)](_0x3357a0){const _0x21e5cc=a40_0x331341,_0x51bf87=Date['now']();try{console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1cf)+_0x3357a0);const _0x440c2a={'gatewayPaymentId':_0x3357a0};loggerService_1[_0x21e5cc(0x18c)][_0x21e5cc(0x189)](_0x21e5cc(0x191),_0x21e5cc(0x1e8),_0x21e5cc(0x206),_0x440c2a);const _0x1cf63c=await fetch(this[_0x21e5cc(0x1f8)],{'method':'POST','headers':{'Content-Type':_0x21e5cc(0x1d2),'Accept':_0x21e5cc(0x1d2),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x440c2a)}),_0x337e5d=Date[_0x21e5cc(0x204)]()-_0x51bf87;console[_0x21e5cc(0x1ef)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x199),_0x1cf63c[_0x21e5cc(0x1bb)]),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1f7),_0x337e5d+'ms');if(!_0x1cf63c['ok']){const _0x1a5338=await _0x1cf63c['text']();console[_0x21e5cc(0x1a9)]('HTTP\x20Status:',_0x1cf63c[_0x21e5cc(0x1bb)]),console[_0x21e5cc(0x1a9)](_0x21e5cc(0x1dc),_0x1a5338),loggerService_1[_0x21e5cc(0x18c)][_0x21e5cc(0x1ed)](_0x21e5cc(0x191),_0x21e5cc(0x1e8),_0x1cf63c[_0x21e5cc(0x1bb)],_0x1a5338,_0x337e5d),loggerService_1[_0x21e5cc(0x18c)]['logWhiteDomainError'](_0x21e5cc(0x191),'/status',_0x21e5cc(0x1d5)+_0x1cf63c['status']+':\x20'+_0x1a5338);throw new Error(_0x21e5cc(0x1e9)+_0x1cf63c[_0x21e5cc(0x1bb)]);}const _0x23a952=await _0x1cf63c[_0x21e5cc(0x1ec)]();console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1de),_0x23a952);let _0x463beb;try{_0x463beb=JSON['parse'](_0x23a952);}catch(_0x5855bf){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5855bf),loggerService_1[_0x21e5cc(0x18c)][_0x21e5cc(0x1ba)](_0x21e5cc(0x191),'/status','JSON\x20Parse\x20Error:\x20'+_0x5855bf);throw new Error(_0x21e5cc(0x1b0)+_0x23a952);}loggerService_1['loggerService'][_0x21e5cc(0x1ed)](_0x21e5cc(0x191),_0x21e5cc(0x1e8),_0x1cf63c['status'],_0x463beb,_0x337e5d),console['log'](_0x21e5cc(0x18e)),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1ad),_0x463beb[_0x21e5cc(0x1d3)]),console['log'](_0x21e5cc(0x19c),_0x463beb[_0x21e5cc(0x198)]),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1fd),_0x463beb[_0x21e5cc(0x1f2)]?.[_0x21e5cc(0x1a6)]),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1a4),_0x463beb['data']?.[_0x21e5cc(0x202)]),console[_0x21e5cc(0x1ef)]('Currency:',_0x463beb[_0x21e5cc(0x1f2)]?.[_0x21e5cc(0x1d0)]);if(_0x463beb[_0x21e5cc(0x1d3)]!==_0x21e5cc(0x1bd)||_0x463beb[_0x21e5cc(0x198)]!==0xc8){const _0x420652=_0x463beb[_0x21e5cc(0x1b1)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x21e5cc(0x1a9)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x21e5cc(0x1a9)](_0x21e5cc(0x19a),_0x420652),loggerService_1[_0x21e5cc(0x18c)][_0x21e5cc(0x1ba)](_0x21e5cc(0x191),'/status','Status\x20API\x20Error:\x20'+_0x420652);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x420652);}if(!_0x463beb[_0x21e5cc(0x1f2)]){console['error'](_0x21e5cc(0x196)),console[_0x21e5cc(0x1a9)](_0x21e5cc(0x192)),loggerService_1['loggerService'][_0x21e5cc(0x1ba)](_0x21e5cc(0x191),'/status',_0x21e5cc(0x205));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x225bbe=_0x21e5cc(0x1b6);switch(_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1a6)]?.[_0x21e5cc(0x1a1)]()){case _0x21e5cc(0x19f):_0x225bbe='PAID';break;case _0x21e5cc(0x1f1):case _0x21e5cc(0x1eb):case _0x21e5cc(0x1a9):_0x225bbe='FAILED';break;case _0x21e5cc(0x1b2):case _0x21e5cc(0x1cc):_0x225bbe='EXPIRED';break;case _0x21e5cc(0x1c6):case'awaiting\x20fiat':case'pending':case'created':default:_0x225bbe='PENDING';break;}let _0x5e73f0,_0x148cb1;if(_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1aa)]){const _0x400fe3=_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1aa)];console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1d1),_0x400fe3);const _0x3d672f=_0x400fe3[_0x21e5cc(0x1e4)](/IBAN\s+([A-Z0-9]+)/i);_0x3d672f&&(_0x5e73f0=_0x3d672f[0x1],console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1a2),_0x5e73f0)),_0x148cb1=_0x400fe3;}const _0x363617={'iban':_0x5e73f0,'bankDetails':_0x148cb1,'transactionId':_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x18d)],'coinAddress':_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1d6)],'qrCodeUrl':_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x195)],'expiryTime':_0x463beb['data'][_0x21e5cc(0x1e5)],'createdOn':_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1d4)],'confirmedOn':_0x463beb['data'][_0x21e5cc(0x1a3)]};console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1ee)),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x199),_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1a6)],'->',_0x225bbe),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1a4),_0x463beb['data'][_0x21e5cc(0x202)],_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1d0)]),console['log'](_0x21e5cc(0x203),_0x463beb['data'][_0x21e5cc(0x18d)]),console[_0x21e5cc(0x1ef)]('IBAN:',_0x5e73f0||_0x21e5cc(0x1b3)),console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1c2),_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1d4)]),console['log'](_0x21e5cc(0x18f),_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1a3)]||'not\x20confirmed');if(_0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1a6)]?.['toLowerCase']()===_0x21e5cc(0x1f6))console[_0x21e5cc(0x1ef)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x463beb[_0x21e5cc(0x1f2)][_0x21e5cc(0x1a6)]?.[_0x21e5cc(0x1a1)]()===_0x21e5cc(0x19f)&&console[_0x21e5cc(0x1ef)](_0x21e5cc(0x1e1));return{'status':_0x225bbe,'amount':parseFloat(_0x463beb[_0x21e5cc(0x1f2)]['Amount'])||undefined,'currency':_0x463beb['data'][_0x21e5cc(0x1d0)]||_0x21e5cc(0x1a5),'paymentDetails':_0x363617};}catch(_0x4d3bac){console[_0x21e5cc(0x1a9)](_0x21e5cc(0x1c8),_0x4d3bac),loggerService_1['loggerService'][_0x21e5cc(0x1ba)](_0x21e5cc(0x191),_0x21e5cc(0x1e8),_0x4d3bac);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x4d3bac instanceof Error?_0x4d3bac[_0x21e5cc(0x1b1)]:_0x21e5cc(0x1b9)));}}async[a40_0x331341(0x1c4)](_0x3424c4){const _0x3c9bcd=a40_0x331341,_0x4f6317=await this[_0x3c9bcd(0x1ce)](_0x3424c4);return{'status':_0x4f6317[_0x3c9bcd(0x1bb)],'amount':_0x4f6317[_0x3c9bcd(0x1ff)],'currency':_0x4f6317[_0x3c9bcd(0x1c0)]};}async[a40_0x331341(0x1ea)](_0x5937ef){const _0x5240de=a40_0x331341;console['log'](_0x5240de(0x20b),_0x5937ef);let _0x152064=_0x5240de(0x1b6);switch(_0x5937ef[_0x5240de(0x1bb)]?.['toLowerCase']()){case _0x5240de(0x19f):_0x152064='PAID';break;case _0x5240de(0x1f1):case _0x5240de(0x1eb):case _0x5240de(0x1a9):_0x152064=_0x5240de(0x1f0);break;case'expired':case _0x5240de(0x1cc):_0x152064=_0x5240de(0x194);break;case'pending':case _0x5240de(0x1c6):case _0x5240de(0x1f6):case'created':default:_0x152064='PENDING';break;}return{'paymentId':_0x5937ef['order_id']||_0x5937ef[_0x5240de(0x1ae)]||'','status':_0x152064,'amount':_0x5937ef[_0x5240de(0x1ff)],'currency':_0x5937ef[_0x5240de(0x1c0)]||_0x5240de(0x1a5)};}}exports[a40_0x331341(0x1f3)]=CoinToPayService;