'use strict';const a55_0x332e0e=a55_0x57d8;function a55_0x5ce0(){const _0x58ca80=['JSON\x20Parse\x20Error:\x20','pending','amount','statusUrl','application/json','awaiting\x20fiat','Payment\x20System/1.0','Failed\x20to\x20parse\x20JSON\x20response:','currency','PENDING','stringify','CreatedOn','logWhiteDomainResponse','now','timeout','/create','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','data','EUR','Status\x20Code:','2084FdxAzI','text','paid','Business\x20Error:\x20','message','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20Body:','status_code','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ðŸ“Š\x20Status\x20check\x20URL:','HTTP\x20error!\x20status:\x20','status','CoinToPay\x20API\x20error:\x20','QRCodeURL','loggerService','Currency:','IBAN:','created','Raw\x20Response\x20Body:','5109624PYfUma','Amount','inputCurrency','FAILED','TransactionConfirmedOn','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','8208914wmfXLz','__esModule','Response\x20data:','apiUrl','137644dhdGTa','verifyPayment','expired','fromEntries','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Parsed\x20Result:','EXPIRED','success','Error\x20Message:','PAID','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','createPaymentLink','/status','cointopay','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20Time:','CoinToPayService','POST','error','https://tesoft.uk/gateway/cointopay/status.php','245gJEeeA','Payment\x20Status:','gateway_payment_id','logWhiteDomainRequest','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Incomplete\x20response:\x20missing\x20data','coinAddress','===\x20COINTOPAY\x20SUCCESS\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','not\x20confirmed','HTTP\x20Status:','Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','order_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','toLowerCase','cancelled','merchant_reference_id','Error\x20details:','not\x20found','Payment\x20URL\x20(original):','Error\x20stack:','logWhiteDomainError','CoinToPay\x20status\x20API\x20error:\x20','17109207UyJfFX','waiting','URL:','parse','stack','Confirmed\x20On:','processWebhook','Created\x20On:',',\x20body:\x20','../loggerService','ðŸ¦\x20Extracted\x20IBAN:','checkPaymentStatus','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','result','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Amount:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Status','Result:','3180522RdvuvX','ExpiryTime','payment_url','log','PaymentDetail','HTTP\x20','entries','3174702SSyFVg','https://tesoft.uk/gateway/cointopay/','376hxSBUx'];a55_0x5ce0=function(){return _0x58ca80;};return a55_0x5ce0();}(function(_0x3e10d6,_0x12d8ba){const _0x1e3b41=a55_0x57d8,_0x178e91=_0x3e10d6();while(!![]){try{const _0x158b58=parseInt(_0x1e3b41(0x20f))/0x1*(-parseInt(_0x1e3b41(0x224))/0x2)+-parseInt(_0x1e3b41(0x206))/0x3+-parseInt(_0x1e3b41(0x242))/0x4*(-parseInt(_0x1e3b41(0x258))/0x5)+parseInt(_0x1e3b41(0x20d))/0x6+-parseInt(_0x1e3b41(0x23e))/0x7+-parseInt(_0x1e3b41(0x238))/0x8+parseInt(_0x1e3b41(0x1f3))/0x9;if(_0x158b58===_0x12d8ba)break;else _0x178e91['push'](_0x178e91['shift']());}catch(_0x1fbbd3){_0x178e91['push'](_0x178e91['shift']());}}}(a55_0x5ce0,0xd03ac));function a55_0x57d8(_0x24c9ec,_0x12544d){_0x24c9ec=_0x24c9ec-0x1ec;const _0x5ce042=a55_0x5ce0();let _0x57d8b0=_0x5ce042[_0x24c9ec];return _0x57d8b0;}Object['defineProperty'](exports,a55_0x332e0e(0x23f),{'value':!![]}),exports[a55_0x332e0e(0x254)]=void 0x0;const loggerService_1=require(a55_0x332e0e(0x1fc));class CoinToPayService{constructor(){const _0x345483=a55_0x332e0e;this['apiUrl']=_0x345483(0x20e),this[_0x345483(0x213)]=_0x345483(0x257),console[_0x345483(0x209)]('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x345483(0x22e),this['statusUrl']);}async[a55_0x332e0e(0x24e)](_0x18eb60){const _0x2b78f3=a55_0x332e0e,{orderId:_0x2fdcb1,amount:_0x9d97f5}=_0x18eb60;console['log'](_0x2b78f3(0x262)+_0x9d97f5+'\x20EUR');const _0x2c3b78={'amount':_0x9d97f5},_0x22199d=Date[_0x2b78f3(0x21d)]();try{console[_0x2b78f3(0x209)](_0x2b78f3(0x267)),console['log'](_0x2b78f3(0x1f5),this[_0x2b78f3(0x241)]),console[_0x2b78f3(0x209)](_0x2b78f3(0x25c),JSON[_0x2b78f3(0x21a)](_0x2c3b78,null,0x2)),console[_0x2b78f3(0x209)](_0x2b78f3(0x202),_0x9d97f5,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2b78f3(0x233)][_0x2b78f3(0x25b)](_0x2b78f3(0x250),'/create',_0x2b78f3(0x255),_0x2c3b78);const _0x3f4844=await fetch(this[_0x2b78f3(0x241)],{'method':_0x2b78f3(0x255),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x2c3b78)}),_0x31f76c=Date['now']()-_0x22199d;console['log'](_0x2b78f3(0x229)),console[_0x2b78f3(0x209)](_0x2b78f3(0x265),_0x3f4844[_0x2b78f3(0x230)]),console['log']('Status\x20Text:',_0x3f4844['statusText']),console[_0x2b78f3(0x209)]('Headers:',Object[_0x2b78f3(0x245)](_0x3f4844['headers'][_0x2b78f3(0x20c)]())),console[_0x2b78f3(0x209)](_0x2b78f3(0x253),_0x31f76c+'ms');const _0x1edb40=await _0x3f4844[_0x2b78f3(0x225)]();console[_0x2b78f3(0x209)]('Raw\x20Response\x20Body:',_0x1edb40);if(!_0x3f4844['ok']){console[_0x2b78f3(0x256)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x2b78f3(0x256)]('HTTP\x20Status:',_0x3f4844['status']),console[_0x2b78f3(0x256)](_0x2b78f3(0x22a),_0x1edb40),loggerService_1[_0x2b78f3(0x233)]['logWhiteDomainResponse'](_0x2b78f3(0x250),'/create',_0x3f4844[_0x2b78f3(0x230)],_0x1edb40,_0x31f76c),loggerService_1['loggerService'][_0x2b78f3(0x1f1)](_0x2b78f3(0x250),'/create','HTTP\x20'+_0x3f4844[_0x2b78f3(0x230)]+':\x20'+_0x1edb40);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3f4844[_0x2b78f3(0x230)]+_0x2b78f3(0x1fb)+_0x1edb40);}let _0x83806b;try{_0x83806b=JSON[_0x2b78f3(0x1f6)](_0x1edb40);}catch(_0x2dcef3){console[_0x2b78f3(0x256)](_0x2b78f3(0x217),_0x2dcef3),loggerService_1[_0x2b78f3(0x233)][_0x2b78f3(0x1f1)]('cointopay',_0x2b78f3(0x21f),_0x2b78f3(0x210)+_0x2dcef3);throw new Error(_0x2b78f3(0x24c)+_0x1edb40);}console[_0x2b78f3(0x209)](_0x2b78f3(0x269)),console[_0x2b78f3(0x209)](_0x2b78f3(0x247),JSON[_0x2b78f3(0x21a)](_0x83806b,null,0x2)),loggerService_1['loggerService'][_0x2b78f3(0x21c)](_0x2b78f3(0x250),_0x2b78f3(0x21f),_0x3f4844[_0x2b78f3(0x230)],_0x83806b,_0x31f76c);if(_0x83806b[_0x2b78f3(0x256)]){const _0xf90d48=_0x83806b[_0x2b78f3(0x228)]||_0x83806b['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x2b78f3(0x256)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2b78f3(0x256)]('Error\x20Message:',_0xf90d48),loggerService_1['loggerService'][_0x2b78f3(0x1f1)](_0x2b78f3(0x250),'/create',_0x2b78f3(0x227)+_0xf90d48);throw new Error(_0x2b78f3(0x231)+_0xf90d48);}if(!_0x83806b['payment_url']||!_0x83806b[_0x2b78f3(0x25a)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x2b78f3(0x256)](_0x2b78f3(0x240),_0x83806b),loggerService_1[_0x2b78f3(0x233)][_0x2b78f3(0x1f1)](_0x2b78f3(0x250),_0x2b78f3(0x21f),_0x2b78f3(0x22d));throw new Error(_0x2b78f3(0x252));}console['log'](_0x2b78f3(0x260)),console['log']('Gateway\x20Payment\x20ID:',_0x83806b[_0x2b78f3(0x25a)]),console['log'](_0x2b78f3(0x1ef),_0x83806b[_0x2b78f3(0x208)]);const _0x260ab5=_0x83806b[_0x2b78f3(0x208)]+'&alternative=false';return console[_0x2b78f3(0x209)]('Payment\x20URL\x20(modified):',_0x260ab5),console[_0x2b78f3(0x209)]('Amount:',_0x9d97f5,_0x2b78f3(0x222)),{'gateway_payment_id':_0x83806b[_0x2b78f3(0x25a)],'payment_url':_0x260ab5};}catch(_0x16edaf){console[_0x2b78f3(0x256)](_0x2b78f3(0x266)),console['error'](_0x2b78f3(0x1ed),_0x16edaf),loggerService_1[_0x2b78f3(0x233)][_0x2b78f3(0x1f1)](_0x2b78f3(0x250),_0x2b78f3(0x21f),_0x16edaf);if(_0x16edaf instanceof Error){console[_0x2b78f3(0x256)]('Error\x20message:',_0x16edaf[_0x2b78f3(0x228)]),console[_0x2b78f3(0x256)](_0x2b78f3(0x1f0),_0x16edaf[_0x2b78f3(0x1f7)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x16edaf[_0x2b78f3(0x228)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a55_0x332e0e(0x1fe)](_0x587201){const _0x18200a=a55_0x332e0e,_0xd35297=Date[_0x18200a(0x21d)]();try{console[_0x18200a(0x209)](_0x18200a(0x23d)+_0x587201);const _0x38dd59={'gatewayPaymentId':_0x587201};loggerService_1['loggerService'][_0x18200a(0x25b)](_0x18200a(0x250),_0x18200a(0x24f),'POST',_0x38dd59);const _0x36c178=await fetch(this[_0x18200a(0x213)],{'method':_0x18200a(0x255),'headers':{'Content-Type':_0x18200a(0x214),'Accept':'application/json','User-Agent':_0x18200a(0x216)},'body':JSON[_0x18200a(0x21a)](_0x38dd59)}),_0x576e1c=Date['now']()-_0xd35297;console[_0x18200a(0x209)](_0x18200a(0x203)),console['log'](_0x18200a(0x265),_0x36c178[_0x18200a(0x230)]),console[_0x18200a(0x209)](_0x18200a(0x253),_0x576e1c+'ms');if(!_0x36c178['ok']){const _0x2fec9e=await _0x36c178['text']();console['error'](_0x18200a(0x264),_0x36c178['status']),console[_0x18200a(0x256)](_0x18200a(0x22a),_0x2fec9e),loggerService_1['loggerService'][_0x18200a(0x21c)]('cointopay',_0x18200a(0x24f),_0x36c178[_0x18200a(0x230)],_0x2fec9e,_0x576e1c),loggerService_1[_0x18200a(0x233)][_0x18200a(0x1f1)](_0x18200a(0x250),_0x18200a(0x24f),_0x18200a(0x20b)+_0x36c178[_0x18200a(0x230)]+':\x20'+_0x2fec9e);throw new Error(_0x18200a(0x22f)+_0x36c178[_0x18200a(0x230)]);}const _0x10145d=await _0x36c178[_0x18200a(0x225)]();console[_0x18200a(0x209)](_0x18200a(0x237),_0x10145d);let _0x20e481;try{_0x20e481=JSON['parse'](_0x10145d);}catch(_0x775595){console[_0x18200a(0x256)](_0x18200a(0x217),_0x775595),loggerService_1[_0x18200a(0x233)][_0x18200a(0x1f1)](_0x18200a(0x250),_0x18200a(0x24f),_0x18200a(0x210)+_0x775595);throw new Error(_0x18200a(0x25d)+_0x10145d);}loggerService_1[_0x18200a(0x233)][_0x18200a(0x21c)](_0x18200a(0x250),_0x18200a(0x24f),_0x36c178[_0x18200a(0x230)],_0x20e481,_0x576e1c),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x18200a(0x205),_0x20e481[_0x18200a(0x200)]),console[_0x18200a(0x209)](_0x18200a(0x223),_0x20e481[_0x18200a(0x22b)]),console[_0x18200a(0x209)](_0x18200a(0x259),_0x20e481[_0x18200a(0x221)]?.[_0x18200a(0x204)]),console[_0x18200a(0x209)]('Amount:',_0x20e481[_0x18200a(0x221)]?.[_0x18200a(0x239)]),console['log'](_0x18200a(0x234),_0x20e481[_0x18200a(0x221)]?.['inputCurrency']);if(_0x20e481[_0x18200a(0x200)]!==_0x18200a(0x249)||_0x20e481[_0x18200a(0x22b)]!==0xc8){const _0x5480a8=_0x20e481[_0x18200a(0x228)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x18200a(0x256)](_0x18200a(0x246)),console['error'](_0x18200a(0x24a),_0x5480a8),loggerService_1['loggerService'][_0x18200a(0x1f1)](_0x18200a(0x250),_0x18200a(0x24f),_0x18200a(0x22c)+_0x5480a8);throw new Error(_0x18200a(0x1f2)+_0x5480a8);}if(!_0x20e481['data']){console[_0x18200a(0x256)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x18200a(0x233)][_0x18200a(0x1f1)](_0x18200a(0x250),'/status',_0x18200a(0x25e));throw new Error(_0x18200a(0x24d));}let _0x291fba=_0x18200a(0x219);switch(_0x20e481[_0x18200a(0x221)][_0x18200a(0x204)]?.[_0x18200a(0x26b)]()){case _0x18200a(0x226):_0x291fba=_0x18200a(0x24b);break;case _0x18200a(0x26c):case'failed':case _0x18200a(0x256):_0x291fba=_0x18200a(0x23b);break;case _0x18200a(0x244):case _0x18200a(0x21e):_0x291fba=_0x18200a(0x248);break;case _0x18200a(0x1f4):case _0x18200a(0x215):case'pending':case _0x18200a(0x236):default:_0x291fba=_0x18200a(0x219);break;}let _0x36bbc3,_0x422483;if(_0x20e481[_0x18200a(0x221)][_0x18200a(0x20a)]){const _0x1467f2=_0x20e481[_0x18200a(0x221)][_0x18200a(0x20a)];console[_0x18200a(0x209)]('ðŸ¦\x20Payment\x20Detail:',_0x1467f2);const _0x1ad494=_0x1467f2['match'](/IBAN\s+([A-Z0-9]+)/i);_0x1ad494&&(_0x36bbc3=_0x1ad494[0x1],console[_0x18200a(0x209)](_0x18200a(0x1fd),_0x36bbc3)),_0x422483=_0x1467f2;}const _0x309373={'iban':_0x36bbc3,'bankDetails':_0x422483,'transactionId':_0x20e481[_0x18200a(0x221)]['TransactionID'],'coinAddress':_0x20e481[_0x18200a(0x221)][_0x18200a(0x25f)],'qrCodeUrl':_0x20e481[_0x18200a(0x221)][_0x18200a(0x232)],'expiryTime':_0x20e481['data'][_0x18200a(0x207)],'createdOn':_0x20e481[_0x18200a(0x221)][_0x18200a(0x21b)],'confirmedOn':_0x20e481[_0x18200a(0x221)][_0x18200a(0x23c)]};console[_0x18200a(0x209)](_0x18200a(0x220)),console['log'](_0x18200a(0x265),_0x20e481[_0x18200a(0x221)]['Status'],'->',_0x291fba),console[_0x18200a(0x209)](_0x18200a(0x202),_0x20e481[_0x18200a(0x221)][_0x18200a(0x239)],_0x20e481[_0x18200a(0x221)][_0x18200a(0x23a)]),console[_0x18200a(0x209)]('Transaction\x20ID:',_0x20e481['data'][_0x18200a(0x251)]),console['log'](_0x18200a(0x235),_0x36bbc3||_0x18200a(0x1ee)),console[_0x18200a(0x209)](_0x18200a(0x1fa),_0x20e481[_0x18200a(0x221)][_0x18200a(0x21b)]),console['log'](_0x18200a(0x1f8),_0x20e481[_0x18200a(0x221)]['TransactionConfirmedOn']||_0x18200a(0x263));if(_0x20e481['data'][_0x18200a(0x204)]?.[_0x18200a(0x26b)]()===_0x18200a(0x215))console[_0x18200a(0x209)](_0x18200a(0x1ff));else _0x20e481[_0x18200a(0x221)][_0x18200a(0x204)]?.[_0x18200a(0x26b)]()==='paid'&&console[_0x18200a(0x209)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x291fba,'amount':parseFloat(_0x20e481['data'][_0x18200a(0x239)])||undefined,'currency':_0x20e481[_0x18200a(0x221)][_0x18200a(0x23a)]||'EUR','paymentDetails':_0x309373};}catch(_0x4a3e68){console['error'](_0x18200a(0x261),_0x4a3e68),loggerService_1[_0x18200a(0x233)][_0x18200a(0x1f1)]('cointopay',_0x18200a(0x24f),_0x4a3e68);throw new Error(_0x18200a(0x26a)+(_0x4a3e68 instanceof Error?_0x4a3e68[_0x18200a(0x228)]:'Unknown\x20error'));}}async[a55_0x332e0e(0x243)](_0xebbe){const _0x86d5e7=a55_0x332e0e,_0xd7776=await this[_0x86d5e7(0x1fe)](_0xebbe);return{'status':_0xd7776['status'],'amount':_0xd7776[_0x86d5e7(0x212)],'currency':_0xd7776[_0x86d5e7(0x218)]};}async[a55_0x332e0e(0x1f9)](_0x24674a){const _0x489d07=a55_0x332e0e;console[_0x489d07(0x209)](_0x489d07(0x201),_0x24674a);let _0x45b74e=_0x489d07(0x219);switch(_0x24674a[_0x489d07(0x230)]?.[_0x489d07(0x26b)]()){case _0x489d07(0x226):_0x45b74e=_0x489d07(0x24b);break;case _0x489d07(0x26c):case'failed':case'error':_0x45b74e='FAILED';break;case _0x489d07(0x244):case _0x489d07(0x21e):_0x45b74e='EXPIRED';break;case _0x489d07(0x211):case'waiting':case _0x489d07(0x215):case'created':default:_0x45b74e=_0x489d07(0x219);break;}return{'paymentId':_0x24674a[_0x489d07(0x268)]||_0x24674a[_0x489d07(0x1ec)]||'','status':_0x45b74e,'amount':_0x24674a[_0x489d07(0x212)],'currency':_0x24674a['currency']||_0x489d07(0x222)};}}exports[a55_0x332e0e(0x254)]=CoinToPayService;