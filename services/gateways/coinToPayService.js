'use strict';const a43_0xc1e24b=a43_0x1198;(function(_0x22fb88,_0x3a3e3d){const _0x430215=a43_0x1198,_0x26b543=_0x22fb88();while(!![]){try{const _0x4645a2=parseInt(_0x430215(0x77))/0x1+parseInt(_0x430215(0x95))/0x2*(parseInt(_0x430215(0xaa))/0x3)+-parseInt(_0x430215(0x73))/0x4+-parseInt(_0x430215(0xa8))/0x5+-parseInt(_0x430215(0x76))/0x6*(-parseInt(_0x430215(0xcb))/0x7)+parseInt(_0x430215(0xc0))/0x8*(-parseInt(_0x430215(0xf0))/0x9)+-parseInt(_0x430215(0xc4))/0xa;if(_0x4645a2===_0x3a3e3d)break;else _0x26b543['push'](_0x26b543['shift']());}catch(_0x1daf0a){_0x26b543['push'](_0x26b543['shift']());}}}(a43_0x5d6d,0xc4466));Object[a43_0xc1e24b(0xe4)](exports,a43_0xc1e24b(0xef),{'value':!![]}),exports[a43_0xc1e24b(0x84)]=void 0x0;const loggerService_1=require('../loggerService');function a43_0x5d6d(){const _0x5de4bc=['statusUrl','pending','Currency:','HTTP\x20error!\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Amount:','logWhiteDomainError','Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/','not\x20found','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Request\x20Body:','Result:','failed','awaiting\x20fiat','created','3644830eleLYu','stringify','3xoSElS','Payment\x20URL:','Confirmed\x20On:','Error\x20message:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','stack','Response\x20Body:','data','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','apiUrl','Raw\x20Response\x20Body:','TesSoft\x20Payment\x20System/1.0','application/json','statusText','log','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üìä\x20Status\x20check\x20URL:','PaymentDetail','status','EXPIRED','7214576kCAtnd','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üè¶\x20Payment\x20Detail:','üè¶\x20Extracted\x20IBAN:','73780dhroZZ','Status:','CreatedOn','coinAddress','CoinToPay\x20API\x20error:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','logWhiteDomainResponse','7tLaiIY','Business\x20Error:\x20','Status','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','/status','text','timeout','Status\x20API\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','not\x20confirmed','success','HTTP\x20Status:','payment_url','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','cointopay','error','expired','Parsed\x20Result:','TransactionConfirmedOn','currency','headers','parse','defineProperty','gateway_payment_id','Missing\x20data\x20in\x20response','result','paid','JSON\x20Parse\x20Error:\x20','Created\x20On:','URL:','Gateway\x20Payment\x20ID:','PENDING','entries','__esModule','9CDEdCi','merchant_reference_id','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Error\x20Message:','Status\x20Text:','logWhiteDomainRequest','waiting','Response\x20data:','2562476OJgdMQ','loggerService','Amount','3547362NNCXpJ','912327ZIOqHV','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','toLowerCase','message','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','processWebhook','POST','ExpiryTime','EUR','QRCodeURL','PAID','CoinToPayService','Response\x20Time:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','HTTP\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Payment\x20Status:','===\x20COINTOPAY\x20API\x20ERROR\x20===','checkPaymentStatus','amount','inputCurrency','FAILED','Error\x20stack:','Unknown\x20error\x20from\x20CoinToPay\x20API','cancelled','now','IBAN:','/create','3158346Xubijt','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)'];a43_0x5d6d=function(){return _0x5de4bc;};return a43_0x5d6d();}function a43_0x1198(_0x49537e,_0x5b3424){const _0x5d6d16=a43_0x5d6d();return a43_0x1198=function(_0x119867,_0x4f1242){_0x119867=_0x119867-0x71;let _0x442a31=_0x5d6d16[_0x119867];return _0x442a31;},a43_0x1198(_0x49537e,_0x5b3424);}class CoinToPayService{constructor(){const _0x24e789=a43_0xc1e24b;this['apiUrl']=_0x24e789(0xa0),this[_0x24e789(0x97)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x24e789(0xb9)](_0x24e789(0xdb)),console[_0x24e789(0xb9)](_0x24e789(0xbc),this[_0x24e789(0x97)]);}async['createPaymentLink'](_0x5310a8){const _0x39303e=a43_0xc1e24b,{orderId:_0x3523e5,amount:_0x5f51c2}=_0x5310a8;console['log'](_0x39303e(0xd5)+_0x5f51c2+'\x20EUR');const _0x1d8029={'amount':_0x5f51c2},_0xac191a=Date[_0x39303e(0x92)]();try{console[_0x39303e(0xb9)](_0x39303e(0xae)),console['log'](_0x39303e(0xeb),this['apiUrl']),console['log'](_0x39303e(0xa3),JSON[_0x39303e(0xa9)](_0x1d8029,null,0x2)),console['log'](_0x39303e(0x9c),_0x5f51c2,_0x39303e(0x78)),loggerService_1[_0x39303e(0x74)][_0x39303e(0xf5)]('cointopay',_0x39303e(0x94),_0x39303e(0x7f),_0x1d8029);const _0x1f0c7c=await fetch(this[_0x39303e(0xb4)],{'method':'POST','headers':{'Content-Type':_0x39303e(0xb7),'Accept':'application/json','User-Agent':_0x39303e(0xb6)},'body':JSON[_0x39303e(0xa9)](_0x1d8029)}),_0x445c65=Date[_0x39303e(0x92)]()-_0xac191a;console[_0x39303e(0xb9)](_0x39303e(0xd6)),console[_0x39303e(0xb9)](_0x39303e(0xc5),_0x1f0c7c['status']),console[_0x39303e(0xb9)](_0x39303e(0xf4),_0x1f0c7c[_0x39303e(0xb8)]),console['log']('Headers:',Object['fromEntries'](_0x1f0c7c[_0x39303e(0xe2)][_0x39303e(0xee)]())),console['log'](_0x39303e(0x85),_0x445c65+'ms');const _0x4d5b45=await _0x1f0c7c['text']();console[_0x39303e(0xb9)]('Raw\x20Response\x20Body:',_0x4d5b45);if(!_0x1f0c7c['ok']){console[_0x39303e(0xdd)](_0x39303e(0x8a)),console[_0x39303e(0xdd)]('HTTP\x20Status:',_0x1f0c7c[_0x39303e(0xbe)]),console['error']('Response\x20Body:',_0x4d5b45),loggerService_1[_0x39303e(0x74)][_0x39303e(0xca)]('cointopay',_0x39303e(0x94),_0x1f0c7c[_0x39303e(0xbe)],_0x4d5b45,_0x445c65),loggerService_1[_0x39303e(0x74)][_0x39303e(0x9d)](_0x39303e(0xdc),'/create',_0x39303e(0x87)+_0x1f0c7c['status']+':\x20'+_0x4d5b45);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1f0c7c[_0x39303e(0xbe)]+',\x20body:\x20'+_0x4d5b45);}let _0x2d1c15;try{_0x2d1c15=JSON[_0x39303e(0xe3)](_0x4d5b45);}catch(_0x506336){console[_0x39303e(0xdd)](_0x39303e(0xd3),_0x506336),loggerService_1[_0x39303e(0x74)][_0x39303e(0x9d)](_0x39303e(0xdc),'/create',_0x39303e(0xe9)+_0x506336);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x4d5b45);}console[_0x39303e(0xb9)](_0x39303e(0x9f)),console[_0x39303e(0xb9)](_0x39303e(0xdf),JSON[_0x39303e(0xa9)](_0x2d1c15,null,0x2)),loggerService_1['loggerService'][_0x39303e(0xca)](_0x39303e(0xdc),'/create',_0x1f0c7c[_0x39303e(0xbe)],_0x2d1c15,_0x445c65);if(_0x2d1c15[_0x39303e(0xdd)]){const _0x4f5d13=_0x2d1c15['message']||_0x2d1c15['error']||_0x39303e(0x90);console[_0x39303e(0xdd)](_0x39303e(0xf2)),console[_0x39303e(0xdd)](_0x39303e(0xf3),_0x4f5d13),loggerService_1[_0x39303e(0x74)][_0x39303e(0x9d)](_0x39303e(0xdc),'/create',_0x39303e(0xcc)+_0x4f5d13);throw new Error(_0x39303e(0xc8)+_0x4f5d13);}if(!_0x2d1c15['payment_url']||!_0x2d1c15[_0x39303e(0xe5)]){console[_0x39303e(0xdd)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x39303e(0xdd)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x39303e(0xdd)](_0x39303e(0x72),_0x2d1c15),loggerService_1[_0x39303e(0x74)][_0x39303e(0x9d)](_0x39303e(0xdc),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x39303e(0xb3));}return console[_0x39303e(0xb9)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x39303e(0xb9)](_0x39303e(0xec),_0x2d1c15[_0x39303e(0xe5)]),console[_0x39303e(0xb9)](_0x39303e(0xab),_0x2d1c15[_0x39303e(0xda)]),console[_0x39303e(0xb9)](_0x39303e(0x9c),_0x5f51c2,_0x39303e(0x81)),{'gateway_payment_id':_0x2d1c15[_0x39303e(0xe5)],'payment_url':_0x2d1c15[_0x39303e(0xda)]};}catch(_0x3514e8){console[_0x39303e(0xdd)](_0x39303e(0xba)),console['error']('Error\x20details:',_0x3514e8),loggerService_1['loggerService'][_0x39303e(0x9d)](_0x39303e(0xdc),'/create',_0x3514e8);if(_0x3514e8 instanceof Error){console[_0x39303e(0xdd)](_0x39303e(0xad),_0x3514e8[_0x39303e(0x7b)]),console['error'](_0x39303e(0x8f),_0x3514e8[_0x39303e(0xaf)]);throw new Error(_0x39303e(0x7d)+_0x3514e8['message']);}throw new Error(_0x39303e(0xa2));}}async[a43_0xc1e24b(0x8b)](_0x12abcc){const _0x5cb760=a43_0xc1e24b,_0x49c531=Date['now']();try{console[_0x5cb760(0xb9)](_0x5cb760(0xc9)+_0x12abcc);const _0x25c203={'gatewayPaymentId':_0x12abcc};loggerService_1[_0x5cb760(0x74)][_0x5cb760(0xf5)](_0x5cb760(0xdc),'/status',_0x5cb760(0x7f),_0x25c203);const _0x1459ad=await fetch(this[_0x5cb760(0x97)],{'method':'POST','headers':{'Content-Type':_0x5cb760(0xb7),'Accept':_0x5cb760(0xb7),'User-Agent':_0x5cb760(0xb6)},'body':JSON[_0x5cb760(0xa9)](_0x25c203)}),_0x1cb45f=Date['now']()-_0x49c531;console[_0x5cb760(0xb9)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5cb760(0xb9)](_0x5cb760(0xc5),_0x1459ad['status']),console[_0x5cb760(0xb9)](_0x5cb760(0x85),_0x1cb45f+'ms');if(!_0x1459ad['ok']){const _0x4aab3b=await _0x1459ad['text']();console[_0x5cb760(0xdd)](_0x5cb760(0xd9),_0x1459ad[_0x5cb760(0xbe)]),console[_0x5cb760(0xdd)](_0x5cb760(0xb0),_0x4aab3b),loggerService_1[_0x5cb760(0x74)][_0x5cb760(0xca)]('cointopay',_0x5cb760(0xcf),_0x1459ad[_0x5cb760(0xbe)],_0x4aab3b,_0x1cb45f),loggerService_1[_0x5cb760(0x74)][_0x5cb760(0x9d)](_0x5cb760(0xdc),'/status',_0x5cb760(0x87)+_0x1459ad[_0x5cb760(0xbe)]+':\x20'+_0x4aab3b);throw new Error(_0x5cb760(0x9a)+_0x1459ad[_0x5cb760(0xbe)]);}const _0x410e73=await _0x1459ad[_0x5cb760(0xd0)]();console['log'](_0x5cb760(0xb5),_0x410e73);let _0x468b25;try{_0x468b25=JSON['parse'](_0x410e73);}catch(_0x225b97){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x225b97),loggerService_1[_0x5cb760(0x74)][_0x5cb760(0x9d)]('cointopay',_0x5cb760(0xcf),_0x5cb760(0xe9)+_0x225b97);throw new Error(_0x5cb760(0x9b)+_0x410e73);}loggerService_1[_0x5cb760(0x74)][_0x5cb760(0xca)](_0x5cb760(0xdc),_0x5cb760(0xcf),_0x1459ad[_0x5cb760(0xbe)],_0x468b25,_0x1cb45f),console[_0x5cb760(0xb9)](_0x5cb760(0xce)),console['log'](_0x5cb760(0xa4),_0x468b25[_0x5cb760(0xe7)]),console[_0x5cb760(0xb9)]('Status\x20Code:',_0x468b25['status_code']),console['log'](_0x5cb760(0x89),_0x468b25['data']?.[_0x5cb760(0xcd)]),console[_0x5cb760(0xb9)]('Amount:',_0x468b25[_0x5cb760(0xb1)]?.[_0x5cb760(0x75)]),console[_0x5cb760(0xb9)](_0x5cb760(0x99),_0x468b25[_0x5cb760(0xb1)]?.[_0x5cb760(0x8d)]);if(_0x468b25['result']!==_0x5cb760(0xd8)||_0x468b25['status_code']!==0xc8){const _0x49e1ee=_0x468b25[_0x5cb760(0x7b)]||_0x5cb760(0xd4);console['error'](_0x5cb760(0x86)),console[_0x5cb760(0xdd)](_0x5cb760(0xf3),_0x49e1ee),loggerService_1[_0x5cb760(0x74)][_0x5cb760(0x9d)]('cointopay',_0x5cb760(0xcf),_0x5cb760(0xd2)+_0x49e1ee);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x49e1ee);}if(!_0x468b25['data']){console[_0x5cb760(0xdd)](_0x5cb760(0xbb)),console[_0x5cb760(0xdd)](_0x5cb760(0xe6)),loggerService_1[_0x5cb760(0x74)][_0x5cb760(0x9d)](_0x5cb760(0xdc),_0x5cb760(0xcf),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5cb760(0x79));}let _0x22489e=_0x5cb760(0xed);switch(_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xcd)]?.[_0x5cb760(0x7a)]()){case _0x5cb760(0xe8):_0x22489e=_0x5cb760(0x83);break;case'cancelled':case'failed':case'error':_0x22489e=_0x5cb760(0x8e);break;case _0x5cb760(0xde):case _0x5cb760(0xd1):_0x22489e=_0x5cb760(0xbf);break;case _0x5cb760(0x71):case _0x5cb760(0xa6):case _0x5cb760(0x98):case _0x5cb760(0xa7):default:_0x22489e='PENDING';break;}let _0x591e7b,_0x3559a4;if(_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xbd)]){const _0x35c680=_0x468b25['data'][_0x5cb760(0xbd)];console['log'](_0x5cb760(0xc2),_0x35c680);const _0x2ad28a=_0x35c680['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2ad28a&&(_0x591e7b=_0x2ad28a[0x1],console[_0x5cb760(0xb9)](_0x5cb760(0xc3),_0x591e7b)),_0x3559a4=_0x35c680;}const _0x116f5d={'iban':_0x591e7b,'bankDetails':_0x3559a4,'transactionId':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xb2)],'coinAddress':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xc7)],'qrCodeUrl':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0x82)],'expiryTime':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0x80)],'createdOn':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xc6)],'confirmedOn':_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xe0)]};console[_0x5cb760(0xb9)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5cb760(0xb9)](_0x5cb760(0xc5),_0x468b25[_0x5cb760(0xb1)]['Status'],'->',_0x22489e),console[_0x5cb760(0xb9)](_0x5cb760(0x9c),_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0x75)],_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0x8d)]),console['log']('Transaction\x20ID:',_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xb2)]),console[_0x5cb760(0xb9)](_0x5cb760(0x93),_0x591e7b||_0x5cb760(0xa1)),console[_0x5cb760(0xb9)](_0x5cb760(0xea),_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xc6)]),console[_0x5cb760(0xb9)](_0x5cb760(0xac),_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xe0)]||_0x5cb760(0xd7));if(_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0xcd)]?.[_0x5cb760(0x7a)]()==='awaiting\x20fiat')console['log'](_0x5cb760(0x96));else _0x468b25['data'][_0x5cb760(0xcd)]?.[_0x5cb760(0x7a)]()==='paid'&&console[_0x5cb760(0xb9)](_0x5cb760(0xc1));return{'status':_0x22489e,'amount':parseFloat(_0x468b25[_0x5cb760(0xb1)][_0x5cb760(0x75)])||undefined,'currency':_0x468b25[_0x5cb760(0xb1)]['inputCurrency']||_0x5cb760(0x81),'paymentDetails':_0x116f5d};}catch(_0xb85d02){console[_0x5cb760(0xdd)](_0x5cb760(0x88),_0xb85d02),loggerService_1[_0x5cb760(0x74)]['logWhiteDomainError'](_0x5cb760(0xdc),_0x5cb760(0xcf),_0xb85d02);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0xb85d02 instanceof Error?_0xb85d02[_0x5cb760(0x7b)]:_0x5cb760(0x9e)));}}async['verifyPayment'](_0x4a7413){const _0xd2c5f9=a43_0xc1e24b,_0x24049c=await this[_0xd2c5f9(0x8b)](_0x4a7413);return{'status':_0x24049c[_0xd2c5f9(0xbe)],'amount':_0x24049c['amount'],'currency':_0x24049c['currency']};}async[a43_0xc1e24b(0x7e)](_0x5639cc){const _0x315da8=a43_0xc1e24b;console[_0x315da8(0xb9)](_0x315da8(0x7c),_0x5639cc);let _0x55f674=_0x315da8(0xed);switch(_0x5639cc[_0x315da8(0xbe)]?.[_0x315da8(0x7a)]()){case _0x315da8(0xe8):_0x55f674='PAID';break;case _0x315da8(0x91):case _0x315da8(0xa5):case _0x315da8(0xdd):_0x55f674=_0x315da8(0x8e);break;case _0x315da8(0xde):case _0x315da8(0xd1):_0x55f674='EXPIRED';break;case _0x315da8(0x98):case'waiting':case _0x315da8(0xa6):case _0x315da8(0xa7):default:_0x55f674=_0x315da8(0xed);break;}return{'paymentId':_0x5639cc['order_id']||_0x5639cc[_0x315da8(0xf1)]||'','status':_0x55f674,'amount':_0x5639cc[_0x315da8(0x8c)],'currency':_0x5639cc[_0x315da8(0xe1)]||'EUR'};}}exports[a43_0xc1e24b(0x84)]=CoinToPayService;