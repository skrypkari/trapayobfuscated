'use strict';const a40_0x511436=a40_0x2434;(function(_0x2d40a7,_0x410398){const _0x288cdc=a40_0x2434,_0x392cf1=_0x2d40a7();while(!![]){try{const _0x367c3f=parseInt(_0x288cdc(0x1c7))/0x1*(-parseInt(_0x288cdc(0x1b8))/0x2)+-parseInt(_0x288cdc(0x1b4))/0x3*(parseInt(_0x288cdc(0x1d9))/0x4)+-parseInt(_0x288cdc(0x1d2))/0x5*(-parseInt(_0x288cdc(0x1de))/0x6)+parseInt(_0x288cdc(0x21b))/0x7*(parseInt(_0x288cdc(0x212))/0x8)+-parseInt(_0x288cdc(0x1cc))/0x9*(-parseInt(_0x288cdc(0x22e))/0xa)+parseInt(_0x288cdc(0x225))/0xb+parseInt(_0x288cdc(0x1f5))/0xc;if(_0x367c3f===_0x410398)break;else _0x392cf1['push'](_0x392cf1['shift']());}catch(_0x5512d0){_0x392cf1['push'](_0x392cf1['shift']());}}}(a40_0x28eb,0xe48e1));function a40_0x28eb(){const _0x505ebd=['9XOmHQF','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cointopay','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','30UoJsdx','/create','application/json','EXPIRED','statusText','Error\x20Message:','CoinToPayService','4UbiLzX','CreatedOn','inputCurrency','error','toLowerCase','514482mhTrkk','order_id','Status:','result','Business\x20Error:\x20','CoinToPay\x20API\x20error:\x20','verifyPayment','not\x20found','expired','Incomplete\x20response:\x20missing\x20data','Created\x20On:','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20SUCCESS\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','data','apiUrl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','POST','https://tesoft.uk/gateway/cointopay/','Status','__esModule','8707800hAGQSl','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Request\x20Body:','statusUrl','logWhiteDomainError','created','log','TesSoft\x20Payment\x20System/1.0','amount','https://tesoft.uk/gateway/cointopay/status.php','EUR','now','Headers:','text','success','HTTP\x20Status:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','QRCodeURL','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','message','loggerService','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','gateway_payment_id','../loggerService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20URL:','logWhiteDomainResponse','112oIHPSJ','checkPaymentStatus','üè¶\x20Payment\x20Detail:','cancelled',',\x20body:\x20','Response\x20Body:','defineProperty','TransactionID','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','20888KWgAzQ','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','waiting','Response\x20data:','ExpiryTime','failed','FAILED','merchant_reference_id','PaymentDetail','6542712yZEwMt','Parsed\x20Result:','status','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','timeout','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20error!\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','9878600oRuLWi','Status\x20Text:','paid','currency','PAID','Raw\x20Response\x20Body:','PENDING','stringify','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20ERROR\x20===','4282950NYVqRP','Amount:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','awaiting\x20fiat','2jKBJpX','/status','TransactionConfirmedOn','parse','logWhiteDomainRequest','Failed\x20to\x20parse\x20JSON\x20response:','CoinToPay\x20status\x20API\x20error:\x20','payment_url','Currency:','Error\x20stack:','Amount','Status\x20API\x20Error:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CoinToPay\x20payment\x20status\x20check\x20error:','pending','500749RDyoCA','Response\x20Time:','status_code','HTTP\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID'];a40_0x28eb=function(){return _0x505ebd;};return a40_0x28eb();}function a40_0x2434(_0x5d8e55,_0x314e9c){const _0x28eb5c=a40_0x28eb();return a40_0x2434=function(_0x243421,_0x4d53f1){_0x243421=_0x243421-0x1ac;let _0x5dcb76=_0x28eb5c[_0x243421];return _0x5dcb76;},a40_0x2434(_0x5d8e55,_0x314e9c);}Object[a40_0x511436(0x218)](exports,a40_0x511436(0x1f4),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x511436(0x20e));class CoinToPayService{constructor(){const _0x410863=a40_0x511436;this['apiUrl']=_0x410863(0x1f2),this[_0x410863(0x1f9)]=_0x410863(0x1ff),console['log'](_0x410863(0x1c4)),console['log'](_0x410863(0x1ef),this['statusUrl']);}async['createPaymentLink'](_0x58e0f1){const _0x12c689=a40_0x511436,{orderId:_0x18b76f,amount:_0x3ed779}=_0x58e0f1;console[_0x12c689(0x1fc)](_0x12c689(0x21a)+_0x3ed779+'\x20EUR');const _0x4d08d0={'amount':_0x3ed779},_0x4a272e=Date['now']();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log']('URL:',this[_0x12c689(0x1ed)]),console[_0x12c689(0x1fc)](_0x12c689(0x1f8),JSON[_0x12c689(0x1b1)](_0x4d08d0,null,0x2)),console['log'](_0x12c689(0x1b5),_0x3ed779,_0x12c689(0x1b6)),loggerService_1[_0x12c689(0x20a)]['logWhiteDomainRequest'](_0x12c689(0x1ce),_0x12c689(0x1d3),_0x12c689(0x1f1),_0x4d08d0);const _0x2f237f=await fetch(this[_0x12c689(0x1ed)],{'method':_0x12c689(0x1f1),'headers':{'Content-Type':'application/json','Accept':_0x12c689(0x1d4),'User-Agent':_0x12c689(0x1fd)},'body':JSON[_0x12c689(0x1b1)](_0x4d08d0)}),_0x362212=Date[_0x12c689(0x201)]()-_0x4a272e;console['log'](_0x12c689(0x20c)),console[_0x12c689(0x1fc)](_0x12c689(0x1e0),_0x2f237f[_0x12c689(0x227)]),console['log'](_0x12c689(0x22f),_0x2f237f[_0x12c689(0x1d6)]),console[_0x12c689(0x1fc)](_0x12c689(0x202),Object['fromEntries'](_0x2f237f[_0x12c689(0x21c)]['entries']())),console[_0x12c689(0x1fc)](_0x12c689(0x1c8),_0x362212+'ms');const _0x3d280d=await _0x2f237f['text']();console['log']('Raw\x20Response\x20Body:',_0x3d280d);if(!_0x2f237f['ok']){console[_0x12c689(0x1dc)](_0x12c689(0x1b3)),console[_0x12c689(0x1dc)](_0x12c689(0x205),_0x2f237f['status']),console[_0x12c689(0x1dc)](_0x12c689(0x217),_0x3d280d),loggerService_1[_0x12c689(0x20a)][_0x12c689(0x211)](_0x12c689(0x1ce),'/create',_0x2f237f['status'],_0x3d280d,_0x362212),loggerService_1['loggerService'][_0x12c689(0x1fa)](_0x12c689(0x1ce),_0x12c689(0x1d3),'HTTP\x20'+_0x2f237f[_0x12c689(0x227)]+':\x20'+_0x3d280d);throw new Error(_0x12c689(0x22b)+_0x2f237f[_0x12c689(0x227)]+_0x12c689(0x216)+_0x3d280d);}let _0x5c940d;try{_0x5c940d=JSON['parse'](_0x3d280d);}catch(_0x57701d){console[_0x12c689(0x1dc)](_0x12c689(0x1bd),_0x57701d),loggerService_1[_0x12c689(0x20a)][_0x12c689(0x1fa)](_0x12c689(0x1ce),_0x12c689(0x1d3),'JSON\x20Parse\x20Error:\x20'+_0x57701d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3d280d);}console['log'](_0x12c689(0x22c)),console[_0x12c689(0x1fc)](_0x12c689(0x226),JSON['stringify'](_0x5c940d,null,0x2)),loggerService_1[_0x12c689(0x20a)][_0x12c689(0x211)](_0x12c689(0x1ce),_0x12c689(0x1d3),_0x2f237f['status'],_0x5c940d,_0x362212);if(_0x5c940d[_0x12c689(0x1dc)]){const _0x30323e=_0x5c940d[_0x12c689(0x209)]||_0x5c940d[_0x12c689(0x1dc)]||_0x12c689(0x1f6);console[_0x12c689(0x1dc)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x12c689(0x1dc)](_0x12c689(0x1d7),_0x30323e),loggerService_1[_0x12c689(0x20a)][_0x12c689(0x1fa)](_0x12c689(0x1ce),_0x12c689(0x1d3),_0x12c689(0x1e2)+_0x30323e);throw new Error(_0x12c689(0x1e3)+_0x30323e);}if(!_0x5c940d[_0x12c689(0x1bf)]||!_0x5c940d[_0x12c689(0x20d)]){console[_0x12c689(0x1dc)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x12c689(0x1dc)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x12c689(0x1dc)](_0x12c689(0x21f),_0x5c940d),loggerService_1['loggerService'][_0x12c689(0x1fa)]('cointopay',_0x12c689(0x1d3),_0x12c689(0x20f));throw new Error(_0x12c689(0x22a));}return console[_0x12c689(0x1fc)](_0x12c689(0x1ea)),console[_0x12c689(0x1fc)](_0x12c689(0x1e9),_0x5c940d[_0x12c689(0x20d)]),console['log'](_0x12c689(0x210),_0x5c940d[_0x12c689(0x1bf)]),console['log'](_0x12c689(0x1b5),_0x3ed779,'EUR'),{'gateway_payment_id':_0x5c940d[_0x12c689(0x20d)],'payment_url':_0x5c940d[_0x12c689(0x1bf)]};}catch(_0x32937f){console[_0x12c689(0x1dc)](_0x12c689(0x1ee)),console['error']('Error\x20details:',_0x32937f),loggerService_1[_0x12c689(0x20a)][_0x12c689(0x1fa)](_0x12c689(0x1ce),_0x12c689(0x1d3),_0x32937f);if(_0x32937f instanceof Error){console[_0x12c689(0x1dc)]('Error\x20message:',_0x32937f[_0x12c689(0x209)]),console['error'](_0x12c689(0x1c1),_0x32937f['stack']);throw new Error(_0x12c689(0x21d)+_0x32937f[_0x12c689(0x209)]);}throw new Error(_0x12c689(0x1f7));}}async['checkPaymentStatus'](_0x36da5f){const _0x25922c=a40_0x511436,_0x134351=Date[_0x25922c(0x201)]();try{console[_0x25922c(0x1fc)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x36da5f);const _0x5595fb={'gatewayPaymentId':_0x36da5f};loggerService_1[_0x25922c(0x20a)][_0x25922c(0x1bc)](_0x25922c(0x1ce),_0x25922c(0x1b9),_0x25922c(0x1f1),_0x5595fb);const _0x51f08d=await fetch(this[_0x25922c(0x1f9)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x25922c(0x1d4),'User-Agent':_0x25922c(0x1fd)},'body':JSON[_0x25922c(0x1b1)](_0x5595fb)}),_0x444577=Date[_0x25922c(0x201)]()-_0x134351;console[_0x25922c(0x1fc)](_0x25922c(0x1f0)),console[_0x25922c(0x1fc)]('Status:',_0x51f08d[_0x25922c(0x227)]),console[_0x25922c(0x1fc)](_0x25922c(0x1c8),_0x444577+'ms');if(!_0x51f08d['ok']){const _0x967b13=await _0x51f08d[_0x25922c(0x203)]();console[_0x25922c(0x1dc)](_0x25922c(0x205),_0x51f08d['status']),console[_0x25922c(0x1dc)](_0x25922c(0x217),_0x967b13),loggerService_1[_0x25922c(0x20a)][_0x25922c(0x211)](_0x25922c(0x1ce),_0x25922c(0x1b9),_0x51f08d[_0x25922c(0x227)],_0x967b13,_0x444577),loggerService_1[_0x25922c(0x20a)][_0x25922c(0x1fa)](_0x25922c(0x1ce),'/status',_0x25922c(0x1ca)+_0x51f08d[_0x25922c(0x227)]+':\x20'+_0x967b13);throw new Error(_0x25922c(0x22b)+_0x51f08d[_0x25922c(0x227)]);}const _0x40aaae=await _0x51f08d[_0x25922c(0x203)]();console['log'](_0x25922c(0x1af),_0x40aaae);let _0x29a743;try{_0x29a743=JSON[_0x25922c(0x1bb)](_0x40aaae);}catch(_0xe45439){console[_0x25922c(0x1dc)](_0x25922c(0x1bd),_0xe45439),loggerService_1[_0x25922c(0x20a)]['logWhiteDomainError'](_0x25922c(0x1ce),'/status',_0x25922c(0x1d1)+_0xe45439);throw new Error(_0x25922c(0x1cd)+_0x40aaae);}loggerService_1[_0x25922c(0x20a)][_0x25922c(0x211)](_0x25922c(0x1ce),_0x25922c(0x1b9),_0x51f08d[_0x25922c(0x227)],_0x29a743,_0x444577),console[_0x25922c(0x1fc)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0x29a743[_0x25922c(0x1e1)]),console[_0x25922c(0x1fc)]('Status\x20Code:',_0x29a743[_0x25922c(0x1c9)]),console[_0x25922c(0x1fc)]('Payment\x20Status:',_0x29a743[_0x25922c(0x1ec)]?.[_0x25922c(0x1f3)]),console[_0x25922c(0x1fc)]('Amount:',_0x29a743[_0x25922c(0x1ec)]?.['Amount']),console[_0x25922c(0x1fc)](_0x25922c(0x1c0),_0x29a743['data']?.[_0x25922c(0x1db)]);if(_0x29a743[_0x25922c(0x1e1)]!==_0x25922c(0x204)||_0x29a743[_0x25922c(0x1c9)]!==0xc8){const _0x163fb2=_0x29a743[_0x25922c(0x209)]||_0x25922c(0x206);console[_0x25922c(0x1dc)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x25922c(0x1dc)](_0x25922c(0x1d7),_0x163fb2),loggerService_1['loggerService'][_0x25922c(0x1fa)]('cointopay',_0x25922c(0x1b9),_0x25922c(0x1c3)+_0x163fb2);throw new Error(_0x25922c(0x1be)+_0x163fb2);}if(!_0x29a743[_0x25922c(0x1ec)]){console[_0x25922c(0x1dc)](_0x25922c(0x208)),console[_0x25922c(0x1dc)](_0x25922c(0x1b2)),loggerService_1[_0x25922c(0x20a)]['logWhiteDomainError'](_0x25922c(0x1ce),_0x25922c(0x1b9),_0x25922c(0x1e7));throw new Error(_0x25922c(0x228));}let _0xae8714=_0x25922c(0x1b0);switch(_0x29a743['data'][_0x25922c(0x1f3)]?.[_0x25922c(0x1dd)]()){case _0x25922c(0x1ac):_0xae8714=_0x25922c(0x1ae);break;case _0x25922c(0x215):case _0x25922c(0x221):case _0x25922c(0x1dc):_0xae8714=_0x25922c(0x222);break;case _0x25922c(0x1e6):case _0x25922c(0x229):_0xae8714=_0x25922c(0x1d5);break;case _0x25922c(0x21e):case _0x25922c(0x1b7):case _0x25922c(0x1c6):case'created':default:_0xae8714=_0x25922c(0x1b0);break;}let _0xc388cd,_0x1d968f;if(_0x29a743['data']['PaymentDetail']){const _0x3eddcc=_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x224)];console[_0x25922c(0x1fc)](_0x25922c(0x214),_0x3eddcc);const _0x5545dd=_0x3eddcc['match'](/IBAN\s+([A-Z0-9]+)/i);_0x5545dd&&(_0xc388cd=_0x5545dd[0x1],console[_0x25922c(0x1fc)]('üè¶\x20Extracted\x20IBAN:',_0xc388cd)),_0x1d968f=_0x3eddcc;}const _0x32134b={'iban':_0xc388cd,'bankDetails':_0x1d968f,'transactionId':_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x219)],'coinAddress':_0x29a743[_0x25922c(0x1ec)]['coinAddress'],'qrCodeUrl':_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x207)],'expiryTime':_0x29a743['data'][_0x25922c(0x220)],'createdOn':_0x29a743['data']['CreatedOn'],'confirmedOn':_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1ba)]};console[_0x25922c(0x1fc)](_0x25922c(0x1d0)),console[_0x25922c(0x1fc)]('Status:',_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1f3)],'->',_0xae8714),console[_0x25922c(0x1fc)](_0x25922c(0x1b5),_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1c2)],_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1db)]),console[_0x25922c(0x1fc)](_0x25922c(0x20b),_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x219)]),console[_0x25922c(0x1fc)]('IBAN:',_0xc388cd||_0x25922c(0x1e5)),console['log'](_0x25922c(0x1e8),_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1da)]),console[_0x25922c(0x1fc)]('Confirmed\x20On:',_0x29a743[_0x25922c(0x1ec)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x29a743[_0x25922c(0x1ec)]['Status']?.[_0x25922c(0x1dd)]()===_0x25922c(0x1b7))console[_0x25922c(0x1fc)](_0x25922c(0x1eb));else _0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1f3)]?.[_0x25922c(0x1dd)]()===_0x25922c(0x1ac)&&console[_0x25922c(0x1fc)](_0x25922c(0x1cb));return{'status':_0xae8714,'amount':parseFloat(_0x29a743[_0x25922c(0x1ec)][_0x25922c(0x1c2)])||undefined,'currency':_0x29a743[_0x25922c(0x1ec)]['inputCurrency']||'EUR','paymentDetails':_0x32134b};}catch(_0x294398){console['error'](_0x25922c(0x1c5),_0x294398),loggerService_1[_0x25922c(0x20a)][_0x25922c(0x1fa)](_0x25922c(0x1ce),_0x25922c(0x1b9),_0x294398);throw new Error(_0x25922c(0x1cf)+(_0x294398 instanceof Error?_0x294398['message']:'Unknown\x20error'));}}async[a40_0x511436(0x1e4)](_0x4ecb26){const _0x3d4370=a40_0x511436,_0x1d102f=await this[_0x3d4370(0x213)](_0x4ecb26);return{'status':_0x1d102f[_0x3d4370(0x227)],'amount':_0x1d102f[_0x3d4370(0x1fe)],'currency':_0x1d102f['currency']};}async['processWebhook'](_0x2cdb38){const _0x2cca32=a40_0x511436;console[_0x2cca32(0x1fc)](_0x2cca32(0x22d),_0x2cdb38);let _0x561ea0=_0x2cca32(0x1b0);switch(_0x2cdb38['status']?.[_0x2cca32(0x1dd)]()){case _0x2cca32(0x1ac):_0x561ea0=_0x2cca32(0x1ae);break;case _0x2cca32(0x215):case _0x2cca32(0x221):case _0x2cca32(0x1dc):_0x561ea0=_0x2cca32(0x222);break;case _0x2cca32(0x1e6):case _0x2cca32(0x229):_0x561ea0='EXPIRED';break;case _0x2cca32(0x1c6):case _0x2cca32(0x21e):case _0x2cca32(0x1b7):case _0x2cca32(0x1fb):default:_0x561ea0='PENDING';break;}return{'paymentId':_0x2cdb38[_0x2cca32(0x1df)]||_0x2cdb38[_0x2cca32(0x223)]||'','status':_0x561ea0,'amount':_0x2cdb38[_0x2cca32(0x1fe)],'currency':_0x2cdb38[_0x2cca32(0x1ad)]||_0x2cca32(0x200)};}}exports[a40_0x511436(0x1d8)]=CoinToPayService;