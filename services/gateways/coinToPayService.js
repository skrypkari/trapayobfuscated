'use strict';const a47_0x405850=a47_0x3916;(function(_0x5cd3f4,_0x308fa3){const _0x316091=a47_0x3916,_0x821b12=_0x5cd3f4();while(!![]){try{const _0x59ca93=parseInt(_0x316091(0x1dd))/0x1*(-parseInt(_0x316091(0x204))/0x2)+-parseInt(_0x316091(0x1d9))/0x3*(parseInt(_0x316091(0x219))/0x4)+parseInt(_0x316091(0x1e8))/0x5*(parseInt(_0x316091(0x20e))/0x6)+-parseInt(_0x316091(0x1fd))/0x7+-parseInt(_0x316091(0x249))/0x8+-parseInt(_0x316091(0x231))/0x9*(parseInt(_0x316091(0x207))/0xa)+parseInt(_0x316091(0x1f0))/0xb;if(_0x59ca93===_0x308fa3)break;else _0x821b12['push'](_0x821b12['shift']());}catch(_0x65c02){_0x821b12['push'](_0x821b12['shift']());}}}(a47_0x2dc2,0x26464));function a47_0x2dc2(){const _0x5044ac=['Error\x20details:','Amount','894234FcRsdv','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount:','text','TransactionConfirmedOn','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20Code:','TransactionID','Response\x20data:','408AkwlCm','not\x20confirmed','/status','awaiting\x20fiat','Created\x20On:','created','status','checkPaymentStatus','\x20EUR','Response\x20Body:','pending','https://tesoft.uk/gateway/cointopay/','stack','result','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','fromEntries','error','success','Missing\x20data\x20in\x20response','IBAN:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Payment\x20Status:','coinAddress','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','9xevUdj','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Currency:','parse','failed','Response\x20Time:','CreatedOn','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','POST','log','CoinToPay\x20status\x20API\x20error:\x20','waiting','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','payment_url','currency','CoinToPay\x20API\x20error:\x20','EUR','FAILED','Result:','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','QRCodeURL','Transaction\x20ID:','500400XaHLtd','headers','CoinToPayService','verifyPayment','üè¶\x20Extracted\x20IBAN:','gateway_payment_id','logWhiteDomainResponse','statusUrl','Error\x20Message:','Status\x20API\x20Error:\x20','Parsed\x20Result:','URL:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','createPaymentLink','status_code','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','__esModule','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','now','timeout','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','order_id','7515YkcEIN','Gateway\x20Payment\x20ID:','PENDING','cointopay','758pNLvcj','JSON\x20Parse\x20Error:\x20','Payment\x20System/1.0','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','not\x20found','processWebhook','merchant_reference_id','PAID','logWhiteDomainRequest','/create','logWhiteDomainError','5OjvUZy','Confirmed\x20On:','loggerService','PaymentDetail','data','paid','HTTP\x20Status:','Status:','5492872qvAvdS','toLowerCase','application/json','Request\x20Body:','===\x20COINTOPAY\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','üè¶\x20Payment\x20Detail:','inputCurrency','stringify','Business\x20Error:\x20','Headers:','Status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','142632PuaNUm','amount','apiUrl','EXPIRED','Unknown\x20error\x20from\x20CoinToPay\x20API','defineProperty','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','206wjSIry','match','Raw\x20Response\x20Body:','751090eqKWLT','HTTP\x20','Payment\x20URL:','message','üìä\x20Status\x20check\x20URL:'];a47_0x2dc2=function(){return _0x5044ac;};return a47_0x2dc2();}function a47_0x3916(_0x1a5d6b,_0x65cc95){const _0x2dc2da=a47_0x2dc2();return a47_0x3916=function(_0x391655,_0x5d90b7){_0x391655=_0x391655-0x1d2;let _0x5267db=_0x2dc2da[_0x391655];return _0x5267db;},a47_0x3916(_0x1a5d6b,_0x65cc95);}Object[a47_0x405850(0x202)](exports,a47_0x405850(0x25a),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x2e187b=a47_0x405850;this[_0x2e187b(0x1ff)]=_0x2e187b(0x224),this['statusUrl']=_0x2e187b(0x20f),console[_0x2e187b(0x23b)](_0x2e187b(0x203)),console['log'](_0x2e187b(0x20b),this[_0x2e187b(0x250)]);}async[a47_0x405850(0x257)](_0x5661c5){const _0x252eff=a47_0x405850,{orderId:_0x5777e4,amount:_0x5f1351}=_0x5661c5;console[_0x252eff(0x23b)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5f1351+_0x252eff(0x221));const _0x39086f={'amount':_0x5f1351},_0x3ca0d5=Date[_0x252eff(0x1d3)]();try{console[_0x252eff(0x23b)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x252eff(0x254),this[_0x252eff(0x1ff)]),console[_0x252eff(0x23b)](_0x252eff(0x1f3),JSON[_0x252eff(0x1f8)](_0x39086f,null,0x2)),console[_0x252eff(0x23b)](_0x252eff(0x211),_0x5f1351,_0x252eff(0x1fc)),loggerService_1[_0x252eff(0x1ea)][_0x252eff(0x1e5)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x252eff(0x23a),_0x39086f);const _0x5b470c=await fetch(this[_0x252eff(0x1ff)],{'method':_0x252eff(0x23a),'headers':{'Content-Type':'application/json','Accept':_0x252eff(0x1f2),'User-Agent':_0x252eff(0x1df)},'body':JSON['stringify'](_0x39086f)}),_0xbe6c72=Date[_0x252eff(0x1d3)]()-_0x3ca0d5;console[_0x252eff(0x23b)](_0x252eff(0x227)),console[_0x252eff(0x23b)](_0x252eff(0x1ef),_0x5b470c[_0x252eff(0x21f)]),console[_0x252eff(0x23b)]('Status\x20Text:',_0x5b470c['statusText']),console[_0x252eff(0x23b)](_0x252eff(0x1fa),Object[_0x252eff(0x228)](_0x5b470c[_0x252eff(0x24a)]['entries']())),console[_0x252eff(0x23b)](_0x252eff(0x237),_0xbe6c72+'ms');const _0x4b6ef8=await _0x5b470c[_0x252eff(0x212)]();console[_0x252eff(0x23b)](_0x252eff(0x206),_0x4b6ef8);if(!_0x5b470c['ok']){console[_0x252eff(0x229)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x252eff(0x1ee),_0x5b470c['status']),console[_0x252eff(0x229)]('Response\x20Body:',_0x4b6ef8),loggerService_1['loggerService'][_0x252eff(0x24f)](_0x252eff(0x1dc),'/create',_0x5b470c['status'],_0x4b6ef8,_0xbe6c72),loggerService_1[_0x252eff(0x1ea)][_0x252eff(0x1e7)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x252eff(0x208)+_0x5b470c[_0x252eff(0x21f)]+':\x20'+_0x4b6ef8);throw new Error(_0x252eff(0x1f5)+_0x5b470c[_0x252eff(0x21f)]+',\x20body:\x20'+_0x4b6ef8);}let _0x5d6b58;try{_0x5d6b58=JSON[_0x252eff(0x235)](_0x4b6ef8);}catch(_0x3c7f1d){console[_0x252eff(0x229)](_0x252eff(0x245),_0x3c7f1d),loggerService_1[_0x252eff(0x1ea)][_0x252eff(0x1e7)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x252eff(0x1de)+_0x3c7f1d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x4b6ef8);}console['log'](_0x252eff(0x239)),console[_0x252eff(0x23b)](_0x252eff(0x253),JSON[_0x252eff(0x1f8)](_0x5d6b58,null,0x2)),loggerService_1[_0x252eff(0x1ea)][_0x252eff(0x24f)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x5b470c[_0x252eff(0x21f)],_0x5d6b58,_0xbe6c72);if(_0x5d6b58['error']){const _0x44edc8=_0x5d6b58[_0x252eff(0x20a)]||_0x5d6b58[_0x252eff(0x229)]||_0x252eff(0x201);console[_0x252eff(0x229)](_0x252eff(0x215)),console[_0x252eff(0x229)](_0x252eff(0x251),_0x44edc8),loggerService_1['loggerService'][_0x252eff(0x1e7)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x252eff(0x1f9)+_0x44edc8);throw new Error(_0x252eff(0x241)+_0x44edc8);}if(!_0x5d6b58[_0x252eff(0x23f)]||!_0x5d6b58[_0x252eff(0x24e)]){console[_0x252eff(0x229)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x252eff(0x229)](_0x252eff(0x1e0)),console[_0x252eff(0x229)](_0x252eff(0x218),_0x5d6b58),loggerService_1[_0x252eff(0x1ea)][_0x252eff(0x1e7)](_0x252eff(0x1dc),_0x252eff(0x1e6),_0x252eff(0x1d7));throw new Error(_0x252eff(0x214));}return console['log'](_0x252eff(0x1f4)),console[_0x252eff(0x23b)](_0x252eff(0x1da),_0x5d6b58[_0x252eff(0x24e)]),console[_0x252eff(0x23b)](_0x252eff(0x209),_0x5d6b58[_0x252eff(0x23f)]),console[_0x252eff(0x23b)](_0x252eff(0x211),_0x5f1351,_0x252eff(0x242)),{'gateway_payment_id':_0x5d6b58[_0x252eff(0x24e)],'payment_url':_0x5d6b58['payment_url']};}catch(_0x1916de){console[_0x252eff(0x229)](_0x252eff(0x22d)),console[_0x252eff(0x229)](_0x252eff(0x20c),_0x1916de),loggerService_1['loggerService'][_0x252eff(0x1e7)]('cointopay',_0x252eff(0x1e6),_0x1916de);if(_0x1916de instanceof Error){console[_0x252eff(0x229)]('Error\x20message:',_0x1916de[_0x252eff(0x20a)]),console[_0x252eff(0x229)](_0x252eff(0x232),_0x1916de[_0x252eff(0x225)]);throw new Error(_0x252eff(0x1d2)+_0x1916de[_0x252eff(0x20a)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a47_0x405850(0x220)](_0x60ee6b){const _0x58fdd9=a47_0x405850,_0x5aa8bf=Date[_0x58fdd9(0x1d3)]();try{console[_0x58fdd9(0x23b)](_0x58fdd9(0x1d6)+_0x60ee6b);const _0xd8ceec={'gatewayPaymentId':_0x60ee6b};loggerService_1['loggerService'][_0x58fdd9(0x1e5)](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),_0x58fdd9(0x23a),_0xd8ceec);const _0x253eb2=await fetch(this[_0x58fdd9(0x250)],{'method':_0x58fdd9(0x23a),'headers':{'Content-Type':_0x58fdd9(0x1f2),'Accept':_0x58fdd9(0x1f2),'User-Agent':_0x58fdd9(0x1df)},'body':JSON[_0x58fdd9(0x1f8)](_0xd8ceec)}),_0x31b19d=Date['now']()-_0x5aa8bf;console[_0x58fdd9(0x23b)](_0x58fdd9(0x230)),console[_0x58fdd9(0x23b)](_0x58fdd9(0x1ef),_0x253eb2[_0x58fdd9(0x21f)]),console[_0x58fdd9(0x23b)]('Response\x20Time:',_0x31b19d+'ms');if(!_0x253eb2['ok']){const _0x5b6df6=await _0x253eb2[_0x58fdd9(0x212)]();console[_0x58fdd9(0x229)](_0x58fdd9(0x1ee),_0x253eb2['status']),console[_0x58fdd9(0x229)](_0x58fdd9(0x222),_0x5b6df6),loggerService_1[_0x58fdd9(0x1ea)]['logWhiteDomainResponse'](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),_0x253eb2[_0x58fdd9(0x21f)],_0x5b6df6,_0x31b19d),loggerService_1[_0x58fdd9(0x1ea)][_0x58fdd9(0x1e7)](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),'HTTP\x20'+_0x253eb2['status']+':\x20'+_0x5b6df6);throw new Error(_0x58fdd9(0x1f5)+_0x253eb2[_0x58fdd9(0x21f)]);}const _0xd93b44=await _0x253eb2[_0x58fdd9(0x212)]();console[_0x58fdd9(0x23b)](_0x58fdd9(0x206),_0xd93b44);let _0x22990a;try{_0x22990a=JSON[_0x58fdd9(0x235)](_0xd93b44);}catch(_0x57082a){console[_0x58fdd9(0x229)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x57082a),loggerService_1[_0x58fdd9(0x1ea)][_0x58fdd9(0x1e7)](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),_0x58fdd9(0x1de)+_0x57082a);throw new Error(_0x58fdd9(0x1d5)+_0xd93b44);}loggerService_1[_0x58fdd9(0x1ea)][_0x58fdd9(0x24f)]('cointopay',_0x58fdd9(0x21b),_0x253eb2[_0x58fdd9(0x21f)],_0x22990a,_0x31b19d),console[_0x58fdd9(0x23b)](_0x58fdd9(0x255)),console[_0x58fdd9(0x23b)](_0x58fdd9(0x244),_0x22990a['result']),console[_0x58fdd9(0x23b)](_0x58fdd9(0x216),_0x22990a[_0x58fdd9(0x258)]),console[_0x58fdd9(0x23b)](_0x58fdd9(0x22e),_0x22990a[_0x58fdd9(0x1ec)]?.[_0x58fdd9(0x1fb)]),console[_0x58fdd9(0x23b)](_0x58fdd9(0x211),_0x22990a[_0x58fdd9(0x1ec)]?.['Amount']),console[_0x58fdd9(0x23b)](_0x58fdd9(0x234),_0x22990a[_0x58fdd9(0x1ec)]?.[_0x58fdd9(0x1f7)]);if(_0x22990a[_0x58fdd9(0x226)]!==_0x58fdd9(0x22a)||_0x22990a['status_code']!==0xc8){const _0x1e87e4=_0x22990a['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x58fdd9(0x229)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x58fdd9(0x229)](_0x58fdd9(0x251),_0x1e87e4),loggerService_1[_0x58fdd9(0x1ea)][_0x58fdd9(0x1e7)](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),_0x58fdd9(0x252)+_0x1e87e4);throw new Error(_0x58fdd9(0x23c)+_0x1e87e4);}if(!_0x22990a['data']){console[_0x58fdd9(0x229)](_0x58fdd9(0x259)),console[_0x58fdd9(0x229)](_0x58fdd9(0x22b)),loggerService_1['loggerService']['logWhiteDomainError'](_0x58fdd9(0x1dc),_0x58fdd9(0x21b),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x58fdd9(0x256));}let _0x5d1980=_0x58fdd9(0x1db);switch(_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x1fb)]?.['toLowerCase']()){case _0x58fdd9(0x1ed):_0x5d1980=_0x58fdd9(0x1e4);break;case _0x58fdd9(0x246):case _0x58fdd9(0x236):case _0x58fdd9(0x229):_0x5d1980=_0x58fdd9(0x243);break;case'expired':case'timeout':_0x5d1980='EXPIRED';break;case _0x58fdd9(0x23d):case _0x58fdd9(0x21c):case _0x58fdd9(0x223):case _0x58fdd9(0x21e):default:_0x5d1980='PENDING';break;}let _0x1b065c,_0x52f6fd;if(_0x22990a['data'][_0x58fdd9(0x1eb)]){const _0x16a87b=_0x22990a[_0x58fdd9(0x1ec)]['PaymentDetail'];console['log'](_0x58fdd9(0x1f6),_0x16a87b);const _0x3dad69=_0x16a87b[_0x58fdd9(0x205)](/IBAN\s+([A-Z0-9]+)/i);_0x3dad69&&(_0x1b065c=_0x3dad69[0x1],console[_0x58fdd9(0x23b)](_0x58fdd9(0x24d),_0x1b065c)),_0x52f6fd=_0x16a87b;}const _0x2ed360={'iban':_0x1b065c,'bankDetails':_0x52f6fd,'transactionId':_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x217)],'coinAddress':_0x22990a['data'][_0x58fdd9(0x22f)],'qrCodeUrl':_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x247)],'expiryTime':_0x22990a[_0x58fdd9(0x1ec)]['ExpiryTime'],'createdOn':_0x22990a[_0x58fdd9(0x1ec)]['CreatedOn'],'confirmedOn':_0x22990a['data'][_0x58fdd9(0x213)]};console[_0x58fdd9(0x23b)](_0x58fdd9(0x233)),console[_0x58fdd9(0x23b)](_0x58fdd9(0x1ef),_0x22990a['data'][_0x58fdd9(0x1fb)],'->',_0x5d1980),console[_0x58fdd9(0x23b)](_0x58fdd9(0x211),_0x22990a['data'][_0x58fdd9(0x20d)],_0x22990a['data'][_0x58fdd9(0x1f7)]),console[_0x58fdd9(0x23b)](_0x58fdd9(0x248),_0x22990a[_0x58fdd9(0x1ec)]['TransactionID']),console[_0x58fdd9(0x23b)](_0x58fdd9(0x22c),_0x1b065c||_0x58fdd9(0x1e1)),console[_0x58fdd9(0x23b)](_0x58fdd9(0x21d),_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x238)]),console[_0x58fdd9(0x23b)](_0x58fdd9(0x1e9),_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x213)]||_0x58fdd9(0x21a));if(_0x22990a[_0x58fdd9(0x1ec)][_0x58fdd9(0x1fb)]?.['toLowerCase']()===_0x58fdd9(0x21c))console[_0x58fdd9(0x23b)](_0x58fdd9(0x23e));else _0x22990a['data'][_0x58fdd9(0x1fb)]?.['toLowerCase']()===_0x58fdd9(0x1ed)&&console[_0x58fdd9(0x23b)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5d1980,'amount':parseFloat(_0x22990a['data'][_0x58fdd9(0x20d)])||undefined,'currency':_0x22990a['data']['inputCurrency']||_0x58fdd9(0x242),'paymentDetails':_0x2ed360};}catch(_0x4a18c0){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4a18c0),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/status',_0x4a18c0);throw new Error(_0x58fdd9(0x210)+(_0x4a18c0 instanceof Error?_0x4a18c0[_0x58fdd9(0x20a)]:'Unknown\x20error'));}}async[a47_0x405850(0x24c)](_0x4bc148){const _0x1f063e=a47_0x405850,_0x35a032=await this[_0x1f063e(0x220)](_0x4bc148);return{'status':_0x35a032[_0x1f063e(0x21f)],'amount':_0x35a032['amount'],'currency':_0x35a032[_0x1f063e(0x240)]};}async[a47_0x405850(0x1e2)](_0x3dbf48){const _0x3b8f42=a47_0x405850;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3dbf48);let _0x4cb71c=_0x3b8f42(0x1db);switch(_0x3dbf48[_0x3b8f42(0x21f)]?.[_0x3b8f42(0x1f1)]()){case _0x3b8f42(0x1ed):_0x4cb71c=_0x3b8f42(0x1e4);break;case'cancelled':case'failed':case'error':_0x4cb71c=_0x3b8f42(0x243);break;case'expired':case _0x3b8f42(0x1d4):_0x4cb71c=_0x3b8f42(0x200);break;case _0x3b8f42(0x223):case _0x3b8f42(0x23d):case _0x3b8f42(0x21c):case'created':default:_0x4cb71c=_0x3b8f42(0x1db);break;}return{'paymentId':_0x3dbf48[_0x3b8f42(0x1d8)]||_0x3dbf48[_0x3b8f42(0x1e3)]||'','status':_0x4cb71c,'amount':_0x3dbf48[_0x3b8f42(0x1fe)],'currency':_0x3dbf48[_0x3b8f42(0x240)]||_0x3b8f42(0x242)};}}exports[a47_0x405850(0x24b)]=CoinToPayService;