'use strict';const a40_0x262a8f=a40_0x5d10;function a40_0x5d10(_0x319ae5,_0x4d59b9){const _0x4c22ad=a40_0x4c22();return a40_0x5d10=function(_0x5d107e,_0xded277){_0x5d107e=_0x5d107e-0x14d;let _0x373ac9=_0x4c22ad[_0x5d107e];return _0x373ac9;},a40_0x5d10(_0x319ae5,_0x4d59b9);}(function(_0x4dbce1,_0x46c4cd){const _0x54b44a=a40_0x5d10,_0x4d81bf=_0x4dbce1();while(!![]){try{const _0x22e115=parseInt(_0x54b44a(0x158))/0x1+parseInt(_0x54b44a(0x1d3))/0x2*(-parseInt(_0x54b44a(0x1b8))/0x3)+parseInt(_0x54b44a(0x160))/0x4*(parseInt(_0x54b44a(0x1b6))/0x5)+-parseInt(_0x54b44a(0x185))/0x6+parseInt(_0x54b44a(0x165))/0x7+-parseInt(_0x54b44a(0x1ab))/0x8*(-parseInt(_0x54b44a(0x1b7))/0x9)+parseInt(_0x54b44a(0x16c))/0xa;if(_0x22e115===_0x46c4cd)break;else _0x4d81bf['push'](_0x4d81bf['shift']());}catch(_0x2d944e){_0x4d81bf['push'](_0x4d81bf['shift']());}}}(a40_0x4c22,0x86a32));function a40_0x4c22(){const _0x4c1c3c=['2730549BxbXCp','Created\x20On:','paid','PAID','checkPaymentStatus','Error\x20Message:','Amount:','order_id','processWebhook','cancelled','/status','logWhiteDomainError','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','waiting','statusText','Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','result','TransactionConfirmedOn','Currency:','Headers:','cointopay','Missing\x20data\x20in\x20response','Status','2HUOGHg','Raw\x20Response\x20Body:','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','pending','Status\x20API\x20Error:\x20','match','Business\x20Error:\x20','üè¶\x20Payment\x20Detail:','Status:','Parsed\x20Result:','application/json','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','276297QFiRpN','currency','https://tesoft.uk/gateway/cointopay/','created','merchant_reference_id','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','timeout','\x20EUR','46136lpMwvB','stack','failed','Status\x20Code:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','1696009nLCiNr','https://tesoft.uk/gateway/cointopay/status.php','JSON\x20Parse\x20Error:\x20','gateway_payment_id','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Transaction\x20ID:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','13334120bgLzSC','log','/create','loggerService','Response\x20Time:','parse','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','error','CoinToPay\x20payment\x20status\x20check\x20error:','text','Response\x20Body:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','inputCurrency','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','POST','status','HTTP\x20error!\x20status:\x20','HTTP\x20Status:','amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','not\x20found','PENDING','CoinToPay\x20API\x20error:\x20','logWhiteDomainResponse','not\x20confirmed','6486216vcpvlC','Failed\x20to\x20parse\x20JSON\x20response:','Result:','awaiting\x20fiat','PaymentDetail','entries','status_code','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20details:','fromEntries','CreatedOn','Confirmed\x20On:','HTTP\x20','Payment\x20URL:',',\x20body:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','ExpiryTime','now','toLowerCase','Amount','Response\x20data:','apiUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','TransactionID','EUR','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Error\x20message:','message','FAILED','Incomplete\x20response:\x20missing\x20data','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üè¶\x20Extracted\x20IBAN:','statusUrl','QRCodeURL','../loggerService','1896oLAcLk','verifyPayment','stringify','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','EXPIRED','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','data','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','__esModule','üìä\x20Status\x20check\x20URL:','40XptmNx','22725WdCRMY'];a40_0x4c22=function(){return _0x4c1c3c;};return a40_0x4c22();}Object['defineProperty'](exports,a40_0x262a8f(0x1b4),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x262a8f(0x1aa));class CoinToPayService{constructor(){const _0x3d12f7=a40_0x262a8f;this[_0x3d12f7(0x19c)]=_0x3d12f7(0x15a),this['statusUrl']=_0x3d12f7(0x166),console[_0x3d12f7(0x16d)](_0x3d12f7(0x15d)),console[_0x3d12f7(0x16d)](_0x3d12f7(0x1b5),this[_0x3d12f7(0x1a8)]);}async['createPaymentLink'](_0xf75841){const _0x5236cb=a40_0x262a8f,{orderId:_0x2665a3,amount:_0x41fcde}=_0xf75841;console[_0x5236cb(0x16d)](_0x5236cb(0x1a1)+_0x41fcde+_0x5236cb(0x15f));const _0x3c0707={'amount':_0x41fcde},_0x44407c=Date[_0x5236cb(0x198)]();try{console['log'](_0x5236cb(0x179)),console[_0x5236cb(0x16d)]('URL:',this[_0x5236cb(0x19c)]),console['log']('Request\x20Body:',JSON[_0x5236cb(0x1ad)](_0x3c0707,null,0x2)),console[_0x5236cb(0x16d)](_0x5236cb(0x1be),_0x41fcde,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x5236cb(0x16f)][_0x5236cb(0x14d)](_0x5236cb(0x1d0),'/create',_0x5236cb(0x17a),_0x3c0707);const _0x1940ec=await fetch(this[_0x5236cb(0x19c)],{'method':_0x5236cb(0x17a),'headers':{'Content-Type':_0x5236cb(0x156),'Accept':'application/json','User-Agent':_0x5236cb(0x18c)},'body':JSON['stringify'](_0x3c0707)}),_0x21b7c3=Date[_0x5236cb(0x198)]()-_0x44407c;console[_0x5236cb(0x16d)](_0x5236cb(0x172)),console['log'](_0x5236cb(0x154),_0x1940ec['status']),console[_0x5236cb(0x16d)]('Status\x20Text:',_0x1940ec[_0x5236cb(0x1c9)]),console[_0x5236cb(0x16d)](_0x5236cb(0x1cf),Object[_0x5236cb(0x18f)](_0x1940ec['headers'][_0x5236cb(0x18a)]())),console['log'](_0x5236cb(0x170),_0x21b7c3+'ms');const _0x3bc508=await _0x1940ec[_0x5236cb(0x175)]();console['log'](_0x5236cb(0x1d4),_0x3bc508);if(!_0x1940ec['ok']){console[_0x5236cb(0x173)](_0x5236cb(0x17f)),console[_0x5236cb(0x173)](_0x5236cb(0x17d),_0x1940ec[_0x5236cb(0x17b)]),console[_0x5236cb(0x173)](_0x5236cb(0x176),_0x3bc508),loggerService_1[_0x5236cb(0x16f)][_0x5236cb(0x183)](_0x5236cb(0x1d0),'/create',_0x1940ec[_0x5236cb(0x17b)],_0x3bc508,_0x21b7c3),loggerService_1[_0x5236cb(0x16f)][_0x5236cb(0x1c3)](_0x5236cb(0x1d0),_0x5236cb(0x16e),_0x5236cb(0x192)+_0x1940ec['status']+':\x20'+_0x3bc508);throw new Error(_0x5236cb(0x17c)+_0x1940ec['status']+_0x5236cb(0x194)+_0x3bc508);}let _0x3f8fd3;try{_0x3f8fd3=JSON[_0x5236cb(0x171)](_0x3bc508);}catch(_0x139c00){console['error'](_0x5236cb(0x186),_0x139c00),loggerService_1['loggerService'][_0x5236cb(0x1c3)](_0x5236cb(0x1d0),_0x5236cb(0x16e),_0x5236cb(0x167)+_0x139c00);throw new Error(_0x5236cb(0x1c7)+_0x3bc508);}console[_0x5236cb(0x16d)](_0x5236cb(0x1cb)),console[_0x5236cb(0x16d)](_0x5236cb(0x155),JSON[_0x5236cb(0x1ad)](_0x3f8fd3,null,0x2)),loggerService_1[_0x5236cb(0x16f)][_0x5236cb(0x183)]('cointopay',_0x5236cb(0x16e),_0x1940ec[_0x5236cb(0x17b)],_0x3f8fd3,_0x21b7c3);if(_0x3f8fd3[_0x5236cb(0x173)]){const _0x46ec38=_0x3f8fd3[_0x5236cb(0x1a3)]||_0x3f8fd3['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x5236cb(0x196)),console[_0x5236cb(0x173)](_0x5236cb(0x1bd),_0x46ec38),loggerService_1[_0x5236cb(0x16f)]['logWhiteDomainError'](_0x5236cb(0x1d0),_0x5236cb(0x16e),_0x5236cb(0x152)+_0x46ec38);throw new Error(_0x5236cb(0x182)+_0x46ec38);}if(!_0x3f8fd3['payment_url']||!_0x3f8fd3[_0x5236cb(0x168)]){console[_0x5236cb(0x173)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5236cb(0x173)](_0x5236cb(0x195)),console[_0x5236cb(0x173)](_0x5236cb(0x19b),_0x3f8fd3),loggerService_1['loggerService'][_0x5236cb(0x1c3)](_0x5236cb(0x1d0),'/create',_0x5236cb(0x1a6));throw new Error(_0x5236cb(0x18d));}return console[_0x5236cb(0x16d)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log']('Gateway\x20Payment\x20ID:',_0x3f8fd3[_0x5236cb(0x168)]),console[_0x5236cb(0x16d)](_0x5236cb(0x193),_0x3f8fd3['payment_url']),console[_0x5236cb(0x16d)](_0x5236cb(0x1be),_0x41fcde,_0x5236cb(0x1a0)),{'gateway_payment_id':_0x3f8fd3[_0x5236cb(0x168)],'payment_url':_0x3f8fd3['payment_url']};}catch(_0xdc703c){console[_0x5236cb(0x173)](_0x5236cb(0x16b)),console[_0x5236cb(0x173)](_0x5236cb(0x18e),_0xdc703c),loggerService_1['loggerService'][_0x5236cb(0x1c3)](_0x5236cb(0x1d0),_0x5236cb(0x16e),_0xdc703c);if(_0xdc703c instanceof Error){console[_0x5236cb(0x173)](_0x5236cb(0x1a2),_0xdc703c[_0x5236cb(0x1a3)]),console[_0x5236cb(0x173)](_0x5236cb(0x1b2),_0xdc703c[_0x5236cb(0x161)]);throw new Error(_0x5236cb(0x19e)+_0xdc703c[_0x5236cb(0x1a3)]);}throw new Error(_0x5236cb(0x1c6));}}async['checkPaymentStatus'](_0x3ae2a7){const _0x31edaa=a40_0x262a8f,_0x61092c=Date['now']();try{console[_0x31edaa(0x16d)](_0x31edaa(0x169)+_0x3ae2a7);const _0x483c72={'gatewayPaymentId':_0x3ae2a7};loggerService_1[_0x31edaa(0x16f)]['logWhiteDomainRequest'](_0x31edaa(0x1d0),_0x31edaa(0x1c2),'POST',_0x483c72);const _0x2d2cfc=await fetch(this[_0x31edaa(0x1a8)],{'method':_0x31edaa(0x17a),'headers':{'Content-Type':_0x31edaa(0x156),'Accept':_0x31edaa(0x156),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x483c72)}),_0x5535ab=Date[_0x31edaa(0x198)]()-_0x61092c;console[_0x31edaa(0x16d)](_0x31edaa(0x14e)),console[_0x31edaa(0x16d)](_0x31edaa(0x154),_0x2d2cfc[_0x31edaa(0x17b)]),console['log'](_0x31edaa(0x170),_0x5535ab+'ms');if(!_0x2d2cfc['ok']){const _0x33a6c3=await _0x2d2cfc['text']();console[_0x31edaa(0x173)](_0x31edaa(0x17d),_0x2d2cfc[_0x31edaa(0x17b)]),console[_0x31edaa(0x173)](_0x31edaa(0x176),_0x33a6c3),loggerService_1['loggerService'][_0x31edaa(0x183)](_0x31edaa(0x1d0),_0x31edaa(0x1c2),_0x2d2cfc[_0x31edaa(0x17b)],_0x33a6c3,_0x5535ab),loggerService_1['loggerService'][_0x31edaa(0x1c3)]('cointopay',_0x31edaa(0x1c2),_0x31edaa(0x192)+_0x2d2cfc[_0x31edaa(0x17b)]+':\x20'+_0x33a6c3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2d2cfc[_0x31edaa(0x17b)]);}const _0x441aa3=await _0x2d2cfc[_0x31edaa(0x175)]();console[_0x31edaa(0x16d)](_0x31edaa(0x1d4),_0x441aa3);let _0x422dfc;try{_0x422dfc=JSON[_0x31edaa(0x171)](_0x441aa3);}catch(_0x3b6056){console['error'](_0x31edaa(0x186),_0x3b6056),loggerService_1[_0x31edaa(0x16f)]['logWhiteDomainError'](_0x31edaa(0x1d0),'/status','JSON\x20Parse\x20Error:\x20'+_0x3b6056);throw new Error(_0x31edaa(0x19d)+_0x441aa3);}loggerService_1[_0x31edaa(0x16f)][_0x31edaa(0x183)](_0x31edaa(0x1d0),_0x31edaa(0x1c2),_0x2d2cfc[_0x31edaa(0x17b)],_0x422dfc,_0x5535ab),console[_0x31edaa(0x16d)](_0x31edaa(0x1ae)),console[_0x31edaa(0x16d)](_0x31edaa(0x187),_0x422dfc['result']),console[_0x31edaa(0x16d)](_0x31edaa(0x163),_0x422dfc[_0x31edaa(0x18b)]),console[_0x31edaa(0x16d)](_0x31edaa(0x1c4),_0x422dfc[_0x31edaa(0x1b1)]?.[_0x31edaa(0x1d2)]),console['log'](_0x31edaa(0x1be),_0x422dfc['data']?.[_0x31edaa(0x19a)]),console[_0x31edaa(0x16d)](_0x31edaa(0x1ce),_0x422dfc[_0x31edaa(0x1b1)]?.[_0x31edaa(0x178)]);if(_0x422dfc[_0x31edaa(0x1cc)]!=='success'||_0x422dfc[_0x31edaa(0x18b)]!==0xc8){const _0x4bcfb8=_0x422dfc[_0x31edaa(0x1a3)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x31edaa(0x1b0)),console['error']('Error\x20Message:',_0x4bcfb8),loggerService_1['loggerService'][_0x31edaa(0x1c3)]('cointopay',_0x31edaa(0x1c2),_0x31edaa(0x150)+_0x4bcfb8);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x4bcfb8);}if(!_0x422dfc[_0x31edaa(0x1b1)]){console[_0x31edaa(0x173)](_0x31edaa(0x1c5)),console['error'](_0x31edaa(0x1d1)),loggerService_1['loggerService'][_0x31edaa(0x1c3)](_0x31edaa(0x1d0),_0x31edaa(0x1c2),_0x31edaa(0x1a5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x1aaa79=_0x31edaa(0x181);switch(_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x1d2)]?.[_0x31edaa(0x199)]()){case _0x31edaa(0x1ba):_0x1aaa79=_0x31edaa(0x1bb);break;case _0x31edaa(0x1c1):case'failed':case _0x31edaa(0x173):_0x1aaa79=_0x31edaa(0x1a4);break;case'expired':case _0x31edaa(0x15e):_0x1aaa79=_0x31edaa(0x1af);break;case _0x31edaa(0x1c8):case'awaiting\x20fiat':case _0x31edaa(0x14f):case _0x31edaa(0x15b):default:_0x1aaa79=_0x31edaa(0x181);break;}let _0x5d6276,_0x16730f;if(_0x422dfc[_0x31edaa(0x1b1)]['PaymentDetail']){const _0x5e4c0a=_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x189)];console[_0x31edaa(0x16d)](_0x31edaa(0x153),_0x5e4c0a);const _0x29489e=_0x5e4c0a[_0x31edaa(0x151)](/IBAN\s+([A-Z0-9]+)/i);_0x29489e&&(_0x5d6276=_0x29489e[0x1],console['log'](_0x31edaa(0x1a7),_0x5d6276)),_0x16730f=_0x5e4c0a;}const _0x291cfa={'iban':_0x5d6276,'bankDetails':_0x16730f,'transactionId':_0x422dfc['data'][_0x31edaa(0x19f)],'coinAddress':_0x422dfc[_0x31edaa(0x1b1)]['coinAddress'],'qrCodeUrl':_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x1a9)],'expiryTime':_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x197)],'createdOn':_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x190)],'confirmedOn':_0x422dfc[_0x31edaa(0x1b1)]['TransactionConfirmedOn']};console['log'](_0x31edaa(0x1b3)),console[_0x31edaa(0x16d)]('Status:',_0x422dfc[_0x31edaa(0x1b1)]['Status'],'->',_0x1aaa79),console['log'](_0x31edaa(0x1be),_0x422dfc[_0x31edaa(0x1b1)]['Amount'],_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x178)]),console[_0x31edaa(0x16d)](_0x31edaa(0x16a),_0x422dfc['data']['TransactionID']),console[_0x31edaa(0x16d)]('IBAN:',_0x5d6276||_0x31edaa(0x180)),console[_0x31edaa(0x16d)](_0x31edaa(0x1b9),_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x190)]),console['log'](_0x31edaa(0x191),_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x1cd)]||_0x31edaa(0x184));if(_0x422dfc['data'][_0x31edaa(0x1d2)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x31edaa(0x16d)](_0x31edaa(0x164));else _0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x1d2)]?.[_0x31edaa(0x199)]()==='paid'&&console[_0x31edaa(0x16d)](_0x31edaa(0x177));return{'status':_0x1aaa79,'amount':parseFloat(_0x422dfc[_0x31edaa(0x1b1)][_0x31edaa(0x19a)])||undefined,'currency':_0x422dfc['data'][_0x31edaa(0x178)]||'EUR','paymentDetails':_0x291cfa};}catch(_0x5cbba4){console[_0x31edaa(0x173)](_0x31edaa(0x174),_0x5cbba4),loggerService_1[_0x31edaa(0x16f)][_0x31edaa(0x1c3)](_0x31edaa(0x1d0),'/status',_0x5cbba4);throw new Error(_0x31edaa(0x157)+(_0x5cbba4 instanceof Error?_0x5cbba4['message']:_0x31edaa(0x1ca)));}}async[a40_0x262a8f(0x1ac)](_0x4f521a){const _0x3c9e27=a40_0x262a8f,_0x3641ea=await this[_0x3c9e27(0x1bc)](_0x4f521a);return{'status':_0x3641ea[_0x3c9e27(0x17b)],'amount':_0x3641ea['amount'],'currency':_0x3641ea[_0x3c9e27(0x159)]};}async[a40_0x262a8f(0x1c0)](_0x312f24){const _0x350d5e=a40_0x262a8f;console[_0x350d5e(0x16d)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x312f24);let _0x2d2de8=_0x350d5e(0x181);switch(_0x312f24['status']?.[_0x350d5e(0x199)]()){case _0x350d5e(0x1ba):_0x2d2de8=_0x350d5e(0x1bb);break;case _0x350d5e(0x1c1):case _0x350d5e(0x162):case _0x350d5e(0x173):_0x2d2de8=_0x350d5e(0x1a4);break;case'expired':case _0x350d5e(0x15e):_0x2d2de8=_0x350d5e(0x1af);break;case _0x350d5e(0x14f):case _0x350d5e(0x1c8):case _0x350d5e(0x188):case'created':default:_0x2d2de8='PENDING';break;}return{'paymentId':_0x312f24[_0x350d5e(0x1bf)]||_0x312f24[_0x350d5e(0x15c)]||'','status':_0x2d2de8,'amount':_0x312f24[_0x350d5e(0x17e)],'currency':_0x312f24[_0x350d5e(0x159)]||_0x350d5e(0x1a0)};}}exports['CoinToPayService']=CoinToPayService;