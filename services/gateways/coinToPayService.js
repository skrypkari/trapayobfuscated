'use strict';const a41_0x2edee0=a41_0x4e2c;(function(_0x4ac4c3,_0x253c51){const _0x452b01=a41_0x4e2c,_0x2e44e0=_0x4ac4c3();while(!![]){try{const _0x3b9575=parseInt(_0x452b01(0x16a))/0x1*(parseInt(_0x452b01(0x171))/0x2)+parseInt(_0x452b01(0x179))/0x3+-parseInt(_0x452b01(0x1de))/0x4*(parseInt(_0x452b01(0x1bd))/0x5)+parseInt(_0x452b01(0x188))/0x6+-parseInt(_0x452b01(0x1be))/0x7+-parseInt(_0x452b01(0x1e1))/0x8+parseInt(_0x452b01(0x17f))/0x9;if(_0x3b9575===_0x253c51)break;else _0x2e44e0['push'](_0x2e44e0['shift']());}catch(_0x52b926){_0x2e44e0['push'](_0x2e44e0['shift']());}}}(a41_0x3f59,0x9af1e));function a41_0x3f59(){const _0x52a2fe=['Error\x20Message:','__esModule','Response\x20Time:','HTTP\x20error!\x20status:\x20','coinAddress','expired','ExpiryTime','success','Confirmed\x20On:','message','Error\x20stack:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Gateway\x20Payment\x20ID:','application/json','../loggerService','logWhiteDomainError','failed','pending','/status','verifyPayment','stringify','cancelled','Status','processWebhook','Payment\x20Status:','awaiting\x20fiat','order_id','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','headers','3575sfDdrw','7132531GWMbhV','parse','checkPaymentStatus','PaymentDetail','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','currency','Result:','payment_url','paid','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Headers:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','waiting','JSON\x20Parse\x20Error:\x20','Error\x20message:','text','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','timeout','POST','toLowerCase','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','HTTP\x20','TesSoft\x20Payment\x20System/1.0','fromEntries','HTTP\x20Status:','FAILED','gateway_payment_id','stack','üìä\x20Status\x20check\x20URL:','Amount:','https://tesoft.uk/gateway/cointopay/','3300EyFORr','Payment\x20URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','5888424JWddDI','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','üè¶\x20Payment\x20Detail:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Request\x20Body:','statusUrl','EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','1XMvnpJ','TransactionID','Response\x20data:','status','Parsed\x20Result:','apiUrl','PENDING','413696vSBETO','Failed\x20to\x20parse\x20JSON\x20response:','QRCodeURL','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20ERROR\x20===','üè¶\x20Extracted\x20IBAN:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','cointopay','229857rfZXOs','error','Unknown\x20error','https://tesoft.uk/gateway/cointopay/status.php','/create','CreatedOn','17234352expitu','Amount','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Transaction\x20ID:','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EXPIRED','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20SUCCESS\x20===','4686720cKfIMt','inputCurrency','Status\x20API\x20Error:\x20','result','PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','log','Status:','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status\x20Text:','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20Body:','Error\x20details:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response',',\x20body:\x20','data','Raw\x20Response\x20Body:','loggerService','CoinToPayService','status_code','created','now'];a41_0x3f59=function(){return _0x52a2fe;};return a41_0x3f59();}function a41_0x4e2c(_0x2956be,_0x16f69d){const _0x3f5904=a41_0x3f59();return a41_0x4e2c=function(_0x4e2cc6,_0x722eb8){_0x4e2cc6=_0x4e2cc6-0x160;let _0x4ceb07=_0x3f5904[_0x4e2cc6];return _0x4ceb07;},a41_0x4e2c(_0x2956be,_0x16f69d);}Object['defineProperty'](exports,a41_0x2edee0(0x1a0),{'value':!![]}),exports[a41_0x2edee0(0x19b)]=void 0x0;const loggerService_1=require(a41_0x2edee0(0x1ad));class CoinToPayService{constructor(){const _0x3774a4=a41_0x2edee0;this[_0x3774a4(0x16f)]=_0x3774a4(0x1dd),this[_0x3774a4(0x166)]=_0x3774a4(0x17c),console[_0x3774a4(0x18e)](_0x3774a4(0x177)),console[_0x3774a4(0x18e)](_0x3774a4(0x1db),this['statusUrl']);}async['createPaymentLink'](_0x4d6797){const _0xef72a6=a41_0x2edee0,{orderId:_0x76f6a0,amount:_0x35cede}=_0x4d6797;console[_0xef72a6(0x18e)](_0xef72a6(0x1cf)+_0x35cede+'\x20EUR');const _0xe3cf6e={'amount':_0x35cede},_0x2a545e=Date[_0xef72a6(0x19e)]();try{console[_0xef72a6(0x18e)](_0xef72a6(0x1d3)),console[_0xef72a6(0x18e)]('URL:',this['apiUrl']),console['log'](_0xef72a6(0x165),JSON[_0xef72a6(0x1b3)](_0xe3cf6e,null,0x2)),console[_0xef72a6(0x18e)]('Amount:',_0x35cede,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0xef72a6(0x19a)][_0xef72a6(0x190)](_0xef72a6(0x178),'/create',_0xef72a6(0x1d1),_0xe3cf6e);const _0x3a9655=await fetch(this[_0xef72a6(0x16f)],{'method':_0xef72a6(0x1d1),'headers':{'Content-Type':_0xef72a6(0x1ac),'Accept':_0xef72a6(0x1ac),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xef72a6(0x1b3)](_0xe3cf6e)}),_0x583a07=Date[_0xef72a6(0x19e)]()-_0x2a545e;console[_0xef72a6(0x18e)](_0xef72a6(0x1ca)),console[_0xef72a6(0x18e)](_0xef72a6(0x18f),_0x3a9655[_0xef72a6(0x16d)]),console[_0xef72a6(0x18e)](_0xef72a6(0x192),_0x3a9655['statusText']),console[_0xef72a6(0x18e)](_0xef72a6(0x1c9),Object[_0xef72a6(0x1d6)](_0x3a9655[_0xef72a6(0x1bc)]['entries']())),console[_0xef72a6(0x18e)](_0xef72a6(0x1a1),_0x583a07+'ms');const _0x6b1bf0=await _0x3a9655[_0xef72a6(0x1ce)]();console[_0xef72a6(0x18e)](_0xef72a6(0x199),_0x6b1bf0);if(!_0x3a9655['ok']){console[_0xef72a6(0x17a)](_0xef72a6(0x175)),console['error'](_0xef72a6(0x1d7),_0x3a9655['status']),console[_0xef72a6(0x17a)](_0xef72a6(0x194),_0x6b1bf0),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay','/create',_0x3a9655[_0xef72a6(0x16d)],_0x6b1bf0,_0x583a07),loggerService_1['loggerService'][_0xef72a6(0x1ae)](_0xef72a6(0x178),'/create',_0xef72a6(0x1d4)+_0x3a9655[_0xef72a6(0x16d)]+':\x20'+_0x6b1bf0);throw new Error(_0xef72a6(0x1a2)+_0x3a9655['status']+_0xef72a6(0x197)+_0x6b1bf0);}let _0x89c021;try{_0x89c021=JSON[_0xef72a6(0x1bf)](_0x6b1bf0);}catch(_0x54e5a4){console['error'](_0xef72a6(0x172),_0x54e5a4),loggerService_1[_0xef72a6(0x19a)][_0xef72a6(0x1ae)](_0xef72a6(0x178),_0xef72a6(0x17d),_0xef72a6(0x1cc)+_0x54e5a4);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x6b1bf0);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0xef72a6(0x18e)](_0xef72a6(0x16e),JSON[_0xef72a6(0x1b3)](_0x89c021,null,0x2)),loggerService_1[_0xef72a6(0x19a)]['logWhiteDomainResponse'](_0xef72a6(0x178),'/create',_0x3a9655[_0xef72a6(0x16d)],_0x89c021,_0x583a07);if(_0x89c021[_0xef72a6(0x17a)]){const _0x4e70b8=_0x89c021[_0xef72a6(0x1a8)]||_0x89c021[_0xef72a6(0x17a)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0xef72a6(0x17a)](_0xef72a6(0x1aa)),console[_0xef72a6(0x17a)]('Error\x20Message:',_0x4e70b8),loggerService_1[_0xef72a6(0x19a)][_0xef72a6(0x1ae)](_0xef72a6(0x178),_0xef72a6(0x17d),'Business\x20Error:\x20'+_0x4e70b8);throw new Error(_0xef72a6(0x1ba)+_0x4e70b8);}if(!_0x89c021[_0xef72a6(0x1c6)]||!_0x89c021['gateway_payment_id']){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xef72a6(0x17a)](_0xef72a6(0x196)),console['error'](_0xef72a6(0x16c),_0x89c021),loggerService_1[_0xef72a6(0x19a)][_0xef72a6(0x1ae)](_0xef72a6(0x178),_0xef72a6(0x17d),_0xef72a6(0x168));throw new Error(_0xef72a6(0x1c8));}return console[_0xef72a6(0x18e)](_0xef72a6(0x187)),console['log'](_0xef72a6(0x1ab),_0x89c021[_0xef72a6(0x1d9)]),console['log'](_0xef72a6(0x1df),_0x89c021[_0xef72a6(0x1c6)]),console[_0xef72a6(0x18e)](_0xef72a6(0x1dc),_0x35cede,_0xef72a6(0x167)),{'gateway_payment_id':_0x89c021['gateway_payment_id'],'payment_url':_0x89c021[_0xef72a6(0x1c6)]};}catch(_0x5a9cac){console[_0xef72a6(0x17a)](_0xef72a6(0x1c2)),console[_0xef72a6(0x17a)](_0xef72a6(0x195),_0x5a9cac),loggerService_1[_0xef72a6(0x19a)][_0xef72a6(0x1ae)](_0xef72a6(0x178),_0xef72a6(0x17d),_0x5a9cac);if(_0x5a9cac instanceof Error){console['error'](_0xef72a6(0x1cd),_0x5a9cac['message']),console[_0xef72a6(0x17a)](_0xef72a6(0x1a9),_0x5a9cac[_0xef72a6(0x1da)]);throw new Error(_0xef72a6(0x181)+_0x5a9cac[_0xef72a6(0x1a8)]);}throw new Error(_0xef72a6(0x18d));}}async[a41_0x2edee0(0x1c0)](_0xe66d88){const _0x44d10e=a41_0x2edee0,_0x4e0f3b=Date['now']();try{console[_0x44d10e(0x18e)](_0x44d10e(0x160)+_0xe66d88);const _0x1b33fd={'gatewayPaymentId':_0xe66d88};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x44d10e(0x178),'/status','POST',_0x1b33fd);const _0x41e6c6=await fetch(this[_0x44d10e(0x166)],{'method':'POST','headers':{'Content-Type':_0x44d10e(0x1ac),'Accept':'application/json','User-Agent':_0x44d10e(0x1d5)},'body':JSON[_0x44d10e(0x1b3)](_0x1b33fd)}),_0x14756d=Date[_0x44d10e(0x19e)]()-_0x4e0f3b;console[_0x44d10e(0x18e)](_0x44d10e(0x1bb)),console[_0x44d10e(0x18e)]('Status:',_0x41e6c6['status']),console[_0x44d10e(0x18e)](_0x44d10e(0x1a1),_0x14756d+'ms');if(!_0x41e6c6['ok']){const _0xe1c41f=await _0x41e6c6[_0x44d10e(0x1ce)]();console[_0x44d10e(0x17a)](_0x44d10e(0x1d7),_0x41e6c6[_0x44d10e(0x16d)]),console[_0x44d10e(0x17a)]('Response\x20Body:',_0xe1c41f),loggerService_1[_0x44d10e(0x19a)][_0x44d10e(0x174)](_0x44d10e(0x178),_0x44d10e(0x1b1),_0x41e6c6[_0x44d10e(0x16d)],_0xe1c41f,_0x14756d),loggerService_1['loggerService']['logWhiteDomainError'](_0x44d10e(0x178),_0x44d10e(0x1b1),'HTTP\x20'+_0x41e6c6[_0x44d10e(0x16d)]+':\x20'+_0xe1c41f);throw new Error(_0x44d10e(0x1a2)+_0x41e6c6['status']);}const _0x157db6=await _0x41e6c6['text']();console[_0x44d10e(0x18e)](_0x44d10e(0x199),_0x157db6);let _0x3ff035;try{_0x3ff035=JSON['parse'](_0x157db6);}catch(_0x5114e4){console[_0x44d10e(0x17a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5114e4),loggerService_1[_0x44d10e(0x19a)][_0x44d10e(0x1ae)]('cointopay',_0x44d10e(0x1b1),_0x44d10e(0x1cc)+_0x5114e4);throw new Error(_0x44d10e(0x1e0)+_0x157db6);}loggerService_1[_0x44d10e(0x19a)]['logWhiteDomainResponse'](_0x44d10e(0x178),_0x44d10e(0x1b1),_0x41e6c6['status'],_0x3ff035,_0x14756d),console[_0x44d10e(0x18e)](_0x44d10e(0x191)),console[_0x44d10e(0x18e)](_0x44d10e(0x1c5),_0x3ff035[_0x44d10e(0x18b)]),console['log']('Status\x20Code:',_0x3ff035['status_code']),console['log'](_0x44d10e(0x1b7),_0x3ff035[_0x44d10e(0x198)]?.[_0x44d10e(0x1b5)]),console[_0x44d10e(0x18e)]('Amount:',_0x3ff035[_0x44d10e(0x198)]?.[_0x44d10e(0x180)]),console[_0x44d10e(0x18e)]('Currency:',_0x3ff035[_0x44d10e(0x198)]?.['inputCurrency']);if(_0x3ff035[_0x44d10e(0x18b)]!==_0x44d10e(0x1a6)||_0x3ff035[_0x44d10e(0x19c)]!==0xc8){const _0x58b691=_0x3ff035[_0x44d10e(0x1a8)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x44d10e(0x164)),console[_0x44d10e(0x17a)](_0x44d10e(0x19f),_0x58b691),loggerService_1['loggerService'][_0x44d10e(0x1ae)](_0x44d10e(0x178),_0x44d10e(0x1b1),_0x44d10e(0x18a)+_0x58b691);throw new Error(_0x44d10e(0x163)+_0x58b691);}if(!_0x3ff035[_0x44d10e(0x198)]){console[_0x44d10e(0x17a)](_0x44d10e(0x184)),console[_0x44d10e(0x17a)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x44d10e(0x1ae)](_0x44d10e(0x178),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x177608='PENDING';switch(_0x3ff035['data'][_0x44d10e(0x1b5)]?.[_0x44d10e(0x1d2)]()){case _0x44d10e(0x1c7):_0x177608=_0x44d10e(0x18c);break;case _0x44d10e(0x1b4):case _0x44d10e(0x1af):case _0x44d10e(0x17a):_0x177608='FAILED';break;case _0x44d10e(0x1a4):case _0x44d10e(0x1d0):_0x177608=_0x44d10e(0x185);break;case _0x44d10e(0x1cb):case _0x44d10e(0x1b8):case _0x44d10e(0x1b0):case _0x44d10e(0x19d):default:_0x177608=_0x44d10e(0x170);break;}let _0x44871e,_0x2f404c;if(_0x3ff035['data'][_0x44d10e(0x1c1)]){const _0x4e2713=_0x3ff035['data'][_0x44d10e(0x1c1)];console[_0x44d10e(0x18e)](_0x44d10e(0x161),_0x4e2713);const _0x176b86=_0x4e2713['match'](/IBAN\s+([A-Z0-9]+)/i);_0x176b86&&(_0x44871e=_0x176b86[0x1],console[_0x44d10e(0x18e)](_0x44d10e(0x176),_0x44871e)),_0x2f404c=_0x4e2713;}const _0x456f04={'iban':_0x44871e,'bankDetails':_0x2f404c,'transactionId':_0x3ff035['data']['TransactionID'],'coinAddress':_0x3ff035['data'][_0x44d10e(0x1a3)],'qrCodeUrl':_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x173)],'expiryTime':_0x3ff035['data'][_0x44d10e(0x1a5)],'createdOn':_0x3ff035['data'][_0x44d10e(0x17e)],'confirmedOn':_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x183)]};console['log'](_0x44d10e(0x169)),console[_0x44d10e(0x18e)]('Status:',_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x1b5)],'->',_0x177608),console[_0x44d10e(0x18e)]('Amount:',_0x3ff035['data'][_0x44d10e(0x180)],_0x3ff035['data'][_0x44d10e(0x189)]),console[_0x44d10e(0x18e)](_0x44d10e(0x182),_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x16b)]),console[_0x44d10e(0x18e)]('IBAN:',_0x44871e||'not\x20found'),console[_0x44d10e(0x18e)]('Created\x20On:',_0x3ff035['data'][_0x44d10e(0x17e)]),console[_0x44d10e(0x18e)](_0x44d10e(0x1a7),_0x3ff035[_0x44d10e(0x198)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x1b5)]?.[_0x44d10e(0x1d2)]()===_0x44d10e(0x1b8))console[_0x44d10e(0x18e)](_0x44d10e(0x186));else _0x3ff035['data'][_0x44d10e(0x1b5)]?.['toLowerCase']()===_0x44d10e(0x1c7)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x177608,'amount':parseFloat(_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x180)])||undefined,'currency':_0x3ff035[_0x44d10e(0x198)][_0x44d10e(0x189)]||_0x44d10e(0x167),'paymentDetails':_0x456f04};}catch(_0x1cd237){console['error'](_0x44d10e(0x193),_0x1cd237),loggerService_1['loggerService'][_0x44d10e(0x1ae)](_0x44d10e(0x178),'/status',_0x1cd237);throw new Error(_0x44d10e(0x162)+(_0x1cd237 instanceof Error?_0x1cd237[_0x44d10e(0x1a8)]:_0x44d10e(0x17b)));}}async[a41_0x2edee0(0x1b2)](_0x5aa5d5){const _0x2135c9=a41_0x2edee0,_0x2b1c66=await this['checkPaymentStatus'](_0x5aa5d5);return{'status':_0x2b1c66[_0x2135c9(0x16d)],'amount':_0x2b1c66['amount'],'currency':_0x2b1c66[_0x2135c9(0x1c4)]};}async[a41_0x2edee0(0x1b6)](_0x331de4){const _0xa32ba2=a41_0x2edee0;console[_0xa32ba2(0x18e)](_0xa32ba2(0x1c3),_0x331de4);let _0x53a314='PENDING';switch(_0x331de4['status']?.[_0xa32ba2(0x1d2)]()){case'paid':_0x53a314=_0xa32ba2(0x18c);break;case _0xa32ba2(0x1b4):case _0xa32ba2(0x1af):case _0xa32ba2(0x17a):_0x53a314=_0xa32ba2(0x1d8);break;case _0xa32ba2(0x1a4):case _0xa32ba2(0x1d0):_0x53a314=_0xa32ba2(0x185);break;case _0xa32ba2(0x1b0):case _0xa32ba2(0x1cb):case _0xa32ba2(0x1b8):case _0xa32ba2(0x19d):default:_0x53a314=_0xa32ba2(0x170);break;}return{'paymentId':_0x331de4[_0xa32ba2(0x1b9)]||_0x331de4['merchant_reference_id']||'','status':_0x53a314,'amount':_0x331de4['amount'],'currency':_0x331de4[_0xa32ba2(0x1c4)]||_0xa32ba2(0x167)};}}exports['CoinToPayService']=CoinToPayService;