'use strict';function a59_0x2be0(_0x413d13,_0x2242fa){_0x413d13=_0x413d13-0x1de;const _0x55db42=a59_0x55db();let _0x2be051=_0x55db42[_0x413d13];return _0x2be051;}const a59_0x4184ca=a59_0x2be0;(function(_0x5adb43,_0x5aae0d){const _0x262ffc=a59_0x2be0,_0x5b667e=_0x5adb43();while(!![]){try{const _0x40ae4e=-parseInt(_0x262ffc(0x246))/0x1+parseInt(_0x262ffc(0x20f))/0x2*(-parseInt(_0x262ffc(0x214))/0x3)+parseInt(_0x262ffc(0x20c))/0x4*(parseInt(_0x262ffc(0x201))/0x5)+-parseInt(_0x262ffc(0x253))/0x6*(-parseInt(_0x262ffc(0x24c))/0x7)+parseInt(_0x262ffc(0x1f6))/0x8+-parseInt(_0x262ffc(0x267))/0x9+-parseInt(_0x262ffc(0x1e1))/0xa*(parseInt(_0x262ffc(0x252))/0xb);if(_0x40ae4e===_0x5aae0d)break;else _0x5b667e['push'](_0x5b667e['shift']());}catch(_0x84038){_0x5b667e['push'](_0x5b667e['shift']());}}}(a59_0x55db,0x38dbe));Object[a59_0x4184ca(0x217)](exports,a59_0x4184ca(0x24a),{'value':!![]}),exports[a59_0x4184ca(0x20a)]=void 0x0;function a59_0x55db(){const _0x80d0c8=['logWhiteDomainResponse','202097aDoEYM','Status','pending','https://tesoft.uk/gateway/cointopay/','JSON\x20Parse\x20Error:\x20','timeout','11AfQnAP','42MFUvzV','Payment\x20URL\x20(modified):','Headers:','ExpiryTime','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','toLowerCase','Status\x20API\x20Error:\x20','paid','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','IBAN:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Currency:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','text','headers','apiUrl','TransactionID','ðŸ“Š\x20Status\x20check\x20URL:','1223784GavVdq','cancelled','status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','parse','901310QIpmLV','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','FAILED','failed','created','coinAddress','/status','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Raw\x20Response\x20Body:','&alternative=false',',\x20body:\x20','Status\x20Text:','Error\x20stack:','currency','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','result','entries','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','expired','3597928XpNOFK','Payment\x20URL\x20(original):','verifyPayment','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','TransactionConfirmedOn','Created\x20On:','Status\x20Code:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','===\x20COINTOPAY\x20API\x20ERROR\x20===','5kKACPq','order_id','Business\x20Error:\x20','gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','awaiting\x20fiat','QRCodeURL','Result:','Response\x20Body:','CoinToPayService','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','293836SALAqH','waiting','Payment\x20System/1.0','292obcxuG','Amount','processWebhook','https://tesoft.uk/gateway/cointopay/status.php','HTTP\x20error!\x20status:\x20','1443jIucTy','logWhiteDomainError','stringify','defineProperty','EUR','cointopay','inputCurrency','CreatedOn','ðŸ¦\x20Payment\x20Detail:','merchant_reference_id','URL:','Confirmed\x20On:','loggerService','application/json','Response\x20Time:','error','Transaction\x20ID:','\x20EUR','POST','logWhiteDomainRequest','EXPIRED','message','Error\x20message:','success','statusUrl','checkPaymentStatus','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','ðŸ¦\x20Extracted\x20IBAN:','PAID','Amount:','Gateway\x20Payment\x20ID:','payment_url','statusText','CoinToPay\x20API\x20error:\x20','../loggerService','===\x20COINTOPAY\x20SUCCESS\x20===','log','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','now','amount','PaymentDetail','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','data','Payment\x20Status:','Parsed\x20Result:','Status:','/create','196070fcNtdI','status_code','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Request\x20Body:','__esModule'];a59_0x55db=function(){return _0x80d0c8;};return a59_0x55db();}const loggerService_1=require(a59_0x4184ca(0x236));class CoinToPayService{constructor(){const _0x5baed6=a59_0x4184ca;this['apiUrl']=_0x5baed6(0x24f),this[_0x5baed6(0x22c)]=_0x5baed6(0x212),console['log'](_0x5baed6(0x20b)),console[_0x5baed6(0x238)](_0x5baed6(0x266),this[_0x5baed6(0x22c)]);}async['createPaymentLink'](_0xc93d){const _0x37e7f7=a59_0x4184ca,{orderId:_0x3c7b3d,amount:_0x25eee2}=_0xc93d;console[_0x37e7f7(0x238)](_0x37e7f7(0x22e)+_0x25eee2+_0x37e7f7(0x225));const _0x3c792={'amount':_0x25eee2},_0x12a20d=Date[_0x37e7f7(0x23b)]();try{console[_0x37e7f7(0x238)](_0x37e7f7(0x25f)),console[_0x37e7f7(0x238)](_0x37e7f7(0x21e),this[_0x37e7f7(0x264)]),console[_0x37e7f7(0x238)](_0x37e7f7(0x249),JSON[_0x37e7f7(0x216)](_0x3c792,null,0x2)),console[_0x37e7f7(0x238)](_0x37e7f7(0x231),_0x25eee2,_0x37e7f7(0x205)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x37e7f7(0x219),_0x37e7f7(0x245),_0x37e7f7(0x226),_0x3c792);const _0x269769=await fetch(this[_0x37e7f7(0x264)],{'method':'POST','headers':{'Content-Type':_0x37e7f7(0x221),'Accept':_0x37e7f7(0x221),'User-Agent':_0x37e7f7(0x20e)},'body':JSON['stringify'](_0x3c792)}),_0x32ee37=Date[_0x37e7f7(0x23b)]()-_0x12a20d;console[_0x37e7f7(0x238)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x37e7f7(0x238)](_0x37e7f7(0x244),_0x269769[_0x37e7f7(0x1de)]),console[_0x37e7f7(0x238)](_0x37e7f7(0x1ec),_0x269769[_0x37e7f7(0x234)]),console[_0x37e7f7(0x238)](_0x37e7f7(0x255),Object['fromEntries'](_0x269769[_0x37e7f7(0x263)][_0x37e7f7(0x1f2)]())),console['log'](_0x37e7f7(0x222),_0x32ee37+'ms');const _0x573fde=await _0x269769[_0x37e7f7(0x262)]();console[_0x37e7f7(0x238)](_0x37e7f7(0x1e9),_0x573fde);if(!_0x269769['ok']){console[_0x37e7f7(0x223)](_0x37e7f7(0x200)),console['error'](_0x37e7f7(0x23f),_0x269769[_0x37e7f7(0x1de)]),console[_0x37e7f7(0x223)]('Response\x20Body:',_0x573fde),loggerService_1[_0x37e7f7(0x220)]['logWhiteDomainResponse'](_0x37e7f7(0x219),'/create',_0x269769[_0x37e7f7(0x1de)],_0x573fde,_0x32ee37),loggerService_1['loggerService']['logWhiteDomainError'](_0x37e7f7(0x219),_0x37e7f7(0x245),_0x37e7f7(0x258)+_0x269769[_0x37e7f7(0x1de)]+':\x20'+_0x573fde);throw new Error(_0x37e7f7(0x213)+_0x269769[_0x37e7f7(0x1de)]+_0x37e7f7(0x1eb)+_0x573fde);}let _0x1db3dd;try{_0x1db3dd=JSON['parse'](_0x573fde);}catch(_0x22d23c){console[_0x37e7f7(0x223)](_0x37e7f7(0x1ef),_0x22d23c),loggerService_1[_0x37e7f7(0x220)][_0x37e7f7(0x215)]('cointopay','/create','JSON\x20Parse\x20Error:\x20'+_0x22d23c);throw new Error(_0x37e7f7(0x25d)+_0x573fde);}console[_0x37e7f7(0x238)](_0x37e7f7(0x248)),console['log'](_0x37e7f7(0x243),JSON[_0x37e7f7(0x216)](_0x1db3dd,null,0x2)),loggerService_1[_0x37e7f7(0x220)][_0x37e7f7(0x24b)](_0x37e7f7(0x219),_0x37e7f7(0x245),_0x269769[_0x37e7f7(0x1de)],_0x1db3dd,_0x32ee37);if(_0x1db3dd['error']){const _0x20c1a4=_0x1db3dd[_0x37e7f7(0x229)]||_0x1db3dd[_0x37e7f7(0x223)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x37e7f7(0x223)](_0x37e7f7(0x1e2)),console[_0x37e7f7(0x223)]('Error\x20Message:',_0x20c1a4),loggerService_1['loggerService']['logWhiteDomainError'](_0x37e7f7(0x219),'/create',_0x37e7f7(0x203)+_0x20c1a4);throw new Error(_0x37e7f7(0x235)+_0x20c1a4);}if(!_0x1db3dd[_0x37e7f7(0x233)]||!_0x1db3dd[_0x37e7f7(0x204)]){console[_0x37e7f7(0x223)](_0x37e7f7(0x1df)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x37e7f7(0x223)]('Response\x20data:',_0x1db3dd),loggerService_1['loggerService'][_0x37e7f7(0x215)](_0x37e7f7(0x219),_0x37e7f7(0x245),_0x37e7f7(0x240));throw new Error(_0x37e7f7(0x1fe));}console[_0x37e7f7(0x238)](_0x37e7f7(0x237)),console['log'](_0x37e7f7(0x232),_0x1db3dd[_0x37e7f7(0x204)]),console[_0x37e7f7(0x238)](_0x37e7f7(0x1f7),_0x1db3dd[_0x37e7f7(0x233)]);const _0x2200b2=_0x1db3dd[_0x37e7f7(0x233)]+_0x37e7f7(0x1ea);return console[_0x37e7f7(0x238)](_0x37e7f7(0x254),_0x2200b2),console[_0x37e7f7(0x238)](_0x37e7f7(0x231),_0x25eee2,_0x37e7f7(0x218)),{'gateway_payment_id':_0x1db3dd[_0x37e7f7(0x204)],'payment_url':_0x2200b2};}catch(_0x907b9e){console['error'](_0x37e7f7(0x1fd)),console['error']('Error\x20details:',_0x907b9e),loggerService_1[_0x37e7f7(0x220)][_0x37e7f7(0x215)](_0x37e7f7(0x219),_0x37e7f7(0x245),_0x907b9e);if(_0x907b9e instanceof Error){console['error'](_0x37e7f7(0x22a),_0x907b9e[_0x37e7f7(0x229)]),console['error'](_0x37e7f7(0x1ed),_0x907b9e['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x907b9e[_0x37e7f7(0x229)]);}throw new Error(_0x37e7f7(0x1f3));}}async[a59_0x4184ca(0x22d)](_0x582589){const _0x5a207b=a59_0x4184ca,_0x13305b=Date[_0x5a207b(0x23b)]();try{console[_0x5a207b(0x238)](_0x5a207b(0x1f9)+_0x582589);const _0x5ad521={'gatewayPaymentId':_0x582589};loggerService_1[_0x5a207b(0x220)][_0x5a207b(0x227)](_0x5a207b(0x219),'/status',_0x5a207b(0x226),_0x5ad521);const _0x1c9312=await fetch(this['statusUrl'],{'method':_0x5a207b(0x226),'headers':{'Content-Type':_0x5a207b(0x221),'Accept':_0x5a207b(0x221),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x5a207b(0x216)](_0x5ad521)}),_0x5a4036=Date['now']()-_0x13305b;console['log'](_0x5a207b(0x1f0)),console['log']('Status:',_0x1c9312[_0x5a207b(0x1de)]),console[_0x5a207b(0x238)](_0x5a207b(0x222),_0x5a4036+'ms');if(!_0x1c9312['ok']){const _0x442f5c=await _0x1c9312[_0x5a207b(0x262)]();console[_0x5a207b(0x223)](_0x5a207b(0x23f),_0x1c9312[_0x5a207b(0x1de)]),console[_0x5a207b(0x223)](_0x5a207b(0x209),_0x442f5c),loggerService_1[_0x5a207b(0x220)][_0x5a207b(0x24b)](_0x5a207b(0x219),_0x5a207b(0x1e7),_0x1c9312[_0x5a207b(0x1de)],_0x442f5c,_0x5a4036),loggerService_1['loggerService'][_0x5a207b(0x215)]('cointopay',_0x5a207b(0x1e7),_0x5a207b(0x258)+_0x1c9312[_0x5a207b(0x1de)]+':\x20'+_0x442f5c);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c9312[_0x5a207b(0x1de)]);}const _0x5d8838=await _0x1c9312['text']();console[_0x5a207b(0x238)](_0x5a207b(0x1e9),_0x5d8838);let _0x1ddc2d;try{_0x1ddc2d=JSON[_0x5a207b(0x1e0)](_0x5d8838);}catch(_0xdcb3b){console['error'](_0x5a207b(0x1ef),_0xdcb3b),loggerService_1[_0x5a207b(0x220)][_0x5a207b(0x215)]('cointopay',_0x5a207b(0x1e7),_0x5a207b(0x250)+_0xdcb3b);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x5d8838);}loggerService_1[_0x5a207b(0x220)][_0x5a207b(0x24b)]('cointopay',_0x5a207b(0x1e7),_0x1c9312[_0x5a207b(0x1de)],_0x1ddc2d,_0x5a4036),console[_0x5a207b(0x238)](_0x5a207b(0x1f4)),console[_0x5a207b(0x238)](_0x5a207b(0x208),_0x1ddc2d[_0x5a207b(0x1f1)]),console['log'](_0x5a207b(0x1fc),_0x1ddc2d[_0x5a207b(0x247)]),console['log'](_0x5a207b(0x242),_0x1ddc2d['data']?.[_0x5a207b(0x24d)]),console[_0x5a207b(0x238)](_0x5a207b(0x231),_0x1ddc2d[_0x5a207b(0x241)]?.[_0x5a207b(0x210)]),console[_0x5a207b(0x238)](_0x5a207b(0x260),_0x1ddc2d[_0x5a207b(0x241)]?.[_0x5a207b(0x21a)]);if(_0x1ddc2d[_0x5a207b(0x1f1)]!==_0x5a207b(0x22b)||_0x1ddc2d[_0x5a207b(0x247)]!==0xc8){const _0x5ac357=_0x1ddc2d[_0x5a207b(0x229)]||_0x5a207b(0x259);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5a207b(0x223)]('Error\x20Message:',_0x5ac357),loggerService_1['loggerService']['logWhiteDomainError'](_0x5a207b(0x219),_0x5a207b(0x1e7),_0x5a207b(0x25b)+_0x5ac357);throw new Error(_0x5a207b(0x23e)+_0x5ac357);}if(!_0x1ddc2d[_0x5a207b(0x241)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x5a207b(0x220)][_0x5a207b(0x215)]('cointopay',_0x5a207b(0x1e7),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5a207b(0x261));}let _0x190814=_0x5a207b(0x1ff);switch(_0x1ddc2d['data'][_0x5a207b(0x24d)]?.[_0x5a207b(0x25a)]()){case _0x5a207b(0x25c):_0x190814=_0x5a207b(0x230);break;case'cancelled':case _0x5a207b(0x1e4):case _0x5a207b(0x223):_0x190814=_0x5a207b(0x1e3);break;case _0x5a207b(0x1f5):case _0x5a207b(0x251):_0x190814=_0x5a207b(0x228);break;case _0x5a207b(0x20d):case'awaiting\x20fiat':case _0x5a207b(0x24e):case _0x5a207b(0x1e5):default:_0x190814=_0x5a207b(0x1ff);break;}let _0x4a15ab,_0x5a5968;if(_0x1ddc2d['data'][_0x5a207b(0x23d)]){const _0x46b3d4=_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x23d)];console['log'](_0x5a207b(0x21c),_0x46b3d4);const _0x2680dc=_0x46b3d4[_0x5a207b(0x23a)](/IBAN\s+([A-Z0-9]+)/i);_0x2680dc&&(_0x4a15ab=_0x2680dc[0x1],console['log'](_0x5a207b(0x22f),_0x4a15ab)),_0x5a5968=_0x46b3d4;}const _0x3d069b={'iban':_0x4a15ab,'bankDetails':_0x5a5968,'transactionId':_0x1ddc2d[_0x5a207b(0x241)]['TransactionID'],'coinAddress':_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x1e6)],'qrCodeUrl':_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x207)],'expiryTime':_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x256)],'createdOn':_0x1ddc2d['data'][_0x5a207b(0x21b)],'confirmedOn':_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x1fa)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5a207b(0x238)]('Status:',_0x1ddc2d[_0x5a207b(0x241)]['Status'],'->',_0x190814),console[_0x5a207b(0x238)](_0x5a207b(0x231),_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x210)],_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x21a)]),console[_0x5a207b(0x238)](_0x5a207b(0x224),_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x265)]),console['log'](_0x5a207b(0x25e),_0x4a15ab||'not\x20found'),console['log'](_0x5a207b(0x1fb),_0x1ddc2d[_0x5a207b(0x241)]['CreatedOn']),console[_0x5a207b(0x238)](_0x5a207b(0x21f),_0x1ddc2d['data'][_0x5a207b(0x1fa)]||'not\x20confirmed');if(_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x24d)]?.[_0x5a207b(0x25a)]()===_0x5a207b(0x206))console['log'](_0x5a207b(0x257));else _0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x24d)]?.[_0x5a207b(0x25a)]()===_0x5a207b(0x25c)&&console[_0x5a207b(0x238)](_0x5a207b(0x1e8));return{'status':_0x190814,'amount':parseFloat(_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x210)])||undefined,'currency':_0x1ddc2d[_0x5a207b(0x241)][_0x5a207b(0x21a)]||_0x5a207b(0x218),'paymentDetails':_0x3d069b};}catch(_0x29d668){console[_0x5a207b(0x223)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x29d668),loggerService_1[_0x5a207b(0x220)]['logWhiteDomainError']('cointopay',_0x5a207b(0x1e7),_0x29d668);throw new Error(_0x5a207b(0x239)+(_0x29d668 instanceof Error?_0x29d668[_0x5a207b(0x229)]:'Unknown\x20error'));}}async[a59_0x4184ca(0x1f8)](_0xc0a42){const _0x44f491=a59_0x4184ca,_0x411845=await this[_0x44f491(0x22d)](_0xc0a42);return{'status':_0x411845['status'],'amount':_0x411845['amount'],'currency':_0x411845[_0x44f491(0x1ee)]};}async[a59_0x4184ca(0x211)](_0x5331d1){const _0x4b8a45=a59_0x4184ca;console[_0x4b8a45(0x238)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5331d1);let _0x2ed9fb=_0x4b8a45(0x1ff);switch(_0x5331d1[_0x4b8a45(0x1de)]?.[_0x4b8a45(0x25a)]()){case'paid':_0x2ed9fb=_0x4b8a45(0x230);break;case _0x4b8a45(0x268):case _0x4b8a45(0x1e4):case _0x4b8a45(0x223):_0x2ed9fb=_0x4b8a45(0x1e3);break;case _0x4b8a45(0x1f5):case _0x4b8a45(0x251):_0x2ed9fb=_0x4b8a45(0x228);break;case _0x4b8a45(0x24e):case _0x4b8a45(0x20d):case _0x4b8a45(0x206):case'created':default:_0x2ed9fb=_0x4b8a45(0x1ff);break;}return{'paymentId':_0x5331d1[_0x4b8a45(0x202)]||_0x5331d1[_0x4b8a45(0x21d)]||'','status':_0x2ed9fb,'amount':_0x5331d1[_0x4b8a45(0x23c)],'currency':_0x5331d1[_0x4b8a45(0x1ee)]||_0x4b8a45(0x218)};}}exports[a59_0x4184ca(0x20a)]=CoinToPayService;