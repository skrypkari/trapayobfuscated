'use strict';const a43_0x4a4cea=a43_0x5683;(function(_0x4852df,_0x1ea80d){const _0x3e8db5=a43_0x5683,_0x302cb5=_0x4852df();while(!![]){try{const _0x34ecd9=parseInt(_0x3e8db5(0x1b8))/0x1*(-parseInt(_0x3e8db5(0x147))/0x2)+parseInt(_0x3e8db5(0x1a3))/0x3+-parseInt(_0x3e8db5(0x15a))/0x4+-parseInt(_0x3e8db5(0x177))/0x5+-parseInt(_0x3e8db5(0x161))/0x6+parseInt(_0x3e8db5(0x149))/0x7+parseInt(_0x3e8db5(0x15c))/0x8;if(_0x34ecd9===_0x1ea80d)break;else _0x302cb5['push'](_0x302cb5['shift']());}catch(_0x5b1cbe){_0x302cb5['push'](_0x302cb5['shift']());}}}(a43_0x1b8c,0xbd8a5));function a43_0x1b8c(){const _0x2b7e1a=['success','amount','Error\x20details:','logWhiteDomainError','Status','1449440qYzsNP','status','10477496hgNimd','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Error\x20Message:','application/json','Headers:','3430590rTDZXS','paid','logWhiteDomainRequest','payment_url','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','logWhiteDomainResponse','/status','checkPaymentStatus','üè¶\x20Payment\x20Detail:','timeout','processWebhook','URL:','PAID','match','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','failed','üè¶\x20Extracted\x20IBAN:','data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Business\x20Error:\x20','result','TransactionID','4807395gtKgSh','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','currency','pending','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','HTTP\x20error!\x20status:\x20','cancelled','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Transaction\x20ID:','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20URL:','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','stack','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Missing\x20data\x20in\x20response','headers','gateway_payment_id','parse','status_code','toLowerCase','Unknown\x20error','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','QRCodeURL','EXPIRED','FAILED','PENDING','text','created','TransactionConfirmedOn','/create','stringify','cointopay','entries','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','log','message','CreatedOn','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','__esModule','loggerService','\x20EUR','EUR','2364981zFVpCb','Status:','PaymentDetail','apiUrl','POST','Status\x20Code:','coinAddress','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Response\x20data:','Result:','Created\x20On:','IBAN:','expired','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CoinToPay\x20API\x20error:\x20','not\x20found','ExpiryTime','HTTP\x20Status:','createPaymentLink','Gateway\x20Payment\x20ID:','not\x20confirmed','482IdPxeJ','waiting','Unknown\x20error\x20from\x20CoinToPay\x20API','CoinToPay\x20payment\x20status\x20check\x20error:','JSON\x20Parse\x20Error:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','inputCurrency','Error\x20message:','Amount','Amount:','Currency:','merchant_reference_id','CoinToPayService','statusUrl','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20API\x20Error:\x20','Response\x20Body:','3170WigmqC','error','9365419evaJSf','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','now','TesSoft\x20Payment\x20System/1.0','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20Text:','Confirmed\x20On:','HTTP\x20','Payment\x20Status:','Incomplete\x20response:\x20missing\x20data','awaiting\x20fiat'];a43_0x1b8c=function(){return _0x2b7e1a;};return a43_0x1b8c();}Object['defineProperty'](exports,a43_0x4a4cea(0x19f),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x4e835a=a43_0x4a4cea;this[_0x4e835a(0x1a6)]=_0x4e835a(0x14d),this[_0x4e835a(0x143)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4e835a(0x19b)](_0x4e835a(0x179)),console[_0x4e835a(0x19b)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a43_0x4a4cea(0x1b5)](_0x23b235){const _0x5a6f83=a43_0x4a4cea,{orderId:_0x354ac5,amount:_0x3470a8}=_0x23b235;console[_0x5a6f83(0x19b)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x3470a8+_0x5a6f83(0x1a1));const _0x4254d9={'amount':_0x3470a8},_0x3bfd11=Date['now']();try{console['log'](_0x5a6f83(0x173)),console[_0x5a6f83(0x19b)](_0x5a6f83(0x16c),this[_0x5a6f83(0x1a6)]),console[_0x5a6f83(0x19b)]('Request\x20Body:',JSON[_0x5a6f83(0x197)](_0x4254d9,null,0x2)),console[_0x5a6f83(0x19b)](_0x5a6f83(0x13f),_0x3470a8,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x5a6f83(0x1a0)]['logWhiteDomainRequest'](_0x5a6f83(0x198),_0x5a6f83(0x196),_0x5a6f83(0x1a7),_0x4254d9);const _0xc75d30=await fetch(this['apiUrl'],{'method':_0x5a6f83(0x1a7),'headers':{'Content-Type':'application/json','Accept':_0x5a6f83(0x15f),'User-Agent':_0x5a6f83(0x14c)},'body':JSON[_0x5a6f83(0x197)](_0x4254d9)}),_0x329232=Date[_0x5a6f83(0x14b)]()-_0x3bfd11;console['log'](_0x5a6f83(0x184)),console[_0x5a6f83(0x19b)](_0x5a6f83(0x1a4),_0xc75d30['status']),console[_0x5a6f83(0x19b)](_0x5a6f83(0x14f),_0xc75d30['statusText']),console[_0x5a6f83(0x19b)](_0x5a6f83(0x160),Object['fromEntries'](_0xc75d30[_0x5a6f83(0x188)][_0x5a6f83(0x199)]())),console[_0x5a6f83(0x19b)]('Response\x20Time:',_0x329232+'ms');const _0x58dbe9=await _0xc75d30[_0x5a6f83(0x193)]();console['log']('Raw\x20Response\x20Body:',_0x58dbe9);if(!_0xc75d30['ok']){console['error'](_0x5a6f83(0x183)),console[_0x5a6f83(0x148)](_0x5a6f83(0x1b4),_0xc75d30[_0x5a6f83(0x15b)]),console[_0x5a6f83(0x148)](_0x5a6f83(0x146),_0x58dbe9),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x166)]('cointopay',_0x5a6f83(0x196),_0xc75d30['status'],_0x58dbe9,_0x329232),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x158)](_0x5a6f83(0x198),'/create',_0x5a6f83(0x151)+_0xc75d30[_0x5a6f83(0x15b)]+':\x20'+_0x58dbe9);throw new Error('HTTP\x20error!\x20status:\x20'+_0xc75d30['status']+',\x20body:\x20'+_0x58dbe9);}let _0x18e9e9;try{_0x18e9e9=JSON[_0x5a6f83(0x18a)](_0x58dbe9);}catch(_0x2f3245){console[_0x5a6f83(0x148)](_0x5a6f83(0x181),_0x2f3245),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x158)](_0x5a6f83(0x198),_0x5a6f83(0x196),_0x5a6f83(0x139)+_0x2f3245);throw new Error(_0x5a6f83(0x19e)+_0x58dbe9);}console['log'](_0x5a6f83(0x13b)),console[_0x5a6f83(0x19b)]('Parsed\x20Result:',JSON[_0x5a6f83(0x197)](_0x18e9e9,null,0x2)),loggerService_1['loggerService'][_0x5a6f83(0x166)]('cointopay',_0x5a6f83(0x196),_0xc75d30[_0x5a6f83(0x15b)],_0x18e9e9,_0x329232);if(_0x18e9e9[_0x5a6f83(0x148)]){const _0x53e283=_0x18e9e9[_0x5a6f83(0x19c)]||_0x18e9e9[_0x5a6f83(0x148)]||_0x5a6f83(0x1ba);console[_0x5a6f83(0x148)](_0x5a6f83(0x144)),console[_0x5a6f83(0x148)]('Error\x20Message:',_0x53e283),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x158)](_0x5a6f83(0x198),_0x5a6f83(0x196),_0x5a6f83(0x174)+_0x53e283);throw new Error(_0x5a6f83(0x1b1)+_0x53e283);}if(!_0x18e9e9[_0x5a6f83(0x164)]||!_0x18e9e9[_0x5a6f83(0x189)]){console[_0x5a6f83(0x148)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5a6f83(0x148)](_0x5a6f83(0x19a)),console['error'](_0x5a6f83(0x1ab),_0x18e9e9),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x158)]('cointopay','/create',_0x5a6f83(0x186));throw new Error(_0x5a6f83(0x14a));}return console[_0x5a6f83(0x19b)](_0x5a6f83(0x14e)),console[_0x5a6f83(0x19b)](_0x5a6f83(0x1b6),_0x18e9e9[_0x5a6f83(0x189)]),console[_0x5a6f83(0x19b)](_0x5a6f83(0x182),_0x18e9e9[_0x5a6f83(0x164)]),console[_0x5a6f83(0x19b)](_0x5a6f83(0x13f),_0x3470a8,_0x5a6f83(0x1a2)),{'gateway_payment_id':_0x18e9e9[_0x5a6f83(0x189)],'payment_url':_0x18e9e9[_0x5a6f83(0x164)]};}catch(_0x26472c){console[_0x5a6f83(0x148)](_0x5a6f83(0x178)),console[_0x5a6f83(0x148)](_0x5a6f83(0x157),_0x26472c),loggerService_1[_0x5a6f83(0x1a0)][_0x5a6f83(0x158)](_0x5a6f83(0x198),'/create',_0x26472c);if(_0x26472c instanceof Error){console[_0x5a6f83(0x148)](_0x5a6f83(0x13d),_0x26472c[_0x5a6f83(0x19c)]),console[_0x5a6f83(0x148)]('Error\x20stack:',_0x26472c[_0x5a6f83(0x185)]);throw new Error(_0x5a6f83(0x1b0)+_0x26472c[_0x5a6f83(0x19c)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x4a4cea(0x168)](_0x3a861f){const _0x552be4=a43_0x4a4cea,_0x2863a4=Date[_0x552be4(0x14b)]();try{console['log'](_0x552be4(0x17c)+_0x3a861f);const _0x1077bf={'gatewayPaymentId':_0x3a861f};loggerService_1[_0x552be4(0x1a0)][_0x552be4(0x163)](_0x552be4(0x198),_0x552be4(0x167),'POST',_0x1077bf);const _0x6d4b40=await fetch(this[_0x552be4(0x143)],{'method':_0x552be4(0x1a7),'headers':{'Content-Type':_0x552be4(0x15f),'Accept':'application/json','User-Agent':_0x552be4(0x14c)},'body':JSON['stringify'](_0x1077bf)}),_0x3b51b0=Date[_0x552be4(0x14b)]()-_0x2863a4;console['log'](_0x552be4(0x15d)),console['log'](_0x552be4(0x1a4),_0x6d4b40[_0x552be4(0x15b)]),console[_0x552be4(0x19b)]('Response\x20Time:',_0x3b51b0+'ms');if(!_0x6d4b40['ok']){const _0x4ba67b=await _0x6d4b40['text']();console[_0x552be4(0x148)](_0x552be4(0x1b4),_0x6d4b40['status']),console[_0x552be4(0x148)]('Response\x20Body:',_0x4ba67b),loggerService_1[_0x552be4(0x1a0)][_0x552be4(0x166)]('cointopay',_0x552be4(0x167),_0x6d4b40[_0x552be4(0x15b)],_0x4ba67b,_0x3b51b0),loggerService_1['loggerService']['logWhiteDomainError'](_0x552be4(0x198),'/status','HTTP\x20'+_0x6d4b40[_0x552be4(0x15b)]+':\x20'+_0x4ba67b);throw new Error(_0x552be4(0x17d)+_0x6d4b40['status']);}const _0xa66c0a=await _0x6d4b40[_0x552be4(0x193)]();console['log']('Raw\x20Response\x20Body:',_0xa66c0a);let _0x59ac9e;try{_0x59ac9e=JSON['parse'](_0xa66c0a);}catch(_0x5c65ac){console[_0x552be4(0x148)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5c65ac),loggerService_1[_0x552be4(0x1a0)][_0x552be4(0x158)](_0x552be4(0x198),_0x552be4(0x167),_0x552be4(0x139)+_0x5c65ac);throw new Error(_0x552be4(0x17f)+_0xa66c0a);}loggerService_1[_0x552be4(0x1a0)]['logWhiteDomainResponse']('cointopay',_0x552be4(0x167),_0x6d4b40['status'],_0x59ac9e,_0x3b51b0),console[_0x552be4(0x19b)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x552be4(0x1ac),_0x59ac9e[_0x552be4(0x175)]),console['log'](_0x552be4(0x1a8),_0x59ac9e[_0x552be4(0x18b)]),console[_0x552be4(0x19b)](_0x552be4(0x152),_0x59ac9e[_0x552be4(0x172)]?.[_0x552be4(0x159)]),console[_0x552be4(0x19b)]('Amount:',_0x59ac9e[_0x552be4(0x172)]?.[_0x552be4(0x13e)]),console[_0x552be4(0x19b)](_0x552be4(0x140),_0x59ac9e['data']?.[_0x552be4(0x13c)]);if(_0x59ac9e[_0x552be4(0x175)]!==_0x552be4(0x155)||_0x59ac9e[_0x552be4(0x18b)]!==0xc8){const _0x2fdd14=_0x59ac9e[_0x552be4(0x19c)]||_0x552be4(0x18e);console[_0x552be4(0x148)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x552be4(0x148)](_0x552be4(0x15e),_0x2fdd14),loggerService_1[_0x552be4(0x1a0)][_0x552be4(0x158)](_0x552be4(0x198),_0x552be4(0x167),_0x552be4(0x145)+_0x2fdd14);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x2fdd14);}if(!_0x59ac9e[_0x552be4(0x172)]){console[_0x552be4(0x148)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x552be4(0x148)](_0x552be4(0x187)),loggerService_1['loggerService'][_0x552be4(0x158)](_0x552be4(0x198),'/status',_0x552be4(0x153));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2d4820=_0x552be4(0x192);switch(_0x59ac9e['data']['Status']?.['toLowerCase']()){case _0x552be4(0x162):_0x2d4820=_0x552be4(0x16d);break;case _0x552be4(0x17e):case _0x552be4(0x170):case'error':_0x2d4820=_0x552be4(0x191);break;case _0x552be4(0x1af):case'timeout':_0x2d4820=_0x552be4(0x190);break;case _0x552be4(0x1b9):case _0x552be4(0x154):case'pending':case _0x552be4(0x194):default:_0x2d4820=_0x552be4(0x192);break;}let _0x351513,_0x54d1ec;if(_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x1a5)]){const _0x36b24b=_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x1a5)];console[_0x552be4(0x19b)](_0x552be4(0x169),_0x36b24b);const _0x38e067=_0x36b24b[_0x552be4(0x16e)](/IBAN\s+([A-Z0-9]+)/i);_0x38e067&&(_0x351513=_0x38e067[0x1],console[_0x552be4(0x19b)](_0x552be4(0x171),_0x351513)),_0x54d1ec=_0x36b24b;}const _0x2f0e08={'iban':_0x351513,'bankDetails':_0x54d1ec,'transactionId':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x176)],'coinAddress':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x1a9)],'qrCodeUrl':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x18f)],'expiryTime':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x1b3)],'createdOn':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x19d)],'confirmedOn':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x195)]};console['log'](_0x552be4(0x16f)),console[_0x552be4(0x19b)](_0x552be4(0x1a4),_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x159)],'->',_0x2d4820),console[_0x552be4(0x19b)](_0x552be4(0x13f),_0x59ac9e[_0x552be4(0x172)]['Amount'],_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x13c)]),console[_0x552be4(0x19b)](_0x552be4(0x180),_0x59ac9e[_0x552be4(0x172)]['TransactionID']),console[_0x552be4(0x19b)](_0x552be4(0x1ae),_0x351513||_0x552be4(0x1b2)),console[_0x552be4(0x19b)](_0x552be4(0x1ad),_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x19d)]),console[_0x552be4(0x19b)](_0x552be4(0x150),_0x59ac9e['data'][_0x552be4(0x195)]||_0x552be4(0x1b7));if(_0x59ac9e[_0x552be4(0x172)]['Status']?.[_0x552be4(0x18c)]()===_0x552be4(0x154))console[_0x552be4(0x19b)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x59ac9e['data'][_0x552be4(0x159)]?.[_0x552be4(0x18c)]()===_0x552be4(0x162)&&console[_0x552be4(0x19b)](_0x552be4(0x1aa));return{'status':_0x2d4820,'amount':parseFloat(_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x13e)])||undefined,'currency':_0x59ac9e[_0x552be4(0x172)][_0x552be4(0x13c)]||_0x552be4(0x1a2),'paymentDetails':_0x2f0e08};}catch(_0x505209){console[_0x552be4(0x148)](_0x552be4(0x1bb),_0x505209),loggerService_1['loggerService'][_0x552be4(0x158)](_0x552be4(0x198),_0x552be4(0x167),_0x505209);throw new Error(_0x552be4(0x165)+(_0x505209 instanceof Error?_0x505209[_0x552be4(0x19c)]:_0x552be4(0x18d)));}}async['verifyPayment'](_0x93035b){const _0x1867fe=a43_0x4a4cea,_0x3f6a33=await this[_0x1867fe(0x168)](_0x93035b);return{'status':_0x3f6a33[_0x1867fe(0x15b)],'amount':_0x3f6a33[_0x1867fe(0x156)],'currency':_0x3f6a33[_0x1867fe(0x17a)]};}async[a43_0x4a4cea(0x16b)](_0x192c41){const _0x3980fa=a43_0x4a4cea;console[_0x3980fa(0x19b)](_0x3980fa(0x13a),_0x192c41);let _0x8c55a0=_0x3980fa(0x192);switch(_0x192c41['status']?.[_0x3980fa(0x18c)]()){case _0x3980fa(0x162):_0x8c55a0='PAID';break;case _0x3980fa(0x17e):case _0x3980fa(0x170):case _0x3980fa(0x148):_0x8c55a0=_0x3980fa(0x191);break;case _0x3980fa(0x1af):case _0x3980fa(0x16a):_0x8c55a0=_0x3980fa(0x190);break;case _0x3980fa(0x17b):case'waiting':case _0x3980fa(0x154):case _0x3980fa(0x194):default:_0x8c55a0=_0x3980fa(0x192);break;}return{'paymentId':_0x192c41['order_id']||_0x192c41[_0x3980fa(0x141)]||'','status':_0x8c55a0,'amount':_0x192c41[_0x3980fa(0x156)],'currency':_0x192c41[_0x3980fa(0x17a)]||_0x3980fa(0x1a2)};}}function a43_0x5683(_0x12f193,_0x9c3f43){const _0x1b8c39=a43_0x1b8c();return a43_0x5683=function(_0x5683f9,_0x47d851){_0x5683f9=_0x5683f9-0x139;let _0x2ab875=_0x1b8c39[_0x5683f9];return _0x2ab875;},a43_0x5683(_0x12f193,_0x9c3f43);}exports[a43_0x4a4cea(0x142)]=CoinToPayService;