'use strict';const a40_0x534ff1=a40_0x3730;(function(_0x2ded8d,_0x290094){const _0x90c66a=a40_0x3730,_0x134e95=_0x2ded8d();while(!![]){try{const _0x282539=-parseInt(_0x90c66a(0x222))/0x1*(-parseInt(_0x90c66a(0x248))/0x2)+parseInt(_0x90c66a(0x240))/0x3+parseInt(_0x90c66a(0x227))/0x4*(-parseInt(_0x90c66a(0x26f))/0x5)+parseInt(_0x90c66a(0x265))/0x6+-parseInt(_0x90c66a(0x201))/0x7*(-parseInt(_0x90c66a(0x264))/0x8)+-parseInt(_0x90c66a(0x1f8))/0x9+parseInt(_0x90c66a(0x255))/0xa;if(_0x282539===_0x290094)break;else _0x134e95['push'](_0x134e95['shift']());}catch(_0x17f0f5){_0x134e95['push'](_0x134e95['shift']());}}}(a40_0x28ed,0xeaa27));function a40_0x3730(_0x4ed7e6,_0x5a01c5){const _0x28edd3=a40_0x28ed();return a40_0x3730=function(_0x373062,_0x2af501){_0x373062=_0x373062-0x1f1;let _0x322fa2=_0x28edd3[_0x373062];return _0x322fa2;},a40_0x3730(_0x4ed7e6,_0x5a01c5);}function a40_0x28ed(){const _0x22a5f9=['/status','merchant_reference_id','TesSoft\x20Payment\x20System/1.0','log','data','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','10595529UCWlMz','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status\x20Code:','Parsed\x20Result:','waiting','üìä\x20Status\x20check\x20URL:','Raw\x20Response\x20Body:','PAID','HTTP\x20error!\x20status:\x20','1337vyVVeD','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Response\x20Time:','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EUR','../loggerService','HTTP\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Incomplete\x20response:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','processWebhook','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EXPIRED','__esModule','TransactionConfirmedOn','match',',\x20body:\x20','timeout','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Payment\x20URL:','Amount','Status\x20API\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','amount','failed','Transaction\x20ID:','toLowerCase','PENDING','Currency:','CoinToPayService','status','296MrjUHx','error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','awaiting\x20fiat','Response\x20Body:','4vmENeD','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20SUCCESS\x20===','ExpiryTime','Status\x20Text:','headers','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','/create','inputCurrency','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','logWhiteDomainResponse','logWhiteDomainRequest','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','paid','CoinToPay\x20API\x20error:\x20','TransactionID','https://tesoft.uk/gateway/cointopay/status.php','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','status_code','success','IBAN:','Request\x20Body:','3837849TaXzYG','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','created','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','result','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','pending','cancelled','4568SLBJCX','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','payment_url','not\x20confirmed','checkPaymentStatus','QRCodeURL','JSON\x20Parse\x20Error:\x20','cointopay','expired','entries','Status','CreatedOn','3624300Gqfeas','Unknown\x20error','Confirmed\x20On:','apiUrl','CoinToPay\x20status\x20API\x20error:\x20','Error\x20stack:','HTTP\x20Status:','üè¶\x20Extracted\x20IBAN:','statusUrl','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Unknown\x20error\x20from\x20CoinToPay\x20API','application/json','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','loggerService','25832tufvqo','6006762VZZDbn','URL:','text','https://tesoft.uk/gateway/cointopay/','Error\x20Message:','üè¶\x20Payment\x20Detail:','PaymentDetail','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','POST','message','8986495QxgqPU','currency','Error\x20message:','FAILED','logWhiteDomainError','now','Amount:','gateway_payment_id','Created\x20On:'];a40_0x28ed=function(){return _0x22a5f9;};return a40_0x28ed();}Object['defineProperty'](exports,a40_0x534ff1(0x210),{'value':!![]}),exports[a40_0x534ff1(0x220)]=void 0x0;const loggerService_1=require(a40_0x534ff1(0x208));class CoinToPayService{constructor(){const _0x5a7f98=a40_0x534ff1;this[_0x5a7f98(0x258)]=_0x5a7f98(0x268),this['statusUrl']=_0x5a7f98(0x239),console[_0x5a7f98(0x1f5)](_0x5a7f98(0x1f9)),console[_0x5a7f98(0x1f5)](_0x5a7f98(0x1fd),this[_0x5a7f98(0x25d)]);}async['createPaymentLink'](_0x5d4d99){const _0x267fc5=a40_0x534ff1,{orderId:_0x5cc280,amount:_0x44dc53}=_0x5d4d99;console[_0x267fc5(0x1f5)](_0x267fc5(0x245)+_0x44dc53+'\x20EUR');const _0x4e82d3={'amount':_0x44dc53},_0x2af969=Date['now']();try{console['log'](_0x267fc5(0x215)),console['log'](_0x267fc5(0x266),this[_0x267fc5(0x258)]),console[_0x267fc5(0x1f5)](_0x267fc5(0x23f),JSON[_0x267fc5(0x202)](_0x4e82d3,null,0x2)),console[_0x267fc5(0x1f5)](_0x267fc5(0x275),_0x44dc53,_0x267fc5(0x25f)),loggerService_1[_0x267fc5(0x263)][_0x267fc5(0x234)](_0x267fc5(0x250),_0x267fc5(0x22e),_0x267fc5(0x26d),_0x4e82d3);const _0x361a2b=await fetch(this[_0x267fc5(0x258)],{'method':_0x267fc5(0x26d),'headers':{'Content-Type':_0x267fc5(0x261),'Accept':_0x267fc5(0x261),'User-Agent':_0x267fc5(0x1f4)},'body':JSON['stringify'](_0x4e82d3)}),_0x53fc15=Date[_0x267fc5(0x274)]()-_0x2af969;console['log'](_0x267fc5(0x243)),console[_0x267fc5(0x1f5)](_0x267fc5(0x231),_0x361a2b['status']),console[_0x267fc5(0x1f5)](_0x267fc5(0x22b),_0x361a2b['statusText']),console[_0x267fc5(0x1f5)]('Headers:',Object['fromEntries'](_0x361a2b[_0x267fc5(0x22c)][_0x267fc5(0x252)]())),console['log'](_0x267fc5(0x204),_0x53fc15+'ms');const _0x12cab7=await _0x361a2b[_0x267fc5(0x267)]();console[_0x267fc5(0x1f5)]('Raw\x20Response\x20Body:',_0x12cab7);if(!_0x361a2b['ok']){console[_0x267fc5(0x223)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x361a2b['status']),console[_0x267fc5(0x223)]('Response\x20Body:',_0x12cab7),loggerService_1[_0x267fc5(0x263)][_0x267fc5(0x233)](_0x267fc5(0x250),_0x267fc5(0x22e),_0x361a2b[_0x267fc5(0x221)],_0x12cab7,_0x53fc15),loggerService_1[_0x267fc5(0x263)][_0x267fc5(0x273)](_0x267fc5(0x250),_0x267fc5(0x22e),_0x267fc5(0x209)+_0x361a2b['status']+':\x20'+_0x12cab7);throw new Error(_0x267fc5(0x200)+_0x361a2b[_0x267fc5(0x221)]+_0x267fc5(0x213)+_0x12cab7);}let _0x3464c0;try{_0x3464c0=JSON[_0x267fc5(0x249)](_0x12cab7);}catch(_0x2b5709){console[_0x267fc5(0x223)](_0x267fc5(0x205),_0x2b5709),loggerService_1['loggerService'][_0x267fc5(0x273)](_0x267fc5(0x250),_0x267fc5(0x22e),_0x267fc5(0x24f)+_0x2b5709);throw new Error(_0x267fc5(0x20c)+_0x12cab7);}console[_0x267fc5(0x1f5)](_0x267fc5(0x232)),console[_0x267fc5(0x1f5)](_0x267fc5(0x1fb),JSON[_0x267fc5(0x202)](_0x3464c0,null,0x2)),loggerService_1[_0x267fc5(0x263)]['logWhiteDomainResponse'](_0x267fc5(0x250),_0x267fc5(0x22e),_0x361a2b['status'],_0x3464c0,_0x53fc15);if(_0x3464c0[_0x267fc5(0x223)]){const _0x538a6d=_0x3464c0['message']||_0x3464c0['error']||_0x267fc5(0x260);console[_0x267fc5(0x223)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x267fc5(0x223)](_0x267fc5(0x269),_0x538a6d),loggerService_1[_0x267fc5(0x263)]['logWhiteDomainError'](_0x267fc5(0x250),'/create','Business\x20Error:\x20'+_0x538a6d);throw new Error(_0x267fc5(0x237)+_0x538a6d);}if(!_0x3464c0[_0x267fc5(0x24b)]||!_0x3464c0[_0x267fc5(0x276)]){console[_0x267fc5(0x223)](_0x267fc5(0x230)),console['error'](_0x267fc5(0x224)),console[_0x267fc5(0x223)]('Response\x20data:',_0x3464c0),loggerService_1[_0x267fc5(0x263)][_0x267fc5(0x273)]('cointopay',_0x267fc5(0x22e),_0x267fc5(0x20e));throw new Error(_0x267fc5(0x25e));}return console[_0x267fc5(0x1f5)](_0x267fc5(0x229)),console['log']('Gateway\x20Payment\x20ID:',_0x3464c0[_0x267fc5(0x276)]),console[_0x267fc5(0x1f5)](_0x267fc5(0x216),_0x3464c0['payment_url']),console[_0x267fc5(0x1f5)](_0x267fc5(0x275),_0x44dc53,_0x267fc5(0x207)),{'gateway_payment_id':_0x3464c0[_0x267fc5(0x276)],'payment_url':_0x3464c0[_0x267fc5(0x24b)]};}catch(_0x4ccb94){console[_0x267fc5(0x223)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x267fc5(0x223)]('Error\x20details:',_0x4ccb94),loggerService_1[_0x267fc5(0x263)][_0x267fc5(0x273)](_0x267fc5(0x250),_0x267fc5(0x22e),_0x4ccb94);if(_0x4ccb94 instanceof Error){console[_0x267fc5(0x223)](_0x267fc5(0x271),_0x4ccb94[_0x267fc5(0x26e)]),console[_0x267fc5(0x223)](_0x267fc5(0x25a),_0x4ccb94['stack']);throw new Error(_0x267fc5(0x24a)+_0x4ccb94['message']);}throw new Error(_0x267fc5(0x20a));}}async[a40_0x534ff1(0x24d)](_0x24fc78){const _0x3c2ea7=a40_0x534ff1,_0x51865f=Date[_0x3c2ea7(0x274)]();try{console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x235)+_0x24fc78);const _0xef703={'gatewayPaymentId':_0x24fc78};loggerService_1[_0x3c2ea7(0x263)]['logWhiteDomainRequest']('cointopay',_0x3c2ea7(0x1f2),'POST',_0xef703);const _0xcdb016=await fetch(this['statusUrl'],{'method':_0x3c2ea7(0x26d),'headers':{'Content-Type':_0x3c2ea7(0x261),'Accept':_0x3c2ea7(0x261),'User-Agent':_0x3c2ea7(0x1f4)},'body':JSON[_0x3c2ea7(0x202)](_0xef703)}),_0x233b40=Date['now']()-_0x51865f;console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x262)),console['log'](_0x3c2ea7(0x231),_0xcdb016[_0x3c2ea7(0x221)]),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x204),_0x233b40+'ms');if(!_0xcdb016['ok']){const _0x33a7ce=await _0xcdb016[_0x3c2ea7(0x267)]();console[_0x3c2ea7(0x223)](_0x3c2ea7(0x25b),_0xcdb016[_0x3c2ea7(0x221)]),console[_0x3c2ea7(0x223)](_0x3c2ea7(0x226),_0x33a7ce),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x233)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),_0xcdb016[_0x3c2ea7(0x221)],_0x33a7ce,_0x233b40),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x273)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),'HTTP\x20'+_0xcdb016[_0x3c2ea7(0x221)]+':\x20'+_0x33a7ce);throw new Error(_0x3c2ea7(0x200)+_0xcdb016['status']);}const _0x16bcf5=await _0xcdb016[_0x3c2ea7(0x267)]();console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x1fe),_0x16bcf5);let _0x453cad;try{_0x453cad=JSON['parse'](_0x16bcf5);}catch(_0x19eb94){console[_0x3c2ea7(0x223)](_0x3c2ea7(0x205),_0x19eb94),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x273)]('cointopay',_0x3c2ea7(0x1f2),'JSON\x20Parse\x20Error:\x20'+_0x19eb94);throw new Error(_0x3c2ea7(0x203)+_0x16bcf5);}loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x233)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),_0xcdb016[_0x3c2ea7(0x221)],_0x453cad,_0x233b40),console['log'](_0x3c2ea7(0x23a)),console[_0x3c2ea7(0x1f5)]('Result:',_0x453cad[_0x3c2ea7(0x244)]),console['log'](_0x3c2ea7(0x1fa),_0x453cad['status_code']),console[_0x3c2ea7(0x1f5)]('Payment\x20Status:',_0x453cad[_0x3c2ea7(0x1f6)]?.[_0x3c2ea7(0x253)]),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x275),_0x453cad[_0x3c2ea7(0x1f6)]?.[_0x3c2ea7(0x217)]),console['log'](_0x3c2ea7(0x21f),_0x453cad['data']?.[_0x3c2ea7(0x22f)]);if(_0x453cad[_0x3c2ea7(0x244)]!==_0x3c2ea7(0x23d)||_0x453cad[_0x3c2ea7(0x23c)]!==0xc8){const _0x5c60bd=_0x453cad[_0x3c2ea7(0x26e)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x3c2ea7(0x223)](_0x3c2ea7(0x228)),console[_0x3c2ea7(0x223)](_0x3c2ea7(0x269),_0x5c60bd),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x273)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),_0x3c2ea7(0x218)+_0x5c60bd);throw new Error(_0x3c2ea7(0x259)+_0x5c60bd);}if(!_0x453cad[_0x3c2ea7(0x1f6)]){console[_0x3c2ea7(0x223)](_0x3c2ea7(0x1f7)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x273)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),_0x3c2ea7(0x20b));throw new Error(_0x3c2ea7(0x219));}let _0x283946=_0x3c2ea7(0x21e);switch(_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x253)]?.['toLowerCase']()){case _0x3c2ea7(0x236):_0x283946=_0x3c2ea7(0x1ff);break;case _0x3c2ea7(0x247):case _0x3c2ea7(0x21b):case _0x3c2ea7(0x223):_0x283946=_0x3c2ea7(0x272);break;case _0x3c2ea7(0x251):case'timeout':_0x283946=_0x3c2ea7(0x20f);break;case _0x3c2ea7(0x1fc):case'awaiting\x20fiat':case _0x3c2ea7(0x246):case _0x3c2ea7(0x242):default:_0x283946=_0x3c2ea7(0x21e);break;}let _0x432269,_0x519966;if(_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x26b)]){const _0xc6ca61=_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x26b)];console['log'](_0x3c2ea7(0x26a),_0xc6ca61);const _0x393f7d=_0xc6ca61[_0x3c2ea7(0x212)](/IBAN\s+([A-Z0-9]+)/i);_0x393f7d&&(_0x432269=_0x393f7d[0x1],console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x25c),_0x432269)),_0x519966=_0xc6ca61;}const _0x19bd3b={'iban':_0x432269,'bankDetails':_0x519966,'transactionId':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x238)],'coinAddress':_0x453cad[_0x3c2ea7(0x1f6)]['coinAddress'],'qrCodeUrl':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x24e)],'expiryTime':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x22a)],'createdOn':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x254)],'confirmedOn':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x211)]};console[_0x3c2ea7(0x1f5)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x231),_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x253)],'->',_0x283946),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x275),_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x217)],_0x453cad[_0x3c2ea7(0x1f6)]['inputCurrency']),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x21c),_0x453cad[_0x3c2ea7(0x1f6)]['TransactionID']),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x23e),_0x432269||'not\x20found'),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x1f1),_0x453cad['data'][_0x3c2ea7(0x254)]),console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x257),_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x211)]||_0x3c2ea7(0x24c));if(_0x453cad[_0x3c2ea7(0x1f6)]['Status']?.[_0x3c2ea7(0x21d)]()==='awaiting\x20fiat')console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x26c));else _0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x253)]?.[_0x3c2ea7(0x21d)]()==='paid'&&console[_0x3c2ea7(0x1f5)](_0x3c2ea7(0x241));return{'status':_0x283946,'amount':parseFloat(_0x453cad['data']['Amount'])||undefined,'currency':_0x453cad[_0x3c2ea7(0x1f6)][_0x3c2ea7(0x22f)]||_0x3c2ea7(0x207),'paymentDetails':_0x19bd3b};}catch(_0x4c9ed7){console[_0x3c2ea7(0x223)](_0x3c2ea7(0x23b),_0x4c9ed7),loggerService_1[_0x3c2ea7(0x263)][_0x3c2ea7(0x273)](_0x3c2ea7(0x250),_0x3c2ea7(0x1f2),_0x4c9ed7);throw new Error(_0x3c2ea7(0x206)+(_0x4c9ed7 instanceof Error?_0x4c9ed7[_0x3c2ea7(0x26e)]:_0x3c2ea7(0x256)));}}async['verifyPayment'](_0x477238){const _0x27f9d9=a40_0x534ff1,_0x5e45c2=await this[_0x27f9d9(0x24d)](_0x477238);return{'status':_0x5e45c2[_0x27f9d9(0x221)],'amount':_0x5e45c2['amount'],'currency':_0x5e45c2[_0x27f9d9(0x270)]};}async[a40_0x534ff1(0x20d)](_0x5b2fce){const _0x4e9e9f=a40_0x534ff1;console['log'](_0x4e9e9f(0x22d),_0x5b2fce);let _0x57ed69=_0x4e9e9f(0x21e);switch(_0x5b2fce[_0x4e9e9f(0x221)]?.['toLowerCase']()){case _0x4e9e9f(0x236):_0x57ed69=_0x4e9e9f(0x1ff);break;case'cancelled':case _0x4e9e9f(0x21b):case _0x4e9e9f(0x223):_0x57ed69='FAILED';break;case _0x4e9e9f(0x251):case _0x4e9e9f(0x214):_0x57ed69=_0x4e9e9f(0x20f);break;case'pending':case _0x4e9e9f(0x1fc):case _0x4e9e9f(0x225):case _0x4e9e9f(0x242):default:_0x57ed69=_0x4e9e9f(0x21e);break;}return{'paymentId':_0x5b2fce['order_id']||_0x5b2fce[_0x4e9e9f(0x1f3)]||'','status':_0x57ed69,'amount':_0x5b2fce[_0x4e9e9f(0x21a)],'currency':_0x5b2fce[_0x4e9e9f(0x270)]||_0x4e9e9f(0x207)};}}exports[a40_0x534ff1(0x220)]=CoinToPayService;