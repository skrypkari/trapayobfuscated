'use strict';const a44_0x7f50b0=a44_0x25d7;(function(_0x52602c,_0x4cef9f){const _0x39f6f5=a44_0x25d7,_0x35f941=_0x52602c();while(!![]){try{const _0xbe54a0=parseInt(_0x39f6f5(0x96))/0x1*(parseInt(_0x39f6f5(0xbc))/0x2)+parseInt(_0x39f6f5(0xad))/0x3+parseInt(_0x39f6f5(0xc4))/0x4*(parseInt(_0x39f6f5(0xbe))/0x5)+-parseInt(_0x39f6f5(0x8c))/0x6*(-parseInt(_0x39f6f5(0xd1))/0x7)+-parseInt(_0x39f6f5(0xc2))/0x8+parseInt(_0x39f6f5(0x8b))/0x9+-parseInt(_0x39f6f5(0xea))/0xa;if(_0xbe54a0===_0x4cef9f)break;else _0x35f941['push'](_0x35f941['shift']());}catch(_0x2af65a){_0x35f941['push'](_0x35f941['shift']());}}}(a44_0x1f47,0x8ef4f));Object[a44_0x7f50b0(0xb9)](exports,a44_0x7f50b0(0xe7),{'value':!![]}),exports[a44_0x7f50b0(0x87)]=void 0x0;function a44_0x25d7(_0x1a3705,_0x7db542){const _0x1f47ed=a44_0x1f47();return a44_0x25d7=function(_0x25d729,_0x25a9e3){_0x25d729=_0x25d729-0x74;let _0x432633=_0x1f47ed[_0x25d729];return _0x432633;},a44_0x25d7(_0x1a3705,_0x7db542);}const loggerService_1=require(a44_0x7f50b0(0xda));class CoinToPayService{constructor(){const _0x4e8102=a44_0x7f50b0;this[_0x4e8102(0xde)]=_0x4e8102(0xec),this['statusUrl']=_0x4e8102(0x8a),console[_0x4e8102(0xa6)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x4e8102(0xa6)](_0x4e8102(0xce),this[_0x4e8102(0x81)]);}async[a44_0x7f50b0(0x79)](_0x54f9a8){const _0x160fc8=a44_0x7f50b0,{orderId:_0x8c3701,amount:_0x85c898}=_0x54f9a8;console[_0x160fc8(0xa6)](_0x160fc8(0xd7)+_0x85c898+_0x160fc8(0xd9));const _0x1b8dfb={'amount':_0x85c898},_0x573855=Date['now']();try{console[_0x160fc8(0xa6)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x160fc8(0xa6)](_0x160fc8(0x85),this['apiUrl']),console[_0x160fc8(0xa6)](_0x160fc8(0xa5),JSON[_0x160fc8(0xca)](_0x1b8dfb,null,0x2)),console[_0x160fc8(0xa6)](_0x160fc8(0xe6),_0x85c898,_0x160fc8(0xf3)),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0x7f)]('cointopay',_0x160fc8(0x9c),'POST',_0x1b8dfb);const _0x449e4a=await fetch(this[_0x160fc8(0xde)],{'method':'POST','headers':{'Content-Type':_0x160fc8(0x88),'Accept':_0x160fc8(0x88),'User-Agent':_0x160fc8(0xb4)},'body':JSON['stringify'](_0x1b8dfb)}),_0x4c5910=Date[_0x160fc8(0x99)]()-_0x573855;console[_0x160fc8(0xa6)](_0x160fc8(0xb5)),console[_0x160fc8(0xa6)](_0x160fc8(0x78),_0x449e4a[_0x160fc8(0xeb)]),console[_0x160fc8(0xa6)](_0x160fc8(0xd6),_0x449e4a[_0x160fc8(0x8d)]),console['log']('Headers:',Object[_0x160fc8(0x7b)](_0x449e4a[_0x160fc8(0x7c)]['entries']())),console[_0x160fc8(0xa6)]('Response\x20Time:',_0x4c5910+'ms');const _0x3ecdc8=await _0x449e4a[_0x160fc8(0xb6)]();console[_0x160fc8(0xa6)](_0x160fc8(0x9d),_0x3ecdc8);if(!_0x449e4a['ok']){console['error'](_0x160fc8(0xdf)),console[_0x160fc8(0x92)]('HTTP\x20Status:',_0x449e4a[_0x160fc8(0xeb)]),console[_0x160fc8(0x92)](_0x160fc8(0xd3),_0x3ecdc8),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0xc0)](_0x160fc8(0xab),_0x160fc8(0x9c),_0x449e4a[_0x160fc8(0xeb)],_0x3ecdc8,_0x4c5910),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0xc8)](_0x160fc8(0xab),_0x160fc8(0x9c),_0x160fc8(0x7d)+_0x449e4a[_0x160fc8(0xeb)]+':\x20'+_0x3ecdc8);throw new Error(_0x160fc8(0xee)+_0x449e4a[_0x160fc8(0xeb)]+_0x160fc8(0xc9)+_0x3ecdc8);}let _0x180759;try{_0x180759=JSON[_0x160fc8(0xa7)](_0x3ecdc8);}catch(_0x3ad1a0){console[_0x160fc8(0x92)](_0x160fc8(0xf5),_0x3ad1a0),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0xc8)](_0x160fc8(0xab),'/create',_0x160fc8(0x9b)+_0x3ad1a0);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3ecdc8);}console[_0x160fc8(0xa6)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x160fc8(0xa6)](_0x160fc8(0xf1),JSON[_0x160fc8(0xca)](_0x180759,null,0x2)),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0xc0)]('cointopay',_0x160fc8(0x9c),_0x449e4a[_0x160fc8(0xeb)],_0x180759,_0x4c5910);if(_0x180759[_0x160fc8(0x92)]){const _0x38eef4=_0x180759['message']||_0x180759[_0x160fc8(0x92)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x160fc8(0x92)](_0x160fc8(0xb8)),console[_0x160fc8(0x92)]('Error\x20Message:',_0x38eef4),loggerService_1['loggerService']['logWhiteDomainError'](_0x160fc8(0xab),_0x160fc8(0x9c),'Business\x20Error:\x20'+_0x38eef4);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x38eef4);}if(!_0x180759['payment_url']||!_0x180759[_0x160fc8(0xba)]){console[_0x160fc8(0x92)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x160fc8(0x92)](_0x160fc8(0xc5)),console[_0x160fc8(0x92)]('Response\x20data:',_0x180759),loggerService_1[_0x160fc8(0xe5)][_0x160fc8(0xc8)]('cointopay',_0x160fc8(0x9c),_0x160fc8(0xa3));throw new Error(_0x160fc8(0xcc));}return console[_0x160fc8(0xa6)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x160fc8(0xa6)]('Gateway\x20Payment\x20ID:',_0x180759[_0x160fc8(0xba)]),console['log']('Payment\x20URL:',_0x180759['payment_url']),console['log'](_0x160fc8(0xe6),_0x85c898,_0x160fc8(0xe1)),{'gateway_payment_id':_0x180759['gateway_payment_id'],'payment_url':_0x180759['payment_url']};}catch(_0x2436ed){console[_0x160fc8(0x92)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x160fc8(0x92)](_0x160fc8(0xef),_0x2436ed),loggerService_1['loggerService'][_0x160fc8(0xc8)](_0x160fc8(0xab),_0x160fc8(0x9c),_0x2436ed);if(_0x2436ed instanceof Error){console['error'](_0x160fc8(0xa9),_0x2436ed['message']),console['error']('Error\x20stack:',_0x2436ed[_0x160fc8(0xe2)]);throw new Error(_0x160fc8(0x80)+_0x2436ed[_0x160fc8(0xbd)]);}throw new Error(_0x160fc8(0xdb));}}async[a44_0x7f50b0(0xdd)](_0x53bdaf){const _0xcc944d=a44_0x7f50b0,_0x21f365=Date[_0xcc944d(0x99)]();try{console[_0xcc944d(0xa6)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x53bdaf);const _0x9dfe8a={'gatewayPaymentId':_0x53bdaf};loggerService_1[_0xcc944d(0xe5)]['logWhiteDomainRequest'](_0xcc944d(0xab),'/status','POST',_0x9dfe8a);const _0x32cadc=await fetch(this['statusUrl'],{'method':_0xcc944d(0xed),'headers':{'Content-Type':_0xcc944d(0x88),'Accept':_0xcc944d(0x88),'User-Agent':_0xcc944d(0xb4)},'body':JSON[_0xcc944d(0xca)](_0x9dfe8a)}),_0x216aa1=Date[_0xcc944d(0x99)]()-_0x21f365;console[_0xcc944d(0xa6)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xcc944d(0xa6)](_0xcc944d(0x78),_0x32cadc[_0xcc944d(0xeb)]),console[_0xcc944d(0xa6)](_0xcc944d(0xc6),_0x216aa1+'ms');if(!_0x32cadc['ok']){const _0x1244b2=await _0x32cadc[_0xcc944d(0xb6)]();console[_0xcc944d(0x92)](_0xcc944d(0x84),_0x32cadc[_0xcc944d(0xeb)]),console['error']('Response\x20Body:',_0x1244b2),loggerService_1[_0xcc944d(0xe5)][_0xcc944d(0xc0)](_0xcc944d(0xab),'/status',_0x32cadc[_0xcc944d(0xeb)],_0x1244b2,_0x216aa1),loggerService_1['loggerService'][_0xcc944d(0xc8)](_0xcc944d(0xab),_0xcc944d(0xaa),_0xcc944d(0x7d)+_0x32cadc['status']+':\x20'+_0x1244b2);throw new Error(_0xcc944d(0xee)+_0x32cadc[_0xcc944d(0xeb)]);}const _0x44b273=await _0x32cadc[_0xcc944d(0xb6)]();console[_0xcc944d(0xa6)](_0xcc944d(0x9d),_0x44b273);let _0xd02650;try{_0xd02650=JSON[_0xcc944d(0xa7)](_0x44b273);}catch(_0x4aa9ba){console[_0xcc944d(0x92)](_0xcc944d(0xf5),_0x4aa9ba),loggerService_1[_0xcc944d(0xe5)][_0xcc944d(0xc8)]('cointopay',_0xcc944d(0xaa),'JSON\x20Parse\x20Error:\x20'+_0x4aa9ba);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x44b273);}loggerService_1[_0xcc944d(0xe5)][_0xcc944d(0xc0)](_0xcc944d(0xab),_0xcc944d(0xaa),_0x32cadc['status'],_0xd02650,_0x216aa1),console[_0xcc944d(0xa6)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0xcc944d(0xa6)](_0xcc944d(0xd4),_0xd02650[_0xcc944d(0xe4)]),console['log'](_0xcc944d(0x95),_0xd02650[_0xcc944d(0xb2)]),console[_0xcc944d(0xa6)](_0xcc944d(0x9f),_0xd02650['data']?.[_0xcc944d(0xbb)]),console[_0xcc944d(0xa6)](_0xcc944d(0xe6),_0xd02650[_0xcc944d(0x8f)]?.[_0xcc944d(0x9a)]),console[_0xcc944d(0xa6)](_0xcc944d(0x83),_0xd02650['data']?.['inputCurrency']);if(_0xd02650['result']!=='success'||_0xd02650[_0xcc944d(0xb2)]!==0xc8){const _0x170ee6=_0xd02650['message']||_0xcc944d(0xac);console[_0xcc944d(0x92)](_0xcc944d(0xb7)),console[_0xcc944d(0x92)](_0xcc944d(0xaf),_0x170ee6),loggerService_1[_0xcc944d(0xe5)]['logWhiteDomainError']('cointopay',_0xcc944d(0xaa),_0xcc944d(0xb1)+_0x170ee6);throw new Error(_0xcc944d(0x8e)+_0x170ee6);}if(!_0xd02650[_0xcc944d(0x8f)]){console['error'](_0xcc944d(0xa8)),console[_0xcc944d(0x92)](_0xcc944d(0xc7)),loggerService_1['loggerService'][_0xcc944d(0xc8)](_0xcc944d(0xab),_0xcc944d(0xaa),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0xcc944d(0xe8));}let _0x35f758=_0xcc944d(0x98);switch(_0xd02650['data'][_0xcc944d(0xbb)]?.[_0xcc944d(0xa0)]()){case'paid':_0x35f758='PAID';break;case _0xcc944d(0xcd):case _0xcc944d(0xd2):case'error':_0x35f758=_0xcc944d(0x75);break;case'expired':case _0xcc944d(0xb0):_0x35f758=_0xcc944d(0xa2);break;case _0xcc944d(0x97):case _0xcc944d(0x90):case'pending':case _0xcc944d(0x93):default:_0x35f758='PENDING';break;}let _0x29b5ff,_0x343388;if(_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0x76)]){const _0x52b2c4=_0xd02650['data'][_0xcc944d(0x76)];console['log'](_0xcc944d(0x74),_0x52b2c4);const _0x28c0a3=_0x52b2c4[_0xcc944d(0xd0)](/IBAN\s+([A-Z0-9]+)/i);_0x28c0a3&&(_0x29b5ff=_0x28c0a3[0x1],console['log'](_0xcc944d(0xf0),_0x29b5ff)),_0x343388=_0x52b2c4;}const _0x71562e={'iban':_0x29b5ff,'bankDetails':_0x343388,'transactionId':_0xd02650[_0xcc944d(0x8f)]['TransactionID'],'coinAddress':_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0xd5)],'qrCodeUrl':_0xd02650['data'][_0xcc944d(0x86)],'expiryTime':_0xd02650['data'][_0xcc944d(0xcf)],'createdOn':_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0x94)],'confirmedOn':_0xd02650[_0xcc944d(0x8f)]['TransactionConfirmedOn']};console[_0xcc944d(0xa6)](_0xcc944d(0xc3)),console['log']('Status:',_0xd02650[_0xcc944d(0x8f)]['Status'],'->',_0x35f758),console[_0xcc944d(0xa6)](_0xcc944d(0xe6),_0xd02650[_0xcc944d(0x8f)]['Amount'],_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0x82)]),console[_0xcc944d(0xa6)](_0xcc944d(0xf6),_0xd02650[_0xcc944d(0x8f)]['TransactionID']),console[_0xcc944d(0xa6)](_0xcc944d(0x9e),_0x29b5ff||'not\x20found'),console[_0xcc944d(0xa6)](_0xcc944d(0x91),_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0x94)]),console[_0xcc944d(0xa6)](_0xcc944d(0xe3),_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0xf2)]||_0xcc944d(0x7e));if(_0xd02650[_0xcc944d(0x8f)][_0xcc944d(0xbb)]?.[_0xcc944d(0xa0)]()==='awaiting\x20fiat')console[_0xcc944d(0xa6)](_0xcc944d(0xcb));else _0xd02650[_0xcc944d(0x8f)][_0xcc944d(0xbb)]?.['toLowerCase']()===_0xcc944d(0xf4)&&console[_0xcc944d(0xa6)](_0xcc944d(0x89));return{'status':_0x35f758,'amount':parseFloat(_0xd02650['data'][_0xcc944d(0x9a)])||undefined,'currency':_0xd02650['data'][_0xcc944d(0x82)]||_0xcc944d(0xe1),'paymentDetails':_0x71562e};}catch(_0x25dc63){console[_0xcc944d(0x92)](_0xcc944d(0xa1),_0x25dc63),loggerService_1['loggerService'][_0xcc944d(0xc8)](_0xcc944d(0xab),_0xcc944d(0xaa),_0x25dc63);throw new Error(_0xcc944d(0x77)+(_0x25dc63 instanceof Error?_0x25dc63[_0xcc944d(0xbd)]:_0xcc944d(0x7a)));}}async[a44_0x7f50b0(0xb3)](_0x4dc2ae){const _0x1e8ea3=a44_0x7f50b0,_0xeb9f72=await this['checkPaymentStatus'](_0x4dc2ae);return{'status':_0xeb9f72[_0x1e8ea3(0xeb)],'amount':_0xeb9f72[_0x1e8ea3(0xdc)],'currency':_0xeb9f72[_0x1e8ea3(0xbf)]};}async[a44_0x7f50b0(0xae)](_0x1138bf){const _0x5bf408=a44_0x7f50b0;console[_0x5bf408(0xa6)](_0x5bf408(0xa4),_0x1138bf);let _0x44c3bf=_0x5bf408(0x98);switch(_0x1138bf[_0x5bf408(0xeb)]?.[_0x5bf408(0xa0)]()){case'paid':_0x44c3bf=_0x5bf408(0xd8);break;case _0x5bf408(0xcd):case _0x5bf408(0xd2):case _0x5bf408(0x92):_0x44c3bf=_0x5bf408(0x75);break;case'expired':case _0x5bf408(0xb0):_0x44c3bf=_0x5bf408(0xa2);break;case _0x5bf408(0xc1):case _0x5bf408(0x97):case _0x5bf408(0x90):case'created':default:_0x44c3bf=_0x5bf408(0x98);break;}return{'paymentId':_0x1138bf[_0x5bf408(0xe9)]||_0x1138bf[_0x5bf408(0xe0)]||'','status':_0x44c3bf,'amount':_0x1138bf['amount'],'currency':_0x1138bf[_0x5bf408(0xbf)]||_0x5bf408(0xe1)};}}exports[a44_0x7f50b0(0x87)]=CoinToPayService;function a44_0x1f47(){const _0x25f1d5=['stringify','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','📊\x20Status\x20check\x20URL:','ExpiryTime','match','180355CVAEfL','failed','Response\x20Body:','Result:','coinAddress','Status\x20Text:','🪙\x20Creating\x20CoinToPay\x20payment:\x20','PAID','\x20EUR','../loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','amount','checkPaymentStatus','apiUrl','===\x20COINTOPAY\x20API\x20ERROR\x20===','merchant_reference_id','EUR','stack','Confirmed\x20On:','result','loggerService','Amount:','__esModule','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','order_id','13870300yMeKSI','status','https://tesoft.uk/gateway/cointopay/','POST','HTTP\x20error!\x20status:\x20','Error\x20details:','🏦\x20Extracted\x20IBAN:','Parsed\x20Result:','TransactionConfirmedOn','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','paid','Failed\x20to\x20parse\x20JSON\x20response:','Transaction\x20ID:','🏦\x20Payment\x20Detail:','FAILED','PaymentDetail','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status:','createPaymentLink','Unknown\x20error','fromEntries','headers','HTTP\x20','not\x20confirmed','logWhiteDomainRequest','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','statusUrl','inputCurrency','Currency:','HTTP\x20Status:','URL:','QRCodeURL','CoinToPayService','application/json','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/status.php','2411460jEgwON','12wMvHQS','statusText','CoinToPay\x20status\x20API\x20error:\x20','data','awaiting\x20fiat','Created\x20On:','error','created','CreatedOn','Status\x20Code:','87041OYsinw','waiting','PENDING','now','Amount','JSON\x20Parse\x20Error:\x20','/create','Raw\x20Response\x20Body:','IBAN:','Payment\x20Status:','toLowerCase','CoinToPay\x20payment\x20status\x20check\x20error:','EXPIRED','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Request\x20Body:','log','parse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20message:','/status','cointopay','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','2584563JwmtxM','processWebhook','Error\x20Message:','timeout','Status\x20API\x20Error:\x20','status_code','verifyPayment','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','text','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','defineProperty','gateway_payment_id','Status','16Ifgofz','message','185YKBKar','currency','logWhiteDomainResponse','pending','6109544GcJlyP','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','92860byzjPX','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Response\x20Time:','Missing\x20data\x20in\x20response','logWhiteDomainError',',\x20body:\x20'];a44_0x1f47=function(){return _0x25f1d5;};return a44_0x1f47();}