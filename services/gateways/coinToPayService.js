'use strict';const a57_0x2f2425=a57_0x1d7f;(function(_0x428bea,_0x44b8bb){const _0x344893=a57_0x1d7f,_0x7c1565=_0x428bea();while(!![]){try{const _0x1baaf3=parseInt(_0x344893(0x1b6))/0x1*(-parseInt(_0x344893(0x186))/0x2)+-parseInt(_0x344893(0x1df))/0x3*(parseInt(_0x344893(0x191))/0x4)+-parseInt(_0x344893(0x165))/0x5*(parseInt(_0x344893(0x180))/0x6)+parseInt(_0x344893(0x1b5))/0x7*(-parseInt(_0x344893(0x1be))/0x8)+parseInt(_0x344893(0x158))/0x9*(parseInt(_0x344893(0x1ba))/0xa)+parseInt(_0x344893(0x1c9))/0xb+parseInt(_0x344893(0x1d0))/0xc;if(_0x1baaf3===_0x44b8bb)break;else _0x7c1565['push'](_0x7c1565['shift']());}catch(_0x283d7d){_0x7c1565['push'](_0x7c1565['shift']());}}}(a57_0x57ba,0xafa24));Object['defineProperty'](exports,a57_0x2f2425(0x19c),{'value':!![]}),exports[a57_0x2f2425(0x1ae)]=void 0x0;function a57_0x1d7f(_0x421b45,_0x530343){_0x421b45=_0x421b45-0x157;const _0x57ba31=a57_0x57ba();let _0x1d7f6b=_0x57ba31[_0x421b45];return _0x1d7f6b;}function a57_0x57ba(){const _0x1486c0=['https://tesoft.uk/gateway/cointopay/status.php','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','pending','Amount','QRCodeURL','apiUrl','success','processWebhook','Status','===\x20COINTOPAY\x20SUCCESS\x20===','order_id','Parsed\x20Result:','PaymentDetail','ðŸ¦\x20Extracted\x20IBAN:','Gateway\x20Payment\x20ID:','Error\x20stack:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Confirmed\x20On:','Unknown\x20error\x20from\x20CoinToPay\x20API','checkPaymentStatus','Status\x20Text:','162PheNqY',',\x20body:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','result','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','error','1046440wIulXp','CoinToPay\x20API\x20error:\x20','Status\x20Code:','failed','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20Status:','headers','PAID','status_code','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','30028pzTMXF','timeout','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CreatedOn','Incomplete\x20response:\x20missing\x20data','merchant_reference_id','/create','Error\x20Message:','../loggerService','payment_url','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','__esModule','Status\x20API\x20Error:\x20','cancelled','fromEntries','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','createPaymentLink','verifyPayment','log','logWhiteDomainError','Currency:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Result:','HTTP\x20','amount','stringify','https://tesoft.uk/gateway/cointopay/','JSON\x20Parse\x20Error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CoinToPayService','loggerService','logWhiteDomainRequest','Payment\x20Status:','status','Response\x20Time:','Request\x20Body:','4754869usWXHV','1JWdEMB','Response\x20Body:','statusUrl','parse','410wXTsoq','not\x20confirmed','now','text','16UAsjFu','Created\x20On:','created','ðŸ¦\x20Payment\x20Detail:','URL:','Error\x20message:','PENDING','expired','Transaction\x20ID:','ðŸ“Š\x20Status\x20check\x20URL:','match','9851941TmmaYk','entries','Status:','cointopay','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Business\x20Error:\x20','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','29984700QEsJEp','statusText','Payment\x20URL\x20(original):','application/json','inputCurrency','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','coinAddress','IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','FAILED','awaiting\x20fiat','EXPIRED','420xEJmWH','Payment\x20System/1.0','Raw\x20Response\x20Body:','Amount:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','/status','CoinToPay\x20status\x20API\x20error:\x20','Unknown\x20error','POST','paid','246249TRdWUu','Error\x20details:','TransactionID','logWhiteDomainResponse','not\x20found','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','EUR','ExpiryTime','data','waiting','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','toLowerCase','message','160005UktzAY','\x20EUR'];a57_0x57ba=function(){return _0x1486c0;};return a57_0x57ba();}const loggerService_1=require(a57_0x2f2425(0x199));class CoinToPayService{constructor(){const _0x388b1d=a57_0x2f2425;this[_0x388b1d(0x16f)]=_0x388b1d(0x1ab),this[_0x388b1d(0x1b8)]=_0x388b1d(0x167),console[_0x388b1d(0x1a3)](_0x388b1d(0x168)),console[_0x388b1d(0x1a3)](_0x388b1d(0x1c7),this[_0x388b1d(0x1b8)]);}async[a57_0x2f2425(0x1a1)](_0x57cf90){const _0x3dbb1f=a57_0x2f2425,{orderId:_0x482816,amount:_0xcf720}=_0x57cf90;console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1a0)+_0xcf720+_0x3dbb1f(0x166));const _0x2128a3={'amount':_0xcf720},_0x808dcd=Date[_0x3dbb1f(0x1bc)]();try{console['log'](_0x3dbb1f(0x1a6)),console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1c2),this[_0x3dbb1f(0x16f)]),console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1b4),JSON[_0x3dbb1f(0x1aa)](_0x2128a3,null,0x2)),console['log']('Amount:',_0xcf720,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x3dbb1f(0x1b0)](_0x3dbb1f(0x1cc),_0x3dbb1f(0x197),_0x3dbb1f(0x1ea),_0x2128a3);const _0x19932a=await fetch(this['apiUrl'],{'method':_0x3dbb1f(0x1ea),'headers':{'Content-Type':'application/json','Accept':_0x3dbb1f(0x1d3),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x3dbb1f(0x1aa)](_0x2128a3)}),_0x1a3d6e=Date['now']()-_0x808dcd;console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x16a)),console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1cb),_0x19932a['status']),console['log'](_0x3dbb1f(0x17f),_0x19932a[_0x3dbb1f(0x1d1)]),console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x16b),Object[_0x3dbb1f(0x19f)](_0x19932a[_0x3dbb1f(0x18c)][_0x3dbb1f(0x1ca)]())),console[_0x3dbb1f(0x1a3)]('Response\x20Time:',_0x1a3d6e+'ms');const _0x3ced6c=await _0x19932a['text']();console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1e1),_0x3ced6c);if(!_0x19932a['ok']){console['error'](_0x3dbb1f(0x1e6)),console['error'](_0x3dbb1f(0x18b),_0x19932a[_0x3dbb1f(0x1b2)]),console[_0x3dbb1f(0x185)](_0x3dbb1f(0x1b7),_0x3ced6c),loggerService_1['loggerService'][_0x3dbb1f(0x15b)]('cointopay','/create',_0x19932a[_0x3dbb1f(0x1b2)],_0x3ced6c,_0x1a3d6e),loggerService_1[_0x3dbb1f(0x1af)][_0x3dbb1f(0x1a4)]('cointopay',_0x3dbb1f(0x197),_0x3dbb1f(0x1a8)+_0x19932a['status']+':\x20'+_0x3ced6c);throw new Error(_0x3dbb1f(0x1d9)+_0x19932a[_0x3dbb1f(0x1b2)]+_0x3dbb1f(0x181)+_0x3ced6c);}let _0x54182f;try{_0x54182f=JSON[_0x3dbb1f(0x1b9)](_0x3ced6c);}catch(_0x4df38d){console['error'](_0x3dbb1f(0x18f),_0x4df38d),loggerService_1[_0x3dbb1f(0x1af)][_0x3dbb1f(0x1a4)](_0x3dbb1f(0x1cc),_0x3dbb1f(0x197),_0x3dbb1f(0x1ac)+_0x4df38d);throw new Error(_0x3dbb1f(0x1d5)+_0x3ced6c);}console['log'](_0x3dbb1f(0x17b)),console['log'](_0x3dbb1f(0x175),JSON[_0x3dbb1f(0x1aa)](_0x54182f,null,0x2)),loggerService_1['loggerService'][_0x3dbb1f(0x15b)](_0x3dbb1f(0x1cc),_0x3dbb1f(0x197),_0x19932a[_0x3dbb1f(0x1b2)],_0x54182f,_0x1a3d6e);if(_0x54182f[_0x3dbb1f(0x185)]){const _0x3e9a51=_0x54182f[_0x3dbb1f(0x164)]||_0x54182f[_0x3dbb1f(0x185)]||_0x3dbb1f(0x17d);console[_0x3dbb1f(0x185)](_0x3dbb1f(0x182)),console['error'](_0x3dbb1f(0x198),_0x3e9a51),loggerService_1[_0x3dbb1f(0x1af)][_0x3dbb1f(0x1a4)](_0x3dbb1f(0x1cc),_0x3dbb1f(0x197),_0x3dbb1f(0x1ce)+_0x3e9a51);throw new Error(_0x3dbb1f(0x187)+_0x3e9a51);}if(!_0x54182f[_0x3dbb1f(0x19a)]||!_0x54182f[_0x3dbb1f(0x1db)]){console[_0x3dbb1f(0x185)](_0x3dbb1f(0x1e3)),console[_0x3dbb1f(0x185)](_0x3dbb1f(0x1ad)),console['error']('Response\x20data:',_0x54182f),loggerService_1['loggerService'][_0x3dbb1f(0x1a4)]('cointopay','/create',_0x3dbb1f(0x1da));throw new Error(_0x3dbb1f(0x1d8));}console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x173)),console['log'](_0x3dbb1f(0x178),_0x54182f[_0x3dbb1f(0x1db)]),console['log'](_0x3dbb1f(0x1d2),_0x54182f[_0x3dbb1f(0x19a)]);const _0x57a7c5=_0x54182f[_0x3dbb1f(0x19a)]+'&alternative=false';return console[_0x3dbb1f(0x1a3)]('Payment\x20URL\x20(modified):',_0x57a7c5),console[_0x3dbb1f(0x1a3)](_0x3dbb1f(0x1e2),_0xcf720,'EUR'),{'gateway_payment_id':_0x54182f['gateway_payment_id'],'payment_url':_0x57a7c5};}catch(_0x289578){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x3dbb1f(0x185)](_0x3dbb1f(0x159),_0x289578),loggerService_1[_0x3dbb1f(0x1af)][_0x3dbb1f(0x1a4)](_0x3dbb1f(0x1cc),_0x3dbb1f(0x197),_0x289578);if(_0x289578 instanceof Error){console[_0x3dbb1f(0x185)](_0x3dbb1f(0x1c3),_0x289578[_0x3dbb1f(0x164)]),console[_0x3dbb1f(0x185)](_0x3dbb1f(0x179),_0x289578['stack']);throw new Error(_0x3dbb1f(0x162)+_0x289578[_0x3dbb1f(0x164)]);}throw new Error(_0x3dbb1f(0x169));}}async[a57_0x2f2425(0x17e)](_0x11a383){const _0x5c531a=a57_0x2f2425,_0x5c3bea=Date[_0x5c531a(0x1bc)]();try{console[_0x5c531a(0x1a3)](_0x5c531a(0x1cf)+_0x11a383);const _0xf57426={'gatewayPaymentId':_0x11a383};loggerService_1[_0x5c531a(0x1af)][_0x5c531a(0x1b0)](_0x5c531a(0x1cc),_0x5c531a(0x1e7),_0x5c531a(0x1ea),_0xf57426);const _0x69bea8=await fetch(this['statusUrl'],{'method':_0x5c531a(0x1ea),'headers':{'Content-Type':'application/json','Accept':_0x5c531a(0x1d3),'User-Agent':_0x5c531a(0x1e0)},'body':JSON[_0x5c531a(0x1aa)](_0xf57426)}),_0x524334=Date[_0x5c531a(0x1bc)]()-_0x5c3bea;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x5c531a(0x1a3)](_0x5c531a(0x1cb),_0x69bea8[_0x5c531a(0x1b2)]),console[_0x5c531a(0x1a3)](_0x5c531a(0x1b3),_0x524334+'ms');if(!_0x69bea8['ok']){const _0x55d6dc=await _0x69bea8['text']();console[_0x5c531a(0x185)](_0x5c531a(0x18b),_0x69bea8[_0x5c531a(0x1b2)]),console[_0x5c531a(0x185)](_0x5c531a(0x1b7),_0x55d6dc),loggerService_1[_0x5c531a(0x1af)][_0x5c531a(0x15b)](_0x5c531a(0x1cc),'/status',_0x69bea8['status'],_0x55d6dc,_0x524334),loggerService_1['loggerService']['logWhiteDomainError'](_0x5c531a(0x1cc),_0x5c531a(0x1e7),_0x5c531a(0x1a8)+_0x69bea8[_0x5c531a(0x1b2)]+':\x20'+_0x55d6dc);throw new Error(_0x5c531a(0x1d9)+_0x69bea8[_0x5c531a(0x1b2)]);}const _0x374507=await _0x69bea8[_0x5c531a(0x1bd)]();console[_0x5c531a(0x1a3)](_0x5c531a(0x1e1),_0x374507);let _0x417791;try{_0x417791=JSON['parse'](_0x374507);}catch(_0x8f65cf){console[_0x5c531a(0x185)](_0x5c531a(0x18f),_0x8f65cf),loggerService_1[_0x5c531a(0x1af)][_0x5c531a(0x1a4)](_0x5c531a(0x1cc),'/status',_0x5c531a(0x1ac)+_0x8f65cf);throw new Error(_0x5c531a(0x190)+_0x374507);}loggerService_1[_0x5c531a(0x1af)][_0x5c531a(0x15b)]('cointopay','/status',_0x69bea8['status'],_0x417791,_0x524334),console['log'](_0x5c531a(0x19b)),console[_0x5c531a(0x1a3)](_0x5c531a(0x1a7),_0x417791[_0x5c531a(0x183)]),console[_0x5c531a(0x1a3)](_0x5c531a(0x188),_0x417791[_0x5c531a(0x18e)]),console[_0x5c531a(0x1a3)](_0x5c531a(0x1b1),_0x417791[_0x5c531a(0x160)]?.[_0x5c531a(0x172)]),console[_0x5c531a(0x1a3)](_0x5c531a(0x1e2),_0x417791[_0x5c531a(0x160)]?.['Amount']),console[_0x5c531a(0x1a3)](_0x5c531a(0x1a5),_0x417791[_0x5c531a(0x160)]?.[_0x5c531a(0x1d4)]);if(_0x417791[_0x5c531a(0x183)]!==_0x5c531a(0x170)||_0x417791[_0x5c531a(0x18e)]!==0xc8){const _0x49eef6=_0x417791[_0x5c531a(0x164)]||_0x5c531a(0x17a);console[_0x5c531a(0x185)](_0x5c531a(0x1e5)),console[_0x5c531a(0x185)](_0x5c531a(0x198),_0x49eef6),loggerService_1[_0x5c531a(0x1af)]['logWhiteDomainError'](_0x5c531a(0x1cc),_0x5c531a(0x1e7),_0x5c531a(0x19d)+_0x49eef6);throw new Error(_0x5c531a(0x1e8)+_0x49eef6);}if(!_0x417791[_0x5c531a(0x160)]){console[_0x5c531a(0x185)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x5c531a(0x1af)]['logWhiteDomainError'](_0x5c531a(0x1cc),'/status',_0x5c531a(0x195));throw new Error(_0x5c531a(0x184));}let _0x19c7f5=_0x5c531a(0x1c4);switch(_0x417791[_0x5c531a(0x160)]['Status']?.[_0x5c531a(0x163)]()){case _0x5c531a(0x157):_0x19c7f5=_0x5c531a(0x18d);break;case _0x5c531a(0x19e):case _0x5c531a(0x189):case'error':_0x19c7f5=_0x5c531a(0x1dc);break;case _0x5c531a(0x1c5):case _0x5c531a(0x192):_0x19c7f5=_0x5c531a(0x1de);break;case'waiting':case _0x5c531a(0x1dd):case'pending':case _0x5c531a(0x1c0):default:_0x19c7f5='PENDING';break;}let _0x3b1c34,_0x2102a7;if(_0x417791['data'][_0x5c531a(0x176)]){const _0x3232ad=_0x417791[_0x5c531a(0x160)][_0x5c531a(0x176)];console[_0x5c531a(0x1a3)](_0x5c531a(0x1c1),_0x3232ad);const _0x3c875b=_0x3232ad[_0x5c531a(0x1c8)](/IBAN\s+([A-Z0-9]+)/i);_0x3c875b&&(_0x3b1c34=_0x3c875b[0x1],console['log'](_0x5c531a(0x177),_0x3b1c34)),_0x2102a7=_0x3232ad;}const _0x23da90={'iban':_0x3b1c34,'bankDetails':_0x2102a7,'transactionId':_0x417791['data'][_0x5c531a(0x15a)],'coinAddress':_0x417791['data'][_0x5c531a(0x1d6)],'qrCodeUrl':_0x417791['data'][_0x5c531a(0x16e)],'expiryTime':_0x417791[_0x5c531a(0x160)][_0x5c531a(0x15f)],'createdOn':_0x417791[_0x5c531a(0x160)][_0x5c531a(0x194)],'confirmedOn':_0x417791[_0x5c531a(0x160)]['TransactionConfirmedOn']};console[_0x5c531a(0x1a3)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log']('Status:',_0x417791[_0x5c531a(0x160)][_0x5c531a(0x172)],'->',_0x19c7f5),console[_0x5c531a(0x1a3)](_0x5c531a(0x1e2),_0x417791['data']['Amount'],_0x417791[_0x5c531a(0x160)][_0x5c531a(0x1d4)]),console[_0x5c531a(0x1a3)](_0x5c531a(0x1c6),_0x417791[_0x5c531a(0x160)]['TransactionID']),console['log'](_0x5c531a(0x1d7),_0x3b1c34||_0x5c531a(0x15c)),console[_0x5c531a(0x1a3)](_0x5c531a(0x1bf),_0x417791['data'][_0x5c531a(0x194)]),console['log'](_0x5c531a(0x17c),_0x417791[_0x5c531a(0x160)]['TransactionConfirmedOn']||_0x5c531a(0x1bb));if(_0x417791[_0x5c531a(0x160)]['Status']?.['toLowerCase']()===_0x5c531a(0x1dd))console[_0x5c531a(0x1a3)](_0x5c531a(0x15d));else _0x417791['data'][_0x5c531a(0x172)]?.[_0x5c531a(0x163)]()===_0x5c531a(0x157)&&console[_0x5c531a(0x1a3)](_0x5c531a(0x1cd));return{'status':_0x19c7f5,'amount':parseFloat(_0x417791[_0x5c531a(0x160)][_0x5c531a(0x16d)])||undefined,'currency':_0x417791[_0x5c531a(0x160)][_0x5c531a(0x1d4)]||_0x5c531a(0x15e),'paymentDetails':_0x23da90};}catch(_0x581406){console[_0x5c531a(0x185)](_0x5c531a(0x18a),_0x581406),loggerService_1[_0x5c531a(0x1af)][_0x5c531a(0x1a4)](_0x5c531a(0x1cc),_0x5c531a(0x1e7),_0x581406);throw new Error(_0x5c531a(0x1e4)+(_0x581406 instanceof Error?_0x581406[_0x5c531a(0x164)]:_0x5c531a(0x1e9)));}}async[a57_0x2f2425(0x1a2)](_0x4dcb81){const _0x5616b1=a57_0x2f2425,_0x41a50f=await this[_0x5616b1(0x17e)](_0x4dcb81);return{'status':_0x41a50f['status'],'amount':_0x41a50f[_0x5616b1(0x1a9)],'currency':_0x41a50f['currency']};}async[a57_0x2f2425(0x171)](_0x28ae97){const _0x32f557=a57_0x2f2425;console[_0x32f557(0x1a3)](_0x32f557(0x193),_0x28ae97);let _0x47b0d2=_0x32f557(0x1c4);switch(_0x28ae97['status']?.[_0x32f557(0x163)]()){case _0x32f557(0x157):_0x47b0d2='PAID';break;case _0x32f557(0x19e):case'failed':case _0x32f557(0x185):_0x47b0d2='FAILED';break;case _0x32f557(0x1c5):case _0x32f557(0x192):_0x47b0d2='EXPIRED';break;case _0x32f557(0x16c):case _0x32f557(0x161):case'awaiting\x20fiat':case _0x32f557(0x1c0):default:_0x47b0d2=_0x32f557(0x1c4);break;}return{'paymentId':_0x28ae97[_0x32f557(0x174)]||_0x28ae97[_0x32f557(0x196)]||'','status':_0x47b0d2,'amount':_0x28ae97[_0x32f557(0x1a9)],'currency':_0x28ae97['currency']||_0x32f557(0x15e)};}}exports[a57_0x2f2425(0x1ae)]=CoinToPayService;