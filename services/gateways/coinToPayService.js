'use strict';const a65_0x413838=a65_0x3f18;(function(_0x2eb93d,_0x3356e1){const _0x2653fc=a65_0x3f18,_0x8906ef=_0x2eb93d();while(!![]){try{const _0xeb575e=-parseInt(_0x2653fc(0x8e))/0x1*(parseInt(_0x2653fc(0xac))/0x2)+parseInt(_0x2653fc(0xbf))/0x3+-parseInt(_0x2653fc(0xd4))/0x4+-parseInt(_0x2653fc(0xa1))/0x5+parseInt(_0x2653fc(0xa9))/0x6+parseInt(_0x2653fc(0x94))/0x7*(-parseInt(_0x2653fc(0x71))/0x8)+parseInt(_0x2653fc(0xed))/0x9;if(_0xeb575e===_0x3356e1)break;else _0x8906ef['push'](_0x8906ef['shift']());}catch(_0x3b20a9){_0x8906ef['push'](_0x8906ef['shift']());}}}(a65_0x58c3,0x95a20));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a65_0x413838(0xc2));function a65_0x3f18(_0x2688ae,_0x395249){_0x2688ae=_0x2688ae-0x6a;const _0x58c3f0=a65_0x58c3();let _0x3f1849=_0x58c3f0[_0x2688ae];return _0x3f1849;}class CoinToPayService{constructor(){const _0x4f4cc2=a65_0x413838;this['apiUrl']=_0x4f4cc2(0x9d),this[_0x4f4cc2(0x70)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4f4cc2(0xa8)](_0x4f4cc2(0xca)),console[_0x4f4cc2(0xa8)]('üìä\x20Status\x20check\x20URL:',this[_0x4f4cc2(0x70)]);}async[a65_0x413838(0xd9)](_0x617abe){const _0x1133c9=a65_0x413838,{orderId:_0x133d85,amount:_0x43011c}=_0x617abe;console[_0x1133c9(0xa8)](_0x1133c9(0xd0)+_0x43011c+'\x20EUR');const _0x108a10={'amount':_0x43011c},_0x34e997=Date['now']();try{console[_0x1133c9(0xa8)](_0x1133c9(0xb1)),console[_0x1133c9(0xa8)](_0x1133c9(0x9b),this[_0x1133c9(0x90)]),console[_0x1133c9(0xa8)](_0x1133c9(0xe1),JSON[_0x1133c9(0xcf)](_0x108a10,null,0x2)),console['log'](_0x1133c9(0x7f),_0x43011c,_0x1133c9(0x6b)),loggerService_1[_0x1133c9(0xdc)]['logWhiteDomainRequest'](_0x1133c9(0xd7),_0x1133c9(0xec),_0x1133c9(0xb9),_0x108a10);const _0x3f670b=await fetch(this[_0x1133c9(0x90)],{'method':_0x1133c9(0xb9),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1133c9(0xaa)},'body':JSON['stringify'](_0x108a10)}),_0x3e3c0e=Date[_0x1133c9(0x8d)]()-_0x34e997;console[_0x1133c9(0xa8)](_0x1133c9(0xbc)),console['log'](_0x1133c9(0xcd),_0x3f670b[_0x1133c9(0xe2)]),console[_0x1133c9(0xa8)](_0x1133c9(0xa3),_0x3f670b[_0x1133c9(0xde)]),console[_0x1133c9(0xa8)](_0x1133c9(0xcc),Object[_0x1133c9(0x77)](_0x3f670b['headers'][_0x1133c9(0x7e)]())),console[_0x1133c9(0xa8)](_0x1133c9(0xe8),_0x3e3c0e+'ms');const _0xa199de=await _0x3f670b[_0x1133c9(0x99)]();console['log'](_0x1133c9(0x72),_0xa199de);if(!_0x3f670b['ok']){console[_0x1133c9(0xa4)](_0x1133c9(0x8c)),console['error']('HTTP\x20Status:',_0x3f670b[_0x1133c9(0xe2)]),console[_0x1133c9(0xa4)](_0x1133c9(0xe3),_0xa199de),loggerService_1[_0x1133c9(0xdc)][_0x1133c9(0xc6)]('cointopay',_0x1133c9(0xec),_0x3f670b[_0x1133c9(0xe2)],_0xa199de,_0x3e3c0e),loggerService_1[_0x1133c9(0xdc)]['logWhiteDomainError'](_0x1133c9(0xd7),_0x1133c9(0xec),_0x1133c9(0x6d)+_0x3f670b[_0x1133c9(0xe2)]+':\x20'+_0xa199de);throw new Error(_0x1133c9(0x79)+_0x3f670b[_0x1133c9(0xe2)]+_0x1133c9(0xb5)+_0xa199de);}let _0x15021c;try{_0x15021c=JSON[_0x1133c9(0xce)](_0xa199de);}catch(_0x1f9e9b){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x1f9e9b),loggerService_1[_0x1133c9(0xdc)][_0x1133c9(0xb4)](_0x1133c9(0xd7),_0x1133c9(0xec),_0x1133c9(0xd1)+_0x1f9e9b);throw new Error(_0x1133c9(0xda)+_0xa199de);}console[_0x1133c9(0xa8)](_0x1133c9(0xad)),console[_0x1133c9(0xa8)](_0x1133c9(0x92),JSON[_0x1133c9(0xcf)](_0x15021c,null,0x2)),loggerService_1[_0x1133c9(0xdc)][_0x1133c9(0xc6)](_0x1133c9(0xd7),'/create',_0x3f670b['status'],_0x15021c,_0x3e3c0e);if(_0x15021c[_0x1133c9(0xa4)]){const _0x165cac=_0x15021c[_0x1133c9(0x7b)]||_0x15021c[_0x1133c9(0xa4)]||_0x1133c9(0x74);console[_0x1133c9(0xa4)](_0x1133c9(0xbd)),console[_0x1133c9(0xa4)]('Error\x20Message:',_0x165cac),loggerService_1[_0x1133c9(0xdc)][_0x1133c9(0xb4)](_0x1133c9(0xd7),'/create',_0x1133c9(0x9c)+_0x165cac);throw new Error(_0x1133c9(0x6e)+_0x165cac);}if(!_0x15021c[_0x1133c9(0x86)]||!_0x15021c['gateway_payment_id']){console[_0x1133c9(0xa4)](_0x1133c9(0xe5)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1133c9(0xa4)]('Response\x20data:',_0x15021c),loggerService_1[_0x1133c9(0xdc)][_0x1133c9(0xb4)](_0x1133c9(0xd7),'/create',_0x1133c9(0x6a));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log'](_0x1133c9(0xa2)),console['log']('Gateway\x20Payment\x20ID:',_0x15021c[_0x1133c9(0x78)]),console[_0x1133c9(0xa8)](_0x1133c9(0x8f),_0x15021c[_0x1133c9(0x86)]);const _0x3e88ed=_0x15021c[_0x1133c9(0x86)]+_0x1133c9(0x96);return console[_0x1133c9(0xa8)](_0x1133c9(0xea),_0x3e88ed),console[_0x1133c9(0xa8)](_0x1133c9(0x7f),_0x43011c,'EUR'),{'gateway_payment_id':_0x15021c[_0x1133c9(0x78)],'payment_url':_0x3e88ed};}catch(_0x58638d){console[_0x1133c9(0xa4)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x1133c9(0xa4)]('Error\x20details:',_0x58638d),loggerService_1[_0x1133c9(0xdc)]['logWhiteDomainError'](_0x1133c9(0xd7),'/create',_0x58638d);if(_0x58638d instanceof Error){console[_0x1133c9(0xa4)]('Error\x20message:',_0x58638d[_0x1133c9(0x7b)]),console['error']('Error\x20stack:',_0x58638d[_0x1133c9(0x88)]);throw new Error(_0x1133c9(0x7c)+_0x58638d[_0x1133c9(0x7b)]);}throw new Error(_0x1133c9(0x9f));}}async[a65_0x413838(0xe0)](_0x524d1a){const _0x3e8e3e=a65_0x413838,_0x4eb3cc=Date[_0x3e8e3e(0x8d)]();try{console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xe6)+_0x524d1a);const _0x235824={'gatewayPaymentId':_0x524d1a};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3e8e3e(0xd7),_0x3e8e3e(0xd8),_0x3e8e3e(0xb9),_0x235824);const _0x46ed4b=await fetch(this[_0x3e8e3e(0x70)],{'method':_0x3e8e3e(0xb9),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x3e8e3e(0xaa)},'body':JSON[_0x3e8e3e(0xcf)](_0x235824)}),_0x1974ba=Date['now']()-_0x4eb3cc;console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xc7)),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xcd),_0x46ed4b['status']),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xe8),_0x1974ba+'ms');if(!_0x46ed4b['ok']){const _0x250d51=await _0x46ed4b['text']();console[_0x3e8e3e(0xa4)](_0x3e8e3e(0x6f),_0x46ed4b[_0x3e8e3e(0xe2)]),console[_0x3e8e3e(0xa4)](_0x3e8e3e(0xe3),_0x250d51),loggerService_1[_0x3e8e3e(0xdc)]['logWhiteDomainResponse'](_0x3e8e3e(0xd7),_0x3e8e3e(0xd8),_0x46ed4b[_0x3e8e3e(0xe2)],_0x250d51,_0x1974ba),loggerService_1[_0x3e8e3e(0xdc)][_0x3e8e3e(0xb4)](_0x3e8e3e(0xd7),'/status','HTTP\x20'+_0x46ed4b[_0x3e8e3e(0xe2)]+':\x20'+_0x250d51);throw new Error(_0x3e8e3e(0x79)+_0x46ed4b[_0x3e8e3e(0xe2)]);}const _0x19c3b3=await _0x46ed4b['text']();console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x72),_0x19c3b3);let _0x47ae93;try{_0x47ae93=JSON[_0x3e8e3e(0xce)](_0x19c3b3);}catch(_0x46d012){console[_0x3e8e3e(0xa4)](_0x3e8e3e(0x82),_0x46d012),loggerService_1[_0x3e8e3e(0xdc)][_0x3e8e3e(0xb4)](_0x3e8e3e(0xd7),_0x3e8e3e(0xd8),_0x3e8e3e(0xd1)+_0x46d012);throw new Error(_0x3e8e3e(0xc0)+_0x19c3b3);}loggerService_1['loggerService'][_0x3e8e3e(0xc6)]('cointopay',_0x3e8e3e(0xd8),_0x46ed4b[_0x3e8e3e(0xe2)],_0x47ae93,_0x1974ba),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x80)),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x73),_0x47ae93['result']),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xb6),_0x47ae93[_0x3e8e3e(0x75)]),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x97),_0x47ae93[_0x3e8e3e(0xe9)]?.['Status']),console[_0x3e8e3e(0xa8)]('Amount:',_0x47ae93['data']?.['Amount']),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x89),_0x47ae93['data']?.['inputCurrency']);if(_0x47ae93[_0x3e8e3e(0x8b)]!=='success'||_0x47ae93[_0x3e8e3e(0x75)]!==0xc8){const _0x196525=_0x47ae93['message']||_0x3e8e3e(0xd5);console['error'](_0x3e8e3e(0xdf)),console[_0x3e8e3e(0xa4)](_0x3e8e3e(0x93),_0x196525),loggerService_1['loggerService'][_0x3e8e3e(0xb4)](_0x3e8e3e(0xd7),_0x3e8e3e(0xd8),_0x3e8e3e(0xab)+_0x196525);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x196525);}if(!_0x47ae93['data']){console['error'](_0x3e8e3e(0xd2)),console[_0x3e8e3e(0xa4)](_0x3e8e3e(0x76)),loggerService_1[_0x3e8e3e(0xdc)][_0x3e8e3e(0xb4)](_0x3e8e3e(0xd7),'/status',_0x3e8e3e(0xc5));throw new Error(_0x3e8e3e(0x7d));}let _0x3a43b1=_0x3e8e3e(0xb8);switch(_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xc4)]?.[_0x3e8e3e(0xba)]()){case _0x3e8e3e(0xbb):_0x3a43b1=_0x3e8e3e(0xa5);break;case _0x3e8e3e(0xc3):case _0x3e8e3e(0xe7):case _0x3e8e3e(0xa4):_0x3a43b1=_0x3e8e3e(0xeb);break;case _0x3e8e3e(0xc8):case'timeout':_0x3a43b1=_0x3e8e3e(0x6c);break;case _0x3e8e3e(0xc9):case'awaiting\x20fiat':case _0x3e8e3e(0xb2):case _0x3e8e3e(0x98):default:_0x3a43b1='PENDING';break;}let _0xc330ab,_0x5ce7b6;if(_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xc1)]){const _0x7b71eb=_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xc1)];console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x95),_0x7b71eb);const _0x2e1dc8=_0x7b71eb['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2e1dc8&&(_0xc330ab=_0x2e1dc8[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0xc330ab)),_0x5ce7b6=_0x7b71eb;}const _0x12b2c3={'iban':_0xc330ab,'bankDetails':_0x5ce7b6,'transactionId':_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xb3)],'coinAddress':_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0x8a)],'qrCodeUrl':_0x47ae93['data'][_0x3e8e3e(0x9e)],'expiryTime':_0x47ae93[_0x3e8e3e(0xe9)]['ExpiryTime'],'createdOn':_0x47ae93['data']['CreatedOn'],'confirmedOn':_0x47ae93['data'][_0x3e8e3e(0x84)]};console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xd6)),console['log'](_0x3e8e3e(0xcd),_0x47ae93[_0x3e8e3e(0xe9)]['Status'],'->',_0x3a43b1),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x7f),_0x47ae93[_0x3e8e3e(0xe9)]['Amount'],_0x47ae93[_0x3e8e3e(0xe9)]['inputCurrency']),console['log'](_0x3e8e3e(0xb0),_0x47ae93['data'][_0x3e8e3e(0xb3)]),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xae),_0xc330ab||_0x3e8e3e(0x83)),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xcb),_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xa0)]),console[_0x3e8e3e(0xa8)](_0x3e8e3e(0x91),_0x47ae93['data'][_0x3e8e3e(0x84)]||_0x3e8e3e(0xb7));if(_0x47ae93['data']['Status']?.['toLowerCase']()===_0x3e8e3e(0xdb))console[_0x3e8e3e(0xa8)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0xc4)]?.['toLowerCase']()===_0x3e8e3e(0xbb)&&console[_0x3e8e3e(0xa8)](_0x3e8e3e(0xdd));return{'status':_0x3a43b1,'amount':parseFloat(_0x47ae93[_0x3e8e3e(0xe9)][_0x3e8e3e(0x9a)])||undefined,'currency':_0x47ae93['data']['inputCurrency']||_0x3e8e3e(0xe4),'paymentDetails':_0x12b2c3};}catch(_0x6dfca5){console['error'](_0x3e8e3e(0xa6),_0x6dfca5),loggerService_1[_0x3e8e3e(0xdc)][_0x3e8e3e(0xb4)](_0x3e8e3e(0xd7),'/status',_0x6dfca5);throw new Error(_0x3e8e3e(0x81)+(_0x6dfca5 instanceof Error?_0x6dfca5[_0x3e8e3e(0x7b)]:_0x3e8e3e(0xaf)));}}async['verifyPayment'](_0x143ddc){const _0x4dd4b8=a65_0x413838,_0x1d604b=await this[_0x4dd4b8(0xe0)](_0x143ddc);return{'status':_0x1d604b['status'],'amount':_0x1d604b[_0x4dd4b8(0xd3)],'currency':_0x1d604b[_0x4dd4b8(0xa7)]};}async[a65_0x413838(0xbe)](_0x261b9f){const _0x1426cc=a65_0x413838;console[_0x1426cc(0xa8)](_0x1426cc(0x7a),_0x261b9f);let _0x5d4ba6=_0x1426cc(0xb8);switch(_0x261b9f['status']?.[_0x1426cc(0xba)]()){case _0x1426cc(0xbb):_0x5d4ba6=_0x1426cc(0xa5);break;case _0x1426cc(0xc3):case _0x1426cc(0xe7):case _0x1426cc(0xa4):_0x5d4ba6='FAILED';break;case _0x1426cc(0xc8):case _0x1426cc(0x85):_0x5d4ba6=_0x1426cc(0x6c);break;case _0x1426cc(0xb2):case _0x1426cc(0xc9):case _0x1426cc(0xdb):case'created':default:_0x5d4ba6='PENDING';break;}return{'paymentId':_0x261b9f['order_id']||_0x261b9f['merchant_reference_id']||'','status':_0x5d4ba6,'amount':_0x261b9f[_0x1426cc(0xd3)],'currency':_0x261b9f[_0x1426cc(0xa7)]||_0x1426cc(0xe4)};}}exports[a65_0x413838(0x87)]=CoinToPayService;function a65_0x58c3(){const _0x45fd82=['CreatedOn','2695925brtANz','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20Text:','error','PAID','CoinToPay\x20payment\x20status\x20check\x20error:','currency','log','1806066XVShul','Payment\x20System/1.0','Status\x20API\x20Error:\x20','85124FFxgCU','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','IBAN:','Unknown\x20error','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','pending','TransactionID','logWhiteDomainError',',\x20body:\x20','Status\x20Code:','not\x20confirmed','PENDING','POST','toLowerCase','paid','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','processWebhook','1861251HsoySR','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PaymentDetail','../loggerService','cancelled','Status','Incomplete\x20response:\x20missing\x20data','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','expired','waiting','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Created\x20On:','Headers:','Status:','parse','stringify','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','amount','3633904AzBvGM','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','cointopay','/status','createPaymentLink','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','awaiting\x20fiat','loggerService','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','statusText','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','checkPaymentStatus','Request\x20Body:','status','Response\x20Body:','EUR','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','failed','Response\x20Time:','data','Payment\x20URL\x20(modified):','FAILED','/create','18637119ZdimgA','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','EXPIRED','HTTP\x20','CoinToPay\x20API\x20error:\x20','HTTP\x20Status:','statusUrl','352JMwVWQ','Raw\x20Response\x20Body:','Result:','Unknown\x20error\x20from\x20CoinToPay\x20API','status_code','Missing\x20data\x20in\x20response','fromEntries','gateway_payment_id','HTTP\x20error!\x20status:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','entries','Amount:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','not\x20found','TransactionConfirmedOn','timeout','payment_url','CoinToPayService','stack','Currency:','coinAddress','result','===\x20COINTOPAY\x20API\x20ERROR\x20===','now','13nlukjE','Payment\x20URL\x20(original):','apiUrl','Confirmed\x20On:','Parsed\x20Result:','Error\x20Message:','60193bnysnq','üè¶\x20Payment\x20Detail:','&alternative=false','Payment\x20Status:','created','text','Amount','URL:','Business\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','QRCodeURL','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error'];a65_0x58c3=function(){return _0x45fd82;};return a65_0x58c3();}