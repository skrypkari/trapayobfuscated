'use strict';function a43_0x5ac6(_0x101f1c,_0x182491){const _0x11be26=a43_0x11be();return a43_0x5ac6=function(_0x5ac69c,_0x24b134){_0x5ac69c=_0x5ac69c-0x117;let _0x45d999=_0x11be26[_0x5ac69c];return _0x45d999;},a43_0x5ac6(_0x101f1c,_0x182491);}const a43_0x17fe61=a43_0x5ac6;(function(_0x1a1988,_0x410964){const _0xe4182c=a43_0x5ac6,_0xa445f8=_0x1a1988();while(!![]){try{const _0x151e7c=parseInt(_0xe4182c(0x18c))/0x1+parseInt(_0xe4182c(0x145))/0x2+parseInt(_0xe4182c(0x16a))/0x3*(-parseInt(_0xe4182c(0x16e))/0x4)+-parseInt(_0xe4182c(0x18a))/0x5*(parseInt(_0xe4182c(0x18b))/0x6)+parseInt(_0xe4182c(0x162))/0x7+parseInt(_0xe4182c(0x166))/0x8+parseInt(_0xe4182c(0x17e))/0x9*(-parseInt(_0xe4182c(0x199))/0xa);if(_0x151e7c===_0x410964)break;else _0xa445f8['push'](_0xa445f8['shift']());}catch(_0x1eb029){_0xa445f8['push'](_0xa445f8['shift']());}}}(a43_0x11be,0x6f42e));Object['defineProperty'](exports,a43_0x17fe61(0x12f),{'value':!![]}),exports[a43_0x17fe61(0x197)]=void 0x0;const loggerService_1=require(a43_0x17fe61(0x11f));class CoinToPayService{constructor(){const _0xa0a33d=a43_0x17fe61;this['apiUrl']=_0xa0a33d(0x167),this[_0xa0a33d(0x14b)]=_0xa0a33d(0x198),console['log'](_0xa0a33d(0x13f)),console[_0xa0a33d(0x157)](_0xa0a33d(0x181),this[_0xa0a33d(0x14b)]);}async['createPaymentLink'](_0x5c8334){const _0x5c34d7=a43_0x17fe61,{orderId:_0x526e41,amount:_0x1a305b}=_0x5c8334;console[_0x5c34d7(0x157)](_0x5c34d7(0x130)+_0x1a305b+'\x20EUR');const _0xb79e4a={'amount':_0x1a305b},_0xb04b6a=Date[_0x5c34d7(0x13e)]();try{console[_0x5c34d7(0x157)](_0x5c34d7(0x12c)),console['log'](_0x5c34d7(0x149),this['apiUrl']),console['log'](_0x5c34d7(0x187),JSON['stringify'](_0xb79e4a,null,0x2)),console['log'](_0x5c34d7(0x136),_0x1a305b,_0x5c34d7(0x160)),loggerService_1[_0x5c34d7(0x180)][_0x5c34d7(0x193)](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x5c34d7(0x13b),_0xb79e4a);const _0x54a767=await fetch(this['apiUrl'],{'method':_0x5c34d7(0x13b),'headers':{'Content-Type':_0x5c34d7(0x17b),'Accept':_0x5c34d7(0x17b),'User-Agent':_0x5c34d7(0x123)},'body':JSON['stringify'](_0xb79e4a)}),_0x310157=Date['now']()-_0xb04b6a;console[_0x5c34d7(0x157)](_0x5c34d7(0x15f)),console[_0x5c34d7(0x157)]('Status:',_0x54a767[_0x5c34d7(0x140)]),console[_0x5c34d7(0x157)]('Status\x20Text:',_0x54a767[_0x5c34d7(0x182)]),console[_0x5c34d7(0x157)](_0x5c34d7(0x137),Object[_0x5c34d7(0x11c)](_0x54a767['headers'][_0x5c34d7(0x12b)]())),console[_0x5c34d7(0x157)](_0x5c34d7(0x119),_0x310157+'ms');const _0x4f71ba=await _0x54a767['text']();console[_0x5c34d7(0x157)](_0x5c34d7(0x125),_0x4f71ba);if(!_0x54a767['ok']){console[_0x5c34d7(0x118)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x5c34d7(0x118)](_0x5c34d7(0x14d),_0x54a767[_0x5c34d7(0x140)]),console[_0x5c34d7(0x118)](_0x5c34d7(0x144),_0x4f71ba),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x54a767[_0x5c34d7(0x140)],_0x4f71ba,_0x310157),loggerService_1['loggerService'][_0x5c34d7(0x139)](_0x5c34d7(0x176),_0x5c34d7(0x15b),'HTTP\x20'+_0x54a767[_0x5c34d7(0x140)]+':\x20'+_0x4f71ba);throw new Error('HTTP\x20error!\x20status:\x20'+_0x54a767[_0x5c34d7(0x140)]+_0x5c34d7(0x14f)+_0x4f71ba);}let _0x1cabfc;try{_0x1cabfc=JSON[_0x5c34d7(0x146)](_0x4f71ba);}catch(_0x2a4f66){console[_0x5c34d7(0x118)](_0x5c34d7(0x173),_0x2a4f66),loggerService_1['loggerService'][_0x5c34d7(0x139)](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x5c34d7(0x158)+_0x2a4f66);throw new Error(_0x5c34d7(0x151)+_0x4f71ba);}console['log'](_0x5c34d7(0x16c)),console[_0x5c34d7(0x157)](_0x5c34d7(0x11a),JSON[_0x5c34d7(0x178)](_0x1cabfc,null,0x2)),loggerService_1[_0x5c34d7(0x180)]['logWhiteDomainResponse'](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x54a767['status'],_0x1cabfc,_0x310157);if(_0x1cabfc['error']){const _0x4a0e15=_0x1cabfc[_0x5c34d7(0x11b)]||_0x1cabfc[_0x5c34d7(0x118)]||_0x5c34d7(0x17d);console[_0x5c34d7(0x118)](_0x5c34d7(0x164)),console[_0x5c34d7(0x118)](_0x5c34d7(0x135),_0x4a0e15),loggerService_1['loggerService'][_0x5c34d7(0x139)](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x5c34d7(0x186)+_0x4a0e15);throw new Error(_0x5c34d7(0x17c)+_0x4a0e15);}if(!_0x1cabfc[_0x5c34d7(0x121)]||!_0x1cabfc[_0x5c34d7(0x153)]){console['error'](_0x5c34d7(0x148)),console[_0x5c34d7(0x118)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x1cabfc),loggerService_1[_0x5c34d7(0x180)][_0x5c34d7(0x139)]('cointopay',_0x5c34d7(0x15b),_0x5c34d7(0x147));throw new Error(_0x5c34d7(0x190));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x5c34d7(0x17f),_0x1cabfc['gateway_payment_id']),console['log'](_0x5c34d7(0x13d),_0x1cabfc[_0x5c34d7(0x121)]),console[_0x5c34d7(0x157)]('Amount:',_0x1a305b,'EUR'),{'gateway_payment_id':_0x1cabfc[_0x5c34d7(0x153)],'payment_url':_0x1cabfc['payment_url']};}catch(_0x1caf0e){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x5c34d7(0x118)]('Error\x20details:',_0x1caf0e),loggerService_1[_0x5c34d7(0x180)][_0x5c34d7(0x139)](_0x5c34d7(0x176),_0x5c34d7(0x15b),_0x1caf0e);if(_0x1caf0e instanceof Error){console[_0x5c34d7(0x118)](_0x5c34d7(0x154),_0x1caf0e[_0x5c34d7(0x11b)]),console[_0x5c34d7(0x118)]('Error\x20stack:',_0x1caf0e[_0x5c34d7(0x155)]);throw new Error(_0x5c34d7(0x192)+_0x1caf0e[_0x5c34d7(0x11b)]);}throw new Error(_0x5c34d7(0x18d));}}async['checkPaymentStatus'](_0x18d3bc){const _0x4d0934=a43_0x17fe61,_0x498b6e=Date[_0x4d0934(0x13e)]();try{console[_0x4d0934(0x157)](_0x4d0934(0x191)+_0x18d3bc);const _0x154585={'gatewayPaymentId':_0x18d3bc};loggerService_1[_0x4d0934(0x180)][_0x4d0934(0x193)](_0x4d0934(0x176),_0x4d0934(0x189),'POST',_0x154585);const _0x286482=await fetch(this[_0x4d0934(0x14b)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x4d0934(0x17b),'User-Agent':_0x4d0934(0x123)},'body':JSON['stringify'](_0x154585)}),_0x1544f3=Date['now']()-_0x498b6e;console[_0x4d0934(0x157)](_0x4d0934(0x196)),console['log'](_0x4d0934(0x13a),_0x286482['status']),console[_0x4d0934(0x157)](_0x4d0934(0x119),_0x1544f3+'ms');if(!_0x286482['ok']){const _0x3a47a2=await _0x286482[_0x4d0934(0x165)]();console[_0x4d0934(0x118)]('HTTP\x20Status:',_0x286482[_0x4d0934(0x140)]),console[_0x4d0934(0x118)]('Response\x20Body:',_0x3a47a2),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4d0934(0x176),'/status',_0x286482[_0x4d0934(0x140)],_0x3a47a2,_0x1544f3),loggerService_1[_0x4d0934(0x180)][_0x4d0934(0x139)](_0x4d0934(0x176),_0x4d0934(0x189),_0x4d0934(0x134)+_0x286482[_0x4d0934(0x140)]+':\x20'+_0x3a47a2);throw new Error(_0x4d0934(0x12a)+_0x286482[_0x4d0934(0x140)]);}const _0x49b735=await _0x286482[_0x4d0934(0x165)]();console[_0x4d0934(0x157)](_0x4d0934(0x125),_0x49b735);let _0x239cea;try{_0x239cea=JSON[_0x4d0934(0x146)](_0x49b735);}catch(_0x4dadf3){console['error'](_0x4d0934(0x173),_0x4dadf3),loggerService_1[_0x4d0934(0x180)]['logWhiteDomainError'](_0x4d0934(0x176),_0x4d0934(0x189),_0x4d0934(0x158)+_0x4dadf3);throw new Error(_0x4d0934(0x18e)+_0x49b735);}loggerService_1[_0x4d0934(0x180)][_0x4d0934(0x159)](_0x4d0934(0x176),_0x4d0934(0x189),_0x286482[_0x4d0934(0x140)],_0x239cea,_0x1544f3),console[_0x4d0934(0x157)](_0x4d0934(0x132)),console[_0x4d0934(0x157)]('Result:',_0x239cea['result']),console[_0x4d0934(0x157)](_0x4d0934(0x168),_0x239cea[_0x4d0934(0x156)]),console['log'](_0x4d0934(0x152),_0x239cea['data']?.['Status']),console[_0x4d0934(0x157)](_0x4d0934(0x136),_0x239cea[_0x4d0934(0x188)]?.[_0x4d0934(0x124)]),console[_0x4d0934(0x157)](_0x4d0934(0x179),_0x239cea[_0x4d0934(0x188)]?.[_0x4d0934(0x14c)]);if(_0x239cea[_0x4d0934(0x184)]!==_0x4d0934(0x15e)||_0x239cea[_0x4d0934(0x156)]!==0xc8){const _0x190838=_0x239cea['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x4d0934(0x19a)),console[_0x4d0934(0x118)](_0x4d0934(0x135),_0x190838),loggerService_1['loggerService'][_0x4d0934(0x139)]('cointopay',_0x4d0934(0x189),_0x4d0934(0x12e)+_0x190838);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x190838);}if(!_0x239cea[_0x4d0934(0x188)]){console[_0x4d0934(0x118)](_0x4d0934(0x15a)),console[_0x4d0934(0x118)](_0x4d0934(0x163)),loggerService_1[_0x4d0934(0x180)][_0x4d0934(0x139)](_0x4d0934(0x176),_0x4d0934(0x189),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x4d0934(0x169));}let _0x10d4d3=_0x4d0934(0x129);switch(_0x239cea[_0x4d0934(0x188)]['Status']?.['toLowerCase']()){case _0x4d0934(0x194):_0x10d4d3=_0x4d0934(0x170);break;case'cancelled':case _0x4d0934(0x18f):case _0x4d0934(0x118):_0x10d4d3=_0x4d0934(0x175);break;case'expired':case _0x4d0934(0x14e):_0x10d4d3=_0x4d0934(0x131);break;case _0x4d0934(0x16f):case _0x4d0934(0x195):case'pending':case _0x4d0934(0x120):default:_0x10d4d3='PENDING';break;}let _0x13afab,_0x5c8a27;if(_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x133)]){const _0x406a50=_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x133)];console['log']('🏦\x20Payment\x20Detail:',_0x406a50);const _0x3b489e=_0x406a50[_0x4d0934(0x141)](/IBAN\s+([A-Z0-9]+)/i);_0x3b489e&&(_0x13afab=_0x3b489e[0x1],console[_0x4d0934(0x157)](_0x4d0934(0x15d),_0x13afab)),_0x5c8a27=_0x406a50;}const _0x580939={'iban':_0x13afab,'bankDetails':_0x5c8a27,'transactionId':_0x239cea[_0x4d0934(0x188)]['TransactionID'],'coinAddress':_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x174)],'qrCodeUrl':_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x16d)],'expiryTime':_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x138)],'createdOn':_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x185)],'confirmedOn':_0x239cea['data'][_0x4d0934(0x122)]};console[_0x4d0934(0x157)](_0x4d0934(0x143)),console[_0x4d0934(0x157)]('Status:',_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x128)],'->',_0x10d4d3),console['log'](_0x4d0934(0x136),_0x239cea['data'][_0x4d0934(0x124)],_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x14c)]),console[_0x4d0934(0x157)](_0x4d0934(0x183),_0x239cea[_0x4d0934(0x188)]['TransactionID']),console['log'](_0x4d0934(0x13c),_0x13afab||'not\x20found'),console[_0x4d0934(0x157)]('Created\x20On:',_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x185)]),console[_0x4d0934(0x157)](_0x4d0934(0x127),_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x122)]||'not\x20confirmed');if(_0x239cea['data'][_0x4d0934(0x128)]?.[_0x4d0934(0x15c)]()===_0x4d0934(0x195))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x239cea['data'][_0x4d0934(0x128)]?.[_0x4d0934(0x15c)]()==='paid'&&console['log'](_0x4d0934(0x11e));return{'status':_0x10d4d3,'amount':parseFloat(_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x124)])||undefined,'currency':_0x239cea[_0x4d0934(0x188)][_0x4d0934(0x14c)]||_0x4d0934(0x17a),'paymentDetails':_0x580939};}catch(_0x47f59f){console['error'](_0x4d0934(0x16b),_0x47f59f),loggerService_1['loggerService'][_0x4d0934(0x139)](_0x4d0934(0x176),'/status',_0x47f59f);throw new Error(_0x4d0934(0x177)+(_0x47f59f instanceof Error?_0x47f59f[_0x4d0934(0x11b)]:_0x4d0934(0x11d)));}}async[a43_0x17fe61(0x172)](_0x32e471){const _0x2b33c2=a43_0x17fe61,_0xf45822=await this[_0x2b33c2(0x150)](_0x32e471);return{'status':_0xf45822[_0x2b33c2(0x140)],'amount':_0xf45822[_0x2b33c2(0x12d)],'currency':_0xf45822[_0x2b33c2(0x117)]};}async['processWebhook'](_0x549435){const _0x58a4a6=a43_0x17fe61;console[_0x58a4a6(0x157)](_0x58a4a6(0x171),_0x549435);let _0x1e37ee=_0x58a4a6(0x129);switch(_0x549435[_0x58a4a6(0x140)]?.[_0x58a4a6(0x15c)]()){case'paid':_0x1e37ee=_0x58a4a6(0x170);break;case'cancelled':case _0x58a4a6(0x18f):case _0x58a4a6(0x118):_0x1e37ee=_0x58a4a6(0x175);break;case _0x58a4a6(0x126):case _0x58a4a6(0x14e):_0x1e37ee=_0x58a4a6(0x131);break;case _0x58a4a6(0x14a):case _0x58a4a6(0x16f):case _0x58a4a6(0x195):case _0x58a4a6(0x120):default:_0x1e37ee=_0x58a4a6(0x129);break;}return{'paymentId':_0x549435[_0x58a4a6(0x142)]||_0x549435[_0x58a4a6(0x161)]||'','status':_0x1e37ee,'amount':_0x549435[_0x58a4a6(0x12d)],'currency':_0x549435[_0x58a4a6(0x117)]||_0x58a4a6(0x17a)};}}function a43_0x11be(){const _0x23a513=['PaymentDetail','HTTP\x20','Error\x20Message:','Amount:','Headers:','ExpiryTime','logWhiteDomainError','Status:','POST','IBAN:','Payment\x20URL:','now','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status','match','order_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Response\x20Body:','1117474vQYwBA','parse','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','URL:','pending','statusUrl','inputCurrency','HTTP\x20Status:','timeout',',\x20body:\x20','checkPaymentStatus','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Payment\x20Status:','gateway_payment_id','Error\x20message:','stack','status_code','log','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/create','toLowerCase','🏦\x20Extracted\x20IBAN:','success','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','merchant_reference_id','5370498gxOeWU','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','text','5915184HhrpWu','https://tesoft.uk/gateway/cointopay/','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','3yvxCtU','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','QRCodeURL','2072856FWHyYP','waiting','PAID','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','verifyPayment','Failed\x20to\x20parse\x20JSON\x20response:','coinAddress','FAILED','cointopay','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','stringify','Currency:','EUR','application/json','CoinToPay\x20API\x20error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','63dsWLCr','Gateway\x20Payment\x20ID:','loggerService','📊\x20Status\x20check\x20URL:','statusText','Transaction\x20ID:','result','CreatedOn','Business\x20Error:\x20','Request\x20Body:','data','/status','453345ozdWIu','36rGboLr','343936fEQxmY','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','failed','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainRequest','paid','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPayService','https://tesoft.uk/gateway/cointopay/status.php','1273330EOvHEh','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','currency','error','Response\x20Time:','Parsed\x20Result:','message','fromEntries','Unknown\x20error','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','../loggerService','created','payment_url','TransactionConfirmedOn','TesSoft\x20Payment\x20System/1.0','Amount','Raw\x20Response\x20Body:','expired','Confirmed\x20On:','Status','PENDING','HTTP\x20error!\x20status:\x20','entries','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','amount','Status\x20API\x20Error:\x20','__esModule','🪙\x20Creating\x20CoinToPay\x20payment:\x20','EXPIRED','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='];a43_0x11be=function(){return _0x23a513;};return a43_0x11be();}exports[a43_0x17fe61(0x197)]=CoinToPayService;