'use strict';const a40_0x546b46=a40_0x5789;(function(_0xde32ee,_0x3b01a9){const _0x23aa82=a40_0x5789,_0x20a6c1=_0xde32ee();while(!![]){try{const _0x4b7c43=parseInt(_0x23aa82(0xbc))/0x1*(parseInt(_0x23aa82(0x9e))/0x2)+-parseInt(_0x23aa82(0x126))/0x3*(-parseInt(_0x23aa82(0xcc))/0x4)+-parseInt(_0x23aa82(0xd9))/0x5+-parseInt(_0x23aa82(0xa3))/0x6*(parseInt(_0x23aa82(0xa9))/0x7)+parseInt(_0x23aa82(0xc0))/0x8+-parseInt(_0x23aa82(0xb8))/0x9*(-parseInt(_0x23aa82(0xb4))/0xa)+parseInt(_0x23aa82(0xb6))/0xb*(-parseInt(_0x23aa82(0x107))/0xc);if(_0x4b7c43===_0x3b01a9)break;else _0x20a6c1['push'](_0x20a6c1['shift']());}catch(_0x413fe2){_0x20a6c1['push'](_0x20a6c1['shift']());}}}(a40_0x1ff5,0x53049));Object[a40_0x546b46(0xb3)](exports,a40_0x546b46(0xc3),{'value':!![]}),exports[a40_0x546b46(0x118)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0xf3ac74=a40_0x546b46;this[_0xf3ac74(0xaa)]=_0xf3ac74(0x109),this['statusUrl']=_0xf3ac74(0x102),console[_0xf3ac74(0xa4)](_0xf3ac74(0xe3)),console[_0xf3ac74(0xa4)](_0xf3ac74(0xc2),this['statusUrl']);}async[a40_0x546b46(0xd0)](_0x411e35){const _0x4b8f91=a40_0x546b46,{orderId:_0x59598c,amount:_0x17d554}=_0x411e35;console['log'](_0x4b8f91(0xd5)+_0x17d554+_0x4b8f91(0xc1));const _0x3b3695={'amount':_0x17d554},_0x38f473=Date[_0x4b8f91(0xe8)]();try{console[_0x4b8f91(0xa4)](_0x4b8f91(0xef)),console[_0x4b8f91(0xa4)]('URL:',this['apiUrl']),console['log'](_0x4b8f91(0x124),JSON[_0x4b8f91(0xac)](_0x3b3695,null,0x2)),console[_0x4b8f91(0xa4)](_0x4b8f91(0x115),_0x17d554,_0x4b8f91(0x9f)),loggerService_1[_0x4b8f91(0xd1)][_0x4b8f91(0xf7)]('cointopay',_0x4b8f91(0xeb),_0x4b8f91(0xb5),_0x3b3695);const _0x319dac=await fetch(this[_0x4b8f91(0xaa)],{'method':_0x4b8f91(0xb5),'headers':{'Content-Type':'application/json','Accept':_0x4b8f91(0x11f),'User-Agent':_0x4b8f91(0x121)},'body':JSON[_0x4b8f91(0xac)](_0x3b3695)}),_0xe14410=Date['now']()-_0x38f473;console['log'](_0x4b8f91(0xf0)),console['log'](_0x4b8f91(0xee),_0x319dac[_0x4b8f91(0x117)]),console[_0x4b8f91(0xa4)](_0x4b8f91(0xea),_0x319dac[_0x4b8f91(0xa1)]),console['log'](_0x4b8f91(0xe6),Object[_0x4b8f91(0x10c)](_0x319dac[_0x4b8f91(0xda)][_0x4b8f91(0xc6)]())),console[_0x4b8f91(0xa4)](_0x4b8f91(0xcb),_0xe14410+'ms');const _0x44ff69=await _0x319dac[_0x4b8f91(0xe2)]();console['log']('Raw\x20Response\x20Body:',_0x44ff69);if(!_0x319dac['ok']){console[_0x4b8f91(0x110)](_0x4b8f91(0xec)),console[_0x4b8f91(0x110)](_0x4b8f91(0x11b),_0x319dac[_0x4b8f91(0x117)]),console[_0x4b8f91(0x110)](_0x4b8f91(0x112),_0x44ff69),loggerService_1[_0x4b8f91(0xd1)][_0x4b8f91(0xb7)]('cointopay',_0x4b8f91(0xeb),_0x319dac['status'],_0x44ff69,_0xe14410),loggerService_1[_0x4b8f91(0xd1)]['logWhiteDomainError'](_0x4b8f91(0xbb),'/create','HTTP\x20'+_0x319dac['status']+':\x20'+_0x44ff69);throw new Error('HTTP\x20error!\x20status:\x20'+_0x319dac[_0x4b8f91(0x117)]+_0x4b8f91(0x123)+_0x44ff69);}let _0x2e53c8;try{_0x2e53c8=JSON[_0x4b8f91(0xdd)](_0x44ff69);}catch(_0x1e5051){console[_0x4b8f91(0x110)](_0x4b8f91(0x125),_0x1e5051),loggerService_1[_0x4b8f91(0xd1)]['logWhiteDomainError'](_0x4b8f91(0xbb),_0x4b8f91(0xeb),_0x4b8f91(0xf8)+_0x1e5051);throw new Error(_0x4b8f91(0xae)+_0x44ff69);}console[_0x4b8f91(0xa4)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x4b8f91(0xa4)]('Parsed\x20Result:',JSON['stringify'](_0x2e53c8,null,0x2)),loggerService_1[_0x4b8f91(0xd1)][_0x4b8f91(0xb7)](_0x4b8f91(0xbb),_0x4b8f91(0xeb),_0x319dac['status'],_0x2e53c8,_0xe14410);if(_0x2e53c8[_0x4b8f91(0x110)]){const _0x2f9614=_0x2e53c8['message']||_0x2e53c8['error']||_0x4b8f91(0xc4);console['error'](_0x4b8f91(0x116)),console[_0x4b8f91(0x110)](_0x4b8f91(0xf9),_0x2f9614),loggerService_1[_0x4b8f91(0xd1)]['logWhiteDomainError'](_0x4b8f91(0xbb),_0x4b8f91(0xeb),'Business\x20Error:\x20'+_0x2f9614);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x2f9614);}if(!_0x2e53c8[_0x4b8f91(0xdc)]||!_0x2e53c8[_0x4b8f91(0xf3)]){console['error'](_0x4b8f91(0xa8)),console['error'](_0x4b8f91(0xc7)),console[_0x4b8f91(0x110)](_0x4b8f91(0xa0),_0x2e53c8),loggerService_1[_0x4b8f91(0xd1)][_0x4b8f91(0xc8)](_0x4b8f91(0xbb),_0x4b8f91(0xeb),_0x4b8f91(0xe1));throw new Error(_0x4b8f91(0x106));}return console['log'](_0x4b8f91(0xa5)),console['log'](_0x4b8f91(0x11d),_0x2e53c8['gateway_payment_id']),console['log'](_0x4b8f91(0xb1),_0x2e53c8[_0x4b8f91(0xdc)]),console[_0x4b8f91(0xa4)](_0x4b8f91(0x115),_0x17d554,_0x4b8f91(0x103)),{'gateway_payment_id':_0x2e53c8[_0x4b8f91(0xf3)],'payment_url':_0x2e53c8[_0x4b8f91(0xdc)]};}catch(_0x1573bf){console[_0x4b8f91(0x110)](_0x4b8f91(0xe9)),console['error']('Error\x20details:',_0x1573bf),loggerService_1['loggerService'][_0x4b8f91(0xc8)]('cointopay',_0x4b8f91(0xeb),_0x1573bf);if(_0x1573bf instanceof Error){console[_0x4b8f91(0x110)](_0x4b8f91(0x11c),_0x1573bf['message']),console[_0x4b8f91(0x110)]('Error\x20stack:',_0x1573bf[_0x4b8f91(0xd3)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x1573bf['message']);}throw new Error(_0x4b8f91(0xbe));}}async['checkPaymentStatus'](_0x47d39e){const _0x9a5d6f=a40_0x546b46,_0x24dc5b=Date[_0x9a5d6f(0xe8)]();try{console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xed)+_0x47d39e);const _0x188718={'gatewayPaymentId':_0x47d39e};loggerService_1[_0x9a5d6f(0xd1)][_0x9a5d6f(0xf7)]('cointopay',_0x9a5d6f(0x120),_0x9a5d6f(0xb5),_0x188718);const _0x19a9e1=await fetch(this['statusUrl'],{'method':_0x9a5d6f(0xb5),'headers':{'Content-Type':'application/json','Accept':_0x9a5d6f(0x11f),'User-Agent':_0x9a5d6f(0x121)},'body':JSON[_0x9a5d6f(0xac)](_0x188718)}),_0x433156=Date[_0x9a5d6f(0xe8)]()-_0x24dc5b;console[_0x9a5d6f(0xa4)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xee),_0x19a9e1[_0x9a5d6f(0x117)]),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xcb),_0x433156+'ms');if(!_0x19a9e1['ok']){const _0x22df2e=await _0x19a9e1[_0x9a5d6f(0xe2)]();console['error'](_0x9a5d6f(0x11b),_0x19a9e1[_0x9a5d6f(0x117)]),console[_0x9a5d6f(0x110)]('Response\x20Body:',_0x22df2e),loggerService_1[_0x9a5d6f(0xd1)][_0x9a5d6f(0xb7)](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x19a9e1['status'],_0x22df2e,_0x433156),loggerService_1[_0x9a5d6f(0xd1)][_0x9a5d6f(0xc8)](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x9a5d6f(0xb0)+_0x19a9e1[_0x9a5d6f(0x117)]+':\x20'+_0x22df2e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x19a9e1[_0x9a5d6f(0x117)]);}const _0x40d99f=await _0x19a9e1['text']();console[_0x9a5d6f(0xa4)](_0x9a5d6f(0x11a),_0x40d99f);let _0x327586;try{_0x327586=JSON[_0x9a5d6f(0xdd)](_0x40d99f);}catch(_0x168212){console[_0x9a5d6f(0x110)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x168212),loggerService_1[_0x9a5d6f(0xd1)]['logWhiteDomainError'](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),'JSON\x20Parse\x20Error:\x20'+_0x168212);throw new Error(_0x9a5d6f(0x10e)+_0x40d99f);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x19a9e1[_0x9a5d6f(0x117)],_0x327586,_0x433156),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xad)),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0x101),_0x327586[_0x9a5d6f(0x104)]),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0x111),_0x327586[_0x9a5d6f(0xbd)]),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xb2),_0x327586[_0x9a5d6f(0xdf)]?.[_0x9a5d6f(0xf2)]),console['log'](_0x9a5d6f(0x115),_0x327586[_0x9a5d6f(0xdf)]?.[_0x9a5d6f(0xa2)]),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xba),_0x327586[_0x9a5d6f(0xdf)]?.[_0x9a5d6f(0xff)]);if(_0x327586[_0x9a5d6f(0x104)]!==_0x9a5d6f(0x113)||_0x327586[_0x9a5d6f(0xbd)]!==0xc8){const _0x3528f0=_0x327586[_0x9a5d6f(0xf5)]||_0x9a5d6f(0xc9);console[_0x9a5d6f(0x110)](_0x9a5d6f(0xd4)),console[_0x9a5d6f(0x110)](_0x9a5d6f(0xf9),_0x3528f0),loggerService_1['loggerService']['logWhiteDomainError'](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x9a5d6f(0x100)+_0x3528f0);throw new Error(_0x9a5d6f(0xe7)+_0x3528f0);}if(!_0x327586[_0x9a5d6f(0xdf)]){console['error'](_0x9a5d6f(0x10d)),console['error'](_0x9a5d6f(0x10a)),loggerService_1['loggerService'][_0x9a5d6f(0xc8)](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x9a5d6f(0x10b));throw new Error(_0x9a5d6f(0xd8));}let _0x5acbe5='PENDING';switch(_0x327586['data']['Status']?.[_0x9a5d6f(0xca)]()){case _0x9a5d6f(0xf6):_0x5acbe5=_0x9a5d6f(0xe4);break;case _0x9a5d6f(0x114):case _0x9a5d6f(0xe0):case _0x9a5d6f(0x110):_0x5acbe5=_0x9a5d6f(0x108);break;case _0x9a5d6f(0xd2):case _0x9a5d6f(0x119):_0x5acbe5='EXPIRED';break;case'waiting':case _0x9a5d6f(0xc5):case _0x9a5d6f(0xaf):case _0x9a5d6f(0xfa):default:_0x5acbe5=_0x9a5d6f(0x122);break;}let _0xb01d9e,_0x4e7639;if(_0x327586[_0x9a5d6f(0xdf)]['PaymentDetail']){const _0x15c662=_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xd7)];console['log']('🏦\x20Payment\x20Detail:',_0x15c662);const _0x416b2e=_0x15c662[_0x9a5d6f(0xf4)](/IBAN\s+([A-Z0-9]+)/i);_0x416b2e&&(_0xb01d9e=_0x416b2e[0x1],console[_0x9a5d6f(0xa4)](_0x9a5d6f(0x10f),_0xb01d9e)),_0x4e7639=_0x15c662;}const _0x1a4e37={'iban':_0xb01d9e,'bankDetails':_0x4e7639,'transactionId':_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0x105)],'coinAddress':_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xa6)],'qrCodeUrl':_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xfd)],'expiryTime':_0x327586['data'][_0x9a5d6f(0xa7)],'createdOn':_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xde)],'confirmedOn':_0x327586[_0x9a5d6f(0xdf)]['TransactionConfirmedOn']};console[_0x9a5d6f(0xa4)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xee),_0x327586['data'][_0x9a5d6f(0xf2)],'->',_0x5acbe5),console[_0x9a5d6f(0xa4)](_0x9a5d6f(0x115),_0x327586['data'][_0x9a5d6f(0xa2)],_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xff)]),console['log'](_0x9a5d6f(0xfc),_0x327586['data'][_0x9a5d6f(0x105)]),console[_0x9a5d6f(0xa4)]('IBAN:',_0xb01d9e||_0x9a5d6f(0xab)),console['log']('Created\x20On:',_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xde)]),console[_0x9a5d6f(0xa4)]('Confirmed\x20On:',_0x327586[_0x9a5d6f(0xdf)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x327586[_0x9a5d6f(0xdf)]['Status']?.[_0x9a5d6f(0xca)]()==='awaiting\x20fiat')console['log'](_0x9a5d6f(0xb9));else _0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xf2)]?.[_0x9a5d6f(0xca)]()==='paid'&&console[_0x9a5d6f(0xa4)](_0x9a5d6f(0xcd));return{'status':_0x5acbe5,'amount':parseFloat(_0x327586[_0x9a5d6f(0xdf)]['Amount'])||undefined,'currency':_0x327586[_0x9a5d6f(0xdf)][_0x9a5d6f(0xff)]||_0x9a5d6f(0x103),'paymentDetails':_0x1a4e37};}catch(_0x18584d){console[_0x9a5d6f(0x110)](_0x9a5d6f(0xce),_0x18584d),loggerService_1['loggerService'][_0x9a5d6f(0xc8)](_0x9a5d6f(0xbb),_0x9a5d6f(0x120),_0x18584d);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x18584d instanceof Error?_0x18584d['message']:_0x9a5d6f(0xbf)));}}async[a40_0x546b46(0xd6)](_0xd5bea2){const _0x12dbba=a40_0x546b46,_0x2a4e03=await this[_0x12dbba(0xfe)](_0xd5bea2);return{'status':_0x2a4e03[_0x12dbba(0x117)],'amount':_0x2a4e03[_0x12dbba(0x11e)],'currency':_0x2a4e03[_0x12dbba(0xcf)]};}async['processWebhook'](_0x1085d2){const _0x46cae8=a40_0x546b46;console[_0x46cae8(0xa4)](_0x46cae8(0xf1),_0x1085d2);let _0x12129f=_0x46cae8(0x122);switch(_0x1085d2[_0x46cae8(0x117)]?.[_0x46cae8(0xca)]()){case _0x46cae8(0xf6):_0x12129f=_0x46cae8(0xe4);break;case _0x46cae8(0x114):case _0x46cae8(0xe0):case _0x46cae8(0x110):_0x12129f='FAILED';break;case _0x46cae8(0xd2):case _0x46cae8(0x119):_0x12129f=_0x46cae8(0xe5);break;case'pending':case _0x46cae8(0xdb):case _0x46cae8(0xc5):case _0x46cae8(0xfa):default:_0x12129f=_0x46cae8(0x122);break;}return{'paymentId':_0x1085d2['order_id']||_0x1085d2[_0x46cae8(0xfb)]||'','status':_0x12129f,'amount':_0x1085d2[_0x46cae8(0x11e)],'currency':_0x1085d2[_0x46cae8(0xcf)]||_0x46cae8(0x103)};}}function a40_0x5789(_0x2940ac,_0x5142fd){const _0x1ff520=a40_0x1ff5();return a40_0x5789=function(_0x5789b8,_0x50f0c5){_0x5789b8=_0x5789b8-0x9e;let _0x16fb16=_0x1ff520[_0x5789b8];return _0x16fb16;},a40_0x5789(_0x2940ac,_0x5142fd);}exports[a40_0x546b46(0x118)]=CoinToPayService;function a40_0x1ff5(){const _0x4ebdac=['/status','TesSoft\x20Payment\x20System/1.0','PENDING',',\x20body:\x20','Request\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','216aNznbJ','338LzsUGc','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20data:','statusText','Amount','652818ZKpRsb','log','===\x20COINTOPAY\x20SUCCESS\x20===','coinAddress','ExpiryTime','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','7rbsQTC','apiUrl','not\x20found','stringify','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','pending','HTTP\x20','Payment\x20URL:','Payment\x20Status:','defineProperty','471610EtFkJQ','POST','44FZykLt','logWhiteDomainResponse','63VbIiqR','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Currency:','cointopay','124mUnAWf','status_code','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error','27864XbAqhY','\x20EUR','📊\x20Status\x20check\x20URL:','__esModule','Unknown\x20error\x20from\x20CoinToPay\x20API','awaiting\x20fiat','entries','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainError','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','toLowerCase','Response\x20Time:','32924xapzYh','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay\x20payment\x20status\x20check\x20error:','currency','createPaymentLink','loggerService','expired','stack','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','🪙\x20Creating\x20CoinToPay\x20payment:\x20','verifyPayment','PaymentDetail','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','2268590IMLakh','headers','waiting','payment_url','parse','CreatedOn','data','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','text','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAID','EXPIRED','Headers:','CoinToPay\x20status\x20API\x20error:\x20','now','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Status\x20Text:','/create','===\x20COINTOPAY\x20API\x20ERROR\x20===','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status','gateway_payment_id','match','message','paid','logWhiteDomainRequest','JSON\x20Parse\x20Error:\x20','Error\x20Message:','created','merchant_reference_id','Transaction\x20ID:','QRCodeURL','checkPaymentStatus','inputCurrency','Status\x20API\x20Error:\x20','Result:','https://tesoft.uk/gateway/cointopay/status.php','EUR','result','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','133908GKGWuA','FAILED','https://tesoft.uk/gateway/cointopay/','Missing\x20data\x20in\x20response','Incomplete\x20response:\x20missing\x20data','fromEntries','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','🏦\x20Extracted\x20IBAN:','error','Status\x20Code:','Response\x20Body:','success','cancelled','Amount:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','status','CoinToPayService','timeout','Raw\x20Response\x20Body:','HTTP\x20Status:','Error\x20message:','Gateway\x20Payment\x20ID:','amount','application/json'];a40_0x1ff5=function(){return _0x4ebdac;};return a40_0x1ff5();}