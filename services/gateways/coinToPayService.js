'use strict';function a57_0x15dc(_0x496829,_0x2f0147){_0x496829=_0x496829-0x1b7;const _0x8100ba=a57_0x8100();let _0x15dcc8=_0x8100ba[_0x496829];return _0x15dcc8;}const a57_0x182366=a57_0x15dc;(function(_0x2335cd,_0x3fe4ed){const _0x2906c3=a57_0x15dc,_0x4c3955=_0x2335cd();while(!![]){try{const _0x335c35=parseInt(_0x2906c3(0x1ec))/0x1+parseInt(_0x2906c3(0x1d3))/0x2+-parseInt(_0x2906c3(0x215))/0x3+parseInt(_0x2906c3(0x22d))/0x4+-parseInt(_0x2906c3(0x204))/0x5*(-parseInt(_0x2906c3(0x1f6))/0x6)+parseInt(_0x2906c3(0x1f2))/0x7*(parseInt(_0x2906c3(0x22e))/0x8)+parseInt(_0x2906c3(0x1f1))/0x9;if(_0x335c35===_0x3fe4ed)break;else _0x4c3955['push'](_0x4c3955['shift']());}catch(_0x300dc1){_0x4c3955['push'](_0x4c3955['shift']());}}}(a57_0x8100,0x4bc8a));function a57_0x8100(){const _0x57a058=['loggerService','Incomplete\x20response:\x20missing\x20data','\x20EUR','Raw\x20Response\x20Body:','Status\x20API\x20Error:\x20','Result:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','error','headers','/create','Payment\x20System/1.0','URL:','Gateway\x20Payment\x20ID:','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','Status','timeout','Payment\x20URL\x20(original):','status_code','HTTP\x20','EUR','application/json','CoinToPay\x20status\x20API\x20error:\x20','IBAN:','stringify','/status','failed','FAILED','CoinToPay\x20payment\x20status\x20check\x20error:','122180hWEhBV','message','Error\x20message:','data','cancelled','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Parsed\x20Result:','gateway_payment_id','created','CoinToPay\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','POST','Payment\x20URL\x20(modified):','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','stack','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','&alternative=false','createPaymentLink','Response\x20data:','toLowerCase','189600czweZJ','Failed\x20to\x20parse\x20JSON\x20response:','now','logWhiteDomainError','parse','1747836DUsfqF','994TZywCx','Transaction\x20ID:','../loggerService','Status:','109788GWSsoW','Confirmed\x20On:','statusUrl','statusText','ðŸ¦\x20Payment\x20Detail:','processWebhook','Response\x20Time:','inputCurrency','log','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20',',\x20body:\x20','Error\x20details:','Currency:','entries','25WtkjrP','fromEntries','merchant_reference_id','pending','Amount','Missing\x20data\x20in\x20response','Amount:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','Created\x20On:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','payment_url','TransactionID','PENDING','PAID','match','1074039Hmcgor','expired','HTTP\x20Status:','apiUrl','Response\x20Body:','Error\x20Message:','verifyPayment','https://tesoft.uk/gateway/cointopay/status.php','CreatedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','success','defineProperty','EXPIRED','logWhiteDomainRequest','CoinToPayService','ðŸ“Š\x20Status\x20check\x20URL:','Status\x20Code:','currency','text','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','waiting','status','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','logWhiteDomainResponse','125444PQaTqs','5672IThuSn','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Unknown\x20error\x20from\x20CoinToPay\x20API','paid','===\x20COINTOPAY\x20SUCCESS\x20===','PaymentDetail','Business\x20Error:\x20','ExpiryTime','cointopay'];a57_0x8100=function(){return _0x57a058;};return a57_0x8100();}Object[a57_0x182366(0x220)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a57_0x182366(0x1f4));class CoinToPayService{constructor(){const _0x3a8106=a57_0x182366;this[_0x3a8106(0x218)]=_0x3a8106(0x1c4),this[_0x3a8106(0x1f8)]=_0x3a8106(0x21c),console[_0x3a8106(0x1fe)](_0x3a8106(0x1d8)),console[_0x3a8106(0x1fe)](_0x3a8106(0x224),this['statusUrl']);}async[a57_0x182366(0x1e9)](_0x1c8898){const _0x29b789=a57_0x182366,{orderId:_0x21c9bf,amount:_0xb2e6ca}=_0x1c8898;console[_0x29b789(0x1fe)](_0x29b789(0x1e3)+_0xb2e6ca+_0x29b789(0x1b8));const _0x16fe84={'amount':_0xb2e6ca},_0xadf872=Date['now']();try{console[_0x29b789(0x1fe)](_0x29b789(0x22b)),console[_0x29b789(0x1fe)](_0x29b789(0x1c1),this[_0x29b789(0x218)]),console['log']('Request\x20Body:',JSON[_0x29b789(0x1ce)](_0x16fe84,null,0x2)),console[_0x29b789(0x1fe)](_0x29b789(0x20a),_0xb2e6ca,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x29b789(0x237)][_0x29b789(0x222)](_0x29b789(0x236),_0x29b789(0x1bf),_0x29b789(0x1e1),_0x16fe84);const _0x317155=await fetch(this['apiUrl'],{'method':_0x29b789(0x1e1),'headers':{'Content-Type':_0x29b789(0x1cb),'Accept':_0x29b789(0x1cb),'User-Agent':_0x29b789(0x1c0)},'body':JSON['stringify'](_0x16fe84)}),_0x48fbe1=Date[_0x29b789(0x1ee)]()-_0xadf872;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x29b789(0x1fe)]('Status:',_0x317155[_0x29b789(0x22a)]),console['log']('Status\x20Text:',_0x317155[_0x29b789(0x1f9)]),console[_0x29b789(0x1fe)]('Headers:',Object[_0x29b789(0x205)](_0x317155[_0x29b789(0x1be)][_0x29b789(0x203)]())),console[_0x29b789(0x1fe)]('Response\x20Time:',_0x48fbe1+'ms');const _0x307456=await _0x317155['text']();console[_0x29b789(0x1fe)](_0x29b789(0x1b9),_0x307456);if(!_0x317155['ok']){console['error'](_0x29b789(0x20c)),console[_0x29b789(0x1bd)](_0x29b789(0x217),_0x317155[_0x29b789(0x22a)]),console[_0x29b789(0x1bd)](_0x29b789(0x219),_0x307456),loggerService_1[_0x29b789(0x237)][_0x29b789(0x22c)]('cointopay','/create',_0x317155['status'],_0x307456,_0x48fbe1),loggerService_1[_0x29b789(0x237)]['logWhiteDomainError']('cointopay',_0x29b789(0x1bf),_0x29b789(0x1c9)+_0x317155['status']+':\x20'+_0x307456);throw new Error(_0x29b789(0x1df)+_0x317155[_0x29b789(0x22a)]+_0x29b789(0x200)+_0x307456);}let _0x35d0f4;try{_0x35d0f4=JSON[_0x29b789(0x1f0)](_0x307456);}catch(_0x21b475){console[_0x29b789(0x1bd)](_0x29b789(0x1ed),_0x21b475),loggerService_1[_0x29b789(0x237)][_0x29b789(0x1ef)](_0x29b789(0x236),_0x29b789(0x1bf),_0x29b789(0x1c3)+_0x21b475);throw new Error(_0x29b789(0x1ff)+_0x307456);}console[_0x29b789(0x1fe)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x29b789(0x1fe)](_0x29b789(0x1db),JSON['stringify'](_0x35d0f4,null,0x2)),loggerService_1[_0x29b789(0x237)][_0x29b789(0x22c)](_0x29b789(0x236),'/create',_0x317155[_0x29b789(0x22a)],_0x35d0f4,_0x48fbe1);if(_0x35d0f4[_0x29b789(0x1bd)]){const _0x449728=_0x35d0f4['message']||_0x35d0f4[_0x29b789(0x1bd)]||_0x29b789(0x230);console[_0x29b789(0x1bd)](_0x29b789(0x1e7)),console['error']('Error\x20Message:',_0x449728),loggerService_1[_0x29b789(0x237)]['logWhiteDomainError'](_0x29b789(0x236),'/create',_0x29b789(0x234)+_0x449728);throw new Error(_0x29b789(0x1de)+_0x449728);}if(!_0x35d0f4['payment_url']||!_0x35d0f4[_0x29b789(0x1dc)]){console[_0x29b789(0x1bd)](_0x29b789(0x1bc)),console[_0x29b789(0x1bd)](_0x29b789(0x1e6)),console[_0x29b789(0x1bd)](_0x29b789(0x1ea),_0x35d0f4),loggerService_1['loggerService'][_0x29b789(0x1ef)](_0x29b789(0x236),_0x29b789(0x1bf),_0x29b789(0x20f));throw new Error(_0x29b789(0x20e));}console['log'](_0x29b789(0x232)),console[_0x29b789(0x1fe)](_0x29b789(0x1c2),_0x35d0f4[_0x29b789(0x1dc)]),console['log'](_0x29b789(0x1c7),_0x35d0f4['payment_url']);const _0x53cfd5=_0x35d0f4[_0x29b789(0x210)]+_0x29b789(0x1e8);return console['log'](_0x29b789(0x1e2),_0x53cfd5),console['log'](_0x29b789(0x20a),_0xb2e6ca,_0x29b789(0x1ca)),{'gateway_payment_id':_0x35d0f4[_0x29b789(0x1dc)],'payment_url':_0x53cfd5};}catch(_0x1a71fe){console[_0x29b789(0x1bd)](_0x29b789(0x21e)),console['error'](_0x29b789(0x201),_0x1a71fe),loggerService_1['loggerService'][_0x29b789(0x1ef)]('cointopay',_0x29b789(0x1bf),_0x1a71fe);if(_0x1a71fe instanceof Error){console[_0x29b789(0x1bd)](_0x29b789(0x1d5),_0x1a71fe[_0x29b789(0x1d4)]),console[_0x29b789(0x1bd)]('Error\x20stack:',_0x1a71fe[_0x29b789(0x1e5)]);throw new Error(_0x29b789(0x228)+_0x1a71fe['message']);}throw new Error(_0x29b789(0x1d9));}}async['checkPaymentStatus'](_0x23193e){const _0x31a4f0=a57_0x182366,_0x33aac9=Date[_0x31a4f0(0x1ee)]();try{console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1e0)+_0x23193e);const _0x56eee9={'gatewayPaymentId':_0x23193e};loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x222)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x31a4f0(0x1e1),_0x56eee9);const _0x49d45e=await fetch(this[_0x31a4f0(0x1f8)],{'method':'POST','headers':{'Content-Type':_0x31a4f0(0x1cb),'Accept':_0x31a4f0(0x1cb),'User-Agent':_0x31a4f0(0x1c0)},'body':JSON[_0x31a4f0(0x1ce)](_0x56eee9)}),_0x2d2823=Date[_0x31a4f0(0x1ee)]()-_0x33aac9;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1f5),_0x49d45e['status']),console['log'](_0x31a4f0(0x1fc),_0x2d2823+'ms');if(!_0x49d45e['ok']){const _0x317f7f=await _0x49d45e[_0x31a4f0(0x227)]();console[_0x31a4f0(0x1bd)](_0x31a4f0(0x217),_0x49d45e['status']),console[_0x31a4f0(0x1bd)](_0x31a4f0(0x219),_0x317f7f),loggerService_1[_0x31a4f0(0x237)]['logWhiteDomainResponse']('cointopay',_0x31a4f0(0x1cf),_0x49d45e['status'],_0x317f7f,_0x2d2823),loggerService_1[_0x31a4f0(0x237)]['logWhiteDomainError'](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x31a4f0(0x1c9)+_0x49d45e['status']+':\x20'+_0x317f7f);throw new Error(_0x31a4f0(0x1df)+_0x49d45e[_0x31a4f0(0x22a)]);}const _0x106036=await _0x49d45e[_0x31a4f0(0x227)]();console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1b9),_0x106036);let _0x4cf903;try{_0x4cf903=JSON[_0x31a4f0(0x1f0)](_0x106036);}catch(_0x32b595){console[_0x31a4f0(0x1bd)](_0x31a4f0(0x1ed),_0x32b595),loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x1ef)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x31a4f0(0x1c3)+_0x32b595);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x106036);}loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x22c)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x49d45e[_0x31a4f0(0x22a)],_0x4cf903,_0x2d2823),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1e4)),console['log'](_0x31a4f0(0x1bb),_0x4cf903['result']),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x225),_0x4cf903['status_code']),console['log']('Payment\x20Status:',_0x4cf903[_0x31a4f0(0x1d6)]?.[_0x31a4f0(0x1c5)]),console[_0x31a4f0(0x1fe)]('Amount:',_0x4cf903[_0x31a4f0(0x1d6)]?.[_0x31a4f0(0x208)]),console['log'](_0x31a4f0(0x202),_0x4cf903[_0x31a4f0(0x1d6)]?.[_0x31a4f0(0x1fd)]);if(_0x4cf903['result']!==_0x31a4f0(0x21f)||_0x4cf903[_0x31a4f0(0x1c8)]!==0xc8){const _0x4a84f7=_0x4cf903['message']||_0x31a4f0(0x22f);console[_0x31a4f0(0x1bd)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x31a4f0(0x1bd)](_0x31a4f0(0x21a),_0x4a84f7),loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x1ef)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x31a4f0(0x1ba)+_0x4a84f7);throw new Error(_0x31a4f0(0x1cc)+_0x4a84f7);}if(!_0x4cf903[_0x31a4f0(0x1d6)]){console[_0x31a4f0(0x1bd)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x31a4f0(0x1bd)](_0x31a4f0(0x209)),loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x1ef)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x31a4f0(0x1b7));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5cd343=_0x31a4f0(0x212);switch(_0x4cf903['data'][_0x31a4f0(0x1c5)]?.[_0x31a4f0(0x1eb)]()){case _0x31a4f0(0x231):_0x5cd343=_0x31a4f0(0x213);break;case'cancelled':case _0x31a4f0(0x1d0):case _0x31a4f0(0x1bd):_0x5cd343=_0x31a4f0(0x1d1);break;case _0x31a4f0(0x216):case'timeout':_0x5cd343=_0x31a4f0(0x221);break;case _0x31a4f0(0x229):case'awaiting\x20fiat':case'pending':case _0x31a4f0(0x1dd):default:_0x5cd343=_0x31a4f0(0x212);break;}let _0x2a649b,_0x510167;if(_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x233)]){const _0x17fc33=_0x4cf903['data'][_0x31a4f0(0x233)];console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1fa),_0x17fc33);const _0x7ac39e=_0x17fc33[_0x31a4f0(0x214)](/IBAN\s+([A-Z0-9]+)/i);_0x7ac39e&&(_0x2a649b=_0x7ac39e[0x1],console[_0x31a4f0(0x1fe)]('ðŸ¦\x20Extracted\x20IBAN:',_0x2a649b)),_0x510167=_0x17fc33;}const _0x10c6b9={'iban':_0x2a649b,'bankDetails':_0x510167,'transactionId':_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x211)],'coinAddress':_0x4cf903[_0x31a4f0(0x1d6)]['coinAddress'],'qrCodeUrl':_0x4cf903[_0x31a4f0(0x1d6)]['QRCodeURL'],'expiryTime':_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x235)],'createdOn':_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x21d)],'confirmedOn':_0x4cf903['data']['TransactionConfirmedOn']};console['log'](_0x31a4f0(0x20b)),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1f5),_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x1c5)],'->',_0x5cd343),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x20a),_0x4cf903['data'][_0x31a4f0(0x208)],_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x1fd)]),console['log'](_0x31a4f0(0x1f3),_0x4cf903['data'][_0x31a4f0(0x211)]),console['log'](_0x31a4f0(0x1cd),_0x2a649b||'not\x20found'),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x20d),_0x4cf903['data'][_0x31a4f0(0x21d)]),console[_0x31a4f0(0x1fe)](_0x31a4f0(0x1f7),_0x4cf903['data']['TransactionConfirmedOn']||'not\x20confirmed');if(_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x1c5)]?.[_0x31a4f0(0x1eb)]()==='awaiting\x20fiat')console[_0x31a4f0(0x1fe)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x1c5)]?.['toLowerCase']()===_0x31a4f0(0x231)&&console[_0x31a4f0(0x1fe)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5cd343,'amount':parseFloat(_0x4cf903[_0x31a4f0(0x1d6)][_0x31a4f0(0x208)])||undefined,'currency':_0x4cf903[_0x31a4f0(0x1d6)]['inputCurrency']||'EUR','paymentDetails':_0x10c6b9};}catch(_0x4e48b1){console['error'](_0x31a4f0(0x1d2),_0x4e48b1),loggerService_1[_0x31a4f0(0x237)][_0x31a4f0(0x1ef)](_0x31a4f0(0x236),_0x31a4f0(0x1cf),_0x4e48b1);throw new Error(_0x31a4f0(0x1da)+(_0x4e48b1 instanceof Error?_0x4e48b1[_0x31a4f0(0x1d4)]:'Unknown\x20error'));}}async[a57_0x182366(0x21b)](_0x6b38c){const _0x58ed7a=a57_0x182366,_0x1296aa=await this['checkPaymentStatus'](_0x6b38c);return{'status':_0x1296aa['status'],'amount':_0x1296aa['amount'],'currency':_0x1296aa[_0x58ed7a(0x226)]};}async[a57_0x182366(0x1fb)](_0x3df9d9){const _0x46f1f9=a57_0x182366;console[_0x46f1f9(0x1fe)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3df9d9);let _0xf4ce7e=_0x46f1f9(0x212);switch(_0x3df9d9[_0x46f1f9(0x22a)]?.[_0x46f1f9(0x1eb)]()){case _0x46f1f9(0x231):_0xf4ce7e=_0x46f1f9(0x213);break;case _0x46f1f9(0x1d7):case'failed':case _0x46f1f9(0x1bd):_0xf4ce7e=_0x46f1f9(0x1d1);break;case'expired':case _0x46f1f9(0x1c6):_0xf4ce7e=_0x46f1f9(0x221);break;case _0x46f1f9(0x207):case'waiting':case'awaiting\x20fiat':case _0x46f1f9(0x1dd):default:_0xf4ce7e=_0x46f1f9(0x212);break;}return{'paymentId':_0x3df9d9['order_id']||_0x3df9d9[_0x46f1f9(0x206)]||'','status':_0xf4ce7e,'amount':_0x3df9d9['amount'],'currency':_0x3df9d9[_0x46f1f9(0x226)]||'EUR'};}}exports[a57_0x182366(0x223)]=CoinToPayService;