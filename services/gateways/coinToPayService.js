'use strict';const a41_0x1ab898=a41_0x56db;(function(_0x27893b,_0x594d21){const _0x5976ec=a41_0x56db,_0x277a22=_0x27893b();while(!![]){try{const _0x3f79d6=-parseInt(_0x5976ec(0xe9))/0x1+-parseInt(_0x5976ec(0x109))/0x2*(parseInt(_0x5976ec(0xff))/0x3)+-parseInt(_0x5976ec(0x149))/0x4*(parseInt(_0x5976ec(0x15f))/0x5)+parseInt(_0x5976ec(0xfd))/0x6+parseInt(_0x5976ec(0x16a))/0x7+parseInt(_0x5976ec(0x108))/0x8+parseInt(_0x5976ec(0x167))/0x9;if(_0x3f79d6===_0x594d21)break;else _0x277a22['push'](_0x277a22['shift']());}catch(_0xbbe631){_0x277a22['push'](_0x277a22['shift']());}}}(a41_0x588d,0xb5667));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a41_0x1ab898(0xf8)]=void 0x0;function a41_0x56db(_0x5c28c9,_0x3a8d6e){const _0x588dcb=a41_0x588d();return a41_0x56db=function(_0x56db42,_0x10a1be){_0x56db42=_0x56db42-0xe9;let _0x5998d2=_0x588dcb[_0x56db42];return _0x5998d2;},a41_0x56db(_0x5c28c9,_0x3a8d6e);}const loggerService_1=require(a41_0x1ab898(0xfc));class CoinToPayService{constructor(){const _0x5b9548=a41_0x1ab898;this[_0x5b9548(0x11f)]=_0x5b9548(0x12e),this[_0x5b9548(0x12b)]=_0x5b9548(0xec),console[_0x5b9548(0x15e)](_0x5b9548(0xfa)),console[_0x5b9548(0x15e)](_0x5b9548(0x14d),this[_0x5b9548(0x12b)]);}async['createPaymentLink'](_0x53b83c){const _0x562703=a41_0x1ab898,{orderId:_0x545576,amount:_0x20a989}=_0x53b83c;console[_0x562703(0x15e)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x20a989+_0x562703(0x163));const _0xbf24c7={'amount':_0x20a989},_0x129d2=Date['now']();try{console[_0x562703(0x15e)](_0x562703(0x132)),console['log'](_0x562703(0x11d),this[_0x562703(0x11f)]),console[_0x562703(0x15e)](_0x562703(0x129),JSON[_0x562703(0x160)](_0xbf24c7,null,0x2)),console[_0x562703(0x15e)](_0x562703(0x124),_0x20a989,_0x562703(0x13b)),loggerService_1[_0x562703(0x137)]['logWhiteDomainRequest']('cointopay',_0x562703(0x144),_0x562703(0x131),_0xbf24c7);const _0x38aa8d=await fetch(this[_0x562703(0x11f)],{'method':_0x562703(0x131),'headers':{'Content-Type':_0x562703(0x102),'Accept':_0x562703(0x102),'User-Agent':_0x562703(0x15a)},'body':JSON[_0x562703(0x160)](_0xbf24c7)}),_0x15624f=Date[_0x562703(0x10a)]()-_0x129d2;console[_0x562703(0x15e)](_0x562703(0x159)),console[_0x562703(0x15e)](_0x562703(0xf5),_0x38aa8d[_0x562703(0x145)]),console['log']('Status\x20Text:',_0x38aa8d[_0x562703(0x133)]),console[_0x562703(0x15e)](_0x562703(0x161),Object[_0x562703(0x152)](_0x38aa8d['headers'][_0x562703(0x10e)]())),console['log'](_0x562703(0x157),_0x15624f+'ms');const _0x3c2cac=await _0x38aa8d[_0x562703(0x141)]();console['log'](_0x562703(0x119),_0x3c2cac);if(!_0x38aa8d['ok']){console['error'](_0x562703(0x126)),console[_0x562703(0x128)](_0x562703(0x158),_0x38aa8d['status']),console[_0x562703(0x128)](_0x562703(0xf2),_0x3c2cac),loggerService_1[_0x562703(0x137)][_0x562703(0xf6)]('cointopay',_0x562703(0x144),_0x38aa8d[_0x562703(0x145)],_0x3c2cac,_0x15624f),loggerService_1['loggerService']['logWhiteDomainError'](_0x562703(0x166),_0x562703(0x144),_0x562703(0x143)+_0x38aa8d[_0x562703(0x145)]+':\x20'+_0x3c2cac);throw new Error(_0x562703(0x10f)+_0x38aa8d[_0x562703(0x145)]+',\x20body:\x20'+_0x3c2cac);}let _0x1e05bb;try{_0x1e05bb=JSON['parse'](_0x3c2cac);}catch(_0x36a65e){console[_0x562703(0x128)](_0x562703(0x13d),_0x36a65e),loggerService_1[_0x562703(0x137)][_0x562703(0x111)]('cointopay',_0x562703(0x144),_0x562703(0x11b)+_0x36a65e);throw new Error(_0x562703(0x114)+_0x3c2cac);}console['log'](_0x562703(0x11c)),console[_0x562703(0x15e)](_0x562703(0x14b),JSON[_0x562703(0x160)](_0x1e05bb,null,0x2)),loggerService_1[_0x562703(0x137)][_0x562703(0xf6)](_0x562703(0x166),_0x562703(0x144),_0x38aa8d['status'],_0x1e05bb,_0x15624f);if(_0x1e05bb['error']){const _0x36ae2b=_0x1e05bb[_0x562703(0x14e)]||_0x1e05bb[_0x562703(0x128)]||_0x562703(0x151);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x562703(0x128)](_0x562703(0x147),_0x36ae2b),loggerService_1[_0x562703(0x137)][_0x562703(0x111)]('cointopay',_0x562703(0x144),_0x562703(0xf4)+_0x36ae2b);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x36ae2b);}if(!_0x1e05bb[_0x562703(0x136)]||!_0x1e05bb[_0x562703(0x14f)]){console[_0x562703(0x128)](_0x562703(0x127)),console[_0x562703(0x128)](_0x562703(0xea)),console[_0x562703(0x128)](_0x562703(0x122),_0x1e05bb),loggerService_1[_0x562703(0x137)][_0x562703(0x111)]('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x562703(0x15e)](_0x562703(0x117)),console[_0x562703(0x15e)](_0x562703(0x115),_0x1e05bb['gateway_payment_id']),console['log'](_0x562703(0x169),_0x1e05bb[_0x562703(0x136)]),console[_0x562703(0x15e)](_0x562703(0x124),_0x20a989,_0x562703(0x121)),{'gateway_payment_id':_0x1e05bb[_0x562703(0x14f)],'payment_url':_0x1e05bb[_0x562703(0x136)]};}catch(_0x4fef94){console[_0x562703(0x128)](_0x562703(0xed)),console[_0x562703(0x128)]('Error\x20details:',_0x4fef94),loggerService_1['loggerService'][_0x562703(0x111)](_0x562703(0x166),_0x562703(0x144),_0x4fef94);if(_0x4fef94 instanceof Error){console['error'](_0x562703(0x104),_0x4fef94[_0x562703(0x14e)]),console[_0x562703(0x128)](_0x562703(0x125),_0x4fef94[_0x562703(0x154)]);throw new Error(_0x562703(0x12d)+_0x4fef94[_0x562703(0x14e)]);}throw new Error(_0x562703(0x12a));}}async['checkPaymentStatus'](_0x54d024){const _0x392ae1=a41_0x1ab898,_0x2f5276=Date[_0x392ae1(0x10a)]();try{console[_0x392ae1(0x15e)](_0x392ae1(0x10b)+_0x54d024);const _0x4532af={'gatewayPaymentId':_0x54d024};loggerService_1[_0x392ae1(0x137)]['logWhiteDomainRequest'](_0x392ae1(0x166),'/status',_0x392ae1(0x131),_0x4532af);const _0x3d160b=await fetch(this[_0x392ae1(0x12b)],{'method':'POST','headers':{'Content-Type':_0x392ae1(0x102),'Accept':'application/json','User-Agent':_0x392ae1(0x15a)},'body':JSON[_0x392ae1(0x160)](_0x4532af)}),_0x5d6add=Date[_0x392ae1(0x10a)]()-_0x2f5276;console[_0x392ae1(0x15e)](_0x392ae1(0x13a)),console['log'](_0x392ae1(0xf5),_0x3d160b[_0x392ae1(0x145)]),console[_0x392ae1(0x15e)](_0x392ae1(0x157),_0x5d6add+'ms');if(!_0x3d160b['ok']){const _0x3db482=await _0x3d160b[_0x392ae1(0x141)]();console[_0x392ae1(0x128)](_0x392ae1(0x158),_0x3d160b[_0x392ae1(0x145)]),console[_0x392ae1(0x128)](_0x392ae1(0xf2),_0x3db482),loggerService_1[_0x392ae1(0x137)]['logWhiteDomainResponse'](_0x392ae1(0x166),_0x392ae1(0x11e),_0x3d160b['status'],_0x3db482,_0x5d6add),loggerService_1[_0x392ae1(0x137)]['logWhiteDomainError'](_0x392ae1(0x166),_0x392ae1(0x11e),_0x392ae1(0x143)+_0x3d160b[_0x392ae1(0x145)]+':\x20'+_0x3db482);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3d160b['status']);}const _0x49061b=await _0x3d160b['text']();console['log'](_0x392ae1(0x119),_0x49061b);let _0x54c23b;try{_0x54c23b=JSON[_0x392ae1(0x103)](_0x49061b);}catch(_0x167363){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x167363),loggerService_1[_0x392ae1(0x137)][_0x392ae1(0x111)](_0x392ae1(0x166),_0x392ae1(0x11e),_0x392ae1(0x11b)+_0x167363);throw new Error(_0x392ae1(0x148)+_0x49061b);}loggerService_1[_0x392ae1(0x137)]['logWhiteDomainResponse'](_0x392ae1(0x166),_0x392ae1(0x11e),_0x3d160b[_0x392ae1(0x145)],_0x54c23b,_0x5d6add),console['log'](_0x392ae1(0xfb)),console[_0x392ae1(0x15e)](_0x392ae1(0x101),_0x54c23b[_0x392ae1(0x142)]),console[_0x392ae1(0x15e)](_0x392ae1(0xf9),_0x54c23b[_0x392ae1(0x15c)]),console['log'](_0x392ae1(0x12c),_0x54c23b[_0x392ae1(0x107)]?.[_0x392ae1(0xfe)]),console[_0x392ae1(0x15e)]('Amount:',_0x54c23b[_0x392ae1(0x107)]?.['Amount']),console['log'](_0x392ae1(0xf1),_0x54c23b['data']?.[_0x392ae1(0x120)]);if(_0x54c23b[_0x392ae1(0x142)]!==_0x392ae1(0x10d)||_0x54c23b['status_code']!==0xc8){const _0x11f099=_0x54c23b[_0x392ae1(0x14e)]||_0x392ae1(0x162);console[_0x392ae1(0x128)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x392ae1(0x128)](_0x392ae1(0x147),_0x11f099),loggerService_1[_0x392ae1(0x137)][_0x392ae1(0x111)]('cointopay',_0x392ae1(0x11e),_0x392ae1(0x112)+_0x11f099);throw new Error(_0x392ae1(0x164)+_0x11f099);}if(!_0x54c23b[_0x392ae1(0x107)]){console[_0x392ae1(0x128)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x392ae1(0x128)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x392ae1(0x137)][_0x392ae1(0x111)]('cointopay','/status',_0x392ae1(0x106));throw new Error(_0x392ae1(0x116));}let _0x55490c=_0x392ae1(0x165);switch(_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0xfe)]?.[_0x392ae1(0xf0)]()){case _0x392ae1(0xee):_0x55490c='PAID';break;case _0x392ae1(0xef):case'failed':case'error':_0x55490c='FAILED';break;case'expired':case _0x392ae1(0x118):_0x55490c='EXPIRED';break;case _0x392ae1(0x10c):case _0x392ae1(0x13c):case _0x392ae1(0x138):case _0x392ae1(0x15b):default:_0x55490c=_0x392ae1(0x165);break;}let _0x58be81,_0x3848bc;if(_0x54c23b['data'][_0x392ae1(0x110)]){const _0x229e4f=_0x54c23b[_0x392ae1(0x107)]['PaymentDetail'];console[_0x392ae1(0x15e)]('🏦\x20Payment\x20Detail:',_0x229e4f);const _0x315fdb=_0x229e4f[_0x392ae1(0x13f)](/IBAN\s+([A-Z0-9]+)/i);_0x315fdb&&(_0x58be81=_0x315fdb[0x1],console[_0x392ae1(0x15e)]('🏦\x20Extracted\x20IBAN:',_0x58be81)),_0x3848bc=_0x229e4f;}const _0x4b68be={'iban':_0x58be81,'bankDetails':_0x3848bc,'transactionId':_0x54c23b['data'][_0x392ae1(0x13e)],'coinAddress':_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x14c)],'qrCodeUrl':_0x54c23b[_0x392ae1(0x107)]['QRCodeURL'],'expiryTime':_0x54c23b['data'][_0x392ae1(0x113)],'createdOn':_0x54c23b['data'][_0x392ae1(0xeb)],'confirmedOn':_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x153)]};console[_0x392ae1(0x15e)](_0x392ae1(0x139)),console[_0x392ae1(0x15e)](_0x392ae1(0xf5),_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0xfe)],'->',_0x55490c),console[_0x392ae1(0x15e)](_0x392ae1(0x124),_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x168)],_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x120)]),console[_0x392ae1(0x15e)]('Transaction\x20ID:',_0x54c23b[_0x392ae1(0x107)]['TransactionID']),console[_0x392ae1(0x15e)](_0x392ae1(0x105),_0x58be81||_0x392ae1(0x150)),console[_0x392ae1(0x15e)](_0x392ae1(0x15d),_0x54c23b[_0x392ae1(0x107)]['CreatedOn']),console[_0x392ae1(0x15e)](_0x392ae1(0x146),_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x153)]||'not\x20confirmed');if(_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0xfe)]?.[_0x392ae1(0xf0)]()===_0x392ae1(0x13c))console['log'](_0x392ae1(0x135));else _0x54c23b[_0x392ae1(0x107)][_0x392ae1(0xfe)]?.[_0x392ae1(0xf0)]()===_0x392ae1(0xee)&&console[_0x392ae1(0x15e)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x55490c,'amount':parseFloat(_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x168)])||undefined,'currency':_0x54c23b[_0x392ae1(0x107)][_0x392ae1(0x120)]||_0x392ae1(0x121),'paymentDetails':_0x4b68be};}catch(_0x21f74b){console[_0x392ae1(0x128)](_0x392ae1(0x14a),_0x21f74b),loggerService_1['loggerService'][_0x392ae1(0x111)](_0x392ae1(0x166),_0x392ae1(0x11e),_0x21f74b);throw new Error(_0x392ae1(0x140)+(_0x21f74b instanceof Error?_0x21f74b[_0x392ae1(0x14e)]:'Unknown\x20error'));}}async[a41_0x1ab898(0x155)](_0x1bb36f){const _0x3c9de6=a41_0x1ab898,_0x145d7a=await this[_0x3c9de6(0xf7)](_0x1bb36f);return{'status':_0x145d7a[_0x3c9de6(0x145)],'amount':_0x145d7a[_0x3c9de6(0x134)],'currency':_0x145d7a['currency']};}async[a41_0x1ab898(0x123)](_0x21a787){const _0x39a9b6=a41_0x1ab898;console[_0x39a9b6(0x15e)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x21a787);let _0x1c4e8b=_0x39a9b6(0x165);switch(_0x21a787[_0x39a9b6(0x145)]?.[_0x39a9b6(0xf0)]()){case'paid':_0x1c4e8b='PAID';break;case _0x39a9b6(0xef):case _0x39a9b6(0x100):case _0x39a9b6(0x128):_0x1c4e8b=_0x39a9b6(0x12f);break;case _0x39a9b6(0x130):case _0x39a9b6(0x118):_0x1c4e8b='EXPIRED';break;case _0x39a9b6(0x138):case _0x39a9b6(0x10c):case'awaiting\x20fiat':case _0x39a9b6(0x15b):default:_0x1c4e8b=_0x39a9b6(0x165);break;}return{'paymentId':_0x21a787[_0x39a9b6(0x11a)]||_0x21a787[_0x39a9b6(0x156)]||'','status':_0x1c4e8b,'amount':_0x21a787[_0x39a9b6(0x134)],'currency':_0x21a787[_0x39a9b6(0xf3)]||_0x39a9b6(0x121)};}}exports[a41_0x1ab898(0xf8)]=CoinToPayService;function a41_0x588d(){const _0x2eb5c9=['Amount','Payment\x20URL:','5429522hMUgDE','804311hXwMNQ','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CreatedOn','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','paid','cancelled','toLowerCase','Currency:','Response\x20Body:','currency','Business\x20Error:\x20','Status:','logWhiteDomainResponse','checkPaymentStatus','CoinToPayService','Status\x20Code:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','../loggerService','3563706JZrXaX','Status','1293HbkVyT','failed','Result:','application/json','parse','Error\x20message:','IBAN:','Incomplete\x20response:\x20missing\x20data','data','4781008WBrezP','4474reppCV','now','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','waiting','success','entries','HTTP\x20error!\x20status:\x20','PaymentDetail','logWhiteDomainError','Status\x20API\x20Error:\x20','ExpiryTime','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Gateway\x20Payment\x20ID:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20SUCCESS\x20===','timeout','Raw\x20Response\x20Body:','order_id','JSON\x20Parse\x20Error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','URL:','/status','apiUrl','inputCurrency','EUR','Response\x20data:','processWebhook','Amount:','Error\x20stack:','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','error','Request\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','statusUrl','Payment\x20Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','https://tesoft.uk/gateway/cointopay/','FAILED','expired','POST','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','statusText','amount','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','payment_url','loggerService','pending','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','awaiting\x20fiat','Failed\x20to\x20parse\x20JSON\x20response:','TransactionID','match','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','text','result','HTTP\x20','/create','status','Confirmed\x20On:','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','32XAedpL','CoinToPay\x20payment\x20status\x20check\x20error:','Parsed\x20Result:','coinAddress','📊\x20Status\x20check\x20URL:','message','gateway_payment_id','not\x20found','Unknown\x20error\x20from\x20CoinToPay\x20API','fromEntries','TransactionConfirmedOn','stack','verifyPayment','merchant_reference_id','Response\x20Time:','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','TesSoft\x20Payment\x20System/1.0','created','status_code','Created\x20On:','log','759025YCZbDj','stringify','Headers:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','\x20EUR','CoinToPay\x20status\x20API\x20error:\x20','PENDING','cointopay','15828210oicHmQ'];a41_0x588d=function(){return _0x2eb5c9;};return a41_0x588d();}