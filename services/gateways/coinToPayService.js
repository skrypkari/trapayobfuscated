'use strict';const a38_0xb2a811=a38_0x7a91;function a38_0x7a91(_0x2224de,_0x4e7a47){const _0x9d5493=a38_0x9d54();return a38_0x7a91=function(_0x7a9116,_0x5265ce){_0x7a9116=_0x7a9116-0x123;let _0x43db33=_0x9d5493[_0x7a9116];return _0x43db33;},a38_0x7a91(_0x2224de,_0x4e7a47);}(function(_0x205b02,_0x1eaa6c){const _0x1ceca0=a38_0x7a91,_0x3f24eb=_0x205b02();while(!![]){try{const _0x2c0e33=-parseInt(_0x1ceca0(0x12e))/0x1+parseInt(_0x1ceca0(0x123))/0x2*(parseInt(_0x1ceca0(0x12b))/0x3)+parseInt(_0x1ceca0(0x165))/0x4+-parseInt(_0x1ceca0(0x154))/0x5+-parseInt(_0x1ceca0(0x19f))/0x6*(-parseInt(_0x1ceca0(0x127))/0x7)+parseInt(_0x1ceca0(0x152))/0x8*(parseInt(_0x1ceca0(0x157))/0x9)+parseInt(_0x1ceca0(0x146))/0xa*(parseInt(_0x1ceca0(0x169))/0xb);if(_0x2c0e33===_0x1eaa6c)break;else _0x3f24eb['push'](_0x3f24eb['shift']());}catch(_0x48b81b){_0x3f24eb['push'](_0x3f24eb['shift']());}}}(a38_0x9d54,0xb9626));Object[a38_0xb2a811(0x164)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;function a38_0x9d54(){const _0x113880=['logWhiteDomainRequest','Payment\x20URL:','427026VlxOIf','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20Code:','809385vyUWZp','Result:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','HTTP\x20Status:','gateway_payment_id','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','processWebhook','apiUrl','HTTP\x20error!\x20status:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Created\x20On:','headers','ExpiryTime','failed','ðŸ¦\x20Extracted\x20IBAN:','QRCodeURL','Payment\x20Status:','coinAddress','TransactionConfirmedOn','result','toLowerCase','pending','cancelled','50UgFllY','status_code','Error\x20message:','inputCurrency','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','payment_url','createPaymentLink','Status\x20Text:','Currency:','data','344CQnFvY','message','4469045UAqlpL','Request\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','27234QCzEMX','Unknown\x20error\x20from\x20CoinToPay\x20API','PAID','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','cointopay','logWhiteDomainError','PaymentDetail','POST','now','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','text','parse','CoinToPay\x20API\x20error:\x20','defineProperty','1167632LcuceX','Status','ðŸ“Š\x20Status\x20check\x20URL:','Error\x20Message:','49423FeJSAd','EUR','IBAN:','EXPIRED','verifyPayment','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status\x20API\x20Error:\x20','order_id','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20parse\x20JSON\x20response:','expired','error','Parsed\x20Result:','status','HTTP\x20','CreatedOn','Response\x20Body:','timeout','Amount:','Business\x20Error:\x20','/status','not\x20found',',\x20body:\x20','TransactionID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','match','awaiting\x20fiat','application/json','Gateway\x20Payment\x20ID:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TesSoft\x20Payment\x20System/1.0','Headers:','../loggerService','currency','amount','waiting','Status:','not\x20confirmed','Transaction\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PENDING','statusUrl','\x20EUR','paid','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','created','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Error\x20stack:','stringify','ðŸ¦\x20Payment\x20Detail:','stack','URL:','statusText','875694Sgyykv','JSON\x20Parse\x20Error:\x20','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CoinToPay\x20status\x20API\x20error:\x20','Confirmed\x20On:','Error\x20details:','log','Unknown\x20error','loggerService','/create','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','14XQLzrJ','checkPaymentStatus','logWhiteDomainResponse','success','49iKvxTd','Amount'];a38_0x9d54=function(){return _0x113880;};return a38_0x9d54();}const loggerService_1=require(a38_0xb2a811(0x189));class CoinToPayService{constructor(){const _0x25cfe3=a38_0xb2a811;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x25cfe3(0x192)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x25cfe3(0x133)),console['log'](_0x25cfe3(0x167),this['statusUrl']);}async[a38_0xb2a811(0x14e)](_0x368c72){const _0x11c534=a38_0xb2a811,{orderId:_0x258dcc,amount:_0x49d5a0}=_0x368c72;console[_0x11c534(0x1a6)]('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x49d5a0+_0x11c534(0x193));const _0x216f3b={'amount':_0x49d5a0},_0x430cc4=Date['now']();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x11c534(0x19d),this[_0x11c534(0x135)]),console[_0x11c534(0x1a6)](_0x11c534(0x155),JSON[_0x11c534(0x19a)](_0x216f3b,null,0x2)),console['log'](_0x11c534(0x17b),_0x49d5a0,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x11c534(0x1a8)]['logWhiteDomainRequest'](_0x11c534(0x15b),_0x11c534(0x1a9),_0x11c534(0x15e),_0x216f3b);const _0x3965f9=await fetch(this[_0x11c534(0x135)],{'method':_0x11c534(0x15e),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x11c534(0x187)},'body':JSON[_0x11c534(0x19a)](_0x216f3b)}),_0x438328=Date[_0x11c534(0x15f)]()-_0x430cc4;console['log'](_0x11c534(0x138)),console[_0x11c534(0x1a6)](_0x11c534(0x18d),_0x3965f9[_0x11c534(0x176)]),console[_0x11c534(0x1a6)](_0x11c534(0x14f),_0x3965f9[_0x11c534(0x19e)]),console[_0x11c534(0x1a6)](_0x11c534(0x188),Object['fromEntries'](_0x3965f9[_0x11c534(0x13a)]['entries']())),console[_0x11c534(0x1a6)]('Response\x20Time:',_0x438328+'ms');const _0x18155a=await _0x3965f9[_0x11c534(0x161)]();console[_0x11c534(0x1a6)]('Raw\x20Response\x20Body:',_0x18155a);if(!_0x3965f9['ok']){console[_0x11c534(0x174)](_0x11c534(0x1aa)),console[_0x11c534(0x174)](_0x11c534(0x131),_0x3965f9[_0x11c534(0x176)]),console[_0x11c534(0x174)](_0x11c534(0x179),_0x18155a),loggerService_1[_0x11c534(0x1a8)]['logWhiteDomainResponse'](_0x11c534(0x15b),_0x11c534(0x1a9),_0x3965f9[_0x11c534(0x176)],_0x18155a,_0x438328),loggerService_1['loggerService'][_0x11c534(0x15c)]('cointopay',_0x11c534(0x1a9),_0x11c534(0x177)+_0x3965f9['status']+':\x20'+_0x18155a);throw new Error(_0x11c534(0x136)+_0x3965f9[_0x11c534(0x176)]+_0x11c534(0x17f)+_0x18155a);}let _0x3819d8;try{_0x3819d8=JSON[_0x11c534(0x162)](_0x18155a);}catch(_0x26e9ca){console[_0x11c534(0x174)](_0x11c534(0x172),_0x26e9ca),loggerService_1[_0x11c534(0x1a8)][_0x11c534(0x15c)](_0x11c534(0x15b),_0x11c534(0x1a9),_0x11c534(0x1a0)+_0x26e9ca);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x18155a);}console[_0x11c534(0x1a6)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x11c534(0x1a6)](_0x11c534(0x175),JSON[_0x11c534(0x19a)](_0x3819d8,null,0x2)),loggerService_1[_0x11c534(0x1a8)][_0x11c534(0x125)](_0x11c534(0x15b),_0x11c534(0x1a9),_0x3965f9[_0x11c534(0x176)],_0x3819d8,_0x438328);if(_0x3819d8[_0x11c534(0x174)]){const _0x21fa8a=_0x3819d8[_0x11c534(0x153)]||_0x3819d8[_0x11c534(0x174)]||_0x11c534(0x158);console['error'](_0x11c534(0x14a)),console[_0x11c534(0x174)](_0x11c534(0x168),_0x21fa8a),loggerService_1['loggerService'][_0x11c534(0x15c)](_0x11c534(0x15b),'/create',_0x11c534(0x17c)+_0x21fa8a);throw new Error(_0x11c534(0x163)+_0x21fa8a);}if(!_0x3819d8[_0x11c534(0x14d)]||!_0x3819d8[_0x11c534(0x132)]){console['error'](_0x11c534(0x195)),console[_0x11c534(0x174)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x11c534(0x174)]('Response\x20data:',_0x3819d8),loggerService_1[_0x11c534(0x1a8)][_0x11c534(0x15c)](_0x11c534(0x15b),_0x11c534(0x1a9),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x11c534(0x156));}return console[_0x11c534(0x1a6)](_0x11c534(0x12c)),console['log'](_0x11c534(0x185),_0x3819d8[_0x11c534(0x132)]),console['log'](_0x11c534(0x12a),_0x3819d8[_0x11c534(0x14d)]),console[_0x11c534(0x1a6)](_0x11c534(0x17b),_0x49d5a0,_0x11c534(0x16a)),{'gateway_payment_id':_0x3819d8[_0x11c534(0x132)],'payment_url':_0x3819d8[_0x11c534(0x14d)]};}catch(_0x5b7e6b){console[_0x11c534(0x174)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x11c534(0x174)](_0x11c534(0x1a5),_0x5b7e6b),loggerService_1[_0x11c534(0x1a8)][_0x11c534(0x15c)](_0x11c534(0x15b),_0x11c534(0x1a9),_0x5b7e6b);if(_0x5b7e6b instanceof Error){console[_0x11c534(0x174)](_0x11c534(0x148),_0x5b7e6b['message']),console[_0x11c534(0x174)](_0x11c534(0x199),_0x5b7e6b[_0x11c534(0x19c)]);throw new Error(_0x11c534(0x1a2)+_0x5b7e6b[_0x11c534(0x153)]);}throw new Error(_0x11c534(0x14c));}}async[a38_0xb2a811(0x124)](_0x5d6993){const _0xc3d946=a38_0xb2a811,_0x203222=Date[_0xc3d946(0x15f)]();try{console['log'](_0xc3d946(0x198)+_0x5d6993);const _0x3673b0={'gatewayPaymentId':_0x5d6993};loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x129)](_0xc3d946(0x15b),_0xc3d946(0x17d),_0xc3d946(0x15e),_0x3673b0);const _0x1de933=await fetch(this[_0xc3d946(0x192)],{'method':'POST','headers':{'Content-Type':_0xc3d946(0x184),'Accept':'application/json','User-Agent':_0xc3d946(0x187)},'body':JSON[_0xc3d946(0x19a)](_0x3673b0)}),_0x3718cb=Date[_0xc3d946(0x15f)]()-_0x203222;console[_0xc3d946(0x1a6)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xc3d946(0x1a6)](_0xc3d946(0x18d),_0x1de933[_0xc3d946(0x176)]),console[_0xc3d946(0x1a6)]('Response\x20Time:',_0x3718cb+'ms');if(!_0x1de933['ok']){const _0x4f70e9=await _0x1de933['text']();console['error'](_0xc3d946(0x131),_0x1de933[_0xc3d946(0x176)]),console[_0xc3d946(0x174)](_0xc3d946(0x179),_0x4f70e9),loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x125)](_0xc3d946(0x15b),_0xc3d946(0x17d),_0x1de933[_0xc3d946(0x176)],_0x4f70e9,_0x3718cb),loggerService_1['loggerService']['logWhiteDomainError'](_0xc3d946(0x15b),_0xc3d946(0x17d),'HTTP\x20'+_0x1de933[_0xc3d946(0x176)]+':\x20'+_0x4f70e9);throw new Error(_0xc3d946(0x136)+_0x1de933['status']);}const _0x45be0f=await _0x1de933[_0xc3d946(0x161)]();console['log']('Raw\x20Response\x20Body:',_0x45be0f);let _0x517097;try{_0x517097=JSON[_0xc3d946(0x162)](_0x45be0f);}catch(_0x4e11c7){console[_0xc3d946(0x174)](_0xc3d946(0x172),_0x4e11c7),loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x15c)](_0xc3d946(0x15b),'/status',_0xc3d946(0x1a0)+_0x4e11c7);throw new Error(_0xc3d946(0x190)+_0x45be0f);}loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x125)](_0xc3d946(0x15b),_0xc3d946(0x17d),_0x1de933['status'],_0x517097,_0x3718cb),console['log'](_0xc3d946(0x181)),console[_0xc3d946(0x1a6)](_0xc3d946(0x12f),_0x517097[_0xc3d946(0x142)]),console['log'](_0xc3d946(0x12d),_0x517097[_0xc3d946(0x147)]),console[_0xc3d946(0x1a6)](_0xc3d946(0x13f),_0x517097[_0xc3d946(0x151)]?.[_0xc3d946(0x166)]),console['log']('Amount:',_0x517097[_0xc3d946(0x151)]?.['Amount']),console[_0xc3d946(0x1a6)](_0xc3d946(0x150),_0x517097['data']?.[_0xc3d946(0x149)]);if(_0x517097[_0xc3d946(0x142)]!==_0xc3d946(0x126)||_0x517097[_0xc3d946(0x147)]!==0xc8){const _0x3cc91c=_0x517097[_0xc3d946(0x153)]||_0xc3d946(0x14b);console['error'](_0xc3d946(0x130)),console[_0xc3d946(0x174)](_0xc3d946(0x168),_0x3cc91c),loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x15c)](_0xc3d946(0x15b),'/status',_0xc3d946(0x16f)+_0x3cc91c);throw new Error(_0xc3d946(0x1a3)+_0x3cc91c);}if(!_0x517097[_0xc3d946(0x151)]){console[_0xc3d946(0x174)](_0xc3d946(0x1ab)),console[_0xc3d946(0x174)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0xc3d946(0x15c)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0xc3d946(0x15a));}let _0x30199c=_0xc3d946(0x191);switch(_0x517097['data'][_0xc3d946(0x166)]?.['toLowerCase']()){case _0xc3d946(0x194):_0x30199c=_0xc3d946(0x159);break;case _0xc3d946(0x145):case _0xc3d946(0x13c):case'error':_0x30199c=_0xc3d946(0x196);break;case _0xc3d946(0x173):case _0xc3d946(0x17a):_0x30199c=_0xc3d946(0x16c);break;case _0xc3d946(0x18c):case _0xc3d946(0x183):case _0xc3d946(0x144):case _0xc3d946(0x197):default:_0x30199c='PENDING';break;}let _0x47fda6,_0x48cf30;if(_0x517097[_0xc3d946(0x151)][_0xc3d946(0x15d)]){const _0x3a9833=_0x517097[_0xc3d946(0x151)][_0xc3d946(0x15d)];console['log'](_0xc3d946(0x19b),_0x3a9833);const _0xf0631a=_0x3a9833[_0xc3d946(0x182)](/IBAN\s+([A-Z0-9]+)/i);_0xf0631a&&(_0x47fda6=_0xf0631a[0x1],console[_0xc3d946(0x1a6)](_0xc3d946(0x13d),_0x47fda6)),_0x48cf30=_0x3a9833;}const _0x2defee={'iban':_0x47fda6,'bankDetails':_0x48cf30,'transactionId':_0x517097[_0xc3d946(0x151)][_0xc3d946(0x180)],'coinAddress':_0x517097[_0xc3d946(0x151)][_0xc3d946(0x140)],'qrCodeUrl':_0x517097[_0xc3d946(0x151)][_0xc3d946(0x13e)],'expiryTime':_0x517097['data'][_0xc3d946(0x13b)],'createdOn':_0x517097[_0xc3d946(0x151)][_0xc3d946(0x178)],'confirmedOn':_0x517097[_0xc3d946(0x151)]['TransactionConfirmedOn']};console[_0xc3d946(0x1a6)](_0xc3d946(0x16e)),console['log'](_0xc3d946(0x18d),_0x517097[_0xc3d946(0x151)][_0xc3d946(0x166)],'->',_0x30199c),console[_0xc3d946(0x1a6)](_0xc3d946(0x17b),_0x517097[_0xc3d946(0x151)][_0xc3d946(0x128)],_0x517097[_0xc3d946(0x151)]['inputCurrency']),console['log'](_0xc3d946(0x18f),_0x517097[_0xc3d946(0x151)]['TransactionID']),console[_0xc3d946(0x1a6)](_0xc3d946(0x16b),_0x47fda6||_0xc3d946(0x17e)),console[_0xc3d946(0x1a6)](_0xc3d946(0x139),_0x517097['data'][_0xc3d946(0x178)]),console[_0xc3d946(0x1a6)](_0xc3d946(0x1a4),_0x517097['data'][_0xc3d946(0x141)]||_0xc3d946(0x18e));if(_0x517097[_0xc3d946(0x151)][_0xc3d946(0x166)]?.[_0xc3d946(0x143)]()==='awaiting\x20fiat')console[_0xc3d946(0x1a6)](_0xc3d946(0x1a1));else _0x517097[_0xc3d946(0x151)][_0xc3d946(0x166)]?.[_0xc3d946(0x143)]()===_0xc3d946(0x194)&&console['log'](_0xc3d946(0x171));return{'status':_0x30199c,'amount':parseFloat(_0x517097[_0xc3d946(0x151)][_0xc3d946(0x128)])||undefined,'currency':_0x517097[_0xc3d946(0x151)][_0xc3d946(0x149)]||_0xc3d946(0x16a),'paymentDetails':_0x2defee};}catch(_0x37401f){console['error'](_0xc3d946(0x137),_0x37401f),loggerService_1[_0xc3d946(0x1a8)][_0xc3d946(0x15c)](_0xc3d946(0x15b),'/status',_0x37401f);throw new Error(_0xc3d946(0x186)+(_0x37401f instanceof Error?_0x37401f[_0xc3d946(0x153)]:_0xc3d946(0x1a7)));}}async[a38_0xb2a811(0x16d)](_0x378566){const _0x3937ae=a38_0xb2a811,_0x3b7cad=await this['checkPaymentStatus'](_0x378566);return{'status':_0x3b7cad['status'],'amount':_0x3b7cad[_0x3937ae(0x18b)],'currency':_0x3b7cad[_0x3937ae(0x18a)]};}async[a38_0xb2a811(0x134)](_0x1fd36f){const _0x341787=a38_0xb2a811;console[_0x341787(0x1a6)](_0x341787(0x160),_0x1fd36f);let _0x1a65fa='PENDING';switch(_0x1fd36f[_0x341787(0x176)]?.[_0x341787(0x143)]()){case _0x341787(0x194):_0x1a65fa=_0x341787(0x159);break;case _0x341787(0x145):case _0x341787(0x13c):case'error':_0x1a65fa='FAILED';break;case _0x341787(0x173):case'timeout':_0x1a65fa=_0x341787(0x16c);break;case _0x341787(0x144):case _0x341787(0x18c):case _0x341787(0x183):case'created':default:_0x1a65fa=_0x341787(0x191);break;}return{'paymentId':_0x1fd36f[_0x341787(0x170)]||_0x1fd36f['merchant_reference_id']||'','status':_0x1a65fa,'amount':_0x1fd36f[_0x341787(0x18b)],'currency':_0x1fd36f[_0x341787(0x18a)]||_0x341787(0x16a)};}}exports['CoinToPayService']=CoinToPayService;