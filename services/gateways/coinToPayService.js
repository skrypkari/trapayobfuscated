'use strict';const a65_0x116389=a65_0x2456;(function(_0x400a08,_0x46770f){const _0x18cf14=a65_0x2456,_0x3ba8c1=_0x400a08();while(!![]){try{const _0x188b13=parseInt(_0x18cf14(0x232))/0x1+parseInt(_0x18cf14(0x1ed))/0x2+parseInt(_0x18cf14(0x1f6))/0x3+parseInt(_0x18cf14(0x1ce))/0x4+parseInt(_0x18cf14(0x1d7))/0x5+parseInt(_0x18cf14(0x1ea))/0x6*(-parseInt(_0x18cf14(0x234))/0x7)+-parseInt(_0x18cf14(0x1f7))/0x8;if(_0x188b13===_0x46770f)break;else _0x3ba8c1['push'](_0x3ba8c1['shift']());}catch(_0x377f26){_0x3ba8c1['push'](_0x3ba8c1['shift']());}}}(a65_0x1fe8,0x7296a));function a65_0x1fe8(){const _0x26f634=['IBAN:','Created\x20On:','paid','EXPIRED','Business\x20Error:\x20','entries','FAILED','failed','URL:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','CoinToPayService','Error\x20stack:','CreatedOn','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPay\x20API\x20error:\x20','Status',',\x20body:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','success','merchant_reference_id','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','now','fromEntries','timeout','order_id','483227THZkVl','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','7CPqprA','Status\x20Code:','/create','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','EUR','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','QRCodeURL','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','/status','Payment\x20Status:','awaiting\x20fiat','loggerService','currency','HTTP\x20Status:','../loggerService','https://tesoft.uk/gateway/cointopay/','status','ðŸ“Š\x20Status\x20check\x20URL:','gateway_payment_id','checkPaymentStatus','message','status_code','2575764gyLpXr','CoinToPay\x20payment\x20status\x20check\x20error:','Error\x20Message:','POST','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','log','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','https://tesoft.uk/gateway/cointopay/status.php','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','1215190bCuvdr','Unknown\x20error\x20from\x20CoinToPay\x20API','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','payment_url','result','created','TransactionConfirmedOn','Status\x20Text:','processWebhook','match','PENDING','JSON\x20Parse\x20Error:\x20','Response\x20data:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20data','Transaction\x20ID:','Payment\x20URL\x20(modified):','parse','error','3891636JIMpYe','TransactionID','data','305568LsXyea','===\x20COINTOPAY\x20SUCCESS\x20===','Raw\x20Response\x20Body:','Amount:','application/json','Response\x20Time:','Gateway\x20Payment\x20ID:','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','361686ZJpHxP','4204736pBjuHm','amount','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Amount','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Error\x20details:','inputCurrency','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','pending','defineProperty','waiting','not\x20found','__esModule','statusUrl','Result:','Missing\x20data\x20in\x20response','PaymentDetail','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','logWhiteDomainRequest','stringify','cointopay','Status:','Response\x20Body:','logWhiteDomainError','Payment\x20System/1.0','Headers:','apiUrl','expired'];a65_0x1fe8=function(){return _0x26f634;};return a65_0x1fe8();}Object[a65_0x116389(0x203)](exports,a65_0x116389(0x206),{'value':!![]}),exports[a65_0x116389(0x223)]=void 0x0;const loggerService_1=require(a65_0x116389(0x1c6));class CoinToPayService{constructor(){const _0x1b1004=a65_0x116389;this[_0x1b1004(0x217)]=_0x1b1004(0x1c7),this[_0x1b1004(0x207)]=_0x1b1004(0x1d5),console['log']('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x1b1004(0x1d3)](_0x1b1004(0x1c9),this[_0x1b1004(0x207)]);}async['createPaymentLink'](_0x559900){const _0x30d961=a65_0x116389,{orderId:_0x3274c1,amount:_0x8e4047}=_0x559900;console[_0x30d961(0x1d3)](_0x30d961(0x233)+_0x8e4047+'\x20EUR');const _0x4c176e={'amount':_0x8e4047},_0x5cb80c=Date[_0x30d961(0x22e)]();try{console[_0x30d961(0x1d3)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x30d961(0x221),this[_0x30d961(0x217)]),console[_0x30d961(0x1d3)]('Request\x20Body:',JSON[_0x30d961(0x210)](_0x4c176e,null,0x2)),console[_0x30d961(0x1d3)]('Amount:',_0x8e4047,_0x30d961(0x23b)),loggerService_1[_0x30d961(0x242)][_0x30d961(0x20f)](_0x30d961(0x211),_0x30d961(0x236),'POST',_0x4c176e);const _0x2e1532=await fetch(this['apiUrl'],{'method':_0x30d961(0x1d1),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x30d961(0x215)},'body':JSON[_0x30d961(0x210)](_0x4c176e)}),_0x390bc6=Date[_0x30d961(0x22e)]()-_0x5cb80c;console[_0x30d961(0x1d3)](_0x30d961(0x22d)),console[_0x30d961(0x1d3)](_0x30d961(0x212),_0x2e1532[_0x30d961(0x1c8)]),console['log'](_0x30d961(0x1de),_0x2e1532['statusText']),console[_0x30d961(0x1d3)](_0x30d961(0x216),Object[_0x30d961(0x22f)](_0x2e1532[_0x30d961(0x1fe)][_0x30d961(0x21e)]())),console[_0x30d961(0x1d3)](_0x30d961(0x1f2),_0x390bc6+'ms');const _0xabd2bb=await _0x2e1532['text']();console[_0x30d961(0x1d3)](_0x30d961(0x1ef),_0xabd2bb);if(!_0x2e1532['ok']){console[_0x30d961(0x1e9)](_0x30d961(0x201)),console[_0x30d961(0x1e9)](_0x30d961(0x244),_0x2e1532[_0x30d961(0x1c8)]),console[_0x30d961(0x1e9)](_0x30d961(0x213),_0xabd2bb),loggerService_1[_0x30d961(0x242)]['logWhiteDomainResponse']('cointopay',_0x30d961(0x236),_0x2e1532['status'],_0xabd2bb,_0x390bc6),loggerService_1[_0x30d961(0x242)]['logWhiteDomainError'](_0x30d961(0x211),_0x30d961(0x236),'HTTP\x20'+_0x2e1532[_0x30d961(0x1c8)]+':\x20'+_0xabd2bb);throw new Error(_0x30d961(0x1f5)+_0x2e1532[_0x30d961(0x1c8)]+_0x30d961(0x229)+_0xabd2bb);}let _0x1748b2;try{_0x1748b2=JSON['parse'](_0xabd2bb);}catch(_0x64366f){console[_0x30d961(0x1e9)](_0x30d961(0x20c),_0x64366f),loggerService_1[_0x30d961(0x242)][_0x30d961(0x214)](_0x30d961(0x211),_0x30d961(0x236),_0x30d961(0x1e2)+_0x64366f);throw new Error(_0x30d961(0x1d9)+_0xabd2bb);}console[_0x30d961(0x1d3)](_0x30d961(0x238)),console['log'](_0x30d961(0x237),JSON['stringify'](_0x1748b2,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x30d961(0x211),_0x30d961(0x236),_0x2e1532[_0x30d961(0x1c8)],_0x1748b2,_0x390bc6);if(_0x1748b2[_0x30d961(0x1e9)]){const _0x3fd4d3=_0x1748b2[_0x30d961(0x1cc)]||_0x1748b2['error']||_0x30d961(0x1d8);console[_0x30d961(0x1e9)](_0x30d961(0x1f9)),console['error'](_0x30d961(0x1d0),_0x3fd4d3),loggerService_1[_0x30d961(0x242)][_0x30d961(0x214)](_0x30d961(0x211),_0x30d961(0x236),_0x30d961(0x21d)+_0x3fd4d3);throw new Error(_0x30d961(0x227)+_0x3fd4d3);}if(!_0x1748b2[_0x30d961(0x1da)]||!_0x1748b2['gateway_payment_id']){console[_0x30d961(0x1e9)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x30d961(0x1e9)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x30d961(0x1e3),_0x1748b2),loggerService_1[_0x30d961(0x242)][_0x30d961(0x214)]('cointopay',_0x30d961(0x236),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log'](_0x30d961(0x1ee)),console[_0x30d961(0x1d3)](_0x30d961(0x1f3),_0x1748b2[_0x30d961(0x1ca)]),console[_0x30d961(0x1d3)]('Payment\x20URL\x20(original):',_0x1748b2[_0x30d961(0x1da)]);const _0x41fc79=_0x1748b2[_0x30d961(0x1da)]+'&alternative=false';return console[_0x30d961(0x1d3)](_0x30d961(0x1e7),_0x41fc79),console[_0x30d961(0x1d3)](_0x30d961(0x1f0),_0x8e4047,_0x30d961(0x23a)),{'gateway_payment_id':_0x1748b2[_0x30d961(0x1ca)],'payment_url':_0x41fc79};}catch(_0x2c1713){console[_0x30d961(0x1e9)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0x30d961(0x1fc),_0x2c1713),loggerService_1[_0x30d961(0x242)]['logWhiteDomainError'](_0x30d961(0x211),_0x30d961(0x236),_0x2c1713);if(_0x2c1713 instanceof Error){console[_0x30d961(0x1e9)]('Error\x20message:',_0x2c1713[_0x30d961(0x1cc)]),console[_0x30d961(0x1e9)](_0x30d961(0x224),_0x2c1713['stack']);throw new Error(_0x30d961(0x23e)+_0x2c1713[_0x30d961(0x1cc)]);}throw new Error(_0x30d961(0x222));}}async[a65_0x116389(0x1cb)](_0x399d76){const _0x2477c6=a65_0x116389,_0x44577c=Date[_0x2477c6(0x22e)]();try{console[_0x2477c6(0x1d3)](_0x2477c6(0x1d6)+_0x399d76);const _0x2d00f4={'gatewayPaymentId':_0x399d76};loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x20f)](_0x2477c6(0x211),_0x2477c6(0x23f),_0x2477c6(0x1d1),_0x2d00f4);const _0x3d8a8c=await fetch(this[_0x2477c6(0x207)],{'method':'POST','headers':{'Content-Type':_0x2477c6(0x1f1),'Accept':'application/json','User-Agent':_0x2477c6(0x215)},'body':JSON['stringify'](_0x2d00f4)}),_0x57af8a=Date['now']()-_0x44577c;console[_0x2477c6(0x1d3)](_0x2477c6(0x22a)),console[_0x2477c6(0x1d3)](_0x2477c6(0x212),_0x3d8a8c['status']),console['log'](_0x2477c6(0x1f2),_0x57af8a+'ms');if(!_0x3d8a8c['ok']){const _0x3d1e89=await _0x3d8a8c['text']();console[_0x2477c6(0x1e9)](_0x2477c6(0x244),_0x3d8a8c['status']),console[_0x2477c6(0x1e9)](_0x2477c6(0x213),_0x3d1e89),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2477c6(0x211),_0x2477c6(0x23f),_0x3d8a8c[_0x2477c6(0x1c8)],_0x3d1e89,_0x57af8a),loggerService_1['loggerService'][_0x2477c6(0x214)](_0x2477c6(0x211),_0x2477c6(0x23f),'HTTP\x20'+_0x3d8a8c[_0x2477c6(0x1c8)]+':\x20'+_0x3d1e89);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3d8a8c[_0x2477c6(0x1c8)]);}const _0x3aa2cf=await _0x3d8a8c['text']();console['log'](_0x2477c6(0x1ef),_0x3aa2cf);let _0xa938de;try{_0xa938de=JSON[_0x2477c6(0x1e8)](_0x3aa2cf);}catch(_0x943164){console['error'](_0x2477c6(0x20c),_0x943164),loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x214)](_0x2477c6(0x211),_0x2477c6(0x23f),'JSON\x20Parse\x20Error:\x20'+_0x943164);throw new Error(_0x2477c6(0x1ff)+_0x3aa2cf);}loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x23d)](_0x2477c6(0x211),_0x2477c6(0x23f),_0x3d8a8c[_0x2477c6(0x1c8)],_0xa938de,_0x57af8a),console[_0x2477c6(0x1d3)](_0x2477c6(0x1e4)),console[_0x2477c6(0x1d3)](_0x2477c6(0x208),_0xa938de[_0x2477c6(0x1db)]),console[_0x2477c6(0x1d3)](_0x2477c6(0x235),_0xa938de[_0x2477c6(0x1cd)]),console[_0x2477c6(0x1d3)](_0x2477c6(0x240),_0xa938de['data']?.[_0x2477c6(0x228)]),console['log'](_0x2477c6(0x1f0),_0xa938de[_0x2477c6(0x1ec)]?.[_0x2477c6(0x1fa)]),console[_0x2477c6(0x1d3)]('Currency:',_0xa938de[_0x2477c6(0x1ec)]?.[_0x2477c6(0x1fd)]);if(_0xa938de['result']!==_0x2477c6(0x22b)||_0xa938de[_0x2477c6(0x1cd)]!==0xc8){const _0x22609d=_0xa938de[_0x2477c6(0x1cc)]||_0x2477c6(0x1d4);console[_0x2477c6(0x1e9)](_0x2477c6(0x1fb)),console[_0x2477c6(0x1e9)](_0x2477c6(0x1d0),_0x22609d),loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x214)](_0x2477c6(0x211),'/status',_0x2477c6(0x239)+_0x22609d);throw new Error(_0x2477c6(0x1f4)+_0x22609d);}if(!_0xa938de[_0x2477c6(0x1ec)]){console[_0x2477c6(0x1e9)](_0x2477c6(0x200)),console[_0x2477c6(0x1e9)](_0x2477c6(0x209)),loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x214)]('cointopay',_0x2477c6(0x23f),_0x2477c6(0x1e5));throw new Error(_0x2477c6(0x20e));}let _0x47824a=_0x2477c6(0x1e1);switch(_0xa938de['data']['Status']?.[_0x2477c6(0x20b)]()){case _0x2477c6(0x21b):_0x47824a='PAID';break;case _0x2477c6(0x20d):case _0x2477c6(0x220):case _0x2477c6(0x1e9):_0x47824a=_0x2477c6(0x21f);break;case _0x2477c6(0x218):case _0x2477c6(0x230):_0x47824a=_0x2477c6(0x21c);break;case _0x2477c6(0x204):case _0x2477c6(0x241):case'pending':case _0x2477c6(0x1dc):default:_0x47824a=_0x2477c6(0x1e1);break;}let _0x7dcbbf,_0x4de706;if(_0xa938de['data'][_0x2477c6(0x20a)]){const _0x3e0653=_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x20a)];console[_0x2477c6(0x1d3)]('ðŸ¦\x20Payment\x20Detail:',_0x3e0653);const _0x2b0f74=_0x3e0653[_0x2477c6(0x1e0)](/IBAN\s+([A-Z0-9]+)/i);_0x2b0f74&&(_0x7dcbbf=_0x2b0f74[0x1],console[_0x2477c6(0x1d3)]('ðŸ¦\x20Extracted\x20IBAN:',_0x7dcbbf)),_0x4de706=_0x3e0653;}const _0x5a14ad={'iban':_0x7dcbbf,'bankDetails':_0x4de706,'transactionId':_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x1eb)],'coinAddress':_0xa938de[_0x2477c6(0x1ec)]['coinAddress'],'qrCodeUrl':_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x23c)],'expiryTime':_0xa938de[_0x2477c6(0x1ec)]['ExpiryTime'],'createdOn':_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x225)],'confirmedOn':_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x1dd)]};console[_0x2477c6(0x1d3)](_0x2477c6(0x1d2)),console[_0x2477c6(0x1d3)](_0x2477c6(0x212),_0xa938de[_0x2477c6(0x1ec)]['Status'],'->',_0x47824a),console[_0x2477c6(0x1d3)](_0x2477c6(0x1f0),_0xa938de['data'][_0x2477c6(0x1fa)],_0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x1fd)]),console[_0x2477c6(0x1d3)](_0x2477c6(0x1e6),_0xa938de['data'][_0x2477c6(0x1eb)]),console[_0x2477c6(0x1d3)](_0x2477c6(0x219),_0x7dcbbf||_0x2477c6(0x205)),console[_0x2477c6(0x1d3)](_0x2477c6(0x21a),_0xa938de[_0x2477c6(0x1ec)]['CreatedOn']),console['log']('Confirmed\x20On:',_0xa938de['data']['TransactionConfirmedOn']||'not\x20confirmed');if(_0xa938de['data'][_0x2477c6(0x228)]?.['toLowerCase']()===_0x2477c6(0x241))console[_0x2477c6(0x1d3)](_0x2477c6(0x226));else _0xa938de[_0x2477c6(0x1ec)][_0x2477c6(0x228)]?.['toLowerCase']()===_0x2477c6(0x21b)&&console['log']('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x47824a,'amount':parseFloat(_0xa938de['data'][_0x2477c6(0x1fa)])||undefined,'currency':_0xa938de[_0x2477c6(0x1ec)]['inputCurrency']||'EUR','paymentDetails':_0x5a14ad};}catch(_0x2e601c){console[_0x2477c6(0x1e9)](_0x2477c6(0x1cf),_0x2e601c),loggerService_1[_0x2477c6(0x242)][_0x2477c6(0x214)]('cointopay',_0x2477c6(0x23f),_0x2e601c);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2e601c instanceof Error?_0x2e601c['message']:'Unknown\x20error'));}}async['verifyPayment'](_0x26de08){const _0x2306ab=a65_0x116389,_0x56dcb5=await this['checkPaymentStatus'](_0x26de08);return{'status':_0x56dcb5[_0x2306ab(0x1c8)],'amount':_0x56dcb5[_0x2306ab(0x1f8)],'currency':_0x56dcb5[_0x2306ab(0x243)]};}async[a65_0x116389(0x1df)](_0x4f4e87){const _0x4546de=a65_0x116389;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4f4e87);let _0x212b5f=_0x4546de(0x1e1);switch(_0x4f4e87[_0x4546de(0x1c8)]?.[_0x4546de(0x20b)]()){case _0x4546de(0x21b):_0x212b5f='PAID';break;case _0x4546de(0x20d):case _0x4546de(0x220):case _0x4546de(0x1e9):_0x212b5f=_0x4546de(0x21f);break;case _0x4546de(0x218):case _0x4546de(0x230):_0x212b5f=_0x4546de(0x21c);break;case _0x4546de(0x202):case'waiting':case _0x4546de(0x241):case _0x4546de(0x1dc):default:_0x212b5f='PENDING';break;}return{'paymentId':_0x4f4e87[_0x4546de(0x231)]||_0x4f4e87[_0x4546de(0x22c)]||'','status':_0x212b5f,'amount':_0x4f4e87['amount'],'currency':_0x4f4e87[_0x4546de(0x243)]||'EUR'};}}function a65_0x2456(_0x2c9a99,_0x1111b8){_0x2c9a99=_0x2c9a99-0x1c6;const _0x1fe861=a65_0x1fe8();let _0x24563c=_0x1fe861[_0x2c9a99];return _0x24563c;}exports[a65_0x116389(0x223)]=CoinToPayService;