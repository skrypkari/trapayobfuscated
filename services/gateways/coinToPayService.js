'use strict';function a41_0x3b72(){const _0x2dcdd9=['toLowerCase','statusUrl','logWhiteDomainResponse','amount','JSON\x20Parse\x20Error:\x20','HTTP\x20','TransactionID','status_code','Error\x20Message:','not\x20confirmed','Result:','entries','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','parse','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','cancelled','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ExpiryTime','Headers:','Amount:','Response\x20Time:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','loggerService','Payment\x20Status:','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','statusText','2461192HOhDkJ','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','POST','https://tesoft.uk/gateway/cointopay/status.php','match','===\x20COINTOPAY\x20SUCCESS\x20===','89PXYkyn','12mvPrUt','logWhiteDomainError','Payment\x20URL:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20parse\x20JSON\x20response:','Parsed\x20Result:','124929XPtfXf','message','IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20API','2388612RDxTRy','Status','Status:','gateway_payment_id','checkPaymentStatus','CoinToPay\x20status\x20API\x20error:\x20','Currency:','failed','https://tesoft.uk/gateway/cointopay/','CreatedOn','EXPIRED','HTTP\x20Status:','apiUrl','inputCurrency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','1002029lJyXtj','logWhiteDomainRequest','currency','PaymentDetail','stack','PAID','HTTP\x20error!\x20status:\x20','FAILED','Created\x20On:','CoinToPay\x20payment\x20status\x20check\x20error:','11AeBIxU','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR','QRCodeURL','/create','CoinToPayService','success','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','payment_url','Unknown\x20error','/status','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Request\x20Body:','defineProperty','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','now','text','pending','processWebhook','9210tgceop','not\x20found','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','11384nnruji','Response\x20Body:','URL:','log','merchant_reference_id','application/json','verifyPayment','__esModule','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','fromEntries','üìä\x20Status\x20check\x20URL:','waiting','PENDING','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount','headers','cointopay','coinAddress','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Confirmed\x20On:','12838470wLcCRo','Raw\x20Response\x20Body:','üè¶\x20Extracted\x20IBAN:','9laKCgK','status','Error\x20stack:','paid','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','TesSoft\x20Payment\x20System/1.0','timeout','result','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','error','awaiting\x20fiat'];a41_0x3b72=function(){return _0x2dcdd9;};return a41_0x3b72();}const a41_0x10a158=a41_0x1107;function a41_0x1107(_0x219588,_0x5bfcf0){const _0x3b7257=a41_0x3b72();return a41_0x1107=function(_0x1107cd,_0x34d97b){_0x1107cd=_0x1107cd-0x76;let _0x15b9ad=_0x3b7257[_0x1107cd];return _0x15b9ad;},a41_0x1107(_0x219588,_0x5bfcf0);}(function(_0x3c8df5,_0x16d29c){const _0x3e31c9=a41_0x1107,_0x36d0d9=_0x3c8df5();while(!![]){try{const _0x5aa4e6=-parseInt(_0x3e31c9(0xd5))/0x1*(parseInt(_0x3e31c9(0x8e))/0x2)+-parseInt(_0x3e31c9(0xdc))/0x3+parseInt(_0x3e31c9(0xe0))/0x4+-parseInt(_0x3e31c9(0x8b))/0x5+parseInt(_0x3e31c9(0xd6))/0x6*(-parseInt(_0x3e31c9(0xef))/0x7)+parseInt(_0x3e31c9(0xcf))/0x8*(-parseInt(_0x3e31c9(0xa5))/0x9)+-parseInt(_0x3e31c9(0xa2))/0xa*(-parseInt(_0x3e31c9(0x76))/0xb);if(_0x5aa4e6===_0x16d29c)break;else _0x36d0d9['push'](_0x36d0d9['shift']());}catch(_0x40d6b7){_0x36d0d9['push'](_0x36d0d9['shift']());}}}(a41_0x3b72,0xb3ed8));Object[a41_0x10a158(0x85)](exports,a41_0x10a158(0x95),{'value':!![]}),exports[a41_0x10a158(0x7b)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x38fdba=a41_0x10a158;this[_0x38fdba(0xec)]=_0x38fdba(0xe8),this[_0x38fdba(0xb1)]=_0x38fdba(0xd2),console[_0x38fdba(0x91)](_0x38fdba(0xbc)),console[_0x38fdba(0x91)](_0x38fdba(0x98),this[_0x38fdba(0xb1)]);}async['createPaymentLink'](_0x1f867e){const _0x24eb63=a41_0x10a158,{orderId:_0x58b0ce,amount:_0x43e57d}=_0x1f867e;console[_0x24eb63(0x91)](_0x24eb63(0x8d)+_0x43e57d+'\x20EUR');const _0x51d27e={'amount':_0x43e57d},_0x1b6d84=Date[_0x24eb63(0x87)]();try{console[_0x24eb63(0x91)](_0x24eb63(0xcd)),console[_0x24eb63(0x91)](_0x24eb63(0x90),this[_0x24eb63(0xec)]),console[_0x24eb63(0x91)](_0x24eb63(0x84),JSON[_0x24eb63(0xca)](_0x51d27e,null,0x2)),console['log'](_0x24eb63(0xc5),_0x43e57d,_0x24eb63(0xa9)),loggerService_1[_0x24eb63(0xc8)][_0x24eb63(0xf0)]('cointopay','/create','POST',_0x51d27e);const _0x2b8423=await fetch(this[_0x24eb63(0xec)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x24eb63(0x93),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x24eb63(0xca)](_0x51d27e)}),_0x295e28=Date[_0x24eb63(0x87)]()-_0x1b6d84;console[_0x24eb63(0x91)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x24eb63(0x91)]('Status:',_0x2b8423[_0x24eb63(0xa6)]),console[_0x24eb63(0x91)]('Status\x20Text:',_0x2b8423[_0x24eb63(0xce)]),console['log'](_0x24eb63(0xc4),Object[_0x24eb63(0x97)](_0x2b8423[_0x24eb63(0x9d)][_0x24eb63(0xbb)]())),console[_0x24eb63(0x91)](_0x24eb63(0xc6),_0x295e28+'ms');const _0x125e31=await _0x2b8423[_0x24eb63(0x88)]();console['log'](_0x24eb63(0xa3),_0x125e31);if(!_0x2b8423['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x24eb63(0xae)](_0x24eb63(0xeb),_0x2b8423[_0x24eb63(0xa6)]),console[_0x24eb63(0xae)](_0x24eb63(0x8f),_0x125e31),loggerService_1[_0x24eb63(0xc8)]['logWhiteDomainResponse']('cointopay',_0x24eb63(0x7a),_0x2b8423[_0x24eb63(0xa6)],_0x125e31,_0x295e28),loggerService_1[_0x24eb63(0xc8)][_0x24eb63(0xd7)]('cointopay',_0x24eb63(0x7a),_0x24eb63(0xb5)+_0x2b8423['status']+':\x20'+_0x125e31);throw new Error(_0x24eb63(0xf5)+_0x2b8423[_0x24eb63(0xa6)]+',\x20body:\x20'+_0x125e31);}let _0x40fcae;try{_0x40fcae=JSON['parse'](_0x125e31);}catch(_0x26617b){console[_0x24eb63(0xae)](_0x24eb63(0xda),_0x26617b),loggerService_1[_0x24eb63(0xc8)][_0x24eb63(0xd7)](_0x24eb63(0x9e),_0x24eb63(0x7a),_0x24eb63(0xb4)+_0x26617b);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x125e31);}console[_0x24eb63(0x91)](_0x24eb63(0x9b)),console[_0x24eb63(0x91)](_0x24eb63(0xdb),JSON[_0x24eb63(0xca)](_0x40fcae,null,0x2)),loggerService_1[_0x24eb63(0xc8)][_0x24eb63(0xb2)](_0x24eb63(0x9e),_0x24eb63(0x7a),_0x2b8423['status'],_0x40fcae,_0x295e28);if(_0x40fcae['error']){const _0x5caa69=_0x40fcae['message']||_0x40fcae[_0x24eb63(0xae)]||_0x24eb63(0xdf);console[_0x24eb63(0xae)](_0x24eb63(0xbf)),console[_0x24eb63(0xae)](_0x24eb63(0xb8),_0x5caa69),loggerService_1['loggerService']['logWhiteDomainError'](_0x24eb63(0x9e),_0x24eb63(0x7a),'Business\x20Error:\x20'+_0x5caa69);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5caa69);}if(!_0x40fcae[_0x24eb63(0x80)]||!_0x40fcae[_0x24eb63(0xe3)]){console[_0x24eb63(0xae)](_0x24eb63(0xad)),console[_0x24eb63(0xae)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x24eb63(0xae)]('Response\x20data:',_0x40fcae),loggerService_1[_0x24eb63(0xc8)]['logWhiteDomainError'](_0x24eb63(0x9e),_0x24eb63(0x7a),_0x24eb63(0xd9));throw new Error(_0x24eb63(0xc2));}return console[_0x24eb63(0x91)](_0x24eb63(0xd4)),console['log']('Gateway\x20Payment\x20ID:',_0x40fcae[_0x24eb63(0xe3)]),console[_0x24eb63(0x91)](_0x24eb63(0xd8),_0x40fcae[_0x24eb63(0x80)]),console['log']('Amount:',_0x43e57d,_0x24eb63(0x78)),{'gateway_payment_id':_0x40fcae[_0x24eb63(0xe3)],'payment_url':_0x40fcae[_0x24eb63(0x80)]};}catch(_0x4dfce6){console['error'](_0x24eb63(0x96)),console[_0x24eb63(0xae)]('Error\x20details:',_0x4dfce6),loggerService_1[_0x24eb63(0xc8)][_0x24eb63(0xd7)](_0x24eb63(0x9e),_0x24eb63(0x7a),_0x4dfce6);if(_0x4dfce6 instanceof Error){console[_0x24eb63(0xae)]('Error\x20message:',_0x4dfce6[_0x24eb63(0xdd)]),console[_0x24eb63(0xae)](_0x24eb63(0xa7),_0x4dfce6[_0x24eb63(0xf3)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x4dfce6['message']);}throw new Error(_0x24eb63(0xee));}}async[a41_0x10a158(0xe4)](_0x419b2a){const _0x29509a=a41_0x10a158,_0x134979=Date[_0x29509a(0x87)]();try{console['log'](_0x29509a(0x7f)+_0x419b2a);const _0x317232={'gatewayPaymentId':_0x419b2a};loggerService_1[_0x29509a(0xc8)]['logWhiteDomainRequest']('cointopay',_0x29509a(0x82),_0x29509a(0xd1),_0x317232);const _0xe915b0=await fetch(this[_0x29509a(0xb1)],{'method':_0x29509a(0xd1),'headers':{'Content-Type':_0x29509a(0x93),'Accept':_0x29509a(0x93),'User-Agent':_0x29509a(0xaa)},'body':JSON[_0x29509a(0xca)](_0x317232)}),_0x5b3333=Date[_0x29509a(0x87)]()-_0x134979;console[_0x29509a(0x91)](_0x29509a(0xa0)),console[_0x29509a(0x91)](_0x29509a(0xe2),_0xe915b0[_0x29509a(0xa6)]),console['log'](_0x29509a(0xc6),_0x5b3333+'ms');if(!_0xe915b0['ok']){const _0x44e780=await _0xe915b0[_0x29509a(0x88)]();console['error'](_0x29509a(0xeb),_0xe915b0[_0x29509a(0xa6)]),console[_0x29509a(0xae)](_0x29509a(0x8f),_0x44e780),loggerService_1[_0x29509a(0xc8)][_0x29509a(0xb2)](_0x29509a(0x9e),_0x29509a(0x82),_0xe915b0[_0x29509a(0xa6)],_0x44e780,_0x5b3333),loggerService_1['loggerService'][_0x29509a(0xd7)](_0x29509a(0x9e),_0x29509a(0x82),_0x29509a(0xb5)+_0xe915b0[_0x29509a(0xa6)]+':\x20'+_0x44e780);throw new Error(_0x29509a(0xf5)+_0xe915b0[_0x29509a(0xa6)]);}const _0xb3a9dd=await _0xe915b0[_0x29509a(0x88)]();console[_0x29509a(0x91)](_0x29509a(0xa3),_0xb3a9dd);let _0x3067bf;try{_0x3067bf=JSON[_0x29509a(0xbe)](_0xb3a9dd);}catch(_0x118f79){console[_0x29509a(0xae)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x118f79),loggerService_1[_0x29509a(0xc8)]['logWhiteDomainError'](_0x29509a(0x9e),_0x29509a(0x82),_0x29509a(0xb4)+_0x118f79);throw new Error(_0x29509a(0xcb)+_0xb3a9dd);}loggerService_1[_0x29509a(0xc8)]['logWhiteDomainResponse'](_0x29509a(0x9e),'/status',_0xe915b0['status'],_0x3067bf,_0x5b3333),console[_0x29509a(0x91)](_0x29509a(0x86)),console['log'](_0x29509a(0xba),_0x3067bf['result']),console['log'](_0x29509a(0xc1),_0x3067bf[_0x29509a(0xb7)]),console['log'](_0x29509a(0xc9),_0x3067bf[_0x29509a(0xcc)]?.[_0x29509a(0xe1)]),console[_0x29509a(0x91)](_0x29509a(0xc5),_0x3067bf[_0x29509a(0xcc)]?.[_0x29509a(0x9c)]),console[_0x29509a(0x91)](_0x29509a(0xe6),_0x3067bf[_0x29509a(0xcc)]?.[_0x29509a(0xed)]);if(_0x3067bf[_0x29509a(0xac)]!==_0x29509a(0x7c)||_0x3067bf[_0x29509a(0xb7)]!==0xc8){const _0x16a8c4=_0x3067bf['message']||_0x29509a(0x7d);console['error'](_0x29509a(0x83)),console[_0x29509a(0xae)](_0x29509a(0xb8),_0x16a8c4),loggerService_1[_0x29509a(0xc8)][_0x29509a(0xd7)](_0x29509a(0x9e),_0x29509a(0x82),'Status\x20API\x20Error:\x20'+_0x16a8c4);throw new Error(_0x29509a(0xe5)+_0x16a8c4);}if(!_0x3067bf['data']){console[_0x29509a(0xae)](_0x29509a(0x77)),console[_0x29509a(0xae)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x29509a(0xd7)](_0x29509a(0x9e),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x29509a(0xbd));}let _0x3b9a34=_0x29509a(0x9a);switch(_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xe1)]?.['toLowerCase']()){case _0x29509a(0xa8):_0x3b9a34='PAID';break;case _0x29509a(0xc0):case _0x29509a(0xe7):case'error':_0x3b9a34=_0x29509a(0xf6);break;case'expired':case _0x29509a(0xab):_0x3b9a34=_0x29509a(0xea);break;case _0x29509a(0x99):case _0x29509a(0xaf):case _0x29509a(0x89):case'created':default:_0x3b9a34='PENDING';break;}let _0x5408b7,_0x3c9284;if(_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xf2)]){const _0x5718b6=_0x3067bf['data'][_0x29509a(0xf2)];console['log']('üè¶\x20Payment\x20Detail:',_0x5718b6);const _0x347970=_0x5718b6[_0x29509a(0xd3)](/IBAN\s+([A-Z0-9]+)/i);_0x347970&&(_0x5408b7=_0x347970[0x1],console[_0x29509a(0x91)](_0x29509a(0xa4),_0x5408b7)),_0x3c9284=_0x5718b6;}const _0x53436b={'iban':_0x5408b7,'bankDetails':_0x3c9284,'transactionId':_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xb6)],'coinAddress':_0x3067bf['data'][_0x29509a(0x9f)],'qrCodeUrl':_0x3067bf[_0x29509a(0xcc)][_0x29509a(0x79)],'expiryTime':_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xc3)],'createdOn':_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xe9)],'confirmedOn':_0x3067bf[_0x29509a(0xcc)]['TransactionConfirmedOn']};console[_0x29509a(0x91)](_0x29509a(0x7e)),console[_0x29509a(0x91)](_0x29509a(0xe2),_0x3067bf['data'][_0x29509a(0xe1)],'->',_0x3b9a34),console[_0x29509a(0x91)](_0x29509a(0xc5),_0x3067bf[_0x29509a(0xcc)][_0x29509a(0x9c)],_0x3067bf['data']['inputCurrency']),console[_0x29509a(0x91)]('Transaction\x20ID:',_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xb6)]),console[_0x29509a(0x91)](_0x29509a(0xde),_0x5408b7||_0x29509a(0x8c)),console[_0x29509a(0x91)](_0x29509a(0xf7),_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xe9)]),console[_0x29509a(0x91)](_0x29509a(0xa1),_0x3067bf[_0x29509a(0xcc)]['TransactionConfirmedOn']||_0x29509a(0xb9));if(_0x3067bf[_0x29509a(0xcc)]['Status']?.[_0x29509a(0xb0)]()===_0x29509a(0xaf))console[_0x29509a(0x91)](_0x29509a(0xd0));else _0x3067bf[_0x29509a(0xcc)][_0x29509a(0xe1)]?.[_0x29509a(0xb0)]()===_0x29509a(0xa8)&&console[_0x29509a(0x91)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3b9a34,'amount':parseFloat(_0x3067bf[_0x29509a(0xcc)][_0x29509a(0x9c)])||undefined,'currency':_0x3067bf[_0x29509a(0xcc)][_0x29509a(0xed)]||'EUR','paymentDetails':_0x53436b};}catch(_0x144232){console[_0x29509a(0xae)](_0x29509a(0xf8),_0x144232),loggerService_1['loggerService'][_0x29509a(0xd7)](_0x29509a(0x9e),_0x29509a(0x82),_0x144232);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x144232 instanceof Error?_0x144232[_0x29509a(0xdd)]:_0x29509a(0x81)));}}async[a41_0x10a158(0x94)](_0x3779a5){const _0x59c2b0=a41_0x10a158,_0x4fdbc7=await this['checkPaymentStatus'](_0x3779a5);return{'status':_0x4fdbc7[_0x59c2b0(0xa6)],'amount':_0x4fdbc7[_0x59c2b0(0xb3)],'currency':_0x4fdbc7[_0x59c2b0(0xf1)]};}async[a41_0x10a158(0x8a)](_0x302ae3){const _0x2b4418=a41_0x10a158;console[_0x2b4418(0x91)](_0x2b4418(0xc7),_0x302ae3);let _0x2c02f2=_0x2b4418(0x9a);switch(_0x302ae3['status']?.[_0x2b4418(0xb0)]()){case _0x2b4418(0xa8):_0x2c02f2=_0x2b4418(0xf4);break;case _0x2b4418(0xc0):case'failed':case _0x2b4418(0xae):_0x2c02f2='FAILED';break;case'expired':case _0x2b4418(0xab):_0x2c02f2=_0x2b4418(0xea);break;case _0x2b4418(0x89):case'waiting':case _0x2b4418(0xaf):case'created':default:_0x2c02f2=_0x2b4418(0x9a);break;}return{'paymentId':_0x302ae3['order_id']||_0x302ae3[_0x2b4418(0x92)]||'','status':_0x2c02f2,'amount':_0x302ae3[_0x2b4418(0xb3)],'currency':_0x302ae3[_0x2b4418(0xf1)]||_0x2b4418(0x78)};}}exports[a41_0x10a158(0x7b)]=CoinToPayService;