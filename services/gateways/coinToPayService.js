'use strict';const a40_0x4d7d60=a40_0x482a;(function(_0x508301,_0x19d4cc){const _0x206201=a40_0x482a,_0x19d354=_0x508301();while(!![]){try{const _0x53c9c2=-parseInt(_0x206201(0x181))/0x1+parseInt(_0x206201(0x18d))/0x2+parseInt(_0x206201(0x18e))/0x3*(parseInt(_0x206201(0x137))/0x4)+parseInt(_0x206201(0x19f))/0x5*(parseInt(_0x206201(0x19e))/0x6)+parseInt(_0x206201(0x177))/0x7+-parseInt(_0x206201(0x153))/0x8+-parseInt(_0x206201(0x130))/0x9*(parseInt(_0x206201(0x125))/0xa);if(_0x53c9c2===_0x19d4cc)break;else _0x19d354['push'](_0x19d354['shift']());}catch(_0x2713d5){_0x19d354['push'](_0x19d354['shift']());}}}(a40_0x3788,0xc4635));function a40_0x3788(){const _0x59b1a3=['now','expired','cancelled','cointopay','454146OimHfO','15XrKoxn','fromEntries','ExpiryTime','coinAddress','POST','Amount:','statusUrl','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','result','URL:','failed','14897910PNXGEW','üè¶\x20Extracted\x20IBAN:','payment_url','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','apiUrl','Response\x20Time:','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','QRCodeURL','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','status','9OBitrk','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','TransactionConfirmedOn','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20details:','success','20UGrNwg','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','inputCurrency','Unknown\x20error\x20from\x20CoinToPay\x20API','TesSoft\x20Payment\x20System/1.0','Confirmed\x20On:','CoinToPayService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Headers:','Amount','/status','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','application/json','Raw\x20Response\x20Body:','text','waiting','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Error\x20stack:','created',',\x20body:\x20','../loggerService','Response\x20Body:','loggerService','https://tesoft.uk/gateway/cointopay/','status_code','CreatedOn','paid','Error\x20Message:','5674032vVspMq','merchant_reference_id','Business\x20Error:\x20','HTTP\x20error!\x20status:\x20','processWebhook','entries','Status','===\x20COINTOPAY\x20SUCCESS\x20===','TransactionID','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','logWhiteDomainRequest','Incomplete\x20response:\x20missing\x20data','checkPaymentStatus','PENDING','currency','createPaymentLink','===\x20COINTOPAY\x20API\x20ERROR\x20===','Payment\x20Status:','Unknown\x20error','Status\x20API\x20Error:\x20','error','üè¶\x20Payment\x20Detail:','Status\x20Text:','log','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','gateway_payment_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','stringify','__esModule','logWhiteDomainResponse','parse','awaiting\x20fiat','HTTP\x20Status:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','11069240IMcaqa','stack','EUR','JSON\x20Parse\x20Error:\x20','Response\x20data:','HTTP\x20','Payment\x20URL:','message','PAID','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','616048XoyGpL','timeout','defineProperty','Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','pending','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','order_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','/create','toLowerCase','2008670QxmwVj','484062yTzQPd','Gateway\x20Payment\x20ID:','data','amount','statusText','PaymentDetail','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Created\x20On:','logWhiteDomainError','Status\x20Code:','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED'];a40_0x3788=function(){return _0x59b1a3;};return a40_0x3788();}Object[a40_0x4d7d60(0x183)](exports,a40_0x4d7d60(0x171),{'value':!![]}),exports[a40_0x4d7d60(0x13d)]=void 0x0;const loggerService_1=require(a40_0x4d7d60(0x14b));function a40_0x482a(_0x23a2a3,_0x1d97b8){const _0x3788c8=a40_0x3788();return a40_0x482a=function(_0x482a11,_0x47cd2f){_0x482a11=_0x482a11-0x11c;let _0x135cbd=_0x3788c8[_0x482a11];return _0x135cbd;},a40_0x482a(_0x23a2a3,_0x1d97b8);}class CoinToPayService{constructor(){const _0x15ab42=a40_0x4d7d60;this[_0x15ab42(0x129)]=_0x15ab42(0x14e),this[_0x15ab42(0x11f)]=_0x15ab42(0x15c),console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x15ab42(0x16b)](_0x15ab42(0x120),this[_0x15ab42(0x11f)]);}async[a40_0x4d7d60(0x163)](_0x1c7673){const _0x2f3f7d=a40_0x4d7d60,{orderId:_0x5e1b14,amount:_0x5047ff}=_0x1c7673;console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x176)+_0x5047ff+'\x20EUR');const _0x160312={'amount':_0x5047ff},_0x89abe7=Date[_0x2f3f7d(0x19a)]();try{console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x180)),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x123),this['apiUrl']),console[_0x2f3f7d(0x16b)]('Request\x20Body:',JSON[_0x2f3f7d(0x170)](_0x160312,null,0x2)),console['log'](_0x2f3f7d(0x11e),_0x5047ff,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x15e)]('cointopay',_0x2f3f7d(0x18b),_0x2f3f7d(0x11d),_0x160312);const _0x595320=await fetch(this[_0x2f3f7d(0x129)],{'method':_0x2f3f7d(0x11d),'headers':{'Content-Type':_0x2f3f7d(0x143),'Accept':_0x2f3f7d(0x143),'User-Agent':_0x2f3f7d(0x13b)},'body':JSON[_0x2f3f7d(0x170)](_0x160312)}),_0x5e8be6=Date[_0x2f3f7d(0x19a)]()-_0x89abe7;console['log'](_0x2f3f7d(0x121)),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x184),_0x595320[_0x2f3f7d(0x12f)]),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x16a),_0x595320[_0x2f3f7d(0x192)]),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x13f),Object[_0x2f3f7d(0x1a0)](_0x595320[_0x2f3f7d(0x12b)][_0x2f3f7d(0x158)]())),console['log']('Response\x20Time:',_0x5e8be6+'ms');const _0x450b2f=await _0x595320[_0x2f3f7d(0x145)]();console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x144),_0x450b2f);if(!_0x595320['ok']){console[_0x2f3f7d(0x168)](_0x2f3f7d(0x164)),console['error'](_0x2f3f7d(0x175),_0x595320[_0x2f3f7d(0x12f)]),console[_0x2f3f7d(0x168)](_0x2f3f7d(0x14c),_0x450b2f),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x172)](_0x2f3f7d(0x19d),_0x2f3f7d(0x18b),_0x595320[_0x2f3f7d(0x12f)],_0x450b2f,_0x5e8be6),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x196)](_0x2f3f7d(0x19d),_0x2f3f7d(0x18b),_0x2f3f7d(0x17c)+_0x595320['status']+':\x20'+_0x450b2f);throw new Error(_0x2f3f7d(0x156)+_0x595320['status']+_0x2f3f7d(0x14a)+_0x450b2f);}let _0x3776c7;try{_0x3776c7=JSON[_0x2f3f7d(0x173)](_0x450b2f);}catch(_0x3c3b24){console['error'](_0x2f3f7d(0x198),_0x3c3b24),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x196)]('cointopay','/create',_0x2f3f7d(0x17a)+_0x3c3b24);throw new Error(_0x2f3f7d(0x12c)+_0x450b2f);}console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x194)),console['log']('Parsed\x20Result:',JSON[_0x2f3f7d(0x170)](_0x3776c7,null,0x2)),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x172)](_0x2f3f7d(0x19d),_0x2f3f7d(0x18b),_0x595320['status'],_0x3776c7,_0x5e8be6);if(_0x3776c7[_0x2f3f7d(0x168)]){const _0x5da1c8=_0x3776c7[_0x2f3f7d(0x17e)]||_0x3776c7[_0x2f3f7d(0x168)]||_0x2f3f7d(0x13a);console[_0x2f3f7d(0x168)](_0x2f3f7d(0x15d)),console[_0x2f3f7d(0x168)]('Error\x20Message:',_0x5da1c8),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x196)](_0x2f3f7d(0x19d),_0x2f3f7d(0x18b),_0x2f3f7d(0x155)+_0x5da1c8);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5da1c8);}if(!_0x3776c7[_0x2f3f7d(0x127)]||!_0x3776c7['gateway_payment_id']){console[_0x2f3f7d(0x168)](_0x2f3f7d(0x16c)),console[_0x2f3f7d(0x168)](_0x2f3f7d(0x16f)),console[_0x2f3f7d(0x168)](_0x2f3f7d(0x17b),_0x3776c7),loggerService_1['loggerService'][_0x2f3f7d(0x196)](_0x2f3f7d(0x19d),'/create',_0x2f3f7d(0x13e));throw new Error(_0x2f3f7d(0x134));}return console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x15a)),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x18f),_0x3776c7[_0x2f3f7d(0x16e)]),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x17d),_0x3776c7[_0x2f3f7d(0x127)]),console[_0x2f3f7d(0x16b)](_0x2f3f7d(0x11e),_0x5047ff,_0x2f3f7d(0x179)),{'gateway_payment_id':_0x3776c7[_0x2f3f7d(0x16e)],'payment_url':_0x3776c7[_0x2f3f7d(0x127)]};}catch(_0x42567c){console['error'](_0x2f3f7d(0x147)),console[_0x2f3f7d(0x168)](_0x2f3f7d(0x135),_0x42567c),loggerService_1[_0x2f3f7d(0x14d)][_0x2f3f7d(0x196)](_0x2f3f7d(0x19d),_0x2f3f7d(0x18b),_0x42567c);if(_0x42567c instanceof Error){console[_0x2f3f7d(0x168)]('Error\x20message:',_0x42567c[_0x2f3f7d(0x17e)]),console[_0x2f3f7d(0x168)](_0x2f3f7d(0x148),_0x42567c[_0x2f3f7d(0x178)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x42567c[_0x2f3f7d(0x17e)]);}throw new Error(_0x2f3f7d(0x185));}}async['checkPaymentStatus'](_0x3b78a2){const _0x48bd77=a40_0x4d7d60,_0x489ea4=Date[_0x48bd77(0x19a)]();try{console['log'](_0x48bd77(0x12e)+_0x3b78a2);const _0x1b9907={'gatewayPaymentId':_0x3b78a2};loggerService_1[_0x48bd77(0x14d)][_0x48bd77(0x15e)](_0x48bd77(0x19d),_0x48bd77(0x141),_0x48bd77(0x11d),_0x1b9907);const _0x51fca6=await fetch(this[_0x48bd77(0x11f)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x48bd77(0x143),'User-Agent':_0x48bd77(0x13b)},'body':JSON[_0x48bd77(0x170)](_0x1b9907)}),_0x19f469=Date[_0x48bd77(0x19a)]()-_0x489ea4;console[_0x48bd77(0x16b)](_0x48bd77(0x142)),console[_0x48bd77(0x16b)](_0x48bd77(0x184),_0x51fca6[_0x48bd77(0x12f)]),console[_0x48bd77(0x16b)](_0x48bd77(0x12a),_0x19f469+'ms');if(!_0x51fca6['ok']){const _0x4464e6=await _0x51fca6['text']();console[_0x48bd77(0x168)]('HTTP\x20Status:',_0x51fca6[_0x48bd77(0x12f)]),console[_0x48bd77(0x168)](_0x48bd77(0x14c),_0x4464e6),loggerService_1[_0x48bd77(0x14d)][_0x48bd77(0x172)](_0x48bd77(0x19d),_0x48bd77(0x141),_0x51fca6[_0x48bd77(0x12f)],_0x4464e6,_0x19f469),loggerService_1[_0x48bd77(0x14d)][_0x48bd77(0x196)](_0x48bd77(0x19d),_0x48bd77(0x141),_0x48bd77(0x17c)+_0x51fca6[_0x48bd77(0x12f)]+':\x20'+_0x4464e6);throw new Error(_0x48bd77(0x156)+_0x51fca6['status']);}const _0x13cb99=await _0x51fca6['text']();console[_0x48bd77(0x16b)](_0x48bd77(0x144),_0x13cb99);let _0x98953c;try{_0x98953c=JSON[_0x48bd77(0x173)](_0x13cb99);}catch(_0x5b2aee){console['error'](_0x48bd77(0x198),_0x5b2aee),loggerService_1['loggerService']['logWhiteDomainError'](_0x48bd77(0x19d),_0x48bd77(0x141),_0x48bd77(0x17a)+_0x5b2aee);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x13cb99);}loggerService_1[_0x48bd77(0x14d)]['logWhiteDomainResponse']('cointopay',_0x48bd77(0x141),_0x51fca6[_0x48bd77(0x12f)],_0x98953c,_0x19f469),console['log'](_0x48bd77(0x138)),console[_0x48bd77(0x16b)]('Result:',_0x98953c[_0x48bd77(0x122)]),console[_0x48bd77(0x16b)](_0x48bd77(0x197),_0x98953c[_0x48bd77(0x14f)]),console[_0x48bd77(0x16b)](_0x48bd77(0x165),_0x98953c['data']?.[_0x48bd77(0x159)]),console[_0x48bd77(0x16b)](_0x48bd77(0x11e),_0x98953c['data']?.[_0x48bd77(0x140)]),console[_0x48bd77(0x16b)]('Currency:',_0x98953c[_0x48bd77(0x190)]?.[_0x48bd77(0x139)]);if(_0x98953c['result']!==_0x48bd77(0x136)||_0x98953c['status_code']!==0xc8){const _0x6597ec=_0x98953c[_0x48bd77(0x17e)]||_0x48bd77(0x186);console[_0x48bd77(0x168)](_0x48bd77(0x128)),console[_0x48bd77(0x168)](_0x48bd77(0x152),_0x6597ec),loggerService_1['loggerService'][_0x48bd77(0x196)](_0x48bd77(0x19d),'/status',_0x48bd77(0x167)+_0x6597ec);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x6597ec);}if(!_0x98953c['data']){console[_0x48bd77(0x168)](_0x48bd77(0x16d)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x48bd77(0x14d)][_0x48bd77(0x196)](_0x48bd77(0x19d),_0x48bd77(0x141),_0x48bd77(0x15f));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x4f6fb9=_0x48bd77(0x161);switch(_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x159)]?.[_0x48bd77(0x18c)]()){case _0x48bd77(0x151):_0x4f6fb9='PAID';break;case'cancelled':case _0x48bd77(0x124):case _0x48bd77(0x168):_0x4f6fb9='FAILED';break;case'expired':case _0x48bd77(0x182):_0x4f6fb9=_0x48bd77(0x199);break;case _0x48bd77(0x146):case'awaiting\x20fiat':case'pending':case _0x48bd77(0x149):default:_0x4f6fb9=_0x48bd77(0x161);break;}let _0x3136b6,_0x14aa81;if(_0x98953c['data'][_0x48bd77(0x193)]){const _0x41e780=_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x193)];console['log'](_0x48bd77(0x169),_0x41e780);const _0x4b7b1a=_0x41e780[_0x48bd77(0x132)](/IBAN\s+([A-Z0-9]+)/i);_0x4b7b1a&&(_0x3136b6=_0x4b7b1a[0x1],console['log'](_0x48bd77(0x126),_0x3136b6)),_0x14aa81=_0x41e780;}const _0x316fa3={'iban':_0x3136b6,'bankDetails':_0x14aa81,'transactionId':_0x98953c['data'][_0x48bd77(0x15b)],'coinAddress':_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x11c)],'qrCodeUrl':_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x12d)],'expiryTime':_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x1a1)],'createdOn':_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x150)],'confirmedOn':_0x98953c[_0x48bd77(0x190)]['TransactionConfirmedOn']};console[_0x48bd77(0x16b)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x48bd77(0x16b)]('Status:',_0x98953c[_0x48bd77(0x190)]['Status'],'->',_0x4f6fb9),console[_0x48bd77(0x16b)](_0x48bd77(0x11e),_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x140)],_0x98953c[_0x48bd77(0x190)]['inputCurrency']),console[_0x48bd77(0x16b)]('Transaction\x20ID:',_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x15b)]),console['log']('IBAN:',_0x3136b6||'not\x20found'),console[_0x48bd77(0x16b)](_0x48bd77(0x195),_0x98953c[_0x48bd77(0x190)]['CreatedOn']),console[_0x48bd77(0x16b)](_0x48bd77(0x13c),_0x98953c['data'][_0x48bd77(0x133)]||'not\x20confirmed');if(_0x98953c['data'][_0x48bd77(0x159)]?.[_0x48bd77(0x18c)]()===_0x48bd77(0x174))console[_0x48bd77(0x16b)](_0x48bd77(0x188));else _0x98953c['data']['Status']?.[_0x48bd77(0x18c)]()===_0x48bd77(0x151)&&console[_0x48bd77(0x16b)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x4f6fb9,'amount':parseFloat(_0x98953c['data'][_0x48bd77(0x140)])||undefined,'currency':_0x98953c[_0x48bd77(0x190)][_0x48bd77(0x139)]||_0x48bd77(0x179),'paymentDetails':_0x316fa3};}catch(_0x55d52f){console[_0x48bd77(0x168)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x55d52f),loggerService_1['loggerService'][_0x48bd77(0x196)](_0x48bd77(0x19d),_0x48bd77(0x141),_0x55d52f);throw new Error(_0x48bd77(0x131)+(_0x55d52f instanceof Error?_0x55d52f['message']:_0x48bd77(0x166)));}}async['verifyPayment'](_0x5891cd){const _0x1d99ca=a40_0x4d7d60,_0x3d6ed6=await this[_0x1d99ca(0x160)](_0x5891cd);return{'status':_0x3d6ed6['status'],'amount':_0x3d6ed6['amount'],'currency':_0x3d6ed6[_0x1d99ca(0x162)]};}async[a40_0x4d7d60(0x157)](_0x5f07b7){const _0x49e9fa=a40_0x4d7d60;console[_0x49e9fa(0x16b)](_0x49e9fa(0x18a),_0x5f07b7);let _0x35d7f6=_0x49e9fa(0x161);switch(_0x5f07b7[_0x49e9fa(0x12f)]?.['toLowerCase']()){case _0x49e9fa(0x151):_0x35d7f6=_0x49e9fa(0x17f);break;case _0x49e9fa(0x19c):case _0x49e9fa(0x124):case _0x49e9fa(0x168):_0x35d7f6='FAILED';break;case _0x49e9fa(0x19b):case _0x49e9fa(0x182):_0x35d7f6='EXPIRED';break;case _0x49e9fa(0x187):case'waiting':case _0x49e9fa(0x174):case _0x49e9fa(0x149):default:_0x35d7f6=_0x49e9fa(0x161);break;}return{'paymentId':_0x5f07b7[_0x49e9fa(0x189)]||_0x5f07b7[_0x49e9fa(0x154)]||'','status':_0x35d7f6,'amount':_0x5f07b7[_0x49e9fa(0x191)],'currency':_0x5f07b7[_0x49e9fa(0x162)]||'EUR'};}}exports[a40_0x4d7d60(0x13d)]=CoinToPayService;