'use strict';function a43_0xc0e9(_0xc9e29f,_0x27b515){const _0x30583c=a43_0x3058();return a43_0xc0e9=function(_0xc0e945,_0x1751b1){_0xc0e945=_0xc0e945-0x145;let _0xcd63c9=_0x30583c[_0xc0e945];return _0xcd63c9;},a43_0xc0e9(_0xc9e29f,_0x27b515);}const a43_0x45bd00=a43_0xc0e9;(function(_0x12dba0,_0x47d839){const _0x46190e=a43_0xc0e9,_0x17a0f1=_0x12dba0();while(!![]){try{const _0xe2bab7=-parseInt(_0x46190e(0x155))/0x1+parseInt(_0x46190e(0x19c))/0x2*(-parseInt(_0x46190e(0x1b5))/0x3)+parseInt(_0x46190e(0x1c5))/0x4*(-parseInt(_0x46190e(0x17b))/0x5)+parseInt(_0x46190e(0x16f))/0x6*(parseInt(_0x46190e(0x1a0))/0x7)+-parseInt(_0x46190e(0x18f))/0x8+-parseInt(_0x46190e(0x180))/0x9*(parseInt(_0x46190e(0x1bb))/0xa)+parseInt(_0x46190e(0x164))/0xb*(parseInt(_0x46190e(0x152))/0xc);if(_0xe2bab7===_0x47d839)break;else _0x17a0f1['push'](_0x17a0f1['shift']());}catch(_0x2f569b){_0x17a0f1['push'](_0x17a0f1['shift']());}}}(a43_0x3058,0x3d48a));Object[a43_0x45bd00(0x170)](exports,a43_0x45bd00(0x1b0),{'value':!![]}),exports[a43_0x45bd00(0x186)]=void 0x0;const loggerService_1=require(a43_0x45bd00(0x1af));class CoinToPayService{constructor(){const _0x3145bb=a43_0x45bd00;this[_0x3145bb(0x187)]=_0x3145bb(0x167),this[_0x3145bb(0x1a3)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3145bb(0x185)](_0x3145bb(0x175)),console[_0x3145bb(0x185)]('📊\x20Status\x20check\x20URL:',this[_0x3145bb(0x1a3)]);}async[a43_0x45bd00(0x160)](_0x110b27){const _0xdc64c5=a43_0x45bd00,{orderId:_0xd5aa1a,amount:_0x29042d}=_0x110b27;console[_0xdc64c5(0x185)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x29042d+_0xdc64c5(0x177));const _0x189d84={'amount':_0x29042d},_0x3ad6e9=Date['now']();try{console['log'](_0xdc64c5(0x1b6)),console[_0xdc64c5(0x185)]('URL:',this[_0xdc64c5(0x187)]),console[_0xdc64c5(0x185)]('Request\x20Body:',JSON['stringify'](_0x189d84,null,0x2)),console[_0xdc64c5(0x185)]('Amount:',_0x29042d,_0xdc64c5(0x1a1)),loggerService_1[_0xdc64c5(0x1c7)]['logWhiteDomainRequest'](_0xdc64c5(0x14a),'/create',_0xdc64c5(0x1ab),_0x189d84);const _0x336c92=await fetch(this['apiUrl'],{'method':_0xdc64c5(0x1ab),'headers':{'Content-Type':_0xdc64c5(0x19f),'Accept':_0xdc64c5(0x19f),'User-Agent':_0xdc64c5(0x146)},'body':JSON[_0xdc64c5(0x14e)](_0x189d84)}),_0x19942d=Date[_0xdc64c5(0x184)]()-_0x3ad6e9;console[_0xdc64c5(0x185)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xdc64c5(0x193),_0x336c92[_0xdc64c5(0x199)]),console['log'](_0xdc64c5(0x169),_0x336c92['statusText']),console[_0xdc64c5(0x185)]('Headers:',Object[_0xdc64c5(0x172)](_0x336c92[_0xdc64c5(0x1c6)][_0xdc64c5(0x157)]())),console[_0xdc64c5(0x185)]('Response\x20Time:',_0x19942d+'ms');const _0x21d2ac=await _0x336c92[_0xdc64c5(0x16b)]();console[_0xdc64c5(0x185)]('Raw\x20Response\x20Body:',_0x21d2ac);if(!_0x336c92['ok']){console[_0xdc64c5(0x176)](_0xdc64c5(0x178)),console[_0xdc64c5(0x176)](_0xdc64c5(0x195),_0x336c92[_0xdc64c5(0x199)]),console[_0xdc64c5(0x176)](_0xdc64c5(0x1a7),_0x21d2ac),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x149)](_0xdc64c5(0x14a),_0xdc64c5(0x15d),_0x336c92[_0xdc64c5(0x199)],_0x21d2ac,_0x19942d),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x162)](_0xdc64c5(0x14a),_0xdc64c5(0x15d),_0xdc64c5(0x16c)+_0x336c92[_0xdc64c5(0x199)]+':\x20'+_0x21d2ac);throw new Error('HTTP\x20error!\x20status:\x20'+_0x336c92[_0xdc64c5(0x199)]+_0xdc64c5(0x192)+_0x21d2ac);}let _0x48e482;try{_0x48e482=JSON[_0xdc64c5(0x1c3)](_0x21d2ac);}catch(_0x24ca35){console[_0xdc64c5(0x176)](_0xdc64c5(0x1c9),_0x24ca35),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x162)](_0xdc64c5(0x14a),'/create','JSON\x20Parse\x20Error:\x20'+_0x24ca35);throw new Error(_0xdc64c5(0x18b)+_0x21d2ac);}console['log'](_0xdc64c5(0x1c4)),console[_0xdc64c5(0x185)](_0xdc64c5(0x150),JSON[_0xdc64c5(0x14e)](_0x48e482,null,0x2)),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x149)](_0xdc64c5(0x14a),'/create',_0x336c92['status'],_0x48e482,_0x19942d);if(_0x48e482[_0xdc64c5(0x176)]){const _0x59eb02=_0x48e482[_0xdc64c5(0x153)]||_0x48e482[_0xdc64c5(0x176)]||_0xdc64c5(0x1a5);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xdc64c5(0x176)](_0xdc64c5(0x19b),_0x59eb02),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x162)]('cointopay','/create',_0xdc64c5(0x188)+_0x59eb02);throw new Error(_0xdc64c5(0x16e)+_0x59eb02);}if(!_0x48e482[_0xdc64c5(0x1c8)]||!_0x48e482['gateway_payment_id']){console[_0xdc64c5(0x176)](_0xdc64c5(0x148)),console[_0xdc64c5(0x176)](_0xdc64c5(0x1ca)),console[_0xdc64c5(0x176)](_0xdc64c5(0x17e),_0x48e482),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x162)]('cointopay',_0xdc64c5(0x15d),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0xdc64c5(0x185)](_0xdc64c5(0x181)),console[_0xdc64c5(0x185)](_0xdc64c5(0x1bd),_0x48e482[_0xdc64c5(0x15e)]),console['log']('Payment\x20URL:',_0x48e482['payment_url']),console['log']('Amount:',_0x29042d,_0xdc64c5(0x1b3)),{'gateway_payment_id':_0x48e482['gateway_payment_id'],'payment_url':_0x48e482['payment_url']};}catch(_0x3b1c8d){console[_0xdc64c5(0x176)](_0xdc64c5(0x1b7)),console['error']('Error\x20details:',_0x3b1c8d),loggerService_1[_0xdc64c5(0x1c7)][_0xdc64c5(0x162)](_0xdc64c5(0x14a),'/create',_0x3b1c8d);if(_0x3b1c8d instanceof Error){console[_0xdc64c5(0x176)](_0xdc64c5(0x1ae),_0x3b1c8d[_0xdc64c5(0x153)]),console[_0xdc64c5(0x176)](_0xdc64c5(0x1c0),_0x3b1c8d[_0xdc64c5(0x1a6)]);throw new Error(_0xdc64c5(0x189)+_0x3b1c8d[_0xdc64c5(0x153)]);}throw new Error(_0xdc64c5(0x1aa));}}async[a43_0x45bd00(0x17c)](_0x2f7aff){const _0x628396=a43_0x45bd00,_0x569ea0=Date[_0x628396(0x184)]();try{console[_0x628396(0x185)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x2f7aff);const _0x3b0734={'gatewayPaymentId':_0x2f7aff};loggerService_1[_0x628396(0x1c7)][_0x628396(0x1b4)]('cointopay','/status',_0x628396(0x1ab),_0x3b0734);const _0x3d6bd2=await fetch(this[_0x628396(0x1a3)],{'method':'POST','headers':{'Content-Type':_0x628396(0x19f),'Accept':_0x628396(0x19f),'User-Agent':_0x628396(0x146)},'body':JSON[_0x628396(0x14e)](_0x3b0734)}),_0x8bc4d5=Date[_0x628396(0x184)]()-_0x569ea0;console[_0x628396(0x185)](_0x628396(0x1b9)),console[_0x628396(0x185)](_0x628396(0x193),_0x3d6bd2[_0x628396(0x199)]),console['log']('Response\x20Time:',_0x8bc4d5+'ms');if(!_0x3d6bd2['ok']){const _0x2d01c0=await _0x3d6bd2[_0x628396(0x16b)]();console[_0x628396(0x176)](_0x628396(0x195),_0x3d6bd2[_0x628396(0x199)]),console[_0x628396(0x176)](_0x628396(0x1a7),_0x2d01c0),loggerService_1[_0x628396(0x1c7)]['logWhiteDomainResponse']('cointopay',_0x628396(0x182),_0x3d6bd2['status'],_0x2d01c0,_0x8bc4d5),loggerService_1[_0x628396(0x1c7)][_0x628396(0x162)](_0x628396(0x14a),'/status',_0x628396(0x16c)+_0x3d6bd2[_0x628396(0x199)]+':\x20'+_0x2d01c0);throw new Error(_0x628396(0x196)+_0x3d6bd2['status']);}const _0x2614fc=await _0x3d6bd2[_0x628396(0x16b)]();console[_0x628396(0x185)](_0x628396(0x1bf),_0x2614fc);let _0x150bf9;try{_0x150bf9=JSON[_0x628396(0x1c3)](_0x2614fc);}catch(_0x28bcdb){console[_0x628396(0x176)](_0x628396(0x1c9),_0x28bcdb),loggerService_1[_0x628396(0x1c7)][_0x628396(0x162)]('cointopay',_0x628396(0x182),_0x628396(0x168)+_0x28bcdb);throw new Error(_0x628396(0x17f)+_0x2614fc);}loggerService_1['loggerService'][_0x628396(0x149)]('cointopay',_0x628396(0x182),_0x3d6bd2[_0x628396(0x199)],_0x150bf9,_0x8bc4d5),console['log'](_0x628396(0x1ba)),console['log']('Result:',_0x150bf9[_0x628396(0x1b1)]),console[_0x628396(0x185)](_0x628396(0x156),_0x150bf9[_0x628396(0x1a4)]),console['log']('Payment\x20Status:',_0x150bf9['data']?.['Status']),console['log'](_0x628396(0x1b2),_0x150bf9[_0x628396(0x18c)]?.[_0x628396(0x17a)]),console[_0x628396(0x185)](_0x628396(0x163),_0x150bf9['data']?.[_0x628396(0x179)]);if(_0x150bf9[_0x628396(0x1b1)]!=='success'||_0x150bf9[_0x628396(0x1a4)]!==0xc8){const _0x3c51b2=_0x150bf9[_0x628396(0x153)]||_0x628396(0x18d);console[_0x628396(0x176)](_0x628396(0x15f)),console['error'](_0x628396(0x19b),_0x3c51b2),loggerService_1[_0x628396(0x1c7)][_0x628396(0x162)](_0x628396(0x14a),_0x628396(0x182),_0x628396(0x18e)+_0x3c51b2);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x3c51b2);}if(!_0x150bf9[_0x628396(0x18c)]){console[_0x628396(0x176)](_0x628396(0x171)),console[_0x628396(0x176)](_0x628396(0x14b)),loggerService_1['loggerService'][_0x628396(0x162)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x628396(0x191));}let _0x3fd46e='PENDING';switch(_0x150bf9[_0x628396(0x18c)][_0x628396(0x147)]?.[_0x628396(0x161)]()){case'paid':_0x3fd46e=_0x628396(0x145);break;case'cancelled':case _0x628396(0x16a):case _0x628396(0x176):_0x3fd46e=_0x628396(0x14d);break;case'expired':case'timeout':_0x3fd46e=_0x628396(0x165);break;case'waiting':case _0x628396(0x14f):case'pending':case _0x628396(0x15b):default:_0x3fd46e=_0x628396(0x1be);break;}let _0x341706,_0x48d019;if(_0x150bf9[_0x628396(0x18c)][_0x628396(0x19e)]){const _0x565cee=_0x150bf9[_0x628396(0x18c)][_0x628396(0x19e)];console[_0x628396(0x185)](_0x628396(0x190),_0x565cee);const _0x430697=_0x565cee[_0x628396(0x1a2)](/IBAN\s+([A-Z0-9]+)/i);_0x430697&&(_0x341706=_0x430697[0x1],console[_0x628396(0x185)]('🏦\x20Extracted\x20IBAN:',_0x341706)),_0x48d019=_0x565cee;}const _0x9c111b={'iban':_0x341706,'bankDetails':_0x48d019,'transactionId':_0x150bf9['data'][_0x628396(0x1ad)],'coinAddress':_0x150bf9[_0x628396(0x18c)]['coinAddress'],'qrCodeUrl':_0x150bf9[_0x628396(0x18c)]['QRCodeURL'],'expiryTime':_0x150bf9[_0x628396(0x18c)][_0x628396(0x194)],'createdOn':_0x150bf9[_0x628396(0x18c)][_0x628396(0x14c)],'confirmedOn':_0x150bf9[_0x628396(0x18c)]['TransactionConfirmedOn']};console[_0x628396(0x185)](_0x628396(0x1b8)),console[_0x628396(0x185)]('Status:',_0x150bf9[_0x628396(0x18c)]['Status'],'->',_0x3fd46e),console[_0x628396(0x185)]('Amount:',_0x150bf9['data'][_0x628396(0x17a)],_0x150bf9[_0x628396(0x18c)]['inputCurrency']),console[_0x628396(0x185)](_0x628396(0x17d),_0x150bf9[_0x628396(0x18c)]['TransactionID']),console[_0x628396(0x185)](_0x628396(0x1bc),_0x341706||_0x628396(0x173)),console[_0x628396(0x185)](_0x628396(0x174),_0x150bf9['data'][_0x628396(0x14c)]),console[_0x628396(0x185)](_0x628396(0x1a8),_0x150bf9[_0x628396(0x18c)][_0x628396(0x18a)]||_0x628396(0x19d));if(_0x150bf9['data']['Status']?.['toLowerCase']()===_0x628396(0x14f))console['log'](_0x628396(0x15c));else _0x150bf9['data']['Status']?.[_0x628396(0x161)]()==='paid'&&console['log'](_0x628396(0x166));return{'status':_0x3fd46e,'amount':parseFloat(_0x150bf9[_0x628396(0x18c)]['Amount'])||undefined,'currency':_0x150bf9[_0x628396(0x18c)][_0x628396(0x179)]||_0x628396(0x1b3),'paymentDetails':_0x9c111b};}catch(_0x1b4a72){console[_0x628396(0x176)](_0x628396(0x1a9),_0x1b4a72),loggerService_1[_0x628396(0x1c7)][_0x628396(0x162)](_0x628396(0x14a),'/status',_0x1b4a72);throw new Error(_0x628396(0x154)+(_0x1b4a72 instanceof Error?_0x1b4a72[_0x628396(0x153)]:_0x628396(0x151)));}}async[a43_0x45bd00(0x1ac)](_0x27d805){const _0x25d085=a43_0x45bd00,_0x1f8e75=await this[_0x25d085(0x17c)](_0x27d805);return{'status':_0x1f8e75[_0x25d085(0x199)],'amount':_0x1f8e75['amount'],'currency':_0x1f8e75[_0x25d085(0x158)]};}async[a43_0x45bd00(0x1c1)](_0x3c1cf8){const _0x58c016=a43_0x45bd00;console[_0x58c016(0x185)](_0x58c016(0x19a),_0x3c1cf8);let _0x544980=_0x58c016(0x1be);switch(_0x3c1cf8[_0x58c016(0x199)]?.[_0x58c016(0x161)]()){case'paid':_0x544980='PAID';break;case'cancelled':case _0x58c016(0x16a):case _0x58c016(0x176):_0x544980=_0x58c016(0x14d);break;case _0x58c016(0x15a):case _0x58c016(0x183):_0x544980=_0x58c016(0x165);break;case _0x58c016(0x16d):case _0x58c016(0x197):case _0x58c016(0x14f):case _0x58c016(0x15b):default:_0x544980='PENDING';break;}return{'paymentId':_0x3c1cf8[_0x58c016(0x1c2)]||_0x3c1cf8[_0x58c016(0x198)]||'','status':_0x544980,'amount':_0x3c1cf8[_0x58c016(0x159)],'currency':_0x3c1cf8['currency']||_0x58c016(0x1b3)};}}exports['CoinToPayService']=CoinToPayService;function a43_0x3058(){const _0x5710fb=['4OmBWpC','headers','loggerService','payment_url','Failed\x20to\x20parse\x20JSON\x20response:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','PAID','TesSoft\x20Payment\x20System/1.0','Status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','cointopay','Missing\x20data\x20in\x20response','CreatedOn','FAILED','stringify','awaiting\x20fiat','Parsed\x20Result:','Unknown\x20error','17176164ZxUeBD','message','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','177768DsjlQp','Status\x20Code:','entries','currency','amount','expired','created','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','/create','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','createPaymentLink','toLowerCase','logWhiteDomainError','Currency:','11pGkpdp','EXPIRED','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/','JSON\x20Parse\x20Error:\x20','Status\x20Text:','failed','text','HTTP\x20','pending','CoinToPay\x20API\x20error:\x20','17484FyoMXB','defineProperty','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','not\x20found','Created\x20On:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','error','\x20EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','inputCurrency','Amount','1618435QdwUgq','checkPaymentStatus','Transaction\x20ID:','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','54EtFFXI','===\x20COINTOPAY\x20SUCCESS\x20===','/status','timeout','now','log','CoinToPayService','apiUrl','Business\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','TransactionConfirmedOn','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Status\x20API\x20Error:\x20','1847976cCPLFi','🏦\x20Payment\x20Detail:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data',',\x20body:\x20','Status:','ExpiryTime','HTTP\x20Status:','HTTP\x20error!\x20status:\x20','waiting','merchant_reference_id','status','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Error\x20Message:','570462cmMEBE','not\x20confirmed','PaymentDetail','application/json','455pFewbQ','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','match','statusUrl','status_code','Unknown\x20error\x20from\x20CoinToPay\x20API','stack','Response\x20Body:','Confirmed\x20On:','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','POST','verifyPayment','TransactionID','Error\x20message:','../loggerService','__esModule','result','Amount:','EUR','logWhiteDomainRequest','3AYOwNx','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','586760wfNasu','IBAN:','Gateway\x20Payment\x20ID:','PENDING','Raw\x20Response\x20Body:','Error\x20stack:','processWebhook','order_id','parse','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='];a43_0x3058=function(){return _0x5710fb;};return a43_0x3058();}