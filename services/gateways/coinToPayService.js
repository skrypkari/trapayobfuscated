'use strict';const a40_0x4cdc61=a40_0x2267;(function(_0x1e2034,_0x1ef604){const _0x3cc536=a40_0x2267,_0x4c82cf=_0x1e2034();while(!![]){try{const _0x26b3bd=-parseInt(_0x3cc536(0x181))/0x1*(-parseInt(_0x3cc536(0x18f))/0x2)+parseInt(_0x3cc536(0x12d))/0x3*(-parseInt(_0x3cc536(0x182))/0x4)+parseInt(_0x3cc536(0x16a))/0x5*(parseInt(_0x3cc536(0x12e))/0x6)+parseInt(_0x3cc536(0x180))/0x7*(-parseInt(_0x3cc536(0x120))/0x8)+-parseInt(_0x3cc536(0x12f))/0x9+parseInt(_0x3cc536(0x154))/0xa*(parseInt(_0x3cc536(0x152))/0xb)+-parseInt(_0x3cc536(0x167))/0xc*(-parseInt(_0x3cc536(0x133))/0xd);if(_0x26b3bd===_0x1ef604)break;else _0x4c82cf['push'](_0x4c82cf['shift']());}catch(_0x1b0d82){_0x4c82cf['push'](_0x4c82cf['shift']());}}}(a40_0x336c,0x1e09a));function a40_0x336c(){const _0x48ed88=['stack','PENDING','HTTP\x20','waiting','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','1316tkAojl','59mlJohX','2012pznOgz','TransactionID','Status:','QRCodeURL','gateway_payment_id',',\x20body:\x20','Payment\x20Status:','Amount','statusUrl','error','/create','TransactionConfirmedOn','log','478LdzgfL','Request\x20Body:','status_code','Error\x20message:','CoinToPay\x20status\x20API\x20error:\x20','../loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','/status','apiUrl','paid','Response\x20Body:','checkPaymentStatus','Failed\x20to\x20parse\x20JSON\x20response:','statusText','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','5944TVcXYj','cancelled','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','pending','awaiting\x20fiat','status','Status','Error\x20details:','processWebhook','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','IBAN:','payment_url','417YAffLB','416802wWPSwV','1519695rQaaEH','CoinToPay\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','result','2275377GDQneS','message','logWhiteDomainRequest','https://tesoft.uk/gateway/cointopay/','POST','JSON\x20Parse\x20Error:\x20','Response\x20Time:','fromEntries','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Currency:','Headers:','defineProperty','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status\x20Code:','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PAID','data','logWhiteDomainResponse','verifyPayment','CoinToPayService','HTTP\x20Status:','loggerService','logWhiteDomainError','Parsed\x20Result:','headers','EUR','__esModule','11SIajNj','failed','2428930fhcceu','===\x20COINTOPAY\x20SUCCESS\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üè¶\x20Extracted\x20IBAN:','Transaction\x20ID:','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','expired','merchant_reference_id','amount','parse','Error\x20Message:','FAILED','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','now','HTTP\x20error!\x20status:\x20','CreatedOn','12tOeUaJ','inputCurrency','Status\x20Text:','5OgQIke','application/json','Raw\x20Response\x20Body:','Error\x20stack:','stringify','Result:','cointopay','EXPIRED','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','toLowerCase','https://tesoft.uk/gateway/cointopay/status.php','text','Unknown\x20error','created','Amount:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id'];a40_0x336c=function(){return _0x48ed88;};return a40_0x336c();}Object[a40_0x4cdc61(0x13f)](exports,a40_0x4cdc61(0x151),{'value':!![]}),exports[a40_0x4cdc61(0x14a)]=void 0x0;function a40_0x2267(_0x1605c6,_0xe66f6a){const _0x336cd5=a40_0x336c();return a40_0x2267=function(_0x22676a,_0x5e6e31){_0x22676a=_0x22676a-0x11c;let _0x430fc5=_0x336cd5[_0x22676a];return _0x430fc5;},a40_0x2267(_0x1605c6,_0xe66f6a);}const loggerService_1=require(a40_0x4cdc61(0x194));class CoinToPayService{constructor(){const _0x14d4a3=a40_0x4cdc61;this['apiUrl']=_0x14d4a3(0x136),this[_0x14d4a3(0x18a)]=_0x14d4a3(0x174),console[_0x14d4a3(0x18e)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x14d4a3(0x15b),this['statusUrl']);}async['createPaymentLink'](_0x293f62){const _0x2ef714=a40_0x4cdc61,{orderId:_0x4bfa9d,amount:_0xa2609e}=_0x293f62;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0xa2609e+'\x20EUR');const _0x4d41bd={'amount':_0xa2609e},_0x4f187d=Date['now']();try{console[_0x2ef714(0x18e)](_0x2ef714(0x140)),console['log']('URL:',this[_0x2ef714(0x197)]),console[_0x2ef714(0x18e)](_0x2ef714(0x190),JSON[_0x2ef714(0x16e)](_0x4d41bd,null,0x2)),console[_0x2ef714(0x18e)]('Amount:',_0xa2609e,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x135)](_0x2ef714(0x170),_0x2ef714(0x18c),_0x2ef714(0x137),_0x4d41bd);const _0x3d5618=await fetch(this[_0x2ef714(0x197)],{'method':_0x2ef714(0x137),'headers':{'Content-Type':'application/json','Accept':_0x2ef714(0x16b),'User-Agent':_0x2ef714(0x131)},'body':JSON['stringify'](_0x4d41bd)}),_0x131435=Date[_0x2ef714(0x164)]()-_0x4f187d;console[_0x2ef714(0x18e)](_0x2ef714(0x145)),console[_0x2ef714(0x18e)](_0x2ef714(0x184),_0x3d5618[_0x2ef714(0x125)]),console[_0x2ef714(0x18e)](_0x2ef714(0x169),_0x3d5618[_0x2ef714(0x11d)]),console['log'](_0x2ef714(0x13e),Object[_0x2ef714(0x13a)](_0x3d5618[_0x2ef714(0x14f)]['entries']())),console[_0x2ef714(0x18e)](_0x2ef714(0x139),_0x131435+'ms');const _0x3f08c5=await _0x3d5618[_0x2ef714(0x175)]();console[_0x2ef714(0x18e)](_0x2ef714(0x16c),_0x3f08c5);if(!_0x3d5618['ok']){console[_0x2ef714(0x18b)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x2ef714(0x14b),_0x3d5618['status']),console[_0x2ef714(0x18b)](_0x2ef714(0x199),_0x3f08c5),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x148)]('cointopay','/create',_0x3d5618[_0x2ef714(0x125)],_0x3f08c5,_0x131435),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x14d)](_0x2ef714(0x170),_0x2ef714(0x18c),_0x2ef714(0x17c)+_0x3d5618[_0x2ef714(0x125)]+':\x20'+_0x3f08c5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3d5618['status']+_0x2ef714(0x187)+_0x3f08c5);}let _0x4cd185;try{_0x4cd185=JSON[_0x2ef714(0x160)](_0x3f08c5);}catch(_0x5658f3){console[_0x2ef714(0x18b)](_0x2ef714(0x11c),_0x5658f3),loggerService_1[_0x2ef714(0x14c)]['logWhiteDomainError'](_0x2ef714(0x170),_0x2ef714(0x18c),_0x2ef714(0x138)+_0x5658f3);throw new Error(_0x2ef714(0x163)+_0x3f08c5);}console[_0x2ef714(0x18e)](_0x2ef714(0x13c)),console[_0x2ef714(0x18e)](_0x2ef714(0x14e),JSON[_0x2ef714(0x16e)](_0x4cd185,null,0x2)),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x148)](_0x2ef714(0x170),'/create',_0x3d5618[_0x2ef714(0x125)],_0x4cd185,_0x131435);if(_0x4cd185[_0x2ef714(0x18b)]){const _0x5e4f73=_0x4cd185[_0x2ef714(0x134)]||_0x4cd185[_0x2ef714(0x18b)]||_0x2ef714(0x11f);console[_0x2ef714(0x18b)](_0x2ef714(0x12a)),console['error'](_0x2ef714(0x161),_0x5e4f73),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x14d)](_0x2ef714(0x170),_0x2ef714(0x18c),'Business\x20Error:\x20'+_0x5e4f73);throw new Error(_0x2ef714(0x130)+_0x5e4f73);}if(!_0x4cd185['payment_url']||!_0x4cd185['gateway_payment_id']){console[_0x2ef714(0x18b)](_0x2ef714(0x144)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x4cd185),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x14d)]('cointopay',_0x2ef714(0x18c),_0x2ef714(0x15a));throw new Error(_0x2ef714(0x179));}return console[_0x2ef714(0x18e)](_0x2ef714(0x155)),console[_0x2ef714(0x18e)]('Gateway\x20Payment\x20ID:',_0x4cd185[_0x2ef714(0x186)]),console[_0x2ef714(0x18e)]('Payment\x20URL:',_0x4cd185['payment_url']),console['log']('Amount:',_0xa2609e,_0x2ef714(0x150)),{'gateway_payment_id':_0x4cd185['gateway_payment_id'],'payment_url':_0x4cd185[_0x2ef714(0x12c)]};}catch(_0x50c412){console[_0x2ef714(0x18b)](_0x2ef714(0x15c)),console[_0x2ef714(0x18b)](_0x2ef714(0x127),_0x50c412),loggerService_1[_0x2ef714(0x14c)][_0x2ef714(0x14d)](_0x2ef714(0x170),'/create',_0x50c412);if(_0x50c412 instanceof Error){console[_0x2ef714(0x18b)](_0x2ef714(0x192),_0x50c412[_0x2ef714(0x134)]),console[_0x2ef714(0x18b)](_0x2ef714(0x16d),_0x50c412[_0x2ef714(0x17a)]);throw new Error(_0x2ef714(0x17f)+_0x50c412[_0x2ef714(0x134)]);}throw new Error(_0x2ef714(0x195));}}async[a40_0x4cdc61(0x19a)](_0x1b3ea0){const _0x389366=a40_0x4cdc61,_0x3b3f6a=Date[_0x389366(0x164)]();try{console[_0x389366(0x18e)](_0x389366(0x141)+_0x1b3ea0);const _0x1709b4={'gatewayPaymentId':_0x1b3ea0};loggerService_1[_0x389366(0x14c)][_0x389366(0x135)](_0x389366(0x170),_0x389366(0x196),_0x389366(0x137),_0x1709b4);const _0x24e3e0=await fetch(this[_0x389366(0x18a)],{'method':_0x389366(0x137),'headers':{'Content-Type':_0x389366(0x16b),'Accept':_0x389366(0x16b),'User-Agent':_0x389366(0x131)},'body':JSON['stringify'](_0x1709b4)}),_0xb92735=Date[_0x389366(0x164)]()-_0x3b3f6a;console[_0x389366(0x18e)](_0x389366(0x11e)),console[_0x389366(0x18e)](_0x389366(0x184),_0x24e3e0[_0x389366(0x125)]),console[_0x389366(0x18e)]('Response\x20Time:',_0xb92735+'ms');if(!_0x24e3e0['ok']){const _0x36f624=await _0x24e3e0[_0x389366(0x175)]();console[_0x389366(0x18b)](_0x389366(0x14b),_0x24e3e0[_0x389366(0x125)]),console[_0x389366(0x18b)](_0x389366(0x199),_0x36f624),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x389366(0x196),_0x24e3e0[_0x389366(0x125)],_0x36f624,_0xb92735),loggerService_1['loggerService'][_0x389366(0x14d)](_0x389366(0x170),_0x389366(0x196),_0x389366(0x17c)+_0x24e3e0['status']+':\x20'+_0x36f624);throw new Error(_0x389366(0x165)+_0x24e3e0[_0x389366(0x125)]);}const _0x163918=await _0x24e3e0[_0x389366(0x175)]();console[_0x389366(0x18e)](_0x389366(0x16c),_0x163918);let _0x10091f;try{_0x10091f=JSON[_0x389366(0x160)](_0x163918);}catch(_0x1040b9){console[_0x389366(0x18b)](_0x389366(0x11c),_0x1040b9),loggerService_1['loggerService'][_0x389366(0x14d)]('cointopay','/status',_0x389366(0x138)+_0x1040b9);throw new Error(_0x389366(0x13b)+_0x163918);}loggerService_1[_0x389366(0x14c)]['logWhiteDomainResponse']('cointopay','/status',_0x24e3e0['status'],_0x10091f,_0xb92735),console[_0x389366(0x18e)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x389366(0x16f),_0x10091f[_0x389366(0x132)]),console[_0x389366(0x18e)](_0x389366(0x142),_0x10091f[_0x389366(0x191)]),console['log'](_0x389366(0x188),_0x10091f[_0x389366(0x147)]?.[_0x389366(0x126)]),console[_0x389366(0x18e)](_0x389366(0x178),_0x10091f[_0x389366(0x147)]?.[_0x389366(0x189)]),console['log'](_0x389366(0x13d),_0x10091f[_0x389366(0x147)]?.[_0x389366(0x168)]);if(_0x10091f['result']!=='success'||_0x10091f['status_code']!==0xc8){const _0x47207b=_0x10091f[_0x389366(0x134)]||_0x389366(0x129);console[_0x389366(0x18b)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x389366(0x18b)](_0x389366(0x161),_0x47207b),loggerService_1[_0x389366(0x14c)][_0x389366(0x14d)](_0x389366(0x170),'/status',_0x389366(0x159)+_0x47207b);throw new Error(_0x389366(0x193)+_0x47207b);}if(!_0x10091f[_0x389366(0x147)]){console[_0x389366(0x18b)](_0x389366(0x17e)),console[_0x389366(0x18b)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x389366(0x14c)][_0x389366(0x14d)](_0x389366(0x170),_0x389366(0x196),_0x389366(0x143));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x438ad5=_0x389366(0x17b);switch(_0x10091f[_0x389366(0x147)][_0x389366(0x126)]?.[_0x389366(0x173)]()){case _0x389366(0x198):_0x438ad5=_0x389366(0x146);break;case _0x389366(0x121):case _0x389366(0x153):case _0x389366(0x18b):_0x438ad5='FAILED';break;case _0x389366(0x15d):case'timeout':_0x438ad5=_0x389366(0x171);break;case _0x389366(0x17d):case _0x389366(0x124):case _0x389366(0x123):case'created':default:_0x438ad5='PENDING';break;}let _0xff60a3,_0x1ad216;if(_0x10091f[_0x389366(0x147)]['PaymentDetail']){const _0x51588f=_0x10091f[_0x389366(0x147)]['PaymentDetail'];console[_0x389366(0x18e)]('üè¶\x20Payment\x20Detail:',_0x51588f);const _0x380e41=_0x51588f['match'](/IBAN\s+([A-Z0-9]+)/i);_0x380e41&&(_0xff60a3=_0x380e41[0x1],console['log'](_0x389366(0x157),_0xff60a3)),_0x1ad216=_0x51588f;}const _0x8ecbd1={'iban':_0xff60a3,'bankDetails':_0x1ad216,'transactionId':_0x10091f[_0x389366(0x147)][_0x389366(0x183)],'coinAddress':_0x10091f[_0x389366(0x147)]['coinAddress'],'qrCodeUrl':_0x10091f[_0x389366(0x147)][_0x389366(0x185)],'expiryTime':_0x10091f[_0x389366(0x147)]['ExpiryTime'],'createdOn':_0x10091f[_0x389366(0x147)][_0x389366(0x166)],'confirmedOn':_0x10091f['data'][_0x389366(0x18d)]};console[_0x389366(0x18e)](_0x389366(0x172)),console[_0x389366(0x18e)](_0x389366(0x184),_0x10091f[_0x389366(0x147)]['Status'],'->',_0x438ad5),console[_0x389366(0x18e)](_0x389366(0x178),_0x10091f['data']['Amount'],_0x10091f[_0x389366(0x147)][_0x389366(0x168)]),console[_0x389366(0x18e)](_0x389366(0x158),_0x10091f[_0x389366(0x147)]['TransactionID']),console[_0x389366(0x18e)](_0x389366(0x12b),_0xff60a3||'not\x20found'),console[_0x389366(0x18e)]('Created\x20On:',_0x10091f[_0x389366(0x147)][_0x389366(0x166)]),console[_0x389366(0x18e)]('Confirmed\x20On:',_0x10091f[_0x389366(0x147)][_0x389366(0x18d)]||'not\x20confirmed');if(_0x10091f[_0x389366(0x147)][_0x389366(0x126)]?.[_0x389366(0x173)]()===_0x389366(0x124))console[_0x389366(0x18e)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x10091f[_0x389366(0x147)]['Status']?.[_0x389366(0x173)]()===_0x389366(0x198)&&console['log'](_0x389366(0x156));return{'status':_0x438ad5,'amount':parseFloat(_0x10091f[_0x389366(0x147)][_0x389366(0x189)])||undefined,'currency':_0x10091f['data'][_0x389366(0x168)]||_0x389366(0x150),'paymentDetails':_0x8ecbd1};}catch(_0x342621){console[_0x389366(0x18b)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x342621),loggerService_1[_0x389366(0x14c)][_0x389366(0x14d)](_0x389366(0x170),'/status',_0x342621);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x342621 instanceof Error?_0x342621[_0x389366(0x134)]:_0x389366(0x176)));}}async[a40_0x4cdc61(0x149)](_0x5d6af5){const _0x194690=a40_0x4cdc61,_0x5067d0=await this['checkPaymentStatus'](_0x5d6af5);return{'status':_0x5067d0[_0x194690(0x125)],'amount':_0x5067d0[_0x194690(0x15f)],'currency':_0x5067d0['currency']};}async[a40_0x4cdc61(0x128)](_0x2be93e){const _0x5a5036=a40_0x4cdc61;console[_0x5a5036(0x18e)](_0x5a5036(0x122),_0x2be93e);let _0x5c6052=_0x5a5036(0x17b);switch(_0x2be93e[_0x5a5036(0x125)]?.['toLowerCase']()){case _0x5a5036(0x198):_0x5c6052='PAID';break;case _0x5a5036(0x121):case'failed':case _0x5a5036(0x18b):_0x5c6052=_0x5a5036(0x162);break;case _0x5a5036(0x15d):case'timeout':_0x5c6052=_0x5a5036(0x171);break;case _0x5a5036(0x123):case'waiting':case'awaiting\x20fiat':case _0x5a5036(0x177):default:_0x5c6052=_0x5a5036(0x17b);break;}return{'paymentId':_0x2be93e['order_id']||_0x2be93e[_0x5a5036(0x15e)]||'','status':_0x5c6052,'amount':_0x2be93e[_0x5a5036(0x15f)],'currency':_0x2be93e['currency']||'EUR'};}}exports['CoinToPayService']=CoinToPayService;