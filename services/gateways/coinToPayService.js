'use strict';function a44_0x3e08(_0x5a7bc6,_0x527de8){const _0x11e553=a44_0x11e5();return a44_0x3e08=function(_0x3e0870,_0x42e792){_0x3e0870=_0x3e0870-0x1e4;let _0x32daf1=_0x11e553[_0x3e0870];return _0x32daf1;},a44_0x3e08(_0x5a7bc6,_0x527de8);}function a44_0x11e5(){const _0x365a16=['Missing\x20data\x20in\x20response','Headers:','statusText','Response\x20Time:','payment_url','not\x20found','match','===\x20COINTOPAY\x20API\x20ERROR\x20===','Payment\x20Status:','1895322oShLNi','PaymentDetail','Currency:','\x20EUR','status_code','PENDING','4206824lbIlQj','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','PAID','QRCodeURL','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','cointopay','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','10VCOxTN','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','FAILED','inputCurrency','EXPIRED','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','checkPaymentStatus','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','40CHufoV','CoinToPay\x20payment\x20status\x20check\x20error:','parse','28603010CjrBQH','loggerService','text','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','stringify','Response\x20data:','statusUrl','/status','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','error','amount','currency','Error\x20details:','data','toLowerCase','success','expired','Unknown\x20error','TesSoft\x20Payment\x20System/1.0','Amount','gateway_payment_id','URL:','created','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','fromEntries','Error\x20Message:','Confirmed\x20On:','3KYuHxD','===\x20COINTOPAY\x20SUCCESS\x20===','ExpiryTime','merchant_reference_id','https://tesoft.uk/gateway/cointopay/status.php','🪙\x20Creating\x20CoinToPay\x20payment:\x20','POST','Status\x20Code:','entries',',\x20body:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','failed','7445394NmcfcU','Response\x20Body:','Status\x20Text:','message','application/json','https://tesoft.uk/gateway/cointopay/','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','coinAddress','CoinToPay\x20API\x20error:\x20','headers','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CoinToPayService','HTTP\x20Status:','Created\x20On:','Transaction\x20ID:','EUR','stack','IBAN:','Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','HTTP\x20error!\x20status:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','__esModule','Amount:','Gateway\x20Payment\x20ID:','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainRequest','Payment\x20URL:','now','654836XItdNK','Error\x20stack:','TransactionConfirmedOn','not\x20confirmed','log','processWebhook','Status\x20API\x20Error:\x20','Status','status','result','TransactionID','HTTP\x20','apiUrl','1891834jPCWwS','Incomplete\x20response:\x20missing\x20data','Result:','Unknown\x20error\x20from\x20CoinToPay\x20API','pending','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainError','Request\x20Body:','2124186ZvhVTk','Error\x20message:','CreatedOn','timeout','cancelled','defineProperty','paid','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Business\x20Error:\x20','/create','Raw\x20Response\x20Body:','awaiting\x20fiat'];a44_0x11e5=function(){return _0x365a16;};return a44_0x11e5();}const a44_0x6e9178=a44_0x3e08;(function(_0x357ce0,_0x5cde95){const _0x862a41=a44_0x3e08,_0x5d6bb6=_0x357ce0();while(!![]){try{const _0x40b685=-parseInt(_0x862a41(0x23e))/0x1+-parseInt(_0x862a41(0x268))/0x2+parseInt(_0x862a41(0x211))/0x3*(parseInt(_0x862a41(0x26e))/0x4)+-parseInt(_0x862a41(0x1e8))/0x5*(-parseInt(_0x862a41(0x253))/0x6)+-parseInt(_0x862a41(0x24b))/0x7*(parseInt(_0x862a41(0x1f3))/0x8)+-parseInt(_0x862a41(0x21d))/0x9+parseInt(_0x862a41(0x1f6))/0xa;if(_0x40b685===_0x5cde95)break;else _0x5d6bb6['push'](_0x5d6bb6['shift']());}catch(_0x58047d){_0x5d6bb6['push'](_0x5d6bb6['shift']());}}}(a44_0x11e5,0xccd54));Object[a44_0x6e9178(0x258)](exports,a44_0x6e9178(0x237),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x4088bd=a44_0x6e9178;this['apiUrl']=_0x4088bd(0x222),this[_0x4088bd(0x1fc)]=_0x4088bd(0x215),console[_0x4088bd(0x242)](_0x4088bd(0x1f1)),console['log']('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x50b5d8){const _0x55c5c0=a44_0x6e9178,{orderId:_0x241f04,amount:_0x3e870b}=_0x50b5d8;console[_0x55c5c0(0x242)](_0x55c5c0(0x216)+_0x3e870b+_0x55c5c0(0x26b));const _0x396eaa={'amount':_0x3e870b},_0x49754b=Date[_0x55c5c0(0x23d)]();try{console[_0x55c5c0(0x242)](_0x55c5c0(0x1e9)),console[_0x55c5c0(0x242)](_0x55c5c0(0x20b),this[_0x55c5c0(0x24a)]),console[_0x55c5c0(0x242)](_0x55c5c0(0x252),JSON[_0x55c5c0(0x1fa)](_0x396eaa,null,0x2)),console[_0x55c5c0(0x242)](_0x55c5c0(0x238),_0x3e870b,_0x55c5c0(0x1e4)),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x23b)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),_0x55c5c0(0x217),_0x396eaa);const _0x1d7923=await fetch(this[_0x55c5c0(0x24a)],{'method':'POST','headers':{'Content-Type':_0x55c5c0(0x221),'Accept':_0x55c5c0(0x221),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x396eaa)}),_0x3169b1=Date[_0x55c5c0(0x23d)]()-_0x49754b;console[_0x55c5c0(0x242)](_0x55c5c0(0x1fe)),console[_0x55c5c0(0x242)](_0x55c5c0(0x231),_0x1d7923[_0x55c5c0(0x246)]),console['log'](_0x55c5c0(0x21f),_0x1d7923[_0x55c5c0(0x261)]),console[_0x55c5c0(0x242)](_0x55c5c0(0x260),Object[_0x55c5c0(0x20e)](_0x1d7923[_0x55c5c0(0x227)][_0x55c5c0(0x219)]())),console[_0x55c5c0(0x242)](_0x55c5c0(0x262),_0x3169b1+'ms');const _0x433487=await _0x1d7923[_0x55c5c0(0x1f8)]();console[_0x55c5c0(0x242)]('Raw\x20Response\x20Body:',_0x433487);if(!_0x1d7923['ok']){console['error'](_0x55c5c0(0x266)),console[_0x55c5c0(0x1ff)]('HTTP\x20Status:',_0x1d7923[_0x55c5c0(0x246)]),console[_0x55c5c0(0x1ff)](_0x55c5c0(0x21e),_0x433487),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x223)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),_0x1d7923[_0x55c5c0(0x246)],_0x433487,_0x3169b1),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x251)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),_0x55c5c0(0x249)+_0x1d7923[_0x55c5c0(0x246)]+':\x20'+_0x433487);throw new Error(_0x55c5c0(0x235)+_0x1d7923[_0x55c5c0(0x246)]+_0x55c5c0(0x21a)+_0x433487);}let _0x989058;try{_0x989058=JSON['parse'](_0x433487);}catch(_0x5ae8b8){console['error'](_0x55c5c0(0x23a),_0x5ae8b8),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x251)]('cointopay',_0x55c5c0(0x25c),_0x55c5c0(0x228)+_0x5ae8b8);throw new Error(_0x55c5c0(0x232)+_0x433487);}console[_0x55c5c0(0x242)](_0x55c5c0(0x1f9)),console[_0x55c5c0(0x242)]('Parsed\x20Result:',JSON['stringify'](_0x989058,null,0x2)),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x223)]('cointopay',_0x55c5c0(0x25c),_0x1d7923[_0x55c5c0(0x246)],_0x989058,_0x3169b1);if(_0x989058[_0x55c5c0(0x1ff)]){const _0x26a3a1=_0x989058[_0x55c5c0(0x220)]||_0x989058['error']||_0x55c5c0(0x24e);console['error'](_0x55c5c0(0x1eb)),console['error'](_0x55c5c0(0x20f),_0x26a3a1),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x251)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),_0x55c5c0(0x25b)+_0x26a3a1);throw new Error(_0x55c5c0(0x226)+_0x26a3a1);}if(!_0x989058['payment_url']||!_0x989058['gateway_payment_id']){console[_0x55c5c0(0x1ff)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x55c5c0(0x26f)),console[_0x55c5c0(0x1ff)](_0x55c5c0(0x1fb),_0x989058),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x251)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x55c5c0(0x1e7));}return console[_0x55c5c0(0x242)](_0x55c5c0(0x212)),console[_0x55c5c0(0x242)](_0x55c5c0(0x239),_0x989058['gateway_payment_id']),console['log'](_0x55c5c0(0x23c),_0x989058[_0x55c5c0(0x263)]),console['log'](_0x55c5c0(0x238),_0x3e870b,_0x55c5c0(0x22e)),{'gateway_payment_id':_0x989058[_0x55c5c0(0x20a)],'payment_url':_0x989058[_0x55c5c0(0x263)]};}catch(_0x322d10){console[_0x55c5c0(0x1ff)](_0x55c5c0(0x21b)),console[_0x55c5c0(0x1ff)](_0x55c5c0(0x202),_0x322d10),loggerService_1[_0x55c5c0(0x1f7)][_0x55c5c0(0x251)](_0x55c5c0(0x1e6),_0x55c5c0(0x25c),_0x322d10);if(_0x322d10 instanceof Error){console[_0x55c5c0(0x1ff)](_0x55c5c0(0x254),_0x322d10[_0x55c5c0(0x220)]),console[_0x55c5c0(0x1ff)](_0x55c5c0(0x23f),_0x322d10[_0x55c5c0(0x22f)]);throw new Error(_0x55c5c0(0x25a)+_0x322d10[_0x55c5c0(0x220)]);}throw new Error(_0x55c5c0(0x250));}}async[a44_0x6e9178(0x1f0)](_0x9842ca){const _0x239d7f=a44_0x6e9178,_0xf51bd2=Date[_0x239d7f(0x23d)]();try{console[_0x239d7f(0x242)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x9842ca);const _0xb81c7f={'gatewayPaymentId':_0x9842ca};loggerService_1[_0x239d7f(0x1f7)][_0x239d7f(0x23b)]('cointopay','/status','POST',_0xb81c7f);const _0x355057=await fetch(this['statusUrl'],{'method':_0x239d7f(0x217),'headers':{'Content-Type':_0x239d7f(0x221),'Accept':_0x239d7f(0x221),'User-Agent':_0x239d7f(0x208)},'body':JSON['stringify'](_0xb81c7f)}),_0x5a331b=Date[_0x239d7f(0x23d)]()-_0xf51bd2;console[_0x239d7f(0x242)](_0x239d7f(0x20d)),console[_0x239d7f(0x242)](_0x239d7f(0x231),_0x355057[_0x239d7f(0x246)]),console[_0x239d7f(0x242)](_0x239d7f(0x262),_0x5a331b+'ms');if(!_0x355057['ok']){const _0x585afb=await _0x355057[_0x239d7f(0x1f8)]();console[_0x239d7f(0x1ff)](_0x239d7f(0x22b),_0x355057[_0x239d7f(0x246)]),console['error']('Response\x20Body:',_0x585afb),loggerService_1[_0x239d7f(0x1f7)]['logWhiteDomainResponse'](_0x239d7f(0x1e6),'/status',_0x355057['status'],_0x585afb,_0x5a331b),loggerService_1[_0x239d7f(0x1f7)][_0x239d7f(0x251)]('cointopay',_0x239d7f(0x1fd),'HTTP\x20'+_0x355057[_0x239d7f(0x246)]+':\x20'+_0x585afb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x355057['status']);}const _0x432d98=await _0x355057[_0x239d7f(0x1f8)]();console[_0x239d7f(0x242)](_0x239d7f(0x25d),_0x432d98);let _0x296cea;try{_0x296cea=JSON[_0x239d7f(0x1f5)](_0x432d98);}catch(_0x547663){console['error'](_0x239d7f(0x23a),_0x547663),loggerService_1['loggerService']['logWhiteDomainError'](_0x239d7f(0x1e6),'/status',_0x239d7f(0x228)+_0x547663);throw new Error(_0x239d7f(0x233)+_0x432d98);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x239d7f(0x1e6),'/status',_0x355057[_0x239d7f(0x246)],_0x296cea,_0x5a331b),console[_0x239d7f(0x242)](_0x239d7f(0x1f2)),console['log'](_0x239d7f(0x24d),_0x296cea[_0x239d7f(0x247)]),console[_0x239d7f(0x242)](_0x239d7f(0x218),_0x296cea[_0x239d7f(0x26c)]),console['log'](_0x239d7f(0x267),_0x296cea[_0x239d7f(0x203)]?.[_0x239d7f(0x245)]),console[_0x239d7f(0x242)]('Amount:',_0x296cea['data']?.[_0x239d7f(0x209)]),console['log'](_0x239d7f(0x26a),_0x296cea[_0x239d7f(0x203)]?.[_0x239d7f(0x1ed)]);if(_0x296cea[_0x239d7f(0x247)]!==_0x239d7f(0x205)||_0x296cea[_0x239d7f(0x26c)]!==0xc8){const _0x2d75e3=_0x296cea[_0x239d7f(0x220)]||_0x239d7f(0x234);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x239d7f(0x20f),_0x2d75e3),loggerService_1[_0x239d7f(0x1f7)]['logWhiteDomainError'](_0x239d7f(0x1e6),_0x239d7f(0x1fd),_0x239d7f(0x244)+_0x2d75e3);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x2d75e3);}if(!_0x296cea['data']){console['error'](_0x239d7f(0x229)),console[_0x239d7f(0x1ff)](_0x239d7f(0x25f)),loggerService_1[_0x239d7f(0x1f7)]['logWhiteDomainError'](_0x239d7f(0x1e6),_0x239d7f(0x1fd),_0x239d7f(0x24c));throw new Error(_0x239d7f(0x1ef));}let _0x4efb22=_0x239d7f(0x26d);switch(_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x245)]?.['toLowerCase']()){case _0x239d7f(0x259):_0x4efb22=_0x239d7f(0x270);break;case _0x239d7f(0x257):case _0x239d7f(0x21c):case _0x239d7f(0x1ff):_0x4efb22='FAILED';break;case _0x239d7f(0x206):case _0x239d7f(0x256):_0x4efb22=_0x239d7f(0x1ee);break;case'waiting':case'awaiting\x20fiat':case _0x239d7f(0x24f):case'created':default:_0x4efb22='PENDING';break;}let _0x60fac8,_0x419fcd;if(_0x296cea['data'][_0x239d7f(0x269)]){const _0x663fcd=_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x269)];console[_0x239d7f(0x242)]('🏦\x20Payment\x20Detail:',_0x663fcd);const _0x295ad3=_0x663fcd[_0x239d7f(0x265)](/IBAN\s+([A-Z0-9]+)/i);_0x295ad3&&(_0x60fac8=_0x295ad3[0x1],console[_0x239d7f(0x242)]('🏦\x20Extracted\x20IBAN:',_0x60fac8)),_0x419fcd=_0x663fcd;}const _0x468510={'iban':_0x60fac8,'bankDetails':_0x419fcd,'transactionId':_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x248)],'coinAddress':_0x296cea['data'][_0x239d7f(0x225)],'qrCodeUrl':_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x271)],'expiryTime':_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x213)],'createdOn':_0x296cea['data'][_0x239d7f(0x255)],'confirmedOn':_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x240)]};console[_0x239d7f(0x242)](_0x239d7f(0x224)),console[_0x239d7f(0x242)]('Status:',_0x296cea[_0x239d7f(0x203)]['Status'],'->',_0x4efb22),console[_0x239d7f(0x242)]('Amount:',_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x209)],_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x1ed)]),console[_0x239d7f(0x242)](_0x239d7f(0x22d),_0x296cea['data'][_0x239d7f(0x248)]),console[_0x239d7f(0x242)](_0x239d7f(0x230),_0x60fac8||_0x239d7f(0x264)),console[_0x239d7f(0x242)](_0x239d7f(0x22c),_0x296cea[_0x239d7f(0x203)]['CreatedOn']),console[_0x239d7f(0x242)](_0x239d7f(0x210),_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x240)]||_0x239d7f(0x241));if(_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x245)]?.[_0x239d7f(0x204)]()===_0x239d7f(0x25e))console[_0x239d7f(0x242)](_0x239d7f(0x1ea));else _0x296cea[_0x239d7f(0x203)]['Status']?.['toLowerCase']()===_0x239d7f(0x259)&&console[_0x239d7f(0x242)](_0x239d7f(0x1e5));return{'status':_0x4efb22,'amount':parseFloat(_0x296cea[_0x239d7f(0x203)]['Amount'])||undefined,'currency':_0x296cea[_0x239d7f(0x203)][_0x239d7f(0x1ed)]||_0x239d7f(0x22e),'paymentDetails':_0x468510};}catch(_0x2900d3){console[_0x239d7f(0x1ff)](_0x239d7f(0x1f4),_0x2900d3),loggerService_1[_0x239d7f(0x1f7)][_0x239d7f(0x251)](_0x239d7f(0x1e6),_0x239d7f(0x1fd),_0x2900d3);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2900d3 instanceof Error?_0x2900d3[_0x239d7f(0x220)]:_0x239d7f(0x207)));}}async['verifyPayment'](_0x33b7c8){const _0x560d21=a44_0x6e9178,_0x3d96be=await this[_0x560d21(0x1f0)](_0x33b7c8);return{'status':_0x3d96be['status'],'amount':_0x3d96be['amount'],'currency':_0x3d96be[_0x560d21(0x201)]};}async[a44_0x6e9178(0x243)](_0x2e5f6c){const _0x589087=a44_0x6e9178;console['log'](_0x589087(0x236),_0x2e5f6c);let _0x5b59ee=_0x589087(0x26d);switch(_0x2e5f6c[_0x589087(0x246)]?.[_0x589087(0x204)]()){case _0x589087(0x259):_0x5b59ee='PAID';break;case _0x589087(0x257):case _0x589087(0x21c):case _0x589087(0x1ff):_0x5b59ee=_0x589087(0x1ec);break;case _0x589087(0x206):case _0x589087(0x256):_0x5b59ee=_0x589087(0x1ee);break;case _0x589087(0x24f):case'waiting':case _0x589087(0x25e):case _0x589087(0x20c):default:_0x5b59ee=_0x589087(0x26d);break;}return{'paymentId':_0x2e5f6c['order_id']||_0x2e5f6c[_0x589087(0x214)]||'','status':_0x5b59ee,'amount':_0x2e5f6c[_0x589087(0x200)],'currency':_0x2e5f6c[_0x589087(0x201)]||_0x589087(0x22e)};}}exports[a44_0x6e9178(0x22a)]=CoinToPayService;