'use strict';const a49_0x281bef=a49_0x1dce;(function(_0x4ced60,_0x5cb346){const _0x5227d6=a49_0x1dce,_0x173b5f=_0x4ced60();while(!![]){try{const _0x139046=parseInt(_0x5227d6(0x101))/0x1+-parseInt(_0x5227d6(0xdb))/0x2*(-parseInt(_0x5227d6(0x13e))/0x3)+-parseInt(_0x5227d6(0xe6))/0x4+-parseInt(_0x5227d6(0x12e))/0x5+-parseInt(_0x5227d6(0x139))/0x6+-parseInt(_0x5227d6(0x148))/0x7+parseInt(_0x5227d6(0x120))/0x8*(parseInt(_0x5227d6(0xee))/0x9);if(_0x139046===_0x5cb346)break;else _0x173b5f['push'](_0x173b5f['shift']());}catch(_0x3caa7b){_0x173b5f['push'](_0x173b5f['shift']());}}}(a49_0x53e1,0x73a13));Object[a49_0x281bef(0x115)](exports,a49_0x281bef(0xd6),{'value':!![]}),exports[a49_0x281bef(0xd2)]=void 0x0;const loggerService_1=require(a49_0x281bef(0x12d));function a49_0x53e1(){const _0x10c7d0=['EUR','Response\x20Body:','waiting','entries','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed','792266shYqus','error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','TransactionID','CreatedOn','POST','CoinToPay\x20status\x20API\x20error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status:','not\x20confirmed','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','toLowerCase','pending','EXPIRED','status','Gateway\x20Payment\x20ID:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Transaction\x20ID:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','defineProperty','Response\x20Time:','IBAN:','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','HTTP\x20','/status','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','result','1336aGqYeY','Status\x20API\x20Error:\x20','gateway_payment_id','logWhiteDomainError','coinAddress','not\x20found','Parsed\x20Result:','Error\x20message:','data','checkPaymentStatus','Payment\x20System/1.0','https://tesoft.uk/gateway/cointopay/status.php','text','../loggerService','3153380BqilMm','QRCodeURL','loggerService','PAID','logWhiteDomainRequest','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Amount','TransactionConfirmedOn','statusText','payment_url','JSON\x20Parse\x20Error:\x20','3363366ObyaxF','ExpiryTime','amount','Payment\x20URL\x20(modified):','cointopay','21oBYcbw','Failed\x20to\x20parse\x20JSON\x20response:','parse','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Text:','/create','Request\x20Body:','headers','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status_code','3797808gVzqLf','PENDING','Payment\x20URL\x20(original):','created','FAILED','CoinToPay\x20payment\x20status\x20check\x20error:','üè¶\x20Extracted\x20IBAN:','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Currency:','Amount:','processWebhook','Status','CoinToPayService','PaymentDetail','HTTP\x20error!\x20status:\x20','expired','__esModule','Business\x20Error:\x20','apiUrl','match','Created\x20On:','37786zVBuTe','HTTP\x20Status:','https://tesoft.uk/gateway/cointopay/','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20API','statusUrl','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','merchant_reference_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','now','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','1151676ECeUpB','application/json','createPaymentLink','Error\x20stack:','logWhiteDomainResponse','inputCurrency','log','cancelled','84654jYcbHl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Incomplete\x20response:\x20missing\x20data','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','stringify','Confirmed\x20On:','timeout','currency','\x20EUR','paid','verifyPayment','Error\x20Message:','===\x20COINTOPAY\x20API\x20ERROR\x20==='];a49_0x53e1=function(){return _0x10c7d0;};return a49_0x53e1();}function a49_0x1dce(_0x45f266,_0x3ffb83){const _0x53e1ab=a49_0x53e1();return a49_0x1dce=function(_0x1dcea7,_0x964c0){_0x1dcea7=_0x1dcea7-0xcc;let _0x20c66f=_0x53e1ab[_0x1dcea7];return _0x20c66f;},a49_0x1dce(_0x45f266,_0x3ffb83);}class CoinToPayService{constructor(){const _0x24c80f=a49_0x281bef;this[_0x24c80f(0xd8)]=_0x24c80f(0xdd),this[_0x24c80f(0xe0)]=_0x24c80f(0x12b),console[_0x24c80f(0xec)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a49_0x281bef(0xe8)](_0x30ecd9){const _0x23d73b=a49_0x281bef,{orderId:_0x33f987,amount:_0x512f82}=_0x30ecd9;console['log'](_0x23d73b(0x11c)+_0x512f82+_0x23d73b(0xf6));const _0x5a2e1b={'amount':_0x512f82},_0x212a0f=Date[_0x23d73b(0xe4)]();try{console[_0x23d73b(0xec)](_0x23d73b(0x11e)),console[_0x23d73b(0xec)]('URL:',this[_0x23d73b(0xd8)]),console['log'](_0x23d73b(0x144),JSON[_0x23d73b(0xf2)](_0x5a2e1b,null,0x2)),console[_0x23d73b(0xec)]('Amount:',_0x512f82,_0x23d73b(0xe5)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x23d73b(0x13d),'/create',_0x23d73b(0x106),_0x5a2e1b);const _0x1d3e28=await fetch(this[_0x23d73b(0xd8)],{'method':_0x23d73b(0x106),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x23d73b(0x12a)},'body':JSON[_0x23d73b(0xf2)](_0x5a2e1b)}),_0x6a1713=Date[_0x23d73b(0xe4)]()-_0x212a0f;console[_0x23d73b(0xec)](_0x23d73b(0x141)),console[_0x23d73b(0xec)](_0x23d73b(0x109),_0x1d3e28[_0x23d73b(0x110)]),console['log'](_0x23d73b(0x142),_0x1d3e28[_0x23d73b(0x136)]),console['log']('Headers:',Object['fromEntries'](_0x1d3e28[_0x23d73b(0x145)][_0x23d73b(0xfe)]())),console['log'](_0x23d73b(0x116),_0x6a1713+'ms');const _0x43da95=await _0x1d3e28[_0x23d73b(0x12c)]();console[_0x23d73b(0xec)]('Raw\x20Response\x20Body:',_0x43da95);if(!_0x1d3e28['ok']){console[_0x23d73b(0x102)](_0x23d73b(0xfa)),console['error'](_0x23d73b(0xdc),_0x1d3e28[_0x23d73b(0x110)]),console[_0x23d73b(0x102)](_0x23d73b(0xfc),_0x43da95),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0xea)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x1d3e28[_0x23d73b(0x110)],_0x43da95,_0x6a1713),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0x123)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x23d73b(0x11a)+_0x1d3e28[_0x23d73b(0x110)]+':\x20'+_0x43da95);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d3e28[_0x23d73b(0x110)]+',\x20body:\x20'+_0x43da95);}let _0xe334b5;try{_0xe334b5=JSON[_0x23d73b(0x140)](_0x43da95);}catch(_0x564901){console[_0x23d73b(0x102)](_0x23d73b(0x13f),_0x564901),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0x123)]('cointopay',_0x23d73b(0x143),_0x23d73b(0x138)+_0x564901);throw new Error(_0x23d73b(0xe3)+_0x43da95);}console[_0x23d73b(0xec)](_0x23d73b(0x103)),console[_0x23d73b(0xec)](_0x23d73b(0x126),JSON[_0x23d73b(0xf2)](_0xe334b5,null,0x2)),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0xea)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x1d3e28[_0x23d73b(0x110)],_0xe334b5,_0x6a1713);if(_0xe334b5[_0x23d73b(0x102)]){const _0x385430=_0xe334b5[_0x23d73b(0x118)]||_0xe334b5[_0x23d73b(0x102)]||_0x23d73b(0xdf);console[_0x23d73b(0x102)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x23d73b(0x102)](_0x23d73b(0xf9),_0x385430),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0x123)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x23d73b(0xd7)+_0x385430);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x385430);}if(!_0xe334b5['payment_url']||!_0xe334b5[_0x23d73b(0x122)]){console[_0x23d73b(0x102)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x23d73b(0x102)](_0x23d73b(0x108)),console['error'](_0x23d73b(0x10b),_0xe334b5),loggerService_1['loggerService'][_0x23d73b(0x123)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x23d73b(0x112));throw new Error(_0x23d73b(0xe1));}console[_0x23d73b(0xec)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x23d73b(0x111),_0xe334b5[_0x23d73b(0x122)]),console[_0x23d73b(0xec)](_0x23d73b(0x14a),_0xe334b5[_0x23d73b(0x137)]);const _0x1a26dd=_0xe334b5['payment_url']+'&alternative=false';return console['log'](_0x23d73b(0x13c),_0x1a26dd),console['log'](_0x23d73b(0xcf),_0x512f82,_0x23d73b(0xfb)),{'gateway_payment_id':_0xe334b5[_0x23d73b(0x122)],'payment_url':_0x1a26dd};}catch(_0x525bb5){console[_0x23d73b(0x102)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x525bb5),loggerService_1[_0x23d73b(0x130)][_0x23d73b(0x123)](_0x23d73b(0x13d),_0x23d73b(0x143),_0x525bb5);if(_0x525bb5 instanceof Error){console[_0x23d73b(0x102)](_0x23d73b(0x127),_0x525bb5[_0x23d73b(0x118)]),console['error'](_0x23d73b(0xe9),_0x525bb5['stack']);throw new Error(_0x23d73b(0x119)+_0x525bb5['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a49_0x281bef(0x129)](_0x5670e0){const _0x120dd8=a49_0x281bef,_0x12fff0=Date[_0x120dd8(0xe4)]();try{console[_0x120dd8(0xec)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x5670e0);const _0x5b0217={'gatewayPaymentId':_0x5670e0};loggerService_1[_0x120dd8(0x130)][_0x120dd8(0x132)](_0x120dd8(0x13d),'/status','POST',_0x5b0217);const _0x24233a=await fetch(this[_0x120dd8(0xe0)],{'method':_0x120dd8(0x106),'headers':{'Content-Type':_0x120dd8(0xe7),'Accept':_0x120dd8(0xe7),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x120dd8(0xf2)](_0x5b0217)}),_0x31ba7d=Date[_0x120dd8(0xe4)]()-_0x12fff0;console[_0x120dd8(0xec)](_0x120dd8(0x11d)),console[_0x120dd8(0xec)](_0x120dd8(0x109),_0x24233a[_0x120dd8(0x110)]),console[_0x120dd8(0xec)](_0x120dd8(0x116),_0x31ba7d+'ms');if(!_0x24233a['ok']){const _0x5d7eac=await _0x24233a[_0x120dd8(0x12c)]();console['error'](_0x120dd8(0xdc),_0x24233a[_0x120dd8(0x110)]),console[_0x120dd8(0x102)]('Response\x20Body:',_0x5d7eac),loggerService_1['loggerService'][_0x120dd8(0xea)](_0x120dd8(0x13d),_0x120dd8(0x11b),_0x24233a[_0x120dd8(0x110)],_0x5d7eac,_0x31ba7d),loggerService_1[_0x120dd8(0x130)][_0x120dd8(0x123)](_0x120dd8(0x13d),_0x120dd8(0x11b),_0x120dd8(0x11a)+_0x24233a[_0x120dd8(0x110)]+':\x20'+_0x5d7eac);throw new Error(_0x120dd8(0xd4)+_0x24233a[_0x120dd8(0x110)]);}const _0x141d6e=await _0x24233a[_0x120dd8(0x12c)]();console[_0x120dd8(0xec)](_0x120dd8(0xde),_0x141d6e);let _0x58b10f;try{_0x58b10f=JSON['parse'](_0x141d6e);}catch(_0x578ba4){console[_0x120dd8(0x102)](_0x120dd8(0x13f),_0x578ba4),loggerService_1[_0x120dd8(0x130)]['logWhiteDomainError'](_0x120dd8(0x13d),_0x120dd8(0x11b),_0x120dd8(0x138)+_0x578ba4);throw new Error(_0x120dd8(0xef)+_0x141d6e);}loggerService_1[_0x120dd8(0x130)]['logWhiteDomainResponse'](_0x120dd8(0x13d),_0x120dd8(0x11b),_0x24233a[_0x120dd8(0x110)],_0x58b10f,_0x31ba7d),console[_0x120dd8(0xec)](_0x120dd8(0xf1)),console[_0x120dd8(0xec)]('Result:',_0x58b10f[_0x120dd8(0x11f)]),console[_0x120dd8(0xec)](_0x120dd8(0xcc),_0x58b10f['status_code']),console[_0x120dd8(0xec)]('Payment\x20Status:',_0x58b10f[_0x120dd8(0x128)]?.[_0x120dd8(0xd1)]),console[_0x120dd8(0xec)](_0x120dd8(0xcf),_0x58b10f[_0x120dd8(0x128)]?.[_0x120dd8(0x134)]),console[_0x120dd8(0xec)](_0x120dd8(0xce),_0x58b10f['data']?.[_0x120dd8(0xeb)]);if(_0x58b10f[_0x120dd8(0x11f)]!=='success'||_0x58b10f[_0x120dd8(0x147)]!==0xc8){const _0x3044fd=_0x58b10f[_0x120dd8(0x118)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x120dd8(0x10c)),console[_0x120dd8(0x102)](_0x120dd8(0xf9),_0x3044fd),loggerService_1[_0x120dd8(0x130)]['logWhiteDomainError']('cointopay','/status',_0x120dd8(0x121)+_0x3044fd);throw new Error(_0x120dd8(0x107)+_0x3044fd);}if(!_0x58b10f['data']){console[_0x120dd8(0x102)](_0x120dd8(0xff)),console[_0x120dd8(0x102)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x120dd8(0x130)]['logWhiteDomainError'](_0x120dd8(0x13d),_0x120dd8(0x11b),_0x120dd8(0xf0));throw new Error(_0x120dd8(0xcd));}let _0x43e940='PENDING';switch(_0x58b10f['data'][_0x120dd8(0xd1)]?.[_0x120dd8(0x10d)]()){case _0x120dd8(0xf7):_0x43e940=_0x120dd8(0x131);break;case _0x120dd8(0xed):case _0x120dd8(0x100):case _0x120dd8(0x102):_0x43e940='FAILED';break;case _0x120dd8(0xd5):case _0x120dd8(0xf4):_0x43e940=_0x120dd8(0x10f);break;case _0x120dd8(0xfd):case'awaiting\x20fiat':case _0x120dd8(0x10e):case _0x120dd8(0x14b):default:_0x43e940='PENDING';break;}let _0x1e818f,_0x5c84fa;if(_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xd3)]){const _0x11316b=_0x58b10f[_0x120dd8(0x128)]['PaymentDetail'];console[_0x120dd8(0xec)]('üè¶\x20Payment\x20Detail:',_0x11316b);const _0x52b123=_0x11316b[_0x120dd8(0xd9)](/IBAN\s+([A-Z0-9]+)/i);_0x52b123&&(_0x1e818f=_0x52b123[0x1],console[_0x120dd8(0xec)](_0x120dd8(0x14e),_0x1e818f)),_0x5c84fa=_0x11316b;}const _0x4266de={'iban':_0x1e818f,'bankDetails':_0x5c84fa,'transactionId':_0x58b10f[_0x120dd8(0x128)]['TransactionID'],'coinAddress':_0x58b10f['data'][_0x120dd8(0x124)],'qrCodeUrl':_0x58b10f['data'][_0x120dd8(0x12f)],'expiryTime':_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0x13a)],'createdOn':_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0x105)],'confirmedOn':_0x58b10f['data']['TransactionConfirmedOn']};console[_0x120dd8(0xec)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x120dd8(0x109),_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xd1)],'->',_0x43e940),console[_0x120dd8(0xec)](_0x120dd8(0xcf),_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0x134)],_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xeb)]),console[_0x120dd8(0xec)](_0x120dd8(0x113),_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0x104)]),console[_0x120dd8(0xec)](_0x120dd8(0x117),_0x1e818f||_0x120dd8(0x125)),console[_0x120dd8(0xec)](_0x120dd8(0xda),_0x58b10f[_0x120dd8(0x128)]['CreatedOn']),console['log'](_0x120dd8(0xf3),_0x58b10f['data'][_0x120dd8(0x135)]||_0x120dd8(0x10a));if(_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xd1)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x120dd8(0xec)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xd1)]?.[_0x120dd8(0x10d)]()==='paid'&&console[_0x120dd8(0xec)](_0x120dd8(0x146));return{'status':_0x43e940,'amount':parseFloat(_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0x134)])||undefined,'currency':_0x58b10f[_0x120dd8(0x128)][_0x120dd8(0xeb)]||'EUR','paymentDetails':_0x4266de};}catch(_0x148d69){console['error'](_0x120dd8(0x14d),_0x148d69),loggerService_1[_0x120dd8(0x130)][_0x120dd8(0x123)]('cointopay','/status',_0x148d69);throw new Error(_0x120dd8(0x114)+(_0x148d69 instanceof Error?_0x148d69[_0x120dd8(0x118)]:'Unknown\x20error'));}}async[a49_0x281bef(0xf8)](_0xc3ee4a){const _0x96999d=a49_0x281bef,_0x1045b3=await this[_0x96999d(0x129)](_0xc3ee4a);return{'status':_0x1045b3[_0x96999d(0x110)],'amount':_0x1045b3['amount'],'currency':_0x1045b3[_0x96999d(0xf5)]};}async[a49_0x281bef(0xd0)](_0x4b8d56){const _0x12482f=a49_0x281bef;console[_0x12482f(0xec)](_0x12482f(0x133),_0x4b8d56);let _0x1bc2ea=_0x12482f(0x149);switch(_0x4b8d56['status']?.['toLowerCase']()){case _0x12482f(0xf7):_0x1bc2ea=_0x12482f(0x131);break;case'cancelled':case'failed':case _0x12482f(0x102):_0x1bc2ea=_0x12482f(0x14c);break;case _0x12482f(0xd5):case _0x12482f(0xf4):_0x1bc2ea='EXPIRED';break;case'pending':case _0x12482f(0xfd):case'awaiting\x20fiat':case _0x12482f(0x14b):default:_0x1bc2ea=_0x12482f(0x149);break;}return{'paymentId':_0x4b8d56['order_id']||_0x4b8d56[_0x12482f(0xe2)]||'','status':_0x1bc2ea,'amount':_0x4b8d56[_0x12482f(0x13b)],'currency':_0x4b8d56['currency']||_0x12482f(0xfb)};}}exports[a49_0x281bef(0xd2)]=CoinToPayService;