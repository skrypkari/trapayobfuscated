'use strict';const a44_0x2ad1e2=a44_0x43c8;(function(_0x46d925,_0x471496){const _0x5049ee=a44_0x43c8,_0x36b3c4=_0x46d925();while(!![]){try{const _0xb2b995=-parseInt(_0x5049ee(0xed))/0x1+parseInt(_0x5049ee(0xe0))/0x2*(-parseInt(_0x5049ee(0x9c))/0x3)+-parseInt(_0x5049ee(0xe5))/0x4*(-parseInt(_0x5049ee(0x65))/0x5)+-parseInt(_0x5049ee(0x89))/0x6+-parseInt(_0x5049ee(0x9b))/0x7+-parseInt(_0x5049ee(0xb0))/0x8*(-parseInt(_0x5049ee(0xae))/0x9)+-parseInt(_0x5049ee(0xb8))/0xa*(-parseInt(_0x5049ee(0xb9))/0xb);if(_0xb2b995===_0x471496)break;else _0x36b3c4['push'](_0x36b3c4['shift']());}catch(_0x49e3ae){_0x36b3c4['push'](_0x36b3c4['shift']());}}}(a44_0x30fe,0xa427d));Object[a44_0x2ad1e2(0x7d)](exports,a44_0x2ad1e2(0xac),{'value':!![]}),exports[a44_0x2ad1e2(0xaf)]=void 0x0;const loggerService_1=require(a44_0x2ad1e2(0x71));function a44_0x43c8(_0x11fb03,_0x717b47){const _0x30fe95=a44_0x30fe();return a44_0x43c8=function(_0x43c8f3,_0x251553){_0x43c8f3=_0x43c8f3-0x64;let _0x289968=_0x30fe95[_0x43c8f3];return _0x289968;},a44_0x43c8(_0x11fb03,_0x717b47);}class CoinToPayService{constructor(){const _0x61f9ae=a44_0x2ad1e2;this[_0x61f9ae(0x91)]=_0x61f9ae(0x73),this[_0x61f9ae(0xa8)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x61f9ae(0x7b)](_0x61f9ae(0xcd)),console['log']('📊\x20Status\x20check\x20URL:',this[_0x61f9ae(0xa8)]);}async[a44_0x2ad1e2(0xe7)](_0x329761){const _0x4b2727=a44_0x2ad1e2,{orderId:_0xb6a26b,amount:_0x7507dc}=_0x329761;console[_0x4b2727(0x7b)](_0x4b2727(0x7c)+_0x7507dc+'\x20EUR');const _0x3f5384={'amount':_0x7507dc},_0x156f67=Date[_0x4b2727(0xeb)]();try{console[_0x4b2727(0x7b)](_0x4b2727(0x80)),console['log'](_0x4b2727(0x6d),this[_0x4b2727(0x91)]),console[_0x4b2727(0x7b)](_0x4b2727(0xbb),JSON[_0x4b2727(0x70)](_0x3f5384,null,0x2)),console['log'](_0x4b2727(0xbf),_0x7507dc,_0x4b2727(0x8a)),loggerService_1[_0x4b2727(0xd8)][_0x4b2727(0x6b)](_0x4b2727(0x94),'/create',_0x4b2727(0xa9),_0x3f5384);const _0x182842=await fetch(this[_0x4b2727(0x91)],{'method':'POST','headers':{'Content-Type':_0x4b2727(0xcc),'Accept':_0x4b2727(0xcc),'User-Agent':_0x4b2727(0xb1)},'body':JSON['stringify'](_0x3f5384)}),_0x20e0af=Date[_0x4b2727(0xeb)]()-_0x156f67;console['log'](_0x4b2727(0xdc)),console['log'](_0x4b2727(0xa2),_0x182842[_0x4b2727(0xcb)]),console[_0x4b2727(0x7b)]('Status\x20Text:',_0x182842[_0x4b2727(0xda)]),console[_0x4b2727(0x7b)](_0x4b2727(0x6e),Object[_0x4b2727(0xd1)](_0x182842['headers']['entries']())),console[_0x4b2727(0x7b)](_0x4b2727(0x88),_0x20e0af+'ms');const _0x415f64=await _0x182842[_0x4b2727(0xd3)]();console[_0x4b2727(0x7b)](_0x4b2727(0x6c),_0x415f64);if(!_0x182842['ok']){console['error'](_0x4b2727(0xdb)),console[_0x4b2727(0x8f)]('HTTP\x20Status:',_0x182842[_0x4b2727(0xcb)]),console[_0x4b2727(0x8f)](_0x4b2727(0x97),_0x415f64),loggerService_1[_0x4b2727(0xd8)][_0x4b2727(0xa0)](_0x4b2727(0x94),_0x4b2727(0xba),_0x182842[_0x4b2727(0xcb)],_0x415f64,_0x20e0af),loggerService_1[_0x4b2727(0xd8)]['logWhiteDomainError'](_0x4b2727(0x94),_0x4b2727(0xba),_0x4b2727(0xb7)+_0x182842[_0x4b2727(0xcb)]+':\x20'+_0x415f64);throw new Error(_0x4b2727(0xc4)+_0x182842[_0x4b2727(0xcb)]+_0x4b2727(0xb3)+_0x415f64);}let _0x7c4f53;try{_0x7c4f53=JSON[_0x4b2727(0xec)](_0x415f64);}catch(_0x243477){console[_0x4b2727(0x8f)](_0x4b2727(0xd4),_0x243477),loggerService_1[_0x4b2727(0xd8)][_0x4b2727(0xea)]('cointopay','/create',_0x4b2727(0x68)+_0x243477);throw new Error(_0x4b2727(0x9e)+_0x415f64);}console[_0x4b2727(0x7b)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x4b2727(0x7b)](_0x4b2727(0xad),JSON[_0x4b2727(0x70)](_0x7c4f53,null,0x2)),loggerService_1['loggerService'][_0x4b2727(0xa0)](_0x4b2727(0x94),_0x4b2727(0xba),_0x182842[_0x4b2727(0xcb)],_0x7c4f53,_0x20e0af);if(_0x7c4f53['error']){const _0x294984=_0x7c4f53['message']||_0x7c4f53[_0x4b2727(0x8f)]||_0x4b2727(0x87);console[_0x4b2727(0x8f)](_0x4b2727(0xb2)),console[_0x4b2727(0x8f)](_0x4b2727(0xe4),_0x294984),loggerService_1[_0x4b2727(0xd8)][_0x4b2727(0xea)]('cointopay',_0x4b2727(0xba),_0x4b2727(0xcf)+_0x294984);throw new Error(_0x4b2727(0xc0)+_0x294984);}if(!_0x7c4f53['payment_url']||!_0x7c4f53[_0x4b2727(0x75)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4b2727(0x8f)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x4b2727(0x8f)]('Response\x20data:',_0x7c4f53),loggerService_1[_0x4b2727(0xd8)][_0x4b2727(0xea)](_0x4b2727(0x94),_0x4b2727(0xba),_0x4b2727(0x9a));throw new Error(_0x4b2727(0xc8));}return console[_0x4b2727(0x7b)](_0x4b2727(0x77)),console['log'](_0x4b2727(0xb4),_0x7c4f53[_0x4b2727(0x75)]),console[_0x4b2727(0x7b)](_0x4b2727(0xb5),_0x7c4f53[_0x4b2727(0x90)]),console[_0x4b2727(0x7b)](_0x4b2727(0xbf),_0x7507dc,'EUR'),{'gateway_payment_id':_0x7c4f53['gateway_payment_id'],'payment_url':_0x7c4f53[_0x4b2727(0x90)]};}catch(_0x216596){console[_0x4b2727(0x8f)](_0x4b2727(0xc3)),console[_0x4b2727(0x8f)](_0x4b2727(0xbd),_0x216596),loggerService_1['loggerService'][_0x4b2727(0xea)]('cointopay','/create',_0x216596);if(_0x216596 instanceof Error){console[_0x4b2727(0x8f)](_0x4b2727(0x72),_0x216596[_0x4b2727(0x67)]),console[_0x4b2727(0x8f)](_0x4b2727(0x6f),_0x216596[_0x4b2727(0xd7)]);throw new Error(_0x4b2727(0xbe)+_0x216596[_0x4b2727(0x67)]);}throw new Error(_0x4b2727(0xe8));}}async[a44_0x2ad1e2(0x7a)](_0x1d850b){const _0x2bdc28=a44_0x2ad1e2,_0x304d8f=Date['now']();try{console['log'](_0x2bdc28(0xa1)+_0x1d850b);const _0xeac33e={'gatewayPaymentId':_0x1d850b};loggerService_1[_0x2bdc28(0xd8)]['logWhiteDomainRequest'](_0x2bdc28(0x94),'/status',_0x2bdc28(0xa9),_0xeac33e);const _0x3e99ce=await fetch(this[_0x2bdc28(0xa8)],{'method':_0x2bdc28(0xa9),'headers':{'Content-Type':_0x2bdc28(0xcc),'Accept':_0x2bdc28(0xcc),'User-Agent':_0x2bdc28(0xb1)},'body':JSON[_0x2bdc28(0x70)](_0xeac33e)}),_0x4592df=Date['now']()-_0x304d8f;console['log'](_0x2bdc28(0xa7)),console[_0x2bdc28(0x7b)](_0x2bdc28(0xa2),_0x3e99ce[_0x2bdc28(0xcb)]),console['log']('Response\x20Time:',_0x4592df+'ms');if(!_0x3e99ce['ok']){const _0x150fd3=await _0x3e99ce['text']();console[_0x2bdc28(0x8f)]('HTTP\x20Status:',_0x3e99ce['status']),console[_0x2bdc28(0x8f)](_0x2bdc28(0x97),_0x150fd3),loggerService_1[_0x2bdc28(0xd8)][_0x2bdc28(0xa0)](_0x2bdc28(0x94),_0x2bdc28(0x8d),_0x3e99ce[_0x2bdc28(0xcb)],_0x150fd3,_0x4592df),loggerService_1[_0x2bdc28(0xd8)]['logWhiteDomainError'](_0x2bdc28(0x94),_0x2bdc28(0x8d),_0x2bdc28(0xb7)+_0x3e99ce[_0x2bdc28(0xcb)]+':\x20'+_0x150fd3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3e99ce[_0x2bdc28(0xcb)]);}const _0x3adafe=await _0x3e99ce[_0x2bdc28(0xd3)]();console[_0x2bdc28(0x7b)](_0x2bdc28(0x6c),_0x3adafe);let _0xc7c1f;try{_0xc7c1f=JSON[_0x2bdc28(0xec)](_0x3adafe);}catch(_0x29da8f){console[_0x2bdc28(0x8f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x29da8f),loggerService_1['loggerService'][_0x2bdc28(0xea)]('cointopay','/status',_0x2bdc28(0x68)+_0x29da8f);throw new Error(_0x2bdc28(0x9f)+_0x3adafe);}loggerService_1[_0x2bdc28(0xd8)]['logWhiteDomainResponse'](_0x2bdc28(0x94),'/status',_0x3e99ce[_0x2bdc28(0xcb)],_0xc7c1f,_0x4592df),console[_0x2bdc28(0x7b)](_0x2bdc28(0x79)),console[_0x2bdc28(0x7b)](_0x2bdc28(0xa5),_0xc7c1f[_0x2bdc28(0x86)]),console[_0x2bdc28(0x7b)](_0x2bdc28(0x7e),_0xc7c1f[_0x2bdc28(0xa6)]),console[_0x2bdc28(0x7b)](_0x2bdc28(0xe9),_0xc7c1f[_0x2bdc28(0xd2)]?.[_0x2bdc28(0xc1)]),console[_0x2bdc28(0x7b)](_0x2bdc28(0xbf),_0xc7c1f[_0x2bdc28(0xd2)]?.['Amount']),console[_0x2bdc28(0x7b)](_0x2bdc28(0xc7),_0xc7c1f['data']?.[_0x2bdc28(0x66)]);if(_0xc7c1f['result']!==_0x2bdc28(0x74)||_0xc7c1f[_0x2bdc28(0xa6)]!==0xc8){const _0x414b3e=_0xc7c1f[_0x2bdc28(0x67)]||_0x2bdc28(0x64);console[_0x2bdc28(0x8f)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x414b3e),loggerService_1[_0x2bdc28(0xd8)][_0x2bdc28(0xea)]('cointopay','/status',_0x2bdc28(0xc9)+_0x414b3e);throw new Error(_0x2bdc28(0x81)+_0x414b3e);}if(!_0xc7c1f[_0x2bdc28(0xd2)]){console[_0x2bdc28(0x8f)](_0x2bdc28(0x93)),console['error'](_0x2bdc28(0x8c)),loggerService_1[_0x2bdc28(0xd8)][_0x2bdc28(0xea)](_0x2bdc28(0x94),_0x2bdc28(0x8d),_0x2bdc28(0x7f));throw new Error(_0x2bdc28(0xef));}let _0x1f9551=_0x2bdc28(0xa3);switch(_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xc1)]?.[_0x2bdc28(0xe2)]()){case'paid':_0x1f9551=_0x2bdc28(0xc6);break;case _0x2bdc28(0xe1):case _0x2bdc28(0x8e):case _0x2bdc28(0x8f):_0x1f9551=_0x2bdc28(0x95);break;case'expired':case _0x2bdc28(0xdf):_0x1f9551=_0x2bdc28(0xc2);break;case _0x2bdc28(0x96):case _0x2bdc28(0x69):case _0x2bdc28(0x92):case _0x2bdc28(0xdd):default:_0x1f9551=_0x2bdc28(0xa3);break;}let _0x1af706,_0x19f022;if(_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xbc)]){const _0x4be2dd=_0xc7c1f['data'][_0x2bdc28(0xbc)];console[_0x2bdc28(0x7b)](_0x2bdc28(0xd6),_0x4be2dd);const _0x20c69a=_0x4be2dd[_0x2bdc28(0x8b)](/IBAN\s+([A-Z0-9]+)/i);_0x20c69a&&(_0x1af706=_0x20c69a[0x1],console['log'](_0x2bdc28(0x98),_0x1af706)),_0x19f022=_0x4be2dd;}const _0x53ebf2={'iban':_0x1af706,'bankDetails':_0x19f022,'transactionId':_0xc7c1f['data']['TransactionID'],'coinAddress':_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xb6)],'qrCodeUrl':_0xc7c1f[_0x2bdc28(0xd2)]['QRCodeURL'],'expiryTime':_0xc7c1f[_0x2bdc28(0xd2)]['ExpiryTime'],'createdOn':_0xc7c1f[_0x2bdc28(0xd2)]['CreatedOn'],'confirmedOn':_0xc7c1f['data'][_0x2bdc28(0xd9)]};console['log'](_0x2bdc28(0xe6)),console['log'](_0x2bdc28(0xa2),_0xc7c1f['data'][_0x2bdc28(0xc1)],'->',_0x1f9551),console[_0x2bdc28(0x7b)](_0x2bdc28(0xbf),_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0x84)],_0xc7c1f[_0x2bdc28(0xd2)]['inputCurrency']),console['log'](_0x2bdc28(0xa4),_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xd0)]),console['log'](_0x2bdc28(0xc5),_0x1af706||_0x2bdc28(0xe3)),console[_0x2bdc28(0x7b)]('Created\x20On:',_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xaa)]),console[_0x2bdc28(0x7b)]('Confirmed\x20On:',_0xc7c1f['data'][_0x2bdc28(0xd9)]||_0x2bdc28(0x76));if(_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xc1)]?.['toLowerCase']()==='awaiting\x20fiat')console['log'](_0x2bdc28(0xd5));else _0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0xc1)]?.[_0x2bdc28(0xe2)]()===_0x2bdc28(0x83)&&console[_0x2bdc28(0x7b)](_0x2bdc28(0xab));return{'status':_0x1f9551,'amount':parseFloat(_0xc7c1f[_0x2bdc28(0xd2)][_0x2bdc28(0x84)])||undefined,'currency':_0xc7c1f[_0x2bdc28(0xd2)]['inputCurrency']||_0x2bdc28(0x82),'paymentDetails':_0x53ebf2};}catch(_0x5e6424){console[_0x2bdc28(0x8f)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x5e6424),loggerService_1['loggerService'][_0x2bdc28(0xea)](_0x2bdc28(0x94),'/status',_0x5e6424);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x5e6424 instanceof Error?_0x5e6424[_0x2bdc28(0x67)]:_0x2bdc28(0xca)));}}async[a44_0x2ad1e2(0x99)](_0x683806){const _0x315963=a44_0x2ad1e2,_0x2a0f1e=await this['checkPaymentStatus'](_0x683806);return{'status':_0x2a0f1e[_0x315963(0xcb)],'amount':_0x2a0f1e[_0x315963(0xee)],'currency':_0x2a0f1e['currency']};}async[a44_0x2ad1e2(0x6a)](_0x13dbdb){const _0x254b9d=a44_0x2ad1e2;console[_0x254b9d(0x7b)](_0x254b9d(0x78),_0x13dbdb);let _0x303192='PENDING';switch(_0x13dbdb[_0x254b9d(0xcb)]?.[_0x254b9d(0xe2)]()){case'paid':_0x303192=_0x254b9d(0xc6);break;case _0x254b9d(0xe1):case _0x254b9d(0x8e):case'error':_0x303192='FAILED';break;case _0x254b9d(0x85):case _0x254b9d(0xdf):_0x303192=_0x254b9d(0xc2);break;case _0x254b9d(0x92):case'waiting':case'awaiting\x20fiat':case _0x254b9d(0xdd):default:_0x303192=_0x254b9d(0xa3);break;}return{'paymentId':_0x13dbdb[_0x254b9d(0x9d)]||_0x13dbdb[_0x254b9d(0xce)]||'','status':_0x303192,'amount':_0x13dbdb[_0x254b9d(0xee)],'currency':_0x13dbdb[_0x254b9d(0xde)]||_0x254b9d(0x82)};}}function a44_0x30fe(){const _0x577202=['processWebhook','logWhiteDomainRequest','Raw\x20Response\x20Body:','URL:','Headers:','Error\x20stack:','stringify','../loggerService','Error\x20message:','https://tesoft.uk/gateway/cointopay/','success','gateway_payment_id','not\x20confirmed','===\x20COINTOPAY\x20SUCCESS\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','checkPaymentStatus','log','🪙\x20Creating\x20CoinToPay\x20payment:\x20','defineProperty','Status\x20Code:','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','CoinToPay\x20status\x20API\x20error:\x20','EUR','paid','Amount','expired','result','Unknown\x20error\x20from\x20CoinToPay\x20API','Response\x20Time:','3443808sEnjqc','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','match','Missing\x20data\x20in\x20response','/status','failed','error','payment_url','apiUrl','pending','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cointopay','FAILED','waiting','Response\x20Body:','🏦\x20Extracted\x20IBAN:','verifyPayment','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','332948UcKQtI','165NEupND','order_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','logWhiteDomainResponse','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status:','PENDING','Transaction\x20ID:','Result:','status_code','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','statusUrl','POST','CreatedOn','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','__esModule','Parsed\x20Result:','9peYczT','CoinToPayService','7092760AhuFrb','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===',',\x20body:\x20','Gateway\x20Payment\x20ID:','Payment\x20URL:','coinAddress','HTTP\x20','415520RCpwsY','341DxrtsD','/create','Request\x20Body:','PaymentDetail','Error\x20details:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Amount:','CoinToPay\x20API\x20error:\x20','Status','EXPIRED','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','IBAN:','PAID','Currency:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20API\x20Error:\x20','Unknown\x20error','status','application/json','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','merchant_reference_id','Business\x20Error:\x20','TransactionID','fromEntries','data','text','Failed\x20to\x20parse\x20JSON\x20response:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','🏦\x20Payment\x20Detail:','stack','loggerService','TransactionConfirmedOn','statusText','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','created','currency','timeout','20374wrqorp','cancelled','toLowerCase','not\x20found','Error\x20Message:','8gddumo','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','createPaymentLink','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Payment\x20Status:','logWhiteDomainError','now','parse','634541FHXkjl','amount','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','785080JmtOow','inputCurrency','message','JSON\x20Parse\x20Error:\x20','awaiting\x20fiat'];a44_0x30fe=function(){return _0x577202;};return a44_0x30fe();}exports['CoinToPayService']=CoinToPayService;