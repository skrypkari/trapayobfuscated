'use strict';const a41_0x4ac181=a41_0x4557;(function(_0xb623b7,_0x59d397){const _0x116941=a41_0x4557,_0xf7f52c=_0xb623b7();while(!![]){try{const _0x267aeb=parseInt(_0x116941(0x1ae))/0x1*(-parseInt(_0x116941(0x193))/0x2)+parseInt(_0x116941(0x164))/0x3+parseInt(_0x116941(0x1ad))/0x4*(-parseInt(_0x116941(0x153))/0x5)+parseInt(_0x116941(0x1b1))/0x6*(parseInt(_0x116941(0x14d))/0x7)+parseInt(_0x116941(0x19c))/0x8+parseInt(_0x116941(0x171))/0x9+-parseInt(_0x116941(0x172))/0xa;if(_0x267aeb===_0x59d397)break;else _0xf7f52c['push'](_0xf7f52c['shift']());}catch(_0x46706d){_0xf7f52c['push'](_0xf7f52c['shift']());}}}(a41_0x1e34,0xa8b52));function a41_0x4557(_0x5a8865,_0x4a715f){const _0x1e3415=a41_0x1e34();return a41_0x4557=function(_0x455758,_0x58c9e0){_0x455758=_0x455758-0x12e;let _0x55bad0=_0x1e3415[_0x455758];return _0x55bad0;},a41_0x4557(_0x5a8865,_0x4a715f);}function a41_0x1e34(){const _0x315298=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Error\x20message:','statusText','üè¶\x20Extracted\x20IBAN:','apiUrl','URL:','Status:','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','inputCurrency','TransactionConfirmedOn','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Confirmed\x20On:','CoinToPay\x20payment\x20status\x20check\x20error:','defineProperty','üè¶\x20Payment\x20Detail:','Amount:','order_id','Payment\x20URL:','status_code','toLowerCase','createPaymentLink','2fKjEYJ','parse','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20data:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error','Transaction\x20ID:','amount','Status\x20API\x20Error:\x20','1741560ioeleE','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','match','verifyPayment','not\x20found','Failed\x20to\x20parse\x20JSON\x20response:','failed','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','PAID','TesSoft\x20Payment\x20System/1.0','paid','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','logWhiteDomainResponse','Raw\x20Response\x20Body:','error','now','Missing\x20data\x20in\x20response','462164nwRAvr','414420aWptZc','entries','../loggerService','6OWsgHy','CoinToPay\x20status\x20API\x20error:\x20','fromEntries','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EXPIRED','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','JSON\x20Parse\x20Error:\x20','stringify','Error\x20details:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','message','pending','awaiting\x20fiat','/status','processWebhook','statusUrl','IBAN:','status','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','CoinToPay\x20API\x20error:\x20','result','success','coinAddress','logWhiteDomainRequest','gateway_payment_id','waiting','text','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20stack:','Status','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PaymentDetail','Unknown\x20error\x20from\x20CoinToPay\x20API','payment_url','8980174OtNoFS','expired','Response\x20Body:','PENDING','Status\x20Text:','FAILED','15vlvaPi','Error\x20Message:','Result:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Headers:','Response\x20Time:','created','not\x20confirmed','CoinToPayService','Amount',',\x20body:\x20','application/json','Request\x20Body:','stack','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainError','https://tesoft.uk/gateway/cointopay/','506352RZqDfU','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','timeout','headers','data','/create','CreatedOn','cointopay','EUR','POST','HTTP\x20','checkPaymentStatus','loggerService','4550670gEFzMu','7229220LqxDlQ','__esModule','===\x20COINTOPAY\x20API\x20ERROR\x20===','currency','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Incomplete\x20response:\x20missing\x20data','log','cancelled','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='];a41_0x1e34=function(){return _0x315298;};return a41_0x1e34();}Object[a41_0x4ac181(0x18b)](exports,a41_0x4ac181(0x173),{'value':!![]}),exports[a41_0x4ac181(0x15b)]=void 0x0;const loggerService_1=require(a41_0x4ac181(0x1b0));class CoinToPayService{constructor(){const _0x3a62a4=a41_0x4ac181;this[_0x3a62a4(0x17f)]=_0x3a62a4(0x163),this[_0x3a62a4(0x137)]=_0x3a62a4(0x145),console[_0x3a62a4(0x178)](_0x3a62a4(0x149)),console[_0x3a62a4(0x178)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a41_0x4ac181(0x192)](_0x277c25){const _0x3000b7=a41_0x4ac181,{orderId:_0x529494,amount:_0x526631}=_0x277c25;console['log'](_0x3000b7(0x1a7)+_0x526631+'\x20EUR');const _0x22af4f={'amount':_0x526631},_0x3e6fb2=Date[_0x3000b7(0x1ab)]();try{console[_0x3000b7(0x178)](_0x3000b7(0x156)),console[_0x3000b7(0x178)](_0x3000b7(0x180),this['apiUrl']),console[_0x3000b7(0x178)](_0x3000b7(0x15f),JSON['stringify'](_0x22af4f,null,0x2)),console[_0x3000b7(0x178)]('Amount:',_0x526631,_0x3000b7(0x19d)),loggerService_1[_0x3000b7(0x170)][_0x3000b7(0x141)]('cointopay',_0x3000b7(0x169),'POST',_0x22af4f);const _0x5f29a0=await fetch(this['apiUrl'],{'method':_0x3000b7(0x16d),'headers':{'Content-Type':_0x3000b7(0x15e),'Accept':_0x3000b7(0x15e),'User-Agent':_0x3000b7(0x1a5)},'body':JSON[_0x3000b7(0x12f)](_0x22af4f)}),_0x290665=Date['now']()-_0x3e6fb2;console[_0x3000b7(0x178)](_0x3000b7(0x146)),console['log'](_0x3000b7(0x181),_0x5f29a0[_0x3000b7(0x139)]),console[_0x3000b7(0x178)](_0x3000b7(0x151),_0x5f29a0[_0x3000b7(0x17d)]),console['log'](_0x3000b7(0x157),Object[_0x3000b7(0x1b3)](_0x5f29a0[_0x3000b7(0x167)][_0x3000b7(0x1af)]())),console[_0x3000b7(0x178)]('Response\x20Time:',_0x290665+'ms');const _0x411c60=await _0x5f29a0[_0x3000b7(0x144)]();console[_0x3000b7(0x178)](_0x3000b7(0x1a9),_0x411c60);if(!_0x5f29a0['ok']){console['error'](_0x3000b7(0x174)),console[_0x3000b7(0x1aa)](_0x3000b7(0x182),_0x5f29a0[_0x3000b7(0x139)]),console[_0x3000b7(0x1aa)](_0x3000b7(0x14f),_0x411c60),loggerService_1[_0x3000b7(0x170)][_0x3000b7(0x1a8)](_0x3000b7(0x16b),_0x3000b7(0x169),_0x5f29a0['status'],_0x411c60,_0x290665),loggerService_1[_0x3000b7(0x170)]['logWhiteDomainError'](_0x3000b7(0x16b),_0x3000b7(0x169),'HTTP\x20'+_0x5f29a0[_0x3000b7(0x139)]+':\x20'+_0x411c60);throw new Error(_0x3000b7(0x13c)+_0x5f29a0['status']+_0x3000b7(0x15d)+_0x411c60);}let _0x50e17c;try{_0x50e17c=JSON[_0x3000b7(0x194)](_0x411c60);}catch(_0x339049){console[_0x3000b7(0x1aa)](_0x3000b7(0x1a1),_0x339049),loggerService_1['loggerService'][_0x3000b7(0x162)](_0x3000b7(0x16b),_0x3000b7(0x169),_0x3000b7(0x12e)+_0x339049);throw new Error(_0x3000b7(0x17b)+_0x411c60);}console[_0x3000b7(0x178)](_0x3000b7(0x1b6)),console[_0x3000b7(0x178)]('Parsed\x20Result:',JSON[_0x3000b7(0x12f)](_0x50e17c,null,0x2)),loggerService_1[_0x3000b7(0x170)][_0x3000b7(0x1a8)](_0x3000b7(0x16b),_0x3000b7(0x169),_0x5f29a0[_0x3000b7(0x139)],_0x50e17c,_0x290665);if(_0x50e17c[_0x3000b7(0x1aa)]){const _0x3066c7=_0x50e17c[_0x3000b7(0x132)]||_0x50e17c[_0x3000b7(0x1aa)]||_0x3000b7(0x14b);console[_0x3000b7(0x1aa)](_0x3000b7(0x13a)),console[_0x3000b7(0x1aa)](_0x3000b7(0x154),_0x3066c7),loggerService_1[_0x3000b7(0x170)][_0x3000b7(0x162)](_0x3000b7(0x16b),_0x3000b7(0x169),'Business\x20Error:\x20'+_0x3066c7);throw new Error(_0x3000b7(0x13d)+_0x3066c7);}if(!_0x50e17c[_0x3000b7(0x14c)]||!_0x50e17c[_0x3000b7(0x142)]){console[_0x3000b7(0x1aa)](_0x3000b7(0x183)),console[_0x3000b7(0x1aa)](_0x3000b7(0x188)),console['error'](_0x3000b7(0x196),_0x50e17c),loggerService_1[_0x3000b7(0x170)][_0x3000b7(0x162)](_0x3000b7(0x16b),_0x3000b7(0x169),_0x3000b7(0x184));throw new Error(_0x3000b7(0x197));}return console['log'](_0x3000b7(0x1b4)),console[_0x3000b7(0x178)]('Gateway\x20Payment\x20ID:',_0x50e17c[_0x3000b7(0x142)]),console[_0x3000b7(0x178)](_0x3000b7(0x18f),_0x50e17c['payment_url']),console[_0x3000b7(0x178)]('Amount:',_0x526631,_0x3000b7(0x16c)),{'gateway_payment_id':_0x50e17c['gateway_payment_id'],'payment_url':_0x50e17c[_0x3000b7(0x14c)]};}catch(_0x405b07){console[_0x3000b7(0x1aa)](_0x3000b7(0x161)),console[_0x3000b7(0x1aa)](_0x3000b7(0x130),_0x405b07),loggerService_1['loggerService'][_0x3000b7(0x162)](_0x3000b7(0x16b),'/create',_0x405b07);if(_0x405b07 instanceof Error){console['error'](_0x3000b7(0x17c),_0x405b07[_0x3000b7(0x132)]),console[_0x3000b7(0x1aa)](_0x3000b7(0x147),_0x405b07[_0x3000b7(0x160)]);throw new Error(_0x3000b7(0x13b)+_0x405b07[_0x3000b7(0x132)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x204312){const _0x1eec02=a41_0x4ac181,_0xe1d1eb=Date[_0x1eec02(0x1ab)]();try{console['log'](_0x1eec02(0x1b8)+_0x204312);const _0x11e91b={'gatewayPaymentId':_0x204312};loggerService_1[_0x1eec02(0x170)][_0x1eec02(0x141)](_0x1eec02(0x16b),_0x1eec02(0x135),_0x1eec02(0x16d),_0x11e91b);const _0x305349=await fetch(this[_0x1eec02(0x137)],{'method':_0x1eec02(0x16d),'headers':{'Content-Type':_0x1eec02(0x15e),'Accept':_0x1eec02(0x15e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x11e91b)}),_0x24897c=Date['now']()-_0xe1d1eb;console[_0x1eec02(0x178)](_0x1eec02(0x1a3)),console[_0x1eec02(0x178)](_0x1eec02(0x181),_0x305349[_0x1eec02(0x139)]),console['log'](_0x1eec02(0x158),_0x24897c+'ms');if(!_0x305349['ok']){const _0x405f50=await _0x305349[_0x1eec02(0x144)]();console[_0x1eec02(0x1aa)](_0x1eec02(0x182),_0x305349[_0x1eec02(0x139)]),console[_0x1eec02(0x1aa)](_0x1eec02(0x14f),_0x405f50),loggerService_1[_0x1eec02(0x170)][_0x1eec02(0x1a8)](_0x1eec02(0x16b),_0x1eec02(0x135),_0x305349['status'],_0x405f50,_0x24897c),loggerService_1['loggerService'][_0x1eec02(0x162)](_0x1eec02(0x16b),_0x1eec02(0x135),_0x1eec02(0x16e)+_0x305349[_0x1eec02(0x139)]+':\x20'+_0x405f50);throw new Error('HTTP\x20error!\x20status:\x20'+_0x305349[_0x1eec02(0x139)]);}const _0x2bec0f=await _0x305349[_0x1eec02(0x144)]();console[_0x1eec02(0x178)](_0x1eec02(0x1a9),_0x2bec0f);let _0x3cf19b;try{_0x3cf19b=JSON[_0x1eec02(0x194)](_0x2bec0f);}catch(_0x5b62c0){console[_0x1eec02(0x1aa)](_0x1eec02(0x1a1),_0x5b62c0),loggerService_1['loggerService'][_0x1eec02(0x162)](_0x1eec02(0x16b),_0x1eec02(0x135),_0x1eec02(0x12e)+_0x5b62c0);throw new Error(_0x1eec02(0x165)+_0x2bec0f);}loggerService_1['loggerService'][_0x1eec02(0x1a8)](_0x1eec02(0x16b),_0x1eec02(0x135),_0x305349[_0x1eec02(0x139)],_0x3cf19b,_0x24897c),console[_0x1eec02(0x178)](_0x1eec02(0x1b5)),console['log'](_0x1eec02(0x155),_0x3cf19b[_0x1eec02(0x13e)]),console[_0x1eec02(0x178)]('Status\x20Code:',_0x3cf19b[_0x1eec02(0x190)]),console['log']('Payment\x20Status:',_0x3cf19b[_0x1eec02(0x168)]?.[_0x1eec02(0x148)]),console[_0x1eec02(0x178)](_0x1eec02(0x18d),_0x3cf19b[_0x1eec02(0x168)]?.[_0x1eec02(0x15c)]),console['log']('Currency:',_0x3cf19b[_0x1eec02(0x168)]?.[_0x1eec02(0x186)]);if(_0x3cf19b[_0x1eec02(0x13e)]!==_0x1eec02(0x13f)||_0x3cf19b[_0x1eec02(0x190)]!==0xc8){const _0x1fadb2=_0x3cf19b['message']||_0x1eec02(0x195);console[_0x1eec02(0x1aa)](_0x1eec02(0x131)),console['error'](_0x1eec02(0x154),_0x1fadb2),loggerService_1['loggerService']['logWhiteDomainError'](_0x1eec02(0x16b),_0x1eec02(0x135),_0x1eec02(0x19b)+_0x1fadb2);throw new Error(_0x1eec02(0x1b2)+_0x1fadb2);}if(!_0x3cf19b[_0x1eec02(0x168)]){console[_0x1eec02(0x1aa)](_0x1eec02(0x185)),console[_0x1eec02(0x1aa)](_0x1eec02(0x1ac)),loggerService_1[_0x1eec02(0x170)][_0x1eec02(0x162)](_0x1eec02(0x16b),'/status',_0x1eec02(0x177));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2201bf=_0x1eec02(0x150);switch(_0x3cf19b['data'][_0x1eec02(0x148)]?.[_0x1eec02(0x191)]()){case _0x1eec02(0x1a6):_0x2201bf=_0x1eec02(0x1a4);break;case _0x1eec02(0x179):case _0x1eec02(0x1a2):case _0x1eec02(0x1aa):_0x2201bf=_0x1eec02(0x152);break;case _0x1eec02(0x14e):case _0x1eec02(0x166):_0x2201bf=_0x1eec02(0x1b7);break;case _0x1eec02(0x143):case _0x1eec02(0x134):case _0x1eec02(0x133):case _0x1eec02(0x159):default:_0x2201bf=_0x1eec02(0x150);break;}let _0x502610,_0x447261;if(_0x3cf19b[_0x1eec02(0x168)]['PaymentDetail']){const _0x403793=_0x3cf19b['data'][_0x1eec02(0x14a)];console['log'](_0x1eec02(0x18c),_0x403793);const _0x47786f=_0x403793[_0x1eec02(0x19e)](/IBAN\s+([A-Z0-9]+)/i);_0x47786f&&(_0x502610=_0x47786f[0x1],console[_0x1eec02(0x178)](_0x1eec02(0x17e),_0x502610)),_0x447261=_0x403793;}const _0x2be870={'iban':_0x502610,'bankDetails':_0x447261,'transactionId':_0x3cf19b[_0x1eec02(0x168)]['TransactionID'],'coinAddress':_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x140)],'qrCodeUrl':_0x3cf19b[_0x1eec02(0x168)]['QRCodeURL'],'expiryTime':_0x3cf19b[_0x1eec02(0x168)]['ExpiryTime'],'createdOn':_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x16a)],'confirmedOn':_0x3cf19b['data']['TransactionConfirmedOn']};console[_0x1eec02(0x178)](_0x1eec02(0x17a)),console['log'](_0x1eec02(0x181),_0x3cf19b['data'][_0x1eec02(0x148)],'->',_0x2201bf),console[_0x1eec02(0x178)](_0x1eec02(0x18d),_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x15c)],_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x186)]),console['log'](_0x1eec02(0x199),_0x3cf19b[_0x1eec02(0x168)]['TransactionID']),console[_0x1eec02(0x178)](_0x1eec02(0x138),_0x502610||_0x1eec02(0x1a0)),console[_0x1eec02(0x178)]('Created\x20On:',_0x3cf19b[_0x1eec02(0x168)]['CreatedOn']),console[_0x1eec02(0x178)](_0x1eec02(0x189),_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x187)]||_0x1eec02(0x15a));if(_0x3cf19b[_0x1eec02(0x168)]['Status']?.[_0x1eec02(0x191)]()===_0x1eec02(0x134))console['log'](_0x1eec02(0x176));else _0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x148)]?.[_0x1eec02(0x191)]()==='paid'&&console[_0x1eec02(0x178)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x2201bf,'amount':parseFloat(_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x15c)])||undefined,'currency':_0x3cf19b[_0x1eec02(0x168)][_0x1eec02(0x186)]||_0x1eec02(0x16c),'paymentDetails':_0x2be870};}catch(_0x4838dc){console['error'](_0x1eec02(0x18a),_0x4838dc),loggerService_1['loggerService'][_0x1eec02(0x162)](_0x1eec02(0x16b),'/status',_0x4838dc);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x4838dc instanceof Error?_0x4838dc[_0x1eec02(0x132)]:_0x1eec02(0x198)));}}async[a41_0x4ac181(0x19f)](_0x442e26){const _0x4b78b2=a41_0x4ac181,_0x2c1212=await this[_0x4b78b2(0x16f)](_0x442e26);return{'status':_0x2c1212[_0x4b78b2(0x139)],'amount':_0x2c1212[_0x4b78b2(0x19a)],'currency':_0x2c1212[_0x4b78b2(0x175)]};}async[a41_0x4ac181(0x136)](_0x22e321){const _0xfa0b11=a41_0x4ac181;console[_0xfa0b11(0x178)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x22e321);let _0x1a46dd=_0xfa0b11(0x150);switch(_0x22e321['status']?.['toLowerCase']()){case _0xfa0b11(0x1a6):_0x1a46dd=_0xfa0b11(0x1a4);break;case'cancelled':case'failed':case _0xfa0b11(0x1aa):_0x1a46dd=_0xfa0b11(0x152);break;case'expired':case'timeout':_0x1a46dd=_0xfa0b11(0x1b7);break;case _0xfa0b11(0x133):case _0xfa0b11(0x143):case _0xfa0b11(0x134):case'created':default:_0x1a46dd=_0xfa0b11(0x150);break;}return{'paymentId':_0x22e321[_0xfa0b11(0x18e)]||_0x22e321['merchant_reference_id']||'','status':_0x1a46dd,'amount':_0x22e321[_0xfa0b11(0x19a)],'currency':_0x22e321[_0xfa0b11(0x175)]||_0xfa0b11(0x16c)};}}exports[a41_0x4ac181(0x15b)]=CoinToPayService;