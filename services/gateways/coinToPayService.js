'use strict';const a43_0x506c4c=a43_0x56d7;(function(_0x580943,_0x26f5b1){const _0x3f9230=a43_0x56d7,_0x3e9242=_0x580943();while(!![]){try{const _0x3bf314=parseInt(_0x3f9230(0x19d))/0x1*(parseInt(_0x3f9230(0x1c5))/0x2)+parseInt(_0x3f9230(0x1c6))/0x3+parseInt(_0x3f9230(0x14e))/0x4*(-parseInt(_0x3f9230(0x16e))/0x5)+parseInt(_0x3f9230(0x1ca))/0x6+-parseInt(_0x3f9230(0x1c3))/0x7*(parseInt(_0x3f9230(0x1bf))/0x8)+-parseInt(_0x3f9230(0x159))/0x9+-parseInt(_0x3f9230(0x14c))/0xa*(parseInt(_0x3f9230(0x166))/0xb);if(_0x3bf314===_0x26f5b1)break;else _0x3e9242['push'](_0x3e9242['shift']());}catch(_0x8b0696){_0x3e9242['push'](_0x3e9242['shift']());}}}(a43_0x3b71,0x65356));function a43_0x3b71(){const _0x545baf=['coinAddress','6460821gzVqqO','CoinToPayService','PAID','amount','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','merchant_reference_id','Error\x20Message:','apiUrl','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Currency:','Raw\x20Response\x20Body:','status','Amount:','248842lTMKmp','loggerService','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','headers','__esModule','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','POST','HTTP\x20','20815Cefkno','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Request\x20Body:','statusUrl','CoinToPay\x20payment\x20status\x20check\x20error:','failed','CreatedOn','currency','EUR','toLowerCase','JSON\x20Parse\x20Error:\x20','Status','expired','Unknown\x20error','🪙\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','error','Status:','===\x20COINTOPAY\x20API\x20ERROR\x20===','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EXPIRED','order_id','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status_code','Response\x20Time:','QRCodeURL','Amount','paid','result','waiting','parse','Payment\x20Status:','HTTP\x20error!\x20status:\x20','logWhiteDomainRequest','/create','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','awaiting\x20fiat','now','PaymentDetail','PENDING','/status','inputCurrency','data','3823egGAlS','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20SUCCESS\x20===','Status\x20API\x20Error:\x20','defineProperty','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','stringify','checkPaymentStatus','not\x20confirmed','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','cointopay','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','payment_url','📊\x20Status\x20check\x20URL:','CoinToPay\x20API\x20error:\x20','stack','Error\x20details:','logWhiteDomainError','Status\x20Code:','Business\x20Error:\x20','Parsed\x20Result:','text','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','TransactionConfirmedOn','application/json','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','entries','\x20EUR','IBAN:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionID','Error\x20message:','1341976sxJTuy','Transaction\x20ID:','success','timeout','7IQiQUm','not\x20found','394PZkytD','1265115TpsWzK','HTTP\x20Status:','logWhiteDomainResponse','FAILED','987624KIGfGR','../loggerService','TesSoft\x20Payment\x20System/1.0','verifyPayment','Error\x20stack:','gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','message','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','createPaymentLink','10pXTYPf','pending','16iCrIoU','log','processWebhook','Result:','Status\x20Text:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Body:','created','Created\x20On:'];a43_0x3b71=function(){return _0x545baf;};return a43_0x3b71();}Object[a43_0x506c4c(0x1a1)](exports,a43_0x506c4c(0x16a),{'value':!![]}),exports[a43_0x506c4c(0x15a)]=void 0x0;function a43_0x56d7(_0x28c113,_0x1b9554){const _0x3b71a9=a43_0x3b71();return a43_0x56d7=function(_0x56d7c9,_0x15c1f6){_0x56d7c9=_0x56d7c9-0x146;let _0x5a5514=_0x3b71a9[_0x56d7c9];return _0x5a5514;},a43_0x56d7(_0x28c113,_0x1b9554);}const loggerService_1=require(a43_0x506c4c(0x1cb));class CoinToPayService{constructor(){const _0x564d92=a43_0x506c4c;this[_0x564d92(0x160)]=_0x564d92(0x1a6),this[_0x564d92(0x172)]=_0x564d92(0x1b7),console[_0x564d92(0x14f)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x564d92(0x14f)](_0x564d92(0x1ab),this['statusUrl']);}async[a43_0x506c4c(0x14b)](_0x27cfd1){const _0x4964e6=a43_0x506c4c,{orderId:_0xa89c7,amount:_0x49ac7e}=_0x27cfd1;console[_0x4964e6(0x14f)](_0x4964e6(0x17d)+_0x49ac7e+_0x4964e6(0x1ba));const _0x3d893f={'amount':_0x49ac7e},_0x5e5129=Date['now']();try{console['log'](_0x4964e6(0x1a7)),console['log']('URL:',this[_0x4964e6(0x160)]),console[_0x4964e6(0x14f)](_0x4964e6(0x171),JSON['stringify'](_0x3d893f,null,0x2)),console[_0x4964e6(0x14f)](_0x4964e6(0x165),_0x49ac7e,_0x4964e6(0x161)),loggerService_1['loggerService'][_0x4964e6(0x192)](_0x4964e6(0x1a8),_0x4964e6(0x193),_0x4964e6(0x16c),_0x3d893f);const _0x212c97=await fetch(this['apiUrl'],{'method':_0x4964e6(0x16c),'headers':{'Content-Type':_0x4964e6(0x1b6),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x4964e6(0x1a3)](_0x3d893f)}),_0xf10fbd=Date[_0x4964e6(0x197)]()-_0x5e5129;console['log'](_0x4964e6(0x187)),console[_0x4964e6(0x14f)](_0x4964e6(0x180),_0x212c97[_0x4964e6(0x164)]),console[_0x4964e6(0x14f)](_0x4964e6(0x152),_0x212c97['statusText']),console[_0x4964e6(0x14f)]('Headers:',Object['fromEntries'](_0x212c97[_0x4964e6(0x169)][_0x4964e6(0x1b9)]())),console[_0x4964e6(0x14f)](_0x4964e6(0x189),_0xf10fbd+'ms');const _0x368d2a=await _0x212c97[_0x4964e6(0x1b3)]();console[_0x4964e6(0x14f)]('Raw\x20Response\x20Body:',_0x368d2a);if(!_0x212c97['ok']){console[_0x4964e6(0x17f)](_0x4964e6(0x181)),console[_0x4964e6(0x17f)](_0x4964e6(0x1c7),_0x212c97['status']),console['error'](_0x4964e6(0x155),_0x368d2a),loggerService_1[_0x4964e6(0x167)][_0x4964e6(0x1c8)](_0x4964e6(0x1a8),_0x4964e6(0x193),_0x212c97[_0x4964e6(0x164)],_0x368d2a,_0xf10fbd),loggerService_1[_0x4964e6(0x167)][_0x4964e6(0x1af)](_0x4964e6(0x1a8),'/create',_0x4964e6(0x16d)+_0x212c97['status']+':\x20'+_0x368d2a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x212c97[_0x4964e6(0x164)]+',\x20body:\x20'+_0x368d2a);}let _0x3802b8;try{_0x3802b8=JSON[_0x4964e6(0x18f)](_0x368d2a);}catch(_0x37bd0c){console[_0x4964e6(0x17f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x37bd0c),loggerService_1[_0x4964e6(0x167)]['logWhiteDomainError'](_0x4964e6(0x1a8),_0x4964e6(0x193),'JSON\x20Parse\x20Error:\x20'+_0x37bd0c);throw new Error(_0x4964e6(0x154)+_0x368d2a);}console[_0x4964e6(0x14f)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x4964e6(0x14f)](_0x4964e6(0x1b2),JSON[_0x4964e6(0x1a3)](_0x3802b8,null,0x2)),loggerService_1[_0x4964e6(0x167)]['logWhiteDomainResponse']('cointopay',_0x4964e6(0x193),_0x212c97[_0x4964e6(0x164)],_0x3802b8,_0xf10fbd);if(_0x3802b8[_0x4964e6(0x17f)]){const _0x32a1ed=_0x3802b8[_0x4964e6(0x149)]||_0x3802b8[_0x4964e6(0x17f)]||_0x4964e6(0x195);console[_0x4964e6(0x17f)](_0x4964e6(0x17e)),console[_0x4964e6(0x17f)](_0x4964e6(0x15f),_0x32a1ed),loggerService_1[_0x4964e6(0x167)][_0x4964e6(0x1af)]('cointopay','/create',_0x4964e6(0x1b1)+_0x32a1ed);throw new Error(_0x4964e6(0x1ac)+_0x32a1ed);}if(!_0x3802b8[_0x4964e6(0x1aa)]||!_0x3802b8['gateway_payment_id']){console[_0x4964e6(0x17f)](_0x4964e6(0x1a9)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x4964e6(0x17f)](_0x4964e6(0x16f),_0x3802b8),loggerService_1[_0x4964e6(0x167)]['logWhiteDomainError'](_0x4964e6(0x1a8),_0x4964e6(0x193),_0x4964e6(0x1bc));throw new Error(_0x4964e6(0x194));}return console[_0x4964e6(0x14f)](_0x4964e6(0x19f)),console[_0x4964e6(0x14f)]('Gateway\x20Payment\x20ID:',_0x3802b8[_0x4964e6(0x147)]),console[_0x4964e6(0x14f)]('Payment\x20URL:',_0x3802b8[_0x4964e6(0x1aa)]),console[_0x4964e6(0x14f)](_0x4964e6(0x165),_0x49ac7e,_0x4964e6(0x177)),{'gateway_payment_id':_0x3802b8[_0x4964e6(0x147)],'payment_url':_0x3802b8[_0x4964e6(0x1aa)]};}catch(_0x243c99){console[_0x4964e6(0x17f)](_0x4964e6(0x153)),console[_0x4964e6(0x17f)](_0x4964e6(0x1ae),_0x243c99),loggerService_1[_0x4964e6(0x167)]['logWhiteDomainError'](_0x4964e6(0x1a8),'/create',_0x243c99);if(_0x243c99 instanceof Error){console[_0x4964e6(0x17f)](_0x4964e6(0x1be),_0x243c99[_0x4964e6(0x149)]),console['error'](_0x4964e6(0x146),_0x243c99[_0x4964e6(0x1ad)]);throw new Error(_0x4964e6(0x148)+_0x243c99['message']);}throw new Error(_0x4964e6(0x1a2));}}async[a43_0x506c4c(0x1a4)](_0xf96d59){const _0x41e486=a43_0x506c4c,_0x2bfc72=Date[_0x41e486(0x197)]();try{console['log'](_0x41e486(0x182)+_0xf96d59);const _0x417204={'gatewayPaymentId':_0xf96d59};loggerService_1[_0x41e486(0x167)]['logWhiteDomainRequest'](_0x41e486(0x1a8),'/status',_0x41e486(0x16c),_0x417204);const _0x5dfd11=await fetch(this[_0x41e486(0x172)],{'method':_0x41e486(0x16c),'headers':{'Content-Type':_0x41e486(0x1b6),'Accept':_0x41e486(0x1b6),'User-Agent':_0x41e486(0x1cc)},'body':JSON[_0x41e486(0x1a3)](_0x417204)}),_0x1a6baa=Date['now']()-_0x2bfc72;console['log'](_0x41e486(0x1b8)),console[_0x41e486(0x14f)](_0x41e486(0x180),_0x5dfd11['status']),console[_0x41e486(0x14f)]('Response\x20Time:',_0x1a6baa+'ms');if(!_0x5dfd11['ok']){const _0x23473e=await _0x5dfd11[_0x41e486(0x1b3)]();console[_0x41e486(0x17f)](_0x41e486(0x1c7),_0x5dfd11[_0x41e486(0x164)]),console['error'](_0x41e486(0x155),_0x23473e),loggerService_1['loggerService'][_0x41e486(0x1c8)](_0x41e486(0x1a8),'/status',_0x5dfd11[_0x41e486(0x164)],_0x23473e,_0x1a6baa),loggerService_1[_0x41e486(0x167)][_0x41e486(0x1af)](_0x41e486(0x1a8),_0x41e486(0x19a),_0x41e486(0x16d)+_0x5dfd11['status']+':\x20'+_0x23473e);throw new Error(_0x41e486(0x191)+_0x5dfd11['status']);}const _0x441fac=await _0x5dfd11[_0x41e486(0x1b3)]();console['log'](_0x41e486(0x163),_0x441fac);let _0x1736da;try{_0x1736da=JSON[_0x41e486(0x18f)](_0x441fac);}catch(_0x30c722){console[_0x41e486(0x17f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x30c722),loggerService_1[_0x41e486(0x167)][_0x41e486(0x1af)](_0x41e486(0x1a8),_0x41e486(0x19a),_0x41e486(0x179)+_0x30c722);throw new Error(_0x41e486(0x16b)+_0x441fac);}loggerService_1['loggerService'][_0x41e486(0x1c8)](_0x41e486(0x1a8),'/status',_0x5dfd11['status'],_0x1736da,_0x1a6baa),console[_0x41e486(0x14f)](_0x41e486(0x15d)),console[_0x41e486(0x14f)](_0x41e486(0x151),_0x1736da[_0x41e486(0x18d)]),console[_0x41e486(0x14f)](_0x41e486(0x1b0),_0x1736da['status_code']),console[_0x41e486(0x14f)](_0x41e486(0x190),_0x1736da['data']?.[_0x41e486(0x17a)]),console[_0x41e486(0x14f)](_0x41e486(0x165),_0x1736da[_0x41e486(0x19c)]?.[_0x41e486(0x18b)]),console[_0x41e486(0x14f)](_0x41e486(0x162),_0x1736da[_0x41e486(0x19c)]?.[_0x41e486(0x19b)]);if(_0x1736da[_0x41e486(0x18d)]!==_0x41e486(0x1c1)||_0x1736da[_0x41e486(0x188)]!==0xc8){const _0x5af9d6=_0x1736da['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x41e486(0x17f)](_0x41e486(0x170)),console['error'](_0x41e486(0x15f),_0x5af9d6),loggerService_1[_0x41e486(0x167)][_0x41e486(0x1af)]('cointopay',_0x41e486(0x19a),_0x41e486(0x1a0)+_0x5af9d6);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5af9d6);}if(!_0x1736da[_0x41e486(0x19c)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x41e486(0x19e)),loggerService_1['loggerService']['logWhiteDomainError'](_0x41e486(0x1a8),_0x41e486(0x19a),_0x41e486(0x185));throw new Error(_0x41e486(0x186));}let _0x41bb1b=_0x41e486(0x199);switch(_0x1736da['data'][_0x41e486(0x17a)]?.[_0x41e486(0x178)]()){case _0x41e486(0x18c):_0x41bb1b=_0x41e486(0x15b);break;case'cancelled':case _0x41e486(0x174):case'error':_0x41bb1b=_0x41e486(0x1c9);break;case _0x41e486(0x17b):case _0x41e486(0x1c2):_0x41bb1b=_0x41e486(0x183);break;case _0x41e486(0x18e):case'awaiting\x20fiat':case'pending':case _0x41e486(0x156):default:_0x41bb1b=_0x41e486(0x199);break;}let _0x2eae5d,_0x33e6ef;if(_0x1736da[_0x41e486(0x19c)]['PaymentDetail']){const _0x452450=_0x1736da[_0x41e486(0x19c)][_0x41e486(0x198)];console[_0x41e486(0x14f)]('🏦\x20Payment\x20Detail:',_0x452450);const _0x17f316=_0x452450['match'](/IBAN\s+([A-Z0-9]+)/i);_0x17f316&&(_0x2eae5d=_0x17f316[0x1],console[_0x41e486(0x14f)]('🏦\x20Extracted\x20IBAN:',_0x2eae5d)),_0x33e6ef=_0x452450;}const _0x4b6044={'iban':_0x2eae5d,'bankDetails':_0x33e6ef,'transactionId':_0x1736da[_0x41e486(0x19c)][_0x41e486(0x1bd)],'coinAddress':_0x1736da[_0x41e486(0x19c)][_0x41e486(0x158)],'qrCodeUrl':_0x1736da['data'][_0x41e486(0x18a)],'expiryTime':_0x1736da[_0x41e486(0x19c)]['ExpiryTime'],'createdOn':_0x1736da[_0x41e486(0x19c)][_0x41e486(0x175)],'confirmedOn':_0x1736da['data'][_0x41e486(0x1b5)]};console[_0x41e486(0x14f)](_0x41e486(0x1b4)),console[_0x41e486(0x14f)]('Status:',_0x1736da[_0x41e486(0x19c)][_0x41e486(0x17a)],'->',_0x41bb1b),console[_0x41e486(0x14f)](_0x41e486(0x165),_0x1736da[_0x41e486(0x19c)]['Amount'],_0x1736da['data'][_0x41e486(0x19b)]),console[_0x41e486(0x14f)](_0x41e486(0x1c0),_0x1736da['data']['TransactionID']),console[_0x41e486(0x14f)](_0x41e486(0x1bb),_0x2eae5d||_0x41e486(0x1c4)),console['log'](_0x41e486(0x157),_0x1736da['data']['CreatedOn']),console[_0x41e486(0x14f)]('Confirmed\x20On:',_0x1736da[_0x41e486(0x19c)][_0x41e486(0x1b5)]||_0x41e486(0x1a5));if(_0x1736da[_0x41e486(0x19c)][_0x41e486(0x17a)]?.[_0x41e486(0x178)]()===_0x41e486(0x196))console[_0x41e486(0x14f)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x1736da[_0x41e486(0x19c)]['Status']?.['toLowerCase']()===_0x41e486(0x18c)&&console[_0x41e486(0x14f)](_0x41e486(0x14a));return{'status':_0x41bb1b,'amount':parseFloat(_0x1736da[_0x41e486(0x19c)][_0x41e486(0x18b)])||undefined,'currency':_0x1736da[_0x41e486(0x19c)]['inputCurrency']||'EUR','paymentDetails':_0x4b6044};}catch(_0x47fcfe){console[_0x41e486(0x17f)](_0x41e486(0x173),_0x47fcfe),loggerService_1[_0x41e486(0x167)]['logWhiteDomainError'](_0x41e486(0x1a8),_0x41e486(0x19a),_0x47fcfe);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x47fcfe instanceof Error?_0x47fcfe[_0x41e486(0x149)]:_0x41e486(0x17c)));}}async[a43_0x506c4c(0x1cd)](_0x596520){const _0x44b0a4=a43_0x506c4c,_0xb03ad6=await this['checkPaymentStatus'](_0x596520);return{'status':_0xb03ad6[_0x44b0a4(0x164)],'amount':_0xb03ad6[_0x44b0a4(0x15c)],'currency':_0xb03ad6[_0x44b0a4(0x176)]};}async[a43_0x506c4c(0x150)](_0x276878){const _0x4e571b=a43_0x506c4c;console[_0x4e571b(0x14f)](_0x4e571b(0x168),_0x276878);let _0x192cdb='PENDING';switch(_0x276878['status']?.[_0x4e571b(0x178)]()){case _0x4e571b(0x18c):_0x192cdb=_0x4e571b(0x15b);break;case'cancelled':case'failed':case _0x4e571b(0x17f):_0x192cdb=_0x4e571b(0x1c9);break;case _0x4e571b(0x17b):case _0x4e571b(0x1c2):_0x192cdb=_0x4e571b(0x183);break;case _0x4e571b(0x14d):case _0x4e571b(0x18e):case'awaiting\x20fiat':case _0x4e571b(0x156):default:_0x192cdb=_0x4e571b(0x199);break;}return{'paymentId':_0x276878[_0x4e571b(0x184)]||_0x276878[_0x4e571b(0x15e)]||'','status':_0x192cdb,'amount':_0x276878['amount'],'currency':_0x276878[_0x4e571b(0x176)]||_0x4e571b(0x177)};}}exports[a43_0x506c4c(0x15a)]=CoinToPayService;