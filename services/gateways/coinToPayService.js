'use strict';function a47_0x2aab(_0x26aee2,_0x525c4d){const _0x3ab82c=a47_0x3ab8();return a47_0x2aab=function(_0x2aab7f,_0x30d30c){_0x2aab7f=_0x2aab7f-0x1ad;let _0x4517cd=_0x3ab82c[_0x2aab7f];return _0x4517cd;},a47_0x2aab(_0x26aee2,_0x525c4d);}const a47_0x294e42=a47_0x2aab;(function(_0x33848d,_0x47bc36){const _0x2a119e=a47_0x2aab,_0x135c8b=_0x33848d();while(!![]){try{const _0x13ea10=parseInt(_0x2a119e(0x1d2))/0x1+-parseInt(_0x2a119e(0x22e))/0x2*(parseInt(_0x2a119e(0x209))/0x3)+-parseInt(_0x2a119e(0x1d7))/0x4*(-parseInt(_0x2a119e(0x1f2))/0x5)+-parseInt(_0x2a119e(0x239))/0x6+parseInt(_0x2a119e(0x215))/0x7*(parseInt(_0x2a119e(0x223))/0x8)+parseInt(_0x2a119e(0x1e4))/0x9+parseInt(_0x2a119e(0x1ae))/0xa*(-parseInt(_0x2a119e(0x206))/0xb);if(_0x13ea10===_0x47bc36)break;else _0x135c8b['push'](_0x135c8b['shift']());}catch(_0x4b86d7){_0x135c8b['push'](_0x135c8b['shift']());}}}(a47_0x3ab8,0xb1783));function a47_0x3ab8(){const _0x21916e=['logWhiteDomainResponse','3486ybIkWX','IBAN:','HTTP\x20','logWhiteDomainError','Incomplete\x20response:\x20missing\x20data','Error\x20stack:','Payment\x20Status:','Payment\x20URL\x20(original):','Business\x20Error:\x20','expired','QRCodeURL','amount','6856689mjaCtb','__esModule','loggerService','not\x20found','Created\x20On:','verifyPayment','FAILED','EUR','defineProperty','Missing\x20data\x20in\x20response','gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20details:','Response\x20Body:','8cnjVok','createPaymentLink','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','not\x20confirmed','Status:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','TransactionID','Error\x20message:','pending','Status','1574CNZMXG','===\x20COINTOPAY\x20SUCCESS\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/','match','115722NzeKpe','inputCurrency','440EkRfCD',',\x20body:\x20','paid','CreatedOn','statusUrl','logWhiteDomainRequest','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','stringify','../loggerService','CoinToPay\x20API\x20error:\x20','Response\x20Time:','failed','CoinToPay\x20payment\x20status\x20check\x20error:','URL:','Response\x20data:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error','/create','success','apiUrl','created','application/json','&alternative=false','https://tesoft.uk/gateway/cointopay/status.php','waiting','/status','headers','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','EXPIRED','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','entries','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','data','Result:','checkPaymentStatus','log','742337ZzPpfv','timeout','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status\x20Code:','452OTxcVP','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20error!\x20status:\x20','coinAddress','PAID','statusText','üè¶\x20Extracted\x20IBAN:','Currency:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','JSON\x20Parse\x20Error:\x20','cointopay','Headers:','toLowerCase','8737605ERkVvQ','stack','message','result','ExpiryTime','Amount:','üìä\x20Status\x20check\x20URL:','Confirmed\x20On:','HTTP\x20Status:','Parsed\x20Result:','Status\x20Text:','CoinToPayService','parse','Payment\x20URL\x20(modified):','62455rfIGod','payment_url','status_code','PENDING','error','status','TransactionConfirmedOn','Request\x20Body:','Amount','Raw\x20Response\x20Body:','awaiting\x20fiat','Transaction\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Error\x20Message:','currency','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','üè¶\x20Payment\x20Detail:','processWebhook','POST','now','610874KyoJBL','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='];a47_0x3ab8=function(){return _0x21916e;};return a47_0x3ab8();}Object[a47_0x294e42(0x21d)](exports,a47_0x294e42(0x216),{'value':!![]}),exports[a47_0x294e42(0x1ef)]=void 0x0;const loggerService_1=require(a47_0x294e42(0x1b6));class CoinToPayService{constructor(){const _0x3f1896=a47_0x294e42;this[_0x3f1896(0x1c1)]=_0x3f1896(0x237),this['statusUrl']=_0x3f1896(0x1c5),console['log'](_0x3f1896(0x1bd)),console['log'](_0x3f1896(0x1ea),this[_0x3f1896(0x1b2)]);}async[a47_0x294e42(0x224)](_0x42525d){const _0x31958d=a47_0x294e42,{orderId:_0x2605c4,amount:_0x4d4833}=_0x42525d;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4d4833+'\x20EUR');const _0x3c5c1a={'amount':_0x4d4833},_0x4c5045=Date[_0x31958d(0x205)]();try{console[_0x31958d(0x1d1)](_0x31958d(0x228)),console[_0x31958d(0x1d1)](_0x31958d(0x1bb),this[_0x31958d(0x1c1)]),console[_0x31958d(0x1d1)](_0x31958d(0x1f9),JSON[_0x31958d(0x1b5)](_0x3c5c1a,null,0x2)),console[_0x31958d(0x1d1)](_0x31958d(0x1e9),_0x4d4833,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x31958d(0x217)][_0x31958d(0x1b3)](_0x31958d(0x1e1),_0x31958d(0x1bf),_0x31958d(0x204),_0x3c5c1a);const _0x1d87de=await fetch(this[_0x31958d(0x1c1)],{'method':_0x31958d(0x204),'headers':{'Content-Type':_0x31958d(0x1c3),'Accept':_0x31958d(0x1c3),'User-Agent':_0x31958d(0x234)},'body':JSON[_0x31958d(0x1b5)](_0x3c5c1a)}),_0x4b6c3b=Date[_0x31958d(0x205)]()-_0x4c5045;console['log'](_0x31958d(0x1df)),console[_0x31958d(0x1d1)](_0x31958d(0x227),_0x1d87de[_0x31958d(0x1f7)]),console[_0x31958d(0x1d1)](_0x31958d(0x1ee),_0x1d87de[_0x31958d(0x1dc)]),console[_0x31958d(0x1d1)](_0x31958d(0x1e2),Object['fromEntries'](_0x1d87de[_0x31958d(0x1c8)][_0x31958d(0x1cc)]())),console[_0x31958d(0x1d1)](_0x31958d(0x1b8),_0x4b6c3b+'ms');const _0x2a7d98=await _0x1d87de['text']();console[_0x31958d(0x1d1)](_0x31958d(0x1fb),_0x2a7d98);if(!_0x1d87de['ok']){console[_0x31958d(0x1f6)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x31958d(0x1f6)](_0x31958d(0x1ec),_0x1d87de[_0x31958d(0x1f7)]),console[_0x31958d(0x1f6)](_0x31958d(0x222),_0x2a7d98),loggerService_1[_0x31958d(0x217)][_0x31958d(0x208)](_0x31958d(0x1e1),'/create',_0x1d87de[_0x31958d(0x1f7)],_0x2a7d98,_0x4b6c3b),loggerService_1[_0x31958d(0x217)][_0x31958d(0x20c)](_0x31958d(0x1e1),_0x31958d(0x1bf),_0x31958d(0x20b)+_0x1d87de[_0x31958d(0x1f7)]+':\x20'+_0x2a7d98);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d87de[_0x31958d(0x1f7)]+_0x31958d(0x1af)+_0x2a7d98);}let _0x18d449;try{_0x18d449=JSON['parse'](_0x2a7d98);}catch(_0x2bfebd){console[_0x31958d(0x1f6)](_0x31958d(0x230),_0x2bfebd),loggerService_1[_0x31958d(0x217)][_0x31958d(0x20c)]('cointopay',_0x31958d(0x1bf),'JSON\x20Parse\x20Error:\x20'+_0x2bfebd);throw new Error(_0x31958d(0x229)+_0x2a7d98);}console[_0x31958d(0x1d1)](_0x31958d(0x225)),console[_0x31958d(0x1d1)](_0x31958d(0x1ed),JSON['stringify'](_0x18d449,null,0x2)),loggerService_1[_0x31958d(0x217)][_0x31958d(0x208)](_0x31958d(0x1e1),'/create',_0x1d87de['status'],_0x18d449,_0x4b6c3b);if(_0x18d449['error']){const _0x57c330=_0x18d449[_0x31958d(0x1e6)]||_0x18d449[_0x31958d(0x1f6)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x31958d(0x1f6)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x31958d(0x1ff),_0x57c330),loggerService_1[_0x31958d(0x217)]['logWhiteDomainError'](_0x31958d(0x1e1),_0x31958d(0x1bf),_0x31958d(0x211)+_0x57c330);throw new Error(_0x31958d(0x1b7)+_0x57c330);}if(!_0x18d449[_0x31958d(0x1f3)]||!_0x18d449[_0x31958d(0x21f)]){console[_0x31958d(0x1f6)](_0x31958d(0x207)),console['error'](_0x31958d(0x1d8)),console[_0x31958d(0x1f6)](_0x31958d(0x1bc),_0x18d449),loggerService_1[_0x31958d(0x217)]['logWhiteDomainError'](_0x31958d(0x1e1),_0x31958d(0x1bf),_0x31958d(0x232));throw new Error(_0x31958d(0x231));}console[_0x31958d(0x1d1)](_0x31958d(0x22f)),console['log']('Gateway\x20Payment\x20ID:',_0x18d449[_0x31958d(0x21f)]),console['log'](_0x31958d(0x210),_0x18d449['payment_url']);const _0xfafa3c=_0x18d449[_0x31958d(0x1f3)]+_0x31958d(0x1c4);return console[_0x31958d(0x1d1)](_0x31958d(0x1f1),_0xfafa3c),console['log'](_0x31958d(0x1e9),_0x4d4833,_0x31958d(0x21c)),{'gateway_payment_id':_0x18d449[_0x31958d(0x21f)],'payment_url':_0xfafa3c};}catch(_0x58a825){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x31958d(0x1f6)](_0x31958d(0x221),_0x58a825),loggerService_1[_0x31958d(0x217)][_0x31958d(0x20c)](_0x31958d(0x1e1),_0x31958d(0x1bf),_0x58a825);if(_0x58a825 instanceof Error){console['error'](_0x31958d(0x22b),_0x58a825[_0x31958d(0x1e6)]),console[_0x31958d(0x1f6)](_0x31958d(0x20e),_0x58a825[_0x31958d(0x1e5)]);throw new Error(_0x31958d(0x220)+_0x58a825[_0x31958d(0x1e6)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a47_0x294e42(0x1d0)](_0x247dd5){const _0x8416b9=a47_0x294e42,_0x25f01d=Date[_0x8416b9(0x205)]();try{console['log'](_0x8416b9(0x233)+_0x247dd5);const _0x269963={'gatewayPaymentId':_0x247dd5};loggerService_1[_0x8416b9(0x217)]['logWhiteDomainRequest'](_0x8416b9(0x1e1),_0x8416b9(0x1c7),_0x8416b9(0x204),_0x269963);const _0x5e934c=await fetch(this[_0x8416b9(0x1b2)],{'method':_0x8416b9(0x204),'headers':{'Content-Type':_0x8416b9(0x1c3),'Accept':'application/json','User-Agent':_0x8416b9(0x234)},'body':JSON[_0x8416b9(0x1b5)](_0x269963)}),_0x3da595=Date[_0x8416b9(0x205)]()-_0x25f01d;console[_0x8416b9(0x1d1)](_0x8416b9(0x235)),console[_0x8416b9(0x1d1)](_0x8416b9(0x227),_0x5e934c[_0x8416b9(0x1f7)]),console['log'](_0x8416b9(0x1b8),_0x3da595+'ms');if(!_0x5e934c['ok']){const _0x2f9e4e=await _0x5e934c['text']();console[_0x8416b9(0x1f6)](_0x8416b9(0x1ec),_0x5e934c[_0x8416b9(0x1f7)]),console['error'](_0x8416b9(0x222),_0x2f9e4e),loggerService_1[_0x8416b9(0x217)]['logWhiteDomainResponse'](_0x8416b9(0x1e1),_0x8416b9(0x1c7),_0x5e934c[_0x8416b9(0x1f7)],_0x2f9e4e,_0x3da595),loggerService_1['loggerService'][_0x8416b9(0x20c)](_0x8416b9(0x1e1),_0x8416b9(0x1c7),'HTTP\x20'+_0x5e934c[_0x8416b9(0x1f7)]+':\x20'+_0x2f9e4e);throw new Error(_0x8416b9(0x1d9)+_0x5e934c[_0x8416b9(0x1f7)]);}const _0x1cb2c7=await _0x5e934c['text']();console[_0x8416b9(0x1d1)](_0x8416b9(0x1fb),_0x1cb2c7);let _0x39172e;try{_0x39172e=JSON[_0x8416b9(0x1f0)](_0x1cb2c7);}catch(_0x1f360f){console[_0x8416b9(0x1f6)](_0x8416b9(0x230),_0x1f360f),loggerService_1[_0x8416b9(0x217)][_0x8416b9(0x20c)](_0x8416b9(0x1e1),_0x8416b9(0x1c7),_0x8416b9(0x1e0)+_0x1f360f);throw new Error(_0x8416b9(0x1fe)+_0x1cb2c7);}loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x8416b9(0x1c7),_0x5e934c['status'],_0x39172e,_0x3da595),console[_0x8416b9(0x1d1)](_0x8416b9(0x1d5)),console[_0x8416b9(0x1d1)](_0x8416b9(0x1cf),_0x39172e['result']),console[_0x8416b9(0x1d1)](_0x8416b9(0x1d6),_0x39172e['status_code']),console[_0x8416b9(0x1d1)](_0x8416b9(0x20f),_0x39172e['data']?.[_0x8416b9(0x22d)]),console['log']('Amount:',_0x39172e[_0x8416b9(0x1ce)]?.[_0x8416b9(0x1fa)]),console[_0x8416b9(0x1d1)](_0x8416b9(0x1de),_0x39172e[_0x8416b9(0x1ce)]?.['inputCurrency']);if(_0x39172e[_0x8416b9(0x1e7)]!==_0x8416b9(0x1c0)||_0x39172e[_0x8416b9(0x1f4)]!==0xc8){const _0x273020=_0x39172e['message']||_0x8416b9(0x201);console[_0x8416b9(0x1f6)](_0x8416b9(0x1cb)),console[_0x8416b9(0x1f6)]('Error\x20Message:',_0x273020),loggerService_1['loggerService'][_0x8416b9(0x20c)](_0x8416b9(0x1e1),_0x8416b9(0x1c7),'Status\x20API\x20Error:\x20'+_0x273020);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x273020);}if(!_0x39172e[_0x8416b9(0x1ce)]){console[_0x8416b9(0x1f6)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x8416b9(0x1f6)](_0x8416b9(0x21e)),loggerService_1[_0x8416b9(0x217)]['logWhiteDomainError'](_0x8416b9(0x1e1),_0x8416b9(0x1c7),_0x8416b9(0x20d));throw new Error(_0x8416b9(0x1b4));}let _0xca8478=_0x8416b9(0x1f5);switch(_0x39172e['data']['Status']?.['toLowerCase']()){case'paid':_0xca8478=_0x8416b9(0x1db);break;case'cancelled':case'failed':case _0x8416b9(0x1f6):_0xca8478=_0x8416b9(0x21b);break;case _0x8416b9(0x212):case _0x8416b9(0x1d3):_0xca8478=_0x8416b9(0x1ca);break;case _0x8416b9(0x1c6):case _0x8416b9(0x1fc):case'pending':case _0x8416b9(0x1c2):default:_0xca8478='PENDING';break;}let _0x20dacf,_0x14151f;if(_0x39172e[_0x8416b9(0x1ce)]['PaymentDetail']){const _0x548bbb=_0x39172e[_0x8416b9(0x1ce)]['PaymentDetail'];console[_0x8416b9(0x1d1)](_0x8416b9(0x202),_0x548bbb);const _0x441aec=_0x548bbb[_0x8416b9(0x238)](/IBAN\s+([A-Z0-9]+)/i);_0x441aec&&(_0x20dacf=_0x441aec[0x1],console[_0x8416b9(0x1d1)](_0x8416b9(0x1dd),_0x20dacf)),_0x14151f=_0x548bbb;}const _0x25a703={'iban':_0x20dacf,'bankDetails':_0x14151f,'transactionId':_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x22a)],'coinAddress':_0x39172e['data'][_0x8416b9(0x1da)],'qrCodeUrl':_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x213)],'expiryTime':_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1e8)],'createdOn':_0x39172e[_0x8416b9(0x1ce)]['CreatedOn'],'confirmedOn':_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1f8)]};console['log'](_0x8416b9(0x1c9)),console[_0x8416b9(0x1d1)](_0x8416b9(0x227),_0x39172e['data'][_0x8416b9(0x22d)],'->',_0xca8478),console['log'](_0x8416b9(0x1e9),_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1fa)],_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1ad)]),console[_0x8416b9(0x1d1)](_0x8416b9(0x1fd),_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x22a)]),console[_0x8416b9(0x1d1)](_0x8416b9(0x20a),_0x20dacf||_0x8416b9(0x218)),console[_0x8416b9(0x1d1)](_0x8416b9(0x219),_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1b1)]),console['log'](_0x8416b9(0x1eb),_0x39172e[_0x8416b9(0x1ce)]['TransactionConfirmedOn']||_0x8416b9(0x226));if(_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x22d)]?.[_0x8416b9(0x1e3)]()===_0x8416b9(0x1fc))console[_0x8416b9(0x1d1)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x39172e[_0x8416b9(0x1ce)]['Status']?.[_0x8416b9(0x1e3)]()===_0x8416b9(0x1b0)&&console[_0x8416b9(0x1d1)](_0x8416b9(0x236));return{'status':_0xca8478,'amount':parseFloat(_0x39172e[_0x8416b9(0x1ce)][_0x8416b9(0x1fa)])||undefined,'currency':_0x39172e['data'][_0x8416b9(0x1ad)]||_0x8416b9(0x21c),'paymentDetails':_0x25a703};}catch(_0x3b4adb){console[_0x8416b9(0x1f6)](_0x8416b9(0x1ba),_0x3b4adb),loggerService_1[_0x8416b9(0x217)][_0x8416b9(0x20c)]('cointopay',_0x8416b9(0x1c7),_0x3b4adb);throw new Error(_0x8416b9(0x1cd)+(_0x3b4adb instanceof Error?_0x3b4adb[_0x8416b9(0x1e6)]:_0x8416b9(0x1be)));}}async[a47_0x294e42(0x21a)](_0xede8e6){const _0x294f96=a47_0x294e42,_0x52e8a7=await this[_0x294f96(0x1d0)](_0xede8e6);return{'status':_0x52e8a7[_0x294f96(0x1f7)],'amount':_0x52e8a7[_0x294f96(0x214)],'currency':_0x52e8a7['currency']};}async[a47_0x294e42(0x203)](_0x5579eb){const _0x4922bc=a47_0x294e42;console[_0x4922bc(0x1d1)](_0x4922bc(0x1d4),_0x5579eb);let _0x436c2b=_0x4922bc(0x1f5);switch(_0x5579eb[_0x4922bc(0x1f7)]?.[_0x4922bc(0x1e3)]()){case'paid':_0x436c2b='PAID';break;case'cancelled':case _0x4922bc(0x1b9):case'error':_0x436c2b=_0x4922bc(0x21b);break;case _0x4922bc(0x212):case _0x4922bc(0x1d3):_0x436c2b=_0x4922bc(0x1ca);break;case _0x4922bc(0x22c):case _0x4922bc(0x1c6):case _0x4922bc(0x1fc):case'created':default:_0x436c2b=_0x4922bc(0x1f5);break;}return{'paymentId':_0x5579eb['order_id']||_0x5579eb['merchant_reference_id']||'','status':_0x436c2b,'amount':_0x5579eb[_0x4922bc(0x214)],'currency':_0x5579eb[_0x4922bc(0x200)]||'EUR'};}}exports[a47_0x294e42(0x1ef)]=CoinToPayService;