'use strict';const a40_0x59e8b9=a40_0x4f44;function a40_0x4f44(_0x1c1fce,_0x331c0e){const _0x43840f=a40_0x4384();return a40_0x4f44=function(_0x4f4425,_0x4406b5){_0x4f4425=_0x4f4425-0x100;let _0x6108bb=_0x43840f[_0x4f4425];return _0x6108bb;},a40_0x4f44(_0x1c1fce,_0x331c0e);}(function(_0x292f4a,_0x701aee){const _0x46cd36=a40_0x4f44,_0x42ff2b=_0x292f4a();while(!![]){try{const _0x4a5b3b=parseInt(_0x46cd36(0x103))/0x1+parseInt(_0x46cd36(0x166))/0x2+-parseInt(_0x46cd36(0x16e))/0x3+-parseInt(_0x46cd36(0x122))/0x4+parseInt(_0x46cd36(0x115))/0x5+parseInt(_0x46cd36(0x108))/0x6+-parseInt(_0x46cd36(0x16f))/0x7;if(_0x4a5b3b===_0x701aee)break;else _0x42ff2b['push'](_0x42ff2b['shift']());}catch(_0x52cb45){_0x42ff2b['push'](_0x42ff2b['shift']());}}}(a40_0x4384,0x9b41b));function a40_0x4384(){const _0x1a9006=['Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20SUCCESS\x20===','Amount','paid','Request\x20Body:','Raw\x20Response\x20Body:','Response\x20Body:','logWhiteDomainRequest','Error\x20Message:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','payment_url','error','CoinToPay\x20API\x20error:\x20','text','awaiting\x20fiat','Transaction\x20ID:','üìä\x20Status\x20check\x20URL:','436282YGhyKv','not\x20found','Parsed\x20Result:','PENDING','expired','FAILED','Created\x20On:','stringify','2254095VLhNhr','9835525nFpGwv','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','Status','statusText','ExpiryTime','Payment\x20Status:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','EXPIRED','Amount:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','fromEntries','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','__esModule','Error\x20details:','Confirmed\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20===','statusUrl','merchant_reference_id','data','loggerService','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','stack','logWhiteDomainResponse','1033633xLCDlU','toLowerCase','PaymentDetail','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','/status','6984972buWwYy','Currency:','created','TesSoft\x20Payment\x20System/1.0','HTTP\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','failed','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status\x20Text:','cointopay','result','inputCurrency','log','1963125jASddl','waiting','üè¶\x20Extracted\x20IBAN:','TransactionConfirmedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','processWebhook','success','entries','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CreatedOn','64760xxWDbh','QRCodeURL','../loggerService','Result:',',\x20body:\x20','createPaymentLink','EUR','currency','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','timeout','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20Status:','CoinToPayService','PAID','POST','order_id','Status\x20API\x20Error:\x20','now','Status:','IBAN:','application/json','TransactionID','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error','cancelled','status','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','https://tesoft.uk/gateway/cointopay/status.php','status_code','gateway_payment_id','apiUrl','message','CoinToPay\x20status\x20API\x20error:\x20','/create','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','coinAddress','parse','not\x20confirmed','pending','https://tesoft.uk/gateway/cointopay/','checkPaymentStatus','JSON\x20Parse\x20Error:\x20','logWhiteDomainError','verifyPayment'];a40_0x4384=function(){return _0x1a9006;};return a40_0x4384();}Object['defineProperty'](exports,a40_0x59e8b9(0x17c),{'value':!![]}),exports[a40_0x59e8b9(0x132)]=void 0x0;const loggerService_1=require(a40_0x59e8b9(0x124));class CoinToPayService{constructor(){const _0x582382=a40_0x59e8b9;this['apiUrl']=_0x582382(0x14f),this['statusUrl']=_0x582382(0x143),console[_0x582382(0x114)](_0x582382(0x120)),console[_0x582382(0x114)](_0x582382(0x165),this[_0x582382(0x180)]);}async[a40_0x59e8b9(0x127)](_0x4d7023){const _0x40fcf6=a40_0x59e8b9,{orderId:_0x16e67d,amount:_0x5a0622}=_0x4d7023;console[_0x40fcf6(0x114)](_0x40fcf6(0x176)+_0x5a0622+'\x20EUR');const _0x29ba2a={'amount':_0x5a0622},_0xb7a1bc=Date['now']();try{console['log'](_0x40fcf6(0x100)),console['log']('URL:',this['apiUrl']),console[_0x40fcf6(0x114)](_0x40fcf6(0x159),JSON[_0x40fcf6(0x16d)](_0x29ba2a,null,0x2)),console[_0x40fcf6(0x114)](_0x40fcf6(0x178),_0x5a0622,_0x40fcf6(0x11a)),loggerService_1[_0x40fcf6(0x183)][_0x40fcf6(0x15c)]('cointopay',_0x40fcf6(0x149),_0x40fcf6(0x134),_0x29ba2a);const _0x7e423d=await fetch(this[_0x40fcf6(0x146)],{'method':_0x40fcf6(0x134),'headers':{'Content-Type':_0x40fcf6(0x13a),'Accept':_0x40fcf6(0x13a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x40fcf6(0x16d)](_0x29ba2a)}),_0x388a9c=Date['now']()-_0xb7a1bc;console[_0x40fcf6(0x114)](_0x40fcf6(0x13d)),console[_0x40fcf6(0x114)]('Status:',_0x7e423d[_0x40fcf6(0x140)]),console[_0x40fcf6(0x114)](_0x40fcf6(0x110),_0x7e423d[_0x40fcf6(0x173)]),console[_0x40fcf6(0x114)]('Headers:',Object[_0x40fcf6(0x17a)](_0x7e423d['headers'][_0x40fcf6(0x11f)]())),console['log']('Response\x20Time:',_0x388a9c+'ms');const _0x368b30=await _0x7e423d[_0x40fcf6(0x162)]();console['log'](_0x40fcf6(0x15a),_0x368b30);if(!_0x7e423d['ok']){console[_0x40fcf6(0x160)](_0x40fcf6(0x17f)),console[_0x40fcf6(0x160)](_0x40fcf6(0x131),_0x7e423d['status']),console[_0x40fcf6(0x160)](_0x40fcf6(0x15b),_0x368b30),loggerService_1['loggerService'][_0x40fcf6(0x102)](_0x40fcf6(0x111),'/create',_0x7e423d[_0x40fcf6(0x140)],_0x368b30,_0x388a9c),loggerService_1['loggerService'][_0x40fcf6(0x152)]('cointopay',_0x40fcf6(0x149),'HTTP\x20'+_0x7e423d[_0x40fcf6(0x140)]+':\x20'+_0x368b30);throw new Error('HTTP\x20error!\x20status:\x20'+_0x7e423d[_0x40fcf6(0x140)]+_0x40fcf6(0x126)+_0x368b30);}let _0x30408e;try{_0x30408e=JSON[_0x40fcf6(0x14c)](_0x368b30);}catch(_0x1d7d3f){console[_0x40fcf6(0x160)](_0x40fcf6(0x141),_0x1d7d3f),loggerService_1[_0x40fcf6(0x183)][_0x40fcf6(0x152)](_0x40fcf6(0x111),_0x40fcf6(0x149),'JSON\x20Parse\x20Error:\x20'+_0x1d7d3f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x368b30);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x40fcf6(0x114)](_0x40fcf6(0x168),JSON[_0x40fcf6(0x16d)](_0x30408e,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x40fcf6(0x111),_0x40fcf6(0x149),_0x7e423d['status'],_0x30408e,_0x388a9c);if(_0x30408e[_0x40fcf6(0x160)]){const _0x10a3f7=_0x30408e['message']||_0x30408e[_0x40fcf6(0x160)]||_0x40fcf6(0x155);console[_0x40fcf6(0x160)](_0x40fcf6(0x12f)),console[_0x40fcf6(0x160)](_0x40fcf6(0x15d),_0x10a3f7),loggerService_1[_0x40fcf6(0x183)][_0x40fcf6(0x152)]('cointopay',_0x40fcf6(0x149),'Business\x20Error:\x20'+_0x10a3f7);throw new Error(_0x40fcf6(0x161)+_0x10a3f7);}if(!_0x30408e['payment_url']||!_0x30408e[_0x40fcf6(0x145)]){console[_0x40fcf6(0x160)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x40fcf6(0x10f)),console['error'](_0x40fcf6(0x142),_0x30408e),loggerService_1[_0x40fcf6(0x183)][_0x40fcf6(0x152)](_0x40fcf6(0x111),_0x40fcf6(0x149),_0x40fcf6(0x12c));throw new Error(_0x40fcf6(0x17b));}return console[_0x40fcf6(0x114)](_0x40fcf6(0x156)),console[_0x40fcf6(0x114)]('Gateway\x20Payment\x20ID:',_0x30408e['gateway_payment_id']),console[_0x40fcf6(0x114)]('Payment\x20URL:',_0x30408e[_0x40fcf6(0x15f)]),console[_0x40fcf6(0x114)](_0x40fcf6(0x178),_0x5a0622,'EUR'),{'gateway_payment_id':_0x30408e['gateway_payment_id'],'payment_url':_0x30408e['payment_url']};}catch(_0x1d5652){console[_0x40fcf6(0x160)](_0x40fcf6(0x119)),console[_0x40fcf6(0x160)](_0x40fcf6(0x17d),_0x1d5652),loggerService_1[_0x40fcf6(0x183)][_0x40fcf6(0x152)](_0x40fcf6(0x111),_0x40fcf6(0x149),_0x1d5652);if(_0x1d5652 instanceof Error){console[_0x40fcf6(0x160)]('Error\x20message:',_0x1d5652[_0x40fcf6(0x147)]),console[_0x40fcf6(0x160)]('Error\x20stack:',_0x1d5652[_0x40fcf6(0x101)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x1d5652[_0x40fcf6(0x147)]);}throw new Error(_0x40fcf6(0x154));}}async[a40_0x59e8b9(0x150)](_0x64c384){const _0x1ce5b4=a40_0x59e8b9,_0x35c65e=Date[_0x1ce5b4(0x137)]();try{console[_0x1ce5b4(0x114)](_0x1ce5b4(0x106)+_0x64c384);const _0x4b5ab3={'gatewayPaymentId':_0x64c384};loggerService_1[_0x1ce5b4(0x183)][_0x1ce5b4(0x15c)](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x1ce5b4(0x134),_0x4b5ab3);const _0x50cb55=await fetch(this[_0x1ce5b4(0x180)],{'method':'POST','headers':{'Content-Type':_0x1ce5b4(0x13a),'Accept':'application/json','User-Agent':_0x1ce5b4(0x10b)},'body':JSON['stringify'](_0x4b5ab3)}),_0x123266=Date[_0x1ce5b4(0x137)]()-_0x35c65e;console[_0x1ce5b4(0x114)](_0x1ce5b4(0x170)),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x138),_0x50cb55['status']),console['log']('Response\x20Time:',_0x123266+'ms');if(!_0x50cb55['ok']){const _0x3ce8bd=await _0x50cb55[_0x1ce5b4(0x162)]();console['error'](_0x1ce5b4(0x131),_0x50cb55['status']),console[_0x1ce5b4(0x160)](_0x1ce5b4(0x15b),_0x3ce8bd),loggerService_1[_0x1ce5b4(0x183)][_0x1ce5b4(0x102)](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x50cb55[_0x1ce5b4(0x140)],_0x3ce8bd,_0x123266),loggerService_1[_0x1ce5b4(0x183)][_0x1ce5b4(0x152)]('cointopay',_0x1ce5b4(0x107),_0x1ce5b4(0x10c)+_0x50cb55[_0x1ce5b4(0x140)]+':\x20'+_0x3ce8bd);throw new Error(_0x1ce5b4(0x171)+_0x50cb55['status']);}const _0x523976=await _0x50cb55['text']();console[_0x1ce5b4(0x114)](_0x1ce5b4(0x15a),_0x523976);let _0x342dec;try{_0x342dec=JSON['parse'](_0x523976);}catch(_0x2b786b){console['error'](_0x1ce5b4(0x141),_0x2b786b),loggerService_1[_0x1ce5b4(0x183)]['logWhiteDomainError'](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x1ce5b4(0x151)+_0x2b786b);throw new Error(_0x1ce5b4(0x11c)+_0x523976);}loggerService_1['loggerService'][_0x1ce5b4(0x102)](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x50cb55[_0x1ce5b4(0x140)],_0x342dec,_0x123266),console[_0x1ce5b4(0x114)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x125),_0x342dec[_0x1ce5b4(0x112)]),console['log']('Status\x20Code:',_0x342dec[_0x1ce5b4(0x144)]),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x175),_0x342dec[_0x1ce5b4(0x182)]?.[_0x1ce5b4(0x172)]),console[_0x1ce5b4(0x114)]('Amount:',_0x342dec[_0x1ce5b4(0x182)]?.[_0x1ce5b4(0x157)]),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x109),_0x342dec['data']?.[_0x1ce5b4(0x113)]);if(_0x342dec[_0x1ce5b4(0x112)]!==_0x1ce5b4(0x11e)||_0x342dec[_0x1ce5b4(0x144)]!==0xc8){const _0x1d426f=_0x342dec['message']||_0x1ce5b4(0x11b);console[_0x1ce5b4(0x160)](_0x1ce5b4(0x12a)),console[_0x1ce5b4(0x160)](_0x1ce5b4(0x15d),_0x1d426f),loggerService_1[_0x1ce5b4(0x183)][_0x1ce5b4(0x152)](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x1ce5b4(0x136)+_0x1d426f);throw new Error(_0x1ce5b4(0x148)+_0x1d426f);}if(!_0x342dec[_0x1ce5b4(0x182)]){console[_0x1ce5b4(0x160)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x1ce5b4(0x183)]['logWhiteDomainError']('cointopay',_0x1ce5b4(0x107),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1ce5b4(0x15e));}let _0x47be38='PENDING';switch(_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x172)]?.[_0x1ce5b4(0x104)]()){case _0x1ce5b4(0x158):_0x47be38=_0x1ce5b4(0x133);break;case _0x1ce5b4(0x13f):case _0x1ce5b4(0x10e):case _0x1ce5b4(0x160):_0x47be38=_0x1ce5b4(0x16b);break;case _0x1ce5b4(0x16a):case _0x1ce5b4(0x12b):_0x47be38=_0x1ce5b4(0x177);break;case _0x1ce5b4(0x116):case'awaiting\x20fiat':case _0x1ce5b4(0x14e):case _0x1ce5b4(0x10a):default:_0x47be38=_0x1ce5b4(0x169);break;}let _0x263fdc,_0x551e53;if(_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x105)]){const _0x177f6b=_0x342dec['data'][_0x1ce5b4(0x105)];console[_0x1ce5b4(0x114)]('üè¶\x20Payment\x20Detail:',_0x177f6b);const _0x3c129a=_0x177f6b['match'](/IBAN\s+([A-Z0-9]+)/i);_0x3c129a&&(_0x263fdc=_0x3c129a[0x1],console[_0x1ce5b4(0x114)](_0x1ce5b4(0x117),_0x263fdc)),_0x551e53=_0x177f6b;}const _0x1cafae={'iban':_0x263fdc,'bankDetails':_0x551e53,'transactionId':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x13b)],'coinAddress':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x14b)],'qrCodeUrl':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x123)],'expiryTime':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x174)],'createdOn':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x121)],'confirmedOn':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x118)]};console[_0x1ce5b4(0x114)](_0x1ce5b4(0x179)),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x138),_0x342dec['data'][_0x1ce5b4(0x172)],'->',_0x47be38),console[_0x1ce5b4(0x114)]('Amount:',_0x342dec['data'][_0x1ce5b4(0x157)],_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x113)]),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x164),_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x13b)]),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x139),_0x263fdc||_0x1ce5b4(0x167)),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x16c),_0x342dec['data']['CreatedOn']),console[_0x1ce5b4(0x114)](_0x1ce5b4(0x17e),_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x118)]||_0x1ce5b4(0x14d));if(_0x342dec[_0x1ce5b4(0x182)]['Status']?.[_0x1ce5b4(0x104)]()===_0x1ce5b4(0x163))console[_0x1ce5b4(0x114)](_0x1ce5b4(0x10d));else _0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x172)]?.['toLowerCase']()===_0x1ce5b4(0x158)&&console[_0x1ce5b4(0x114)](_0x1ce5b4(0x13c));return{'status':_0x47be38,'amount':parseFloat(_0x342dec[_0x1ce5b4(0x182)]['Amount'])||undefined,'currency':_0x342dec[_0x1ce5b4(0x182)][_0x1ce5b4(0x113)]||_0x1ce5b4(0x128),'paymentDetails':_0x1cafae};}catch(_0x37173b){console[_0x1ce5b4(0x160)](_0x1ce5b4(0x130),_0x37173b),loggerService_1[_0x1ce5b4(0x183)][_0x1ce5b4(0x152)](_0x1ce5b4(0x111),_0x1ce5b4(0x107),_0x37173b);throw new Error(_0x1ce5b4(0x12e)+(_0x37173b instanceof Error?_0x37173b['message']:_0x1ce5b4(0x13e)));}}async[a40_0x59e8b9(0x153)](_0x118bb4){const _0x27a073=a40_0x59e8b9,_0x71bc06=await this[_0x27a073(0x150)](_0x118bb4);return{'status':_0x71bc06[_0x27a073(0x140)],'amount':_0x71bc06[_0x27a073(0x12d)],'currency':_0x71bc06[_0x27a073(0x129)]};}async[a40_0x59e8b9(0x11d)](_0x2ccdb9){const _0x5ec94a=a40_0x59e8b9;console[_0x5ec94a(0x114)](_0x5ec94a(0x14a),_0x2ccdb9);let _0x25a9fe='PENDING';switch(_0x2ccdb9['status']?.[_0x5ec94a(0x104)]()){case _0x5ec94a(0x158):_0x25a9fe='PAID';break;case'cancelled':case _0x5ec94a(0x10e):case'error':_0x25a9fe=_0x5ec94a(0x16b);break;case _0x5ec94a(0x16a):case _0x5ec94a(0x12b):_0x25a9fe=_0x5ec94a(0x177);break;case _0x5ec94a(0x14e):case _0x5ec94a(0x116):case _0x5ec94a(0x163):case _0x5ec94a(0x10a):default:_0x25a9fe=_0x5ec94a(0x169);break;}return{'paymentId':_0x2ccdb9[_0x5ec94a(0x135)]||_0x2ccdb9[_0x5ec94a(0x181)]||'','status':_0x25a9fe,'amount':_0x2ccdb9[_0x5ec94a(0x12d)],'currency':_0x2ccdb9[_0x5ec94a(0x129)]||_0x5ec94a(0x128)};}}exports[a40_0x59e8b9(0x132)]=CoinToPayService;