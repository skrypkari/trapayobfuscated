'use strict';const a55_0x592525=a55_0x4722;(function(_0x150456,_0x4a4c90){const _0x3d7a58=a55_0x4722,_0x1342ff=_0x150456();while(!![]){try{const _0x45de15=-parseInt(_0x3d7a58(0x1c1))/0x1*(parseInt(_0x3d7a58(0x1ac))/0x2)+parseInt(_0x3d7a58(0x1df))/0x3*(-parseInt(_0x3d7a58(0x1bf))/0x4)+parseInt(_0x3d7a58(0x1a5))/0x5+parseInt(_0x3d7a58(0x174))/0x6*(-parseInt(_0x3d7a58(0x1e3))/0x7)+parseInt(_0x3d7a58(0x1d8))/0x8+parseInt(_0x3d7a58(0x19e))/0x9+parseInt(_0x3d7a58(0x175))/0xa;if(_0x45de15===_0x4a4c90)break;else _0x1342ff['push'](_0x1342ff['shift']());}catch(_0x4b892c){_0x1342ff['push'](_0x1342ff['shift']());}}}(a55_0x55e2,0x5148d));function a55_0x55e2(){const _0x45c986=['inputCurrency','apiUrl','created',',\x20body:\x20','Payment\x20URL\x20(modified):','CoinToPay\x20status\x20API\x20error:\x20','parse','message','HTTP\x20','expired','Created\x20On:','EXPIRED','https://tesoft.uk/gateway/cointopay/status.php','8tlKFnz','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','254855dCKaYx','Amount','../loggerService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','logWhiteDomainResponse','data','processWebhook','now','Status\x20Text:','status_code','URL:','Confirmed\x20On:','toLowerCase','currency','Response\x20Time:','PENDING','text','EUR','Unknown\x20error\x20from\x20CoinToPay\x20API','TransactionID','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','&alternative=false','Business\x20Error:\x20','4548760kvxGMX','Incomplete\x20response:\x20missing\x20data','CreatedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','stringify','Failed\x20to\x20parse\x20JSON\x20response:','ðŸ¦\x20Payment\x20Detail:','843213NaSepD','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','order_id','payment_url','532bTyFyk','not\x20found','/status','logWhiteDomainError','CoinToPay\x20payment\x20status\x20check\x20error:','Error\x20message:','Raw\x20Response\x20Body:','PAID','defineProperty','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20stack:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','fromEntries','===\x20COINTOPAY\x20SUCCESS\x20===','paid','Payment\x20URL\x20(original):','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Request\x20Body:','Payment\x20System/1.0','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','loggerService','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','statusText','42810ByujIh','6383770ZbqGFh','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20data:','JSON\x20Parse\x20Error:\x20','failed','Transaction\x20ID:','TransactionConfirmedOn','PaymentDetail','Unknown\x20error','waiting','pending','not\x20confirmed','gateway_payment_id','logWhiteDomainRequest','Payment\x20Status:','CoinToPayService','FAILED','Amount:','Response\x20Body:','Status:','Status','awaiting\x20fiat','HTTP\x20error!\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','checkPaymentStatus','Parsed\x20Result:','cancelled','match','amount','application/json','statusUrl','log','Missing\x20data\x20in\x20response','cointopay','error','/create','POST','stack','result','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20ERROR\x20===','5106762ONoamj','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','ðŸ“Š\x20Status\x20check\x20URL:','Error\x20Message:','coinAddress','863315TazynY','status','HTTP\x20Status:','timeout','QRCodeURL','Headers:','Status\x20Code:','4vxtojg','Result:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Currency:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data'];a55_0x55e2=function(){return _0x45c986;};return a55_0x55e2();}Object[a55_0x592525(0x1eb)](exports,'__esModule',{'value':!![]}),exports[a55_0x592525(0x184)]=void 0x0;function a55_0x4722(_0x5d3fe7,_0x2957c9){_0x5d3fe7=_0x5d3fe7-0x16f;const _0x55e2d1=a55_0x55e2();let _0x47228e=_0x55e2d1[_0x5d3fe7];return _0x47228e;}const loggerService_1=require(a55_0x592525(0x1c3));class CoinToPayService{constructor(){const _0x5e79cb=a55_0x592525;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x5e79cb(0x193)]=_0x5e79cb(0x1be),console['log'](_0x5e79cb(0x1f6)),console[_0x5e79cb(0x194)](_0x5e79cb(0x1a2),this[_0x5e79cb(0x193)]);}async['createPaymentLink'](_0x9ea739){const _0x1c2f55=a55_0x592525,{orderId:_0x33c77e,amount:_0x3831fe}=_0x9ea739;console[_0x1c2f55(0x194)](_0x1c2f55(0x172)+_0x3831fe+'\x20EUR');const _0x3ba6f9={'amount':_0x3831fe},_0x2d401b=Date[_0x1c2f55(0x1c8)]();try{console['log'](_0x1c2f55(0x1af)),console['log'](_0x1c2f55(0x1cb),this[_0x1c2f55(0x1b3)]),console[_0x1c2f55(0x194)](_0x1c2f55(0x1f4),JSON['stringify'](_0x3ba6f9,null,0x2)),console[_0x1c2f55(0x194)](_0x1c2f55(0x186),_0x3831fe,_0x1c2f55(0x18c)),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x182)]('cointopay',_0x1c2f55(0x198),_0x1c2f55(0x199),_0x3ba6f9);const _0x3cfb9d=await fetch(this[_0x1c2f55(0x1b3)],{'method':_0x1c2f55(0x199),'headers':{'Content-Type':_0x1c2f55(0x192),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x1c2f55(0x1dc)](_0x3ba6f9)}),_0x24a633=Date[_0x1c2f55(0x1c8)]()-_0x2d401b;console[_0x1c2f55(0x194)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1c2f55(0x194)](_0x1c2f55(0x188),_0x3cfb9d[_0x1c2f55(0x1a6)]),console[_0x1c2f55(0x194)](_0x1c2f55(0x1c9),_0x3cfb9d[_0x1c2f55(0x173)]),console[_0x1c2f55(0x194)](_0x1c2f55(0x1aa),Object[_0x1c2f55(0x1ef)](_0x3cfb9d[_0x1c2f55(0x170)]['entries']())),console[_0x1c2f55(0x194)](_0x1c2f55(0x1cf),_0x24a633+'ms');const _0x92c3be=await _0x3cfb9d[_0x1c2f55(0x1d1)]();console['log'](_0x1c2f55(0x1e9),_0x92c3be);if(!_0x3cfb9d['ok']){console[_0x1c2f55(0x197)](_0x1c2f55(0x19d)),console['error'](_0x1c2f55(0x1a7),_0x3cfb9d[_0x1c2f55(0x1a6)]),console['error'](_0x1c2f55(0x187),_0x92c3be),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x1c5)](_0x1c2f55(0x196),'/create',_0x3cfb9d[_0x1c2f55(0x1a6)],_0x92c3be,_0x24a633),loggerService_1[_0x1c2f55(0x16f)]['logWhiteDomainError'](_0x1c2f55(0x196),_0x1c2f55(0x198),_0x1c2f55(0x1ba)+_0x3cfb9d['status']+':\x20'+_0x92c3be);throw new Error(_0x1c2f55(0x18b)+_0x3cfb9d[_0x1c2f55(0x1a6)]+_0x1c2f55(0x1b5)+_0x92c3be);}let _0x2ceaa6;try{_0x2ceaa6=JSON[_0x1c2f55(0x1b8)](_0x92c3be);}catch(_0x23e48f){console[_0x1c2f55(0x197)](_0x1c2f55(0x1dd),_0x23e48f),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x1e6)]('cointopay','/create',_0x1c2f55(0x178)+_0x23e48f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x92c3be);}console[_0x1c2f55(0x194)](_0x1c2f55(0x19f)),console['log'](_0x1c2f55(0x18e),JSON[_0x1c2f55(0x1dc)](_0x2ceaa6,null,0x2)),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x1c5)](_0x1c2f55(0x196),'/create',_0x3cfb9d['status'],_0x2ceaa6,_0x24a633);if(_0x2ceaa6[_0x1c2f55(0x197)]){const _0x5c2ecf=_0x2ceaa6[_0x1c2f55(0x1b9)]||_0x2ceaa6[_0x1c2f55(0x197)]||_0x1c2f55(0x1d3);console[_0x1c2f55(0x197)](_0x1c2f55(0x176)),console['error'](_0x1c2f55(0x1a3),_0x5c2ecf),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x1e6)]('cointopay',_0x1c2f55(0x198),_0x1c2f55(0x1d7)+_0x5c2ecf);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5c2ecf);}if(!_0x2ceaa6[_0x1c2f55(0x1e2)]||!_0x2ceaa6[_0x1c2f55(0x181)]){console['error'](_0x1c2f55(0x1ee)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1c2f55(0x197)](_0x1c2f55(0x177),_0x2ceaa6),loggerService_1[_0x1c2f55(0x16f)][_0x1c2f55(0x1e6)](_0x1c2f55(0x196),_0x1c2f55(0x198),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1c2f55(0x1a0));}console[_0x1c2f55(0x194)](_0x1c2f55(0x1f0)),console['log'](_0x1c2f55(0x19c),_0x2ceaa6[_0x1c2f55(0x181)]),console['log'](_0x1c2f55(0x1f2),_0x2ceaa6[_0x1c2f55(0x1e2)]);const _0x1a80bd=_0x2ceaa6[_0x1c2f55(0x1e2)]+_0x1c2f55(0x1d6);return console['log'](_0x1c2f55(0x1b6),_0x1a80bd),console[_0x1c2f55(0x194)](_0x1c2f55(0x186),_0x3831fe,_0x1c2f55(0x1d2)),{'gateway_payment_id':_0x2ceaa6[_0x1c2f55(0x181)],'payment_url':_0x1a80bd};}catch(_0x121294){console[_0x1c2f55(0x197)](_0x1c2f55(0x1e0)),console['error']('Error\x20details:',_0x121294),loggerService_1['loggerService'][_0x1c2f55(0x1e6)](_0x1c2f55(0x196),_0x1c2f55(0x198),_0x121294);if(_0x121294 instanceof Error){console[_0x1c2f55(0x197)](_0x1c2f55(0x1e8),_0x121294['message']),console[_0x1c2f55(0x197)](_0x1c2f55(0x1ed),_0x121294[_0x1c2f55(0x19a)]);throw new Error(_0x1c2f55(0x1db)+_0x121294[_0x1c2f55(0x1b9)]);}throw new Error(_0x1c2f55(0x171));}}async[a55_0x592525(0x18d)](_0x595c98){const _0xe4b70b=a55_0x592525,_0x56e2f8=Date[_0xe4b70b(0x1c8)]();try{console[_0xe4b70b(0x194)]('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x595c98);const _0x472a0e={'gatewayPaymentId':_0x595c98};loggerService_1[_0xe4b70b(0x16f)][_0xe4b70b(0x182)]('cointopay',_0xe4b70b(0x1e5),_0xe4b70b(0x199),_0x472a0e);const _0x264c71=await fetch(this['statusUrl'],{'method':_0xe4b70b(0x199),'headers':{'Content-Type':_0xe4b70b(0x192),'Accept':_0xe4b70b(0x192),'User-Agent':_0xe4b70b(0x1f5)},'body':JSON['stringify'](_0x472a0e)}),_0x46b764=Date[_0xe4b70b(0x1c8)]()-_0x56e2f8;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xe4b70b(0x194)]('Status:',_0x264c71[_0xe4b70b(0x1a6)]),console[_0xe4b70b(0x194)](_0xe4b70b(0x1cf),_0x46b764+'ms');if(!_0x264c71['ok']){const _0x47a6a1=await _0x264c71[_0xe4b70b(0x1d1)]();console[_0xe4b70b(0x197)](_0xe4b70b(0x1a7),_0x264c71[_0xe4b70b(0x1a6)]),console[_0xe4b70b(0x197)](_0xe4b70b(0x187),_0x47a6a1),loggerService_1[_0xe4b70b(0x16f)][_0xe4b70b(0x1c5)](_0xe4b70b(0x196),_0xe4b70b(0x1e5),_0x264c71[_0xe4b70b(0x1a6)],_0x47a6a1,_0x46b764),loggerService_1[_0xe4b70b(0x16f)][_0xe4b70b(0x1e6)](_0xe4b70b(0x196),_0xe4b70b(0x1e5),_0xe4b70b(0x1ba)+_0x264c71[_0xe4b70b(0x1a6)]+':\x20'+_0x47a6a1);throw new Error(_0xe4b70b(0x18b)+_0x264c71[_0xe4b70b(0x1a6)]);}const _0x53629a=await _0x264c71[_0xe4b70b(0x1d1)]();console['log']('Raw\x20Response\x20Body:',_0x53629a);let _0x150e22;try{_0x150e22=JSON[_0xe4b70b(0x1b8)](_0x53629a);}catch(_0x10fa5f){console[_0xe4b70b(0x197)](_0xe4b70b(0x1dd),_0x10fa5f),loggerService_1[_0xe4b70b(0x16f)][_0xe4b70b(0x1e6)](_0xe4b70b(0x196),'/status',_0xe4b70b(0x178)+_0x10fa5f);throw new Error(_0xe4b70b(0x1c0)+_0x53629a);}loggerService_1[_0xe4b70b(0x16f)]['logWhiteDomainResponse'](_0xe4b70b(0x196),_0xe4b70b(0x1e5),_0x264c71[_0xe4b70b(0x1a6)],_0x150e22,_0x46b764),console['log'](_0xe4b70b(0x1f3)),console[_0xe4b70b(0x194)](_0xe4b70b(0x1ad),_0x150e22['result']),console[_0xe4b70b(0x194)](_0xe4b70b(0x1ab),_0x150e22['status_code']),console[_0xe4b70b(0x194)](_0xe4b70b(0x183),_0x150e22['data']?.[_0xe4b70b(0x189)]),console[_0xe4b70b(0x194)](_0xe4b70b(0x186),_0x150e22[_0xe4b70b(0x1c6)]?.[_0xe4b70b(0x1c2)]),console[_0xe4b70b(0x194)](_0xe4b70b(0x1b0),_0x150e22[_0xe4b70b(0x1c6)]?.['inputCurrency']);if(_0x150e22[_0xe4b70b(0x19b)]!=='success'||_0x150e22[_0xe4b70b(0x1ca)]!==0xc8){const _0x1aaefb=_0x150e22[_0xe4b70b(0x1b9)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0xe4b70b(0x197)](_0xe4b70b(0x1c4)),console[_0xe4b70b(0x197)](_0xe4b70b(0x1a3),_0x1aaefb),loggerService_1[_0xe4b70b(0x16f)]['logWhiteDomainError'](_0xe4b70b(0x196),_0xe4b70b(0x1e5),'Status\x20API\x20Error:\x20'+_0x1aaefb);throw new Error(_0xe4b70b(0x1b7)+_0x1aaefb);}if(!_0x150e22[_0xe4b70b(0x1c6)]){console[_0xe4b70b(0x197)](_0xe4b70b(0x1ec)),console[_0xe4b70b(0x197)](_0xe4b70b(0x195)),loggerService_1[_0xe4b70b(0x16f)][_0xe4b70b(0x1e6)](_0xe4b70b(0x196),_0xe4b70b(0x1e5),_0xe4b70b(0x1d9));throw new Error(_0xe4b70b(0x1b1));}let _0x45479e=_0xe4b70b(0x1d0);switch(_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x189)]?.[_0xe4b70b(0x1cd)]()){case _0xe4b70b(0x1f1):_0x45479e='PAID';break;case'cancelled':case _0xe4b70b(0x179):case _0xe4b70b(0x197):_0x45479e=_0xe4b70b(0x185);break;case'expired':case _0xe4b70b(0x1a8):_0x45479e=_0xe4b70b(0x1bd);break;case _0xe4b70b(0x17e):case _0xe4b70b(0x18a):case _0xe4b70b(0x17f):case _0xe4b70b(0x1b4):default:_0x45479e='PENDING';break;}let _0x72f80e,_0x48a595;if(_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x17c)]){const _0xb2a819=_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x17c)];console[_0xe4b70b(0x194)](_0xe4b70b(0x1de),_0xb2a819);const _0x152410=_0xb2a819[_0xe4b70b(0x190)](/IBAN\s+([A-Z0-9]+)/i);_0x152410&&(_0x72f80e=_0x152410[0x1],console[_0xe4b70b(0x194)]('ðŸ¦\x20Extracted\x20IBAN:',_0x72f80e)),_0x48a595=_0xb2a819;}const _0x21cf85={'iban':_0x72f80e,'bankDetails':_0x48a595,'transactionId':_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1d4)],'coinAddress':_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1a4)],'qrCodeUrl':_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1a9)],'expiryTime':_0x150e22[_0xe4b70b(0x1c6)]['ExpiryTime'],'createdOn':_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1da)],'confirmedOn':_0x150e22[_0xe4b70b(0x1c6)]['TransactionConfirmedOn']};console[_0xe4b70b(0x194)](_0xe4b70b(0x1ae)),console[_0xe4b70b(0x194)](_0xe4b70b(0x188),_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x189)],'->',_0x45479e),console[_0xe4b70b(0x194)](_0xe4b70b(0x186),_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1c2)],_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1b2)]),console[_0xe4b70b(0x194)](_0xe4b70b(0x17a),_0x150e22['data'][_0xe4b70b(0x1d4)]),console[_0xe4b70b(0x194)]('IBAN:',_0x72f80e||_0xe4b70b(0x1e4)),console['log'](_0xe4b70b(0x1bc),_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1da)]),console[_0xe4b70b(0x194)](_0xe4b70b(0x1cc),_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x17b)]||_0xe4b70b(0x180));if(_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x189)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0xe4b70b(0x194)](_0xe4b70b(0x1a1));else _0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x189)]?.[_0xe4b70b(0x1cd)]()===_0xe4b70b(0x1f1)&&console[_0xe4b70b(0x194)]('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x45479e,'amount':parseFloat(_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1c2)])||undefined,'currency':_0x150e22[_0xe4b70b(0x1c6)][_0xe4b70b(0x1b2)]||'EUR','paymentDetails':_0x21cf85};}catch(_0xcc21b1){console[_0xe4b70b(0x197)](_0xe4b70b(0x1e7),_0xcc21b1),loggerService_1['loggerService'][_0xe4b70b(0x1e6)]('cointopay',_0xe4b70b(0x1e5),_0xcc21b1);throw new Error(_0xe4b70b(0x1d5)+(_0xcc21b1 instanceof Error?_0xcc21b1[_0xe4b70b(0x1b9)]:_0xe4b70b(0x17d)));}}async['verifyPayment'](_0x494df8){const _0x474a67=a55_0x592525,_0x4ca152=await this['checkPaymentStatus'](_0x494df8);return{'status':_0x4ca152['status'],'amount':_0x4ca152[_0x474a67(0x191)],'currency':_0x4ca152[_0x474a67(0x1ce)]};}async[a55_0x592525(0x1c7)](_0xbb745c){const _0x638756=a55_0x592525;console[_0x638756(0x194)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xbb745c);let _0x1cd019=_0x638756(0x1d0);switch(_0xbb745c[_0x638756(0x1a6)]?.['toLowerCase']()){case _0x638756(0x1f1):_0x1cd019=_0x638756(0x1ea);break;case _0x638756(0x18f):case'failed':case'error':_0x1cd019=_0x638756(0x185);break;case _0x638756(0x1bb):case'timeout':_0x1cd019='EXPIRED';break;case _0x638756(0x17f):case _0x638756(0x17e):case _0x638756(0x18a):case'created':default:_0x1cd019=_0x638756(0x1d0);break;}return{'paymentId':_0xbb745c[_0x638756(0x1e1)]||_0xbb745c['merchant_reference_id']||'','status':_0x1cd019,'amount':_0xbb745c[_0x638756(0x191)],'currency':_0xbb745c[_0x638756(0x1ce)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;