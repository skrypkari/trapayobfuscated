'use strict';const a59_0xd76892=a59_0x3a88;(function(_0xad50fa,_0x1cd93b){const _0x5ec468=a59_0x3a88,_0xa19107=_0xad50fa();while(!![]){try{const _0xfeabe6=parseInt(_0x5ec468(0xe3))/0x1+parseInt(_0x5ec468(0xa2))/0x2+parseInt(_0x5ec468(0xcf))/0x3*(-parseInt(_0x5ec468(0xa9))/0x4)+parseInt(_0x5ec468(0x108))/0x5*(parseInt(_0x5ec468(0xcb))/0x6)+parseInt(_0x5ec468(0xb5))/0x7+parseInt(_0x5ec468(0xe2))/0x8+parseInt(_0x5ec468(0xa7))/0x9*(-parseInt(_0x5ec468(0x10c))/0xa);if(_0xfeabe6===_0x1cd93b)break;else _0xa19107['push'](_0xa19107['shift']());}catch(_0x24020f){_0xa19107['push'](_0xa19107['shift']());}}}(a59_0x5e41,0x5993c));function a59_0x3a88(_0x4fae72,_0x54ac51){_0x4fae72=_0x4fae72-0x7f;const _0x5e412e=a59_0x5e41();let _0x3a886d=_0x5e412e[_0x4fae72];return _0x3a886d;}Object[a59_0xd76892(0xda)](exports,a59_0xd76892(0xba),{'value':!![]}),exports[a59_0xd76892(0xd7)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x52cc7e=a59_0xd76892;this[_0x52cc7e(0x80)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x52cc7e(0xb9),console[_0x52cc7e(0x101)](_0x52cc7e(0xb7)),console[_0x52cc7e(0x101)](_0x52cc7e(0xbb),this[_0x52cc7e(0x10e)]);}async[a59_0xd76892(0xe7)](_0x5803a0){const _0x242d5f=a59_0xd76892,{orderId:_0x41e164,amount:_0x53fe39}=_0x5803a0;console[_0x242d5f(0x101)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x53fe39+_0x242d5f(0xf3));const _0x28f5b7={'amount':_0x53fe39},_0x652109=Date[_0x242d5f(0xaf)]();try{console[_0x242d5f(0x101)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x242d5f(0x101)](_0x242d5f(0xeb),this[_0x242d5f(0x80)]),console[_0x242d5f(0x101)](_0x242d5f(0x94),JSON[_0x242d5f(0xfc)](_0x28f5b7,null,0x2)),console[_0x242d5f(0x101)]('Amount:',_0x53fe39,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0xa5)](_0x242d5f(0xf7),'/create',_0x242d5f(0xf2),_0x28f5b7);const _0x31b529=await fetch(this[_0x242d5f(0x80)],{'method':_0x242d5f(0xf2),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x242d5f(0xfd)},'body':JSON[_0x242d5f(0xfc)](_0x28f5b7)}),_0xe1dc0e=Date[_0x242d5f(0xaf)]()-_0x652109;console['log'](_0x242d5f(0x104)),console[_0x242d5f(0x101)](_0x242d5f(0x97),_0x31b529[_0x242d5f(0xbf)]),console[_0x242d5f(0x101)](_0x242d5f(0x109),_0x31b529['statusText']),console[_0x242d5f(0x101)](_0x242d5f(0xc5),Object[_0x242d5f(0xf6)](_0x31b529[_0x242d5f(0xd9)]['entries']())),console[_0x242d5f(0x101)](_0x242d5f(0x84),_0xe1dc0e+'ms');const _0xb9346d=await _0x31b529[_0x242d5f(0xc6)]();console[_0x242d5f(0x101)](_0x242d5f(0xbd),_0xb9346d);if(!_0x31b529['ok']){console[_0x242d5f(0xdb)](_0x242d5f(0x99)),console[_0x242d5f(0xdb)](_0x242d5f(0xef),_0x31b529[_0x242d5f(0xbf)]),console['error'](_0x242d5f(0xc1),_0xb9346d),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0x8b)]('cointopay','/create',_0x31b529['status'],_0xb9346d,_0xe1dc0e),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0x81)](_0x242d5f(0xf7),_0x242d5f(0xbe),'HTTP\x20'+_0x31b529[_0x242d5f(0xbf)]+':\x20'+_0xb9346d);throw new Error(_0x242d5f(0xe6)+_0x31b529[_0x242d5f(0xbf)]+_0x242d5f(0x10d)+_0xb9346d);}let _0x1ee5fc;try{_0x1ee5fc=JSON['parse'](_0xb9346d);}catch(_0x283426){console[_0x242d5f(0xdb)](_0x242d5f(0x8c),_0x283426),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0x81)](_0x242d5f(0xf7),_0x242d5f(0xbe),_0x242d5f(0xab)+_0x283426);throw new Error(_0x242d5f(0x100)+_0xb9346d);}console[_0x242d5f(0x101)](_0x242d5f(0xdf)),console['log'](_0x242d5f(0xf0),JSON['stringify'](_0x1ee5fc,null,0x2)),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0x8b)](_0x242d5f(0xf7),_0x242d5f(0xbe),_0x31b529[_0x242d5f(0xbf)],_0x1ee5fc,_0xe1dc0e);if(_0x1ee5fc[_0x242d5f(0xdb)]){const _0x500574=_0x1ee5fc['message']||_0x1ee5fc[_0x242d5f(0xdb)]||_0x242d5f(0x90);console[_0x242d5f(0xdb)](_0x242d5f(0xaa)),console[_0x242d5f(0xdb)]('Error\x20Message:',_0x500574),loggerService_1[_0x242d5f(0xbc)]['logWhiteDomainError'](_0x242d5f(0xf7),_0x242d5f(0xbe),_0x242d5f(0x9e)+_0x500574);throw new Error(_0x242d5f(0x106)+_0x500574);}if(!_0x1ee5fc[_0x242d5f(0xd1)]||!_0x1ee5fc[_0x242d5f(0xa3)]){console['error'](_0x242d5f(0xac)),console[_0x242d5f(0xdb)](_0x242d5f(0x83)),console[_0x242d5f(0xdb)](_0x242d5f(0x105),_0x1ee5fc),loggerService_1[_0x242d5f(0xbc)][_0x242d5f(0x81)](_0x242d5f(0xf7),_0x242d5f(0xbe),_0x242d5f(0xe9));throw new Error(_0x242d5f(0x9a));}console[_0x242d5f(0x101)](_0x242d5f(0x96)),console[_0x242d5f(0x101)]('Gateway\x20Payment\x20ID:',_0x1ee5fc[_0x242d5f(0xa3)]),console[_0x242d5f(0x101)]('Payment\x20URL\x20(original):',_0x1ee5fc[_0x242d5f(0xd1)]);const _0x3c6ea0=_0x1ee5fc[_0x242d5f(0xd1)]+_0x242d5f(0xc9);return console['log'](_0x242d5f(0xe5),_0x3c6ea0),console[_0x242d5f(0x101)](_0x242d5f(0xf8),_0x53fe39,_0x242d5f(0x91)),{'gateway_payment_id':_0x1ee5fc[_0x242d5f(0xa3)],'payment_url':_0x3c6ea0};}catch(_0xe39745){console[_0x242d5f(0xdb)](_0x242d5f(0xec)),console[_0x242d5f(0xdb)](_0x242d5f(0xb0),_0xe39745),loggerService_1[_0x242d5f(0xbc)]['logWhiteDomainError']('cointopay',_0x242d5f(0xbe),_0xe39745);if(_0xe39745 instanceof Error){console['error'](_0x242d5f(0xf9),_0xe39745[_0x242d5f(0x98)]),console[_0x242d5f(0xdb)](_0x242d5f(0x103),_0xe39745[_0x242d5f(0x92)]);throw new Error(_0x242d5f(0xe0)+_0xe39745[_0x242d5f(0x98)]);}throw new Error(_0x242d5f(0xc2));}}async[a59_0xd76892(0xdc)](_0x2130d0){const _0x1faa0c=a59_0xd76892,_0x1432d6=Date[_0x1faa0c(0xaf)]();try{console[_0x1faa0c(0x101)](_0x1faa0c(0xb3)+_0x2130d0);const _0x405cfa={'gatewayPaymentId':_0x2130d0};loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0xa5)](_0x1faa0c(0xf7),_0x1faa0c(0xed),_0x1faa0c(0xf2),_0x405cfa);const _0x3635db=await fetch(this[_0x1faa0c(0x10e)],{'method':_0x1faa0c(0xf2),'headers':{'Content-Type':_0x1faa0c(0x107),'Accept':_0x1faa0c(0x107),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x1faa0c(0xfc)](_0x405cfa)}),_0x3316fc=Date[_0x1faa0c(0xaf)]()-_0x1432d6;console['log'](_0x1faa0c(0xcd)),console[_0x1faa0c(0x101)]('Status:',_0x3635db[_0x1faa0c(0xbf)]),console[_0x1faa0c(0x101)]('Response\x20Time:',_0x3316fc+'ms');if(!_0x3635db['ok']){const _0x549464=await _0x3635db[_0x1faa0c(0xc6)]();console[_0x1faa0c(0xdb)](_0x1faa0c(0xef),_0x3635db[_0x1faa0c(0xbf)]),console['error']('Response\x20Body:',_0x549464),loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0x8b)]('cointopay','/status',_0x3635db['status'],_0x549464,_0x3316fc),loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0x81)](_0x1faa0c(0xf7),'/status',_0x1faa0c(0x88)+_0x3635db[_0x1faa0c(0xbf)]+':\x20'+_0x549464);throw new Error(_0x1faa0c(0xe6)+_0x3635db['status']);}const _0x28952a=await _0x3635db['text']();console[_0x1faa0c(0x101)](_0x1faa0c(0xbd),_0x28952a);let _0x189f49;try{_0x189f49=JSON[_0x1faa0c(0x8d)](_0x28952a);}catch(_0x19963d){console[_0x1faa0c(0xdb)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x19963d),loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0x81)]('cointopay',_0x1faa0c(0xed),'JSON\x20Parse\x20Error:\x20'+_0x19963d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x28952a);}loggerService_1[_0x1faa0c(0xbc)]['logWhiteDomainResponse']('cointopay','/status',_0x3635db['status'],_0x189f49,_0x3316fc),console[_0x1faa0c(0x101)](_0x1faa0c(0xf1)),console[_0x1faa0c(0x101)](_0x1faa0c(0x102),_0x189f49[_0x1faa0c(0x86)]),console[_0x1faa0c(0x101)](_0x1faa0c(0x8f),_0x189f49[_0x1faa0c(0xa8)]),console['log'](_0x1faa0c(0xe1),_0x189f49[_0x1faa0c(0x89)]?.[_0x1faa0c(0xc4)]),console[_0x1faa0c(0x101)](_0x1faa0c(0xf8),_0x189f49[_0x1faa0c(0x89)]?.[_0x1faa0c(0xd3)]),console[_0x1faa0c(0x101)]('Currency:',_0x189f49[_0x1faa0c(0x89)]?.[_0x1faa0c(0xb1)]);if(_0x189f49[_0x1faa0c(0x86)]!==_0x1faa0c(0x85)||_0x189f49['status_code']!==0xc8){const _0x571e44=_0x189f49[_0x1faa0c(0x98)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x1faa0c(0xdb)](_0x1faa0c(0xd8)),console[_0x1faa0c(0xdb)](_0x1faa0c(0xfb),_0x571e44),loggerService_1['loggerService'][_0x1faa0c(0x81)]('cointopay','/status',_0x1faa0c(0xe4)+_0x571e44);throw new Error(_0x1faa0c(0xea)+_0x571e44);}if(!_0x189f49['data']){console[_0x1faa0c(0xdb)](_0x1faa0c(0x9b)),console[_0x1faa0c(0xdb)](_0x1faa0c(0xad)),loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0x81)](_0x1faa0c(0xf7),_0x1faa0c(0xed),_0x1faa0c(0xb4));throw new Error(_0x1faa0c(0xdd));}let _0x12272b=_0x1faa0c(0xf5);switch(_0x189f49[_0x1faa0c(0x89)]['Status']?.[_0x1faa0c(0xc3)]()){case _0x1faa0c(0xe8):_0x12272b=_0x1faa0c(0xca);break;case _0x1faa0c(0x8e):case _0x1faa0c(0x7f):case _0x1faa0c(0xdb):_0x12272b=_0x1faa0c(0xb8);break;case _0x1faa0c(0x87):case'timeout':_0x12272b=_0x1faa0c(0x9d);break;case'waiting':case'awaiting\x20fiat':case _0x1faa0c(0xae):case _0x1faa0c(0xd0):default:_0x12272b=_0x1faa0c(0xf5);break;}let _0x225906,_0x276afb;if(_0x189f49['data'][_0x1faa0c(0xc8)]){const _0x680067=_0x189f49['data']['PaymentDetail'];console['log'](_0x1faa0c(0x9f),_0x680067);const _0x288c4c=_0x680067[_0x1faa0c(0x9c)](/IBAN\s+([A-Z0-9]+)/i);_0x288c4c&&(_0x225906=_0x288c4c[0x1],console[_0x1faa0c(0x101)](_0x1faa0c(0x10a),_0x225906)),_0x276afb=_0x680067;}const _0x2a9c03={'iban':_0x225906,'bankDetails':_0x276afb,'transactionId':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xd2)],'coinAddress':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xff)],'qrCodeUrl':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xfa)],'expiryTime':_0x189f49['data']['ExpiryTime'],'createdOn':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xde)],'confirmedOn':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xb2)]};console[_0x1faa0c(0x101)](_0x1faa0c(0xce)),console[_0x1faa0c(0x101)](_0x1faa0c(0x97),_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xc4)],'->',_0x12272b),console[_0x1faa0c(0x101)](_0x1faa0c(0xf8),_0x189f49['data'][_0x1faa0c(0xd3)],_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xb1)]),console[_0x1faa0c(0x101)](_0x1faa0c(0xb6),_0x189f49[_0x1faa0c(0x89)]['TransactionID']),console[_0x1faa0c(0x101)](_0x1faa0c(0xd5),_0x225906||_0x1faa0c(0xc0)),console[_0x1faa0c(0x101)](_0x1faa0c(0x95),_0x189f49['data'][_0x1faa0c(0xde)]),console['log'](_0x1faa0c(0x82),_0x189f49[_0x1faa0c(0x89)]['TransactionConfirmedOn']||_0x1faa0c(0xcc));if(_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xc4)]?.[_0x1faa0c(0xc3)]()===_0x1faa0c(0xa4))console['log'](_0x1faa0c(0xa0));else _0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xc4)]?.[_0x1faa0c(0xc3)]()===_0x1faa0c(0xe8)&&console[_0x1faa0c(0x101)](_0x1faa0c(0x8a));return{'status':_0x12272b,'amount':parseFloat(_0x189f49['data'][_0x1faa0c(0xd3)])||undefined,'currency':_0x189f49[_0x1faa0c(0x89)][_0x1faa0c(0xb1)]||_0x1faa0c(0x91),'paymentDetails':_0x2a9c03};}catch(_0x4f6928){console[_0x1faa0c(0xdb)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4f6928),loggerService_1[_0x1faa0c(0xbc)][_0x1faa0c(0x81)]('cointopay',_0x1faa0c(0xed),_0x4f6928);throw new Error(_0x1faa0c(0xa6)+(_0x4f6928 instanceof Error?_0x4f6928['message']:_0x1faa0c(0xc7)));}}async[a59_0xd76892(0x93)](_0x23a544){const _0x5e13c8=a59_0xd76892,_0x414dc8=await this[_0x5e13c8(0xdc)](_0x23a544);return{'status':_0x414dc8[_0x5e13c8(0xbf)],'amount':_0x414dc8[_0x5e13c8(0xd6)],'currency':_0x414dc8[_0x5e13c8(0xd4)]};}async[a59_0xd76892(0x10b)](_0x50c370){const _0x5e0acd=a59_0xd76892;console['log'](_0x5e0acd(0xf4),_0x50c370);let _0x2e6e85=_0x5e0acd(0xf5);switch(_0x50c370['status']?.[_0x5e0acd(0xc3)]()){case _0x5e0acd(0xe8):_0x2e6e85=_0x5e0acd(0xca);break;case _0x5e0acd(0x8e):case _0x5e0acd(0x7f):case _0x5e0acd(0xdb):_0x2e6e85=_0x5e0acd(0xb8);break;case _0x5e0acd(0x87):case _0x5e0acd(0xee):_0x2e6e85=_0x5e0acd(0x9d);break;case _0x5e0acd(0xae):case _0x5e0acd(0xfe):case'awaiting\x20fiat':case'created':default:_0x2e6e85='PENDING';break;}return{'paymentId':_0x50c370[_0x5e0acd(0xa1)]||_0x50c370['merchant_reference_id']||'','status':_0x2e6e85,'amount':_0x50c370[_0x5e0acd(0xd6)],'currency':_0x50c370[_0x5e0acd(0xd4)]||'EUR'};}}function a59_0x5e41(){const _0x4005b1=['Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Response\x20Time:','success','result','expired','HTTP\x20','data','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','logWhiteDomainResponse','Failed\x20to\x20parse\x20JSON\x20response:','parse','cancelled','Status\x20Code:','Unknown\x20error\x20from\x20CoinToPay\x20API','EUR','stack','verifyPayment','Request\x20Body:','Created\x20On:','===\x20COINTOPAY\x20SUCCESS\x20===','Status:','message','===\x20COINTOPAY\x20API\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','EXPIRED','Business\x20Error:\x20','üè¶\x20Payment\x20Detail:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','order_id','318486dTSVpx','gateway_payment_id','awaiting\x20fiat','logWhiteDomainRequest','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','10796958sbueMB','status_code','24LJmGod','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','pending','now','Error\x20details:','inputCurrency','TransactionConfirmedOn','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Incomplete\x20response:\x20missing\x20data','1314936HVDmEA','Transaction\x20ID:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','FAILED','https://tesoft.uk/gateway/cointopay/status.php','__esModule','üìä\x20Status\x20check\x20URL:','loggerService','Raw\x20Response\x20Body:','/create','status','not\x20found','Response\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','toLowerCase','Status','Headers:','text','Unknown\x20error','PaymentDetail','&alternative=false','PAID','2057364JMGSPD','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','29037zmVhFI','created','payment_url','TransactionID','Amount','currency','IBAN:','amount','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','headers','defineProperty','error','checkPaymentStatus','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','CreatedOn','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Payment\x20Status:','3244680rwupUD','529074xVxaAx','Status\x20API\x20Error:\x20','Payment\x20URL\x20(modified):','HTTP\x20error!\x20status:\x20','createPaymentLink','paid','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPay\x20status\x20API\x20error:\x20','URL:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','/status','timeout','HTTP\x20Status:','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','POST','\x20EUR','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PENDING','fromEntries','cointopay','Amount:','Error\x20message:','QRCodeURL','Error\x20Message:','stringify','Payment\x20System/1.0','waiting','coinAddress','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','log','Result:','Error\x20stack:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20data:','CoinToPay\x20API\x20error:\x20','application/json','5bZthzb','Status\x20Text:','üè¶\x20Extracted\x20IBAN:','processWebhook','10TEIeGG',',\x20body:\x20','statusUrl','failed','apiUrl','logWhiteDomainError','Confirmed\x20On:'];a59_0x5e41=function(){return _0x4005b1;};return a59_0x5e41();}exports[a59_0xd76892(0xd7)]=CoinToPayService;