'use strict';const a38_0x5d2aad=a38_0x4e49;(function(_0x3950bb,_0xcecf8b){const _0x2e1712=a38_0x4e49,_0x2e7468=_0x3950bb();while(!![]){try{const _0x216639=parseInt(_0x2e1712(0x1b7))/0x1+parseInt(_0x2e1712(0x19f))/0x2*(parseInt(_0x2e1712(0x1a2))/0x3)+-parseInt(_0x2e1712(0x1ec))/0x4+-parseInt(_0x2e1712(0x1d5))/0x5*(parseInt(_0x2e1712(0x1fb))/0x6)+-parseInt(_0x2e1712(0x1ac))/0x7+parseInt(_0x2e1712(0x17c))/0x8+parseInt(_0x2e1712(0x1c2))/0x9*(-parseInt(_0x2e1712(0x19d))/0xa);if(_0x216639===_0xcecf8b)break;else _0x2e7468['push'](_0x2e7468['shift']());}catch(_0x231415){_0x2e7468['push'](_0x2e7468['shift']());}}}(a38_0x123c,0x7b2da));Object['defineProperty'](exports,a38_0x5d2aad(0x18c),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x5d2aad(0x1fa));class CoinToPayService{constructor(){const _0x5df21b=a38_0x5d2aad;this['apiUrl']=_0x5df21b(0x17d),this[_0x5df21b(0x187)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x5df21b(0x1a3)](_0x5df21b(0x185)),console[_0x5df21b(0x1a3)](_0x5df21b(0x1bd),this[_0x5df21b(0x187)]);}async[a38_0x5d2aad(0x1e8)](_0x201776){const _0x15b6b3=a38_0x5d2aad,{orderId:_0x2f4ee6,amount:_0x25ecec}=_0x201776;console[_0x15b6b3(0x1a3)](_0x15b6b3(0x1e1)+_0x25ecec+_0x15b6b3(0x191));const _0x30ce9b={'amount':_0x25ecec},_0x3d0a71=Date[_0x15b6b3(0x1be)]();try{console['log'](_0x15b6b3(0x1e2)),console['log'](_0x15b6b3(0x182),this['apiUrl']),console[_0x15b6b3(0x1a3)]('Request\x20Body:',JSON[_0x15b6b3(0x1db)](_0x30ce9b,null,0x2)),console[_0x15b6b3(0x1a3)]('Amount:',_0x25ecec,_0x15b6b3(0x1a9)),loggerService_1['loggerService'][_0x15b6b3(0x1cd)](_0x15b6b3(0x1b4),_0x15b6b3(0x1ce),_0x15b6b3(0x1e9),_0x30ce9b);const _0x1eb51f=await fetch(this[_0x15b6b3(0x174)],{'method':_0x15b6b3(0x1e9),'headers':{'Content-Type':'application/json','Accept':_0x15b6b3(0x1c0),'User-Agent':_0x15b6b3(0x198)},'body':JSON[_0x15b6b3(0x1db)](_0x30ce9b)}),_0x17f0d9=Date[_0x15b6b3(0x1be)]()-_0x3d0a71;console[_0x15b6b3(0x1a3)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x15b6b3(0x1a3)](_0x15b6b3(0x19b),_0x1eb51f[_0x15b6b3(0x1cf)]),console[_0x15b6b3(0x1a3)](_0x15b6b3(0x1ee),_0x1eb51f['statusText']),console['log']('Headers:',Object[_0x15b6b3(0x1f8)](_0x1eb51f[_0x15b6b3(0x1e6)][_0x15b6b3(0x1d0)]())),console[_0x15b6b3(0x1a3)](_0x15b6b3(0x1d6),_0x17f0d9+'ms');const _0x2d2d7d=await _0x1eb51f[_0x15b6b3(0x1df)]();console['log'](_0x15b6b3(0x1ed),_0x2d2d7d);if(!_0x1eb51f['ok']){console['error'](_0x15b6b3(0x192)),console[_0x15b6b3(0x1b0)]('HTTP\x20Status:',_0x1eb51f['status']),console[_0x15b6b3(0x1b0)]('Response\x20Body:',_0x2d2d7d),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x1b6)]('cointopay',_0x15b6b3(0x1ce),_0x1eb51f[_0x15b6b3(0x1cf)],_0x2d2d7d,_0x17f0d9),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x196)](_0x15b6b3(0x1b4),'/create',_0x15b6b3(0x1b8)+_0x1eb51f[_0x15b6b3(0x1cf)]+':\x20'+_0x2d2d7d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1eb51f[_0x15b6b3(0x1cf)]+_0x15b6b3(0x1b2)+_0x2d2d7d);}let _0x14bf1b;try{_0x14bf1b=JSON[_0x15b6b3(0x18d)](_0x2d2d7d);}catch(_0x3493ba){console[_0x15b6b3(0x1b0)](_0x15b6b3(0x181),_0x3493ba),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x196)](_0x15b6b3(0x1b4),_0x15b6b3(0x1ce),_0x15b6b3(0x1af)+_0x3493ba);throw new Error(_0x15b6b3(0x1e7)+_0x2d2d7d);}console[_0x15b6b3(0x1a3)](_0x15b6b3(0x184)),console['log'](_0x15b6b3(0x19e),JSON[_0x15b6b3(0x1db)](_0x14bf1b,null,0x2)),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x1b6)](_0x15b6b3(0x1b4),_0x15b6b3(0x1ce),_0x1eb51f[_0x15b6b3(0x1cf)],_0x14bf1b,_0x17f0d9);if(_0x14bf1b[_0x15b6b3(0x1b0)]){const _0x4c858d=_0x14bf1b[_0x15b6b3(0x183)]||_0x14bf1b['error']||_0x15b6b3(0x1dd);console['error'](_0x15b6b3(0x1c1)),console['error'](_0x15b6b3(0x1ab),_0x4c858d),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x196)]('cointopay',_0x15b6b3(0x1ce),_0x15b6b3(0x1b3)+_0x4c858d);throw new Error(_0x15b6b3(0x189)+_0x4c858d);}if(!_0x14bf1b[_0x15b6b3(0x1c8)]||!_0x14bf1b[_0x15b6b3(0x1ea)]){console[_0x15b6b3(0x1b0)](_0x15b6b3(0x1ad)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x15b6b3(0x1aa),_0x14bf1b),loggerService_1['loggerService'][_0x15b6b3(0x196)](_0x15b6b3(0x1b4),_0x15b6b3(0x1ce),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x15b6b3(0x1e3));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x15b6b3(0x1a3)](_0x15b6b3(0x1ba),_0x14bf1b['gateway_payment_id']),console['log'](_0x15b6b3(0x1c7),_0x14bf1b[_0x15b6b3(0x1c8)]),console['log'](_0x15b6b3(0x18f),_0x25ecec,'EUR'),{'gateway_payment_id':_0x14bf1b[_0x15b6b3(0x1ea)],'payment_url':_0x14bf1b['payment_url']};}catch(_0x413c1c){console[_0x15b6b3(0x1b0)](_0x15b6b3(0x19c)),console[_0x15b6b3(0x1b0)](_0x15b6b3(0x1d8),_0x413c1c),loggerService_1[_0x15b6b3(0x197)][_0x15b6b3(0x196)](_0x15b6b3(0x1b4),'/create',_0x413c1c);if(_0x413c1c instanceof Error){console[_0x15b6b3(0x1b0)](_0x15b6b3(0x194),_0x413c1c['message']),console[_0x15b6b3(0x1b0)](_0x15b6b3(0x1bb),_0x413c1c[_0x15b6b3(0x1e4)]);throw new Error(_0x15b6b3(0x180)+_0x413c1c[_0x15b6b3(0x183)]);}throw new Error(_0x15b6b3(0x1da));}}async[a38_0x5d2aad(0x1f0)](_0x2a46fb){const _0x1d134e=a38_0x5d2aad,_0xed3c5a=Date['now']();try{console[_0x1d134e(0x1a3)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x2a46fb);const _0x1ebdbb={'gatewayPaymentId':_0x2a46fb};loggerService_1['loggerService'][_0x1d134e(0x1cd)](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x1d134e(0x1e9),_0x1ebdbb);const _0x16d5ea=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x1d134e(0x1c0),'Accept':_0x1d134e(0x1c0),'User-Agent':_0x1d134e(0x198)},'body':JSON[_0x1d134e(0x1db)](_0x1ebdbb)}),_0x2d7fa4=Date[_0x1d134e(0x1be)]()-_0xed3c5a;console['log'](_0x1d134e(0x18b)),console['log'](_0x1d134e(0x19b),_0x16d5ea['status']),console[_0x1d134e(0x1a3)](_0x1d134e(0x1d6),_0x2d7fa4+'ms');if(!_0x16d5ea['ok']){const _0x510220=await _0x16d5ea[_0x1d134e(0x1df)]();console[_0x1d134e(0x1b0)](_0x1d134e(0x1a5),_0x16d5ea[_0x1d134e(0x1cf)]),console['error'](_0x1d134e(0x17b),_0x510220),loggerService_1[_0x1d134e(0x197)]['logWhiteDomainResponse'](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x16d5ea['status'],_0x510220,_0x2d7fa4),loggerService_1[_0x1d134e(0x197)]['logWhiteDomainError'](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x1d134e(0x1b8)+_0x16d5ea[_0x1d134e(0x1cf)]+':\x20'+_0x510220);throw new Error(_0x1d134e(0x1b1)+_0x16d5ea[_0x1d134e(0x1cf)]);}const _0x49719c=await _0x16d5ea[_0x1d134e(0x1df)]();console[_0x1d134e(0x1a3)](_0x1d134e(0x1ed),_0x49719c);let _0x2cbd9c;try{_0x2cbd9c=JSON[_0x1d134e(0x18d)](_0x49719c);}catch(_0x12bdbd){console[_0x1d134e(0x1b0)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x12bdbd),loggerService_1[_0x1d134e(0x197)][_0x1d134e(0x196)](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x1d134e(0x1af)+_0x12bdbd);throw new Error(_0x1d134e(0x1d1)+_0x49719c);}loggerService_1[_0x1d134e(0x197)]['logWhiteDomainResponse'](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x16d5ea[_0x1d134e(0x1cf)],_0x2cbd9c,_0x2d7fa4),console[_0x1d134e(0x1a3)](_0x1d134e(0x1eb)),console[_0x1d134e(0x1a3)](_0x1d134e(0x1d2),_0x2cbd9c['result']),console[_0x1d134e(0x1a3)]('Status\x20Code:',_0x2cbd9c[_0x1d134e(0x1ca)]),console[_0x1d134e(0x1a3)](_0x1d134e(0x1a8),_0x2cbd9c[_0x1d134e(0x1b5)]?.[_0x1d134e(0x190)]),console[_0x1d134e(0x1a3)]('Amount:',_0x2cbd9c['data']?.[_0x1d134e(0x193)]),console[_0x1d134e(0x1a3)](_0x1d134e(0x188),_0x2cbd9c[_0x1d134e(0x1b5)]?.[_0x1d134e(0x1cc)]);if(_0x2cbd9c[_0x1d134e(0x1b9)]!==_0x1d134e(0x176)||_0x2cbd9c['status_code']!==0xc8){const _0x2c07c9=_0x2cbd9c[_0x1d134e(0x183)]||_0x1d134e(0x1f6);console[_0x1d134e(0x1b0)](_0x1d134e(0x1de)),console[_0x1d134e(0x1b0)]('Error\x20Message:',_0x2c07c9),loggerService_1[_0x1d134e(0x197)]['logWhiteDomainError'](_0x1d134e(0x1b4),'/status',_0x1d134e(0x1cb)+_0x2c07c9);throw new Error(_0x1d134e(0x1a6)+_0x2c07c9);}if(!_0x2cbd9c[_0x1d134e(0x1b5)]){console[_0x1d134e(0x1b0)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1d134e(0x1b0)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x1d134e(0x197)][_0x1d134e(0x196)](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x1d134e(0x173));throw new Error(_0x1d134e(0x1a7));}let _0x3f47d3=_0x1d134e(0x1c5);switch(_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x190)]?.['toLowerCase']()){case _0x1d134e(0x1f9):_0x3f47d3='PAID';break;case _0x1d134e(0x1bf):case _0x1d134e(0x1d9):case'error':_0x3f47d3=_0x1d134e(0x177);break;case _0x1d134e(0x1d4):case _0x1d134e(0x1bc):_0x3f47d3=_0x1d134e(0x195);break;case _0x1d134e(0x1f1):case _0x1d134e(0x199):case _0x1d134e(0x1ae):case _0x1d134e(0x186):default:_0x3f47d3='PENDING';break;}let _0xd12c79,_0x3288f;if(_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1ef)]){const _0x4a4636=_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1ef)];console[_0x1d134e(0x1a3)](_0x1d134e(0x19a),_0x4a4636);const _0x28ec8e=_0x4a4636['match'](/IBAN\s+([A-Z0-9]+)/i);_0x28ec8e&&(_0xd12c79=_0x28ec8e[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0xd12c79)),_0x3288f=_0x4a4636;}const _0x2e1fea={'iban':_0xd12c79,'bankDetails':_0x3288f,'transactionId':_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x18e)],'coinAddress':_0x2cbd9c['data']['coinAddress'],'qrCodeUrl':_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x17a)],'expiryTime':_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1c6)],'createdOn':_0x2cbd9c[_0x1d134e(0x1b5)]['CreatedOn'],'confirmedOn':_0x2cbd9c[_0x1d134e(0x1b5)]['TransactionConfirmedOn']};console[_0x1d134e(0x1a3)](_0x1d134e(0x175)),console[_0x1d134e(0x1a3)]('Status:',_0x2cbd9c['data']['Status'],'->',_0x3f47d3),console[_0x1d134e(0x1a3)](_0x1d134e(0x18f),_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x193)],_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1cc)]),console['log'](_0x1d134e(0x18a),_0x2cbd9c['data'][_0x1d134e(0x18e)]),console[_0x1d134e(0x1a3)](_0x1d134e(0x1e0),_0xd12c79||_0x1d134e(0x178)),console['log'](_0x1d134e(0x1a4),_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1f3)]),console[_0x1d134e(0x1a3)](_0x1d134e(0x1a1),_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x1e5)]||_0x1d134e(0x17e));if(_0x2cbd9c['data'][_0x1d134e(0x190)]?.[_0x1d134e(0x1d7)]()===_0x1d134e(0x199))console[_0x1d134e(0x1a3)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2cbd9c[_0x1d134e(0x1b5)]['Status']?.['toLowerCase']()===_0x1d134e(0x1f9)&&console[_0x1d134e(0x1a3)](_0x1d134e(0x1d3));return{'status':_0x3f47d3,'amount':parseFloat(_0x2cbd9c[_0x1d134e(0x1b5)][_0x1d134e(0x193)])||undefined,'currency':_0x2cbd9c['data'][_0x1d134e(0x1cc)]||_0x1d134e(0x1a0),'paymentDetails':_0x2e1fea};}catch(_0x25df3f){console[_0x1d134e(0x1b0)](_0x1d134e(0x1f7),_0x25df3f),loggerService_1['loggerService'][_0x1d134e(0x196)](_0x1d134e(0x1b4),_0x1d134e(0x1c3),_0x25df3f);throw new Error(_0x1d134e(0x1f2)+(_0x25df3f instanceof Error?_0x25df3f[_0x1d134e(0x183)]:_0x1d134e(0x172)));}}async['verifyPayment'](_0x5a2360){const _0x34ba97=a38_0x5d2aad,_0xa66b66=await this[_0x34ba97(0x1f0)](_0x5a2360);return{'status':_0xa66b66['status'],'amount':_0xa66b66['amount'],'currency':_0xa66b66[_0x34ba97(0x1f4)]};}async[a38_0x5d2aad(0x1c9)](_0x47f2d6){const _0x5cf7c8=a38_0x5d2aad;console[_0x5cf7c8(0x1a3)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x47f2d6);let _0x3abef9='PENDING';switch(_0x47f2d6[_0x5cf7c8(0x1cf)]?.[_0x5cf7c8(0x1d7)]()){case _0x5cf7c8(0x1f9):_0x3abef9=_0x5cf7c8(0x1c4);break;case _0x5cf7c8(0x1bf):case _0x5cf7c8(0x1d9):case'error':_0x3abef9=_0x5cf7c8(0x177);break;case _0x5cf7c8(0x1d4):case _0x5cf7c8(0x1bc):_0x3abef9=_0x5cf7c8(0x195);break;case _0x5cf7c8(0x1ae):case'waiting':case _0x5cf7c8(0x199):case _0x5cf7c8(0x186):default:_0x3abef9=_0x5cf7c8(0x1c5);break;}return{'paymentId':_0x47f2d6[_0x5cf7c8(0x1dc)]||_0x47f2d6[_0x5cf7c8(0x17f)]||'','status':_0x3abef9,'amount':_0x47f2d6[_0x5cf7c8(0x179)],'currency':_0x47f2d6['currency']||_0x5cf7c8(0x1a0)};}}function a38_0x4e49(_0x2096d1,_0x194acb){const _0x123c07=a38_0x123c();return a38_0x4e49=function(_0x4e494d,_0x5502a9){_0x4e494d=_0x4e494d-0x172;let _0xea3422=_0x123c07[_0x4e494d];return _0xea3422;},a38_0x4e49(_0x2096d1,_0x194acb);}function a38_0x123c(){const _0x3f33fa=['processWebhook','status_code','Status\x20API\x20Error:\x20','inputCurrency','logWhiteDomainRequest','/create','status','entries','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Result:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','expired','1435SbVURU','Response\x20Time:','toLowerCase','Error\x20details:','failed','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','stringify','order_id','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','text','IBAN:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','stack','TransactionConfirmedOn','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','createPaymentLink','POST','gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','2493324VvBkic','Raw\x20Response\x20Body:','Status\x20Text:','PaymentDetail','checkPaymentStatus','waiting','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CreatedOn','currency','CoinToPayService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','CoinToPay\x20payment\x20status\x20check\x20error:','fromEntries','paid','../loggerService','7734pMNBbm','Unknown\x20error','Incomplete\x20response:\x20missing\x20data','apiUrl','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','success','FAILED','not\x20found','amount','QRCodeURL','Response\x20Body:','1277824wlhDXv','https://tesoft.uk/gateway/cointopay/','not\x20confirmed','merchant_reference_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Failed\x20to\x20parse\x20JSON\x20response:','URL:','message','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','created','statusUrl','Currency:','CoinToPay\x20API\x20error:\x20','Transaction\x20ID:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','__esModule','parse','TransactionID','Amount:','Status','\x20EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','Amount','Error\x20message:','EXPIRED','logWhiteDomainError','loggerService','TesSoft\x20Payment\x20System/1.0','awaiting\x20fiat','üè¶\x20Payment\x20Detail:','Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','3187060iUioMH','Parsed\x20Result:','185552lCREyf','EUR','Confirmed\x20On:','27KKUeoQ','log','Created\x20On:','HTTP\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Payment\x20Status:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20data:','Error\x20Message:','1134035PMQIaC','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','pending','JSON\x20Parse\x20Error:\x20','error','HTTP\x20error!\x20status:\x20',',\x20body:\x20','Business\x20Error:\x20','cointopay','data','logWhiteDomainResponse','983811LlagrM','HTTP\x20','result','Gateway\x20Payment\x20ID:','Error\x20stack:','timeout','üìä\x20Status\x20check\x20URL:','now','cancelled','application/json','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','9XPElXf','/status','PAID','PENDING','ExpiryTime','Payment\x20URL:','payment_url'];a38_0x123c=function(){return _0x3f33fa;};return a38_0x123c();}exports[a38_0x5d2aad(0x1f5)]=CoinToPayService;