'use strict';const a40_0x4ae36d=a40_0xc650;(function(_0x45f0c7,_0x575292){const _0x3591c7=a40_0xc650,_0x18ef1b=_0x45f0c7();while(!![]){try{const _0x18cbfc=-parseInt(_0x3591c7(0x1eb))/0x1*(-parseInt(_0x3591c7(0x23d))/0x2)+parseInt(_0x3591c7(0x1f9))/0x3*(-parseInt(_0x3591c7(0x231))/0x4)+-parseInt(_0x3591c7(0x25e))/0x5*(parseInt(_0x3591c7(0x252))/0x6)+parseInt(_0x3591c7(0x272))/0x7+-parseInt(_0x3591c7(0x246))/0x8*(parseInt(_0x3591c7(0x22b))/0x9)+parseInt(_0x3591c7(0x271))/0xa+-parseInt(_0x3591c7(0x26a))/0xb*(parseInt(_0x3591c7(0x25c))/0xc);if(_0x18cbfc===_0x575292)break;else _0x18ef1b['push'](_0x18ef1b['shift']());}catch(_0x11cd06){_0x18ef1b['push'](_0x18ef1b['shift']());}}}(a40_0x19c7,0x2275b));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;function a40_0xc650(_0xfc0473,_0x2e0bb5){const _0x19c772=a40_0x19c7();return a40_0xc650=function(_0xc6503a,_0x1a9b40){_0xc6503a=_0xc6503a-0x1e9;let _0x51c17c=_0x19c772[_0xc6503a];return _0x51c17c;},a40_0xc650(_0xfc0473,_0x2e0bb5);}const loggerService_1=require(a40_0x4ae36d(0x201));class CoinToPayService{constructor(){const _0x5b0b95=a40_0x4ae36d;this[_0x5b0b95(0x1fa)]='https://tesoft.uk/gateway/cointopay/',this[_0x5b0b95(0x21d)]=_0x5b0b95(0x1f3),console['log'](_0x5b0b95(0x207)),console[_0x5b0b95(0x22c)](_0x5b0b95(0x1f7),this[_0x5b0b95(0x21d)]);}async[a40_0x4ae36d(0x203)](_0x1c0cc0){const _0xb55eae=a40_0x4ae36d,{orderId:_0xa41ff9,amount:_0x156444}=_0x1c0cc0;console['log'](_0xb55eae(0x23f)+_0x156444+_0xb55eae(0x249));const _0x8abcd9={'amount':_0x156444},_0x1976df=Date[_0xb55eae(0x239)]();try{console[_0xb55eae(0x22c)](_0xb55eae(0x205)),console[_0xb55eae(0x22c)](_0xb55eae(0x243),this[_0xb55eae(0x1fa)]),console[_0xb55eae(0x22c)](_0xb55eae(0x274),JSON['stringify'](_0x8abcd9,null,0x2)),console[_0xb55eae(0x22c)](_0xb55eae(0x23a),_0x156444,_0xb55eae(0x25a)),loggerService_1[_0xb55eae(0x218)]['logWhiteDomainRequest'](_0xb55eae(0x227),'/create','POST',_0x8abcd9);const _0x5ec048=await fetch(this[_0xb55eae(0x1fa)],{'method':_0xb55eae(0x206),'headers':{'Content-Type':'application/json','Accept':_0xb55eae(0x24f),'User-Agent':_0xb55eae(0x1fb)},'body':JSON['stringify'](_0x8abcd9)}),_0x51f73c=Date[_0xb55eae(0x239)]()-_0x1976df;console[_0xb55eae(0x22c)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xb55eae(0x22c)]('Status:',_0x5ec048[_0xb55eae(0x1f2)]),console[_0xb55eae(0x22c)](_0xb55eae(0x26b),_0x5ec048[_0xb55eae(0x1ff)]),console[_0xb55eae(0x22c)](_0xb55eae(0x1fc),Object[_0xb55eae(0x216)](_0x5ec048[_0xb55eae(0x232)][_0xb55eae(0x211)]())),console[_0xb55eae(0x22c)](_0xb55eae(0x222),_0x51f73c+'ms');const _0x1707ca=await _0x5ec048[_0xb55eae(0x20c)]();console[_0xb55eae(0x22c)](_0xb55eae(0x202),_0x1707ca);if(!_0x5ec048['ok']){console[_0xb55eae(0x230)](_0xb55eae(0x226)),console[_0xb55eae(0x230)](_0xb55eae(0x1ed),_0x5ec048['status']),console['error'](_0xb55eae(0x21c),_0x1707ca),loggerService_1[_0xb55eae(0x218)][_0xb55eae(0x234)](_0xb55eae(0x227),'/create',_0x5ec048[_0xb55eae(0x1f2)],_0x1707ca,_0x51f73c),loggerService_1['loggerService'][_0xb55eae(0x253)](_0xb55eae(0x227),_0xb55eae(0x254),_0xb55eae(0x256)+_0x5ec048[_0xb55eae(0x1f2)]+':\x20'+_0x1707ca);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5ec048[_0xb55eae(0x1f2)]+',\x20body:\x20'+_0x1707ca);}let _0x57ec4a;try{_0x57ec4a=JSON[_0xb55eae(0x200)](_0x1707ca);}catch(_0x17abb5){console[_0xb55eae(0x230)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x17abb5),loggerService_1['loggerService'][_0xb55eae(0x253)](_0xb55eae(0x227),_0xb55eae(0x254),_0xb55eae(0x1f0)+_0x17abb5);throw new Error(_0xb55eae(0x24b)+_0x1707ca);}console[_0xb55eae(0x22c)](_0xb55eae(0x21f)),console[_0xb55eae(0x22c)]('Parsed\x20Result:',JSON['stringify'](_0x57ec4a,null,0x2)),loggerService_1[_0xb55eae(0x218)][_0xb55eae(0x234)](_0xb55eae(0x227),_0xb55eae(0x254),_0x5ec048[_0xb55eae(0x1f2)],_0x57ec4a,_0x51f73c);if(_0x57ec4a[_0xb55eae(0x230)]){const _0x55a6a8=_0x57ec4a['message']||_0x57ec4a[_0xb55eae(0x230)]||_0xb55eae(0x265);console['error'](_0xb55eae(0x215)),console[_0xb55eae(0x230)]('Error\x20Message:',_0x55a6a8),loggerService_1[_0xb55eae(0x218)][_0xb55eae(0x253)](_0xb55eae(0x227),_0xb55eae(0x254),_0xb55eae(0x24d)+_0x55a6a8);throw new Error(_0xb55eae(0x229)+_0x55a6a8);}if(!_0x57ec4a['payment_url']||!_0x57ec4a[_0xb55eae(0x260)]){console['error'](_0xb55eae(0x264)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0xb55eae(0x230)](_0xb55eae(0x20a),_0x57ec4a),loggerService_1[_0xb55eae(0x218)][_0xb55eae(0x253)]('cointopay','/create',_0xb55eae(0x22f));throw new Error(_0xb55eae(0x258));}return console[_0xb55eae(0x22c)](_0xb55eae(0x228)),console[_0xb55eae(0x22c)](_0xb55eae(0x1e9),_0x57ec4a[_0xb55eae(0x260)]),console[_0xb55eae(0x22c)](_0xb55eae(0x210),_0x57ec4a['payment_url']),console[_0xb55eae(0x22c)](_0xb55eae(0x23a),_0x156444,_0xb55eae(0x259)),{'gateway_payment_id':_0x57ec4a[_0xb55eae(0x260)],'payment_url':_0x57ec4a[_0xb55eae(0x248)]};}catch(_0x56049a){console[_0xb55eae(0x230)](_0xb55eae(0x24c)),console[_0xb55eae(0x230)]('Error\x20details:',_0x56049a),loggerService_1[_0xb55eae(0x218)][_0xb55eae(0x253)](_0xb55eae(0x227),_0xb55eae(0x254),_0x56049a);if(_0x56049a instanceof Error){console['error']('Error\x20message:',_0x56049a[_0xb55eae(0x261)]),console[_0xb55eae(0x230)](_0xb55eae(0x1f5),_0x56049a[_0xb55eae(0x1ee)]);throw new Error(_0xb55eae(0x233)+_0x56049a[_0xb55eae(0x261)]);}throw new Error(_0xb55eae(0x235));}}async[a40_0x4ae36d(0x242)](_0x2ba79f){const _0x2cc294=a40_0x4ae36d,_0x4c07d7=Date[_0x2cc294(0x239)]();try{console['log'](_0x2cc294(0x257)+_0x2ba79f);const _0x260d29={'gatewayPaymentId':_0x2ba79f};loggerService_1[_0x2cc294(0x218)][_0x2cc294(0x268)](_0x2cc294(0x227),_0x2cc294(0x267),_0x2cc294(0x206),_0x260d29);const _0x15d0f5=await fetch(this[_0x2cc294(0x21d)],{'method':_0x2cc294(0x206),'headers':{'Content-Type':_0x2cc294(0x24f),'Accept':_0x2cc294(0x24f),'User-Agent':_0x2cc294(0x1fb)},'body':JSON[_0x2cc294(0x220)](_0x260d29)}),_0x43027b=Date[_0x2cc294(0x239)]()-_0x4c07d7;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x2cc294(0x22c)](_0x2cc294(0x250),_0x15d0f5[_0x2cc294(0x1f2)]),console[_0x2cc294(0x22c)]('Response\x20Time:',_0x43027b+'ms');if(!_0x15d0f5['ok']){const _0x26cbfe=await _0x15d0f5[_0x2cc294(0x20c)]();console[_0x2cc294(0x230)]('HTTP\x20Status:',_0x15d0f5[_0x2cc294(0x1f2)]),console[_0x2cc294(0x230)](_0x2cc294(0x21c),_0x26cbfe),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x2cc294(0x267),_0x15d0f5[_0x2cc294(0x1f2)],_0x26cbfe,_0x43027b),loggerService_1[_0x2cc294(0x218)][_0x2cc294(0x253)]('cointopay',_0x2cc294(0x267),'HTTP\x20'+_0x15d0f5[_0x2cc294(0x1f2)]+':\x20'+_0x26cbfe);throw new Error(_0x2cc294(0x1f8)+_0x15d0f5[_0x2cc294(0x1f2)]);}const _0x33c608=await _0x15d0f5['text']();console[_0x2cc294(0x22c)](_0x2cc294(0x202),_0x33c608);let _0x290144;try{_0x290144=JSON['parse'](_0x33c608);}catch(_0x1f8cd8){console[_0x2cc294(0x230)](_0x2cc294(0x26c),_0x1f8cd8),loggerService_1[_0x2cc294(0x218)]['logWhiteDomainError'](_0x2cc294(0x227),_0x2cc294(0x267),_0x2cc294(0x1f0)+_0x1f8cd8);throw new Error(_0x2cc294(0x269)+_0x33c608);}loggerService_1[_0x2cc294(0x218)]['logWhiteDomainResponse'](_0x2cc294(0x227),_0x2cc294(0x267),_0x15d0f5['status'],_0x290144,_0x43027b),console['log'](_0x2cc294(0x270)),console[_0x2cc294(0x22c)](_0x2cc294(0x262),_0x290144[_0x2cc294(0x247)]),console[_0x2cc294(0x22c)](_0x2cc294(0x273),_0x290144[_0x2cc294(0x20e)]),console[_0x2cc294(0x22c)](_0x2cc294(0x224),_0x290144['data']?.[_0x2cc294(0x214)]),console[_0x2cc294(0x22c)]('Amount:',_0x290144[_0x2cc294(0x225)]?.[_0x2cc294(0x1ec)]),console[_0x2cc294(0x22c)](_0x2cc294(0x1f1),_0x290144['data']?.[_0x2cc294(0x20d)]);if(_0x290144['result']!=='success'||_0x290144[_0x2cc294(0x20e)]!==0xc8){const _0x1ee2be=_0x290144[_0x2cc294(0x261)]||_0x2cc294(0x1f4);console[_0x2cc294(0x230)](_0x2cc294(0x275)),console[_0x2cc294(0x230)](_0x2cc294(0x212),_0x1ee2be),loggerService_1[_0x2cc294(0x218)][_0x2cc294(0x253)](_0x2cc294(0x227),_0x2cc294(0x267),_0x2cc294(0x244)+_0x1ee2be);throw new Error(_0x2cc294(0x23e)+_0x1ee2be);}if(!_0x290144[_0x2cc294(0x225)]){console[_0x2cc294(0x230)](_0x2cc294(0x237)),console[_0x2cc294(0x230)](_0x2cc294(0x219)),loggerService_1[_0x2cc294(0x218)][_0x2cc294(0x253)](_0x2cc294(0x227),_0x2cc294(0x267),_0x2cc294(0x213));throw new Error(_0x2cc294(0x21b));}let _0xafb6a8='PENDING';switch(_0x290144[_0x2cc294(0x225)][_0x2cc294(0x214)]?.[_0x2cc294(0x1f6)]()){case _0x2cc294(0x208):_0xafb6a8='PAID';break;case _0x2cc294(0x1ea):case _0x2cc294(0x25d):case _0x2cc294(0x230):_0xafb6a8=_0x2cc294(0x240);break;case _0x2cc294(0x1fd):case _0x2cc294(0x20b):_0xafb6a8=_0x2cc294(0x209);break;case'waiting':case _0x2cc294(0x266):case _0x2cc294(0x25f):case _0x2cc294(0x24e):default:_0xafb6a8='PENDING';break;}let _0x496172,_0x11dc82;if(_0x290144[_0x2cc294(0x225)][_0x2cc294(0x276)]){const _0x418d86=_0x290144[_0x2cc294(0x225)][_0x2cc294(0x276)];console[_0x2cc294(0x22c)](_0x2cc294(0x22a),_0x418d86);const _0x17c394=_0x418d86[_0x2cc294(0x251)](/IBAN\s+([A-Z0-9]+)/i);_0x17c394&&(_0x496172=_0x17c394[0x1],console[_0x2cc294(0x22c)]('🏦\x20Extracted\x20IBAN:',_0x496172)),_0x11dc82=_0x418d86;}const _0x157898={'iban':_0x496172,'bankDetails':_0x11dc82,'transactionId':_0x290144[_0x2cc294(0x225)][_0x2cc294(0x23b)],'coinAddress':_0x290144[_0x2cc294(0x225)][_0x2cc294(0x217)],'qrCodeUrl':_0x290144[_0x2cc294(0x225)][_0x2cc294(0x255)],'expiryTime':_0x290144[_0x2cc294(0x225)][_0x2cc294(0x22d)],'createdOn':_0x290144[_0x2cc294(0x225)]['CreatedOn'],'confirmedOn':_0x290144['data'][_0x2cc294(0x238)]};console[_0x2cc294(0x22c)](_0x2cc294(0x20f)),console[_0x2cc294(0x22c)](_0x2cc294(0x250),_0x290144[_0x2cc294(0x225)]['Status'],'->',_0xafb6a8),console[_0x2cc294(0x22c)](_0x2cc294(0x23a),_0x290144[_0x2cc294(0x225)][_0x2cc294(0x1ec)],_0x290144[_0x2cc294(0x225)]['inputCurrency']),console[_0x2cc294(0x22c)]('Transaction\x20ID:',_0x290144[_0x2cc294(0x225)][_0x2cc294(0x23b)]),console[_0x2cc294(0x22c)](_0x2cc294(0x245),_0x496172||_0x2cc294(0x223)),console['log']('Created\x20On:',_0x290144[_0x2cc294(0x225)][_0x2cc294(0x263)]),console['log'](_0x2cc294(0x1fe),_0x290144[_0x2cc294(0x225)][_0x2cc294(0x238)]||_0x2cc294(0x25b));if(_0x290144[_0x2cc294(0x225)]['Status']?.[_0x2cc294(0x1f6)]()===_0x2cc294(0x266))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x290144['data'][_0x2cc294(0x214)]?.[_0x2cc294(0x1f6)]()===_0x2cc294(0x208)&&console[_0x2cc294(0x22c)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xafb6a8,'amount':parseFloat(_0x290144[_0x2cc294(0x225)][_0x2cc294(0x1ec)])||undefined,'currency':_0x290144[_0x2cc294(0x225)][_0x2cc294(0x20d)]||_0x2cc294(0x259),'paymentDetails':_0x157898};}catch(_0x40506b){console['error'](_0x2cc294(0x204),_0x40506b),loggerService_1[_0x2cc294(0x218)][_0x2cc294(0x253)](_0x2cc294(0x227),_0x2cc294(0x267),_0x40506b);throw new Error(_0x2cc294(0x26f)+(_0x40506b instanceof Error?_0x40506b[_0x2cc294(0x261)]:_0x2cc294(0x236)));}}async[a40_0x4ae36d(0x1ef)](_0x4ce41e){const _0xbb16e=a40_0x4ae36d,_0x5a601d=await this[_0xbb16e(0x242)](_0x4ce41e);return{'status':_0x5a601d[_0xbb16e(0x1f2)],'amount':_0x5a601d['amount'],'currency':_0x5a601d[_0xbb16e(0x21a)]};}async[a40_0x4ae36d(0x26e)](_0x55f23b){const _0xb93d14=a40_0x4ae36d;console[_0xb93d14(0x22c)](_0xb93d14(0x221),_0x55f23b);let _0x27ec5d=_0xb93d14(0x23c);switch(_0x55f23b['status']?.['toLowerCase']()){case _0xb93d14(0x208):_0x27ec5d=_0xb93d14(0x22e);break;case _0xb93d14(0x1ea):case'failed':case _0xb93d14(0x230):_0x27ec5d=_0xb93d14(0x240);break;case _0xb93d14(0x1fd):case _0xb93d14(0x20b):_0x27ec5d=_0xb93d14(0x209);break;case _0xb93d14(0x25f):case _0xb93d14(0x21e):case _0xb93d14(0x266):case'created':default:_0x27ec5d='PENDING';break;}return{'paymentId':_0x55f23b[_0xb93d14(0x241)]||_0x55f23b['merchant_reference_id']||'','status':_0x27ec5d,'amount':_0x55f23b[_0xb93d14(0x24a)],'currency':_0x55f23b['currency']||_0xb93d14(0x259)};}}function a40_0x19c7(){const _0x5c29d1=['HTTP\x20Status:','stack','verifyPayment','JSON\x20Parse\x20Error:\x20','Currency:','status','https://tesoft.uk/gateway/cointopay/status.php','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20stack:','toLowerCase','📊\x20Status\x20check\x20URL:','HTTP\x20error!\x20status:\x20','3jClMGI','apiUrl','TesSoft\x20Payment\x20System/1.0','Headers:','expired','Confirmed\x20On:','statusText','parse','../loggerService','Raw\x20Response\x20Body:','createPaymentLink','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','POST','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','paid','EXPIRED','Response\x20data:','timeout','text','inputCurrency','status_code','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Payment\x20URL:','entries','Error\x20Message:','Incomplete\x20response:\x20missing\x20data','Status','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','coinAddress','loggerService','Missing\x20data\x20in\x20response','currency','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20Body:','statusUrl','waiting','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','stringify','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20Time:','not\x20found','Payment\x20Status:','data','===\x20COINTOPAY\x20API\x20ERROR\x20===','cointopay','===\x20COINTOPAY\x20SUCCESS\x20===','CoinToPay\x20API\x20error:\x20','🏦\x20Payment\x20Detail:','706086LQKYGY','log','ExpiryTime','PAID','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','error','575276yGNWnq','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TransactionConfirmedOn','now','Amount:','TransactionID','PENDING','302EToyTz','CoinToPay\x20status\x20API\x20error:\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20','FAILED','order_id','checkPaymentStatus','URL:','Status\x20API\x20Error:\x20','IBAN:','8Cichfn','result','payment_url','\x20EUR','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','created','application/json','Status:','match','152238IJGOTz','logWhiteDomainError','/create','QRCodeURL','HTTP\x20','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','not\x20confirmed','12gxFjBx','failed','15NUUAxW','pending','gateway_payment_id','message','Result:','CreatedOn','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','awaiting\x20fiat','/status','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','1277067MqAqFw','Status\x20Text:','Failed\x20to\x20parse\x20JSON\x20response:','CoinToPayService','processWebhook','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','2022620BcFInc','1350027ePNmxM','Status\x20Code:','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','PaymentDetail','Gateway\x20Payment\x20ID:','cancelled','1063agiXSa','Amount'];a40_0x19c7=function(){return _0x5c29d1;};return a40_0x19c7();}exports[a40_0x4ae36d(0x26d)]=CoinToPayService;