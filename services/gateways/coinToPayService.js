'use strict';const a41_0xae33bd=a41_0x4279;(function(_0xedc75f,_0x9c0bd1){const _0x1e2d0d=a41_0x4279,_0x25d320=_0xedc75f();while(!![]){try{const _0x2d2d98=-parseInt(_0x1e2d0d(0x14c))/0x1*(parseInt(_0x1e2d0d(0xdd))/0x2)+-parseInt(_0x1e2d0d(0x117))/0x3+parseInt(_0x1e2d0d(0x114))/0x4*(parseInt(_0x1e2d0d(0x159))/0x5)+-parseInt(_0x1e2d0d(0xfc))/0x6*(-parseInt(_0x1e2d0d(0xfb))/0x7)+parseInt(_0x1e2d0d(0x115))/0x8*(parseInt(_0x1e2d0d(0x129))/0x9)+-parseInt(_0x1e2d0d(0xed))/0xa+parseInt(_0x1e2d0d(0x135))/0xb*(parseInt(_0x1e2d0d(0xfe))/0xc);if(_0x2d2d98===_0x9c0bd1)break;else _0x25d320['push'](_0x25d320['shift']());}catch(_0x339ebb){_0x25d320['push'](_0x25d320['shift']());}}}(a41_0xf8fb,0xd75b2));function a41_0xf8fb(){const _0x400ceb=['===\x20COINTOPAY\x20SUCCESS\x20===','match','CreatedOn','Error\x20Message:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response',',\x20body:\x20','Headers:','gateway_payment_id','Request\x20Body:','\x20EUR','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','9TsjFUs','TransactionConfirmedOn','Business\x20Error:\x20','amount','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','createPaymentLink','Created\x20On:','Status','stringify','defineProperty','409112hgDYEZ','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Status\x20check\x20URL:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Response\x20Time:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','IBAN:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','status','merchant_reference_id','status_code','POST','now','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20Body:','Amount:','QRCodeURL','Payment\x20URL:','URL:','51571jhljQl','Missing\x20data\x20in\x20response','CoinToPay\x20API\x20error:\x20','Response\x20data:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','paid','__esModule','Transaction\x20ID:','logWhiteDomainRequest','Currency:','timeout','HTTP\x20Status:','checkPaymentStatus','263515cAjXPj','payment_url','application/json','failed','expired','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','inputCurrency','PENDING','../loggerService','Status\x20API\x20Error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','not\x20confirmed','PAID','26GWQucA','Amount','ExpiryTime','Status:','cointopay','TesSoft\x20Payment\x20System/1.0','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','awaiting\x20fiat','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','HTTP\x20error!\x20status:\x20','CoinToPayService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','order_id','Gateway\x20Payment\x20ID:','statusUrl','text','12661220KMAjyK','EXPIRED','log','error','parse','PaymentDetail','apiUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','success','/create','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','cancelled','logWhiteDomainResponse','7BHkehk','2385756hQBXAH','headers','192XDbXKQ','Raw\x20Response\x20Body:','entries','HTTP\x20','Parsed\x20Result:','waiting','statusText','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','üè¶\x20Payment\x20Detail:','not\x20found','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','toLowerCase','loggerService','verifyPayment','===\x20COINTOPAY\x20API\x20ERROR\x20===','message','FAILED','üè¶\x20Extracted\x20IBAN:','CoinToPay\x20status\x20API\x20error:\x20','/status','Unknown\x20error\x20from\x20CoinToPay\x20API','60IWcAUR','11963048qKkFhG','stack','1379943ZpnOsP','TransactionID','JSON\x20Parse\x20Error:\x20','fromEntries','coinAddress','pending'];a41_0xf8fb=function(){return _0x400ceb;};return a41_0xf8fb();}function a41_0x4279(_0x5a82cf,_0x3649e3){const _0xf8fb90=a41_0xf8fb();return a41_0x4279=function(_0x42796d,_0x420270){_0x42796d=_0x42796d-0xd7;let _0x53f176=_0xf8fb90[_0x42796d];return _0x53f176;},a41_0x4279(_0x5a82cf,_0x3649e3);}Object[a41_0xae33bd(0x134)](exports,a41_0xae33bd(0x152),{'value':!![]}),exports[a41_0xae33bd(0xe7)]=void 0x0;const loggerService_1=require(a41_0xae33bd(0x164));class CoinToPayService{constructor(){const _0x16e4e2=a41_0xae33bd;this[_0x16e4e2(0xf3)]='https://tesoft.uk/gateway/cointopay/',this[_0x16e4e2(0xeb)]=_0x16e4e2(0x160),console[_0x16e4e2(0xef)](_0x16e4e2(0x15e)),console['log'](_0x16e4e2(0x137),this[_0x16e4e2(0xeb)]);}async[a41_0xae33bd(0x130)](_0x4ea946){const _0x28cb6b=a41_0xae33bd,{orderId:_0xa2f658,amount:_0x176f57}=_0x4ea946;console[_0x28cb6b(0xef)](_0x28cb6b(0xf7)+_0x176f57+_0x28cb6b(0x127));const _0x546afc={'amount':_0x176f57},_0x420248=Date['now']();try{console[_0x28cb6b(0xef)](_0x28cb6b(0x13d)),console[_0x28cb6b(0xef)](_0x28cb6b(0x14b),this[_0x28cb6b(0xf3)]),console[_0x28cb6b(0xef)](_0x28cb6b(0x126),JSON[_0x28cb6b(0x133)](_0x546afc,null,0x2)),console[_0x28cb6b(0xef)](_0x28cb6b(0x148),_0x176f57,_0x28cb6b(0xe3)),loggerService_1[_0x28cb6b(0x10b)]['logWhiteDomainRequest'](_0x28cb6b(0xe1),_0x28cb6b(0xf6),_0x28cb6b(0x144),_0x546afc);const _0x23d26b=await fetch(this['apiUrl'],{'method':_0x28cb6b(0x144),'headers':{'Content-Type':_0x28cb6b(0x15b),'Accept':_0x28cb6b(0x15b),'User-Agent':_0x28cb6b(0xe2)},'body':JSON[_0x28cb6b(0x133)](_0x546afc)}),_0x2cf036=Date['now']()-_0x420248;console[_0x28cb6b(0xef)](_0x28cb6b(0x121)),console[_0x28cb6b(0xef)](_0x28cb6b(0xe0),_0x23d26b[_0x28cb6b(0x141)]),console[_0x28cb6b(0xef)]('Status\x20Text:',_0x23d26b[_0x28cb6b(0x104)]),console[_0x28cb6b(0xef)](_0x28cb6b(0x124),Object[_0x28cb6b(0x11a)](_0x23d26b[_0x28cb6b(0xfd)][_0x28cb6b(0x100)]())),console[_0x28cb6b(0xef)](_0x28cb6b(0x13a),_0x2cf036+'ms');const _0x2346ee=await _0x23d26b[_0x28cb6b(0xec)]();console[_0x28cb6b(0xef)](_0x28cb6b(0xff),_0x2346ee);if(!_0x23d26b['ok']){console[_0x28cb6b(0xf0)](_0x28cb6b(0x10d)),console['error'](_0x28cb6b(0x157),_0x23d26b[_0x28cb6b(0x141)]),console[_0x28cb6b(0xf0)](_0x28cb6b(0x147),_0x2346ee),loggerService_1[_0x28cb6b(0x10b)][_0x28cb6b(0xfa)](_0x28cb6b(0xe1),'/create',_0x23d26b[_0x28cb6b(0x141)],_0x2346ee,_0x2cf036),loggerService_1[_0x28cb6b(0x10b)]['logWhiteDomainError'](_0x28cb6b(0xe1),_0x28cb6b(0xf6),_0x28cb6b(0x101)+_0x23d26b[_0x28cb6b(0x141)]+':\x20'+_0x2346ee);throw new Error(_0x28cb6b(0xe6)+_0x23d26b[_0x28cb6b(0x141)]+_0x28cb6b(0x123)+_0x2346ee);}let _0x3f306e;try{_0x3f306e=JSON[_0x28cb6b(0xf1)](_0x2346ee);}catch(_0x32d1ee){console[_0x28cb6b(0xf0)](_0x28cb6b(0x138),_0x32d1ee),loggerService_1[_0x28cb6b(0x10b)][_0x28cb6b(0x105)](_0x28cb6b(0xe1),_0x28cb6b(0xf6),_0x28cb6b(0x119)+_0x32d1ee);throw new Error(_0x28cb6b(0x12e)+_0x2346ee);}console[_0x28cb6b(0xef)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x28cb6b(0x102),JSON[_0x28cb6b(0x133)](_0x3f306e,null,0x2)),loggerService_1[_0x28cb6b(0x10b)][_0x28cb6b(0xfa)](_0x28cb6b(0xe1),_0x28cb6b(0xf6),_0x23d26b[_0x28cb6b(0x141)],_0x3f306e,_0x2cf036);if(_0x3f306e[_0x28cb6b(0xf0)]){const _0x3d8f58=_0x3f306e[_0x28cb6b(0x10e)]||_0x3f306e[_0x28cb6b(0xf0)]||_0x28cb6b(0x113);console[_0x28cb6b(0xf0)](_0x28cb6b(0x12f)),console[_0x28cb6b(0xf0)](_0x28cb6b(0x120),_0x3d8f58),loggerService_1[_0x28cb6b(0x10b)][_0x28cb6b(0x105)](_0x28cb6b(0xe1),'/create',_0x28cb6b(0x12b)+_0x3d8f58);throw new Error(_0x28cb6b(0x14e)+_0x3d8f58);}if(!_0x3f306e['payment_url']||!_0x3f306e[_0x28cb6b(0x125)]){console[_0x28cb6b(0xf0)](_0x28cb6b(0xf8)),console[_0x28cb6b(0xf0)](_0x28cb6b(0x122)),console[_0x28cb6b(0xf0)](_0x28cb6b(0x14f),_0x3f306e),loggerService_1[_0x28cb6b(0x10b)]['logWhiteDomainError'](_0x28cb6b(0xe1),'/create',_0x28cb6b(0x136));throw new Error(_0x28cb6b(0xd9));}return console[_0x28cb6b(0xef)](_0x28cb6b(0x11d)),console[_0x28cb6b(0xef)](_0x28cb6b(0xea),_0x3f306e[_0x28cb6b(0x125)]),console[_0x28cb6b(0xef)](_0x28cb6b(0x14a),_0x3f306e['payment_url']),console['log'](_0x28cb6b(0x148),_0x176f57,_0x28cb6b(0xda)),{'gateway_payment_id':_0x3f306e['gateway_payment_id'],'payment_url':_0x3f306e[_0x28cb6b(0x15a)]};}catch(_0x468240){console[_0x28cb6b(0xf0)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x28cb6b(0xf0)](_0x28cb6b(0x15f),_0x468240),loggerService_1[_0x28cb6b(0x10b)][_0x28cb6b(0x105)]('cointopay','/create',_0x468240);if(_0x468240 instanceof Error){console['error'](_0x28cb6b(0x13e),_0x468240[_0x28cb6b(0x10e)]),console[_0x28cb6b(0xf0)]('Error\x20stack:',_0x468240[_0x28cb6b(0x116)]);throw new Error(_0x28cb6b(0x109)+_0x468240[_0x28cb6b(0x10e)]);}throw new Error(_0x28cb6b(0x146));}}async[a41_0xae33bd(0x158)](_0x63fbff){const _0x5cef1d=a41_0xae33bd,_0x342182=Date[_0x5cef1d(0x145)]();try{console[_0x5cef1d(0xef)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x63fbff);const _0x28c6e4={'gatewayPaymentId':_0x63fbff};loggerService_1[_0x5cef1d(0x10b)][_0x5cef1d(0x154)](_0x5cef1d(0xe1),_0x5cef1d(0x112),_0x5cef1d(0x144),_0x28c6e4);const _0x1abb31=await fetch(this[_0x5cef1d(0xeb)],{'method':_0x5cef1d(0x144),'headers':{'Content-Type':'application/json','Accept':_0x5cef1d(0x15b),'User-Agent':_0x5cef1d(0xe2)},'body':JSON[_0x5cef1d(0x133)](_0x28c6e4)}),_0x4c2063=Date[_0x5cef1d(0x145)]()-_0x342182;console[_0x5cef1d(0xef)](_0x5cef1d(0x139)),console[_0x5cef1d(0xef)](_0x5cef1d(0xe0),_0x1abb31[_0x5cef1d(0x141)]),console[_0x5cef1d(0xef)](_0x5cef1d(0x13a),_0x4c2063+'ms');if(!_0x1abb31['ok']){const _0x4ceec8=await _0x1abb31[_0x5cef1d(0xec)]();console[_0x5cef1d(0xf0)]('HTTP\x20Status:',_0x1abb31[_0x5cef1d(0x141)]),console[_0x5cef1d(0xf0)]('Response\x20Body:',_0x4ceec8),loggerService_1[_0x5cef1d(0x10b)][_0x5cef1d(0xfa)]('cointopay',_0x5cef1d(0x112),_0x1abb31[_0x5cef1d(0x141)],_0x4ceec8,_0x4c2063),loggerService_1[_0x5cef1d(0x10b)][_0x5cef1d(0x105)]('cointopay',_0x5cef1d(0x112),'HTTP\x20'+_0x1abb31[_0x5cef1d(0x141)]+':\x20'+_0x4ceec8);throw new Error(_0x5cef1d(0xe6)+_0x1abb31[_0x5cef1d(0x141)]);}const _0x294071=await _0x1abb31[_0x5cef1d(0xec)]();console[_0x5cef1d(0xef)](_0x5cef1d(0xff),_0x294071);let _0x28a0a1;try{_0x28a0a1=JSON[_0x5cef1d(0xf1)](_0x294071);}catch(_0x3e77ec){console[_0x5cef1d(0xf0)](_0x5cef1d(0x138),_0x3e77ec),loggerService_1[_0x5cef1d(0x10b)][_0x5cef1d(0x105)](_0x5cef1d(0xe1),_0x5cef1d(0x112),'JSON\x20Parse\x20Error:\x20'+_0x3e77ec);throw new Error(_0x5cef1d(0xf4)+_0x294071);}loggerService_1[_0x5cef1d(0x10b)][_0x5cef1d(0xfa)]('cointopay',_0x5cef1d(0x112),_0x1abb31[_0x5cef1d(0x141)],_0x28a0a1,_0x4c2063),console[_0x5cef1d(0xef)](_0x5cef1d(0x128)),console[_0x5cef1d(0xef)]('Result:',_0x28a0a1['result']),console[_0x5cef1d(0xef)]('Status\x20Code:',_0x28a0a1[_0x5cef1d(0x143)]),console[_0x5cef1d(0xef)]('Payment\x20Status:',_0x28a0a1[_0x5cef1d(0x13c)]?.[_0x5cef1d(0x132)]),console[_0x5cef1d(0xef)](_0x5cef1d(0x148),_0x28a0a1[_0x5cef1d(0x13c)]?.['Amount']),console[_0x5cef1d(0xef)](_0x5cef1d(0x155),_0x28a0a1['data']?.['inputCurrency']);if(_0x28a0a1['result']!==_0x5cef1d(0xf5)||_0x28a0a1['status_code']!==0xc8){const _0x4de94f=_0x28a0a1[_0x5cef1d(0x10e)]||_0x5cef1d(0xe8);console['error'](_0x5cef1d(0x13b)),console[_0x5cef1d(0xf0)](_0x5cef1d(0x120),_0x4de94f),loggerService_1['loggerService'][_0x5cef1d(0x105)]('cointopay',_0x5cef1d(0x112),_0x5cef1d(0xd7)+_0x4de94f);throw new Error(_0x5cef1d(0x111)+_0x4de94f);}if(!_0x28a0a1[_0x5cef1d(0x13c)]){console['error'](_0x5cef1d(0x12d)),console[_0x5cef1d(0xf0)](_0x5cef1d(0x14d)),loggerService_1[_0x5cef1d(0x10b)]['logWhiteDomainError'](_0x5cef1d(0xe1),_0x5cef1d(0x112),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5cef1d(0x106));}let _0x28370b=_0x5cef1d(0x163);switch(_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x132)]?.[_0x5cef1d(0x10a)]()){case _0x5cef1d(0x151):_0x28370b=_0x5cef1d(0xdc);break;case _0x5cef1d(0xf9):case _0x5cef1d(0x15c):case _0x5cef1d(0xf0):_0x28370b=_0x5cef1d(0x10f);break;case _0x5cef1d(0x15d):case _0x5cef1d(0x156):_0x28370b=_0x5cef1d(0xee);break;case _0x5cef1d(0x103):case'awaiting\x20fiat':case _0x5cef1d(0x11c):case'created':default:_0x28370b=_0x5cef1d(0x163);break;}let _0xdf7fa0,_0x3420b5;if(_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0xf2)]){const _0x55db00=_0x28a0a1[_0x5cef1d(0x13c)]['PaymentDetail'];console[_0x5cef1d(0xef)](_0x5cef1d(0x107),_0x55db00);const _0x2caaf7=_0x55db00[_0x5cef1d(0x11e)](/IBAN\s+([A-Z0-9]+)/i);_0x2caaf7&&(_0xdf7fa0=_0x2caaf7[0x1],console['log'](_0x5cef1d(0x110),_0xdf7fa0)),_0x3420b5=_0x55db00;}const _0x2248d6={'iban':_0xdf7fa0,'bankDetails':_0x3420b5,'transactionId':_0x28a0a1['data']['TransactionID'],'coinAddress':_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x11b)],'qrCodeUrl':_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x149)],'expiryTime':_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0xdf)],'createdOn':_0x28a0a1['data'][_0x5cef1d(0x11f)],'confirmedOn':_0x28a0a1['data'][_0x5cef1d(0x12a)]};console[_0x5cef1d(0xef)](_0x5cef1d(0x161)),console[_0x5cef1d(0xef)](_0x5cef1d(0xe0),_0x28a0a1['data'][_0x5cef1d(0x132)],'->',_0x28370b),console[_0x5cef1d(0xef)](_0x5cef1d(0x148),_0x28a0a1['data']['Amount'],_0x28a0a1[_0x5cef1d(0x13c)]['inputCurrency']),console[_0x5cef1d(0xef)](_0x5cef1d(0x153),_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x118)]),console[_0x5cef1d(0xef)](_0x5cef1d(0x13f),_0xdf7fa0||_0x5cef1d(0x108)),console[_0x5cef1d(0xef)](_0x5cef1d(0x131),_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x11f)]),console[_0x5cef1d(0xef)]('Confirmed\x20On:',_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x12a)]||_0x5cef1d(0xdb));if(_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x132)]?.[_0x5cef1d(0x10a)]()==='awaiting\x20fiat')console['log'](_0x5cef1d(0x150));else _0x28a0a1[_0x5cef1d(0x13c)]['Status']?.[_0x5cef1d(0x10a)]()===_0x5cef1d(0x151)&&console['log'](_0x5cef1d(0x140));return{'status':_0x28370b,'amount':parseFloat(_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0xde)])||undefined,'currency':_0x28a0a1[_0x5cef1d(0x13c)][_0x5cef1d(0x162)]||_0x5cef1d(0xda),'paymentDetails':_0x2248d6};}catch(_0x7d18cb){console[_0x5cef1d(0xf0)](_0x5cef1d(0xd8),_0x7d18cb),loggerService_1[_0x5cef1d(0x10b)]['logWhiteDomainError'](_0x5cef1d(0xe1),_0x5cef1d(0x112),_0x7d18cb);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x7d18cb instanceof Error?_0x7d18cb[_0x5cef1d(0x10e)]:'Unknown\x20error'));}}async[a41_0xae33bd(0x10c)](_0x22beca){const _0x2ee283=a41_0xae33bd,_0x57fc67=await this['checkPaymentStatus'](_0x22beca);return{'status':_0x57fc67[_0x2ee283(0x141)],'amount':_0x57fc67[_0x2ee283(0x12c)],'currency':_0x57fc67['currency']};}async['processWebhook'](_0x45e988){const _0x335cc3=a41_0xae33bd;console[_0x335cc3(0xef)](_0x335cc3(0xe5),_0x45e988);let _0x379342='PENDING';switch(_0x45e988['status']?.[_0x335cc3(0x10a)]()){case _0x335cc3(0x151):_0x379342='PAID';break;case _0x335cc3(0xf9):case _0x335cc3(0x15c):case _0x335cc3(0xf0):_0x379342=_0x335cc3(0x10f);break;case _0x335cc3(0x15d):case _0x335cc3(0x156):_0x379342=_0x335cc3(0xee);break;case'pending':case _0x335cc3(0x103):case _0x335cc3(0xe4):case'created':default:_0x379342='PENDING';break;}return{'paymentId':_0x45e988[_0x335cc3(0xe9)]||_0x45e988[_0x335cc3(0x142)]||'','status':_0x379342,'amount':_0x45e988[_0x335cc3(0x12c)],'currency':_0x45e988['currency']||_0x335cc3(0xda)};}}exports[a41_0xae33bd(0xe7)]=CoinToPayService;