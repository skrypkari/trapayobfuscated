'use strict';const a49_0x5a97db=a49_0xd6cd;function a49_0xd6cd(_0x481e36,_0x5da83c){const _0x4ea56e=a49_0x4ea5();return a49_0xd6cd=function(_0xd6cda5,_0x3e5d2d){_0xd6cda5=_0xd6cda5-0x101;let _0x498e25=_0x4ea56e[_0xd6cda5];return _0x498e25;},a49_0xd6cd(_0x481e36,_0x5da83c);}(function(_0x4c55fa,_0x6dd32d){const _0x3e07b1=a49_0xd6cd,_0x39bf10=_0x4c55fa();while(!![]){try{const _0x1b29dd=parseInt(_0x3e07b1(0x111))/0x1*(parseInt(_0x3e07b1(0x132))/0x2)+-parseInt(_0x3e07b1(0x180))/0x3*(parseInt(_0x3e07b1(0x137))/0x4)+-parseInt(_0x3e07b1(0x15e))/0x5+parseInt(_0x3e07b1(0x110))/0x6+parseInt(_0x3e07b1(0x151))/0x7*(parseInt(_0x3e07b1(0x170))/0x8)+parseInt(_0x3e07b1(0x144))/0x9+-parseInt(_0x3e07b1(0x117))/0xa;if(_0x1b29dd===_0x6dd32d)break;else _0x39bf10['push'](_0x39bf10['shift']());}catch(_0x5a34c3){_0x39bf10['push'](_0x39bf10['shift']());}}}(a49_0x4ea5,0x2ba44));Object[a49_0x5a97db(0x17e)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a49_0x5a97db(0x164));function a49_0x4ea5(){const _0x55c2b7=['===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','data','pending','200bnzUex','TransactionID','Status\x20Code:','PaymentDetail','gateway_payment_id','match','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','fromEntries','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','timeout','failed','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','toLowerCase','defineProperty','loggerService','6McGCIz','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','logWhiteDomainRequest','Error\x20details:','Status','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','amount','statusText','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','\x20EUR','stack','error','CreatedOn','headers','entries','log','checkPaymentStatus','EUR','HTTP\x20Status:','CoinToPay\x20API\x20error:\x20','1952370RTmOhO','59EHgLwp','stringify','Payment\x20URL\x20(original):','cointopay','/status','coinAddress','6070390ifRTBr','created','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20SUCCESS\x20===','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','application/json','order_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING',',\x20body:\x20','Raw\x20Response\x20Body:','Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','currency','===\x20COINTOPAY\x20API\x20ERROR\x20===','Confirmed\x20On:','QRCodeURL','text','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','message','Failed\x20to\x20parse\x20JSON\x20response:','Parsed\x20Result:','logWhiteDomainError','Response\x20Time:','Result:','merchant_reference_id','848PGVBGV','Payment\x20System/1.0','verifyPayment','now','result','76612SkttuI','statusUrl','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','ExpiryTime','URL:','/create','Error\x20Message:','FAILED','Unknown\x20error\x20from\x20CoinToPay\x20API','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','paid','Status:','2786661vIZEVh','awaiting\x20fiat','Headers:','Response\x20Body:','processWebhook','Error\x20stack:','POST','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','apiUrl','HTTP\x20error!\x20status:\x20','not\x20confirmed','https://tesoft.uk/gateway/cointopay/status.php','success','77105fpFPVI','&alternative=false','üìä\x20Status\x20check\x20URL:','EXPIRED','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','PAID','payment_url','CoinToPay\x20payment\x20status\x20check\x20error:','Gateway\x20Payment\x20ID:','logWhiteDomainResponse','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','expired','556570rLipYL','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Amount','üè¶\x20Extracted\x20IBAN:','parse','not\x20found','../loggerService','inputCurrency','waiting','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','status_code','status'];a49_0x4ea5=function(){return _0x55c2b7;};return a49_0x4ea5();}class CoinToPayService{constructor(){const _0x55eef7=a49_0x5a97db;this[_0x55eef7(0x14c)]='https://tesoft.uk/gateway/cointopay/',this[_0x55eef7(0x138)]=_0x55eef7(0x14f),console[_0x55eef7(0x10b)](_0x55eef7(0x14b)),console['log'](_0x55eef7(0x153),this['statusUrl']);}async['createPaymentLink'](_0x36a99e){const _0x14938f=a49_0x5a97db,{orderId:_0x12967a,amount:_0x1ff78d}=_0x36a99e;console[_0x14938f(0x10b)](_0x14938f(0x11b)+_0x1ff78d+_0x14938f(0x105));const _0x4db615={'amount':_0x1ff78d},_0x31dddd=Date['now']();try{console['log'](_0x14938f(0x15f)),console[_0x14938f(0x10b)](_0x14938f(0x13c),this[_0x14938f(0x14c)]),console['log']('Request\x20Body:',JSON[_0x14938f(0x112)](_0x4db615,null,0x2)),console['log'](_0x14938f(0x122),_0x1ff78d,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x14938f(0x17f)][_0x14938f(0x183)]('cointopay',_0x14938f(0x13d),_0x14938f(0x14a),_0x4db615);const _0x2146e6=await fetch(this[_0x14938f(0x14c)],{'method':_0x14938f(0x14a),'headers':{'Content-Type':_0x14938f(0x11c),'Accept':'application/json','User-Agent':_0x14938f(0x133)},'body':JSON[_0x14938f(0x112)](_0x4db615)}),_0x5bd05a=Date[_0x14938f(0x135)]()-_0x31dddd;console['log'](_0x14938f(0x12a)),console['log'](_0x14938f(0x143),_0x2146e6[_0x14938f(0x169)]),console['log']('Status\x20Text:',_0x2146e6[_0x14938f(0x102)]),console[_0x14938f(0x10b)](_0x14938f(0x146),Object[_0x14938f(0x177)](_0x2146e6[_0x14938f(0x109)][_0x14938f(0x10a)]())),console[_0x14938f(0x10b)](_0x14938f(0x12f),_0x5bd05a+'ms');const _0x3a1d70=await _0x2146e6[_0x14938f(0x128)]();console[_0x14938f(0x10b)]('Raw\x20Response\x20Body:',_0x3a1d70);if(!_0x2146e6['ok']){console[_0x14938f(0x107)](_0x14938f(0x125)),console[_0x14938f(0x107)](_0x14938f(0x10e),_0x2146e6[_0x14938f(0x169)]),console['error'](_0x14938f(0x147),_0x3a1d70),loggerService_1[_0x14938f(0x17f)]['logWhiteDomainResponse'](_0x14938f(0x114),_0x14938f(0x13d),_0x2146e6[_0x14938f(0x169)],_0x3a1d70,_0x5bd05a),loggerService_1[_0x14938f(0x17f)][_0x14938f(0x12e)](_0x14938f(0x114),_0x14938f(0x13d),'HTTP\x20'+_0x2146e6['status']+':\x20'+_0x3a1d70);throw new Error(_0x14938f(0x14d)+_0x2146e6[_0x14938f(0x169)]+_0x14938f(0x120)+_0x3a1d70);}let _0x12e391;try{_0x12e391=JSON[_0x14938f(0x162)](_0x3a1d70);}catch(_0x42a9eb){console[_0x14938f(0x107)](_0x14938f(0x12c),_0x42a9eb),loggerService_1['loggerService'][_0x14938f(0x12e)]('cointopay','/create','JSON\x20Parse\x20Error:\x20'+_0x42a9eb);throw new Error(_0x14938f(0x176)+_0x3a1d70);}console['log'](_0x14938f(0x103)),console[_0x14938f(0x10b)](_0x14938f(0x12d),JSON[_0x14938f(0x112)](_0x12e391,null,0x2)),loggerService_1[_0x14938f(0x17f)][_0x14938f(0x15b)](_0x14938f(0x114),'/create',_0x2146e6[_0x14938f(0x169)],_0x12e391,_0x5bd05a);if(_0x12e391[_0x14938f(0x107)]){const _0x39f005=_0x12e391[_0x14938f(0x12b)]||_0x12e391[_0x14938f(0x107)]||_0x14938f(0x140);console[_0x14938f(0x107)](_0x14938f(0x178)),console[_0x14938f(0x107)](_0x14938f(0x13e),_0x39f005),loggerService_1[_0x14938f(0x17f)]['logWhiteDomainError'](_0x14938f(0x114),_0x14938f(0x13d),'Business\x20Error:\x20'+_0x39f005);throw new Error(_0x14938f(0x10f)+_0x39f005);}if(!_0x12e391[_0x14938f(0x158)]||!_0x12e391[_0x14938f(0x174)]){console[_0x14938f(0x107)](_0x14938f(0x16a)),console[_0x14938f(0x107)](_0x14938f(0x17c)),console['error']('Response\x20data:',_0x12e391),loggerService_1['loggerService'][_0x14938f(0x12e)]('cointopay',_0x14938f(0x13d),_0x14938f(0x11e));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x14938f(0x10b)](_0x14938f(0x11a)),console[_0x14938f(0x10b)](_0x14938f(0x15a),_0x12e391[_0x14938f(0x174)]),console[_0x14938f(0x10b)](_0x14938f(0x113),_0x12e391[_0x14938f(0x158)]);const _0x524490=_0x12e391[_0x14938f(0x158)]+_0x14938f(0x152);return console['log']('Payment\x20URL\x20(modified):',_0x524490),console[_0x14938f(0x10b)](_0x14938f(0x122),_0x1ff78d,_0x14938f(0x10d)),{'gateway_payment_id':_0x12e391[_0x14938f(0x174)],'payment_url':_0x524490};}catch(_0x3d5e2e){console[_0x14938f(0x107)](_0x14938f(0x186)),console[_0x14938f(0x107)](_0x14938f(0x184),_0x3d5e2e),loggerService_1[_0x14938f(0x17f)][_0x14938f(0x12e)]('cointopay',_0x14938f(0x13d),_0x3d5e2e);if(_0x3d5e2e instanceof Error){console['error']('Error\x20message:',_0x3d5e2e[_0x14938f(0x12b)]),console[_0x14938f(0x107)](_0x14938f(0x149),_0x3d5e2e[_0x14938f(0x106)]);throw new Error(_0x14938f(0x179)+_0x3d5e2e[_0x14938f(0x12b)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x38ef89){const _0x38cdda=a49_0x5a97db,_0x15ad38=Date[_0x38cdda(0x135)]();try{console[_0x38cdda(0x10b)](_0x38cdda(0x139)+_0x38ef89);const _0x1cbc13={'gatewayPaymentId':_0x38ef89};loggerService_1[_0x38cdda(0x17f)]['logWhiteDomainRequest'](_0x38cdda(0x114),_0x38cdda(0x115),'POST',_0x1cbc13);const _0x31853f=await fetch(this['statusUrl'],{'method':_0x38cdda(0x14a),'headers':{'Content-Type':_0x38cdda(0x11c),'Accept':_0x38cdda(0x11c),'User-Agent':_0x38cdda(0x133)},'body':JSON['stringify'](_0x1cbc13)}),_0x445239=Date['now']()-_0x15ad38;console[_0x38cdda(0x10b)](_0x38cdda(0x182)),console[_0x38cdda(0x10b)](_0x38cdda(0x143),_0x31853f[_0x38cdda(0x169)]),console[_0x38cdda(0x10b)](_0x38cdda(0x12f),_0x445239+'ms');if(!_0x31853f['ok']){const _0x5f434b=await _0x31853f['text']();console[_0x38cdda(0x107)](_0x38cdda(0x10e),_0x31853f[_0x38cdda(0x169)]),console[_0x38cdda(0x107)](_0x38cdda(0x147),_0x5f434b),loggerService_1[_0x38cdda(0x17f)][_0x38cdda(0x15b)](_0x38cdda(0x114),_0x38cdda(0x115),_0x31853f[_0x38cdda(0x169)],_0x5f434b,_0x445239),loggerService_1[_0x38cdda(0x17f)][_0x38cdda(0x12e)]('cointopay',_0x38cdda(0x115),'HTTP\x20'+_0x31853f[_0x38cdda(0x169)]+':\x20'+_0x5f434b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x31853f[_0x38cdda(0x169)]);}const _0x23c8d0=await _0x31853f[_0x38cdda(0x128)]();console['log'](_0x38cdda(0x121),_0x23c8d0);let _0x44d626;try{_0x44d626=JSON[_0x38cdda(0x162)](_0x23c8d0);}catch(_0xaa5090){console[_0x38cdda(0x107)](_0x38cdda(0x12c),_0xaa5090),loggerService_1[_0x38cdda(0x17f)][_0x38cdda(0x12e)]('cointopay',_0x38cdda(0x115),_0x38cdda(0x104)+_0xaa5090);throw new Error(_0x38cdda(0x123)+_0x23c8d0);}loggerService_1['loggerService'][_0x38cdda(0x15b)](_0x38cdda(0x114),_0x38cdda(0x115),_0x31853f['status'],_0x44d626,_0x445239),console[_0x38cdda(0x10b)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x38cdda(0x10b)](_0x38cdda(0x130),_0x44d626[_0x38cdda(0x136)]),console[_0x38cdda(0x10b)](_0x38cdda(0x172),_0x44d626['status_code']),console[_0x38cdda(0x10b)]('Payment\x20Status:',_0x44d626[_0x38cdda(0x16e)]?.[_0x38cdda(0x185)]),console[_0x38cdda(0x10b)]('Amount:',_0x44d626[_0x38cdda(0x16e)]?.[_0x38cdda(0x160)]),console[_0x38cdda(0x10b)](_0x38cdda(0x156),_0x44d626[_0x38cdda(0x16e)]?.[_0x38cdda(0x165)]);if(_0x44d626[_0x38cdda(0x136)]!==_0x38cdda(0x150)||_0x44d626[_0x38cdda(0x168)]!==0xc8){const _0x1532f3=_0x44d626['message']||_0x38cdda(0x16b);console[_0x38cdda(0x107)](_0x38cdda(0x13a)),console['error']('Error\x20Message:',_0x1532f3),loggerService_1[_0x38cdda(0x17f)]['logWhiteDomainError'](_0x38cdda(0x114),_0x38cdda(0x115),'Status\x20API\x20Error:\x20'+_0x1532f3);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1532f3);}if(!_0x44d626['data']){console[_0x38cdda(0x107)](_0x38cdda(0x155)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x38cdda(0x17f)][_0x38cdda(0x12e)](_0x38cdda(0x114),_0x38cdda(0x115),_0x38cdda(0x129));throw new Error(_0x38cdda(0x167));}let _0x15fb65=_0x38cdda(0x11f);switch(_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x185)]?.[_0x38cdda(0x17d)]()){case _0x38cdda(0x142):_0x15fb65=_0x38cdda(0x157);break;case'cancelled':case _0x38cdda(0x17b):case _0x38cdda(0x107):_0x15fb65=_0x38cdda(0x13f);break;case _0x38cdda(0x15d):case _0x38cdda(0x17a):_0x15fb65=_0x38cdda(0x154);break;case _0x38cdda(0x166):case'awaiting\x20fiat':case _0x38cdda(0x16f):case _0x38cdda(0x118):default:_0x15fb65='PENDING';break;}let _0x31387e,_0x57adcd;if(_0x44d626[_0x38cdda(0x16e)]['PaymentDetail']){const _0x1cb800=_0x44d626['data'][_0x38cdda(0x173)];console['log'](_0x38cdda(0x119),_0x1cb800);const _0x473077=_0x1cb800[_0x38cdda(0x175)](/IBAN\s+([A-Z0-9]+)/i);_0x473077&&(_0x31387e=_0x473077[0x1],console[_0x38cdda(0x10b)](_0x38cdda(0x161),_0x31387e)),_0x57adcd=_0x1cb800;}const _0x569cf0={'iban':_0x31387e,'bankDetails':_0x57adcd,'transactionId':_0x44d626[_0x38cdda(0x16e)]['TransactionID'],'coinAddress':_0x44d626['data'][_0x38cdda(0x116)],'qrCodeUrl':_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x127)],'expiryTime':_0x44d626['data'][_0x38cdda(0x13b)],'createdOn':_0x44d626['data'][_0x38cdda(0x108)],'confirmedOn':_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x16c)]};console[_0x38cdda(0x10b)](_0x38cdda(0x16d)),console[_0x38cdda(0x10b)]('Status:',_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x185)],'->',_0x15fb65),console['log'](_0x38cdda(0x122),_0x44d626[_0x38cdda(0x16e)]['Amount'],_0x44d626['data'][_0x38cdda(0x165)]),console[_0x38cdda(0x10b)]('Transaction\x20ID:',_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x171)]),console[_0x38cdda(0x10b)]('IBAN:',_0x31387e||_0x38cdda(0x163)),console['log']('Created\x20On:',_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x108)]),console[_0x38cdda(0x10b)](_0x38cdda(0x126),_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x16c)]||_0x38cdda(0x14e));if(_0x44d626[_0x38cdda(0x16e)][_0x38cdda(0x185)]?.['toLowerCase']()===_0x38cdda(0x145))console['log'](_0x38cdda(0x15c));else _0x44d626['data'][_0x38cdda(0x185)]?.['toLowerCase']()===_0x38cdda(0x142)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x15fb65,'amount':parseFloat(_0x44d626['data']['Amount'])||undefined,'currency':_0x44d626[_0x38cdda(0x16e)]['inputCurrency']||'EUR','paymentDetails':_0x569cf0};}catch(_0xfbc841){console[_0x38cdda(0x107)](_0x38cdda(0x159),_0xfbc841),loggerService_1[_0x38cdda(0x17f)][_0x38cdda(0x12e)](_0x38cdda(0x114),_0x38cdda(0x115),_0xfbc841);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0xfbc841 instanceof Error?_0xfbc841[_0x38cdda(0x12b)]:'Unknown\x20error'));}}async[a49_0x5a97db(0x134)](_0x9db847){const _0x3b66fb=a49_0x5a97db,_0xc5dc16=await this[_0x3b66fb(0x10c)](_0x9db847);return{'status':_0xc5dc16[_0x3b66fb(0x169)],'amount':_0xc5dc16[_0x3b66fb(0x101)],'currency':_0xc5dc16[_0x3b66fb(0x124)]};}async[a49_0x5a97db(0x148)](_0x236646){const _0x47e318=a49_0x5a97db;console[_0x47e318(0x10b)](_0x47e318(0x141),_0x236646);let _0x55840e=_0x47e318(0x11f);switch(_0x236646[_0x47e318(0x169)]?.[_0x47e318(0x17d)]()){case _0x47e318(0x142):_0x55840e='PAID';break;case'cancelled':case _0x47e318(0x17b):case _0x47e318(0x107):_0x55840e='FAILED';break;case _0x47e318(0x15d):case _0x47e318(0x17a):_0x55840e='EXPIRED';break;case'pending':case _0x47e318(0x166):case _0x47e318(0x145):case _0x47e318(0x118):default:_0x55840e=_0x47e318(0x11f);break;}return{'paymentId':_0x236646[_0x47e318(0x11d)]||_0x236646[_0x47e318(0x131)]||'','status':_0x55840e,'amount':_0x236646[_0x47e318(0x101)],'currency':_0x236646[_0x47e318(0x124)]||'EUR'};}}exports[a49_0x5a97db(0x181)]=CoinToPayService;