'use strict';const a46_0x35267d=a46_0x2765;function a46_0x123e(){const _0x1164c1=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','stringify','Error\x20Message:','Status\x20Text:','parse','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','result','headers','Incomplete\x20response:\x20missing\x20data','20544768AktNMG','JSON\x20Parse\x20Error:\x20','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20ERROR\x20===','3741680erohwo','Failed\x20to\x20parse\x20JSON\x20response:','Transaction\x20ID:','1651912EIbOYx','gateway_payment_id','Headers:','1262247LRdYXx','not\x20found','Error\x20message:','Response\x20Time:','TransactionConfirmedOn','currency','verifyPayment','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/cointopay/','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','cointopay','entries','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','pending','defineProperty','data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Result:','waiting','/create','TransactionID','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','awaiting\x20fiat','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','application/json','Currency:','Error\x20stack:','inputCurrency','match','paid','success','HTTP\x20error!\x20status:\x20','stack','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','merchant_reference_id','Missing\x20data\x20in\x20response','CoinToPay\x20API\x20error:\x20','PENDING','payment_url','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','FAILED','ExpiryTime','===\x20COINTOPAY\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','now','apiUrl','HTTP\x20Status:','error','coinAddress','PaymentDetail','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainResponse','timeout','fromEntries','cancelled','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','3835592NPaTAF','checkPaymentStatus','status_code','14pSxdBQ','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','EUR','914321MINrde','2643048vaNPoR',',\x20body:\x20','Unknown\x20error','CoinToPayService','Gateway\x20Payment\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','Amount:','Status','Created\x20On:','Status\x20API\x20Error:\x20','PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainError','Status:','Payment\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','createPaymentLink','CreatedOn','status','text','Request\x20Body:','amount','not\x20confirmed','logWhiteDomainRequest','2dzvcIV','HTTP\x20','processWebhook','POST','__esModule','log','üìä\x20Status\x20check\x20URL:','TesSoft\x20Payment\x20System/1.0','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Error\x20details:','Amount','loggerService','created','statusUrl','Parsed\x20Result:','message','https://tesoft.uk/gateway/cointopay/status.php','failed','order_id','expired','toLowerCase','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Business\x20Error:\x20','/status','Response\x20data:'];a46_0x123e=function(){return _0x1164c1;};return a46_0x123e();}(function(_0xc0381d,_0x544195){const _0x530683=a46_0x2765,_0x40c4d3=_0xc0381d();while(!![]){try{const _0x177c14=-parseInt(_0x530683(0x1a6))/0x1*(-parseInt(_0x530683(0x1c0))/0x2)+parseInt(_0x530683(0x163))/0x3+parseInt(_0x530683(0x160))/0x4+parseInt(_0x530683(0x15d))/0x5+parseInt(_0x530683(0x1a7))/0x6*(parseInt(_0x530683(0x1a3))/0x7)+-parseInt(_0x530683(0x1a0))/0x8+-parseInt(_0x530683(0x159))/0x9;if(_0x177c14===_0x544195)break;else _0x40c4d3['push'](_0x40c4d3['shift']());}catch(_0x1bdc81){_0x40c4d3['push'](_0x40c4d3['shift']());}}}(a46_0x123e,0x9631f));Object[a46_0x35267d(0x172)](exports,a46_0x35267d(0x1c4),{'value':!![]}),exports[a46_0x35267d(0x1aa)]=void 0x0;const loggerService_1=require('../loggerService');function a46_0x2765(_0x1ed381,_0x2694f3){const _0x123e9f=a46_0x123e();return a46_0x2765=function(_0x27652a,_0x598897){_0x27652a=_0x27652a-0x150;let _0x1c1049=_0x123e9f[_0x27652a];return _0x1c1049;},a46_0x2765(_0x1ed381,_0x2694f3);}class CoinToPayService{constructor(){const _0x3e6972=a46_0x35267d;this[_0x3e6972(0x193)]=_0x3e6972(0x16b),this[_0x3e6972(0x1cd)]=_0x3e6972(0x1d0),console[_0x3e6972(0x1c5)](_0x3e6972(0x185)),console['log'](_0x3e6972(0x1c6),this[_0x3e6972(0x1cd)]);}async[a46_0x35267d(0x1b8)](_0xefff68){const _0x14897e=a46_0x35267d,{orderId:_0x543e15,amount:_0x14e7f6}=_0xefff68;console[_0x14897e(0x1c5)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x14e7f6+'\x20EUR');const _0x2ea782={'amount':_0x14e7f6},_0x1803f9=Date['now']();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x14897e(0x1c5)]('URL:',this[_0x14897e(0x193)]),console[_0x14897e(0x1c5)](_0x14897e(0x1bc),JSON['stringify'](_0x2ea782,null,0x2)),console[_0x14897e(0x1c5)](_0x14897e(0x1ae),_0x14e7f6,_0x14897e(0x1a4)),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x1bf)](_0x14897e(0x16d),_0x14897e(0x177),_0x14897e(0x1c3),_0x2ea782);const _0x1b964c=await fetch(this['apiUrl'],{'method':_0x14897e(0x1c3),'headers':{'Content-Type':_0x14897e(0x17c),'Accept':_0x14897e(0x17c),'User-Agent':_0x14897e(0x1c7)},'body':JSON[_0x14897e(0x151)](_0x2ea782)}),_0x53c09e=Date[_0x14897e(0x192)]()-_0x1803f9;console[_0x14897e(0x1c5)](_0x14897e(0x19a)),console[_0x14897e(0x1c5)]('Status:',_0x1b964c[_0x14897e(0x1ba)]),console['log'](_0x14897e(0x153),_0x1b964c['statusText']),console[_0x14897e(0x1c5)](_0x14897e(0x162),Object[_0x14897e(0x19d)](_0x1b964c[_0x14897e(0x157)][_0x14897e(0x16e)]())),console[_0x14897e(0x1c5)](_0x14897e(0x166),_0x53c09e+'ms');const _0x1ed72d=await _0x1b964c[_0x14897e(0x1bb)]();console[_0x14897e(0x1c5)](_0x14897e(0x16a),_0x1ed72d);if(!_0x1b964c['ok']){console[_0x14897e(0x195)](_0x14897e(0x15c)),console[_0x14897e(0x195)](_0x14897e(0x194),_0x1b964c['status']),console[_0x14897e(0x195)]('Response\x20Body:',_0x1ed72d),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x19b)](_0x14897e(0x16d),_0x14897e(0x177),_0x1b964c[_0x14897e(0x1ba)],_0x1ed72d,_0x53c09e),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x1b4)]('cointopay',_0x14897e(0x177),'HTTP\x20'+_0x1b964c[_0x14897e(0x1ba)]+':\x20'+_0x1ed72d);throw new Error(_0x14897e(0x183)+_0x1b964c['status']+_0x14897e(0x1a8)+_0x1ed72d);}let _0xa9c42e;try{_0xa9c42e=JSON['parse'](_0x1ed72d);}catch(_0x3ff418){console[_0x14897e(0x195)](_0x14897e(0x15e),_0x3ff418),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x1b4)](_0x14897e(0x16d),_0x14897e(0x177),_0x14897e(0x15a)+_0x3ff418);throw new Error(_0x14897e(0x150)+_0x1ed72d);}console[_0x14897e(0x1c5)](_0x14897e(0x199)),console[_0x14897e(0x1c5)](_0x14897e(0x1ce),JSON[_0x14897e(0x151)](_0xa9c42e,null,0x2)),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x19b)](_0x14897e(0x16d),_0x14897e(0x177),_0x1b964c[_0x14897e(0x1ba)],_0xa9c42e,_0x53c09e);if(_0xa9c42e['error']){const _0x52bc91=_0xa9c42e[_0x14897e(0x1cf)]||_0xa9c42e[_0x14897e(0x195)]||_0x14897e(0x1ad);console[_0x14897e(0x195)](_0x14897e(0x18d)),console[_0x14897e(0x195)](_0x14897e(0x152),_0x52bc91),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x1b4)]('cointopay',_0x14897e(0x177),_0x14897e(0x1d6)+_0x52bc91);throw new Error(_0x14897e(0x188)+_0x52bc91);}if(!_0xa9c42e['payment_url']||!_0xa9c42e['gateway_payment_id']){console[_0x14897e(0x195)](_0x14897e(0x16f)),console[_0x14897e(0x195)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x14897e(0x195)](_0x14897e(0x1d8),_0xa9c42e),loggerService_1[_0x14897e(0x1cb)][_0x14897e(0x1b4)](_0x14897e(0x16d),_0x14897e(0x177),_0x14897e(0x18b));throw new Error(_0x14897e(0x174));}return console['log'](_0x14897e(0x190)),console[_0x14897e(0x1c5)](_0x14897e(0x1ab),_0xa9c42e[_0x14897e(0x161)]),console['log']('Payment\x20URL:',_0xa9c42e[_0x14897e(0x18a)]),console[_0x14897e(0x1c5)](_0x14897e(0x1ae),_0x14e7f6,_0x14897e(0x1a5)),{'gateway_payment_id':_0xa9c42e['gateway_payment_id'],'payment_url':_0xa9c42e[_0x14897e(0x18a)]};}catch(_0x160f7a){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0x14897e(0x1c9),_0x160f7a),loggerService_1[_0x14897e(0x1cb)]['logWhiteDomainError']('cointopay',_0x14897e(0x177),_0x160f7a);if(_0x160f7a instanceof Error){console[_0x14897e(0x195)](_0x14897e(0x165),_0x160f7a['message']),console[_0x14897e(0x195)](_0x14897e(0x17e),_0x160f7a[_0x14897e(0x184)]);throw new Error(_0x14897e(0x1b3)+_0x160f7a[_0x14897e(0x1cf)]);}throw new Error(_0x14897e(0x191));}}async[a46_0x35267d(0x1a1)](_0x5741fd){const _0x3fb3f8=a46_0x35267d,_0x57500c=Date[_0x3fb3f8(0x192)]();try{console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x18c)+_0x5741fd);const _0x264479={'gatewayPaymentId':_0x5741fd};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay','/status',_0x3fb3f8(0x1c3),_0x264479);const _0xbdadb4=await fetch(this[_0x3fb3f8(0x1cd)],{'method':_0x3fb3f8(0x1c3),'headers':{'Content-Type':_0x3fb3f8(0x17c),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x264479)}),_0xeeda4b=Date[_0x3fb3f8(0x192)]()-_0x57500c;console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x19f)),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1b5),_0xbdadb4[_0x3fb3f8(0x1ba)]),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x166),_0xeeda4b+'ms');if(!_0xbdadb4['ok']){const _0x53e232=await _0xbdadb4[_0x3fb3f8(0x1bb)]();console[_0x3fb3f8(0x195)](_0x3fb3f8(0x194),_0xbdadb4[_0x3fb3f8(0x1ba)]),console['error']('Response\x20Body:',_0x53e232),loggerService_1['loggerService'][_0x3fb3f8(0x19b)]('cointopay','/status',_0xbdadb4[_0x3fb3f8(0x1ba)],_0x53e232,_0xeeda4b),loggerService_1['loggerService'][_0x3fb3f8(0x1b4)](_0x3fb3f8(0x16d),_0x3fb3f8(0x1d7),_0x3fb3f8(0x1c1)+_0xbdadb4[_0x3fb3f8(0x1ba)]+':\x20'+_0x53e232);throw new Error(_0x3fb3f8(0x183)+_0xbdadb4[_0x3fb3f8(0x1ba)]);}const _0x121ea6=await _0xbdadb4[_0x3fb3f8(0x1bb)]();console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x16a),_0x121ea6);let _0x1d22d8;try{_0x1d22d8=JSON[_0x3fb3f8(0x154)](_0x121ea6);}catch(_0x5502df){console[_0x3fb3f8(0x195)](_0x3fb3f8(0x15e),_0x5502df),loggerService_1[_0x3fb3f8(0x1cb)]['logWhiteDomainError']('cointopay',_0x3fb3f8(0x1d7),'JSON\x20Parse\x20Error:\x20'+_0x5502df);throw new Error(_0x3fb3f8(0x1ac)+_0x121ea6);}loggerService_1[_0x3fb3f8(0x1cb)][_0x3fb3f8(0x19b)](_0x3fb3f8(0x16d),_0x3fb3f8(0x1d7),_0xbdadb4[_0x3fb3f8(0x1ba)],_0x1d22d8,_0xeeda4b),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x155)),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x175),_0x1d22d8[_0x3fb3f8(0x156)]),console[_0x3fb3f8(0x1c5)]('Status\x20Code:',_0x1d22d8[_0x3fb3f8(0x1a2)]),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1b6),_0x1d22d8[_0x3fb3f8(0x173)]?.[_0x3fb3f8(0x1af)]),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1ae),_0x1d22d8[_0x3fb3f8(0x173)]?.[_0x3fb3f8(0x1ca)]),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x17d),_0x1d22d8[_0x3fb3f8(0x173)]?.[_0x3fb3f8(0x17f)]);if(_0x1d22d8['result']!==_0x3fb3f8(0x182)||_0x1d22d8[_0x3fb3f8(0x1a2)]!==0xc8){const _0xaa7414=_0x1d22d8['message']||_0x3fb3f8(0x17b);console[_0x3fb3f8(0x195)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x3fb3f8(0x195)](_0x3fb3f8(0x152),_0xaa7414),loggerService_1[_0x3fb3f8(0x1cb)][_0x3fb3f8(0x1b4)](_0x3fb3f8(0x16d),_0x3fb3f8(0x1d7),_0x3fb3f8(0x1b1)+_0xaa7414);throw new Error(_0x3fb3f8(0x1b7)+_0xaa7414);}if(!_0x1d22d8[_0x3fb3f8(0x173)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x3fb3f8(0x187)),loggerService_1[_0x3fb3f8(0x1cb)][_0x3fb3f8(0x1b4)](_0x3fb3f8(0x16d),_0x3fb3f8(0x1d7),_0x3fb3f8(0x158));throw new Error(_0x3fb3f8(0x170));}let _0x187e26=_0x3fb3f8(0x189);switch(_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1af)]?.[_0x3fb3f8(0x1d4)]()){case'paid':_0x187e26=_0x3fb3f8(0x1b2);break;case _0x3fb3f8(0x19e):case'failed':case _0x3fb3f8(0x195):_0x187e26=_0x3fb3f8(0x18e);break;case'expired':case _0x3fb3f8(0x19c):_0x187e26='EXPIRED';break;case _0x3fb3f8(0x176):case'awaiting\x20fiat':case _0x3fb3f8(0x171):case _0x3fb3f8(0x1cc):default:_0x187e26=_0x3fb3f8(0x189);break;}let _0x17262c,_0x483ad2;if(_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x197)]){const _0x46749a=_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x197)];console[_0x3fb3f8(0x1c5)]('üè¶\x20Payment\x20Detail:',_0x46749a);const _0x4089c4=_0x46749a[_0x3fb3f8(0x180)](/IBAN\s+([A-Z0-9]+)/i);_0x4089c4&&(_0x17262c=_0x4089c4[0x1],console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x15b),_0x17262c)),_0x483ad2=_0x46749a;}const _0x154f6a={'iban':_0x17262c,'bankDetails':_0x483ad2,'transactionId':_0x1d22d8[_0x3fb3f8(0x173)]['TransactionID'],'coinAddress':_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x196)],'qrCodeUrl':_0x1d22d8['data']['QRCodeURL'],'expiryTime':_0x1d22d8['data'][_0x3fb3f8(0x18f)],'createdOn':_0x1d22d8['data']['CreatedOn'],'confirmedOn':_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x167)]};console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x179)),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1b5),_0x1d22d8[_0x3fb3f8(0x173)]['Status'],'->',_0x187e26),console['log'](_0x3fb3f8(0x1ae),_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1ca)],_0x1d22d8[_0x3fb3f8(0x173)]['inputCurrency']),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x15f),_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x178)]),console[_0x3fb3f8(0x1c5)]('IBAN:',_0x17262c||_0x3fb3f8(0x164)),console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1b0),_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1b9)]),console[_0x3fb3f8(0x1c5)]('Confirmed\x20On:',_0x1d22d8['data'][_0x3fb3f8(0x167)]||_0x3fb3f8(0x1be));if(_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1af)]?.[_0x3fb3f8(0x1d4)]()===_0x3fb3f8(0x17a))console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x1c8));else _0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1af)]?.['toLowerCase']()===_0x3fb3f8(0x181)&&console[_0x3fb3f8(0x1c5)](_0x3fb3f8(0x16c));return{'status':_0x187e26,'amount':parseFloat(_0x1d22d8[_0x3fb3f8(0x173)][_0x3fb3f8(0x1ca)])||undefined,'currency':_0x1d22d8['data']['inputCurrency']||_0x3fb3f8(0x1a5),'paymentDetails':_0x154f6a};}catch(_0x38c50f){console['error'](_0x3fb3f8(0x198),_0x38c50f),loggerService_1[_0x3fb3f8(0x1cb)]['logWhiteDomainError'](_0x3fb3f8(0x16d),_0x3fb3f8(0x1d7),_0x38c50f);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x38c50f instanceof Error?_0x38c50f[_0x3fb3f8(0x1cf)]:_0x3fb3f8(0x1a9)));}}async[a46_0x35267d(0x169)](_0x123251){const _0x3c8aa2=a46_0x35267d,_0x15d650=await this[_0x3c8aa2(0x1a1)](_0x123251);return{'status':_0x15d650[_0x3c8aa2(0x1ba)],'amount':_0x15d650[_0x3c8aa2(0x1bd)],'currency':_0x15d650[_0x3c8aa2(0x168)]};}async[a46_0x35267d(0x1c2)](_0x125639){const _0x5480d9=a46_0x35267d;console['log'](_0x5480d9(0x1d5),_0x125639);let _0x1d2302='PENDING';switch(_0x125639[_0x5480d9(0x1ba)]?.[_0x5480d9(0x1d4)]()){case _0x5480d9(0x181):_0x1d2302=_0x5480d9(0x1b2);break;case'cancelled':case _0x5480d9(0x1d1):case'error':_0x1d2302='FAILED';break;case _0x5480d9(0x1d3):case _0x5480d9(0x19c):_0x1d2302='EXPIRED';break;case _0x5480d9(0x171):case _0x5480d9(0x176):case'awaiting\x20fiat':case _0x5480d9(0x1cc):default:_0x1d2302=_0x5480d9(0x189);break;}return{'paymentId':_0x125639[_0x5480d9(0x1d2)]||_0x125639[_0x5480d9(0x186)]||'','status':_0x1d2302,'amount':_0x125639[_0x5480d9(0x1bd)],'currency':_0x125639[_0x5480d9(0x168)]||_0x5480d9(0x1a5)};}}exports['CoinToPayService']=CoinToPayService;