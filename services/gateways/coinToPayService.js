'use strict';const a43_0x894ca2=a43_0x4bdb;(function(_0x39b2e2,_0x3dce0e){const _0x114a77=a43_0x4bdb,_0x32bcb5=_0x39b2e2();while(!![]){try{const _0x58d04d=-parseInt(_0x114a77(0x1e9))/0x1+parseInt(_0x114a77(0x1f8))/0x2*(parseInt(_0x114a77(0x1c9))/0x3)+-parseInt(_0x114a77(0x189))/0x4+-parseInt(_0x114a77(0x1c5))/0x5+parseInt(_0x114a77(0x1a5))/0x6+-parseInt(_0x114a77(0x1a9))/0x7*(-parseInt(_0x114a77(0x1ab))/0x8)+parseInt(_0x114a77(0x1d6))/0x9;if(_0x58d04d===_0x3dce0e)break;else _0x32bcb5['push'](_0x32bcb5['shift']());}catch(_0xda6679){_0x32bcb5['push'](_0x32bcb5['shift']());}}}(a43_0x4530,0x9347e));function a43_0x4530(){const _0x596106=['ExpiryTime','toLowerCase','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20error!\x20status:\x20','text','failed','CreatedOn','TesSoft\x20Payment\x20System/1.0','Raw\x20Response\x20Body:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','557016qvuiyr','stack','Response\x20data:','Confirmed\x20On:','938gPIFcV','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','25752EoDqYt','POST','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','not\x20found','QRCodeURL','EUR','CoinToPay\x20API\x20error:\x20','Created\x20On:','pending','Result:','===\x20COINTOPAY\x20SUCCESS\x20===','HTTP\x20Status:','PAID','JSON\x20Parse\x20Error:\x20','success','logWhiteDomainResponse','not\x20confirmed','createPaymentLink','Transaction\x20ID:','timeout','Status\x20Code:','log','CoinToPay\x20status\x20API\x20error:\x20','IBAN:','Error\x20message:','Amount','1207400ywYHwR','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','gateway_payment_id','status','83385jAYJLo','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','URL:','TransactionID','Amount:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Request\x20Body:','üìä\x20Status\x20check\x20URL:','processWebhook','entries','logWhiteDomainRequest','payment_url','Business\x20Error:\x20','13747086ClizAe','defineProperty','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','cancelled','error','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','data','üè¶\x20Extracted\x20IBAN:','created','../loggerService','apiUrl','checkPaymentStatus','now','waiting','application/json',',\x20body:\x20','761791hYcWji','Headers:','Unknown\x20error','HTTP\x20','awaiting\x20fiat','/create','Status:','Status','Gateway\x20Payment\x20ID:','status_code','Status\x20API\x20Error:\x20','message','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','loggerService','Error\x20stack:','8wsAJnt','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Error\x20details:','/status','Missing\x20data\x20in\x20response','currency','stringify','Status\x20Text:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','PaymentDetail','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','merchant_reference_id','cointopay','Incomplete\x20response:\x20missing\x20data','verifyPayment','parse','inputCurrency','fromEntries','coinAddress','CoinToPayService','CoinToPay\x20payment\x20status\x20check\x20error:','2225132vSVvhj','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusUrl','Response\x20Time:','TransactionConfirmedOn','expired','Payment\x20Status:','Response\x20Body:','logWhiteDomainError','===\x20COINTOPAY\x20API\x20ERROR\x20===','paid','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','PENDING','üè¶\x20Payment\x20Detail:','Error\x20Message:','Payment\x20URL:'];a43_0x4530=function(){return _0x596106;};return a43_0x4530();}Object[a43_0x894ca2(0x1d7)](exports,'__esModule',{'value':!![]}),exports[a43_0x894ca2(0x187)]=void 0x0;const loggerService_1=require(a43_0x894ca2(0x1e2));function a43_0x4bdb(_0x5225ec,_0x37e6f4){const _0x453023=a43_0x4530();return a43_0x4bdb=function(_0x4bdb78,_0x3e280f){_0x4bdb78=_0x4bdb78-0x182;let _0x211fbd=_0x453023[_0x4bdb78];return _0x211fbd;},a43_0x4bdb(_0x5225ec,_0x37e6f4);}class CoinToPayService{constructor(){const _0x3cd787=a43_0x894ca2;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x3cd787(0x18b)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3cd787(0x1c0)](_0x3cd787(0x1ad)),console[_0x3cd787(0x1c0)](_0x3cd787(0x1d0),this[_0x3cd787(0x18b)]);}async[a43_0x894ca2(0x1bc)](_0x46257e){const _0x1567e4=a43_0x894ca2,{orderId:_0x56460b,amount:_0x21ac47}=_0x46257e;console[_0x1567e4(0x1c0)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x21ac47+'\x20EUR');const _0x4cac01={'amount':_0x21ac47},_0x5c1c77=Date[_0x1567e4(0x1e5)]();try{console[_0x1567e4(0x1c0)](_0x1567e4(0x1ca)),console[_0x1567e4(0x1c0)](_0x1567e4(0x1cb),this[_0x1567e4(0x1e3)]),console[_0x1567e4(0x1c0)](_0x1567e4(0x1cf),JSON[_0x1567e4(0x1ff)](_0x4cac01,null,0x2)),console[_0x1567e4(0x1c0)](_0x1567e4(0x1cd),_0x21ac47,_0x1567e4(0x1d8)),loggerService_1[_0x1567e4(0x1f6)][_0x1567e4(0x1d3)](_0x1567e4(0x208),_0x1567e4(0x1ee),'POST',_0x4cac01);const _0x3e717f=await fetch(this[_0x1567e4(0x1e3)],{'method':_0x1567e4(0x1ac),'headers':{'Content-Type':_0x1567e4(0x1e7),'Accept':_0x1567e4(0x1e7),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x4cac01)}),_0x57517d=Date[_0x1567e4(0x1e5)]()-_0x5c1c77;console[_0x1567e4(0x1c0)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1567e4(0x1c0)]('Status:',_0x3e717f['status']),console[_0x1567e4(0x1c0)](_0x1567e4(0x200),_0x3e717f['statusText']),console[_0x1567e4(0x1c0)](_0x1567e4(0x1ea),Object[_0x1567e4(0x185)](_0x3e717f[_0x1567e4(0x1f9)][_0x1567e4(0x1d2)]())),console[_0x1567e4(0x1c0)](_0x1567e4(0x18c),_0x57517d+'ms');const _0x5a436d=await _0x3e717f[_0x1567e4(0x19e)]();console[_0x1567e4(0x1c0)](_0x1567e4(0x1a2),_0x5a436d);if(!_0x3e717f['ok']){console['error'](_0x1567e4(0x192)),console['error'](_0x1567e4(0x1b6),_0x3e717f[_0x1567e4(0x1c8)]),console[_0x1567e4(0x1db)](_0x1567e4(0x190),_0x5a436d),loggerService_1[_0x1567e4(0x1f6)]['logWhiteDomainResponse'](_0x1567e4(0x208),_0x1567e4(0x1ee),_0x3e717f[_0x1567e4(0x1c8)],_0x5a436d,_0x57517d),loggerService_1['loggerService'][_0x1567e4(0x191)](_0x1567e4(0x208),'/create',_0x1567e4(0x1ec)+_0x3e717f[_0x1567e4(0x1c8)]+':\x20'+_0x5a436d);throw new Error(_0x1567e4(0x19d)+_0x3e717f[_0x1567e4(0x1c8)]+_0x1567e4(0x1e8)+_0x5a436d);}let _0x42bb33;try{_0x42bb33=JSON[_0x1567e4(0x183)](_0x5a436d);}catch(_0x22d0b1){console[_0x1567e4(0x1db)](_0x1567e4(0x1de),_0x22d0b1),loggerService_1['loggerService'][_0x1567e4(0x191)]('cointopay',_0x1567e4(0x1ee),_0x1567e4(0x1b8)+_0x22d0b1);throw new Error(_0x1567e4(0x1fa)+_0x5a436d);}console[_0x1567e4(0x1c0)](_0x1567e4(0x1dd)),console[_0x1567e4(0x1c0)](_0x1567e4(0x202),JSON['stringify'](_0x42bb33,null,0x2)),loggerService_1[_0x1567e4(0x1f6)][_0x1567e4(0x1ba)](_0x1567e4(0x208),_0x1567e4(0x1ee),_0x3e717f['status'],_0x42bb33,_0x57517d);if(_0x42bb33[_0x1567e4(0x1db)]){const _0x4f5a8c=_0x42bb33[_0x1567e4(0x1f4)]||_0x42bb33['error']||_0x1567e4(0x205);console[_0x1567e4(0x1db)](_0x1567e4(0x1ce)),console[_0x1567e4(0x1db)](_0x1567e4(0x197),_0x4f5a8c),loggerService_1[_0x1567e4(0x1f6)][_0x1567e4(0x191)]('cointopay',_0x1567e4(0x1ee),_0x1567e4(0x1d5)+_0x4f5a8c);throw new Error(_0x1567e4(0x1b1)+_0x4f5a8c);}if(!_0x42bb33['payment_url']||!_0x42bb33[_0x1567e4(0x1c7)]){console[_0x1567e4(0x1db)](_0x1567e4(0x201)),console[_0x1567e4(0x1db)](_0x1567e4(0x1c6)),console[_0x1567e4(0x1db)](_0x1567e4(0x1a7),_0x42bb33),loggerService_1[_0x1567e4(0x1f6)][_0x1567e4(0x191)](_0x1567e4(0x208),_0x1567e4(0x1ee),_0x1567e4(0x19c));throw new Error(_0x1567e4(0x19b));}return console[_0x1567e4(0x1c0)](_0x1567e4(0x1b5)),console[_0x1567e4(0x1c0)](_0x1567e4(0x1f1),_0x42bb33[_0x1567e4(0x1c7)]),console['log'](_0x1567e4(0x198),_0x42bb33[_0x1567e4(0x1d4)]),console[_0x1567e4(0x1c0)](_0x1567e4(0x1cd),_0x21ac47,'EUR'),{'gateway_payment_id':_0x42bb33[_0x1567e4(0x1c7)],'payment_url':_0x42bb33[_0x1567e4(0x1d4)]};}catch(_0x1dfbcf){console[_0x1567e4(0x1db)](_0x1567e4(0x204)),console[_0x1567e4(0x1db)](_0x1567e4(0x1fb),_0x1dfbcf),loggerService_1[_0x1567e4(0x1f6)][_0x1567e4(0x191)](_0x1567e4(0x208),_0x1567e4(0x1ee),_0x1dfbcf);if(_0x1dfbcf instanceof Error){console[_0x1567e4(0x1db)](_0x1567e4(0x1c3),_0x1dfbcf[_0x1567e4(0x1f4)]),console['error'](_0x1567e4(0x1f7),_0x1dfbcf[_0x1567e4(0x1a6)]);throw new Error(_0x1567e4(0x1d9)+_0x1dfbcf[_0x1567e4(0x1f4)]);}throw new Error(_0x1567e4(0x1dc));}}async['checkPaymentStatus'](_0x88752b){const _0x219482=a43_0x894ca2,_0xc5c810=Date['now']();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x88752b);const _0x4519db={'gatewayPaymentId':_0x88752b};loggerService_1[_0x219482(0x1f6)]['logWhiteDomainRequest'](_0x219482(0x208),_0x219482(0x1fc),_0x219482(0x1ac),_0x4519db);const _0x9717fe=await fetch(this['statusUrl'],{'method':_0x219482(0x1ac),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x219482(0x1a1)},'body':JSON[_0x219482(0x1ff)](_0x4519db)}),_0x5845e2=Date[_0x219482(0x1e5)]()-_0xc5c810;console[_0x219482(0x1c0)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x219482(0x1ef),_0x9717fe[_0x219482(0x1c8)]),console[_0x219482(0x1c0)](_0x219482(0x18c),_0x5845e2+'ms');if(!_0x9717fe['ok']){const _0x42a39d=await _0x9717fe['text']();console[_0x219482(0x1db)]('HTTP\x20Status:',_0x9717fe['status']),console[_0x219482(0x1db)](_0x219482(0x190),_0x42a39d),loggerService_1[_0x219482(0x1f6)][_0x219482(0x1ba)](_0x219482(0x208),_0x219482(0x1fc),_0x9717fe[_0x219482(0x1c8)],_0x42a39d,_0x5845e2),loggerService_1['loggerService'][_0x219482(0x191)](_0x219482(0x208),'/status',_0x219482(0x1ec)+_0x9717fe[_0x219482(0x1c8)]+':\x20'+_0x42a39d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x9717fe[_0x219482(0x1c8)]);}const _0x79b1a6=await _0x9717fe[_0x219482(0x19e)]();console['log'](_0x219482(0x1a2),_0x79b1a6);let _0x470793;try{_0x470793=JSON[_0x219482(0x183)](_0x79b1a6);}catch(_0x1c7b16){console['error'](_0x219482(0x1de),_0x1c7b16),loggerService_1[_0x219482(0x1f6)][_0x219482(0x191)]('cointopay',_0x219482(0x1fc),'JSON\x20Parse\x20Error:\x20'+_0x1c7b16);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x79b1a6);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x219482(0x208),_0x219482(0x1fc),_0x9717fe[_0x219482(0x1c8)],_0x470793,_0x5845e2),console[_0x219482(0x1c0)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x219482(0x1c0)](_0x219482(0x1b4),_0x470793['result']),console[_0x219482(0x1c0)](_0x219482(0x1bf),_0x470793[_0x219482(0x1f2)]),console[_0x219482(0x1c0)](_0x219482(0x18f),_0x470793[_0x219482(0x1df)]?.[_0x219482(0x1f0)]),console['log'](_0x219482(0x1cd),_0x470793[_0x219482(0x1df)]?.[_0x219482(0x1c4)]),console[_0x219482(0x1c0)]('Currency:',_0x470793[_0x219482(0x1df)]?.[_0x219482(0x184)]);if(_0x470793['result']!==_0x219482(0x1b9)||_0x470793[_0x219482(0x1f2)]!==0xc8){const _0x344902=_0x470793['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x219482(0x1db)](_0x219482(0x194)),console[_0x219482(0x1db)]('Error\x20Message:',_0x344902),loggerService_1['loggerService']['logWhiteDomainError'](_0x219482(0x208),_0x219482(0x1fc),_0x219482(0x1f3)+_0x344902);throw new Error(_0x219482(0x1c1)+_0x344902);}if(!_0x470793['data']){console['error'](_0x219482(0x18a)),console[_0x219482(0x1db)](_0x219482(0x1fd)),loggerService_1[_0x219482(0x1f6)][_0x219482(0x191)](_0x219482(0x208),'/status',_0x219482(0x209));throw new Error(_0x219482(0x1f5));}let _0x565e26=_0x219482(0x195);switch(_0x470793['data']['Status']?.['toLowerCase']()){case _0x219482(0x193):_0x565e26=_0x219482(0x1b7);break;case _0x219482(0x1da):case _0x219482(0x19f):case _0x219482(0x1db):_0x565e26='FAILED';break;case _0x219482(0x18e):case _0x219482(0x1be):_0x565e26='EXPIRED';break;case _0x219482(0x1e6):case _0x219482(0x1ed):case _0x219482(0x1b3):case _0x219482(0x1e1):default:_0x565e26=_0x219482(0x195);break;}let _0x54e9e5,_0xedd287;if(_0x470793[_0x219482(0x1df)][_0x219482(0x203)]){const _0x245ada=_0x470793[_0x219482(0x1df)][_0x219482(0x203)];console[_0x219482(0x1c0)](_0x219482(0x196),_0x245ada);const _0x7fcf5c=_0x245ada[_0x219482(0x1a4)](/IBAN\s+([A-Z0-9]+)/i);_0x7fcf5c&&(_0x54e9e5=_0x7fcf5c[0x1],console[_0x219482(0x1c0)](_0x219482(0x1e0),_0x54e9e5)),_0xedd287=_0x245ada;}const _0x359e44={'iban':_0x54e9e5,'bankDetails':_0xedd287,'transactionId':_0x470793[_0x219482(0x1df)][_0x219482(0x1cc)],'coinAddress':_0x470793[_0x219482(0x1df)][_0x219482(0x186)],'qrCodeUrl':_0x470793[_0x219482(0x1df)][_0x219482(0x1af)],'expiryTime':_0x470793[_0x219482(0x1df)][_0x219482(0x199)],'createdOn':_0x470793[_0x219482(0x1df)]['CreatedOn'],'confirmedOn':_0x470793[_0x219482(0x1df)][_0x219482(0x18d)]};console[_0x219482(0x1c0)](_0x219482(0x1aa)),console['log']('Status:',_0x470793[_0x219482(0x1df)][_0x219482(0x1f0)],'->',_0x565e26),console['log'](_0x219482(0x1cd),_0x470793[_0x219482(0x1df)][_0x219482(0x1c4)],_0x470793[_0x219482(0x1df)][_0x219482(0x184)]),console[_0x219482(0x1c0)](_0x219482(0x1bd),_0x470793['data'][_0x219482(0x1cc)]),console[_0x219482(0x1c0)](_0x219482(0x1c2),_0x54e9e5||_0x219482(0x1ae)),console[_0x219482(0x1c0)](_0x219482(0x1b2),_0x470793[_0x219482(0x1df)][_0x219482(0x1a0)]),console[_0x219482(0x1c0)](_0x219482(0x1a8),_0x470793[_0x219482(0x1df)][_0x219482(0x18d)]||_0x219482(0x1bb));if(_0x470793[_0x219482(0x1df)][_0x219482(0x1f0)]?.[_0x219482(0x19a)]()===_0x219482(0x1ed))console['log'](_0x219482(0x206));else _0x470793[_0x219482(0x1df)]['Status']?.[_0x219482(0x19a)]()===_0x219482(0x193)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x565e26,'amount':parseFloat(_0x470793[_0x219482(0x1df)][_0x219482(0x1c4)])||undefined,'currency':_0x470793[_0x219482(0x1df)][_0x219482(0x184)]||'EUR','paymentDetails':_0x359e44};}catch(_0x4d9d41){console[_0x219482(0x1db)](_0x219482(0x188),_0x4d9d41),loggerService_1[_0x219482(0x1f6)][_0x219482(0x191)](_0x219482(0x208),_0x219482(0x1fc),_0x4d9d41);throw new Error(_0x219482(0x1a3)+(_0x4d9d41 instanceof Error?_0x4d9d41[_0x219482(0x1f4)]:_0x219482(0x1eb)));}}async[a43_0x894ca2(0x182)](_0x578325){const _0x133afe=a43_0x894ca2,_0x1b6817=await this[_0x133afe(0x1e4)](_0x578325);return{'status':_0x1b6817['status'],'amount':_0x1b6817['amount'],'currency':_0x1b6817[_0x133afe(0x1fe)]};}async[a43_0x894ca2(0x1d1)](_0x5df05a){const _0x51c40f=a43_0x894ca2;console[_0x51c40f(0x1c0)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5df05a);let _0x42b396='PENDING';switch(_0x5df05a['status']?.[_0x51c40f(0x19a)]()){case _0x51c40f(0x193):_0x42b396='PAID';break;case _0x51c40f(0x1da):case _0x51c40f(0x19f):case _0x51c40f(0x1db):_0x42b396='FAILED';break;case _0x51c40f(0x18e):case _0x51c40f(0x1be):_0x42b396='EXPIRED';break;case _0x51c40f(0x1b3):case'waiting':case _0x51c40f(0x1ed):case _0x51c40f(0x1e1):default:_0x42b396='PENDING';break;}return{'paymentId':_0x5df05a['order_id']||_0x5df05a[_0x51c40f(0x207)]||'','status':_0x42b396,'amount':_0x5df05a['amount'],'currency':_0x5df05a[_0x51c40f(0x1fe)]||_0x51c40f(0x1b0)};}}exports['CoinToPayService']=CoinToPayService;