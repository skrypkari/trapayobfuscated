'use strict';const a38_0x331908=a38_0x2980;(function(_0x1e6e2b,_0x43d66c){const _0x46bee4=a38_0x2980,_0x493aeb=_0x1e6e2b();while(!![]){try{const _0x242da5=parseInt(_0x46bee4(0x12f))/0x1*(parseInt(_0x46bee4(0x17e))/0x2)+-parseInt(_0x46bee4(0x155))/0x3+-parseInt(_0x46bee4(0x173))/0x4+-parseInt(_0x46bee4(0x135))/0x5+-parseInt(_0x46bee4(0x189))/0x6*(parseInt(_0x46bee4(0x157))/0x7)+parseInt(_0x46bee4(0x19a))/0x8+parseInt(_0x46bee4(0x19f))/0x9*(parseInt(_0x46bee4(0x149))/0xa);if(_0x242da5===_0x43d66c)break;else _0x493aeb['push'](_0x493aeb['shift']());}catch(_0x3cb9c7){_0x493aeb['push'](_0x493aeb['shift']());}}}(a38_0x1743,0xcadcb));Object[a38_0x331908(0x159)](exports,a38_0x331908(0x190),{'value':!![]}),exports[a38_0x331908(0x17b)]=void 0x0;const loggerService_1=require(a38_0x331908(0x14f));function a38_0x2980(_0x9993b8,_0xfe94a6){const _0x174351=a38_0x1743();return a38_0x2980=function(_0x29801a,_0x28a123){_0x29801a=_0x29801a-0x11c;let _0x1fb804=_0x174351[_0x29801a];return _0x1fb804;},a38_0x2980(_0x9993b8,_0xfe94a6);}class CoinToPayService{constructor(){const _0x163663=a38_0x331908;this['apiUrl']=_0x163663(0x141),this[_0x163663(0x125)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x163663(0x178)](_0x163663(0x132)),console[_0x163663(0x178)](_0x163663(0x134),this[_0x163663(0x125)]);}async['createPaymentLink'](_0x1750fa){const _0x552945=a38_0x331908,{orderId:_0x2f4ad7,amount:_0x123b9f}=_0x1750fa;console[_0x552945(0x178)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x123b9f+_0x552945(0x175));const _0x176235={'amount':_0x123b9f},_0xfc6f26=Date[_0x552945(0x158)]();try{console[_0x552945(0x178)](_0x552945(0x179)),console[_0x552945(0x178)]('URL:',this[_0x552945(0x147)]),console['log'](_0x552945(0x18c),JSON[_0x552945(0x142)](_0x176235,null,0x2)),console[_0x552945(0x178)]('Amount:',_0x123b9f,_0x552945(0x12d)),loggerService_1['loggerService'][_0x552945(0x176)]('cointopay',_0x552945(0x1a0),_0x552945(0x199),_0x176235);const _0x10e4e7=await fetch(this[_0x552945(0x147)],{'method':_0x552945(0x199),'headers':{'Content-Type':_0x552945(0x153),'Accept':_0x552945(0x153),'User-Agent':_0x552945(0x15e)},'body':JSON[_0x552945(0x142)](_0x176235)}),_0x50d326=Date[_0x552945(0x158)]()-_0xfc6f26;console[_0x552945(0x178)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x552945(0x178)](_0x552945(0x17a),_0x10e4e7[_0x552945(0x167)]),console[_0x552945(0x178)](_0x552945(0x14a),_0x10e4e7['statusText']),console[_0x552945(0x178)](_0x552945(0x14e),Object[_0x552945(0x170)](_0x10e4e7[_0x552945(0x145)][_0x552945(0x183)]())),console[_0x552945(0x178)](_0x552945(0x19e),_0x50d326+'ms');const _0x27c67f=await _0x10e4e7[_0x552945(0x126)]();console[_0x552945(0x178)](_0x552945(0x130),_0x27c67f);if(!_0x10e4e7['ok']){console[_0x552945(0x148)](_0x552945(0x122)),console[_0x552945(0x148)](_0x552945(0x16b),_0x10e4e7[_0x552945(0x167)]),console['error'](_0x552945(0x18f),_0x27c67f),loggerService_1[_0x552945(0x15a)]['logWhiteDomainResponse']('cointopay','/create',_0x10e4e7[_0x552945(0x167)],_0x27c67f,_0x50d326),loggerService_1[_0x552945(0x15a)]['logWhiteDomainError'](_0x552945(0x177),_0x552945(0x1a0),_0x552945(0x18d)+_0x10e4e7[_0x552945(0x167)]+':\x20'+_0x27c67f);throw new Error(_0x552945(0x168)+_0x10e4e7[_0x552945(0x167)]+_0x552945(0x16f)+_0x27c67f);}let _0x166231;try{_0x166231=JSON[_0x552945(0x162)](_0x27c67f);}catch(_0x4f15ab){console[_0x552945(0x148)](_0x552945(0x163),_0x4f15ab),loggerService_1[_0x552945(0x15a)][_0x552945(0x13b)](_0x552945(0x177),_0x552945(0x1a0),'JSON\x20Parse\x20Error:\x20'+_0x4f15ab);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x27c67f);}console[_0x552945(0x178)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x552945(0x178)](_0x552945(0x140),JSON[_0x552945(0x142)](_0x166231,null,0x2)),loggerService_1[_0x552945(0x15a)][_0x552945(0x133)](_0x552945(0x177),'/create',_0x10e4e7[_0x552945(0x167)],_0x166231,_0x50d326);if(_0x166231[_0x552945(0x148)]){const _0x112631=_0x166231[_0x552945(0x129)]||_0x166231[_0x552945(0x148)]||_0x552945(0x138);console[_0x552945(0x148)](_0x552945(0x137)),console[_0x552945(0x148)](_0x552945(0x15f),_0x112631),loggerService_1[_0x552945(0x15a)][_0x552945(0x13b)]('cointopay',_0x552945(0x1a0),_0x552945(0x13a)+_0x112631);throw new Error(_0x552945(0x160)+_0x112631);}if(!_0x166231[_0x552945(0x11d)]||!_0x166231[_0x552945(0x14c)]){console[_0x552945(0x148)](_0x552945(0x14d)),console[_0x552945(0x148)](_0x552945(0x151)),console[_0x552945(0x148)](_0x552945(0x123),_0x166231),loggerService_1[_0x552945(0x15a)]['logWhiteDomainError'](_0x552945(0x177),_0x552945(0x1a0),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x552945(0x166));}return console[_0x552945(0x178)](_0x552945(0x17c)),console[_0x552945(0x178)](_0x552945(0x172),_0x166231['gateway_payment_id']),console[_0x552945(0x178)](_0x552945(0x127),_0x166231[_0x552945(0x11d)]),console[_0x552945(0x178)]('Amount:',_0x123b9f,_0x552945(0x194)),{'gateway_payment_id':_0x166231[_0x552945(0x14c)],'payment_url':_0x166231['payment_url']};}catch(_0x432042){console[_0x552945(0x148)](_0x552945(0x154)),console[_0x552945(0x148)](_0x552945(0x11e),_0x432042),loggerService_1[_0x552945(0x15a)][_0x552945(0x13b)](_0x552945(0x177),_0x552945(0x1a0),_0x432042);if(_0x432042 instanceof Error){console[_0x552945(0x148)]('Error\x20message:',_0x432042[_0x552945(0x129)]),console[_0x552945(0x148)](_0x552945(0x13d),_0x432042[_0x552945(0x11f)]);throw new Error(_0x552945(0x12a)+_0x432042[_0x552945(0x129)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a38_0x331908(0x12b)](_0x114534){const _0x4a7eb0=a38_0x331908,_0x34df43=Date[_0x4a7eb0(0x158)]();try{console['log'](_0x4a7eb0(0x197)+_0x114534);const _0x4ae274={'gatewayPaymentId':_0x114534};loggerService_1[_0x4a7eb0(0x15a)][_0x4a7eb0(0x176)]('cointopay',_0x4a7eb0(0x12c),_0x4a7eb0(0x199),_0x4ae274);const _0x113d53=await fetch(this['statusUrl'],{'method':_0x4a7eb0(0x199),'headers':{'Content-Type':_0x4a7eb0(0x153),'Accept':_0x4a7eb0(0x153),'User-Agent':_0x4a7eb0(0x15e)},'body':JSON[_0x4a7eb0(0x142)](_0x4ae274)}),_0x1fcc63=Date[_0x4a7eb0(0x158)]()-_0x34df43;console[_0x4a7eb0(0x178)](_0x4a7eb0(0x184)),console['log']('Status:',_0x113d53[_0x4a7eb0(0x167)]),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x19e),_0x1fcc63+'ms');if(!_0x113d53['ok']){const _0x530bc7=await _0x113d53[_0x4a7eb0(0x126)]();console['error'](_0x4a7eb0(0x16b),_0x113d53[_0x4a7eb0(0x167)]),console[_0x4a7eb0(0x148)]('Response\x20Body:',_0x530bc7),loggerService_1[_0x4a7eb0(0x15a)][_0x4a7eb0(0x133)]('cointopay',_0x4a7eb0(0x12c),_0x113d53['status'],_0x530bc7,_0x1fcc63),loggerService_1[_0x4a7eb0(0x15a)][_0x4a7eb0(0x13b)]('cointopay',_0x4a7eb0(0x12c),'HTTP\x20'+_0x113d53[_0x4a7eb0(0x167)]+':\x20'+_0x530bc7);throw new Error(_0x4a7eb0(0x168)+_0x113d53[_0x4a7eb0(0x167)]);}const _0x4ca0ff=await _0x113d53[_0x4a7eb0(0x126)]();console[_0x4a7eb0(0x178)](_0x4a7eb0(0x130),_0x4ca0ff);let _0x3e7e68;try{_0x3e7e68=JSON[_0x4a7eb0(0x162)](_0x4ca0ff);}catch(_0x210f78){console[_0x4a7eb0(0x148)](_0x4a7eb0(0x163),_0x210f78),loggerService_1[_0x4a7eb0(0x15a)]['logWhiteDomainError'](_0x4a7eb0(0x177),_0x4a7eb0(0x12c),'JSON\x20Parse\x20Error:\x20'+_0x210f78);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4ca0ff);}loggerService_1[_0x4a7eb0(0x15a)]['logWhiteDomainResponse'](_0x4a7eb0(0x177),_0x4a7eb0(0x12c),_0x113d53[_0x4a7eb0(0x167)],_0x3e7e68,_0x1fcc63),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x150)),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x164),_0x3e7e68[_0x4a7eb0(0x19c)]),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x191),_0x3e7e68[_0x4a7eb0(0x152)]),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x143),_0x3e7e68[_0x4a7eb0(0x169)]?.['Status']),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x146),_0x3e7e68[_0x4a7eb0(0x169)]?.[_0x4a7eb0(0x124)]),console['log'](_0x4a7eb0(0x139),_0x3e7e68['data']?.[_0x4a7eb0(0x192)]);if(_0x3e7e68[_0x4a7eb0(0x19c)]!==_0x4a7eb0(0x15d)||_0x3e7e68[_0x4a7eb0(0x152)]!==0xc8){const _0x44ccba=_0x3e7e68[_0x4a7eb0(0x129)]||_0x4a7eb0(0x18a);console[_0x4a7eb0(0x148)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x4a7eb0(0x15f),_0x44ccba),loggerService_1[_0x4a7eb0(0x15a)][_0x4a7eb0(0x13b)](_0x4a7eb0(0x177),_0x4a7eb0(0x12c),_0x4a7eb0(0x18e)+_0x44ccba);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x44ccba);}if(!_0x3e7e68['data']){console[_0x4a7eb0(0x148)](_0x4a7eb0(0x16d)),console[_0x4a7eb0(0x148)](_0x4a7eb0(0x193)),loggerService_1[_0x4a7eb0(0x15a)]['logWhiteDomainError']('cointopay',_0x4a7eb0(0x12c),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x3315a6=_0x4a7eb0(0x131);switch(_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x181)]?.['toLowerCase']()){case _0x4a7eb0(0x17d):_0x3315a6=_0x4a7eb0(0x13e);break;case _0x4a7eb0(0x182):case _0x4a7eb0(0x16e):case'error':_0x3315a6='FAILED';break;case _0x4a7eb0(0x19b):case _0x4a7eb0(0x144):_0x3315a6=_0x4a7eb0(0x17f);break;case _0x4a7eb0(0x13f):case'awaiting\x20fiat':case'pending':case _0x4a7eb0(0x136):default:_0x3315a6=_0x4a7eb0(0x131);break;}let _0x469055,_0x59795c;if(_0x3e7e68['data'][_0x4a7eb0(0x186)]){const _0x5c9cb9=_0x3e7e68['data']['PaymentDetail'];console['log'](_0x4a7eb0(0x188),_0x5c9cb9);const _0x3b2dc3=_0x5c9cb9[_0x4a7eb0(0x14b)](/IBAN\s+([A-Z0-9]+)/i);_0x3b2dc3&&(_0x469055=_0x3b2dc3[0x1],console['log'](_0x4a7eb0(0x174),_0x469055)),_0x59795c=_0x5c9cb9;}const _0x4b7683={'iban':_0x469055,'bankDetails':_0x59795c,'transactionId':_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x16c)],'coinAddress':_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x180)],'qrCodeUrl':_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x19d)],'expiryTime':_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x12e)],'createdOn':_0x3e7e68['data']['CreatedOn'],'confirmedOn':_0x3e7e68['data'][_0x4a7eb0(0x15c)]};console[_0x4a7eb0(0x178)](_0x4a7eb0(0x13c)),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x17a),_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x181)],'->',_0x3315a6),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x146),_0x3e7e68['data'][_0x4a7eb0(0x124)],_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x192)]),console[_0x4a7eb0(0x178)]('Transaction\x20ID:',_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x16c)]),console[_0x4a7eb0(0x178)](_0x4a7eb0(0x18b),_0x469055||'not\x20found'),console['log'](_0x4a7eb0(0x120),_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x11c)]),console['log'](_0x4a7eb0(0x185),_0x3e7e68['data'][_0x4a7eb0(0x15c)]||'not\x20confirmed');if(_0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x181)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x4a7eb0(0x178)](_0x4a7eb0(0x187));else _0x3e7e68[_0x4a7eb0(0x169)][_0x4a7eb0(0x181)]?.[_0x4a7eb0(0x171)]()===_0x4a7eb0(0x17d)&&console[_0x4a7eb0(0x178)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3315a6,'amount':parseFloat(_0x3e7e68['data'][_0x4a7eb0(0x124)])||undefined,'currency':_0x3e7e68['data'][_0x4a7eb0(0x192)]||_0x4a7eb0(0x194),'paymentDetails':_0x4b7683};}catch(_0x2b7f7a){console[_0x4a7eb0(0x148)](_0x4a7eb0(0x198),_0x2b7f7a),loggerService_1[_0x4a7eb0(0x15a)][_0x4a7eb0(0x13b)](_0x4a7eb0(0x177),_0x4a7eb0(0x12c),_0x2b7f7a);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2b7f7a instanceof Error?_0x2b7f7a[_0x4a7eb0(0x129)]:_0x4a7eb0(0x165)));}}async[a38_0x331908(0x196)](_0x589ae3){const _0x4f7512=a38_0x331908,_0x58699e=await this[_0x4f7512(0x12b)](_0x589ae3);return{'status':_0x58699e[_0x4f7512(0x167)],'amount':_0x58699e[_0x4f7512(0x156)],'currency':_0x58699e[_0x4f7512(0x121)]};}async['processWebhook'](_0x5a54d4){const _0x663f7b=a38_0x331908;console[_0x663f7b(0x178)](_0x663f7b(0x161),_0x5a54d4);let _0x30e6b5=_0x663f7b(0x131);switch(_0x5a54d4[_0x663f7b(0x167)]?.[_0x663f7b(0x171)]()){case _0x663f7b(0x17d):_0x30e6b5=_0x663f7b(0x13e);break;case _0x663f7b(0x182):case _0x663f7b(0x16e):case _0x663f7b(0x148):_0x30e6b5=_0x663f7b(0x16a);break;case _0x663f7b(0x19b):case _0x663f7b(0x144):_0x30e6b5='EXPIRED';break;case _0x663f7b(0x128):case _0x663f7b(0x13f):case _0x663f7b(0x15b):case'created':default:_0x30e6b5=_0x663f7b(0x131);break;}return{'paymentId':_0x5a54d4['order_id']||_0x5a54d4[_0x663f7b(0x195)]||'','status':_0x30e6b5,'amount':_0x5a54d4[_0x663f7b(0x156)],'currency':_0x5a54d4[_0x663f7b(0x121)]||_0x663f7b(0x194)};}}exports['CoinToPayService']=CoinToPayService;function a38_0x1743(){const _0x41ad09=['3678924CKgRzn','amount','1022ujrsfk','now','defineProperty','loggerService','awaiting\x20fiat','TransactionConfirmedOn','success','TesSoft\x20Payment\x20System/1.0','Error\x20Message:','CoinToPay\x20API\x20error:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','parse','Failed\x20to\x20parse\x20JSON\x20response:','Result:','Unknown\x20error','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status','HTTP\x20error!\x20status:\x20','data','FAILED','HTTP\x20Status:','TransactionID','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','failed',',\x20body:\x20','fromEntries','toLowerCase','Gateway\x20Payment\x20ID:','2977960Stehev','üè¶\x20Extracted\x20IBAN:','\x20EUR','logWhiteDomainRequest','cointopay','log','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status:','CoinToPayService','===\x20COINTOPAY\x20SUCCESS\x20===','paid','22jvmAYP','EXPIRED','coinAddress','Status','cancelled','entries','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Confirmed\x20On:','PaymentDetail','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','üè¶\x20Payment\x20Detail:','56778XqSchp','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','IBAN:','Request\x20Body:','HTTP\x20','Status\x20API\x20Error:\x20','Response\x20Body:','__esModule','Status\x20Code:','inputCurrency','Missing\x20data\x20in\x20response','EUR','merchant_reference_id','verifyPayment','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','POST','1104320uYIbyw','expired','result','QRCodeURL','Response\x20Time:','41607963olQXRv','/create','CreatedOn','payment_url','Error\x20details:','stack','Created\x20On:','currency','===\x20COINTOPAY\x20API\x20ERROR\x20===','Response\x20data:','Amount','statusUrl','text','Payment\x20URL:','pending','message','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','checkPaymentStatus','/status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ExpiryTime','53717jAlECU','Raw\x20Response\x20Body:','PENDING','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainResponse','üìä\x20Status\x20check\x20URL:','5843575qOXUgK','created','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','Currency:','Business\x20Error:\x20','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Error\x20stack:','PAID','waiting','Parsed\x20Result:','https://tesoft.uk/gateway/cointopay/','stringify','Payment\x20Status:','timeout','headers','Amount:','apiUrl','error','10kFFWVF','Status\x20Text:','match','gateway_payment_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Headers:','../loggerService','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status_code','application/json','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='];a38_0x1743=function(){return _0x41ad09;};return a38_0x1743();}