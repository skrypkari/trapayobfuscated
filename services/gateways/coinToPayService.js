'use strict';const a38_0x47647a=a38_0x49a4;(function(_0x5ab611,_0x12846c){const _0x22545f=a38_0x49a4,_0x13bb35=_0x5ab611();while(!![]){try{const _0x2e1171=parseInt(_0x22545f(0x1a3))/0x1*(parseInt(_0x22545f(0x169))/0x2)+-parseInt(_0x22545f(0x195))/0x3*(-parseInt(_0x22545f(0x198))/0x4)+parseInt(_0x22545f(0x167))/0x5+-parseInt(_0x22545f(0x1c2))/0x6+-parseInt(_0x22545f(0x1a8))/0x7+parseInt(_0x22545f(0x16f))/0x8+parseInt(_0x22545f(0x192))/0x9*(-parseInt(_0x22545f(0x188))/0xa);if(_0x2e1171===_0x12846c)break;else _0x13bb35['push'](_0x13bb35['shift']());}catch(_0x558aa5){_0x13bb35['push'](_0x13bb35['shift']());}}}(a38_0xf30c,0x6931f));function a38_0x49a4(_0x429aff,_0x9308d3){const _0xf30c0f=a38_0xf30c();return a38_0x49a4=function(_0x49a4ed,_0x2349ff){_0x49a4ed=_0x49a4ed-0x15c;let _0x4651f0=_0xf30c0f[_0x49a4ed];return _0x4651f0;},a38_0x49a4(_0x429aff,_0x9308d3);}Object[a38_0x47647a(0x185)](exports,'__esModule',{'value':!![]}),exports[a38_0x47647a(0x1a2)]=void 0x0;const loggerService_1=require(a38_0x47647a(0x179));class CoinToPayService{constructor(){const _0x370b5f=a38_0x47647a;this[_0x370b5f(0x1b2)]=_0x370b5f(0x1d0),this['statusUrl']=_0x370b5f(0x17b),console[_0x370b5f(0x1d4)](_0x370b5f(0x1b9)),console[_0x370b5f(0x1d4)](_0x370b5f(0x1c3),this[_0x370b5f(0x182)]);}async['createPaymentLink'](_0x6d0fa3){const _0x550cc8=a38_0x47647a,{orderId:_0x432bd4,amount:_0x700cc4}=_0x6d0fa3;console[_0x550cc8(0x1d4)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x700cc4+_0x550cc8(0x1c0));const _0x4dbf6f={'amount':_0x700cc4},_0x51b086=Date[_0x550cc8(0x1c4)]();try{console[_0x550cc8(0x1d4)](_0x550cc8(0x1c1)),console[_0x550cc8(0x1d4)](_0x550cc8(0x194),this['apiUrl']),console[_0x550cc8(0x1d4)](_0x550cc8(0x15f),JSON['stringify'](_0x4dbf6f,null,0x2)),console[_0x550cc8(0x1d4)](_0x550cc8(0x1cb),_0x700cc4,_0x550cc8(0x199)),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x1cd)]('cointopay',_0x550cc8(0x19e),_0x550cc8(0x16a),_0x4dbf6f);const _0x49723a=await fetch(this['apiUrl'],{'method':_0x550cc8(0x16a),'headers':{'Content-Type':_0x550cc8(0x193),'Accept':_0x550cc8(0x193),'User-Agent':_0x550cc8(0x1bd)},'body':JSON['stringify'](_0x4dbf6f)}),_0x29c024=Date[_0x550cc8(0x1c4)]()-_0x51b086;console[_0x550cc8(0x1d4)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x550cc8(0x1d4)]('Status:',_0x49723a[_0x550cc8(0x1ce)]),console[_0x550cc8(0x1d4)](_0x550cc8(0x1b8),_0x49723a[_0x550cc8(0x17a)]),console[_0x550cc8(0x1d4)]('Headers:',Object['fromEntries'](_0x49723a['headers']['entries']())),console['log']('Response\x20Time:',_0x29c024+'ms');const _0x4c80ad=await _0x49723a[_0x550cc8(0x15c)]();console['log'](_0x550cc8(0x173),_0x4c80ad);if(!_0x49723a['ok']){console['error'](_0x550cc8(0x1da)),console[_0x550cc8(0x1d3)](_0x550cc8(0x172),_0x49723a['status']),console[_0x550cc8(0x1d3)](_0x550cc8(0x1d9),_0x4c80ad),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x1a4)](_0x550cc8(0x17d),'/create',_0x49723a[_0x550cc8(0x1ce)],_0x4c80ad,_0x29c024),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x161)](_0x550cc8(0x17d),'/create',_0x550cc8(0x174)+_0x49723a['status']+':\x20'+_0x4c80ad);throw new Error('HTTP\x20error!\x20status:\x20'+_0x49723a[_0x550cc8(0x1ce)]+_0x550cc8(0x1a5)+_0x4c80ad);}let _0x40e69e;try{_0x40e69e=JSON[_0x550cc8(0x197)](_0x4c80ad);}catch(_0x128785){console[_0x550cc8(0x1d3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x128785),loggerService_1['loggerService'][_0x550cc8(0x161)](_0x550cc8(0x17d),_0x550cc8(0x19e),_0x550cc8(0x1bc)+_0x128785);throw new Error(_0x550cc8(0x1b5)+_0x4c80ad);}console[_0x550cc8(0x1d4)](_0x550cc8(0x1b6)),console['log'](_0x550cc8(0x1be),JSON['stringify'](_0x40e69e,null,0x2)),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x1a4)](_0x550cc8(0x17d),_0x550cc8(0x19e),_0x49723a[_0x550cc8(0x1ce)],_0x40e69e,_0x29c024);if(_0x40e69e['error']){const _0x4b4557=_0x40e69e[_0x550cc8(0x1d2)]||_0x40e69e[_0x550cc8(0x1d3)]||_0x550cc8(0x171);console[_0x550cc8(0x1d3)](_0x550cc8(0x17e)),console[_0x550cc8(0x1d3)](_0x550cc8(0x16e),_0x4b4557),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x161)]('cointopay','/create',_0x550cc8(0x163)+_0x4b4557);throw new Error(_0x550cc8(0x189)+_0x4b4557);}if(!_0x40e69e['payment_url']||!_0x40e69e[_0x550cc8(0x1bf)]){console[_0x550cc8(0x1d3)](_0x550cc8(0x16b)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x550cc8(0x1d3)](_0x550cc8(0x15e),_0x40e69e),loggerService_1[_0x550cc8(0x18d)][_0x550cc8(0x161)](_0x550cc8(0x17d),'/create',_0x550cc8(0x186));throw new Error(_0x550cc8(0x18b));}return console[_0x550cc8(0x1d4)](_0x550cc8(0x166)),console[_0x550cc8(0x1d4)](_0x550cc8(0x18f),_0x40e69e[_0x550cc8(0x1bf)]),console['log'](_0x550cc8(0x1b0),_0x40e69e[_0x550cc8(0x1a7)]),console[_0x550cc8(0x1d4)](_0x550cc8(0x1cb),_0x700cc4,_0x550cc8(0x176)),{'gateway_payment_id':_0x40e69e['gateway_payment_id'],'payment_url':_0x40e69e['payment_url']};}catch(_0x942103){console['error'](_0x550cc8(0x191)),console[_0x550cc8(0x1d3)]('Error\x20details:',_0x942103),loggerService_1[_0x550cc8(0x18d)]['logWhiteDomainError'](_0x550cc8(0x17d),_0x550cc8(0x19e),_0x942103);if(_0x942103 instanceof Error){console[_0x550cc8(0x1d3)](_0x550cc8(0x164),_0x942103[_0x550cc8(0x1d2)]),console['error'](_0x550cc8(0x1ca),_0x942103['stack']);throw new Error(_0x550cc8(0x1ac)+_0x942103[_0x550cc8(0x1d2)]);}throw new Error(_0x550cc8(0x1d5));}}async[a38_0x47647a(0x1aa)](_0x42be71){const _0x4dd5ac=a38_0x47647a,_0x58ab4c=Date['now']();try{console[_0x4dd5ac(0x1d4)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x42be71);const _0x47ebc8={'gatewayPaymentId':_0x42be71};loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x1cd)]('cointopay',_0x4dd5ac(0x16d),_0x4dd5ac(0x16a),_0x47ebc8);const _0x734353=await fetch(this[_0x4dd5ac(0x182)],{'method':'POST','headers':{'Content-Type':_0x4dd5ac(0x193),'Accept':_0x4dd5ac(0x193),'User-Agent':_0x4dd5ac(0x1bd)},'body':JSON[_0x4dd5ac(0x1cc)](_0x47ebc8)}),_0x12c84a=Date[_0x4dd5ac(0x1c4)]()-_0x58ab4c;console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x1b3)),console[_0x4dd5ac(0x1d4)]('Status:',_0x734353[_0x4dd5ac(0x1ce)]),console['log'](_0x4dd5ac(0x1d8),_0x12c84a+'ms');if(!_0x734353['ok']){const _0x501c62=await _0x734353[_0x4dd5ac(0x15c)]();console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x172),_0x734353[_0x4dd5ac(0x1ce)]),console['error'](_0x4dd5ac(0x1d9),_0x501c62),loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x1a4)](_0x4dd5ac(0x17d),'/status',_0x734353[_0x4dd5ac(0x1ce)],_0x501c62,_0x12c84a),loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x161)](_0x4dd5ac(0x17d),_0x4dd5ac(0x16d),_0x4dd5ac(0x174)+_0x734353['status']+':\x20'+_0x501c62);throw new Error('HTTP\x20error!\x20status:\x20'+_0x734353[_0x4dd5ac(0x1ce)]);}const _0x1e3767=await _0x734353[_0x4dd5ac(0x15c)]();console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x173),_0x1e3767);let _0x27dd8e;try{_0x27dd8e=JSON[_0x4dd5ac(0x197)](_0x1e3767);}catch(_0x1bca5b){console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x165),_0x1bca5b),loggerService_1[_0x4dd5ac(0x18d)]['logWhiteDomainError'](_0x4dd5ac(0x17d),_0x4dd5ac(0x16d),'JSON\x20Parse\x20Error:\x20'+_0x1bca5b);throw new Error(_0x4dd5ac(0x1b4)+_0x1e3767);}loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x1a4)](_0x4dd5ac(0x17d),'/status',_0x734353['status'],_0x27dd8e,_0x12c84a),console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x168)),console['log'](_0x4dd5ac(0x16c),_0x27dd8e[_0x4dd5ac(0x187)]),console['log'](_0x4dd5ac(0x162),_0x27dd8e['status_code']),console['log']('Payment\x20Status:',_0x27dd8e[_0x4dd5ac(0x1c6)]?.[_0x4dd5ac(0x181)]),console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x1cb),_0x27dd8e[_0x4dd5ac(0x1c6)]?.[_0x4dd5ac(0x17f)]),console['log'](_0x4dd5ac(0x1d6),_0x27dd8e[_0x4dd5ac(0x1c6)]?.['inputCurrency']);if(_0x27dd8e[_0x4dd5ac(0x187)]!==_0x4dd5ac(0x177)||_0x27dd8e['status_code']!==0xc8){const _0x37190b=_0x27dd8e[_0x4dd5ac(0x1d2)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x17c)),console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x16e),_0x37190b),loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x161)](_0x4dd5ac(0x17d),_0x4dd5ac(0x16d),_0x4dd5ac(0x183)+_0x37190b);throw new Error(_0x4dd5ac(0x178)+_0x37190b);}if(!_0x27dd8e['data']){console[_0x4dd5ac(0x1d3)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x18e)),loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x161)](_0x4dd5ac(0x17d),_0x4dd5ac(0x16d),_0x4dd5ac(0x1d7));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x36002c='PENDING';switch(_0x27dd8e[_0x4dd5ac(0x1c6)]['Status']?.[_0x4dd5ac(0x1a9)]()){case _0x4dd5ac(0x1dc):_0x36002c='PAID';break;case _0x4dd5ac(0x1ad):case'failed':case'error':_0x36002c='FAILED';break;case _0x4dd5ac(0x19b):case _0x4dd5ac(0x19f):_0x36002c='EXPIRED';break;case _0x4dd5ac(0x1a6):case _0x4dd5ac(0x1ae):case _0x4dd5ac(0x1b7):case _0x4dd5ac(0x170):default:_0x36002c=_0x4dd5ac(0x180);break;}let _0x28649d,_0x624917;if(_0x27dd8e[_0x4dd5ac(0x1c6)]['PaymentDetail']){const _0x3d58af=_0x27dd8e['data']['PaymentDetail'];console[_0x4dd5ac(0x1d4)]('üè¶\x20Payment\x20Detail:',_0x3d58af);const _0x155f64=_0x3d58af['match'](/IBAN\s+([A-Z0-9]+)/i);_0x155f64&&(_0x28649d=_0x155f64[0x1],console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x1bb),_0x28649d)),_0x624917=_0x3d58af;}const _0x4157b3={'iban':_0x28649d,'bankDetails':_0x624917,'transactionId':_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x19a)],'coinAddress':_0x27dd8e['data']['coinAddress'],'qrCodeUrl':_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x1a0)],'expiryTime':_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x15d)],'createdOn':_0x27dd8e[_0x4dd5ac(0x1c6)]['CreatedOn'],'confirmedOn':_0x27dd8e['data'][_0x4dd5ac(0x190)]};console[_0x4dd5ac(0x1d4)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x18c),_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x181)],'->',_0x36002c),console[_0x4dd5ac(0x1d4)]('Amount:',_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x17f)],_0x27dd8e['data'][_0x4dd5ac(0x175)]),console['log'](_0x4dd5ac(0x1c5),_0x27dd8e['data'][_0x4dd5ac(0x19a)]),console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x1a1),_0x28649d||_0x4dd5ac(0x1b1)),console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x1d1),_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x1c9)]),console[_0x4dd5ac(0x1d4)]('Confirmed\x20On:',_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x190)]||_0x4dd5ac(0x19d));if(_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x181)]?.[_0x4dd5ac(0x1a9)]()==='awaiting\x20fiat')console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x27dd8e[_0x4dd5ac(0x1c6)]['Status']?.[_0x4dd5ac(0x1a9)]()===_0x4dd5ac(0x1dc)&&console[_0x4dd5ac(0x1d4)](_0x4dd5ac(0x196));return{'status':_0x36002c,'amount':parseFloat(_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x17f)])||undefined,'currency':_0x27dd8e[_0x4dd5ac(0x1c6)][_0x4dd5ac(0x175)]||_0x4dd5ac(0x176),'paymentDetails':_0x4157b3};}catch(_0x577db0){console[_0x4dd5ac(0x1d3)](_0x4dd5ac(0x1c8),_0x577db0),loggerService_1[_0x4dd5ac(0x18d)][_0x4dd5ac(0x161)]('cointopay','/status',_0x577db0);throw new Error(_0x4dd5ac(0x1ab)+(_0x577db0 instanceof Error?_0x577db0[_0x4dd5ac(0x1d2)]:_0x4dd5ac(0x19c)));}}async[a38_0x47647a(0x1db)](_0x359185){const _0x2583b8=a38_0x47647a,_0x185668=await this[_0x2583b8(0x1aa)](_0x359185);return{'status':_0x185668[_0x2583b8(0x1ce)],'amount':_0x185668[_0x2583b8(0x160)],'currency':_0x185668[_0x2583b8(0x1cf)]};}async['processWebhook'](_0x44fba5){const _0x4fc2cf=a38_0x47647a;console[_0x4fc2cf(0x1d4)](_0x4fc2cf(0x1af),_0x44fba5);let _0xc15c8a='PENDING';switch(_0x44fba5['status']?.[_0x4fc2cf(0x1a9)]()){case'paid':_0xc15c8a=_0x4fc2cf(0x1ba);break;case _0x4fc2cf(0x1ad):case'failed':case _0x4fc2cf(0x1d3):_0xc15c8a=_0x4fc2cf(0x1c7);break;case _0x4fc2cf(0x19b):case _0x4fc2cf(0x19f):_0xc15c8a=_0x4fc2cf(0x184);break;case _0x4fc2cf(0x1b7):case'waiting':case _0x4fc2cf(0x1ae):case _0x4fc2cf(0x170):default:_0xc15c8a=_0x4fc2cf(0x180);break;}return{'paymentId':_0x44fba5[_0x4fc2cf(0x18a)]||_0x44fba5['merchant_reference_id']||'','status':_0xc15c8a,'amount':_0x44fba5[_0x4fc2cf(0x160)],'currency':_0x44fba5[_0x4fc2cf(0x1cf)]||_0x4fc2cf(0x176)};}}function a38_0xf30c(){const _0x2ec9bc=['payment_url','4561389rRpdMj','toLowerCase','checkPaymentStatus','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','cancelled','awaiting\x20fiat','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Payment\x20URL:','not\x20found','apiUrl','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','pending','Status\x20Text:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PAID','üè¶\x20Extracted\x20IBAN:','JSON\x20Parse\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','Parsed\x20Result:','gateway_payment_id','\x20EUR','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','54228WsvaPC','üìä\x20Status\x20check\x20URL:','now','Transaction\x20ID:','data','FAILED','CoinToPay\x20payment\x20status\x20check\x20error:','CreatedOn','Error\x20stack:','Amount:','stringify','logWhiteDomainRequest','status','currency','https://tesoft.uk/gateway/cointopay/','Created\x20On:','message','error','log','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Currency:','Incomplete\x20response:\x20missing\x20data','Response\x20Time:','Response\x20Body:','===\x20COINTOPAY\x20API\x20ERROR\x20===','verifyPayment','paid','text','ExpiryTime','Response\x20data:','Request\x20Body:','amount','logWhiteDomainError','Status\x20Code:','Business\x20Error:\x20','Error\x20message:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20SUCCESS\x20===','993180mmlPzr','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','722RjUunU','POST','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Result:','/status','Error\x20Message:','4756896wPAgFK','created','Unknown\x20error\x20from\x20CoinToPay\x20API','HTTP\x20Status:','Raw\x20Response\x20Body:','HTTP\x20','inputCurrency','EUR','success','CoinToPay\x20status\x20API\x20error:\x20','../loggerService','statusText','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','cointopay','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Amount','PENDING','Status','statusUrl','Status\x20API\x20Error:\x20','EXPIRED','defineProperty','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','result','40LbrARW','CoinToPay\x20API\x20error:\x20','order_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status:','loggerService','Missing\x20data\x20in\x20response','Gateway\x20Payment\x20ID:','TransactionConfirmedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','161199inDdJp','application/json','URL:','831489XvCUWY','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','parse','4ddGwHu','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','TransactionID','expired','Unknown\x20error','not\x20confirmed','/create','timeout','QRCodeURL','IBAN:','CoinToPayService','257whcFGc','logWhiteDomainResponse',',\x20body:\x20','waiting'];a38_0xf30c=function(){return _0x2ec9bc;};return a38_0xf30c();}exports[a38_0x47647a(0x1a2)]=CoinToPayService;