'use strict';function a43_0x1394(){const _0x1e940a=['parse','../loggerService','264335btnKfs','Amount','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','match','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Gateway\x20Payment\x20ID:','Status:','4448238rVCPvy','HTTP\x20error!\x20status:\x20','IBAN:','Response\x20Body:','statusUrl','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CreatedOn','data','not\x20confirmed','TransactionID','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','üìä\x20Status\x20check\x20URL:','Parsed\x20Result:','error','failed','POST','amount','toLowerCase','coinAddress','Transaction\x20ID:','PAID','Headers:','Request\x20Body:','created','Currency:','CoinToPay\x20API\x20error:\x20','result','EUR','stack','Confirmed\x20On:','verifyPayment','success','Incomplete\x20response:\x20missing\x20data','not\x20found','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status','now','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Amount:','730CbPaOk','HTTP\x20','PENDING','https://tesoft.uk/gateway/cointopay/','fromEntries','EXPIRED','/status','order_id','130XVEtWD','message','7cDLzGn','===\x20COINTOPAY\x20SUCCESS\x20===','pending','ExpiryTime','Status\x20Code:','Unknown\x20error\x20from\x20CoinToPay\x20API','headers','logWhiteDomainRequest','Payment\x20URL:','\x20EUR','154278wJJgTr','waiting','TransactionConfirmedOn','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','173340FoFrnW','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','/create','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','defineProperty','CoinToPayService','log','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','1404996mXOabx','CoinToPay\x20status\x20API\x20error:\x20','4148960CRNAUa','payment_url','CoinToPay\x20payment\x20status\x20check\x20error:','application/json','üè¶\x20Payment\x20Detail:','gateway_payment_id','URL:','FAILED','merchant_reference_id','Failed\x20to\x20parse\x20JSON\x20response:','PaymentDetail','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','cointopay','HTTP\x20Status:','paid','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','JSON\x20Parse\x20Error:\x20','checkPaymentStatus','logWhiteDomainResponse','expired','text','Payment\x20Status:','createPaymentLink','inputCurrency','Created\x20On:','Error\x20stack:','logWhiteDomainError','loggerService','status','apiUrl','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Missing\x20data\x20in\x20response','Status\x20API\x20Error:\x20','Status\x20Text:','awaiting\x20fiat','QRCodeURL','https://tesoft.uk/gateway/cointopay/status.php','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Result:','130952NEzBvb','currency','__esModule','stringify'];a43_0x1394=function(){return _0x1e940a;};return a43_0x1394();}const a43_0x317844=a43_0x6ee6;(function(_0x392d06,_0x258425){const _0x36477d=a43_0x6ee6,_0x420ca0=_0x392d06();while(!![]){try{const _0x2d9a81=-parseInt(_0x36477d(0x20f))/0x1+-parseInt(_0x36477d(0x1d0))/0x2+parseInt(_0x36477d(0x1df))/0x3+parseInt(_0x36477d(0x209))/0x4*(-parseInt(_0x36477d(0x1c4))/0x5)+parseInt(_0x36477d(0x217))/0x6*(-parseInt(_0x36477d(0x1c6))/0x7)+parseInt(_0x36477d(0x1e1))/0x8+-parseInt(_0x36477d(0x1d5))/0x9*(-parseInt(_0x36477d(0x1bc))/0xa);if(_0x2d9a81===_0x258425)break;else _0x420ca0['push'](_0x420ca0['shift']());}catch(_0x31395e){_0x420ca0['push'](_0x420ca0['shift']());}}}(a43_0x1394,0x70091));function a43_0x6ee6(_0x255a62,_0x288bc4){const _0x139424=a43_0x1394();return a43_0x6ee6=function(_0x6ee68d,_0x3fe07a){_0x6ee68d=_0x6ee68d-0x1b0;let _0x484676=_0x139424[_0x6ee68d];return _0x484676;},a43_0x6ee6(_0x255a62,_0x288bc4);}Object[a43_0x317844(0x1db)](exports,a43_0x317844(0x20b),{'value':!![]}),exports[a43_0x317844(0x1dc)]=void 0x0;const loggerService_1=require(a43_0x317844(0x20e));class CoinToPayService{constructor(){const _0x1f550c=a43_0x317844;this[_0x1f550c(0x1ff)]=_0x1f550c(0x1bf),this['statusUrl']=_0x1f550c(0x206),console[_0x1f550c(0x1dd)](_0x1f550c(0x207)),console[_0x1f550c(0x1dd)](_0x1f550c(0x223),this['statusUrl']);}async[a43_0x317844(0x1f8)](_0x36ddeb){const _0x310d4b=a43_0x317844,{orderId:_0x3221a1,amount:_0xf7dbbc}=_0x36ddeb;console[_0x310d4b(0x1dd)](_0x310d4b(0x214)+_0xf7dbbc+_0x310d4b(0x1cf));const _0x13214b={'amount':_0xf7dbbc},_0xe2d296=Date[_0x310d4b(0x1b6)]();try{console[_0x310d4b(0x1dd)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x310d4b(0x1dd)](_0x310d4b(0x1e7),this[_0x310d4b(0x1ff)]),console[_0x310d4b(0x1dd)](_0x310d4b(0x22e),JSON[_0x310d4b(0x20c)](_0x13214b,null,0x2)),console[_0x310d4b(0x1dd)]('Amount:',_0xf7dbbc,_0x310d4b(0x1d4)),loggerService_1['loggerService'][_0x310d4b(0x1cd)]('cointopay',_0x310d4b(0x1d9),_0x310d4b(0x227),_0x13214b);const _0x1b01ae=await fetch(this[_0x310d4b(0x1ff)],{'method':'POST','headers':{'Content-Type':_0x310d4b(0x1e4),'Accept':_0x310d4b(0x1e4),'User-Agent':_0x310d4b(0x1b8)},'body':JSON[_0x310d4b(0x20c)](_0x13214b)}),_0x5c7487=Date[_0x310d4b(0x1b6)]()-_0xe2d296;console['log'](_0x310d4b(0x1f1)),console[_0x310d4b(0x1dd)](_0x310d4b(0x216),_0x1b01ae[_0x310d4b(0x1fe)]),console[_0x310d4b(0x1dd)](_0x310d4b(0x203),_0x1b01ae['statusText']),console[_0x310d4b(0x1dd)](_0x310d4b(0x22d),Object[_0x310d4b(0x1c0)](_0x1b01ae[_0x310d4b(0x1cc)]['entries']())),console['log'](_0x310d4b(0x1b7),_0x5c7487+'ms');const _0x2972ff=await _0x1b01ae[_0x310d4b(0x1f6)]();console['log']('Raw\x20Response\x20Body:',_0x2972ff);if(!_0x1b01ae['ok']){console[_0x310d4b(0x225)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x310d4b(0x225)](_0x310d4b(0x1ef),_0x1b01ae[_0x310d4b(0x1fe)]),console['error'](_0x310d4b(0x21a),_0x2972ff),loggerService_1[_0x310d4b(0x1fd)][_0x310d4b(0x1f4)](_0x310d4b(0x1ee),_0x310d4b(0x1d9),_0x1b01ae['status'],_0x2972ff,_0x5c7487),loggerService_1['loggerService'][_0x310d4b(0x1fc)](_0x310d4b(0x1ee),_0x310d4b(0x1d9),'HTTP\x20'+_0x1b01ae[_0x310d4b(0x1fe)]+':\x20'+_0x2972ff);throw new Error(_0x310d4b(0x218)+_0x1b01ae[_0x310d4b(0x1fe)]+',\x20body:\x20'+_0x2972ff);}let _0x542e60;try{_0x542e60=JSON[_0x310d4b(0x20d)](_0x2972ff);}catch(_0xcf8062){console[_0x310d4b(0x225)](_0x310d4b(0x1ea),_0xcf8062),loggerService_1[_0x310d4b(0x1fd)][_0x310d4b(0x1fc)](_0x310d4b(0x1ee),'/create','JSON\x20Parse\x20Error:\x20'+_0xcf8062);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2972ff);}console[_0x310d4b(0x1dd)](_0x310d4b(0x211)),console[_0x310d4b(0x1dd)](_0x310d4b(0x224),JSON['stringify'](_0x542e60,null,0x2)),loggerService_1[_0x310d4b(0x1fd)][_0x310d4b(0x1f4)]('cointopay',_0x310d4b(0x1d9),_0x1b01ae[_0x310d4b(0x1fe)],_0x542e60,_0x5c7487);if(_0x542e60[_0x310d4b(0x225)]){const _0x17d07b=_0x542e60[_0x310d4b(0x1c5)]||_0x542e60['error']||_0x310d4b(0x1cb);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x310d4b(0x225)]('Error\x20Message:',_0x17d07b),loggerService_1[_0x310d4b(0x1fd)][_0x310d4b(0x1fc)]('cointopay','/create',_0x310d4b(0x1d7)+_0x17d07b);throw new Error(_0x310d4b(0x231)+_0x17d07b);}if(!_0x542e60['payment_url']||!_0x542e60[_0x310d4b(0x1e6)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x310d4b(0x225)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x310d4b(0x225)]('Response\x20data:',_0x542e60),loggerService_1[_0x310d4b(0x1fd)]['logWhiteDomainError'](_0x310d4b(0x1ee),_0x310d4b(0x1d9),_0x310d4b(0x221));throw new Error(_0x310d4b(0x1ec));}return console[_0x310d4b(0x1dd)](_0x310d4b(0x1c7)),console[_0x310d4b(0x1dd)](_0x310d4b(0x215),_0x542e60[_0x310d4b(0x1e6)]),console[_0x310d4b(0x1dd)](_0x310d4b(0x1ce),_0x542e60['payment_url']),console[_0x310d4b(0x1dd)]('Amount:',_0xf7dbbc,'EUR'),{'gateway_payment_id':_0x542e60[_0x310d4b(0x1e6)],'payment_url':_0x542e60[_0x310d4b(0x1e2)]};}catch(_0x129e2c){console[_0x310d4b(0x225)](_0x310d4b(0x1d6)),console['error']('Error\x20details:',_0x129e2c),loggerService_1[_0x310d4b(0x1fd)][_0x310d4b(0x1fc)](_0x310d4b(0x1ee),_0x310d4b(0x1d9),_0x129e2c);if(_0x129e2c instanceof Error){console[_0x310d4b(0x225)]('Error\x20message:',_0x129e2c[_0x310d4b(0x1c5)]),console['error'](_0x310d4b(0x1fb),_0x129e2c[_0x310d4b(0x234)]);throw new Error(_0x310d4b(0x1d8)+_0x129e2c[_0x310d4b(0x1c5)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x317844(0x1f3)](_0x3bc7d2){const _0x312900=a43_0x317844,_0x3c2953=Date['now']();try{console[_0x312900(0x1dd)](_0x312900(0x1da)+_0x3bc7d2);const _0xb08481={'gatewayPaymentId':_0x3bc7d2};loggerService_1[_0x312900(0x1fd)][_0x312900(0x1cd)](_0x312900(0x1ee),_0x312900(0x1c2),_0x312900(0x227),_0xb08481);const _0x3efe32=await fetch(this[_0x312900(0x21b)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x312900(0x1e4),'User-Agent':_0x312900(0x1b8)},'body':JSON[_0x312900(0x20c)](_0xb08481)}),_0x36dd6f=Date['now']()-_0x3c2953;console[_0x312900(0x1dd)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x312900(0x1dd)](_0x312900(0x216),_0x3efe32[_0x312900(0x1fe)]),console['log'](_0x312900(0x1b7),_0x36dd6f+'ms');if(!_0x3efe32['ok']){const _0x464084=await _0x3efe32['text']();console['error'](_0x312900(0x1ef),_0x3efe32[_0x312900(0x1fe)]),console[_0x312900(0x225)](_0x312900(0x21a),_0x464084),loggerService_1['loggerService'][_0x312900(0x1f4)](_0x312900(0x1ee),_0x312900(0x1c2),_0x3efe32[_0x312900(0x1fe)],_0x464084,_0x36dd6f),loggerService_1[_0x312900(0x1fd)]['logWhiteDomainError'](_0x312900(0x1ee),_0x312900(0x1c2),_0x312900(0x1bd)+_0x3efe32[_0x312900(0x1fe)]+':\x20'+_0x464084);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3efe32[_0x312900(0x1fe)]);}const _0x208ac6=await _0x3efe32['text']();console[_0x312900(0x1dd)]('Raw\x20Response\x20Body:',_0x208ac6);let _0x571c7f;try{_0x571c7f=JSON[_0x312900(0x20d)](_0x208ac6);}catch(_0x5777e2){console[_0x312900(0x225)](_0x312900(0x1ea),_0x5777e2),loggerService_1[_0x312900(0x1fd)][_0x312900(0x1fc)]('cointopay',_0x312900(0x1c2),_0x312900(0x1f2)+_0x5777e2);throw new Error(_0x312900(0x213)+_0x208ac6);}loggerService_1['loggerService'][_0x312900(0x1f4)]('cointopay',_0x312900(0x1c2),_0x3efe32['status'],_0x571c7f,_0x36dd6f),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x312900(0x1dd)](_0x312900(0x208),_0x571c7f['result']),console[_0x312900(0x1dd)](_0x312900(0x1ca),_0x571c7f[_0x312900(0x1ed)]),console[_0x312900(0x1dd)](_0x312900(0x1f7),_0x571c7f['data']?.[_0x312900(0x1b5)]),console['log'](_0x312900(0x1bb),_0x571c7f['data']?.[_0x312900(0x210)]),console[_0x312900(0x1dd)](_0x312900(0x230),_0x571c7f['data']?.[_0x312900(0x1f9)]);if(_0x571c7f[_0x312900(0x232)]!==_0x312900(0x1b1)||_0x571c7f[_0x312900(0x1ed)]!==0xc8){const _0x21fe09=_0x571c7f['message']||_0x312900(0x1ba);console[_0x312900(0x225)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x312900(0x225)]('Error\x20Message:',_0x21fe09),loggerService_1[_0x312900(0x1fd)][_0x312900(0x1fc)](_0x312900(0x1ee),'/status',_0x312900(0x202)+_0x21fe09);throw new Error(_0x312900(0x1e0)+_0x21fe09);}if(!_0x571c7f[_0x312900(0x21e)]){console[_0x312900(0x225)](_0x312900(0x21c)),console[_0x312900(0x225)](_0x312900(0x201)),loggerService_1[_0x312900(0x1fd)]['logWhiteDomainError']('cointopay',_0x312900(0x1c2),_0x312900(0x1b2));throw new Error(_0x312900(0x1de));}let _0x5c4c70=_0x312900(0x1be);switch(_0x571c7f['data'][_0x312900(0x1b5)]?.[_0x312900(0x229)]()){case _0x312900(0x1f0):_0x5c4c70=_0x312900(0x22c);break;case _0x312900(0x222):case _0x312900(0x226):case _0x312900(0x225):_0x5c4c70=_0x312900(0x1e8);break;case _0x312900(0x1f5):case'timeout':_0x5c4c70=_0x312900(0x1c1);break;case _0x312900(0x1d1):case _0x312900(0x204):case _0x312900(0x1c8):case _0x312900(0x22f):default:_0x5c4c70=_0x312900(0x1be);break;}let _0x1cc265,_0x28e9c9;if(_0x571c7f[_0x312900(0x21e)]['PaymentDetail']){const _0x58be5f=_0x571c7f['data'][_0x312900(0x1eb)];console[_0x312900(0x1dd)](_0x312900(0x1e5),_0x58be5f);const _0x1a37ed=_0x58be5f[_0x312900(0x212)](/IBAN\s+([A-Z0-9]+)/i);_0x1a37ed&&(_0x1cc265=_0x1a37ed[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x1cc265)),_0x28e9c9=_0x58be5f;}const _0x48c6ad={'iban':_0x1cc265,'bankDetails':_0x28e9c9,'transactionId':_0x571c7f[_0x312900(0x21e)][_0x312900(0x220)],'coinAddress':_0x571c7f[_0x312900(0x21e)][_0x312900(0x22a)],'qrCodeUrl':_0x571c7f[_0x312900(0x21e)][_0x312900(0x205)],'expiryTime':_0x571c7f[_0x312900(0x21e)][_0x312900(0x1c9)],'createdOn':_0x571c7f[_0x312900(0x21e)][_0x312900(0x21d)],'confirmedOn':_0x571c7f['data'][_0x312900(0x1d2)]};console[_0x312900(0x1dd)](_0x312900(0x1b4)),console[_0x312900(0x1dd)]('Status:',_0x571c7f[_0x312900(0x21e)][_0x312900(0x1b5)],'->',_0x5c4c70),console[_0x312900(0x1dd)](_0x312900(0x1bb),_0x571c7f[_0x312900(0x21e)][_0x312900(0x210)],_0x571c7f[_0x312900(0x21e)][_0x312900(0x1f9)]),console['log'](_0x312900(0x22b),_0x571c7f[_0x312900(0x21e)][_0x312900(0x220)]),console[_0x312900(0x1dd)](_0x312900(0x219),_0x1cc265||_0x312900(0x1b3)),console[_0x312900(0x1dd)](_0x312900(0x1fa),_0x571c7f[_0x312900(0x21e)][_0x312900(0x21d)]),console[_0x312900(0x1dd)](_0x312900(0x235),_0x571c7f[_0x312900(0x21e)][_0x312900(0x1d2)]||_0x312900(0x21f));if(_0x571c7f[_0x312900(0x21e)][_0x312900(0x1b5)]?.[_0x312900(0x229)]()===_0x312900(0x204))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x571c7f['data'][_0x312900(0x1b5)]?.['toLowerCase']()===_0x312900(0x1f0)&&console[_0x312900(0x1dd)](_0x312900(0x1b9));return{'status':_0x5c4c70,'amount':parseFloat(_0x571c7f['data'][_0x312900(0x210)])||undefined,'currency':_0x571c7f['data'][_0x312900(0x1f9)]||_0x312900(0x233),'paymentDetails':_0x48c6ad};}catch(_0x2932f2){console[_0x312900(0x225)](_0x312900(0x1e3),_0x2932f2),loggerService_1['loggerService'][_0x312900(0x1fc)](_0x312900(0x1ee),'/status',_0x2932f2);throw new Error(_0x312900(0x1d3)+(_0x2932f2 instanceof Error?_0x2932f2[_0x312900(0x1c5)]:'Unknown\x20error'));}}async[a43_0x317844(0x1b0)](_0x1f51c0){const _0x294d3f=a43_0x317844,_0x16c67f=await this[_0x294d3f(0x1f3)](_0x1f51c0);return{'status':_0x16c67f[_0x294d3f(0x1fe)],'amount':_0x16c67f['amount'],'currency':_0x16c67f[_0x294d3f(0x20a)]};}async['processWebhook'](_0x472e27){const _0x2e64f4=a43_0x317844;console[_0x2e64f4(0x1dd)](_0x2e64f4(0x200),_0x472e27);let _0x49389b='PENDING';switch(_0x472e27[_0x2e64f4(0x1fe)]?.[_0x2e64f4(0x229)]()){case _0x2e64f4(0x1f0):_0x49389b=_0x2e64f4(0x22c);break;case _0x2e64f4(0x222):case _0x2e64f4(0x226):case _0x2e64f4(0x225):_0x49389b='FAILED';break;case _0x2e64f4(0x1f5):case'timeout':_0x49389b=_0x2e64f4(0x1c1);break;case _0x2e64f4(0x1c8):case'waiting':case'awaiting\x20fiat':case _0x2e64f4(0x22f):default:_0x49389b='PENDING';break;}return{'paymentId':_0x472e27[_0x2e64f4(0x1c3)]||_0x472e27[_0x2e64f4(0x1e9)]||'','status':_0x49389b,'amount':_0x472e27[_0x2e64f4(0x228)],'currency':_0x472e27[_0x2e64f4(0x20a)]||_0x2e64f4(0x233)};}}exports[a43_0x317844(0x1dc)]=CoinToPayService;