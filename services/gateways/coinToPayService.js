'use strict';const a43_0x933c08=a43_0x2924;(function(_0x368906,_0x5e7963){const _0x3ec5c5=a43_0x2924,_0x8983c1=_0x368906();while(!![]){try{const _0x5f114e=-parseInt(_0x3ec5c5(0x1cc))/0x1+parseInt(_0x3ec5c5(0x19d))/0x2+-parseInt(_0x3ec5c5(0x1e5))/0x3*(parseInt(_0x3ec5c5(0x193))/0x4)+parseInt(_0x3ec5c5(0x1de))/0x5+parseInt(_0x3ec5c5(0x182))/0x6*(-parseInt(_0x3ec5c5(0x1b0))/0x7)+-parseInt(_0x3ec5c5(0x1cd))/0x8*(-parseInt(_0x3ec5c5(0x1fa))/0x9)+-parseInt(_0x3ec5c5(0x1f6))/0xa*(parseInt(_0x3ec5c5(0x19f))/0xb);if(_0x5f114e===_0x5e7963)break;else _0x8983c1['push'](_0x8983c1['shift']());}catch(_0x16f13e){_0x8983c1['push'](_0x8983c1['shift']());}}}(a43_0x37e8,0x9feb8));Object[a43_0x933c08(0x1a7)](exports,a43_0x933c08(0x197),{'value':!![]}),exports[a43_0x933c08(0x19e)]=void 0x0;const loggerService_1=require(a43_0x933c08(0x1c9));class CoinToPayService{constructor(){const _0xcc6722=a43_0x933c08;this['apiUrl']=_0xcc6722(0x1b2),this[_0xcc6722(0x1ec)]=_0xcc6722(0x200),console[_0xcc6722(0x17e)](_0xcc6722(0x1c8)),console[_0xcc6722(0x17e)]('📊\x20Status\x20check\x20URL:',this[_0xcc6722(0x1ec)]);}async[a43_0x933c08(0x1fb)](_0x119342){const _0x40f7b9=a43_0x933c08,{orderId:_0x16d578,amount:_0x2ea8ee}=_0x119342;console[_0x40f7b9(0x17e)](_0x40f7b9(0x1a1)+_0x2ea8ee+_0x40f7b9(0x1e0));const _0x41391c={'amount':_0x2ea8ee},_0x108a24=Date[_0x40f7b9(0x18b)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x40f7b9(0x17e)](_0x40f7b9(0x186),this['apiUrl']),console[_0x40f7b9(0x17e)]('Request\x20Body:',JSON[_0x40f7b9(0x1bd)](_0x41391c,null,0x2)),console['log']('Amount:',_0x2ea8ee,_0x40f7b9(0x1d4)),loggerService_1[_0x40f7b9(0x18f)]['logWhiteDomainRequest'](_0x40f7b9(0x1fd),_0x40f7b9(0x1e6),_0x40f7b9(0x1a0),_0x41391c);const _0x190bf7=await fetch(this[_0x40f7b9(0x1ee)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x40f7b9(0x1b7)},'body':JSON['stringify'](_0x41391c)}),_0x27d2d0=Date[_0x40f7b9(0x18b)]()-_0x108a24;console[_0x40f7b9(0x17e)](_0x40f7b9(0x1db)),console[_0x40f7b9(0x17e)](_0x40f7b9(0x1e3),_0x190bf7[_0x40f7b9(0x190)]),console['log'](_0x40f7b9(0x188),_0x190bf7[_0x40f7b9(0x192)]),console[_0x40f7b9(0x17e)](_0x40f7b9(0x1be),Object[_0x40f7b9(0x1d0)](_0x190bf7['headers'][_0x40f7b9(0x1b3)]())),console[_0x40f7b9(0x17e)](_0x40f7b9(0x1c7),_0x27d2d0+'ms');const _0x5946fa=await _0x190bf7[_0x40f7b9(0x1cf)]();console['log'](_0x40f7b9(0x19b),_0x5946fa);if(!_0x190bf7['ok']){console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1d8)),console[_0x40f7b9(0x1f4)]('HTTP\x20Status:',_0x190bf7['status']),console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1c1),_0x5946fa),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x40f7b9(0x1fd),'/create',_0x190bf7[_0x40f7b9(0x190)],_0x5946fa,_0x27d2d0),loggerService_1['loggerService'][_0x40f7b9(0x1b8)](_0x40f7b9(0x1fd),_0x40f7b9(0x1e6),'HTTP\x20'+_0x190bf7[_0x40f7b9(0x190)]+':\x20'+_0x5946fa);throw new Error('HTTP\x20error!\x20status:\x20'+_0x190bf7[_0x40f7b9(0x190)]+_0x40f7b9(0x18a)+_0x5946fa);}let _0x4349da;try{_0x4349da=JSON[_0x40f7b9(0x19c)](_0x5946fa);}catch(_0x2129f5){console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1ce),_0x2129f5),loggerService_1[_0x40f7b9(0x18f)][_0x40f7b9(0x1b8)]('cointopay',_0x40f7b9(0x1e6),'JSON\x20Parse\x20Error:\x20'+_0x2129f5);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5946fa);}console[_0x40f7b9(0x17e)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x40f7b9(0x17e)]('Parsed\x20Result:',JSON[_0x40f7b9(0x1bd)](_0x4349da,null,0x2)),loggerService_1[_0x40f7b9(0x18f)][_0x40f7b9(0x1f1)](_0x40f7b9(0x1fd),_0x40f7b9(0x1e6),_0x190bf7[_0x40f7b9(0x190)],_0x4349da,_0x27d2d0);if(_0x4349da[_0x40f7b9(0x1f4)]){const _0x371f49=_0x4349da[_0x40f7b9(0x1e2)]||_0x4349da[_0x40f7b9(0x1f4)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1ff)),console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1b6),_0x371f49),loggerService_1[_0x40f7b9(0x18f)]['logWhiteDomainError'](_0x40f7b9(0x1fd),_0x40f7b9(0x1e6),_0x40f7b9(0x1ae)+_0x371f49);throw new Error(_0x40f7b9(0x1e9)+_0x371f49);}if(!_0x4349da['payment_url']||!_0x4349da['gateway_payment_id']){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x40f7b9(0x1f4)](_0x40f7b9(0x1dc)),console[_0x40f7b9(0x1f4)]('Response\x20data:',_0x4349da),loggerService_1[_0x40f7b9(0x18f)][_0x40f7b9(0x1b8)]('cointopay',_0x40f7b9(0x1e6),_0x40f7b9(0x1ba));throw new Error(_0x40f7b9(0x1bb));}return console[_0x40f7b9(0x17e)](_0x40f7b9(0x1ad)),console[_0x40f7b9(0x17e)](_0x40f7b9(0x1c0),_0x4349da[_0x40f7b9(0x1c2)]),console[_0x40f7b9(0x17e)](_0x40f7b9(0x1d2),_0x4349da[_0x40f7b9(0x1c3)]),console['log']('Amount:',_0x2ea8ee,_0x40f7b9(0x1a5)),{'gateway_payment_id':_0x4349da[_0x40f7b9(0x1c2)],'payment_url':_0x4349da[_0x40f7b9(0x1c3)]};}catch(_0x57fe22){console[_0x40f7b9(0x1f4)](_0x40f7b9(0x18c)),console['error'](_0x40f7b9(0x1d3),_0x57fe22),loggerService_1[_0x40f7b9(0x18f)][_0x40f7b9(0x1b8)](_0x40f7b9(0x1fd),'/create',_0x57fe22);if(_0x57fe22 instanceof Error){console[_0x40f7b9(0x1f4)](_0x40f7b9(0x198),_0x57fe22[_0x40f7b9(0x1e2)]),console['error'](_0x40f7b9(0x1ab),_0x57fe22[_0x40f7b9(0x194)]);throw new Error(_0x40f7b9(0x1f9)+_0x57fe22[_0x40f7b9(0x1e2)]);}throw new Error(_0x40f7b9(0x1fc));}}async[a43_0x933c08(0x183)](_0x1b1769){const _0x3da05a=a43_0x933c08,_0x43ea1f=Date[_0x3da05a(0x18b)]();try{console[_0x3da05a(0x17e)](_0x3da05a(0x18e)+_0x1b1769);const _0x5f53a6={'gatewayPaymentId':_0x1b1769};loggerService_1[_0x3da05a(0x18f)][_0x3da05a(0x1ea)]('cointopay',_0x3da05a(0x1a4),'POST',_0x5f53a6);const _0x52cdcd=await fetch(this[_0x3da05a(0x1ec)],{'method':'POST','headers':{'Content-Type':_0x3da05a(0x187),'Accept':'application/json','User-Agent':_0x3da05a(0x1b7)},'body':JSON['stringify'](_0x5f53a6)}),_0x5b95db=Date[_0x3da05a(0x18b)]()-_0x43ea1f;console['log'](_0x3da05a(0x17f)),console[_0x3da05a(0x17e)]('Status:',_0x52cdcd[_0x3da05a(0x190)]),console[_0x3da05a(0x17e)](_0x3da05a(0x1c7),_0x5b95db+'ms');if(!_0x52cdcd['ok']){const _0x5d0d0d=await _0x52cdcd['text']();console['error'](_0x3da05a(0x1d6),_0x52cdcd['status']),console[_0x3da05a(0x1f4)](_0x3da05a(0x1c1),_0x5d0d0d),loggerService_1['loggerService'][_0x3da05a(0x1f1)](_0x3da05a(0x1fd),_0x3da05a(0x1a4),_0x52cdcd[_0x3da05a(0x190)],_0x5d0d0d,_0x5b95db),loggerService_1[_0x3da05a(0x18f)]['logWhiteDomainError'](_0x3da05a(0x1fd),_0x3da05a(0x1a4),_0x3da05a(0x1aa)+_0x52cdcd[_0x3da05a(0x190)]+':\x20'+_0x5d0d0d);throw new Error(_0x3da05a(0x1af)+_0x52cdcd[_0x3da05a(0x190)]);}const _0x49809a=await _0x52cdcd[_0x3da05a(0x1cf)]();console['log'](_0x3da05a(0x19b),_0x49809a);let _0x328a3c;try{_0x328a3c=JSON['parse'](_0x49809a);}catch(_0x259a99){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x259a99),loggerService_1[_0x3da05a(0x18f)][_0x3da05a(0x1b8)](_0x3da05a(0x1fd),_0x3da05a(0x1a4),_0x3da05a(0x1d1)+_0x259a99);throw new Error(_0x3da05a(0x1f5)+_0x49809a);}loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay','/status',_0x52cdcd[_0x3da05a(0x190)],_0x328a3c,_0x5b95db),console[_0x3da05a(0x17e)](_0x3da05a(0x191)),console[_0x3da05a(0x17e)](_0x3da05a(0x1a8),_0x328a3c[_0x3da05a(0x1fe)]),console[_0x3da05a(0x17e)]('Status\x20Code:',_0x328a3c[_0x3da05a(0x1ca)]),console[_0x3da05a(0x17e)](_0x3da05a(0x1f7),_0x328a3c[_0x3da05a(0x1ac)]?.[_0x3da05a(0x1a6)]),console[_0x3da05a(0x17e)](_0x3da05a(0x1d9),_0x328a3c[_0x3da05a(0x1ac)]?.[_0x3da05a(0x1bc)]),console[_0x3da05a(0x17e)]('Currency:',_0x328a3c[_0x3da05a(0x1ac)]?.[_0x3da05a(0x1d7)]);if(_0x328a3c[_0x3da05a(0x1fe)]!=='success'||_0x328a3c[_0x3da05a(0x1ca)]!==0xc8){const _0x214154=_0x328a3c['message']||_0x3da05a(0x18d);console[_0x3da05a(0x1f4)](_0x3da05a(0x1e4)),console['error'](_0x3da05a(0x1b6),_0x214154),loggerService_1['loggerService'][_0x3da05a(0x1b8)](_0x3da05a(0x1fd),_0x3da05a(0x1a4),_0x3da05a(0x181)+_0x214154);throw new Error(_0x3da05a(0x189)+_0x214154);}if(!_0x328a3c[_0x3da05a(0x1ac)]){console[_0x3da05a(0x1f4)](_0x3da05a(0x1ef)),console[_0x3da05a(0x1f4)](_0x3da05a(0x185)),loggerService_1[_0x3da05a(0x18f)][_0x3da05a(0x1b8)](_0x3da05a(0x1fd),_0x3da05a(0x1a4),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3da05a(0x1f8));}let _0x5f4aa4=_0x3da05a(0x1f0);switch(_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1a6)]?.[_0x3da05a(0x1c6)]()){case'paid':_0x5f4aa4='PAID';break;case _0x3da05a(0x1e8):case _0x3da05a(0x195):case _0x3da05a(0x1f4):_0x5f4aa4='FAILED';break;case _0x3da05a(0x1c5):case _0x3da05a(0x17c):_0x5f4aa4='EXPIRED';break;case'waiting':case _0x3da05a(0x180):case _0x3da05a(0x1dd):case _0x3da05a(0x1a2):default:_0x5f4aa4='PENDING';break;}let _0xbe4d5f,_0x178170;if(_0x328a3c['data'][_0x3da05a(0x1a9)]){const _0x1964f6=_0x328a3c['data'][_0x3da05a(0x1a9)];console[_0x3da05a(0x17e)](_0x3da05a(0x1f2),_0x1964f6);const _0x2daf85=_0x1964f6[_0x3da05a(0x1eb)](/IBAN\s+([A-Z0-9]+)/i);_0x2daf85&&(_0xbe4d5f=_0x2daf85[0x1],console[_0x3da05a(0x17e)]('🏦\x20Extracted\x20IBAN:',_0xbe4d5f)),_0x178170=_0x1964f6;}const _0x23c55e={'iban':_0xbe4d5f,'bankDetails':_0x178170,'transactionId':_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x17d)],'coinAddress':_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1b5)],'qrCodeUrl':_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1f3)],'expiryTime':_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x19a)],'createdOn':_0x328a3c[_0x3da05a(0x1ac)]['CreatedOn'],'confirmedOn':_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1df)]};console[_0x3da05a(0x17e)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3da05a(0x17e)](_0x3da05a(0x1e3),_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1a6)],'->',_0x5f4aa4),console[_0x3da05a(0x17e)](_0x3da05a(0x1d9),_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1bc)],_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1d7)]),console[_0x3da05a(0x17e)]('Transaction\x20ID:',_0x328a3c['data'][_0x3da05a(0x17d)]),console['log'](_0x3da05a(0x1d5),_0xbe4d5f||'not\x20found'),console[_0x3da05a(0x17e)](_0x3da05a(0x1a3),_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1b1)]),console[_0x3da05a(0x17e)]('Confirmed\x20On:',_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1df)]||_0x3da05a(0x1cb));if(_0x328a3c[_0x3da05a(0x1ac)]['Status']?.['toLowerCase']()===_0x3da05a(0x180))console[_0x3da05a(0x17e)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1a6)]?.[_0x3da05a(0x1c6)]()===_0x3da05a(0x1e1)&&console['log']('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5f4aa4,'amount':parseFloat(_0x328a3c[_0x3da05a(0x1ac)][_0x3da05a(0x1bc)])||undefined,'currency':_0x328a3c['data'][_0x3da05a(0x1d7)]||_0x3da05a(0x1a5),'paymentDetails':_0x23c55e};}catch(_0x44bc4c){console['error'](_0x3da05a(0x184),_0x44bc4c),loggerService_1['loggerService'][_0x3da05a(0x1b8)](_0x3da05a(0x1fd),_0x3da05a(0x1a4),_0x44bc4c);throw new Error(_0x3da05a(0x1ed)+(_0x44bc4c instanceof Error?_0x44bc4c['message']:_0x3da05a(0x1e7)));}}async[a43_0x933c08(0x199)](_0x8c0e05){const _0x9556a5=a43_0x933c08,_0x15b6d4=await this[_0x9556a5(0x183)](_0x8c0e05);return{'status':_0x15b6d4['status'],'amount':_0x15b6d4[_0x9556a5(0x17b)],'currency':_0x15b6d4[_0x9556a5(0x1b4)]};}async['processWebhook'](_0x395a06){const _0x2bbabf=a43_0x933c08;console[_0x2bbabf(0x17e)](_0x2bbabf(0x1c4),_0x395a06);let _0x2bb38c=_0x2bbabf(0x1f0);switch(_0x395a06[_0x2bbabf(0x190)]?.['toLowerCase']()){case _0x2bbabf(0x1e1):_0x2bb38c=_0x2bbabf(0x1da);break;case'cancelled':case'failed':case _0x2bbabf(0x1f4):_0x2bb38c='FAILED';break;case _0x2bbabf(0x1c5):case _0x2bbabf(0x17c):_0x2bb38c='EXPIRED';break;case'pending':case _0x2bbabf(0x196):case _0x2bbabf(0x180):case _0x2bbabf(0x1a2):default:_0x2bb38c=_0x2bbabf(0x1f0);break;}return{'paymentId':_0x395a06[_0x2bbabf(0x1b9)]||_0x395a06[_0x2bbabf(0x1bf)]||'','status':_0x2bb38c,'amount':_0x395a06[_0x2bbabf(0x17b)],'currency':_0x395a06[_0x2bbabf(0x1b4)]||_0x2bbabf(0x1a5)};}}function a43_0x37e8(){const _0x4caec7=['300apPpwT','Payment\x20Status:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','14526nmqyGT','createPaymentLink','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','cointopay','result','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/status.php','amount','timeout','TransactionID','log','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','awaiting\x20fiat','Status\x20API\x20Error:\x20','1229754SKYddT','checkPaymentStatus','CoinToPay\x20payment\x20status\x20check\x20error:','Missing\x20data\x20in\x20response','URL:','application/json','Status\x20Text:','CoinToPay\x20status\x20API\x20error:\x20',',\x20body:\x20','now','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','loggerService','status','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','statusText','4lqafps','stack','failed','waiting','__esModule','Error\x20message:','verifyPayment','ExpiryTime','Raw\x20Response\x20Body:','parse','902320zjMkgr','CoinToPayService','21406ApiSRH','POST','🪙\x20Creating\x20CoinToPay\x20payment:\x20','created','Created\x20On:','/status','EUR','Status','defineProperty','Result:','PaymentDetail','HTTP\x20','Error\x20stack:','data','===\x20COINTOPAY\x20SUCCESS\x20===','Business\x20Error:\x20','HTTP\x20error!\x20status:\x20','7VcTyNp','CreatedOn','https://tesoft.uk/gateway/cointopay/','entries','currency','coinAddress','Error\x20Message:','TesSoft\x20Payment\x20System/1.0','logWhiteDomainError','order_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Amount','stringify','Headers:','merchant_reference_id','Gateway\x20Payment\x20ID:','Response\x20Body:','gateway_payment_id','payment_url','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','expired','toLowerCase','Response\x20Time:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','../loggerService','status_code','not\x20confirmed','231249wacYqu','2936jKJHAl','Failed\x20to\x20parse\x20JSON\x20response:','text','fromEntries','JSON\x20Parse\x20Error:\x20','Payment\x20URL:','Error\x20details:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','IBAN:','HTTP\x20Status:','inputCurrency','===\x20COINTOPAY\x20API\x20ERROR\x20===','Amount:','PAID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','pending','2054215gcTMxz','TransactionConfirmedOn','\x20EUR','paid','message','Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','914163USsSsh','/create','Unknown\x20error','cancelled','CoinToPay\x20API\x20error:\x20','logWhiteDomainRequest','match','statusUrl','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','apiUrl','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','logWhiteDomainResponse','🏦\x20Payment\x20Detail:','QRCodeURL','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'];a43_0x37e8=function(){return _0x4caec7;};return a43_0x37e8();}function a43_0x2924(_0x4ac257,_0x5ad0c7){const _0x37e810=a43_0x37e8();return a43_0x2924=function(_0x2924ef,_0x40e326){_0x2924ef=_0x2924ef-0x17b;let _0x324369=_0x37e810[_0x2924ef];return _0x324369;},a43_0x2924(_0x4ac257,_0x5ad0c7);}exports['CoinToPayService']=CoinToPayService;