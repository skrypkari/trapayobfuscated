'use strict';const a38_0x1aba11=a38_0x56b8;(function(_0x5445c3,_0x29c77e){const _0xb4731a=a38_0x56b8,_0x47cdae=_0x5445c3();while(!![]){try{const _0xf8d962=parseInt(_0xb4731a(0x19c))/0x1+parseInt(_0xb4731a(0x1cf))/0x2+parseInt(_0xb4731a(0x1be))/0x3*(-parseInt(_0xb4731a(0x203))/0x4)+parseInt(_0xb4731a(0x212))/0x5+-parseInt(_0xb4731a(0x1dc))/0x6*(-parseInt(_0xb4731a(0x215))/0x7)+parseInt(_0xb4731a(0x1d5))/0x8*(parseInt(_0xb4731a(0x216))/0x9)+-parseInt(_0xb4731a(0x1c3))/0xa*(parseInt(_0xb4731a(0x207))/0xb);if(_0xf8d962===_0x29c77e)break;else _0x47cdae['push'](_0x47cdae['shift']());}catch(_0x1581cb){_0x47cdae['push'](_0x47cdae['shift']());}}}(a38_0x5182,0xd951c));function a38_0x56b8(_0x13d317,_0xdd5069){const _0x51821e=a38_0x5182();return a38_0x56b8=function(_0x56b82b,_0x268cc7){_0x56b82b=_0x56b82b-0x196;let _0x387e14=_0x51821e[_0x56b82b];return _0x387e14;},a38_0x56b8(_0x13d317,_0xdd5069);}Object['defineProperty'](exports,a38_0x1aba11(0x202),{'value':!![]}),exports[a38_0x1aba11(0x1e7)]=void 0x0;function a38_0x5182(){const _0x1a1b5f=['https://tesoft.uk/gateway/cointopay/status.php','stack','EXPIRED','message','Payment\x20URL:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','payment_url','1705260vyByJD','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','../loggerService','POST','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','16FXlvtJ','apiUrl','timeout','order_id','JSON\x20Parse\x20Error:\x20','created','QRCodeURL','6DsvcNq','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','parse','Unknown\x20error','stringify','application/json','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cancelled','status_code','Error\x20details:','CoinToPayService','paid','cointopay','verifyPayment','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','IBAN:','CoinToPay\x20payment\x20status\x20check\x20error:','Transaction\x20ID:','failed','Failed\x20to\x20parse\x20JSON\x20response:','Status\x20Code:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','text','fromEntries','===\x20COINTOPAY\x20SUCCESS\x20===','gateway_payment_id','üìä\x20Status\x20check\x20URL:','Payment\x20Status:','logWhiteDomainRequest','logWhiteDomainResponse','üè¶\x20Extracted\x20IBAN:','pending','Result:','Amount','URL:','success','__esModule','8584IQKGvs','ExpiryTime','Error\x20stack:','result','913LlqSKn','HTTP\x20','now','coinAddress','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Error\x20Message:','toLowerCase','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Currency:','FAILED','not\x20confirmed','37225yWIvVL','Headers:','CoinToPay\x20API\x20error:\x20','5888015MdnFJY','5156208fdJKqS','entries','headers','inputCurrency','Amount:','PaymentDetail','PAID','HTTP\x20Status:','/status','TesSoft\x20Payment\x20System/1.0','expired','TransactionID','checkPaymentStatus','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','271749PwJhFE','loggerService','Response\x20data:','Status\x20Text:','waiting','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Status','Parsed\x20Result:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','/create','Unknown\x20error\x20from\x20CoinToPay\x20API','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','log','Response\x20Body:','data','awaiting\x20fiat','PENDING','processWebhook','\x20EUR','Missing\x20data\x20in\x20response','error','EUR','Request\x20Body:','currency','Created\x20On:','Raw\x20Response\x20Body:','CreatedOn','TransactionConfirmedOn','Response\x20Time:','match','2319TgVwHY','status','HTTP\x20error!\x20status:\x20','createPaymentLink','merchant_reference_id','68650gJLCKx','===\x20COINTOPAY\x20API\x20ERROR\x20===','statusText','statusUrl','CoinToPay\x20status\x20API\x20error:\x20'];a38_0x5182=function(){return _0x1a1b5f;};return a38_0x5182();}const loggerService_1=require(a38_0x1aba11(0x1d2));class CoinToPayService{constructor(){const _0x296915=a38_0x1aba11;this[_0x296915(0x1d6)]='https://tesoft.uk/gateway/cointopay/',this[_0x296915(0x1c6)]=_0x296915(0x1c8),console[_0x296915(0x1ac)](_0x296915(0x1aa)),console[_0x296915(0x1ac)](_0x296915(0x1f8),this[_0x296915(0x1c6)]);}async[a38_0x1aba11(0x1c1)](_0x5c7753){const _0x4933bb=a38_0x1aba11,{orderId:_0x599eba,amount:_0x542680}=_0x5c7753;console[_0x4933bb(0x1ac)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x542680+_0x4933bb(0x1b2));const _0x3cb6da={'amount':_0x542680},_0x28a112=Date[_0x4933bb(0x209)]();try{console[_0x4933bb(0x1ac)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x4933bb(0x1ac)](_0x4933bb(0x200),this[_0x4933bb(0x1d6)]),console['log'](_0x4933bb(0x1b6),JSON[_0x4933bb(0x1e1)](_0x3cb6da,null,0x2)),console['log']('Amount:',_0x542680,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x4933bb(0x19d)][_0x4933bb(0x1fa)](_0x4933bb(0x1e9),'/create',_0x4933bb(0x1d3),_0x3cb6da);const _0x2d0546=await fetch(this['apiUrl'],{'method':_0x4933bb(0x1d3),'headers':{'Content-Type':_0x4933bb(0x1e2),'Accept':'application/json','User-Agent':_0x4933bb(0x197)},'body':JSON['stringify'](_0x3cb6da)}),_0x418db9=Date[_0x4933bb(0x209)]()-_0x28a112;console[_0x4933bb(0x1ac)](_0x4933bb(0x1a8)),console[_0x4933bb(0x1ac)](_0x4933bb(0x1a9),_0x2d0546[_0x4933bb(0x1bf)]),console[_0x4933bb(0x1ac)](_0x4933bb(0x19f),_0x2d0546[_0x4933bb(0x1c5)]),console[_0x4933bb(0x1ac)](_0x4933bb(0x213),Object[_0x4933bb(0x1f5)](_0x2d0546[_0x4933bb(0x218)][_0x4933bb(0x217)]())),console['log'](_0x4933bb(0x1bc),_0x418db9+'ms');const _0x54a50b=await _0x2d0546[_0x4933bb(0x1f4)]();console['log'](_0x4933bb(0x1b9),_0x54a50b);if(!_0x2d0546['ok']){console['error'](_0x4933bb(0x1c4)),console['error'](_0x4933bb(0x21d),_0x2d0546['status']),console[_0x4933bb(0x1b4)](_0x4933bb(0x1ad),_0x54a50b),loggerService_1[_0x4933bb(0x19d)][_0x4933bb(0x1fb)](_0x4933bb(0x1e9),_0x4933bb(0x1a5),_0x2d0546[_0x4933bb(0x1bf)],_0x54a50b,_0x418db9),loggerService_1['loggerService'][_0x4933bb(0x1de)](_0x4933bb(0x1e9),_0x4933bb(0x1a5),_0x4933bb(0x208)+_0x2d0546[_0x4933bb(0x1bf)]+':\x20'+_0x54a50b);throw new Error(_0x4933bb(0x1c0)+_0x2d0546[_0x4933bb(0x1bf)]+',\x20body:\x20'+_0x54a50b);}let _0x1e4d3b;try{_0x1e4d3b=JSON[_0x4933bb(0x1df)](_0x54a50b);}catch(_0x221e7d){console[_0x4933bb(0x1b4)](_0x4933bb(0x1f0),_0x221e7d),loggerService_1[_0x4933bb(0x19d)][_0x4933bb(0x1de)](_0x4933bb(0x1e9),_0x4933bb(0x1a5),_0x4933bb(0x1d9)+_0x221e7d);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x54a50b);}console['log'](_0x4933bb(0x1a1)),console[_0x4933bb(0x1ac)](_0x4933bb(0x1a3),JSON[_0x4933bb(0x1e1)](_0x1e4d3b,null,0x2)),loggerService_1[_0x4933bb(0x19d)]['logWhiteDomainResponse'](_0x4933bb(0x1e9),'/create',_0x2d0546[_0x4933bb(0x1bf)],_0x1e4d3b,_0x418db9);if(_0x1e4d3b['error']){const _0x28bfa8=_0x1e4d3b[_0x4933bb(0x1cb)]||_0x1e4d3b[_0x4933bb(0x1b4)]||_0x4933bb(0x1a6);console[_0x4933bb(0x1b4)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x4933bb(0x1b4)](_0x4933bb(0x20c),_0x28bfa8),loggerService_1[_0x4933bb(0x19d)][_0x4933bb(0x1de)](_0x4933bb(0x1e9),_0x4933bb(0x1a5),_0x4933bb(0x1a7)+_0x28bfa8);throw new Error(_0x4933bb(0x214)+_0x28bfa8);}if(!_0x1e4d3b[_0x4933bb(0x1ce)]||!_0x1e4d3b[_0x4933bb(0x1f7)]){console[_0x4933bb(0x1b4)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4933bb(0x1b4)](_0x4933bb(0x1d1)),console[_0x4933bb(0x1b4)](_0x4933bb(0x19e),_0x1e4d3b),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x4933bb(0x1a5),_0x4933bb(0x19b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x4933bb(0x1ac)](_0x4933bb(0x1f6)),console[_0x4933bb(0x1ac)]('Gateway\x20Payment\x20ID:',_0x1e4d3b[_0x4933bb(0x1f7)]),console[_0x4933bb(0x1ac)](_0x4933bb(0x1cc),_0x1e4d3b[_0x4933bb(0x1ce)]),console['log'](_0x4933bb(0x21a),_0x542680,_0x4933bb(0x1b5)),{'gateway_payment_id':_0x1e4d3b[_0x4933bb(0x1f7)],'payment_url':_0x1e4d3b[_0x4933bb(0x1ce)]};}catch(_0x53c5a2){console['error'](_0x4933bb(0x1eb)),console['error'](_0x4933bb(0x1e6),_0x53c5a2),loggerService_1[_0x4933bb(0x19d)][_0x4933bb(0x1de)](_0x4933bb(0x1e9),_0x4933bb(0x1a5),_0x53c5a2);if(_0x53c5a2 instanceof Error){console[_0x4933bb(0x1b4)]('Error\x20message:',_0x53c5a2[_0x4933bb(0x1cb)]),console[_0x4933bb(0x1b4)](_0x4933bb(0x205),_0x53c5a2[_0x4933bb(0x1c9)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x53c5a2['message']);}throw new Error(_0x4933bb(0x1f3));}}async[a38_0x1aba11(0x19a)](_0x65e032){const _0x2c99aa=a38_0x1aba11,_0x18b95f=Date[_0x2c99aa(0x209)]();try{console[_0x2c99aa(0x1ac)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x65e032);const _0x248f1a={'gatewayPaymentId':_0x65e032};loggerService_1['loggerService'][_0x2c99aa(0x1fa)]('cointopay',_0x2c99aa(0x196),_0x2c99aa(0x1d3),_0x248f1a);const _0x85c1a9=await fetch(this[_0x2c99aa(0x1c6)],{'method':_0x2c99aa(0x1d3),'headers':{'Content-Type':_0x2c99aa(0x1e2),'Accept':'application/json','User-Agent':_0x2c99aa(0x197)},'body':JSON['stringify'](_0x248f1a)}),_0x39d780=Date[_0x2c99aa(0x209)]()-_0x18b95f;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1a9),_0x85c1a9[_0x2c99aa(0x1bf)]),console[_0x2c99aa(0x1ac)]('Response\x20Time:',_0x39d780+'ms');if(!_0x85c1a9['ok']){const _0x1e3a03=await _0x85c1a9[_0x2c99aa(0x1f4)]();console[_0x2c99aa(0x1b4)]('HTTP\x20Status:',_0x85c1a9['status']),console['error']('Response\x20Body:',_0x1e3a03),loggerService_1[_0x2c99aa(0x19d)][_0x2c99aa(0x1fb)](_0x2c99aa(0x1e9),_0x2c99aa(0x196),_0x85c1a9['status'],_0x1e3a03,_0x39d780),loggerService_1[_0x2c99aa(0x19d)][_0x2c99aa(0x1de)](_0x2c99aa(0x1e9),_0x2c99aa(0x196),_0x2c99aa(0x208)+_0x85c1a9[_0x2c99aa(0x1bf)]+':\x20'+_0x1e3a03);throw new Error(_0x2c99aa(0x1c0)+_0x85c1a9[_0x2c99aa(0x1bf)]);}const _0x4ff6de=await _0x85c1a9[_0x2c99aa(0x1f4)]();console['log'](_0x2c99aa(0x1b9),_0x4ff6de);let _0x300324;try{_0x300324=JSON[_0x2c99aa(0x1df)](_0x4ff6de);}catch(_0x193b1a){console[_0x2c99aa(0x1b4)](_0x2c99aa(0x1f0),_0x193b1a),loggerService_1[_0x2c99aa(0x19d)][_0x2c99aa(0x1de)](_0x2c99aa(0x1e9),_0x2c99aa(0x196),_0x2c99aa(0x1d9)+_0x193b1a);throw new Error(_0x2c99aa(0x1e3)+_0x4ff6de);}loggerService_1[_0x2c99aa(0x19d)][_0x2c99aa(0x1fb)](_0x2c99aa(0x1e9),_0x2c99aa(0x196),_0x85c1a9['status'],_0x300324,_0x39d780),console[_0x2c99aa(0x1ac)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1fe),_0x300324[_0x2c99aa(0x206)]),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1f1),_0x300324['status_code']),console['log'](_0x2c99aa(0x1f9),_0x300324['data']?.[_0x2c99aa(0x1a2)]),console['log'](_0x2c99aa(0x21a),_0x300324['data']?.[_0x2c99aa(0x1ff)]),console['log'](_0x2c99aa(0x20f),_0x300324[_0x2c99aa(0x1ae)]?.[_0x2c99aa(0x219)]);if(_0x300324[_0x2c99aa(0x206)]!==_0x2c99aa(0x201)||_0x300324[_0x2c99aa(0x1e5)]!==0xc8){const _0x3838ae=_0x300324['message']||_0x2c99aa(0x1d0);console[_0x2c99aa(0x1b4)](_0x2c99aa(0x1f2)),console['error'](_0x2c99aa(0x20c),_0x3838ae),loggerService_1[_0x2c99aa(0x19d)][_0x2c99aa(0x1de)]('cointopay','/status','Status\x20API\x20Error:\x20'+_0x3838ae);throw new Error(_0x2c99aa(0x1c7)+_0x3838ae);}if(!_0x300324['data']){console[_0x2c99aa(0x1b4)](_0x2c99aa(0x1dd)),console[_0x2c99aa(0x1b4)](_0x2c99aa(0x1b3)),loggerService_1['loggerService'][_0x2c99aa(0x1de)](_0x2c99aa(0x1e9),_0x2c99aa(0x196),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x2c99aa(0x20e));}let _0x105551=_0x2c99aa(0x1b0);switch(_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1a2)]?.['toLowerCase']()){case _0x2c99aa(0x1e8):_0x105551=_0x2c99aa(0x21c);break;case'cancelled':case _0x2c99aa(0x1ef):case _0x2c99aa(0x1b4):_0x105551=_0x2c99aa(0x210);break;case _0x2c99aa(0x198):case _0x2c99aa(0x1d7):_0x105551=_0x2c99aa(0x1ca);break;case'waiting':case'awaiting\x20fiat':case _0x2c99aa(0x1fd):case _0x2c99aa(0x1da):default:_0x105551=_0x2c99aa(0x1b0);break;}let _0x48a3e8,_0x44aa66;if(_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x21b)]){const _0x5cd407=_0x300324[_0x2c99aa(0x1ae)]['PaymentDetail'];console['log']('üè¶\x20Payment\x20Detail:',_0x5cd407);const _0x592adb=_0x5cd407[_0x2c99aa(0x1bd)](/IBAN\s+([A-Z0-9]+)/i);_0x592adb&&(_0x48a3e8=_0x592adb[0x1],console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1fc),_0x48a3e8)),_0x44aa66=_0x5cd407;}const _0x58a968={'iban':_0x48a3e8,'bankDetails':_0x44aa66,'transactionId':_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x199)],'coinAddress':_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x20a)],'qrCodeUrl':_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1db)],'expiryTime':_0x300324['data'][_0x2c99aa(0x204)],'createdOn':_0x300324['data']['CreatedOn'],'confirmedOn':_0x300324['data']['TransactionConfirmedOn']};console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1d4)),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1a9),_0x300324['data'][_0x2c99aa(0x1a2)],'->',_0x105551),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x21a),_0x300324['data'][_0x2c99aa(0x1ff)],_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x219)]),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1ee),_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x199)]),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1ec),_0x48a3e8||'not\x20found'),console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1b8),_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1ba)]),console[_0x2c99aa(0x1ac)]('Confirmed\x20On:',_0x300324['data'][_0x2c99aa(0x1bb)]||_0x2c99aa(0x211));if(_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1a2)]?.['toLowerCase']()===_0x2c99aa(0x1af))console[_0x2c99aa(0x1ac)](_0x2c99aa(0x1ab));else _0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1a2)]?.[_0x2c99aa(0x20d)]()==='paid'&&console[_0x2c99aa(0x1ac)](_0x2c99aa(0x20b));return{'status':_0x105551,'amount':parseFloat(_0x300324[_0x2c99aa(0x1ae)][_0x2c99aa(0x1ff)])||undefined,'currency':_0x300324[_0x2c99aa(0x1ae)]['inputCurrency']||_0x2c99aa(0x1b5),'paymentDetails':_0x58a968};}catch(_0x185567){console[_0x2c99aa(0x1b4)](_0x2c99aa(0x1ed),_0x185567),loggerService_1[_0x2c99aa(0x19d)]['logWhiteDomainError']('cointopay','/status',_0x185567);throw new Error(_0x2c99aa(0x1a4)+(_0x185567 instanceof Error?_0x185567[_0x2c99aa(0x1cb)]:_0x2c99aa(0x1e0)));}}async[a38_0x1aba11(0x1ea)](_0x106f0a){const _0x45d6cb=a38_0x1aba11,_0x191d50=await this[_0x45d6cb(0x19a)](_0x106f0a);return{'status':_0x191d50['status'],'amount':_0x191d50['amount'],'currency':_0x191d50['currency']};}async[a38_0x1aba11(0x1b1)](_0x3ade0a){const _0x552a2d=a38_0x1aba11;console['log'](_0x552a2d(0x1cd),_0x3ade0a);let _0x453692='PENDING';switch(_0x3ade0a[_0x552a2d(0x1bf)]?.[_0x552a2d(0x20d)]()){case _0x552a2d(0x1e8):_0x453692='PAID';break;case _0x552a2d(0x1e4):case _0x552a2d(0x1ef):case _0x552a2d(0x1b4):_0x453692=_0x552a2d(0x210);break;case _0x552a2d(0x198):case'timeout':_0x453692=_0x552a2d(0x1ca);break;case _0x552a2d(0x1fd):case _0x552a2d(0x1a0):case'awaiting\x20fiat':case'created':default:_0x453692='PENDING';break;}return{'paymentId':_0x3ade0a[_0x552a2d(0x1d8)]||_0x3ade0a[_0x552a2d(0x1c2)]||'','status':_0x453692,'amount':_0x3ade0a['amount'],'currency':_0x3ade0a[_0x552a2d(0x1b7)]||_0x552a2d(0x1b5)};}}exports[a38_0x1aba11(0x1e7)]=CoinToPayService;