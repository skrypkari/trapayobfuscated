'use strict';const a65_0x5d94ef=a65_0x361b;function a65_0x355c(){const _0x27ddd6=['POST','1095410kbtRmh','FAILED','EUR','Failed\x20to\x20parse\x20JSON\x20response:','message','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Unknown\x20error','timeout','cancelled','Created\x20On:','12OGcpNi','Status:','CoinToPay\x20payment\x20status\x20check\x20error:','payment_url','595nApiRG','31448HXmVAX','application/json','currency','createPaymentLink','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','cointopay','Gateway\x20Payment\x20ID:','Raw\x20Response\x20Body:','QRCodeURL','3367227NQCTEr','expired','merchant_reference_id','coinAddress','../loggerService','processWebhook','12259331QNkWQp','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','checkPaymentStatus','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','CoinToPayService','status','PaymentDetail','paid','loggerService','81aPMxLz','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','failed','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','__esModule','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','success','order_id','Transaction\x20ID:','ðŸ“Š\x20Status\x20check\x20URL:','statusUrl',',\x20body:\x20','https://tesoft.uk/gateway/cointopay/status.php','Error\x20Message:','Currency:','CoinToPay\x20API\x20error:\x20','inputCurrency','EXPIRED','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','ExpiryTime','not\x20confirmed','now','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','/status','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status','Request\x20Body:','Amount','Payment\x20URL\x20(modified):','Result:','data','log','not\x20found','amount','CreatedOn','Payment\x20System/1.0','headers','HTTP\x20','PENDING','608578eqvaRo','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Payment\x20Status:','JSON\x20Parse\x20Error:\x20','Status\x20API\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','11314824DQiVKK','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','apiUrl','===\x20COINTOPAY\x20API\x20ERROR\x20===','CoinToPay\x20status\x20API\x20error:\x20','status_code','text','6vRDhQe','URL:','/create','Business\x20Error:\x20','logWhiteDomainRequest','fromEntries','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','created','Parsed\x20Result:','error','\x20EUR','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','&alternative=false','awaiting\x20fiat','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20stack:','===\x20COINTOPAY\x20SUCCESS\x20===','stack','gateway_payment_id','21829907qUulbf','Confirmed\x20On:','ðŸ¦\x20Extracted\x20IBAN:','3gybmqc','logWhiteDomainResponse','parse','toLowerCase','verifyPayment','Response\x20Time:','https://tesoft.uk/gateway/cointopay/','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','HTTP\x20Status:','stringify','pending','HTTP\x20error!\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','waiting','PAID','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','TransactionID','defineProperty','IBAN:','logWhiteDomainError','Headers:'];a65_0x355c=function(){return _0x27ddd6;};return a65_0x355c();}(function(_0x62e867,_0x3f4566){const _0x46f1d8=a65_0x361b,_0x5b39ad=_0x62e867();while(!![]){try{const _0x7dbd3f=parseInt(_0x46f1d8(0x1a1))/0x1*(-parseInt(_0x46f1d8(0x17c))/0x2)+parseInt(_0x46f1d8(0x1d0))/0x3+-parseInt(_0x46f1d8(0x1c7))/0x4*(-parseInt(_0x46f1d8(0x1c6))/0x5)+parseInt(_0x46f1d8(0x18a))/0x6*(-parseInt(_0x46f1d8(0x1d6))/0x7)+-parseInt(_0x46f1d8(0x183))/0x8+parseInt(_0x46f1d8(0x1e0))/0x9*(parseInt(_0x46f1d8(0x1b8))/0xa)+parseInt(_0x46f1d8(0x19e))/0xb*(parseInt(_0x46f1d8(0x1c2))/0xc);if(_0x7dbd3f===_0x3f4566)break;else _0x5b39ad['push'](_0x5b39ad['shift']());}catch(_0xa20dbf){_0x5b39ad['push'](_0x5b39ad['shift']());}}}(a65_0x355c,0xe7e50));function a65_0x361b(_0x523f7e,_0x2ca45a){_0x523f7e=_0x523f7e-0x15c;const _0x355c0e=a65_0x355c();let _0x361be2=_0x355c0e[_0x523f7e];return _0x361be2;}Object[a65_0x5d94ef(0x1b3)](exports,a65_0x5d94ef(0x1e5),{'value':!![]}),exports[a65_0x5d94ef(0x1db)]=void 0x0;const loggerService_1=require(a65_0x5d94ef(0x1d4));class CoinToPayService{constructor(){const _0x5c99e1=a65_0x5d94ef;this['apiUrl']=_0x5c99e1(0x1a7),this['statusUrl']=_0x5c99e1(0x160),console['log'](_0x5c99e1(0x198)),console['log'](_0x5c99e1(0x15d),this[_0x5c99e1(0x15e)]);}async[a65_0x5d94ef(0x1ca)](_0x32ab90){const _0x58cfb8=a65_0x5d94ef,{orderId:_0x59c679,amount:_0x374d11}=_0x32ab90;console[_0x58cfb8(0x174)](_0x58cfb8(0x1cb)+_0x374d11+_0x58cfb8(0x194));const _0x502952={'amount':_0x374d11},_0x2fe1d2=Date[_0x58cfb8(0x169)]();try{console[_0x58cfb8(0x174)](_0x58cfb8(0x17d)),console[_0x58cfb8(0x174)](_0x58cfb8(0x18b),this[_0x58cfb8(0x185)]),console[_0x58cfb8(0x174)](_0x58cfb8(0x16f),JSON[_0x58cfb8(0x1aa)](_0x502952,null,0x2)),console['log'](_0x58cfb8(0x16b),_0x374d11,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x58cfb8(0x1df)][_0x58cfb8(0x18e)](_0x58cfb8(0x1cc),'/create','POST',_0x502952);const _0x419fd9=await fetch(this[_0x58cfb8(0x185)],{'method':_0x58cfb8(0x1b7),'headers':{'Content-Type':_0x58cfb8(0x1c8),'Accept':_0x58cfb8(0x1c8),'User-Agent':_0x58cfb8(0x178)},'body':JSON['stringify'](_0x502952)}),_0x5d42db=Date['now']()-_0x2fe1d2;console[_0x58cfb8(0x174)](_0x58cfb8(0x195)),console['log'](_0x58cfb8(0x1c3),_0x419fd9[_0x58cfb8(0x1dc)]),console[_0x58cfb8(0x174)]('Status\x20Text:',_0x419fd9['statusText']),console['log'](_0x58cfb8(0x1b6),Object[_0x58cfb8(0x18f)](_0x419fd9[_0x58cfb8(0x179)]['entries']())),console['log'](_0x58cfb8(0x1a6),_0x5d42db+'ms');const _0x16fb39=await _0x419fd9['text']();console['log'](_0x58cfb8(0x1ce),_0x16fb39);if(!_0x419fd9['ok']){console[_0x58cfb8(0x193)](_0x58cfb8(0x186)),console[_0x58cfb8(0x193)](_0x58cfb8(0x1a9),_0x419fd9[_0x58cfb8(0x1dc)]),console[_0x58cfb8(0x193)]('Response\x20Body:',_0x16fb39),loggerService_1['loggerService'][_0x58cfb8(0x1a2)](_0x58cfb8(0x1cc),_0x58cfb8(0x18c),_0x419fd9[_0x58cfb8(0x1dc)],_0x16fb39,_0x5d42db),loggerService_1[_0x58cfb8(0x1df)][_0x58cfb8(0x1b5)](_0x58cfb8(0x1cc),_0x58cfb8(0x18c),'HTTP\x20'+_0x419fd9[_0x58cfb8(0x1dc)]+':\x20'+_0x16fb39);throw new Error(_0x58cfb8(0x1ac)+_0x419fd9['status']+_0x58cfb8(0x15f)+_0x16fb39);}let _0x4e6878;try{_0x4e6878=JSON[_0x58cfb8(0x1a3)](_0x16fb39);}catch(_0x2e293c){console[_0x58cfb8(0x193)](_0x58cfb8(0x1bb),_0x2e293c),loggerService_1[_0x58cfb8(0x1df)][_0x58cfb8(0x1b5)](_0x58cfb8(0x1cc),'/create','JSON\x20Parse\x20Error:\x20'+_0x2e293c);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x16fb39);}console[_0x58cfb8(0x174)](_0x58cfb8(0x1e4)),console[_0x58cfb8(0x174)](_0x58cfb8(0x192),JSON[_0x58cfb8(0x1aa)](_0x4e6878,null,0x2)),loggerService_1['loggerService'][_0x58cfb8(0x1a2)](_0x58cfb8(0x1cc),'/create',_0x419fd9['status'],_0x4e6878,_0x5d42db);if(_0x4e6878['error']){const _0x1c3705=_0x4e6878[_0x58cfb8(0x1bc)]||_0x4e6878[_0x58cfb8(0x193)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x58cfb8(0x193)](_0x58cfb8(0x1b1)),console[_0x58cfb8(0x193)]('Error\x20Message:',_0x1c3705),loggerService_1[_0x58cfb8(0x1df)]['logWhiteDomainError'](_0x58cfb8(0x1cc),_0x58cfb8(0x18c),_0x58cfb8(0x18d)+_0x1c3705);throw new Error(_0x58cfb8(0x163)+_0x1c3705);}if(!_0x4e6878[_0x58cfb8(0x1c5)]||!_0x4e6878[_0x58cfb8(0x19d)]){console[_0x58cfb8(0x193)](_0x58cfb8(0x16a)),console['error'](_0x58cfb8(0x1bd)),console[_0x58cfb8(0x193)]('Response\x20data:',_0x4e6878),loggerService_1['loggerService'][_0x58cfb8(0x1b5)](_0x58cfb8(0x1cc),_0x58cfb8(0x18c),_0x58cfb8(0x1d7));throw new Error(_0x58cfb8(0x182));}console[_0x58cfb8(0x174)](_0x58cfb8(0x19b)),console['log'](_0x58cfb8(0x1cd),_0x4e6878[_0x58cfb8(0x19d)]),console[_0x58cfb8(0x174)](_0x58cfb8(0x1b0),_0x4e6878[_0x58cfb8(0x1c5)]);const _0x176265=_0x4e6878[_0x58cfb8(0x1c5)]+_0x58cfb8(0x196);return console['log'](_0x58cfb8(0x171),_0x176265),console[_0x58cfb8(0x174)](_0x58cfb8(0x16b),_0x374d11,_0x58cfb8(0x1ba)),{'gateway_payment_id':_0x4e6878[_0x58cfb8(0x19d)],'payment_url':_0x176265};}catch(_0x4b338c){console[_0x58cfb8(0x193)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x4b338c),loggerService_1[_0x58cfb8(0x1df)][_0x58cfb8(0x1b5)]('cointopay',_0x58cfb8(0x18c),_0x4b338c);if(_0x4b338c instanceof Error){console[_0x58cfb8(0x193)]('Error\x20message:',_0x4b338c['message']),console[_0x58cfb8(0x193)](_0x58cfb8(0x19a),_0x4b338c[_0x58cfb8(0x19c)]);throw new Error(_0x58cfb8(0x199)+_0x4b338c[_0x58cfb8(0x1bc)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x293df7){const _0x381e25=a65_0x5d94ef,_0x3d0fb6=Date[_0x381e25(0x169)]();try{console[_0x381e25(0x174)]('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x293df7);const _0x2018e9={'gatewayPaymentId':_0x293df7};loggerService_1[_0x381e25(0x1df)][_0x381e25(0x18e)](_0x381e25(0x1cc),_0x381e25(0x16c),_0x381e25(0x1b7),_0x2018e9);const _0x3900ff=await fetch(this['statusUrl'],{'method':_0x381e25(0x1b7),'headers':{'Content-Type':_0x381e25(0x1c8),'Accept':'application/json','User-Agent':_0x381e25(0x178)},'body':JSON[_0x381e25(0x1aa)](_0x2018e9)}),_0x499ad9=Date[_0x381e25(0x169)]()-_0x3d0fb6;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x381e25(0x174)]('Status:',_0x3900ff[_0x381e25(0x1dc)]),console['log'](_0x381e25(0x1a6),_0x499ad9+'ms');if(!_0x3900ff['ok']){const _0x1e64a2=await _0x3900ff[_0x381e25(0x189)]();console[_0x381e25(0x193)]('HTTP\x20Status:',_0x3900ff[_0x381e25(0x1dc)]),console[_0x381e25(0x193)]('Response\x20Body:',_0x1e64a2),loggerService_1[_0x381e25(0x1df)]['logWhiteDomainResponse']('cointopay',_0x381e25(0x16c),_0x3900ff[_0x381e25(0x1dc)],_0x1e64a2,_0x499ad9),loggerService_1[_0x381e25(0x1df)]['logWhiteDomainError'](_0x381e25(0x1cc),_0x381e25(0x16c),_0x381e25(0x17a)+_0x3900ff[_0x381e25(0x1dc)]+':\x20'+_0x1e64a2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3900ff[_0x381e25(0x1dc)]);}const _0x19044f=await _0x3900ff['text']();console[_0x381e25(0x174)](_0x381e25(0x1ce),_0x19044f);let _0x441b8d;try{_0x441b8d=JSON['parse'](_0x19044f);}catch(_0x218848){console['error'](_0x381e25(0x1bb),_0x218848),loggerService_1['loggerService'][_0x381e25(0x1b5)](_0x381e25(0x1cc),_0x381e25(0x16c),_0x381e25(0x17f)+_0x218848);throw new Error(_0x381e25(0x1e6)+_0x19044f);}loggerService_1[_0x381e25(0x1df)][_0x381e25(0x1a2)]('cointopay',_0x381e25(0x16c),_0x3900ff[_0x381e25(0x1dc)],_0x441b8d,_0x499ad9),console['log'](_0x381e25(0x1ad)),console[_0x381e25(0x174)](_0x381e25(0x172),_0x441b8d['result']),console[_0x381e25(0x174)]('Status\x20Code:',_0x441b8d[_0x381e25(0x188)]),console[_0x381e25(0x174)](_0x381e25(0x17e),_0x441b8d[_0x381e25(0x173)]?.['Status']),console[_0x381e25(0x174)](_0x381e25(0x16b),_0x441b8d['data']?.['Amount']),console[_0x381e25(0x174)](_0x381e25(0x162),_0x441b8d['data']?.['inputCurrency']);if(_0x441b8d['result']!==_0x381e25(0x1e7)||_0x441b8d[_0x381e25(0x188)]!==0xc8){const _0x44bc43=_0x441b8d[_0x381e25(0x1bc)]||_0x381e25(0x1da);console['error'](_0x381e25(0x1e2)),console[_0x381e25(0x193)](_0x381e25(0x161),_0x44bc43),loggerService_1[_0x381e25(0x1df)][_0x381e25(0x1b5)]('cointopay',_0x381e25(0x16c),_0x381e25(0x180)+_0x44bc43);throw new Error(_0x381e25(0x187)+_0x44bc43);}if(!_0x441b8d[_0x381e25(0x173)]){console[_0x381e25(0x193)](_0x381e25(0x1d9)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x381e25(0x1df)][_0x381e25(0x1b5)](_0x381e25(0x1cc),_0x381e25(0x16c),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x381e25(0x181));}let _0xf96274=_0x381e25(0x17b);switch(_0x441b8d['data'][_0x381e25(0x16e)]?.[_0x381e25(0x1a4)]()){case _0x381e25(0x1de):_0xf96274=_0x381e25(0x1af);break;case _0x381e25(0x1c0):case _0x381e25(0x1e3):case _0x381e25(0x193):_0xf96274=_0x381e25(0x1b9);break;case _0x381e25(0x1d1):case _0x381e25(0x1bf):_0xf96274=_0x381e25(0x165);break;case _0x381e25(0x1ae):case _0x381e25(0x197):case'pending':case _0x381e25(0x191):default:_0xf96274='PENDING';break;}let _0x2c8d7f,_0x296939;if(_0x441b8d['data']['PaymentDetail']){const _0x16cf2e=_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1dd)];console[_0x381e25(0x174)]('ðŸ¦\x20Payment\x20Detail:',_0x16cf2e);const _0x17fd02=_0x16cf2e['match'](/IBAN\s+([A-Z0-9]+)/i);_0x17fd02&&(_0x2c8d7f=_0x17fd02[0x1],console[_0x381e25(0x174)](_0x381e25(0x1a0),_0x2c8d7f)),_0x296939=_0x16cf2e;}const _0x38c6b5={'iban':_0x2c8d7f,'bankDetails':_0x296939,'transactionId':_0x441b8d[_0x381e25(0x173)]['TransactionID'],'coinAddress':_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1d3)],'qrCodeUrl':_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1cf)],'expiryTime':_0x441b8d[_0x381e25(0x173)][_0x381e25(0x167)],'createdOn':_0x441b8d['data'][_0x381e25(0x177)],'confirmedOn':_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1e1)]};console[_0x381e25(0x174)](_0x381e25(0x166)),console[_0x381e25(0x174)]('Status:',_0x441b8d[_0x381e25(0x173)][_0x381e25(0x16e)],'->',_0xf96274),console['log'](_0x381e25(0x16b),_0x441b8d[_0x381e25(0x173)][_0x381e25(0x170)],_0x441b8d[_0x381e25(0x173)][_0x381e25(0x164)]),console[_0x381e25(0x174)](_0x381e25(0x15c),_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1b2)]),console[_0x381e25(0x174)](_0x381e25(0x1b4),_0x2c8d7f||_0x381e25(0x175)),console['log'](_0x381e25(0x1c1),_0x441b8d[_0x381e25(0x173)][_0x381e25(0x177)]),console[_0x381e25(0x174)](_0x381e25(0x19f),_0x441b8d[_0x381e25(0x173)][_0x381e25(0x1e1)]||_0x381e25(0x168));if(_0x441b8d[_0x381e25(0x173)][_0x381e25(0x16e)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x381e25(0x174)](_0x381e25(0x16d));else _0x441b8d[_0x381e25(0x173)][_0x381e25(0x16e)]?.[_0x381e25(0x1a4)]()==='paid'&&console['log'](_0x381e25(0x184));return{'status':_0xf96274,'amount':parseFloat(_0x441b8d[_0x381e25(0x173)][_0x381e25(0x170)])||undefined,'currency':_0x441b8d[_0x381e25(0x173)]['inputCurrency']||_0x381e25(0x1ba),'paymentDetails':_0x38c6b5};}catch(_0x3ab33e){console['error'](_0x381e25(0x1c4),_0x3ab33e),loggerService_1[_0x381e25(0x1df)]['logWhiteDomainError'](_0x381e25(0x1cc),_0x381e25(0x16c),_0x3ab33e);throw new Error(_0x381e25(0x1a8)+(_0x3ab33e instanceof Error?_0x3ab33e[_0x381e25(0x1bc)]:_0x381e25(0x1be)));}}async[a65_0x5d94ef(0x1a5)](_0x2ccde9){const _0x39ade6=a65_0x5d94ef,_0x465c28=await this[_0x39ade6(0x1d8)](_0x2ccde9);return{'status':_0x465c28[_0x39ade6(0x1dc)],'amount':_0x465c28[_0x39ade6(0x176)],'currency':_0x465c28[_0x39ade6(0x1c9)]};}async[a65_0x5d94ef(0x1d5)](_0x389c19){const _0x2e87cb=a65_0x5d94ef;console[_0x2e87cb(0x174)](_0x2e87cb(0x190),_0x389c19);let _0x1907fe=_0x2e87cb(0x17b);switch(_0x389c19[_0x2e87cb(0x1dc)]?.[_0x2e87cb(0x1a4)]()){case _0x2e87cb(0x1de):_0x1907fe=_0x2e87cb(0x1af);break;case'cancelled':case _0x2e87cb(0x1e3):case _0x2e87cb(0x193):_0x1907fe=_0x2e87cb(0x1b9);break;case _0x2e87cb(0x1d1):case _0x2e87cb(0x1bf):_0x1907fe='EXPIRED';break;case _0x2e87cb(0x1ab):case _0x2e87cb(0x1ae):case _0x2e87cb(0x197):case'created':default:_0x1907fe=_0x2e87cb(0x17b);break;}return{'paymentId':_0x389c19[_0x2e87cb(0x1e8)]||_0x389c19[_0x2e87cb(0x1d2)]||'','status':_0x1907fe,'amount':_0x389c19[_0x2e87cb(0x176)],'currency':_0x389c19[_0x2e87cb(0x1c9)]||_0x2e87cb(0x1ba)};}}exports[a65_0x5d94ef(0x1db)]=CoinToPayService;