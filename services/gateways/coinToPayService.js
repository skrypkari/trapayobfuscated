'use strict';const a40_0x494c7a=a40_0x560e;function a40_0xc35a(){const _0x2bd005=['order_id','Amount','4155500OlRNyK','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Headers:','cointopay','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','TransactionConfirmedOn','gateway_payment_id','Status\x20Code:','stack','Result:','Business\x20Error:\x20','7064cvCLdr','PAID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','PaymentDetail','Response\x20Body:','PENDING','amount','CoinToPay\x20payment\x20status\x20check\x20error:','CoinToPay\x20API\x20error:\x20','message','673484XYAVoa','üè¶\x20Extracted\x20IBAN:','awaiting\x20fiat','Parsed\x20Result:','75529QolDUk','logWhiteDomainError','paid','https://tesoft.uk/gateway/cointopay/status.php','application/json','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','__esModule','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','10crzUEQ','loggerService','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','merchant_reference_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','expired','waiting','parse','data','EXPIRED','Error\x20message:','URL:','IBAN:','Created\x20On:','ExpiryTime','Currency:','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','fromEntries','POST','entries','===\x20COINTOPAY\x20SUCCESS\x20===','CoinToPay\x20status\x20API\x20error:\x20','result','/status','Status:','statusUrl','Unknown\x20error\x20from\x20CoinToPay\x20API','checkPaymentStatus','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','https://tesoft.uk/gateway/cointopay/','text','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','CreatedOn','created','FAILED','Raw\x20Response\x20Body:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','success','Status','headers','timeout','Error\x20Message:','log','Confirmed\x20On:','status','apiUrl',',\x20body:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','/create','failed','CoinToPayService','toLowerCase','Gateway\x20Payment\x20ID:','verifyPayment','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','3149498IRVzta','JSON\x20Parse\x20Error:\x20','üè¶\x20Payment\x20Detail:','defineProperty','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20stack:','processWebhook','pending','statusText','currency','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','84qWbZaw','4067owRERF','inputCurrency','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','TransactionID','logWhiteDomainResponse','TesSoft\x20Payment\x20System/1.0','status_code','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','stringify','Request\x20Body:','Amount:','HTTP\x20','payment_url','createPaymentLink','HTTP\x20error!\x20status:\x20','now','Transaction\x20ID:','error','EUR','Status\x20API\x20Error:\x20','18490RRoHNM','2933757NNSbbb','HTTP\x20Status:','cancelled','3LvsxHQ','not\x20confirmed'];a40_0xc35a=function(){return _0x2bd005;};return a40_0xc35a();}(function(_0x34673c,_0x2a1adc){const _0xf7b8d=a40_0x560e,_0x5a2b6c=_0x34673c();while(!![]){try{const _0x27ff24=parseInt(_0xf7b8d(0x225))/0x1*(-parseInt(_0xf7b8d(0x22d))/0x2)+-parseInt(_0xf7b8d(0x208))/0x3*(parseInt(_0xf7b8d(0x221))/0x4)+parseInt(_0xf7b8d(0x204))/0x5*(-parseInt(_0xf7b8d(0x1ef))/0x6)+-parseInt(_0xf7b8d(0x1f0))/0x7*(-parseInt(_0xf7b8d(0x217))/0x8)+-parseInt(_0xf7b8d(0x205))/0x9+parseInt(_0xf7b8d(0x20c))/0xa+parseInt(_0xf7b8d(0x1e2))/0xb;if(_0x27ff24===_0x2a1adc)break;else _0x5a2b6c['push'](_0x5a2b6c['shift']());}catch(_0x32a740){_0x5a2b6c['push'](_0x5a2b6c['shift']());}}}(a40_0xc35a,0x4713a));function a40_0x560e(_0x4b4e16,_0x441576){const _0xc35af8=a40_0xc35a();return a40_0x560e=function(_0x560e85,_0x4e8b55){_0x560e85=_0x560e85-0x1d9;let _0x20cf0d=_0xc35af8[_0x560e85];return _0x20cf0d;},a40_0x560e(_0x4b4e16,_0x441576);}Object[a40_0x494c7a(0x1e5)](exports,a40_0x494c7a(0x22b),{'value':!![]}),exports[a40_0x494c7a(0x1dd)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x21bace=a40_0x494c7a;this['apiUrl']=_0x21bace(0x24c),this[_0x21bace(0x248)]=_0x21bace(0x228),console[_0x21bace(0x25a)](_0x21bace(0x253)),console[_0x21bace(0x25a)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a40_0x494c7a(0x1fd)](_0x235a7d){const _0x1c9337=a40_0x494c7a,{orderId:_0x10a9ec,amount:_0x3a90c7}=_0x235a7d;console[_0x1c9337(0x25a)](_0x1c9337(0x24b)+_0x3a90c7+'\x20EUR');const _0x5ed37f={'amount':_0x3a90c7},_0x281b33=Date[_0x1c9337(0x1ff)]();try{console[_0x1c9337(0x25a)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1c9337(0x25a)](_0x1c9337(0x239),this[_0x1c9337(0x25d)]),console[_0x1c9337(0x25a)](_0x1c9337(0x1f9),JSON[_0x1c9337(0x1f8)](_0x5ed37f,null,0x2)),console[_0x1c9337(0x25a)](_0x1c9337(0x1fa),_0x3a90c7,_0x1c9337(0x20d)),loggerService_1[_0x1c9337(0x22e)][_0x1c9337(0x23e)](_0x1c9337(0x20f),_0x1c9337(0x1db),_0x1c9337(0x241),_0x5ed37f);const _0x48859d=await fetch(this[_0x1c9337(0x25d)],{'method':_0x1c9337(0x241),'headers':{'Content-Type':'application/json','Accept':_0x1c9337(0x229),'User-Agent':_0x1c9337(0x1f5)},'body':JSON[_0x1c9337(0x1f8)](_0x5ed37f)}),_0xfca15d=Date['now']()-_0x281b33;console[_0x1c9337(0x25a)](_0x1c9337(0x24e)),console['log'](_0x1c9337(0x247),_0x48859d[_0x1c9337(0x25c)]),console[_0x1c9337(0x25a)]('Status\x20Text:',_0x48859d[_0x1c9337(0x1eb)]),console[_0x1c9337(0x25a)](_0x1c9337(0x20e),Object[_0x1c9337(0x240)](_0x48859d[_0x1c9337(0x257)][_0x1c9337(0x242)]())),console['log']('Response\x20Time:',_0xfca15d+'ms');const _0x57f416=await _0x48859d['text']();console[_0x1c9337(0x25a)](_0x1c9337(0x252),_0x57f416);if(!_0x48859d['ok']){console[_0x1c9337(0x201)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x1c9337(0x201)]('HTTP\x20Status:',_0x48859d[_0x1c9337(0x25c)]),console['error'](_0x1c9337(0x21b),_0x57f416),loggerService_1['loggerService'][_0x1c9337(0x1f4)](_0x1c9337(0x20f),'/create',_0x48859d[_0x1c9337(0x25c)],_0x57f416,_0xfca15d),loggerService_1[_0x1c9337(0x22e)][_0x1c9337(0x226)]('cointopay',_0x1c9337(0x1db),_0x1c9337(0x1fb)+_0x48859d[_0x1c9337(0x25c)]+':\x20'+_0x57f416);throw new Error('HTTP\x20error!\x20status:\x20'+_0x48859d[_0x1c9337(0x25c)]+_0x1c9337(0x1d9)+_0x57f416);}let _0x1ba20d;try{_0x1ba20d=JSON[_0x1c9337(0x235)](_0x57f416);}catch(_0x59d601){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x59d601),loggerService_1['loggerService'][_0x1c9337(0x226)](_0x1c9337(0x20f),_0x1c9337(0x1db),_0x1c9337(0x1e3)+_0x59d601);throw new Error(_0x1c9337(0x1ee)+_0x57f416);}console[_0x1c9337(0x25a)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x1c9337(0x224),JSON['stringify'](_0x1ba20d,null,0x2)),loggerService_1['loggerService'][_0x1c9337(0x1f4)](_0x1c9337(0x20f),'/create',_0x48859d[_0x1c9337(0x25c)],_0x1ba20d,_0xfca15d);if(_0x1ba20d[_0x1c9337(0x201)]){const _0x3b9993=_0x1ba20d[_0x1c9337(0x220)]||_0x1ba20d[_0x1c9337(0x201)]||_0x1c9337(0x249);console[_0x1c9337(0x201)](_0x1c9337(0x1f2)),console[_0x1c9337(0x201)](_0x1c9337(0x259),_0x3b9993),loggerService_1[_0x1c9337(0x22e)][_0x1c9337(0x226)]('cointopay',_0x1c9337(0x1db),_0x1c9337(0x216)+_0x3b9993);throw new Error(_0x1c9337(0x21f)+_0x3b9993);}if(!_0x1ba20d[_0x1c9337(0x1fc)]||!_0x1ba20d[_0x1c9337(0x212)]){console[_0x1c9337(0x201)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1c9337(0x201)](_0x1c9337(0x1e6)),console[_0x1c9337(0x201)]('Response\x20data:',_0x1ba20d),loggerService_1[_0x1c9337(0x22e)][_0x1c9337(0x226)](_0x1c9337(0x20f),_0x1c9337(0x1db),_0x1c9337(0x22c));throw new Error(_0x1c9337(0x230));}return console['log'](_0x1c9337(0x243)),console[_0x1c9337(0x25a)](_0x1c9337(0x1df),_0x1ba20d[_0x1c9337(0x212)]),console[_0x1c9337(0x25a)]('Payment\x20URL:',_0x1ba20d[_0x1c9337(0x1fc)]),console['log'](_0x1c9337(0x1fa),_0x3a90c7,_0x1c9337(0x202)),{'gateway_payment_id':_0x1ba20d[_0x1c9337(0x212)],'payment_url':_0x1ba20d['payment_url']};}catch(_0x4d4000){console['error'](_0x1c9337(0x22a)),console['error']('Error\x20details:',_0x4d4000),loggerService_1[_0x1c9337(0x22e)][_0x1c9337(0x226)](_0x1c9337(0x20f),_0x1c9337(0x1db),_0x4d4000);if(_0x4d4000 instanceof Error){console[_0x1c9337(0x201)](_0x1c9337(0x238),_0x4d4000[_0x1c9337(0x220)]),console[_0x1c9337(0x201)](_0x1c9337(0x1e8),_0x4d4000[_0x1c9337(0x214)]);throw new Error(_0x1c9337(0x1e7)+_0x4d4000[_0x1c9337(0x220)]);}throw new Error(_0x1c9337(0x232));}}async[a40_0x494c7a(0x24a)](_0x6f374b){const _0x38d381=a40_0x494c7a,_0x1a5ad5=Date[_0x38d381(0x1ff)]();try{console['log'](_0x38d381(0x1da)+_0x6f374b);const _0x36e5ba={'gatewayPaymentId':_0x6f374b};loggerService_1[_0x38d381(0x22e)][_0x38d381(0x23e)](_0x38d381(0x20f),_0x38d381(0x246),_0x38d381(0x241),_0x36e5ba);const _0x24ccd0=await fetch(this[_0x38d381(0x248)],{'method':_0x38d381(0x241),'headers':{'Content-Type':_0x38d381(0x229),'Accept':'application/json','User-Agent':_0x38d381(0x1f5)},'body':JSON[_0x38d381(0x1f8)](_0x36e5ba)}),_0x4b2286=Date['now']()-_0x1a5ad5;console[_0x38d381(0x25a)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x38d381(0x25a)]('Status:',_0x24ccd0['status']),console[_0x38d381(0x25a)]('Response\x20Time:',_0x4b2286+'ms');if(!_0x24ccd0['ok']){const _0x13a91d=await _0x24ccd0['text']();console[_0x38d381(0x201)](_0x38d381(0x206),_0x24ccd0['status']),console[_0x38d381(0x201)](_0x38d381(0x21b),_0x13a91d),loggerService_1[_0x38d381(0x22e)][_0x38d381(0x1f4)]('cointopay',_0x38d381(0x246),_0x24ccd0[_0x38d381(0x25c)],_0x13a91d,_0x4b2286),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x38d381(0x246),_0x38d381(0x1fb)+_0x24ccd0[_0x38d381(0x25c)]+':\x20'+_0x13a91d);throw new Error(_0x38d381(0x1fe)+_0x24ccd0[_0x38d381(0x25c)]);}const _0xcd9851=await _0x24ccd0[_0x38d381(0x24d)]();console['log'](_0x38d381(0x252),_0xcd9851);let _0x2f134a;try{_0x2f134a=JSON[_0x38d381(0x235)](_0xcd9851);}catch(_0x157124){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x157124),loggerService_1[_0x38d381(0x22e)][_0x38d381(0x226)](_0x38d381(0x20f),_0x38d381(0x246),_0x38d381(0x1e3)+_0x157124);throw new Error(_0x38d381(0x210)+_0xcd9851);}loggerService_1[_0x38d381(0x22e)][_0x38d381(0x1f4)]('cointopay',_0x38d381(0x246),_0x24ccd0[_0x38d381(0x25c)],_0x2f134a,_0x4b2286),console['log'](_0x38d381(0x219)),console['log'](_0x38d381(0x215),_0x2f134a[_0x38d381(0x245)]),console[_0x38d381(0x25a)](_0x38d381(0x213),_0x2f134a[_0x38d381(0x1f6)]),console[_0x38d381(0x25a)]('Payment\x20Status:',_0x2f134a[_0x38d381(0x236)]?.[_0x38d381(0x256)]),console[_0x38d381(0x25a)](_0x38d381(0x1fa),_0x2f134a['data']?.['Amount']),console[_0x38d381(0x25a)](_0x38d381(0x23d),_0x2f134a['data']?.['inputCurrency']);if(_0x2f134a[_0x38d381(0x245)]!==_0x38d381(0x255)||_0x2f134a[_0x38d381(0x1f6)]!==0xc8){const _0x415694=_0x2f134a['message']||_0x38d381(0x1e1);console[_0x38d381(0x201)](_0x38d381(0x23f)),console['error']('Error\x20Message:',_0x415694),loggerService_1['loggerService'][_0x38d381(0x226)](_0x38d381(0x20f),'/status',_0x38d381(0x203)+_0x415694);throw new Error(_0x38d381(0x244)+_0x415694);}if(!_0x2f134a[_0x38d381(0x236)]){console[_0x38d381(0x201)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x38d381(0x201)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x38d381(0x22e)]['logWhiteDomainError']('cointopay',_0x38d381(0x246),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x38d381(0x1f7));}let _0x4ee513=_0x38d381(0x21c);switch(_0x2f134a[_0x38d381(0x236)][_0x38d381(0x256)]?.[_0x38d381(0x1de)]()){case'paid':_0x4ee513=_0x38d381(0x218);break;case _0x38d381(0x207):case _0x38d381(0x1dc):case'error':_0x4ee513='FAILED';break;case _0x38d381(0x233):case _0x38d381(0x258):_0x4ee513='EXPIRED';break;case _0x38d381(0x234):case _0x38d381(0x223):case _0x38d381(0x1ea):case _0x38d381(0x250):default:_0x4ee513='PENDING';break;}let _0x2eedcd,_0x5469fb;if(_0x2f134a['data'][_0x38d381(0x21a)]){const _0x8d0ab6=_0x2f134a[_0x38d381(0x236)][_0x38d381(0x21a)];console[_0x38d381(0x25a)](_0x38d381(0x1e4),_0x8d0ab6);const _0x515cc4=_0x8d0ab6['match'](/IBAN\s+([A-Z0-9]+)/i);_0x515cc4&&(_0x2eedcd=_0x515cc4[0x1],console[_0x38d381(0x25a)](_0x38d381(0x222),_0x2eedcd)),_0x5469fb=_0x8d0ab6;}const _0x5f2514={'iban':_0x2eedcd,'bankDetails':_0x5469fb,'transactionId':_0x2f134a['data']['TransactionID'],'coinAddress':_0x2f134a['data']['coinAddress'],'qrCodeUrl':_0x2f134a[_0x38d381(0x236)]['QRCodeURL'],'expiryTime':_0x2f134a[_0x38d381(0x236)][_0x38d381(0x23c)],'createdOn':_0x2f134a[_0x38d381(0x236)]['CreatedOn'],'confirmedOn':_0x2f134a['data'][_0x38d381(0x211)]};console[_0x38d381(0x25a)](_0x38d381(0x254)),console['log'](_0x38d381(0x247),_0x2f134a[_0x38d381(0x236)]['Status'],'->',_0x4ee513),console['log'](_0x38d381(0x1fa),_0x2f134a[_0x38d381(0x236)][_0x38d381(0x20b)],_0x2f134a[_0x38d381(0x236)][_0x38d381(0x1f1)]),console[_0x38d381(0x25a)](_0x38d381(0x200),_0x2f134a['data'][_0x38d381(0x1f3)]),console[_0x38d381(0x25a)](_0x38d381(0x23a),_0x2eedcd||'not\x20found'),console['log'](_0x38d381(0x23b),_0x2f134a[_0x38d381(0x236)][_0x38d381(0x24f)]),console['log'](_0x38d381(0x25b),_0x2f134a[_0x38d381(0x236)]['TransactionConfirmedOn']||_0x38d381(0x209));if(_0x2f134a['data'][_0x38d381(0x256)]?.['toLowerCase']()===_0x38d381(0x223))console[_0x38d381(0x25a)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2f134a[_0x38d381(0x236)][_0x38d381(0x256)]?.[_0x38d381(0x1de)]()===_0x38d381(0x227)&&console[_0x38d381(0x25a)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x4ee513,'amount':parseFloat(_0x2f134a[_0x38d381(0x236)][_0x38d381(0x20b)])||undefined,'currency':_0x2f134a['data'][_0x38d381(0x1f1)]||_0x38d381(0x202),'paymentDetails':_0x5f2514};}catch(_0x47dd52){console[_0x38d381(0x201)](_0x38d381(0x21e),_0x47dd52),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/status',_0x47dd52);throw new Error(_0x38d381(0x22f)+(_0x47dd52 instanceof Error?_0x47dd52[_0x38d381(0x220)]:'Unknown\x20error'));}}async[a40_0x494c7a(0x1e0)](_0x3ef098){const _0x4179ca=a40_0x494c7a,_0x4305b8=await this[_0x4179ca(0x24a)](_0x3ef098);return{'status':_0x4305b8['status'],'amount':_0x4305b8[_0x4179ca(0x21d)],'currency':_0x4305b8[_0x4179ca(0x1ec)]};}async[a40_0x494c7a(0x1e9)](_0x35538a){const _0x165176=a40_0x494c7a;console[_0x165176(0x25a)](_0x165176(0x1ed),_0x35538a);let _0x4a38b8=_0x165176(0x21c);switch(_0x35538a[_0x165176(0x25c)]?.['toLowerCase']()){case _0x165176(0x227):_0x4a38b8=_0x165176(0x218);break;case'cancelled':case'failed':case'error':_0x4a38b8=_0x165176(0x251);break;case _0x165176(0x233):case _0x165176(0x258):_0x4a38b8=_0x165176(0x237);break;case _0x165176(0x1ea):case'waiting':case _0x165176(0x223):case _0x165176(0x250):default:_0x4a38b8='PENDING';break;}return{'paymentId':_0x35538a[_0x165176(0x20a)]||_0x35538a[_0x165176(0x231)]||'','status':_0x4a38b8,'amount':_0x35538a[_0x165176(0x21d)],'currency':_0x35538a[_0x165176(0x1ec)]||_0x165176(0x202)};}}exports[a40_0x494c7a(0x1dd)]=CoinToPayService;