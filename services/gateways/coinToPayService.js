'use strict';const a44_0x5625f2=a44_0x1dd9;(function(_0xb47050,_0x1fb1aa){const _0x1577bb=a44_0x1dd9,_0x50802f=_0xb47050();while(!![]){try{const _0x1bdb8c=-parseInt(_0x1577bb(0x16a))/0x1+-parseInt(_0x1577bb(0x119))/0x2*(-parseInt(_0x1577bb(0x15f))/0x3)+-parseInt(_0x1577bb(0x121))/0x4+-parseInt(_0x1577bb(0x12a))/0x5*(-parseInt(_0x1577bb(0x103))/0x6)+parseInt(_0x1577bb(0x14a))/0x7+-parseInt(_0x1577bb(0xef))/0x8+parseInt(_0x1577bb(0x105))/0x9;if(_0x1bdb8c===_0x1fb1aa)break;else _0x50802f['push'](_0x50802f['shift']());}catch(_0xe3455a){_0x50802f['push'](_0x50802f['shift']());}}}(a44_0xd1de,0xb825b));Object['defineProperty'](exports,a44_0x5625f2(0x118),{'value':!![]}),exports[a44_0x5625f2(0x11d)]=void 0x0;function a44_0x1dd9(_0x313c70,_0x315b2e){const _0xd1de47=a44_0xd1de();return a44_0x1dd9=function(_0x1dd987,_0x511344){_0x1dd987=_0x1dd987-0xee;let _0x29c521=_0xd1de47[_0x1dd987];return _0x29c521;},a44_0x1dd9(_0x313c70,_0x315b2e);}const loggerService_1=require(a44_0x5625f2(0x168));class CoinToPayService{constructor(){const _0x24e780=a44_0x5625f2;this[_0x24e780(0x16f)]=_0x24e780(0x15c),this[_0x24e780(0x11b)]=_0x24e780(0x156),console[_0x24e780(0x109)](_0x24e780(0x11f)),console[_0x24e780(0x109)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async[a44_0x5625f2(0x11c)](_0x231b47){const _0x419528=a44_0x5625f2,{orderId:_0x5097f7,amount:_0x1e8d5a}=_0x231b47;console[_0x419528(0x109)](_0x419528(0xff)+_0x1e8d5a+'\x20EUR');const _0xcebd6={'amount':_0x1e8d5a},_0xc34f3d=Date[_0x419528(0x154)]();try{console[_0x419528(0x109)](_0x419528(0x167)),console[_0x419528(0x109)]('URL:',this['apiUrl']),console[_0x419528(0x109)](_0x419528(0xfa),JSON[_0x419528(0x102)](_0xcebd6,null,0x2)),console[_0x419528(0x109)](_0x419528(0x164),_0x1e8d5a,_0x419528(0x123)),loggerService_1[_0x419528(0x142)]['logWhiteDomainRequest'](_0x419528(0x101),'/create','POST',_0xcebd6);const _0x571161=await fetch(this[_0x419528(0x16f)],{'method':_0x419528(0x149),'headers':{'Content-Type':_0x419528(0x15e),'Accept':_0x419528(0x15e),'User-Agent':_0x419528(0x16b)},'body':JSON[_0x419528(0x102)](_0xcebd6)}),_0x538295=Date[_0x419528(0x154)]()-_0xc34f3d;console['log'](_0x419528(0x130)),console[_0x419528(0x109)](_0x419528(0xf6),_0x571161['status']),console[_0x419528(0x109)](_0x419528(0x158),_0x571161[_0x419528(0x143)]),console['log']('Headers:',Object[_0x419528(0x12e)](_0x571161['headers'][_0x419528(0x160)]())),console[_0x419528(0x109)](_0x419528(0xf1),_0x538295+'ms');const _0x3ce7b9=await _0x571161['text']();console[_0x419528(0x109)](_0x419528(0x147),_0x3ce7b9);if(!_0x571161['ok']){console[_0x419528(0x163)](_0x419528(0x133)),console['error'](_0x419528(0x136),_0x571161[_0x419528(0x13f)]),console[_0x419528(0x163)](_0x419528(0xf7),_0x3ce7b9),loggerService_1[_0x419528(0x142)][_0x419528(0x125)](_0x419528(0x101),_0x419528(0x14b),_0x571161['status'],_0x3ce7b9,_0x538295),loggerService_1['loggerService']['logWhiteDomainError'](_0x419528(0x101),_0x419528(0x14b),_0x419528(0x12c)+_0x571161[_0x419528(0x13f)]+':\x20'+_0x3ce7b9);throw new Error(_0x419528(0x115)+_0x571161[_0x419528(0x13f)]+_0x419528(0x16c)+_0x3ce7b9);}let _0x5d8233;try{_0x5d8233=JSON[_0x419528(0x100)](_0x3ce7b9);}catch(_0x8279a3){console[_0x419528(0x163)](_0x419528(0x10e),_0x8279a3),loggerService_1['loggerService'][_0x419528(0x128)](_0x419528(0x101),_0x419528(0x14b),_0x419528(0x138)+_0x8279a3);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3ce7b9);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x419528(0x102)](_0x5d8233,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x419528(0x14b),_0x571161[_0x419528(0x13f)],_0x5d8233,_0x538295);if(_0x5d8233[_0x419528(0x163)]){const _0x2d8b31=_0x5d8233[_0x419528(0x14c)]||_0x5d8233[_0x419528(0x163)]||_0x419528(0x120);console[_0x419528(0x163)](_0x419528(0x104)),console[_0x419528(0x163)](_0x419528(0x15a),_0x2d8b31),loggerService_1[_0x419528(0x142)]['logWhiteDomainError'](_0x419528(0x101),'/create',_0x419528(0x10a)+_0x2d8b31);throw new Error(_0x419528(0x13e)+_0x2d8b31);}if(!_0x5d8233['payment_url']||!_0x5d8233[_0x419528(0x10c)]){console[_0x419528(0x163)](_0x419528(0x122)),console[_0x419528(0x163)](_0x419528(0x148)),console[_0x419528(0x163)](_0x419528(0x116),_0x5d8233),loggerService_1[_0x419528(0x142)][_0x419528(0x128)]('cointopay',_0x419528(0x14b),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x419528(0x10d));}return console[_0x419528(0x109)](_0x419528(0x16e)),console[_0x419528(0x109)](_0x419528(0xfc),_0x5d8233[_0x419528(0x10c)]),console[_0x419528(0x109)](_0x419528(0x166),_0x5d8233[_0x419528(0x11a)]),console[_0x419528(0x109)](_0x419528(0x164),_0x1e8d5a,_0x419528(0x13a)),{'gateway_payment_id':_0x5d8233[_0x419528(0x10c)],'payment_url':_0x5d8233[_0x419528(0x11a)]};}catch(_0x348d0f){console[_0x419528(0x163)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x419528(0x163)](_0x419528(0xfe),_0x348d0f),loggerService_1[_0x419528(0x142)]['logWhiteDomainError'](_0x419528(0x101),_0x419528(0x14b),_0x348d0f);if(_0x348d0f instanceof Error){console[_0x419528(0x163)](_0x419528(0xf9),_0x348d0f[_0x419528(0x14c)]),console[_0x419528(0x163)](_0x419528(0x124),_0x348d0f[_0x419528(0x14e)]);throw new Error(_0x419528(0x11e)+_0x348d0f['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x5625f2(0x169)](_0x4c9831){const _0x475180=a44_0x5625f2,_0x39dcb0=Date['now']();try{console[_0x475180(0x109)](_0x475180(0x10f)+_0x4c9831);const _0xd0bed2={'gatewayPaymentId':_0x4c9831};loggerService_1['loggerService'][_0x475180(0xfb)]('cointopay',_0x475180(0x13d),_0x475180(0x149),_0xd0bed2);const _0x22b9e7=await fetch(this[_0x475180(0x11b)],{'method':_0x475180(0x149),'headers':{'Content-Type':_0x475180(0x15e),'Accept':'application/json','User-Agent':_0x475180(0x16b)},'body':JSON[_0x475180(0x102)](_0xd0bed2)}),_0x37a712=Date[_0x475180(0x154)]()-_0x39dcb0;console[_0x475180(0x109)](_0x475180(0x111)),console[_0x475180(0x109)](_0x475180(0xf6),_0x22b9e7[_0x475180(0x13f)]),console[_0x475180(0x109)](_0x475180(0xf1),_0x37a712+'ms');if(!_0x22b9e7['ok']){const _0x2464f5=await _0x22b9e7[_0x475180(0xf2)]();console['error']('HTTP\x20Status:',_0x22b9e7['status']),console[_0x475180(0x163)](_0x475180(0xf7),_0x2464f5),loggerService_1[_0x475180(0x142)][_0x475180(0x125)]('cointopay','/status',_0x22b9e7[_0x475180(0x13f)],_0x2464f5,_0x37a712),loggerService_1[_0x475180(0x142)][_0x475180(0x128)]('cointopay',_0x475180(0x13d),_0x475180(0x12c)+_0x22b9e7['status']+':\x20'+_0x2464f5);throw new Error(_0x475180(0x115)+_0x22b9e7['status']);}const _0x2cbc2d=await _0x22b9e7[_0x475180(0xf2)]();console[_0x475180(0x109)](_0x475180(0x147),_0x2cbc2d);let _0x3ca90e;try{_0x3ca90e=JSON[_0x475180(0x100)](_0x2cbc2d);}catch(_0x272708){console['error'](_0x475180(0x10e),_0x272708),loggerService_1[_0x475180(0x142)]['logWhiteDomainError'](_0x475180(0x101),_0x475180(0x13d),_0x475180(0x138)+_0x272708);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x2cbc2d);}loggerService_1[_0x475180(0x142)][_0x475180(0x125)](_0x475180(0x101),_0x475180(0x13d),_0x22b9e7[_0x475180(0x13f)],_0x3ca90e,_0x37a712),console[_0x475180(0x109)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x475180(0x109)](_0x475180(0x126),_0x3ca90e[_0x475180(0x170)]),console[_0x475180(0x109)](_0x475180(0x151),_0x3ca90e[_0x475180(0x131)]),console[_0x475180(0x109)](_0x475180(0x14d),_0x3ca90e[_0x475180(0x14f)]?.['Status']),console[_0x475180(0x109)](_0x475180(0x164),_0x3ca90e[_0x475180(0x14f)]?.['Amount']),console[_0x475180(0x109)](_0x475180(0x153),_0x3ca90e[_0x475180(0x14f)]?.[_0x475180(0x140)]);if(_0x3ca90e[_0x475180(0x170)]!==_0x475180(0x15d)||_0x3ca90e[_0x475180(0x131)]!==0xc8){const _0x3f321a=_0x3ca90e[_0x475180(0x14c)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x475180(0x127)),console['error'](_0x475180(0x15a),_0x3f321a),loggerService_1[_0x475180(0x142)][_0x475180(0x128)]('cointopay',_0x475180(0x13d),_0x475180(0x150)+_0x3f321a);throw new Error(_0x475180(0x110)+_0x3f321a);}if(!_0x3ca90e[_0x475180(0x14f)]){console[_0x475180(0x163)](_0x475180(0x159)),console[_0x475180(0x163)](_0x475180(0x145)),loggerService_1[_0x475180(0x142)][_0x475180(0x128)](_0x475180(0x101),_0x475180(0x13d),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x3f52a2=_0x475180(0x137);switch(_0x3ca90e['data'][_0x475180(0x155)]?.[_0x475180(0x114)]()){case _0x475180(0x113):_0x3f52a2=_0x475180(0xee);break;case _0x475180(0x10b):case _0x475180(0x12f):case _0x475180(0x163):_0x3f52a2=_0x475180(0x135);break;case _0x475180(0xfd):case _0x475180(0x15b):_0x3f52a2=_0x475180(0x139);break;case'waiting':case _0x475180(0x162):case'pending':case _0x475180(0x13c):default:_0x3f52a2='PENDING';break;}let _0x2cabdf,_0x310133;if(_0x3ca90e[_0x475180(0x14f)][_0x475180(0x12b)]){const _0x48e185=_0x3ca90e['data'][_0x475180(0x12b)];console[_0x475180(0x109)]('🏦\x20Payment\x20Detail:',_0x48e185);const _0x70070e=_0x48e185[_0x475180(0x161)](/IBAN\s+([A-Z0-9]+)/i);_0x70070e&&(_0x2cabdf=_0x70070e[0x1],console[_0x475180(0x109)](_0x475180(0x16d),_0x2cabdf)),_0x310133=_0x48e185;}const _0x19e71b={'iban':_0x2cabdf,'bankDetails':_0x310133,'transactionId':_0x3ca90e[_0x475180(0x14f)][_0x475180(0x117)],'coinAddress':_0x3ca90e['data'][_0x475180(0x13b)],'qrCodeUrl':_0x3ca90e[_0x475180(0x14f)]['QRCodeURL'],'expiryTime':_0x3ca90e[_0x475180(0x14f)][_0x475180(0xf0)],'createdOn':_0x3ca90e[_0x475180(0x14f)][_0x475180(0x108)],'confirmedOn':_0x3ca90e[_0x475180(0x14f)][_0x475180(0x141)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x475180(0xf6),_0x3ca90e['data']['Status'],'->',_0x3f52a2),console[_0x475180(0x109)]('Amount:',_0x3ca90e[_0x475180(0x14f)][_0x475180(0x134)],_0x3ca90e[_0x475180(0x14f)]['inputCurrency']),console['log']('Transaction\x20ID:',_0x3ca90e[_0x475180(0x14f)]['TransactionID']),console[_0x475180(0x109)](_0x475180(0x152),_0x2cabdf||_0x475180(0x165)),console[_0x475180(0x109)](_0x475180(0x106),_0x3ca90e[_0x475180(0x14f)][_0x475180(0x108)]),console[_0x475180(0x109)](_0x475180(0x157),_0x3ca90e['data'][_0x475180(0x141)]||_0x475180(0xf8));if(_0x3ca90e['data']['Status']?.[_0x475180(0x114)]()===_0x475180(0x162))console['log'](_0x475180(0x144));else _0x3ca90e[_0x475180(0x14f)]['Status']?.[_0x475180(0x114)]()===_0x475180(0x113)&&console[_0x475180(0x109)](_0x475180(0x107));return{'status':_0x3f52a2,'amount':parseFloat(_0x3ca90e[_0x475180(0x14f)][_0x475180(0x134)])||undefined,'currency':_0x3ca90e[_0x475180(0x14f)][_0x475180(0x140)]||_0x475180(0x13a),'paymentDetails':_0x19e71b};}catch(_0x5abb86){console[_0x475180(0x163)](_0x475180(0xf5),_0x5abb86),loggerService_1[_0x475180(0x142)]['logWhiteDomainError'](_0x475180(0x101),_0x475180(0x13d),_0x5abb86);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x5abb86 instanceof Error?_0x5abb86['message']:_0x475180(0x132)));}}async['verifyPayment'](_0x589f87){const _0x15b60c=a44_0x5625f2,_0x5f0227=await this[_0x15b60c(0x169)](_0x589f87);return{'status':_0x5f0227[_0x15b60c(0x13f)],'amount':_0x5f0227[_0x15b60c(0x129)],'currency':_0x5f0227[_0x15b60c(0x112)]};}async['processWebhook'](_0x50a232){const _0x21c67e=a44_0x5625f2;console['log'](_0x21c67e(0xf3),_0x50a232);let _0x4fe162=_0x21c67e(0x137);switch(_0x50a232[_0x21c67e(0x13f)]?.[_0x21c67e(0x114)]()){case'paid':_0x4fe162='PAID';break;case _0x21c67e(0x10b):case _0x21c67e(0x12f):case'error':_0x4fe162=_0x21c67e(0x135);break;case _0x21c67e(0xfd):case'timeout':_0x4fe162=_0x21c67e(0x139);break;case'pending':case _0x21c67e(0xf4):case _0x21c67e(0x162):case _0x21c67e(0x13c):default:_0x4fe162='PENDING';break;}return{'paymentId':_0x50a232[_0x21c67e(0x146)]||_0x50a232[_0x21c67e(0x12d)]||'','status':_0x4fe162,'amount':_0x50a232[_0x21c67e(0x129)],'currency':_0x50a232[_0x21c67e(0x112)]||_0x21c67e(0x13a)};}}function a44_0xd1de(){const _0x51f04f=['Payment\x20URL:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','../loggerService','checkPaymentStatus','963333kXPSrX','TesSoft\x20Payment\x20System/1.0',',\x20body:\x20','🏦\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20SUCCESS\x20===','apiUrl','result','PAID','6605944WhxGUS','ExpiryTime','Response\x20Time:','text','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','waiting','CoinToPay\x20payment\x20status\x20check\x20error:','Status:','Response\x20Body:','not\x20confirmed','Error\x20message:','Request\x20Body:','logWhiteDomainRequest','Gateway\x20Payment\x20ID:','expired','Error\x20details:','🪙\x20Creating\x20CoinToPay\x20payment:\x20','parse','cointopay','stringify','24LdRgrN','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','5327334eEVpPb','Created\x20On:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CreatedOn','log','Business\x20Error:\x20','cancelled','gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20parse\x20JSON\x20response:','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','currency','paid','toLowerCase','HTTP\x20error!\x20status:\x20','Response\x20data:','TransactionID','__esModule','1284894BcHWvI','payment_url','statusUrl','createPaymentLink','CoinToPayService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Unknown\x20error\x20from\x20CoinToPay\x20API','5565096eVvgdo','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Error\x20stack:','logWhiteDomainResponse','Result:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','logWhiteDomainError','amount','1089055MUdbfP','PaymentDetail','HTTP\x20','merchant_reference_id','fromEntries','failed','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status_code','Unknown\x20error','===\x20COINTOPAY\x20API\x20ERROR\x20===','Amount','FAILED','HTTP\x20Status:','PENDING','JSON\x20Parse\x20Error:\x20','EXPIRED','EUR','coinAddress','created','/status','CoinToPay\x20API\x20error:\x20','status','inputCurrency','TransactionConfirmedOn','loggerService','statusText','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Missing\x20data\x20in\x20response','order_id','Raw\x20Response\x20Body:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','POST','8305871LDdwam','/create','message','Payment\x20Status:','stack','data','Status\x20API\x20Error:\x20','Status\x20Code:','IBAN:','Currency:','now','Status','https://tesoft.uk/gateway/cointopay/status.php','Confirmed\x20On:','Status\x20Text:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','timeout','https://tesoft.uk/gateway/cointopay/','success','application/json','6imFCJB','entries','match','awaiting\x20fiat','error','Amount:','not\x20found'];a44_0xd1de=function(){return _0x51f04f;};return a44_0xd1de();}exports[a44_0x5625f2(0x11d)]=CoinToPayService;