'use strict';const a43_0x1d6b4a=a43_0x3884;(function(_0x2185dd,_0x5b2726){const _0x113995=a43_0x3884,_0x35e4e3=_0x2185dd();while(!![]){try{const _0x208fde=-parseInt(_0x113995(0x1ca))/0x1*(parseInt(_0x113995(0x1ab))/0x2)+parseInt(_0x113995(0x166))/0x3*(-parseInt(_0x113995(0x195))/0x4)+parseInt(_0x113995(0x181))/0x5*(-parseInt(_0x113995(0x1c9))/0x6)+-parseInt(_0x113995(0x1ad))/0x7+-parseInt(_0x113995(0x1b8))/0x8*(-parseInt(_0x113995(0x198))/0x9)+parseInt(_0x113995(0x192))/0xa+-parseInt(_0x113995(0x17b))/0xb*(-parseInt(_0x113995(0x1c8))/0xc);if(_0x208fde===_0x5b2726)break;else _0x35e4e3['push'](_0x35e4e3['shift']());}catch(_0x302d26){_0x35e4e3['push'](_0x35e4e3['shift']());}}}(a43_0x2abd,0x3ffc8));function a43_0x2abd(){const _0x262963=['CoinToPayService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','Headers:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','Error\x20details:','Unknown\x20error','Confirmed\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Business\x20Error:\x20','HTTP\x20Status:','gateway_payment_id','status_code','\x20EUR','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','entries','created','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','currency','Payment\x20Status:','3cyLnCL','Status\x20Text:','stringify','/create','Status\x20API\x20Error:\x20','Response\x20data:','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','PaymentDetail','coinAddress','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','/status','Failed\x20to\x20parse\x20JSON\x20response:','JSON\x20Parse\x20Error:\x20','CreatedOn','URL:','expired','error','not\x20confirmed','14025jNQxZa','Missing\x20data\x20in\x20response','https://tesoft.uk/gateway/cointopay/','statusText','message','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','488780ZytYBh','../loggerService','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20','amount','Payment\x20URL:','EUR','order_id','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','TransactionConfirmedOn','loggerService','merchant_reference_id','üè¶\x20Payment\x20Detail:','awaiting\x20fiat','PAID','üìä\x20Status\x20check\x20URL:','4544210FOyoIp','Amount','POST','943192BUmgtd','ExpiryTime','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','9jjLPdB','result','Status:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','statusUrl','Amount:','Status','Raw\x20Response\x20Body:','application/json','defineProperty','apiUrl','Response\x20Time:','logWhiteDomainRequest','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','FAILED','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','waiting','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20ERROR\x20===','855866pHinHQ','logWhiteDomainError','1134266cEAWtb','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','log','toLowerCase','EXPIRED','IBAN:','paid','cointopay','pending','match','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','3105736htlAGu','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Transaction\x20ID:','processWebhook','parse','Gateway\x20Payment\x20ID:','cancelled','data','QRCodeURL','failed','logWhiteDomainResponse','Status\x20Code:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','status','inputCurrency','Result:','3228xSmaau','6HHlVcH','1KKuYVI','not\x20found','checkPaymentStatus',',\x20body:\x20','PENDING','now','Error\x20Message:','Request\x20Body:','Response\x20Body:','payment_url','===\x20COINTOPAY\x20SUCCESS\x20===','createPaymentLink','TesSoft\x20Payment\x20System/1.0','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','verifyPayment','TransactionID'];a43_0x2abd=function(){return _0x262963;};return a43_0x2abd();}Object[a43_0x1d6b4a(0x1a1)](exports,'__esModule',{'value':!![]}),exports[a43_0x1d6b4a(0x1da)]=void 0x0;function a43_0x3884(_0x3fa0d6,_0x3ceaf4){const _0x2abd66=a43_0x2abd();return a43_0x3884=function(_0x388469,_0x3fabf6){_0x388469=_0x388469-0x165;let _0xd5700e=_0x2abd66[_0x388469];return _0xd5700e;},a43_0x3884(_0x3fa0d6,_0x3ceaf4);}const loggerService_1=require(a43_0x1d6b4a(0x182));class CoinToPayService{constructor(){const _0x21a51b=a43_0x1d6b4a;this['apiUrl']=_0x21a51b(0x17d),this['statusUrl']=_0x21a51b(0x16e),console[_0x21a51b(0x1af)](_0x21a51b(0x1c4)),console[_0x21a51b(0x1af)](_0x21a51b(0x191),this[_0x21a51b(0x19c)]);}async[a43_0x1d6b4a(0x1d5)](_0x4605a0){const _0x1137b6=a43_0x1d6b4a,{orderId:_0x526bc2,amount:_0x2fc428}=_0x4605a0;console['log'](_0x1137b6(0x1d7)+_0x2fc428+_0x1137b6(0x1e8));const _0x1624f2={'amount':_0x2fc428},_0x6d6a4b=Date[_0x1137b6(0x1cf)]();try{console[_0x1137b6(0x1af)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1137b6(0x1af)](_0x1137b6(0x177),this[_0x1137b6(0x1a2)]),console[_0x1137b6(0x1af)](_0x1137b6(0x1d1),JSON[_0x1137b6(0x168)](_0x1624f2,null,0x2)),console[_0x1137b6(0x1af)](_0x1137b6(0x19d),_0x2fc428,_0x1137b6(0x180)),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1a4)]('cointopay',_0x1137b6(0x169),'POST',_0x1624f2);const _0xb5faab=await fetch(this[_0x1137b6(0x1a2)],{'method':_0x1137b6(0x194),'headers':{'Content-Type':'application/json','Accept':_0x1137b6(0x1a0),'User-Agent':_0x1137b6(0x1d6)},'body':JSON['stringify'](_0x1624f2)}),_0x47c2be=Date[_0x1137b6(0x1cf)]()-_0x6d6a4b;console[_0x1137b6(0x1af)](_0x1137b6(0x1e9)),console[_0x1137b6(0x1af)](_0x1137b6(0x19a),_0xb5faab[_0x1137b6(0x1c5)]),console[_0x1137b6(0x1af)](_0x1137b6(0x167),_0xb5faab[_0x1137b6(0x17e)]),console[_0x1137b6(0x1af)](_0x1137b6(0x1dd),Object['fromEntries'](_0xb5faab['headers'][_0x1137b6(0x1ea)]())),console['log'](_0x1137b6(0x1a3),_0x47c2be+'ms');const _0x338260=await _0xb5faab['text']();console[_0x1137b6(0x1af)](_0x1137b6(0x19f),_0x338260);if(!_0xb5faab['ok']){console['error'](_0x1137b6(0x1aa)),console[_0x1137b6(0x179)](_0x1137b6(0x1e5),_0xb5faab[_0x1137b6(0x1c5)]),console[_0x1137b6(0x179)](_0x1137b6(0x1d2),_0x338260),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1c2)]('cointopay',_0x1137b6(0x169),_0xb5faab[_0x1137b6(0x1c5)],_0x338260,_0x47c2be),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1ac)]('cointopay',_0x1137b6(0x169),_0x1137b6(0x184)+_0xb5faab['status']+':\x20'+_0x338260);throw new Error(_0x1137b6(0x1df)+_0xb5faab[_0x1137b6(0x1c5)]+_0x1137b6(0x1cd)+_0x338260);}let _0x4262b9;try{_0x4262b9=JSON['parse'](_0x338260);}catch(_0x5506f4){console[_0x1137b6(0x179)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5506f4),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1ac)]('cointopay',_0x1137b6(0x169),'JSON\x20Parse\x20Error:\x20'+_0x5506f4);throw new Error(_0x1137b6(0x1e3)+_0x338260);}console['log'](_0x1137b6(0x197)),console[_0x1137b6(0x1af)]('Parsed\x20Result:',JSON[_0x1137b6(0x168)](_0x4262b9,null,0x2)),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1c2)](_0x1137b6(0x1b4),_0x1137b6(0x169),_0xb5faab[_0x1137b6(0x1c5)],_0x4262b9,_0x47c2be);if(_0x4262b9['error']){const _0x1c0c9d=_0x4262b9[_0x1137b6(0x17f)]||_0x4262b9['error']||_0x1137b6(0x1dc);console['error'](_0x1137b6(0x1b9)),console['error']('Error\x20Message:',_0x1c0c9d),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x1137b6(0x1e4)+_0x1c0c9d);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x1c0c9d);}if(!_0x4262b9[_0x1137b6(0x1d3)]||!_0x4262b9[_0x1137b6(0x1e6)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1137b6(0x179)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x1137b6(0x16b),_0x4262b9),loggerService_1['loggerService']['logWhiteDomainError'](_0x1137b6(0x1b4),_0x1137b6(0x169),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x1137b6(0x1af)](_0x1137b6(0x1d4)),console[_0x1137b6(0x1af)](_0x1137b6(0x1bd),_0x4262b9[_0x1137b6(0x1e6)]),console[_0x1137b6(0x1af)](_0x1137b6(0x186),_0x4262b9[_0x1137b6(0x1d3)]),console['log'](_0x1137b6(0x19d),_0x2fc428,_0x1137b6(0x187)),{'gateway_payment_id':_0x4262b9[_0x1137b6(0x1e6)],'payment_url':_0x4262b9[_0x1137b6(0x1d3)]};}catch(_0x299299){console[_0x1137b6(0x179)](_0x1137b6(0x16d)),console[_0x1137b6(0x179)](_0x1137b6(0x1e0),_0x299299),loggerService_1[_0x1137b6(0x18c)][_0x1137b6(0x1ac)](_0x1137b6(0x1b4),'/create',_0x299299);if(_0x299299 instanceof Error){console['error']('Error\x20message:',_0x299299['message']),console[_0x1137b6(0x179)]('Error\x20stack:',_0x299299['stack']);throw new Error(_0x1137b6(0x1db)+_0x299299['message']);}throw new Error(_0x1137b6(0x1ec));}}async[a43_0x1d6b4a(0x1cc)](_0x54c3f0){const _0x7902f2=a43_0x1d6b4a,_0x59a2ed=Date[_0x7902f2(0x1cf)]();try{console[_0x7902f2(0x1af)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x54c3f0);const _0xfb0b6d={'gatewayPaymentId':_0x54c3f0};loggerService_1[_0x7902f2(0x18c)][_0x7902f2(0x1a4)](_0x7902f2(0x1b4),'/status',_0x7902f2(0x194),_0xfb0b6d);const _0x1a2ae2=await fetch(this[_0x7902f2(0x19c)],{'method':_0x7902f2(0x194),'headers':{'Content-Type':_0x7902f2(0x1a0),'Accept':'application/json','User-Agent':_0x7902f2(0x1d6)},'body':JSON['stringify'](_0xfb0b6d)}),_0x4664e9=Date[_0x7902f2(0x1cf)]()-_0x59a2ed;console[_0x7902f2(0x1af)](_0x7902f2(0x172)),console['log'](_0x7902f2(0x19a),_0x1a2ae2['status']),console[_0x7902f2(0x1af)](_0x7902f2(0x1a3),_0x4664e9+'ms');if(!_0x1a2ae2['ok']){const _0x523791=await _0x1a2ae2['text']();console[_0x7902f2(0x179)]('HTTP\x20Status:',_0x1a2ae2[_0x7902f2(0x1c5)]),console[_0x7902f2(0x179)](_0x7902f2(0x1d2),_0x523791),loggerService_1[_0x7902f2(0x18c)][_0x7902f2(0x1c2)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x1a2ae2[_0x7902f2(0x1c5)],_0x523791,_0x4664e9),loggerService_1[_0x7902f2(0x18c)][_0x7902f2(0x1ac)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x7902f2(0x184)+_0x1a2ae2[_0x7902f2(0x1c5)]+':\x20'+_0x523791);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a2ae2[_0x7902f2(0x1c5)]);}const _0x212c3a=await _0x1a2ae2['text']();console[_0x7902f2(0x1af)](_0x7902f2(0x19f),_0x212c3a);let _0x4dcfaf;try{_0x4dcfaf=JSON[_0x7902f2(0x1bc)](_0x212c3a);}catch(_0x4eb8ca){console[_0x7902f2(0x179)](_0x7902f2(0x174),_0x4eb8ca),loggerService_1['loggerService'][_0x7902f2(0x1ac)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x7902f2(0x175)+_0x4eb8ca);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x212c3a);}loggerService_1['loggerService'][_0x7902f2(0x1c2)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x1a2ae2[_0x7902f2(0x1c5)],_0x4dcfaf,_0x4664e9),console[_0x7902f2(0x1af)](_0x7902f2(0x1a9)),console['log'](_0x7902f2(0x1c7),_0x4dcfaf['result']),console['log'](_0x7902f2(0x1c3),_0x4dcfaf[_0x7902f2(0x1e7)]),console[_0x7902f2(0x1af)](_0x7902f2(0x165),_0x4dcfaf['data']?.[_0x7902f2(0x19e)]),console[_0x7902f2(0x1af)](_0x7902f2(0x19d),_0x4dcfaf[_0x7902f2(0x1bf)]?.[_0x7902f2(0x193)]),console[_0x7902f2(0x1af)]('Currency:',_0x4dcfaf[_0x7902f2(0x1bf)]?.[_0x7902f2(0x1c6)]);if(_0x4dcfaf[_0x7902f2(0x199)]!=='success'||_0x4dcfaf[_0x7902f2(0x1e7)]!==0xc8){const _0xd644b4=_0x4dcfaf[_0x7902f2(0x17f)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x7902f2(0x179)](_0x7902f2(0x18a)),console[_0x7902f2(0x179)](_0x7902f2(0x1d0),_0xd644b4),loggerService_1[_0x7902f2(0x18c)][_0x7902f2(0x1ac)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x7902f2(0x16a)+_0xd644b4);throw new Error(_0x7902f2(0x16c)+_0xd644b4);}if(!_0x4dcfaf['data']){console[_0x7902f2(0x179)](_0x7902f2(0x1de)),console[_0x7902f2(0x179)](_0x7902f2(0x17c)),loggerService_1[_0x7902f2(0x18c)]['logWhiteDomainError']('cointopay',_0x7902f2(0x173),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x7902f2(0x1ae));}let _0xcf5d86=_0x7902f2(0x1ce);switch(_0x4dcfaf['data'][_0x7902f2(0x19e)]?.[_0x7902f2(0x1b0)]()){case _0x7902f2(0x1b3):_0xcf5d86=_0x7902f2(0x190);break;case'cancelled':case _0x7902f2(0x1c1):case _0x7902f2(0x179):_0xcf5d86=_0x7902f2(0x1a6);break;case _0x7902f2(0x178):case'timeout':_0xcf5d86=_0x7902f2(0x1b1);break;case _0x7902f2(0x1a8):case _0x7902f2(0x18f):case _0x7902f2(0x1b5):case _0x7902f2(0x1eb):default:_0xcf5d86='PENDING';break;}let _0x5ee387,_0x3842bf;if(_0x4dcfaf[_0x7902f2(0x1bf)]['PaymentDetail']){const _0x32ae43=_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x170)];console['log'](_0x7902f2(0x18e),_0x32ae43);const _0x16d423=_0x32ae43[_0x7902f2(0x1b6)](/IBAN\s+([A-Z0-9]+)/i);_0x16d423&&(_0x5ee387=_0x16d423[0x1],console[_0x7902f2(0x1af)](_0x7902f2(0x189),_0x5ee387)),_0x3842bf=_0x32ae43;}const _0x409570={'iban':_0x5ee387,'bankDetails':_0x3842bf,'transactionId':_0x4dcfaf['data'][_0x7902f2(0x1d9)],'coinAddress':_0x4dcfaf['data'][_0x7902f2(0x171)],'qrCodeUrl':_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x1c0)],'expiryTime':_0x4dcfaf['data'][_0x7902f2(0x196)],'createdOn':_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x176)],'confirmedOn':_0x4dcfaf[_0x7902f2(0x1bf)]['TransactionConfirmedOn']};console['log'](_0x7902f2(0x16f)),console[_0x7902f2(0x1af)](_0x7902f2(0x19a),_0x4dcfaf[_0x7902f2(0x1bf)]['Status'],'->',_0xcf5d86),console['log'](_0x7902f2(0x19d),_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x193)],_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x1c6)]),console['log'](_0x7902f2(0x1ba),_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x1d9)]),console[_0x7902f2(0x1af)](_0x7902f2(0x1b2),_0x5ee387||_0x7902f2(0x1cb)),console[_0x7902f2(0x1af)]('Created\x20On:',_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x176)]),console[_0x7902f2(0x1af)](_0x7902f2(0x1e2),_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x18b)]||_0x7902f2(0x17a));if(_0x4dcfaf['data']['Status']?.['toLowerCase']()===_0x7902f2(0x18f))console[_0x7902f2(0x1af)](_0x7902f2(0x1a5));else _0x4dcfaf[_0x7902f2(0x1bf)]['Status']?.['toLowerCase']()===_0x7902f2(0x1b3)&&console[_0x7902f2(0x1af)](_0x7902f2(0x1b7));return{'status':_0xcf5d86,'amount':parseFloat(_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x193)])||undefined,'currency':_0x4dcfaf[_0x7902f2(0x1bf)][_0x7902f2(0x1c6)]||_0x7902f2(0x187),'paymentDetails':_0x409570};}catch(_0x514758){console['error'](_0x7902f2(0x183),_0x514758),loggerService_1[_0x7902f2(0x18c)][_0x7902f2(0x1ac)](_0x7902f2(0x1b4),_0x7902f2(0x173),_0x514758);throw new Error(_0x7902f2(0x19b)+(_0x514758 instanceof Error?_0x514758[_0x7902f2(0x17f)]:_0x7902f2(0x1e1)));}}async[a43_0x1d6b4a(0x1d8)](_0x2d9d8d){const _0xeea603=a43_0x1d6b4a,_0xee1277=await this['checkPaymentStatus'](_0x2d9d8d);return{'status':_0xee1277[_0xeea603(0x1c5)],'amount':_0xee1277[_0xeea603(0x185)],'currency':_0xee1277[_0xeea603(0x1ed)]};}async[a43_0x1d6b4a(0x1bb)](_0x39340e){const _0x211b0a=a43_0x1d6b4a;console[_0x211b0a(0x1af)](_0x211b0a(0x1a7),_0x39340e);let _0xd4a351='PENDING';switch(_0x39340e[_0x211b0a(0x1c5)]?.[_0x211b0a(0x1b0)]()){case _0x211b0a(0x1b3):_0xd4a351=_0x211b0a(0x190);break;case _0x211b0a(0x1be):case _0x211b0a(0x1c1):case _0x211b0a(0x179):_0xd4a351=_0x211b0a(0x1a6);break;case _0x211b0a(0x178):case'timeout':_0xd4a351='EXPIRED';break;case _0x211b0a(0x1b5):case _0x211b0a(0x1a8):case _0x211b0a(0x18f):case _0x211b0a(0x1eb):default:_0xd4a351='PENDING';break;}return{'paymentId':_0x39340e[_0x211b0a(0x188)]||_0x39340e[_0x211b0a(0x18d)]||'','status':_0xd4a351,'amount':_0x39340e[_0x211b0a(0x185)],'currency':_0x39340e[_0x211b0a(0x1ed)]||_0x211b0a(0x187)};}}exports[a43_0x1d6b4a(0x1da)]=CoinToPayService;