'use strict';const a38_0x449bd4=a38_0x120a;function a38_0x120a(_0x111f45,_0x58e574){const _0x198c5f=a38_0x198c();return a38_0x120a=function(_0x120a98,_0x47cdc2){_0x120a98=_0x120a98-0x15c;let _0x26578e=_0x198c5f[_0x120a98];return _0x26578e;},a38_0x120a(_0x111f45,_0x58e574);}(function(_0x263a6f,_0x3a1457){const _0x281d6a=a38_0x120a,_0x3a4bd4=_0x263a6f();while(!![]){try{const _0x176f10=parseInt(_0x281d6a(0x1cd))/0x1*(parseInt(_0x281d6a(0x1e2))/0x2)+-parseInt(_0x281d6a(0x162))/0x3+parseInt(_0x281d6a(0x1d9))/0x4*(parseInt(_0x281d6a(0x1a0))/0x5)+parseInt(_0x281d6a(0x189))/0x6*(-parseInt(_0x281d6a(0x19e))/0x7)+parseInt(_0x281d6a(0x1bd))/0x8+-parseInt(_0x281d6a(0x16d))/0x9*(-parseInt(_0x281d6a(0x161))/0xa)+parseInt(_0x281d6a(0x1d0))/0xb;if(_0x176f10===_0x3a1457)break;else _0x3a4bd4['push'](_0x3a4bd4['shift']());}catch(_0x37120e){_0x3a4bd4['push'](_0x3a4bd4['shift']());}}}(a38_0x198c,0xc404a));function a38_0x198c(){const _0x28ef0c=['===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','stack','Parsed\x20Result:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Response\x20Time:','Incomplete\x20response:\x20missing\x20data','URL:','inputCurrency','fromEntries','https://tesoft.uk/gateway/cointopay/status.php','created','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','logWhiteDomainRequest','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','currency','üè¶\x20Extracted\x20IBAN:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Amount:','Error\x20message:','Confirmed\x20On:','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20API','data','now','6460256mBSRxR','application/json','ExpiryTime','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','paid','HTTP\x20','Status\x20Text:','payment_url','/status','üìä\x20Status\x20check\x20URL:','checkPaymentStatus','PAID','stringify','statusText','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','CoinToPayService','6KJuBTZ','match','CoinToPay\x20status\x20API\x20error:\x20','6287435tPmSxK','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','/create','JSON\x20Parse\x20Error:\x20','expired','TransactionConfirmedOn','text','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','4596WYGFUs','not\x20confirmed','__esModule','https://tesoft.uk/gateway/cointopay/','headers','toLowerCase','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','pending','Result:','339006anhZyz','status_code','gateway_payment_id','message','Business\x20Error:\x20',',\x20body:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','1642400vLrcxW','4442832cOZnUS','Status:','PENDING','apiUrl','createPaymentLink','order_id','defineProperty','EXPIRED','CreatedOn','Response\x20Body:','amount','9GTyCLz','Created\x20On:','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','verifyPayment','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PaymentDetail','Status','Headers:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TesSoft\x20Payment\x20System/1.0','failed','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Gateway\x20Payment\x20ID:','Currency:','entries','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20URL:','Payment\x20Status:','POST','Missing\x20data\x20in\x20response','FAILED','Status\x20Code:','2555466PkLqIw','Error\x20Message:','result','Amount','Transaction\x20ID:','===\x20COINTOPAY\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','cancelled','loggerService','cointopay','error','EUR','parse','not\x20found','status','timeout','HTTP\x20Status:','processWebhook','../loggerService','CoinToPay\x20API\x20error:\x20','Unknown\x20error','7xvIpts','log','650dEHyyv','coinAddress'];a38_0x198c=function(){return _0x28ef0c;};return a38_0x198c();}Object[a38_0x449bd4(0x168)](exports,a38_0x449bd4(0x1db),{'value':!![]}),exports[a38_0x449bd4(0x1cc)]=void 0x0;const loggerService_1=require(a38_0x449bd4(0x19b));class CoinToPayService{constructor(){const _0x3ca53a=a38_0x449bd4;this[_0x3ca53a(0x165)]=_0x3ca53a(0x1dc),this['statusUrl']=_0x3ca53a(0x1ae),console[_0x3ca53a(0x19f)](_0x3ca53a(0x1b0)),console['log'](_0x3ca53a(0x1c6),this['statusUrl']);}async[a38_0x449bd4(0x166)](_0x5b0e63){const _0x3960f0=a38_0x449bd4,{orderId:_0x357790,amount:_0x11e98e}=_0x5b0e63;console[_0x3960f0(0x19f)](_0x3960f0(0x1b2)+_0x11e98e+'\x20EUR');const _0x4c66f4={'amount':_0x11e98e},_0x154580=Date[_0x3960f0(0x1bc)]();try{console['log'](_0x3960f0(0x1cb)),console[_0x3960f0(0x19f)](_0x3960f0(0x1ab),this['apiUrl']),console[_0x3960f0(0x19f)]('Request\x20Body:',JSON[_0x3960f0(0x1c9)](_0x4c66f4,null,0x2)),console[_0x3960f0(0x19f)](_0x3960f0(0x1b6),_0x11e98e,_0x3960f0(0x1d2)),loggerService_1[_0x3960f0(0x191)]['logWhiteDomainRequest']('cointopay','/create',_0x3960f0(0x185),_0x4c66f4);const _0x331668=await fetch(this[_0x3960f0(0x165)],{'method':_0x3960f0(0x185),'headers':{'Content-Type':_0x3960f0(0x1be),'Accept':_0x3960f0(0x1be),'User-Agent':_0x3960f0(0x179)},'body':JSON['stringify'](_0x4c66f4)}),_0x58de5a=Date[_0x3960f0(0x1bc)]()-_0x154580;console[_0x3960f0(0x19f)](_0x3960f0(0x17d)),console[_0x3960f0(0x19f)](_0x3960f0(0x163),_0x331668[_0x3960f0(0x197)]),console[_0x3960f0(0x19f)](_0x3960f0(0x1c3),_0x331668[_0x3960f0(0x1ca)]),console[_0x3960f0(0x19f)](_0x3960f0(0x177),Object[_0x3960f0(0x1ad)](_0x331668[_0x3960f0(0x1dd)][_0x3960f0(0x181)]())),console[_0x3960f0(0x19f)](_0x3960f0(0x1a9),_0x58de5a+'ms');const _0x3d50c6=await _0x331668[_0x3960f0(0x1d7)]();console[_0x3960f0(0x19f)]('Raw\x20Response\x20Body:',_0x3d50c6);if(!_0x331668['ok']){console[_0x3960f0(0x193)](_0x3960f0(0x15f)),console[_0x3960f0(0x193)](_0x3960f0(0x199),_0x331668[_0x3960f0(0x197)]),console[_0x3960f0(0x193)](_0x3960f0(0x16b),_0x3d50c6),loggerService_1[_0x3960f0(0x191)][_0x3960f0(0x1a3)](_0x3960f0(0x192),'/create',_0x331668[_0x3960f0(0x197)],_0x3d50c6,_0x58de5a),loggerService_1['loggerService'][_0x3960f0(0x173)]('cointopay',_0x3960f0(0x1d3),_0x3960f0(0x1c2)+_0x331668[_0x3960f0(0x197)]+':\x20'+_0x3d50c6);throw new Error(_0x3960f0(0x160)+_0x331668['status']+_0x3960f0(0x15e)+_0x3d50c6);}let _0x5673fc;try{_0x5673fc=JSON[_0x3960f0(0x195)](_0x3d50c6);}catch(_0x340a1e){console['error'](_0x3960f0(0x182),_0x340a1e),loggerService_1[_0x3960f0(0x191)]['logWhiteDomainError']('cointopay',_0x3960f0(0x1d3),_0x3960f0(0x1d4)+_0x340a1e);throw new Error(_0x3960f0(0x18f)+_0x3d50c6);}console[_0x3960f0(0x19f)](_0x3960f0(0x1c0)),console[_0x3960f0(0x19f)](_0x3960f0(0x1a7),JSON['stringify'](_0x5673fc,null,0x2)),loggerService_1[_0x3960f0(0x191)][_0x3960f0(0x1a3)]('cointopay','/create',_0x331668['status'],_0x5673fc,_0x58de5a);if(_0x5673fc['error']){const _0xb3f690=_0x5673fc[_0x3960f0(0x15c)]||_0x5673fc[_0x3960f0(0x193)]||_0x3960f0(0x1ba);console['error'](_0x3960f0(0x1a8)),console[_0x3960f0(0x193)](_0x3960f0(0x18a),_0xb3f690),loggerService_1['loggerService'][_0x3960f0(0x173)]('cointopay',_0x3960f0(0x1d3),_0x3960f0(0x15d)+_0xb3f690);throw new Error(_0x3960f0(0x19c)+_0xb3f690);}if(!_0x5673fc[_0x3960f0(0x1c4)]||!_0x5673fc['gateway_payment_id']){console['error'](_0x3960f0(0x1a2)),console['error'](_0x3960f0(0x1df)),console['error']('Response\x20data:',_0x5673fc),loggerService_1['loggerService'][_0x3960f0(0x173)](_0x3960f0(0x192),_0x3960f0(0x1d3),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3960f0(0x170));}return console[_0x3960f0(0x19f)](_0x3960f0(0x18e)),console[_0x3960f0(0x19f)](_0x3960f0(0x17f),_0x5673fc[_0x3960f0(0x1e4)]),console['log'](_0x3960f0(0x183),_0x5673fc[_0x3960f0(0x1c4)]),console[_0x3960f0(0x19f)](_0x3960f0(0x1b6),_0x11e98e,_0x3960f0(0x194)),{'gateway_payment_id':_0x5673fc[_0x3960f0(0x1e4)],'payment_url':_0x5673fc[_0x3960f0(0x1c4)]};}catch(_0x4264fb){console[_0x3960f0(0x193)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x3960f0(0x193)]('Error\x20details:',_0x4264fb),loggerService_1[_0x3960f0(0x191)]['logWhiteDomainError']('cointopay',_0x3960f0(0x1d3),_0x4264fb);if(_0x4264fb instanceof Error){console['error'](_0x3960f0(0x1b7),_0x4264fb[_0x3960f0(0x15c)]),console['error']('Error\x20stack:',_0x4264fb[_0x3960f0(0x1a6)]);throw new Error(_0x3960f0(0x1b5)+_0x4264fb[_0x3960f0(0x15c)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a38_0x449bd4(0x1c7)](_0x39e618){const _0x35e211=a38_0x449bd4,_0x4b5be7=Date['now']();try{console[_0x35e211(0x19f)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x39e618);const _0x52962b={'gatewayPaymentId':_0x39e618};loggerService_1[_0x35e211(0x191)][_0x35e211(0x1b1)]('cointopay',_0x35e211(0x1c5),'POST',_0x52962b);const _0x58fb97=await fetch(this['statusUrl'],{'method':_0x35e211(0x185),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x35e211(0x179)},'body':JSON[_0x35e211(0x1c9)](_0x52962b)}),_0x2fcc00=Date[_0x35e211(0x1bc)]()-_0x4b5be7;console['log'](_0x35e211(0x17c)),console[_0x35e211(0x19f)](_0x35e211(0x163),_0x58fb97[_0x35e211(0x197)]),console['log'](_0x35e211(0x1a9),_0x2fcc00+'ms');if(!_0x58fb97['ok']){const _0x375c27=await _0x58fb97['text']();console['error'](_0x35e211(0x199),_0x58fb97[_0x35e211(0x197)]),console['error']('Response\x20Body:',_0x375c27),loggerService_1[_0x35e211(0x191)][_0x35e211(0x1a3)](_0x35e211(0x192),_0x35e211(0x1c5),_0x58fb97['status'],_0x375c27,_0x2fcc00),loggerService_1[_0x35e211(0x191)]['logWhiteDomainError'](_0x35e211(0x192),_0x35e211(0x1c5),'HTTP\x20'+_0x58fb97[_0x35e211(0x197)]+':\x20'+_0x375c27);throw new Error(_0x35e211(0x160)+_0x58fb97[_0x35e211(0x197)]);}const _0xc6abf9=await _0x58fb97[_0x35e211(0x1d7)]();console['log'](_0x35e211(0x1b9),_0xc6abf9);let _0x3c11e7;try{_0x3c11e7=JSON[_0x35e211(0x195)](_0xc6abf9);}catch(_0x2ca43c){console[_0x35e211(0x193)](_0x35e211(0x182),_0x2ca43c),loggerService_1[_0x35e211(0x191)][_0x35e211(0x173)](_0x35e211(0x192),_0x35e211(0x1c5),_0x35e211(0x1d4)+_0x2ca43c);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0xc6abf9);}loggerService_1[_0x35e211(0x191)][_0x35e211(0x1a3)](_0x35e211(0x192),_0x35e211(0x1c5),_0x58fb97[_0x35e211(0x197)],_0x3c11e7,_0x2fcc00),console[_0x35e211(0x19f)](_0x35e211(0x171)),console['log'](_0x35e211(0x1e1),_0x3c11e7['result']),console[_0x35e211(0x19f)](_0x35e211(0x188),_0x3c11e7[_0x35e211(0x1e3)]),console[_0x35e211(0x19f)](_0x35e211(0x184),_0x3c11e7['data']?.[_0x35e211(0x176)]),console['log']('Amount:',_0x3c11e7['data']?.['Amount']),console[_0x35e211(0x19f)](_0x35e211(0x180),_0x3c11e7[_0x35e211(0x1bb)]?.[_0x35e211(0x1ac)]);if(_0x3c11e7[_0x35e211(0x18b)]!=='success'||_0x3c11e7[_0x35e211(0x1e3)]!==0xc8){const _0x3774bc=_0x3c11e7['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x35e211(0x193)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x35e211(0x193)]('Error\x20Message:',_0x3774bc),loggerService_1['loggerService'][_0x35e211(0x173)](_0x35e211(0x192),_0x35e211(0x1c5),_0x35e211(0x17b)+_0x3774bc);throw new Error(_0x35e211(0x1cf)+_0x3774bc);}if(!_0x3c11e7[_0x35e211(0x1bb)]){console[_0x35e211(0x193)](_0x35e211(0x174)),console['error'](_0x35e211(0x186)),loggerService_1['loggerService']['logWhiteDomainError'](_0x35e211(0x192),_0x35e211(0x1c5),_0x35e211(0x1aa));throw new Error(_0x35e211(0x17e));}let _0x1070e8=_0x35e211(0x164);switch(_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x176)]?.[_0x35e211(0x1de)]()){case _0x35e211(0x1c1):_0x1070e8=_0x35e211(0x1c8);break;case _0x35e211(0x190):case _0x35e211(0x17a):case _0x35e211(0x193):_0x1070e8=_0x35e211(0x187);break;case _0x35e211(0x1d5):case _0x35e211(0x198):_0x1070e8='EXPIRED';break;case'waiting':case _0x35e211(0x1a4):case _0x35e211(0x1e0):case _0x35e211(0x1af):default:_0x1070e8=_0x35e211(0x164);break;}let _0x102b7c,_0x1a67f7;if(_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x175)]){const _0x5c5e15=_0x3c11e7['data'][_0x35e211(0x175)];console[_0x35e211(0x19f)]('üè¶\x20Payment\x20Detail:',_0x5c5e15);const _0x56dcd1=_0x5c5e15[_0x35e211(0x1ce)](/IBAN\s+([A-Z0-9]+)/i);_0x56dcd1&&(_0x102b7c=_0x56dcd1[0x1],console[_0x35e211(0x19f)](_0x35e211(0x1b4),_0x102b7c)),_0x1a67f7=_0x5c5e15;}const _0x95a051={'iban':_0x102b7c,'bankDetails':_0x1a67f7,'transactionId':_0x3c11e7['data']['TransactionID'],'coinAddress':_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x1a1)],'qrCodeUrl':_0x3c11e7[_0x35e211(0x1bb)]['QRCodeURL'],'expiryTime':_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x1bf)],'createdOn':_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x16a)],'confirmedOn':_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x1d6)]};console[_0x35e211(0x19f)](_0x35e211(0x1a5)),console[_0x35e211(0x19f)]('Status:',_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x176)],'->',_0x1070e8),console[_0x35e211(0x19f)](_0x35e211(0x1b6),_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x18c)],_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x1ac)]),console[_0x35e211(0x19f)](_0x35e211(0x18d),_0x3c11e7['data']['TransactionID']),console[_0x35e211(0x19f)]('IBAN:',_0x102b7c||_0x35e211(0x196)),console[_0x35e211(0x19f)](_0x35e211(0x16e),_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x16a)]),console[_0x35e211(0x19f)](_0x35e211(0x1b8),_0x3c11e7[_0x35e211(0x1bb)]['TransactionConfirmedOn']||_0x35e211(0x1da));if(_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x176)]?.[_0x35e211(0x1de)]()===_0x35e211(0x1a4))console['log'](_0x35e211(0x178));else _0x3c11e7[_0x35e211(0x1bb)]['Status']?.['toLowerCase']()==='paid'&&console[_0x35e211(0x19f)](_0x35e211(0x1d8));return{'status':_0x1070e8,'amount':parseFloat(_0x3c11e7[_0x35e211(0x1bb)]['Amount'])||undefined,'currency':_0x3c11e7[_0x35e211(0x1bb)][_0x35e211(0x1ac)]||'EUR','paymentDetails':_0x95a051};}catch(_0x57f9e3){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x57f9e3),loggerService_1[_0x35e211(0x191)][_0x35e211(0x173)](_0x35e211(0x192),_0x35e211(0x1c5),_0x57f9e3);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x57f9e3 instanceof Error?_0x57f9e3[_0x35e211(0x15c)]:_0x35e211(0x19d)));}}async[a38_0x449bd4(0x172)](_0x42696b){const _0x2c48ec=a38_0x449bd4,_0x5da67f=await this[_0x2c48ec(0x1c7)](_0x42696b);return{'status':_0x5da67f['status'],'amount':_0x5da67f[_0x2c48ec(0x16c)],'currency':_0x5da67f[_0x2c48ec(0x1b3)]};}async[a38_0x449bd4(0x19a)](_0x1138cc){const _0x307dfd=a38_0x449bd4;console[_0x307dfd(0x19f)](_0x307dfd(0x1d1),_0x1138cc);let _0xb896cd=_0x307dfd(0x164);switch(_0x1138cc[_0x307dfd(0x197)]?.[_0x307dfd(0x1de)]()){case _0x307dfd(0x1c1):_0xb896cd=_0x307dfd(0x1c8);break;case _0x307dfd(0x190):case _0x307dfd(0x17a):case _0x307dfd(0x193):_0xb896cd='FAILED';break;case _0x307dfd(0x1d5):case _0x307dfd(0x198):_0xb896cd=_0x307dfd(0x169);break;case _0x307dfd(0x1e0):case'waiting':case _0x307dfd(0x1a4):case _0x307dfd(0x1af):default:_0xb896cd=_0x307dfd(0x164);break;}return{'paymentId':_0x1138cc[_0x307dfd(0x167)]||_0x1138cc[_0x307dfd(0x16f)]||'','status':_0xb896cd,'amount':_0x1138cc['amount'],'currency':_0x1138cc['currency']||_0x307dfd(0x194)};}}exports[a38_0x449bd4(0x1cc)]=CoinToPayService;