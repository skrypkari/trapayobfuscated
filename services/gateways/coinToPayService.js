'use strict';const a49_0x3e1f02=a49_0xd7d4;function a49_0xd7d4(_0x4084c3,_0x4fbcc9){const _0x29b37c=a49_0x29b3();return a49_0xd7d4=function(_0xd7d410,_0x230df5){_0xd7d410=_0xd7d410-0x175;let _0x443798=_0x29b37c[_0xd7d410];return _0x443798;},a49_0xd7d4(_0x4084c3,_0x4fbcc9);}(function(_0xaf439c,_0xd90700){const _0x403b31=a49_0xd7d4,_0x3e5a5f=_0xaf439c();while(!![]){try{const _0x48a6e7=-parseInt(_0x403b31(0x175))/0x1+parseInt(_0x403b31(0x1c1))/0x2+parseInt(_0x403b31(0x186))/0x3+parseInt(_0x403b31(0x1dd))/0x4+parseInt(_0x403b31(0x1a1))/0x5+-parseInt(_0x403b31(0x17d))/0x6+parseInt(_0x403b31(0x177))/0x7*(-parseInt(_0x403b31(0x184))/0x8);if(_0x48a6e7===_0xd90700)break;else _0x3e5a5f['push'](_0x3e5a5f['shift']());}catch(_0x204046){_0x3e5a5f['push'](_0x3e5a5f['shift']());}}}(a49_0x29b3,0x9f68c));Object[a49_0x3e1f02(0x1ec)](exports,a49_0x3e1f02(0x1c4),{'value':!![]}),exports[a49_0x3e1f02(0x1df)]=void 0x0;const loggerService_1=require(a49_0x3e1f02(0x1e5));function a49_0x29b3(){const _0x5ef07d=['Payment\x20URL\x20(modified):',',\x20body:\x20','inputCurrency','apiUrl','success','match','timeout','coinAddress','&alternative=false','Error\x20details:','Raw\x20Response\x20Body:','Error\x20stack:','statusUrl','status_code','JSON\x20Parse\x20Error:\x20','Status:','Gateway\x20Payment\x20ID:','status','cointopay','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','parse','https://tesoft.uk/gateway/cointopay/','HTTP\x20Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','createPaymentLink','amount','1342296YgsajL','URL:','PENDING','__esModule','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Parsed\x20Result:','Amount','Headers:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20parse\x20JSON\x20response:','POST','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','waiting','Unknown\x20error\x20from\x20CoinToPay\x20API','CoinToPay\x20API\x20error:\x20','HTTP\x20','Payment\x20Status:','message','result','Confirmed\x20On:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','checkPaymentStatus','TransactionID','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Response\x20data:','Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','2367840fokOLG','data','CoinToPayService','loggerService','/status','logWhiteDomainResponse','Business\x20Error:\x20','Result:','../loggerService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','statusText','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','now','Transaction\x20ID:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','defineProperty','üè¶\x20Extracted\x20IBAN:','PAID','application/json','currency','Response\x20Time:','entries','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','logWhiteDomainRequest','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','not\x20found','fromEntries','toLowerCase','\x20EUR','log','Response\x20Body:','155003nqoDhY','PaymentDetail','5506921jMIWzX','payment_url','Amount:','verifyPayment','===\x20COINTOPAY\x20SUCCESS\x20===','IBAN:','136758eFqgSW','EUR','/create','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status\x20Code:','headers','CreatedOn','24gZaloO','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','3491598JpNeMp','order_id','Request\x20Body:','ExpiryTime','created','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','stack','merchant_reference_id','Error\x20message:','error','awaiting\x20fiat','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','text','not\x20confirmed','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','üè¶\x20Payment\x20Detail:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','TransactionConfirmedOn','cancelled','EXPIRED','stringify','paid','Error\x20Message:','gateway_payment_id','FAILED','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','3819355WwPZJc','Status','expired','failed','CoinToPay\x20payment\x20status\x20check\x20error:'];a49_0x29b3=function(){return _0x5ef07d;};return a49_0x29b3();}class CoinToPayService{constructor(){const _0x49ff03=a49_0x3e1f02;this[_0x49ff03(0x1a9)]=_0x49ff03(0x1bc),this[_0x49ff03(0x1b2)]=_0x49ff03(0x1f3),console[_0x49ff03(0x1ff)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x49ff03(0x1ff)]('üìä\x20Status\x20check\x20URL:',this[_0x49ff03(0x1b2)]);}async[a49_0x3e1f02(0x1bf)](_0x5b254c){const _0x32c7c7=a49_0x3e1f02,{orderId:_0x222215,amount:_0x577f75}=_0x5b254c;console[_0x32c7c7(0x1ff)](_0x32c7c7(0x1eb)+_0x577f75+_0x32c7c7(0x1fe));const _0x290ef8={'amount':_0x577f75},_0x53b771=Date['now']();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x32c7c7(0x1ff)](_0x32c7c7(0x1c2),this['apiUrl']),console[_0x32c7c7(0x1ff)](_0x32c7c7(0x188),JSON[_0x32c7c7(0x19a)](_0x290ef8,null,0x2)),console['log'](_0x32c7c7(0x179),_0x577f75,_0x32c7c7(0x196)),loggerService_1[_0x32c7c7(0x1e0)][_0x32c7c7(0x1f8)](_0x32c7c7(0x1b8),'/create','POST',_0x290ef8);const _0x47b007=await fetch(this['apiUrl'],{'method':_0x32c7c7(0x1cb),'headers':{'Content-Type':'application/json','Accept':_0x32c7c7(0x1ef),'User-Agent':_0x32c7c7(0x1da)},'body':JSON[_0x32c7c7(0x19a)](_0x290ef8)}),_0x405284=Date['now']()-_0x53b771;console['log'](_0x32c7c7(0x1c9)),console[_0x32c7c7(0x1ff)]('Status:',_0x47b007[_0x32c7c7(0x1b7)]),console['log']('Status\x20Text:',_0x47b007[_0x32c7c7(0x1e7)]),console[_0x32c7c7(0x1ff)](_0x32c7c7(0x1c8),Object[_0x32c7c7(0x1fc)](_0x47b007[_0x32c7c7(0x182)][_0x32c7c7(0x1f2)]())),console[_0x32c7c7(0x1ff)]('Response\x20Time:',_0x405284+'ms');const _0x437d04=await _0x47b007[_0x32c7c7(0x192)]();console[_0x32c7c7(0x1ff)](_0x32c7c7(0x1b0),_0x437d04);if(!_0x47b007['ok']){console[_0x32c7c7(0x18f)](_0x32c7c7(0x1a0)),console[_0x32c7c7(0x18f)](_0x32c7c7(0x1bd),_0x47b007['status']),console[_0x32c7c7(0x18f)](_0x32c7c7(0x200),_0x437d04),loggerService_1[_0x32c7c7(0x1e0)][_0x32c7c7(0x1e2)](_0x32c7c7(0x1b8),'/create',_0x47b007['status'],_0x437d04,_0x405284),loggerService_1[_0x32c7c7(0x1e0)][_0x32c7c7(0x1f9)](_0x32c7c7(0x1b8),_0x32c7c7(0x17f),_0x32c7c7(0x1d0)+_0x47b007[_0x32c7c7(0x1b7)]+':\x20'+_0x437d04);throw new Error('HTTP\x20error!\x20status:\x20'+_0x47b007[_0x32c7c7(0x1b7)]+_0x32c7c7(0x1a7)+_0x437d04);}let _0x1d5e45;try{_0x1d5e45=JSON[_0x32c7c7(0x1bb)](_0x437d04);}catch(_0x38400a){console[_0x32c7c7(0x18f)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x38400a),loggerService_1['loggerService']['logWhiteDomainError'](_0x32c7c7(0x1b8),'/create','JSON\x20Parse\x20Error:\x20'+_0x38400a);throw new Error(_0x32c7c7(0x191)+_0x437d04);}console[_0x32c7c7(0x1ff)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x32c7c7(0x1ff)](_0x32c7c7(0x1c6),JSON[_0x32c7c7(0x19a)](_0x1d5e45,null,0x2)),loggerService_1[_0x32c7c7(0x1e0)][_0x32c7c7(0x1e2)](_0x32c7c7(0x1b8),_0x32c7c7(0x17f),_0x47b007[_0x32c7c7(0x1b7)],_0x1d5e45,_0x405284);if(_0x1d5e45['error']){const _0x26316e=_0x1d5e45[_0x32c7c7(0x1d2)]||_0x1d5e45[_0x32c7c7(0x18f)]||_0x32c7c7(0x1ce);console[_0x32c7c7(0x18f)](_0x32c7c7(0x1ba)),console[_0x32c7c7(0x18f)](_0x32c7c7(0x19c),_0x26316e),loggerService_1[_0x32c7c7(0x1e0)][_0x32c7c7(0x1f9)](_0x32c7c7(0x1b8),'/create',_0x32c7c7(0x1e3)+_0x26316e);throw new Error(_0x32c7c7(0x1cf)+_0x26316e);}if(!_0x1d5e45[_0x32c7c7(0x178)]||!_0x1d5e45[_0x32c7c7(0x19d)]){console[_0x32c7c7(0x18f)](_0x32c7c7(0x1f6)),console['error'](_0x32c7c7(0x185)),console[_0x32c7c7(0x18f)](_0x32c7c7(0x1d9),_0x1d5e45),loggerService_1['loggerService'][_0x32c7c7(0x1f9)]('cointopay',_0x32c7c7(0x17f),_0x32c7c7(0x1c5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x32c7c7(0x1ff)](_0x32c7c7(0x17b)),console['log'](_0x32c7c7(0x1b6),_0x1d5e45[_0x32c7c7(0x19d)]),console['log']('Payment\x20URL\x20(original):',_0x1d5e45['payment_url']);const _0x27410c=_0x1d5e45['payment_url']+_0x32c7c7(0x1ae);return console['log'](_0x32c7c7(0x1a6),_0x27410c),console['log'](_0x32c7c7(0x179),_0x577f75,_0x32c7c7(0x17e)),{'gateway_payment_id':_0x1d5e45[_0x32c7c7(0x19d)],'payment_url':_0x27410c};}catch(_0x288f91){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x32c7c7(0x18f)](_0x32c7c7(0x1af),_0x288f91),loggerService_1['loggerService']['logWhiteDomainError'](_0x32c7c7(0x1b8),'/create',_0x288f91);if(_0x288f91 instanceof Error){console[_0x32c7c7(0x18f)](_0x32c7c7(0x18e),_0x288f91['message']),console['error'](_0x32c7c7(0x1b1),_0x288f91[_0x32c7c7(0x18c)]);throw new Error(_0x32c7c7(0x1be)+_0x288f91['message']);}throw new Error(_0x32c7c7(0x1f4));}}async[a49_0x3e1f02(0x1d6)](_0x1108ed){const _0x562705=a49_0x3e1f02,_0x5d3feb=Date['now']();try{console[_0x562705(0x1ff)](_0x562705(0x1cc)+_0x1108ed);const _0x3a0d34={'gatewayPaymentId':_0x1108ed};loggerService_1[_0x562705(0x1e0)]['logWhiteDomainRequest']('cointopay',_0x562705(0x1e1),_0x562705(0x1cb),_0x3a0d34);const _0x5ef732=await fetch(this['statusUrl'],{'method':_0x562705(0x1cb),'headers':{'Content-Type':_0x562705(0x1ef),'Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x562705(0x19a)](_0x3a0d34)}),_0x4a07a7=Date[_0x562705(0x1e9)]()-_0x5d3feb;console[_0x562705(0x1ff)](_0x562705(0x1e6)),console[_0x562705(0x1ff)]('Status:',_0x5ef732[_0x562705(0x1b7)]),console[_0x562705(0x1ff)](_0x562705(0x1f1),_0x4a07a7+'ms');if(!_0x5ef732['ok']){const _0xead4be=await _0x5ef732[_0x562705(0x192)]();console[_0x562705(0x18f)]('HTTP\x20Status:',_0x5ef732[_0x562705(0x1b7)]),console[_0x562705(0x18f)](_0x562705(0x200),_0xead4be),loggerService_1[_0x562705(0x1e0)][_0x562705(0x1e2)](_0x562705(0x1b8),_0x562705(0x1e1),_0x5ef732[_0x562705(0x1b7)],_0xead4be,_0x4a07a7),loggerService_1[_0x562705(0x1e0)][_0x562705(0x1f9)](_0x562705(0x1b8),'/status','HTTP\x20'+_0x5ef732['status']+':\x20'+_0xead4be);throw new Error(_0x562705(0x1b9)+_0x5ef732[_0x562705(0x1b7)]);}const _0x568a56=await _0x5ef732[_0x562705(0x192)]();console[_0x562705(0x1ff)](_0x562705(0x1b0),_0x568a56);let _0x1921f3;try{_0x1921f3=JSON[_0x562705(0x1bb)](_0x568a56);}catch(_0x3862ff){console[_0x562705(0x18f)](_0x562705(0x1ca),_0x3862ff),loggerService_1[_0x562705(0x1e0)][_0x562705(0x1f9)](_0x562705(0x1b8),_0x562705(0x1e1),_0x562705(0x1b4)+_0x3862ff);throw new Error(_0x562705(0x1fa)+_0x568a56);}loggerService_1[_0x562705(0x1e0)][_0x562705(0x1e2)](_0x562705(0x1b8),'/status',_0x5ef732['status'],_0x1921f3,_0x4a07a7),console[_0x562705(0x1ff)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x562705(0x1e4),_0x1921f3[_0x562705(0x1d3)]),console[_0x562705(0x1ff)](_0x562705(0x181),_0x1921f3[_0x562705(0x1b3)]),console[_0x562705(0x1ff)](_0x562705(0x1d1),_0x1921f3[_0x562705(0x1de)]?.[_0x562705(0x1a2)]),console[_0x562705(0x1ff)](_0x562705(0x179),_0x1921f3['data']?.[_0x562705(0x1c7)]),console['log']('Currency:',_0x1921f3[_0x562705(0x1de)]?.['inputCurrency']);if(_0x1921f3[_0x562705(0x1d3)]!==_0x562705(0x1aa)||_0x1921f3[_0x562705(0x1b3)]!==0xc8){const _0x584be1=_0x1921f3[_0x562705(0x1d2)]||_0x562705(0x1e8);console[_0x562705(0x18f)](_0x562705(0x1d8)),console[_0x562705(0x18f)](_0x562705(0x19c),_0x584be1),loggerService_1[_0x562705(0x1e0)][_0x562705(0x1f9)]('cointopay',_0x562705(0x1e1),_0x562705(0x1f7)+_0x584be1);throw new Error(_0x562705(0x19f)+_0x584be1);}if(!_0x1921f3[_0x562705(0x1de)]){console['error'](_0x562705(0x1db)),console[_0x562705(0x18f)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x562705(0x1e0)][_0x562705(0x1f9)](_0x562705(0x1b8),_0x562705(0x1e1),_0x562705(0x1f5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x1a76f5=_0x562705(0x1c3);switch(_0x1921f3['data'][_0x562705(0x1a2)]?.[_0x562705(0x1fd)]()){case _0x562705(0x19b):_0x1a76f5=_0x562705(0x1ee);break;case _0x562705(0x198):case _0x562705(0x1a4):case _0x562705(0x18f):_0x1a76f5=_0x562705(0x19e);break;case _0x562705(0x1a3):case'timeout':_0x1a76f5=_0x562705(0x199);break;case _0x562705(0x1cd):case _0x562705(0x190):case'pending':case _0x562705(0x18a):default:_0x1a76f5=_0x562705(0x1c3);break;}let _0x535974,_0x2b9036;if(_0x1921f3[_0x562705(0x1de)]['PaymentDetail']){const _0x1e59ed=_0x1921f3[_0x562705(0x1de)][_0x562705(0x176)];console[_0x562705(0x1ff)](_0x562705(0x195),_0x1e59ed);const _0x40ebcb=_0x1e59ed[_0x562705(0x1ab)](/IBAN\s+([A-Z0-9]+)/i);_0x40ebcb&&(_0x535974=_0x40ebcb[0x1],console[_0x562705(0x1ff)](_0x562705(0x1ed),_0x535974)),_0x2b9036=_0x1e59ed;}const _0x4b3a15={'iban':_0x535974,'bankDetails':_0x2b9036,'transactionId':_0x1921f3[_0x562705(0x1de)][_0x562705(0x1d7)],'coinAddress':_0x1921f3[_0x562705(0x1de)][_0x562705(0x1ad)],'qrCodeUrl':_0x1921f3[_0x562705(0x1de)][_0x562705(0x1dc)],'expiryTime':_0x1921f3[_0x562705(0x1de)][_0x562705(0x189)],'createdOn':_0x1921f3[_0x562705(0x1de)][_0x562705(0x183)],'confirmedOn':_0x1921f3[_0x562705(0x1de)]['TransactionConfirmedOn']};console[_0x562705(0x1ff)](_0x562705(0x1d5)),console[_0x562705(0x1ff)](_0x562705(0x1b5),_0x1921f3['data'][_0x562705(0x1a2)],'->',_0x1a76f5),console[_0x562705(0x1ff)]('Amount:',_0x1921f3[_0x562705(0x1de)][_0x562705(0x1c7)],_0x1921f3[_0x562705(0x1de)][_0x562705(0x1a8)]),console[_0x562705(0x1ff)](_0x562705(0x1ea),_0x1921f3['data']['TransactionID']),console[_0x562705(0x1ff)](_0x562705(0x17c),_0x535974||_0x562705(0x1fb)),console[_0x562705(0x1ff)]('Created\x20On:',_0x1921f3[_0x562705(0x1de)][_0x562705(0x183)]),console[_0x562705(0x1ff)](_0x562705(0x1d4),_0x1921f3[_0x562705(0x1de)][_0x562705(0x197)]||_0x562705(0x193));if(_0x1921f3['data']['Status']?.[_0x562705(0x1fd)]()===_0x562705(0x190))console['log'](_0x562705(0x180));else _0x1921f3[_0x562705(0x1de)][_0x562705(0x1a2)]?.[_0x562705(0x1fd)]()===_0x562705(0x19b)&&console[_0x562705(0x1ff)](_0x562705(0x18b));return{'status':_0x1a76f5,'amount':parseFloat(_0x1921f3[_0x562705(0x1de)][_0x562705(0x1c7)])||undefined,'currency':_0x1921f3[_0x562705(0x1de)][_0x562705(0x1a8)]||_0x562705(0x17e),'paymentDetails':_0x4b3a15};}catch(_0x446382){console['error'](_0x562705(0x1a5),_0x446382),loggerService_1['loggerService'][_0x562705(0x1f9)](_0x562705(0x1b8),_0x562705(0x1e1),_0x446382);throw new Error(_0x562705(0x194)+(_0x446382 instanceof Error?_0x446382['message']:'Unknown\x20error'));}}async[a49_0x3e1f02(0x17a)](_0x1bb171){const _0xef74e5=a49_0x3e1f02,_0x2174c1=await this[_0xef74e5(0x1d6)](_0x1bb171);return{'status':_0x2174c1[_0xef74e5(0x1b7)],'amount':_0x2174c1['amount'],'currency':_0x2174c1[_0xef74e5(0x1f0)]};}async['processWebhook'](_0x32aabf){const _0x2609b5=a49_0x3e1f02;console[_0x2609b5(0x1ff)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x32aabf);let _0x1e5f07=_0x2609b5(0x1c3);switch(_0x32aabf['status']?.[_0x2609b5(0x1fd)]()){case'paid':_0x1e5f07=_0x2609b5(0x1ee);break;case'cancelled':case _0x2609b5(0x1a4):case _0x2609b5(0x18f):_0x1e5f07='FAILED';break;case _0x2609b5(0x1a3):case _0x2609b5(0x1ac):_0x1e5f07=_0x2609b5(0x199);break;case'pending':case _0x2609b5(0x1cd):case _0x2609b5(0x190):case _0x2609b5(0x18a):default:_0x1e5f07='PENDING';break;}return{'paymentId':_0x32aabf[_0x2609b5(0x187)]||_0x32aabf[_0x2609b5(0x18d)]||'','status':_0x1e5f07,'amount':_0x32aabf[_0x2609b5(0x1c0)],'currency':_0x32aabf[_0x2609b5(0x1f0)]||_0x2609b5(0x17e)};}}exports[a49_0x3e1f02(0x1df)]=CoinToPayService;