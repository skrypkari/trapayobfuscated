'use strict';const a46_0x656d1f=a46_0x4467;(function(_0x35cd5a,_0x40a48e){const _0xfa6eb5=a46_0x4467,_0x5aa56b=_0x35cd5a();while(!![]){try{const _0x955cbc=parseInt(_0xfa6eb5(0x20f))/0x1*(-parseInt(_0xfa6eb5(0x20d))/0x2)+-parseInt(_0xfa6eb5(0x20c))/0x3*(-parseInt(_0xfa6eb5(0x1ff))/0x4)+-parseInt(_0xfa6eb5(0x20a))/0x5+-parseInt(_0xfa6eb5(0x224))/0x6+parseInt(_0xfa6eb5(0x1c1))/0x7*(-parseInt(_0xfa6eb5(0x220))/0x8)+parseInt(_0xfa6eb5(0x234))/0x9+parseInt(_0xfa6eb5(0x231))/0xa;if(_0x955cbc===_0x40a48e)break;else _0x5aa56b['push'](_0x5aa56b['shift']());}catch(_0x535061){_0x5aa56b['push'](_0x5aa56b['shift']());}}}(a46_0x5521,0x25752));function a46_0x4467(_0x582ac4,_0x583d8f){const _0x55211a=a46_0x5521();return a46_0x4467=function(_0x4467b5,_0x3069a2){_0x4467b5=_0x4467b5-0x1b2;let _0x2e8501=_0x55211a[_0x4467b5];return _0x2e8501;},a46_0x4467(_0x582ac4,_0x583d8f);}function a46_0x5521(){const _0x4e1853=['Amount','Status\x20API\x20Error:\x20','Request\x20Body:','timeout','status_code','===\x20COINTOPAY\x20API\x20ERROR\x20===','IBAN:','CoinToPayService','Error\x20Message:','HTTP\x20','/status','Payment\x20URL:','Business\x20Error:\x20','created','952RZZnWR','stringify','Incomplete\x20response:\x20missing\x20data','ExpiryTime','coinAddress','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','HTTP\x20Status:','gateway_payment_id','failed','Amount:','üìä\x20Status\x20check\x20URL:','954205QjJJRU','createPaymentLink','3567kqhnvK','80638MyLrTM','Status\x20Text:','1LEzlqb','Response\x20Time:','../loggerService','now','logWhiteDomainRequest','defineProperty','Error\x20details:','CreatedOn','TransactionConfirmedOn','Result:','Unknown\x20error\x20from\x20CoinToPay\x20API','Missing\x20data\x20in\x20response','logWhiteDomainError','Status\x20Code:','Failed\x20to\x20parse\x20JSON\x20response:','Status','EXPIRED','56UmKzVS','Response\x20data:','\x20EUR','loggerService','1091766ZNHhur','log','TransactionID','toLowerCase','payment_url','logWhiteDomainResponse','verifyPayment','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','üè¶\x20Extracted\x20IBAN:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','parse','Headers:','2961300mQjETc','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','apiUrl','654696djWfsF','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','checkPaymentStatus','PaymentDetail','headers','entries','stack','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Confirmed\x20On:','Transaction\x20ID:','error','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','success','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','JSON\x20Parse\x20Error:\x20','application/json','85309qZgDKK','result','HTTP\x20error!\x20status:\x20','status','match','waiting','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','QRCodeURL','statusUrl','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','FAILED','pending','message','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAID','currency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','POST','PENDING','cointopay','Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Payment\x20Status:','fromEntries','===\x20COINTOPAY\x20SUCCESS\x20===','Raw\x20Response\x20Body:','order_id','expired','CoinToPay\x20status\x20API\x20error:\x20','cancelled','https://tesoft.uk/gateway/cointopay/status.php','paid','text','amount','EUR','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Body:','inputCurrency','Currency:','statusText','https://tesoft.uk/gateway/cointopay/','Payment\x20System/1.0','data','/create','Error\x20message:'];a46_0x5521=function(){return _0x4e1853;};return a46_0x5521();}Object[a46_0x656d1f(0x214)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a46_0x656d1f(0x211));class CoinToPayService{constructor(){const _0x44a9c4=a46_0x656d1f;this[_0x44a9c4(0x233)]=_0x44a9c4(0x1ec),this[_0x44a9c4(0x1ca)]=_0x44a9c4(0x1e2),console['log'](_0x44a9c4(0x1c7)),console[_0x44a9c4(0x225)](_0x44a9c4(0x209),this[_0x44a9c4(0x1ca)]);}async[a46_0x656d1f(0x20b)](_0x2cd5ac){const _0x564a7d=a46_0x656d1f,{orderId:_0x586f4f,amount:_0x41d844}=_0x2cd5ac;console[_0x564a7d(0x225)](_0x564a7d(0x1b5)+_0x41d844+_0x564a7d(0x222));const _0xf29125={'amount':_0x41d844},_0x2322df=Date[_0x564a7d(0x212)]();try{console[_0x564a7d(0x225)](_0x564a7d(0x1d9)),console[_0x564a7d(0x225)]('URL:',this['apiUrl']),console[_0x564a7d(0x225)](_0x564a7d(0x1f3),JSON[_0x564a7d(0x200)](_0xf29125,null,0x2)),console[_0x564a7d(0x225)]('Amount:',_0x41d844,_0x564a7d(0x1c8)),loggerService_1[_0x564a7d(0x223)][_0x564a7d(0x213)]('cointopay','/create','POST',_0xf29125);const _0x355286=await fetch(this[_0x564a7d(0x233)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x564a7d(0x1ed)},'body':JSON[_0x564a7d(0x200)](_0xf29125)}),_0x3d74ac=Date[_0x564a7d(0x212)]()-_0x2322df;console['log'](_0x564a7d(0x1be)),console[_0x564a7d(0x225)]('Status:',_0x355286['status']),console[_0x564a7d(0x225)](_0x564a7d(0x20e),_0x355286[_0x564a7d(0x1eb)]),console[_0x564a7d(0x225)](_0x564a7d(0x230),Object[_0x564a7d(0x1db)](_0x355286[_0x564a7d(0x239)][_0x564a7d(0x23a)]())),console[_0x564a7d(0x225)](_0x564a7d(0x210),_0x3d74ac+'ms');const _0x1f2c46=await _0x355286['text']();console[_0x564a7d(0x225)]('Raw\x20Response\x20Body:',_0x1f2c46);if(!_0x355286['ok']){console[_0x564a7d(0x1b9)](_0x564a7d(0x1f6)),console[_0x564a7d(0x1b9)](_0x564a7d(0x205),_0x355286['status']),console['error'](_0x564a7d(0x1e8),_0x1f2c46),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x564a7d(0x1ef),_0x355286[_0x564a7d(0x1c4)],_0x1f2c46,_0x3d74ac),loggerService_1['loggerService']['logWhiteDomainError'](_0x564a7d(0x1d5),_0x564a7d(0x1ef),_0x564a7d(0x1fa)+_0x355286[_0x564a7d(0x1c4)]+':\x20'+_0x1f2c46);throw new Error('HTTP\x20error!\x20status:\x20'+_0x355286[_0x564a7d(0x1c4)]+',\x20body:\x20'+_0x1f2c46);}let _0x584998;try{_0x584998=JSON[_0x564a7d(0x22f)](_0x1f2c46);}catch(_0x584b82){console[_0x564a7d(0x1b9)](_0x564a7d(0x21d),_0x584b82),loggerService_1[_0x564a7d(0x223)][_0x564a7d(0x21b)]('cointopay',_0x564a7d(0x1ef),_0x564a7d(0x1bf)+_0x584b82);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x1f2c46);}console[_0x564a7d(0x225)](_0x564a7d(0x1d7)),console[_0x564a7d(0x225)]('Parsed\x20Result:',JSON[_0x564a7d(0x200)](_0x584998,null,0x2)),loggerService_1['loggerService'][_0x564a7d(0x229)](_0x564a7d(0x1d5),_0x564a7d(0x1ef),_0x355286['status'],_0x584998,_0x3d74ac);if(_0x584998[_0x564a7d(0x1b9)]){const _0x59d093=_0x584998['message']||_0x584998[_0x564a7d(0x1b9)]||_0x564a7d(0x219);console[_0x564a7d(0x1b9)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x564a7d(0x1b9)]('Error\x20Message:',_0x59d093),loggerService_1[_0x564a7d(0x223)]['logWhiteDomainError']('cointopay','/create',_0x564a7d(0x1fd)+_0x59d093);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x59d093);}if(!_0x584998[_0x564a7d(0x228)]||!_0x584998[_0x564a7d(0x206)]){console[_0x564a7d(0x1b9)](_0x564a7d(0x1cf)),console[_0x564a7d(0x1b9)](_0x564a7d(0x1cb)),console[_0x564a7d(0x1b9)](_0x564a7d(0x221),_0x584998),loggerService_1[_0x564a7d(0x223)][_0x564a7d(0x21b)](_0x564a7d(0x1d5),_0x564a7d(0x1ef),_0x564a7d(0x22e));throw new Error(_0x564a7d(0x22b));}return console[_0x564a7d(0x225)](_0x564a7d(0x1dc)),console[_0x564a7d(0x225)](_0x564a7d(0x235),_0x584998[_0x564a7d(0x206)]),console[_0x564a7d(0x225)](_0x564a7d(0x1fc),_0x584998[_0x564a7d(0x228)]),console[_0x564a7d(0x225)]('Amount:',_0x41d844,'EUR'),{'gateway_payment_id':_0x584998['gateway_payment_id'],'payment_url':_0x584998[_0x564a7d(0x228)]};}catch(_0x274fa6){console[_0x564a7d(0x1b9)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x564a7d(0x1b9)](_0x564a7d(0x215),_0x274fa6),loggerService_1['loggerService']['logWhiteDomainError'](_0x564a7d(0x1d5),_0x564a7d(0x1ef),_0x274fa6);if(_0x274fa6 instanceof Error){console['error'](_0x564a7d(0x1f0),_0x274fa6[_0x564a7d(0x1ce)]),console[_0x564a7d(0x1b9)]('Error\x20stack:',_0x274fa6[_0x564a7d(0x1b2)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x274fa6['message']);}throw new Error(_0x564a7d(0x1d2));}}async[a46_0x656d1f(0x237)](_0x4e0682){const _0x2213ea=a46_0x656d1f,_0x1248a2=Date['now']();try{console[_0x2213ea(0x225)](_0x2213ea(0x1d8)+_0x4e0682);const _0x156b2a={'gatewayPaymentId':_0x4e0682};loggerService_1[_0x2213ea(0x223)]['logWhiteDomainRequest'](_0x2213ea(0x1d5),_0x2213ea(0x1fb),'POST',_0x156b2a);const _0x517dd7=await fetch(this[_0x2213ea(0x1ca)],{'method':_0x2213ea(0x1d3),'headers':{'Content-Type':_0x2213ea(0x1c0),'Accept':_0x2213ea(0x1c0),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x2213ea(0x200)](_0x156b2a)}),_0x5c79ba=Date[_0x2213ea(0x212)]()-_0x1248a2;console[_0x2213ea(0x225)](_0x2213ea(0x1bc)),console[_0x2213ea(0x225)](_0x2213ea(0x1d6),_0x517dd7['status']),console['log'](_0x2213ea(0x210),_0x5c79ba+'ms');if(!_0x517dd7['ok']){const _0x35e990=await _0x517dd7['text']();console[_0x2213ea(0x1b9)](_0x2213ea(0x205),_0x517dd7['status']),console[_0x2213ea(0x1b9)](_0x2213ea(0x1e8),_0x35e990),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x2213ea(0x1fb),_0x517dd7[_0x2213ea(0x1c4)],_0x35e990,_0x5c79ba),loggerService_1[_0x2213ea(0x223)][_0x2213ea(0x21b)](_0x2213ea(0x1d5),'/status','HTTP\x20'+_0x517dd7[_0x2213ea(0x1c4)]+':\x20'+_0x35e990);throw new Error(_0x2213ea(0x1c3)+_0x517dd7[_0x2213ea(0x1c4)]);}const _0x26d0a1=await _0x517dd7[_0x2213ea(0x1e4)]();console[_0x2213ea(0x225)](_0x2213ea(0x1dd),_0x26d0a1);let _0x2ef945;try{_0x2ef945=JSON[_0x2213ea(0x22f)](_0x26d0a1);}catch(_0x533220){console[_0x2213ea(0x1b9)](_0x2213ea(0x21d),_0x533220),loggerService_1[_0x2213ea(0x223)]['logWhiteDomainError']('cointopay','/status','JSON\x20Parse\x20Error:\x20'+_0x533220);throw new Error(_0x2213ea(0x232)+_0x26d0a1);}loggerService_1[_0x2213ea(0x223)]['logWhiteDomainResponse']('cointopay','/status',_0x517dd7['status'],_0x2ef945,_0x5c79ba),console[_0x2213ea(0x225)](_0x2213ea(0x236)),console[_0x2213ea(0x225)](_0x2213ea(0x218),_0x2ef945[_0x2213ea(0x1c2)]),console[_0x2213ea(0x225)](_0x2213ea(0x21c),_0x2ef945[_0x2213ea(0x1f5)]),console[_0x2213ea(0x225)](_0x2213ea(0x1da),_0x2ef945[_0x2213ea(0x1ee)]?.['Status']),console[_0x2213ea(0x225)](_0x2213ea(0x208),_0x2ef945['data']?.['Amount']),console[_0x2213ea(0x225)](_0x2213ea(0x1ea),_0x2ef945[_0x2213ea(0x1ee)]?.[_0x2213ea(0x1e9)]);if(_0x2ef945[_0x2213ea(0x1c2)]!==_0x2213ea(0x1bd)||_0x2ef945[_0x2213ea(0x1f5)]!==0xc8){const _0x35dc9c=_0x2ef945[_0x2213ea(0x1ce)]||_0x2213ea(0x1e7);console[_0x2213ea(0x1b9)](_0x2213ea(0x1b4)),console[_0x2213ea(0x1b9)](_0x2213ea(0x1f9),_0x35dc9c),loggerService_1[_0x2213ea(0x223)][_0x2213ea(0x21b)]('cointopay','/status',_0x2213ea(0x1f2)+_0x35dc9c);throw new Error(_0x2213ea(0x1e0)+_0x35dc9c);}if(!_0x2ef945[_0x2213ea(0x1ee)]){console[_0x2213ea(0x1b9)](_0x2213ea(0x1bb)),console[_0x2213ea(0x1b9)](_0x2213ea(0x21a)),loggerService_1[_0x2213ea(0x223)]['logWhiteDomainError'](_0x2213ea(0x1d5),_0x2213ea(0x1fb),_0x2213ea(0x201));throw new Error(_0x2213ea(0x22c));}let _0x64eb61=_0x2213ea(0x1d4);switch(_0x2ef945[_0x2213ea(0x1ee)]['Status']?.[_0x2213ea(0x227)]()){case'paid':_0x64eb61=_0x2213ea(0x1d0);break;case _0x2213ea(0x1e1):case _0x2213ea(0x207):case _0x2213ea(0x1b9):_0x64eb61='FAILED';break;case _0x2213ea(0x1df):case _0x2213ea(0x1f4):_0x64eb61=_0x2213ea(0x21f);break;case _0x2213ea(0x1c6):case _0x2213ea(0x1ba):case _0x2213ea(0x1cd):case'created':default:_0x64eb61='PENDING';break;}let _0x1a76c7,_0x3a5044;if(_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x238)]){const _0x6a3649=_0x2ef945['data'][_0x2213ea(0x238)];console[_0x2213ea(0x225)]('üè¶\x20Payment\x20Detail:',_0x6a3649);const _0x221d3a=_0x6a3649[_0x2213ea(0x1c5)](/IBAN\s+([A-Z0-9]+)/i);_0x221d3a&&(_0x1a76c7=_0x221d3a[0x1],console[_0x2213ea(0x225)](_0x2213ea(0x22d),_0x1a76c7)),_0x3a5044=_0x6a3649;}const _0x3de090={'iban':_0x1a76c7,'bankDetails':_0x3a5044,'transactionId':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x226)],'coinAddress':_0x2ef945['data'][_0x2213ea(0x203)],'qrCodeUrl':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x1c9)],'expiryTime':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x202)],'createdOn':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x216)],'confirmedOn':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x217)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x2213ea(0x225)](_0x2213ea(0x1d6),_0x2ef945['data'][_0x2213ea(0x21e)],'->',_0x64eb61),console[_0x2213ea(0x225)]('Amount:',_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x1f1)],_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x1e9)]),console['log'](_0x2213ea(0x1b8),_0x2ef945['data'][_0x2213ea(0x226)]),console[_0x2213ea(0x225)](_0x2213ea(0x1f7),_0x1a76c7||'not\x20found'),console['log']('Created\x20On:',_0x2ef945[_0x2213ea(0x1ee)]['CreatedOn']),console[_0x2213ea(0x225)](_0x2213ea(0x1b7),_0x2ef945['data'][_0x2213ea(0x217)]||'not\x20confirmed');if(_0x2ef945['data'][_0x2213ea(0x21e)]?.[_0x2213ea(0x227)]()===_0x2213ea(0x1ba))console[_0x2213ea(0x225)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2ef945[_0x2213ea(0x1ee)]['Status']?.['toLowerCase']()===_0x2213ea(0x1e3)&&console[_0x2213ea(0x225)](_0x2213ea(0x1b6));return{'status':_0x64eb61,'amount':parseFloat(_0x2ef945['data'][_0x2213ea(0x1f1)])||undefined,'currency':_0x2ef945[_0x2213ea(0x1ee)][_0x2213ea(0x1e9)]||'EUR','paymentDetails':_0x3de090};}catch(_0x53feed){console[_0x2213ea(0x1b9)](_0x2213ea(0x1b3),_0x53feed),loggerService_1[_0x2213ea(0x223)][_0x2213ea(0x21b)](_0x2213ea(0x1d5),_0x2213ea(0x1fb),_0x53feed);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x53feed instanceof Error?_0x53feed[_0x2213ea(0x1ce)]:'Unknown\x20error'));}}async[a46_0x656d1f(0x22a)](_0x273478){const _0x103ad8=a46_0x656d1f,_0x5e7e6d=await this[_0x103ad8(0x237)](_0x273478);return{'status':_0x5e7e6d[_0x103ad8(0x1c4)],'amount':_0x5e7e6d['amount'],'currency':_0x5e7e6d[_0x103ad8(0x1d1)]};}async['processWebhook'](_0x55e396){const _0x2b0d23=a46_0x656d1f;console['log'](_0x2b0d23(0x204),_0x55e396);let _0x23a5e5='PENDING';switch(_0x55e396['status']?.[_0x2b0d23(0x227)]()){case _0x2b0d23(0x1e3):_0x23a5e5=_0x2b0d23(0x1d0);break;case _0x2b0d23(0x1e1):case _0x2b0d23(0x207):case _0x2b0d23(0x1b9):_0x23a5e5=_0x2b0d23(0x1cc);break;case _0x2b0d23(0x1df):case _0x2b0d23(0x1f4):_0x23a5e5=_0x2b0d23(0x21f);break;case'pending':case _0x2b0d23(0x1c6):case'awaiting\x20fiat':case _0x2b0d23(0x1fe):default:_0x23a5e5=_0x2b0d23(0x1d4);break;}return{'paymentId':_0x55e396[_0x2b0d23(0x1de)]||_0x55e396['merchant_reference_id']||'','status':_0x23a5e5,'amount':_0x55e396[_0x2b0d23(0x1e5)],'currency':_0x55e396['currency']||_0x2b0d23(0x1e6)};}}exports[a46_0x656d1f(0x1f8)]=CoinToPayService;