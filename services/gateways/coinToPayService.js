'use strict';const a49_0xd0916=a49_0x1f66;function a49_0x1f66(_0x52f205,_0x2104ab){const _0x43d5b3=a49_0x43d5();return a49_0x1f66=function(_0x1f6655,_0x5843be){_0x1f6655=_0x1f6655-0x97;let _0x1afe9f=_0x43d5b3[_0x1f6655];return _0x1afe9f;},a49_0x1f66(_0x52f205,_0x2104ab);}(function(_0x5a552,_0x4413fb){const _0x39dda1=a49_0x1f66,_0x57823a=_0x5a552();while(!![]){try{const _0x4de74f=-parseInt(_0x39dda1(0xf0))/0x1+-parseInt(_0x39dda1(0x10d))/0x2*(parseInt(_0x39dda1(0xa5))/0x3)+parseInt(_0x39dda1(0xdd))/0x4*(parseInt(_0x39dda1(0xdf))/0x5)+-parseInt(_0x39dda1(0x9d))/0x6+-parseInt(_0x39dda1(0xd4))/0x7+-parseInt(_0x39dda1(0xe1))/0x8+parseInt(_0x39dda1(0x107))/0x9*(parseInt(_0x39dda1(0xd2))/0xa);if(_0x4de74f===_0x4413fb)break;else _0x57823a['push'](_0x57823a['shift']());}catch(_0x10e1f5){_0x57823a['push'](_0x57823a['shift']());}}}(a49_0x43d5,0x40aa9));Object[a49_0xd0916(0xc5)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a49_0xd0916(0xab));class CoinToPayService{constructor(){const _0x5b4bce=a49_0xd0916;this[_0x5b4bce(0xb3)]='https://tesoft.uk/gateway/cointopay/',this[_0x5b4bce(0x117)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x5b4bce(0xfe)](_0x5b4bce(0xe7)),console[_0x5b4bce(0xfe)](_0x5b4bce(0xfb),this[_0x5b4bce(0x117)]);}async[a49_0xd0916(0x112)](_0xc6fe61){const _0x271306=a49_0xd0916,{orderId:_0x2ee50b,amount:_0x34b4d9}=_0xc6fe61;console[_0x271306(0xfe)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x34b4d9+_0x271306(0xfa));const _0x44231f={'amount':_0x34b4d9},_0x1a96ef=Date[_0x271306(0x108)]();try{console['log'](_0x271306(0x114)),console[_0x271306(0xfe)](_0x271306(0xca),this['apiUrl']),console[_0x271306(0xfe)](_0x271306(0xcf),JSON[_0x271306(0xaf)](_0x44231f,null,0x2)),console[_0x271306(0xfe)](_0x271306(0xac),_0x34b4d9,_0x271306(0xa2)),loggerService_1['loggerService'][_0x271306(0xdc)](_0x271306(0xe4),'/create',_0x271306(0xc3),_0x44231f);const _0x13cd37=await fetch(this[_0x271306(0xb3)],{'method':_0x271306(0xc3),'headers':{'Content-Type':_0x271306(0xb4),'Accept':'application/json','User-Agent':_0x271306(0xea)},'body':JSON[_0x271306(0xaf)](_0x44231f)}),_0x3a8b3a=Date[_0x271306(0x108)]()-_0x1a96ef;console[_0x271306(0xfe)](_0x271306(0xf9)),console[_0x271306(0xfe)](_0x271306(0xd3),_0x13cd37['status']),console['log'](_0x271306(0xe8),_0x13cd37[_0x271306(0xce)]),console[_0x271306(0xfe)](_0x271306(0xcb),Object[_0x271306(0x110)](_0x13cd37['headers'][_0x271306(0xe0)]())),console[_0x271306(0xfe)]('Response\x20Time:',_0x3a8b3a+'ms');const _0x4fbb2e=await _0x13cd37[_0x271306(0xbe)]();console[_0x271306(0xfe)](_0x271306(0xcc),_0x4fbb2e);if(!_0x13cd37['ok']){console[_0x271306(0xc8)](_0x271306(0xd6)),console[_0x271306(0xc8)]('HTTP\x20Status:',_0x13cd37[_0x271306(0x9a)]),console['error'](_0x271306(0xd9),_0x4fbb2e),loggerService_1['loggerService'][_0x271306(0xa3)]('cointopay',_0x271306(0x119),_0x13cd37[_0x271306(0x9a)],_0x4fbb2e,_0x3a8b3a),loggerService_1[_0x271306(0xb1)][_0x271306(0x106)](_0x271306(0xe4),_0x271306(0x119),_0x271306(0xe6)+_0x13cd37[_0x271306(0x9a)]+':\x20'+_0x4fbb2e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x13cd37['status']+_0x271306(0xc7)+_0x4fbb2e);}let _0x460146;try{_0x460146=JSON['parse'](_0x4fbb2e);}catch(_0x1a693f){console[_0x271306(0xc8)](_0x271306(0xa4),_0x1a693f),loggerService_1['loggerService']['logWhiteDomainError'](_0x271306(0xe4),_0x271306(0x119),'JSON\x20Parse\x20Error:\x20'+_0x1a693f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x4fbb2e);}console[_0x271306(0xfe)](_0x271306(0xf7)),console[_0x271306(0xfe)]('Parsed\x20Result:',JSON[_0x271306(0xaf)](_0x460146,null,0x2)),loggerService_1[_0x271306(0xb1)][_0x271306(0xa3)]('cointopay',_0x271306(0x119),_0x13cd37[_0x271306(0x9a)],_0x460146,_0x3a8b3a);if(_0x460146[_0x271306(0xc8)]){const _0x4de80f=_0x460146['message']||_0x460146[_0x271306(0xc8)]||_0x271306(0x100);console['error'](_0x271306(0xbd)),console[_0x271306(0xc8)](_0x271306(0xa8),_0x4de80f),loggerService_1[_0x271306(0xb1)][_0x271306(0x106)](_0x271306(0xe4),_0x271306(0x119),_0x271306(0xec)+_0x4de80f);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4de80f);}if(!_0x460146[_0x271306(0xeb)]||!_0x460146[_0x271306(0xb0)]){console['error'](_0x271306(0xe5)),console[_0x271306(0xc8)](_0x271306(0xf5)),console['error'](_0x271306(0xef),_0x460146),loggerService_1[_0x271306(0xb1)][_0x271306(0x106)]('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x271306(0x111));}console[_0x271306(0xfe)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x271306(0xfe)]('Gateway\x20Payment\x20ID:',_0x460146[_0x271306(0xb0)]),console[_0x271306(0xfe)]('Payment\x20URL\x20(original):',_0x460146['payment_url']);const _0x54f536=_0x460146[_0x271306(0xeb)]+'&alternative=false';return console['log']('Payment\x20URL\x20(modified):',_0x54f536),console[_0x271306(0xfe)](_0x271306(0xac),_0x34b4d9,'EUR'),{'gateway_payment_id':_0x460146[_0x271306(0xb0)],'payment_url':_0x54f536};}catch(_0x58cb3a){console[_0x271306(0xc8)](_0x271306(0x10e)),console[_0x271306(0xc8)](_0x271306(0xfc),_0x58cb3a),loggerService_1[_0x271306(0xb1)][_0x271306(0x106)](_0x271306(0xe4),_0x271306(0x119),_0x58cb3a);if(_0x58cb3a instanceof Error){console['error'](_0x271306(0x97),_0x58cb3a[_0x271306(0xb7)]),console[_0x271306(0xc8)](_0x271306(0x105),_0x58cb3a[_0x271306(0xcd)]);throw new Error(_0x271306(0x11a)+_0x58cb3a[_0x271306(0xb7)]);}throw new Error(_0x271306(0xff));}}async['checkPaymentStatus'](_0x3f231f){const _0x1efa03=a49_0xd0916,_0x1c7ac9=Date[_0x1efa03(0x108)]();try{console[_0x1efa03(0xfe)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x3f231f);const _0x55f501={'gatewayPaymentId':_0x3f231f};loggerService_1[_0x1efa03(0xb1)][_0x1efa03(0xdc)]('cointopay',_0x1efa03(0xbb),'POST',_0x55f501);const _0xdec958=await fetch(this[_0x1efa03(0x117)],{'method':_0x1efa03(0xc3),'headers':{'Content-Type':_0x1efa03(0xb4),'Accept':_0x1efa03(0xb4),'User-Agent':_0x1efa03(0xea)},'body':JSON[_0x1efa03(0xaf)](_0x55f501)}),_0xe2223f=Date[_0x1efa03(0x108)]()-_0x1c7ac9;console['log'](_0x1efa03(0xd0)),console[_0x1efa03(0xfe)](_0x1efa03(0xd3),_0xdec958[_0x1efa03(0x9a)]),console[_0x1efa03(0xfe)]('Response\x20Time:',_0xe2223f+'ms');if(!_0xdec958['ok']){const _0x45eaf8=await _0xdec958[_0x1efa03(0xbe)]();console[_0x1efa03(0xc8)](_0x1efa03(0xd7),_0xdec958[_0x1efa03(0x9a)]),console[_0x1efa03(0xc8)](_0x1efa03(0xd9),_0x45eaf8),loggerService_1[_0x1efa03(0xb1)]['logWhiteDomainResponse'](_0x1efa03(0xe4),'/status',_0xdec958['status'],_0x45eaf8,_0xe2223f),loggerService_1['loggerService']['logWhiteDomainError'](_0x1efa03(0xe4),_0x1efa03(0xbb),_0x1efa03(0xe6)+_0xdec958['status']+':\x20'+_0x45eaf8);throw new Error('HTTP\x20error!\x20status:\x20'+_0xdec958[_0x1efa03(0x9a)]);}const _0xd55cff=await _0xdec958[_0x1efa03(0xbe)]();console[_0x1efa03(0xfe)]('Raw\x20Response\x20Body:',_0xd55cff);let _0x410371;try{_0x410371=JSON[_0x1efa03(0xae)](_0xd55cff);}catch(_0xac17bc){console[_0x1efa03(0xc8)](_0x1efa03(0xa4),_0xac17bc),loggerService_1[_0x1efa03(0xb1)]['logWhiteDomainError'](_0x1efa03(0xe4),_0x1efa03(0xbb),_0x1efa03(0xee)+_0xac17bc);throw new Error(_0x1efa03(0xa7)+_0xd55cff);}loggerService_1[_0x1efa03(0xb1)][_0x1efa03(0xa3)]('cointopay','/status',_0xdec958[_0x1efa03(0x9a)],_0x410371,_0xe2223f),console[_0x1efa03(0xfe)](_0x1efa03(0xde)),console['log'](_0x1efa03(0x102),_0x410371[_0x1efa03(0x103)]),console[_0x1efa03(0xfe)]('Status\x20Code:',_0x410371[_0x1efa03(0xc2)]),console[_0x1efa03(0xfe)](_0x1efa03(0xbc),_0x410371[_0x1efa03(0x118)]?.[_0x1efa03(0xad)]),console['log'](_0x1efa03(0xac),_0x410371[_0x1efa03(0x118)]?.[_0x1efa03(0xa0)]),console[_0x1efa03(0xfe)](_0x1efa03(0xd5),_0x410371['data']?.['inputCurrency']);if(_0x410371[_0x1efa03(0x103)]!==_0x1efa03(0xc9)||_0x410371[_0x1efa03(0xc2)]!==0xc8){const _0x49ac06=_0x410371['message']||_0x1efa03(0xc1);console['error'](_0x1efa03(0xc4)),console['error'](_0x1efa03(0xa8),_0x49ac06),loggerService_1['loggerService'][_0x1efa03(0x106)]('cointopay',_0x1efa03(0xbb),_0x1efa03(0xd8)+_0x49ac06);throw new Error(_0x1efa03(0xc0)+_0x49ac06);}if(!_0x410371[_0x1efa03(0x118)]){console[_0x1efa03(0xc8)](_0x1efa03(0xd1)),console[_0x1efa03(0xc8)](_0x1efa03(0xf6)),loggerService_1[_0x1efa03(0xb1)][_0x1efa03(0x106)](_0x1efa03(0xe4),_0x1efa03(0xbb),_0x1efa03(0xb2));throw new Error(_0x1efa03(0xfd));}let _0x35dbc8=_0x1efa03(0x9b);switch(_0x410371[_0x1efa03(0x118)][_0x1efa03(0xad)]?.[_0x1efa03(0xa6)]()){case _0x1efa03(0xda):_0x35dbc8=_0x1efa03(0x116);break;case _0x1efa03(0x9f):case _0x1efa03(0x10b):case _0x1efa03(0xc8):_0x35dbc8=_0x1efa03(0xaa);break;case _0x1efa03(0x98):case _0x1efa03(0xe3):_0x35dbc8=_0x1efa03(0xe9);break;case _0x1efa03(0xb9):case _0x1efa03(0xb5):case'pending':case _0x1efa03(0x115):default:_0x35dbc8=_0x1efa03(0x9b);break;}let _0x107d1b,_0x3aa94d;if(_0x410371[_0x1efa03(0x118)][_0x1efa03(0xa9)]){const _0x5d784e=_0x410371[_0x1efa03(0x118)]['PaymentDetail'];console['log'](_0x1efa03(0xf4),_0x5d784e);const _0x18f245=_0x5d784e['match'](/IBAN\s+([A-Z0-9]+)/i);_0x18f245&&(_0x107d1b=_0x18f245[0x1],console[_0x1efa03(0xfe)](_0x1efa03(0x10f),_0x107d1b)),_0x3aa94d=_0x5d784e;}const _0x4ff901={'iban':_0x107d1b,'bankDetails':_0x3aa94d,'transactionId':_0x410371[_0x1efa03(0x118)][_0x1efa03(0x104)],'coinAddress':_0x410371[_0x1efa03(0x118)]['coinAddress'],'qrCodeUrl':_0x410371[_0x1efa03(0x118)][_0x1efa03(0x10c)],'expiryTime':_0x410371[_0x1efa03(0x118)]['ExpiryTime'],'createdOn':_0x410371['data']['CreatedOn'],'confirmedOn':_0x410371[_0x1efa03(0x118)][_0x1efa03(0xf1)]};console[_0x1efa03(0xfe)](_0x1efa03(0x99)),console['log']('Status:',_0x410371[_0x1efa03(0x118)]['Status'],'->',_0x35dbc8),console[_0x1efa03(0xfe)](_0x1efa03(0xac),_0x410371[_0x1efa03(0x118)][_0x1efa03(0xa0)],_0x410371[_0x1efa03(0x118)]['inputCurrency']),console[_0x1efa03(0xfe)]('Transaction\x20ID:',_0x410371['data'][_0x1efa03(0x104)]),console[_0x1efa03(0xfe)]('IBAN:',_0x107d1b||'not\x20found'),console[_0x1efa03(0xfe)]('Created\x20On:',_0x410371[_0x1efa03(0x118)][_0x1efa03(0xf3)]),console[_0x1efa03(0xfe)]('Confirmed\x20On:',_0x410371[_0x1efa03(0x118)][_0x1efa03(0xf1)]||_0x1efa03(0xed));if(_0x410371['data'][_0x1efa03(0xad)]?.[_0x1efa03(0xa6)]()===_0x1efa03(0xb5))console[_0x1efa03(0xfe)](_0x1efa03(0x101));else _0x410371[_0x1efa03(0x118)][_0x1efa03(0xad)]?.['toLowerCase']()===_0x1efa03(0xda)&&console[_0x1efa03(0xfe)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x35dbc8,'amount':parseFloat(_0x410371['data'][_0x1efa03(0xa0)])||undefined,'currency':_0x410371[_0x1efa03(0x118)][_0x1efa03(0x10a)]||_0x1efa03(0x9e),'paymentDetails':_0x4ff901};}catch(_0xadba5e){console[_0x1efa03(0xc8)](_0x1efa03(0x109),_0xadba5e),loggerService_1['loggerService']['logWhiteDomainError'](_0x1efa03(0xe4),_0x1efa03(0xbb),_0xadba5e);throw new Error(_0x1efa03(0xa1)+(_0xadba5e instanceof Error?_0xadba5e[_0x1efa03(0xb7)]:_0x1efa03(0xf8)));}}async[a49_0xd0916(0xbf)](_0x3b72ca){const _0x1b7c64=a49_0xd0916,_0x63e04a=await this[_0x1b7c64(0x9c)](_0x3b72ca);return{'status':_0x63e04a[_0x1b7c64(0x9a)],'amount':_0x63e04a['amount'],'currency':_0x63e04a[_0x1b7c64(0xe2)]};}async[a49_0xd0916(0xc6)](_0x58e8bf){const _0x171464=a49_0xd0916;console['log'](_0x171464(0xb6),_0x58e8bf);let _0x3c2479=_0x171464(0x9b);switch(_0x58e8bf[_0x171464(0x9a)]?.['toLowerCase']()){case _0x171464(0xda):_0x3c2479=_0x171464(0x116);break;case _0x171464(0x9f):case _0x171464(0x10b):case _0x171464(0xc8):_0x3c2479=_0x171464(0xaa);break;case _0x171464(0x98):case _0x171464(0xe3):_0x3c2479=_0x171464(0xe9);break;case _0x171464(0xb8):case _0x171464(0xb9):case _0x171464(0xb5):case _0x171464(0x115):default:_0x3c2479=_0x171464(0x9b);break;}return{'paymentId':_0x58e8bf[_0x171464(0xba)]||_0x58e8bf[_0x171464(0xf2)]||'','status':_0x3c2479,'amount':_0x58e8bf[_0x171464(0x113)],'currency':_0x58e8bf[_0x171464(0xe2)]||'EUR'};}}function a49_0x43d5(){const _0x2d1b84=['/status','Payment\x20Status:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','text','verifyPayment','CoinToPay\x20status\x20API\x20error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','status_code','POST','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','defineProperty','processWebhook',',\x20body:\x20','error','success','URL:','Headers:','Raw\x20Response\x20Body:','stack','statusText','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1059610heDJNW','Status:','2443679fghGLi','Currency:','===\x20COINTOPAY\x20API\x20ERROR\x20===','HTTP\x20Status:','Status\x20API\x20Error:\x20','Response\x20Body:','paid','CoinToPayService','logWhiteDomainRequest','145064vPNQTv','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','5Mkkkst','entries','3184352OsZgYq','currency','timeout','cointopay','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Status\x20Text:','EXPIRED','Payment\x20System/1.0','payment_url','Business\x20Error:\x20','not\x20confirmed','JSON\x20Parse\x20Error:\x20','Response\x20data:','177287UtHwrI','TransactionConfirmedOn','merchant_reference_id','CreatedOn','🏦\x20Payment\x20Detail:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Missing\x20data\x20in\x20response','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Unknown\x20error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','\x20EUR','📊\x20Status\x20check\x20URL:','Error\x20details:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','log','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Unknown\x20error\x20from\x20CoinToPay\x20API','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Result:','result','TransactionID','Error\x20stack:','logWhiteDomainError','135NHJFMO','now','CoinToPay\x20payment\x20status\x20check\x20error:','inputCurrency','failed','QRCodeURL','2pFXaXl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','🏦\x20Extracted\x20IBAN:','fromEntries','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','createPaymentLink','amount','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','created','PAID','statusUrl','data','/create','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20message:','expired','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','status','PENDING','checkPaymentStatus','2082054AXMcZe','EUR','cancelled','Amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','logWhiteDomainResponse','Failed\x20to\x20parse\x20JSON\x20response:','268113SEEiTa','toLowerCase','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Error\x20Message:','PaymentDetail','FAILED','../loggerService','Amount:','Status','parse','stringify','gateway_payment_id','loggerService','Incomplete\x20response:\x20missing\x20data','apiUrl','application/json','awaiting\x20fiat','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','message','pending','waiting','order_id'];a49_0x43d5=function(){return _0x2d1b84;};return a49_0x43d5();}exports[a49_0xd0916(0xdb)]=CoinToPayService;