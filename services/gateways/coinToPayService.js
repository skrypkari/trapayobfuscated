'use strict';function a44_0x5ebe(_0x4833a2,_0x42ea82){const _0x2a8afa=a44_0x2a8a();return a44_0x5ebe=function(_0x5ebe66,_0x2100e3){_0x5ebe66=_0x5ebe66-0xcf;let _0x3ff2f5=_0x2a8afa[_0x5ebe66];return _0x3ff2f5;},a44_0x5ebe(_0x4833a2,_0x42ea82);}const a44_0x1a7c3b=a44_0x5ebe;function a44_0x2a8a(){const _0x5a122e=['===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','fromEntries','2528950MrTCuf','logWhiteDomainResponse','1864yYhOzU','3224190mhNaqM','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Confirmed\x20On:','üè¶\x20Extracted\x20IBAN:','success','currency','cancelled','failed','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','amount','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','PENDING','CoinToPayService','not\x20confirmed','/status','logWhiteDomainError','status_code','HTTP\x20','verifyPayment','Gateway\x20Payment\x20ID:','message','Failed\x20to\x20parse\x20JSON\x20response:','error','toLowerCase','===\x20COINTOPAY\x20API\x20ERROR\x20===','statusText','EXPIRED','timeout','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','4191ExdNpy','loggerService','FAILED','Amount:','EUR','URL:','TransactionConfirmedOn','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id',',\x20body:\x20','cointopay','Missing\x20data\x20in\x20response','Status\x20API\x20Error:\x20','Payment\x20Status:','headers','/create','pending','log','5376168LisCqR','Error\x20message:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','status','Error\x20Message:','result','Parsed\x20Result:','HTTP\x20Status:','waiting','Amount','awaiting\x20fiat','paid','../loggerService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Currency:','statusUrl','Business\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','üìä\x20Status\x20check\x20URL:','gateway_payment_id','entries','Raw\x20Response\x20Body:','Unknown\x20error','Response\x20Body:','logWhiteDomainRequest','stringify','Headers:','created','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20details:','JSON\x20Parse\x20Error:\x20','IBAN:','Error\x20stack:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Status:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','\x20EUR','Result:','Status\x20Code:','text','defineProperty','2hTflxQ','match','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','307513lMKfqC','now','coinAddress','merchant_reference_id','payment_url','ExpiryTime','Status','CreatedOn','3768Txrflb','parse','Incomplete\x20response:\x20missing\x20data','createPaymentLink','CoinToPay\x20status\x20API\x20error:\x20','POST','TesSoft\x20Payment\x20System/1.0','checkPaymentStatus','Response\x20data:','https://tesoft.uk/gateway/cointopay/','inputCurrency','Request\x20Body:','1267SfDctl','Response\x20Time:','apiUrl','data','1677224MgpeaA','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','PaymentDetail','PAID','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','TransactionID','application/json'];a44_0x2a8a=function(){return _0x5a122e;};return a44_0x2a8a();}(function(_0xb3fce6,_0x29bd28){const _0x4dae12=a44_0x5ebe,_0x243f9b=_0xb3fce6();while(!![]){try{const _0x383edf=-parseInt(_0x4dae12(0xd6))/0x1*(-parseInt(_0x4dae12(0xd3))/0x2)+parseInt(_0x4dae12(0x11b))/0x3*(parseInt(_0x4dae12(0xfa))/0x4)+-parseInt(_0x4dae12(0xfb))/0x5+-parseInt(_0x4dae12(0xde))/0x6*(parseInt(_0x4dae12(0xea))/0x7)+-parseInt(_0x4dae12(0xee))/0x8+parseInt(_0x4dae12(0x12c))/0x9+-parseInt(_0x4dae12(0xf8))/0xa;if(_0x383edf===_0x29bd28)break;else _0x243f9b['push'](_0x243f9b['shift']());}catch(_0x1e76af){_0x243f9b['push'](_0x243f9b['shift']());}}}(a44_0x2a8a,0x51bdd));Object[a44_0x1a7c3b(0xd2)](exports,'__esModule',{'value':!![]}),exports[a44_0x1a7c3b(0x109)]=void 0x0;const loggerService_1=require(a44_0x1a7c3b(0x139));class CoinToPayService{constructor(){const _0x789678=a44_0x1a7c3b;this[_0x789678(0xec)]=_0x789678(0xe7),this['statusUrl']=_0x789678(0x106),console['log'](_0x789678(0x12e)),console[_0x789678(0x12b)](_0x789678(0x140),this[_0x789678(0x13d)]);}async[a44_0x1a7c3b(0xe1)](_0x4b45bd){const _0x33c432=a44_0x1a7c3b,{orderId:_0x19ce8a,amount:_0x130cfd}=_0x4b45bd;console[_0x33c432(0x12b)](_0x33c432(0x13b)+_0x130cfd+_0x33c432(0x154));const _0x3ec006={'amount':_0x130cfd},_0x49f821=Date[_0x33c432(0xd7)]();try{console[_0x33c432(0x12b)](_0x33c432(0xef)),console[_0x33c432(0x12b)](_0x33c432(0x120),this['apiUrl']),console[_0x33c432(0x12b)](_0x33c432(0xe9),JSON[_0x33c432(0x147)](_0x3ec006,null,0x2)),console[_0x33c432(0x12b)](_0x33c432(0x11e),_0x130cfd,_0x33c432(0xf2)),loggerService_1[_0x33c432(0x11c)]['logWhiteDomainRequest'](_0x33c432(0x124),_0x33c432(0x129),_0x33c432(0xe3),_0x3ec006);const _0x168368=await fetch(this[_0x33c432(0xec)],{'method':'POST','headers':{'Content-Type':_0x33c432(0xf4),'Accept':_0x33c432(0xf4),'User-Agent':_0x33c432(0xe4)},'body':JSON['stringify'](_0x3ec006)}),_0x3672f1=Date[_0x33c432(0xd7)]()-_0x49f821;console[_0x33c432(0x12b)](_0x33c432(0x14a)),console[_0x33c432(0x12b)](_0x33c432(0x151),_0x168368['status']),console[_0x33c432(0x12b)]('Status\x20Text:',_0x168368[_0x33c432(0x116)]),console[_0x33c432(0x12b)](_0x33c432(0x148),Object[_0x33c432(0xf7)](_0x168368[_0x33c432(0x128)][_0x33c432(0x142)]())),console[_0x33c432(0x12b)](_0x33c432(0xeb),_0x3672f1+'ms');const _0x3746a2=await _0x168368['text']();console[_0x33c432(0x12b)]('Raw\x20Response\x20Body:',_0x3746a2);if(!_0x168368['ok']){console['error'](_0x33c432(0x115)),console[_0x33c432(0x113)](_0x33c432(0x134),_0x168368['status']),console[_0x33c432(0x113)](_0x33c432(0x145),_0x3746a2),loggerService_1[_0x33c432(0x11c)][_0x33c432(0xf9)]('cointopay',_0x33c432(0x129),_0x168368[_0x33c432(0x130)],_0x3746a2,_0x3672f1),loggerService_1['loggerService'][_0x33c432(0x10c)](_0x33c432(0x124),_0x33c432(0x129),'HTTP\x20'+_0x168368[_0x33c432(0x130)]+':\x20'+_0x3746a2);throw new Error(_0x33c432(0x103)+_0x168368[_0x33c432(0x130)]+_0x33c432(0x123)+_0x3746a2);}let _0x109001;try{_0x109001=JSON[_0x33c432(0xdf)](_0x3746a2);}catch(_0x3167b2){console[_0x33c432(0x113)](_0x33c432(0x112),_0x3167b2),loggerService_1['loggerService'][_0x33c432(0x10c)]('cointopay',_0x33c432(0x129),'JSON\x20Parse\x20Error:\x20'+_0x3167b2);throw new Error(_0x33c432(0x13f)+_0x3746a2);}console[_0x33c432(0x12b)](_0x33c432(0xf5)),console['log'](_0x33c432(0x133),JSON['stringify'](_0x109001,null,0x2)),loggerService_1[_0x33c432(0x11c)]['logWhiteDomainResponse'](_0x33c432(0x124),'/create',_0x168368[_0x33c432(0x130)],_0x109001,_0x3672f1);if(_0x109001[_0x33c432(0x113)]){const _0x5a1970=_0x109001['message']||_0x109001['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x33c432(0xf6)),console[_0x33c432(0x113)](_0x33c432(0x131),_0x5a1970),loggerService_1[_0x33c432(0x11c)]['logWhiteDomainError'](_0x33c432(0x124),_0x33c432(0x129),_0x33c432(0x13e)+_0x5a1970);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5a1970);}if(!_0x109001['payment_url']||!_0x109001[_0x33c432(0x141)]){console[_0x33c432(0x113)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x33c432(0x152)),console[_0x33c432(0x113)](_0x33c432(0xe6),_0x109001),loggerService_1[_0x33c432(0x11c)]['logWhiteDomainError'](_0x33c432(0x124),'/create',_0x33c432(0x14f));throw new Error(_0x33c432(0x122));}return console[_0x33c432(0x12b)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x33c432(0x12b)](_0x33c432(0x110),_0x109001['gateway_payment_id']),console['log']('Payment\x20URL:',_0x109001[_0x33c432(0xda)]),console[_0x33c432(0x12b)]('Amount:',_0x130cfd,_0x33c432(0x11f)),{'gateway_payment_id':_0x109001[_0x33c432(0x141)],'payment_url':_0x109001[_0x33c432(0xda)]};}catch(_0x5df6c4){console[_0x33c432(0x113)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x33c432(0x113)](_0x33c432(0x14b),_0x5df6c4),loggerService_1[_0x33c432(0x11c)]['logWhiteDomainError'](_0x33c432(0x124),_0x33c432(0x129),_0x5df6c4);if(_0x5df6c4 instanceof Error){console[_0x33c432(0x113)](_0x33c432(0x12d),_0x5df6c4['message']),console[_0x33c432(0x113)](_0x33c432(0x14e),_0x5df6c4['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x5df6c4[_0x33c432(0x111)]);}throw new Error(_0x33c432(0x11a));}}async[a44_0x1a7c3b(0xe5)](_0xdb296a){const _0x544fbc=a44_0x1a7c3b,_0x39d5a2=Date[_0x544fbc(0xd7)]();try{console[_0x544fbc(0x12b)](_0x544fbc(0x12f)+_0xdb296a);const _0x26ae96={'gatewayPaymentId':_0xdb296a};loggerService_1[_0x544fbc(0x11c)][_0x544fbc(0x146)](_0x544fbc(0x124),_0x544fbc(0x10b),_0x544fbc(0xe3),_0x26ae96);const _0x4d0eea=await fetch(this[_0x544fbc(0x13d)],{'method':_0x544fbc(0xe3),'headers':{'Content-Type':_0x544fbc(0xf4),'Accept':_0x544fbc(0xf4),'User-Agent':_0x544fbc(0xe4)},'body':JSON['stringify'](_0x26ae96)}),_0x5e3d85=Date[_0x544fbc(0xd7)]()-_0x39d5a2;console[_0x544fbc(0x12b)](_0x544fbc(0x104)),console[_0x544fbc(0x12b)](_0x544fbc(0x151),_0x4d0eea[_0x544fbc(0x130)]),console[_0x544fbc(0x12b)](_0x544fbc(0xeb),_0x5e3d85+'ms');if(!_0x4d0eea['ok']){const _0xcbf858=await _0x4d0eea['text']();console[_0x544fbc(0x113)]('HTTP\x20Status:',_0x4d0eea['status']),console[_0x544fbc(0x113)]('Response\x20Body:',_0xcbf858),loggerService_1[_0x544fbc(0x11c)]['logWhiteDomainResponse']('cointopay','/status',_0x4d0eea[_0x544fbc(0x130)],_0xcbf858,_0x5e3d85),loggerService_1['loggerService'][_0x544fbc(0x10c)](_0x544fbc(0x124),'/status',_0x544fbc(0x10e)+_0x4d0eea[_0x544fbc(0x130)]+':\x20'+_0xcbf858);throw new Error(_0x544fbc(0x103)+_0x4d0eea[_0x544fbc(0x130)]);}const _0x5821ab=await _0x4d0eea[_0x544fbc(0xd1)]();console['log'](_0x544fbc(0x143),_0x5821ab);let _0x4fee39;try{_0x4fee39=JSON[_0x544fbc(0xdf)](_0x5821ab);}catch(_0x636b2f){console[_0x544fbc(0x113)](_0x544fbc(0x112),_0x636b2f),loggerService_1['loggerService'][_0x544fbc(0x10c)](_0x544fbc(0x124),_0x544fbc(0x10b),_0x544fbc(0x14c)+_0x636b2f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x5821ab);}loggerService_1[_0x544fbc(0x11c)][_0x544fbc(0xf9)](_0x544fbc(0x124),_0x544fbc(0x10b),_0x4d0eea[_0x544fbc(0x130)],_0x4fee39,_0x5e3d85),console[_0x544fbc(0x12b)](_0x544fbc(0xfc)),console[_0x544fbc(0x12b)](_0x544fbc(0xcf),_0x4fee39[_0x544fbc(0x132)]),console[_0x544fbc(0x12b)](_0x544fbc(0xd0),_0x4fee39[_0x544fbc(0x10d)]),console[_0x544fbc(0x12b)](_0x544fbc(0x127),_0x4fee39['data']?.[_0x544fbc(0xdc)]),console['log']('Amount:',_0x4fee39[_0x544fbc(0xed)]?.['Amount']),console[_0x544fbc(0x12b)](_0x544fbc(0x13c),_0x4fee39[_0x544fbc(0xed)]?.[_0x544fbc(0xe8)]);if(_0x4fee39['result']!==_0x544fbc(0xff)||_0x4fee39[_0x544fbc(0x10d)]!==0xc8){const _0x3e5348=_0x4fee39[_0x544fbc(0x111)]||_0x544fbc(0x13a);console[_0x544fbc(0x113)](_0x544fbc(0x150)),console[_0x544fbc(0x113)](_0x544fbc(0x131),_0x3e5348),loggerService_1[_0x544fbc(0x11c)][_0x544fbc(0x10c)](_0x544fbc(0x124),_0x544fbc(0x10b),_0x544fbc(0x126)+_0x3e5348);throw new Error(_0x544fbc(0xe2)+_0x3e5348);}if(!_0x4fee39[_0x544fbc(0xed)]){console[_0x544fbc(0x113)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x544fbc(0x113)](_0x544fbc(0x125)),loggerService_1[_0x544fbc(0x11c)]['logWhiteDomainError'](_0x544fbc(0x124),_0x544fbc(0x10b),_0x544fbc(0xe0));throw new Error(_0x544fbc(0xd5));}let _0x469a18=_0x544fbc(0x108);switch(_0x4fee39[_0x544fbc(0xed)]['Status']?.[_0x544fbc(0x114)]()){case _0x544fbc(0x138):_0x469a18=_0x544fbc(0xf1);break;case _0x544fbc(0x101):case _0x544fbc(0x102):case _0x544fbc(0x113):_0x469a18=_0x544fbc(0x11d);break;case'expired':case _0x544fbc(0x118):_0x469a18=_0x544fbc(0x117);break;case _0x544fbc(0x135):case _0x544fbc(0x137):case _0x544fbc(0x12a):case _0x544fbc(0x149):default:_0x469a18=_0x544fbc(0x108);break;}let _0x4bf68b,_0x2dd217;if(_0x4fee39['data'][_0x544fbc(0xf0)]){const _0x3365fc=_0x4fee39['data'][_0x544fbc(0xf0)];console['log']('üè¶\x20Payment\x20Detail:',_0x3365fc);const _0x103dd6=_0x3365fc[_0x544fbc(0xd4)](/IBAN\s+([A-Z0-9]+)/i);_0x103dd6&&(_0x4bf68b=_0x103dd6[0x1],console['log'](_0x544fbc(0xfe),_0x4bf68b)),_0x2dd217=_0x3365fc;}const _0x3f3a6={'iban':_0x4bf68b,'bankDetails':_0x2dd217,'transactionId':_0x4fee39[_0x544fbc(0xed)]['TransactionID'],'coinAddress':_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xd8)],'qrCodeUrl':_0x4fee39['data']['QRCodeURL'],'expiryTime':_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xdb)],'createdOn':_0x4fee39['data'][_0x544fbc(0xdd)],'confirmedOn':_0x4fee39[_0x544fbc(0xed)]['TransactionConfirmedOn']};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x544fbc(0x12b)](_0x544fbc(0x151),_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xdc)],'->',_0x469a18),console['log'](_0x544fbc(0x11e),_0x4fee39['data']['Amount'],_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xe8)]),console['log'](_0x544fbc(0x119),_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xf3)]),console['log'](_0x544fbc(0x14d),_0x4bf68b||'not\x20found'),console[_0x544fbc(0x12b)]('Created\x20On:',_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xdd)]),console['log'](_0x544fbc(0xfd),_0x4fee39['data'][_0x544fbc(0x121)]||_0x544fbc(0x10a));if(_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0xdc)]?.[_0x544fbc(0x114)]()===_0x544fbc(0x137))console[_0x544fbc(0x12b)](_0x544fbc(0x153));else _0x4fee39['data'][_0x544fbc(0xdc)]?.[_0x544fbc(0x114)]()===_0x544fbc(0x138)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x469a18,'amount':parseFloat(_0x4fee39[_0x544fbc(0xed)][_0x544fbc(0x136)])||undefined,'currency':_0x4fee39['data'][_0x544fbc(0xe8)]||_0x544fbc(0x11f),'paymentDetails':_0x3f3a6};}catch(_0x32dcda){console[_0x544fbc(0x113)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x32dcda),loggerService_1['loggerService'][_0x544fbc(0x10c)](_0x544fbc(0x124),_0x544fbc(0x10b),_0x32dcda);throw new Error(_0x544fbc(0x107)+(_0x32dcda instanceof Error?_0x32dcda[_0x544fbc(0x111)]:_0x544fbc(0x144)));}}async[a44_0x1a7c3b(0x10f)](_0x2e61a0){const _0x1c24a4=a44_0x1a7c3b,_0x26c4d1=await this[_0x1c24a4(0xe5)](_0x2e61a0);return{'status':_0x26c4d1[_0x1c24a4(0x130)],'amount':_0x26c4d1[_0x1c24a4(0x105)],'currency':_0x26c4d1[_0x1c24a4(0x100)]};}async['processWebhook'](_0x3fe9e1){const _0xc7cb38=a44_0x1a7c3b;console[_0xc7cb38(0x12b)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3fe9e1);let _0x9274c4=_0xc7cb38(0x108);switch(_0x3fe9e1['status']?.[_0xc7cb38(0x114)]()){case _0xc7cb38(0x138):_0x9274c4=_0xc7cb38(0xf1);break;case _0xc7cb38(0x101):case _0xc7cb38(0x102):case _0xc7cb38(0x113):_0x9274c4='FAILED';break;case'expired':case _0xc7cb38(0x118):_0x9274c4=_0xc7cb38(0x117);break;case'pending':case _0xc7cb38(0x135):case'awaiting\x20fiat':case'created':default:_0x9274c4=_0xc7cb38(0x108);break;}return{'paymentId':_0x3fe9e1['order_id']||_0x3fe9e1[_0xc7cb38(0xd9)]||'','status':_0x9274c4,'amount':_0x3fe9e1['amount'],'currency':_0x3fe9e1[_0xc7cb38(0x100)]||_0xc7cb38(0x11f)};}}exports[a44_0x1a7c3b(0x109)]=CoinToPayService;