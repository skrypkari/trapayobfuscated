'use strict';const a37_0x584867=a37_0x1f77;(function(_0x1089ad,_0x91f3c7){const _0xd324b9=a37_0x1f77,_0xdfbc77=_0x1089ad();while(!![]){try{const _0x1da70f=parseInt(_0xd324b9(0x1f5))/0x1+-parseInt(_0xd324b9(0x1d0))/0x2*(-parseInt(_0xd324b9(0x19d))/0x3)+parseInt(_0xd324b9(0x200))/0x4*(-parseInt(_0xd324b9(0x1e1))/0x5)+-parseInt(_0xd324b9(0x195))/0x6*(-parseInt(_0xd324b9(0x19a))/0x7)+parseInt(_0xd324b9(0x1b1))/0x8*(parseInt(_0xd324b9(0x1ef))/0x9)+-parseInt(_0xd324b9(0x1a4))/0xa*(parseInt(_0xd324b9(0x1d6))/0xb)+-parseInt(_0xd324b9(0x1c4))/0xc*(-parseInt(_0xd324b9(0x18f))/0xd);if(_0x1da70f===_0x91f3c7)break;else _0xdfbc77['push'](_0xdfbc77['shift']());}catch(_0x3766d5){_0xdfbc77['push'](_0xdfbc77['shift']());}}}(a37_0x58e0,0x7d79a));function a37_0x58e0(){const _0x199770=['Status','defineProperty','cancelled','log','EXPIRED','cointopay','16732kuPmLT','TransactionID','apiUrl','CoinToPayService','Business\x20Error:\x20','\x20EUR','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','pending','CoinToPay\x20API\x20error:\x20','result','merchant_reference_id','TesSoft\x20Payment\x20System/1.0','Currency:','Amount:','stack','Failed\x20to\x20parse\x20JSON\x20response:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','paid','Error\x20message:','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','__esModule','Transaction\x20ID:','failed','statusUrl','../loggerService','waiting','Incomplete\x20response:\x20missing\x20data','expired','527371DSOTEm','HTTP\x20error!\x20status:\x20','EUR','not\x20found','payment_url','logWhiteDomainRequest','172812QPwoaI','URL:','TransactionConfirmedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','ExpiryTime','7pdCfZt','Created\x20On:','HTTP\x20','3123tYewin','status_code','headers','createPaymentLink','Status\x20API\x20Error:\x20','awaiting\x20fiat','Request\x20Body:','1690KvuZsi','CoinToPay\x20payment\x20status\x20check\x20error:','text','PaymentDetail','===\x20COINTOPAY\x20API\x20ERROR\x20===','Parsed\x20Result:','match','Error\x20details:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','logWhiteDomainError','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Confirmed\x20On:','Response\x20Body:','2666264rKfBaQ','üìä\x20Status\x20check\x20URL:','now','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','processWebhook','timeout','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','HTTP\x20Status:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','üè¶\x20Extracted\x20IBAN:','üè¶\x20Payment\x20Detail:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','not\x20confirmed','message','POST','order_id','Response\x20Time:','264yTDgph','Missing\x20data\x20in\x20response','application/json','Response\x20data:','Gateway\x20Payment\x20ID:','PENDING','loggerService','amount',',\x20body:\x20','Status:','IBAN:','checkPaymentStatus','262xBOxLb','Error\x20Message:','Status\x20Code:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','/status','statusText','30635AEMfhJ','CreatedOn','Payment\x20URL:','/create','Result:','Amount','CoinToPay\x20status\x20API\x20error:\x20','verifyPayment','toLowerCase','data','error','795zUfivh','logWhiteDomainResponse','Unknown\x20error','FAILED','parse','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status','gateway_payment_id','currency','success','inputCurrency','coinAddress','9baHslW','created','PAID','Headers:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','258778bYAtAI','===\x20COINTOPAY\x20SUCCESS\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'];a37_0x58e0=function(){return _0x199770;};return a37_0x58e0();}Object[a37_0x584867(0x1fb)](exports,a37_0x584867(0x187),{'value':!![]}),exports[a37_0x584867(0x203)]=void 0x0;const loggerService_1=require(a37_0x584867(0x18b));class CoinToPayService{constructor(){const _0x1e17c7=a37_0x584867;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x1e17c7(0x1fd)](_0x1e17c7(0x210)),console['log'](_0x1e17c7(0x1b2),this[_0x1e17c7(0x18a)]);}async[a37_0x584867(0x1a0)](_0xce96de){const _0x5aed65=a37_0x584867,{orderId:_0x4b603f,amount:_0x303a89}=_0xce96de;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x303a89+_0x5aed65(0x205));const _0x5f1996={'amount':_0x303a89},_0x428ede=Date[_0x5aed65(0x1b3)]();try{console[_0x5aed65(0x1fd)](_0x5aed65(0x1e6)),console[_0x5aed65(0x1fd)](_0x5aed65(0x196),this['apiUrl']),console['log'](_0x5aed65(0x1a3),JSON[_0x5aed65(0x211)](_0x5f1996,null,0x2)),console[_0x5aed65(0x1fd)]('Amount:',_0x303a89,_0x5aed65(0x1f7)),loggerService_1['loggerService'][_0x5aed65(0x194)](_0x5aed65(0x1ff),_0x5aed65(0x1d9),_0x5aed65(0x1c1),_0x5f1996);const _0x108ba8=await fetch(this[_0x5aed65(0x202)],{'method':_0x5aed65(0x1c1),'headers':{'Content-Type':_0x5aed65(0x1c6),'Accept':_0x5aed65(0x1c6),'User-Agent':_0x5aed65(0x20b)},'body':JSON[_0x5aed65(0x211)](_0x5f1996)}),_0x3095c4=Date[_0x5aed65(0x1b3)]()-_0x428ede;console[_0x5aed65(0x1fd)](_0x5aed65(0x1e8)),console[_0x5aed65(0x1fd)](_0x5aed65(0x1cd),_0x108ba8['status']),console[_0x5aed65(0x1fd)]('Status\x20Text:',_0x108ba8[_0x5aed65(0x1d5)]),console[_0x5aed65(0x1fd)](_0x5aed65(0x1f2),Object['fromEntries'](_0x108ba8[_0x5aed65(0x19f)]['entries']())),console[_0x5aed65(0x1fd)](_0x5aed65(0x1c3),_0x3095c4+'ms');const _0x9f18f=await _0x108ba8['text']();console[_0x5aed65(0x1fd)](_0x5aed65(0x214),_0x9f18f);if(!_0x108ba8['ok']){console[_0x5aed65(0x1e0)](_0x5aed65(0x1a8)),console['error']('HTTP\x20Status:',_0x108ba8[_0x5aed65(0x1e9)]),console['error']('Response\x20Body:',_0x9f18f),loggerService_1['loggerService'][_0x5aed65(0x1e2)]('cointopay',_0x5aed65(0x1d9),_0x108ba8[_0x5aed65(0x1e9)],_0x9f18f,_0x3095c4),loggerService_1[_0x5aed65(0x1ca)][_0x5aed65(0x1ad)]('cointopay',_0x5aed65(0x1d9),_0x5aed65(0x19c)+_0x108ba8[_0x5aed65(0x1e9)]+':\x20'+_0x9f18f);throw new Error(_0x5aed65(0x190)+_0x108ba8[_0x5aed65(0x1e9)]+_0x5aed65(0x1cc)+_0x9f18f);}let _0x1f41a9;try{_0x1f41a9=JSON[_0x5aed65(0x1e5)](_0x9f18f);}catch(_0x23fbcf){console['error'](_0x5aed65(0x20f),_0x23fbcf),loggerService_1[_0x5aed65(0x1ca)][_0x5aed65(0x1ad)](_0x5aed65(0x1ff),'/create',_0x5aed65(0x1be)+_0x23fbcf);throw new Error(_0x5aed65(0x1f9)+_0x9f18f);}console['log'](_0x5aed65(0x1b4)),console[_0x5aed65(0x1fd)](_0x5aed65(0x1a9),JSON[_0x5aed65(0x211)](_0x1f41a9,null,0x2)),loggerService_1['loggerService'][_0x5aed65(0x1e2)]('cointopay','/create',_0x108ba8[_0x5aed65(0x1e9)],_0x1f41a9,_0x3095c4);if(_0x1f41a9['error']){const _0x1f30c1=_0x1f41a9[_0x5aed65(0x1c0)]||_0x1f41a9[_0x5aed65(0x1e0)]||_0x5aed65(0x186);console[_0x5aed65(0x1e0)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x5aed65(0x1e0)]('Error\x20Message:',_0x1f30c1),loggerService_1['loggerService'][_0x5aed65(0x1ad)](_0x5aed65(0x1ff),'/create',_0x5aed65(0x204)+_0x1f30c1);throw new Error(_0x5aed65(0x208)+_0x1f30c1);}if(!_0x1f41a9['payment_url']||!_0x1f41a9[_0x5aed65(0x1ea)]){console['error'](_0x5aed65(0x1ae)),console[_0x5aed65(0x1e0)](_0x5aed65(0x1b9)),console[_0x5aed65(0x1e0)](_0x5aed65(0x1c7),_0x1f41a9),loggerService_1['loggerService'][_0x5aed65(0x1ad)](_0x5aed65(0x1ff),_0x5aed65(0x1d9),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x5aed65(0x215));}return console[_0x5aed65(0x1fd)](_0x5aed65(0x1f6)),console[_0x5aed65(0x1fd)](_0x5aed65(0x1c8),_0x1f41a9[_0x5aed65(0x1ea)]),console[_0x5aed65(0x1fd)](_0x5aed65(0x1d8),_0x1f41a9[_0x5aed65(0x193)]),console['log'](_0x5aed65(0x20d),_0x303a89,_0x5aed65(0x191)),{'gateway_payment_id':_0x1f41a9[_0x5aed65(0x1ea)],'payment_url':_0x1f41a9[_0x5aed65(0x193)]};}catch(_0x4f8ccf){console[_0x5aed65(0x1e0)](_0x5aed65(0x1f8)),console['error'](_0x5aed65(0x1ab),_0x4f8ccf),loggerService_1['loggerService'][_0x5aed65(0x1ad)]('cointopay',_0x5aed65(0x1d9),_0x4f8ccf);if(_0x4f8ccf instanceof Error){console[_0x5aed65(0x1e0)](_0x5aed65(0x213),_0x4f8ccf['message']),console[_0x5aed65(0x1e0)]('Error\x20stack:',_0x4f8ccf[_0x5aed65(0x20e)]);throw new Error(_0x5aed65(0x198)+_0x4f8ccf['message']);}throw new Error(_0x5aed65(0x1b7));}}async[a37_0x584867(0x1cf)](_0x5702fc){const _0x5c5358=a37_0x584867,_0x14c4ae=Date['now']();try{console[_0x5c5358(0x1fd)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x5702fc);const _0x103044={'gatewayPaymentId':_0x5702fc};loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x194)](_0x5c5358(0x1ff),'/status',_0x5c5358(0x1c1),_0x103044);const _0x136a4e=await fetch(this[_0x5c5358(0x18a)],{'method':_0x5c5358(0x1c1),'headers':{'Content-Type':_0x5c5358(0x1c6),'Accept':_0x5c5358(0x1c6),'User-Agent':_0x5c5358(0x20b)},'body':JSON[_0x5c5358(0x211)](_0x103044)}),_0x34c0c4=Date[_0x5c5358(0x1b3)]()-_0x14c4ae;console[_0x5c5358(0x1fd)](_0x5c5358(0x206)),console['log']('Status:',_0x136a4e['status']),console['log'](_0x5c5358(0x1c3),_0x34c0c4+'ms');if(!_0x136a4e['ok']){const _0x56a5bb=await _0x136a4e[_0x5c5358(0x1a6)]();console[_0x5c5358(0x1e0)](_0x5c5358(0x1b8),_0x136a4e[_0x5c5358(0x1e9)]),console[_0x5c5358(0x1e0)](_0x5c5358(0x1b0),_0x56a5bb),loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1e2)]('cointopay',_0x5c5358(0x1d4),_0x136a4e[_0x5c5358(0x1e9)],_0x56a5bb,_0x34c0c4),loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1ad)]('cointopay','/status',_0x5c5358(0x19c)+_0x136a4e[_0x5c5358(0x1e9)]+':\x20'+_0x56a5bb);throw new Error(_0x5c5358(0x190)+_0x136a4e[_0x5c5358(0x1e9)]);}const _0x1b989c=await _0x136a4e['text']();console[_0x5c5358(0x1fd)](_0x5c5358(0x214),_0x1b989c);let _0x2eb5f7;try{_0x2eb5f7=JSON[_0x5c5358(0x1e5)](_0x1b989c);}catch(_0x5b9977){console[_0x5c5358(0x1e0)](_0x5c5358(0x20f),_0x5b9977),loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1ad)](_0x5c5358(0x1ff),_0x5c5358(0x1d4),_0x5c5358(0x1be)+_0x5b9977);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x1b989c);}loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1e2)](_0x5c5358(0x1ff),'/status',_0x136a4e[_0x5c5358(0x1e9)],_0x2eb5f7,_0x34c0c4),console[_0x5c5358(0x1fd)](_0x5c5358(0x1bc)),console['log'](_0x5c5358(0x1da),_0x2eb5f7['result']),console[_0x5c5358(0x1fd)](_0x5c5358(0x1d2),_0x2eb5f7[_0x5c5358(0x19e)]),console[_0x5c5358(0x1fd)]('Payment\x20Status:',_0x2eb5f7['data']?.[_0x5c5358(0x1fa)]),console[_0x5c5358(0x1fd)]('Amount:',_0x2eb5f7['data']?.[_0x5c5358(0x1db)]),console['log'](_0x5c5358(0x20c),_0x2eb5f7[_0x5c5358(0x1df)]?.[_0x5c5358(0x1ed)]);if(_0x2eb5f7[_0x5c5358(0x209)]!==_0x5c5358(0x1ec)||_0x2eb5f7[_0x5c5358(0x19e)]!==0xc8){const _0x4c26c7=_0x2eb5f7[_0x5c5358(0x1c0)]||_0x5c5358(0x1f4);console[_0x5c5358(0x1e0)](_0x5c5358(0x1bd)),console[_0x5c5358(0x1e0)](_0x5c5358(0x1d1),_0x4c26c7),loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1ad)](_0x5c5358(0x1ff),'/status',_0x5c5358(0x1a1)+_0x4c26c7);throw new Error(_0x5c5358(0x1dc)+_0x4c26c7);}if(!_0x2eb5f7[_0x5c5358(0x1df)]){console[_0x5c5358(0x1e0)](_0x5c5358(0x1e7)),console[_0x5c5358(0x1e0)](_0x5c5358(0x1c5)),loggerService_1['loggerService'][_0x5c5358(0x1ad)]('cointopay',_0x5c5358(0x1d4),_0x5c5358(0x18d));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x52d997=_0x5c5358(0x1c9);switch(_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1fa)]?.['toLowerCase']()){case'paid':_0x52d997='PAID';break;case'cancelled':case _0x5c5358(0x189):case'error':_0x52d997=_0x5c5358(0x1e4);break;case _0x5c5358(0x18e):case'timeout':_0x52d997=_0x5c5358(0x1fe);break;case'waiting':case _0x5c5358(0x1a2):case _0x5c5358(0x207):case _0x5c5358(0x1f0):default:_0x52d997=_0x5c5358(0x1c9);break;}let _0x193f67,_0x1cae87;if(_0x2eb5f7[_0x5c5358(0x1df)]['PaymentDetail']){const _0x896d48=_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1a7)];console[_0x5c5358(0x1fd)](_0x5c5358(0x1bb),_0x896d48);const _0x5f285a=_0x896d48[_0x5c5358(0x1aa)](/IBAN\s+([A-Z0-9]+)/i);_0x5f285a&&(_0x193f67=_0x5f285a[0x1],console[_0x5c5358(0x1fd)](_0x5c5358(0x1ba),_0x193f67)),_0x1cae87=_0x896d48;}const _0x3363ad={'iban':_0x193f67,'bankDetails':_0x1cae87,'transactionId':_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x201)],'coinAddress':_0x2eb5f7['data'][_0x5c5358(0x1ee)],'qrCodeUrl':_0x2eb5f7[_0x5c5358(0x1df)]['QRCodeURL'],'expiryTime':_0x2eb5f7['data'][_0x5c5358(0x199)],'createdOn':_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1d7)],'confirmedOn':_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x197)]};console[_0x5c5358(0x1fd)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5c5358(0x1fd)](_0x5c5358(0x1cd),_0x2eb5f7['data'][_0x5c5358(0x1fa)],'->',_0x52d997),console[_0x5c5358(0x1fd)]('Amount:',_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1db)],_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1ed)]),console[_0x5c5358(0x1fd)](_0x5c5358(0x188),_0x2eb5f7['data'][_0x5c5358(0x201)]),console[_0x5c5358(0x1fd)](_0x5c5358(0x1ce),_0x193f67||_0x5c5358(0x192)),console[_0x5c5358(0x1fd)](_0x5c5358(0x19b),_0x2eb5f7[_0x5c5358(0x1df)]['CreatedOn']),console[_0x5c5358(0x1fd)](_0x5c5358(0x1af),_0x2eb5f7['data'][_0x5c5358(0x197)]||_0x5c5358(0x1bf));if(_0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1fa)]?.[_0x5c5358(0x1de)]()===_0x5c5358(0x1a2))console[_0x5c5358(0x1fd)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2eb5f7[_0x5c5358(0x1df)][_0x5c5358(0x1fa)]?.[_0x5c5358(0x1de)]()==='paid'&&console[_0x5c5358(0x1fd)](_0x5c5358(0x1d3));return{'status':_0x52d997,'amount':parseFloat(_0x2eb5f7['data'][_0x5c5358(0x1db)])||undefined,'currency':_0x2eb5f7[_0x5c5358(0x1df)]['inputCurrency']||_0x5c5358(0x191),'paymentDetails':_0x3363ad};}catch(_0x42ef73){console['error'](_0x5c5358(0x1a5),_0x42ef73),loggerService_1[_0x5c5358(0x1ca)][_0x5c5358(0x1ad)]('cointopay',_0x5c5358(0x1d4),_0x42ef73);throw new Error(_0x5c5358(0x1f3)+(_0x42ef73 instanceof Error?_0x42ef73[_0x5c5358(0x1c0)]:_0x5c5358(0x1e3)));}}async[a37_0x584867(0x1dd)](_0x5c2987){const _0x5967ce=a37_0x584867,_0x2f6520=await this[_0x5967ce(0x1cf)](_0x5c2987);return{'status':_0x2f6520[_0x5967ce(0x1e9)],'amount':_0x2f6520[_0x5967ce(0x1cb)],'currency':_0x2f6520['currency']};}async[a37_0x584867(0x1b5)](_0x51b453){const _0x185691=a37_0x584867;console['log'](_0x185691(0x1ac),_0x51b453);let _0x268f32='PENDING';switch(_0x51b453['status']?.[_0x185691(0x1de)]()){case _0x185691(0x212):_0x268f32=_0x185691(0x1f1);break;case _0x185691(0x1fc):case _0x185691(0x189):case _0x185691(0x1e0):_0x268f32=_0x185691(0x1e4);break;case _0x185691(0x18e):case _0x185691(0x1b6):_0x268f32=_0x185691(0x1fe);break;case _0x185691(0x207):case _0x185691(0x18c):case'awaiting\x20fiat':case _0x185691(0x1f0):default:_0x268f32='PENDING';break;}return{'paymentId':_0x51b453[_0x185691(0x1c2)]||_0x51b453[_0x185691(0x20a)]||'','status':_0x268f32,'amount':_0x51b453[_0x185691(0x1cb)],'currency':_0x51b453[_0x185691(0x1eb)]||'EUR'};}}function a37_0x1f77(_0x2f5d79,_0x38048b){const _0x58e0a5=a37_0x58e0();return a37_0x1f77=function(_0x1f7730,_0x8e8b64){_0x1f7730=_0x1f7730-0x186;let _0x499056=_0x58e0a5[_0x1f7730];return _0x499056;},a37_0x1f77(_0x2f5d79,_0x38048b);}exports[a37_0x584867(0x203)]=CoinToPayService;