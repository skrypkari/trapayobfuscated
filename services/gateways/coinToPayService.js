'use strict';const a41_0x199dab=a41_0x29ea;(function(_0x225290,_0x3e4de7){const _0x2426eb=a41_0x29ea,_0x1ae41e=_0x225290();while(!![]){try{const _0x257e46=parseInt(_0x2426eb(0x1fa))/0x1*(-parseInt(_0x2426eb(0x22c))/0x2)+parseInt(_0x2426eb(0x1da))/0x3+parseInt(_0x2426eb(0x201))/0x4*(-parseInt(_0x2426eb(0x240))/0x5)+parseInt(_0x2426eb(0x1dc))/0x6*(-parseInt(_0x2426eb(0x214))/0x7)+-parseInt(_0x2426eb(0x215))/0x8+parseInt(_0x2426eb(0x223))/0x9+parseInt(_0x2426eb(0x204))/0xa;if(_0x257e46===_0x3e4de7)break;else _0x1ae41e['push'](_0x1ae41e['shift']());}catch(_0x177b1c){_0x1ae41e['push'](_0x1ae41e['shift']());}}}(a41_0x4e96,0x7df04));function a41_0x29ea(_0x47f708,_0x2d4f37){const _0x4e9645=a41_0x4e96();return a41_0x29ea=function(_0x29ea13,_0x411161){_0x29ea13=_0x29ea13-0x1d9;let _0x58f464=_0x4e9645[_0x29ea13];return _0x58f464;},a41_0x29ea(_0x47f708,_0x2d4f37);}Object[a41_0x199dab(0x244)](exports,a41_0x199dab(0x248),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a41_0x199dab(0x217));class CoinToPayService{constructor(){const _0x417316=a41_0x199dab;this[_0x417316(0x23c)]=_0x417316(0x250),this[_0x417316(0x1e9)]=_0x417316(0x1f2),console[_0x417316(0x1fd)](_0x417316(0x20e)),console[_0x417316(0x1fd)]('📊\x20Status\x20check\x20URL:',this[_0x417316(0x1e9)]);}async[a41_0x199dab(0x200)](_0x52d003){const _0xd5c063=a41_0x199dab,{orderId:_0x268d7c,amount:_0x37405d}=_0x52d003;console[_0xd5c063(0x1fd)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x37405d+_0xd5c063(0x20b));const _0x1a3d5b={'amount':_0x37405d},_0x1ef6a5=Date['now']();try{console[_0xd5c063(0x1fd)](_0xd5c063(0x20a)),console[_0xd5c063(0x1fd)]('URL:',this[_0xd5c063(0x23c)]),console[_0xd5c063(0x1fd)]('Request\x20Body:',JSON[_0xd5c063(0x235)](_0x1a3d5b,null,0x2)),console['log'](_0xd5c063(0x1f9),_0x37405d,_0xd5c063(0x22d)),loggerService_1[_0xd5c063(0x21f)][_0xd5c063(0x1e4)](_0xd5c063(0x1de),_0xd5c063(0x220),_0xd5c063(0x241),_0x1a3d5b);const _0x466d4a=await fetch(this[_0xd5c063(0x23c)],{'method':_0xd5c063(0x241),'headers':{'Content-Type':_0xd5c063(0x254),'Accept':'application/json','User-Agent':_0xd5c063(0x243)},'body':JSON['stringify'](_0x1a3d5b)}),_0xe01c10=Date[_0xd5c063(0x1ef)]()-_0x1ef6a5;console[_0xd5c063(0x1fd)](_0xd5c063(0x1e2)),console[_0xd5c063(0x1fd)](_0xd5c063(0x239),_0x466d4a['status']),console[_0xd5c063(0x1fd)]('Status\x20Text:',_0x466d4a[_0xd5c063(0x233)]),console[_0xd5c063(0x1fd)](_0xd5c063(0x216),Object[_0xd5c063(0x219)](_0x466d4a[_0xd5c063(0x225)][_0xd5c063(0x203)]())),console[_0xd5c063(0x1fd)](_0xd5c063(0x21c),_0xe01c10+'ms');const _0x560702=await _0x466d4a[_0xd5c063(0x1ec)]();console['log'](_0xd5c063(0x1e0),_0x560702);if(!_0x466d4a['ok']){console[_0xd5c063(0x1f5)](_0xd5c063(0x1ff)),console[_0xd5c063(0x1f5)]('HTTP\x20Status:',_0x466d4a[_0xd5c063(0x252)]),console[_0xd5c063(0x1f5)](_0xd5c063(0x24e),_0x560702),loggerService_1[_0xd5c063(0x21f)]['logWhiteDomainResponse']('cointopay',_0xd5c063(0x220),_0x466d4a[_0xd5c063(0x252)],_0x560702,_0xe01c10),loggerService_1[_0xd5c063(0x21f)][_0xd5c063(0x1e6)](_0xd5c063(0x1de),_0xd5c063(0x220),_0xd5c063(0x24d)+_0x466d4a['status']+':\x20'+_0x560702);throw new Error(_0xd5c063(0x234)+_0x466d4a[_0xd5c063(0x252)]+_0xd5c063(0x1f6)+_0x560702);}let _0x368353;try{_0x368353=JSON[_0xd5c063(0x202)](_0x560702);}catch(_0x18ab9b){console[_0xd5c063(0x1f5)](_0xd5c063(0x205),_0x18ab9b),loggerService_1[_0xd5c063(0x21f)][_0xd5c063(0x1e6)](_0xd5c063(0x1de),_0xd5c063(0x220),_0xd5c063(0x20f)+_0x18ab9b);throw new Error(_0xd5c063(0x1eb)+_0x560702);}console[_0xd5c063(0x1fd)](_0xd5c063(0x227)),console['log'](_0xd5c063(0x1df),JSON['stringify'](_0x368353,null,0x2)),loggerService_1[_0xd5c063(0x21f)][_0xd5c063(0x22a)]('cointopay','/create',_0x466d4a['status'],_0x368353,_0xe01c10);if(_0x368353[_0xd5c063(0x1f5)]){const _0x3aaa46=_0x368353[_0xd5c063(0x247)]||_0x368353[_0xd5c063(0x1f5)]||_0xd5c063(0x232);console[_0xd5c063(0x1f5)](_0xd5c063(0x1ee)),console['error']('Error\x20Message:',_0x3aaa46),loggerService_1['loggerService'][_0xd5c063(0x1e6)](_0xd5c063(0x1de),_0xd5c063(0x220),'Business\x20Error:\x20'+_0x3aaa46);throw new Error(_0xd5c063(0x242)+_0x3aaa46);}if(!_0x368353[_0xd5c063(0x23d)]||!_0x368353[_0xd5c063(0x256)]){console[_0xd5c063(0x1f5)](_0xd5c063(0x1f0)),console[_0xd5c063(0x1f5)](_0xd5c063(0x1ed)),console['error'](_0xd5c063(0x206),_0x368353),loggerService_1['loggerService'][_0xd5c063(0x1e6)](_0xd5c063(0x1de),_0xd5c063(0x220),_0xd5c063(0x1fb));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0xd5c063(0x1fd)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0xd5c063(0x1fd)]('Gateway\x20Payment\x20ID:',_0x368353[_0xd5c063(0x256)]),console[_0xd5c063(0x1fd)]('Payment\x20URL:',_0x368353['payment_url']),console[_0xd5c063(0x1fd)](_0xd5c063(0x1f9),_0x37405d,'EUR'),{'gateway_payment_id':_0x368353[_0xd5c063(0x256)],'payment_url':_0x368353[_0xd5c063(0x23d)]};}catch(_0x5c152b){console[_0xd5c063(0x1f5)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x5c152b),loggerService_1['loggerService'][_0xd5c063(0x1e6)](_0xd5c063(0x1de),_0xd5c063(0x220),_0x5c152b);if(_0x5c152b instanceof Error){console['error'](_0xd5c063(0x22f),_0x5c152b[_0xd5c063(0x247)]),console[_0xd5c063(0x1f5)](_0xd5c063(0x20c),_0x5c152b['stack']);throw new Error(_0xd5c063(0x224)+_0x5c152b[_0xd5c063(0x247)]);}throw new Error(_0xd5c063(0x226));}}async[a41_0x199dab(0x222)](_0x1890a4){const _0x493737=a41_0x199dab,_0x528b43=Date[_0x493737(0x1ef)]();try{console['log']('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x1890a4);const _0x299f3f={'gatewayPaymentId':_0x1890a4};loggerService_1[_0x493737(0x21f)]['logWhiteDomainRequest'](_0x493737(0x1de),_0x493737(0x23e),_0x493737(0x241),_0x299f3f);const _0x7c27d=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x493737(0x254),'Accept':'application/json','User-Agent':_0x493737(0x243)},'body':JSON[_0x493737(0x235)](_0x299f3f)}),_0x1721fc=Date[_0x493737(0x1ef)]()-_0x528b43;console[_0x493737(0x1fd)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x493737(0x1fd)](_0x493737(0x239),_0x7c27d[_0x493737(0x252)]),console[_0x493737(0x1fd)](_0x493737(0x21c),_0x1721fc+'ms');if(!_0x7c27d['ok']){const _0x3db73e=await _0x7c27d[_0x493737(0x1ec)]();console[_0x493737(0x1f5)](_0x493737(0x1f3),_0x7c27d[_0x493737(0x252)]),console['error'](_0x493737(0x24e),_0x3db73e),loggerService_1['loggerService'][_0x493737(0x22a)](_0x493737(0x1de),_0x493737(0x23e),_0x7c27d['status'],_0x3db73e,_0x1721fc),loggerService_1[_0x493737(0x21f)]['logWhiteDomainError'](_0x493737(0x1de),_0x493737(0x23e),_0x493737(0x24d)+_0x7c27d[_0x493737(0x252)]+':\x20'+_0x3db73e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x7c27d[_0x493737(0x252)]);}const _0x4c8243=await _0x7c27d['text']();console['log'](_0x493737(0x1e0),_0x4c8243);let _0x4e243a;try{_0x4e243a=JSON['parse'](_0x4c8243);}catch(_0x538ebc){console[_0x493737(0x1f5)](_0x493737(0x205),_0x538ebc),loggerService_1['loggerService'][_0x493737(0x1e6)]('cointopay',_0x493737(0x23e),_0x493737(0x20f)+_0x538ebc);throw new Error(_0x493737(0x245)+_0x4c8243);}loggerService_1[_0x493737(0x21f)][_0x493737(0x22a)](_0x493737(0x1de),_0x493737(0x23e),_0x7c27d[_0x493737(0x252)],_0x4e243a,_0x1721fc),console[_0x493737(0x1fd)](_0x493737(0x236)),console[_0x493737(0x1fd)]('Result:',_0x4e243a[_0x493737(0x21e)]),console[_0x493737(0x1fd)](_0x493737(0x209),_0x4e243a['status_code']),console[_0x493737(0x1fd)](_0x493737(0x1f4),_0x4e243a[_0x493737(0x24c)]?.[_0x493737(0x22e)]),console[_0x493737(0x1fd)]('Amount:',_0x4e243a[_0x493737(0x24c)]?.[_0x493737(0x20d)]),console[_0x493737(0x1fd)](_0x493737(0x211),_0x4e243a[_0x493737(0x24c)]?.[_0x493737(0x212)]);if(_0x4e243a[_0x493737(0x21e)]!==_0x493737(0x1f7)||_0x4e243a[_0x493737(0x23a)]!==0xc8){const _0x494798=_0x4e243a[_0x493737(0x247)]||_0x493737(0x1e1);console[_0x493737(0x1f5)](_0x493737(0x228)),console['error'](_0x493737(0x23b),_0x494798),loggerService_1[_0x493737(0x21f)][_0x493737(0x1e6)](_0x493737(0x1de),'/status','Status\x20API\x20Error:\x20'+_0x494798);throw new Error(_0x493737(0x23f)+_0x494798);}if(!_0x4e243a[_0x493737(0x24c)]){console[_0x493737(0x1f5)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x493737(0x1d9)),loggerService_1['loggerService'][_0x493737(0x1e6)](_0x493737(0x1de),_0x493737(0x23e),_0x493737(0x1f1));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x574d5e=_0x493737(0x218);switch(_0x4e243a[_0x493737(0x24c)][_0x493737(0x22e)]?.[_0x493737(0x24a)]()){case'paid':_0x574d5e='PAID';break;case'cancelled':case _0x493737(0x1e3):case _0x493737(0x1f5):_0x574d5e=_0x493737(0x1fc);break;case _0x493737(0x24f):case _0x493737(0x21d):_0x574d5e=_0x493737(0x1e5);break;case'waiting':case _0x493737(0x21a):case _0x493737(0x229):case _0x493737(0x1e7):default:_0x574d5e=_0x493737(0x218);break;}let _0x485758,_0x1c7fa8;if(_0x4e243a[_0x493737(0x24c)][_0x493737(0x231)]){const _0x35d2b6=_0x4e243a[_0x493737(0x24c)][_0x493737(0x231)];console[_0x493737(0x1fd)]('🏦\x20Payment\x20Detail:',_0x35d2b6);const _0x3a76dc=_0x35d2b6[_0x493737(0x255)](/IBAN\s+([A-Z0-9]+)/i);_0x3a76dc&&(_0x485758=_0x3a76dc[0x1],console[_0x493737(0x1fd)](_0x493737(0x253),_0x485758)),_0x1c7fa8=_0x35d2b6;}const _0x4c3d96={'iban':_0x485758,'bankDetails':_0x1c7fa8,'transactionId':_0x4e243a['data'][_0x493737(0x1db)],'coinAddress':_0x4e243a[_0x493737(0x24c)][_0x493737(0x246)],'qrCodeUrl':_0x4e243a[_0x493737(0x24c)]['QRCodeURL'],'expiryTime':_0x4e243a[_0x493737(0x24c)][_0x493737(0x1ea)],'createdOn':_0x4e243a[_0x493737(0x24c)][_0x493737(0x21b)],'confirmedOn':_0x4e243a[_0x493737(0x24c)][_0x493737(0x1e8)]};console[_0x493737(0x1fd)](_0x493737(0x210)),console[_0x493737(0x1fd)](_0x493737(0x239),_0x4e243a[_0x493737(0x24c)][_0x493737(0x22e)],'->',_0x574d5e),console[_0x493737(0x1fd)](_0x493737(0x1f9),_0x4e243a['data'][_0x493737(0x20d)],_0x4e243a[_0x493737(0x24c)]['inputCurrency']),console[_0x493737(0x1fd)]('Transaction\x20ID:',_0x4e243a[_0x493737(0x24c)][_0x493737(0x1db)]),console[_0x493737(0x1fd)](_0x493737(0x221),_0x485758||_0x493737(0x208)),console[_0x493737(0x1fd)](_0x493737(0x207),_0x4e243a[_0x493737(0x24c)][_0x493737(0x21b)]),console[_0x493737(0x1fd)](_0x493737(0x238),_0x4e243a[_0x493737(0x24c)][_0x493737(0x1e8)]||_0x493737(0x1dd));if(_0x4e243a[_0x493737(0x24c)][_0x493737(0x22e)]?.[_0x493737(0x24a)]()===_0x493737(0x21a))console[_0x493737(0x1fd)](_0x493737(0x22b));else _0x4e243a[_0x493737(0x24c)]['Status']?.['toLowerCase']()===_0x493737(0x1f8)&&console[_0x493737(0x1fd)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x574d5e,'amount':parseFloat(_0x4e243a[_0x493737(0x24c)][_0x493737(0x20d)])||undefined,'currency':_0x4e243a['data']['inputCurrency']||'EUR','paymentDetails':_0x4c3d96};}catch(_0x2e0a1f){console[_0x493737(0x1f5)](_0x493737(0x1fe),_0x2e0a1f),loggerService_1[_0x493737(0x21f)]['logWhiteDomainError'](_0x493737(0x1de),_0x493737(0x23e),_0x2e0a1f);throw new Error(_0x493737(0x249)+(_0x2e0a1f instanceof Error?_0x2e0a1f['message']:_0x493737(0x230)));}}async[a41_0x199dab(0x213)](_0x5c22d1){const _0x10ee9e=a41_0x199dab,_0x2bf5ab=await this[_0x10ee9e(0x222)](_0x5c22d1);return{'status':_0x2bf5ab['status'],'amount':_0x2bf5ab[_0x10ee9e(0x24b)],'currency':_0x2bf5ab['currency']};}async['processWebhook'](_0x3c55b3){const _0x51e93a=a41_0x199dab;console['log'](_0x51e93a(0x257),_0x3c55b3);let _0x1bd7fd=_0x51e93a(0x218);switch(_0x3c55b3[_0x51e93a(0x252)]?.[_0x51e93a(0x24a)]()){case _0x51e93a(0x1f8):_0x1bd7fd='PAID';break;case'cancelled':case _0x51e93a(0x1e3):case'error':_0x1bd7fd=_0x51e93a(0x1fc);break;case _0x51e93a(0x24f):case _0x51e93a(0x21d):_0x1bd7fd=_0x51e93a(0x1e5);break;case'pending':case'waiting':case'awaiting\x20fiat':case _0x51e93a(0x1e7):default:_0x1bd7fd='PENDING';break;}return{'paymentId':_0x3c55b3['order_id']||_0x3c55b3[_0x51e93a(0x251)]||'','status':_0x1bd7fd,'amount':_0x3c55b3[_0x51e93a(0x24b)],'currency':_0x3c55b3[_0x51e93a(0x237)]||'EUR'};}}function a41_0x4e96(){const _0x528d4d=['💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','2jnppwY','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status','Error\x20message:','Unknown\x20error','PaymentDetail','Unknown\x20error\x20from\x20CoinToPay\x20API','statusText','HTTP\x20error!\x20status:\x20','stringify','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','currency','Confirmed\x20On:','Status:','status_code','Error\x20Message:','apiUrl','payment_url','/status','CoinToPay\x20status\x20API\x20error:\x20','254195kDWFnU','POST','CoinToPay\x20API\x20error:\x20','TesSoft\x20Payment\x20System/1.0','defineProperty','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','coinAddress','message','__esModule','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','toLowerCase','amount','data','HTTP\x20','Response\x20Body:','expired','https://tesoft.uk/gateway/cointopay/','merchant_reference_id','status','🏦\x20Extracted\x20IBAN:','application/json','match','gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Missing\x20data\x20in\x20response','186687cfMikR','TransactionID','151398FqCrbV','not\x20confirmed','cointopay','Parsed\x20Result:','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','failed','logWhiteDomainRequest','EXPIRED','logWhiteDomainError','created','TransactionConfirmedOn','statusUrl','ExpiryTime','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','text','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','now','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20data','https://tesoft.uk/gateway/cointopay/status.php','HTTP\x20Status:','Payment\x20Status:','error',',\x20body:\x20','success','paid','Amount:','887834paLDpu','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','FAILED','log','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20ERROR\x20===','createPaymentLink','40szViTs','parse','entries','31335640nDUXpL','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','Created\x20On:','not\x20found','Status\x20Code:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','\x20EUR','Error\x20stack:','Amount','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Currency:','inputCurrency','verifyPayment','273VCjKuu','6713512QNFuha','Headers:','../loggerService','PENDING','fromEntries','awaiting\x20fiat','CreatedOn','Response\x20Time:','timeout','result','loggerService','/create','IBAN:','checkPaymentStatus','4855959gRRczd','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','pending','logWhiteDomainResponse'];a41_0x4e96=function(){return _0x528d4d;};return a41_0x4e96();}exports['CoinToPayService']=CoinToPayService;