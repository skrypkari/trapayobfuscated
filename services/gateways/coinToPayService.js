'use strict';function a40_0x346c(){const _0x5f1b1d=['Status','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','/create','TransactionConfirmedOn','currency','QRCodeURL','CreatedOn','EXPIRED','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','result','Business\x20Error:\x20','10043943TpfNwU','not\x20confirmed','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','now','apiUrl','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','text','EUR','Response\x20data:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20Code:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','loggerService','amount','HTTP\x20Status:','logWhiteDomainResponse','error','fromEntries','TransactionID','Raw\x20Response\x20Body:','Error\x20Message:','awaiting\x20fiat','statusText','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','verifyPayment','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Status:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','PENDING','ExpiryTime','log','Headers:','failed','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','payment_url','match','2587672LsgwVg','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','1433356XgCbKn','4042752LlUvCi','toLowerCase','message','üè¶\x20Payment\x20Detail:','Error\x20message:','12txWeUD','Unknown\x20error\x20from\x20CoinToPay\x20API','defineProperty','waiting','Transaction\x20ID:','data','statusUrl','2328395viKWeC','Missing\x20data\x20in\x20response','https://tesoft.uk/gateway/cointopay/status.php','FAILED','__esModule','Confirmed\x20On:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Created\x20On:','coinAddress','Response\x20Time:','gateway_payment_id','===\x20COINTOPAY\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/','paid','inputCurrency','PAID','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','Currency:','checkPaymentStatus','Incomplete\x20response:\x20missing\x20data','status','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Amount:','Result:','üè¶\x20Extracted\x20IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Status\x20check\x20URL:','CoinToPayService','Payment\x20URL:','\x20EUR','POST','created','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20','Amount','4274478MOvDbf','PaymentDetail','logWhiteDomainRequest','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','124494JhBHEd','/status','application/json','../loggerService','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CoinToPay\x20API\x20error:\x20','Request\x20Body:','IBAN:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','timeout','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','status_code','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20details:','pending','merchant_reference_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','parse','Status\x20API\x20Error:\x20','Parsed\x20Result:'];a40_0x346c=function(){return _0x5f1b1d;};return a40_0x346c();}const a40_0x53d7cd=a40_0x2f4c;(function(_0x406b05,_0x342749){const _0x1c6297=a40_0x2f4c,_0x48d7b=_0x406b05();while(!![]){try{const _0x30187a=parseInt(_0x1c6297(0x211))/0x1+parseInt(_0x1c6297(0x20d))/0x2+-parseInt(_0x1c6297(0x248))/0x3*(-parseInt(_0x1c6297(0x217))/0x4)+-parseInt(_0x1c6297(0x21e))/0x5+-parseInt(_0x1c6297(0x242))/0x6+-parseInt(_0x1c6297(0x1e6))/0x7+parseInt(_0x1c6297(0x212))/0x8;if(_0x30187a===_0x342749)break;else _0x48d7b['push'](_0x48d7b['shift']());}catch(_0x2dffd9){_0x48d7b['push'](_0x48d7b['shift']());}}}(a40_0x346c,0xb5a99));Object[a40_0x53d7cd(0x219)](exports,a40_0x53d7cd(0x222),{'value':!![]}),exports[a40_0x53d7cd(0x23a)]=void 0x0;const loggerService_1=require(a40_0x53d7cd(0x24b));class CoinToPayService{constructor(){const _0x73fd05=a40_0x53d7cd;this[_0x73fd05(0x1ea)]=_0x73fd05(0x22a),this[_0x73fd05(0x21d)]=_0x73fd05(0x220),console[_0x73fd05(0x207)](_0x73fd05(0x22e)),console[_0x73fd05(0x207)](_0x73fd05(0x239),this[_0x73fd05(0x21d)]);}async['createPaymentLink'](_0x4205d5){const _0xb32b52=a40_0x53d7cd,{orderId:_0x58ef52,amount:_0x122fb9}=_0x4205d5;console[_0xb32b52(0x207)](_0xb32b52(0x1f1)+_0x122fb9+_0xb32b52(0x23c));const _0x4511cd={'amount':_0x122fb9},_0x47f2a4=Date[_0xb32b52(0x1e9)]();try{console[_0xb32b52(0x207)](_0xb32b52(0x1f4)),console['log']('URL:',this[_0xb32b52(0x1ea)]),console[_0xb32b52(0x207)](_0xb32b52(0x1ca),JSON[_0xb32b52(0x22f)](_0x4511cd,null,0x2)),console['log'](_0xb32b52(0x235),_0x122fb9,_0xb32b52(0x1ce)),loggerService_1[_0xb32b52(0x1f5)][_0xb32b52(0x244)](_0xb32b52(0x1ec),'/create',_0xb32b52(0x23d),_0x4511cd);const _0x3e0e85=await fetch(this[_0xb32b52(0x1ea)],{'method':_0xb32b52(0x23d),'headers':{'Content-Type':_0xb32b52(0x24a),'Accept':_0xb32b52(0x24a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xb32b52(0x22f)](_0x4511cd)}),_0x5e2e56=Date[_0xb32b52(0x1e9)]()-_0x47f2a4;console[_0xb32b52(0x207)](_0xb32b52(0x1dc)),console[_0xb32b52(0x207)](_0xb32b52(0x203),_0x3e0e85[_0xb32b52(0x233)]),console[_0xb32b52(0x207)]('Status\x20Text:',_0x3e0e85[_0xb32b52(0x1ff)]),console[_0xb32b52(0x207)](_0xb32b52(0x208),Object[_0xb32b52(0x1fa)](_0x3e0e85['headers']['entries']())),console[_0xb32b52(0x207)](_0xb32b52(0x227),_0x5e2e56+'ms');const _0x1abb8e=await _0x3e0e85['text']();console['log'](_0xb32b52(0x1fc),_0x1abb8e);if(!_0x3e0e85['ok']){console[_0xb32b52(0x1f9)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0xb32b52(0x1f7),_0x3e0e85[_0xb32b52(0x233)]),console['error'](_0xb32b52(0x1d2),_0x1abb8e),loggerService_1[_0xb32b52(0x1f5)][_0xb32b52(0x1f8)](_0xb32b52(0x1ec),_0xb32b52(0x1dd),_0x3e0e85[_0xb32b52(0x233)],_0x1abb8e,_0x5e2e56),loggerService_1['loggerService'][_0xb32b52(0x245)](_0xb32b52(0x1ec),_0xb32b52(0x1dd),_0xb32b52(0x240)+_0x3e0e85[_0xb32b52(0x233)]+':\x20'+_0x1abb8e);throw new Error(_0xb32b52(0x1d1)+_0x3e0e85[_0xb32b52(0x233)]+_0xb32b52(0x20f)+_0x1abb8e);}let _0x41bf3c;try{_0x41bf3c=JSON[_0xb32b52(0x1d8)](_0x1abb8e);}catch(_0x4844eb){console[_0xb32b52(0x1f9)](_0xb32b52(0x1eb),_0x4844eb),loggerService_1[_0xb32b52(0x1f5)][_0xb32b52(0x245)]('cointopay',_0xb32b52(0x1dd),'JSON\x20Parse\x20Error:\x20'+_0x4844eb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x1abb8e);}console['log'](_0xb32b52(0x1d7)),console[_0xb32b52(0x207)](_0xb32b52(0x1da),JSON['stringify'](_0x41bf3c,null,0x2)),loggerService_1[_0xb32b52(0x1f5)][_0xb32b52(0x1f8)](_0xb32b52(0x1ec),_0xb32b52(0x1dd),_0x3e0e85[_0xb32b52(0x233)],_0x41bf3c,_0x5e2e56);if(_0x41bf3c[_0xb32b52(0x1f9)]){const _0x7f493e=_0x41bf3c[_0xb32b52(0x214)]||_0x41bf3c[_0xb32b52(0x1f9)]||_0xb32b52(0x218);console[_0xb32b52(0x1f9)](_0xb32b52(0x1f2)),console[_0xb32b52(0x1f9)](_0xb32b52(0x1fd),_0x7f493e),loggerService_1[_0xb32b52(0x1f5)]['logWhiteDomainError'](_0xb32b52(0x1ec),'/create',_0xb32b52(0x1e5)+_0x7f493e);throw new Error(_0xb32b52(0x1c9)+_0x7f493e);}if(!_0x41bf3c[_0xb32b52(0x20b)]||!_0x41bf3c[_0xb32b52(0x228)]){console[_0xb32b52(0x1f9)](_0xb32b52(0x1cc)),console[_0xb32b52(0x1f9)](_0xb32b52(0x24c)),console['error'](_0xb32b52(0x1f0),_0x41bf3c),loggerService_1['loggerService'][_0xb32b52(0x245)](_0xb32b52(0x1ec),_0xb32b52(0x1dd),_0xb32b52(0x200));throw new Error(_0xb32b52(0x238));}return console['log'](_0xb32b52(0x229)),console['log']('Gateway\x20Payment\x20ID:',_0x41bf3c[_0xb32b52(0x228)]),console[_0xb32b52(0x207)](_0xb32b52(0x23b),_0x41bf3c[_0xb32b52(0x20b)]),console[_0xb32b52(0x207)](_0xb32b52(0x235),_0x122fb9,'EUR'),{'gateway_payment_id':_0x41bf3c[_0xb32b52(0x228)],'payment_url':_0x41bf3c[_0xb32b52(0x20b)]};}catch(_0x371c96){console[_0xb32b52(0x1f9)](_0xb32b52(0x1e8)),console[_0xb32b52(0x1f9)](_0xb32b52(0x1d4),_0x371c96),loggerService_1['loggerService'][_0xb32b52(0x245)](_0xb32b52(0x1ec),'/create',_0x371c96);if(_0x371c96 instanceof Error){console['error'](_0xb32b52(0x216),_0x371c96['message']),console[_0xb32b52(0x1f9)]('Error\x20stack:',_0x371c96['stack']);throw new Error(_0xb32b52(0x1ed)+_0x371c96[_0xb32b52(0x214)]);}throw new Error(_0xb32b52(0x1e3));}}async[a40_0x53d7cd(0x231)](_0x287a94){const _0x12f4a2=a40_0x53d7cd,_0x5672bd=Date[_0x12f4a2(0x1e9)]();try{console['log'](_0x12f4a2(0x234)+_0x287a94);const _0x55d4a9={'gatewayPaymentId':_0x287a94};loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x244)](_0x12f4a2(0x1ec),_0x12f4a2(0x249),_0x12f4a2(0x23d),_0x55d4a9);const _0x12a7e8=await fetch(this[_0x12f4a2(0x21d)],{'method':_0x12f4a2(0x23d),'headers':{'Content-Type':_0x12f4a2(0x24a),'Accept':_0x12f4a2(0x24a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x12f4a2(0x22f)](_0x55d4a9)}),_0x289e85=Date[_0x12f4a2(0x1e9)]()-_0x5672bd;console[_0x12f4a2(0x207)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x12f4a2(0x203),_0x12a7e8[_0x12f4a2(0x233)]),console[_0x12f4a2(0x207)](_0x12f4a2(0x227),_0x289e85+'ms');if(!_0x12a7e8['ok']){const _0x226bff=await _0x12a7e8[_0x12f4a2(0x1ee)]();console[_0x12f4a2(0x1f9)]('HTTP\x20Status:',_0x12a7e8[_0x12f4a2(0x233)]),console[_0x12f4a2(0x1f9)](_0x12f4a2(0x1d2),_0x226bff),loggerService_1['loggerService'][_0x12f4a2(0x1f8)]('cointopay','/status',_0x12a7e8[_0x12f4a2(0x233)],_0x226bff,_0x289e85),loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x245)]('cointopay',_0x12f4a2(0x249),'HTTP\x20'+_0x12a7e8[_0x12f4a2(0x233)]+':\x20'+_0x226bff);throw new Error(_0x12f4a2(0x1d1)+_0x12a7e8['status']);}const _0xc3138e=await _0x12a7e8[_0x12f4a2(0x1ee)]();console['log']('Raw\x20Response\x20Body:',_0xc3138e);let _0x4490c0;try{_0x4490c0=JSON[_0x12f4a2(0x1d8)](_0xc3138e);}catch(_0x29485e){console['error'](_0x12f4a2(0x1eb),_0x29485e),loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x245)]('cointopay','/status',_0x12f4a2(0x20e)+_0x29485e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0xc3138e);}loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x1f8)](_0x12f4a2(0x1ec),_0x12f4a2(0x249),_0x12a7e8[_0x12f4a2(0x233)],_0x4490c0,_0x289e85),console[_0x12f4a2(0x207)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x12f4a2(0x207)](_0x12f4a2(0x236),_0x4490c0['result']),console[_0x12f4a2(0x207)](_0x12f4a2(0x1f3),_0x4490c0[_0x12f4a2(0x1cf)]),console[_0x12f4a2(0x207)]('Payment\x20Status:',_0x4490c0[_0x12f4a2(0x21c)]?.[_0x12f4a2(0x1db)]),console['log'](_0x12f4a2(0x235),_0x4490c0['data']?.[_0x12f4a2(0x241)]),console[_0x12f4a2(0x207)](_0x12f4a2(0x230),_0x4490c0[_0x12f4a2(0x21c)]?.[_0x12f4a2(0x22c)]);if(_0x4490c0[_0x12f4a2(0x1e4)]!=='success'||_0x4490c0[_0x12f4a2(0x1cf)]!==0xc8){const _0x2b8d6e=_0x4490c0['message']||_0x12f4a2(0x1d3);console['error'](_0x12f4a2(0x202)),console[_0x12f4a2(0x1f9)](_0x12f4a2(0x1fd),_0x2b8d6e),loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x245)](_0x12f4a2(0x1ec),_0x12f4a2(0x249),_0x12f4a2(0x1d9)+_0x2b8d6e);throw new Error(_0x12f4a2(0x1d0)+_0x2b8d6e);}if(!_0x4490c0['data']){console[_0x12f4a2(0x1f9)](_0x12f4a2(0x224)),console[_0x12f4a2(0x1f9)](_0x12f4a2(0x21f)),loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x245)](_0x12f4a2(0x1ec),_0x12f4a2(0x249),_0x12f4a2(0x232));throw new Error(_0x12f4a2(0x246));}let _0x49032b=_0x12f4a2(0x205);switch(_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1db)]?.['toLowerCase']()){case'paid':_0x49032b='PAID';break;case'cancelled':case _0x12f4a2(0x209):case _0x12f4a2(0x1f9):_0x49032b=_0x12f4a2(0x221);break;case'expired':case _0x12f4a2(0x1cd):_0x49032b=_0x12f4a2(0x1e2);break;case _0x12f4a2(0x21a):case _0x12f4a2(0x1fe):case _0x12f4a2(0x1d5):case _0x12f4a2(0x23e):default:_0x49032b=_0x12f4a2(0x205);break;}let _0x38011e,_0x15d0d3;if(_0x4490c0['data'][_0x12f4a2(0x243)]){const _0x471454=_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x243)];console['log'](_0x12f4a2(0x215),_0x471454);const _0x4a9371=_0x471454[_0x12f4a2(0x20c)](/IBAN\s+([A-Z0-9]+)/i);_0x4a9371&&(_0x38011e=_0x4a9371[0x1],console['log'](_0x12f4a2(0x237),_0x38011e)),_0x15d0d3=_0x471454;}const _0x182ac8={'iban':_0x38011e,'bankDetails':_0x15d0d3,'transactionId':_0x4490c0[_0x12f4a2(0x21c)]['TransactionID'],'coinAddress':_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x226)],'qrCodeUrl':_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1e0)],'expiryTime':_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x206)],'createdOn':_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1e1)],'confirmedOn':_0x4490c0['data'][_0x12f4a2(0x1de)]};console[_0x12f4a2(0x207)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x12f4a2(0x203),_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1db)],'->',_0x49032b),console[_0x12f4a2(0x207)](_0x12f4a2(0x235),_0x4490c0['data'][_0x12f4a2(0x241)],_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x22c)]),console[_0x12f4a2(0x207)](_0x12f4a2(0x21b),_0x4490c0['data'][_0x12f4a2(0x1fb)]),console[_0x12f4a2(0x207)](_0x12f4a2(0x1cb),_0x38011e||'not\x20found'),console[_0x12f4a2(0x207)](_0x12f4a2(0x225),_0x4490c0[_0x12f4a2(0x21c)]['CreatedOn']),console[_0x12f4a2(0x207)](_0x12f4a2(0x223),_0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1de)]||_0x12f4a2(0x1e7));if(_0x4490c0[_0x12f4a2(0x21c)]['Status']?.[_0x12f4a2(0x213)]()===_0x12f4a2(0x1fe))console[_0x12f4a2(0x207)](_0x12f4a2(0x210));else _0x4490c0[_0x12f4a2(0x21c)][_0x12f4a2(0x1db)]?.[_0x12f4a2(0x213)]()===_0x12f4a2(0x22b)&&console[_0x12f4a2(0x207)](_0x12f4a2(0x204));return{'status':_0x49032b,'amount':parseFloat(_0x4490c0['data'][_0x12f4a2(0x241)])||undefined,'currency':_0x4490c0[_0x12f4a2(0x21c)]['inputCurrency']||_0x12f4a2(0x1ef),'paymentDetails':_0x182ac8};}catch(_0x55b5d9){console[_0x12f4a2(0x1f9)](_0x12f4a2(0x23f),_0x55b5d9),loggerService_1[_0x12f4a2(0x1f5)][_0x12f4a2(0x245)](_0x12f4a2(0x1ec),_0x12f4a2(0x249),_0x55b5d9);throw new Error(_0x12f4a2(0x20a)+(_0x55b5d9 instanceof Error?_0x55b5d9[_0x12f4a2(0x214)]:'Unknown\x20error'));}}async[a40_0x53d7cd(0x201)](_0x466774){const _0x46d98f=a40_0x53d7cd,_0x9e2d89=await this[_0x46d98f(0x231)](_0x466774);return{'status':_0x9e2d89['status'],'amount':_0x9e2d89[_0x46d98f(0x1f6)],'currency':_0x9e2d89[_0x46d98f(0x1df)]};}async['processWebhook'](_0x4080bc){const _0x186458=a40_0x53d7cd;console[_0x186458(0x207)](_0x186458(0x247),_0x4080bc);let _0x5d7bcf=_0x186458(0x205);switch(_0x4080bc[_0x186458(0x233)]?.[_0x186458(0x213)]()){case _0x186458(0x22b):_0x5d7bcf=_0x186458(0x22d);break;case'cancelled':case _0x186458(0x209):case _0x186458(0x1f9):_0x5d7bcf='FAILED';break;case'expired':case'timeout':_0x5d7bcf=_0x186458(0x1e2);break;case _0x186458(0x1d5):case _0x186458(0x21a):case _0x186458(0x1fe):case _0x186458(0x23e):default:_0x5d7bcf=_0x186458(0x205);break;}return{'paymentId':_0x4080bc['order_id']||_0x4080bc[_0x186458(0x1d6)]||'','status':_0x5d7bcf,'amount':_0x4080bc[_0x186458(0x1f6)],'currency':_0x4080bc[_0x186458(0x1df)]||_0x186458(0x1ef)};}}function a40_0x2f4c(_0x442aef,_0x4c47f4){const _0x346c35=a40_0x346c();return a40_0x2f4c=function(_0x2f4cce,_0x149794){_0x2f4cce=_0x2f4cce-0x1c9;let _0x1b0b3a=_0x346c35[_0x2f4cce];return _0x1b0b3a;},a40_0x2f4c(_0x442aef,_0x4c47f4);}exports[a40_0x53d7cd(0x23a)]=CoinToPayService;