'use strict';const a49_0x91ef08=a49_0x54c4;(function(_0x3d1f6a,_0x43630c){const _0x261277=a49_0x54c4,_0x14165f=_0x3d1f6a();while(!![]){try{const _0x3e4179=parseInt(_0x261277(0x195))/0x1+parseInt(_0x261277(0x1ea))/0x2*(parseInt(_0x261277(0x1e0))/0x3)+-parseInt(_0x261277(0x1e7))/0x4*(parseInt(_0x261277(0x217))/0x5)+-parseInt(_0x261277(0x1ae))/0x6+-parseInt(_0x261277(0x1ce))/0x7*(-parseInt(_0x261277(0x1c4))/0x8)+-parseInt(_0x261277(0x1a5))/0x9+-parseInt(_0x261277(0x200))/0xa;if(_0x3e4179===_0x43630c)break;else _0x14165f['push'](_0x14165f['shift']());}catch(_0x122d9f){_0x14165f['push'](_0x14165f['shift']());}}}(a49_0x28b9,0x1cefe));function a49_0x54c4(_0x3a8e72,_0xa2537d){const _0x28b990=a49_0x28b9();return a49_0x54c4=function(_0x54c421,_0x1703ff){_0x54c421=_0x54c421-0x194;let _0x206fb8=_0x28b990[_0x54c421];return _0x206fb8;},a49_0x54c4(_0x3a8e72,_0xa2537d);}Object['defineProperty'](exports,a49_0x91ef08(0x1d9),{'value':!![]}),exports[a49_0x91ef08(0x19b)]=void 0x0;const loggerService_1=require(a49_0x91ef08(0x1b7));class CoinToPayService{constructor(){const _0x5a1e55=a49_0x91ef08;this[_0x5a1e55(0x1fe)]=_0x5a1e55(0x213),this[_0x5a1e55(0x215)]=_0x5a1e55(0x1b0),console[_0x5a1e55(0x1ee)](_0x5a1e55(0x20f)),console[_0x5a1e55(0x1ee)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async[a49_0x91ef08(0x1ba)](_0x4ee381){const _0x5eb770=a49_0x91ef08,{orderId:_0x1e4048,amount:_0x2c86bc}=_0x4ee381;console[_0x5eb770(0x1ee)](_0x5eb770(0x205)+_0x2c86bc+_0x5eb770(0x1dc));const _0x4ed91d={'amount':_0x2c86bc},_0x4535ec=Date[_0x5eb770(0x1ef)]();try{console[_0x5eb770(0x1ee)](_0x5eb770(0x204)),console[_0x5eb770(0x1ee)](_0x5eb770(0x216),this[_0x5eb770(0x1fe)]),console[_0x5eb770(0x1ee)](_0x5eb770(0x19a),JSON[_0x5eb770(0x197)](_0x4ed91d,null,0x2)),console[_0x5eb770(0x1ee)](_0x5eb770(0x1c9),_0x2c86bc,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x5eb770(0x1a2)](_0x5eb770(0x1a8),'/create',_0x5eb770(0x1eb),_0x4ed91d);const _0x5023e5=await fetch(this[_0x5eb770(0x1fe)],{'method':_0x5eb770(0x1eb),'headers':{'Content-Type':_0x5eb770(0x1f1),'Accept':_0x5eb770(0x1f1),'User-Agent':_0x5eb770(0x1c8)},'body':JSON[_0x5eb770(0x197)](_0x4ed91d)}),_0x3f8a8c=Date[_0x5eb770(0x1ef)]()-_0x4535ec;console[_0x5eb770(0x1ee)](_0x5eb770(0x1bf)),console[_0x5eb770(0x1ee)](_0x5eb770(0x1e9),_0x5023e5[_0x5eb770(0x1ac)]),console[_0x5eb770(0x1ee)]('Status\x20Text:',_0x5023e5[_0x5eb770(0x1b8)]),console[_0x5eb770(0x1ee)](_0x5eb770(0x1f0),Object[_0x5eb770(0x1d0)](_0x5023e5[_0x5eb770(0x1d8)][_0x5eb770(0x209)]())),console[_0x5eb770(0x1ee)](_0x5eb770(0x1c0),_0x3f8a8c+'ms');const _0x367925=await _0x5023e5['text']();console[_0x5eb770(0x1ee)]('Raw\x20Response\x20Body:',_0x367925);if(!_0x5023e5['ok']){console['error'](_0x5eb770(0x1cd)),console['error']('HTTP\x20Status:',_0x5023e5[_0x5eb770(0x1ac)]),console[_0x5eb770(0x19d)](_0x5eb770(0x1fb),_0x367925),loggerService_1[_0x5eb770(0x1a1)]['logWhiteDomainResponse'](_0x5eb770(0x1a8),'/create',_0x5023e5[_0x5eb770(0x1ac)],_0x367925,_0x3f8a8c),loggerService_1[_0x5eb770(0x1a1)][_0x5eb770(0x211)](_0x5eb770(0x1a8),_0x5eb770(0x1f4),_0x5eb770(0x1aa)+_0x5023e5[_0x5eb770(0x1ac)]+':\x20'+_0x367925);throw new Error(_0x5eb770(0x196)+_0x5023e5[_0x5eb770(0x1ac)]+',\x20body:\x20'+_0x367925);}let _0x260bca;try{_0x260bca=JSON[_0x5eb770(0x19f)](_0x367925);}catch(_0x163052){console[_0x5eb770(0x19d)](_0x5eb770(0x1ff),_0x163052),loggerService_1[_0x5eb770(0x1a1)][_0x5eb770(0x211)](_0x5eb770(0x1a8),'/create',_0x5eb770(0x1b5)+_0x163052);throw new Error(_0x5eb770(0x20b)+_0x367925);}console[_0x5eb770(0x1ee)](_0x5eb770(0x1e2)),console[_0x5eb770(0x1ee)]('Parsed\x20Result:',JSON['stringify'](_0x260bca,null,0x2)),loggerService_1['loggerService'][_0x5eb770(0x1f6)]('cointopay',_0x5eb770(0x1f4),_0x5023e5[_0x5eb770(0x1ac)],_0x260bca,_0x3f8a8c);if(_0x260bca['error']){const _0x5effd8=_0x260bca['message']||_0x260bca[_0x5eb770(0x19d)]||_0x5eb770(0x1bb);console[_0x5eb770(0x19d)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x5eb770(0x207),_0x5effd8),loggerService_1['loggerService'][_0x5eb770(0x211)](_0x5eb770(0x1a8),'/create',_0x5eb770(0x210)+_0x5effd8);throw new Error(_0x5eb770(0x1c7)+_0x5effd8);}if(!_0x260bca[_0x5eb770(0x1b6)]||!_0x260bca[_0x5eb770(0x1f3)]){console[_0x5eb770(0x19d)](_0x5eb770(0x1e6)),console[_0x5eb770(0x19d)](_0x5eb770(0x1df)),console[_0x5eb770(0x19d)](_0x5eb770(0x1ec),_0x260bca),loggerService_1[_0x5eb770(0x1a1)][_0x5eb770(0x211)](_0x5eb770(0x1a8),'/create',_0x5eb770(0x1d1));throw new Error(_0x5eb770(0x1e3));}console[_0x5eb770(0x1ee)](_0x5eb770(0x1ed)),console[_0x5eb770(0x1ee)]('Gateway\x20Payment\x20ID:',_0x260bca[_0x5eb770(0x1f3)]),console[_0x5eb770(0x1ee)](_0x5eb770(0x1e5),_0x260bca['payment_url']);const _0x4e6412=_0x260bca[_0x5eb770(0x1b6)]+_0x5eb770(0x20d);return console[_0x5eb770(0x1ee)](_0x5eb770(0x1cf),_0x4e6412),console[_0x5eb770(0x1ee)](_0x5eb770(0x1c9),_0x2c86bc,_0x5eb770(0x19e)),{'gateway_payment_id':_0x260bca[_0x5eb770(0x1f3)],'payment_url':_0x4e6412};}catch(_0x3bb09f){console[_0x5eb770(0x19d)](_0x5eb770(0x1b1)),console[_0x5eb770(0x19d)](_0x5eb770(0x1a3),_0x3bb09f),loggerService_1[_0x5eb770(0x1a1)][_0x5eb770(0x211)](_0x5eb770(0x1a8),'/create',_0x3bb09f);if(_0x3bb09f instanceof Error){console[_0x5eb770(0x19d)](_0x5eb770(0x1be),_0x3bb09f[_0x5eb770(0x1ad)]),console[_0x5eb770(0x19d)]('Error\x20stack:',_0x3bb09f[_0x5eb770(0x1a9)]);throw new Error(_0x5eb770(0x1b3)+_0x3bb09f['message']);}throw new Error(_0x5eb770(0x1fa));}}async[a49_0x91ef08(0x1f9)](_0x1e0d10){const _0x5cb685=a49_0x91ef08,_0x4aca20=Date[_0x5cb685(0x1ef)]();try{console[_0x5cb685(0x1ee)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x1e0d10);const _0x3ad94b={'gatewayPaymentId':_0x1e0d10};loggerService_1[_0x5cb685(0x1a1)][_0x5cb685(0x1a2)](_0x5cb685(0x1a8),_0x5cb685(0x1f8),'POST',_0x3ad94b);const _0x50f97f=await fetch(this[_0x5cb685(0x215)],{'method':_0x5cb685(0x1eb),'headers':{'Content-Type':_0x5cb685(0x1f1),'Accept':_0x5cb685(0x1f1),'User-Agent':_0x5cb685(0x1c8)},'body':JSON[_0x5cb685(0x197)](_0x3ad94b)}),_0x2db3db=Date[_0x5cb685(0x1ef)]()-_0x4aca20;console[_0x5cb685(0x1ee)](_0x5cb685(0x1de)),console['log']('Status:',_0x50f97f[_0x5cb685(0x1ac)]),console[_0x5cb685(0x1ee)](_0x5cb685(0x1c0),_0x2db3db+'ms');if(!_0x50f97f['ok']){const _0x16482b=await _0x50f97f[_0x5cb685(0x1d5)]();console[_0x5cb685(0x19d)]('HTTP\x20Status:',_0x50f97f[_0x5cb685(0x1ac)]),console['error'](_0x5cb685(0x1fb),_0x16482b),loggerService_1[_0x5cb685(0x1a1)]['logWhiteDomainResponse'](_0x5cb685(0x1a8),_0x5cb685(0x1f8),_0x50f97f[_0x5cb685(0x1ac)],_0x16482b,_0x2db3db),loggerService_1['loggerService'][_0x5cb685(0x211)](_0x5cb685(0x1a8),'/status',_0x5cb685(0x1aa)+_0x50f97f[_0x5cb685(0x1ac)]+':\x20'+_0x16482b);throw new Error(_0x5cb685(0x196)+_0x50f97f[_0x5cb685(0x1ac)]);}const _0x49abc8=await _0x50f97f['text']();console[_0x5cb685(0x1ee)](_0x5cb685(0x1f2),_0x49abc8);let _0x3cd2cc;try{_0x3cd2cc=JSON[_0x5cb685(0x19f)](_0x49abc8);}catch(_0xbbffa1){console['error'](_0x5cb685(0x1ff),_0xbbffa1),loggerService_1[_0x5cb685(0x1a1)]['logWhiteDomainError'](_0x5cb685(0x1a8),_0x5cb685(0x1f8),_0x5cb685(0x1b5)+_0xbbffa1);throw new Error(_0x5cb685(0x198)+_0x49abc8);}loggerService_1[_0x5cb685(0x1a1)][_0x5cb685(0x1f6)](_0x5cb685(0x1a8),_0x5cb685(0x1f8),_0x50f97f[_0x5cb685(0x1ac)],_0x3cd2cc,_0x2db3db),console[_0x5cb685(0x1ee)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x5cb685(0x1c2),_0x3cd2cc[_0x5cb685(0x1dd)]),console[_0x5cb685(0x1ee)](_0x5cb685(0x1a7),_0x3cd2cc[_0x5cb685(0x214)]),console['log'](_0x5cb685(0x1ca),_0x3cd2cc['data']?.[_0x5cb685(0x1af)]),console['log'](_0x5cb685(0x1c9),_0x3cd2cc['data']?.[_0x5cb685(0x1c6)]),console[_0x5cb685(0x1ee)]('Currency:',_0x3cd2cc[_0x5cb685(0x208)]?.['inputCurrency']);if(_0x3cd2cc['result']!=='success'||_0x3cd2cc[_0x5cb685(0x214)]!==0xc8){const _0xcca2a2=_0x3cd2cc[_0x5cb685(0x1ad)]||_0x5cb685(0x1bd);console[_0x5cb685(0x19d)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5cb685(0x19d)](_0x5cb685(0x207),_0xcca2a2),loggerService_1[_0x5cb685(0x1a1)][_0x5cb685(0x211)](_0x5cb685(0x1a8),'/status',_0x5cb685(0x1e1)+_0xcca2a2);throw new Error(_0x5cb685(0x1c5)+_0xcca2a2);}if(!_0x3cd2cc['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x5cb685(0x19d)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5cb685(0x1a1)][_0x5cb685(0x211)](_0x5cb685(0x1a8),'/status',_0x5cb685(0x1c3));throw new Error(_0x5cb685(0x199));}let _0x971b3b='PENDING';switch(_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1af)]?.[_0x5cb685(0x1e4)]()){case _0x5cb685(0x1b2):_0x971b3b=_0x5cb685(0x1e8);break;case _0x5cb685(0x1f5):case'failed':case _0x5cb685(0x19d):_0x971b3b='FAILED';break;case _0x5cb685(0x1da):case'timeout':_0x971b3b=_0x5cb685(0x201);break;case _0x5cb685(0x1f7):case _0x5cb685(0x203):case _0x5cb685(0x1b9):case'created':default:_0x971b3b=_0x5cb685(0x1b4);break;}let _0x12395d,_0x4d3742;if(_0x3cd2cc['data'][_0x5cb685(0x212)]){const _0x353ece=_0x3cd2cc['data']['PaymentDetail'];console[_0x5cb685(0x1ee)](_0x5cb685(0x1d3),_0x353ece);const _0x2c27a8=_0x353ece[_0x5cb685(0x1bc)](/IBAN\s+([A-Z0-9]+)/i);_0x2c27a8&&(_0x12395d=_0x2c27a8[0x1],console[_0x5cb685(0x1ee)]('🏦\x20Extracted\x20IBAN:',_0x12395d)),_0x4d3742=_0x353ece;}const _0x429d5e={'iban':_0x12395d,'bankDetails':_0x4d3742,'transactionId':_0x3cd2cc['data'][_0x5cb685(0x20c)],'coinAddress':_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1db)],'qrCodeUrl':_0x3cd2cc[_0x5cb685(0x208)]['QRCodeURL'],'expiryTime':_0x3cd2cc[_0x5cb685(0x208)]['ExpiryTime'],'createdOn':_0x3cd2cc['data'][_0x5cb685(0x206)],'confirmedOn':_0x3cd2cc['data'][_0x5cb685(0x1c1)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5cb685(0x1ee)](_0x5cb685(0x1e9),_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1af)],'->',_0x971b3b),console['log']('Amount:',_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1c6)],_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1cb)]),console[_0x5cb685(0x1ee)](_0x5cb685(0x1ab),_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x20c)]),console['log'](_0x5cb685(0x20e),_0x12395d||'not\x20found'),console[_0x5cb685(0x1ee)](_0x5cb685(0x1cc),_0x3cd2cc['data'][_0x5cb685(0x206)]),console[_0x5cb685(0x1ee)](_0x5cb685(0x1fc),_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1c1)]||'not\x20confirmed');if(_0x3cd2cc[_0x5cb685(0x208)]['Status']?.[_0x5cb685(0x1e4)]()==='awaiting\x20fiat')console[_0x5cb685(0x1ee)](_0x5cb685(0x1a6));else _0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1af)]?.[_0x5cb685(0x1e4)]()===_0x5cb685(0x1b2)&&console[_0x5cb685(0x1ee)](_0x5cb685(0x194));return{'status':_0x971b3b,'amount':parseFloat(_0x3cd2cc[_0x5cb685(0x208)][_0x5cb685(0x1c6)])||undefined,'currency':_0x3cd2cc[_0x5cb685(0x208)]['inputCurrency']||_0x5cb685(0x19e),'paymentDetails':_0x429d5e};}catch(_0x50c5be){console[_0x5cb685(0x19d)](_0x5cb685(0x218),_0x50c5be),loggerService_1[_0x5cb685(0x1a1)][_0x5cb685(0x211)](_0x5cb685(0x1a8),_0x5cb685(0x1f8),_0x50c5be);throw new Error(_0x5cb685(0x1d2)+(_0x50c5be instanceof Error?_0x50c5be[_0x5cb685(0x1ad)]:_0x5cb685(0x1fd)));}}async[a49_0x91ef08(0x20a)](_0x3040c0){const _0x29d8c4=a49_0x91ef08,_0x1c5623=await this['checkPaymentStatus'](_0x3040c0);return{'status':_0x1c5623[_0x29d8c4(0x1ac)],'amount':_0x1c5623['amount'],'currency':_0x1c5623['currency']};}async['processWebhook'](_0x38b750){const _0x364427=a49_0x91ef08;console[_0x364427(0x1ee)](_0x364427(0x1a4),_0x38b750);let _0x4d4c92=_0x364427(0x1b4);switch(_0x38b750[_0x364427(0x1ac)]?.[_0x364427(0x1e4)]()){case'paid':_0x4d4c92=_0x364427(0x1e8);break;case'cancelled':case _0x364427(0x19c):case _0x364427(0x19d):_0x4d4c92=_0x364427(0x202);break;case _0x364427(0x1da):case'timeout':_0x4d4c92=_0x364427(0x201);break;case _0x364427(0x1b9):case _0x364427(0x1f7):case _0x364427(0x203):case _0x364427(0x1d7):default:_0x4d4c92=_0x364427(0x1b4);break;}return{'paymentId':_0x38b750[_0x364427(0x1d6)]||_0x38b750[_0x364427(0x1a0)]||'','status':_0x4d4c92,'amount':_0x38b750['amount'],'currency':_0x38b750[_0x364427(0x1d4)]||_0x364427(0x19e)};}}exports[a49_0x91ef08(0x19b)]=CoinToPayService;function a49_0x28b9(){const _0x4532d5=['7vRhgwo','Payment\x20URL\x20(modified):','fromEntries','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','🏦\x20Payment\x20Detail:','currency','text','order_id','created','headers','__esModule','expired','coinAddress','\x20EUR','result','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','6qBqbwA','Status\x20API\x20Error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','toLowerCase','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','2408HtSCZH','PAID','Status:','209394zwFYCv','POST','Response\x20data:','===\x20COINTOPAY\x20SUCCESS\x20===','log','now','Headers:','application/json','Raw\x20Response\x20Body:','gateway_payment_id','/create','cancelled','logWhiteDomainResponse','waiting','/status','checkPaymentStatus','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20Body:','Confirmed\x20On:','Unknown\x20error','apiUrl','Failed\x20to\x20parse\x20JSON\x20response:','1823500WhzCBD','EXPIRED','FAILED','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','🪙\x20Creating\x20CoinToPay\x20payment:\x20','CreatedOn','Error\x20Message:','data','entries','verifyPayment','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','TransactionID','&alternative=false','IBAN:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Business\x20Error:\x20','logWhiteDomainError','PaymentDetail','https://tesoft.uk/gateway/cointopay/','status_code','statusUrl','URL:','1065MrYgMJ','CoinToPay\x20payment\x20status\x20check\x20error:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','225296jGdrqa','HTTP\x20error!\x20status:\x20','stringify','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Request\x20Body:','CoinToPayService','failed','error','EUR','parse','merchant_reference_id','loggerService','logWhiteDomainRequest','Error\x20details:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','61821izpOOD','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status\x20Code:','cointopay','stack','HTTP\x20','Transaction\x20ID:','status','message','837180GlMsiS','Status','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','paid','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','PENDING','JSON\x20Parse\x20Error:\x20','payment_url','../loggerService','statusText','pending','createPaymentLink','Unknown\x20error\x20from\x20CoinToPay\x20API','match','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20message:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Response\x20Time:','TransactionConfirmedOn','Result:','Incomplete\x20response:\x20missing\x20data','1126488ZLoTDL','CoinToPay\x20status\x20API\x20error:\x20','Amount','CoinToPay\x20API\x20error:\x20','Payment\x20System/1.0','Amount:','Payment\x20Status:','inputCurrency','Created\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20==='];a49_0x28b9=function(){return _0x4532d5;};return a49_0x28b9();}