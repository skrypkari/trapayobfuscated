'use strict';const a38_0x38ac62=a38_0x3650;(function(_0x377567,_0x208edb){const _0x412697=a38_0x3650,_0x8616f3=_0x377567();while(!![]){try{const _0x5d0004=parseInt(_0x412697(0x10f))/0x1*(parseInt(_0x412697(0x14a))/0x2)+-parseInt(_0x412697(0x16e))/0x3*(-parseInt(_0x412697(0x13e))/0x4)+parseInt(_0x412697(0x13c))/0x5*(parseInt(_0x412697(0x180))/0x6)+-parseInt(_0x412697(0x127))/0x7*(parseInt(_0x412697(0x137))/0x8)+parseInt(_0x412697(0x157))/0x9+parseInt(_0x412697(0x16c))/0xa+-parseInt(_0x412697(0x156))/0xb*(parseInt(_0x412697(0x123))/0xc);if(_0x5d0004===_0x208edb)break;else _0x8616f3['push'](_0x8616f3['shift']());}catch(_0x555203){_0x8616f3['push'](_0x8616f3['shift']());}}}(a38_0x45e7,0xdf082));Object['defineProperty'](exports,a38_0x38ac62(0x13b),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x38ac62(0x131));function a38_0x45e7(){const _0x3edf7e=['match','currency','3252780ctTZUn','Request\x20Body:','TransactionID','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','8386lmDpXK','HTTP\x20error!\x20status:\x20','now','status','cancelled','HTTP\x20Status:','Status\x20Text:','Status\x20Code:','toLowerCase','checkPaymentStatus','../loggerService','log','apiUrl','failed','logWhiteDomainError','Raw\x20Response\x20Body:','8648JCtrCv','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','createPaymentLink','Parsed\x20Result:','__esModule','775KKWDHo',',\x20body:\x20','4uWKlmw','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','parse','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','entries','not\x20found','Response\x20Time:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','text','created','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','2bLjWSc','https://tesoft.uk/gateway/cointopay/status.php','cointopay','order_id','Failed\x20to\x20parse\x20JSON\x20response:','message','POST','processWebhook','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','status_code','QRCodeURL','/status','110dZTgTJ','7126668NMcFmP','CoinToPay\x20payment\x20status\x20check\x20error:','CoinToPay\x20API\x20error:\x20','inputCurrency','Status:','statusText','===\x20COINTOPAY\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','gateway_payment_id','PAID','fromEntries','PaymentDetail','logWhiteDomainResponse','merchant_reference_id','expired','Amount:','CreatedOn','error','coinAddress','amount','9694020koyeNq','JSON\x20Parse\x20Error:\x20','2847234iSnfBJ','IBAN:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Payment\x20Status:','Result:','paid','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','loggerService','waiting','Payment\x20URL:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainRequest','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','headers','33570CTnSWf','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Created\x20On:','Response\x20data:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','stack','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','ExpiryTime','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Headers:','Error\x20message:','Response\x20Body:','Error\x20Message:','EXPIRED','verifyPayment','pending','üìä\x20Status\x20check\x20URL:','Error\x20stack:','EUR','Error\x20details:','Confirmed\x20On:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Business\x20Error:\x20','statusUrl','üè¶\x20Payment\x20Detail:','\x20EUR','data','1341669zdPNbt','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','awaiting\x20fiat','stringify','/create','URL:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20SUCCESS\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','payment_url','Unknown\x20error','TesSoft\x20Payment\x20System/1.0','application/json','FAILED','CoinToPay\x20status\x20API\x20error:\x20'];a38_0x45e7=function(){return _0x3edf7e;};return a38_0x45e7();}function a38_0x3650(_0x4fa293,_0xa34456){const _0x45e7f6=a38_0x45e7();return a38_0x3650=function(_0x36504d,_0x438dc2){_0x36504d=_0x36504d-0xf8;let _0xa6002d=_0x45e7f6[_0x36504d];return _0xa6002d;},a38_0x3650(_0x4fa293,_0xa34456);}class CoinToPayService{constructor(){const _0x28ec59=a38_0x38ac62;this[_0x28ec59(0x133)]='https://tesoft.uk/gateway/cointopay/',this[_0x28ec59(0x10b)]=_0x28ec59(0x14b),console['log'](_0x28ec59(0x181)),console[_0x28ec59(0x132)](_0x28ec59(0x104),this[_0x28ec59(0x10b)]);}async[a38_0x38ac62(0x139)](_0x329b05){const _0x588ca5=a38_0x38ac62,{orderId:_0x5f2279,amount:_0x20bcb9}=_0x329b05;console[_0x588ca5(0x132)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x20bcb9+_0x588ca5(0x10d));const _0x53d09f={'amount':_0x20bcb9},_0x399dd6=Date[_0x588ca5(0x129)]();try{console[_0x588ca5(0x132)](_0x588ca5(0x118)),console[_0x588ca5(0x132)](_0x588ca5(0x117),this[_0x588ca5(0x133)]),console[_0x588ca5(0x132)](_0x588ca5(0x124),JSON[_0x588ca5(0x115)](_0x53d09f,null,0x2)),console[_0x588ca5(0x132)](_0x588ca5(0x167),_0x20bcb9,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x588ca5(0x177)][_0x588ca5(0x17d)](_0x588ca5(0x14c),_0x588ca5(0x116),_0x588ca5(0x150),_0x53d09f);const _0x49fd4a=await fetch(this[_0x588ca5(0x133)],{'method':'POST','headers':{'Content-Type':_0x588ca5(0x11e),'Accept':_0x588ca5(0x11e),'User-Agent':_0x588ca5(0x11d)},'body':JSON['stringify'](_0x53d09f)}),_0x38196c=Date[_0x588ca5(0x129)]()-_0x399dd6;console[_0x588ca5(0x132)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x588ca5(0x132)](_0x588ca5(0x15b),_0x49fd4a['status']),console['log'](_0x588ca5(0x12d),_0x49fd4a[_0x588ca5(0x15c)]),console['log'](_0x588ca5(0xfd),Object[_0x588ca5(0x162)](_0x49fd4a[_0x588ca5(0x17f)][_0x588ca5(0x143)]())),console[_0x588ca5(0x132)](_0x588ca5(0x145),_0x38196c+'ms');const _0x50650f=await _0x49fd4a[_0x588ca5(0x147)]();console[_0x588ca5(0x132)](_0x588ca5(0x136),_0x50650f);if(!_0x49fd4a['ok']){console[_0x588ca5(0x169)](_0x588ca5(0x15d)),console[_0x588ca5(0x169)](_0x588ca5(0x12c),_0x49fd4a[_0x588ca5(0x12a)]),console['error']('Response\x20Body:',_0x50650f),loggerService_1[_0x588ca5(0x177)]['logWhiteDomainResponse'](_0x588ca5(0x14c),_0x588ca5(0x116),_0x49fd4a['status'],_0x50650f,_0x38196c),loggerService_1[_0x588ca5(0x177)]['logWhiteDomainError'](_0x588ca5(0x14c),'/create','HTTP\x20'+_0x49fd4a['status']+':\x20'+_0x50650f);throw new Error(_0x588ca5(0x128)+_0x49fd4a['status']+_0x588ca5(0x13d)+_0x50650f);}let _0x145429;try{_0x145429=JSON[_0x588ca5(0x140)](_0x50650f);}catch(_0x570b41){console['error'](_0x588ca5(0x14e),_0x570b41),loggerService_1[_0x588ca5(0x177)][_0x588ca5(0x135)](_0x588ca5(0x14c),_0x588ca5(0x116),_0x588ca5(0x16d)+_0x570b41);throw new Error(_0x588ca5(0x17a)+_0x50650f);}console[_0x588ca5(0x132)](_0x588ca5(0xfa)),console[_0x588ca5(0x132)](_0x588ca5(0x13a),JSON[_0x588ca5(0x115)](_0x145429,null,0x2)),loggerService_1['loggerService'][_0x588ca5(0x164)](_0x588ca5(0x14c),_0x588ca5(0x116),_0x49fd4a[_0x588ca5(0x12a)],_0x145429,_0x38196c);if(_0x145429['error']){const _0x3c9c6f=_0x145429['message']||_0x145429[_0x588ca5(0x169)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x588ca5(0x175)),console[_0x588ca5(0x169)](_0x588ca5(0x100),_0x3c9c6f),loggerService_1['loggerService'][_0x588ca5(0x135)](_0x588ca5(0x14c),'/create',_0x588ca5(0x10a)+_0x3c9c6f);throw new Error(_0x588ca5(0x159)+_0x3c9c6f);}if(!_0x145429[_0x588ca5(0x11b)]||!_0x145429[_0x588ca5(0x160)]){console[_0x588ca5(0x169)](_0x588ca5(0x15f)),console['error'](_0x588ca5(0x149)),console[_0x588ca5(0x169)](_0x588ca5(0x183),_0x145429),loggerService_1[_0x588ca5(0x177)]['logWhiteDomainError']('cointopay',_0x588ca5(0x116),_0x588ca5(0x110));throw new Error(_0x588ca5(0xfc));}return console[_0x588ca5(0x132)](_0x588ca5(0x119)),console['log'](_0x588ca5(0x141),_0x145429['gateway_payment_id']),console['log'](_0x588ca5(0x179),_0x145429[_0x588ca5(0x11b)]),console['log'](_0x588ca5(0x167),_0x20bcb9,'EUR'),{'gateway_payment_id':_0x145429[_0x588ca5(0x160)],'payment_url':_0x145429['payment_url']};}catch(_0x2fab2a){console['error'](_0x588ca5(0x17c)),console[_0x588ca5(0x169)](_0x588ca5(0x107),_0x2fab2a),loggerService_1['loggerService']['logWhiteDomainError'](_0x588ca5(0x14c),_0x588ca5(0x116),_0x2fab2a);if(_0x2fab2a instanceof Error){console[_0x588ca5(0x169)](_0x588ca5(0xfe),_0x2fab2a[_0x588ca5(0x14f)]),console[_0x588ca5(0x169)](_0x588ca5(0x105),_0x2fab2a[_0x588ca5(0xf9)]);throw new Error(_0x588ca5(0x13f)+_0x2fab2a[_0x588ca5(0x14f)]);}throw new Error(_0x588ca5(0x170));}}async[a38_0x38ac62(0x130)](_0x43a7ab){const _0x1edd1d=a38_0x38ac62,_0x20dcdb=Date['now']();try{console[_0x1edd1d(0x132)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x43a7ab);const _0x38a630={'gatewayPaymentId':_0x43a7ab};loggerService_1[_0x1edd1d(0x177)][_0x1edd1d(0x17d)](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x1edd1d(0x150),_0x38a630);const _0x21dc10=await fetch(this[_0x1edd1d(0x10b)],{'method':'POST','headers':{'Content-Type':_0x1edd1d(0x11e),'Accept':_0x1edd1d(0x11e),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x38a630)}),_0x4bdcf7=Date['now']()-_0x20dcdb;console[_0x1edd1d(0x132)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1edd1d(0x132)](_0x1edd1d(0x15b),_0x21dc10[_0x1edd1d(0x12a)]),console['log'](_0x1edd1d(0x145),_0x4bdcf7+'ms');if(!_0x21dc10['ok']){const _0x1f9128=await _0x21dc10[_0x1edd1d(0x147)]();console[_0x1edd1d(0x169)](_0x1edd1d(0x12c),_0x21dc10[_0x1edd1d(0x12a)]),console[_0x1edd1d(0x169)](_0x1edd1d(0xff),_0x1f9128),loggerService_1['loggerService'][_0x1edd1d(0x164)](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x21dc10[_0x1edd1d(0x12a)],_0x1f9128,_0x4bdcf7),loggerService_1[_0x1edd1d(0x177)]['logWhiteDomainError'](_0x1edd1d(0x14c),_0x1edd1d(0x155),'HTTP\x20'+_0x21dc10[_0x1edd1d(0x12a)]+':\x20'+_0x1f9128);throw new Error(_0x1edd1d(0x128)+_0x21dc10[_0x1edd1d(0x12a)]);}const _0x1d8ecd=await _0x21dc10[_0x1edd1d(0x147)]();console[_0x1edd1d(0x132)]('Raw\x20Response\x20Body:',_0x1d8ecd);let _0x195452;try{_0x195452=JSON[_0x1edd1d(0x140)](_0x1d8ecd);}catch(_0x960f9f){console[_0x1edd1d(0x169)](_0x1edd1d(0x14e),_0x960f9f),loggerService_1[_0x1edd1d(0x177)][_0x1edd1d(0x135)](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x1edd1d(0x16d)+_0x960f9f);throw new Error(_0x1edd1d(0x126)+_0x1d8ecd);}loggerService_1[_0x1edd1d(0x177)][_0x1edd1d(0x164)](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x21dc10[_0x1edd1d(0x12a)],_0x195452,_0x4bdcf7),console[_0x1edd1d(0x132)](_0x1edd1d(0x138)),console[_0x1edd1d(0x132)](_0x1edd1d(0x172),_0x195452['result']),console['log'](_0x1edd1d(0x12e),_0x195452['status_code']),console[_0x1edd1d(0x132)](_0x1edd1d(0x171),_0x195452[_0x1edd1d(0x10e)]?.[_0x1edd1d(0x111)]),console[_0x1edd1d(0x132)](_0x1edd1d(0x167),_0x195452[_0x1edd1d(0x10e)]?.['Amount']),console[_0x1edd1d(0x132)]('Currency:',_0x195452['data']?.[_0x1edd1d(0x15a)]);if(_0x195452['result']!=='success'||_0x195452[_0x1edd1d(0x153)]!==0xc8){const _0x5667c1=_0x195452[_0x1edd1d(0x14f)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x1edd1d(0x113)),console[_0x1edd1d(0x169)](_0x1edd1d(0x100),_0x5667c1),loggerService_1[_0x1edd1d(0x177)][_0x1edd1d(0x135)]('cointopay',_0x1edd1d(0x155),'Status\x20API\x20Error:\x20'+_0x5667c1);throw new Error(_0x1edd1d(0x120)+_0x5667c1);}if(!_0x195452[_0x1edd1d(0x10e)]){console[_0x1edd1d(0x169)](_0x1edd1d(0x142)),console[_0x1edd1d(0x169)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x1edd1d(0x177)]['logWhiteDomainError'](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x1edd1d(0x15e));throw new Error(_0x1edd1d(0x152));}let _0x5f0587=_0x1edd1d(0x176);switch(_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x111)]?.[_0x1edd1d(0x12f)]()){case'paid':_0x5f0587=_0x1edd1d(0x161);break;case'cancelled':case _0x1edd1d(0x134):case _0x1edd1d(0x169):_0x5f0587=_0x1edd1d(0x11f);break;case _0x1edd1d(0x166):case'timeout':_0x5f0587=_0x1edd1d(0x101);break;case _0x1edd1d(0x178):case _0x1edd1d(0x114):case _0x1edd1d(0x103):case _0x1edd1d(0x148):default:_0x5f0587=_0x1edd1d(0x176);break;}let _0x2731cc,_0x47b8bd;if(_0x195452['data'][_0x1edd1d(0x163)]){const _0x3fcac1=_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x163)];console[_0x1edd1d(0x132)](_0x1edd1d(0x10c),_0x3fcac1);const _0xc7fdc0=_0x3fcac1[_0x1edd1d(0x121)](/IBAN\s+([A-Z0-9]+)/i);_0xc7fdc0&&(_0x2731cc=_0xc7fdc0[0x1],console[_0x1edd1d(0x132)](_0x1edd1d(0x17b),_0x2731cc)),_0x47b8bd=_0x3fcac1;}const _0xdc2181={'iban':_0x2731cc,'bankDetails':_0x47b8bd,'transactionId':_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x125)],'coinAddress':_0x195452['data'][_0x1edd1d(0x16a)],'qrCodeUrl':_0x195452['data'][_0x1edd1d(0x154)],'expiryTime':_0x195452['data'][_0x1edd1d(0xfb)],'createdOn':_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x168)],'confirmedOn':_0x195452['data']['TransactionConfirmedOn']};console['log'](_0x1edd1d(0x146)),console[_0x1edd1d(0x132)]('Status:',_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x111)],'->',_0x5f0587),console[_0x1edd1d(0x132)](_0x1edd1d(0x167),_0x195452[_0x1edd1d(0x10e)]['Amount'],_0x195452['data']['inputCurrency']),console[_0x1edd1d(0x132)](_0x1edd1d(0x174),_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x125)]),console['log'](_0x1edd1d(0x16f),_0x2731cc||_0x1edd1d(0x144)),console[_0x1edd1d(0x132)](_0x1edd1d(0x182),_0x195452[_0x1edd1d(0x10e)][_0x1edd1d(0x168)]),console[_0x1edd1d(0x132)](_0x1edd1d(0x108),_0x195452[_0x1edd1d(0x10e)]['TransactionConfirmedOn']||_0x1edd1d(0x112));if(_0x195452['data'][_0x1edd1d(0x111)]?.[_0x1edd1d(0x12f)]()===_0x1edd1d(0x114))console[_0x1edd1d(0x132)](_0x1edd1d(0x17e));else _0x195452['data'][_0x1edd1d(0x111)]?.[_0x1edd1d(0x12f)]()==='paid'&&console['log'](_0x1edd1d(0x11a));return{'status':_0x5f0587,'amount':parseFloat(_0x195452[_0x1edd1d(0x10e)]['Amount'])||undefined,'currency':_0x195452['data']['inputCurrency']||_0x1edd1d(0x106),'paymentDetails':_0xdc2181};}catch(_0x111409){console[_0x1edd1d(0x169)](_0x1edd1d(0x158),_0x111409),loggerService_1['loggerService'][_0x1edd1d(0x135)](_0x1edd1d(0x14c),_0x1edd1d(0x155),_0x111409);throw new Error(_0x1edd1d(0x109)+(_0x111409 instanceof Error?_0x111409[_0x1edd1d(0x14f)]:_0x1edd1d(0x11c)));}}async[a38_0x38ac62(0x102)](_0x5b367c){const _0xac166c=a38_0x38ac62,_0x58ef96=await this[_0xac166c(0x130)](_0x5b367c);return{'status':_0x58ef96[_0xac166c(0x12a)],'amount':_0x58ef96[_0xac166c(0x16b)],'currency':_0x58ef96['currency']};}async[a38_0x38ac62(0x151)](_0x29f610){const _0x1bbac9=a38_0x38ac62;console['log'](_0x1bbac9(0xf8),_0x29f610);let _0x4dfcdc=_0x1bbac9(0x176);switch(_0x29f610[_0x1bbac9(0x12a)]?.[_0x1bbac9(0x12f)]()){case _0x1bbac9(0x173):_0x4dfcdc=_0x1bbac9(0x161);break;case _0x1bbac9(0x12b):case _0x1bbac9(0x134):case _0x1bbac9(0x169):_0x4dfcdc=_0x1bbac9(0x11f);break;case'expired':case'timeout':_0x4dfcdc=_0x1bbac9(0x101);break;case _0x1bbac9(0x103):case _0x1bbac9(0x178):case'awaiting\x20fiat':case'created':default:_0x4dfcdc=_0x1bbac9(0x176);break;}return{'paymentId':_0x29f610[_0x1bbac9(0x14d)]||_0x29f610[_0x1bbac9(0x165)]||'','status':_0x4dfcdc,'amount':_0x29f610[_0x1bbac9(0x16b)],'currency':_0x29f610[_0x1bbac9(0x122)]||_0x1bbac9(0x106)};}}exports['CoinToPayService']=CoinToPayService;