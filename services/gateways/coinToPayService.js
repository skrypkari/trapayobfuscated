'use strict';function a40_0x234a(_0x126ab6,_0x64c165){const _0x1d3480=a40_0x1d34();return a40_0x234a=function(_0x234aa8,_0x4b9e46){_0x234aa8=_0x234aa8-0xbf;let _0x3fe7a3=_0x1d3480[_0x234aa8];return _0x3fe7a3;},a40_0x234a(_0x126ab6,_0x64c165);}const a40_0x180947=a40_0x234a;function a40_0x1d34(){const _0x2a2d68=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','timeout','logWhiteDomainError','Error\x20Message:','now','not\x20found','apiUrl','FAILED','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','2613681GZjTWO','defineProperty','PENDING','text','order_id',',\x20body:\x20','gateway_payment_id','logWhiteDomainRequest','coinAddress','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','12791120FWFNZR','Currency:','paid','Result:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','/status','Status\x20Text:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Error\x20stack:','headers','Headers:','EUR','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','6531800feakkS','EXPIRED','Payment\x20Status:','amount','awaiting\x20fiat','Status:','createPaymentLink','Status\x20Code:','Unknown\x20error','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Incomplete\x20response:\x20missing\x20data','369879NFAsEC','currency','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status','PAID','payment_url','2064558aMBqga','ExpiryTime','Response\x20Body:','\x20EUR','checkPaymentStatus','Parsed\x20Result:','QRCodeURL','not\x20confirmed','toLowerCase','Failed\x20to\x20parse\x20JSON\x20response:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','11bnIQvu','91148DMhJfJ','loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','statusUrl','Response\x20data:','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/cointopay/status.php','cointopay','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','2lQGEim','üè¶\x20Extracted\x20IBAN:','Error\x20message:','TransactionConfirmedOn','Created\x20On:','__esModule','expired','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','CoinToPayService','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/create','entries','TesSoft\x20Payment\x20System/1.0','HTTP\x20error!\x20status:\x20','CoinToPay\x20status\x20API\x20error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','31847QGNUQt','TransactionID','merchant_reference_id','success','pending','parse','data','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','inputCurrency','üè¶\x20Payment\x20Detail:','IBAN:','Amount:','Amount','215ojhVVQ','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20SUCCESS\x20===','PaymentDetail','verifyPayment','Request\x20Body:','Confirmed\x20On:','statusText','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Error\x20details:','cancelled','HTTP\x20Status:','Response\x20Time:','POST','failed','Gateway\x20Payment\x20ID:','HTTP\x20','Status\x20API\x20Error:\x20','../loggerService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','result','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','URL:','CreatedOn','stringify','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','üìä\x20Status\x20check\x20URL:','status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','log','message','status_code','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','21CwfJuC'];a40_0x1d34=function(){return _0x2a2d68;};return a40_0x1d34();}(function(_0x479ab8,_0x5045b6){const _0xd49c4f=a40_0x234a,_0x6c526f=_0x479ab8();while(!![]){try{const _0xed3cc9=-parseInt(_0xd49c4f(0x11f))/0x1*(-parseInt(_0xd49c4f(0x109))/0x2)+-parseInt(_0xd49c4f(0xee))/0x3+parseInt(_0xd49c4f(0x100))/0x4*(parseInt(_0xd49c4f(0x12d))/0x5)+parseInt(_0xd49c4f(0xf4))/0x6*(-parseInt(_0xd49c4f(0xc0))/0x7)+-parseInt(_0xd49c4f(0xe3))/0x8+parseInt(_0xd49c4f(0xca))/0x9+parseInt(_0xd49c4f(0xd4))/0xa*(parseInt(_0xd49c4f(0xff))/0xb);if(_0xed3cc9===_0x5045b6)break;else _0x6c526f['push'](_0x6c526f['shift']());}catch(_0x5f249e){_0x6c526f['push'](_0x6c526f['shift']());}}}(a40_0x1d34,0x94b8a));Object[a40_0x180947(0xcb)](exports,a40_0x180947(0x10e),{'value':!![]}),exports[a40_0x180947(0x112)]=void 0x0;const loggerService_1=require(a40_0x180947(0x13f));class CoinToPayService{constructor(){const _0x2f72d8=a40_0x180947;this[_0x2f72d8(0xc7)]=_0x2f72d8(0x113),this[_0x2f72d8(0x103)]=_0x2f72d8(0x106),console[_0x2f72d8(0x14a)](_0x2f72d8(0xc9)),console[_0x2f72d8(0x14a)](_0x2f72d8(0x147),this[_0x2f72d8(0x103)]);}async[a40_0x180947(0xe9)](_0xd0adc6){const _0x516a70=a40_0x180947,{orderId:_0x25db8a,amount:_0x4473b9}=_0xd0adc6;console[_0x516a70(0x14a)](_0x516a70(0x111)+_0x4473b9+_0x516a70(0xf7));const _0x5d8c52={'amount':_0x4473b9},_0x131b33=Date['now']();try{console[_0x516a70(0x14a)](_0x516a70(0xd3)),console['log'](_0x516a70(0x143),this['apiUrl']),console[_0x516a70(0x14a)](_0x516a70(0x132),JSON[_0x516a70(0x145)](_0x5d8c52,null,0x2)),console['log']('Amount:',_0x4473b9,_0x516a70(0xfe)),loggerService_1[_0x516a70(0x101)]['logWhiteDomainRequest']('cointopay','/create',_0x516a70(0x13a),_0x5d8c52);const _0x56aadc=await fetch(this[_0x516a70(0xc7)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x516a70(0x117)},'body':JSON[_0x516a70(0x145)](_0x5d8c52)}),_0x5dc865=Date[_0x516a70(0xc5)]()-_0x131b33;console[_0x516a70(0x14a)](_0x516a70(0x11c)),console[_0x516a70(0x14a)](_0x516a70(0xe8),_0x56aadc[_0x516a70(0x148)]),console['log'](_0x516a70(0xdc),_0x56aadc[_0x516a70(0x134)]),console[_0x516a70(0x14a)](_0x516a70(0xe0),Object['fromEntries'](_0x56aadc[_0x516a70(0xdf)][_0x516a70(0x116)]())),console[_0x516a70(0x14a)](_0x516a70(0x139),_0x5dc865+'ms');const _0x1c2faa=await _0x56aadc[_0x516a70(0xcd)]();console[_0x516a70(0x14a)](_0x516a70(0x105),_0x1c2faa);if(!_0x56aadc['ok']){console[_0x516a70(0x11b)](_0x516a70(0xdd)),console[_0x516a70(0x11b)](_0x516a70(0x138),_0x56aadc['status']),console[_0x516a70(0x11b)](_0x516a70(0xf6),_0x1c2faa),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x516a70(0x107),_0x516a70(0x115),_0x56aadc[_0x516a70(0x148)],_0x1c2faa,_0x5dc865),loggerService_1[_0x516a70(0x101)]['logWhiteDomainError'](_0x516a70(0x107),_0x516a70(0x115),_0x516a70(0x13d)+_0x56aadc[_0x516a70(0x148)]+':\x20'+_0x1c2faa);throw new Error(_0x516a70(0x118)+_0x56aadc[_0x516a70(0x148)]+_0x516a70(0xcf)+_0x1c2faa);}let _0x36be11;try{_0x36be11=JSON[_0x516a70(0x124)](_0x1c2faa);}catch(_0x1a4a17){console[_0x516a70(0x11b)](_0x516a70(0xfd),_0x1a4a17),loggerService_1[_0x516a70(0x101)]['logWhiteDomainError'](_0x516a70(0x107),_0x516a70(0x115),_0x516a70(0x127)+_0x1a4a17);throw new Error(_0x516a70(0xc1)+_0x1c2faa);}console[_0x516a70(0x14a)](_0x516a70(0x126)),console[_0x516a70(0x14a)](_0x516a70(0xf9),JSON[_0x516a70(0x145)](_0x36be11,null,0x2)),loggerService_1[_0x516a70(0x101)][_0x516a70(0x11d)](_0x516a70(0x107),_0x516a70(0x115),_0x56aadc['status'],_0x36be11,_0x5dc865);if(_0x36be11[_0x516a70(0x11b)]){const _0x5e4c74=_0x36be11[_0x516a70(0x14b)]||_0x36be11[_0x516a70(0x11b)]||_0x516a70(0x11a);console[_0x516a70(0x11b)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x5e4c74),loggerService_1[_0x516a70(0x101)][_0x516a70(0xc3)](_0x516a70(0x107),_0x516a70(0x115),'Business\x20Error:\x20'+_0x5e4c74);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5e4c74);}if(!_0x36be11[_0x516a70(0xf3)]||!_0x36be11[_0x516a70(0xd0)]){console[_0x516a70(0x11b)](_0x516a70(0x11e)),console[_0x516a70(0x11b)](_0x516a70(0x12e)),console['error'](_0x516a70(0x104),_0x36be11),loggerService_1[_0x516a70(0x101)][_0x516a70(0xc3)](_0x516a70(0x107),_0x516a70(0x115),_0x516a70(0x149));throw new Error(_0x516a70(0xe2));}return console['log'](_0x516a70(0x12f)),console[_0x516a70(0x14a)](_0x516a70(0x13c),_0x36be11['gateway_payment_id']),console[_0x516a70(0x14a)]('Payment\x20URL:',_0x36be11[_0x516a70(0xf3)]),console[_0x516a70(0x14a)](_0x516a70(0x12b),_0x4473b9,_0x516a70(0xe1)),{'gateway_payment_id':_0x36be11['gateway_payment_id'],'payment_url':_0x36be11[_0x516a70(0xf3)]};}catch(_0x19cc3d){console[_0x516a70(0x11b)](_0x516a70(0x142)),console[_0x516a70(0x11b)](_0x516a70(0x136),_0x19cc3d),loggerService_1[_0x516a70(0x101)]['logWhiteDomainError']('cointopay',_0x516a70(0x115),_0x19cc3d);if(_0x19cc3d instanceof Error){console[_0x516a70(0x11b)](_0x516a70(0x10b),_0x19cc3d['message']),console['error'](_0x516a70(0xde),_0x19cc3d['stack']);throw new Error(_0x516a70(0xec)+_0x19cc3d[_0x516a70(0x14b)]);}throw new Error(_0x516a70(0x102));}}async[a40_0x180947(0xf8)](_0x4573c0){const _0x52968f=a40_0x180947,_0x491387=Date[_0x52968f(0xc5)]();try{console['log'](_0x52968f(0xf0)+_0x4573c0);const _0x267e38={'gatewayPaymentId':_0x4573c0};loggerService_1['loggerService'][_0x52968f(0xd1)](_0x52968f(0x107),_0x52968f(0xdb),_0x52968f(0x13a),_0x267e38);const _0x4caf3b=await fetch(this[_0x52968f(0x103)],{'method':_0x52968f(0x13a),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x52968f(0x117)},'body':JSON[_0x52968f(0x145)](_0x267e38)}),_0x1e1ae4=Date['now']()-_0x491387;console[_0x52968f(0x14a)](_0x52968f(0x135)),console['log'](_0x52968f(0xe8),_0x4caf3b['status']),console[_0x52968f(0x14a)](_0x52968f(0x139),_0x1e1ae4+'ms');if(!_0x4caf3b['ok']){const _0x468ce1=await _0x4caf3b[_0x52968f(0xcd)]();console[_0x52968f(0x11b)](_0x52968f(0x138),_0x4caf3b[_0x52968f(0x148)]),console[_0x52968f(0x11b)](_0x52968f(0xf6),_0x468ce1),loggerService_1[_0x52968f(0x101)][_0x52968f(0x11d)](_0x52968f(0x107),_0x52968f(0xdb),_0x4caf3b[_0x52968f(0x148)],_0x468ce1,_0x1e1ae4),loggerService_1[_0x52968f(0x101)][_0x52968f(0xc3)]('cointopay',_0x52968f(0xdb),'HTTP\x20'+_0x4caf3b['status']+':\x20'+_0x468ce1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4caf3b[_0x52968f(0x148)]);}const _0x4ab489=await _0x4caf3b[_0x52968f(0xcd)]();console['log']('Raw\x20Response\x20Body:',_0x4ab489);let _0x39d3c9;try{_0x39d3c9=JSON['parse'](_0x4ab489);}catch(_0x3bd75b){console[_0x52968f(0x11b)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3bd75b),loggerService_1[_0x52968f(0x101)]['logWhiteDomainError']('cointopay',_0x52968f(0xdb),_0x52968f(0x127)+_0x3bd75b);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4ab489);}loggerService_1[_0x52968f(0x101)][_0x52968f(0x11d)](_0x52968f(0x107),'/status',_0x4caf3b[_0x52968f(0x148)],_0x39d3c9,_0x1e1ae4),console[_0x52968f(0x14a)](_0x52968f(0xd9)),console[_0x52968f(0x14a)](_0x52968f(0xd7),_0x39d3c9['result']),console['log'](_0x52968f(0xea),_0x39d3c9[_0x52968f(0x14c)]),console[_0x52968f(0x14a)](_0x52968f(0xe5),_0x39d3c9['data']?.[_0x52968f(0xf1)]),console[_0x52968f(0x14a)]('Amount:',_0x39d3c9[_0x52968f(0x125)]?.['Amount']),console[_0x52968f(0x14a)](_0x52968f(0xd5),_0x39d3c9[_0x52968f(0x125)]?.[_0x52968f(0x128)]);if(_0x39d3c9[_0x52968f(0x141)]!==_0x52968f(0x122)||_0x39d3c9[_0x52968f(0x14c)]!==0xc8){const _0x2bb87a=_0x39d3c9[_0x52968f(0x14b)]||_0x52968f(0x140);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x52968f(0xc4),_0x2bb87a),loggerService_1[_0x52968f(0x101)][_0x52968f(0xc3)]('cointopay','/status',_0x52968f(0x13e)+_0x2bb87a);throw new Error(_0x52968f(0x119)+_0x2bb87a);}if(!_0x39d3c9[_0x52968f(0x125)]){console['error'](_0x52968f(0x114)),console['error'](_0x52968f(0xda)),loggerService_1[_0x52968f(0x101)]['logWhiteDomainError'](_0x52968f(0x107),_0x52968f(0xdb),_0x52968f(0xed));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x53edc5=_0x52968f(0xcc);switch(_0x39d3c9[_0x52968f(0x125)]['Status']?.['toLowerCase']()){case _0x52968f(0xd6):_0x53edc5=_0x52968f(0xf2);break;case _0x52968f(0x137):case'failed':case _0x52968f(0x11b):_0x53edc5='FAILED';break;case _0x52968f(0x10f):case _0x52968f(0xc2):_0x53edc5='EXPIRED';break;case'waiting':case _0x52968f(0xe7):case _0x52968f(0x123):case'created':default:_0x53edc5='PENDING';break;}let _0xcfc490,_0x9909bc;if(_0x39d3c9['data'][_0x52968f(0x130)]){const _0x58b075=_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x130)];console['log'](_0x52968f(0x129),_0x58b075);const _0x2306d3=_0x58b075['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2306d3&&(_0xcfc490=_0x2306d3[0x1],console[_0x52968f(0x14a)](_0x52968f(0x10a),_0xcfc490)),_0x9909bc=_0x58b075;}const _0x327897={'iban':_0xcfc490,'bankDetails':_0x9909bc,'transactionId':_0x39d3c9['data'][_0x52968f(0x120)],'coinAddress':_0x39d3c9[_0x52968f(0x125)][_0x52968f(0xd2)],'qrCodeUrl':_0x39d3c9[_0x52968f(0x125)][_0x52968f(0xfa)],'expiryTime':_0x39d3c9[_0x52968f(0x125)][_0x52968f(0xf5)],'createdOn':_0x39d3c9[_0x52968f(0x125)]['CreatedOn'],'confirmedOn':_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x10c)]};console['log'](_0x52968f(0x110)),console[_0x52968f(0x14a)]('Status:',_0x39d3c9[_0x52968f(0x125)]['Status'],'->',_0x53edc5),console[_0x52968f(0x14a)]('Amount:',_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x12c)],_0x39d3c9[_0x52968f(0x125)]['inputCurrency']),console[_0x52968f(0x14a)]('Transaction\x20ID:',_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x120)]),console[_0x52968f(0x14a)](_0x52968f(0x12a),_0xcfc490||_0x52968f(0xc6)),console[_0x52968f(0x14a)](_0x52968f(0x10d),_0x39d3c9['data'][_0x52968f(0x144)]),console[_0x52968f(0x14a)](_0x52968f(0x133),_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x10c)]||_0x52968f(0xfb));if(_0x39d3c9[_0x52968f(0x125)][_0x52968f(0xf1)]?.[_0x52968f(0xfc)]()===_0x52968f(0xe7))console['log'](_0x52968f(0x146));else _0x39d3c9[_0x52968f(0x125)][_0x52968f(0xf1)]?.[_0x52968f(0xfc)]()===_0x52968f(0xd6)&&console[_0x52968f(0x14a)](_0x52968f(0xbf));return{'status':_0x53edc5,'amount':parseFloat(_0x39d3c9[_0x52968f(0x125)]['Amount'])||undefined,'currency':_0x39d3c9[_0x52968f(0x125)][_0x52968f(0x128)]||'EUR','paymentDetails':_0x327897};}catch(_0x4f2522){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4f2522),loggerService_1[_0x52968f(0x101)][_0x52968f(0xc3)](_0x52968f(0x107),_0x52968f(0xdb),_0x4f2522);throw new Error(_0x52968f(0x108)+(_0x4f2522 instanceof Error?_0x4f2522[_0x52968f(0x14b)]:_0x52968f(0xeb)));}}async[a40_0x180947(0x131)](_0x29b219){const _0x26d3a7=a40_0x180947,_0x431402=await this['checkPaymentStatus'](_0x29b219);return{'status':_0x431402[_0x26d3a7(0x148)],'amount':_0x431402[_0x26d3a7(0xe6)],'currency':_0x431402['currency']};}async['processWebhook'](_0x580a9e){const _0x57740f=a40_0x180947;console[_0x57740f(0x14a)](_0x57740f(0xd8),_0x580a9e);let _0x2e430a=_0x57740f(0xcc);switch(_0x580a9e[_0x57740f(0x148)]?.[_0x57740f(0xfc)]()){case _0x57740f(0xd6):_0x2e430a=_0x57740f(0xf2);break;case _0x57740f(0x137):case _0x57740f(0x13b):case _0x57740f(0x11b):_0x2e430a=_0x57740f(0xc8);break;case _0x57740f(0x10f):case _0x57740f(0xc2):_0x2e430a=_0x57740f(0xe4);break;case _0x57740f(0x123):case'waiting':case _0x57740f(0xe7):case'created':default:_0x2e430a=_0x57740f(0xcc);break;}return{'paymentId':_0x580a9e[_0x57740f(0xce)]||_0x580a9e[_0x57740f(0x121)]||'','status':_0x2e430a,'amount':_0x580a9e[_0x57740f(0xe6)],'currency':_0x580a9e[_0x57740f(0xef)]||_0x57740f(0xe1)};}}exports['CoinToPayService']=CoinToPayService;