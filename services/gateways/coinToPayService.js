'use strict';const a40_0x378b38=a40_0x17a2;(function(_0x497887,_0x535362){const _0x54fcb=a40_0x17a2,_0x40b8fa=_0x497887();while(!![]){try{const _0x243649=parseInt(_0x54fcb(0x1a5))/0x1+parseInt(_0x54fcb(0x1a1))/0x2+-parseInt(_0x54fcb(0x1bb))/0x3*(-parseInt(_0x54fcb(0x1b0))/0x4)+-parseInt(_0x54fcb(0x18a))/0x5+-parseInt(_0x54fcb(0x1b5))/0x6+-parseInt(_0x54fcb(0x1cf))/0x7*(parseInt(_0x54fcb(0x182))/0x8)+-parseInt(_0x54fcb(0x184))/0x9*(parseInt(_0x54fcb(0x1be))/0xa);if(_0x243649===_0x535362)break;else _0x40b8fa['push'](_0x40b8fa['shift']());}catch(_0x336876){_0x40b8fa['push'](_0x40b8fa['shift']());}}}(a40_0x371f,0x28b86));function a40_0x17a2(_0x2755a5,_0xa8f398){const _0x371fe4=a40_0x371f();return a40_0x17a2=function(_0x17a292,_0x26e457){_0x17a292=_0x17a292-0x17e;let _0x61cda4=_0x371fe4[_0x17a292];return _0x61cda4;},a40_0x17a2(_0x2755a5,_0xa8f398);}Object['defineProperty'](exports,a40_0x378b38(0x1ef),{'value':!![]}),exports[a40_0x378b38(0x1cd)]=void 0x0;const loggerService_1=require(a40_0x378b38(0x18e));class CoinToPayService{constructor(){const _0x4f31db=a40_0x378b38;this[_0x4f31db(0x1ba)]='https://tesoft.uk/gateway/cointopay/',this[_0x4f31db(0x196)]=_0x4f31db(0x1df),console[_0x4f31db(0x1ea)](_0x4f31db(0x19a)),console['log'](_0x4f31db(0x18d),this['statusUrl']);}async[a40_0x378b38(0x1ff)](_0x258dc7){const _0x43e260=a40_0x378b38,{orderId:_0x4aea86,amount:_0x5e12bc}=_0x258dc7;console[_0x43e260(0x1ea)](_0x43e260(0x1fe)+_0x5e12bc+_0x43e260(0x1d7));const _0x37cf48={'amount':_0x5e12bc},_0xb0edc=Date[_0x43e260(0x1de)]();try{console[_0x43e260(0x1ea)](_0x43e260(0x1d3)),console[_0x43e260(0x1ea)]('URL:',this['apiUrl']),console[_0x43e260(0x1ea)]('Request\x20Body:',JSON[_0x43e260(0x1f6)](_0x37cf48,null,0x2)),console[_0x43e260(0x1ea)](_0x43e260(0x1c5),_0x5e12bc,_0x43e260(0x19e)),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x193)](_0x43e260(0x1f1),_0x43e260(0x1e2),_0x43e260(0x1f0),_0x37cf48);const _0x138e06=await fetch(this['apiUrl'],{'method':_0x43e260(0x1f0),'headers':{'Content-Type':_0x43e260(0x1bc),'Accept':'application/json','User-Agent':_0x43e260(0x197)},'body':JSON[_0x43e260(0x1f6)](_0x37cf48)}),_0x4ed668=Date[_0x43e260(0x1de)]()-_0xb0edc;console[_0x43e260(0x1ea)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x43e260(0x1ea)]('Status:',_0x138e06[_0x43e260(0x1c0)]),console['log'](_0x43e260(0x1f9),_0x138e06['statusText']),console[_0x43e260(0x1ea)](_0x43e260(0x1f5),Object[_0x43e260(0x1d9)](_0x138e06['headers'][_0x43e260(0x1ab)]())),console[_0x43e260(0x1ea)]('Response\x20Time:',_0x4ed668+'ms');const _0x437f9e=await _0x138e06[_0x43e260(0x1c8)]();console['log']('Raw\x20Response\x20Body:',_0x437f9e);if(!_0x138e06['ok']){console[_0x43e260(0x1a2)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x43e260(0x1a8),_0x138e06[_0x43e260(0x1c0)]),console[_0x43e260(0x1a2)]('Response\x20Body:',_0x437f9e),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1f4)]('cointopay',_0x43e260(0x1e2),_0x138e06[_0x43e260(0x1c0)],_0x437f9e,_0x4ed668),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1ac)](_0x43e260(0x1f1),_0x43e260(0x1e2),_0x43e260(0x1ed)+_0x138e06[_0x43e260(0x1c0)]+':\x20'+_0x437f9e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x138e06[_0x43e260(0x1c0)]+_0x43e260(0x181)+_0x437f9e);}let _0x3c39f0;try{_0x3c39f0=JSON['parse'](_0x437f9e);}catch(_0x8f7f4f){console[_0x43e260(0x1a2)](_0x43e260(0x1d0),_0x8f7f4f),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1ac)](_0x43e260(0x1f1),_0x43e260(0x1e2),_0x43e260(0x1b6)+_0x8f7f4f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x437f9e);}console[_0x43e260(0x1ea)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x43e260(0x188),JSON[_0x43e260(0x1f6)](_0x3c39f0,null,0x2)),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1f4)]('cointopay',_0x43e260(0x1e2),_0x138e06[_0x43e260(0x1c0)],_0x3c39f0,_0x4ed668);if(_0x3c39f0['error']){const _0x403398=_0x3c39f0[_0x43e260(0x1ca)]||_0x3c39f0[_0x43e260(0x1a2)]||_0x43e260(0x1c7);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x43e260(0x1a2)](_0x43e260(0x195),_0x403398),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1ac)](_0x43e260(0x1f1),_0x43e260(0x1e2),_0x43e260(0x1b4)+_0x403398);throw new Error(_0x43e260(0x1db)+_0x403398);}if(!_0x3c39f0['payment_url']||!_0x3c39f0[_0x43e260(0x1e8)]){console[_0x43e260(0x1a2)](_0x43e260(0x1b1)),console[_0x43e260(0x1a2)](_0x43e260(0x1d1)),console['error'](_0x43e260(0x191),_0x3c39f0),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1ac)](_0x43e260(0x1f1),_0x43e260(0x1e2),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x43e260(0x1fb));}return console[_0x43e260(0x1ea)](_0x43e260(0x1d8)),console[_0x43e260(0x1ea)]('Gateway\x20Payment\x20ID:',_0x3c39f0[_0x43e260(0x1e8)]),console['log']('Payment\x20URL:',_0x3c39f0[_0x43e260(0x1dc)]),console[_0x43e260(0x1ea)](_0x43e260(0x1c5),_0x5e12bc,_0x43e260(0x1f3)),{'gateway_payment_id':_0x3c39f0[_0x43e260(0x1e8)],'payment_url':_0x3c39f0['payment_url']};}catch(_0x4b925e){console[_0x43e260(0x1a2)](_0x43e260(0x1a9)),console['error'](_0x43e260(0x1e7),_0x4b925e),loggerService_1[_0x43e260(0x1b8)][_0x43e260(0x1ac)]('cointopay',_0x43e260(0x1e2),_0x4b925e);if(_0x4b925e instanceof Error){console[_0x43e260(0x1a2)](_0x43e260(0x194),_0x4b925e[_0x43e260(0x1ca)]),console[_0x43e260(0x1a2)](_0x43e260(0x18b),_0x4b925e[_0x43e260(0x1fc)]);throw new Error(_0x43e260(0x198)+_0x4b925e[_0x43e260(0x1ca)]);}throw new Error(_0x43e260(0x19f));}}async[a40_0x378b38(0x186)](_0x468f9b){const _0x598402=a40_0x378b38,_0x15c540=Date[_0x598402(0x1de)]();try{console[_0x598402(0x1ea)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x468f9b);const _0x66af86={'gatewayPaymentId':_0x468f9b};loggerService_1[_0x598402(0x1b8)][_0x598402(0x193)](_0x598402(0x1f1),_0x598402(0x1e0),_0x598402(0x1f0),_0x66af86);const _0x463d91=await fetch(this[_0x598402(0x196)],{'method':_0x598402(0x1f0),'headers':{'Content-Type':_0x598402(0x1bc),'Accept':'application/json','User-Agent':_0x598402(0x197)},'body':JSON[_0x598402(0x1f6)](_0x66af86)}),_0x5dc7f5=Date[_0x598402(0x1de)]()-_0x15c540;console['log'](_0x598402(0x1bd)),console['log']('Status:',_0x463d91[_0x598402(0x1c0)]),console[_0x598402(0x1ea)](_0x598402(0x200),_0x5dc7f5+'ms');if(!_0x463d91['ok']){const _0x1ac3a8=await _0x463d91[_0x598402(0x1c8)]();console[_0x598402(0x1a2)](_0x598402(0x1a8),_0x463d91[_0x598402(0x1c0)]),console[_0x598402(0x1a2)]('Response\x20Body:',_0x1ac3a8),loggerService_1['loggerService'][_0x598402(0x1f4)](_0x598402(0x1f1),_0x598402(0x1e0),_0x463d91[_0x598402(0x1c0)],_0x1ac3a8,_0x5dc7f5),loggerService_1[_0x598402(0x1b8)][_0x598402(0x1ac)]('cointopay',_0x598402(0x1e0),'HTTP\x20'+_0x463d91[_0x598402(0x1c0)]+':\x20'+_0x1ac3a8);throw new Error(_0x598402(0x1aa)+_0x463d91[_0x598402(0x1c0)]);}const _0x2e84b2=await _0x463d91[_0x598402(0x1c8)]();console[_0x598402(0x1ea)](_0x598402(0x1ae),_0x2e84b2);let _0x408cf7;try{_0x408cf7=JSON[_0x598402(0x199)](_0x2e84b2);}catch(_0x4f7eb8){console[_0x598402(0x1a2)](_0x598402(0x1d0),_0x4f7eb8),loggerService_1[_0x598402(0x1b8)]['logWhiteDomainError'](_0x598402(0x1f1),'/status','JSON\x20Parse\x20Error:\x20'+_0x4f7eb8);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x2e84b2);}loggerService_1[_0x598402(0x1b8)][_0x598402(0x1f4)]('cointopay',_0x598402(0x1e0),_0x463d91[_0x598402(0x1c0)],_0x408cf7,_0x5dc7f5),console[_0x598402(0x1ea)](_0x598402(0x1a6)),console[_0x598402(0x1ea)](_0x598402(0x1d2),_0x408cf7[_0x598402(0x1e5)]),console['log'](_0x598402(0x1d6),_0x408cf7['status_code']),console[_0x598402(0x1ea)](_0x598402(0x1fa),_0x408cf7[_0x598402(0x1ad)]?.[_0x598402(0x189)]),console['log']('Amount:',_0x408cf7[_0x598402(0x1ad)]?.[_0x598402(0x1da)]),console[_0x598402(0x1ea)](_0x598402(0x1c6),_0x408cf7[_0x598402(0x1ad)]?.[_0x598402(0x17e)]);if(_0x408cf7['result']!==_0x598402(0x18c)||_0x408cf7['status_code']!==0xc8){const _0x1e636e=_0x408cf7[_0x598402(0x1ca)]||_0x598402(0x1fd);console['error'](_0x598402(0x1b9)),console[_0x598402(0x1a2)](_0x598402(0x195),_0x1e636e),loggerService_1['loggerService'][_0x598402(0x1ac)](_0x598402(0x1f1),'/status',_0x598402(0x1ee)+_0x1e636e);throw new Error(_0x598402(0x201)+_0x1e636e);}if(!_0x408cf7[_0x598402(0x1ad)]){console[_0x598402(0x1a2)](_0x598402(0x19b)),console[_0x598402(0x1a2)](_0x598402(0x192)),loggerService_1[_0x598402(0x1b8)][_0x598402(0x1ac)](_0x598402(0x1f1),'/status',_0x598402(0x1c4));throw new Error(_0x598402(0x1c2));}let _0x3a065a=_0x598402(0x1c3);switch(_0x408cf7[_0x598402(0x1ad)][_0x598402(0x189)]?.[_0x598402(0x1e1)]()){case _0x598402(0x1a0):_0x3a065a=_0x598402(0x183);break;case _0x598402(0x1ec):case'failed':case'error':_0x3a065a=_0x598402(0x1af);break;case _0x598402(0x1eb):case'timeout':_0x3a065a='EXPIRED';break;case'waiting':case _0x598402(0x19c):case _0x598402(0x1b2):case _0x598402(0x187):default:_0x3a065a='PENDING';break;}let _0x222635,_0x21614d;if(_0x408cf7[_0x598402(0x1ad)][_0x598402(0x1c9)]){const _0x1fa7b2=_0x408cf7[_0x598402(0x1ad)]['PaymentDetail'];console[_0x598402(0x1ea)](_0x598402(0x1f2),_0x1fa7b2);const _0x2ddad3=_0x1fa7b2['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2ddad3&&(_0x222635=_0x2ddad3[0x1],console[_0x598402(0x1ea)](_0x598402(0x1f8),_0x222635)),_0x21614d=_0x1fa7b2;}const _0x100a8f={'iban':_0x222635,'bankDetails':_0x21614d,'transactionId':_0x408cf7[_0x598402(0x1ad)]['TransactionID'],'coinAddress':_0x408cf7[_0x598402(0x1ad)][_0x598402(0x180)],'qrCodeUrl':_0x408cf7[_0x598402(0x1ad)][_0x598402(0x1bf)],'expiryTime':_0x408cf7['data'][_0x598402(0x1e6)],'createdOn':_0x408cf7[_0x598402(0x1ad)]['CreatedOn'],'confirmedOn':_0x408cf7['data']['TransactionConfirmedOn']};console['log'](_0x598402(0x1a7)),console[_0x598402(0x1ea)](_0x598402(0x1d4),_0x408cf7['data'][_0x598402(0x189)],'->',_0x3a065a),console[_0x598402(0x1ea)]('Amount:',_0x408cf7['data'][_0x598402(0x1da)],_0x408cf7['data'][_0x598402(0x17e)]),console['log'](_0x598402(0x1a3),_0x408cf7[_0x598402(0x1ad)][_0x598402(0x17f)]),console['log']('IBAN:',_0x222635||_0x598402(0x1dd)),console[_0x598402(0x1ea)]('Created\x20On:',_0x408cf7[_0x598402(0x1ad)][_0x598402(0x1cb)]),console[_0x598402(0x1ea)](_0x598402(0x1c1),_0x408cf7['data'][_0x598402(0x1d5)]||_0x598402(0x18f));if(_0x408cf7[_0x598402(0x1ad)][_0x598402(0x189)]?.['toLowerCase']()===_0x598402(0x19c))console[_0x598402(0x1ea)](_0x598402(0x1b7));else _0x408cf7[_0x598402(0x1ad)]['Status']?.['toLowerCase']()===_0x598402(0x1a0)&&console[_0x598402(0x1ea)](_0x598402(0x1cc));return{'status':_0x3a065a,'amount':parseFloat(_0x408cf7['data'][_0x598402(0x1da)])||undefined,'currency':_0x408cf7['data'][_0x598402(0x17e)]||'EUR','paymentDetails':_0x100a8f};}catch(_0x2064bc){console[_0x598402(0x1a2)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x2064bc),loggerService_1[_0x598402(0x1b8)][_0x598402(0x1ac)](_0x598402(0x1f1),_0x598402(0x1e0),_0x2064bc);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2064bc instanceof Error?_0x2064bc['message']:'Unknown\x20error'));}}async['verifyPayment'](_0x435e8d){const _0x4a9b22=a40_0x378b38,_0x557358=await this[_0x4a9b22(0x186)](_0x435e8d);return{'status':_0x557358[_0x4a9b22(0x1c0)],'amount':_0x557358[_0x4a9b22(0x1e9)],'currency':_0x557358[_0x4a9b22(0x1ce)]};}async[a40_0x378b38(0x190)](_0x31ae26){const _0x49172c=a40_0x378b38;console[_0x49172c(0x1ea)](_0x49172c(0x1e3),_0x31ae26);let _0xe6f4f8=_0x49172c(0x1c3);switch(_0x31ae26[_0x49172c(0x1c0)]?.['toLowerCase']()){case _0x49172c(0x1a0):_0xe6f4f8=_0x49172c(0x183);break;case _0x49172c(0x1ec):case _0x49172c(0x1f7):case _0x49172c(0x1a2):_0xe6f4f8='FAILED';break;case'expired':case _0x49172c(0x1b3):_0xe6f4f8=_0x49172c(0x19d);break;case _0x49172c(0x1b2):case _0x49172c(0x185):case _0x49172c(0x19c):case _0x49172c(0x187):default:_0xe6f4f8=_0x49172c(0x1c3);break;}return{'paymentId':_0x31ae26[_0x49172c(0x1e4)]||_0x31ae26[_0x49172c(0x1a4)]||'','status':_0xe6f4f8,'amount':_0x31ae26[_0x49172c(0x1e9)],'currency':_0x31ae26[_0x49172c(0x1ce)]||_0x49172c(0x1f3)};}}exports[a40_0x378b38(0x1cd)]=CoinToPayService;function a40_0x371f(){const _0x24f696=['===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','EXPIRED','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','paid','322504fIflRh','error','Transaction\x20ID:','merchant_reference_id','236563jVjWix','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','HTTP\x20Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','HTTP\x20error!\x20status:\x20','entries','logWhiteDomainError','data','Raw\x20Response\x20Body:','FAILED','4MWsltr','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','pending','timeout','Business\x20Error:\x20','1246728pkmCoo','JSON\x20Parse\x20Error:\x20','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','loggerService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','apiUrl','953949YGbdML','application/json','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','27590GyDxmx','QRCodeURL','status','Confirmed\x20On:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','PENDING','Incomplete\x20response:\x20missing\x20data','Amount:','Currency:','Unknown\x20error\x20from\x20CoinToPay\x20API','text','PaymentDetail','message','CreatedOn','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPayService','currency','285712QqKplV','Failed\x20to\x20parse\x20JSON\x20response:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Result:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status:','TransactionConfirmedOn','Status\x20Code:','\x20EUR','===\x20COINTOPAY\x20SUCCESS\x20===','fromEntries','Amount','CoinToPay\x20API\x20error:\x20','payment_url','not\x20found','now','https://tesoft.uk/gateway/cointopay/status.php','/status','toLowerCase','/create','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','order_id','result','ExpiryTime','Error\x20details:','gateway_payment_id','amount','log','expired','cancelled','HTTP\x20','Status\x20API\x20Error:\x20','__esModule','POST','cointopay','🏦\x20Payment\x20Detail:','EUR','logWhiteDomainResponse','Headers:','stringify','failed','🏦\x20Extracted\x20IBAN:','Status\x20Text:','Payment\x20Status:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','stack','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','🪙\x20Creating\x20CoinToPay\x20payment:\x20','createPaymentLink','Response\x20Time:','CoinToPay\x20status\x20API\x20error:\x20','inputCurrency','TransactionID','coinAddress',',\x20body:\x20','8xefiku','PAID','216mxuWhJ','waiting','checkPaymentStatus','created','Parsed\x20Result:','Status','1170940ZLzNqv','Error\x20stack:','success','📊\x20Status\x20check\x20URL:','../loggerService','not\x20confirmed','processWebhook','Response\x20data:','Missing\x20data\x20in\x20response','logWhiteDomainRequest','Error\x20message:','Error\x20Message:','statusUrl','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','parse','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'];a40_0x371f=function(){return _0x24f696;};return a40_0x371f();}