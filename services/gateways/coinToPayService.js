'use strict';const a40_0x201526=a40_0x2575;(function(_0x1ce28e,_0x7567d0){const _0x3a723d=a40_0x2575,_0x277c28=_0x1ce28e();while(!![]){try{const _0x339c23=parseInt(_0x3a723d(0x12d))/0x1+-parseInt(_0x3a723d(0xc8))/0x2*(parseInt(_0x3a723d(0x110))/0x3)+-parseInt(_0x3a723d(0xde))/0x4*(-parseInt(_0x3a723d(0xd1))/0x5)+-parseInt(_0x3a723d(0x111))/0x6*(-parseInt(_0x3a723d(0xf0))/0x7)+-parseInt(_0x3a723d(0x12a))/0x8+parseInt(_0x3a723d(0x122))/0x9*(-parseInt(_0x3a723d(0xbd))/0xa)+-parseInt(_0x3a723d(0xfd))/0xb;if(_0x339c23===_0x7567d0)break;else _0x277c28['push'](_0x277c28['shift']());}catch(_0x2ad691){_0x277c28['push'](_0x277c28['shift']());}}}(a40_0x23f0,0xef0f9));Object[a40_0x201526(0xea)](exports,a40_0x201526(0xd3),{'value':!![]}),exports[a40_0x201526(0xed)]=void 0x0;const loggerService_1=require(a40_0x201526(0x10a));function a40_0x23f0(){const _0xf4bf7c=['toLowerCase','coinAddress','stack','order_id','paid','EUR','Error\x20message:','merchant_reference_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','CreatedOn','4vjXhOr','EXPIRED','/create','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','waiting','PAID','not\x20found','timeout','4810arNxyf','stringify','__esModule','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainRequest','pending','TesSoft\x20Payment\x20System/1.0','Payment\x20Status:','🪙\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','https://tesoft.uk/gateway/cointopay/','ExpiryTime','2156tvPhCH','loggerService','message','PaymentDetail','created','Response\x20Time:','error','createPaymentLink','TransactionConfirmedOn','entries','currency','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','defineProperty','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','cancelled','CoinToPayService','\x20EUR','HTTP\x20','966uPwTsT','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','JSON\x20Parse\x20Error:\x20','FAILED','Incomplete\x20response:\x20missing\x20data','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','data','Response\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','fromEntries','parse','Error\x20details:','status','3257166YIkOpD','Amount:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','failed','statusText','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','match','verifyPayment','Confirmed\x20On:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','../loggerService','status_code','Request\x20Body:','Gateway\x20Payment\x20ID:','application/json','Status\x20Code:','1184202EIHEWg','45690SSjlAk','/status',',\x20body:\x20','PENDING','now','Currency:','success','https://tesoft.uk/gateway/cointopay/status.php','IBAN:','payment_url','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','POST','Missing\x20data\x20in\x20response','statusUrl','12507444yRBHux','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status:','expired','apiUrl','text','Status','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','292648KPkgIG','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Raw\x20Response\x20Body:','1921676zqpBZk','cointopay','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','awaiting\x20fiat','log','Amount','Headers:','QRCodeURL','gateway_payment_id','TransactionID','Status\x20Text:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','inputCurrency','logWhiteDomainResponse','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Result:','HTTP\x20Status:','Unknown\x20error','Error\x20Message:','Status\x20API\x20Error:\x20','logWhiteDomainError','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','URL:','result','10aXwwMi'];a40_0x23f0=function(){return _0xf4bf7c;};return a40_0x23f0();}function a40_0x2575(_0x283d46,_0x118a58){const _0x23f095=a40_0x23f0();return a40_0x2575=function(_0x257552,_0x1e3f20){_0x257552=_0x257552-0xba;let _0x1ab2e5=_0x23f095[_0x257552];return _0x1ab2e5;},a40_0x2575(_0x283d46,_0x118a58);}class CoinToPayService{constructor(){const _0x20fff2=a40_0x201526;this[_0x20fff2(0x126)]=_0x20fff2(0xdc),this[_0x20fff2(0x121)]=_0x20fff2(0x118),console[_0x20fff2(0x131)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x20fff2(0x131)]('📊\x20Status\x20check\x20URL:',this[_0x20fff2(0x121)]);}async[a40_0x201526(0xe5)](_0x27a45f){const _0x1f7f93=a40_0x201526,{orderId:_0x4bd61d,amount:_0x1786a7}=_0x27a45f;console[_0x1f7f93(0x131)](_0x1f7f93(0xd9)+_0x1786a7+_0x1f7f93(0xee));const _0x2ac207={'amount':_0x1786a7},_0x4f15af=Date['now']();try{console[_0x1f7f93(0x131)](_0x1f7f93(0x123)),console[_0x1f7f93(0x131)](_0x1f7f93(0xbb),this['apiUrl']),console[_0x1f7f93(0x131)](_0x1f7f93(0x10c),JSON[_0x1f7f93(0xd2)](_0x2ac207,null,0x2)),console[_0x1f7f93(0x131)](_0x1f7f93(0xfe),_0x1786a7,_0x1f7f93(0x11e)),loggerService_1['loggerService'][_0x1f7f93(0xd5)](_0x1f7f93(0x12e),_0x1f7f93(0xca),'POST',_0x2ac207);const _0x1954b6=await fetch(this[_0x1f7f93(0x126)],{'method':_0x1f7f93(0x11f),'headers':{'Content-Type':_0x1f7f93(0x10e),'Accept':_0x1f7f93(0x10e),'User-Agent':_0x1f7f93(0xd7)},'body':JSON[_0x1f7f93(0xd2)](_0x2ac207)}),_0x46a116=Date['now']()-_0x4f15af;console['log'](_0x1f7f93(0xda)),console[_0x1f7f93(0x131)]('Status:',_0x1954b6[_0x1f7f93(0xfc)]),console[_0x1f7f93(0x131)](_0x1f7f93(0x137),_0x1954b6[_0x1f7f93(0x102)]),console[_0x1f7f93(0x131)](_0x1f7f93(0x133),Object[_0x1f7f93(0xf9)](_0x1954b6['headers'][_0x1f7f93(0xe7)]())),console[_0x1f7f93(0x131)](_0x1f7f93(0xe3),_0x46a116+'ms');const _0x1c29c5=await _0x1954b6[_0x1f7f93(0x127)]();console[_0x1f7f93(0x131)]('Raw\x20Response\x20Body:',_0x1c29c5);if(!_0x1954b6['ok']){console[_0x1f7f93(0xe4)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x1954b6[_0x1f7f93(0xfc)]),console[_0x1f7f93(0xe4)](_0x1f7f93(0xf7),_0x1c29c5),loggerService_1[_0x1f7f93(0xdf)]['logWhiteDomainResponse'](_0x1f7f93(0x12e),_0x1f7f93(0xca),_0x1954b6[_0x1f7f93(0xfc)],_0x1c29c5,_0x46a116),loggerService_1[_0x1f7f93(0xdf)]['logWhiteDomainError'](_0x1f7f93(0x12e),_0x1f7f93(0xca),_0x1f7f93(0xef)+_0x1954b6[_0x1f7f93(0xfc)]+':\x20'+_0x1c29c5);throw new Error(_0x1f7f93(0xcb)+_0x1954b6[_0x1f7f93(0xfc)]+_0x1f7f93(0x113)+_0x1c29c5);}let _0x1932dd;try{_0x1932dd=JSON[_0x1f7f93(0xfa)](_0x1c29c5);}catch(_0x63277e){console[_0x1f7f93(0xe4)](_0x1f7f93(0xd4),_0x63277e),loggerService_1[_0x1f7f93(0xdf)]['logWhiteDomainError']('cointopay','/create','JSON\x20Parse\x20Error:\x20'+_0x63277e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x1c29c5);}console[_0x1f7f93(0x131)](_0x1f7f93(0xf5)),console[_0x1f7f93(0x131)]('Parsed\x20Result:',JSON[_0x1f7f93(0xd2)](_0x1932dd,null,0x2)),loggerService_1['loggerService'][_0x1f7f93(0x13a)](_0x1f7f93(0x12e),_0x1f7f93(0xca),_0x1954b6[_0x1f7f93(0xfc)],_0x1932dd,_0x46a116);if(_0x1932dd[_0x1f7f93(0xe4)]){const _0x275036=_0x1932dd[_0x1f7f93(0xe0)]||_0x1932dd[_0x1f7f93(0xe4)]||_0x1f7f93(0xdb);console[_0x1f7f93(0xe4)](_0x1f7f93(0xff)),console[_0x1f7f93(0xe4)](_0x1f7f93(0x140),_0x275036),loggerService_1[_0x1f7f93(0xdf)]['logWhiteDomainError']('cointopay',_0x1f7f93(0xca),'Business\x20Error:\x20'+_0x275036);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x275036);}if(!_0x1932dd[_0x1f7f93(0x11a)]||!_0x1932dd[_0x1f7f93(0x135)]){console['error'](_0x1f7f93(0x13c)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1f7f93(0xe4)]('Response\x20data:',_0x1932dd),loggerService_1['loggerService'][_0x1f7f93(0x142)]('cointopay',_0x1f7f93(0xca),_0x1f7f93(0x11b));throw new Error(_0x1f7f93(0x129));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x1f7f93(0x10d),_0x1932dd[_0x1f7f93(0x135)]),console[_0x1f7f93(0x131)](_0x1f7f93(0x11c),_0x1932dd[_0x1f7f93(0x11a)]),console['log']('Amount:',_0x1786a7,'EUR'),{'gateway_payment_id':_0x1932dd[_0x1f7f93(0x135)],'payment_url':_0x1932dd[_0x1f7f93(0x11a)]};}catch(_0x2aa569){console[_0x1f7f93(0xe4)](_0x1f7f93(0x138)),console['error'](_0x1f7f93(0xfb),_0x2aa569),loggerService_1[_0x1f7f93(0xdf)][_0x1f7f93(0x142)](_0x1f7f93(0x12e),_0x1f7f93(0xca),_0x2aa569);if(_0x2aa569 instanceof Error){console[_0x1f7f93(0xe4)](_0x1f7f93(0xc4),_0x2aa569[_0x1f7f93(0xe0)]),console[_0x1f7f93(0xe4)]('Error\x20stack:',_0x2aa569[_0x1f7f93(0xc0)]);throw new Error(_0x1f7f93(0xba)+_0x2aa569[_0x1f7f93(0xe0)]);}throw new Error(_0x1f7f93(0xf1));}}async['checkPaymentStatus'](_0x17bce2){const _0x1b2bf5=a40_0x201526,_0x1fcda7=Date[_0x1b2bf5(0x115)]();try{console[_0x1b2bf5(0x131)](_0x1b2bf5(0xe9)+_0x17bce2);const _0x53ff5e={'gatewayPaymentId':_0x17bce2};loggerService_1[_0x1b2bf5(0xdf)][_0x1b2bf5(0xd5)](_0x1b2bf5(0x12e),_0x1b2bf5(0x112),'POST',_0x53ff5e);const _0x43082d=await fetch(this['statusUrl'],{'method':_0x1b2bf5(0x11f),'headers':{'Content-Type':_0x1b2bf5(0x10e),'Accept':_0x1b2bf5(0x10e),'User-Agent':_0x1b2bf5(0xd7)},'body':JSON[_0x1b2bf5(0xd2)](_0x53ff5e)}),_0x516e2a=Date[_0x1b2bf5(0x115)]()-_0x1fcda7;console['log'](_0x1b2bf5(0xcc)),console[_0x1b2bf5(0x131)]('Status:',_0x43082d[_0x1b2bf5(0xfc)]),console['log'](_0x1b2bf5(0xe3),_0x516e2a+'ms');if(!_0x43082d['ok']){const _0x478b8e=await _0x43082d[_0x1b2bf5(0x127)]();console[_0x1b2bf5(0xe4)](_0x1b2bf5(0x13e),_0x43082d[_0x1b2bf5(0xfc)]),console['error'](_0x1b2bf5(0xf7),_0x478b8e),loggerService_1[_0x1b2bf5(0xdf)][_0x1b2bf5(0x13a)](_0x1b2bf5(0x12e),_0x1b2bf5(0x112),_0x43082d[_0x1b2bf5(0xfc)],_0x478b8e,_0x516e2a),loggerService_1[_0x1b2bf5(0xdf)][_0x1b2bf5(0x142)]('cointopay',_0x1b2bf5(0x112),_0x1b2bf5(0xef)+_0x43082d[_0x1b2bf5(0xfc)]+':\x20'+_0x478b8e);throw new Error(_0x1b2bf5(0xcb)+_0x43082d['status']);}const _0x1f4ba2=await _0x43082d[_0x1b2bf5(0x127)]();console[_0x1b2bf5(0x131)](_0x1b2bf5(0x12c),_0x1f4ba2);let _0x264c0c;try{_0x264c0c=JSON[_0x1b2bf5(0xfa)](_0x1f4ba2);}catch(_0x40a33c){console[_0x1b2bf5(0xe4)](_0x1b2bf5(0xd4),_0x40a33c),loggerService_1[_0x1b2bf5(0xdf)][_0x1b2bf5(0x142)](_0x1b2bf5(0x12e),_0x1b2bf5(0x112),_0x1b2bf5(0xf2)+_0x40a33c);throw new Error(_0x1b2bf5(0xc6)+_0x1f4ba2);}loggerService_1[_0x1b2bf5(0xdf)][_0x1b2bf5(0x13a)](_0x1b2bf5(0x12e),'/status',_0x43082d[_0x1b2bf5(0xfc)],_0x264c0c,_0x516e2a),console['log'](_0x1b2bf5(0x12f)),console[_0x1b2bf5(0x131)](_0x1b2bf5(0x13d),_0x264c0c[_0x1b2bf5(0xbc)]),console[_0x1b2bf5(0x131)](_0x1b2bf5(0x10f),_0x264c0c['status_code']),console[_0x1b2bf5(0x131)](_0x1b2bf5(0xd8),_0x264c0c[_0x1b2bf5(0xf6)]?.[_0x1b2bf5(0x128)]),console['log'](_0x1b2bf5(0xfe),_0x264c0c['data']?.['Amount']),console[_0x1b2bf5(0x131)](_0x1b2bf5(0x116),_0x264c0c[_0x1b2bf5(0xf6)]?.['inputCurrency']);if(_0x264c0c[_0x1b2bf5(0xbc)]!==_0x1b2bf5(0x117)||_0x264c0c[_0x1b2bf5(0x10b)]!==0xc8){const _0x1475d9=_0x264c0c['message']||_0x1b2bf5(0xeb);console[_0x1b2bf5(0xe4)](_0x1b2bf5(0x12b)),console[_0x1b2bf5(0xe4)](_0x1b2bf5(0x140),_0x1475d9),loggerService_1['loggerService'][_0x1b2bf5(0x142)](_0x1b2bf5(0x12e),_0x1b2bf5(0x112),_0x1b2bf5(0x141)+_0x1475d9);throw new Error(_0x1b2bf5(0x13b)+_0x1475d9);}if(!_0x264c0c['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1b2bf5(0xe4)](_0x1b2bf5(0x120)),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x1b2bf5(0x112),_0x1b2bf5(0xf4));throw new Error(_0x1b2bf5(0xf8));}let _0x3aa790=_0x1b2bf5(0x114);switch(_0x264c0c['data'][_0x1b2bf5(0x128)]?.['toLowerCase']()){case _0x1b2bf5(0xc2):_0x3aa790=_0x1b2bf5(0xce);break;case'cancelled':case _0x1b2bf5(0x101):case _0x1b2bf5(0xe4):_0x3aa790=_0x1b2bf5(0xf3);break;case _0x1b2bf5(0x125):case _0x1b2bf5(0xd0):_0x3aa790=_0x1b2bf5(0xc9);break;case _0x1b2bf5(0xcd):case'awaiting\x20fiat':case _0x1b2bf5(0xd6):case _0x1b2bf5(0xe2):default:_0x3aa790=_0x1b2bf5(0x114);break;}let _0x44dd69,_0x144215;if(_0x264c0c['data'][_0x1b2bf5(0xe1)]){const _0x38499a=_0x264c0c[_0x1b2bf5(0xf6)]['PaymentDetail'];console[_0x1b2bf5(0x131)]('🏦\x20Payment\x20Detail:',_0x38499a);const _0x12d7b7=_0x38499a[_0x1b2bf5(0x104)](/IBAN\s+([A-Z0-9]+)/i);_0x12d7b7&&(_0x44dd69=_0x12d7b7[0x1],console[_0x1b2bf5(0x131)]('🏦\x20Extracted\x20IBAN:',_0x44dd69)),_0x144215=_0x38499a;}const _0x7f7ea2={'iban':_0x44dd69,'bankDetails':_0x144215,'transactionId':_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x136)],'coinAddress':_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0xbf)],'qrCodeUrl':_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x134)],'expiryTime':_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0xdd)],'createdOn':_0x264c0c['data'][_0x1b2bf5(0xc7)],'confirmedOn':_0x264c0c['data'][_0x1b2bf5(0xe6)]};console[_0x1b2bf5(0x131)](_0x1b2bf5(0x103)),console[_0x1b2bf5(0x131)](_0x1b2bf5(0x124),_0x264c0c[_0x1b2bf5(0xf6)]['Status'],'->',_0x3aa790),console[_0x1b2bf5(0x131)](_0x1b2bf5(0xfe),_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x132)],_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x139)]),console['log'](_0x1b2bf5(0x143),_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x136)]),console['log'](_0x1b2bf5(0x119),_0x44dd69||_0x1b2bf5(0xcf)),console['log']('Created\x20On:',_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0xc7)]),console[_0x1b2bf5(0x131)](_0x1b2bf5(0x106),_0x264c0c[_0x1b2bf5(0xf6)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x128)]?.['toLowerCase']()==='awaiting\x20fiat')console['log'](_0x1b2bf5(0x108));else _0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x128)]?.[_0x1b2bf5(0xbe)]()===_0x1b2bf5(0xc2)&&console[_0x1b2bf5(0x131)](_0x1b2bf5(0x107));return{'status':_0x3aa790,'amount':parseFloat(_0x264c0c['data'][_0x1b2bf5(0x132)])||undefined,'currency':_0x264c0c[_0x1b2bf5(0xf6)][_0x1b2bf5(0x139)]||_0x1b2bf5(0xc3),'paymentDetails':_0x7f7ea2};}catch(_0x48c881){console['error'](_0x1b2bf5(0x11d),_0x48c881),loggerService_1[_0x1b2bf5(0xdf)]['logWhiteDomainError'](_0x1b2bf5(0x12e),_0x1b2bf5(0x112),_0x48c881);throw new Error(_0x1b2bf5(0x109)+(_0x48c881 instanceof Error?_0x48c881[_0x1b2bf5(0xe0)]:_0x1b2bf5(0x13f)));}}async[a40_0x201526(0x105)](_0x5226c8){const _0x82245c=a40_0x201526,_0x1470d8=await this['checkPaymentStatus'](_0x5226c8);return{'status':_0x1470d8['status'],'amount':_0x1470d8['amount'],'currency':_0x1470d8[_0x82245c(0xe8)]};}async['processWebhook'](_0x416f37){const _0x5e88b0=a40_0x201526;console[_0x5e88b0(0x131)](_0x5e88b0(0x100),_0x416f37);let _0x6f43d2=_0x5e88b0(0x114);switch(_0x416f37[_0x5e88b0(0xfc)]?.[_0x5e88b0(0xbe)]()){case _0x5e88b0(0xc2):_0x6f43d2=_0x5e88b0(0xce);break;case _0x5e88b0(0xec):case'failed':case _0x5e88b0(0xe4):_0x6f43d2=_0x5e88b0(0xf3);break;case _0x5e88b0(0x125):case'timeout':_0x6f43d2='EXPIRED';break;case _0x5e88b0(0xd6):case _0x5e88b0(0xcd):case _0x5e88b0(0x130):case'created':default:_0x6f43d2='PENDING';break;}return{'paymentId':_0x416f37[_0x5e88b0(0xc1)]||_0x416f37[_0x5e88b0(0xc5)]||'','status':_0x6f43d2,'amount':_0x416f37['amount'],'currency':_0x416f37['currency']||'EUR'};}}exports['CoinToPayService']=CoinToPayService;