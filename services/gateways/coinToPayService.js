'use strict';function a43_0x54f6(){const _0x374398=['order_id','TesSoft\x20Payment\x20System/1.0','CoinToPayService','stack','statusUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','/status','Incomplete\x20response:\x20missing\x20data','9525oNVlMc','application/json','not\x20found','Unknown\x20error\x20from\x20CoinToPay\x20API','amount','Status\x20Text:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','TransactionID','https://tesoft.uk/gateway/cointopay/status.php','payment_url','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status_code','expired','checkPaymentStatus','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','9mRgvsA','Response\x20Time:','JSON\x20Parse\x20Error:\x20',',\x20body:\x20','parse','cointopay','Transaction\x20ID:','Response\x20Body:','stringify','üè¶\x20Extracted\x20IBAN:','processWebhook','IBAN:','1023336yMaxVH','20FqjmAl','Result:','now','loggerService','/create','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','logWhiteDomainError','fromEntries','HTTP\x20Status:','Status:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Raw\x20Response\x20Body:','Error\x20stack:','Created\x20On:','PAID','TransactionConfirmedOn','CoinToPay\x20API\x20error:\x20','Amount:','Status','pending','üè¶\x20Payment\x20Detail:','logWhiteDomainResponse','Parsed\x20Result:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','168276OIpCqV','6xOXXiF','result','currency','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20data:','logWhiteDomainRequest','gateway_payment_id','text','inputCurrency','Currency:','PENDING','apiUrl','status','paid','949802ihcYnI','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','POST','===\x20COINTOPAY\x20SUCCESS\x20===','../loggerService','message','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','failed','https://tesoft.uk/gateway/cointopay/','PaymentDetail','Amount','QRCodeURL','log','statusText','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','awaiting\x20fiat','ExpiryTime','HTTP\x20error!\x20status:\x20','6325350OsVcLP','__esModule','Headers:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','timeout','Status\x20Code:','headers','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20API\x20Error:\x20','toLowerCase','data','EUR','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','HTTP\x20','201088qsQdWI','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','defineProperty','235608bSXUfm','\x20EUR','Error\x20message:','FAILED','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','EXPIRED','verifyPayment','created','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','URL:','Payment\x20URL:','error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','CoinToPay\x20payment\x20status\x20check\x20error:'];a43_0x54f6=function(){return _0x374398;};return a43_0x54f6();}const a43_0x390f8e=a43_0x5a1a;(function(_0x5f1268,_0x5028d7){const _0x427da1=a43_0x5a1a,_0x37b578=_0x5f1268();while(!![]){try{const _0x5343e8=parseInt(_0x427da1(0x1fa))/0x1+-parseInt(_0x427da1(0x1ad))/0x2*(parseInt(_0x427da1(0x209))/0x3)+parseInt(_0x427da1(0x1df))/0x4*(-parseInt(_0x427da1(0x216))/0x5)+parseInt(_0x427da1(0x1ae))/0x6*(-parseInt(_0x427da1(0x1bc))/0x7)+parseInt(_0x427da1(0x1e2))/0x8+parseInt(_0x427da1(0x215))/0x9+parseInt(_0x427da1(0x1cf))/0xa;if(_0x5343e8===_0x5028d7)break;else _0x37b578['push'](_0x37b578['shift']());}catch(_0x1efb40){_0x37b578['push'](_0x37b578['shift']());}}}(a43_0x54f6,0x2fdbb));function a43_0x5a1a(_0x3641f4,_0x3778af){const _0x54f675=a43_0x54f6();return a43_0x5a1a=function(_0x5a1ac3,_0x5eaec6){_0x5a1ac3=_0x5a1ac3-0x1a5;let _0xcfe149=_0x54f675[_0x5a1ac3];return _0xcfe149;},a43_0x5a1a(_0x3641f4,_0x3778af);}Object[a43_0x390f8e(0x1e1)](exports,a43_0x390f8e(0x1d0),{'value':!![]}),exports[a43_0x390f8e(0x1f4)]=void 0x0;const loggerService_1=require(a43_0x390f8e(0x1c0));class CoinToPayService{constructor(){const _0x6c8256=a43_0x390f8e;this[_0x6c8256(0x1b9)]=_0x6c8256(0x1c4),this[_0x6c8256(0x1f6)]=_0x6c8256(0x202),console[_0x6c8256(0x1c8)](_0x6c8256(0x200)),console[_0x6c8256(0x1c8)]('üìä\x20Status\x20check\x20URL:',this[_0x6c8256(0x1f6)]);}async['createPaymentLink'](_0x38136d){const _0x251abf=a43_0x390f8e,{orderId:_0x1b77a0,amount:_0x29e1bf}=_0x38136d;console[_0x251abf(0x1c8)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x29e1bf+_0x251abf(0x1e3));const _0x5ef52a={'amount':_0x29e1bf},_0x1ed2ce=Date[_0x251abf(0x218)]();try{console['log'](_0x251abf(0x1ac)),console[_0x251abf(0x1c8)](_0x251abf(0x1eb),this[_0x251abf(0x1b9)]),console[_0x251abf(0x1c8)]('Request\x20Body:',JSON['stringify'](_0x5ef52a,null,0x2)),console[_0x251abf(0x1c8)]('Amount:',_0x29e1bf,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x251abf(0x219)][_0x251abf(0x1b3)](_0x251abf(0x20e),_0x251abf(0x21a),_0x251abf(0x1be),_0x5ef52a);const _0x1cfe24=await fetch(this[_0x251abf(0x1b9)],{'method':_0x251abf(0x1be),'headers':{'Content-Type':_0x251abf(0x1fb),'Accept':'application/json','User-Agent':_0x251abf(0x1f3)},'body':JSON['stringify'](_0x5ef52a)}),_0x486459=Date['now']()-_0x1ed2ce;console['log'](_0x251abf(0x1d8)),console[_0x251abf(0x1c8)](_0x251abf(0x21f),_0x1cfe24['status']),console[_0x251abf(0x1c8)](_0x251abf(0x1ff),_0x1cfe24[_0x251abf(0x1c9)]),console[_0x251abf(0x1c8)](_0x251abf(0x1d1),Object[_0x251abf(0x21d)](_0x1cfe24[_0x251abf(0x1d6)]['entries']())),console['log']('Response\x20Time:',_0x486459+'ms');const _0x49042a=await _0x1cfe24[_0x251abf(0x1b5)]();console[_0x251abf(0x1c8)]('Raw\x20Response\x20Body:',_0x49042a);if(!_0x1cfe24['ok']){console[_0x251abf(0x1ed)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x251abf(0x1ed)](_0x251abf(0x21e),_0x1cfe24[_0x251abf(0x1ba)]),console[_0x251abf(0x1ed)](_0x251abf(0x210),_0x49042a),loggerService_1[_0x251abf(0x219)]['logWhiteDomainResponse'](_0x251abf(0x20e),_0x251abf(0x21a),_0x1cfe24['status'],_0x49042a,_0x486459),loggerService_1[_0x251abf(0x219)]['logWhiteDomainError']('cointopay',_0x251abf(0x21a),_0x251abf(0x1de)+_0x1cfe24['status']+':\x20'+_0x49042a);throw new Error(_0x251abf(0x1ce)+_0x1cfe24[_0x251abf(0x1ba)]+_0x251abf(0x20c)+_0x49042a);}let _0x581a98;try{_0x581a98=JSON[_0x251abf(0x20d)](_0x49042a);}catch(_0x44f014){console[_0x251abf(0x1ed)](_0x251abf(0x1b1),_0x44f014),loggerService_1[_0x251abf(0x219)]['logWhiteDomainError'](_0x251abf(0x20e),_0x251abf(0x21a),_0x251abf(0x20b)+_0x44f014);throw new Error(_0x251abf(0x1f7)+_0x49042a);}console['log'](_0x251abf(0x1ee)),console[_0x251abf(0x1c8)](_0x251abf(0x1ab),JSON[_0x251abf(0x211)](_0x581a98,null,0x2)),loggerService_1['loggerService'][_0x251abf(0x1aa)](_0x251abf(0x20e),_0x251abf(0x21a),_0x1cfe24[_0x251abf(0x1ba)],_0x581a98,_0x486459);if(_0x581a98[_0x251abf(0x1ed)]){const _0x35a2ab=_0x581a98['message']||_0x581a98[_0x251abf(0x1ed)]||_0x251abf(0x1fd);console[_0x251abf(0x1ed)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x251abf(0x1ed)]('Error\x20Message:',_0x35a2ab),loggerService_1[_0x251abf(0x219)][_0x251abf(0x21c)]('cointopay',_0x251abf(0x21a),'Business\x20Error:\x20'+_0x35a2ab);throw new Error(_0x251abf(0x1a5)+_0x35a2ab);}if(!_0x581a98[_0x251abf(0x203)]||!_0x581a98[_0x251abf(0x1b4)]){console[_0x251abf(0x1ed)](_0x251abf(0x1d7)),console['error'](_0x251abf(0x204)),console['error'](_0x251abf(0x1b2),_0x581a98),loggerService_1[_0x251abf(0x219)][_0x251abf(0x21c)](_0x251abf(0x20e),_0x251abf(0x21a),_0x251abf(0x1ea));throw new Error(_0x251abf(0x220));}return console['log'](_0x251abf(0x1bf)),console[_0x251abf(0x1c8)]('Gateway\x20Payment\x20ID:',_0x581a98[_0x251abf(0x1b4)]),console[_0x251abf(0x1c8)](_0x251abf(0x1ec),_0x581a98[_0x251abf(0x203)]),console['log'](_0x251abf(0x1a6),_0x29e1bf,'EUR'),{'gateway_payment_id':_0x581a98[_0x251abf(0x1b4)],'payment_url':_0x581a98[_0x251abf(0x203)]};}catch(_0x1783da){console[_0x251abf(0x1ed)](_0x251abf(0x1f0)),console[_0x251abf(0x1ed)]('Error\x20details:',_0x1783da),loggerService_1['loggerService'][_0x251abf(0x21c)](_0x251abf(0x20e),'/create',_0x1783da);if(_0x1783da instanceof Error){console[_0x251abf(0x1ed)](_0x251abf(0x1e4),_0x1783da[_0x251abf(0x1c1)]),console[_0x251abf(0x1ed)](_0x251abf(0x223),_0x1783da[_0x251abf(0x1f5)]);throw new Error(_0x251abf(0x208)+_0x1783da[_0x251abf(0x1c1)]);}throw new Error(_0x251abf(0x1e0));}}async['checkPaymentStatus'](_0x1efc95){const _0x7bc5fc=a43_0x390f8e,_0x75b1f3=Date['now']();try{console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1c2)+_0x1efc95);const _0x30551c={'gatewayPaymentId':_0x1efc95};loggerService_1['loggerService'][_0x7bc5fc(0x1b3)](_0x7bc5fc(0x20e),_0x7bc5fc(0x1f8),_0x7bc5fc(0x1be),_0x30551c);const _0x3e859d=await fetch(this[_0x7bc5fc(0x1f6)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x7bc5fc(0x1fb),'User-Agent':_0x7bc5fc(0x1f3)},'body':JSON[_0x7bc5fc(0x211)](_0x30551c)}),_0xb63a7b=Date['now']()-_0x75b1f3;console['log'](_0x7bc5fc(0x1dd)),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x21f),_0x3e859d[_0x7bc5fc(0x1ba)]),console['log'](_0x7bc5fc(0x20a),_0xb63a7b+'ms');if(!_0x3e859d['ok']){const _0x6ce7ee=await _0x3e859d[_0x7bc5fc(0x1b5)]();console[_0x7bc5fc(0x1ed)](_0x7bc5fc(0x21e),_0x3e859d[_0x7bc5fc(0x1ba)]),console[_0x7bc5fc(0x1ed)](_0x7bc5fc(0x210),_0x6ce7ee),loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x1aa)](_0x7bc5fc(0x20e),'/status',_0x3e859d[_0x7bc5fc(0x1ba)],_0x6ce7ee,_0xb63a7b),loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x21c)](_0x7bc5fc(0x20e),'/status',_0x7bc5fc(0x1de)+_0x3e859d[_0x7bc5fc(0x1ba)]+':\x20'+_0x6ce7ee);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3e859d['status']);}const _0x4972ae=await _0x3e859d[_0x7bc5fc(0x1b5)]();console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x222),_0x4972ae);let _0x59858f;try{_0x59858f=JSON[_0x7bc5fc(0x20d)](_0x4972ae);}catch(_0x1353d3){console[_0x7bc5fc(0x1ed)](_0x7bc5fc(0x1b1),_0x1353d3),loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x21c)](_0x7bc5fc(0x20e),'/status','JSON\x20Parse\x20Error:\x20'+_0x1353d3);throw new Error(_0x7bc5fc(0x1ef)+_0x4972ae);}loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x1aa)](_0x7bc5fc(0x20e),_0x7bc5fc(0x1f8),_0x3e859d[_0x7bc5fc(0x1ba)],_0x59858f,_0xb63a7b),console[_0x7bc5fc(0x1c8)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x217),_0x59858f[_0x7bc5fc(0x1af)]),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1d5),_0x59858f[_0x7bc5fc(0x205)]),console[_0x7bc5fc(0x1c8)]('Payment\x20Status:',_0x59858f[_0x7bc5fc(0x1db)]?.[_0x7bc5fc(0x1a7)]),console[_0x7bc5fc(0x1c8)]('Amount:',_0x59858f[_0x7bc5fc(0x1db)]?.[_0x7bc5fc(0x1c6)]),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1b7),_0x59858f[_0x7bc5fc(0x1db)]?.[_0x7bc5fc(0x1b6)]);if(_0x59858f[_0x7bc5fc(0x1af)]!=='success'||_0x59858f[_0x7bc5fc(0x205)]!==0xc8){const _0x10be97=_0x59858f[_0x7bc5fc(0x1c1)]||_0x7bc5fc(0x1e6);console['error'](_0x7bc5fc(0x1d3)),console[_0x7bc5fc(0x1ed)]('Error\x20Message:',_0x10be97),loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x21c)]('cointopay',_0x7bc5fc(0x1f8),_0x7bc5fc(0x1d9)+_0x10be97);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x10be97);}if(!_0x59858f[_0x7bc5fc(0x1db)]){console[_0x7bc5fc(0x1ed)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x7bc5fc(0x1ed)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x7bc5fc(0x219)][_0x7bc5fc(0x21c)](_0x7bc5fc(0x20e),_0x7bc5fc(0x1f8),_0x7bc5fc(0x1f9));throw new Error(_0x7bc5fc(0x1cb));}let _0x39b96d=_0x7bc5fc(0x1b8);switch(_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x1a7)]?.[_0x7bc5fc(0x1da)]()){case _0x7bc5fc(0x1bb):_0x39b96d=_0x7bc5fc(0x225);break;case _0x7bc5fc(0x1ca):case _0x7bc5fc(0x1c3):case _0x7bc5fc(0x1ed):_0x39b96d=_0x7bc5fc(0x1e5);break;case _0x7bc5fc(0x206):case _0x7bc5fc(0x1d4):_0x39b96d=_0x7bc5fc(0x1e7);break;case'waiting':case _0x7bc5fc(0x1cc):case _0x7bc5fc(0x1a8):case _0x7bc5fc(0x1e9):default:_0x39b96d=_0x7bc5fc(0x1b8);break;}let _0x190980,_0xb17a5d;if(_0x59858f['data']['PaymentDetail']){const _0x47eada=_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x1c5)];console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1a9),_0x47eada);const _0x33aded=_0x47eada['match'](/IBAN\s+([A-Z0-9]+)/i);_0x33aded&&(_0x190980=_0x33aded[0x1],console['log'](_0x7bc5fc(0x212),_0x190980)),_0xb17a5d=_0x47eada;}const _0xffbb18={'iban':_0x190980,'bankDetails':_0xb17a5d,'transactionId':_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x201)],'coinAddress':_0x59858f['data']['coinAddress'],'qrCodeUrl':_0x59858f['data'][_0x7bc5fc(0x1c7)],'expiryTime':_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x1cd)],'createdOn':_0x59858f[_0x7bc5fc(0x1db)]['CreatedOn'],'confirmedOn':_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x226)]};console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1bd)),console[_0x7bc5fc(0x1c8)]('Status:',_0x59858f[_0x7bc5fc(0x1db)]['Status'],'->',_0x39b96d),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x1a6),_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x1c6)],_0x59858f['data'][_0x7bc5fc(0x1b6)]),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x20f),_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x201)]),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x214),_0x190980||_0x7bc5fc(0x1fc)),console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x224),_0x59858f['data']['CreatedOn']),console[_0x7bc5fc(0x1c8)]('Confirmed\x20On:',_0x59858f[_0x7bc5fc(0x1db)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x59858f[_0x7bc5fc(0x1db)][_0x7bc5fc(0x1a7)]?.[_0x7bc5fc(0x1da)]()===_0x7bc5fc(0x1cc))console[_0x7bc5fc(0x1c8)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x59858f[_0x7bc5fc(0x1db)]['Status']?.[_0x7bc5fc(0x1da)]()===_0x7bc5fc(0x1bb)&&console[_0x7bc5fc(0x1c8)](_0x7bc5fc(0x21b));return{'status':_0x39b96d,'amount':parseFloat(_0x59858f[_0x7bc5fc(0x1db)]['Amount'])||undefined,'currency':_0x59858f['data'][_0x7bc5fc(0x1b6)]||'EUR','paymentDetails':_0xffbb18};}catch(_0x29cdf5){console[_0x7bc5fc(0x1ed)](_0x7bc5fc(0x1f1),_0x29cdf5),loggerService_1[_0x7bc5fc(0x219)]['logWhiteDomainError'](_0x7bc5fc(0x20e),_0x7bc5fc(0x1f8),_0x29cdf5);throw new Error(_0x7bc5fc(0x1d2)+(_0x29cdf5 instanceof Error?_0x29cdf5[_0x7bc5fc(0x1c1)]:'Unknown\x20error'));}}async[a43_0x390f8e(0x1e8)](_0x399e0a){const _0x55d56e=a43_0x390f8e,_0xe96175=await this[_0x55d56e(0x207)](_0x399e0a);return{'status':_0xe96175[_0x55d56e(0x1ba)],'amount':_0xe96175[_0x55d56e(0x1fe)],'currency':_0xe96175[_0x55d56e(0x1b0)]};}async[a43_0x390f8e(0x213)](_0x2b5057){const _0xc142f6=a43_0x390f8e;console[_0xc142f6(0x1c8)](_0xc142f6(0x221),_0x2b5057);let _0x3b7482=_0xc142f6(0x1b8);switch(_0x2b5057[_0xc142f6(0x1ba)]?.[_0xc142f6(0x1da)]()){case _0xc142f6(0x1bb):_0x3b7482=_0xc142f6(0x225);break;case _0xc142f6(0x1ca):case _0xc142f6(0x1c3):case _0xc142f6(0x1ed):_0x3b7482=_0xc142f6(0x1e5);break;case'expired':case _0xc142f6(0x1d4):_0x3b7482=_0xc142f6(0x1e7);break;case _0xc142f6(0x1a8):case'waiting':case _0xc142f6(0x1cc):case _0xc142f6(0x1e9):default:_0x3b7482=_0xc142f6(0x1b8);break;}return{'paymentId':_0x2b5057[_0xc142f6(0x1f2)]||_0x2b5057['merchant_reference_id']||'','status':_0x3b7482,'amount':_0x2b5057[_0xc142f6(0x1fe)],'currency':_0x2b5057[_0xc142f6(0x1b0)]||_0xc142f6(0x1dc)};}}exports[a43_0x390f8e(0x1f4)]=CoinToPayService;