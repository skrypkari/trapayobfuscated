'use strict';function a49_0x8795(_0x14faa7,_0x2018aa){const _0x293ab7=a49_0x293a();return a49_0x8795=function(_0x8795ea,_0x10a5c0){_0x8795ea=_0x8795ea-0xd0;let _0x1558b3=_0x293ab7[_0x8795ea];return _0x1558b3;},a49_0x8795(_0x14faa7,_0x2018aa);}const a49_0x1e65bf=a49_0x8795;(function(_0xc8e0ae,_0x596cb0){const _0x3abf25=a49_0x8795,_0x5f1360=_0xc8e0ae();while(!![]){try{const _0x3ffecc=-parseInt(_0x3abf25(0x14f))/0x1*(parseInt(_0x3abf25(0xf9))/0x2)+parseInt(_0x3abf25(0x12a))/0x3*(parseInt(_0x3abf25(0xed))/0x4)+-parseInt(_0x3abf25(0x127))/0x5*(-parseInt(_0x3abf25(0x15d))/0x6)+parseInt(_0x3abf25(0xe0))/0x7+-parseInt(_0x3abf25(0x15e))/0x8+parseInt(_0x3abf25(0x140))/0x9+parseInt(_0x3abf25(0x122))/0xa*(-parseInt(_0x3abf25(0x121))/0xb);if(_0x3ffecc===_0x596cb0)break;else _0x5f1360['push'](_0x5f1360['shift']());}catch(_0x51ad6b){_0x5f1360['push'](_0x5f1360['shift']());}}}(a49_0x293a,0xe77bb));Object[a49_0x1e65bf(0xd0)](exports,'__esModule',{'value':!![]}),exports[a49_0x1e65bf(0x109)]=void 0x0;const loggerService_1=require(a49_0x1e65bf(0xdb));class CoinToPayService{constructor(){const _0x4e29f8=a49_0x1e65bf;this['apiUrl']=_0x4e29f8(0xe2),this[_0x4e29f8(0x110)]=_0x4e29f8(0x138),console[_0x4e29f8(0x107)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x4e29f8(0x107)](_0x4e29f8(0xda),this[_0x4e29f8(0x110)]);}async[a49_0x1e65bf(0x118)](_0x4671c6){const _0x2c97b4=a49_0x1e65bf,{orderId:_0x46efe1,amount:_0x580005}=_0x4671c6;console[_0x2c97b4(0x107)](_0x2c97b4(0x113)+_0x580005+_0x2c97b4(0x156));const _0xc1d88e={'amount':_0x580005},_0x559a49=Date[_0x2c97b4(0xd2)]();try{console[_0x2c97b4(0x107)](_0x2c97b4(0x11b)),console['log']('URL:',this[_0x2c97b4(0xf0)]),console['log'](_0x2c97b4(0x14e),JSON['stringify'](_0xc1d88e,null,0x2)),console[_0x2c97b4(0x107)](_0x2c97b4(0x136),_0x580005,_0x2c97b4(0xd9)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2c97b4(0x15c),_0x2c97b4(0x104),'POST',_0xc1d88e);const _0x29acd2=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x2c97b4(0x139),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x2c97b4(0xf2)](_0xc1d88e)}),_0x4cddad=Date[_0x2c97b4(0xd2)]()-_0x559a49;console[_0x2c97b4(0x107)](_0x2c97b4(0xe6)),console[_0x2c97b4(0x107)](_0x2c97b4(0x11f),_0x29acd2[_0x2c97b4(0x150)]),console[_0x2c97b4(0x107)](_0x2c97b4(0x10e),_0x29acd2[_0x2c97b4(0x10f)]),console[_0x2c97b4(0x107)]('Headers:',Object[_0x2c97b4(0x10b)](_0x29acd2[_0x2c97b4(0x131)]['entries']())),console[_0x2c97b4(0x107)](_0x2c97b4(0x149),_0x4cddad+'ms');const _0x415ef3=await _0x29acd2['text']();console['log']('Raw\x20Response\x20Body:',_0x415ef3);if(!_0x29acd2['ok']){console['error'](_0x2c97b4(0x126)),console['error']('HTTP\x20Status:',_0x29acd2['status']),console[_0x2c97b4(0x119)](_0x2c97b4(0xef),_0x415ef3),loggerService_1[_0x2c97b4(0xfe)]['logWhiteDomainResponse']('cointopay',_0x2c97b4(0x104),_0x29acd2['status'],_0x415ef3,_0x4cddad),loggerService_1[_0x2c97b4(0xfe)][_0x2c97b4(0x137)](_0x2c97b4(0x15c),'/create',_0x2c97b4(0x134)+_0x29acd2[_0x2c97b4(0x150)]+':\x20'+_0x415ef3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x29acd2[_0x2c97b4(0x150)]+_0x2c97b4(0x105)+_0x415ef3);}let _0x5aac06;try{_0x5aac06=JSON[_0x2c97b4(0x124)](_0x415ef3);}catch(_0x2dd74b){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2dd74b),loggerService_1[_0x2c97b4(0xfe)][_0x2c97b4(0x137)]('cointopay',_0x2c97b4(0x104),'JSON\x20Parse\x20Error:\x20'+_0x2dd74b);throw new Error(_0x2c97b4(0xf1)+_0x415ef3);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x2c97b4(0xf2)](_0x5aac06,null,0x2)),loggerService_1['loggerService'][_0x2c97b4(0xe9)]('cointopay',_0x2c97b4(0x104),_0x29acd2['status'],_0x5aac06,_0x4cddad);if(_0x5aac06['error']){const _0x113322=_0x5aac06[_0x2c97b4(0x14b)]||_0x5aac06[_0x2c97b4(0x119)]||_0x2c97b4(0x125);console[_0x2c97b4(0x119)](_0x2c97b4(0x144)),console[_0x2c97b4(0x119)](_0x2c97b4(0x11a),_0x113322),loggerService_1['loggerService'][_0x2c97b4(0x137)](_0x2c97b4(0x15c),_0x2c97b4(0x104),_0x2c97b4(0x10d)+_0x113322);throw new Error(_0x2c97b4(0x147)+_0x113322);}if(!_0x5aac06[_0x2c97b4(0x135)]||!_0x5aac06[_0x2c97b4(0xfc)]){console[_0x2c97b4(0x119)](_0x2c97b4(0x13f)),console[_0x2c97b4(0x119)](_0x2c97b4(0x154)),console['error'](_0x2c97b4(0x111),_0x5aac06),loggerService_1['loggerService'][_0x2c97b4(0x137)](_0x2c97b4(0x15c),_0x2c97b4(0x104),_0x2c97b4(0xe5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x2c97b4(0x107)](_0x2c97b4(0x10a)),console['log'](_0x2c97b4(0x132),_0x5aac06[_0x2c97b4(0xfc)]),console[_0x2c97b4(0x107)]('Payment\x20URL\x20(original):',_0x5aac06[_0x2c97b4(0x135)]);const _0x56f7ff=_0x5aac06['payment_url']+_0x2c97b4(0x123);return console[_0x2c97b4(0x107)](_0x2c97b4(0x155),_0x56f7ff),console[_0x2c97b4(0x107)](_0x2c97b4(0x136),_0x580005,_0x2c97b4(0x146)),{'gateway_payment_id':_0x5aac06[_0x2c97b4(0xfc)],'payment_url':_0x56f7ff};}catch(_0x26e20c){console[_0x2c97b4(0x119)](_0x2c97b4(0x100)),console[_0x2c97b4(0x119)](_0x2c97b4(0x13c),_0x26e20c),loggerService_1['loggerService'][_0x2c97b4(0x137)](_0x2c97b4(0x15c),_0x2c97b4(0x104),_0x26e20c);if(_0x26e20c instanceof Error){console[_0x2c97b4(0x119)](_0x2c97b4(0x12c),_0x26e20c[_0x2c97b4(0x14b)]),console[_0x2c97b4(0x119)](_0x2c97b4(0x12f),_0x26e20c[_0x2c97b4(0x114)]);throw new Error(_0x2c97b4(0xf5)+_0x26e20c['message']);}throw new Error(_0x2c97b4(0x11d));}}async[a49_0x1e65bf(0x115)](_0x553268){const _0x1b246a=a49_0x1e65bf,_0x24ceec=Date[_0x1b246a(0xd2)]();try{console[_0x1b246a(0x107)](_0x1b246a(0xd7)+_0x553268);const _0x2980f6={'gatewayPaymentId':_0x553268};loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0x112)](_0x1b246a(0x15c),'/status',_0x1b246a(0xeb),_0x2980f6);const _0x28e05d=await fetch(this[_0x1b246a(0x110)],{'method':_0x1b246a(0xeb),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1b246a(0xea)},'body':JSON[_0x1b246a(0xf2)](_0x2980f6)}),_0x225b01=Date[_0x1b246a(0xd2)]()-_0x24ceec;console[_0x1b246a(0x107)](_0x1b246a(0x12e)),console[_0x1b246a(0x107)](_0x1b246a(0x11f),_0x28e05d[_0x1b246a(0x150)]),console[_0x1b246a(0x107)](_0x1b246a(0x149),_0x225b01+'ms');if(!_0x28e05d['ok']){const _0x1f400f=await _0x28e05d[_0x1b246a(0x157)]();console['error'](_0x1b246a(0xec),_0x28e05d[_0x1b246a(0x150)]),console[_0x1b246a(0x119)](_0x1b246a(0xef),_0x1f400f),loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0xe9)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x28e05d[_0x1b246a(0x150)],_0x1f400f,_0x225b01),loggerService_1['loggerService'][_0x1b246a(0x137)](_0x1b246a(0x15c),'/status','HTTP\x20'+_0x28e05d[_0x1b246a(0x150)]+':\x20'+_0x1f400f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x28e05d[_0x1b246a(0x150)]);}const _0x23b4c5=await _0x28e05d['text']();console[_0x1b246a(0x107)](_0x1b246a(0x133),_0x23b4c5);let _0x5407df;try{_0x5407df=JSON['parse'](_0x23b4c5);}catch(_0x5cabf3){console[_0x1b246a(0x119)](_0x1b246a(0xfd),_0x5cabf3),loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0x137)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x1b246a(0x130)+_0x5cabf3);throw new Error(_0x1b246a(0x14d)+_0x23b4c5);}loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0xe9)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x28e05d['status'],_0x5407df,_0x225b01),console[_0x1b246a(0x107)](_0x1b246a(0x11e)),console['log'](_0x1b246a(0xe1),_0x5407df['result']),console[_0x1b246a(0x107)](_0x1b246a(0xfb),_0x5407df[_0x1b246a(0x158)]),console['log'](_0x1b246a(0x13e),_0x5407df[_0x1b246a(0x11c)]?.[_0x1b246a(0xdc)]),console[_0x1b246a(0x107)](_0x1b246a(0x136),_0x5407df[_0x1b246a(0x11c)]?.[_0x1b246a(0x14c)]),console[_0x1b246a(0x107)]('Currency:',_0x5407df[_0x1b246a(0x11c)]?.['inputCurrency']);if(_0x5407df[_0x1b246a(0x103)]!=='success'||_0x5407df['status_code']!==0xc8){const _0x3c2a6a=_0x5407df[_0x1b246a(0x14b)]||_0x1b246a(0x12b);console[_0x1b246a(0x119)](_0x1b246a(0xee)),console[_0x1b246a(0x119)]('Error\x20Message:',_0x3c2a6a),loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0x137)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x1b246a(0xd6)+_0x3c2a6a);throw new Error(_0x1b246a(0xd4)+_0x3c2a6a);}if(!_0x5407df[_0x1b246a(0x11c)]){console[_0x1b246a(0x119)](_0x1b246a(0xe8)),console[_0x1b246a(0x119)](_0x1b246a(0xf6)),loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0x137)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x1b246a(0x141));throw new Error(_0x1b246a(0xde));}let _0x36e666=_0x1b246a(0x129);switch(_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xdc)]?.[_0x1b246a(0x128)]()){case'paid':_0x36e666=_0x1b246a(0xe3);break;case _0x1b246a(0x15a):case'failed':case _0x1b246a(0x119):_0x36e666=_0x1b246a(0xdf);break;case _0x1b246a(0x116):case _0x1b246a(0xf3):_0x36e666=_0x1b246a(0x10c);break;case _0x1b246a(0x145):case _0x1b246a(0xf7):case _0x1b246a(0xfa):case _0x1b246a(0x13a):default:_0x36e666='PENDING';break;}let _0x104e80,_0x1fa70b;if(_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xd1)]){const _0x27d4f6=_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xd1)];console['log'](_0x1b246a(0x108),_0x27d4f6);const _0x41c8eb=_0x27d4f6[_0x1b246a(0xe4)](/IBAN\s+([A-Z0-9]+)/i);_0x41c8eb&&(_0x104e80=_0x41c8eb[0x1],console[_0x1b246a(0x107)](_0x1b246a(0x117),_0x104e80)),_0x1fa70b=_0x27d4f6;}const _0x2d3508={'iban':_0x104e80,'bankDetails':_0x1fa70b,'transactionId':_0x5407df[_0x1b246a(0x11c)]['TransactionID'],'coinAddress':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xf8)],'qrCodeUrl':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0x142)],'expiryTime':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xdd)],'createdOn':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0x15b)],'confirmedOn':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0x106)]};console['log'](_0x1b246a(0x159)),console[_0x1b246a(0x107)]('Status:',_0x5407df[_0x1b246a(0x11c)]['Status'],'->',_0x36e666),console[_0x1b246a(0x107)](_0x1b246a(0x136),_0x5407df['data'][_0x1b246a(0x14c)],_0x5407df[_0x1b246a(0x11c)]['inputCurrency']),console[_0x1b246a(0x107)](_0x1b246a(0x13d),_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0xd8)]),console[_0x1b246a(0x107)]('IBAN:',_0x104e80||'not\x20found'),console[_0x1b246a(0x107)](_0x1b246a(0x143),_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0x15b)]),console[_0x1b246a(0x107)](_0x1b246a(0x101),_0x5407df[_0x1b246a(0x11c)]['TransactionConfirmedOn']||_0x1b246a(0xd3));if(_0x5407df['data'][_0x1b246a(0xdc)]?.[_0x1b246a(0x128)]()==='awaiting\x20fiat')console['log'](_0x1b246a(0x120));else _0x5407df['data'][_0x1b246a(0xdc)]?.[_0x1b246a(0x128)]()===_0x1b246a(0x151)&&console[_0x1b246a(0x107)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x36e666,'amount':parseFloat(_0x5407df[_0x1b246a(0x11c)]['Amount'])||undefined,'currency':_0x5407df[_0x1b246a(0x11c)][_0x1b246a(0x12d)]||'EUR','paymentDetails':_0x2d3508};}catch(_0x17b9d4){console[_0x1b246a(0x119)](_0x1b246a(0xd5),_0x17b9d4),loggerService_1[_0x1b246a(0xfe)][_0x1b246a(0x137)](_0x1b246a(0x15c),_0x1b246a(0x13b),_0x17b9d4);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x17b9d4 instanceof Error?_0x17b9d4[_0x1b246a(0x14b)]:_0x1b246a(0x102)));}}async[a49_0x1e65bf(0x152)](_0x5cae51){const _0x47a0b7=a49_0x1e65bf,_0x4c16e9=await this[_0x47a0b7(0x115)](_0x5cae51);return{'status':_0x4c16e9[_0x47a0b7(0x150)],'amount':_0x4c16e9[_0x47a0b7(0x153)],'currency':_0x4c16e9[_0x47a0b7(0x148)]};}async[a49_0x1e65bf(0xf4)](_0x1d1224){const _0x5fef5=a49_0x1e65bf;console[_0x5fef5(0x107)](_0x5fef5(0xff),_0x1d1224);let _0x1c4102='PENDING';switch(_0x1d1224[_0x5fef5(0x150)]?.['toLowerCase']()){case _0x5fef5(0x151):_0x1c4102='PAID';break;case _0x5fef5(0x15a):case _0x5fef5(0x14a):case'error':_0x1c4102=_0x5fef5(0xdf);break;case _0x5fef5(0x116):case _0x5fef5(0xf3):_0x1c4102=_0x5fef5(0x10c);break;case'pending':case _0x5fef5(0x145):case _0x5fef5(0xf7):case'created':default:_0x1c4102=_0x5fef5(0x129);break;}return{'paymentId':_0x1d1224['order_id']||_0x1d1224[_0x5fef5(0xe7)]||'','status':_0x1c4102,'amount':_0x1d1224[_0x5fef5(0x153)],'currency':_0x1d1224[_0x5fef5(0x148)]||'EUR'};}}function a49_0x293a(){const _0x38e92b=['logWhiteDomainError','https://tesoft.uk/gateway/cointopay/status.php','application/json','created','/status','Error\x20details:','Transaction\x20ID:','Payment\x20Status:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','10767825XxoaRJ','Incomplete\x20response:\x20missing\x20data','QRCodeURL','Created\x20On:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','waiting','EUR','CoinToPay\x20API\x20error:\x20','currency','Response\x20Time:','failed','message','Amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Request\x20Body:','2737dtJTgH','status','paid','verifyPayment','amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Payment\x20URL\x20(modified):','\x20EUR','text','status_code','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','cancelled','CreatedOn','cointopay','1798392NJIfxl','463616fGSMSj','defineProperty','PaymentDetail','now','not\x20confirmed','CoinToPay\x20status\x20API\x20error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Status\x20API\x20Error:\x20','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','TransactionID','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','📊\x20Status\x20check\x20URL:','../loggerService','Status','ExpiryTime','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','FAILED','3952767etuEmU','Result:','https://tesoft.uk/gateway/cointopay/','PAID','match','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','Payment\x20System/1.0','POST','HTTP\x20Status:','468008Kmhujm','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Response\x20Body:','apiUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','stringify','timeout','processWebhook','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Missing\x20data\x20in\x20response','awaiting\x20fiat','coinAddress','508kqRfyD','pending','Status\x20Code:','gateway_payment_id','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Confirmed\x20On:','Unknown\x20error','result','/create',',\x20body:\x20','TransactionConfirmedOn','log','🏦\x20Payment\x20Detail:','CoinToPayService','===\x20COINTOPAY\x20SUCCESS\x20===','fromEntries','EXPIRED','Business\x20Error:\x20','Status\x20Text:','statusText','statusUrl','Response\x20data:','logWhiteDomainRequest','🪙\x20Creating\x20CoinToPay\x20payment:\x20','stack','checkPaymentStatus','expired','🏦\x20Extracted\x20IBAN:','createPaymentLink','error','Error\x20Message:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','data','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','1663783cIycmi','90QhnlUS','&alternative=false','parse','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20API\x20ERROR\x20===','10UsDWcG','toLowerCase','PENDING','18MeSlos','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20message:','inputCurrency','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Error\x20stack:','JSON\x20Parse\x20Error:\x20','headers','Gateway\x20Payment\x20ID:','Raw\x20Response\x20Body:','HTTP\x20','payment_url','Amount:'];a49_0x293a=function(){return _0x38e92b;};return a49_0x293a();}exports[a49_0x1e65bf(0x109)]=CoinToPayService;