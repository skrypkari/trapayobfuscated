'use strict';const a40_0x2eacc6=a40_0xbb16;(function(_0x2f5947,_0x6386ef){const _0x4e0292=a40_0xbb16,_0x582289=_0x2f5947();while(!![]){try{const _0x38f531=-parseInt(_0x4e0292(0x1de))/0x1+-parseInt(_0x4e0292(0x228))/0x2+parseInt(_0x4e0292(0x23a))/0x3*(parseInt(_0x4e0292(0x1f5))/0x4)+parseInt(_0x4e0292(0x1dd))/0x5*(parseInt(_0x4e0292(0x21b))/0x6)+-parseInt(_0x4e0292(0x1cb))/0x7*(parseInt(_0x4e0292(0x222))/0x8)+parseInt(_0x4e0292(0x22d))/0x9+parseInt(_0x4e0292(0x1c2))/0xa;if(_0x38f531===_0x6386ef)break;else _0x582289['push'](_0x582289['shift']());}catch(_0x1780e9){_0x582289['push'](_0x582289['shift']());}}}(a40_0xd202,0xec63e));Object[a40_0x2eacc6(0x1ee)](exports,a40_0x2eacc6(0x1f6),{'value':!![]}),exports[a40_0x2eacc6(0x1ec)]=void 0x0;function a40_0xd202(){const _0x10b85d=['createPaymentLink','checkPaymentStatus','awaiting\x20fiat','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','message','===\x20COINTOPAY\x20API\x20ERROR\x20===','headers','CoinToPay\x20status\x20API\x20error:\x20','entries','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20data','HTTP\x20error!\x20status:\x20','/create','pending','result','Response\x20Time:','Unknown\x20error','ExpiryTime','Missing\x20data\x20in\x20response',',\x20body:\x20','waiting','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','paid','POST','Raw\x20Response\x20Body:','cointopay','Response\x20data:','Transaction\x20ID:','failed','1294758pglLas','amount','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status','logWhiteDomainError','24TYXILh','apiUrl','text','Error\x20stack:','QRCodeURL','CoinToPay\x20payment\x20status\x20check\x20error:','2053292YqcgsV','inputCurrency','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','payment_url','FAILED','10232037xDcWIB','../loggerService','logWhiteDomainRequest','üè¶\x20Extracted\x20IBAN:','Failed\x20to\x20parse\x20JSON\x20response:','Created\x20On:','Request\x20Body:','verifyPayment','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status\x20Code:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','2172knWTFT','Amount','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','Payment\x20Status:','error','not\x20found','currency','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20SUCCESS\x20===','application/json','stringify','status','created','Headers:','toLowerCase','634320cJURXW','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','EXPIRED','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','parse','Amount:','Parsed\x20Result:','475538vYzpXM','TesSoft\x20Payment\x20System/1.0','üè¶\x20Payment\x20Detail:','gateway_payment_id','Payment\x20URL:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','merchant_reference_id','log','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','cancelled','\x20EUR','Response\x20Body:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','CreatedOn','order_id','stack','statusUrl','10EztFnl','1319953ITLdMO','https://tesoft.uk/gateway/cointopay/status.php','TransactionConfirmedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','timeout','loggerService','PENDING','TransactionID','PaymentDetail','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','IBAN:','data','CoinToPayService','JSON\x20Parse\x20Error:\x20','defineProperty','expired','Business\x20Error:\x20','Error\x20Message:','Error\x20details:','URL:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','10424zVOFre','__esModule','CoinToPay\x20API\x20error:\x20','match','/status','success','PAID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainResponse'];a40_0xd202=function(){return _0x10b85d;};return a40_0xd202();}function a40_0xbb16(_0x599b94,_0x65aa0e){const _0xd202b6=a40_0xd202();return a40_0xbb16=function(_0xbb16c3,_0x45e219){_0xbb16c3=_0xbb16c3-0x1c1;let _0x5bc6ce=_0xd202b6[_0xbb16c3];return _0x5bc6ce;},a40_0xbb16(_0x599b94,_0x65aa0e);}const loggerService_1=require(a40_0x2eacc6(0x22e));class CoinToPayService{constructor(){const _0x58f714=a40_0x2eacc6;this['apiUrl']=_0x58f714(0x1d3),this[_0x58f714(0x1dc)]=_0x58f714(0x1df),console[_0x58f714(0x1d2)](_0x58f714(0x1d0)),console[_0x58f714(0x1d2)]('üìä\x20Status\x20check\x20URL:',this[_0x58f714(0x1dc)]);}async[a40_0x2eacc6(0x1fe)](_0x3236e3){const _0x4b7fb8=a40_0x2eacc6,{orderId:_0x3644ed,amount:_0x1f2144}=_0x3236e3;console[_0x4b7fb8(0x1d2)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x1f2144+_0x4b7fb8(0x1d6));const _0x3f455a={'amount':_0x1f2144},_0x51d2fc=Date[_0x4b7fb8(0x23d)]();try{console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1c6)),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1f3),this[_0x4b7fb8(0x223)]),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x233),JSON['stringify'](_0x3f455a,null,0x2)),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1c9),_0x1f2144,_0x4b7fb8(0x1e7)),loggerService_1[_0x4b7fb8(0x1e3)][_0x4b7fb8(0x22f)](_0x4b7fb8(0x217),_0x4b7fb8(0x20a),_0x4b7fb8(0x215),_0x3f455a);const _0x59c063=await fetch(this[_0x4b7fb8(0x223)],{'method':_0x4b7fb8(0x215),'headers':{'Content-Type':_0x4b7fb8(0x244),'Accept':_0x4b7fb8(0x244),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x4b7fb8(0x245)](_0x3f455a)}),_0x23ea46=Date[_0x4b7fb8(0x23d)]()-_0x51d2fc;console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1fc)),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1e8),_0x59c063['status']),console['log']('Status\x20Text:',_0x59c063['statusText']),console['log'](_0x4b7fb8(0x248),Object['fromEntries'](_0x59c063[_0x4b7fb8(0x204)][_0x4b7fb8(0x206)]())),console[_0x4b7fb8(0x1d2)]('Response\x20Time:',_0x23ea46+'ms');const _0x29e451=await _0x59c063['text']();console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x216),_0x29e451);if(!_0x59c063['ok']){console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x203)),console[_0x4b7fb8(0x23f)]('HTTP\x20Status:',_0x59c063[_0x4b7fb8(0x246)]),console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x1d7),_0x29e451),loggerService_1[_0x4b7fb8(0x1e3)]['logWhiteDomainResponse'](_0x4b7fb8(0x217),'/create',_0x59c063[_0x4b7fb8(0x246)],_0x29e451,_0x23ea46),loggerService_1[_0x4b7fb8(0x1e3)]['logWhiteDomainError'](_0x4b7fb8(0x217),_0x4b7fb8(0x20a),'HTTP\x20'+_0x59c063[_0x4b7fb8(0x246)]+':\x20'+_0x29e451);throw new Error('HTTP\x20error!\x20status:\x20'+_0x59c063[_0x4b7fb8(0x246)]+_0x4b7fb8(0x211)+_0x29e451);}let _0x55556f;try{_0x55556f=JSON[_0x4b7fb8(0x1c8)](_0x29e451);}catch(_0x5d3849){console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x231),_0x5d3849),loggerService_1['loggerService'][_0x4b7fb8(0x221)](_0x4b7fb8(0x217),_0x4b7fb8(0x20a),_0x4b7fb8(0x1ed)+_0x5d3849);throw new Error(_0x4b7fb8(0x201)+_0x29e451);}console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x207)),console['log'](_0x4b7fb8(0x1ca),JSON[_0x4b7fb8(0x245)](_0x55556f,null,0x2)),loggerService_1['loggerService'][_0x4b7fb8(0x1fd)](_0x4b7fb8(0x217),_0x4b7fb8(0x20a),_0x59c063[_0x4b7fb8(0x246)],_0x55556f,_0x23ea46);if(_0x55556f[_0x4b7fb8(0x23f)]){const _0x256349=_0x55556f[_0x4b7fb8(0x202)]||_0x55556f[_0x4b7fb8(0x23f)]||_0x4b7fb8(0x242);console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x1c5)),console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x1f1),_0x256349),loggerService_1[_0x4b7fb8(0x1e3)][_0x4b7fb8(0x221)](_0x4b7fb8(0x217),_0x4b7fb8(0x20a),_0x4b7fb8(0x1f0)+_0x256349);throw new Error(_0x4b7fb8(0x1f7)+_0x256349);}if(!_0x55556f[_0x4b7fb8(0x22b)]||!_0x55556f[_0x4b7fb8(0x1ce)]){console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x213)),console['error'](_0x4b7fb8(0x1e9)),console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x218),_0x55556f),loggerService_1[_0x4b7fb8(0x1e3)]['logWhiteDomainError']('cointopay',_0x4b7fb8(0x20a),_0x4b7fb8(0x21f));throw new Error(_0x4b7fb8(0x238));}return console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x243)),console['log']('Gateway\x20Payment\x20ID:',_0x55556f['gateway_payment_id']),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1cf),_0x55556f[_0x4b7fb8(0x22b)]),console[_0x4b7fb8(0x1d2)](_0x4b7fb8(0x1c9),_0x1f2144,_0x4b7fb8(0x21e)),{'gateway_payment_id':_0x55556f['gateway_payment_id'],'payment_url':_0x55556f[_0x4b7fb8(0x22b)]};}catch(_0x172651){console['error'](_0x4b7fb8(0x235)),console[_0x4b7fb8(0x23f)](_0x4b7fb8(0x1f2),_0x172651),loggerService_1[_0x4b7fb8(0x1e3)][_0x4b7fb8(0x221)]('cointopay',_0x4b7fb8(0x20a),_0x172651);if(_0x172651 instanceof Error){console[_0x4b7fb8(0x23f)]('Error\x20message:',_0x172651[_0x4b7fb8(0x202)]),console['error'](_0x4b7fb8(0x225),_0x172651[_0x4b7fb8(0x1db)]);throw new Error(_0x4b7fb8(0x1e1)+_0x172651['message']);}throw new Error(_0x4b7fb8(0x1d8));}}async[a40_0x2eacc6(0x1ff)](_0x161a21){const _0x19efdc=a40_0x2eacc6,_0x2b7954=Date[_0x19efdc(0x23d)]();try{console[_0x19efdc(0x1d2)](_0x19efdc(0x21d)+_0x161a21);const _0x2c88a0={'gatewayPaymentId':_0x161a21};loggerService_1[_0x19efdc(0x1e3)][_0x19efdc(0x22f)]('cointopay',_0x19efdc(0x1f9),_0x19efdc(0x215),_0x2c88a0);const _0x45faad=await fetch(this[_0x19efdc(0x1dc)],{'method':'POST','headers':{'Content-Type':_0x19efdc(0x244),'Accept':_0x19efdc(0x244),'User-Agent':_0x19efdc(0x1cc)},'body':JSON[_0x19efdc(0x245)](_0x2c88a0)}),_0x1d58fd=Date[_0x19efdc(0x23d)]()-_0x2b7954;console['log'](_0x19efdc(0x1d4)),console['log'](_0x19efdc(0x1e8),_0x45faad[_0x19efdc(0x246)]),console[_0x19efdc(0x1d2)](_0x19efdc(0x20d),_0x1d58fd+'ms');if(!_0x45faad['ok']){const _0x2f7d16=await _0x45faad['text']();console[_0x19efdc(0x23f)]('HTTP\x20Status:',_0x45faad[_0x19efdc(0x246)]),console[_0x19efdc(0x23f)](_0x19efdc(0x1d7),_0x2f7d16),loggerService_1[_0x19efdc(0x1e3)][_0x19efdc(0x1fd)]('cointopay',_0x19efdc(0x1f9),_0x45faad[_0x19efdc(0x246)],_0x2f7d16,_0x1d58fd),loggerService_1[_0x19efdc(0x1e3)]['logWhiteDomainError'](_0x19efdc(0x217),_0x19efdc(0x1f9),'HTTP\x20'+_0x45faad[_0x19efdc(0x246)]+':\x20'+_0x2f7d16);throw new Error(_0x19efdc(0x209)+_0x45faad[_0x19efdc(0x246)]);}const _0x5f1f67=await _0x45faad[_0x19efdc(0x224)]();console['log'](_0x19efdc(0x216),_0x5f1f67);let _0x1ad3d9;try{_0x1ad3d9=JSON[_0x19efdc(0x1c8)](_0x5f1f67);}catch(_0x218cbc){console[_0x19efdc(0x23f)](_0x19efdc(0x231),_0x218cbc),loggerService_1['loggerService'][_0x19efdc(0x221)]('cointopay',_0x19efdc(0x1f9),_0x19efdc(0x1ed)+_0x218cbc);throw new Error(_0x19efdc(0x236)+_0x5f1f67);}loggerService_1[_0x19efdc(0x1e3)][_0x19efdc(0x1fd)](_0x19efdc(0x217),_0x19efdc(0x1f9),_0x45faad[_0x19efdc(0x246)],_0x1ad3d9,_0x1d58fd),console[_0x19efdc(0x1d2)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0x1ad3d9[_0x19efdc(0x20c)]),console[_0x19efdc(0x1d2)](_0x19efdc(0x237),_0x1ad3d9[_0x19efdc(0x239)]),console[_0x19efdc(0x1d2)](_0x19efdc(0x23e),_0x1ad3d9[_0x19efdc(0x1eb)]?.[_0x19efdc(0x220)]),console['log'](_0x19efdc(0x1c9),_0x1ad3d9['data']?.[_0x19efdc(0x23b)]),console[_0x19efdc(0x1d2)]('Currency:',_0x1ad3d9['data']?.[_0x19efdc(0x229)]);if(_0x1ad3d9[_0x19efdc(0x20c)]!==_0x19efdc(0x1fa)||_0x1ad3d9[_0x19efdc(0x239)]!==0xc8){const _0x41aac1=_0x1ad3d9[_0x19efdc(0x202)]||_0x19efdc(0x1c7);console[_0x19efdc(0x23f)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x19efdc(0x1f1),_0x41aac1),loggerService_1['loggerService']['logWhiteDomainError'](_0x19efdc(0x217),_0x19efdc(0x1f9),'Status\x20API\x20Error:\x20'+_0x41aac1);throw new Error(_0x19efdc(0x205)+_0x41aac1);}if(!_0x1ad3d9[_0x19efdc(0x1eb)]){console[_0x19efdc(0x23f)](_0x19efdc(0x23c)),console['error'](_0x19efdc(0x210)),loggerService_1[_0x19efdc(0x1e3)][_0x19efdc(0x221)](_0x19efdc(0x217),_0x19efdc(0x1f9),_0x19efdc(0x208));throw new Error(_0x19efdc(0x1c3));}let _0x250ebb=_0x19efdc(0x1e4);switch(_0x1ad3d9[_0x19efdc(0x1eb)]['Status']?.[_0x19efdc(0x1c1)]()){case _0x19efdc(0x214):_0x250ebb=_0x19efdc(0x1fb);break;case _0x19efdc(0x1d5):case _0x19efdc(0x21a):case'error':_0x250ebb=_0x19efdc(0x22c);break;case _0x19efdc(0x1ef):case _0x19efdc(0x1e2):_0x250ebb='EXPIRED';break;case _0x19efdc(0x212):case'awaiting\x20fiat':case _0x19efdc(0x20b):case'created':default:_0x250ebb='PENDING';break;}let _0x1e12d8,_0x39e1e9;if(_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x1e6)]){const _0x241160=_0x1ad3d9['data'][_0x19efdc(0x1e6)];console[_0x19efdc(0x1d2)](_0x19efdc(0x1cd),_0x241160);const _0x35749a=_0x241160[_0x19efdc(0x1f8)](/IBAN\s+([A-Z0-9]+)/i);_0x35749a&&(_0x1e12d8=_0x35749a[0x1],console['log'](_0x19efdc(0x230),_0x1e12d8)),_0x39e1e9=_0x241160;}const _0x546df7={'iban':_0x1e12d8,'bankDetails':_0x39e1e9,'transactionId':_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x1e5)],'coinAddress':_0x1ad3d9[_0x19efdc(0x1eb)]['coinAddress'],'qrCodeUrl':_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x226)],'expiryTime':_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x20f)],'createdOn':_0x1ad3d9['data'][_0x19efdc(0x1d9)],'confirmedOn':_0x1ad3d9['data'][_0x19efdc(0x1e0)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x19efdc(0x1d2)](_0x19efdc(0x1e8),_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x220)],'->',_0x250ebb),console[_0x19efdc(0x1d2)](_0x19efdc(0x1c9),_0x1ad3d9['data'][_0x19efdc(0x23b)],_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x229)]),console[_0x19efdc(0x1d2)](_0x19efdc(0x219),_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x1e5)]),console[_0x19efdc(0x1d2)](_0x19efdc(0x1ea),_0x1e12d8||_0x19efdc(0x240)),console[_0x19efdc(0x1d2)](_0x19efdc(0x232),_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x1d9)]),console[_0x19efdc(0x1d2)]('Confirmed\x20On:',_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x1e0)]||'not\x20confirmed');if(_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x220)]?.[_0x19efdc(0x1c1)]()==='awaiting\x20fiat')console[_0x19efdc(0x1d2)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x220)]?.[_0x19efdc(0x1c1)]()==='paid'&&console['log'](_0x19efdc(0x1f4));return{'status':_0x250ebb,'amount':parseFloat(_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x23b)])||undefined,'currency':_0x1ad3d9[_0x19efdc(0x1eb)][_0x19efdc(0x229)]||_0x19efdc(0x21e),'paymentDetails':_0x546df7};}catch(_0x1e6d52){console['error'](_0x19efdc(0x227),_0x1e6d52),loggerService_1[_0x19efdc(0x1e3)][_0x19efdc(0x221)](_0x19efdc(0x217),_0x19efdc(0x1f9),_0x1e6d52);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1e6d52 instanceof Error?_0x1e6d52[_0x19efdc(0x202)]:_0x19efdc(0x20e)));}}async[a40_0x2eacc6(0x234)](_0x1b96e4){const _0x27aac4=a40_0x2eacc6,_0x4aa1b3=await this[_0x27aac4(0x1ff)](_0x1b96e4);return{'status':_0x4aa1b3[_0x27aac4(0x246)],'amount':_0x4aa1b3[_0x27aac4(0x21c)],'currency':_0x4aa1b3[_0x27aac4(0x241)]};}async['processWebhook'](_0x3cea8d){const _0x36fe5b=a40_0x2eacc6;console[_0x36fe5b(0x1d2)](_0x36fe5b(0x22a),_0x3cea8d);let _0x2343be=_0x36fe5b(0x1e4);switch(_0x3cea8d[_0x36fe5b(0x246)]?.[_0x36fe5b(0x1c1)]()){case _0x36fe5b(0x214):_0x2343be=_0x36fe5b(0x1fb);break;case _0x36fe5b(0x1d5):case'failed':case _0x36fe5b(0x23f):_0x2343be=_0x36fe5b(0x22c);break;case _0x36fe5b(0x1ef):case _0x36fe5b(0x1e2):_0x2343be=_0x36fe5b(0x1c4);break;case'pending':case _0x36fe5b(0x212):case _0x36fe5b(0x200):case _0x36fe5b(0x247):default:_0x2343be=_0x36fe5b(0x1e4);break;}return{'paymentId':_0x3cea8d[_0x36fe5b(0x1da)]||_0x3cea8d[_0x36fe5b(0x1d1)]||'','status':_0x2343be,'amount':_0x3cea8d[_0x36fe5b(0x21c)],'currency':_0x3cea8d[_0x36fe5b(0x241)]||_0x36fe5b(0x21e)};}}exports[a40_0x2eacc6(0x1ec)]=CoinToPayService;