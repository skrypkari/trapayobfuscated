'use strict';const a43_0x53fae5=a43_0x36df;(function(_0x234a28,_0xdea3ab){const _0x51bfcc=a43_0x36df,_0x1f95bb=_0x234a28();while(!![]){try{const _0x473b13=-parseInt(_0x51bfcc(0x11c))/0x1+parseInt(_0x51bfcc(0x14c))/0x2+-parseInt(_0x51bfcc(0x149))/0x3+parseInt(_0x51bfcc(0xfc))/0x4+-parseInt(_0x51bfcc(0x120))/0x5+parseInt(_0x51bfcc(0x139))/0x6+-parseInt(_0x51bfcc(0xff))/0x7*(-parseInt(_0x51bfcc(0x11f))/0x8);if(_0x473b13===_0xdea3ab)break;else _0x1f95bb['push'](_0x1f95bb['shift']());}catch(_0x252c00){_0x1f95bb['push'](_0x1f95bb['shift']());}}}(a43_0xb526,0xd0832));Object[a43_0x53fae5(0x10d)](exports,'__esModule',{'value':!![]}),exports[a43_0x53fae5(0x131)]=void 0x0;const loggerService_1=require(a43_0x53fae5(0x101));function a43_0xb526(){const _0x4db783=['result','cointopay','Gateway\x20Payment\x20ID:','amount','/create','createPaymentLink','Error\x20Message:','success','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','POST','toLowerCase','defineProperty','Amount','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üìä\x20Status\x20check\x20URL:','payment_url','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','merchant_reference_id','stringify','üè¶\x20Payment\x20Detail:','Response\x20data:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','EXPIRED','TransactionID','1442324qNVRwl','ExpiryTime','Error\x20message:','13192FhjfxK','2745885MMfpRW','timeout','error','failed','logWhiteDomainResponse','HTTP\x20Status:','URL:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','\x20EUR','status_code','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Payment\x20Status:','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','log','CoinToPayService','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Confirmed\x20On:','Amount:','checkPaymentStatus','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','8118078oVMczl','Currency:','processWebhook','parse','HTTP\x20','EUR','IBAN:','waiting','paid','cancelled','logWhiteDomainRequest','Failed\x20to\x20parse\x20JSON\x20response:','not\x20found','expired','currency','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','23727ggNEcB','HTTP\x20error!\x20status:\x20','now','849170XzYVfx','Result:','statusText','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status:','Incomplete\x20response:\x20missing\x20data','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CreatedOn','loggerService','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','gateway_payment_id','status','TesSoft\x20Payment\x20System/1.0','TransactionConfirmedOn','inputCurrency','üè¶\x20Extracted\x20IBAN:','stack','Error\x20stack:','PENDING','text','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','headers','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','https://tesoft.uk/gateway/cointopay/','Unknown\x20error','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','/status','PAID','data','Status\x20Code:','Headers:','FAILED','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20status\x20API\x20error:\x20','statusUrl','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','PaymentDetail','created','Response\x20Time:','3300920apdhMg','application/json','awaiting\x20fiat','1064XgYtzT','message','../loggerService'];a43_0xb526=function(){return _0x4db783;};return a43_0xb526();}class CoinToPayService{constructor(){const _0x5b2f2e=a43_0x53fae5;this['apiUrl']=_0x5b2f2e(0xeb),this['statusUrl']=_0x5b2f2e(0x153),console[_0x5b2f2e(0x130)](_0x5b2f2e(0x111)),console['log'](_0x5b2f2e(0x112),this['statusUrl']);}async[a43_0x53fae5(0x107)](_0x20793f){const _0x46a9ee=a43_0x53fae5,{orderId:_0x3668a5,amount:_0x3badca}=_0x20793f;console[_0x46a9ee(0x130)](_0x46a9ee(0x127)+_0x3badca+_0x46a9ee(0x128));const _0x2153ab={'amount':_0x3badca},_0xb27da0=Date[_0x46a9ee(0x14b)]();try{console[_0x46a9ee(0x130)](_0x46a9ee(0xe5)),console[_0x46a9ee(0x130)](_0x46a9ee(0x126),this['apiUrl']),console['log'](_0x46a9ee(0x12c),JSON[_0x46a9ee(0x116)](_0x2153ab,null,0x2)),console[_0x46a9ee(0x130)](_0x46a9ee(0x134),_0x3badca,_0x46a9ee(0x150)),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x143)]('cointopay',_0x46a9ee(0x106),_0x46a9ee(0x10b),_0x2153ab);const _0x3a6867=await fetch(this['apiUrl'],{'method':_0x46a9ee(0x10b),'headers':{'Content-Type':'application/json','Accept':_0x46a9ee(0xfd),'User-Agent':_0x46a9ee(0xdd)},'body':JSON[_0x46a9ee(0x116)](_0x2153ab)}),_0x196b65=Date[_0x46a9ee(0x14b)]()-_0xb27da0;console[_0x46a9ee(0x130)](_0x46a9ee(0x12a)),console['log'](_0x46a9ee(0x151),_0x3a6867[_0x46a9ee(0xdc)]),console[_0x46a9ee(0x130)]('Status\x20Text:',_0x3a6867[_0x46a9ee(0x14e)]),console[_0x46a9ee(0x130)](_0x46a9ee(0xf2),Object['fromEntries'](_0x3a6867[_0x46a9ee(0xe9)]['entries']())),console[_0x46a9ee(0x130)](_0x46a9ee(0xfb),_0x196b65+'ms');const _0x2dc633=await _0x3a6867[_0x46a9ee(0xe4)]();console[_0x46a9ee(0x130)](_0x46a9ee(0x136),_0x2dc633);if(!_0x3a6867['ok']){console[_0x46a9ee(0x122)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x46a9ee(0x122)](_0x46a9ee(0x125),_0x3a6867[_0x46a9ee(0xdc)]),console['error'](_0x46a9ee(0xf4),_0x2dc633),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x124)](_0x46a9ee(0x103),_0x46a9ee(0x106),_0x3a6867[_0x46a9ee(0xdc)],_0x2dc633,_0x196b65),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x10f)](_0x46a9ee(0x103),'/create',_0x46a9ee(0x13d)+_0x3a6867[_0x46a9ee(0xdc)]+':\x20'+_0x2dc633);throw new Error(_0x46a9ee(0x14a)+_0x3a6867[_0x46a9ee(0xdc)]+_0x46a9ee(0x138)+_0x2dc633);}let _0x56742f;try{_0x56742f=JSON[_0x46a9ee(0x13c)](_0x2dc633);}catch(_0x438ba2){console[_0x46a9ee(0x122)](_0x46a9ee(0x144),_0x438ba2),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x10f)]('cointopay',_0x46a9ee(0x106),'JSON\x20Parse\x20Error:\x20'+_0x438ba2);throw new Error(_0x46a9ee(0xf5)+_0x2dc633);}console[_0x46a9ee(0x130)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x46a9ee(0x130)]('Parsed\x20Result:',JSON[_0x46a9ee(0x116)](_0x56742f,null,0x2)),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x124)]('cointopay',_0x46a9ee(0x106),_0x3a6867['status'],_0x56742f,_0x196b65);if(_0x56742f[_0x46a9ee(0x122)]){const _0x57191b=_0x56742f[_0x46a9ee(0x100)]||_0x56742f[_0x46a9ee(0x122)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x46a9ee(0x114)),console[_0x46a9ee(0x122)](_0x46a9ee(0x108),_0x57191b),loggerService_1[_0x46a9ee(0xd9)]['logWhiteDomainError'](_0x46a9ee(0x103),_0x46a9ee(0x106),'Business\x20Error:\x20'+_0x57191b);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x57191b);}if(!_0x56742f[_0x46a9ee(0x113)]||!_0x56742f[_0x46a9ee(0xdb)]){console[_0x46a9ee(0x122)](_0x46a9ee(0x137)),console[_0x46a9ee(0x122)](_0x46a9ee(0x148)),console[_0x46a9ee(0x122)](_0x46a9ee(0x118),_0x56742f),loggerService_1[_0x46a9ee(0xd9)][_0x46a9ee(0x10f)]('cointopay',_0x46a9ee(0x106),_0x46a9ee(0x12e));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x46a9ee(0x130)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x46a9ee(0x104),_0x56742f['gateway_payment_id']),console[_0x46a9ee(0x130)]('Payment\x20URL:',_0x56742f[_0x46a9ee(0x113)]),console[_0x46a9ee(0x130)](_0x46a9ee(0x134),_0x3badca,_0x46a9ee(0x13e)),{'gateway_payment_id':_0x56742f[_0x46a9ee(0xdb)],'payment_url':_0x56742f[_0x46a9ee(0x113)]};}catch(_0x3f2548){console[_0x46a9ee(0x122)](_0x46a9ee(0x132)),console[_0x46a9ee(0x122)]('Error\x20details:',_0x3f2548),loggerService_1['loggerService'][_0x46a9ee(0x10f)](_0x46a9ee(0x103),_0x46a9ee(0x106),_0x3f2548);if(_0x3f2548 instanceof Error){console[_0x46a9ee(0x122)](_0x46a9ee(0x11e),_0x3f2548[_0x46a9ee(0x100)]),console[_0x46a9ee(0x122)](_0x46a9ee(0xe2),_0x3f2548[_0x46a9ee(0xe1)]);throw new Error(_0x46a9ee(0x154)+_0x3f2548[_0x46a9ee(0x100)]);}throw new Error(_0x46a9ee(0x119));}}async[a43_0x53fae5(0x135)](_0x55c611){const _0x2d9ebe=a43_0x53fae5,_0x39f0d2=Date[_0x2d9ebe(0x14b)]();try{console[_0x2d9ebe(0x130)](_0x2d9ebe(0x14f)+_0x55c611);const _0xe8e9c3={'gatewayPaymentId':_0x55c611};loggerService_1['loggerService'][_0x2d9ebe(0x143)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),'POST',_0xe8e9c3);const _0x3fcf2c=await fetch(this[_0x2d9ebe(0xf7)],{'method':_0x2d9ebe(0x10b),'headers':{'Content-Type':_0x2d9ebe(0xfd),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2d9ebe(0x116)](_0xe8e9c3)}),_0x39f9cc=Date[_0x2d9ebe(0x14b)]()-_0x39f0d2;console[_0x2d9ebe(0x130)](_0x2d9ebe(0x12f)),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x151),_0x3fcf2c[_0x2d9ebe(0xdc)]),console['log']('Response\x20Time:',_0x39f9cc+'ms');if(!_0x3fcf2c['ok']){const _0x121b8c=await _0x3fcf2c[_0x2d9ebe(0xe4)]();console[_0x2d9ebe(0x122)](_0x2d9ebe(0x125),_0x3fcf2c['status']),console[_0x2d9ebe(0x122)](_0x2d9ebe(0xf4),_0x121b8c),loggerService_1[_0x2d9ebe(0xd9)][_0x2d9ebe(0x124)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),_0x3fcf2c['status'],_0x121b8c,_0x39f9cc),loggerService_1[_0x2d9ebe(0xd9)]['logWhiteDomainError'](_0x2d9ebe(0x103),_0x2d9ebe(0xee),_0x2d9ebe(0x13d)+_0x3fcf2c['status']+':\x20'+_0x121b8c);throw new Error(_0x2d9ebe(0x14a)+_0x3fcf2c[_0x2d9ebe(0xdc)]);}const _0xea0a91=await _0x3fcf2c[_0x2d9ebe(0xe4)]();console[_0x2d9ebe(0x130)](_0x2d9ebe(0x136),_0xea0a91);let _0x115c8b;try{_0x115c8b=JSON[_0x2d9ebe(0x13c)](_0xea0a91);}catch(_0x5ad458){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5ad458),loggerService_1[_0x2d9ebe(0xd9)][_0x2d9ebe(0x10f)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),'JSON\x20Parse\x20Error:\x20'+_0x5ad458);throw new Error(_0x2d9ebe(0xea)+_0xea0a91);}loggerService_1['loggerService'][_0x2d9ebe(0x124)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),_0x3fcf2c[_0x2d9ebe(0xdc)],_0x115c8b,_0x39f9cc),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x10a)),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x14d),_0x115c8b[_0x2d9ebe(0x102)]),console[_0x2d9ebe(0x130)](_0x2d9ebe(0xf1),_0x115c8b[_0x2d9ebe(0x129)]),console['log'](_0x2d9ebe(0x12b),_0x115c8b[_0x2d9ebe(0xf0)]?.[_0x2d9ebe(0xe6)]),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x134),_0x115c8b[_0x2d9ebe(0xf0)]?.[_0x2d9ebe(0x10e)]),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x13a),_0x115c8b['data']?.['inputCurrency']);if(_0x115c8b[_0x2d9ebe(0x102)]!==_0x2d9ebe(0x109)||_0x115c8b[_0x2d9ebe(0x129)]!==0xc8){const _0xc2b896=_0x115c8b[_0x2d9ebe(0x100)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x2d9ebe(0x122)](_0x2d9ebe(0xe7)),console[_0x2d9ebe(0x122)]('Error\x20Message:',_0xc2b896),loggerService_1[_0x2d9ebe(0xd9)][_0x2d9ebe(0x10f)]('cointopay','/status','Status\x20API\x20Error:\x20'+_0xc2b896);throw new Error(_0x2d9ebe(0xf6)+_0xc2b896);}if(!_0x115c8b[_0x2d9ebe(0xf0)]){console[_0x2d9ebe(0x122)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2d9ebe(0x122)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x2d9ebe(0xd9)][_0x2d9ebe(0x10f)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),_0x2d9ebe(0x152));throw new Error(_0x2d9ebe(0x110));}let _0x2ca6d5=_0x2d9ebe(0xe3);switch(_0x115c8b['data'][_0x2d9ebe(0xe6)]?.[_0x2d9ebe(0x10c)]()){case _0x2d9ebe(0x141):_0x2ca6d5=_0x2d9ebe(0xef);break;case _0x2d9ebe(0x142):case _0x2d9ebe(0x123):case _0x2d9ebe(0x122):_0x2ca6d5=_0x2d9ebe(0xf3);break;case'expired':case _0x2d9ebe(0x121):_0x2ca6d5='EXPIRED';break;case _0x2d9ebe(0x140):case _0x2d9ebe(0xfe):case'pending':case _0x2d9ebe(0xfa):default:_0x2ca6d5='PENDING';break;}let _0x10df0b,_0xc456d8;if(_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xf9)]){const _0x670acf=_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xf9)];console[_0x2d9ebe(0x130)](_0x2d9ebe(0x117),_0x670acf);const _0xd63a9=_0x670acf['match'](/IBAN\s+([A-Z0-9]+)/i);_0xd63a9&&(_0x10df0b=_0xd63a9[0x1],console[_0x2d9ebe(0x130)](_0x2d9ebe(0xe0),_0x10df0b)),_0xc456d8=_0x670acf;}const _0x4f8410={'iban':_0x10df0b,'bankDetails':_0xc456d8,'transactionId':_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0x11b)],'coinAddress':_0x115c8b['data']['coinAddress'],'qrCodeUrl':_0x115c8b[_0x2d9ebe(0xf0)]['QRCodeURL'],'expiryTime':_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0x11d)],'createdOn':_0x115c8b[_0x2d9ebe(0xf0)]['CreatedOn'],'confirmedOn':_0x115c8b[_0x2d9ebe(0xf0)]['TransactionConfirmedOn']};console['log'](_0x2d9ebe(0x12d)),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x151),_0x115c8b['data'][_0x2d9ebe(0xe6)],'->',_0x2ca6d5),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x134),_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0x10e)],_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xdf)]),console[_0x2d9ebe(0x130)]('Transaction\x20ID:',_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0x11b)]),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x13f),_0x10df0b||_0x2d9ebe(0x145)),console['log']('Created\x20On:',_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xd8)]),console[_0x2d9ebe(0x130)](_0x2d9ebe(0x133),_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xde)]||'not\x20confirmed');if(_0x115c8b['data']['Status']?.[_0x2d9ebe(0x10c)]()===_0x2d9ebe(0xfe))console[_0x2d9ebe(0x130)](_0x2d9ebe(0xed));else _0x115c8b['data'][_0x2d9ebe(0xe6)]?.[_0x2d9ebe(0x10c)]()===_0x2d9ebe(0x141)&&console[_0x2d9ebe(0x130)](_0x2d9ebe(0xe8));return{'status':_0x2ca6d5,'amount':parseFloat(_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0x10e)])||undefined,'currency':_0x115c8b[_0x2d9ebe(0xf0)][_0x2d9ebe(0xdf)]||_0x2d9ebe(0x13e),'paymentDetails':_0x4f8410};}catch(_0xdb189){console[_0x2d9ebe(0x122)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0xdb189),loggerService_1['loggerService'][_0x2d9ebe(0x10f)](_0x2d9ebe(0x103),_0x2d9ebe(0xee),_0xdb189);throw new Error(_0x2d9ebe(0xf8)+(_0xdb189 instanceof Error?_0xdb189[_0x2d9ebe(0x100)]:_0x2d9ebe(0xec)));}}async['verifyPayment'](_0x561d31){const _0x312b7a=a43_0x53fae5,_0x4ff478=await this[_0x312b7a(0x135)](_0x561d31);return{'status':_0x4ff478[_0x312b7a(0xdc)],'amount':_0x4ff478[_0x312b7a(0x105)],'currency':_0x4ff478[_0x312b7a(0x147)]};}async[a43_0x53fae5(0x13b)](_0xf65852){const _0x36f2b4=a43_0x53fae5;console[_0x36f2b4(0x130)](_0x36f2b4(0xda),_0xf65852);let _0x415a20=_0x36f2b4(0xe3);switch(_0xf65852[_0x36f2b4(0xdc)]?.[_0x36f2b4(0x10c)]()){case _0x36f2b4(0x141):_0x415a20=_0x36f2b4(0xef);break;case _0x36f2b4(0x142):case _0x36f2b4(0x123):case'error':_0x415a20=_0x36f2b4(0xf3);break;case _0x36f2b4(0x146):case _0x36f2b4(0x121):_0x415a20=_0x36f2b4(0x11a);break;case'pending':case _0x36f2b4(0x140):case _0x36f2b4(0xfe):case'created':default:_0x415a20=_0x36f2b4(0xe3);break;}return{'paymentId':_0xf65852['order_id']||_0xf65852[_0x36f2b4(0x115)]||'','status':_0x415a20,'amount':_0xf65852['amount'],'currency':_0xf65852[_0x36f2b4(0x147)]||_0x36f2b4(0x13e)};}}function a43_0x36df(_0x4f80f1,_0x1c0fe5){const _0xb52683=a43_0xb526();return a43_0x36df=function(_0x36dfd8,_0x390ae6){_0x36dfd8=_0x36dfd8-0xd8;let _0x996ecb=_0xb52683[_0x36dfd8];return _0x996ecb;},a43_0x36df(_0x4f80f1,_0x1c0fe5);}exports[a43_0x53fae5(0x131)]=CoinToPayService;