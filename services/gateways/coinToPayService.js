'use strict';const a41_0x48190a=a41_0xd62b;(function(_0x19043a,_0x3e5511){const _0x370acc=a41_0xd62b,_0x2f5d0f=_0x19043a();while(!![]){try{const _0x41cad3=-parseInt(_0x370acc(0xd2))/0x1+parseInt(_0x370acc(0xfd))/0x2*(parseInt(_0x370acc(0xf4))/0x3)+-parseInt(_0x370acc(0xa9))/0x4+parseInt(_0x370acc(0xe0))/0x5+-parseInt(_0x370acc(0xa8))/0x6*(-parseInt(_0x370acc(0x8a))/0x7)+parseInt(_0x370acc(0xc0))/0x8+-parseInt(_0x370acc(0xe6))/0x9;if(_0x41cad3===_0x3e5511)break;else _0x2f5d0f['push'](_0x2f5d0f['shift']());}catch(_0x325403){_0x2f5d0f['push'](_0x2f5d0f['shift']());}}}(a41_0x3c19,0x7d90f));function a41_0xd62b(_0x543732,_0x38d49f){const _0x3c1957=a41_0x3c19();return a41_0xd62b=function(_0xd62b06,_0x5bfd2c){_0xd62b06=_0xd62b06-0x7c;let _0x564dc9=_0x3c1957[_0xd62b06];return _0x564dc9;},a41_0xd62b(_0x543732,_0x38d49f);}Object[a41_0x48190a(0xfe)](exports,a41_0x48190a(0xcb),{'value':!![]}),exports[a41_0x48190a(0x95)]=void 0x0;const loggerService_1=require(a41_0x48190a(0x93));function a41_0x3c19(){const _0x44580a=['===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','processWebhook','PENDING','350765bpMEmi','Headers:','Business\x20Error:\x20','headers','not\x20found','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','4320504kkNxXQ','status_code','gateway_payment_id','TransactionConfirmedOn','üìä\x20Status\x20check\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','statusUrl','Status','message','Confirmed\x20On:','Error\x20stack:','20652astPSr','PaymentDetail','createPaymentLink','/create','/status','POST','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Status\x20Code:','38pROqkZ','defineProperty','Gateway\x20Payment\x20ID:','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','data','currency','paid','parse','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','logWhiteDomainResponse','===\x20COINTOPAY\x20SUCCESS\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','CreatedOn','match','\x20EUR','https://tesoft.uk/gateway/cointopay/','57057IkCdQs','EUR','error','===\x20COINTOPAY\x20API\x20ERROR\x20===','Result:','log','Response\x20Body:','PAID','payment_url','../loggerService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','CoinToPayService','HTTP\x20Status:','created','Status:','ExpiryTime','IBAN:','logWhiteDomainError','Status\x20Text:','now','amount','cointopay','TransactionID','timeout','Created\x20On:','Unknown\x20error','EXPIRED','stack','Request\x20Body:','URL:','636XUJNDe','1442916xEAkON',',\x20body:\x20','checkPaymentStatus','Incomplete\x20response:\x20missing\x20data','Transaction\x20ID:','status','Payment\x20URL:','statusText','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Error\x20details:','coinAddress','Payment\x20Status:','https://tesoft.uk/gateway/cointopay/status.php','not\x20confirmed','fromEntries','JSON\x20Parse\x20Error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','apiUrl','QRCodeURL','HTTP\x20error!\x20status:\x20','Failed\x20to\x20parse\x20JSON\x20response:','inputCurrency','expired','7002480TExrWV','Amount:','text','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','awaiting\x20fiat','pending','Parsed\x20Result:','result','loggerService','üè¶\x20Extracted\x20IBAN:','Currency:','__esModule','cancelled','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20API\x20Error:\x20','Error\x20message:','stringify','failed','585161npGrzF','Raw\x20Response\x20Body:','FAILED','application/json','Amount','HTTP\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20Time:','toLowerCase','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','waiting'];a41_0x3c19=function(){return _0x44580a;};return a41_0x3c19();}class CoinToPayService{constructor(){const _0xd476f2=a41_0x48190a;this['apiUrl']=_0xd476f2(0x89),this[_0xd476f2(0xef)]=_0xd476f2(0xb5),console[_0xd476f2(0x8f)](_0xd476f2(0xd8)),console[_0xd476f2(0x8f)](_0xd476f2(0xea),this[_0xd476f2(0xef)]);}async[a41_0x48190a(0xf6)](_0x2b1a13){const _0x2b40a5=a41_0x48190a,{orderId:_0x5745ed,amount:_0x125493}=_0x2b1a13;console[_0x2b40a5(0x8f)](_0x2b40a5(0x80)+_0x125493+_0x2b40a5(0x88));const _0xfe8210={'amount':_0x125493},_0x3e828f=Date['now']();try{console[_0x2b40a5(0x8f)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x2b40a5(0x8f)](_0x2b40a5(0xa7),this['apiUrl']),console[_0x2b40a5(0x8f)](_0x2b40a5(0xa6),JSON['stringify'](_0xfe8210,null,0x2)),console[_0x2b40a5(0x8f)](_0x2b40a5(0xc1),_0x125493,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2b40a5(0xc8)]['logWhiteDomainRequest'](_0x2b40a5(0x9f),_0x2b40a5(0xf7),_0x2b40a5(0xf9),_0xfe8210);const _0x3fc181=await fetch(this[_0x2b40a5(0xba)],{'method':_0x2b40a5(0xf9),'headers':{'Content-Type':_0x2b40a5(0xd5),'Accept':_0x2b40a5(0xd5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2b40a5(0xd0)](_0xfe8210)}),_0xf4689e=Date[_0x2b40a5(0x9d)]()-_0x3e828f;console['log'](_0x2b40a5(0xec)),console['log'](_0x2b40a5(0x98),_0x3fc181['status']),console['log'](_0x2b40a5(0x9c),_0x3fc181[_0x2b40a5(0xb0)]),console[_0x2b40a5(0x8f)](_0x2b40a5(0xe1),Object[_0x2b40a5(0xb7)](_0x3fc181[_0x2b40a5(0xe3)]['entries']())),console[_0x2b40a5(0x8f)](_0x2b40a5(0xd9),_0xf4689e+'ms');const _0x1b7618=await _0x3fc181[_0x2b40a5(0xc2)]();console[_0x2b40a5(0x8f)]('Raw\x20Response\x20Body:',_0x1b7618);if(!_0x3fc181['ok']){console[_0x2b40a5(0x8c)](_0x2b40a5(0x8d)),console['error'](_0x2b40a5(0x96),_0x3fc181[_0x2b40a5(0xae)]),console[_0x2b40a5(0x8c)](_0x2b40a5(0x90),_0x1b7618),loggerService_1[_0x2b40a5(0xc8)][_0x2b40a5(0x81)](_0x2b40a5(0x9f),_0x2b40a5(0xf7),_0x3fc181[_0x2b40a5(0xae)],_0x1b7618,_0xf4689e),loggerService_1[_0x2b40a5(0xc8)][_0x2b40a5(0x9b)](_0x2b40a5(0x9f),_0x2b40a5(0xf7),'HTTP\x20'+_0x3fc181['status']+':\x20'+_0x1b7618);throw new Error(_0x2b40a5(0xbc)+_0x3fc181['status']+_0x2b40a5(0xaa)+_0x1b7618);}let _0x2de32b;try{_0x2de32b=JSON['parse'](_0x1b7618);}catch(_0x1ad89b){console[_0x2b40a5(0x8c)](_0x2b40a5(0xbd),_0x1ad89b),loggerService_1[_0x2b40a5(0xc8)][_0x2b40a5(0x9b)](_0x2b40a5(0x9f),_0x2b40a5(0xf7),_0x2b40a5(0xb8)+_0x1ad89b);throw new Error(_0x2b40a5(0xfb)+_0x1b7618);}console['log'](_0x2b40a5(0x85)),console['log'](_0x2b40a5(0xc6),JSON[_0x2b40a5(0xd0)](_0x2de32b,null,0x2)),loggerService_1[_0x2b40a5(0xc8)]['logWhiteDomainResponse'](_0x2b40a5(0x9f),_0x2b40a5(0xf7),_0x3fc181[_0x2b40a5(0xae)],_0x2de32b,_0xf4689e);if(_0x2de32b[_0x2b40a5(0x8c)]){const _0x479645=_0x2de32b['message']||_0x2de32b[_0x2b40a5(0x8c)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x2b40a5(0x8c)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2b40a5(0x8c)](_0x2b40a5(0xfa),_0x479645),loggerService_1[_0x2b40a5(0xc8)][_0x2b40a5(0x9b)](_0x2b40a5(0x9f),'/create',_0x2b40a5(0xe2)+_0x479645);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x479645);}if(!_0x2de32b[_0x2b40a5(0x92)]||!_0x2de32b['gateway_payment_id']){console[_0x2b40a5(0x8c)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2b40a5(0x8c)](_0x2b40a5(0x83)),console['error'](_0x2b40a5(0x100),_0x2de32b),loggerService_1[_0x2b40a5(0xc8)]['logWhiteDomainError']('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x2b40a5(0x8f)](_0x2b40a5(0x82)),console[_0x2b40a5(0x8f)](_0x2b40a5(0xff),_0x2de32b['gateway_payment_id']),console[_0x2b40a5(0x8f)](_0x2b40a5(0xaf),_0x2de32b['payment_url']),console[_0x2b40a5(0x8f)](_0x2b40a5(0xc1),_0x125493,'EUR'),{'gateway_payment_id':_0x2de32b[_0x2b40a5(0xe8)],'payment_url':_0x2de32b[_0x2b40a5(0x92)]};}catch(_0x4a4880){console[_0x2b40a5(0x8c)](_0x2b40a5(0xee)),console[_0x2b40a5(0x8c)](_0x2b40a5(0xb2),_0x4a4880),loggerService_1[_0x2b40a5(0xc8)][_0x2b40a5(0x9b)](_0x2b40a5(0x9f),_0x2b40a5(0xf7),_0x4a4880);if(_0x4a4880 instanceof Error){console[_0x2b40a5(0x8c)](_0x2b40a5(0xcf),_0x4a4880[_0x2b40a5(0xf1)]),console['error'](_0x2b40a5(0xf3),_0x4a4880[_0x2b40a5(0xa5)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x4a4880[_0x2b40a5(0xf1)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a41_0x48190a(0xab)](_0x506dfd){const _0x3a7d31=a41_0x48190a,_0x483a37=Date[_0x3a7d31(0x9d)]();try{console[_0x3a7d31(0x8f)](_0x3a7d31(0xe5)+_0x506dfd);const _0x1b546d={'gatewayPaymentId':_0x506dfd};loggerService_1[_0x3a7d31(0xc8)]['logWhiteDomainRequest'](_0x3a7d31(0x9f),_0x3a7d31(0xf8),_0x3a7d31(0xf9),_0x1b546d);const _0x51102c=await fetch(this[_0x3a7d31(0xef)],{'method':'POST','headers':{'Content-Type':_0x3a7d31(0xd5),'Accept':_0x3a7d31(0xd5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3a7d31(0xd0)](_0x1b546d)}),_0x2b5da2=Date[_0x3a7d31(0x9d)]()-_0x483a37;console[_0x3a7d31(0x8f)](_0x3a7d31(0xdd)),console[_0x3a7d31(0x8f)]('Status:',_0x51102c['status']),console[_0x3a7d31(0x8f)](_0x3a7d31(0xd9),_0x2b5da2+'ms');if(!_0x51102c['ok']){const _0xf4b61d=await _0x51102c[_0x3a7d31(0xc2)]();console[_0x3a7d31(0x8c)]('HTTP\x20Status:',_0x51102c[_0x3a7d31(0xae)]),console[_0x3a7d31(0x8c)](_0x3a7d31(0x90),_0xf4b61d),loggerService_1[_0x3a7d31(0xc8)]['logWhiteDomainResponse']('cointopay',_0x3a7d31(0xf8),_0x51102c['status'],_0xf4b61d,_0x2b5da2),loggerService_1['loggerService'][_0x3a7d31(0x9b)](_0x3a7d31(0x9f),'/status',_0x3a7d31(0xd7)+_0x51102c[_0x3a7d31(0xae)]+':\x20'+_0xf4b61d);throw new Error(_0x3a7d31(0xbc)+_0x51102c[_0x3a7d31(0xae)]);}const _0x71e66f=await _0x51102c[_0x3a7d31(0xc2)]();console['log'](_0x3a7d31(0xd3),_0x71e66f);let _0x25ebae;try{_0x25ebae=JSON[_0x3a7d31(0x7f)](_0x71e66f);}catch(_0x47a3b6){console[_0x3a7d31(0x8c)](_0x3a7d31(0xbd),_0x47a3b6),loggerService_1[_0x3a7d31(0xc8)][_0x3a7d31(0x9b)]('cointopay','/status',_0x3a7d31(0xb8)+_0x47a3b6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x71e66f);}loggerService_1[_0x3a7d31(0xc8)][_0x3a7d31(0x81)]('cointopay',_0x3a7d31(0xf8),_0x51102c[_0x3a7d31(0xae)],_0x25ebae,_0x2b5da2),console[_0x3a7d31(0x8f)](_0x3a7d31(0xdb)),console[_0x3a7d31(0x8f)](_0x3a7d31(0x8e),_0x25ebae[_0x3a7d31(0xc7)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0xfc),_0x25ebae[_0x3a7d31(0xe7)]),console['log'](_0x3a7d31(0xb4),_0x25ebae[_0x3a7d31(0x7c)]?.[_0x3a7d31(0xf0)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0xc1),_0x25ebae[_0x3a7d31(0x7c)]?.[_0x3a7d31(0xd6)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0xca),_0x25ebae['data']?.[_0x3a7d31(0xbe)]);if(_0x25ebae[_0x3a7d31(0xc7)]!=='success'||_0x25ebae[_0x3a7d31(0xe7)]!==0xc8){const _0x240810=_0x25ebae[_0x3a7d31(0xf1)]||_0x3a7d31(0x94);console[_0x3a7d31(0x8c)](_0x3a7d31(0xc3)),console[_0x3a7d31(0x8c)]('Error\x20Message:',_0x240810),loggerService_1[_0x3a7d31(0xc8)][_0x3a7d31(0x9b)](_0x3a7d31(0x9f),_0x3a7d31(0xf8),_0x3a7d31(0xce)+_0x240810);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x240810);}if(!_0x25ebae[_0x3a7d31(0x7c)]){console[_0x3a7d31(0x8c)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3a7d31(0x8c)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x3a7d31(0xc8)]['logWhiteDomainError'](_0x3a7d31(0x9f),_0x3a7d31(0xf8),_0x3a7d31(0xac));throw new Error(_0x3a7d31(0xeb));}let _0x106aec='PENDING';switch(_0x25ebae[_0x3a7d31(0x7c)]['Status']?.[_0x3a7d31(0xda)]()){case _0x3a7d31(0x7e):_0x106aec=_0x3a7d31(0x91);break;case'cancelled':case _0x3a7d31(0xd1):case _0x3a7d31(0x8c):_0x106aec=_0x3a7d31(0xd4);break;case'expired':case _0x3a7d31(0xa1):_0x106aec=_0x3a7d31(0xa4);break;case _0x3a7d31(0xdc):case _0x3a7d31(0xc4):case _0x3a7d31(0xc5):case'created':default:_0x106aec=_0x3a7d31(0xdf);break;}let _0x37d665,_0x3ab3fc;if(_0x25ebae['data'][_0x3a7d31(0xf5)]){const _0x174773=_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xf5)];console[_0x3a7d31(0x8f)]('üè¶\x20Payment\x20Detail:',_0x174773);const _0x49e731=_0x174773[_0x3a7d31(0x87)](/IBAN\s+([A-Z0-9]+)/i);_0x49e731&&(_0x37d665=_0x49e731[0x1],console[_0x3a7d31(0x8f)](_0x3a7d31(0xc9),_0x37d665)),_0x3ab3fc=_0x174773;}const _0x55afbf={'iban':_0x37d665,'bankDetails':_0x3ab3fc,'transactionId':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xa0)],'coinAddress':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xb3)],'qrCodeUrl':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xbb)],'expiryTime':_0x25ebae['data'][_0x3a7d31(0x99)],'createdOn':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0x86)],'confirmedOn':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xe9)]};console[_0x3a7d31(0x8f)](_0x3a7d31(0x101)),console[_0x3a7d31(0x8f)]('Status:',_0x25ebae[_0x3a7d31(0x7c)]['Status'],'->',_0x106aec),console[_0x3a7d31(0x8f)](_0x3a7d31(0xc1),_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xd6)],_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xbe)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0xad),_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xa0)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0x9a),_0x37d665||_0x3a7d31(0xe4)),console[_0x3a7d31(0x8f)](_0x3a7d31(0xa2),_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0x86)]),console[_0x3a7d31(0x8f)](_0x3a7d31(0xf2),_0x25ebae['data'][_0x3a7d31(0xe9)]||_0x3a7d31(0xb6));if(_0x25ebae['data'][_0x3a7d31(0xf0)]?.[_0x3a7d31(0xda)]()===_0x3a7d31(0xc4))console[_0x3a7d31(0x8f)](_0x3a7d31(0xed));else _0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xf0)]?.['toLowerCase']()===_0x3a7d31(0x7e)&&console['log'](_0x3a7d31(0x84));return{'status':_0x106aec,'amount':parseFloat(_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xd6)])||undefined,'currency':_0x25ebae[_0x3a7d31(0x7c)][_0x3a7d31(0xbe)]||'EUR','paymentDetails':_0x55afbf};}catch(_0x348975){console[_0x3a7d31(0x8c)](_0x3a7d31(0xb9),_0x348975),loggerService_1[_0x3a7d31(0xc8)][_0x3a7d31(0x9b)](_0x3a7d31(0x9f),_0x3a7d31(0xf8),_0x348975);throw new Error(_0x3a7d31(0xb1)+(_0x348975 instanceof Error?_0x348975[_0x3a7d31(0xf1)]:_0x3a7d31(0xa3)));}}async['verifyPayment'](_0x108544){const _0x9e4dd5=a41_0x48190a,_0x4b228f=await this['checkPaymentStatus'](_0x108544);return{'status':_0x4b228f[_0x9e4dd5(0xae)],'amount':_0x4b228f['amount'],'currency':_0x4b228f[_0x9e4dd5(0x7d)]};}async[a41_0x48190a(0xde)](_0x4b809f){const _0x56b86d=a41_0x48190a;console[_0x56b86d(0x8f)](_0x56b86d(0xcd),_0x4b809f);let _0x1abb46='PENDING';switch(_0x4b809f[_0x56b86d(0xae)]?.['toLowerCase']()){case _0x56b86d(0x7e):_0x1abb46='PAID';break;case _0x56b86d(0xcc):case _0x56b86d(0xd1):case _0x56b86d(0x8c):_0x1abb46=_0x56b86d(0xd4);break;case _0x56b86d(0xbf):case _0x56b86d(0xa1):_0x1abb46='EXPIRED';break;case _0x56b86d(0xc5):case _0x56b86d(0xdc):case _0x56b86d(0xc4):case _0x56b86d(0x97):default:_0x1abb46=_0x56b86d(0xdf);break;}return{'paymentId':_0x4b809f['order_id']||_0x4b809f['merchant_reference_id']||'','status':_0x1abb46,'amount':_0x4b809f[_0x56b86d(0x9e)],'currency':_0x4b809f[_0x56b86d(0x7d)]||_0x56b86d(0x8b)};}}exports[a41_0x48190a(0x95)]=CoinToPayService;