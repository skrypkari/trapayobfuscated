'use strict';const a44_0x5e95fc=a44_0x3af3;(function(_0x55591e,_0x3c6c61){const _0x77d5a=a44_0x3af3,_0x18894c=_0x55591e();while(!![]){try{const _0x37255a=-parseInt(_0x77d5a(0x1dd))/0x1+parseInt(_0x77d5a(0x1de))/0x2*(-parseInt(_0x77d5a(0x248))/0x3)+parseInt(_0x77d5a(0x1f6))/0x4*(parseInt(_0x77d5a(0x238))/0x5)+parseInt(_0x77d5a(0x210))/0x6+-parseInt(_0x77d5a(0x1ca))/0x7+parseInt(_0x77d5a(0x203))/0x8*(-parseInt(_0x77d5a(0x1e1))/0x9)+-parseInt(_0x77d5a(0x1d8))/0xa*(-parseInt(_0x77d5a(0x1c6))/0xb);if(_0x37255a===_0x3c6c61)break;else _0x18894c['push'](_0x18894c['shift']());}catch(_0x3eddc3){_0x18894c['push'](_0x18894c['shift']());}}}(a44_0x5c06,0x3a6b1));Object['defineProperty'](exports,a44_0x5e95fc(0x1c5),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a44_0x3af3(_0x4c6bad,_0x3ec815){const _0x5c067d=a44_0x5c06();return a44_0x3af3=function(_0x3af324,_0x3351de){_0x3af324=_0x3af324-0x1c4;let _0x470dc3=_0x5c067d[_0x3af324];return _0x470dc3;},a44_0x3af3(_0x4c6bad,_0x3ec815);}const loggerService_1=require('../loggerService');function a44_0x5c06(){const _0x2624b0=['inputCurrency','coinAddress','FAILED','statusUrl','Incomplete\x20response:\x20missing\x20data','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SUCCESS\x20===','HTTP\x20Status:','now','HTTP\x20error!\x20status:\x20','44mLTnap','Status','not\x20found','TransactionID','status','cancelled','===\x20COINTOPAY\x20API\x20ERROR\x20===','Gateway\x20Payment\x20ID:','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','text','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','awaiting\x20fiat','2527568RjejtD','match','error','Result:','Currency:','PENDING','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','headers','Response\x20data:','processWebhook','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Headers:','2186460IhHCOT','amount','stringify','Status\x20Code:','TransactionConfirmedOn','Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','üè¶\x20Payment\x20Detail:','CoinToPayService','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','gateway_payment_id','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','data','Confirmed\x20On:','application/json','verifyPayment','PaymentDetail','ExpiryTime','failed','logWhiteDomainResponse','Unknown\x20error','CoinToPay\x20status\x20API\x20error:\x20','https://tesoft.uk/gateway/cointopay/','CreatedOn','\x20EUR','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status\x20Text:','Error\x20message:','pending','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EXPIRED','JSON\x20Parse\x20Error:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','merchant_reference_id','currency','timeout','parse','CoinToPay\x20API\x20error:\x20','116030WaXoQe','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','QRCodeURL','created','EUR','message','POST','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Parsed\x20Result:','statusText','toLowerCase','Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Created\x20On:','558114zvzIEb','Amount','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','__esModule','11aiZSGL','Business\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','26271xgyZZR','Unknown\x20error\x20from\x20CoinToPay\x20API','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Raw\x20Response\x20Body:','URL:','log','Error\x20details:','/status','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','/create','expired','PAID','üìä\x20Status\x20check\x20URL:','7443970fGHcXP','cointopay','stack','Response\x20Time:','success','433017RbJTDB','4LcoVMS','apiUrl','createPaymentLink','9wZklCa','Error\x20stack:','Payment\x20URL:','payment_url','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','IBAN:','paid'];a44_0x5c06=function(){return _0x2624b0;};return a44_0x5c06();}class CoinToPayService{constructor(){const _0x29403a=a44_0x5e95fc;this[_0x29403a(0x1df)]=_0x29403a(0x228),this[_0x29403a(0x1ec)]=_0x29403a(0x1f1),console[_0x29403a(0x1cf)](_0x29403a(0x1ee)),console['log'](_0x29403a(0x1d7),this[_0x29403a(0x1ec)]);}async[a44_0x5e95fc(0x1e0)](_0x36de03){const _0x57e5fa=a44_0x5e95fc,{orderId:_0x32a0c7,amount:_0x124793}=_0x36de03;console[_0x57e5fa(0x1cf)](_0x57e5fa(0x20e)+_0x124793+_0x57e5fa(0x22a));const _0x1e5321={'amount':_0x124793},_0xe5d87e=Date[_0x57e5fa(0x1f4)]();try{console['log'](_0x57e5fa(0x1d3)),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1ce),this[_0x57e5fa(0x1df)]),console[_0x57e5fa(0x1cf)]('Request\x20Body:',JSON['stringify'](_0x1e5321,null,0x2)),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x215),_0x124793,_0x57e5fa(0x1c4)),loggerService_1[_0x57e5fa(0x1ef)]['logWhiteDomainRequest'](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x57e5fa(0x23f),_0x1e5321);const _0x18f9a0=await fetch(this['apiUrl'],{'method':_0x57e5fa(0x23f),'headers':{'Content-Type':_0x57e5fa(0x220),'Accept':'application/json','User-Agent':_0x57e5fa(0x1fe)},'body':JSON[_0x57e5fa(0x212)](_0x1e5321)}),_0x3f1924=Date[_0x57e5fa(0x1f4)]()-_0xe5d87e;console['log'](_0x57e5fa(0x22f)),console['log'](_0x57e5fa(0x24b),_0x18f9a0[_0x57e5fa(0x1fa)]),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x22c),_0x18f9a0[_0x57e5fa(0x242)]),console['log'](_0x57e5fa(0x20f),Object['fromEntries'](_0x18f9a0[_0x57e5fa(0x20b)]['entries']())),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1db),_0x3f1924+'ms');const _0x139b1b=await _0x18f9a0[_0x57e5fa(0x200)]();console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1cd),_0x139b1b);if(!_0x18f9a0['ok']){console[_0x57e5fa(0x205)](_0x57e5fa(0x1fc)),console[_0x57e5fa(0x205)](_0x57e5fa(0x1f3),_0x18f9a0[_0x57e5fa(0x1fa)]),console['error'](_0x57e5fa(0x244),_0x139b1b),loggerService_1[_0x57e5fa(0x1ef)][_0x57e5fa(0x225)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x18f9a0[_0x57e5fa(0x1fa)],_0x139b1b,_0x3f1924),loggerService_1[_0x57e5fa(0x1ef)][_0x57e5fa(0x20a)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),'HTTP\x20'+_0x18f9a0['status']+':\x20'+_0x139b1b);throw new Error(_0x57e5fa(0x1f5)+_0x18f9a0[_0x57e5fa(0x1fa)]+',\x20body:\x20'+_0x139b1b);}let _0x10db42;try{_0x10db42=JSON[_0x57e5fa(0x236)](_0x139b1b);}catch(_0x167761){console['error'](_0x57e5fa(0x1c8),_0x167761),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x57e5fa(0x231)+_0x167761);throw new Error(_0x57e5fa(0x216)+_0x139b1b);}console[_0x57e5fa(0x1cf)](_0x57e5fa(0x24c)),console['log'](_0x57e5fa(0x241),JSON[_0x57e5fa(0x212)](_0x10db42,null,0x2)),loggerService_1[_0x57e5fa(0x1ef)][_0x57e5fa(0x225)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x18f9a0['status'],_0x10db42,_0x3f1924);if(_0x10db42[_0x57e5fa(0x205)]){const _0xa529d3=_0x10db42['message']||_0x10db42[_0x57e5fa(0x205)]||_0x57e5fa(0x1cb);console[_0x57e5fa(0x205)](_0x57e5fa(0x21d)),console[_0x57e5fa(0x205)](_0x57e5fa(0x21b),_0xa529d3),loggerService_1['loggerService'][_0x57e5fa(0x20a)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x57e5fa(0x1c7)+_0xa529d3);throw new Error(_0x57e5fa(0x237)+_0xa529d3);}if(!_0x10db42['payment_url']||!_0x10db42[_0x57e5fa(0x21c)]){console[_0x57e5fa(0x205)](_0x57e5fa(0x209)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x57e5fa(0x205)](_0x57e5fa(0x20c),_0x10db42),loggerService_1[_0x57e5fa(0x1ef)][_0x57e5fa(0x20a)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x57e5fa(0x23a));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1f2)),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1fd),_0x10db42[_0x57e5fa(0x21c)]),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x1e3),_0x10db42['payment_url']),console[_0x57e5fa(0x1cf)](_0x57e5fa(0x215),_0x124793,_0x57e5fa(0x23d)),{'gateway_payment_id':_0x10db42[_0x57e5fa(0x21c)],'payment_url':_0x10db42[_0x57e5fa(0x1e4)]};}catch(_0x23d4a9){console[_0x57e5fa(0x205)](_0x57e5fa(0x24a)),console[_0x57e5fa(0x205)](_0x57e5fa(0x1d0),_0x23d4a9),loggerService_1['loggerService'][_0x57e5fa(0x20a)](_0x57e5fa(0x1d9),_0x57e5fa(0x1d4),_0x23d4a9);if(_0x23d4a9 instanceof Error){console[_0x57e5fa(0x205)](_0x57e5fa(0x22d),_0x23d4a9[_0x57e5fa(0x23e)]),console[_0x57e5fa(0x205)](_0x57e5fa(0x1e2),_0x23d4a9[_0x57e5fa(0x1da)]);throw new Error(_0x57e5fa(0x1f0)+_0x23d4a9[_0x57e5fa(0x23e)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x9fc3d1){const _0x21f3b3=a44_0x5e95fc,_0x5701ea=Date[_0x21f3b3(0x1f4)]();try{console[_0x21f3b3(0x1cf)](_0x21f3b3(0x232)+_0x9fc3d1);const _0x1e5937={'gatewayPaymentId':_0x9fc3d1};loggerService_1['loggerService'][_0x21f3b3(0x1ff)](_0x21f3b3(0x1d9),'/status',_0x21f3b3(0x23f),_0x1e5937);const _0x150de7=await fetch(this[_0x21f3b3(0x1ec)],{'method':_0x21f3b3(0x23f),'headers':{'Content-Type':_0x21f3b3(0x220),'Accept':_0x21f3b3(0x220),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x21f3b3(0x212)](_0x1e5937)}),_0x50d2af=Date['now']()-_0x5701ea;console[_0x21f3b3(0x1cf)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x21f3b3(0x1cf)]('Status:',_0x150de7['status']),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x1db),_0x50d2af+'ms');if(!_0x150de7['ok']){const _0x5e3d14=await _0x150de7[_0x21f3b3(0x200)]();console[_0x21f3b3(0x205)]('HTTP\x20Status:',_0x150de7[_0x21f3b3(0x1fa)]),console[_0x21f3b3(0x205)](_0x21f3b3(0x244),_0x5e3d14),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x21f3b3(0x1d1),_0x150de7[_0x21f3b3(0x1fa)],_0x5e3d14,_0x50d2af),loggerService_1[_0x21f3b3(0x1ef)]['logWhiteDomainError'](_0x21f3b3(0x1d9),_0x21f3b3(0x1d1),'HTTP\x20'+_0x150de7['status']+':\x20'+_0x5e3d14);throw new Error(_0x21f3b3(0x1f5)+_0x150de7['status']);}const _0x2b1197=await _0x150de7[_0x21f3b3(0x200)]();console['log'](_0x21f3b3(0x1cd),_0x2b1197);let _0xdf7290;try{_0xdf7290=JSON[_0x21f3b3(0x236)](_0x2b1197);}catch(_0x157efa){console[_0x21f3b3(0x205)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x157efa),loggerService_1[_0x21f3b3(0x1ef)]['logWhiteDomainError'](_0x21f3b3(0x1d9),'/status',_0x21f3b3(0x231)+_0x157efa);throw new Error(_0x21f3b3(0x1e6)+_0x2b1197);}loggerService_1[_0x21f3b3(0x1ef)]['logWhiteDomainResponse'](_0x21f3b3(0x1d9),_0x21f3b3(0x1d1),_0x150de7[_0x21f3b3(0x1fa)],_0xdf7290,_0x50d2af),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x240)),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x206),_0xdf7290['result']),console['log'](_0x21f3b3(0x213),_0xdf7290['status_code']),console['log']('Payment\x20Status:',_0xdf7290['data']?.[_0x21f3b3(0x1f7)]),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x215),_0xdf7290[_0x21f3b3(0x21e)]?.[_0x21f3b3(0x249)]),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x207),_0xdf7290[_0x21f3b3(0x21e)]?.['inputCurrency']);if(_0xdf7290['result']!==_0x21f3b3(0x1dc)||_0xdf7290['status_code']!==0xc8){const _0x43aa35=_0xdf7290[_0x21f3b3(0x23e)]||_0x21f3b3(0x245);console[_0x21f3b3(0x205)](_0x21f3b3(0x246)),console[_0x21f3b3(0x205)](_0x21f3b3(0x21b),_0x43aa35),loggerService_1['loggerService'][_0x21f3b3(0x20a)](_0x21f3b3(0x1d9),_0x21f3b3(0x1d1),_0x21f3b3(0x219)+_0x43aa35);throw new Error(_0x21f3b3(0x227)+_0x43aa35);}if(!_0xdf7290[_0x21f3b3(0x21e)]){console[_0x21f3b3(0x205)](_0x21f3b3(0x21a)),console[_0x21f3b3(0x205)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x21f3b3(0x1ef)][_0x21f3b3(0x20a)]('cointopay',_0x21f3b3(0x1d1),_0x21f3b3(0x1ed));throw new Error(_0x21f3b3(0x1c9));}let _0x3b44c0='PENDING';switch(_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x1f7)]?.[_0x21f3b3(0x243)]()){case _0x21f3b3(0x1e8):_0x3b44c0=_0x21f3b3(0x1d6);break;case'cancelled':case _0x21f3b3(0x224):case'error':_0x3b44c0=_0x21f3b3(0x1eb);break;case _0x21f3b3(0x1d5):case _0x21f3b3(0x235):_0x3b44c0=_0x21f3b3(0x230);break;case'waiting':case _0x21f3b3(0x202):case'pending':case _0x21f3b3(0x23c):default:_0x3b44c0=_0x21f3b3(0x208);break;}let _0x1cd120,_0xcdd8b0;if(_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x222)]){const _0xcbb3cf=_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x222)];console[_0x21f3b3(0x1cf)](_0x21f3b3(0x217),_0xcbb3cf);const _0x21d665=_0xcbb3cf[_0x21f3b3(0x204)](/IBAN\s+([A-Z0-9]+)/i);_0x21d665&&(_0x1cd120=_0x21d665[0x1],console[_0x21f3b3(0x1cf)](_0x21f3b3(0x1d2),_0x1cd120)),_0xcdd8b0=_0xcbb3cf;}const _0x431a66={'iban':_0x1cd120,'bankDetails':_0xcdd8b0,'transactionId':_0xdf7290['data'][_0x21f3b3(0x1f9)],'coinAddress':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x1ea)],'qrCodeUrl':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x23b)],'expiryTime':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x223)],'createdOn':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x229)],'confirmedOn':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x214)]};console[_0x21f3b3(0x1cf)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x21f3b3(0x24b),_0xdf7290['data'][_0x21f3b3(0x1f7)],'->',_0x3b44c0),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x215),_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x249)],_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x1e9)]),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x239),_0xdf7290['data'][_0x21f3b3(0x1f9)]),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x1e7),_0x1cd120||_0x21f3b3(0x1f8)),console[_0x21f3b3(0x1cf)](_0x21f3b3(0x247),_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x229)]),console['log'](_0x21f3b3(0x21f),_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x214)]||'not\x20confirmed');if(_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x1f7)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x21f3b3(0x1cf)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xdf7290[_0x21f3b3(0x21e)]['Status']?.['toLowerCase']()===_0x21f3b3(0x1e8)&&console[_0x21f3b3(0x1cf)](_0x21f3b3(0x1cc));return{'status':_0x3b44c0,'amount':parseFloat(_0xdf7290[_0x21f3b3(0x21e)]['Amount'])||undefined,'currency':_0xdf7290[_0x21f3b3(0x21e)][_0x21f3b3(0x1e9)]||'EUR','paymentDetails':_0x431a66};}catch(_0x1c525c){console[_0x21f3b3(0x205)](_0x21f3b3(0x1e5),_0x1c525c),loggerService_1[_0x21f3b3(0x1ef)][_0x21f3b3(0x20a)](_0x21f3b3(0x1d9),_0x21f3b3(0x1d1),_0x1c525c);throw new Error(_0x21f3b3(0x22b)+(_0x1c525c instanceof Error?_0x1c525c[_0x21f3b3(0x23e)]:_0x21f3b3(0x226)));}}async[a44_0x5e95fc(0x221)](_0x2f2d47){const _0x71a95b=a44_0x5e95fc,_0x3e6329=await this['checkPaymentStatus'](_0x2f2d47);return{'status':_0x3e6329[_0x71a95b(0x1fa)],'amount':_0x3e6329['amount'],'currency':_0x3e6329[_0x71a95b(0x234)]};}async[a44_0x5e95fc(0x20d)](_0x16e9d2){const _0x69e1be=a44_0x5e95fc;console[_0x69e1be(0x1cf)](_0x69e1be(0x201),_0x16e9d2);let _0x2f28d3=_0x69e1be(0x208);switch(_0x16e9d2[_0x69e1be(0x1fa)]?.[_0x69e1be(0x243)]()){case _0x69e1be(0x1e8):_0x2f28d3='PAID';break;case _0x69e1be(0x1fb):case'failed':case'error':_0x2f28d3=_0x69e1be(0x1eb);break;case _0x69e1be(0x1d5):case _0x69e1be(0x235):_0x2f28d3=_0x69e1be(0x230);break;case _0x69e1be(0x22e):case'waiting':case'awaiting\x20fiat':case'created':default:_0x2f28d3=_0x69e1be(0x208);break;}return{'paymentId':_0x16e9d2['order_id']||_0x16e9d2[_0x69e1be(0x233)]||'','status':_0x2f28d3,'amount':_0x16e9d2[_0x69e1be(0x211)],'currency':_0x16e9d2[_0x69e1be(0x234)]||_0x69e1be(0x23d)};}}exports[a44_0x5e95fc(0x218)]=CoinToPayService;