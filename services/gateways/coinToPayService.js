'use strict';const a40_0x53b959=a40_0x1c9e;(function(_0x26edb5,_0x22f541){const _0xf0b8b0=a40_0x1c9e,_0x4cb206=_0x26edb5();while(!![]){try{const _0x5be51a=-parseInt(_0xf0b8b0(0x1c9))/0x1+parseInt(_0xf0b8b0(0x1f8))/0x2*(-parseInt(_0xf0b8b0(0x208))/0x3)+-parseInt(_0xf0b8b0(0x20d))/0x4*(parseInt(_0xf0b8b0(0x20b))/0x5)+-parseInt(_0xf0b8b0(0x1fc))/0x6+parseInt(_0xf0b8b0(0x1df))/0x7+-parseInt(_0xf0b8b0(0x1d3))/0x8*(-parseInt(_0xf0b8b0(0x1e5))/0x9)+parseInt(_0xf0b8b0(0x1ef))/0xa;if(_0x5be51a===_0x22f541)break;else _0x4cb206['push'](_0x4cb206['shift']());}catch(_0x4d7dce){_0x4cb206['push'](_0x4cb206['shift']());}}}(a40_0x59ac,0x1ed63));Object[a40_0x53b959(0x221)](exports,'__esModule',{'value':!![]}),exports[a40_0x53b959(0x23e)]=void 0x0;const loggerService_1=require(a40_0x53b959(0x212));function a40_0x1c9e(_0x555b68,_0x5cf26d){const _0x59ac36=a40_0x59ac();return a40_0x1c9e=function(_0x1c9e44,_0x3a5c73){_0x1c9e44=_0x1c9e44-0x1c7;let _0xd4f5c4=_0x59ac36[_0x1c9e44];return _0xd4f5c4;},a40_0x1c9e(_0x555b68,_0x5cf26d);}class CoinToPayService{constructor(){const _0x28f106=a40_0x53b959;this[_0x28f106(0x1c7)]=_0x28f106(0x1f3),this['statusUrl']=_0x28f106(0x1e7),console[_0x28f106(0x1e4)](_0x28f106(0x1d5)),console[_0x28f106(0x1e4)]('📊\x20Status\x20check\x20URL:',this[_0x28f106(0x21f)]);}async['createPaymentLink'](_0x24ecd6){const _0x52ea51=a40_0x53b959,{orderId:_0x25f9bd,amount:_0x1e5d7d}=_0x24ecd6;console[_0x52ea51(0x1e4)](_0x52ea51(0x207)+_0x1e5d7d+_0x52ea51(0x1f5));const _0x46089b={'amount':_0x1e5d7d},_0x6f5b26=Date[_0x52ea51(0x1cc)]();try{console[_0x52ea51(0x1e4)](_0x52ea51(0x248)),console['log'](_0x52ea51(0x245),this['apiUrl']),console['log'](_0x52ea51(0x206),JSON[_0x52ea51(0x1d8)](_0x46089b,null,0x2)),console[_0x52ea51(0x1e4)]('Amount:',_0x1e5d7d,_0x52ea51(0x1e1)),loggerService_1[_0x52ea51(0x23d)][_0x52ea51(0x1d4)]('cointopay','/create',_0x52ea51(0x244),_0x46089b);const _0x1255d3=await fetch(this[_0x52ea51(0x1c7)],{'method':'POST','headers':{'Content-Type':_0x52ea51(0x210),'Accept':_0x52ea51(0x210),'User-Agent':_0x52ea51(0x1fe)},'body':JSON[_0x52ea51(0x1d8)](_0x46089b)}),_0x15e484=Date['now']()-_0x6f5b26;console['log'](_0x52ea51(0x237)),console[_0x52ea51(0x1e4)](_0x52ea51(0x204),_0x1255d3[_0x52ea51(0x226)]),console[_0x52ea51(0x1e4)](_0x52ea51(0x23f),_0x1255d3[_0x52ea51(0x20a)]),console['log'](_0x52ea51(0x1f7),Object['fromEntries'](_0x1255d3[_0x52ea51(0x1ff)]['entries']())),console['log'](_0x52ea51(0x222),_0x15e484+'ms');const _0x16b90d=await _0x1255d3[_0x52ea51(0x203)]();console['log'](_0x52ea51(0x1f1),_0x16b90d);if(!_0x1255d3['ok']){console[_0x52ea51(0x20e)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x52ea51(0x229),_0x1255d3[_0x52ea51(0x226)]),console[_0x52ea51(0x20e)](_0x52ea51(0x23b),_0x16b90d),loggerService_1[_0x52ea51(0x23d)][_0x52ea51(0x1e2)](_0x52ea51(0x1ee),_0x52ea51(0x201),_0x1255d3[_0x52ea51(0x226)],_0x16b90d,_0x15e484),loggerService_1[_0x52ea51(0x23d)]['logWhiteDomainError'](_0x52ea51(0x1ee),_0x52ea51(0x201),_0x52ea51(0x1e0)+_0x1255d3['status']+':\x20'+_0x16b90d);throw new Error(_0x52ea51(0x236)+_0x1255d3[_0x52ea51(0x226)]+',\x20body:\x20'+_0x16b90d);}let _0x337ce4;try{_0x337ce4=JSON[_0x52ea51(0x22b)](_0x16b90d);}catch(_0x30e79e){console[_0x52ea51(0x20e)](_0x52ea51(0x1ea),_0x30e79e),loggerService_1[_0x52ea51(0x23d)]['logWhiteDomainError'](_0x52ea51(0x1ee),'/create',_0x52ea51(0x228)+_0x30e79e);throw new Error(_0x52ea51(0x24a)+_0x16b90d);}console[_0x52ea51(0x1e4)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x52ea51(0x1da),JSON['stringify'](_0x337ce4,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x52ea51(0x1ee),_0x52ea51(0x201),_0x1255d3[_0x52ea51(0x226)],_0x337ce4,_0x15e484);if(_0x337ce4[_0x52ea51(0x20e)]){const _0x10420c=_0x337ce4[_0x52ea51(0x1cb)]||_0x337ce4[_0x52ea51(0x20e)]||_0x52ea51(0x1e8);console[_0x52ea51(0x20e)](_0x52ea51(0x1f2)),console[_0x52ea51(0x20e)](_0x52ea51(0x1dc),_0x10420c),loggerService_1[_0x52ea51(0x23d)][_0x52ea51(0x227)]('cointopay',_0x52ea51(0x201),_0x52ea51(0x202)+_0x10420c);throw new Error(_0x52ea51(0x20f)+_0x10420c);}if(!_0x337ce4[_0x52ea51(0x225)]||!_0x337ce4[_0x52ea51(0x246)]){console[_0x52ea51(0x20e)](_0x52ea51(0x233)),console[_0x52ea51(0x20e)](_0x52ea51(0x1d0)),console[_0x52ea51(0x20e)](_0x52ea51(0x1d9),_0x337ce4),loggerService_1[_0x52ea51(0x23d)][_0x52ea51(0x227)](_0x52ea51(0x1ee),_0x52ea51(0x201),_0x52ea51(0x215));throw new Error(_0x52ea51(0x243));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x52ea51(0x1e4)](_0x52ea51(0x231),_0x337ce4['gateway_payment_id']),console[_0x52ea51(0x1e4)](_0x52ea51(0x217),_0x337ce4['payment_url']),console['log'](_0x52ea51(0x211),_0x1e5d7d,_0x52ea51(0x22d)),{'gateway_payment_id':_0x337ce4[_0x52ea51(0x246)],'payment_url':_0x337ce4['payment_url']};}catch(_0xf65fed){console['error'](_0x52ea51(0x1dd)),console[_0x52ea51(0x20e)](_0x52ea51(0x242),_0xf65fed),loggerService_1['loggerService'][_0x52ea51(0x227)](_0x52ea51(0x1ee),'/create',_0xf65fed);if(_0xf65fed instanceof Error){console[_0x52ea51(0x20e)](_0x52ea51(0x1e3),_0xf65fed[_0x52ea51(0x1cb)]),console['error'](_0x52ea51(0x1db),_0xf65fed[_0x52ea51(0x22e)]);throw new Error(_0x52ea51(0x1c8)+_0xf65fed[_0x52ea51(0x1cb)]);}throw new Error(_0x52ea51(0x200));}}async[a40_0x53b959(0x1eb)](_0x3f56dc){const _0x18a4f0=a40_0x53b959,_0x3fcd6f=Date[_0x18a4f0(0x1cc)]();try{console[_0x18a4f0(0x1e4)](_0x18a4f0(0x216)+_0x3f56dc);const _0x5f98a2={'gatewayPaymentId':_0x3f56dc};loggerService_1[_0x18a4f0(0x23d)]['logWhiteDomainRequest'](_0x18a4f0(0x1ee),_0x18a4f0(0x1fa),_0x18a4f0(0x244),_0x5f98a2);const _0x22cb46=await fetch(this[_0x18a4f0(0x21f)],{'method':_0x18a4f0(0x244),'headers':{'Content-Type':_0x18a4f0(0x210),'Accept':_0x18a4f0(0x210),'User-Agent':_0x18a4f0(0x1fe)},'body':JSON[_0x18a4f0(0x1d8)](_0x5f98a2)}),_0x3bd5d7=Date[_0x18a4f0(0x1cc)]()-_0x3fcd6f;console[_0x18a4f0(0x1e4)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x204),_0x22cb46[_0x18a4f0(0x226)]),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x222),_0x3bd5d7+'ms');if(!_0x22cb46['ok']){const _0x4b5eb3=await _0x22cb46[_0x18a4f0(0x203)]();console['error'](_0x18a4f0(0x229),_0x22cb46[_0x18a4f0(0x226)]),console['error'](_0x18a4f0(0x23b),_0x4b5eb3),loggerService_1[_0x18a4f0(0x23d)]['logWhiteDomainResponse'](_0x18a4f0(0x1ee),'/status',_0x22cb46[_0x18a4f0(0x226)],_0x4b5eb3,_0x3bd5d7),loggerService_1[_0x18a4f0(0x23d)]['logWhiteDomainError'](_0x18a4f0(0x1ee),_0x18a4f0(0x1fa),_0x18a4f0(0x1e0)+_0x22cb46['status']+':\x20'+_0x4b5eb3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x22cb46[_0x18a4f0(0x226)]);}const _0x2027b8=await _0x22cb46['text']();console[_0x18a4f0(0x1e4)](_0x18a4f0(0x1f1),_0x2027b8);let _0x18af64;try{_0x18af64=JSON[_0x18a4f0(0x22b)](_0x2027b8);}catch(_0x1b04d5){console['error'](_0x18a4f0(0x1ea),_0x1b04d5),loggerService_1[_0x18a4f0(0x23d)][_0x18a4f0(0x227)]('cointopay',_0x18a4f0(0x1fa),_0x18a4f0(0x228)+_0x1b04d5);throw new Error(_0x18a4f0(0x21e)+_0x2027b8);}loggerService_1[_0x18a4f0(0x23d)][_0x18a4f0(0x1e2)](_0x18a4f0(0x1ee),'/status',_0x22cb46[_0x18a4f0(0x226)],_0x18af64,_0x3bd5d7),console['log'](_0x18a4f0(0x1e9)),console[_0x18a4f0(0x1e4)]('Result:',_0x18af64['result']),console['log'](_0x18a4f0(0x1d1),_0x18af64[_0x18a4f0(0x214)]),console['log'](_0x18a4f0(0x1cd),_0x18af64[_0x18a4f0(0x21d)]?.[_0x18a4f0(0x1d2)]),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x211),_0x18af64['data']?.[_0x18a4f0(0x1fd)]),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x1f4),_0x18af64[_0x18a4f0(0x21d)]?.[_0x18a4f0(0x220)]);if(_0x18af64[_0x18a4f0(0x1f0)]!==_0x18a4f0(0x235)||_0x18af64[_0x18a4f0(0x214)]!==0xc8){const _0x444a59=_0x18af64[_0x18a4f0(0x1cb)]||_0x18a4f0(0x239);console['error'](_0x18a4f0(0x1cf)),console[_0x18a4f0(0x20e)](_0x18a4f0(0x1dc),_0x444a59),loggerService_1[_0x18a4f0(0x23d)][_0x18a4f0(0x227)]('cointopay',_0x18a4f0(0x1fa),'Status\x20API\x20Error:\x20'+_0x444a59);throw new Error(_0x18a4f0(0x1ce)+_0x444a59);}if(!_0x18af64['data']){console['error'](_0x18a4f0(0x230)),console[_0x18a4f0(0x20e)](_0x18a4f0(0x22f)),loggerService_1[_0x18a4f0(0x23d)]['logWhiteDomainError'](_0x18a4f0(0x1ee),_0x18a4f0(0x1fa),_0x18a4f0(0x209));throw new Error(_0x18a4f0(0x20c));}let _0x9084db='PENDING';switch(_0x18af64['data']['Status']?.[_0x18a4f0(0x1d7)]()){case _0x18a4f0(0x238):_0x9084db='PAID';break;case'cancelled':case _0x18a4f0(0x232):case _0x18a4f0(0x20e):_0x9084db=_0x18a4f0(0x21c);break;case'expired':case'timeout':_0x9084db=_0x18a4f0(0x205);break;case'waiting':case _0x18a4f0(0x1fb):case _0x18a4f0(0x224):case _0x18a4f0(0x1ec):default:_0x9084db=_0x18a4f0(0x1d6);break;}let _0x4f0e7e,_0x53b88b;if(_0x18af64[_0x18a4f0(0x21d)]['PaymentDetail']){const _0x4d8465=_0x18af64['data']['PaymentDetail'];console[_0x18a4f0(0x1e4)]('🏦\x20Payment\x20Detail:',_0x4d8465);const _0x29b3cc=_0x4d8465[_0x18a4f0(0x1ed)](/IBAN\s+([A-Z0-9]+)/i);_0x29b3cc&&(_0x4f0e7e=_0x29b3cc[0x1],console['log']('🏦\x20Extracted\x20IBAN:',_0x4f0e7e)),_0x53b88b=_0x4d8465;}const _0x3aaf5c={'iban':_0x4f0e7e,'bankDetails':_0x53b88b,'transactionId':_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x1f6)],'coinAddress':_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x1e6)],'qrCodeUrl':_0x18af64['data'][_0x18a4f0(0x223)],'expiryTime':_0x18af64['data'][_0x18a4f0(0x23c)],'createdOn':_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x218)],'confirmedOn':_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x247)]};console[_0x18a4f0(0x1e4)](_0x18a4f0(0x241)),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x204),_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x1d2)],'->',_0x9084db),console['log'](_0x18a4f0(0x211),_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x1fd)],_0x18af64['data'][_0x18a4f0(0x220)]),console['log'](_0x18a4f0(0x249),_0x18af64['data'][_0x18a4f0(0x1f6)]),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x21b),_0x4f0e7e||_0x18a4f0(0x1de)),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x1ca),_0x18af64['data'][_0x18a4f0(0x218)]),console[_0x18a4f0(0x1e4)](_0x18a4f0(0x22a),_0x18af64['data'][_0x18a4f0(0x247)]||_0x18a4f0(0x240));if(_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x1d2)]?.[_0x18a4f0(0x1d7)]()===_0x18a4f0(0x1fb))console[_0x18a4f0(0x1e4)](_0x18a4f0(0x23a));else _0x18af64[_0x18a4f0(0x21d)]['Status']?.[_0x18a4f0(0x1d7)]()==='paid'&&console[_0x18a4f0(0x1e4)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x9084db,'amount':parseFloat(_0x18af64[_0x18a4f0(0x21d)]['Amount'])||undefined,'currency':_0x18af64[_0x18a4f0(0x21d)][_0x18a4f0(0x220)]||_0x18a4f0(0x22d),'paymentDetails':_0x3aaf5c};}catch(_0x211b2d){console[_0x18a4f0(0x20e)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x211b2d),loggerService_1[_0x18a4f0(0x23d)][_0x18a4f0(0x227)]('cointopay',_0x18a4f0(0x1fa),_0x211b2d);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x211b2d instanceof Error?_0x211b2d[_0x18a4f0(0x1cb)]:'Unknown\x20error'));}}async[a40_0x53b959(0x219)](_0x36ab07){const _0x3128c0=a40_0x53b959,_0x3b60e6=await this['checkPaymentStatus'](_0x36ab07);return{'status':_0x3b60e6['status'],'amount':_0x3b60e6[_0x3128c0(0x213)],'currency':_0x3b60e6[_0x3128c0(0x22c)]};}async[a40_0x53b959(0x21a)](_0x2f8732){const _0x166ff7=a40_0x53b959;console[_0x166ff7(0x1e4)](_0x166ff7(0x234),_0x2f8732);let _0x21335d=_0x166ff7(0x1d6);switch(_0x2f8732['status']?.[_0x166ff7(0x1d7)]()){case'paid':_0x21335d=_0x166ff7(0x24b);break;case'cancelled':case _0x166ff7(0x232):case _0x166ff7(0x20e):_0x21335d=_0x166ff7(0x21c);break;case'expired':case'timeout':_0x21335d=_0x166ff7(0x205);break;case _0x166ff7(0x224):case'waiting':case _0x166ff7(0x1fb):case _0x166ff7(0x1ec):default:_0x21335d=_0x166ff7(0x1d6);break;}return{'paymentId':_0x2f8732['order_id']||_0x2f8732[_0x166ff7(0x1f9)]||'','status':_0x21335d,'amount':_0x2f8732[_0x166ff7(0x213)],'currency':_0x2f8732[_0x166ff7(0x22c)]||'EUR'};}}exports[a40_0x53b959(0x23e)]=CoinToPayService;function a40_0x59ac(){const _0x42e7ae=['stack','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','failed','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','success','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','paid','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Response\x20Body:','ExpiryTime','loggerService','CoinToPayService','Status\x20Text:','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Error\x20details:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','URL:','gateway_payment_id','TransactionConfirmedOn','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Transaction\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','PAID','apiUrl','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','177746AYuPOP','Created\x20On:','message','now','Payment\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status\x20Code:','Status','762896Dmiald','logWhiteDomainRequest','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','PENDING','toLowerCase','stringify','Response\x20data:','Parsed\x20Result:','Error\x20stack:','Error\x20Message:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','not\x20found','714420erTBWJ','HTTP\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','logWhiteDomainResponse','Error\x20message:','log','18OAhibg','coinAddress','https://tesoft.uk/gateway/cointopay/status.php','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Failed\x20to\x20parse\x20JSON\x20response:','checkPaymentStatus','created','match','cointopay','1505760zPzSkj','result','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/','Currency:','\x20EUR','TransactionID','Headers:','23222FpewwL','merchant_reference_id','/status','awaiting\x20fiat','318978enwxVT','Amount','TesSoft\x20Payment\x20System/1.0','headers','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','/create','Business\x20Error:\x20','text','Status:','EXPIRED','Request\x20Body:','🪙\x20Creating\x20CoinToPay\x20payment:\x20','6hHKQrF','Incomplete\x20response:\x20missing\x20data','statusText','314610eAjsYf','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','4VfJiHs','error','CoinToPay\x20API\x20error:\x20','application/json','Amount:','../loggerService','amount','status_code','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Payment\x20URL:','CreatedOn','verifyPayment','processWebhook','IBAN:','FAILED','data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','statusUrl','inputCurrency','defineProperty','Response\x20Time:','QRCodeURL','pending','payment_url','status','logWhiteDomainError','JSON\x20Parse\x20Error:\x20','HTTP\x20Status:','Confirmed\x20On:','parse','currency','EUR'];a40_0x59ac=function(){return _0x42e7ae;};return a40_0x59ac();}