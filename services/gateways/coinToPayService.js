'use strict';const a40_0x253622=a40_0x7a5e;(function(_0x41b0f7,_0x49b7c0){const _0x5e7726=a40_0x7a5e,_0x230f05=_0x41b0f7();while(!![]){try{const _0x533d9f=-parseInt(_0x5e7726(0x1e9))/0x1*(parseInt(_0x5e7726(0x1bc))/0x2)+parseInt(_0x5e7726(0x1f9))/0x3+parseInt(_0x5e7726(0x18f))/0x4+-parseInt(_0x5e7726(0x19c))/0x5+parseInt(_0x5e7726(0x18b))/0x6*(parseInt(_0x5e7726(0x1f2))/0x7)+-parseInt(_0x5e7726(0x1e8))/0x8*(parseInt(_0x5e7726(0x1be))/0x9)+-parseInt(_0x5e7726(0x19b))/0xa;if(_0x533d9f===_0x49b7c0)break;else _0x230f05['push'](_0x230f05['shift']());}catch(_0x5af51e){_0x230f05['push'](_0x230f05['shift']());}}}(a40_0x1e0c,0xe211f));function a40_0x7a5e(_0x52e228,_0x24a346){const _0x1e0cfc=a40_0x1e0c();return a40_0x7a5e=function(_0x7a5e8f,_0x1a9db0){_0x7a5e8f=_0x7a5e8f-0x177;let _0x4d84a3=_0x1e0cfc[_0x7a5e8f];return _0x4d84a3;},a40_0x7a5e(_0x52e228,_0x24a346);}Object[a40_0x253622(0x1a6)](exports,a40_0x253622(0x192),{'value':!![]}),exports[a40_0x253622(0x1a1)]=void 0x0;const loggerService_1=require(a40_0x253622(0x1d5));function a40_0x1e0c(){const _0x228d5d=['success','processWebhook','1398bmGeGJ','FAILED','Business\x20Error:\x20','Currency:','1698072LwHaLH','paid','cancelled','__esModule','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Created\x20On:','Incomplete\x20response:\x20missing\x20data','ExpiryTime','toLowerCase','EXPIRED','checkPaymentStatus','17865580ZkLPsZ','924100trNdEG','data','Amount',',\x20body:\x20','expired','CoinToPayService','message','logWhiteDomainResponse','/status','createPaymentLink','defineProperty','Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20error!\x20status:\x20','URL:','not\x20found','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','fromEntries','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','created','POST','logWhiteDomainRequest','Raw\x20Response\x20Body:','HTTP\x20Status:','status_code','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','173758Rfarmg','Error\x20message:','3645lVNIIo','now','headers','currency','not\x20confirmed','amount','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','inputCurrency','failed','Error\x20Message:','cointopay','apiUrl','parse','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','Result:','coinAddress','üè¶\x20Extracted\x20IBAN:','logWhiteDomainError','Status','CoinToPay\x20API\x20error:\x20','../loggerService','statusText','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20Time:','üìä\x20Status\x20check\x20URL:','statusUrl','status','Response\x20Body:','payment_url','IBAN:','JSON\x20Parse\x20Error:\x20','stringify','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Transaction\x20ID:','match','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CreatedOn','Response\x20data:','3520pQHxuo','10tzoeMn','timeout','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','Status\x20Text:','QRCodeURL','https://tesoft.uk/gateway/cointopay/','Unknown\x20error\x20from\x20CoinToPay\x20API','51709eUmUMa','awaiting\x20fiat','PaymentDetail','EUR','application/json','entries','TransactionConfirmedOn','5395986ECIYnz','Request\x20Body:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','result','loggerService','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','gateway_payment_id','Confirmed\x20On:','pending','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Headers:','text','Error\x20details:','/create','üè¶\x20Payment\x20Detail:','Error\x20stack:','PAID','\x20EUR','Payment\x20Status:','waiting','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20ERROR\x20===','log','error'];a40_0x1e0c=function(){return _0x228d5d;};return a40_0x1e0c();}class CoinToPayService{constructor(){const _0x2c5a27=a40_0x253622;this[_0x2c5a27(0x1cb)]=_0x2c5a27(0x1f0),this['statusUrl']=_0x2c5a27(0x193),console['log'](_0x2c5a27(0x1ff)),console[_0x2c5a27(0x187)](_0x2c5a27(0x1d9),this[_0x2c5a27(0x1da)]);}async[a40_0x253622(0x1a5)](_0x3a2ecb){const _0x21adae=a40_0x253622,{orderId:_0x40ffe6,amount:_0x736158}=_0x3a2ecb;console['log'](_0x21adae(0x1fb)+_0x736158+_0x21adae(0x182));const _0x18894a={'amount':_0x736158},_0x4d6b42=Date[_0x21adae(0x1bf)]();try{console[_0x21adae(0x187)](_0x21adae(0x194)),console['log'](_0x21adae(0x1ac),this['apiUrl']),console[_0x21adae(0x187)](_0x21adae(0x1fa),JSON['stringify'](_0x18894a,null,0x2)),console[_0x21adae(0x187)](_0x21adae(0x1b2),_0x736158,_0x21adae(0x1fe)),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1b6)](_0x21adae(0x1ca),'/create','POST',_0x18894a);const _0x41c7af=await fetch(this[_0x21adae(0x1cb)],{'method':'POST','headers':{'Content-Type':_0x21adae(0x1f6),'Accept':_0x21adae(0x1f6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x18894a)}),_0xb0f682=Date['now']()-_0x4d6b42;console['log'](_0x21adae(0x17a)),console['log'](_0x21adae(0x1a7),_0x41c7af[_0x21adae(0x1db)]),console[_0x21adae(0x187)](_0x21adae(0x1ee),_0x41c7af[_0x21adae(0x1d6)]),console[_0x21adae(0x187)](_0x21adae(0x17b),Object[_0x21adae(0x1b0)](_0x41c7af[_0x21adae(0x1c0)][_0x21adae(0x1f7)]())),console[_0x21adae(0x187)](_0x21adae(0x1d8),_0xb0f682+'ms');const _0x1078f5=await _0x41c7af[_0x21adae(0x17c)]();console[_0x21adae(0x187)]('Raw\x20Response\x20Body:',_0x1078f5);if(!_0x41c7af['ok']){console['error'](_0x21adae(0x186)),console['error'](_0x21adae(0x1b8),_0x41c7af[_0x21adae(0x1db)]),console[_0x21adae(0x188)](_0x21adae(0x1dc),_0x1078f5),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1a3)](_0x21adae(0x1ca),'/create',_0x41c7af[_0x21adae(0x1db)],_0x1078f5,_0xb0f682),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1d2)](_0x21adae(0x1ca),_0x21adae(0x17e),_0x21adae(0x1ed)+_0x41c7af[_0x21adae(0x1db)]+':\x20'+_0x1078f5);throw new Error(_0x21adae(0x1ab)+_0x41c7af[_0x21adae(0x1db)]+_0x21adae(0x19f)+_0x1078f5);}let _0x347920;try{_0x347920=JSON['parse'](_0x1078f5);}catch(_0x5b1240){console[_0x21adae(0x188)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5b1240),loggerService_1['loggerService']['logWhiteDomainError'](_0x21adae(0x1ca),'/create',_0x21adae(0x1df)+_0x5b1240);throw new Error(_0x21adae(0x1e5)+_0x1078f5);}console[_0x21adae(0x187)](_0x21adae(0x1c6)),console[_0x21adae(0x187)]('Parsed\x20Result:',JSON[_0x21adae(0x1e0)](_0x347920,null,0x2)),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1a3)]('cointopay',_0x21adae(0x17e),_0x41c7af['status'],_0x347920,_0xb0f682);if(_0x347920['error']){const _0xa8fea7=_0x347920[_0x21adae(0x1a2)]||_0x347920[_0x21adae(0x188)]||_0x21adae(0x1f1);console[_0x21adae(0x188)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x21adae(0x188)](_0x21adae(0x1c9),_0xa8fea7),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1d2)]('cointopay',_0x21adae(0x17e),_0x21adae(0x18d)+_0xa8fea7);throw new Error(_0x21adae(0x1d4)+_0xa8fea7);}if(!_0x347920[_0x21adae(0x1dd)]||!_0x347920['gateway_payment_id']){console[_0x21adae(0x188)](_0x21adae(0x1cd)),console[_0x21adae(0x188)](_0x21adae(0x1e4)),console[_0x21adae(0x188)](_0x21adae(0x1e7),_0x347920),loggerService_1[_0x21adae(0x1fd)]['logWhiteDomainError'](_0x21adae(0x1ca),_0x21adae(0x17e),_0x21adae(0x1b3));throw new Error(_0x21adae(0x1ba));}return console[_0x21adae(0x187)](_0x21adae(0x1af)),console[_0x21adae(0x187)]('Gateway\x20Payment\x20ID:',_0x347920[_0x21adae(0x177)]),console[_0x21adae(0x187)]('Payment\x20URL:',_0x347920[_0x21adae(0x1dd)]),console['log'](_0x21adae(0x1b2),_0x736158,_0x21adae(0x1f5)),{'gateway_payment_id':_0x347920[_0x21adae(0x177)],'payment_url':_0x347920[_0x21adae(0x1dd)]};}catch(_0x492c3d){console[_0x21adae(0x188)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x21adae(0x188)](_0x21adae(0x17d),_0x492c3d),loggerService_1[_0x21adae(0x1fd)][_0x21adae(0x1d2)](_0x21adae(0x1ca),'/create',_0x492c3d);if(_0x492c3d instanceof Error){console[_0x21adae(0x188)](_0x21adae(0x1bd),_0x492c3d[_0x21adae(0x1a2)]),console['error'](_0x21adae(0x180),_0x492c3d['stack']);throw new Error(_0x21adae(0x1ae)+_0x492c3d[_0x21adae(0x1a2)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x253622(0x19a)](_0x1227c7){const _0x46f5ad=a40_0x253622,_0x391e89=Date[_0x46f5ad(0x1bf)]();try{console['log'](_0x46f5ad(0x1c5)+_0x1227c7);const _0x5375d5={'gatewayPaymentId':_0x1227c7};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x46f5ad(0x1ca),_0x46f5ad(0x1a4),_0x46f5ad(0x1b5),_0x5375d5);const _0x5d8baa=await fetch(this[_0x46f5ad(0x1da)],{'method':_0x46f5ad(0x1b5),'headers':{'Content-Type':_0x46f5ad(0x1f6),'Accept':_0x46f5ad(0x1f6),'User-Agent':_0x46f5ad(0x1eb)},'body':JSON[_0x46f5ad(0x1e0)](_0x5375d5)}),_0x51470e=Date[_0x46f5ad(0x1bf)]()-_0x391e89;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x46f5ad(0x187)](_0x46f5ad(0x1a7),_0x5d8baa['status']),console[_0x46f5ad(0x187)]('Response\x20Time:',_0x51470e+'ms');if(!_0x5d8baa['ok']){const _0x125c89=await _0x5d8baa[_0x46f5ad(0x17c)]();console['error']('HTTP\x20Status:',_0x5d8baa[_0x46f5ad(0x1db)]),console[_0x46f5ad(0x188)](_0x46f5ad(0x1dc),_0x125c89),loggerService_1[_0x46f5ad(0x1fd)][_0x46f5ad(0x1a3)](_0x46f5ad(0x1ca),_0x46f5ad(0x1a4),_0x5d8baa[_0x46f5ad(0x1db)],_0x125c89,_0x51470e),loggerService_1[_0x46f5ad(0x1fd)]['logWhiteDomainError']('cointopay','/status','HTTP\x20'+_0x5d8baa[_0x46f5ad(0x1db)]+':\x20'+_0x125c89);throw new Error(_0x46f5ad(0x1ab)+_0x5d8baa[_0x46f5ad(0x1db)]);}const _0x5e6723=await _0x5d8baa[_0x46f5ad(0x17c)]();console[_0x46f5ad(0x187)](_0x46f5ad(0x1b7),_0x5e6723);let _0x176bc6;try{_0x176bc6=JSON[_0x46f5ad(0x1cc)](_0x5e6723);}catch(_0x29245){console[_0x46f5ad(0x188)](_0x46f5ad(0x1d7),_0x29245),loggerService_1['loggerService']['logWhiteDomainError'](_0x46f5ad(0x1ca),'/status',_0x46f5ad(0x1df)+_0x29245);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x5e6723);}loggerService_1['loggerService'][_0x46f5ad(0x1a3)](_0x46f5ad(0x1ca),_0x46f5ad(0x1a4),_0x5d8baa[_0x46f5ad(0x1db)],_0x176bc6,_0x51470e),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x46f5ad(0x187)](_0x46f5ad(0x1cf),_0x176bc6[_0x46f5ad(0x1fc)]),console['log']('Status\x20Code:',_0x176bc6[_0x46f5ad(0x1b9)]),console['log'](_0x46f5ad(0x183),_0x176bc6[_0x46f5ad(0x19d)]?.[_0x46f5ad(0x1d3)]),console['log'](_0x46f5ad(0x1b2),_0x176bc6[_0x46f5ad(0x19d)]?.[_0x46f5ad(0x19e)]),console['log'](_0x46f5ad(0x18e),_0x176bc6[_0x46f5ad(0x19d)]?.[_0x46f5ad(0x1c7)]);if(_0x176bc6['result']!==_0x46f5ad(0x189)||_0x176bc6['status_code']!==0xc8){const _0x56a55a=_0x176bc6[_0x46f5ad(0x1a2)]||_0x46f5ad(0x1a9);console[_0x46f5ad(0x188)](_0x46f5ad(0x1a8)),console[_0x46f5ad(0x188)](_0x46f5ad(0x1c9),_0x56a55a),loggerService_1[_0x46f5ad(0x1fd)][_0x46f5ad(0x1d2)](_0x46f5ad(0x1ca),'/status',_0x46f5ad(0x1ce)+_0x56a55a);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x56a55a);}if(!_0x176bc6['data']){console[_0x46f5ad(0x188)](_0x46f5ad(0x1ec)),console[_0x46f5ad(0x188)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x46f5ad(0x1d2)](_0x46f5ad(0x1ca),'/status',_0x46f5ad(0x196));throw new Error(_0x46f5ad(0x185));}let _0x13f4b7=_0x46f5ad(0x1bb);switch(_0x176bc6['data']['Status']?.[_0x46f5ad(0x198)]()){case'paid':_0x13f4b7=_0x46f5ad(0x181);break;case _0x46f5ad(0x191):case _0x46f5ad(0x1c8):case _0x46f5ad(0x188):_0x13f4b7=_0x46f5ad(0x18c);break;case _0x46f5ad(0x1a0):case'timeout':_0x13f4b7=_0x46f5ad(0x199);break;case _0x46f5ad(0x184):case'awaiting\x20fiat':case _0x46f5ad(0x179):case _0x46f5ad(0x1b4):default:_0x13f4b7=_0x46f5ad(0x1bb);break;}let _0x5e223f,_0x40e3a5;if(_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1f4)]){const _0x3fb63f=_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1f4)];console['log'](_0x46f5ad(0x17f),_0x3fb63f);const _0x1f768a=_0x3fb63f[_0x46f5ad(0x1e3)](/IBAN\s+([A-Z0-9]+)/i);_0x1f768a&&(_0x5e223f=_0x1f768a[0x1],console['log'](_0x46f5ad(0x1d1),_0x5e223f)),_0x40e3a5=_0x3fb63f;}const _0x377042={'iban':_0x5e223f,'bankDetails':_0x40e3a5,'transactionId':_0x176bc6[_0x46f5ad(0x19d)]['TransactionID'],'coinAddress':_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1d0)],'qrCodeUrl':_0x176bc6['data'][_0x46f5ad(0x1ef)],'expiryTime':_0x176bc6['data'][_0x46f5ad(0x197)],'createdOn':_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1e6)],'confirmedOn':_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1f8)]};console[_0x46f5ad(0x187)](_0x46f5ad(0x1c4)),console[_0x46f5ad(0x187)](_0x46f5ad(0x1a7),_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1d3)],'->',_0x13f4b7),console[_0x46f5ad(0x187)]('Amount:',_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x19e)],_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1c7)]),console[_0x46f5ad(0x187)](_0x46f5ad(0x1e2),_0x176bc6[_0x46f5ad(0x19d)]['TransactionID']),console['log'](_0x46f5ad(0x1de),_0x5e223f||_0x46f5ad(0x1ad)),console[_0x46f5ad(0x187)](_0x46f5ad(0x195),_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1e6)]),console[_0x46f5ad(0x187)](_0x46f5ad(0x178),_0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1f8)]||_0x46f5ad(0x1c2));if(_0x176bc6['data'][_0x46f5ad(0x1d3)]?.[_0x46f5ad(0x198)]()===_0x46f5ad(0x1f3))console[_0x46f5ad(0x187)](_0x46f5ad(0x1aa));else _0x176bc6[_0x46f5ad(0x19d)][_0x46f5ad(0x1d3)]?.['toLowerCase']()===_0x46f5ad(0x190)&&console[_0x46f5ad(0x187)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x13f4b7,'amount':parseFloat(_0x176bc6[_0x46f5ad(0x19d)]['Amount'])||undefined,'currency':_0x176bc6['data'][_0x46f5ad(0x1c7)]||_0x46f5ad(0x1f5),'paymentDetails':_0x377042};}catch(_0x120022){console[_0x46f5ad(0x188)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x120022),loggerService_1[_0x46f5ad(0x1fd)]['logWhiteDomainError'](_0x46f5ad(0x1ca),_0x46f5ad(0x1a4),_0x120022);throw new Error(_0x46f5ad(0x1b1)+(_0x120022 instanceof Error?_0x120022['message']:'Unknown\x20error'));}}async['verifyPayment'](_0xad7b65){const _0x156a8a=a40_0x253622,_0xb235ca=await this[_0x156a8a(0x19a)](_0xad7b65);return{'status':_0xb235ca['status'],'amount':_0xb235ca[_0x156a8a(0x1c3)],'currency':_0xb235ca[_0x156a8a(0x1c1)]};}async[a40_0x253622(0x18a)](_0xdbbf3e){const _0x34ab07=a40_0x253622;console[_0x34ab07(0x187)](_0x34ab07(0x1e1),_0xdbbf3e);let _0xa1cc0d=_0x34ab07(0x1bb);switch(_0xdbbf3e[_0x34ab07(0x1db)]?.[_0x34ab07(0x198)]()){case _0x34ab07(0x190):_0xa1cc0d=_0x34ab07(0x181);break;case _0x34ab07(0x191):case _0x34ab07(0x1c8):case _0x34ab07(0x188):_0xa1cc0d=_0x34ab07(0x18c);break;case _0x34ab07(0x1a0):case _0x34ab07(0x1ea):_0xa1cc0d=_0x34ab07(0x199);break;case'pending':case _0x34ab07(0x184):case _0x34ab07(0x1f3):case _0x34ab07(0x1b4):default:_0xa1cc0d=_0x34ab07(0x1bb);break;}return{'paymentId':_0xdbbf3e['order_id']||_0xdbbf3e['merchant_reference_id']||'','status':_0xa1cc0d,'amount':_0xdbbf3e['amount'],'currency':_0xdbbf3e['currency']||_0x34ab07(0x1f5)};}}exports[a40_0x253622(0x1a1)]=CoinToPayService;