'use strict';const a47_0x50c488=a47_0x5aff;function a47_0x5aff(_0xc8162,_0x3d261f){const _0x2f1735=a47_0x2f17();return a47_0x5aff=function(_0x5aff16,_0x34444f){_0x5aff16=_0x5aff16-0x198;let _0x2068c6=_0x2f1735[_0x5aff16];return _0x2068c6;},a47_0x5aff(_0xc8162,_0x3d261f);}(function(_0x52eac1,_0x1376a8){const _0x57b1aa=a47_0x5aff,_0x5eb0d3=_0x52eac1();while(!![]){try{const _0x33b28c=parseInt(_0x57b1aa(0x1b0))/0x1+-parseInt(_0x57b1aa(0x1df))/0x2+-parseInt(_0x57b1aa(0x19f))/0x3*(-parseInt(_0x57b1aa(0x221))/0x4)+-parseInt(_0x57b1aa(0x20e))/0x5+parseInt(_0x57b1aa(0x1b1))/0x6*(parseInt(_0x57b1aa(0x1c8))/0x7)+-parseInt(_0x57b1aa(0x21c))/0x8+parseInt(_0x57b1aa(0x1f0))/0x9;if(_0x33b28c===_0x1376a8)break;else _0x5eb0d3['push'](_0x5eb0d3['shift']());}catch(_0x2d9396){_0x5eb0d3['push'](_0x5eb0d3['shift']());}}}(a47_0x2f17,0x759cc));Object[a47_0x50c488(0x1f5)](exports,a47_0x50c488(0x220),{'value':!![]}),exports[a47_0x50c488(0x1fd)]=void 0x0;const loggerService_1=require(a47_0x50c488(0x1e7));class CoinToPayService{constructor(){const _0x55ad34=a47_0x50c488;this[_0x55ad34(0x21a)]=_0x55ad34(0x1d3),this[_0x55ad34(0x212)]=_0x55ad34(0x1f4),console[_0x55ad34(0x203)](_0x55ad34(0x1c9)),console[_0x55ad34(0x203)](_0x55ad34(0x1ec),this[_0x55ad34(0x212)]);}async[a47_0x50c488(0x1c7)](_0x42d6fa){const _0x589085=a47_0x50c488,{orderId:_0x4443e4,amount:_0x2afdc6}=_0x42d6fa;console['log'](_0x589085(0x210)+_0x2afdc6+_0x589085(0x1cd));const _0x358e2d={'amount':_0x2afdc6},_0x34bbbb=Date[_0x589085(0x213)]();try{console['log'](_0x589085(0x1bc)),console[_0x589085(0x203)]('URL:',this[_0x589085(0x21a)]),console['log'](_0x589085(0x206),JSON[_0x589085(0x1e0)](_0x358e2d,null,0x2)),console[_0x589085(0x203)](_0x589085(0x1ef),_0x2afdc6,_0x589085(0x223)),loggerService_1[_0x589085(0x19d)][_0x589085(0x214)](_0x589085(0x1aa),_0x589085(0x1ac),_0x589085(0x20f),_0x358e2d);const _0xa7e673=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x589085(0x1e0)](_0x358e2d)}),_0x216b55=Date[_0x589085(0x213)]()-_0x34bbbb;console[_0x589085(0x203)](_0x589085(0x1cf)),console[_0x589085(0x203)](_0x589085(0x1d0),_0xa7e673[_0x589085(0x1c1)]),console[_0x589085(0x203)](_0x589085(0x1d1),_0xa7e673['statusText']),console['log'](_0x589085(0x1a2),Object[_0x589085(0x1e4)](_0xa7e673[_0x589085(0x205)]['entries']())),console[_0x589085(0x203)](_0x589085(0x1d7),_0x216b55+'ms');const _0xbb6883=await _0xa7e673[_0x589085(0x1e9)]();console[_0x589085(0x203)]('Raw\x20Response\x20Body:',_0xbb6883);if(!_0xa7e673['ok']){console[_0x589085(0x1d4)](_0x589085(0x222)),console[_0x589085(0x1d4)](_0x589085(0x1b7),_0xa7e673[_0x589085(0x1c1)]),console[_0x589085(0x1d4)](_0x589085(0x1a5),_0xbb6883),loggerService_1[_0x589085(0x19d)][_0x589085(0x1fa)](_0x589085(0x1aa),_0x589085(0x1ac),_0xa7e673[_0x589085(0x1c1)],_0xbb6883,_0x216b55),loggerService_1[_0x589085(0x19d)][_0x589085(0x219)](_0x589085(0x1aa),_0x589085(0x1ac),'HTTP\x20'+_0xa7e673['status']+':\x20'+_0xbb6883);throw new Error(_0x589085(0x1eb)+_0xa7e673[_0x589085(0x1c1)]+_0x589085(0x1c3)+_0xbb6883);}let _0x1a2ebe;try{_0x1a2ebe=JSON['parse'](_0xbb6883);}catch(_0x127b79){console[_0x589085(0x1d4)](_0x589085(0x218),_0x127b79),loggerService_1['loggerService'][_0x589085(0x219)]('cointopay',_0x589085(0x1ac),_0x589085(0x1f9)+_0x127b79);throw new Error(_0x589085(0x1ae)+_0xbb6883);}console[_0x589085(0x203)](_0x589085(0x1ca)),console[_0x589085(0x203)](_0x589085(0x20a),JSON['stringify'](_0x1a2ebe,null,0x2)),loggerService_1[_0x589085(0x19d)][_0x589085(0x1fa)](_0x589085(0x1aa),_0x589085(0x1ac),_0xa7e673['status'],_0x1a2ebe,_0x216b55);if(_0x1a2ebe[_0x589085(0x1d4)]){const _0x5c3b76=_0x1a2ebe['message']||_0x1a2ebe[_0x589085(0x1d4)]||_0x589085(0x1f1);console[_0x589085(0x1d4)](_0x589085(0x1a9)),console[_0x589085(0x1d4)](_0x589085(0x1f3),_0x5c3b76),loggerService_1[_0x589085(0x19d)][_0x589085(0x219)](_0x589085(0x1aa),_0x589085(0x1ac),_0x589085(0x1ee)+_0x5c3b76);throw new Error(_0x589085(0x1f2)+_0x5c3b76);}if(!_0x1a2ebe[_0x589085(0x1af)]||!_0x1a2ebe[_0x589085(0x21f)]){console[_0x589085(0x1d4)](_0x589085(0x19a)),console[_0x589085(0x1d4)](_0x589085(0x1ea)),console['error']('Response\x20data:',_0x1a2ebe),loggerService_1[_0x589085(0x19d)][_0x589085(0x219)]('cointopay',_0x589085(0x1ac),_0x589085(0x1fe));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x589085(0x203)](_0x589085(0x216)),console[_0x589085(0x203)](_0x589085(0x199),_0x1a2ebe[_0x589085(0x21f)]),console['log'](_0x589085(0x1a8),_0x1a2ebe['payment_url']);const _0x1c8b50=_0x1a2ebe[_0x589085(0x1af)]+_0x589085(0x1d9);return console[_0x589085(0x203)](_0x589085(0x1a7),_0x1c8b50),console['log'](_0x589085(0x1ef),_0x2afdc6,'EUR'),{'gateway_payment_id':_0x1a2ebe[_0x589085(0x21f)],'payment_url':_0x1c8b50};}catch(_0x278817){console[_0x589085(0x1d4)](_0x589085(0x1dc)),console[_0x589085(0x1d4)]('Error\x20details:',_0x278817),loggerService_1[_0x589085(0x19d)]['logWhiteDomainError'](_0x589085(0x1aa),_0x589085(0x1ac),_0x278817);if(_0x278817 instanceof Error){console[_0x589085(0x1d4)](_0x589085(0x1f8),_0x278817[_0x589085(0x1bd)]),console[_0x589085(0x1d4)]('Error\x20stack:',_0x278817[_0x589085(0x1a6)]);throw new Error(_0x589085(0x1c6)+_0x278817[_0x589085(0x1bd)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a47_0x50c488(0x1cb)](_0x1f154d){const _0xdb9086=a47_0x50c488,_0x5e31e7=Date['now']();try{console[_0xdb9086(0x203)](_0xdb9086(0x198)+_0x1f154d);const _0x2c3923={'gatewayPaymentId':_0x1f154d};loggerService_1[_0xdb9086(0x19d)][_0xdb9086(0x214)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0xdb9086(0x20f),_0x2c3923);const _0x51ed84=await fetch(this[_0xdb9086(0x212)],{'method':'POST','headers':{'Content-Type':_0xdb9086(0x1d6),'Accept':_0xdb9086(0x1d6),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0xdb9086(0x1e0)](_0x2c3923)}),_0x58ecdb=Date[_0xdb9086(0x213)]()-_0x5e31e7;console['log'](_0xdb9086(0x1ff)),console[_0xdb9086(0x203)](_0xdb9086(0x1d0),_0x51ed84['status']),console[_0xdb9086(0x203)](_0xdb9086(0x1d7),_0x58ecdb+'ms');if(!_0x51ed84['ok']){const _0x31b6ab=await _0x51ed84[_0xdb9086(0x1e9)]();console[_0xdb9086(0x1d4)](_0xdb9086(0x1b7),_0x51ed84['status']),console[_0xdb9086(0x1d4)]('Response\x20Body:',_0x31b6ab),loggerService_1[_0xdb9086(0x19d)]['logWhiteDomainResponse'](_0xdb9086(0x1aa),'/status',_0x51ed84['status'],_0x31b6ab,_0x58ecdb),loggerService_1[_0xdb9086(0x19d)][_0xdb9086(0x219)](_0xdb9086(0x1aa),_0xdb9086(0x19c),'HTTP\x20'+_0x51ed84[_0xdb9086(0x1c1)]+':\x20'+_0x31b6ab);throw new Error(_0xdb9086(0x1eb)+_0x51ed84[_0xdb9086(0x1c1)]);}const _0xa0311f=await _0x51ed84[_0xdb9086(0x1e9)]();console[_0xdb9086(0x203)]('Raw\x20Response\x20Body:',_0xa0311f);let _0x33aadd;try{_0x33aadd=JSON[_0xdb9086(0x1ad)](_0xa0311f);}catch(_0x126425){console[_0xdb9086(0x1d4)](_0xdb9086(0x218),_0x126425),loggerService_1[_0xdb9086(0x19d)][_0xdb9086(0x219)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0xdb9086(0x1f9)+_0x126425);throw new Error(_0xdb9086(0x1c5)+_0xa0311f);}loggerService_1['loggerService'][_0xdb9086(0x1fa)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0x51ed84[_0xdb9086(0x1c1)],_0x33aadd,_0x58ecdb),console[_0xdb9086(0x203)](_0xdb9086(0x211)),console[_0xdb9086(0x203)]('Result:',_0x33aadd[_0xdb9086(0x1da)]),console['log'](_0xdb9086(0x20d),_0x33aadd[_0xdb9086(0x1e2)]),console['log'](_0xdb9086(0x1b5),_0x33aadd[_0xdb9086(0x21d)]?.['Status']),console[_0xdb9086(0x203)](_0xdb9086(0x1ef),_0x33aadd['data']?.['Amount']),console['log']('Currency:',_0x33aadd['data']?.[_0xdb9086(0x21b)]);if(_0x33aadd['result']!==_0xdb9086(0x1dd)||_0x33aadd[_0xdb9086(0x1e2)]!==0xc8){const _0x57f4de=_0x33aadd[_0xdb9086(0x1bd)]||_0xdb9086(0x1be);console['error'](_0xdb9086(0x1bf)),console[_0xdb9086(0x1d4)](_0xdb9086(0x1f3),_0x57f4de),loggerService_1[_0xdb9086(0x19d)][_0xdb9086(0x219)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0xdb9086(0x1e3)+_0x57f4de);throw new Error(_0xdb9086(0x1b8)+_0x57f4de);}if(!_0x33aadd['data']){console[_0xdb9086(0x1d4)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xdb9086(0x1d4)](_0xdb9086(0x19b)),loggerService_1[_0xdb9086(0x19d)][_0xdb9086(0x219)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0xdb9086(0x1ab));throw new Error(_0xdb9086(0x215));}let _0x498cdb=_0xdb9086(0x1b9);switch(_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1f6)]?.['toLowerCase']()){case _0xdb9086(0x1e5):_0x498cdb=_0xdb9086(0x1c2);break;case _0xdb9086(0x1ed):case _0xdb9086(0x20b):case'error':_0x498cdb=_0xdb9086(0x21e);break;case'expired':case _0xdb9086(0x1a4):_0x498cdb='EXPIRED';break;case _0xdb9086(0x1fb):case _0xdb9086(0x200):case _0xdb9086(0x20c):case'created':default:_0x498cdb=_0xdb9086(0x1b9);break;}let _0x506b86,_0x483f32;if(_0x33aadd['data'][_0xdb9086(0x204)]){const _0x461025=_0x33aadd[_0xdb9086(0x21d)]['PaymentDetail'];console['log'](_0xdb9086(0x1bb),_0x461025);const _0x25aca7=_0x461025[_0xdb9086(0x1b3)](/IBAN\s+([A-Z0-9]+)/i);_0x25aca7&&(_0x506b86=_0x25aca7[0x1],console['log'](_0xdb9086(0x209),_0x506b86)),_0x483f32=_0x461025;}const _0x270715={'iban':_0x506b86,'bankDetails':_0x483f32,'transactionId':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1a3)],'coinAddress':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1d5)],'qrCodeUrl':_0x33aadd['data'][_0xdb9086(0x1b2)],'expiryTime':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1b4)],'createdOn':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1d8)],'confirmedOn':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1c0)]};console[_0xdb9086(0x203)](_0xdb9086(0x1c4)),console[_0xdb9086(0x203)](_0xdb9086(0x1d0),_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1f6)],'->',_0x498cdb),console['log'](_0xdb9086(0x1ef),_0x33aadd['data']['Amount'],_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x21b)]),console['log'](_0xdb9086(0x1f7),_0x33aadd[_0xdb9086(0x21d)]['TransactionID']),console[_0xdb9086(0x203)](_0xdb9086(0x1d2),_0x506b86||_0xdb9086(0x1fc)),console[_0xdb9086(0x203)](_0xdb9086(0x1cc),_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x1d8)]),console[_0xdb9086(0x203)](_0xdb9086(0x1a1),_0x33aadd['data'][_0xdb9086(0x1c0)]||_0xdb9086(0x1de));if(_0x33aadd['data'][_0xdb9086(0x1f6)]?.['toLowerCase']()===_0xdb9086(0x200))console[_0xdb9086(0x203)](_0xdb9086(0x208));else _0x33aadd['data'][_0xdb9086(0x1f6)]?.[_0xdb9086(0x1e8)]()===_0xdb9086(0x1e5)&&console['log'](_0xdb9086(0x1a0));return{'status':_0x498cdb,'amount':parseFloat(_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x19e)])||undefined,'currency':_0x33aadd[_0xdb9086(0x21d)][_0xdb9086(0x21b)]||'EUR','paymentDetails':_0x270715};}catch(_0x21b91b){console[_0xdb9086(0x1d4)](_0xdb9086(0x207),_0x21b91b),loggerService_1['loggerService'][_0xdb9086(0x219)](_0xdb9086(0x1aa),_0xdb9086(0x19c),_0x21b91b);throw new Error(_0xdb9086(0x1ce)+(_0x21b91b instanceof Error?_0x21b91b[_0xdb9086(0x1bd)]:_0xdb9086(0x1ba)));}}async[a47_0x50c488(0x202)](_0x31f428){const _0x3dc5fa=a47_0x50c488,_0x1e1818=await this['checkPaymentStatus'](_0x31f428);return{'status':_0x1e1818[_0x3dc5fa(0x1c1)],'amount':_0x1e1818[_0x3dc5fa(0x1e6)],'currency':_0x1e1818[_0x3dc5fa(0x1b6)]};}async[a47_0x50c488(0x1e1)](_0x47f306){const _0x166b70=a47_0x50c488;console['log'](_0x166b70(0x201),_0x47f306);let _0x409cab=_0x166b70(0x1b9);switch(_0x47f306['status']?.[_0x166b70(0x1e8)]()){case'paid':_0x409cab=_0x166b70(0x1c2);break;case _0x166b70(0x1ed):case _0x166b70(0x20b):case _0x166b70(0x1d4):_0x409cab=_0x166b70(0x21e);break;case _0x166b70(0x217):case'timeout':_0x409cab='EXPIRED';break;case _0x166b70(0x20c):case _0x166b70(0x1fb):case _0x166b70(0x200):case'created':default:_0x409cab='PENDING';break;}return{'paymentId':_0x47f306['order_id']||_0x47f306[_0x166b70(0x1db)]||'','status':_0x409cab,'amount':_0x47f306['amount'],'currency':_0x47f306[_0x166b70(0x1b6)]||'EUR'};}}function a47_0x2f17(){const _0x596cd3=['JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','waiting','not\x20found','CoinToPayService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','awaiting\x20fiat','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','verifyPayment','log','PaymentDetail','headers','Request\x20Body:','CoinToPay\x20payment\x20status\x20check\x20error:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','🏦\x20Extracted\x20IBAN:','Parsed\x20Result:','failed','pending','Status\x20Code:','4592530SfXzXR','POST','🪙\x20Creating\x20CoinToPay\x20payment:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','statusUrl','now','logWhiteDomainRequest','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20SUCCESS\x20===','expired','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainError','apiUrl','inputCurrency','2281936ARCCPC','data','FAILED','gateway_payment_id','__esModule','4RlPxgp','===\x20COINTOPAY\x20API\x20ERROR\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','/status','loggerService','Amount','922881zVNdEk','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Confirmed\x20On:','Headers:','TransactionID','timeout','Response\x20Body:','stack','Payment\x20URL\x20(modified):','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','cointopay','Incomplete\x20response:\x20missing\x20data','/create','parse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','payment_url','497547otoKjT','1999908aVHNvw','QRCodeURL','match','ExpiryTime','Payment\x20Status:','currency','HTTP\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','PENDING','Unknown\x20error','🏦\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','message','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','TransactionConfirmedOn','status','PAID',',\x20body:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','createPaymentLink','14JoRdpf','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','checkPaymentStatus','Created\x20On:','\x20EUR','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status:','Status\x20Text:','IBAN:','https://tesoft.uk/gateway/cointopay/','error','coinAddress','application/json','Response\x20Time:','CreatedOn','&alternative=false','result','merchant_reference_id','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','success','not\x20confirmed','1919594JzYBJw','stringify','processWebhook','status_code','Status\x20API\x20Error:\x20','fromEntries','paid','amount','../loggerService','toLowerCase','text','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20error!\x20status:\x20','📊\x20Status\x20check\x20URL:','cancelled','Business\x20Error:\x20','Amount:','10561275dGikGB','Unknown\x20error\x20from\x20CoinToPay\x20API','CoinToPay\x20API\x20error:\x20','Error\x20Message:','https://tesoft.uk/gateway/cointopay/status.php','defineProperty','Status','Transaction\x20ID:','Error\x20message:'];a47_0x2f17=function(){return _0x596cd3;};return a47_0x2f17();}exports[a47_0x50c488(0x1fd)]=CoinToPayService;