'use strict';function a40_0x2dbf(){const _0x5965d5=['status','TransactionID','PAID','üè¶\x20Extracted\x20IBAN:','awaiting\x20fiat','loggerService','logWhiteDomainResponse','statusUrl','Status:','Transaction\x20ID:','IBAN:','CoinToPay\x20API\x20error:\x20','üìä\x20Status\x20check\x20URL:','Error\x20Message:','11182192SrmiVy','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Created\x20On:','data','CoinToPayService','result','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20Status:','Error\x20details:','../loggerService','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','paid','üè¶\x20Payment\x20Detail:','CreatedOn','Response\x20data:','===\x20COINTOPAY\x20SUCCESS\x20===','Parsed\x20Result:','pending','1351782yRMyRY','TransactionConfirmedOn','Amount:','Failed\x20to\x20parse\x20JSON\x20response:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','fromEntries','Error\x20stack:','https://tesoft.uk/gateway/cointopay/','Error\x20message:','timeout','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','now','message','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','created','payment_url','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','4361504QsjFtZ','Status\x20Code:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','/status','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EXPIRED','coinAddress','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy',',\x20body:\x20','Incomplete\x20response:\x20missing\x20data','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','parse','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20Time:','text','apiUrl','Request\x20Body:','entries','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','Currency:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','__esModule','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','TesSoft\x20Payment\x20System/1.0','success','not\x20confirmed','Gateway\x20Payment\x20ID:','Unknown\x20error','currency','10otoLCU','cointopay','checkPaymentStatus','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','31749687fmiRLw','cancelled','stack','POST','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','EUR','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','URL:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','5065165IFhSSe','logWhiteDomainError','Business\x20Error:\x20','HTTP\x20','waiting','status_code','Result:','Status\x20Text:','log','6VpXeqk','3543RBURfM','4157349ICdyrw','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Raw\x20Response\x20Body:','application/json','Missing\x20data\x20in\x20response','not\x20found','Status','headers','Payment\x20Status:','amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','gateway_payment_id','order_id','expired','2868AERlvd','ExpiryTime','PaymentDetail','stringify','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','toLowerCase','FAILED','inputCurrency','defineProperty','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Body:','error','statusText','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','PENDING','/create'];a40_0x2dbf=function(){return _0x5965d5;};return a40_0x2dbf();}const a40_0x15c118=a40_0x19b8;function a40_0x19b8(_0x57c428,_0x46ebc1){const _0x2dbfa9=a40_0x2dbf();return a40_0x19b8=function(_0x19b856,_0x19cf83){_0x19b856=_0x19b856-0x14d;let _0x587622=_0x2dbfa9[_0x19b856];return _0x587622;},a40_0x19b8(_0x57c428,_0x46ebc1);}(function(_0x5b4361,_0x5c3504){const _0x32f406=a40_0x19b8,_0x5ab0f3=_0x5b4361();while(!![]){try{const _0x1c32fb=-parseInt(_0x32f406(0x18d))/0x1+parseInt(_0x32f406(0x15d))/0x2*(parseInt(_0x32f406(0x14e))/0x3)+parseInt(_0x32f406(0x19f))/0x4+parseInt(_0x32f406(0x1cf))/0x5+parseInt(_0x32f406(0x14d))/0x6*(parseInt(_0x32f406(0x14f))/0x7)+parseInt(_0x32f406(0x17b))/0x8+-parseInt(_0x32f406(0x1c4))/0x9*(parseInt(_0x32f406(0x1c0))/0xa);if(_0x1c32fb===_0x5c3504)break;else _0x5ab0f3['push'](_0x5ab0f3['shift']());}catch(_0x299ad8){_0x5ab0f3['push'](_0x5ab0f3['shift']());}}}(a40_0x2dbf,0xddf3f));Object[a40_0x15c118(0x165)](exports,a40_0x15c118(0x1b7),{'value':!![]}),exports[a40_0x15c118(0x17f)]=void 0x0;const loggerService_1=require(a40_0x15c118(0x184));class CoinToPayService{constructor(){const _0xd78f4f=a40_0x15c118;this[_0xd78f4f(0x1af)]=_0xd78f4f(0x194),this[_0xd78f4f(0x174)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0xd78f4f(0x1d7)](_0xd78f4f(0x1a7)),console[_0xd78f4f(0x1d7)](_0xd78f4f(0x179),this['statusUrl']);}async['createPaymentLink'](_0x162e49){const _0x5711be=a40_0x15c118,{orderId:_0x12197e,amount:_0x303243}=_0x162e49;console[_0x5711be(0x1d7)](_0x5711be(0x1aa)+_0x303243+'\x20EUR');const _0x1d73c3={'amount':_0x303243},_0x54b4d6=Date[_0x5711be(0x198)]();try{console[_0x5711be(0x1d7)](_0x5711be(0x19b)),console[_0x5711be(0x1d7)](_0x5711be(0x1cb),this[_0x5711be(0x1af)]),console[_0x5711be(0x1d7)](_0x5711be(0x1b0),JSON['stringify'](_0x1d73c3,null,0x2)),console[_0x5711be(0x1d7)](_0x5711be(0x18f),_0x303243,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x5711be(0x172)]['logWhiteDomainRequest'](_0x5711be(0x1c1),_0x5711be(0x16c),'POST',_0x1d73c3);const _0x8d9d56=await fetch(this['apiUrl'],{'method':_0x5711be(0x1c7),'headers':{'Content-Type':'application/json','Accept':_0x5711be(0x152),'User-Agent':_0x5711be(0x1ba)},'body':JSON[_0x5711be(0x160)](_0x1d73c3)}),_0x4cc0f6=Date['now']()-_0x54b4d6;console[_0x5711be(0x1d7)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5711be(0x1d7)](_0x5711be(0x175),_0x8d9d56['status']),console['log'](_0x5711be(0x1d6),_0x8d9d56[_0x5711be(0x169)]),console[_0x5711be(0x1d7)]('Headers:',Object[_0x5711be(0x192)](_0x8d9d56[_0x5711be(0x156)][_0x5711be(0x1b1)]())),console[_0x5711be(0x1d7)](_0x5711be(0x1ad),_0x4cc0f6+'ms');const _0x139585=await _0x8d9d56[_0x5711be(0x1ae)]();console[_0x5711be(0x1d7)]('Raw\x20Response\x20Body:',_0x139585);if(!_0x8d9d56['ok']){console[_0x5711be(0x168)](_0x5711be(0x1b4)),console[_0x5711be(0x168)](_0x5711be(0x182),_0x8d9d56[_0x5711be(0x16d)]),console[_0x5711be(0x168)](_0x5711be(0x167),_0x139585),loggerService_1['loggerService'][_0x5711be(0x173)]('cointopay',_0x5711be(0x16c),_0x8d9d56[_0x5711be(0x16d)],_0x139585,_0x4cc0f6),loggerService_1['loggerService'][_0x5711be(0x1d0)](_0x5711be(0x1c1),'/create',_0x5711be(0x1d2)+_0x8d9d56[_0x5711be(0x16d)]+':\x20'+_0x139585);throw new Error(_0x5711be(0x19a)+_0x8d9d56[_0x5711be(0x16d)]+_0x5711be(0x1a8)+_0x139585);}let _0x562fba;try{_0x562fba=JSON[_0x5711be(0x1ab)](_0x139585);}catch(_0x28a1ff){console[_0x5711be(0x168)](_0x5711be(0x190),_0x28a1ff),loggerService_1[_0x5711be(0x172)]['logWhiteDomainError'](_0x5711be(0x1c1),_0x5711be(0x16c),_0x5711be(0x1b8)+_0x28a1ff);throw new Error(_0x5711be(0x166)+_0x139585);}console[_0x5711be(0x1d7)](_0x5711be(0x1a4)),console[_0x5711be(0x1d7)](_0x5711be(0x18b),JSON[_0x5711be(0x160)](_0x562fba,null,0x2)),loggerService_1[_0x5711be(0x172)][_0x5711be(0x173)]('cointopay',_0x5711be(0x16c),_0x8d9d56[_0x5711be(0x16d)],_0x562fba,_0x4cc0f6);if(_0x562fba[_0x5711be(0x168)]){const _0x402f09=_0x562fba[_0x5711be(0x199)]||_0x562fba['error']||_0x5711be(0x1b9);console['error'](_0x5711be(0x197)),console[_0x5711be(0x168)](_0x5711be(0x17a),_0x402f09),loggerService_1[_0x5711be(0x172)][_0x5711be(0x1d0)](_0x5711be(0x1c1),_0x5711be(0x16c),_0x5711be(0x1d1)+_0x402f09);throw new Error(_0x5711be(0x178)+_0x402f09);}if(!_0x562fba[_0x5711be(0x19d)]||!_0x562fba[_0x5711be(0x15a)]){console[_0x5711be(0x168)](_0x5711be(0x1cd)),console[_0x5711be(0x168)](_0x5711be(0x159)),console[_0x5711be(0x168)](_0x5711be(0x189),_0x562fba),loggerService_1['loggerService'][_0x5711be(0x1d0)](_0x5711be(0x1c1),'/create',_0x5711be(0x1a1));throw new Error(_0x5711be(0x150));}return console[_0x5711be(0x1d7)](_0x5711be(0x18a)),console[_0x5711be(0x1d7)](_0x5711be(0x1bd),_0x562fba[_0x5711be(0x15a)]),console['log']('Payment\x20URL:',_0x562fba[_0x5711be(0x19d)]),console[_0x5711be(0x1d7)](_0x5711be(0x18f),_0x303243,_0x5711be(0x1c9)),{'gateway_payment_id':_0x562fba[_0x5711be(0x15a)],'payment_url':_0x562fba[_0x5711be(0x19d)]};}catch(_0x3c49aa){console[_0x5711be(0x168)](_0x5711be(0x1b2)),console[_0x5711be(0x168)](_0x5711be(0x183),_0x3c49aa),loggerService_1[_0x5711be(0x172)][_0x5711be(0x1d0)](_0x5711be(0x1c1),_0x5711be(0x16c),_0x3c49aa);if(_0x3c49aa instanceof Error){console['error'](_0x5711be(0x195),_0x3c49aa['message']),console[_0x5711be(0x168)](_0x5711be(0x193),_0x3c49aa[_0x5711be(0x1c6)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x3c49aa[_0x5711be(0x199)]);}throw new Error(_0x5711be(0x1cc));}}async[a40_0x15c118(0x1c2)](_0x59a883){const _0x10550b=a40_0x15c118,_0x212e3f=Date['now']();try{console[_0x10550b(0x1d7)](_0x10550b(0x16a)+_0x59a883);const _0x75db69={'gatewayPaymentId':_0x59a883};loggerService_1[_0x10550b(0x172)]['logWhiteDomainRequest'](_0x10550b(0x1c1),_0x10550b(0x1a2),_0x10550b(0x1c7),_0x75db69);const _0x1fbd19=await fetch(this[_0x10550b(0x174)],{'method':_0x10550b(0x1c7),'headers':{'Content-Type':_0x10550b(0x152),'Accept':'application/json','User-Agent':_0x10550b(0x1ba)},'body':JSON[_0x10550b(0x160)](_0x75db69)}),_0x1d11c6=Date['now']()-_0x212e3f;console['log'](_0x10550b(0x1c3)),console[_0x10550b(0x1d7)](_0x10550b(0x175),_0x1fbd19['status']),console[_0x10550b(0x1d7)](_0x10550b(0x1ad),_0x1d11c6+'ms');if(!_0x1fbd19['ok']){const _0x217e48=await _0x1fbd19['text']();console['error'](_0x10550b(0x182),_0x1fbd19[_0x10550b(0x16d)]),console[_0x10550b(0x168)](_0x10550b(0x167),_0x217e48),loggerService_1[_0x10550b(0x172)][_0x10550b(0x173)](_0x10550b(0x1c1),_0x10550b(0x1a2),_0x1fbd19['status'],_0x217e48,_0x1d11c6),loggerService_1[_0x10550b(0x172)][_0x10550b(0x1d0)](_0x10550b(0x1c1),_0x10550b(0x1a2),_0x10550b(0x1d2)+_0x1fbd19[_0x10550b(0x16d)]+':\x20'+_0x217e48);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1fbd19['status']);}const _0x1f1983=await _0x1fbd19[_0x10550b(0x1ae)]();console[_0x10550b(0x1d7)](_0x10550b(0x151),_0x1f1983);let _0x31e329;try{_0x31e329=JSON[_0x10550b(0x1ab)](_0x1f1983);}catch(_0x5af061){console[_0x10550b(0x168)](_0x10550b(0x190),_0x5af061),loggerService_1[_0x10550b(0x172)][_0x10550b(0x1d0)](_0x10550b(0x1c1),'/status','JSON\x20Parse\x20Error:\x20'+_0x5af061);throw new Error(_0x10550b(0x1c8)+_0x1f1983);}loggerService_1[_0x10550b(0x172)]['logWhiteDomainResponse'](_0x10550b(0x1c1),'/status',_0x1fbd19[_0x10550b(0x16d)],_0x31e329,_0x1d11c6),console[_0x10550b(0x1d7)](_0x10550b(0x161)),console[_0x10550b(0x1d7)](_0x10550b(0x1d5),_0x31e329[_0x10550b(0x180)]),console[_0x10550b(0x1d7)](_0x10550b(0x1a0),_0x31e329[_0x10550b(0x1d4)]),console[_0x10550b(0x1d7)](_0x10550b(0x157),_0x31e329[_0x10550b(0x17e)]?.[_0x10550b(0x155)]),console[_0x10550b(0x1d7)]('Amount:',_0x31e329['data']?.[_0x10550b(0x1b3)]),console['log'](_0x10550b(0x1b5),_0x31e329['data']?.[_0x10550b(0x164)]);if(_0x31e329[_0x10550b(0x180)]!==_0x10550b(0x1bb)||_0x31e329[_0x10550b(0x1d4)]!==0xc8){const _0x16af93=_0x31e329['message']||_0x10550b(0x1ac);console[_0x10550b(0x168)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x10550b(0x17a),_0x16af93),loggerService_1[_0x10550b(0x172)]['logWhiteDomainError']('cointopay',_0x10550b(0x1a2),'Status\x20API\x20Error:\x20'+_0x16af93);throw new Error(_0x10550b(0x181)+_0x16af93);}if(!_0x31e329[_0x10550b(0x17e)]){console[_0x10550b(0x168)](_0x10550b(0x17c)),console[_0x10550b(0x168)](_0x10550b(0x153)),loggerService_1[_0x10550b(0x172)][_0x10550b(0x1d0)](_0x10550b(0x1c1),_0x10550b(0x1a2),_0x10550b(0x1a9));throw new Error(_0x10550b(0x185));}let _0x37694e='PENDING';switch(_0x31e329[_0x10550b(0x17e)][_0x10550b(0x155)]?.[_0x10550b(0x162)]()){case _0x10550b(0x186):_0x37694e=_0x10550b(0x16f);break;case _0x10550b(0x1c5):case'failed':case _0x10550b(0x168):_0x37694e=_0x10550b(0x163);break;case _0x10550b(0x15c):case'timeout':_0x37694e=_0x10550b(0x1a5);break;case _0x10550b(0x1d3):case _0x10550b(0x171):case'pending':case _0x10550b(0x19c):default:_0x37694e=_0x10550b(0x16b);break;}let _0x34e493,_0x5847a6;if(_0x31e329[_0x10550b(0x17e)]['PaymentDetail']){const _0x321a49=_0x31e329['data'][_0x10550b(0x15f)];console[_0x10550b(0x1d7)](_0x10550b(0x187),_0x321a49);const _0x5b3a37=_0x321a49['match'](/IBAN\s+([A-Z0-9]+)/i);_0x5b3a37&&(_0x34e493=_0x5b3a37[0x1],console[_0x10550b(0x1d7)](_0x10550b(0x170),_0x34e493)),_0x5847a6=_0x321a49;}const _0x1c2292={'iban':_0x34e493,'bankDetails':_0x5847a6,'transactionId':_0x31e329['data']['TransactionID'],'coinAddress':_0x31e329[_0x10550b(0x17e)][_0x10550b(0x1a6)],'qrCodeUrl':_0x31e329[_0x10550b(0x17e)][_0x10550b(0x1ce)],'expiryTime':_0x31e329['data'][_0x10550b(0x15e)],'createdOn':_0x31e329[_0x10550b(0x17e)][_0x10550b(0x188)],'confirmedOn':_0x31e329['data'][_0x10550b(0x18e)]};console['log'](_0x10550b(0x1b6)),console[_0x10550b(0x1d7)](_0x10550b(0x175),_0x31e329[_0x10550b(0x17e)]['Status'],'->',_0x37694e),console[_0x10550b(0x1d7)]('Amount:',_0x31e329['data'][_0x10550b(0x1b3)],_0x31e329[_0x10550b(0x17e)]['inputCurrency']),console['log'](_0x10550b(0x176),_0x31e329[_0x10550b(0x17e)][_0x10550b(0x16e)]),console[_0x10550b(0x1d7)](_0x10550b(0x177),_0x34e493||_0x10550b(0x154)),console[_0x10550b(0x1d7)](_0x10550b(0x17d),_0x31e329[_0x10550b(0x17e)]['CreatedOn']),console[_0x10550b(0x1d7)]('Confirmed\x20On:',_0x31e329[_0x10550b(0x17e)][_0x10550b(0x18e)]||_0x10550b(0x1bc));if(_0x31e329['data']['Status']?.[_0x10550b(0x162)]()===_0x10550b(0x171))console[_0x10550b(0x1d7)](_0x10550b(0x191));else _0x31e329['data'][_0x10550b(0x155)]?.[_0x10550b(0x162)]()==='paid'&&console['log'](_0x10550b(0x1ca));return{'status':_0x37694e,'amount':parseFloat(_0x31e329[_0x10550b(0x17e)][_0x10550b(0x1b3)])||undefined,'currency':_0x31e329['data'][_0x10550b(0x164)]||_0x10550b(0x1c9),'paymentDetails':_0x1c2292};}catch(_0x49e47c){console['error'](_0x10550b(0x1a3),_0x49e47c),loggerService_1[_0x10550b(0x172)][_0x10550b(0x1d0)](_0x10550b(0x1c1),_0x10550b(0x1a2),_0x49e47c);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x49e47c instanceof Error?_0x49e47c['message']:_0x10550b(0x1be)));}}async['verifyPayment'](_0xb0580c){const _0xbc8860=a40_0x15c118,_0x31899b=await this[_0xbc8860(0x1c2)](_0xb0580c);return{'status':_0x31899b[_0xbc8860(0x16d)],'amount':_0x31899b[_0xbc8860(0x158)],'currency':_0x31899b[_0xbc8860(0x1bf)]};}async['processWebhook'](_0x51d4d6){const _0x5b7eca=a40_0x15c118;console['log'](_0x5b7eca(0x19e),_0x51d4d6);let _0x4fc816=_0x5b7eca(0x16b);switch(_0x51d4d6[_0x5b7eca(0x16d)]?.[_0x5b7eca(0x162)]()){case _0x5b7eca(0x186):_0x4fc816='PAID';break;case'cancelled':case'failed':case'error':_0x4fc816=_0x5b7eca(0x163);break;case _0x5b7eca(0x15c):case _0x5b7eca(0x196):_0x4fc816='EXPIRED';break;case _0x5b7eca(0x18c):case _0x5b7eca(0x1d3):case _0x5b7eca(0x171):case'created':default:_0x4fc816=_0x5b7eca(0x16b);break;}return{'paymentId':_0x51d4d6[_0x5b7eca(0x15b)]||_0x51d4d6['merchant_reference_id']||'','status':_0x4fc816,'amount':_0x51d4d6[_0x5b7eca(0x158)],'currency':_0x51d4d6['currency']||_0x5b7eca(0x1c9)};}}exports[a40_0x15c118(0x17f)]=CoinToPayService;