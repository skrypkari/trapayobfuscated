'use strict';const a65_0x2da649=a65_0x18dc;function a65_0x2a56(){const _0x464a55=['amount','Payment\x20System/1.0','ðŸ“Š\x20Status\x20check\x20URL:','processWebhook','Response\x20Time:','21014741WesMjX','cancelled','gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','7zKMlhD','PAID','inputCurrency','Missing\x20data\x20in\x20response','CoinToPay\x20payment\x20status\x20check\x20error:','Parsed\x20Result:','FAILED','Currency:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Response\x20Body:','not\x20found','logWhiteDomainError','toLowerCase','expired','/status','awaiting\x20fiat','loggerService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','/create','Result:','===\x20COINTOPAY\x20SUCCESS\x20===','ExpiryTime','stringify','stack','ðŸ¦\x20Extracted\x20IBAN:','error','HTTP\x20error!\x20status:\x20','2661540VKtIDv','../loggerService','status','3817722btFYWP','merchant_reference_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','status_code','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','data','paid','logWhiteDomainResponse','success','apiUrl','checkPaymentStatus','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Gateway\x20Payment\x20ID:','Error\x20details:','https://tesoft.uk/gateway/cointopay/','Status:','cointopay','322pstvKW',',\x20body:\x20','createPaymentLink','log','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','timeout','pending','parse','currency','Confirmed\x20On:','Payment\x20URL\x20(original):','Unknown\x20error','2735352txYABH','fromEntries','HTTP\x20','defineProperty','created','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','failed','__esModule','payment_url','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','QRCodeURL','POST','message','statusUrl','Error\x20message:','4519RVhlUE','order_id','not\x20confirmed','&alternative=false','Amount','Incomplete\x20response:\x20missing\x20data','logWhiteDomainRequest','Error\x20stack:','Status\x20API\x20Error:\x20','ðŸ¦\x20Payment\x20Detail:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Request\x20Body:','text','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','result','Status','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','477790OvBzrh','application/json','waiting','match','CoinToPay\x20status\x20API\x20error:\x20','statusText','Error\x20Message:','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Amount:','EXPIRED','Payment\x20Status:','Raw\x20Response\x20Body:','https://tesoft.uk/gateway/cointopay/status.php','108wkBTQr','now','21ITpqKd','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','CoinToPayService','PaymentDetail','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionConfirmedOn','JSON\x20Parse\x20Error:\x20','Status\x20Text:','Unknown\x20error\x20from\x20CoinToPay\x20API','Business\x20Error:\x20','Created\x20On:','273708iZKWHM'];a65_0x2a56=function(){return _0x464a55;};return a65_0x2a56();}(function(_0x4c1899,_0x5f2031){const _0x3163a2=a65_0x18dc,_0x421228=_0x4c1899();while(!![]){try{const _0x1ae917=-parseInt(_0x3163a2(0x21e))/0x1*(parseInt(_0x3163a2(0x202))/0x2)+-parseInt(_0x3163a2(0x241))/0x3*(parseInt(_0x3163a2(0x24c))/0x4)+parseInt(_0x3163a2(0x1ea))/0x5+-parseInt(_0x3163a2(0x1ed))/0x6*(parseInt(_0x3163a2(0x256))/0x7)+parseInt(_0x3163a2(0x20f))/0x8+-parseInt(_0x3163a2(0x23f))/0x9*(parseInt(_0x3163a2(0x231))/0xa)+parseInt(_0x3163a2(0x252))/0xb;if(_0x1ae917===_0x5f2031)break;else _0x421228['push'](_0x421228['shift']());}catch(_0xad3a0b){_0x421228['push'](_0x421228['shift']());}}}(a65_0x2a56,0x59f5b));Object[a65_0x2da649(0x212)](exports,a65_0x2da649(0x216),{'value':!![]}),exports[a65_0x2da649(0x243)]=void 0x0;const loggerService_1=require(a65_0x2da649(0x1eb));function a65_0x18dc(_0x14e89b,_0x46ff30){_0x14e89b=_0x14e89b-0x1e5;const _0x2a566e=a65_0x2a56();let _0x18dc40=_0x2a566e[_0x14e89b];return _0x18dc40;}class CoinToPayService{constructor(){const _0x573231=a65_0x2da649;this[_0x573231(0x1fa)]=_0x573231(0x1ff),this['statusUrl']=_0x573231(0x23e),console[_0x573231(0x205)](_0x573231(0x1f5)),console[_0x573231(0x205)](_0x573231(0x24f),this[_0x573231(0x21c)]);}async[a65_0x2da649(0x204)](_0x58d680){const _0x3a8f8a=a65_0x2da649,{orderId:_0x3d3ac5,amount:_0x2744cd}=_0x58d680;console[_0x3a8f8a(0x205)]('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2744cd+'\x20EUR');const _0x582766={'amount':_0x2744cd},_0x2445aa=Date[_0x3a8f8a(0x240)]();try{console[_0x3a8f8a(0x205)](_0x3a8f8a(0x22d)),console['log']('URL:',this[_0x3a8f8a(0x1fa)]),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x22a),JSON[_0x3a8f8a(0x1e5)](_0x582766,null,0x2)),console[_0x3a8f8a(0x205)]('Amount:',_0x2744cd,_0x3a8f8a(0x239)),loggerService_1[_0x3a8f8a(0x268)][_0x3a8f8a(0x224)]('cointopay',_0x3a8f8a(0x26a),_0x3a8f8a(0x21a),_0x582766);const _0x7fffe0=await fetch(this[_0x3a8f8a(0x1fa)],{'method':_0x3a8f8a(0x21a),'headers':{'Content-Type':_0x3a8f8a(0x232),'Accept':'application/json','User-Agent':_0x3a8f8a(0x24e)},'body':JSON['stringify'](_0x582766)}),_0x48bb85=Date[_0x3a8f8a(0x240)]()-_0x2445aa;console[_0x3a8f8a(0x205)](_0x3a8f8a(0x242)),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x200),_0x7fffe0[_0x3a8f8a(0x1ec)]),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x248),_0x7fffe0[_0x3a8f8a(0x236)]),console[_0x3a8f8a(0x205)]('Headers:',Object[_0x3a8f8a(0x210)](_0x7fffe0['headers']['entries']())),console['log'](_0x3a8f8a(0x251),_0x48bb85+'ms');const _0xfb7a3b=await _0x7fffe0[_0x3a8f8a(0x22b)]();console[_0x3a8f8a(0x205)](_0x3a8f8a(0x23d),_0xfb7a3b);if(!_0x7fffe0['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x206),_0x7fffe0[_0x3a8f8a(0x1ec)]),console[_0x3a8f8a(0x1e8)]('Response\x20Body:',_0xfb7a3b),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3a8f8a(0x201),'/create',_0x7fffe0[_0x3a8f8a(0x1ec)],_0xfb7a3b,_0x48bb85),loggerService_1['loggerService'][_0x3a8f8a(0x263)](_0x3a8f8a(0x201),_0x3a8f8a(0x26a),_0x3a8f8a(0x211)+_0x7fffe0[_0x3a8f8a(0x1ec)]+':\x20'+_0xfb7a3b);throw new Error(_0x3a8f8a(0x1e9)+_0x7fffe0[_0x3a8f8a(0x1ec)]+_0x3a8f8a(0x203)+_0xfb7a3b);}let _0x2d1cf5;try{_0x2d1cf5=JSON[_0x3a8f8a(0x20a)](_0xfb7a3b);}catch(_0x2050a2){console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x22c),_0x2050a2),loggerService_1[_0x3a8f8a(0x268)][_0x3a8f8a(0x263)](_0x3a8f8a(0x201),_0x3a8f8a(0x26a),'JSON\x20Parse\x20Error:\x20'+_0x2050a2);throw new Error(_0x3a8f8a(0x1ef)+_0xfb7a3b);}console['log'](_0x3a8f8a(0x255)),console['log'](_0x3a8f8a(0x25b),JSON['stringify'](_0x2d1cf5,null,0x2)),loggerService_1['loggerService'][_0x3a8f8a(0x1f8)](_0x3a8f8a(0x201),'/create',_0x7fffe0[_0x3a8f8a(0x1ec)],_0x2d1cf5,_0x48bb85);if(_0x2d1cf5['error']){const _0x362014=_0x2d1cf5[_0x3a8f8a(0x21b)]||_0x2d1cf5[_0x3a8f8a(0x1e8)]||_0x3a8f8a(0x249);console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x207)),console['error'](_0x3a8f8a(0x237),_0x362014),loggerService_1[_0x3a8f8a(0x268)]['logWhiteDomainError'](_0x3a8f8a(0x201),'/create',_0x3a8f8a(0x24a)+_0x362014);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x362014);}if(!_0x2d1cf5['payment_url']||!_0x2d1cf5[_0x3a8f8a(0x254)]){console['error'](_0x3a8f8a(0x1f2)),console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x1fc)),console[_0x3a8f8a(0x1e8)]('Response\x20data:',_0x2d1cf5),loggerService_1[_0x3a8f8a(0x268)][_0x3a8f8a(0x263)](_0x3a8f8a(0x201),_0x3a8f8a(0x26a),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3a8f8a(0x245));}console[_0x3a8f8a(0x205)](_0x3a8f8a(0x26c)),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x1fd),_0x2d1cf5[_0x3a8f8a(0x254)]),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x20d),_0x2d1cf5[_0x3a8f8a(0x217)]);const _0x129bb0=_0x2d1cf5[_0x3a8f8a(0x217)]+_0x3a8f8a(0x221);return console[_0x3a8f8a(0x205)]('Payment\x20URL\x20(modified):',_0x129bb0),console[_0x3a8f8a(0x205)](_0x3a8f8a(0x23a),_0x2744cd,'EUR'),{'gateway_payment_id':_0x2d1cf5[_0x3a8f8a(0x254)],'payment_url':_0x129bb0};}catch(_0x909a96){console['error'](_0x3a8f8a(0x1f1)),console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x1fe),_0x909a96),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x909a96);if(_0x909a96 instanceof Error){console[_0x3a8f8a(0x1e8)](_0x3a8f8a(0x21d),_0x909a96[_0x3a8f8a(0x21b)]),console['error'](_0x3a8f8a(0x225),_0x909a96[_0x3a8f8a(0x1e6)]);throw new Error(_0x3a8f8a(0x25e)+_0x909a96[_0x3a8f8a(0x21b)]);}throw new Error(_0x3a8f8a(0x218));}}async[a65_0x2da649(0x1fb)](_0x5a47e3){const _0x437dcd=a65_0x2da649,_0x117ac0=Date[_0x437dcd(0x240)]();try{console[_0x437dcd(0x205)](_0x437dcd(0x260)+_0x5a47e3);const _0x3881ee={'gatewayPaymentId':_0x5a47e3};loggerService_1[_0x437dcd(0x268)][_0x437dcd(0x224)](_0x437dcd(0x201),_0x437dcd(0x266),'POST',_0x3881ee);const _0x4605ce=await fetch(this[_0x437dcd(0x21c)],{'method':_0x437dcd(0x21a),'headers':{'Content-Type':_0x437dcd(0x232),'Accept':_0x437dcd(0x232),'User-Agent':_0x437dcd(0x24e)},'body':JSON[_0x437dcd(0x1e5)](_0x3881ee)}),_0x319f04=Date[_0x437dcd(0x240)]()-_0x117ac0;console[_0x437dcd(0x205)](_0x437dcd(0x269)),console['log'](_0x437dcd(0x200),_0x4605ce[_0x437dcd(0x1ec)]),console[_0x437dcd(0x205)]('Response\x20Time:',_0x319f04+'ms');if(!_0x4605ce['ok']){const _0x160c80=await _0x4605ce[_0x437dcd(0x22b)]();console[_0x437dcd(0x1e8)](_0x437dcd(0x206),_0x4605ce[_0x437dcd(0x1ec)]),console[_0x437dcd(0x1e8)](_0x437dcd(0x261),_0x160c80),loggerService_1[_0x437dcd(0x268)]['logWhiteDomainResponse'](_0x437dcd(0x201),'/status',_0x4605ce[_0x437dcd(0x1ec)],_0x160c80,_0x319f04),loggerService_1[_0x437dcd(0x268)][_0x437dcd(0x263)](_0x437dcd(0x201),_0x437dcd(0x266),_0x437dcd(0x211)+_0x4605ce[_0x437dcd(0x1ec)]+':\x20'+_0x160c80);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4605ce['status']);}const _0x4054d8=await _0x4605ce[_0x437dcd(0x22b)]();console['log'](_0x437dcd(0x23d),_0x4054d8);let _0x351e45;try{_0x351e45=JSON[_0x437dcd(0x20a)](_0x4054d8);}catch(_0x165eb6){console[_0x437dcd(0x1e8)](_0x437dcd(0x22c),_0x165eb6),loggerService_1[_0x437dcd(0x268)][_0x437dcd(0x263)]('cointopay',_0x437dcd(0x266),_0x437dcd(0x247)+_0x165eb6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4054d8);}loggerService_1[_0x437dcd(0x268)][_0x437dcd(0x1f8)](_0x437dcd(0x201),_0x437dcd(0x266),_0x4605ce[_0x437dcd(0x1ec)],_0x351e45,_0x319f04),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x437dcd(0x205)](_0x437dcd(0x26b),_0x351e45[_0x437dcd(0x22e)]),console[_0x437dcd(0x205)]('Status\x20Code:',_0x351e45[_0x437dcd(0x1f4)]),console[_0x437dcd(0x205)](_0x437dcd(0x23c),_0x351e45[_0x437dcd(0x1f6)]?.['Status']),console[_0x437dcd(0x205)](_0x437dcd(0x23a),_0x351e45[_0x437dcd(0x1f6)]?.[_0x437dcd(0x222)]),console[_0x437dcd(0x205)](_0x437dcd(0x25d),_0x351e45[_0x437dcd(0x1f6)]?.[_0x437dcd(0x258)]);if(_0x351e45[_0x437dcd(0x22e)]!==_0x437dcd(0x1f9)||_0x351e45[_0x437dcd(0x1f4)]!==0xc8){const _0x552018=_0x351e45[_0x437dcd(0x21b)]||_0x437dcd(0x230);console[_0x437dcd(0x1e8)](_0x437dcd(0x1f0)),console[_0x437dcd(0x1e8)](_0x437dcd(0x237),_0x552018),loggerService_1[_0x437dcd(0x268)]['logWhiteDomainError'](_0x437dcd(0x201),_0x437dcd(0x266),_0x437dcd(0x226)+_0x552018);throw new Error(_0x437dcd(0x235)+_0x552018);}if(!_0x351e45[_0x437dcd(0x1f6)]){console[_0x437dcd(0x1e8)](_0x437dcd(0x228)),console[_0x437dcd(0x1e8)](_0x437dcd(0x259)),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x437dcd(0x266),_0x437dcd(0x223));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5e55b8=_0x437dcd(0x1f3);switch(_0x351e45['data'][_0x437dcd(0x22f)]?.['toLowerCase']()){case'paid':_0x5e55b8=_0x437dcd(0x257);break;case _0x437dcd(0x253):case _0x437dcd(0x215):case _0x437dcd(0x1e8):_0x5e55b8=_0x437dcd(0x25c);break;case _0x437dcd(0x265):case _0x437dcd(0x208):_0x5e55b8=_0x437dcd(0x23b);break;case _0x437dcd(0x233):case _0x437dcd(0x267):case _0x437dcd(0x209):case _0x437dcd(0x213):default:_0x5e55b8=_0x437dcd(0x1f3);break;}let _0x1141d1,_0x4b0844;if(_0x351e45['data'][_0x437dcd(0x244)]){const _0xf84ecc=_0x351e45['data'][_0x437dcd(0x244)];console['log'](_0x437dcd(0x227),_0xf84ecc);const _0x892cdb=_0xf84ecc[_0x437dcd(0x234)](/IBAN\s+([A-Z0-9]+)/i);_0x892cdb&&(_0x1141d1=_0x892cdb[0x1],console[_0x437dcd(0x205)](_0x437dcd(0x1e7),_0x1141d1)),_0x4b0844=_0xf84ecc;}const _0x339fe2={'iban':_0x1141d1,'bankDetails':_0x4b0844,'transactionId':_0x351e45['data']['TransactionID'],'coinAddress':_0x351e45['data']['coinAddress'],'qrCodeUrl':_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x219)],'expiryTime':_0x351e45['data'][_0x437dcd(0x26d)],'createdOn':_0x351e45[_0x437dcd(0x1f6)]['CreatedOn'],'confirmedOn':_0x351e45['data']['TransactionConfirmedOn']};console[_0x437dcd(0x205)](_0x437dcd(0x229)),console[_0x437dcd(0x205)]('Status:',_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x22f)],'->',_0x5e55b8),console[_0x437dcd(0x205)](_0x437dcd(0x23a),_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x222)],_0x351e45['data']['inputCurrency']),console[_0x437dcd(0x205)]('Transaction\x20ID:',_0x351e45[_0x437dcd(0x1f6)]['TransactionID']),console[_0x437dcd(0x205)]('IBAN:',_0x1141d1||_0x437dcd(0x262)),console[_0x437dcd(0x205)](_0x437dcd(0x24b),_0x351e45[_0x437dcd(0x1f6)]['CreatedOn']),console[_0x437dcd(0x205)](_0x437dcd(0x20c),_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x246)]||_0x437dcd(0x220));if(_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x22f)]?.[_0x437dcd(0x264)]()===_0x437dcd(0x267))console[_0x437dcd(0x205)](_0x437dcd(0x214));else _0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x22f)]?.[_0x437dcd(0x264)]()===_0x437dcd(0x1f7)&&console['log'](_0x437dcd(0x238));return{'status':_0x5e55b8,'amount':parseFloat(_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x222)])||undefined,'currency':_0x351e45[_0x437dcd(0x1f6)][_0x437dcd(0x258)]||'EUR','paymentDetails':_0x339fe2};}catch(_0x4761a8){console[_0x437dcd(0x1e8)](_0x437dcd(0x25a),_0x4761a8),loggerService_1['loggerService']['logWhiteDomainError'](_0x437dcd(0x201),'/status',_0x4761a8);throw new Error(_0x437dcd(0x25f)+(_0x4761a8 instanceof Error?_0x4761a8[_0x437dcd(0x21b)]:_0x437dcd(0x20e)));}}async['verifyPayment'](_0x45953a){const _0x4ec9ac=a65_0x2da649,_0x2c6ae9=await this[_0x4ec9ac(0x1fb)](_0x45953a);return{'status':_0x2c6ae9[_0x4ec9ac(0x1ec)],'amount':_0x2c6ae9[_0x4ec9ac(0x24d)],'currency':_0x2c6ae9[_0x4ec9ac(0x20b)]};}async[a65_0x2da649(0x250)](_0x22a1f7){const _0x40a7be=a65_0x2da649;console[_0x40a7be(0x205)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x22a1f7);let _0x15641e=_0x40a7be(0x1f3);switch(_0x22a1f7['status']?.[_0x40a7be(0x264)]()){case _0x40a7be(0x1f7):_0x15641e=_0x40a7be(0x257);break;case _0x40a7be(0x253):case'failed':case _0x40a7be(0x1e8):_0x15641e='FAILED';break;case _0x40a7be(0x265):case _0x40a7be(0x208):_0x15641e='EXPIRED';break;case _0x40a7be(0x209):case _0x40a7be(0x233):case _0x40a7be(0x267):case _0x40a7be(0x213):default:_0x15641e='PENDING';break;}return{'paymentId':_0x22a1f7[_0x40a7be(0x21f)]||_0x22a1f7[_0x40a7be(0x1ee)]||'','status':_0x15641e,'amount':_0x22a1f7['amount'],'currency':_0x22a1f7[_0x40a7be(0x20b)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;