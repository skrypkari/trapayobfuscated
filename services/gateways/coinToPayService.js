'use strict';function a55_0x4894(_0x1a9cf8,_0x4700b7){_0x1a9cf8=_0x1a9cf8-0x64;const _0x2c5534=a55_0x2c55();let _0x4894e6=_0x2c5534[_0x1a9cf8];return _0x4894e6;}function a55_0x2c55(){const _0x5daa2b=['logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','merchant_reference_id','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','application/json','status','fromEntries','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','paid','/status','CoinToPay\x20status\x20API\x20error:\x20','Amount:','Parsed\x20Result:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','now','===\x20COINTOPAY\x20SUCCESS\x20===','apiUrl','text','656366lftIZB','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cancelled','Unknown\x20error\x20from\x20CoinToPay\x20API','error','logWhiteDomainRequest','ExpiryTime','2325465XrKLwK','4729148SzFazB','7UpRKyg','entries','Transaction\x20ID:','Missing\x20data\x20in\x20response','headers','PAID','HTTP\x20','33174tvUwNM','waiting','inputCurrency','Incomplete\x20response:\x20missing\x20data','10404582QPGabT','not\x20confirmed','stringify','order_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','ðŸ¦\x20Extracted\x20IBAN:','Headers:','stack','PENDING','expired','Error\x20details:','Raw\x20Response\x20Body:','defineProperty','verifyPayment','TransactionID','parse','\x20EUR','Payment\x20URL\x20(original):','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','2085243kODzfD','EXPIRED','Payment\x20URL\x20(modified):','message','Currency:','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','data','loggerService','logWhiteDomainError','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','awaiting\x20fiat','Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','gateway_payment_id','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20data:','pending','2TzPHuk','Failed\x20to\x20parse\x20JSON\x20response:','POST','Result:','CoinToPay\x20API\x20error:\x20','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cointopay','statusText','FAILED','Amount','19771810mprnLy','Status:','failed','currency','/create','Status','Created\x20On:','statusUrl','CoinToPay\x20payment\x20status\x20check\x20error:','1208NcSclE','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','payment_url','JSON\x20Parse\x20Error:\x20','HTTP\x20error!\x20status:\x20','processWebhook','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','createPaymentLink','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','status_code','Error\x20Message:','TransactionConfirmedOn','Error\x20stack:','Status\x20Code:','result','checkPaymentStatus','HTTP\x20Status:','amount','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','coinAddress','toLowerCase','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','URL:','CreatedOn','CoinToPayService','Unknown\x20error','EUR','log','match','Confirmed\x20On:','Response\x20Time:','success','https://tesoft.uk/gateway/cointopay/','created'];a55_0x2c55=function(){return _0x5daa2b;};return a55_0x2c55();}const a55_0x59c4bd=a55_0x4894;(function(_0x5d95b3,_0x192b49){const _0x4968c0=a55_0x4894,_0x465b24=_0x5d95b3();while(!![]){try{const _0x2d16c9=parseInt(_0x4968c0(0x79))/0x1+parseInt(_0x4968c0(0xb3))/0x2*(-parseInt(_0x4968c0(0xa1))/0x3)+parseInt(_0x4968c0(0x81))/0x4+-parseInt(_0x4968c0(0x80))/0x5+-parseInt(_0x4968c0(0x8d))/0x6*(-parseInt(_0x4968c0(0x82))/0x7)+parseInt(_0x4968c0(0xc7))/0x8*(parseInt(_0x4968c0(0x89))/0x9)+-parseInt(_0x4968c0(0xbe))/0xa;if(_0x2d16c9===_0x192b49)break;else _0x465b24['push'](_0x465b24['shift']());}catch(_0x1b1323){_0x465b24['push'](_0x465b24['shift']());}}}(a55_0x2c55,0xf22ed));Object[a55_0x59c4bd(0x99)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x32f08b=a55_0x59c4bd;this[_0x32f08b(0x77)]=_0x32f08b(0xe7),this['statusUrl']=_0x32f08b(0xaf),console[_0x32f08b(0xe2)](_0x32f08b(0xa6)),console[_0x32f08b(0xe2)]('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x32f08b(0xc5)]);}async[a55_0x59c4bd(0xce)](_0x102036){const _0x1b8d41=a55_0x59c4bd,{orderId:_0x2d49a4,amount:_0x5391fc}=_0x102036;console['log'](_0x1b8d41(0xb8)+_0x5391fc+_0x1b8d41(0x9d));const _0x5e7994={'amount':_0x5391fc},_0x24ebf3=Date[_0x1b8d41(0x75)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1b8d41(0xe2)](_0x1b8d41(0xdd),this[_0x1b8d41(0x77)]),console[_0x1b8d41(0xe2)]('Request\x20Body:',JSON['stringify'](_0x5e7994,null,0x2)),console[_0x1b8d41(0xe2)]('Amount:',_0x5391fc,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x1b8d41(0xa8)][_0x1b8d41(0x7e)](_0x1b8d41(0xba),_0x1b8d41(0xc2),'POST',_0x5e7994);const _0x257e81=await fetch(this[_0x1b8d41(0x77)],{'method':_0x1b8d41(0xb5),'headers':{'Content-Type':_0x1b8d41(0x68),'Accept':_0x1b8d41(0x68),'User-Agent':_0x1b8d41(0xac)},'body':JSON[_0x1b8d41(0x8f)](_0x5e7994)}),_0x5f3d6f=Date[_0x1b8d41(0x75)]()-_0x24ebf3;console[_0x1b8d41(0xe2)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1b8d41(0xe2)](_0x1b8d41(0xbf),_0x257e81[_0x1b8d41(0x69)]),console[_0x1b8d41(0xe2)]('Status\x20Text:',_0x257e81[_0x1b8d41(0xbb)]),console[_0x1b8d41(0xe2)](_0x1b8d41(0x93),Object[_0x1b8d41(0x6a)](_0x257e81[_0x1b8d41(0x86)][_0x1b8d41(0x83)]())),console[_0x1b8d41(0xe2)]('Response\x20Time:',_0x5f3d6f+'ms');const _0x43fd90=await _0x257e81[_0x1b8d41(0x78)]();console['log'](_0x1b8d41(0x98),_0x43fd90);if(!_0x257e81['ok']){console['error'](_0x1b8d41(0xa0)),console['error']('HTTP\x20Status:',_0x257e81[_0x1b8d41(0x69)]),console['error'](_0x1b8d41(0x6c),_0x43fd90),loggerService_1[_0x1b8d41(0xa8)][_0x1b8d41(0xe9)](_0x1b8d41(0xba),_0x1b8d41(0xc2),_0x257e81['status'],_0x43fd90,_0x5f3d6f),loggerService_1['loggerService'][_0x1b8d41(0xa9)](_0x1b8d41(0xba),_0x1b8d41(0xc2),_0x1b8d41(0x88)+_0x257e81[_0x1b8d41(0x69)]+':\x20'+_0x43fd90);throw new Error(_0x1b8d41(0xcb)+_0x257e81[_0x1b8d41(0x69)]+',\x20body:\x20'+_0x43fd90);}let _0x2ca1dd;try{_0x2ca1dd=JSON['parse'](_0x43fd90);}catch(_0x577b0f){console[_0x1b8d41(0x7d)](_0x1b8d41(0xb4),_0x577b0f),loggerService_1[_0x1b8d41(0xa8)][_0x1b8d41(0xa9)]('cointopay',_0x1b8d41(0xc2),'JSON\x20Parse\x20Error:\x20'+_0x577b0f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x43fd90);}console[_0x1b8d41(0xe2)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x1b8d41(0xe2)](_0x1b8d41(0x72),JSON['stringify'](_0x2ca1dd,null,0x2)),loggerService_1[_0x1b8d41(0xa8)]['logWhiteDomainResponse'](_0x1b8d41(0xba),_0x1b8d41(0xc2),_0x257e81['status'],_0x2ca1dd,_0x5f3d6f);if(_0x2ca1dd['error']){const _0x1d3696=_0x2ca1dd[_0x1b8d41(0xa4)]||_0x2ca1dd[_0x1b8d41(0x7d)]||_0x1b8d41(0x7c);console[_0x1b8d41(0x7d)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x1b8d41(0xd1),_0x1d3696),loggerService_1[_0x1b8d41(0xa8)][_0x1b8d41(0xa9)](_0x1b8d41(0xba),_0x1b8d41(0xc2),'Business\x20Error:\x20'+_0x1d3696);throw new Error(_0x1b8d41(0xb7)+_0x1d3696);}if(!_0x2ca1dd[_0x1b8d41(0xc9)]||!_0x2ca1dd[_0x1b8d41(0xae)]){console[_0x1b8d41(0x7d)](_0x1b8d41(0xc8)),console[_0x1b8d41(0x7d)](_0x1b8d41(0x91)),console['error'](_0x1b8d41(0xb1),_0x2ca1dd),loggerService_1[_0x1b8d41(0xa8)]['logWhiteDomainError'](_0x1b8d41(0xba),'/create',_0x1b8d41(0x67));throw new Error(_0x1b8d41(0xdc));}console['log'](_0x1b8d41(0x76)),console['log']('Gateway\x20Payment\x20ID:',_0x2ca1dd[_0x1b8d41(0xae)]),console[_0x1b8d41(0xe2)](_0x1b8d41(0x9e),_0x2ca1dd[_0x1b8d41(0xc9)]);const _0x28d789=_0x2ca1dd[_0x1b8d41(0xc9)]+'&alternative=false';return console['log'](_0x1b8d41(0xa3),_0x28d789),console[_0x1b8d41(0xe2)](_0x1b8d41(0x71),_0x5391fc,_0x1b8d41(0xe1)),{'gateway_payment_id':_0x2ca1dd[_0x1b8d41(0xae)],'payment_url':_0x28d789};}catch(_0x3dda52){console[_0x1b8d41(0x7d)](_0x1b8d41(0xcd)),console[_0x1b8d41(0x7d)](_0x1b8d41(0x97),_0x3dda52),loggerService_1[_0x1b8d41(0xa8)][_0x1b8d41(0xa9)](_0x1b8d41(0xba),_0x1b8d41(0xc2),_0x3dda52);if(_0x3dda52 instanceof Error){console[_0x1b8d41(0x7d)]('Error\x20message:',_0x3dda52[_0x1b8d41(0xa4)]),console[_0x1b8d41(0x7d)](_0x1b8d41(0xd3),_0x3dda52[_0x1b8d41(0x94)]);throw new Error(_0x1b8d41(0x64)+_0x3dda52[_0x1b8d41(0xa4)]);}throw new Error(_0x1b8d41(0xb0));}}async[a55_0x59c4bd(0xd6)](_0x35753c){const _0x1446ff=a55_0x59c4bd,_0x40c55b=Date[_0x1446ff(0x75)]();try{console[_0x1446ff(0xe2)](_0x1446ff(0xb9)+_0x35753c);const _0x45df46={'gatewayPaymentId':_0x35753c};loggerService_1['loggerService'][_0x1446ff(0x7e)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x1446ff(0xb5),_0x45df46);const _0xb872ea=await fetch(this[_0x1446ff(0xc5)],{'method':'POST','headers':{'Content-Type':_0x1446ff(0x68),'Accept':_0x1446ff(0x68),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x1446ff(0x8f)](_0x45df46)}),_0x3dcdc6=Date[_0x1446ff(0x75)]()-_0x40c55b;console[_0x1446ff(0xe2)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1446ff(0xe2)](_0x1446ff(0xbf),_0xb872ea['status']),console[_0x1446ff(0xe2)](_0x1446ff(0xe5),_0x3dcdc6+'ms');if(!_0xb872ea['ok']){const _0x48e0d7=await _0xb872ea[_0x1446ff(0x78)]();console['error'](_0x1446ff(0xd7),_0xb872ea['status']),console[_0x1446ff(0x7d)](_0x1446ff(0x6c),_0x48e0d7),loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xe9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0xb872ea['status'],_0x48e0d7,_0x3dcdc6),loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xa9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x1446ff(0x88)+_0xb872ea[_0x1446ff(0x69)]+':\x20'+_0x48e0d7);throw new Error(_0x1446ff(0xcb)+_0xb872ea[_0x1446ff(0x69)]);}const _0x297106=await _0xb872ea[_0x1446ff(0x78)]();console[_0x1446ff(0xe2)]('Raw\x20Response\x20Body:',_0x297106);let _0x239fbf;try{_0x239fbf=JSON[_0x1446ff(0x9c)](_0x297106);}catch(_0x21fb52){console[_0x1446ff(0x7d)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x21fb52),loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xa9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x1446ff(0xca)+_0x21fb52);throw new Error(_0x1446ff(0x7a)+_0x297106);}loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xe9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0xb872ea['status'],_0x239fbf,_0x3dcdc6),console['log'](_0x1446ff(0x65)),console[_0x1446ff(0xe2)](_0x1446ff(0xb6),_0x239fbf[_0x1446ff(0xd5)]),console[_0x1446ff(0xe2)](_0x1446ff(0xd4),_0x239fbf[_0x1446ff(0xd0)]),console[_0x1446ff(0xe2)]('Payment\x20Status:',_0x239fbf[_0x1446ff(0xa7)]?.['Status']),console[_0x1446ff(0xe2)]('Amount:',_0x239fbf[_0x1446ff(0xa7)]?.[_0x1446ff(0xbd)]),console['log'](_0x1446ff(0xa5),_0x239fbf[_0x1446ff(0xa7)]?.['inputCurrency']);if(_0x239fbf[_0x1446ff(0xd5)]!==_0x1446ff(0xe6)||_0x239fbf[_0x1446ff(0xd0)]!==0xc8){const _0x4b024c=_0x239fbf['message']||_0x1446ff(0x6d);console['error'](_0x1446ff(0xd9)),console[_0x1446ff(0x7d)](_0x1446ff(0xd1),_0x4b024c),loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xa9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x1446ff(0x9f)+_0x4b024c);throw new Error(_0x1446ff(0x70)+_0x4b024c);}if(!_0x239fbf[_0x1446ff(0xa7)]){console[_0x1446ff(0x7d)](_0x1446ff(0xcf)),console['error'](_0x1446ff(0x85)),loggerService_1['loggerService'][_0x1446ff(0xa9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x1446ff(0x8c));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2bbd57=_0x1446ff(0x95);switch(_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xc3)]?.[_0x1446ff(0xdb)]()){case'paid':_0x2bbd57=_0x1446ff(0x87);break;case _0x1446ff(0x7b):case'failed':case _0x1446ff(0x7d):_0x2bbd57=_0x1446ff(0xbc);break;case'expired':case'timeout':_0x2bbd57='EXPIRED';break;case _0x1446ff(0x8a):case _0x1446ff(0xab):case _0x1446ff(0xb2):case _0x1446ff(0xe8):default:_0x2bbd57='PENDING';break;}let _0x1bb114,_0x6f0dab;if(_0x239fbf[_0x1446ff(0xa7)]['PaymentDetail']){const _0x4813f4=_0x239fbf[_0x1446ff(0xa7)]['PaymentDetail'];console[_0x1446ff(0xe2)]('ðŸ¦\x20Payment\x20Detail:',_0x4813f4);const _0xc410c5=_0x4813f4[_0x1446ff(0xe3)](/IBAN\s+([A-Z0-9]+)/i);_0xc410c5&&(_0x1bb114=_0xc410c5[0x1],console['log'](_0x1446ff(0x92),_0x1bb114)),_0x6f0dab=_0x4813f4;}const _0x82873c={'iban':_0x1bb114,'bankDetails':_0x6f0dab,'transactionId':_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0x9b)],'coinAddress':_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xda)],'qrCodeUrl':_0x239fbf[_0x1446ff(0xa7)]['QRCodeURL'],'expiryTime':_0x239fbf['data'][_0x1446ff(0x7f)],'createdOn':_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xde)],'confirmedOn':_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xd2)]};console[_0x1446ff(0xe2)](_0x1446ff(0xad)),console[_0x1446ff(0xe2)](_0x1446ff(0xbf),_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xc3)],'->',_0x2bbd57),console[_0x1446ff(0xe2)](_0x1446ff(0x71),_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xbd)],_0x239fbf[_0x1446ff(0xa7)]['inputCurrency']),console[_0x1446ff(0xe2)](_0x1446ff(0x84),_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0x9b)]),console['log']('IBAN:',_0x1bb114||'not\x20found'),console[_0x1446ff(0xe2)](_0x1446ff(0xc4),_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xde)]),console['log'](_0x1446ff(0xe4),_0x239fbf['data']['TransactionConfirmedOn']||_0x1446ff(0x8e));if(_0x239fbf['data']['Status']?.[_0x1446ff(0xdb)]()===_0x1446ff(0xab))console[_0x1446ff(0xe2)](_0x1446ff(0x6b));else _0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xc3)]?.['toLowerCase']()==='paid'&&console[_0x1446ff(0xe2)](_0x1446ff(0x74));return{'status':_0x2bbd57,'amount':parseFloat(_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0xbd)])||undefined,'currency':_0x239fbf[_0x1446ff(0xa7)][_0x1446ff(0x8b)]||_0x1446ff(0xe1),'paymentDetails':_0x82873c};}catch(_0x388da4){console['error'](_0x1446ff(0xc6),_0x388da4),loggerService_1[_0x1446ff(0xa8)][_0x1446ff(0xa9)](_0x1446ff(0xba),_0x1446ff(0x6f),_0x388da4);throw new Error(_0x1446ff(0xaa)+(_0x388da4 instanceof Error?_0x388da4['message']:_0x1446ff(0xe0)));}}async[a55_0x59c4bd(0x9a)](_0x440f57){const _0x1c14eb=a55_0x59c4bd,_0x22cd3e=await this[_0x1c14eb(0xd6)](_0x440f57);return{'status':_0x22cd3e[_0x1c14eb(0x69)],'amount':_0x22cd3e[_0x1c14eb(0xd8)],'currency':_0x22cd3e['currency']};}async[a55_0x59c4bd(0xcc)](_0x37aebb){const _0x427b9d=a55_0x59c4bd;console['log'](_0x427b9d(0x73),_0x37aebb);let _0x2f81c6='PENDING';switch(_0x37aebb[_0x427b9d(0x69)]?.[_0x427b9d(0xdb)]()){case _0x427b9d(0x6e):_0x2f81c6=_0x427b9d(0x87);break;case _0x427b9d(0x7b):case _0x427b9d(0xc0):case _0x427b9d(0x7d):_0x2f81c6=_0x427b9d(0xbc);break;case _0x427b9d(0x96):case'timeout':_0x2f81c6=_0x427b9d(0xa2);break;case _0x427b9d(0xb2):case _0x427b9d(0x8a):case'awaiting\x20fiat':case _0x427b9d(0xe8):default:_0x2f81c6=_0x427b9d(0x95);break;}return{'paymentId':_0x37aebb[_0x427b9d(0x90)]||_0x37aebb[_0x427b9d(0x66)]||'','status':_0x2f81c6,'amount':_0x37aebb[_0x427b9d(0xd8)],'currency':_0x37aebb[_0x427b9d(0xc1)]||_0x427b9d(0xe1)};}}exports[a55_0x59c4bd(0xdf)]=CoinToPayService;