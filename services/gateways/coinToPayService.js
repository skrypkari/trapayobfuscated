'use strict';const a38_0x5aa8e3=a38_0x5266;function a38_0x5266(_0x4949f9,_0x402102){const _0x3327d6=a38_0x3327();return a38_0x5266=function(_0x5266db,_0x3cf312){_0x5266db=_0x5266db-0xb8;let _0x31484c=_0x3327d6[_0x5266db];return _0x31484c;},a38_0x5266(_0x4949f9,_0x402102);}(function(_0x2cd918,_0x425ab6){const _0x5b131a=a38_0x5266,_0x59dacc=_0x2cd918();while(!![]){try{const _0x578de2=-parseInt(_0x5b131a(0x10d))/0x1+parseInt(_0x5b131a(0x10e))/0x2+parseInt(_0x5b131a(0xcb))/0x3+parseInt(_0x5b131a(0xf4))/0x4+parseInt(_0x5b131a(0x12e))/0x5*(-parseInt(_0x5b131a(0x12d))/0x6)+parseInt(_0x5b131a(0x12f))/0x7*(parseInt(_0x5b131a(0xd5))/0x8)+-parseInt(_0x5b131a(0xc5))/0x9*(parseInt(_0x5b131a(0x127))/0xa);if(_0x578de2===_0x425ab6)break;else _0x59dacc['push'](_0x59dacc['shift']());}catch(_0x91a4a){_0x59dacc['push'](_0x59dacc['shift']());}}}(a38_0x3327,0x68eee));Object[a38_0x5aa8e3(0xd2)](exports,a38_0x5aa8e3(0x129),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x5aa8e3(0xeb));class CoinToPayService{constructor(){const _0x26f89d=a38_0x5aa8e3;this[_0x26f89d(0xe2)]='https://tesoft.uk/gateway/cointopay/',this[_0x26f89d(0xd3)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x26f89d(0xda)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x31f85f){const _0x1cfd3b=a38_0x5aa8e3,{orderId:_0x492c7c,amount:_0x23cfaf}=_0x31f85f;console[_0x1cfd3b(0xda)](_0x1cfd3b(0xef)+_0x23cfaf+_0x1cfd3b(0x12a));const _0x15a3b6={'amount':_0x23cfaf},_0x123021=Date[_0x1cfd3b(0xdf)]();try{console[_0x1cfd3b(0xda)](_0x1cfd3b(0x11b)),console['log'](_0x1cfd3b(0xbd),this[_0x1cfd3b(0xe2)]),console[_0x1cfd3b(0xda)](_0x1cfd3b(0xcf),JSON[_0x1cfd3b(0xf0)](_0x15a3b6,null,0x2)),console['log'](_0x1cfd3b(0x111),_0x23cfaf,_0x1cfd3b(0xed)),loggerService_1[_0x1cfd3b(0x139)][_0x1cfd3b(0x11e)]('cointopay','/create',_0x1cfd3b(0xe6),_0x15a3b6);const _0x22c662=await fetch(this['apiUrl'],{'method':_0x1cfd3b(0xe6),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1cfd3b(0xfe)},'body':JSON[_0x1cfd3b(0xf0)](_0x15a3b6)}),_0x408ff1=Date[_0x1cfd3b(0xdf)]()-_0x123021;console['log'](_0x1cfd3b(0x103)),console[_0x1cfd3b(0xda)](_0x1cfd3b(0x112),_0x22c662[_0x1cfd3b(0x107)]),console[_0x1cfd3b(0xda)](_0x1cfd3b(0xb8),_0x22c662['statusText']),console[_0x1cfd3b(0xda)](_0x1cfd3b(0x102),Object['fromEntries'](_0x22c662['headers'][_0x1cfd3b(0xf6)]())),console['log'](_0x1cfd3b(0xc3),_0x408ff1+'ms');const _0xb681fb=await _0x22c662[_0x1cfd3b(0x120)]();console[_0x1cfd3b(0xda)](_0x1cfd3b(0x121),_0xb681fb);if(!_0x22c662['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x22c662[_0x1cfd3b(0x107)]),console[_0x1cfd3b(0x117)]('Response\x20Body:',_0xb681fb),loggerService_1['loggerService'][_0x1cfd3b(0x101)](_0x1cfd3b(0xbf),_0x1cfd3b(0x10b),_0x22c662[_0x1cfd3b(0x107)],_0xb681fb,_0x408ff1),loggerService_1[_0x1cfd3b(0x139)]['logWhiteDomainError']('cointopay',_0x1cfd3b(0x10b),_0x1cfd3b(0x122)+_0x22c662[_0x1cfd3b(0x107)]+':\x20'+_0xb681fb);throw new Error(_0x1cfd3b(0xee)+_0x22c662['status']+_0x1cfd3b(0x130)+_0xb681fb);}let _0x286023;try{_0x286023=JSON[_0x1cfd3b(0x136)](_0xb681fb);}catch(_0x268d91){console[_0x1cfd3b(0x117)](_0x1cfd3b(0xbe),_0x268d91),loggerService_1[_0x1cfd3b(0x139)][_0x1cfd3b(0xfd)]('cointopay',_0x1cfd3b(0x10b),'JSON\x20Parse\x20Error:\x20'+_0x268d91);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0xb681fb);}console[_0x1cfd3b(0xda)](_0x1cfd3b(0x11f)),console[_0x1cfd3b(0xda)](_0x1cfd3b(0xfb),JSON['stringify'](_0x286023,null,0x2)),loggerService_1['loggerService'][_0x1cfd3b(0x101)]('cointopay','/create',_0x22c662[_0x1cfd3b(0x107)],_0x286023,_0x408ff1);if(_0x286023[_0x1cfd3b(0x117)]){const _0x4edce6=_0x286023[_0x1cfd3b(0xf1)]||_0x286023['error']||_0x1cfd3b(0x12c);console[_0x1cfd3b(0x117)](_0x1cfd3b(0xc6)),console['error'](_0x1cfd3b(0xcc),_0x4edce6),loggerService_1['loggerService'][_0x1cfd3b(0xfd)](_0x1cfd3b(0xbf),_0x1cfd3b(0x10b),_0x1cfd3b(0xe1)+_0x4edce6);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4edce6);}if(!_0x286023[_0x1cfd3b(0x100)]||!_0x286023['gateway_payment_id']){console[_0x1cfd3b(0x117)](_0x1cfd3b(0xe0)),console['error'](_0x1cfd3b(0x135)),console[_0x1cfd3b(0x117)](_0x1cfd3b(0xbc),_0x286023),loggerService_1[_0x1cfd3b(0x139)][_0x1cfd3b(0xfd)](_0x1cfd3b(0xbf),_0x1cfd3b(0x10b),_0x1cfd3b(0xe8));throw new Error(_0x1cfd3b(0x133));}return console[_0x1cfd3b(0xda)](_0x1cfd3b(0xdc)),console['log'](_0x1cfd3b(0xc7),_0x286023[_0x1cfd3b(0x113)]),console['log'](_0x1cfd3b(0xd1),_0x286023['payment_url']),console[_0x1cfd3b(0xda)]('Amount:',_0x23cfaf,_0x1cfd3b(0x10c)),{'gateway_payment_id':_0x286023[_0x1cfd3b(0x113)],'payment_url':_0x286023[_0x1cfd3b(0x100)]};}catch(_0xec0b99){console[_0x1cfd3b(0x117)](_0x1cfd3b(0xc0)),console[_0x1cfd3b(0x117)](_0x1cfd3b(0xce),_0xec0b99),loggerService_1[_0x1cfd3b(0x139)]['logWhiteDomainError'](_0x1cfd3b(0xbf),_0x1cfd3b(0x10b),_0xec0b99);if(_0xec0b99 instanceof Error){console[_0x1cfd3b(0x117)](_0x1cfd3b(0x105),_0xec0b99[_0x1cfd3b(0xf1)]),console[_0x1cfd3b(0x117)](_0x1cfd3b(0xf5),_0xec0b99[_0x1cfd3b(0xea)]);throw new Error(_0x1cfd3b(0x10f)+_0xec0b99[_0x1cfd3b(0xf1)]);}throw new Error(_0x1cfd3b(0x118));}}async[a38_0x5aa8e3(0x128)](_0x2647ce){const _0x3c0bce=a38_0x5aa8e3,_0xa927a9=Date[_0x3c0bce(0xdf)]();try{console[_0x3c0bce(0xda)](_0x3c0bce(0x109)+_0x2647ce);const _0x414533={'gatewayPaymentId':_0x2647ce};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x3c0bce(0xd8),_0x3c0bce(0xe6),_0x414533);const _0x5c9c11=await fetch(this['statusUrl'],{'method':_0x3c0bce(0xe6),'headers':{'Content-Type':_0x3c0bce(0xdd),'Accept':'application/json','User-Agent':_0x3c0bce(0xfe)},'body':JSON[_0x3c0bce(0xf0)](_0x414533)}),_0x22f4f7=Date['now']()-_0xa927a9;console['log'](_0x3c0bce(0x125)),console[_0x3c0bce(0xda)]('Status:',_0x5c9c11[_0x3c0bce(0x107)]),console[_0x3c0bce(0xda)]('Response\x20Time:',_0x22f4f7+'ms');if(!_0x5c9c11['ok']){const _0x5a7ad0=await _0x5c9c11[_0x3c0bce(0x120)]();console[_0x3c0bce(0x117)]('HTTP\x20Status:',_0x5c9c11[_0x3c0bce(0x107)]),console[_0x3c0bce(0x117)]('Response\x20Body:',_0x5a7ad0),loggerService_1[_0x3c0bce(0x139)][_0x3c0bce(0x101)]('cointopay',_0x3c0bce(0xd8),_0x5c9c11[_0x3c0bce(0x107)],_0x5a7ad0,_0x22f4f7),loggerService_1['loggerService'][_0x3c0bce(0xfd)](_0x3c0bce(0xbf),_0x3c0bce(0xd8),'HTTP\x20'+_0x5c9c11[_0x3c0bce(0x107)]+':\x20'+_0x5a7ad0);throw new Error(_0x3c0bce(0xee)+_0x5c9c11['status']);}const _0x55c2ea=await _0x5c9c11[_0x3c0bce(0x120)]();console[_0x3c0bce(0xda)]('Raw\x20Response\x20Body:',_0x55c2ea);let _0x43118d;try{_0x43118d=JSON['parse'](_0x55c2ea);}catch(_0x2a2f8f){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2a2f8f),loggerService_1[_0x3c0bce(0x139)][_0x3c0bce(0xfd)](_0x3c0bce(0xbf),_0x3c0bce(0xd8),'JSON\x20Parse\x20Error:\x20'+_0x2a2f8f);throw new Error(_0x3c0bce(0x10a)+_0x55c2ea);}loggerService_1[_0x3c0bce(0x139)][_0x3c0bce(0x101)]('cointopay',_0x3c0bce(0xd8),_0x5c9c11[_0x3c0bce(0x107)],_0x43118d,_0x22f4f7),console[_0x3c0bce(0xda)](_0x3c0bce(0xd6)),console['log'](_0x3c0bce(0xe4),_0x43118d[_0x3c0bce(0xcd)]),console[_0x3c0bce(0xda)](_0x3c0bce(0x106),_0x43118d[_0x3c0bce(0x137)]),console['log'](_0x3c0bce(0xe9),_0x43118d['data']?.[_0x3c0bce(0x11a)]),console['log'](_0x3c0bce(0x111),_0x43118d[_0x3c0bce(0x114)]?.[_0x3c0bce(0xba)]),console[_0x3c0bce(0xda)]('Currency:',_0x43118d[_0x3c0bce(0x114)]?.[_0x3c0bce(0xde)]);if(_0x43118d[_0x3c0bce(0xcd)]!=='success'||_0x43118d[_0x3c0bce(0x137)]!==0xc8){const _0x1fc92d=_0x43118d['message']||_0x3c0bce(0x108);console[_0x3c0bce(0x117)](_0x3c0bce(0x138)),console[_0x3c0bce(0x117)](_0x3c0bce(0xcc),_0x1fc92d),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/status',_0x3c0bce(0xc1)+_0x1fc92d);throw new Error(_0x3c0bce(0xd4)+_0x1fc92d);}if(!_0x43118d[_0x3c0bce(0x114)]){console['error'](_0x3c0bce(0xec)),console[_0x3c0bce(0x117)](_0x3c0bce(0xd7)),loggerService_1[_0x3c0bce(0x139)][_0x3c0bce(0xfd)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3c0bce(0x11c));}let _0x174704='PENDING';switch(_0x43118d[_0x3c0bce(0x114)]['Status']?.['toLowerCase']()){case _0x3c0bce(0xf8):_0x174704=_0x3c0bce(0x126);break;case _0x3c0bce(0xf2):case _0x3c0bce(0xe7):case _0x3c0bce(0x117):_0x174704=_0x3c0bce(0xc2);break;case'expired':case _0x3c0bce(0x12b):_0x174704=_0x3c0bce(0x119);break;case _0x3c0bce(0xfc):case _0x3c0bce(0xf7):case _0x3c0bce(0x110):case _0x3c0bce(0xe3):default:_0x174704=_0x3c0bce(0xbb);break;}let _0x430c90,_0x1849c5;if(_0x43118d[_0x3c0bce(0x114)]['PaymentDetail']){const _0x52881f=_0x43118d['data']['PaymentDetail'];console[_0x3c0bce(0xda)]('🏦\x20Payment\x20Detail:',_0x52881f);const _0x4e2730=_0x52881f[_0x3c0bce(0xdb)](/IBAN\s+([A-Z0-9]+)/i);_0x4e2730&&(_0x430c90=_0x4e2730[0x1],console[_0x3c0bce(0xda)](_0x3c0bce(0xc4),_0x430c90)),_0x1849c5=_0x52881f;}const _0x4f9d05={'iban':_0x430c90,'bankDetails':_0x1849c5,'transactionId':_0x43118d['data'][_0x3c0bce(0x115)],'coinAddress':_0x43118d['data'][_0x3c0bce(0xb9)],'qrCodeUrl':_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0x131)],'expiryTime':_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0xc9)],'createdOn':_0x43118d['data'][_0x3c0bce(0x132)],'confirmedOn':_0x43118d['data'][_0x3c0bce(0xd0)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3c0bce(0xda)]('Status:',_0x43118d[_0x3c0bce(0x114)]['Status'],'->',_0x174704),console[_0x3c0bce(0xda)](_0x3c0bce(0x111),_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0xba)],_0x43118d[_0x3c0bce(0x114)]['inputCurrency']),console[_0x3c0bce(0xda)](_0x3c0bce(0x124),_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0x115)]),console[_0x3c0bce(0xda)](_0x3c0bce(0xfa),_0x430c90||_0x3c0bce(0x11d)),console['log'](_0x3c0bce(0xd9),_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0x132)]),console[_0x3c0bce(0xda)]('Confirmed\x20On:',_0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0xd0)]||_0x3c0bce(0xca));if(_0x43118d[_0x3c0bce(0x114)]['Status']?.['toLowerCase']()==='awaiting\x20fiat')console[_0x3c0bce(0xda)](_0x3c0bce(0xf3));else _0x43118d[_0x3c0bce(0x114)][_0x3c0bce(0x11a)]?.[_0x3c0bce(0xff)]()===_0x3c0bce(0xf8)&&console[_0x3c0bce(0xda)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x174704,'amount':parseFloat(_0x43118d['data']['Amount'])||undefined,'currency':_0x43118d['data'][_0x3c0bce(0xde)]||_0x3c0bce(0x10c),'paymentDetails':_0x4f9d05};}catch(_0x2fafda){console[_0x3c0bce(0x117)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x2fafda),loggerService_1[_0x3c0bce(0x139)][_0x3c0bce(0xfd)](_0x3c0bce(0xbf),'/status',_0x2fafda);throw new Error(_0x3c0bce(0xe5)+(_0x2fafda instanceof Error?_0x2fafda[_0x3c0bce(0xf1)]:_0x3c0bce(0x134)));}}async['verifyPayment'](_0x24ac2f){const _0xad4158=a38_0x5aa8e3,_0x2ff4a3=await this[_0xad4158(0x128)](_0x24ac2f);return{'status':_0x2ff4a3[_0xad4158(0x107)],'amount':_0x2ff4a3[_0xad4158(0xc8)],'currency':_0x2ff4a3[_0xad4158(0xf9)]};}async['processWebhook'](_0x28d16a){const _0x2d14be=a38_0x5aa8e3;console[_0x2d14be(0xda)](_0x2d14be(0x104),_0x28d16a);let _0x3a14ca='PENDING';switch(_0x28d16a[_0x2d14be(0x107)]?.[_0x2d14be(0xff)]()){case _0x2d14be(0xf8):_0x3a14ca='PAID';break;case _0x2d14be(0xf2):case'failed':case _0x2d14be(0x117):_0x3a14ca=_0x2d14be(0xc2);break;case'expired':case _0x2d14be(0x12b):_0x3a14ca=_0x2d14be(0x119);break;case _0x2d14be(0x110):case'waiting':case _0x2d14be(0xf7):case _0x2d14be(0xe3):default:_0x3a14ca=_0x2d14be(0xbb);break;}return{'paymentId':_0x28d16a['order_id']||_0x28d16a[_0x2d14be(0x123)]||'','status':_0x3a14ca,'amount':_0x28d16a[_0x2d14be(0xc8)],'currency':_0x28d16a['currency']||_0x2d14be(0x10c)};}}function a38_0x3327(){const _0x497e16=['Missing\x20data\x20in\x20response','/status','Created\x20On:','log','match','===\x20COINTOPAY\x20SUCCESS\x20===','application/json','inputCurrency','now','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Business\x20Error:\x20','apiUrl','created','Result:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','POST','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20Status:','stack','../loggerService','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','HTTP\x20error!\x20status:\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20','stringify','message','cancelled','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','3430308KcZIgL','Error\x20stack:','entries','awaiting\x20fiat','paid','currency','IBAN:','Parsed\x20Result:','waiting','logWhiteDomainError','TesSoft\x20Payment\x20System/1.0','toLowerCase','payment_url','logWhiteDomainResponse','Headers:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Error\x20message:','Status\x20Code:','status','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','/create','EUR','392988ouBAdI','282538rOxCHm','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','pending','Amount:','Status:','gateway_payment_id','data','TransactionID','CoinToPayService','error','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','EXPIRED','Status','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','not\x20found','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','text','Raw\x20Response\x20Body:','HTTP\x20','merchant_reference_id','Transaction\x20ID:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','PAID','10LSkDKA','checkPaymentStatus','__esModule','\x20EUR','timeout','Unknown\x20error\x20from\x20CoinToPay\x20API','180DoOsUi','77015CTkBhb','1974735QnEVvh',',\x20body:\x20','QRCodeURL','CreatedOn','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','parse','status_code','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','loggerService','Status\x20Text:','coinAddress','Amount','PENDING','Response\x20data:','URL:','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Status\x20API\x20Error:\x20','FAILED','Response\x20Time:','🏦\x20Extracted\x20IBAN:','2455146xhVUmU','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Gateway\x20Payment\x20ID:','amount','ExpiryTime','not\x20confirmed','830181nznVjn','Error\x20Message:','result','Error\x20details:','Request\x20Body:','TransactionConfirmedOn','Payment\x20URL:','defineProperty','statusUrl','CoinToPay\x20status\x20API\x20error:\x20','8fxwyCE','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='];a38_0x3327=function(){return _0x497e16;};return a38_0x3327();}exports[a38_0x5aa8e3(0x116)]=CoinToPayService;