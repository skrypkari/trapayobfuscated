'use strict';const a38_0x5b840c=a38_0x204b;(function(_0x5b10bf,_0x171b97){const _0x1f0fcc=a38_0x204b,_0x2f81f1=_0x5b10bf();while(!![]){try{const _0x2aed21=-parseInt(_0x1f0fcc(0xcd))/0x1*(-parseInt(_0x1f0fcc(0xad))/0x2)+-parseInt(_0x1f0fcc(0xaa))/0x3+-parseInt(_0x1f0fcc(0xb5))/0x4+-parseInt(_0x1f0fcc(0xa8))/0x5+-parseInt(_0x1f0fcc(0x93))/0x6*(-parseInt(_0x1f0fcc(0xbd))/0x7)+-parseInt(_0x1f0fcc(0x9e))/0x8+-parseInt(_0x1f0fcc(0xb6))/0x9*(-parseInt(_0x1f0fcc(0xd5))/0xa);if(_0x2aed21===_0x171b97)break;else _0x2f81f1['push'](_0x2f81f1['shift']());}catch(_0x2e145e){_0x2f81f1['push'](_0x2f81f1['shift']());}}}(a38_0x2e47,0xbb92a));function a38_0x2e47(){const _0x12224c=['Response\x20Body:','Payment\x20URL:','PENDING','cancelled','HTTP\x20error!\x20status:\x20','https://tesoft.uk/gateway/cointopay/status.php','paid','Response\x20Time:','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Headers:','Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','ExpiryTime','awaiting\x20fiat','defineProperty','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','1460202UgZnWC','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','gateway_payment_id','EUR','/create','createPaymentLink','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Gateway\x20Payment\x20ID:','success','POST','Request\x20Body:','10585192Qnhoxf','checkPaymentStatus','Amount','created','FAILED','stringify','Business\x20Error:\x20','HTTP\x20','currency','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','995115EnubTE','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','888090RHUymT','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20Status:','2848996peRnBt','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','statusUrl','===\x20COINTOPAY\x20SUCCESS\x20===','fromEntries','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','log','result','1540084gRjFuJ','2933226gcZeJQ','Error\x20Message:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','processWebhook','coinAddress','inputCurrency','Amount:','7UGhYFv','toLowerCase','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','statusText','message','status_code','waiting',',\x20body:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20EUR','Unknown\x20error\x20from\x20CoinToPay\x20API','TransactionID','Error\x20details:','status','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','1KLrGpK','text','üè¶\x20Extracted\x20IBAN:','loggerService','Status\x20Text:','https://tesoft.uk/gateway/cointopay/','amount','Created\x20On:','40pPJGik','PAID','data','CoinToPay\x20payment\x20status\x20check\x20error:','/status','CoinToPay\x20API\x20error:\x20','URL:','now','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','logWhiteDomainResponse','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','QRCodeURL','timeout','pending','Unknown\x20error','cointopay','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','failed','PaymentDetail','match','entries','order_id','Currency:','EXPIRED','Transaction\x20ID:','Missing\x20data\x20in\x20response','Status','Incomplete\x20response:\x20missing\x20data','CreatedOn','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','apiUrl','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','../loggerService','logWhiteDomainError','__esModule','TesSoft\x20Payment\x20System/1.0','error','merchant_reference_id','Status\x20API\x20Error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','stack','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','HTTP\x20Status:','not\x20confirmed','IBAN:','application/json','Response\x20data:','CoinToPayService','logWhiteDomainRequest','expired','payment_url','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='];a38_0x2e47=function(){return _0x12224c;};return a38_0x2e47();}Object[a38_0x5b840c(0x90)](exports,a38_0x5b840c(0x6f),{'value':!![]}),exports[a38_0x5b840c(0x7c)]=void 0x0;const loggerService_1=require(a38_0x5b840c(0x6d));function a38_0x204b(_0x476dcd,_0x2039a8){const _0x2e4773=a38_0x2e47();return a38_0x204b=function(_0x204b15,_0x2ce04e){_0x204b15=_0x204b15-0x69;let _0x4861e4=_0x2e4773[_0x204b15];return _0x4861e4;},a38_0x204b(_0x476dcd,_0x2039a8);}class CoinToPayService{constructor(){const _0x5346d4=a38_0x5b840c;this[_0x5346d4(0x6b)]=_0x5346d4(0xd2),this[_0x5346d4(0xaf)]=_0x5346d4(0x86),console['log'](_0x5346d4(0x6c)),console[_0x5346d4(0xb3)]('üìä\x20Status\x20check\x20URL:',this[_0x5346d4(0xaf)]);}async[a38_0x5b840c(0x98)](_0x2429e2){const _0x233e6c=a38_0x5b840c,{orderId:_0x3668f9,amount:_0x60691b}=_0x2429e2;console[_0x233e6c(0xb3)](_0x233e6c(0xae)+_0x60691b+_0x233e6c(0xc6));const _0x3deb00={'amount':_0x60691b},_0x501165=Date[_0x233e6c(0xdc)]();try{console[_0x233e6c(0xb3)](_0x233e6c(0x91)),console[_0x233e6c(0xb3)](_0x233e6c(0xdb),this[_0x233e6c(0x6b)]),console[_0x233e6c(0xb3)](_0x233e6c(0x9d),JSON[_0x233e6c(0xa3)](_0x3deb00,null,0x2)),console[_0x233e6c(0xb3)](_0x233e6c(0xbc),_0x60691b,_0x233e6c(0x74)),loggerService_1[_0x233e6c(0xd0)][_0x233e6c(0x7d)]('cointopay',_0x233e6c(0x97),_0x233e6c(0x9c),_0x3deb00);const _0x3dc3ca=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x233e6c(0x7a),'Accept':_0x233e6c(0x7a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x233e6c(0xa3)](_0x3deb00)}),_0x37988c=Date['now']()-_0x501165;console['log'](_0x233e6c(0x69)),console['log']('Status:',_0x3dc3ca['status']),console[_0x233e6c(0xb3)](_0x233e6c(0xd1),_0x3dc3ca[_0x233e6c(0xc0)]),console[_0x233e6c(0xb3)](_0x233e6c(0x8b),Object[_0x233e6c(0xb1)](_0x3dc3ca['headers'][_0x233e6c(0xe9)]())),console['log'](_0x233e6c(0x88),_0x37988c+'ms');const _0x3dc5f5=await _0x3dc3ca[_0x233e6c(0xce)]();console[_0x233e6c(0xb3)]('Raw\x20Response\x20Body:',_0x3dc5f5);if(!_0x3dc3ca['ok']){console[_0x233e6c(0x71)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x233e6c(0x71)](_0x233e6c(0x77),_0x3dc3ca['status']),console[_0x233e6c(0x71)](_0x233e6c(0x81),_0x3dc5f5),loggerService_1[_0x233e6c(0xd0)][_0x233e6c(0xde)]('cointopay',_0x233e6c(0x97),_0x3dc3ca['status'],_0x3dc5f5,_0x37988c),loggerService_1[_0x233e6c(0xd0)][_0x233e6c(0x6e)](_0x233e6c(0xe4),_0x233e6c(0x97),_0x233e6c(0xa5)+_0x3dc3ca[_0x233e6c(0xca)]+':\x20'+_0x3dc5f5);throw new Error(_0x233e6c(0x85)+_0x3dc3ca['status']+_0x233e6c(0xc4)+_0x3dc5f5);}let _0x11c460;try{_0x11c460=JSON['parse'](_0x3dc5f5);}catch(_0x570024){console[_0x233e6c(0x71)](_0x233e6c(0xab),_0x570024),loggerService_1[_0x233e6c(0xd0)][_0x233e6c(0x6e)](_0x233e6c(0xe4),_0x233e6c(0x97),_0x233e6c(0xcb)+_0x570024);throw new Error(_0x233e6c(0x94)+_0x3dc5f5);}console[_0x233e6c(0xb3)](_0x233e6c(0x6a)),console[_0x233e6c(0xb3)]('Parsed\x20Result:',JSON[_0x233e6c(0xa3)](_0x11c460,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x233e6c(0xe4),_0x233e6c(0x97),_0x3dc3ca['status'],_0x11c460,_0x37988c);if(_0x11c460[_0x233e6c(0x71)]){const _0xe9009c=_0x11c460[_0x233e6c(0xc1)]||_0x11c460[_0x233e6c(0x71)]||_0x233e6c(0xc7);console[_0x233e6c(0x71)](_0x233e6c(0x80)),console[_0x233e6c(0x71)]('Error\x20Message:',_0xe9009c),loggerService_1['loggerService']['logWhiteDomainError'](_0x233e6c(0xe4),_0x233e6c(0x97),_0x233e6c(0xa4)+_0xe9009c);throw new Error(_0x233e6c(0xda)+_0xe9009c);}if(!_0x11c460['payment_url']||!_0x11c460[_0x233e6c(0x95)]){console[_0x233e6c(0x71)](_0x233e6c(0xc5)),console[_0x233e6c(0x71)](_0x233e6c(0xe5)),console[_0x233e6c(0x71)](_0x233e6c(0x7b),_0x11c460),loggerService_1[_0x233e6c(0xd0)][_0x233e6c(0x6e)](_0x233e6c(0xe4),_0x233e6c(0x97),_0x233e6c(0x99));throw new Error(_0x233e6c(0xbf));}return console[_0x233e6c(0xb3)](_0x233e6c(0xb0)),console[_0x233e6c(0xb3)](_0x233e6c(0x9a),_0x11c460['gateway_payment_id']),console['log'](_0x233e6c(0x82),_0x11c460[_0x233e6c(0x7f)]),console[_0x233e6c(0xb3)](_0x233e6c(0xbc),_0x60691b,_0x233e6c(0x96)),{'gateway_payment_id':_0x11c460[_0x233e6c(0x95)],'payment_url':_0x11c460[_0x233e6c(0x7f)]};}catch(_0x54f188){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x233e6c(0x71)](_0x233e6c(0xc9),_0x54f188),loggerService_1['loggerService'][_0x233e6c(0x6e)](_0x233e6c(0xe4),_0x233e6c(0x97),_0x54f188);if(_0x54f188 instanceof Error){console[_0x233e6c(0x71)]('Error\x20message:',_0x54f188['message']),console[_0x233e6c(0x71)]('Error\x20stack:',_0x54f188[_0x233e6c(0x75)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x54f188[_0x233e6c(0xc1)]);}throw new Error(_0x233e6c(0x92));}}async['checkPaymentStatus'](_0x3bbbac){const _0x2c33a4=a38_0x5b840c,_0x44a821=Date[_0x2c33a4(0xdc)]();try{console['log'](_0x2c33a4(0xdf)+_0x3bbbac);const _0x2f2fcc={'gatewayPaymentId':_0x3bbbac};loggerService_1[_0x2c33a4(0xd0)]['logWhiteDomainRequest']('cointopay',_0x2c33a4(0xd9),_0x2c33a4(0x9c),_0x2f2fcc);const _0x4d3ac7=await fetch(this[_0x2c33a4(0xaf)],{'method':'POST','headers':{'Content-Type':_0x2c33a4(0x7a),'Accept':'application/json','User-Agent':_0x2c33a4(0x70)},'body':JSON[_0x2c33a4(0xa3)](_0x2f2fcc)}),_0x7dc440=Date[_0x2c33a4(0xdc)]()-_0x44a821;console[_0x2c33a4(0xb3)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x2c33a4(0x8c),_0x4d3ac7['status']),console[_0x2c33a4(0xb3)](_0x2c33a4(0x88),_0x7dc440+'ms');if(!_0x4d3ac7['ok']){const _0x1866d3=await _0x4d3ac7[_0x2c33a4(0xce)]();console[_0x2c33a4(0x71)](_0x2c33a4(0x77),_0x4d3ac7['status']),console[_0x2c33a4(0x71)](_0x2c33a4(0x81),_0x1866d3),loggerService_1[_0x2c33a4(0xd0)][_0x2c33a4(0xde)](_0x2c33a4(0xe4),_0x2c33a4(0xd9),_0x4d3ac7[_0x2c33a4(0xca)],_0x1866d3,_0x7dc440),loggerService_1['loggerService'][_0x2c33a4(0x6e)](_0x2c33a4(0xe4),_0x2c33a4(0xd9),_0x2c33a4(0xa5)+_0x4d3ac7[_0x2c33a4(0xca)]+':\x20'+_0x1866d3);throw new Error(_0x2c33a4(0x85)+_0x4d3ac7[_0x2c33a4(0xca)]);}const _0x4ed459=await _0x4d3ac7['text']();console[_0x2c33a4(0xb3)](_0x2c33a4(0x89),_0x4ed459);let _0x50a6f5;try{_0x50a6f5=JSON['parse'](_0x4ed459);}catch(_0x1584fb){console[_0x2c33a4(0x71)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1584fb),loggerService_1['loggerService'][_0x2c33a4(0x6e)](_0x2c33a4(0xe4),_0x2c33a4(0xd9),_0x2c33a4(0xcb)+_0x1584fb);throw new Error(_0x2c33a4(0x8d)+_0x4ed459);}loggerService_1[_0x2c33a4(0xd0)][_0x2c33a4(0xde)](_0x2c33a4(0xe4),'/status',_0x4d3ac7[_0x2c33a4(0xca)],_0x50a6f5,_0x7dc440),console[_0x2c33a4(0xb3)](_0x2c33a4(0x76)),console['log']('Result:',_0x50a6f5[_0x2c33a4(0xb4)]),console[_0x2c33a4(0xb3)]('Status\x20Code:',_0x50a6f5[_0x2c33a4(0xc2)]),console[_0x2c33a4(0xb3)](_0x2c33a4(0xac),_0x50a6f5[_0x2c33a4(0xd7)]?.[_0x2c33a4(0xef)]),console[_0x2c33a4(0xb3)]('Amount:',_0x50a6f5[_0x2c33a4(0xd7)]?.['Amount']),console[_0x2c33a4(0xb3)](_0x2c33a4(0xeb),_0x50a6f5[_0x2c33a4(0xd7)]?.[_0x2c33a4(0xbb)]);if(_0x50a6f5['result']!==_0x2c33a4(0x9b)||_0x50a6f5[_0x2c33a4(0xc2)]!==0xc8){const _0x14362d=_0x50a6f5[_0x2c33a4(0xc1)]||_0x2c33a4(0xcc);console[_0x2c33a4(0x71)](_0x2c33a4(0x8a)),console[_0x2c33a4(0x71)](_0x2c33a4(0xb7),_0x14362d),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/status',_0x2c33a4(0x73)+_0x14362d);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x14362d);}if(!_0x50a6f5[_0x2c33a4(0xd7)]){console[_0x2c33a4(0x71)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2c33a4(0x71)](_0x2c33a4(0xee)),loggerService_1[_0x2c33a4(0xd0)]['logWhiteDomainError'](_0x2c33a4(0xe4),_0x2c33a4(0xd9),_0x2c33a4(0xf0));throw new Error(_0x2c33a4(0xdd));}let _0x549382=_0x2c33a4(0x83);switch(_0x50a6f5['data'][_0x2c33a4(0xef)]?.[_0x2c33a4(0xbe)]()){case _0x2c33a4(0x87):_0x549382='PAID';break;case'cancelled':case _0x2c33a4(0xe6):case _0x2c33a4(0x71):_0x549382=_0x2c33a4(0xa2);break;case _0x2c33a4(0x7e):case'timeout':_0x549382=_0x2c33a4(0xec);break;case _0x2c33a4(0xc3):case _0x2c33a4(0x8f):case _0x2c33a4(0xe2):case _0x2c33a4(0xa1):default:_0x549382=_0x2c33a4(0x83);break;}let _0x49a0fe,_0x498cc1;if(_0x50a6f5['data'][_0x2c33a4(0xe7)]){const _0x1d0458=_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xe7)];console['log']('üè¶\x20Payment\x20Detail:',_0x1d0458);const _0x1e864c=_0x1d0458[_0x2c33a4(0xe8)](/IBAN\s+([A-Z0-9]+)/i);_0x1e864c&&(_0x49a0fe=_0x1e864c[0x1],console['log'](_0x2c33a4(0xcf),_0x49a0fe)),_0x498cc1=_0x1d0458;}const _0x283dd8={'iban':_0x49a0fe,'bankDetails':_0x498cc1,'transactionId':_0x50a6f5['data'][_0x2c33a4(0xc8)],'coinAddress':_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xba)],'qrCodeUrl':_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xe0)],'expiryTime':_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0x8e)],'createdOn':_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xf1)],'confirmedOn':_0x50a6f5[_0x2c33a4(0xd7)]['TransactionConfirmedOn']};console['log'](_0x2c33a4(0xa7)),console[_0x2c33a4(0xb3)](_0x2c33a4(0x8c),_0x50a6f5['data']['Status'],'->',_0x549382),console[_0x2c33a4(0xb3)](_0x2c33a4(0xbc),_0x50a6f5[_0x2c33a4(0xd7)]['Amount'],_0x50a6f5['data'][_0x2c33a4(0xbb)]),console['log'](_0x2c33a4(0xed),_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xc8)]),console['log'](_0x2c33a4(0x79),_0x49a0fe||'not\x20found'),console['log'](_0x2c33a4(0xd4),_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xf1)]),console[_0x2c33a4(0xb3)]('Confirmed\x20On:',_0x50a6f5[_0x2c33a4(0xd7)]['TransactionConfirmedOn']||_0x2c33a4(0x78));if(_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xef)]?.[_0x2c33a4(0xbe)]()===_0x2c33a4(0x8f))console['log'](_0x2c33a4(0xa9));else _0x50a6f5['data'][_0x2c33a4(0xef)]?.[_0x2c33a4(0xbe)]()===_0x2c33a4(0x87)&&console[_0x2c33a4(0xb3)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x549382,'amount':parseFloat(_0x50a6f5[_0x2c33a4(0xd7)][_0x2c33a4(0xa0)])||undefined,'currency':_0x50a6f5['data'][_0x2c33a4(0xbb)]||_0x2c33a4(0x96),'paymentDetails':_0x283dd8};}catch(_0xb257c3){console['error'](_0x2c33a4(0xd8),_0xb257c3),loggerService_1['loggerService'][_0x2c33a4(0x6e)](_0x2c33a4(0xe4),_0x2c33a4(0xd9),_0xb257c3);throw new Error(_0x2c33a4(0xb8)+(_0xb257c3 instanceof Error?_0xb257c3[_0x2c33a4(0xc1)]:_0x2c33a4(0xe3)));}}async['verifyPayment'](_0x321d5b){const _0x44c96c=a38_0x5b840c,_0xda3a54=await this[_0x44c96c(0x9f)](_0x321d5b);return{'status':_0xda3a54[_0x44c96c(0xca)],'amount':_0xda3a54[_0x44c96c(0xd3)],'currency':_0xda3a54[_0x44c96c(0xa6)]};}async[a38_0x5b840c(0xb9)](_0x24a355){const _0xd4614f=a38_0x5b840c;console['log'](_0xd4614f(0xb2),_0x24a355);let _0x121e6a=_0xd4614f(0x83);switch(_0x24a355['status']?.[_0xd4614f(0xbe)]()){case _0xd4614f(0x87):_0x121e6a=_0xd4614f(0xd6);break;case _0xd4614f(0x84):case _0xd4614f(0xe6):case _0xd4614f(0x71):_0x121e6a=_0xd4614f(0xa2);break;case'expired':case _0xd4614f(0xe1):_0x121e6a=_0xd4614f(0xec);break;case _0xd4614f(0xe2):case _0xd4614f(0xc3):case _0xd4614f(0x8f):case'created':default:_0x121e6a=_0xd4614f(0x83);break;}return{'paymentId':_0x24a355[_0xd4614f(0xea)]||_0x24a355[_0xd4614f(0x72)]||'','status':_0x121e6a,'amount':_0x24a355['amount'],'currency':_0x24a355[_0xd4614f(0xa6)]||_0xd4614f(0x96)};}}exports[a38_0x5b840c(0x7c)]=CoinToPayService;