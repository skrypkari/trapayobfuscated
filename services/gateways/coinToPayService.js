'use strict';const a38_0x33e68a=a38_0x4049;(function(_0x4d47db,_0x33ff36){const _0x1de757=a38_0x4049,_0x188d35=_0x4d47db();while(!![]){try{const _0x1c53db=parseInt(_0x1de757(0x105))/0x1*(-parseInt(_0x1de757(0xc7))/0x2)+-parseInt(_0x1de757(0xe6))/0x3*(parseInt(_0x1de757(0xc6))/0x4)+-parseInt(_0x1de757(0xfb))/0x5*(-parseInt(_0x1de757(0xf5))/0x6)+-parseInt(_0x1de757(0xf3))/0x7*(-parseInt(_0x1de757(0x9a))/0x8)+-parseInt(_0x1de757(0xae))/0x9+parseInt(_0x1de757(0x87))/0xa*(-parseInt(_0x1de757(0xa5))/0xb)+-parseInt(_0x1de757(0x109))/0xc*(-parseInt(_0x1de757(0xe0))/0xd);if(_0x1c53db===_0x33ff36)break;else _0x188d35['push'](_0x188d35['shift']());}catch(_0x48921e){_0x188d35['push'](_0x188d35['shift']());}}}(a38_0x5197,0x23985));Object[a38_0x33e68a(0x8b)](exports,a38_0x33e68a(0x106),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x33e68a(0xd1));function a38_0x5197(){const _0x199186=['success','stringify','https://tesoft.uk/gateway/cointopay/status.php','784656rDGTpD','QRCodeURL','data','amount','logWhiteDomainRequest','loggerService','Currency:','not\x20confirmed','Payment\x20Status:','createPaymentLink','Error\x20message:','11aCtKBa','statusUrl','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','PENDING','/status','2209050MVtGDw','coinAddress','toLowerCase','log','Gateway\x20Payment\x20ID:','Error\x20Message:','EXPIRED','status_code','cancelled','Response\x20data:','FAILED','parse','paid','===\x20COINTOPAY\x20API\x20ERROR\x20===','apiUrl','EUR','now','not\x20found','Error\x20details:','üè¶\x20Extracted\x20IBAN:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','4ZDKLZe','10QSWTTt','ExpiryTime','awaiting\x20fiat','inputCurrency','statusText','Status\x20Text:','gateway_payment_id','logWhiteDomainError','message','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','../loggerService','created','Status','Amount','processWebhook','Missing\x20data\x20in\x20response','Business\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error','stack','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','payment_url','Status\x20Code:','PAID','3236922sluBEV','Status\x20API\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','pending','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','failed','270372aomPew','result','order_id','cointopay','Payment\x20URL:','currency','waiting','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','status','/create','Response\x20Time:','TesSoft\x20Payment\x20System/1.0','7pwvKbA','checkPaymentStatus','24CwWfAe','application/json','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Result:','error','üè¶\x20Payment\x20Detail:','62255NEAbQE','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20Status:','Created\x20On:','IBAN:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Confirmed\x20On:','timeout','Response\x20Body:','entries','31093Nopxgw','__esModule','CreatedOn','TransactionID','24ZjYHxn','fromEntries','CoinToPayService','PaymentDetail','CoinToPay\x20API\x20error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','\x20EUR','expired','POST','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Amount:','90380UXBwav','TransactionConfirmedOn','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','defineProperty',',\x20body:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Headers:','match','verifyPayment','text','Failed\x20to\x20parse\x20JSON\x20response:','üìä\x20Status\x20check\x20URL:','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='];a38_0x5197=function(){return _0x199186;};return a38_0x5197();}class CoinToPayService{constructor(){const _0x444fc4=a38_0x33e68a;this[_0x444fc4(0xbc)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x444fc4(0x99),console['log'](_0x444fc4(0xdb)),console['log'](_0x444fc4(0x94),this['statusUrl']);}async[a38_0x33e68a(0xa3)](_0x1e9e08){const _0x43b92e=a38_0x33e68a,{orderId:_0x287eca,amount:_0x180f9a}=_0x1e9e08;console[_0x43b92e(0xb1)](_0x43b92e(0x7e)+_0x180f9a+_0x43b92e(0x80));const _0x43582d={'amount':_0x180f9a},_0x3ca6ea=Date['now']();try{console['log'](_0x43b92e(0x8d)),console[_0x43b92e(0xb1)]('URL:',this[_0x43b92e(0xbc)]),console[_0x43b92e(0xb1)]('Request\x20Body:',JSON[_0x43b92e(0x98)](_0x43582d,null,0x2)),console[_0x43b92e(0xb1)](_0x43b92e(0x86),_0x180f9a,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x43b92e(0x9e)]('cointopay',_0x43b92e(0xf0),_0x43b92e(0x82),_0x43582d);const _0x2dbe90=await fetch(this[_0x43b92e(0xbc)],{'method':'POST','headers':{'Content-Type':_0x43b92e(0xf6),'Accept':_0x43b92e(0xf6),'User-Agent':_0x43b92e(0xf2)},'body':JSON[_0x43b92e(0x98)](_0x43582d)}),_0x3da3c2=Date[_0x43b92e(0xbe)]()-_0x3ca6ea;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x2dbe90[_0x43b92e(0xef)]),console[_0x43b92e(0xb1)](_0x43b92e(0xcc),_0x2dbe90[_0x43b92e(0xcb)]),console[_0x43b92e(0xb1)](_0x43b92e(0x8f),Object[_0x43b92e(0x10a)](_0x2dbe90['headers'][_0x43b92e(0x104)]())),console[_0x43b92e(0xb1)](_0x43b92e(0xf1),_0x3da3c2+'ms');const _0x2838b3=await _0x2dbe90[_0x43b92e(0x92)]();console[_0x43b92e(0xb1)]('Raw\x20Response\x20Body:',_0x2838b3);if(!_0x2dbe90['ok']){console[_0x43b92e(0xf9)](_0x43b92e(0xbb)),console['error'](_0x43b92e(0xfd),_0x2dbe90[_0x43b92e(0xef)]),console[_0x43b92e(0xf9)](_0x43b92e(0x103),_0x2838b3),loggerService_1[_0x43b92e(0x9f)]['logWhiteDomainResponse'](_0x43b92e(0xe9),'/create',_0x2dbe90[_0x43b92e(0xef)],_0x2838b3,_0x3da3c2),loggerService_1[_0x43b92e(0x9f)][_0x43b92e(0xce)](_0x43b92e(0xe9),'/create',_0x43b92e(0xed)+_0x2dbe90[_0x43b92e(0xef)]+':\x20'+_0x2838b3);throw new Error(_0x43b92e(0xa7)+_0x2dbe90[_0x43b92e(0xef)]+_0x43b92e(0x8c)+_0x2838b3);}let _0x5cf5a2;try{_0x5cf5a2=JSON[_0x43b92e(0xb9)](_0x2838b3);}catch(_0x6492bd){console['error'](_0x43b92e(0x93),_0x6492bd),loggerService_1[_0x43b92e(0x9f)][_0x43b92e(0xce)](_0x43b92e(0xe9),_0x43b92e(0xf0),_0x43b92e(0x89)+_0x6492bd);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2838b3);}console[_0x43b92e(0xb1)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log']('Parsed\x20Result:',JSON[_0x43b92e(0x98)](_0x5cf5a2,null,0x2)),loggerService_1[_0x43b92e(0x9f)][_0x43b92e(0xa9)](_0x43b92e(0xe9),_0x43b92e(0xf0),_0x2dbe90[_0x43b92e(0xef)],_0x5cf5a2,_0x3da3c2);if(_0x5cf5a2[_0x43b92e(0xf9)]){const _0x78ff6e=_0x5cf5a2[_0x43b92e(0xcf)]||_0x5cf5a2[_0x43b92e(0xf9)]||_0x43b92e(0x95);console[_0x43b92e(0xf9)](_0x43b92e(0xab)),console[_0x43b92e(0xf9)](_0x43b92e(0xb3),_0x78ff6e),loggerService_1[_0x43b92e(0x9f)][_0x43b92e(0xce)]('cointopay',_0x43b92e(0xf0),_0x43b92e(0xd7)+_0x78ff6e);throw new Error(_0x43b92e(0x7d)+_0x78ff6e);}if(!_0x5cf5a2['payment_url']||!_0x5cf5a2['gateway_payment_id']){console[_0x43b92e(0xf9)](_0x43b92e(0x100)),console[_0x43b92e(0xf9)](_0x43b92e(0x7f)),console[_0x43b92e(0xf9)](_0x43b92e(0xb7),_0x5cf5a2),loggerService_1[_0x43b92e(0x9f)]['logWhiteDomainError'](_0x43b92e(0xe9),'/create',_0x43b92e(0xdc));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x43b92e(0x84)),console[_0x43b92e(0xb1)](_0x43b92e(0xb2),_0x5cf5a2['gateway_payment_id']),console[_0x43b92e(0xb1)](_0x43b92e(0xea),_0x5cf5a2[_0x43b92e(0xdd)]),console[_0x43b92e(0xb1)](_0x43b92e(0x86),_0x180f9a,_0x43b92e(0xbd)),{'gateway_payment_id':_0x5cf5a2[_0x43b92e(0xcd)],'payment_url':_0x5cf5a2['payment_url']};}catch(_0x4bce17){console['error'](_0x43b92e(0xa8)),console['error'](_0x43b92e(0xc0),_0x4bce17),loggerService_1[_0x43b92e(0x9f)][_0x43b92e(0xce)](_0x43b92e(0xe9),_0x43b92e(0xf0),_0x4bce17);if(_0x4bce17 instanceof Error){console['error'](_0x43b92e(0xa4),_0x4bce17[_0x43b92e(0xcf)]),console[_0x43b92e(0xf9)]('Error\x20stack:',_0x4bce17[_0x43b92e(0xda)]);throw new Error(_0x43b92e(0xc4)+_0x4bce17['message']);}throw new Error(_0x43b92e(0xe2));}}async[a38_0x33e68a(0xf4)](_0x12b997){const _0x1e6c48=a38_0x33e68a,_0x107371=Date['now']();try{console['log'](_0x1e6c48(0xc5)+_0x12b997);const _0x1e273a={'gatewayPaymentId':_0x12b997};loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0x9e)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x1e6c48(0x82),_0x1e273a);const _0x509918=await fetch(this[_0x1e6c48(0xa6)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x1e6c48(0xf6),'User-Agent':_0x1e6c48(0xf2)},'body':JSON[_0x1e6c48(0x98)](_0x1e273a)}),_0x435d6c=Date['now']()-_0x107371;console[_0x1e6c48(0xb1)](_0x1e6c48(0xee)),console[_0x1e6c48(0xb1)]('Status:',_0x509918[_0x1e6c48(0xef)]),console[_0x1e6c48(0xb1)](_0x1e6c48(0xf1),_0x435d6c+'ms');if(!_0x509918['ok']){const _0x201fdd=await _0x509918[_0x1e6c48(0x92)]();console[_0x1e6c48(0xf9)]('HTTP\x20Status:',_0x509918[_0x1e6c48(0xef)]),console[_0x1e6c48(0xf9)]('Response\x20Body:',_0x201fdd),loggerService_1[_0x1e6c48(0x9f)]['logWhiteDomainResponse'](_0x1e6c48(0xe9),'/status',_0x509918[_0x1e6c48(0xef)],_0x201fdd,_0x435d6c),loggerService_1['loggerService'][_0x1e6c48(0xce)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x1e6c48(0xed)+_0x509918[_0x1e6c48(0xef)]+':\x20'+_0x201fdd);throw new Error(_0x1e6c48(0xa7)+_0x509918['status']);}const _0x426988=await _0x509918['text']();console[_0x1e6c48(0xb1)]('Raw\x20Response\x20Body:',_0x426988);let _0x1e5e7a;try{_0x1e5e7a=JSON[_0x1e6c48(0xb9)](_0x426988);}catch(_0xfef9f3){console[_0x1e6c48(0xf9)](_0x1e6c48(0x93),_0xfef9f3),loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0xce)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x1e6c48(0x89)+_0xfef9f3);throw new Error(_0x1e6c48(0x85)+_0x426988);}loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0xa9)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x509918[_0x1e6c48(0xef)],_0x1e5e7a,_0x435d6c),console[_0x1e6c48(0xb1)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x1e6c48(0xb1)](_0x1e6c48(0xf8),_0x1e5e7a[_0x1e6c48(0xe7)]),console['log'](_0x1e6c48(0xde),_0x1e5e7a[_0x1e6c48(0xb5)]),console['log'](_0x1e6c48(0xa2),_0x1e5e7a[_0x1e6c48(0x9c)]?.['Status']),console['log'](_0x1e6c48(0x86),_0x1e5e7a[_0x1e6c48(0x9c)]?.[_0x1e6c48(0xd4)]),console[_0x1e6c48(0xb1)](_0x1e6c48(0xa0),_0x1e5e7a[_0x1e6c48(0x9c)]?.[_0x1e6c48(0xca)]);if(_0x1e5e7a[_0x1e6c48(0xe7)]!==_0x1e6c48(0x97)||_0x1e5e7a['status_code']!==0xc8){const _0x3bd6bf=_0x1e5e7a[_0x1e6c48(0xcf)]||_0x1e6c48(0x8e);console[_0x1e6c48(0xf9)](_0x1e6c48(0x96)),console[_0x1e6c48(0xf9)](_0x1e6c48(0xb3),_0x3bd6bf),loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0xce)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x1e6c48(0xe1)+_0x3bd6bf);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x3bd6bf);}if(!_0x1e5e7a[_0x1e6c48(0x9c)]){console[_0x1e6c48(0xf9)](_0x1e6c48(0xd8)),console[_0x1e6c48(0xf9)](_0x1e6c48(0xd6)),loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0xce)](_0x1e6c48(0xe9),_0x1e6c48(0xad),_0x1e6c48(0x8a));throw new Error(_0x1e6c48(0xf7));}let _0x3e721b='PENDING';switch(_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xd3)]?.[_0x1e6c48(0xb0)]()){case _0x1e6c48(0xba):_0x3e721b=_0x1e6c48(0xdf);break;case _0x1e6c48(0xb6):case _0x1e6c48(0xe5):case'error':_0x3e721b=_0x1e6c48(0xb8);break;case _0x1e6c48(0x81):case _0x1e6c48(0x102):_0x3e721b='EXPIRED';break;case _0x1e6c48(0xec):case _0x1e6c48(0xc9):case'pending':case _0x1e6c48(0xd2):default:_0x3e721b=_0x1e6c48(0xac);break;}let _0x59c2ae,_0x1e38ac;if(_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x7c)]){const _0x596e66=_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x7c)];console[_0x1e6c48(0xb1)](_0x1e6c48(0xfa),_0x596e66);const _0x2b8e7f=_0x596e66[_0x1e6c48(0x90)](/IBAN\s+([A-Z0-9]+)/i);_0x2b8e7f&&(_0x59c2ae=_0x2b8e7f[0x1],console[_0x1e6c48(0xb1)](_0x1e6c48(0xc1),_0x59c2ae)),_0x1e38ac=_0x596e66;}const _0x54404d={'iban':_0x59c2ae,'bankDetails':_0x1e38ac,'transactionId':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x108)],'coinAddress':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xaf)],'qrCodeUrl':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x9b)],'expiryTime':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xc8)],'createdOn':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x107)],'confirmedOn':_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x88)]};console['log'](_0x1e6c48(0xd0)),console[_0x1e6c48(0xb1)](_0x1e6c48(0xc3),_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xd3)],'->',_0x3e721b),console[_0x1e6c48(0xb1)](_0x1e6c48(0x86),_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xd4)],_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xca)]),console[_0x1e6c48(0xb1)](_0x1e6c48(0xaa),_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x108)]),console[_0x1e6c48(0xb1)](_0x1e6c48(0xff),_0x59c2ae||_0x1e6c48(0xbf)),console[_0x1e6c48(0xb1)](_0x1e6c48(0xfe),_0x1e5e7a['data']['CreatedOn']),console['log'](_0x1e6c48(0x101),_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0x88)]||_0x1e6c48(0xa1));if(_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xd3)]?.[_0x1e6c48(0xb0)]()===_0x1e6c48(0xc9))console[_0x1e6c48(0xb1)](_0x1e6c48(0xe4));else _0x1e5e7a['data'][_0x1e6c48(0xd3)]?.['toLowerCase']()==='paid'&&console['log'](_0x1e6c48(0xc2));return{'status':_0x3e721b,'amount':parseFloat(_0x1e5e7a[_0x1e6c48(0x9c)][_0x1e6c48(0xd4)])||undefined,'currency':_0x1e5e7a['data']['inputCurrency']||_0x1e6c48(0xbd),'paymentDetails':_0x54404d};}catch(_0x26fcd2){console[_0x1e6c48(0xf9)](_0x1e6c48(0xfc),_0x26fcd2),loggerService_1[_0x1e6c48(0x9f)][_0x1e6c48(0xce)]('cointopay',_0x1e6c48(0xad),_0x26fcd2);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x26fcd2 instanceof Error?_0x26fcd2[_0x1e6c48(0xcf)]:_0x1e6c48(0xd9)));}}async[a38_0x33e68a(0x91)](_0x333fc3){const _0x1ab17e=a38_0x33e68a,_0x3cd214=await this[_0x1ab17e(0xf4)](_0x333fc3);return{'status':_0x3cd214[_0x1ab17e(0xef)],'amount':_0x3cd214[_0x1ab17e(0x9d)],'currency':_0x3cd214['currency']};}async[a38_0x33e68a(0xd5)](_0x4a6129){const _0x33dc07=a38_0x33e68a;console[_0x33dc07(0xb1)](_0x33dc07(0x83),_0x4a6129);let _0x3f9a29='PENDING';switch(_0x4a6129[_0x33dc07(0xef)]?.[_0x33dc07(0xb0)]()){case _0x33dc07(0xba):_0x3f9a29=_0x33dc07(0xdf);break;case _0x33dc07(0xb6):case'failed':case _0x33dc07(0xf9):_0x3f9a29=_0x33dc07(0xb8);break;case'expired':case'timeout':_0x3f9a29=_0x33dc07(0xb4);break;case _0x33dc07(0xe3):case'waiting':case _0x33dc07(0xc9):case _0x33dc07(0xd2):default:_0x3f9a29=_0x33dc07(0xac);break;}return{'paymentId':_0x4a6129[_0x33dc07(0xe8)]||_0x4a6129['merchant_reference_id']||'','status':_0x3f9a29,'amount':_0x4a6129[_0x33dc07(0x9d)],'currency':_0x4a6129[_0x33dc07(0xeb)]||_0x33dc07(0xbd)};}}function a38_0x4049(_0x5757fb,_0x55e465){const _0x519704=a38_0x5197();return a38_0x4049=function(_0x404962,_0x7c7f12){_0x404962=_0x404962-0x7c;let _0x5ee3c7=_0x519704[_0x404962];return _0x5ee3c7;},a38_0x4049(_0x5757fb,_0x55e465);}exports[a38_0x33e68a(0x10b)]=CoinToPayService;