'use strict';const a38_0x341548=a38_0x2325;(function(_0x4aad63,_0xf32fed){const _0x5d2d67=a38_0x2325,_0x58eab4=_0x4aad63();while(!![]){try{const _0x3c63e4=parseInt(_0x5d2d67(0x19b))/0x1+-parseInt(_0x5d2d67(0x1f6))/0x2*(-parseInt(_0x5d2d67(0x1bd))/0x3)+parseInt(_0x5d2d67(0x1b9))/0x4*(-parseInt(_0x5d2d67(0x1f9))/0x5)+parseInt(_0x5d2d67(0x1d4))/0x6+parseInt(_0x5d2d67(0x208))/0x7*(-parseInt(_0x5d2d67(0x195))/0x8)+parseInt(_0x5d2d67(0x1ea))/0x9+-parseInt(_0x5d2d67(0x1d2))/0xa;if(_0x3c63e4===_0xf32fed)break;else _0x58eab4['push'](_0x58eab4['shift']());}catch(_0x39c650){_0x58eab4['push'](_0x58eab4['shift']());}}}(a38_0x22b8,0xda9ef));Object[a38_0x341548(0x1c5)](exports,a38_0x341548(0x1d9),{'value':!![]}),exports[a38_0x341548(0x1de)]=void 0x0;const loggerService_1=require('../loggerService');function a38_0x2325(_0x54d851,_0x5a3dd3){const _0x22b854=a38_0x22b8();return a38_0x2325=function(_0x232551,_0x3b87fa){_0x232551=_0x232551-0x186;let _0x423a6e=_0x22b854[_0x232551];return _0x423a6e;},a38_0x2325(_0x54d851,_0x5a3dd3);}function a38_0x22b8(){const _0x2bbe39=['CreatedOn','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status\x20API\x20Error:\x20','application/json','Transaction\x20ID:','statusText','8GLyyhc','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','logWhiteDomainError','137426fKoXXD','not\x20confirmed','payment_url','Incomplete\x20response:\x20missing\x20data','Missing\x20data\x20in\x20response','apiUrl','not\x20found','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','status','HTTP\x20error!\x20status:\x20','stringify','CoinToPay\x20payment\x20status\x20check\x20error:','fromEntries','coinAddress','ExpiryTime','JSON\x20Parse\x20Error:\x20','cancelled','stack','üè¶\x20Payment\x20Detail:','Status:','status_code','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','üìä\x20Status\x20check\x20URL:','logWhiteDomainResponse','Status\x20Text:','timeout','Payment\x20URL:','EXPIRED','CoinToPay\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','4reodrU','TesSoft\x20Payment\x20System/1.0','PaymentDetail','inputCurrency','69cgbnxk','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Payment\x20Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','error','gateway_payment_id','success','cointopay','defineProperty','Response\x20Time:','log','parse','/status','PENDING','Error\x20stack:','amount','awaiting\x20fiat','Raw\x20Response\x20Body:','Response\x20data:','IBAN:','currency','24447100QhGjJc','PAID','10203198TJmMhL','loggerService','paid','Response\x20Body:','TransactionConfirmedOn','__esModule','Error\x20details:','https://tesoft.uk/gateway/cointopay/status.php','toLowerCase','POST','CoinToPayService','üè¶\x20Extracted\x20IBAN:','message','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','https://tesoft.uk/gateway/cointopay/','order_id','Amount:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','TransactionID','FAILED','15547230cObIkx','entries','HTTP\x20','\x20EUR','Gateway\x20Payment\x20ID:','text','Amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','waiting','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','data','31726TWEgRw','failed','EUR','856390hzRbcd','Confirmed\x20On:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','created','Headers:',',\x20body:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','/create','checkPaymentStatus','Request\x20Body:','statusUrl','Error\x20Message:','now','pending','2931733ozpudN','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','createPaymentLink','Status','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20Code:','result'];a38_0x22b8=function(){return _0x2bbe39;};return a38_0x22b8();}class CoinToPayService{constructor(){const _0x5a645d=a38_0x341548;this['apiUrl']=_0x5a645d(0x1e4),this[_0x5a645d(0x204)]=_0x5a645d(0x1db),console[_0x5a645d(0x1c7)](_0x5a645d(0x200)),console[_0x5a645d(0x1c7)](_0x5a645d(0x1b1),this[_0x5a645d(0x204)]);}async[a38_0x341548(0x189)](_0x47ac74){const _0xfa9f5a=a38_0x341548,{orderId:_0x1377cf,amount:_0x2f3761}=_0x47ac74;console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1e1)+_0x2f3761+_0xfa9f5a(0x1ed));const _0x659f33={'amount':_0x2f3761},_0x15e997=Date['now']();try{console['log'](_0xfa9f5a(0x199)),console['log']('URL:',this[_0xfa9f5a(0x1a0)]),console['log'](_0xfa9f5a(0x203),JSON[_0xfa9f5a(0x1a5)](_0x659f33,null,0x2)),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1e6),_0x2f3761,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0xfa9f5a(0x1d5)][_0xfa9f5a(0x196)](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),'POST',_0x659f33);const _0x4e1c53=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0xfa9f5a(0x192),'Accept':'application/json','User-Agent':_0xfa9f5a(0x1ba)},'body':JSON['stringify'](_0x659f33)}),_0x376cf3=Date['now']()-_0x15e997;console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x18b)),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1ae),_0x4e1c53[_0xfa9f5a(0x1a3)]),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1b3),_0x4e1c53[_0xfa9f5a(0x194)]),console['log'](_0xfa9f5a(0x1fd),Object[_0xfa9f5a(0x1a7)](_0x4e1c53['headers'][_0xfa9f5a(0x1eb)]())),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1c6),_0x376cf3+'ms');const _0x35d5a5=await _0x4e1c53[_0xfa9f5a(0x1ef)]();console['log'](_0xfa9f5a(0x1ce),_0x35d5a5);if(!_0x4e1c53['ok']){console[_0xfa9f5a(0x1c1)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x187),_0x4e1c53['status']),console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1d7),_0x35d5a5),loggerService_1[_0xfa9f5a(0x1d5)]['logWhiteDomainResponse'](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),_0x4e1c53[_0xfa9f5a(0x1a3)],_0x35d5a5,_0x376cf3),loggerService_1[_0xfa9f5a(0x1d5)]['logWhiteDomainError']('cointopay',_0xfa9f5a(0x201),_0xfa9f5a(0x1ec)+_0x4e1c53['status']+':\x20'+_0x35d5a5);throw new Error(_0xfa9f5a(0x1a4)+_0x4e1c53[_0xfa9f5a(0x1a3)]+_0xfa9f5a(0x1fe)+_0x35d5a5);}let _0x282c1e;try{_0x282c1e=JSON[_0xfa9f5a(0x1c8)](_0x35d5a5);}catch(_0x2bfd22){console['error'](_0xfa9f5a(0x198),_0x2bfd22),loggerService_1[_0xfa9f5a(0x1d5)][_0xfa9f5a(0x19a)](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),_0xfa9f5a(0x1aa)+_0x2bfd22);throw new Error(_0xfa9f5a(0x188)+_0x35d5a5);}console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x18f)),console[_0xfa9f5a(0x1c7)]('Parsed\x20Result:',JSON[_0xfa9f5a(0x1a5)](_0x282c1e,null,0x2)),loggerService_1[_0xfa9f5a(0x1d5)]['logWhiteDomainResponse'](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),_0x4e1c53[_0xfa9f5a(0x1a3)],_0x282c1e,_0x376cf3);if(_0x282c1e[_0xfa9f5a(0x1c1)]){const _0x497286=_0x282c1e[_0xfa9f5a(0x1e0)]||_0x282c1e[_0xfa9f5a(0x1c1)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1a2)),console['error'](_0xfa9f5a(0x205),_0x497286),loggerService_1[_0xfa9f5a(0x1d5)][_0xfa9f5a(0x19a)](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),'Business\x20Error:\x20'+_0x497286);throw new Error(_0xfa9f5a(0x1b7)+_0x497286);}if(!_0x282c1e['payment_url']||!_0x282c1e[_0xfa9f5a(0x1c2)]){console[_0xfa9f5a(0x1c1)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0xfa9f5a(0x1e2)),console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1cf),_0x282c1e),loggerService_1['loggerService']['logWhiteDomainError'](_0xfa9f5a(0x1c4),'/create',_0xfa9f5a(0x1b8));throw new Error(_0xfa9f5a(0x1f2));}return console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1ff)),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1ee),_0x282c1e[_0xfa9f5a(0x1c2)]),console['log'](_0xfa9f5a(0x1b5),_0x282c1e[_0xfa9f5a(0x19d)]),console[_0xfa9f5a(0x1c7)](_0xfa9f5a(0x1e6),_0x2f3761,_0xfa9f5a(0x1f8)),{'gateway_payment_id':_0x282c1e['gateway_payment_id'],'payment_url':_0x282c1e[_0xfa9f5a(0x19d)]};}catch(_0x7c55de){console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1be)),console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1da),_0x7c55de),loggerService_1[_0xfa9f5a(0x1d5)][_0xfa9f5a(0x19a)](_0xfa9f5a(0x1c4),_0xfa9f5a(0x201),_0x7c55de);if(_0x7c55de instanceof Error){console[_0xfa9f5a(0x1c1)]('Error\x20message:',_0x7c55de[_0xfa9f5a(0x1e0)]),console[_0xfa9f5a(0x1c1)](_0xfa9f5a(0x1cb),_0x7c55de[_0xfa9f5a(0x1ac)]);throw new Error(_0xfa9f5a(0x1b0)+_0x7c55de[_0xfa9f5a(0x1e0)]);}throw new Error(_0xfa9f5a(0x1c0));}}async[a38_0x341548(0x202)](_0x48d95d){const _0x253e04=a38_0x341548,_0x33994f=Date[_0x253e04(0x206)]();try{console[_0x253e04(0x1c7)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x48d95d);const _0xd4c609={'gatewayPaymentId':_0x48d95d};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x253e04(0x1c4),_0x253e04(0x1c9),_0x253e04(0x1dd),_0xd4c609);const _0x23e053=await fetch(this['statusUrl'],{'method':_0x253e04(0x1dd),'headers':{'Content-Type':_0x253e04(0x192),'Accept':_0x253e04(0x192),'User-Agent':_0x253e04(0x1ba)},'body':JSON[_0x253e04(0x1a5)](_0xd4c609)}),_0x130250=Date['now']()-_0x33994f;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x253e04(0x1c7)](_0x253e04(0x1ae),_0x23e053['status']),console[_0x253e04(0x1c7)](_0x253e04(0x1c6),_0x130250+'ms');if(!_0x23e053['ok']){const _0x19565d=await _0x23e053[_0x253e04(0x1ef)]();console[_0x253e04(0x1c1)](_0x253e04(0x187),_0x23e053[_0x253e04(0x1a3)]),console[_0x253e04(0x1c1)]('Response\x20Body:',_0x19565d),loggerService_1[_0x253e04(0x1d5)]['logWhiteDomainResponse'](_0x253e04(0x1c4),_0x253e04(0x1c9),_0x23e053[_0x253e04(0x1a3)],_0x19565d,_0x130250),loggerService_1[_0x253e04(0x1d5)][_0x253e04(0x19a)](_0x253e04(0x1c4),_0x253e04(0x1c9),_0x253e04(0x1ec)+_0x23e053[_0x253e04(0x1a3)]+':\x20'+_0x19565d);throw new Error(_0x253e04(0x1a4)+_0x23e053[_0x253e04(0x1a3)]);}const _0x3f33ea=await _0x23e053[_0x253e04(0x1ef)]();console['log'](_0x253e04(0x1ce),_0x3f33ea);let _0x208752;try{_0x208752=JSON[_0x253e04(0x1c8)](_0x3f33ea);}catch(_0x19b3e0){console[_0x253e04(0x1c1)](_0x253e04(0x198),_0x19b3e0),loggerService_1[_0x253e04(0x1d5)]['logWhiteDomainError'](_0x253e04(0x1c4),'/status',_0x253e04(0x1aa)+_0x19b3e0);throw new Error(_0x253e04(0x190)+_0x3f33ea);}loggerService_1['loggerService'][_0x253e04(0x1b2)](_0x253e04(0x1c4),'/status',_0x23e053['status'],_0x208752,_0x130250),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0x208752[_0x253e04(0x18d)]),console[_0x253e04(0x1c7)](_0x253e04(0x18c),_0x208752[_0x253e04(0x1af)]),console['log'](_0x253e04(0x1bf),_0x208752[_0x253e04(0x1f5)]?.[_0x253e04(0x18a)]),console[_0x253e04(0x1c7)]('Amount:',_0x208752['data']?.['Amount']),console[_0x253e04(0x1c7)]('Currency:',_0x208752[_0x253e04(0x1f5)]?.[_0x253e04(0x1bc)]);if(_0x208752[_0x253e04(0x18d)]!==_0x253e04(0x1c3)||_0x208752[_0x253e04(0x1af)]!==0xc8){const _0x42dc96=_0x208752[_0x253e04(0x1e0)]||_0x253e04(0x1e3);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x42dc96),loggerService_1[_0x253e04(0x1d5)][_0x253e04(0x19a)]('cointopay',_0x253e04(0x1c9),_0x253e04(0x191)+_0x42dc96);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x42dc96);}if(!_0x208752[_0x253e04(0x1f5)]){console[_0x253e04(0x1c1)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x253e04(0x1c1)](_0x253e04(0x19f)),loggerService_1['loggerService'][_0x253e04(0x19a)](_0x253e04(0x1c4),'/status',_0x253e04(0x19e));throw new Error(_0x253e04(0x1f4));}let _0x1aef10=_0x253e04(0x1ca);switch(_0x208752[_0x253e04(0x1f5)][_0x253e04(0x18a)]?.[_0x253e04(0x1dc)]()){case _0x253e04(0x1d6):_0x1aef10=_0x253e04(0x1d3);break;case _0x253e04(0x1ab):case _0x253e04(0x1f7):case'error':_0x1aef10='FAILED';break;case'expired':case'timeout':_0x1aef10=_0x253e04(0x1b6);break;case _0x253e04(0x1f3):case _0x253e04(0x1cd):case _0x253e04(0x207):case _0x253e04(0x1fc):default:_0x1aef10=_0x253e04(0x1ca);break;}let _0x46d1bb,_0x1b606a;if(_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1bb)]){const _0x37cb26=_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1bb)];console[_0x253e04(0x1c7)](_0x253e04(0x1ad),_0x37cb26);const _0x52dbf5=_0x37cb26['match'](/IBAN\s+([A-Z0-9]+)/i);_0x52dbf5&&(_0x46d1bb=_0x52dbf5[0x1],console[_0x253e04(0x1c7)](_0x253e04(0x1df),_0x46d1bb)),_0x1b606a=_0x37cb26;}const _0x1ffc4e={'iban':_0x46d1bb,'bankDetails':_0x1b606a,'transactionId':_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1e8)],'coinAddress':_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1a8)],'qrCodeUrl':_0x208752[_0x253e04(0x1f5)]['QRCodeURL'],'expiryTime':_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1a9)],'createdOn':_0x208752[_0x253e04(0x1f5)][_0x253e04(0x18e)],'confirmedOn':_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1d8)]};console[_0x253e04(0x1c7)](_0x253e04(0x197)),console[_0x253e04(0x1c7)]('Status:',_0x208752[_0x253e04(0x1f5)][_0x253e04(0x18a)],'->',_0x1aef10),console[_0x253e04(0x1c7)]('Amount:',_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1f0)],_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1bc)]),console[_0x253e04(0x1c7)](_0x253e04(0x193),_0x208752[_0x253e04(0x1f5)]['TransactionID']),console[_0x253e04(0x1c7)](_0x253e04(0x1d0),_0x46d1bb||_0x253e04(0x1a1)),console['log']('Created\x20On:',_0x208752['data'][_0x253e04(0x18e)]),console['log'](_0x253e04(0x1fa),_0x208752['data'][_0x253e04(0x1d8)]||_0x253e04(0x19c));if(_0x208752[_0x253e04(0x1f5)][_0x253e04(0x18a)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x253e04(0x1c7)](_0x253e04(0x186));else _0x208752[_0x253e04(0x1f5)][_0x253e04(0x18a)]?.[_0x253e04(0x1dc)]()==='paid'&&console[_0x253e04(0x1c7)](_0x253e04(0x1fb));return{'status':_0x1aef10,'amount':parseFloat(_0x208752[_0x253e04(0x1f5)][_0x253e04(0x1f0)])||undefined,'currency':_0x208752[_0x253e04(0x1f5)]['inputCurrency']||_0x253e04(0x1f8),'paymentDetails':_0x1ffc4e};}catch(_0x4617c2){console[_0x253e04(0x1c1)](_0x253e04(0x1a6),_0x4617c2),loggerService_1[_0x253e04(0x1d5)][_0x253e04(0x19a)](_0x253e04(0x1c4),_0x253e04(0x1c9),_0x4617c2);throw new Error(_0x253e04(0x1f1)+(_0x4617c2 instanceof Error?_0x4617c2[_0x253e04(0x1e0)]:'Unknown\x20error'));}}async['verifyPayment'](_0x34d842){const _0x16c89e=a38_0x341548,_0x16c8c8=await this[_0x16c89e(0x202)](_0x34d842);return{'status':_0x16c8c8[_0x16c89e(0x1a3)],'amount':_0x16c8c8[_0x16c89e(0x1cc)],'currency':_0x16c8c8[_0x16c89e(0x1d1)]};}async['processWebhook'](_0x24a603){const _0xa02c32=a38_0x341548;console[_0xa02c32(0x1c7)](_0xa02c32(0x1e7),_0x24a603);let _0x2131fd=_0xa02c32(0x1ca);switch(_0x24a603['status']?.[_0xa02c32(0x1dc)]()){case _0xa02c32(0x1d6):_0x2131fd=_0xa02c32(0x1d3);break;case _0xa02c32(0x1ab):case _0xa02c32(0x1f7):case _0xa02c32(0x1c1):_0x2131fd=_0xa02c32(0x1e9);break;case'expired':case _0xa02c32(0x1b4):_0x2131fd=_0xa02c32(0x1b6);break;case'pending':case _0xa02c32(0x1f3):case _0xa02c32(0x1cd):case _0xa02c32(0x1fc):default:_0x2131fd=_0xa02c32(0x1ca);break;}return{'paymentId':_0x24a603[_0xa02c32(0x1e5)]||_0x24a603['merchant_reference_id']||'','status':_0x2131fd,'amount':_0x24a603[_0xa02c32(0x1cc)],'currency':_0x24a603[_0xa02c32(0x1d1)]||_0xa02c32(0x1f8)};}}exports[a38_0x341548(0x1de)]=CoinToPayService;