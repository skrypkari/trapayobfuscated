'use strict';const a59_0x59b3ba=a59_0x2871;(function(_0x5bef99,_0x5257b7){const _0x2d2caf=a59_0x2871,_0x2596cc=_0x5bef99();while(!![]){try{const _0x30f56a=parseInt(_0x2d2caf(0x18f))/0x1*(-parseInt(_0x2d2caf(0x1aa))/0x2)+-parseInt(_0x2d2caf(0x1f2))/0x3*(parseInt(_0x2d2caf(0x1da))/0x4)+parseInt(_0x2d2caf(0x194))/0x5+parseInt(_0x2d2caf(0x1a6))/0x6+parseInt(_0x2d2caf(0x1b7))/0x7*(parseInt(_0x2d2caf(0x200))/0x8)+-parseInt(_0x2d2caf(0x1bf))/0x9+-parseInt(_0x2d2caf(0x1e0))/0xa;if(_0x30f56a===_0x5257b7)break;else _0x2596cc['push'](_0x2596cc['shift']());}catch(_0x1afa8c){_0x2596cc['push'](_0x2596cc['shift']());}}}(a59_0x43bb,0xe3e6b));function a59_0x2871(_0x4adf34,_0x270d0b){_0x4adf34=_0x4adf34-0x18a;const _0x43bb08=a59_0x43bb();let _0x28713a=_0x43bb08[_0x4adf34];return _0x28713a;}Object[a59_0x59b3ba(0x1f0)](exports,'__esModule',{'value':!![]}),exports[a59_0x59b3ba(0x19a)]=void 0x0;const loggerService_1=require(a59_0x59b3ba(0x20e));function a59_0x43bb(){const _0x1f93a3=['logWhiteDomainResponse','text','ðŸ“Š\x20Status\x20check\x20URL:','HTTP\x20Status:','failed','PaymentDetail','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','8LVogdn','stringify','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','inputCurrency','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','URL:','6744510CxZgIB','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy',',\x20body:\x20','error','Result:','HTTP\x20','Status\x20Text:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','HTTP\x20error!\x20status:\x20','Error\x20details:','ExpiryTime','timeout','paid','Amount','PAID','defineProperty','Unknown\x20error','2280786ywqfPr','PENDING','Request\x20Body:','===\x20COINTOPAY\x20SUCCESS\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','Payment\x20URL\x20(original):','CoinToPay\x20payment\x20status\x20check\x20error:','POST','/create','TransactionConfirmedOn','IBAN:','expired','ðŸ¦\x20Payment\x20Detail:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','337664saZyxg','EXPIRED','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Payment\x20Status:','cointopay','Amount:','Created\x20On:','Gateway\x20Payment\x20ID:','Error\x20stack:','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','application/json','Business\x20Error:\x20','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','../loggerService','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','toLowerCase','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','log','apiUrl','status','TransactionID','created','Status','Response\x20Body:','coinAddress','5JalQZz','Confirmed\x20On:','status_code','Status:','amount','8427845KHrQeF','awaiting\x20fiat','Error\x20Message:','Raw\x20Response\x20Body:','result','Headers:','CoinToPayService','Response\x20Time:','CreatedOn','gateway_payment_id','https://tesoft.uk/gateway/cointopay/status.php','loggerService','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','message','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','match','statusText','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','9579690SRXlCV','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','statusUrl','Response\x20data:','238124sccTIy','entries','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','&alternative=false','not\x20found','data','now','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','headers','verifyPayment','pending','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','98TSULxr','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','parse','payment_url','Payment\x20URL\x20(modified):','currency','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Payment\x20System/1.0','1343952fDuqxn','Parsed\x20Result:','logWhiteDomainError','checkPaymentStatus','logWhiteDomainRequest','order_id','processWebhook','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','cancelled','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','success','/status','JSON\x20Parse\x20Error:\x20','waiting','not\x20confirmed','CoinToPay\x20API\x20error:\x20','Missing\x20data\x20in\x20response'];a59_0x43bb=function(){return _0x1f93a3;};return a59_0x43bb();}class CoinToPayService{constructor(){const _0x374340=a59_0x59b3ba;this[_0x374340(0x215)]='https://tesoft.uk/gateway/cointopay/',this[_0x374340(0x1a8)]=_0x374340(0x19e),console[_0x374340(0x214)](_0x374340(0x1e1)),console[_0x374340(0x214)](_0x374340(0x1d3),this[_0x374340(0x1a8)]);}async['createPaymentLink'](_0x2c7a93){const _0xe4e3ba=a59_0x59b3ba,{orderId:_0x369c69,amount:_0x5b57a4}=_0x2c7a93;console[_0xe4e3ba(0x214)]('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5b57a4+'\x20EUR');const _0x34c353={'amount':_0x5b57a4},_0x2ffe02=Date['now']();try{console['log'](_0xe4e3ba(0x1dc)),console['log'](_0xe4e3ba(0x1df),this[_0xe4e3ba(0x215)]),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1f4),JSON[_0xe4e3ba(0x1db)](_0x34c353,null,0x2)),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x205),_0x5b57a4,_0xe4e3ba(0x202)),loggerService_1[_0xe4e3ba(0x19f)][_0xe4e3ba(0x1c3)](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0xe4e3ba(0x1f9),_0x34c353);const _0x1eea55=await fetch(this['apiUrl'],{'method':_0xe4e3ba(0x1f9),'headers':{'Content-Type':_0xe4e3ba(0x20a),'Accept':_0xe4e3ba(0x20a),'User-Agent':_0xe4e3ba(0x1be)},'body':JSON[_0xe4e3ba(0x1db)](_0x34c353)}),_0x390fb1=Date[_0xe4e3ba(0x1b0)]()-_0x2ffe02;console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1b1)),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x192),_0x1eea55['status']),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1e6),_0x1eea55[_0xe4e3ba(0x1a4)]),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x199),Object[_0xe4e3ba(0x20d)](_0x1eea55[_0xe4e3ba(0x1b2)][_0xe4e3ba(0x1ab)]())),console[_0xe4e3ba(0x214)]('Response\x20Time:',_0x390fb1+'ms');const _0x518487=await _0x1eea55[_0xe4e3ba(0x1d2)]();console['log'](_0xe4e3ba(0x197),_0x518487);if(!_0x1eea55['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0xe4e3ba(0x1d4),_0x1eea55[_0xe4e3ba(0x216)]),console[_0xe4e3ba(0x1e3)](_0xe4e3ba(0x18d),_0x518487),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0x1eea55[_0xe4e3ba(0x216)],_0x518487,_0x390fb1),loggerService_1[_0xe4e3ba(0x19f)][_0xe4e3ba(0x1c1)](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0xe4e3ba(0x1e5)+_0x1eea55[_0xe4e3ba(0x216)]+':\x20'+_0x518487);throw new Error(_0xe4e3ba(0x1e9)+_0x1eea55[_0xe4e3ba(0x216)]+_0xe4e3ba(0x1e2)+_0x518487);}let _0x2a2fce;try{_0x2a2fce=JSON[_0xe4e3ba(0x1b9)](_0x518487);}catch(_0xff5080){console[_0xe4e3ba(0x1e3)](_0xe4e3ba(0x20c),_0xff5080),loggerService_1['loggerService'][_0xe4e3ba(0x1c1)](_0xe4e3ba(0x204),'/create',_0xe4e3ba(0x1cc)+_0xff5080);throw new Error(_0xe4e3ba(0x1a2)+_0x518487);}console[_0xe4e3ba(0x214)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1c0),JSON[_0xe4e3ba(0x1db)](_0x2a2fce,null,0x2)),loggerService_1[_0xe4e3ba(0x19f)]['logWhiteDomainResponse'](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0x1eea55['status'],_0x2a2fce,_0x390fb1);if(_0x2a2fce[_0xe4e3ba(0x1e3)]){const _0x4e578c=_0x2a2fce[_0xe4e3ba(0x1a1)]||_0x2a2fce[_0xe4e3ba(0x1e3)]||_0xe4e3ba(0x1f6);console[_0xe4e3ba(0x1e3)](_0xe4e3ba(0x1c9)),console[_0xe4e3ba(0x1e3)]('Error\x20Message:',_0x4e578c),loggerService_1[_0xe4e3ba(0x19f)]['logWhiteDomainError'](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0xe4e3ba(0x20b)+_0x4e578c);throw new Error(_0xe4e3ba(0x1cf)+_0x4e578c);}if(!_0x2a2fce['payment_url']||!_0x2a2fce[_0xe4e3ba(0x19d)]){console[_0xe4e3ba(0x1e3)](_0xe4e3ba(0x1d9)),console['error'](_0xe4e3ba(0x1a0)),console['error'](_0xe4e3ba(0x1a9),_0x2a2fce),loggerService_1[_0xe4e3ba(0x19f)][_0xe4e3ba(0x1c1)]('cointopay','/create',_0xe4e3ba(0x1d7));throw new Error(_0xe4e3ba(0x1b5));}console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1f5)),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x207),_0x2a2fce['gateway_payment_id']),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1f7),_0x2a2fce[_0xe4e3ba(0x1ba)]);const _0x36cab7=_0x2a2fce['payment_url']+_0xe4e3ba(0x1ad);return console[_0xe4e3ba(0x214)](_0xe4e3ba(0x1bb),_0x36cab7),console[_0xe4e3ba(0x214)](_0xe4e3ba(0x205),_0x5b57a4,'EUR'),{'gateway_payment_id':_0x2a2fce[_0xe4e3ba(0x19d)],'payment_url':_0x36cab7};}catch(_0x489a1b){console['error'](_0xe4e3ba(0x1de)),console['error'](_0xe4e3ba(0x1ea),_0x489a1b),loggerService_1['loggerService'][_0xe4e3ba(0x1c1)](_0xe4e3ba(0x204),_0xe4e3ba(0x1fa),_0x489a1b);if(_0x489a1b instanceof Error){console[_0xe4e3ba(0x1e3)]('Error\x20message:',_0x489a1b[_0xe4e3ba(0x1a1)]),console[_0xe4e3ba(0x1e3)](_0xe4e3ba(0x208),_0x489a1b['stack']);throw new Error(_0xe4e3ba(0x1c6)+_0x489a1b[_0xe4e3ba(0x1a1)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a59_0x59b3ba(0x1c2)](_0x33ca20){const _0x3de180=a59_0x59b3ba,_0x209a84=Date[_0x3de180(0x1b0)]();try{console[_0x3de180(0x214)](_0x3de180(0x1a7)+_0x33ca20);const _0x5d342f={'gatewayPaymentId':_0x33ca20};loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1c3)](_0x3de180(0x204),'/status','POST',_0x5d342f);const _0x3380c6=await fetch(this[_0x3de180(0x1a8)],{'method':_0x3de180(0x1f9),'headers':{'Content-Type':_0x3de180(0x20a),'Accept':'application/json','User-Agent':_0x3de180(0x1be)},'body':JSON[_0x3de180(0x1db)](_0x5d342f)}),_0x220792=Date[_0x3de180(0x1b0)]()-_0x209a84;console[_0x3de180(0x214)](_0x3de180(0x212)),console['log'](_0x3de180(0x192),_0x3380c6[_0x3de180(0x216)]),console['log'](_0x3de180(0x19b),_0x220792+'ms');if(!_0x3380c6['ok']){const _0x3cf675=await _0x3380c6[_0x3de180(0x1d2)]();console[_0x3de180(0x1e3)](_0x3de180(0x1d4),_0x3380c6[_0x3de180(0x216)]),console[_0x3de180(0x1e3)](_0x3de180(0x18d),_0x3cf675),loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1d1)](_0x3de180(0x204),_0x3de180(0x1cb),_0x3380c6[_0x3de180(0x216)],_0x3cf675,_0x220792),loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1c1)]('cointopay','/status',_0x3de180(0x1e5)+_0x3380c6[_0x3de180(0x216)]+':\x20'+_0x3cf675);throw new Error('HTTP\x20error!\x20status:\x20'+_0x3380c6[_0x3de180(0x216)]);}const _0x4e89f9=await _0x3380c6['text']();console[_0x3de180(0x214)](_0x3de180(0x197),_0x4e89f9);let _0x11bc73;try{_0x11bc73=JSON['parse'](_0x4e89f9);}catch(_0x4033e8){console[_0x3de180(0x1e3)](_0x3de180(0x20c),_0x4033e8),loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1c1)](_0x3de180(0x204),_0x3de180(0x1cb),'JSON\x20Parse\x20Error:\x20'+_0x4033e8);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4e89f9);}loggerService_1[_0x3de180(0x19f)]['logWhiteDomainResponse'](_0x3de180(0x204),'/status',_0x3380c6[_0x3de180(0x216)],_0x11bc73,_0x220792),console['log'](_0x3de180(0x1b6)),console['log'](_0x3de180(0x1e4),_0x11bc73['result']),console[_0x3de180(0x214)]('Status\x20Code:',_0x11bc73[_0x3de180(0x191)]),console[_0x3de180(0x214)](_0x3de180(0x203),_0x11bc73[_0x3de180(0x1af)]?.[_0x3de180(0x18c)]),console[_0x3de180(0x214)]('Amount:',_0x11bc73[_0x3de180(0x1af)]?.['Amount']),console[_0x3de180(0x214)](_0x3de180(0x1e8),_0x11bc73[_0x3de180(0x1af)]?.['inputCurrency']);if(_0x11bc73[_0x3de180(0x198)]!==_0x3de180(0x1ca)||_0x11bc73[_0x3de180(0x191)]!==0xc8){const _0x1547cd=_0x11bc73[_0x3de180(0x1a1)]||_0x3de180(0x1ff);console[_0x3de180(0x1e3)](_0x3de180(0x213)),console[_0x3de180(0x1e3)](_0x3de180(0x196),_0x1547cd),loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1c1)](_0x3de180(0x204),_0x3de180(0x1cb),_0x3de180(0x211)+_0x1547cd);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1547cd);}if(!_0x11bc73['data']){console[_0x3de180(0x1e3)](_0x3de180(0x1e7)),console['error'](_0x3de180(0x1d0)),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x3de180(0x1cb),_0x3de180(0x1c8));throw new Error(_0x3de180(0x1a5));}let _0x19c4cb=_0x3de180(0x1f3);switch(_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x18c)]?.[_0x3de180(0x210)]()){case _0x3de180(0x1ed):_0x19c4cb=_0x3de180(0x1ef);break;case _0x3de180(0x1c7):case'failed':case _0x3de180(0x1e3):_0x19c4cb='FAILED';break;case _0x3de180(0x1fd):case _0x3de180(0x1ec):_0x19c4cb=_0x3de180(0x201);break;case _0x3de180(0x1cd):case'awaiting\x20fiat':case'pending':case _0x3de180(0x18b):default:_0x19c4cb='PENDING';break;}let _0x443e85,_0x15f7e7;if(_0x11bc73[_0x3de180(0x1af)]['PaymentDetail']){const _0x219958=_0x11bc73['data'][_0x3de180(0x1d6)];console['log'](_0x3de180(0x1fe),_0x219958);const _0x240a2e=_0x219958[_0x3de180(0x1a3)](/IBAN\s+([A-Z0-9]+)/i);_0x240a2e&&(_0x443e85=_0x240a2e[0x1],console['log']('ðŸ¦\x20Extracted\x20IBAN:',_0x443e85)),_0x15f7e7=_0x219958;}const _0x3f1940={'iban':_0x443e85,'bankDetails':_0x15f7e7,'transactionId':_0x11bc73['data']['TransactionID'],'coinAddress':_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x18e)],'qrCodeUrl':_0x11bc73[_0x3de180(0x1af)]['QRCodeURL'],'expiryTime':_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x1eb)],'createdOn':_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x19c)],'confirmedOn':_0x11bc73[_0x3de180(0x1af)]['TransactionConfirmedOn']};console[_0x3de180(0x214)](_0x3de180(0x20f)),console[_0x3de180(0x214)](_0x3de180(0x192),_0x11bc73['data'][_0x3de180(0x18c)],'->',_0x19c4cb),console[_0x3de180(0x214)](_0x3de180(0x205),_0x11bc73[_0x3de180(0x1af)]['Amount'],_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x1dd)]),console[_0x3de180(0x214)]('Transaction\x20ID:',_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x18a)]),console['log'](_0x3de180(0x1fc),_0x443e85||_0x3de180(0x1ae)),console['log'](_0x3de180(0x206),_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x19c)]),console[_0x3de180(0x214)](_0x3de180(0x190),_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x1fb)]||_0x3de180(0x1ce));if(_0x11bc73['data'][_0x3de180(0x18c)]?.[_0x3de180(0x210)]()==='awaiting\x20fiat')console[_0x3de180(0x214)](_0x3de180(0x1ac));else _0x11bc73['data'][_0x3de180(0x18c)]?.[_0x3de180(0x210)]()===_0x3de180(0x1ed)&&console[_0x3de180(0x214)](_0x3de180(0x209));return{'status':_0x19c4cb,'amount':parseFloat(_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x1ee)])||undefined,'currency':_0x11bc73[_0x3de180(0x1af)][_0x3de180(0x1dd)]||_0x3de180(0x1d8),'paymentDetails':_0x3f1940};}catch(_0x5be893){console['error'](_0x3de180(0x1f8),_0x5be893),loggerService_1[_0x3de180(0x19f)][_0x3de180(0x1c1)](_0x3de180(0x204),_0x3de180(0x1cb),_0x5be893);throw new Error(_0x3de180(0x1bd)+(_0x5be893 instanceof Error?_0x5be893[_0x3de180(0x1a1)]:_0x3de180(0x1f1)));}}async[a59_0x59b3ba(0x1b3)](_0xfaca56){const _0x287115=a59_0x59b3ba,_0x4bdd77=await this['checkPaymentStatus'](_0xfaca56);return{'status':_0x4bdd77[_0x287115(0x216)],'amount':_0x4bdd77[_0x287115(0x193)],'currency':_0x4bdd77[_0x287115(0x1bc)]};}async[a59_0x59b3ba(0x1c5)](_0x3867e1){const _0x33e985=a59_0x59b3ba;console[_0x33e985(0x214)](_0x33e985(0x1b8),_0x3867e1);let _0x3466c='PENDING';switch(_0x3867e1['status']?.[_0x33e985(0x210)]()){case _0x33e985(0x1ed):_0x3466c=_0x33e985(0x1ef);break;case'cancelled':case _0x33e985(0x1d5):case _0x33e985(0x1e3):_0x3466c='FAILED';break;case _0x33e985(0x1fd):case _0x33e985(0x1ec):_0x3466c='EXPIRED';break;case _0x33e985(0x1b4):case'waiting':case _0x33e985(0x195):case _0x33e985(0x18b):default:_0x3466c=_0x33e985(0x1f3);break;}return{'paymentId':_0x3867e1[_0x33e985(0x1c4)]||_0x3867e1['merchant_reference_id']||'','status':_0x3466c,'amount':_0x3867e1['amount'],'currency':_0x3867e1[_0x33e985(0x1bc)]||_0x33e985(0x1d8)};}}exports['CoinToPayService']=CoinToPayService;