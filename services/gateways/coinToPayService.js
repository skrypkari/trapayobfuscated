'use strict';function a40_0x5a35(_0x75ac9d,_0x4e2317){const _0x31643c=a40_0x3164();return a40_0x5a35=function(_0x5a3576,_0x433094){_0x5a3576=_0x5a3576-0x129;let _0x27587e=_0x31643c[_0x5a3576];return _0x27587e;},a40_0x5a35(_0x75ac9d,_0x4e2317);}const a40_0x3ad5a4=a40_0x5a35;(function(_0x3b441f,_0x219c63){const _0x10a006=a40_0x5a35,_0x35fd22=_0x3b441f();while(!![]){try{const _0x26722f=-parseInt(_0x10a006(0x141))/0x1+parseInt(_0x10a006(0x198))/0x2*(parseInt(_0x10a006(0x14b))/0x3)+-parseInt(_0x10a006(0x137))/0x4*(-parseInt(_0x10a006(0x166))/0x5)+parseInt(_0x10a006(0x164))/0x6+-parseInt(_0x10a006(0x158))/0x7*(-parseInt(_0x10a006(0x183))/0x8)+-parseInt(_0x10a006(0x144))/0x9*(-parseInt(_0x10a006(0x139))/0xa)+-parseInt(_0x10a006(0x196))/0xb*(parseInt(_0x10a006(0x140))/0xc);if(_0x26722f===_0x219c63)break;else _0x35fd22['push'](_0x35fd22['shift']());}catch(_0x376997){_0x35fd22['push'](_0x35fd22['shift']());}}}(a40_0x3164,0xae9ac));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x3ad5a4(0x152)]=void 0x0;const loggerService_1=require(a40_0x3ad5a4(0x133));class CoinToPayService{constructor(){const _0x4bf412=a40_0x3ad5a4;this[_0x4bf412(0x145)]='https://tesoft.uk/gateway/cointopay/',this[_0x4bf412(0x155)]=_0x4bf412(0x16e),console[_0x4bf412(0x18e)](_0x4bf412(0x15a)),console[_0x4bf412(0x18e)](_0x4bf412(0x12b),this[_0x4bf412(0x155)]);}async[a40_0x3ad5a4(0x132)](_0x155019){const _0x21a483=a40_0x3ad5a4,{orderId:_0x184c5d,amount:_0x4c1774}=_0x155019;console[_0x21a483(0x18e)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4c1774+_0x21a483(0x180));const _0x254157={'amount':_0x4c1774},_0x553b71=Date[_0x21a483(0x19e)]();try{console['log'](_0x21a483(0x19d)),console[_0x21a483(0x18e)](_0x21a483(0x14e),this[_0x21a483(0x145)]),console[_0x21a483(0x18e)](_0x21a483(0x154),JSON[_0x21a483(0x177)](_0x254157,null,0x2)),console[_0x21a483(0x18e)](_0x21a483(0x131),_0x4c1774,_0x21a483(0x13b)),loggerService_1[_0x21a483(0x179)][_0x21a483(0x13c)]('cointopay','/create',_0x21a483(0x14c),_0x254157);const _0x518128=await fetch(this['apiUrl'],{'method':_0x21a483(0x14c),'headers':{'Content-Type':_0x21a483(0x17b),'Accept':'application/json','User-Agent':_0x21a483(0x18b)},'body':JSON[_0x21a483(0x177)](_0x254157)}),_0x10a08d=Date['now']()-_0x553b71;console[_0x21a483(0x18e)](_0x21a483(0x19b)),console[_0x21a483(0x18e)]('Status:',_0x518128[_0x21a483(0x1a0)]),console['log'](_0x21a483(0x16f),_0x518128['statusText']),console['log']('Headers:',Object['fromEntries'](_0x518128[_0x21a483(0x172)]['entries']())),console[_0x21a483(0x18e)]('Response\x20Time:',_0x10a08d+'ms');const _0x2914e2=await _0x518128[_0x21a483(0x14f)]();console[_0x21a483(0x18e)](_0x21a483(0x184),_0x2914e2);if(!_0x518128['ok']){console[_0x21a483(0x15d)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x518128[_0x21a483(0x1a0)]),console[_0x21a483(0x15d)](_0x21a483(0x16a),_0x2914e2),loggerService_1[_0x21a483(0x179)]['logWhiteDomainResponse'](_0x21a483(0x15c),'/create',_0x518128['status'],_0x2914e2,_0x10a08d),loggerService_1[_0x21a483(0x179)]['logWhiteDomainError']('cointopay',_0x21a483(0x17f),_0x21a483(0x134)+_0x518128[_0x21a483(0x1a0)]+':\x20'+_0x2914e2);throw new Error('HTTP\x20error!\x20status:\x20'+_0x518128['status']+',\x20body:\x20'+_0x2914e2);}let _0x5085d2;try{_0x5085d2=JSON[_0x21a483(0x12c)](_0x2914e2);}catch(_0x124747){console[_0x21a483(0x15d)](_0x21a483(0x12e),_0x124747),loggerService_1['loggerService'][_0x21a483(0x130)](_0x21a483(0x15c),_0x21a483(0x17f),_0x21a483(0x165)+_0x124747);throw new Error(_0x21a483(0x150)+_0x2914e2);}console[_0x21a483(0x18e)](_0x21a483(0x14d)),console[_0x21a483(0x18e)](_0x21a483(0x13e),JSON[_0x21a483(0x177)](_0x5085d2,null,0x2)),loggerService_1[_0x21a483(0x179)]['logWhiteDomainResponse'](_0x21a483(0x15c),'/create',_0x518128[_0x21a483(0x1a0)],_0x5085d2,_0x10a08d);if(_0x5085d2['error']){const _0x4102f2=_0x5085d2['message']||_0x5085d2[_0x21a483(0x15d)]||_0x21a483(0x12a);console[_0x21a483(0x15d)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x21a483(0x153),_0x4102f2),loggerService_1[_0x21a483(0x179)]['logWhiteDomainError']('cointopay',_0x21a483(0x17f),_0x21a483(0x149)+_0x4102f2);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4102f2);}if(!_0x5085d2['payment_url']||!_0x5085d2['gateway_payment_id']){console[_0x21a483(0x15d)](_0x21a483(0x18a)),console[_0x21a483(0x15d)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x21a483(0x15d)](_0x21a483(0x189),_0x5085d2),loggerService_1['loggerService'][_0x21a483(0x130)](_0x21a483(0x15c),_0x21a483(0x17f),_0x21a483(0x167));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x21a483(0x18e)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x21a483(0x182),_0x5085d2['gateway_payment_id']),console[_0x21a483(0x18e)]('Payment\x20URL:',_0x5085d2['payment_url']),console[_0x21a483(0x18e)](_0x21a483(0x131),_0x4c1774,'EUR'),{'gateway_payment_id':_0x5085d2['gateway_payment_id'],'payment_url':_0x5085d2[_0x21a483(0x16b)]};}catch(_0x2973b9){console[_0x21a483(0x15d)](_0x21a483(0x15e)),console[_0x21a483(0x15d)](_0x21a483(0x197),_0x2973b9),loggerService_1[_0x21a483(0x179)][_0x21a483(0x130)](_0x21a483(0x15c),'/create',_0x2973b9);if(_0x2973b9 instanceof Error){console[_0x21a483(0x15d)](_0x21a483(0x12f),_0x2973b9[_0x21a483(0x170)]),console['error']('Error\x20stack:',_0x2973b9['stack']);throw new Error(_0x21a483(0x17c)+_0x2973b9['message']);}throw new Error(_0x21a483(0x178));}}async['checkPaymentStatus'](_0x4cf825){const _0x24a9f3=a40_0x3ad5a4,_0x2be298=Date[_0x24a9f3(0x19e)]();try{console['log'](_0x24a9f3(0x17e)+_0x4cf825);const _0x4a9385={'gatewayPaymentId':_0x4cf825};loggerService_1[_0x24a9f3(0x179)][_0x24a9f3(0x13c)](_0x24a9f3(0x15c),_0x24a9f3(0x136),'POST',_0x4a9385);const _0x1c96c4=await fetch(this[_0x24a9f3(0x155)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x24a9f3(0x17b),'User-Agent':_0x24a9f3(0x18b)},'body':JSON[_0x24a9f3(0x177)](_0x4a9385)}),_0x64ff9b=Date[_0x24a9f3(0x19e)]()-_0x2be298;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x24a9f3(0x192),_0x1c96c4[_0x24a9f3(0x1a0)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x188),_0x64ff9b+'ms');if(!_0x1c96c4['ok']){const _0x380b35=await _0x1c96c4[_0x24a9f3(0x14f)]();console[_0x24a9f3(0x15d)]('HTTP\x20Status:',_0x1c96c4[_0x24a9f3(0x1a0)]),console[_0x24a9f3(0x15d)](_0x24a9f3(0x16a),_0x380b35),loggerService_1[_0x24a9f3(0x179)][_0x24a9f3(0x13a)]('cointopay',_0x24a9f3(0x136),_0x1c96c4['status'],_0x380b35,_0x64ff9b),loggerService_1[_0x24a9f3(0x179)][_0x24a9f3(0x130)](_0x24a9f3(0x15c),_0x24a9f3(0x136),'HTTP\x20'+_0x1c96c4[_0x24a9f3(0x1a0)]+':\x20'+_0x380b35);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1c96c4[_0x24a9f3(0x1a0)]);}const _0x15f412=await _0x1c96c4['text']();console[_0x24a9f3(0x18e)]('Raw\x20Response\x20Body:',_0x15f412);let _0x75f340;try{_0x75f340=JSON[_0x24a9f3(0x12c)](_0x15f412);}catch(_0x244955){console[_0x24a9f3(0x15d)](_0x24a9f3(0x12e),_0x244955),loggerService_1['loggerService']['logWhiteDomainError'](_0x24a9f3(0x15c),_0x24a9f3(0x136),_0x24a9f3(0x165)+_0x244955);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x15f412);}loggerService_1['loggerService'][_0x24a9f3(0x13a)](_0x24a9f3(0x15c),_0x24a9f3(0x136),_0x1c96c4[_0x24a9f3(0x1a0)],_0x75f340,_0x64ff9b),console[_0x24a9f3(0x18e)](_0x24a9f3(0x174)),console[_0x24a9f3(0x18e)](_0x24a9f3(0x16d),_0x75f340[_0x24a9f3(0x13f)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x191),_0x75f340[_0x24a9f3(0x186)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x12d),_0x75f340[_0x24a9f3(0x13d)]?.[_0x24a9f3(0x148)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x131),_0x75f340[_0x24a9f3(0x13d)]?.[_0x24a9f3(0x185)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x195),_0x75f340['data']?.[_0x24a9f3(0x175)]);if(_0x75f340['result']!=='success'||_0x75f340['status_code']!==0xc8){const _0x5678e2=_0x75f340['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x24a9f3(0x143)),console[_0x24a9f3(0x15d)]('Error\x20Message:',_0x5678e2),loggerService_1['loggerService'][_0x24a9f3(0x130)]('cointopay',_0x24a9f3(0x136),'Status\x20API\x20Error:\x20'+_0x5678e2);throw new Error(_0x24a9f3(0x15b)+_0x5678e2);}if(!_0x75f340[_0x24a9f3(0x13d)]){console[_0x24a9f3(0x15d)](_0x24a9f3(0x19c)),console[_0x24a9f3(0x15d)](_0x24a9f3(0x199)),loggerService_1['loggerService'][_0x24a9f3(0x130)](_0x24a9f3(0x15c),_0x24a9f3(0x136),_0x24a9f3(0x171));throw new Error(_0x24a9f3(0x1a4));}let _0x50b0d4='PENDING';switch(_0x75f340['data'][_0x24a9f3(0x148)]?.[_0x24a9f3(0x1a1)]()){case _0x24a9f3(0x157):_0x50b0d4=_0x24a9f3(0x161);break;case _0x24a9f3(0x194):case _0x24a9f3(0x16c):case'error':_0x50b0d4=_0x24a9f3(0x151);break;case'expired':case'timeout':_0x50b0d4=_0x24a9f3(0x138);break;case _0x24a9f3(0x19f):case'awaiting\x20fiat':case'pending':case _0x24a9f3(0x147):default:_0x50b0d4=_0x24a9f3(0x181);break;}let _0x6a6b89,_0xfcdff;if(_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x168)]){const _0x1cb17b=_0x75f340['data'][_0x24a9f3(0x168)];console[_0x24a9f3(0x18e)](_0x24a9f3(0x176),_0x1cb17b);const _0x4f9694=_0x1cb17b[_0x24a9f3(0x19a)](/IBAN\s+([A-Z0-9]+)/i);_0x4f9694&&(_0x6a6b89=_0x4f9694[0x1],console[_0x24a9f3(0x18e)]('🏦\x20Extracted\x20IBAN:',_0x6a6b89)),_0xfcdff=_0x1cb17b;}const _0x1e3cfc={'iban':_0x6a6b89,'bankDetails':_0xfcdff,'transactionId':_0x75f340['data']['TransactionID'],'coinAddress':_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x129)],'qrCodeUrl':_0x75f340['data'][_0x24a9f3(0x18c)],'expiryTime':_0x75f340[_0x24a9f3(0x13d)]['ExpiryTime'],'createdOn':_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x156)],'confirmedOn':_0x75f340['data']['TransactionConfirmedOn']};console[_0x24a9f3(0x18e)](_0x24a9f3(0x142)),console[_0x24a9f3(0x18e)](_0x24a9f3(0x192),_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x148)],'->',_0x50b0d4),console[_0x24a9f3(0x18e)]('Amount:',_0x75f340[_0x24a9f3(0x13d)]['Amount'],_0x75f340[_0x24a9f3(0x13d)]['inputCurrency']),console[_0x24a9f3(0x18e)](_0x24a9f3(0x190),_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x17a)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x135),_0x6a6b89||_0x24a9f3(0x187)),console[_0x24a9f3(0x18e)](_0x24a9f3(0x173),_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x156)]),console[_0x24a9f3(0x18e)](_0x24a9f3(0x146),_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x193)]||_0x24a9f3(0x18d));if(_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x148)]?.[_0x24a9f3(0x1a1)]()==='awaiting\x20fiat')console[_0x24a9f3(0x18e)](_0x24a9f3(0x163));else _0x75f340['data']['Status']?.['toLowerCase']()===_0x24a9f3(0x157)&&console[_0x24a9f3(0x18e)]('✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x50b0d4,'amount':parseFloat(_0x75f340['data'][_0x24a9f3(0x185)])||undefined,'currency':_0x75f340[_0x24a9f3(0x13d)][_0x24a9f3(0x175)]||'EUR','paymentDetails':_0x1e3cfc};}catch(_0x376640){console[_0x24a9f3(0x15d)](_0x24a9f3(0x1a3),_0x376640),loggerService_1['loggerService']['logWhiteDomainError'](_0x24a9f3(0x15c),'/status',_0x376640);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x376640 instanceof Error?_0x376640[_0x24a9f3(0x170)]:_0x24a9f3(0x14a)));}}async[a40_0x3ad5a4(0x15f)](_0x5aa2f1){const _0x54e01c=a40_0x3ad5a4,_0x5904f5=await this[_0x54e01c(0x169)](_0x5aa2f1);return{'status':_0x5904f5[_0x54e01c(0x1a0)],'amount':_0x5904f5[_0x54e01c(0x1a2)],'currency':_0x5904f5[_0x54e01c(0x159)]};}async[a40_0x3ad5a4(0x162)](_0x1da699){const _0x304050=a40_0x3ad5a4;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x1da699);let _0x2b2d5b=_0x304050(0x181);switch(_0x1da699[_0x304050(0x1a0)]?.[_0x304050(0x1a1)]()){case _0x304050(0x157):_0x2b2d5b=_0x304050(0x161);break;case _0x304050(0x194):case _0x304050(0x16c):case _0x304050(0x15d):_0x2b2d5b='FAILED';break;case'expired':case'timeout':_0x2b2d5b=_0x304050(0x138);break;case'pending':case _0x304050(0x19f):case _0x304050(0x17d):case'created':default:_0x2b2d5b=_0x304050(0x181);break;}return{'paymentId':_0x1da699[_0x304050(0x160)]||_0x1da699['merchant_reference_id']||'','status':_0x2b2d5b,'amount':_0x1da699['amount'],'currency':_0x1da699[_0x304050(0x159)]||_0x304050(0x18f)};}}exports[a40_0x3ad5a4(0x152)]=CoinToPayService;function a40_0x3164(){const _0x531e3f=['===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','QRCodeURL','not\x20confirmed','log','EUR','Transaction\x20ID:','Status\x20Code:','Status:','TransactionConfirmedOn','cancelled','Currency:','1529BAAFHn','Error\x20details:','2228542rxcvLo','Missing\x20data\x20in\x20response','match','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','now','waiting','status','toLowerCase','amount','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','coinAddress','Unknown\x20error\x20from\x20CoinToPay\x20API','📊\x20Status\x20check\x20URL:','parse','Payment\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20message:','logWhiteDomainError','Amount:','createPaymentLink','../loggerService','HTTP\x20','IBAN:','/status','3966124MEIcuF','EXPIRED','13362670NzOSPo','logWhiteDomainResponse','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','logWhiteDomainRequest','data','Parsed\x20Result:','result','175524HdCAhW','936280obdrYP','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','9pWofmE','apiUrl','Confirmed\x20On:','created','Status','Business\x20Error:\x20','Unknown\x20error','3ssNSkV','POST','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','URL:','text','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','FAILED','CoinToPayService','Error\x20Message:','Request\x20Body:','statusUrl','CreatedOn','paid','3115NmKhcj','currency','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CoinToPay\x20status\x20API\x20error:\x20','cointopay','error','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','verifyPayment','order_id','PAID','processWebhook','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','1169574EJArau','JSON\x20Parse\x20Error:\x20','5hRoBYe','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PaymentDetail','checkPaymentStatus','Response\x20Body:','payment_url','failed','Result:','https://tesoft.uk/gateway/cointopay/status.php','Status\x20Text:','message','Incomplete\x20response:\x20missing\x20data','headers','Created\x20On:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','inputCurrency','🏦\x20Payment\x20Detail:','stringify','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','loggerService','TransactionID','application/json','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','awaiting\x20fiat','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','/create','\x20EUR','PENDING','Gateway\x20Payment\x20ID:','856UoIQZk','Raw\x20Response\x20Body:','Amount','status_code','not\x20found','Response\x20Time:','Response\x20data:'];a40_0x3164=function(){return _0x531e3f;};return a40_0x3164();}