'use strict';const a40_0x126457=a40_0x26bf;function a40_0x26bf(_0x2db8d2,_0x5e1525){const _0x4eb4f5=a40_0x4eb4();return a40_0x26bf=function(_0x26bfe8,_0x15c36f){_0x26bfe8=_0x26bfe8-0x18c;let _0x3e7620=_0x4eb4f5[_0x26bfe8];return _0x3e7620;},a40_0x26bf(_0x2db8d2,_0x5e1525);}(function(_0x22f9c9,_0x568273){const _0x121c78=a40_0x26bf,_0x571b41=_0x22f9c9();while(!![]){try{const _0x1956f9=-parseInt(_0x121c78(0x1ef))/0x1+-parseInt(_0x121c78(0x1a1))/0x2+-parseInt(_0x121c78(0x1c5))/0x3*(parseInt(_0x121c78(0x1c0))/0x4)+-parseInt(_0x121c78(0x1ca))/0x5+-parseInt(_0x121c78(0x20e))/0x6*(parseInt(_0x121c78(0x1a9))/0x7)+-parseInt(_0x121c78(0x201))/0x8+parseInt(_0x121c78(0x1e6))/0x9;if(_0x1956f9===_0x568273)break;else _0x571b41['push'](_0x571b41['shift']());}catch(_0x140374){_0x571b41['push'](_0x571b41['shift']());}}}(a40_0x4eb4,0x6be6e));Object[a40_0x126457(0x191)](exports,a40_0x126457(0x1f6),{'value':!![]}),exports[a40_0x126457(0x1b9)]=void 0x0;function a40_0x4eb4(){const _0x114c3f=['timeout','Status\x20Text:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','error','Payment\x20URL:','cointopay','TransactionID','CreatedOn','text','createPaymentLink','apiUrl','30JkfLkK','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','https://tesoft.uk/gateway/cointopay/status.php','FAILED','loggerService','/status','Confirmed\x20On:','../loggerService','parse','Business\x20Error:\x20','defineProperty','created','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Created\x20On:','POST','üè¶\x20Payment\x20Detail:','logWhiteDomainResponse','Error\x20stack:','coinAddress','JSON\x20Parse\x20Error:\x20','Status\x20Code:','\x20EUR','statusUrl','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','PENDING','1491320PHrZrl','Error\x20Message:','CoinToPay\x20API\x20error:\x20','not\x20found','Gateway\x20Payment\x20ID:','entries','message','failed','891835BrEQoI','result','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','awaiting\x20fiat','logWhiteDomainRequest','===\x20COINTOPAY\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','status_code','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','EUR','processWebhook','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','/create','Amount:','CoinToPayService','Status:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','Payment\x20Status:','pending','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','1532948XfhoFG','not\x20confirmed','Amount','TransactionConfirmedOn','fromEntries','3XiOBWk','amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','2510765mqNUyR','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','payment_url','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN:','paid','EXPIRED','Status','Missing\x20data\x20in\x20response','currency','Unknown\x20error','Result:','order_id','CoinToPay\x20status\x20API\x20error:\x20','verifyPayment','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','URL:','QRCodeURL','logWhiteDomainError','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','HTTP\x20','application/json','log','===\x20COINTOPAY\x20API\x20ERROR\x20===','inputCurrency','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','35844282LolMOo','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','status','gateway_payment_id','TesSoft\x20Payment\x20System/1.0','IBAN:','Response\x20Time:','PaymentDetail','match','451482DVfaZo','now','checkPaymentStatus','data','Raw\x20Response\x20Body:','Incomplete\x20response:\x20missing\x20data','Status\x20API\x20Error:\x20','__esModule','stringify','toLowerCase','waiting','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20Body:','https://tesoft.uk/gateway/cointopay/','Failed\x20to\x20parse\x20JSON\x20response:','PAID','Error\x20details:','headers','6569400kMuych','HTTP\x20Status:'];a40_0x4eb4=function(){return _0x114c3f;};return a40_0x4eb4();}const loggerService_1=require(a40_0x126457(0x18e));class CoinToPayService{constructor(){const _0x55cd34=a40_0x126457;this[_0x55cd34(0x20d)]=_0x55cd34(0x1fc),this[_0x55cd34(0x19d)]=_0x55cd34(0x210),console['log'](_0x55cd34(0x1bb)),console[_0x55cd34(0x1e1)]('üìä\x20Status\x20check\x20URL:',this[_0x55cd34(0x19d)]);}async[a40_0x126457(0x20c)](_0x33b3dc){const _0x4414d0=a40_0x126457,{orderId:_0x59103f,amount:_0x3f14fb}=_0x33b3dc;console['log'](_0x4414d0(0x1de)+_0x3f14fb+_0x4414d0(0x19c));const _0x31ec07={'amount':_0x3f14fb},_0x1db034=Date[_0x4414d0(0x1f0)]();try{console[_0x4414d0(0x1e1)](_0x4414d0(0x205)),console[_0x4414d0(0x1e1)](_0x4414d0(0x1db),this['apiUrl']),console['log']('Request\x20Body:',JSON[_0x4414d0(0x1f7)](_0x31ec07,null,0x2)),console[_0x4414d0(0x1e1)](_0x4414d0(0x1b8),_0x3f14fb,_0x4414d0(0x193)),loggerService_1[_0x4414d0(0x212)][_0x4414d0(0x1ad)](_0x4414d0(0x208),'/create',_0x4414d0(0x195),_0x31ec07);const _0x17371d=await fetch(this[_0x4414d0(0x20d)],{'method':_0x4414d0(0x195),'headers':{'Content-Type':_0x4414d0(0x1e0),'Accept':_0x4414d0(0x1e0),'User-Agent':_0x4414d0(0x1ea)},'body':JSON[_0x4414d0(0x1f7)](_0x31ec07)}),_0x261b70=Date[_0x4414d0(0x1f0)]()-_0x1db034;console[_0x4414d0(0x1e1)](_0x4414d0(0x1e5)),console[_0x4414d0(0x1e1)](_0x4414d0(0x1ba),_0x17371d[_0x4414d0(0x1e8)]),console[_0x4414d0(0x1e1)](_0x4414d0(0x204),_0x17371d['statusText']),console[_0x4414d0(0x1e1)]('Headers:',Object[_0x4414d0(0x1c4)](_0x17371d[_0x4414d0(0x200)][_0x4414d0(0x1a6)]())),console[_0x4414d0(0x1e1)](_0x4414d0(0x1ec),_0x261b70+'ms');const _0x102ea1=await _0x17371d[_0x4414d0(0x20b)]();console[_0x4414d0(0x1e1)]('Raw\x20Response\x20Body:',_0x102ea1);if(!_0x17371d['ok']){console[_0x4414d0(0x206)](_0x4414d0(0x1e2)),console['error']('HTTP\x20Status:',_0x17371d[_0x4414d0(0x1e8)]),console[_0x4414d0(0x206)]('Response\x20Body:',_0x102ea1),loggerService_1[_0x4414d0(0x212)][_0x4414d0(0x197)](_0x4414d0(0x208),_0x4414d0(0x1b7),_0x17371d[_0x4414d0(0x1e8)],_0x102ea1,_0x261b70),loggerService_1['loggerService'][_0x4414d0(0x1dd)](_0x4414d0(0x208),_0x4414d0(0x1b7),_0x4414d0(0x1df)+_0x17371d['status']+':\x20'+_0x102ea1);throw new Error(_0x4414d0(0x1af)+_0x17371d[_0x4414d0(0x1e8)]+',\x20body:\x20'+_0x102ea1);}let _0x192df6;try{_0x192df6=JSON[_0x4414d0(0x18f)](_0x102ea1);}catch(_0x283bfa){console[_0x4414d0(0x206)](_0x4414d0(0x1fd),_0x283bfa),loggerService_1[_0x4414d0(0x212)][_0x4414d0(0x1dd)](_0x4414d0(0x208),'/create',_0x4414d0(0x19a)+_0x283bfa);throw new Error(_0x4414d0(0x1ab)+_0x102ea1);}console[_0x4414d0(0x1e1)](_0x4414d0(0x1cd)),console[_0x4414d0(0x1e1)]('Parsed\x20Result:',JSON[_0x4414d0(0x1f7)](_0x192df6,null,0x2)),loggerService_1[_0x4414d0(0x212)][_0x4414d0(0x197)](_0x4414d0(0x208),'/create',_0x17371d['status'],_0x192df6,_0x261b70);if(_0x192df6['error']){const _0x1ad6c5=_0x192df6[_0x4414d0(0x1a7)]||_0x192df6['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x4414d0(0x1b1)),console[_0x4414d0(0x206)](_0x4414d0(0x1a2),_0x1ad6c5),loggerService_1[_0x4414d0(0x212)]['logWhiteDomainError'](_0x4414d0(0x208),_0x4414d0(0x1b7),_0x4414d0(0x190)+_0x1ad6c5);throw new Error(_0x4414d0(0x1a3)+_0x1ad6c5);}if(!_0x192df6[_0x4414d0(0x1cc)]||!_0x192df6[_0x4414d0(0x1e9)]){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4414d0(0x206)](_0x4414d0(0x1e7)),console[_0x4414d0(0x206)]('Response\x20data:',_0x192df6),loggerService_1[_0x4414d0(0x212)]['logWhiteDomainError'](_0x4414d0(0x208),_0x4414d0(0x1b7),_0x4414d0(0x1c9));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x4414d0(0x1ae)),console['log'](_0x4414d0(0x1a5),_0x192df6[_0x4414d0(0x1e9)]),console[_0x4414d0(0x1e1)](_0x4414d0(0x207),_0x192df6[_0x4414d0(0x1cc)]),console['log'](_0x4414d0(0x1b8),_0x3f14fb,_0x4414d0(0x1b4)),{'gateway_payment_id':_0x192df6[_0x4414d0(0x1e9)],'payment_url':_0x192df6[_0x4414d0(0x1cc)]};}catch(_0x636ab9){console[_0x4414d0(0x206)](_0x4414d0(0x1b6)),console[_0x4414d0(0x206)](_0x4414d0(0x1ff),_0x636ab9),loggerService_1[_0x4414d0(0x212)][_0x4414d0(0x1dd)](_0x4414d0(0x208),_0x4414d0(0x1b7),_0x636ab9);if(_0x636ab9 instanceof Error){console[_0x4414d0(0x206)]('Error\x20message:',_0x636ab9[_0x4414d0(0x1a7)]),console[_0x4414d0(0x206)](_0x4414d0(0x198),_0x636ab9[_0x4414d0(0x1bc)]);throw new Error(_0x4414d0(0x19f)+_0x636ab9[_0x4414d0(0x1a7)]);}throw new Error(_0x4414d0(0x20f));}}async['checkPaymentStatus'](_0x43a3be){const _0x3d0b48=a40_0x126457,_0x4348d6=Date[_0x3d0b48(0x1f0)]();try{console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1d9)+_0x43a3be);const _0x2d746c={'gatewayPaymentId':_0x43a3be};loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x1ad)](_0x3d0b48(0x208),_0x3d0b48(0x18c),_0x3d0b48(0x195),_0x2d746c);const _0x412381=await fetch(this[_0x3d0b48(0x19d)],{'method':'POST','headers':{'Content-Type':_0x3d0b48(0x1e0),'Accept':_0x3d0b48(0x1e0),'User-Agent':_0x3d0b48(0x1ea)},'body':JSON[_0x3d0b48(0x1f7)](_0x2d746c)}),_0x4118c1=Date[_0x3d0b48(0x1f0)]()-_0x4348d6;console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1bf)),console['log'](_0x3d0b48(0x1ba),_0x412381[_0x3d0b48(0x1e8)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1ec),_0x4118c1+'ms');if(!_0x412381['ok']){const _0x134368=await _0x412381['text']();console[_0x3d0b48(0x206)](_0x3d0b48(0x202),_0x412381[_0x3d0b48(0x1e8)]),console[_0x3d0b48(0x206)](_0x3d0b48(0x1fb),_0x134368),loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x197)](_0x3d0b48(0x208),'/status',_0x412381['status'],_0x134368,_0x4118c1),loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x1dd)](_0x3d0b48(0x208),'/status','HTTP\x20'+_0x412381[_0x3d0b48(0x1e8)]+':\x20'+_0x134368);throw new Error(_0x3d0b48(0x1af)+_0x412381['status']);}const _0x19cfce=await _0x412381[_0x3d0b48(0x20b)]();console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1f3),_0x19cfce);let _0x46ace9;try{_0x46ace9=JSON[_0x3d0b48(0x18f)](_0x19cfce);}catch(_0x2f608b){console['error'](_0x3d0b48(0x1fd),_0x2f608b),loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x1dd)]('cointopay',_0x3d0b48(0x18c),_0x3d0b48(0x19a)+_0x2f608b);throw new Error(_0x3d0b48(0x1cb)+_0x19cfce);}loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x197)](_0x3d0b48(0x208),_0x3d0b48(0x18c),_0x412381['status'],_0x46ace9,_0x4118c1),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x19e)),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1d5),_0x46ace9[_0x3d0b48(0x1aa)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x19b),_0x46ace9[_0x3d0b48(0x1b0)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1bd),_0x46ace9['data']?.[_0x3d0b48(0x1d1)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1b8),_0x46ace9[_0x3d0b48(0x1f2)]?.[_0x3d0b48(0x1c2)]),console[_0x3d0b48(0x1e1)]('Currency:',_0x46ace9[_0x3d0b48(0x1f2)]?.[_0x3d0b48(0x1e3)]);if(_0x46ace9[_0x3d0b48(0x1aa)]!=='success'||_0x46ace9[_0x3d0b48(0x1b0)]!==0xc8){const _0x5f4046=_0x46ace9['message']||_0x3d0b48(0x1da);console[_0x3d0b48(0x206)](_0x3d0b48(0x1e4)),console[_0x3d0b48(0x206)]('Error\x20Message:',_0x5f4046),loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x1dd)](_0x3d0b48(0x208),_0x3d0b48(0x18c),_0x3d0b48(0x1f5)+_0x5f4046);throw new Error(_0x3d0b48(0x1d7)+_0x5f4046);}if(!_0x46ace9[_0x3d0b48(0x1f2)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3d0b48(0x206)](_0x3d0b48(0x1d2)),loggerService_1[_0x3d0b48(0x212)][_0x3d0b48(0x1dd)](_0x3d0b48(0x208),_0x3d0b48(0x18c),_0x3d0b48(0x1f4));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2738b6=_0x3d0b48(0x1a0);switch(_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x1d1)]?.[_0x3d0b48(0x1f8)]()){case _0x3d0b48(0x1cf):_0x2738b6='PAID';break;case'cancelled':case _0x3d0b48(0x1a8):case _0x3d0b48(0x206):_0x2738b6=_0x3d0b48(0x211);break;case'expired':case _0x3d0b48(0x203):_0x2738b6=_0x3d0b48(0x1d0);break;case'waiting':case'awaiting\x20fiat':case _0x3d0b48(0x1be):case _0x3d0b48(0x192):default:_0x2738b6=_0x3d0b48(0x1a0);break;}let _0x5b859b,_0x3640b6;if(_0x46ace9['data'][_0x3d0b48(0x1ed)]){const _0x19174e=_0x46ace9['data']['PaymentDetail'];console[_0x3d0b48(0x1e1)](_0x3d0b48(0x196),_0x19174e);const _0x4b8fdf=_0x19174e[_0x3d0b48(0x1ee)](/IBAN\s+([A-Z0-9]+)/i);_0x4b8fdf&&(_0x5b859b=_0x4b8fdf[0x1],console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1ce),_0x5b859b)),_0x3640b6=_0x19174e;}const _0x5650e1={'iban':_0x5b859b,'bankDetails':_0x3640b6,'transactionId':_0x46ace9['data']['TransactionID'],'coinAddress':_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x199)],'qrCodeUrl':_0x46ace9['data'][_0x3d0b48(0x1dc)],'expiryTime':_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x1b2)],'createdOn':_0x46ace9['data']['CreatedOn'],'confirmedOn':_0x46ace9['data'][_0x3d0b48(0x1c3)]};console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1b3)),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1ba),_0x46ace9['data'][_0x3d0b48(0x1d1)],'->',_0x2738b6),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1b8),_0x46ace9['data'][_0x3d0b48(0x1c2)],_0x46ace9[_0x3d0b48(0x1f2)]['inputCurrency']),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1c8),_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x209)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x1eb),_0x5b859b||_0x3d0b48(0x1a4)),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x194),_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x20a)]),console[_0x3d0b48(0x1e1)](_0x3d0b48(0x18d),_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x1c3)]||_0x3d0b48(0x1c1));if(_0x46ace9['data'][_0x3d0b48(0x1d1)]?.[_0x3d0b48(0x1f8)]()==='awaiting\x20fiat')console[_0x3d0b48(0x1e1)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x46ace9[_0x3d0b48(0x1f2)]['Status']?.[_0x3d0b48(0x1f8)]()===_0x3d0b48(0x1cf)&&console[_0x3d0b48(0x1e1)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x2738b6,'amount':parseFloat(_0x46ace9[_0x3d0b48(0x1f2)]['Amount'])||undefined,'currency':_0x46ace9[_0x3d0b48(0x1f2)][_0x3d0b48(0x1e3)]||_0x3d0b48(0x1b4),'paymentDetails':_0x5650e1};}catch(_0x1809c7){console[_0x3d0b48(0x206)](_0x3d0b48(0x1fa),_0x1809c7),loggerService_1['loggerService'][_0x3d0b48(0x1dd)]('cointopay',_0x3d0b48(0x18c),_0x1809c7);throw new Error(_0x3d0b48(0x1c7)+(_0x1809c7 instanceof Error?_0x1809c7['message']:_0x3d0b48(0x1d4)));}}async[a40_0x126457(0x1d8)](_0xfce38e){const _0x203f74=a40_0x126457,_0x20fc6c=await this[_0x203f74(0x1f1)](_0xfce38e);return{'status':_0x20fc6c[_0x203f74(0x1e8)],'amount':_0x20fc6c[_0x203f74(0x1c6)],'currency':_0x20fc6c['currency']};}async[a40_0x126457(0x1b5)](_0x42a0a1){const _0x314ac8=a40_0x126457;console[_0x314ac8(0x1e1)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x42a0a1);let _0x298591=_0x314ac8(0x1a0);switch(_0x42a0a1['status']?.['toLowerCase']()){case _0x314ac8(0x1cf):_0x298591=_0x314ac8(0x1fe);break;case'cancelled':case _0x314ac8(0x1a8):case'error':_0x298591=_0x314ac8(0x211);break;case'expired':case _0x314ac8(0x203):_0x298591='EXPIRED';break;case _0x314ac8(0x1be):case _0x314ac8(0x1f9):case _0x314ac8(0x1ac):case _0x314ac8(0x192):default:_0x298591='PENDING';break;}return{'paymentId':_0x42a0a1[_0x314ac8(0x1d6)]||_0x42a0a1['merchant_reference_id']||'','status':_0x298591,'amount':_0x42a0a1['amount'],'currency':_0x42a0a1[_0x314ac8(0x1d3)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;