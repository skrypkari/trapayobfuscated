'use strict';const a38_0x4b7803=a38_0x4b4d;(function(_0x5e51e2,_0x17a89b){const _0x1c58ec=a38_0x4b4d,_0x48092a=_0x5e51e2();while(!![]){try{const _0x470add=parseInt(_0x1c58ec(0x275))/0x1+parseInt(_0x1c58ec(0x209))/0x2*(-parseInt(_0x1c58ec(0x232))/0x3)+parseInt(_0x1c58ec(0x257))/0x4*(-parseInt(_0x1c58ec(0x212))/0x5)+parseInt(_0x1c58ec(0x223))/0x6*(-parseInt(_0x1c58ec(0x263))/0x7)+-parseInt(_0x1c58ec(0x26d))/0x8+parseInt(_0x1c58ec(0x277))/0x9*(-parseInt(_0x1c58ec(0x260))/0xa)+parseInt(_0x1c58ec(0x271))/0xb*(parseInt(_0x1c58ec(0x23b))/0xc);if(_0x470add===_0x17a89b)break;else _0x48092a['push'](_0x48092a['shift']());}catch(_0x57c97c){_0x48092a['push'](_0x48092a['shift']());}}}(a38_0x1e79,0x46660));function a38_0x1e79(){const _0x235e33=['10OElcam','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','ExpiryTime','CoinToPayService','Response\x20Time:','checkPaymentStatus','Parsed\x20Result:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stack','fromEntries','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','cointopay','CreatedOn','Raw\x20Response\x20Body:','timeout','üìä\x20Status\x20check\x20URL:','942OxRurl','TransactionID','\x20EUR','success','Status','PAID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','logWhiteDomainError','Result:','Status:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','HTTP\x20Status:','now','1693149RIpwrn',',\x20body:\x20','error','Missing\x20data\x20in\x20response','pending','waiting','defineProperty','Request\x20Body:','match','1410888GuZbBD','URL:','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20','Error\x20message:','processWebhook','not\x20found','message','gateway_payment_id','===\x20COINTOPAY\x20API\x20ERROR\x20===','data','awaiting\x20fiat','üè¶\x20Payment\x20Detail:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','PaymentDetail','Incomplete\x20response:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PENDING','toLowerCase','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','EXPIRED','FAILED','Headers:','cancelled','EUR','870436sohqmE','Currency:','verifyPayment','/status','inputCurrency','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','created','Amount:','failed','100wTLefa','Unknown\x20error\x20from\x20CoinToPay\x20API','coinAddress','18445uqINto','POST','statusUrl','Status\x20Code:','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20Body:','payment_url','Payment\x20URL:','apiUrl','stringify','1198968eeJrlU','expired','https://tesoft.uk/gateway/cointopay/','paid','132mrlnkt','parse','status_code','HTTP\x20error!\x20status:\x20','456091YgiFhb','Created\x20On:','13914KBhVAu','entries','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Payment\x20Status:','text','/create','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','result','amount','Amount','headers','status','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TransactionConfirmedOn','CoinToPay\x20status\x20API\x20error:\x20','loggerService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','order_id','CoinToPay\x20API\x20error:\x20','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','JSON\x20Parse\x20Error:\x20','2umUpgB','application/json','Unknown\x20error','Error\x20Message:','log','not\x20confirmed','https://tesoft.uk/gateway/cointopay/status.php','createPaymentLink','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='];a38_0x1e79=function(){return _0x235e33;};return a38_0x1e79();}Object[a38_0x4b7803(0x238)](exports,'__esModule',{'value':!![]}),exports[a38_0x4b7803(0x215)]=void 0x0;const loggerService_1=require('../loggerService');function a38_0x4b4d(_0x3e8df4,_0xcd17e5){const _0x1e791d=a38_0x1e79();return a38_0x4b4d=function(_0x4b4dc0,_0x243af9){_0x4b4dc0=_0x4b4dc0-0x1f4;let _0x4f787e=_0x1e791d[_0x4b4dc0];return _0x4f787e;},a38_0x4b4d(_0x3e8df4,_0xcd17e5);}class CoinToPayService{constructor(){const _0xdad94f=a38_0x4b7803;this[_0xdad94f(0x26b)]=_0xdad94f(0x26f),this[_0xdad94f(0x265)]=_0xdad94f(0x20f),console[_0xdad94f(0x20d)](_0xdad94f(0x219)),console['log'](_0xdad94f(0x222),this[_0xdad94f(0x265)]);}async[a38_0x4b7803(0x210)](_0x475914){const _0x5b6ba1=a38_0x4b7803,{orderId:_0x5afeb1,amount:_0x2c8dab}=_0x475914;console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x213)+_0x2c8dab+_0x5b6ba1(0x225));const _0x5a5094={'amount':_0x2c8dab},_0x4f74a1=Date[_0x5b6ba1(0x231)]();try{console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x249)),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x23c),this['apiUrl']),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x239),JSON[_0x5b6ba1(0x26c)](_0x5a5094,null,0x2)),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x25e),_0x2c8dab,_0x5b6ba1(0x22a)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x5b6ba1(0x21e),'/create','POST',_0x5a5094);const _0x497469=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x5b6ba1(0x20a),'Accept':_0x5b6ba1(0x20a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x5b6ba1(0x26c)](_0x5a5094)}),_0x1d7731=Date[_0x5b6ba1(0x231)]()-_0x4f74a1;console[_0x5b6ba1(0x20d)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x22d),_0x497469['status']),console[_0x5b6ba1(0x20d)]('Status\x20Text:',_0x497469['statusText']),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x254),Object[_0x5b6ba1(0x21b)](_0x497469[_0x5b6ba1(0x1fd)][_0x5b6ba1(0x1f4)]())),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x216),_0x1d7731+'ms');const _0x388ac8=await _0x497469[_0x5b6ba1(0x1f7)]();console['log'](_0x5b6ba1(0x220),_0x388ac8);if(!_0x497469['ok']){console[_0x5b6ba1(0x234)](_0x5b6ba1(0x244)),console[_0x5b6ba1(0x234)](_0x5b6ba1(0x230),_0x497469[_0x5b6ba1(0x1fe)]),console[_0x5b6ba1(0x234)](_0x5b6ba1(0x268),_0x388ac8),loggerService_1['loggerService'][_0x5b6ba1(0x206)](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),_0x497469[_0x5b6ba1(0x1fe)],_0x388ac8,_0x1d7731),loggerService_1[_0x5b6ba1(0x202)][_0x5b6ba1(0x22b)](_0x5b6ba1(0x21e),'/create',_0x5b6ba1(0x23e)+_0x497469[_0x5b6ba1(0x1fe)]+':\x20'+_0x388ac8);throw new Error(_0x5b6ba1(0x274)+_0x497469[_0x5b6ba1(0x1fe)]+_0x5b6ba1(0x233)+_0x388ac8);}let _0x4f8a9d;try{_0x4f8a9d=JSON[_0x5b6ba1(0x272)](_0x388ac8);}catch(_0x5dd403){console[_0x5b6ba1(0x234)](_0x5b6ba1(0x267),_0x5dd403),loggerService_1['loggerService'][_0x5b6ba1(0x22b)](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),'JSON\x20Parse\x20Error:\x20'+_0x5dd403);throw new Error(_0x5b6ba1(0x25c)+_0x388ac8);}console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x251)),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x218),JSON['stringify'](_0x4f8a9d,null,0x2)),loggerService_1[_0x5b6ba1(0x202)]['logWhiteDomainResponse'](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),_0x497469[_0x5b6ba1(0x1fe)],_0x4f8a9d,_0x1d7731);if(_0x4f8a9d['error']){const _0x339599=_0x4f8a9d['message']||_0x4f8a9d['error']||_0x5b6ba1(0x261);console['error'](_0x5b6ba1(0x203)),console[_0x5b6ba1(0x234)]('Error\x20Message:',_0x339599),loggerService_1[_0x5b6ba1(0x202)][_0x5b6ba1(0x22b)](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),'Business\x20Error:\x20'+_0x339599);throw new Error(_0x5b6ba1(0x205)+_0x339599);}if(!_0x4f8a9d[_0x5b6ba1(0x269)]||!_0x4f8a9d[_0x5b6ba1(0x243)]){console[_0x5b6ba1(0x234)](_0x5b6ba1(0x207)),console[_0x5b6ba1(0x234)](_0x5b6ba1(0x21d)),console['error']('Response\x20data:',_0x4f8a9d),loggerService_1[_0x5b6ba1(0x202)][_0x5b6ba1(0x22b)](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),_0x5b6ba1(0x21c));throw new Error(_0x5b6ba1(0x229));}return console[_0x5b6ba1(0x20d)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x250),_0x4f8a9d['gateway_payment_id']),console[_0x5b6ba1(0x20d)](_0x5b6ba1(0x26a),_0x4f8a9d[_0x5b6ba1(0x269)]),console[_0x5b6ba1(0x20d)]('Amount:',_0x2c8dab,_0x5b6ba1(0x256)),{'gateway_payment_id':_0x4f8a9d[_0x5b6ba1(0x243)],'payment_url':_0x4f8a9d[_0x5b6ba1(0x269)]};}catch(_0x450e45){console[_0x5b6ba1(0x234)](_0x5b6ba1(0x24f)),console[_0x5b6ba1(0x234)]('Error\x20details:',_0x450e45),loggerService_1[_0x5b6ba1(0x202)][_0x5b6ba1(0x22b)](_0x5b6ba1(0x21e),_0x5b6ba1(0x1f8),_0x450e45);if(_0x450e45 instanceof Error){console['error'](_0x5b6ba1(0x23f),_0x450e45[_0x5b6ba1(0x242)]),console[_0x5b6ba1(0x234)]('Error\x20stack:',_0x450e45[_0x5b6ba1(0x21a)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x450e45[_0x5b6ba1(0x242)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x277df1){const _0xbf9d6a=a38_0x4b7803,_0x10f5a9=Date[_0xbf9d6a(0x231)]();try{console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x248)+_0x277df1);const _0x4b1fbd={'gatewayPaymentId':_0x277df1};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay','/status','POST',_0x4b1fbd);const _0x4c451b=await fetch(this[_0xbf9d6a(0x265)],{'method':_0xbf9d6a(0x264),'headers':{'Content-Type':_0xbf9d6a(0x20a),'Accept':_0xbf9d6a(0x20a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xbf9d6a(0x26c)](_0x4b1fbd)}),_0x31180c=Date['now']()-_0x10f5a9;console[_0xbf9d6a(0x20d)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0xbf9d6a(0x22d),_0x4c451b[_0xbf9d6a(0x1fe)]),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x216),_0x31180c+'ms');if(!_0x4c451b['ok']){const _0x1691f7=await _0x4c451b[_0xbf9d6a(0x1f7)]();console[_0xbf9d6a(0x234)](_0xbf9d6a(0x230),_0x4c451b[_0xbf9d6a(0x1fe)]),console['error'](_0xbf9d6a(0x268),_0x1691f7),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xbf9d6a(0x21e),_0xbf9d6a(0x25a),_0x4c451b['status'],_0x1691f7,_0x31180c),loggerService_1[_0xbf9d6a(0x202)][_0xbf9d6a(0x22b)](_0xbf9d6a(0x21e),_0xbf9d6a(0x25a),_0xbf9d6a(0x23e)+_0x4c451b[_0xbf9d6a(0x1fe)]+':\x20'+_0x1691f7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4c451b[_0xbf9d6a(0x1fe)]);}const _0x5d76e1=await _0x4c451b[_0xbf9d6a(0x1f7)]();console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x220),_0x5d76e1);let _0x2c93ec;try{_0x2c93ec=JSON['parse'](_0x5d76e1);}catch(_0x3febf7){console[_0xbf9d6a(0x234)](_0xbf9d6a(0x267),_0x3febf7),loggerService_1[_0xbf9d6a(0x202)][_0xbf9d6a(0x22b)](_0xbf9d6a(0x21e),_0xbf9d6a(0x25a),_0xbf9d6a(0x208)+_0x3febf7);throw new Error(_0xbf9d6a(0x24c)+_0x5d76e1);}loggerService_1[_0xbf9d6a(0x202)]['logWhiteDomainResponse'](_0xbf9d6a(0x21e),'/status',_0x4c451b['status'],_0x2c93ec,_0x31180c),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x1f5)),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x22c),_0x2c93ec[_0xbf9d6a(0x1fa)]),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x266),_0x2c93ec['status_code']),console['log'](_0xbf9d6a(0x1f6),_0x2c93ec[_0xbf9d6a(0x245)]?.[_0xbf9d6a(0x227)]),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x25e),_0x2c93ec[_0xbf9d6a(0x245)]?.['Amount']),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x258),_0x2c93ec['data']?.[_0xbf9d6a(0x25b)]);if(_0x2c93ec[_0xbf9d6a(0x1fa)]!==_0xbf9d6a(0x226)||_0x2c93ec[_0xbf9d6a(0x273)]!==0xc8){const _0xe6080d=_0x2c93ec['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0xbf9d6a(0x234)](_0xbf9d6a(0x211)),console[_0xbf9d6a(0x234)](_0xbf9d6a(0x20c),_0xe6080d),loggerService_1[_0xbf9d6a(0x202)][_0xbf9d6a(0x22b)](_0xbf9d6a(0x21e),_0xbf9d6a(0x25a),'Status\x20API\x20Error:\x20'+_0xe6080d);throw new Error(_0xbf9d6a(0x201)+_0xe6080d);}if(!_0x2c93ec['data']){console['error'](_0xbf9d6a(0x22e)),console[_0xbf9d6a(0x234)](_0xbf9d6a(0x235)),loggerService_1[_0xbf9d6a(0x202)][_0xbf9d6a(0x22b)](_0xbf9d6a(0x21e),'/status',_0xbf9d6a(0x24b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2863a0=_0xbf9d6a(0x24d);switch(_0x2c93ec[_0xbf9d6a(0x245)]['Status']?.['toLowerCase']()){case _0xbf9d6a(0x270):_0x2863a0=_0xbf9d6a(0x228);break;case _0xbf9d6a(0x255):case _0xbf9d6a(0x25f):case _0xbf9d6a(0x234):_0x2863a0=_0xbf9d6a(0x253);break;case _0xbf9d6a(0x26e):case _0xbf9d6a(0x221):_0x2863a0=_0xbf9d6a(0x252);break;case _0xbf9d6a(0x237):case _0xbf9d6a(0x246):case _0xbf9d6a(0x236):case'created':default:_0x2863a0='PENDING';break;}let _0x472d3e,_0x125a93;if(_0x2c93ec['data'][_0xbf9d6a(0x24a)]){const _0x209dfd=_0x2c93ec['data'][_0xbf9d6a(0x24a)];console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x247),_0x209dfd);const _0x5a2337=_0x209dfd[_0xbf9d6a(0x23a)](/IBAN\s+([A-Z0-9]+)/i);_0x5a2337&&(_0x472d3e=_0x5a2337[0x1],console[_0xbf9d6a(0x20d)]('üè¶\x20Extracted\x20IBAN:',_0x472d3e)),_0x125a93=_0x209dfd;}const _0x56b3b0={'iban':_0x472d3e,'bankDetails':_0x125a93,'transactionId':_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x224)],'coinAddress':_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x262)],'qrCodeUrl':_0x2c93ec['data'][_0xbf9d6a(0x22f)],'expiryTime':_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x214)],'createdOn':_0x2c93ec['data']['CreatedOn'],'confirmedOn':_0x2c93ec[_0xbf9d6a(0x245)]['TransactionConfirmedOn']};console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x1f9)),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x22d),_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x227)],'->',_0x2863a0),console['log'](_0xbf9d6a(0x25e),_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x1fc)],_0x2c93ec[_0xbf9d6a(0x245)]['inputCurrency']),console[_0xbf9d6a(0x20d)]('Transaction\x20ID:',_0x2c93ec['data'][_0xbf9d6a(0x224)]),console[_0xbf9d6a(0x20d)]('IBAN:',_0x472d3e||_0xbf9d6a(0x241)),console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x276),_0x2c93ec['data'][_0xbf9d6a(0x21f)]),console['log']('Confirmed\x20On:',_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x200)]||_0xbf9d6a(0x20e));if(_0x2c93ec[_0xbf9d6a(0x245)]['Status']?.[_0xbf9d6a(0x24e)]()===_0xbf9d6a(0x246))console[_0xbf9d6a(0x20d)](_0xbf9d6a(0x1ff));else _0x2c93ec['data'][_0xbf9d6a(0x227)]?.[_0xbf9d6a(0x24e)]()===_0xbf9d6a(0x270)&&console[_0xbf9d6a(0x20d)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x2863a0,'amount':parseFloat(_0x2c93ec[_0xbf9d6a(0x245)][_0xbf9d6a(0x1fc)])||undefined,'currency':_0x2c93ec['data'][_0xbf9d6a(0x25b)]||_0xbf9d6a(0x256),'paymentDetails':_0x56b3b0};}catch(_0x44cee0){console[_0xbf9d6a(0x234)](_0xbf9d6a(0x23d),_0x44cee0),loggerService_1[_0xbf9d6a(0x202)][_0xbf9d6a(0x22b)]('cointopay',_0xbf9d6a(0x25a),_0x44cee0);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x44cee0 instanceof Error?_0x44cee0[_0xbf9d6a(0x242)]:_0xbf9d6a(0x20b)));}}async[a38_0x4b7803(0x259)](_0x57f007){const _0x3f7184=a38_0x4b7803,_0x1d5342=await this[_0x3f7184(0x217)](_0x57f007);return{'status':_0x1d5342[_0x3f7184(0x1fe)],'amount':_0x1d5342[_0x3f7184(0x1fb)],'currency':_0x1d5342['currency']};}async[a38_0x4b7803(0x240)](_0x304d79){const _0x589800=a38_0x4b7803;console[_0x589800(0x20d)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x304d79);let _0x33261d='PENDING';switch(_0x304d79[_0x589800(0x1fe)]?.[_0x589800(0x24e)]()){case _0x589800(0x270):_0x33261d=_0x589800(0x228);break;case'cancelled':case _0x589800(0x25f):case _0x589800(0x234):_0x33261d=_0x589800(0x253);break;case _0x589800(0x26e):case _0x589800(0x221):_0x33261d=_0x589800(0x252);break;case _0x589800(0x236):case'waiting':case'awaiting\x20fiat':case _0x589800(0x25d):default:_0x33261d=_0x589800(0x24d);break;}return{'paymentId':_0x304d79[_0x589800(0x204)]||_0x304d79['merchant_reference_id']||'','status':_0x33261d,'amount':_0x304d79['amount'],'currency':_0x304d79['currency']||_0x589800(0x256)};}}exports[a38_0x4b7803(0x215)]=CoinToPayService;