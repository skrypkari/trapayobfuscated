'use strict';function a65_0x1a61(_0x4bd12f,_0x28bb26){_0x4bd12f=_0x4bd12f-0x1f1;const _0x119f13=a65_0x119f();let _0x1a61c1=_0x119f13[_0x4bd12f];return _0x1a61c1;}const a65_0x36624c=a65_0x1a61;(function(_0x31b0b3,_0x242ed6){const _0x25f9c2=a65_0x1a61,_0x357f51=_0x31b0b3();while(!![]){try{const _0x19da16=-parseInt(_0x25f9c2(0x23a))/0x1+parseInt(_0x25f9c2(0x207))/0x2*(-parseInt(_0x25f9c2(0x23d))/0x3)+-parseInt(_0x25f9c2(0x24a))/0x4+-parseInt(_0x25f9c2(0x23c))/0x5*(-parseInt(_0x25f9c2(0x278))/0x6)+-parseInt(_0x25f9c2(0x264))/0x7*(parseInt(_0x25f9c2(0x212))/0x8)+parseInt(_0x25f9c2(0x26a))/0x9*(-parseInt(_0x25f9c2(0x24c))/0xa)+parseInt(_0x25f9c2(0x225))/0xb;if(_0x19da16===_0x242ed6)break;else _0x357f51['push'](_0x357f51['shift']());}catch(_0x4e8893){_0x357f51['push'](_0x357f51['shift']());}}}(a65_0x119f,0x92877));Object[a65_0x36624c(0x229)](exports,a65_0x36624c(0x24d),{'value':!![]}),exports[a65_0x36624c(0x262)]=void 0x0;function a65_0x119f(){const _0x398dd0=['POST','CoinToPay\x20API\x20error:\x20','Amount','not\x20found','paid','Business\x20Error:\x20','Currency:','created','stringify','3958640mWCtsl','stack','10hBTfpO','__esModule','match','not\x20confirmed','CoinToPay\x20payment\x20status\x20check\x20error:','timeout','entries','Gateway\x20Payment\x20ID:','QRCodeURL','PaymentDetail','statusUrl','data','now','cancelled','failed','logWhiteDomainResponse','parse','ExpiryTime','logWhiteDomainError','Created\x20On:','status_code','PAID','CoinToPayService','https://tesoft.uk/gateway/cointopay/','14NruxpX','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','statusText','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','HTTP\x20error!\x20status:\x20','inputCurrency','6548787UJHDFc','amount','error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','currency','EUR','Unknown\x20error\x20from\x20CoinToPay\x20API','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','/status','Status\x20Code:','TransactionConfirmedOn','Error\x20stack:','apiUrl','createPaymentLink','12DpOvaL','Parsed\x20Result:','message','Payment\x20URL\x20(original):','Amount:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','../loggerService','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PENDING','Raw\x20Response\x20Body:','/create','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20parse\x20JSON\x20response:','gateway_payment_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','Response\x20Body:','Headers:','CreatedOn','cointopay','awaiting\x20fiat','Incomplete\x20response:\x20missing\x20data','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','&alternative=false','Status\x20API\x20Error:\x20','Request\x20Body:','waiting','Response\x20Time:','129434zJTWXq','FAILED','\x20EUR','toLowerCase','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Status:','Unknown\x20error','Confirmed\x20On:','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','EXPIRED','expired','3260336JdBJJX','application/json','ðŸ¦\x20Extracted\x20IBAN:','headers','Status\x20Text:','checkPaymentStatus','HTTP\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','pending','ðŸ¦\x20Payment\x20Detail:','status','Error\x20message:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Payment\x20System/1.0','logWhiteDomainRequest','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','order_id','Response\x20data:','HTTP\x20Status:','52639741UEIPIp','processWebhook','payment_url','merchant_reference_id','defineProperty','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','log','===\x20COINTOPAY\x20SUCCESS\x20===','Status','Error\x20Message:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','URL:','result','JSON\x20Parse\x20Error:\x20','TransactionID','loggerService','success','Missing\x20data\x20in\x20response','verifyPayment',',\x20body:\x20','1078038HVTZwI','Payment\x20Status:','666245aojpKc','39DiOqZf','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Result:','CoinToPay\x20status\x20API\x20error:\x20'];a65_0x119f=function(){return _0x398dd0;};return a65_0x119f();}const loggerService_1=require(a65_0x36624c(0x1f1));class CoinToPayService{constructor(){const _0x4f7f28=a65_0x36624c;this[_0x4f7f28(0x276)]=_0x4f7f28(0x263),this[_0x4f7f28(0x256)]=_0x4f7f28(0x1f6),console['log']('ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x4f7f28(0x256)]);}async[a65_0x36624c(0x277)](_0x33a90d){const _0x565d40=a65_0x36624c,{orderId:_0x51cb2b,amount:_0x1b9c8d}=_0x33a90d;console[_0x565d40(0x22c)](_0x565d40(0x221)+_0x1b9c8d+_0x565d40(0x209));const _0x113c3c={'amount':_0x1b9c8d},_0x14c74f=Date[_0x565d40(0x258)]();try{console['log'](_0x565d40(0x23e)),console['log'](_0x565d40(0x231),this[_0x565d40(0x276)]),console['log'](_0x565d40(0x204),JSON['stringify'](_0x113c3c,null,0x2)),console[_0x565d40(0x22c)]('Amount:',_0x1b9c8d,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x565d40(0x1f5),_0x565d40(0x241),_0x113c3c);const _0x5b6fcd=await fetch(this['apiUrl'],{'method':_0x565d40(0x241),'headers':{'Content-Type':_0x565d40(0x213),'Accept':'application/json','User-Agent':_0x565d40(0x21f)},'body':JSON[_0x565d40(0x249)](_0x113c3c)}),_0x31ee5a=Date[_0x565d40(0x258)]()-_0x14c74f;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x565d40(0x22c)](_0x565d40(0x20c),_0x5b6fcd['status']),console[_0x565d40(0x22c)](_0x565d40(0x216),_0x5b6fcd[_0x565d40(0x266)]),console['log'](_0x565d40(0x1fc),Object['fromEntries'](_0x5b6fcd[_0x565d40(0x215)][_0x565d40(0x252)]())),console[_0x565d40(0x22c)](_0x565d40(0x206),_0x31ee5a+'ms');const _0x1cb8e8=await _0x5b6fcd[_0x565d40(0x1fa)]();console[_0x565d40(0x22c)](_0x565d40(0x1f4),_0x1cb8e8);if(!_0x5b6fcd['ok']){console[_0x565d40(0x26c)](_0x565d40(0x21e)),console[_0x565d40(0x26c)](_0x565d40(0x224),_0x5b6fcd[_0x565d40(0x21c)]),console[_0x565d40(0x26c)](_0x565d40(0x1fb),_0x1cb8e8),loggerService_1['loggerService'][_0x565d40(0x25b)](_0x565d40(0x1fe),'/create',_0x5b6fcd['status'],_0x1cb8e8,_0x31ee5a),loggerService_1[_0x565d40(0x235)]['logWhiteDomainError'](_0x565d40(0x1fe),_0x565d40(0x1f5),_0x565d40(0x218)+_0x5b6fcd[_0x565d40(0x21c)]+':\x20'+_0x1cb8e8);throw new Error(_0x565d40(0x268)+_0x5b6fcd[_0x565d40(0x21c)]+_0x565d40(0x239)+_0x1cb8e8);}let _0x104040;try{_0x104040=JSON[_0x565d40(0x25c)](_0x1cb8e8);}catch(_0x506725){console[_0x565d40(0x26c)](_0x565d40(0x1f7),_0x506725),loggerService_1[_0x565d40(0x235)][_0x565d40(0x25e)](_0x565d40(0x1fe),_0x565d40(0x1f5),_0x565d40(0x233)+_0x506725);throw new Error(_0x565d40(0x230)+_0x1cb8e8);}console[_0x565d40(0x22c)](_0x565d40(0x267)),console['log'](_0x565d40(0x279),JSON['stringify'](_0x104040,null,0x2)),loggerService_1[_0x565d40(0x235)]['logWhiteDomainResponse'](_0x565d40(0x1fe),'/create',_0x5b6fcd[_0x565d40(0x21c)],_0x104040,_0x31ee5a);if(_0x104040[_0x565d40(0x26c)]){const _0x4b46d6=_0x104040[_0x565d40(0x27a)]||_0x104040[_0x565d40(0x26c)]||_0x565d40(0x270);console[_0x565d40(0x26c)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x565d40(0x26c)](_0x565d40(0x22f),_0x4b46d6),loggerService_1[_0x565d40(0x235)][_0x565d40(0x25e)](_0x565d40(0x1fe),_0x565d40(0x1f5),_0x565d40(0x246)+_0x4b46d6);throw new Error(_0x565d40(0x242)+_0x4b46d6);}if(!_0x104040[_0x565d40(0x227)]||!_0x104040[_0x565d40(0x1f8)]){console[_0x565d40(0x26c)](_0x565d40(0x1f9)),console[_0x565d40(0x26c)](_0x565d40(0x26d)),console[_0x565d40(0x26c)](_0x565d40(0x223),_0x104040),loggerService_1['loggerService']['logWhiteDomainError'](_0x565d40(0x1fe),_0x565d40(0x1f5),_0x565d40(0x22a));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x565d40(0x22c)](_0x565d40(0x22d)),console['log'](_0x565d40(0x253),_0x104040[_0x565d40(0x1f8)]),console[_0x565d40(0x22c)](_0x565d40(0x27b),_0x104040[_0x565d40(0x227)]);const _0x1af54e=_0x104040[_0x565d40(0x227)]+_0x565d40(0x202);return console[_0x565d40(0x22c)]('Payment\x20URL\x20(modified):',_0x1af54e),console['log']('Amount:',_0x1b9c8d,_0x565d40(0x26f)),{'gateway_payment_id':_0x104040[_0x565d40(0x1f8)],'payment_url':_0x1af54e};}catch(_0x2c8c5b){console[_0x565d40(0x26c)](_0x565d40(0x20b)),console['error']('Error\x20details:',_0x2c8c5b),loggerService_1[_0x565d40(0x235)][_0x565d40(0x25e)]('cointopay',_0x565d40(0x1f5),_0x2c8c5b);if(_0x2c8c5b instanceof Error){console[_0x565d40(0x26c)](_0x565d40(0x21d),_0x2c8c5b[_0x565d40(0x27a)]),console['error'](_0x565d40(0x275),_0x2c8c5b[_0x565d40(0x24b)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2c8c5b['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a65_0x36624c(0x217)](_0x868e5c){const _0x13dca1=a65_0x36624c,_0xa467cd=Date[_0x13dca1(0x258)]();try{console[_0x13dca1(0x22c)](_0x13dca1(0x20f)+_0x868e5c);const _0x476b07={'gatewayPaymentId':_0x868e5c};loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x220)](_0x13dca1(0x1fe),_0x13dca1(0x272),_0x13dca1(0x241),_0x476b07);const _0x1a8df2=await fetch(this['statusUrl'],{'method':_0x13dca1(0x241),'headers':{'Content-Type':_0x13dca1(0x213),'Accept':'application/json','User-Agent':_0x13dca1(0x21f)},'body':JSON[_0x13dca1(0x249)](_0x476b07)}),_0x1b1f83=Date['now']()-_0xa467cd;console[_0x13dca1(0x22c)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x13dca1(0x22c)](_0x13dca1(0x20c),_0x1a8df2[_0x13dca1(0x21c)]),console[_0x13dca1(0x22c)](_0x13dca1(0x206),_0x1b1f83+'ms');if(!_0x1a8df2['ok']){const _0x180206=await _0x1a8df2[_0x13dca1(0x1fa)]();console[_0x13dca1(0x26c)](_0x13dca1(0x224),_0x1a8df2['status']),console[_0x13dca1(0x26c)](_0x13dca1(0x1fb),_0x180206),loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x25b)](_0x13dca1(0x1fe),_0x13dca1(0x272),_0x1a8df2[_0x13dca1(0x21c)],_0x180206,_0x1b1f83),loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x25e)](_0x13dca1(0x1fe),'/status',_0x13dca1(0x218)+_0x1a8df2[_0x13dca1(0x21c)]+':\x20'+_0x180206);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a8df2['status']);}const _0x193c81=await _0x1a8df2['text']();console[_0x13dca1(0x22c)](_0x13dca1(0x1f4),_0x193c81);let _0x39c2c8;try{_0x39c2c8=JSON[_0x13dca1(0x25c)](_0x193c81);}catch(_0x287edb){console[_0x13dca1(0x26c)](_0x13dca1(0x1f7),_0x287edb),loggerService_1[_0x13dca1(0x235)]['logWhiteDomainError'](_0x13dca1(0x1fe),_0x13dca1(0x272),_0x13dca1(0x233)+_0x287edb);throw new Error(_0x13dca1(0x271)+_0x193c81);}loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x25b)]('cointopay',_0x13dca1(0x272),_0x1a8df2[_0x13dca1(0x21c)],_0x39c2c8,_0x1b1f83),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x13dca1(0x23f),_0x39c2c8['result']),console[_0x13dca1(0x22c)](_0x13dca1(0x273),_0x39c2c8['status_code']),console['log'](_0x13dca1(0x23b),_0x39c2c8['data']?.[_0x13dca1(0x22e)]),console['log'](_0x13dca1(0x27c),_0x39c2c8[_0x13dca1(0x257)]?.[_0x13dca1(0x243)]),console[_0x13dca1(0x22c)](_0x13dca1(0x247),_0x39c2c8[_0x13dca1(0x257)]?.[_0x13dca1(0x269)]);if(_0x39c2c8[_0x13dca1(0x232)]!==_0x13dca1(0x236)||_0x39c2c8[_0x13dca1(0x260)]!==0xc8){const _0x2bf9a1=_0x39c2c8[_0x13dca1(0x27a)]||_0x13dca1(0x265);console[_0x13dca1(0x26c)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x13dca1(0x22f),_0x2bf9a1),loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x25e)](_0x13dca1(0x1fe),'/status',_0x13dca1(0x203)+_0x2bf9a1);throw new Error(_0x13dca1(0x240)+_0x2bf9a1);}if(!_0x39c2c8['data']){console[_0x13dca1(0x26c)](_0x13dca1(0x27d)),console[_0x13dca1(0x26c)](_0x13dca1(0x237)),loggerService_1[_0x13dca1(0x235)][_0x13dca1(0x25e)](_0x13dca1(0x1fe),_0x13dca1(0x272),_0x13dca1(0x200));throw new Error(_0x13dca1(0x219));}let _0x89d033=_0x13dca1(0x1f3);switch(_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x22e)]?.[_0x13dca1(0x20a)]()){case'paid':_0x89d033='PAID';break;case _0x13dca1(0x259):case _0x13dca1(0x25a):case _0x13dca1(0x26c):_0x89d033=_0x13dca1(0x208);break;case _0x13dca1(0x211):case _0x13dca1(0x251):_0x89d033=_0x13dca1(0x210);break;case _0x13dca1(0x205):case _0x13dca1(0x1ff):case _0x13dca1(0x21a):case _0x13dca1(0x248):default:_0x89d033=_0x13dca1(0x1f3);break;}let _0x25e5c0,_0x447e9b;if(_0x39c2c8['data'][_0x13dca1(0x255)]){const _0x5f262d=_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x255)];console['log'](_0x13dca1(0x21b),_0x5f262d);const _0x4278f7=_0x5f262d[_0x13dca1(0x24e)](/IBAN\s+([A-Z0-9]+)/i);_0x4278f7&&(_0x25e5c0=_0x4278f7[0x1],console[_0x13dca1(0x22c)](_0x13dca1(0x214),_0x25e5c0)),_0x447e9b=_0x5f262d;}const _0x41acae={'iban':_0x25e5c0,'bankDetails':_0x447e9b,'transactionId':_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x234)],'coinAddress':_0x39c2c8['data']['coinAddress'],'qrCodeUrl':_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x254)],'expiryTime':_0x39c2c8['data'][_0x13dca1(0x25d)],'createdOn':_0x39c2c8['data'][_0x13dca1(0x1fd)],'confirmedOn':_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x274)]};console[_0x13dca1(0x22c)](_0x13dca1(0x22b)),console[_0x13dca1(0x22c)](_0x13dca1(0x20c),_0x39c2c8['data'][_0x13dca1(0x22e)],'->',_0x89d033),console[_0x13dca1(0x22c)](_0x13dca1(0x27c),_0x39c2c8['data'][_0x13dca1(0x243)],_0x39c2c8[_0x13dca1(0x257)]['inputCurrency']),console['log']('Transaction\x20ID:',_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x234)]),console[_0x13dca1(0x22c)]('IBAN:',_0x25e5c0||_0x13dca1(0x244)),console['log'](_0x13dca1(0x25f),_0x39c2c8['data'][_0x13dca1(0x1fd)]),console[_0x13dca1(0x22c)](_0x13dca1(0x20e),_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x274)]||_0x13dca1(0x24f));if(_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x22e)]?.[_0x13dca1(0x20a)]()===_0x13dca1(0x1ff))console['log']('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x22e)]?.[_0x13dca1(0x20a)]()===_0x13dca1(0x245)&&console[_0x13dca1(0x22c)](_0x13dca1(0x201));return{'status':_0x89d033,'amount':parseFloat(_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x243)])||undefined,'currency':_0x39c2c8[_0x13dca1(0x257)][_0x13dca1(0x269)]||_0x13dca1(0x26f),'paymentDetails':_0x41acae};}catch(_0x1747e1){console[_0x13dca1(0x26c)](_0x13dca1(0x250),_0x1747e1),loggerService_1[_0x13dca1(0x235)]['logWhiteDomainError'](_0x13dca1(0x1fe),_0x13dca1(0x272),_0x1747e1);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1747e1 instanceof Error?_0x1747e1[_0x13dca1(0x27a)]:_0x13dca1(0x20d)));}}async[a65_0x36624c(0x238)](_0x1eaf8a){const _0x481dcb=a65_0x36624c,_0xee3d28=await this[_0x481dcb(0x217)](_0x1eaf8a);return{'status':_0xee3d28[_0x481dcb(0x21c)],'amount':_0xee3d28[_0x481dcb(0x26b)],'currency':_0xee3d28[_0x481dcb(0x26e)]};}async[a65_0x36624c(0x226)](_0x2d7239){const _0x3409f8=a65_0x36624c;console[_0x3409f8(0x22c)](_0x3409f8(0x1f2),_0x2d7239);let _0x2e5636=_0x3409f8(0x1f3);switch(_0x2d7239[_0x3409f8(0x21c)]?.[_0x3409f8(0x20a)]()){case _0x3409f8(0x245):_0x2e5636=_0x3409f8(0x261);break;case _0x3409f8(0x259):case _0x3409f8(0x25a):case _0x3409f8(0x26c):_0x2e5636=_0x3409f8(0x208);break;case _0x3409f8(0x211):case'timeout':_0x2e5636=_0x3409f8(0x210);break;case _0x3409f8(0x21a):case _0x3409f8(0x205):case _0x3409f8(0x1ff):case _0x3409f8(0x248):default:_0x2e5636=_0x3409f8(0x1f3);break;}return{'paymentId':_0x2d7239[_0x3409f8(0x222)]||_0x2d7239[_0x3409f8(0x228)]||'','status':_0x2e5636,'amount':_0x2d7239[_0x3409f8(0x26b)],'currency':_0x2d7239[_0x3409f8(0x26e)]||_0x3409f8(0x26f)};}}exports['CoinToPayService']=CoinToPayService;