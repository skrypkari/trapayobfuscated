'use strict';const a38_0x31034d=a38_0x3c24;(function(_0x3f7898,_0x360ac7){const _0x3a20a6=a38_0x3c24,_0xa89f1f=_0x3f7898();while(!![]){try{const _0x28fd5f=parseInt(_0x3a20a6(0x13f))/0x1+parseInt(_0x3a20a6(0x17f))/0x2+parseInt(_0x3a20a6(0x171))/0x3+-parseInt(_0x3a20a6(0x18e))/0x4+-parseInt(_0x3a20a6(0x151))/0x5*(-parseInt(_0x3a20a6(0x192))/0x6)+-parseInt(_0x3a20a6(0x184))/0x7*(parseInt(_0x3a20a6(0x131))/0x8)+-parseInt(_0x3a20a6(0x144))/0x9;if(_0x28fd5f===_0x360ac7)break;else _0xa89f1f['push'](_0xa89f1f['shift']());}catch(_0xf63d3b){_0xa89f1f['push'](_0xa89f1f['shift']());}}}(a38_0x527c,0x316e8));function a38_0x527c(){const _0x18cb34=['expired','toLowerCase','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','HTTP\x20error!\x20status:\x20','946500MHgUjp','===\x20COINTOPAY\x20SUCCESS\x20===','paid','FAILED','Status:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','message','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','created','Response\x20Time:','application/json','statusUrl','üè¶\x20Extracted\x20IBAN:','89934wypmLV',',\x20body:\x20','PAID','failed','Headers:','1988ybcWQr','status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/status','error','merchant_reference_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Amount','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','1584456jOjEux','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Parsed\x20Result:','Created\x20On:','168294qgCXZP','Status','log','TransactionID','Raw\x20Response\x20Body:','headers','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','now','success','data','ExpiryTime','currency','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','CreatedOn','statusText','pending','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20Status:','Transaction\x20ID:','not\x20found','Error\x20message:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Result:','timeout','Amount:','üè¶\x20Payment\x20Detail:','../loggerService','Status\x20Code:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','__esModule','Error\x20Message:','POST','entries','Response\x20data:','processWebhook','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','400TOxPWT','amount','üìä\x20Status\x20check\x20URL:','PENDING','Error\x20details:','https://tesoft.uk/gateway/cointopay/','logWhiteDomainRequest','/create','stringify','Gateway\x20Payment\x20ID:','URL:','cancelled','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Response\x20Body:','57407pALTBZ','defineProperty','logWhiteDomainError','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','IBAN:','1275084lZPQMU','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','TransactionConfirmedOn','EXPIRED','inputCurrency','CoinToPay\x20status\x20API\x20error:\x20','waiting','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','fromEntries','Request\x20Body:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','apiUrl','Unknown\x20error\x20from\x20CoinToPay\x20API','60rFYQYT','EUR','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cointopay','Payment\x20URL:','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','order_id','logWhiteDomainResponse','https://tesoft.uk/gateway/cointopay/status.php','PaymentDetail','text','status_code','stack','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','checkPaymentStatus','loggerService','match','coinAddress','TesSoft\x20Payment\x20System/1.0','gateway_payment_id','payment_url','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id'];a38_0x527c=function(){return _0x18cb34;};return a38_0x527c();}Object[a38_0x31034d(0x140)](exports,a38_0x31034d(0x129),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x31034d(0x1ad));class CoinToPayService{constructor(){const _0x1e6f3b=a38_0x31034d;this[_0x1e6f3b(0x14f)]=_0x1e6f3b(0x136),this[_0x1e6f3b(0x17d)]=_0x1e6f3b(0x15d),console[_0x1e6f3b(0x194)](_0x1e6f3b(0x14b)),console[_0x1e6f3b(0x194)](_0x1e6f3b(0x133),this[_0x1e6f3b(0x17d)]);}async['createPaymentLink'](_0x2bd427){const _0x4bdbfc=a38_0x31034d,{orderId:_0x228303,amount:_0xf659e9}=_0x2bd427;console['log'](_0x4bdbfc(0x178)+_0xf659e9+'\x20EUR');const _0x38bd50={'amount':_0xf659e9},_0x3b2359=Date[_0x4bdbfc(0x199)]();try{console['log'](_0x4bdbfc(0x128)),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x13b),this[_0x4bdbfc(0x14f)]),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x14d),JSON['stringify'](_0x38bd50,null,0x2)),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x1ab),_0xf659e9,_0x4bdbfc(0x16f)),loggerService_1[_0x4bdbfc(0x164)][_0x4bdbfc(0x137)](_0x4bdbfc(0x156),_0x4bdbfc(0x138),_0x4bdbfc(0x12b),_0x38bd50);const _0x1478d7=await fetch(this['apiUrl'],{'method':_0x4bdbfc(0x12b),'headers':{'Content-Type':'application/json','Accept':_0x4bdbfc(0x17c),'User-Agent':_0x4bdbfc(0x167)},'body':JSON[_0x4bdbfc(0x139)](_0x38bd50)}),_0xa8739b=Date[_0x4bdbfc(0x199)]()-_0x3b2359;console[_0x4bdbfc(0x194)](_0x4bdbfc(0x14e)),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x175),_0x1478d7[_0x4bdbfc(0x185)]),console[_0x4bdbfc(0x194)]('Status\x20Text:',_0x1478d7[_0x4bdbfc(0x1a1)]),console['log'](_0x4bdbfc(0x183),Object[_0x4bdbfc(0x14c)](_0x1478d7[_0x4bdbfc(0x197)][_0x4bdbfc(0x12c)]())),console['log'](_0x4bdbfc(0x17b),_0xa8739b+'ms');const _0x2a5a62=await _0x1478d7[_0x4bdbfc(0x15f)]();console[_0x4bdbfc(0x194)](_0x4bdbfc(0x196),_0x2a5a62);if(!_0x1478d7['ok']){console[_0x4bdbfc(0x188)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x1478d7[_0x4bdbfc(0x185)]),console[_0x4bdbfc(0x188)]('Response\x20Body:',_0x2a5a62),loggerService_1[_0x4bdbfc(0x164)][_0x4bdbfc(0x15c)](_0x4bdbfc(0x156),_0x4bdbfc(0x138),_0x1478d7[_0x4bdbfc(0x185)],_0x2a5a62,_0xa8739b),loggerService_1[_0x4bdbfc(0x164)][_0x4bdbfc(0x141)]('cointopay',_0x4bdbfc(0x138),'HTTP\x20'+_0x1478d7[_0x4bdbfc(0x185)]+':\x20'+_0x2a5a62);throw new Error(_0x4bdbfc(0x170)+_0x1478d7[_0x4bdbfc(0x185)]+_0x4bdbfc(0x180)+_0x2a5a62);}let _0x5c43e9;try{_0x5c43e9=JSON['parse'](_0x2a5a62);}catch(_0x1ba0a9){console[_0x4bdbfc(0x188)](_0x4bdbfc(0x1a3),_0x1ba0a9),loggerService_1[_0x4bdbfc(0x164)][_0x4bdbfc(0x141)](_0x4bdbfc(0x156),'/create',_0x4bdbfc(0x16a)+_0x1ba0a9);throw new Error(_0x4bdbfc(0x162)+_0x2a5a62);}console[_0x4bdbfc(0x194)](_0x4bdbfc(0x1a8)),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x190),JSON['stringify'](_0x5c43e9,null,0x2)),loggerService_1['loggerService'][_0x4bdbfc(0x15c)](_0x4bdbfc(0x156),'/create',_0x1478d7[_0x4bdbfc(0x185)],_0x5c43e9,_0xa8739b);if(_0x5c43e9[_0x4bdbfc(0x188)]){const _0x5c8dad=_0x5c43e9[_0x4bdbfc(0x177)]||_0x5c43e9[_0x4bdbfc(0x188)]||_0x4bdbfc(0x150);console[_0x4bdbfc(0x188)](_0x4bdbfc(0x176)),console[_0x4bdbfc(0x188)](_0x4bdbfc(0x12a),_0x5c8dad),loggerService_1[_0x4bdbfc(0x164)][_0x4bdbfc(0x141)](_0x4bdbfc(0x156),_0x4bdbfc(0x138),'Business\x20Error:\x20'+_0x5c8dad);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5c8dad);}if(!_0x5c43e9[_0x4bdbfc(0x169)]||!_0x5c43e9[_0x4bdbfc(0x168)]){console[_0x4bdbfc(0x188)](_0x4bdbfc(0x186)),console['error'](_0x4bdbfc(0x145)),console[_0x4bdbfc(0x188)](_0x4bdbfc(0x12d),_0x5c43e9),loggerService_1['loggerService'][_0x4bdbfc(0x141)](_0x4bdbfc(0x156),_0x4bdbfc(0x138),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4bdbfc(0x16c));}return console[_0x4bdbfc(0x194)](_0x4bdbfc(0x172)),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x13a),_0x5c43e9[_0x4bdbfc(0x168)]),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x157),_0x5c43e9[_0x4bdbfc(0x169)]),console[_0x4bdbfc(0x194)](_0x4bdbfc(0x1ab),_0xf659e9,_0x4bdbfc(0x152)),{'gateway_payment_id':_0x5c43e9[_0x4bdbfc(0x168)],'payment_url':_0x5c43e9['payment_url']};}catch(_0x2dd4b5){console[_0x4bdbfc(0x188)](_0x4bdbfc(0x16b)),console[_0x4bdbfc(0x188)](_0x4bdbfc(0x135),_0x2dd4b5),loggerService_1[_0x4bdbfc(0x164)]['logWhiteDomainError'](_0x4bdbfc(0x156),'/create',_0x2dd4b5);if(_0x2dd4b5 instanceof Error){console[_0x4bdbfc(0x188)](_0x4bdbfc(0x1a7),_0x2dd4b5['message']),console[_0x4bdbfc(0x188)](_0x4bdbfc(0x12f),_0x2dd4b5[_0x4bdbfc(0x161)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2dd4b5[_0x4bdbfc(0x177)]);}throw new Error(_0x4bdbfc(0x18d));}}async[a38_0x31034d(0x163)](_0x132caf){const _0x2588f7=a38_0x31034d,_0x2b7fb5=Date['now']();try{console[_0x2588f7(0x194)](_0x2588f7(0x15a)+_0x132caf);const _0x3e6ea8={'gatewayPaymentId':_0x132caf};loggerService_1['loggerService'][_0x2588f7(0x137)](_0x2588f7(0x156),_0x2588f7(0x187),_0x2588f7(0x12b),_0x3e6ea8);const _0x45c815=await fetch(this[_0x2588f7(0x17d)],{'method':_0x2588f7(0x12b),'headers':{'Content-Type':_0x2588f7(0x17c),'Accept':'application/json','User-Agent':_0x2588f7(0x167)},'body':JSON[_0x2588f7(0x139)](_0x3e6ea8)}),_0x114284=Date['now']()-_0x2b7fb5;console[_0x2588f7(0x194)](_0x2588f7(0x130)),console[_0x2588f7(0x194)]('Status:',_0x45c815[_0x2588f7(0x185)]),console['log']('Response\x20Time:',_0x114284+'ms');if(!_0x45c815['ok']){const _0x695b68=await _0x45c815[_0x2588f7(0x15f)]();console[_0x2588f7(0x188)]('HTTP\x20Status:',_0x45c815[_0x2588f7(0x185)]),console[_0x2588f7(0x188)](_0x2588f7(0x13e),_0x695b68),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2588f7(0x156),'/status',_0x45c815[_0x2588f7(0x185)],_0x695b68,_0x114284),loggerService_1['loggerService'][_0x2588f7(0x141)](_0x2588f7(0x156),_0x2588f7(0x187),'HTTP\x20'+_0x45c815[_0x2588f7(0x185)]+':\x20'+_0x695b68);throw new Error(_0x2588f7(0x170)+_0x45c815[_0x2588f7(0x185)]);}const _0x59ec19=await _0x45c815['text']();console[_0x2588f7(0x194)](_0x2588f7(0x196),_0x59ec19);let _0x2a527c;try{_0x2a527c=JSON['parse'](_0x59ec19);}catch(_0x468c27){console[_0x2588f7(0x188)](_0x2588f7(0x1a3),_0x468c27),loggerService_1[_0x2588f7(0x164)][_0x2588f7(0x141)](_0x2588f7(0x156),_0x2588f7(0x187),'JSON\x20Parse\x20Error:\x20'+_0x468c27);throw new Error(_0x2588f7(0x155)+_0x59ec19);}loggerService_1[_0x2588f7(0x164)][_0x2588f7(0x15c)](_0x2588f7(0x156),_0x2588f7(0x187),_0x45c815[_0x2588f7(0x185)],_0x2a527c,_0x114284),console[_0x2588f7(0x194)](_0x2588f7(0x13d)),console[_0x2588f7(0x194)](_0x2588f7(0x1a9),_0x2a527c['result']),console['log'](_0x2588f7(0x127),_0x2a527c[_0x2588f7(0x160)]),console[_0x2588f7(0x194)](_0x2588f7(0x1a4),_0x2a527c[_0x2588f7(0x19b)]?.['Status']),console['log']('Amount:',_0x2a527c[_0x2588f7(0x19b)]?.[_0x2588f7(0x18b)]),console[_0x2588f7(0x194)]('Currency:',_0x2a527c[_0x2588f7(0x19b)]?.[_0x2588f7(0x148)]);if(_0x2a527c['result']!==_0x2588f7(0x19a)||_0x2a527c['status_code']!==0xc8){const _0xe340fa=_0x2a527c[_0x2588f7(0x177)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x2588f7(0x154)),console[_0x2588f7(0x188)]('Error\x20Message:',_0xe340fa),loggerService_1[_0x2588f7(0x164)]['logWhiteDomainError'](_0x2588f7(0x156),'/status',_0x2588f7(0x158)+_0xe340fa);throw new Error(_0x2588f7(0x149)+_0xe340fa);}if(!_0x2a527c[_0x2588f7(0x19b)]){console['error'](_0x2588f7(0x19e)),console[_0x2588f7(0x188)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x2588f7(0x164)][_0x2588f7(0x141)](_0x2588f7(0x156),'/status',_0x2588f7(0x159));throw new Error(_0x2588f7(0x153));}let _0x2935f2=_0x2588f7(0x134);switch(_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x193)]?.['toLowerCase']()){case'paid':_0x2935f2=_0x2588f7(0x181);break;case _0x2588f7(0x13c):case _0x2588f7(0x182):case _0x2588f7(0x188):_0x2935f2=_0x2588f7(0x174);break;case _0x2588f7(0x16d):case _0x2588f7(0x1aa):_0x2935f2=_0x2588f7(0x147);break;case'waiting':case _0x2588f7(0x19f):case _0x2588f7(0x1a2):case _0x2588f7(0x17a):default:_0x2935f2=_0x2588f7(0x134);break;}let _0xce4c71,_0x4aa7e3;if(_0x2a527c[_0x2588f7(0x19b)]['PaymentDetail']){const _0x5f4661=_0x2a527c['data'][_0x2588f7(0x15e)];console[_0x2588f7(0x194)](_0x2588f7(0x1ac),_0x5f4661);const _0x4fec27=_0x5f4661[_0x2588f7(0x165)](/IBAN\s+([A-Z0-9]+)/i);_0x4fec27&&(_0xce4c71=_0x4fec27[0x1],console[_0x2588f7(0x194)](_0x2588f7(0x17e),_0xce4c71)),_0x4aa7e3=_0x5f4661;}const _0x5e2d9e={'iban':_0xce4c71,'bankDetails':_0x4aa7e3,'transactionId':_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x195)],'coinAddress':_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x166)],'qrCodeUrl':_0x2a527c[_0x2588f7(0x19b)]['QRCodeURL'],'expiryTime':_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x19c)],'createdOn':_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x1a0)],'confirmedOn':_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x146)]};console[_0x2588f7(0x194)](_0x2588f7(0x198)),console[_0x2588f7(0x194)](_0x2588f7(0x175),_0x2a527c[_0x2588f7(0x19b)]['Status'],'->',_0x2935f2),console['log'](_0x2588f7(0x1ab),_0x2a527c['data'][_0x2588f7(0x18b)],_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x148)]),console[_0x2588f7(0x194)](_0x2588f7(0x1a5),_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x195)]),console['log'](_0x2588f7(0x143),_0xce4c71||_0x2588f7(0x1a6)),console[_0x2588f7(0x194)](_0x2588f7(0x191),_0x2a527c[_0x2588f7(0x19b)]['CreatedOn']),console[_0x2588f7(0x194)]('Confirmed\x20On:',_0x2a527c[_0x2588f7(0x19b)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x193)]?.[_0x2588f7(0x16e)]()===_0x2588f7(0x19f))console[_0x2588f7(0x194)](_0x2588f7(0x179));else _0x2a527c[_0x2588f7(0x19b)]['Status']?.[_0x2588f7(0x16e)]()===_0x2588f7(0x173)&&console[_0x2588f7(0x194)](_0x2588f7(0x18a));return{'status':_0x2935f2,'amount':parseFloat(_0x2a527c[_0x2588f7(0x19b)][_0x2588f7(0x18b)])||undefined,'currency':_0x2a527c[_0x2588f7(0x19b)]['inputCurrency']||'EUR','paymentDetails':_0x5e2d9e};}catch(_0x3e6e08){console[_0x2588f7(0x188)](_0x2588f7(0x18c),_0x3e6e08),loggerService_1[_0x2588f7(0x164)]['logWhiteDomainError'](_0x2588f7(0x156),_0x2588f7(0x187),_0x3e6e08);throw new Error(_0x2588f7(0x18f)+(_0x3e6e08 instanceof Error?_0x3e6e08[_0x2588f7(0x177)]:'Unknown\x20error'));}}async['verifyPayment'](_0x322985){const _0x178f39=a38_0x31034d,_0xc96a22=await this[_0x178f39(0x163)](_0x322985);return{'status':_0xc96a22[_0x178f39(0x185)],'amount':_0xc96a22[_0x178f39(0x132)],'currency':_0xc96a22[_0x178f39(0x19d)]};}async[a38_0x31034d(0x12e)](_0x1b4f38){const _0x2e82cb=a38_0x31034d;console[_0x2e82cb(0x194)](_0x2e82cb(0x142),_0x1b4f38);let _0x4ce808='PENDING';switch(_0x1b4f38[_0x2e82cb(0x185)]?.['toLowerCase']()){case'paid':_0x4ce808='PAID';break;case _0x2e82cb(0x13c):case _0x2e82cb(0x182):case _0x2e82cb(0x188):_0x4ce808='FAILED';break;case'expired':case _0x2e82cb(0x1aa):_0x4ce808='EXPIRED';break;case _0x2e82cb(0x1a2):case _0x2e82cb(0x14a):case'awaiting\x20fiat':case _0x2e82cb(0x17a):default:_0x4ce808=_0x2e82cb(0x134);break;}return{'paymentId':_0x1b4f38[_0x2e82cb(0x15b)]||_0x1b4f38[_0x2e82cb(0x189)]||'','status':_0x4ce808,'amount':_0x1b4f38[_0x2e82cb(0x132)],'currency':_0x1b4f38['currency']||_0x2e82cb(0x152)};}}function a38_0x3c24(_0x5f303a,_0xcd1dfc){const _0x527c08=a38_0x527c();return a38_0x3c24=function(_0x3c2446,_0x561e3f){_0x3c2446=_0x3c2446-0x127;let _0x17cf87=_0x527c08[_0x3c2446];return _0x17cf87;},a38_0x3c24(_0x5f303a,_0xcd1dfc);}exports['CoinToPayService']=CoinToPayService;