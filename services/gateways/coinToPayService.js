'use strict';const a38_0x4a9866=a38_0xa117;(function(_0x229a65,_0x15e876){const _0x44366c=a38_0xa117,_0x21cc1b=_0x229a65();while(!![]){try{const _0x453645=parseInt(_0x44366c(0x24d))/0x1*(-parseInt(_0x44366c(0x22f))/0x2)+parseInt(_0x44366c(0x202))/0x3+parseInt(_0x44366c(0x214))/0x4*(parseInt(_0x44366c(0x20a))/0x5)+parseInt(_0x44366c(0x1f0))/0x6*(parseInt(_0x44366c(0x201))/0x7)+-parseInt(_0x44366c(0x206))/0x8+parseInt(_0x44366c(0x1cb))/0x9*(-parseInt(_0x44366c(0x246))/0xa)+-parseInt(_0x44366c(0x245))/0xb*(-parseInt(_0x44366c(0x1fd))/0xc);if(_0x453645===_0x15e876)break;else _0x21cc1b['push'](_0x21cc1b['shift']());}catch(_0xdf8e8b){_0x21cc1b['push'](_0x21cc1b['shift']());}}}(a38_0x49a8,0xb38c5));function a38_0x49a8(){const _0x5a71e6=['Unknown\x20error','defineProperty','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Business\x20Error:\x20','474172TJSMms','POST','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','https://tesoft.uk/gateway/cointopay/status.php','CoinToPay\x20API\x20error:\x20','coinAddress','Transaction\x20ID:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','text','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','order_id','cointopay','URL:','status','createPaymentLink','/create','Amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainRequest','headers','QRCodeURL','44IvOypD','914170yeVwHT','CoinToPayService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Payment\x20URL:','EUR','TransactionID','fromEntries','5IyZRQI','HTTP\x20Status:','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','üè¶\x20Payment\x20Detail:','failed','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','63jCnCEv','processWebhook','now','error','Payment\x20Status:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','application/json','TransactionConfirmedOn','Request\x20Body:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20Code:','FAILED','paid','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status\x20Text:','ExpiryTime','loggerService','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','match','amount','Created\x20On:','Raw\x20Response\x20Body:',',\x20body:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','statusUrl','Error\x20message:','Missing\x20data\x20in\x20response','TesSoft\x20Payment\x20System/1.0','PAID','log','3267918OelSkr','payment_url','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','status_code','gateway_payment_id','Status','Confirmed\x20On:','logWhiteDomainError','Amount:','HTTP\x20error!\x20status:\x20','inputCurrency','Response\x20Body:','stack','3450012TcAWJm','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Currency:','currency','14aNgdsK','2177088WaVvkw','stringify','cancelled','result','10195592uxMIBw','PENDING','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','timeout','5wKddtg','Incomplete\x20response:\x20missing\x20data','parse','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','checkPaymentStatus','Parsed\x20Result:','apiUrl','CreatedOn','PaymentDetail','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','3480884QLicCy','pending','logWhiteDomainResponse','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20Message:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','success','entries','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20data:','Response\x20Time:','message','toLowerCase','not\x20confirmed','\x20EUR','CoinToPay\x20payment\x20status\x20check\x20error:','data','expired','awaiting\x20fiat','created','not\x20found','Result:'];a38_0x49a8=function(){return _0x5a71e6;};return a38_0x49a8();}function a38_0xa117(_0x5124dd,_0x22a52d){const _0x49a8a2=a38_0x49a8();return a38_0xa117=function(_0xa11788,_0x3f19b9){_0xa11788=_0xa11788-0x1c5;let _0x143fe6=_0x49a8a2[_0xa11788];return _0x143fe6;},a38_0xa117(_0x5124dd,_0x22a52d);}Object[a38_0x4a9866(0x22c)](exports,'__esModule',{'value':!![]}),exports[a38_0x4a9866(0x247)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x5dc725=a38_0x4a9866;this[_0x5dc725(0x210)]='https://tesoft.uk/gateway/cointopay/',this[_0x5dc725(0x1ea)]=_0x5dc725(0x232),console[_0x5dc725(0x1ef)](_0x5dc725(0x1d4)),console[_0x5dc725(0x1ef)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async[a38_0x4a9866(0x23e)](_0x15a74a){const _0x138b12=a38_0x4a9866,{orderId:_0xe263b8,amount:_0x361943}=_0x15a74a;console['log'](_0x138b12(0x22d)+_0x361943+_0x138b12(0x223));const _0x2e343a={'amount':_0x361943},_0xa4bdfb=Date[_0x138b12(0x1cd)]();try{console[_0x138b12(0x1ef)](_0x138b12(0x217)),console['log'](_0x138b12(0x23c),this[_0x138b12(0x210)]),console[_0x138b12(0x1ef)](_0x138b12(0x1d3),JSON[_0x138b12(0x203)](_0x2e343a,null,0x2)),console['log'](_0x138b12(0x1f8),_0x361943,_0x138b12(0x1fe)),loggerService_1[_0x138b12(0x1e1)][_0x138b12(0x242)]('cointopay',_0x138b12(0x23f),_0x138b12(0x230),_0x2e343a);const _0x3c5441=await fetch(this[_0x138b12(0x210)],{'method':_0x138b12(0x230),'headers':{'Content-Type':'application/json','Accept':_0x138b12(0x1d1),'User-Agent':_0x138b12(0x1ed)},'body':JSON['stringify'](_0x2e343a)}),_0x6484d0=Date['now']()-_0xa4bdfb;console[_0x138b12(0x1ef)](_0x138b12(0x213)),console[_0x138b12(0x1ef)]('Status:',_0x3c5441['status']),console[_0x138b12(0x1ef)](_0x138b12(0x1df),_0x3c5441['statusText']),console[_0x138b12(0x1ef)]('Headers:',Object[_0x138b12(0x24c)](_0x3c5441[_0x138b12(0x243)][_0x138b12(0x21b)]())),console[_0x138b12(0x1ef)](_0x138b12(0x21f),_0x6484d0+'ms');const _0xcbec9b=await _0x3c5441['text']();console[_0x138b12(0x1ef)](_0x138b12(0x1e6),_0xcbec9b);if(!_0x3c5441['ok']){console[_0x138b12(0x1ce)](_0x138b12(0x1de)),console[_0x138b12(0x1ce)](_0x138b12(0x24e),_0x3c5441[_0x138b12(0x23d)]),console[_0x138b12(0x1ce)](_0x138b12(0x1fb),_0xcbec9b),loggerService_1['loggerService'][_0x138b12(0x216)](_0x138b12(0x23b),_0x138b12(0x23f),_0x3c5441['status'],_0xcbec9b,_0x6484d0),loggerService_1['loggerService'][_0x138b12(0x1f7)](_0x138b12(0x23b),_0x138b12(0x23f),_0x138b12(0x1d5)+_0x3c5441[_0x138b12(0x23d)]+':\x20'+_0xcbec9b);throw new Error(_0x138b12(0x1f9)+_0x3c5441[_0x138b12(0x23d)]+_0x138b12(0x1e7)+_0xcbec9b);}let _0x2dc41a;try{_0x2dc41a=JSON[_0x138b12(0x20c)](_0xcbec9b);}catch(_0x1dbf60){console['error'](_0x138b12(0x21c),_0x1dbf60),loggerService_1[_0x138b12(0x1e1)][_0x138b12(0x1f7)](_0x138b12(0x23b),_0x138b12(0x23f),_0x138b12(0x1e9)+_0x1dbf60);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0xcbec9b);}console[_0x138b12(0x1ef)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x138b12(0x20f),JSON[_0x138b12(0x203)](_0x2dc41a,null,0x2)),loggerService_1['loggerService'][_0x138b12(0x216)](_0x138b12(0x23b),_0x138b12(0x23f),_0x3c5441[_0x138b12(0x23d)],_0x2dc41a,_0x6484d0);if(_0x2dc41a['error']){const _0x473c96=_0x2dc41a[_0x138b12(0x220)]||_0x2dc41a[_0x138b12(0x1ce)]||_0x138b12(0x24f);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x138b12(0x1ce)](_0x138b12(0x218),_0x473c96),loggerService_1[_0x138b12(0x1e1)][_0x138b12(0x1f7)](_0x138b12(0x23b),'/create',_0x138b12(0x22e)+_0x473c96);throw new Error(_0x138b12(0x233)+_0x473c96);}if(!_0x2dc41a[_0x138b12(0x1f1)]||!_0x2dc41a[_0x138b12(0x1f4)]){console['error'](_0x138b12(0x1d6)),console[_0x138b12(0x1ce)](_0x138b12(0x241)),console['error'](_0x138b12(0x21e),_0x2dc41a),loggerService_1[_0x138b12(0x1e1)]['logWhiteDomainError'](_0x138b12(0x23b),_0x138b12(0x23f),_0x138b12(0x1ca));throw new Error(_0x138b12(0x1d8));}return console[_0x138b12(0x1ef)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x138b12(0x1ef)]('Gateway\x20Payment\x20ID:',_0x2dc41a['gateway_payment_id']),console[_0x138b12(0x1ef)](_0x138b12(0x249),_0x2dc41a[_0x138b12(0x1f1)]),console[_0x138b12(0x1ef)](_0x138b12(0x1f8),_0x361943,'EUR'),{'gateway_payment_id':_0x2dc41a[_0x138b12(0x1f4)],'payment_url':_0x2dc41a['payment_url']};}catch(_0x15ce28){console[_0x138b12(0x1ce)](_0x138b12(0x237)),console[_0x138b12(0x1ce)]('Error\x20details:',_0x15ce28),loggerService_1[_0x138b12(0x1e1)][_0x138b12(0x1f7)](_0x138b12(0x23b),_0x138b12(0x23f),_0x15ce28);if(_0x15ce28 instanceof Error){console[_0x138b12(0x1ce)](_0x138b12(0x1eb),_0x15ce28[_0x138b12(0x220)]),console[_0x138b12(0x1ce)]('Error\x20stack:',_0x15ce28[_0x138b12(0x1fc)]);throw new Error(_0x138b12(0x248)+_0x15ce28[_0x138b12(0x220)]);}throw new Error(_0x138b12(0x21d));}}async[a38_0x4a9866(0x20e)](_0xa67821){const _0x5305b7=a38_0x4a9866,_0x4f8981=Date[_0x5305b7(0x1cd)]();try{console['log'](_0x5305b7(0x1e2)+_0xa67821);const _0x463352={'gatewayPaymentId':_0xa67821};loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x242)](_0x5305b7(0x23b),_0x5305b7(0x1c5),'POST',_0x463352);const _0x10c0ac=await fetch(this[_0x5305b7(0x1ea)],{'method':_0x5305b7(0x230),'headers':{'Content-Type':_0x5305b7(0x1d1),'Accept':_0x5305b7(0x1d1),'User-Agent':_0x5305b7(0x1ed)},'body':JSON[_0x5305b7(0x203)](_0x463352)}),_0x1f3793=Date['now']()-_0x4f8981;console[_0x5305b7(0x1ef)](_0x5305b7(0x219)),console[_0x5305b7(0x1ef)](_0x5305b7(0x1d7),_0x10c0ac[_0x5305b7(0x23d)]),console[_0x5305b7(0x1ef)](_0x5305b7(0x21f),_0x1f3793+'ms');if(!_0x10c0ac['ok']){const _0x24d00f=await _0x10c0ac[_0x5305b7(0x238)]();console['error'](_0x5305b7(0x24e),_0x10c0ac[_0x5305b7(0x23d)]),console[_0x5305b7(0x1ce)]('Response\x20Body:',_0x24d00f),loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x216)](_0x5305b7(0x23b),_0x5305b7(0x1c5),_0x10c0ac[_0x5305b7(0x23d)],_0x24d00f,_0x1f3793),loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x1f7)](_0x5305b7(0x23b),_0x5305b7(0x1c5),_0x5305b7(0x1d5)+_0x10c0ac[_0x5305b7(0x23d)]+':\x20'+_0x24d00f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x10c0ac['status']);}const _0x3d2a1f=await _0x10c0ac[_0x5305b7(0x238)]();console['log']('Raw\x20Response\x20Body:',_0x3d2a1f);let _0x29a342;try{_0x29a342=JSON[_0x5305b7(0x20c)](_0x3d2a1f);}catch(_0x24aca0){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x24aca0),loggerService_1['loggerService'][_0x5305b7(0x1f7)](_0x5305b7(0x23b),'/status',_0x5305b7(0x1e9)+_0x24aca0);throw new Error(_0x5305b7(0x239)+_0x3d2a1f);}loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x216)](_0x5305b7(0x23b),_0x5305b7(0x1c5),_0x10c0ac[_0x5305b7(0x23d)],_0x29a342,_0x1f3793),console[_0x5305b7(0x1ef)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x5305b7(0x1ef)](_0x5305b7(0x22a),_0x29a342[_0x5305b7(0x205)]),console[_0x5305b7(0x1ef)](_0x5305b7(0x1da),_0x29a342[_0x5305b7(0x1f3)]),console['log'](_0x5305b7(0x1cf),_0x29a342[_0x5305b7(0x225)]?.[_0x5305b7(0x1f5)]),console[_0x5305b7(0x1ef)]('Amount:',_0x29a342['data']?.[_0x5305b7(0x240)]),console['log'](_0x5305b7(0x1ff),_0x29a342[_0x5305b7(0x225)]?.[_0x5305b7(0x1fa)]);if(_0x29a342[_0x5305b7(0x205)]!==_0x5305b7(0x21a)||_0x29a342[_0x5305b7(0x1f3)]!==0xc8){const _0x54a4ea=_0x29a342[_0x5305b7(0x220)]||_0x5305b7(0x20d);console['error'](_0x5305b7(0x1e8)),console[_0x5305b7(0x1ce)](_0x5305b7(0x218),_0x54a4ea),loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x1f7)]('cointopay',_0x5305b7(0x1c5),'Status\x20API\x20Error:\x20'+_0x54a4ea);throw new Error(_0x5305b7(0x1dd)+_0x54a4ea);}if(!_0x29a342['data']){console[_0x5305b7(0x1ce)](_0x5305b7(0x1c9)),console[_0x5305b7(0x1ce)](_0x5305b7(0x1ec)),loggerService_1[_0x5305b7(0x1e1)]['logWhiteDomainError']('cointopay',_0x5305b7(0x1c5),_0x5305b7(0x20b));throw new Error(_0x5305b7(0x231));}let _0x544fc3=_0x5305b7(0x207);switch(_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1f5)]?.[_0x5305b7(0x221)]()){case _0x5305b7(0x1dc):_0x544fc3=_0x5305b7(0x1ee);break;case'cancelled':case'failed':case'error':_0x544fc3=_0x5305b7(0x1db);break;case'expired':case _0x5305b7(0x209):_0x544fc3='EXPIRED';break;case'waiting':case _0x5305b7(0x227):case _0x5305b7(0x215):case _0x5305b7(0x228):default:_0x544fc3=_0x5305b7(0x207);break;}let _0x5cd837,_0x40d19b;if(_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x212)]){const _0x1e3d87=_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x212)];console[_0x5305b7(0x1ef)](_0x5305b7(0x1c6),_0x1e3d87);const _0x17e37b=_0x1e3d87[_0x5305b7(0x1e3)](/IBAN\s+([A-Z0-9]+)/i);_0x17e37b&&(_0x5cd837=_0x17e37b[0x1],console[_0x5305b7(0x1ef)](_0x5305b7(0x1c8),_0x5cd837)),_0x40d19b=_0x1e3d87;}const _0x41fc2b={'iban':_0x5cd837,'bankDetails':_0x40d19b,'transactionId':_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x24b)],'coinAddress':_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x234)],'qrCodeUrl':_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x244)],'expiryTime':_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1e0)],'createdOn':_0x29a342[_0x5305b7(0x225)]['CreatedOn'],'confirmedOn':_0x29a342['data'][_0x5305b7(0x1d2)]};console[_0x5305b7(0x1ef)](_0x5305b7(0x236)),console[_0x5305b7(0x1ef)](_0x5305b7(0x1d7),_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1f5)],'->',_0x544fc3),console[_0x5305b7(0x1ef)](_0x5305b7(0x1f8),_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x240)],_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1fa)]),console[_0x5305b7(0x1ef)](_0x5305b7(0x235),_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x24b)]),console[_0x5305b7(0x1ef)]('IBAN:',_0x5cd837||_0x5305b7(0x229)),console[_0x5305b7(0x1ef)](_0x5305b7(0x1e5),_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x211)]),console['log'](_0x5305b7(0x1f6),_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1d2)]||_0x5305b7(0x222));if(_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1f5)]?.[_0x5305b7(0x221)]()==='awaiting\x20fiat')console[_0x5305b7(0x1ef)](_0x5305b7(0x1f2));else _0x29a342[_0x5305b7(0x225)]['Status']?.[_0x5305b7(0x221)]()===_0x5305b7(0x1dc)&&console['log'](_0x5305b7(0x208));return{'status':_0x544fc3,'amount':parseFloat(_0x29a342['data']['Amount'])||undefined,'currency':_0x29a342[_0x5305b7(0x225)][_0x5305b7(0x1fa)]||_0x5305b7(0x24a),'paymentDetails':_0x41fc2b};}catch(_0x1ed51d){console[_0x5305b7(0x1ce)](_0x5305b7(0x224),_0x1ed51d),loggerService_1[_0x5305b7(0x1e1)][_0x5305b7(0x1f7)]('cointopay',_0x5305b7(0x1c5),_0x1ed51d);throw new Error(_0x5305b7(0x1d0)+(_0x1ed51d instanceof Error?_0x1ed51d[_0x5305b7(0x220)]:_0x5305b7(0x22b)));}}async['verifyPayment'](_0x3a557c){const _0x24576e=a38_0x4a9866,_0x238a9e=await this[_0x24576e(0x20e)](_0x3a557c);return{'status':_0x238a9e['status'],'amount':_0x238a9e['amount'],'currency':_0x238a9e[_0x24576e(0x200)]};}async[a38_0x4a9866(0x1cc)](_0x54699e){const _0x482301=a38_0x4a9866;console[_0x482301(0x1ef)](_0x482301(0x1d9),_0x54699e);let _0x20ca98=_0x482301(0x207);switch(_0x54699e[_0x482301(0x23d)]?.['toLowerCase']()){case _0x482301(0x1dc):_0x20ca98=_0x482301(0x1ee);break;case _0x482301(0x204):case _0x482301(0x1c7):case _0x482301(0x1ce):_0x20ca98=_0x482301(0x1db);break;case _0x482301(0x226):case _0x482301(0x209):_0x20ca98='EXPIRED';break;case _0x482301(0x215):case'waiting':case _0x482301(0x227):case _0x482301(0x228):default:_0x20ca98=_0x482301(0x207);break;}return{'paymentId':_0x54699e[_0x482301(0x23a)]||_0x54699e['merchant_reference_id']||'','status':_0x20ca98,'amount':_0x54699e[_0x482301(0x1e4)],'currency':_0x54699e[_0x482301(0x200)]||_0x482301(0x24a)};}}exports['CoinToPayService']=CoinToPayService;