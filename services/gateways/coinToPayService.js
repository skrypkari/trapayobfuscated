'use strict';const a65_0x3d2453=a65_0x30b7;function a65_0x49c2(){const _0x343490=['loggerService','/status','text','HTTP\x20Status:','Error\x20stack:','logWhiteDomainRequest','1285839YhgizX','Failed\x20to\x20parse\x20JSON\x20response:','10iZJaRP','status_code','Status','created','logWhiteDomainError','log','error','failed','21065PQinOn','&alternative=false','__esModule','Amount:','https://tesoft.uk/gateway/cointopay/status.php','coinAddress','2787279PazKJO','EXPIRED','processWebhook','entries','Unknown\x20error\x20from\x20CoinToPay\x20API','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPayService','POST','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','awaiting\x20fiat','fromEntries','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','not\x20found','../loggerService','Created\x20On:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ðŸ“Š\x20Status\x20check\x20URL:','Incomplete\x20response:\x20missing\x20data','Status\x20Text:','Error\x20details:','pending','parse','7MjQPtG','Amount','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Status\x20API\x20Error:\x20','PaymentDetail','26740QdzwIl','ðŸ¦\x20Payment\x20Detail:','/create','HTTP\x20',',\x20body:\x20','status','payment_url','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','Gateway\x20Payment\x20ID:','137544aAojFe','Currency:','Response\x20Body:','IBAN:','order_id','Confirmed\x20On:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Transaction\x20ID:','PENDING','currency','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','QRCodeURL','now','ðŸ¦\x20Extracted\x20IBAN:','PAID','cancelled','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','defineProperty','FAILED','apiUrl','data','gateway_payment_id','578076iQTrcR','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20URL\x20(original):','Payment\x20URL\x20(modified):','Payment\x20System/1.0','TransactionID','message','Status:','Parsed\x20Result:','Error\x20Message:','CoinToPay\x20payment\x20status\x20check\x20error:','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','5htGHsT','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','paid','checkPaymentStatus','logWhiteDomainResponse','verifyPayment','CoinToPay\x20API\x20error:\x20','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','waiting','2430440yBlVdW','Raw\x20Response\x20Body:','cointopay','expired','inputCurrency','toLowerCase','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','stringify','2XHMySa','createPaymentLink','Response\x20Time:','URL:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Business\x20Error:\x20','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','result','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','statusUrl','match','CreatedOn','JSON\x20Parse\x20Error:\x20','EUR','HTTP\x20error!\x20status:\x20','stack','ExpiryTime','application/json'];a65_0x49c2=function(){return _0x343490;};return a65_0x49c2();}function a65_0x30b7(_0x1acbc6,_0x515545){_0x1acbc6=_0x1acbc6-0x10b;const _0x49c227=a65_0x49c2();let _0x30b745=_0x49c227[_0x1acbc6];return _0x30b745;}(function(_0x2d06ff,_0x423bb3){const _0xa20d7b=a65_0x30b7,_0x412140=_0x2d06ff();while(!![]){try{const _0xd4db39=parseInt(_0xa20d7b(0x12e))/0x1+parseInt(_0xa20d7b(0x18d))/0x2*(parseInt(_0xa20d7b(0x158))/0x3)+-parseInt(_0xa20d7b(0x14f))/0x4*(-parseInt(_0xa20d7b(0x17c))/0x5)+-parseInt(_0xa20d7b(0x16e))/0x6+-parseInt(_0xa20d7b(0x14a))/0x7*(-parseInt(_0xa20d7b(0x185))/0x8)+parseInt(_0xa20d7b(0x124))/0x9*(parseInt(_0xa20d7b(0x126))/0xa)+-parseInt(_0xa20d7b(0x134))/0xb;if(_0xd4db39===_0x423bb3)break;else _0x412140['push'](_0x412140['shift']());}catch(_0x5aedb8){_0x412140['push'](_0x412140['shift']());}}}(a65_0x49c2,0x29a2b));Object[a65_0x3d2453(0x169)](exports,a65_0x3d2453(0x130),{'value':!![]}),exports[a65_0x3d2453(0x13a)]=void 0x0;const loggerService_1=require(a65_0x3d2453(0x141));class CoinToPayService{constructor(){const _0x546014=a65_0x3d2453;this[_0x546014(0x16b)]='https://tesoft.uk/gateway/cointopay/',this[_0x546014(0x115)]=_0x546014(0x132),console['log'](_0x546014(0x183)),console[_0x546014(0x12b)](_0x546014(0x144),this['statusUrl']);}async[a65_0x3d2453(0x18e)](_0x2bb0ed){const _0x344cc=a65_0x3d2453,{orderId:_0xb7610f,amount:_0x241152}=_0x2bb0ed;console['log'](_0x344cc(0x156)+_0x241152+'\x20EUR');const _0x4ba2d2={'amount':_0x241152},_0x49b664=Date[_0x344cc(0x164)]();try{console[_0x344cc(0x12b)](_0x344cc(0x17d)),console[_0x344cc(0x12b)](_0x344cc(0x10c),this['apiUrl']),console['log']('Request\x20Body:',JSON[_0x344cc(0x18c)](_0x4ba2d2,null,0x2)),console[_0x344cc(0x12b)](_0x344cc(0x131),_0x241152,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x344cc(0x11e)][_0x344cc(0x123)](_0x344cc(0x187),_0x344cc(0x151),_0x344cc(0x13b),_0x4ba2d2);const _0x1c2789=await fetch(this[_0x344cc(0x16b)],{'method':_0x344cc(0x13b),'headers':{'Content-Type':_0x344cc(0x11d),'Accept':_0x344cc(0x11d),'User-Agent':_0x344cc(0x172)},'body':JSON[_0x344cc(0x18c)](_0x4ba2d2)}),_0x5e336c=Date[_0x344cc(0x164)]()-_0x49b664;console[_0x344cc(0x12b)](_0x344cc(0x14c)),console[_0x344cc(0x12b)](_0x344cc(0x175),_0x1c2789[_0x344cc(0x154)]),console[_0x344cc(0x12b)](_0x344cc(0x146),_0x1c2789['statusText']),console[_0x344cc(0x12b)]('Headers:',Object[_0x344cc(0x13e)](_0x1c2789['headers'][_0x344cc(0x137)]())),console[_0x344cc(0x12b)](_0x344cc(0x10b),_0x5e336c+'ms');const _0x3dcbdc=await _0x1c2789['text']();console[_0x344cc(0x12b)]('Raw\x20Response\x20Body:',_0x3dcbdc);if(!_0x1c2789['ok']){console[_0x344cc(0x12c)](_0x344cc(0x10d)),console[_0x344cc(0x12c)](_0x344cc(0x121),_0x1c2789[_0x344cc(0x154)]),console[_0x344cc(0x12c)](_0x344cc(0x15a),_0x3dcbdc),loggerService_1[_0x344cc(0x11e)][_0x344cc(0x180)](_0x344cc(0x187),_0x344cc(0x151),_0x1c2789[_0x344cc(0x154)],_0x3dcbdc,_0x5e336c),loggerService_1[_0x344cc(0x11e)][_0x344cc(0x12a)](_0x344cc(0x187),'/create',_0x344cc(0x152)+_0x1c2789[_0x344cc(0x154)]+':\x20'+_0x3dcbdc);throw new Error(_0x344cc(0x11a)+_0x1c2789[_0x344cc(0x154)]+_0x344cc(0x153)+_0x3dcbdc);}let _0x23c7ea;try{_0x23c7ea=JSON[_0x344cc(0x149)](_0x3dcbdc);}catch(_0x4782ca){console[_0x344cc(0x12c)](_0x344cc(0x125),_0x4782ca),loggerService_1[_0x344cc(0x11e)]['logWhiteDomainError'](_0x344cc(0x187),_0x344cc(0x151),_0x344cc(0x118)+_0x4782ca);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3dcbdc);}console[_0x344cc(0x12b)](_0x344cc(0x114)),console[_0x344cc(0x12b)](_0x344cc(0x176),JSON[_0x344cc(0x18c)](_0x23c7ea,null,0x2)),loggerService_1[_0x344cc(0x11e)][_0x344cc(0x180)](_0x344cc(0x187),_0x344cc(0x151),_0x1c2789[_0x344cc(0x154)],_0x23c7ea,_0x5e336c);if(_0x23c7ea[_0x344cc(0x12c)]){const _0x419e1f=_0x23c7ea[_0x344cc(0x174)]||_0x23c7ea['error']||_0x344cc(0x138);console[_0x344cc(0x12c)](_0x344cc(0x18b)),console['error'](_0x344cc(0x177),_0x419e1f),loggerService_1['loggerService']['logWhiteDomainError'](_0x344cc(0x187),'/create',_0x344cc(0x10e)+_0x419e1f);throw new Error(_0x344cc(0x182)+_0x419e1f);}if(!_0x23c7ea[_0x344cc(0x155)]||!_0x23c7ea['gateway_payment_id']){console[_0x344cc(0x12c)](_0x344cc(0x143)),console[_0x344cc(0x12c)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error']('Response\x20data:',_0x23c7ea),loggerService_1['loggerService']['logWhiteDomainError'](_0x344cc(0x187),_0x344cc(0x151),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x344cc(0x16f));}console[_0x344cc(0x12b)](_0x344cc(0x111)),console['log'](_0x344cc(0x157),_0x23c7ea[_0x344cc(0x16d)]),console['log'](_0x344cc(0x170),_0x23c7ea[_0x344cc(0x155)]);const _0x158572=_0x23c7ea[_0x344cc(0x155)]+_0x344cc(0x12f);return console[_0x344cc(0x12b)](_0x344cc(0x171),_0x158572),console[_0x344cc(0x12b)](_0x344cc(0x131),_0x241152,_0x344cc(0x119)),{'gateway_payment_id':_0x23c7ea[_0x344cc(0x16d)],'payment_url':_0x158572};}catch(_0x28f8ce){console['error'](_0x344cc(0x113)),console[_0x344cc(0x12c)](_0x344cc(0x147),_0x28f8ce),loggerService_1[_0x344cc(0x11e)][_0x344cc(0x12a)]('cointopay','/create',_0x28f8ce);if(_0x28f8ce instanceof Error){console[_0x344cc(0x12c)]('Error\x20message:',_0x28f8ce[_0x344cc(0x174)]),console[_0x344cc(0x12c)](_0x344cc(0x122),_0x28f8ce[_0x344cc(0x11b)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x28f8ce[_0x344cc(0x174)]);}throw new Error(_0x344cc(0x15e));}}async['checkPaymentStatus'](_0x3df087){const _0x34897f=a65_0x3d2453,_0x2e5672=Date[_0x34897f(0x164)]();try{console[_0x34897f(0x12b)](_0x34897f(0x168)+_0x3df087);const _0x5d94d5={'gatewayPaymentId':_0x3df087};loggerService_1[_0x34897f(0x11e)]['logWhiteDomainRequest'](_0x34897f(0x187),_0x34897f(0x11f),_0x34897f(0x13b),_0x5d94d5);const _0x49e525=await fetch(this[_0x34897f(0x115)],{'method':_0x34897f(0x13b),'headers':{'Content-Type':_0x34897f(0x11d),'Accept':'application/json','User-Agent':_0x34897f(0x172)},'body':JSON['stringify'](_0x5d94d5)}),_0x531b5d=Date[_0x34897f(0x164)]()-_0x2e5672;console['log'](_0x34897f(0x13c)),console[_0x34897f(0x12b)](_0x34897f(0x175),_0x49e525[_0x34897f(0x154)]),console[_0x34897f(0x12b)]('Response\x20Time:',_0x531b5d+'ms');if(!_0x49e525['ok']){const _0x1727f9=await _0x49e525[_0x34897f(0x120)]();console[_0x34897f(0x12c)](_0x34897f(0x121),_0x49e525[_0x34897f(0x154)]),console['error'](_0x34897f(0x15a),_0x1727f9),loggerService_1[_0x34897f(0x11e)][_0x34897f(0x180)](_0x34897f(0x187),_0x34897f(0x11f),_0x49e525[_0x34897f(0x154)],_0x1727f9,_0x531b5d),loggerService_1[_0x34897f(0x11e)][_0x34897f(0x12a)]('cointopay',_0x34897f(0x11f),_0x34897f(0x152)+_0x49e525[_0x34897f(0x154)]+':\x20'+_0x1727f9);throw new Error(_0x34897f(0x11a)+_0x49e525['status']);}const _0x2daecc=await _0x49e525['text']();console[_0x34897f(0x12b)](_0x34897f(0x186),_0x2daecc);let _0x4ed0f7;try{_0x4ed0f7=JSON[_0x34897f(0x149)](_0x2daecc);}catch(_0x1400d4){console['error'](_0x34897f(0x125),_0x1400d4),loggerService_1[_0x34897f(0x11e)][_0x34897f(0x12a)]('cointopay',_0x34897f(0x11f),_0x34897f(0x118)+_0x1400d4);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x2daecc);}loggerService_1[_0x34897f(0x11e)][_0x34897f(0x180)](_0x34897f(0x187),_0x34897f(0x11f),_0x49e525[_0x34897f(0x154)],_0x4ed0f7,_0x531b5d),console[_0x34897f(0x12b)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x34897f(0x12b)]('Result:',_0x4ed0f7[_0x34897f(0x112)]),console[_0x34897f(0x12b)]('Status\x20Code:',_0x4ed0f7[_0x34897f(0x127)]),console['log']('Payment\x20Status:',_0x4ed0f7[_0x34897f(0x16c)]?.[_0x34897f(0x128)]),console[_0x34897f(0x12b)](_0x34897f(0x131),_0x4ed0f7[_0x34897f(0x16c)]?.[_0x34897f(0x14b)]),console['log'](_0x34897f(0x159),_0x4ed0f7[_0x34897f(0x16c)]?.[_0x34897f(0x189)]);if(_0x4ed0f7[_0x34897f(0x112)]!=='success'||_0x4ed0f7['status_code']!==0xc8){const _0xee4b17=_0x4ed0f7[_0x34897f(0x174)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x34897f(0x12c)](_0x34897f(0x177),_0xee4b17),loggerService_1[_0x34897f(0x11e)]['logWhiteDomainError'](_0x34897f(0x187),_0x34897f(0x11f),_0x34897f(0x14d)+_0xee4b17);throw new Error(_0x34897f(0x110)+_0xee4b17);}if(!_0x4ed0f7[_0x34897f(0x16c)]){console[_0x34897f(0x12c)](_0x34897f(0x17a)),console[_0x34897f(0x12c)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x34897f(0x12a)](_0x34897f(0x187),'/status',_0x34897f(0x145));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5133f6=_0x34897f(0x160);switch(_0x4ed0f7['data']['Status']?.['toLowerCase']()){case _0x34897f(0x17e):_0x5133f6=_0x34897f(0x166);break;case'cancelled':case _0x34897f(0x12d):case _0x34897f(0x12c):_0x5133f6=_0x34897f(0x16a);break;case'expired':case'timeout':_0x5133f6=_0x34897f(0x135);break;case _0x34897f(0x184):case _0x34897f(0x13d):case _0x34897f(0x148):case'created':default:_0x5133f6=_0x34897f(0x160);break;}let _0x481d0e,_0x5c2b5f;if(_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x14e)]){const _0x52050f=_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x14e)];console[_0x34897f(0x12b)](_0x34897f(0x150),_0x52050f);const _0x40b24a=_0x52050f[_0x34897f(0x116)](/IBAN\s+([A-Z0-9]+)/i);_0x40b24a&&(_0x481d0e=_0x40b24a[0x1],console[_0x34897f(0x12b)](_0x34897f(0x165),_0x481d0e)),_0x5c2b5f=_0x52050f;}const _0x375c07={'iban':_0x481d0e,'bankDetails':_0x5c2b5f,'transactionId':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x173)],'coinAddress':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x133)],'qrCodeUrl':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x163)],'expiryTime':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x11c)],'createdOn':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x117)],'confirmedOn':_0x4ed0f7[_0x34897f(0x16c)]['TransactionConfirmedOn']};console['log'](_0x34897f(0x162)),console[_0x34897f(0x12b)](_0x34897f(0x175),_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x128)],'->',_0x5133f6),console[_0x34897f(0x12b)](_0x34897f(0x131),_0x4ed0f7[_0x34897f(0x16c)]['Amount'],_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x189)]),console[_0x34897f(0x12b)](_0x34897f(0x15f),_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x173)]),console[_0x34897f(0x12b)](_0x34897f(0x15b),_0x481d0e||_0x34897f(0x140)),console[_0x34897f(0x12b)](_0x34897f(0x142),_0x4ed0f7['data'][_0x34897f(0x117)]),console[_0x34897f(0x12b)](_0x34897f(0x15d),_0x4ed0f7['data'][_0x34897f(0x179)]||'not\x20confirmed');if(_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x128)]?.[_0x34897f(0x18a)]()===_0x34897f(0x13d))console[_0x34897f(0x12b)](_0x34897f(0x10f));else _0x4ed0f7['data'][_0x34897f(0x128)]?.[_0x34897f(0x18a)]()===_0x34897f(0x17e)&&console[_0x34897f(0x12b)](_0x34897f(0x139));return{'status':_0x5133f6,'amount':parseFloat(_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x14b)])||undefined,'currency':_0x4ed0f7[_0x34897f(0x16c)][_0x34897f(0x189)]||'EUR','paymentDetails':_0x375c07};}catch(_0xa5c5aa){console[_0x34897f(0x12c)](_0x34897f(0x178),_0xa5c5aa),loggerService_1[_0x34897f(0x11e)][_0x34897f(0x12a)](_0x34897f(0x187),_0x34897f(0x11f),_0xa5c5aa);throw new Error(_0x34897f(0x17b)+(_0xa5c5aa instanceof Error?_0xa5c5aa[_0x34897f(0x174)]:'Unknown\x20error'));}}async[a65_0x3d2453(0x181)](_0x21b20d){const _0x2c5925=a65_0x3d2453,_0x4d90de=await this[_0x2c5925(0x17f)](_0x21b20d);return{'status':_0x4d90de[_0x2c5925(0x154)],'amount':_0x4d90de['amount'],'currency':_0x4d90de[_0x2c5925(0x161)]};}async[a65_0x3d2453(0x136)](_0x1b2851){const _0x1ae8a7=a65_0x3d2453;console[_0x1ae8a7(0x12b)](_0x1ae8a7(0x13f),_0x1b2851);let _0x2a7828=_0x1ae8a7(0x160);switch(_0x1b2851['status']?.[_0x1ae8a7(0x18a)]()){case _0x1ae8a7(0x17e):_0x2a7828='PAID';break;case _0x1ae8a7(0x167):case _0x1ae8a7(0x12d):case _0x1ae8a7(0x12c):_0x2a7828=_0x1ae8a7(0x16a);break;case _0x1ae8a7(0x188):case'timeout':_0x2a7828=_0x1ae8a7(0x135);break;case'pending':case _0x1ae8a7(0x184):case'awaiting\x20fiat':case _0x1ae8a7(0x129):default:_0x2a7828=_0x1ae8a7(0x160);break;}return{'paymentId':_0x1b2851[_0x1ae8a7(0x15c)]||_0x1b2851['merchant_reference_id']||'','status':_0x2a7828,'amount':_0x1b2851['amount'],'currency':_0x1b2851[_0x1ae8a7(0x161)]||_0x1ae8a7(0x119)};}}exports[a65_0x3d2453(0x13a)]=CoinToPayService;