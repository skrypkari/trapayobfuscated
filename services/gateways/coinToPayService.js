'use strict';const a40_0x17aa59=a40_0x31f5;(function(_0x496ac6,_0x1cf52c){const _0x40a206=a40_0x31f5,_0x5b0f3b=_0x496ac6();while(!![]){try{const _0x397d86=parseInt(_0x40a206(0x120))/0x1*(-parseInt(_0x40a206(0xe9))/0x2)+-parseInt(_0x40a206(0xbf))/0x3*(-parseInt(_0x40a206(0xd2))/0x4)+parseInt(_0x40a206(0x117))/0x5+parseInt(_0x40a206(0x124))/0x6*(-parseInt(_0x40a206(0xeb))/0x7)+-parseInt(_0x40a206(0xcb))/0x8+-parseInt(_0x40a206(0x149))/0x9*(-parseInt(_0x40a206(0xce))/0xa)+parseInt(_0x40a206(0x13e))/0xb;if(_0x397d86===_0x1cf52c)break;else _0x5b0f3b['push'](_0x5b0f3b['shift']());}catch(_0x3685e5){_0x5b0f3b['push'](_0x5b0f3b['shift']());}}}(a40_0x2a1b,0x72a4d));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0x17aa59(0x104)]=void 0x0;const loggerService_1=require(a40_0x17aa59(0x102));class CoinToPayService{constructor(){const _0x3e325b=a40_0x17aa59;this[_0x3e325b(0x103)]=_0x3e325b(0x11e),this[_0x3e325b(0xdf)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3e325b(0x126)](_0x3e325b(0xf0)),console[_0x3e325b(0x126)]('📊\x20Status\x20check\x20URL:',this[_0x3e325b(0xdf)]);}async[a40_0x17aa59(0x138)](_0x850f74){const _0x102129=a40_0x17aa59,{orderId:_0x5effa5,amount:_0x8ecab}=_0x850f74;console[_0x102129(0x126)](_0x102129(0x128)+_0x8ecab+_0x102129(0xfe));const _0x38f764={'amount':_0x8ecab},_0x582d65=Date[_0x102129(0xef)]();try{console[_0x102129(0x126)](_0x102129(0xf5)),console[_0x102129(0x126)](_0x102129(0xf2),this[_0x102129(0x103)]),console[_0x102129(0x126)]('Request\x20Body:',JSON[_0x102129(0x142)](_0x38f764,null,0x2)),console[_0x102129(0x126)](_0x102129(0xe4),_0x8ecab,_0x102129(0xed)),loggerService_1[_0x102129(0xd9)][_0x102129(0xc9)]('cointopay',_0x102129(0xde),'POST',_0x38f764);const _0xfcbc58=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x102129(0x137),'User-Agent':_0x102129(0xe5)},'body':JSON[_0x102129(0x142)](_0x38f764)}),_0xd96a3c=Date['now']()-_0x582d65;console[_0x102129(0x126)](_0x102129(0x12e)),console['log'](_0x102129(0xee),_0xfcbc58[_0x102129(0xe0)]),console[_0x102129(0x126)](_0x102129(0x109),_0xfcbc58[_0x102129(0x132)]),console[_0x102129(0x126)](_0x102129(0x13d),Object[_0x102129(0x11c)](_0xfcbc58[_0x102129(0x119)][_0x102129(0xd5)]())),console[_0x102129(0x126)](_0x102129(0x122),_0xd96a3c+'ms');const _0x40eb8d=await _0xfcbc58['text']();console[_0x102129(0x126)](_0x102129(0x147),_0x40eb8d);if(!_0xfcbc58['ok']){console[_0x102129(0x12a)](_0x102129(0xe6)),console[_0x102129(0x12a)]('HTTP\x20Status:',_0xfcbc58[_0x102129(0xe0)]),console[_0x102129(0x12a)](_0x102129(0x125),_0x40eb8d),loggerService_1[_0x102129(0xd9)][_0x102129(0xe3)](_0x102129(0xc5),_0x102129(0xde),_0xfcbc58[_0x102129(0xe0)],_0x40eb8d,_0xd96a3c),loggerService_1[_0x102129(0xd9)][_0x102129(0x10e)](_0x102129(0xc5),_0x102129(0xde),_0x102129(0x127)+_0xfcbc58['status']+':\x20'+_0x40eb8d);throw new Error(_0x102129(0x121)+_0xfcbc58['status']+_0x102129(0xfb)+_0x40eb8d);}let _0x40e1b4;try{_0x40e1b4=JSON[_0x102129(0xca)](_0x40eb8d);}catch(_0xefa46e){console[_0x102129(0x12a)](_0x102129(0x10c),_0xefa46e),loggerService_1[_0x102129(0xd9)][_0x102129(0x10e)]('cointopay',_0x102129(0xde),_0x102129(0xe2)+_0xefa46e);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x40eb8d);}console['log'](_0x102129(0xc4)),console[_0x102129(0x126)]('Parsed\x20Result:',JSON['stringify'](_0x40e1b4,null,0x2)),loggerService_1['loggerService'][_0x102129(0xe3)](_0x102129(0xc5),_0x102129(0xde),_0xfcbc58['status'],_0x40e1b4,_0xd96a3c);if(_0x40e1b4[_0x102129(0x12a)]){const _0x2b58a7=_0x40e1b4['message']||_0x40e1b4[_0x102129(0x12a)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x102129(0x12a)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x102129(0x12a)](_0x102129(0xf1),_0x2b58a7),loggerService_1[_0x102129(0xd9)][_0x102129(0x10e)](_0x102129(0xc5),_0x102129(0xde),_0x102129(0xc0)+_0x2b58a7);throw new Error(_0x102129(0x145)+_0x2b58a7);}if(!_0x40e1b4[_0x102129(0x135)]||!_0x40e1b4[_0x102129(0x114)]){console[_0x102129(0x12a)](_0x102129(0x12b)),console['error'](_0x102129(0xd0)),console[_0x102129(0x12a)](_0x102129(0xdd),_0x40e1b4),loggerService_1[_0x102129(0xd9)]['logWhiteDomainError'](_0x102129(0xc5),_0x102129(0xde),_0x102129(0x113));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x102129(0x126)](_0x102129(0x106)),console['log'](_0x102129(0xff),_0x40e1b4[_0x102129(0x114)]),console[_0x102129(0x126)](_0x102129(0x134),_0x40e1b4[_0x102129(0x135)]),console[_0x102129(0x126)](_0x102129(0xe4),_0x8ecab,'EUR'),{'gateway_payment_id':_0x40e1b4[_0x102129(0x114)],'payment_url':_0x40e1b4['payment_url']};}catch(_0x475636){console[_0x102129(0x12a)](_0x102129(0x11a)),console[_0x102129(0x12a)]('Error\x20details:',_0x475636),loggerService_1['loggerService'][_0x102129(0x10e)](_0x102129(0xc5),_0x102129(0xde),_0x475636);if(_0x475636 instanceof Error){console[_0x102129(0x12a)](_0x102129(0x136),_0x475636[_0x102129(0x101)]),console['error']('Error\x20stack:',_0x475636[_0x102129(0xf6)]);throw new Error(_0x102129(0x115)+_0x475636['message']);}throw new Error(_0x102129(0xd3));}}async['checkPaymentStatus'](_0xe4c2ac){const _0x2eae11=a40_0x17aa59,_0x6d623=Date[_0x2eae11(0xef)]();try{console[_0x2eae11(0x126)](_0x2eae11(0xfd)+_0xe4c2ac);const _0x4255a8={'gatewayPaymentId':_0xe4c2ac};loggerService_1[_0x2eae11(0xd9)][_0x2eae11(0xc9)](_0x2eae11(0xc5),'/status',_0x2eae11(0x116),_0x4255a8);const _0x382e78=await fetch(this[_0x2eae11(0xdf)],{'method':_0x2eae11(0x116),'headers':{'Content-Type':_0x2eae11(0x137),'Accept':_0x2eae11(0x137),'User-Agent':_0x2eae11(0xe5)},'body':JSON[_0x2eae11(0x142)](_0x4255a8)}),_0x4d43ba=Date['now']()-_0x6d623;console['log'](_0x2eae11(0xec)),console[_0x2eae11(0x126)](_0x2eae11(0xee),_0x382e78[_0x2eae11(0xe0)]),console[_0x2eae11(0x126)](_0x2eae11(0x122),_0x4d43ba+'ms');if(!_0x382e78['ok']){const _0x319c46=await _0x382e78[_0x2eae11(0x100)]();console[_0x2eae11(0x12a)](_0x2eae11(0x130),_0x382e78['status']),console[_0x2eae11(0x12a)](_0x2eae11(0x125),_0x319c46),loggerService_1[_0x2eae11(0xd9)]['logWhiteDomainResponse']('cointopay','/status',_0x382e78[_0x2eae11(0xe0)],_0x319c46,_0x4d43ba),loggerService_1['loggerService'][_0x2eae11(0x10e)](_0x2eae11(0xc5),_0x2eae11(0x12c),'HTTP\x20'+_0x382e78[_0x2eae11(0xe0)]+':\x20'+_0x319c46);throw new Error('HTTP\x20error!\x20status:\x20'+_0x382e78[_0x2eae11(0xe0)]);}const _0x52a409=await _0x382e78['text']();console[_0x2eae11(0x126)](_0x2eae11(0x147),_0x52a409);let _0x1db295;try{_0x1db295=JSON[_0x2eae11(0xca)](_0x52a409);}catch(_0x1ae826){console['error'](_0x2eae11(0x10c),_0x1ae826),loggerService_1[_0x2eae11(0xd9)][_0x2eae11(0x10e)]('cointopay',_0x2eae11(0x12c),_0x2eae11(0xe2)+_0x1ae826);throw new Error(_0x2eae11(0xda)+_0x52a409);}loggerService_1[_0x2eae11(0xd9)]['logWhiteDomainResponse'](_0x2eae11(0xc5),_0x2eae11(0x12c),_0x382e78[_0x2eae11(0xe0)],_0x1db295,_0x4d43ba),console[_0x2eae11(0x126)](_0x2eae11(0x118)),console[_0x2eae11(0x126)](_0x2eae11(0x10d),_0x1db295[_0x2eae11(0x146)]),console[_0x2eae11(0x126)](_0x2eae11(0x10a),_0x1db295['status_code']),console['log'](_0x2eae11(0xea),_0x1db295['data']?.[_0x2eae11(0xdc)]),console[_0x2eae11(0x126)]('Amount:',_0x1db295[_0x2eae11(0x13f)]?.[_0x2eae11(0xc7)]),console['log'](_0x2eae11(0x13b),_0x1db295[_0x2eae11(0x13f)]?.['inputCurrency']);if(_0x1db295[_0x2eae11(0x146)]!==_0x2eae11(0x133)||_0x1db295[_0x2eae11(0xc3)]!==0xc8){const _0x7e4991=_0x1db295[_0x2eae11(0x101)]||_0x2eae11(0xd1);console['error'](_0x2eae11(0xcc)),console[_0x2eae11(0x12a)](_0x2eae11(0xf1),_0x7e4991),loggerService_1[_0x2eae11(0xd9)][_0x2eae11(0x10e)](_0x2eae11(0xc5),'/status',_0x2eae11(0xe7)+_0x7e4991);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x7e4991);}if(!_0x1db295[_0x2eae11(0x13f)]){console[_0x2eae11(0x12a)](_0x2eae11(0xf4)),console['error'](_0x2eae11(0xe8)),loggerService_1[_0x2eae11(0xd9)][_0x2eae11(0x10e)](_0x2eae11(0xc5),'/status',_0x2eae11(0xd4));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x4cb3fb='PENDING';switch(_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0xdc)]?.[_0x2eae11(0xf3)]()){case _0x2eae11(0xc1):_0x4cb3fb='PAID';break;case _0x2eae11(0x10b):case'failed':case'error':_0x4cb3fb='FAILED';break;case _0x2eae11(0x140):case _0x2eae11(0x131):_0x4cb3fb='EXPIRED';break;case _0x2eae11(0x11b):case _0x2eae11(0xd6):case _0x2eae11(0xfc):case _0x2eae11(0x143):default:_0x4cb3fb=_0x2eae11(0x11d);break;}let _0x4ee3e2,_0x35da93;if(_0x1db295['data'][_0x2eae11(0xd8)]){const _0x43fad4=_0x1db295[_0x2eae11(0x13f)]['PaymentDetail'];console[_0x2eae11(0x126)](_0x2eae11(0x111),_0x43fad4);const _0x5e7f63=_0x43fad4[_0x2eae11(0xf8)](/IBAN\s+([A-Z0-9]+)/i);_0x5e7f63&&(_0x4ee3e2=_0x5e7f63[0x1],console[_0x2eae11(0x126)]('🏦\x20Extracted\x20IBAN:',_0x4ee3e2)),_0x35da93=_0x43fad4;}const _0x282e30={'iban':_0x4ee3e2,'bankDetails':_0x35da93,'transactionId':_0x1db295['data'][_0x2eae11(0x10f)],'coinAddress':_0x1db295['data'][_0x2eae11(0x11f)],'qrCodeUrl':_0x1db295['data']['QRCodeURL'],'expiryTime':_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0x12f)],'createdOn':_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0x107)],'confirmedOn':_0x1db295[_0x2eae11(0x13f)]['TransactionConfirmedOn']};console[_0x2eae11(0x126)](_0x2eae11(0xc2)),console['log']('Status:',_0x1db295[_0x2eae11(0x13f)]['Status'],'->',_0x4cb3fb),console[_0x2eae11(0x126)](_0x2eae11(0xe4),_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0xc7)],_0x1db295['data']['inputCurrency']),console['log'](_0x2eae11(0xf9),_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0x10f)]),console['log'](_0x2eae11(0x141),_0x4ee3e2||_0x2eae11(0x110)),console[_0x2eae11(0x126)](_0x2eae11(0xfa),_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0x107)]),console['log'](_0x2eae11(0x148),_0x1db295['data']['TransactionConfirmedOn']||_0x2eae11(0x108));if(_0x1db295['data'][_0x2eae11(0xdc)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x2eae11(0x126)](_0x2eae11(0x105));else _0x1db295[_0x2eae11(0x13f)][_0x2eae11(0xdc)]?.[_0x2eae11(0xf3)]()===_0x2eae11(0xc1)&&console[_0x2eae11(0x126)](_0x2eae11(0xdb));return{'status':_0x4cb3fb,'amount':parseFloat(_0x1db295[_0x2eae11(0x13f)][_0x2eae11(0xc7)])||undefined,'currency':_0x1db295['data'][_0x2eae11(0x112)]||_0x2eae11(0xe1),'paymentDetails':_0x282e30};}catch(_0x369de8){console[_0x2eae11(0x12a)](_0x2eae11(0x129),_0x369de8),loggerService_1[_0x2eae11(0xd9)][_0x2eae11(0x10e)]('cointopay',_0x2eae11(0x12c),_0x369de8);throw new Error(_0x2eae11(0xf7)+(_0x369de8 instanceof Error?_0x369de8[_0x2eae11(0x101)]:_0x2eae11(0x12d)));}}async[a40_0x17aa59(0x144)](_0x29c0c9){const _0x43344a=a40_0x17aa59,_0x93f0f3=await this[_0x43344a(0x139)](_0x29c0c9);return{'status':_0x93f0f3[_0x43344a(0xe0)],'amount':_0x93f0f3[_0x43344a(0x123)],'currency':_0x93f0f3[_0x43344a(0xcf)]};}async['processWebhook'](_0x4e0ad7){const _0x546c24=a40_0x17aa59;console[_0x546c24(0x126)](_0x546c24(0x13a),_0x4e0ad7);let _0x498031=_0x546c24(0x11d);switch(_0x4e0ad7[_0x546c24(0xe0)]?.['toLowerCase']()){case'paid':_0x498031=_0x546c24(0xcd);break;case'cancelled':case _0x546c24(0x13c):case _0x546c24(0x12a):_0x498031=_0x546c24(0xc8);break;case _0x546c24(0x140):case _0x546c24(0x131):_0x498031='EXPIRED';break;case'pending':case _0x546c24(0x11b):case'awaiting\x20fiat':case _0x546c24(0x143):default:_0x498031=_0x546c24(0x11d);break;}return{'paymentId':_0x4e0ad7[_0x546c24(0xc6)]||_0x4e0ad7[_0x546c24(0xd7)]||'','status':_0x498031,'amount':_0x4e0ad7[_0x546c24(0x123)],'currency':_0x4e0ad7['currency']||_0x546c24(0xe1)};}}function a40_0x31f5(_0x3dc58b,_0x1ee39f){const _0x2a1bf9=a40_0x2a1b();return a40_0x31f5=function(_0x31f50c,_0x514a7f){_0x31f50c=_0x31f50c-0xbf;let _0x4bfa1c=_0x2a1bf9[_0x31f50c];return _0x4bfa1c;},a40_0x31f5(_0x3dc58b,_0x1ee39f);}exports['CoinToPayService']=CoinToPayService;function a40_0x2a1b(){const _0xff0de=['not\x20found','🏦\x20Payment\x20Detail:','inputCurrency','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','POST','2955580XZKrTI','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','headers','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','waiting','fromEntries','PENDING','https://tesoft.uk/gateway/cointopay/','coinAddress','26uvkGRi','HTTP\x20error!\x20status:\x20','Response\x20Time:','amount','4134534yBRjzC','Response\x20Body:','log','HTTP\x20','🪙\x20Creating\x20CoinToPay\x20payment:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','error','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/status','Unknown\x20error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','ExpiryTime','HTTP\x20Status:','timeout','statusText','success','Payment\x20URL:','payment_url','Error\x20message:','application/json','createPaymentLink','checkPaymentStatus','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Currency:','failed','Headers:','15902447BZHJRs','data','expired','IBAN:','stringify','created','verifyPayment','CoinToPay\x20API\x20error:\x20','result','Raw\x20Response\x20Body:','Confirmed\x20On:','215073iDXJfR','3mjmUZu','Business\x20Error:\x20','paid','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','status_code','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','cointopay','order_id','Amount','FAILED','logWhiteDomainRequest','parse','5693096APnoSw','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','PAID','240lQedJg','currency','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','295456IiTNjo','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Incomplete\x20response:\x20missing\x20data','entries','awaiting\x20fiat','merchant_reference_id','PaymentDetail','loggerService','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Status','Response\x20data:','/create','statusUrl','status','EUR','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','Amount:','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status\x20API\x20Error:\x20','Missing\x20data\x20in\x20response','62606HJKbpS','Payment\x20Status:','7CcHkgB','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status:','now','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20Message:','URL:','toLowerCase','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','stack','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','Transaction\x20ID:','Created\x20On:',',\x20body:\x20','pending','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','\x20EUR','Gateway\x20Payment\x20ID:','text','message','../loggerService','apiUrl','CoinToPayService','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20SUCCESS\x20===','CreatedOn','not\x20confirmed','Status\x20Text:','Status\x20Code:','cancelled','Failed\x20to\x20parse\x20JSON\x20response:','Result:','logWhiteDomainError','TransactionID'];a40_0x2a1b=function(){return _0xff0de;};return a40_0x2a1b();}