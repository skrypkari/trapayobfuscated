'use strict';const a40_0x320d4c=a40_0x12cf;(function(_0x6c2ccc,_0x19a055){const _0xa3f41e=a40_0x12cf,_0x1d927b=_0x6c2ccc();while(!![]){try{const _0x212534=-parseInt(_0xa3f41e(0x1c0))/0x1*(parseInt(_0xa3f41e(0x197))/0x2)+-parseInt(_0xa3f41e(0x1fe))/0x3*(parseInt(_0xa3f41e(0x1b2))/0x4)+parseInt(_0xa3f41e(0x199))/0x5+parseInt(_0xa3f41e(0x1e9))/0x6+parseInt(_0xa3f41e(0x1b6))/0x7*(-parseInt(_0xa3f41e(0x1f5))/0x8)+-parseInt(_0xa3f41e(0x19f))/0x9+parseInt(_0xa3f41e(0x1c9))/0xa;if(_0x212534===_0x19a055)break;else _0x1d927b['push'](_0x1d927b['shift']());}catch(_0x200a07){_0x1d927b['push'](_0x1d927b['shift']());}}}(a40_0x4d32,0x4cc97));Object[a40_0x320d4c(0x1f3)](exports,'__esModule',{'value':!![]}),exports[a40_0x320d4c(0x1b9)]=void 0x0;const loggerService_1=require(a40_0x320d4c(0x1fb));function a40_0x12cf(_0x209975,_0x305306){const _0x4d3249=a40_0x4d32();return a40_0x12cf=function(_0x12cf2d,_0x374964){_0x12cf2d=_0x12cf2d-0x17a;let _0x50a64e=_0x4d3249[_0x12cf2d];return _0x50a64e;},a40_0x12cf(_0x209975,_0x305306);}function a40_0x4d32(){const _0x43ab75=['coinAddress','created','TesSoft\x20Payment\x20System/1.0','4hBlkbW','FAILED','1784250oxLtlM','statusUrl','status_code','cancelled','EXPIRED','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','3390129cJblal','loggerService','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','text','QRCodeURL','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','error','timeout','inputCurrency','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20stack:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','message','EUR','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','verifyPayment','data','56924fXBFxp','PAID','\x20EUR','logWhiteDomainRequest','3409bIthqv','/status','not\x20confirmed','CoinToPayService','===\x20COINTOPAY\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','stack','stringify','apiUrl','application/json','132239rrMkwQ','amount','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','pending','logWhiteDomainError','TransactionConfirmedOn','payment_url','https://tesoft.uk/gateway/cointopay/status.php','10291930jxqYSr','üè¶\x20Payment\x20Detail:','PaymentDetail','Status','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','TransactionID','Error\x20details:','Payment\x20URL:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','ExpiryTime','Status:','Gateway\x20Payment\x20ID:','Status\x20Code:','Missing\x20data\x20in\x20response','status','CoinToPay\x20payment\x20status\x20check\x20error:','paid','result','Response\x20Time:','parse','expired','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','cointopay','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','checkPaymentStatus','Confirmed\x20On:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Business\x20Error:\x20','Created\x20On:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','3435774bfKYvu','Currency:','Unknown\x20error\x20from\x20CoinToPay\x20API','now','Failed\x20to\x20parse\x20JSON\x20response:','match','waiting','URL:','processWebhook','Error\x20Message:','defineProperty','headers','6424NuEhbX','currency','failed','createPaymentLink','Transaction\x20ID:','CoinToPay\x20API\x20error:\x20','../loggerService','Amount','toLowerCase','129gdchya','/create','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','gateway_payment_id','Parsed\x20Result:',',\x20body:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','log','CreatedOn','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Response\x20data:','Request\x20Body:','IBAN:','awaiting\x20fiat','https://tesoft.uk/gateway/cointopay/','Amount:','fromEntries','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Raw\x20Response\x20Body:','Headers:','HTTP\x20Status:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','not\x20found','POST'];a40_0x4d32=function(){return _0x43ab75;};return a40_0x4d32();}class CoinToPayService{constructor(){const _0x20ca2d=a40_0x320d4c;this[_0x20ca2d(0x1be)]=_0x20ca2d(0x188),this[_0x20ca2d(0x19a)]=_0x20ca2d(0x1c8),console[_0x20ca2d(0x180)](_0x20ca2d(0x1a5)),console[_0x20ca2d(0x180)]('üìä\x20Status\x20check\x20URL:',this[_0x20ca2d(0x19a)]);}async[a40_0x320d4c(0x1f8)](_0x1eba5e){const _0xe8caf7=a40_0x320d4c,{orderId:_0x334f97,amount:_0xde491b}=_0x1eba5e;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0xde491b+_0xe8caf7(0x1b4));const _0x4d45e2={'amount':_0xde491b},_0x3c477f=Date[_0xe8caf7(0x1ec)]();try{console[_0xe8caf7(0x180)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xe8caf7(0x180)](_0xe8caf7(0x1f0),this[_0xe8caf7(0x1be)]),console['log'](_0xe8caf7(0x185),JSON[_0xe8caf7(0x1bd)](_0x4d45e2,null,0x2)),console['log'](_0xe8caf7(0x189),_0xde491b,_0xe8caf7(0x17f)),loggerService_1[_0xe8caf7(0x1a0)][_0xe8caf7(0x1b5)]('cointopay','/create','POST',_0x4d45e2);const _0x17872f=await fetch(this[_0xe8caf7(0x1be)],{'method':_0xe8caf7(0x193),'headers':{'Content-Type':'application/json','Accept':_0xe8caf7(0x1bf),'User-Agent':_0xe8caf7(0x196)},'body':JSON[_0xe8caf7(0x1bd)](_0x4d45e2)}),_0x14405b=Date[_0xe8caf7(0x1ec)]()-_0x3c477f;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xe8caf7(0x180)]('Status:',_0x17872f['status']),console[_0xe8caf7(0x180)]('Status\x20Text:',_0x17872f['statusText']),console[_0xe8caf7(0x180)](_0xe8caf7(0x18f),Object[_0xe8caf7(0x18a)](_0x17872f[_0xe8caf7(0x1f4)]['entries']())),console[_0xe8caf7(0x180)](_0xe8caf7(0x1dc),_0x14405b+'ms');const _0x2e3969=await _0x17872f['text']();console[_0xe8caf7(0x180)](_0xe8caf7(0x18e),_0x2e3969);if(!_0x17872f['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x17872f[_0xe8caf7(0x1d8)]),console[_0xe8caf7(0x1a6)]('Response\x20Body:',_0x2e3969),loggerService_1[_0xe8caf7(0x1a0)][_0xe8caf7(0x1af)](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0x17872f[_0xe8caf7(0x1d8)],_0x2e3969,_0x14405b),loggerService_1[_0xe8caf7(0x1a0)][_0xe8caf7(0x1c5)]('cointopay',_0xe8caf7(0x17a),_0xe8caf7(0x1cd)+_0x17872f[_0xe8caf7(0x1d8)]+':\x20'+_0x2e3969);throw new Error(_0xe8caf7(0x1a1)+_0x17872f['status']+_0xe8caf7(0x17e)+_0x2e3969);}let _0x639c4d;try{_0x639c4d=JSON['parse'](_0x2e3969);}catch(_0xce4f63){console['error'](_0xe8caf7(0x1ed),_0xce4f63),loggerService_1[_0xe8caf7(0x1a0)]['logWhiteDomainError'](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0xe8caf7(0x1bb)+_0xce4f63);throw new Error(_0xe8caf7(0x1ab)+_0x2e3969);}console[_0xe8caf7(0x180)](_0xe8caf7(0x18b)),console['log'](_0xe8caf7(0x17d),JSON[_0xe8caf7(0x1bd)](_0x639c4d,null,0x2)),loggerService_1['loggerService'][_0xe8caf7(0x1af)](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0x17872f[_0xe8caf7(0x1d8)],_0x639c4d,_0x14405b);if(_0x639c4d[_0xe8caf7(0x1a6)]){const _0x3c856f=_0x639c4d[_0xe8caf7(0x1ac)]||_0x639c4d[_0xe8caf7(0x1a6)]||_0xe8caf7(0x1eb);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x3c856f),loggerService_1[_0xe8caf7(0x1a0)]['logWhiteDomainError'](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0xe8caf7(0x1e6)+_0x3c856f);throw new Error(_0xe8caf7(0x1fa)+_0x3c856f);}if(!_0x639c4d[_0xe8caf7(0x1c7)]||!_0x639c4d[_0xe8caf7(0x17c)]){console[_0xe8caf7(0x1a6)](_0xe8caf7(0x1a9)),console[_0xe8caf7(0x1a6)](_0xe8caf7(0x17b)),console['error'](_0xe8caf7(0x184),_0x639c4d),loggerService_1[_0xe8caf7(0x1a0)][_0xe8caf7(0x1c5)](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0xe8caf7(0x18d));throw new Error(_0xe8caf7(0x1c3));}return console[_0xe8caf7(0x180)](_0xe8caf7(0x1ba)),console[_0xe8caf7(0x180)](_0xe8caf7(0x1d5),_0x639c4d['gateway_payment_id']),console['log'](_0xe8caf7(0x1d1),_0x639c4d['payment_url']),console[_0xe8caf7(0x180)](_0xe8caf7(0x189),_0xde491b,'EUR'),{'gateway_payment_id':_0x639c4d[_0xe8caf7(0x17c)],'payment_url':_0x639c4d[_0xe8caf7(0x1c7)]};}catch(_0x6765f5){console['error'](_0xe8caf7(0x1ae)),console[_0xe8caf7(0x1a6)](_0xe8caf7(0x1d0),_0x6765f5),loggerService_1[_0xe8caf7(0x1a0)]['logWhiteDomainError'](_0xe8caf7(0x1e1),_0xe8caf7(0x17a),_0x6765f5);if(_0x6765f5 instanceof Error){console[_0xe8caf7(0x1a6)]('Error\x20message:',_0x6765f5['message']),console[_0xe8caf7(0x1a6)](_0xe8caf7(0x1aa),_0x6765f5[_0xe8caf7(0x1bc)]);throw new Error(_0xe8caf7(0x18c)+_0x6765f5[_0xe8caf7(0x1ac)]);}throw new Error(_0xe8caf7(0x1a2));}}async[a40_0x320d4c(0x1e3)](_0x1a53ad){const _0x46a24f=a40_0x320d4c,_0x21ad0e=Date['now']();try{console['log'](_0x46a24f(0x1e2)+_0x1a53ad);const _0xef58a0={'gatewayPaymentId':_0x1a53ad};loggerService_1[_0x46a24f(0x1a0)]['logWhiteDomainRequest'](_0x46a24f(0x1e1),'/status',_0x46a24f(0x193),_0xef58a0);const _0x2d93a9=await fetch(this[_0x46a24f(0x19a)],{'method':_0x46a24f(0x193),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x46a24f(0x196)},'body':JSON[_0x46a24f(0x1bd)](_0xef58a0)}),_0x236992=Date[_0x46a24f(0x1ec)]()-_0x21ad0e;console[_0x46a24f(0x180)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x46a24f(0x180)](_0x46a24f(0x1d4),_0x2d93a9[_0x46a24f(0x1d8)]),console[_0x46a24f(0x180)]('Response\x20Time:',_0x236992+'ms');if(!_0x2d93a9['ok']){const _0x5b3ed8=await _0x2d93a9[_0x46a24f(0x1a3)]();console[_0x46a24f(0x1a6)](_0x46a24f(0x190),_0x2d93a9[_0x46a24f(0x1d8)]),console['error']('Response\x20Body:',_0x5b3ed8),loggerService_1[_0x46a24f(0x1a0)][_0x46a24f(0x1af)]('cointopay',_0x46a24f(0x1b7),_0x2d93a9[_0x46a24f(0x1d8)],_0x5b3ed8,_0x236992),loggerService_1[_0x46a24f(0x1a0)][_0x46a24f(0x1c5)](_0x46a24f(0x1e1),_0x46a24f(0x1b7),_0x46a24f(0x1cd)+_0x2d93a9['status']+':\x20'+_0x5b3ed8);throw new Error(_0x46a24f(0x1a1)+_0x2d93a9['status']);}const _0x130ddd=await _0x2d93a9[_0x46a24f(0x1a3)]();console[_0x46a24f(0x180)](_0x46a24f(0x18e),_0x130ddd);let _0x29d2ac;try{_0x29d2ac=JSON[_0x46a24f(0x1dd)](_0x130ddd);}catch(_0x12fb82){console[_0x46a24f(0x1a6)](_0x46a24f(0x1ed),_0x12fb82),loggerService_1[_0x46a24f(0x1a0)]['logWhiteDomainError'](_0x46a24f(0x1e1),'/status',_0x46a24f(0x1bb)+_0x12fb82);throw new Error(_0x46a24f(0x1e0)+_0x130ddd);}loggerService_1[_0x46a24f(0x1a0)][_0x46a24f(0x1af)](_0x46a24f(0x1e1),_0x46a24f(0x1b7),_0x2d93a9['status'],_0x29d2ac,_0x236992),console[_0x46a24f(0x180)](_0x46a24f(0x1e8)),console[_0x46a24f(0x180)]('Result:',_0x29d2ac[_0x46a24f(0x1db)]),console[_0x46a24f(0x180)](_0x46a24f(0x1d6),_0x29d2ac[_0x46a24f(0x19b)]),console[_0x46a24f(0x180)]('Payment\x20Status:',_0x29d2ac[_0x46a24f(0x1b1)]?.[_0x46a24f(0x1cc)]),console[_0x46a24f(0x180)](_0x46a24f(0x189),_0x29d2ac[_0x46a24f(0x1b1)]?.[_0x46a24f(0x1fc)]),console[_0x46a24f(0x180)](_0x46a24f(0x1ea),_0x29d2ac[_0x46a24f(0x1b1)]?.['inputCurrency']);if(_0x29d2ac[_0x46a24f(0x1db)]!=='success'||_0x29d2ac[_0x46a24f(0x19b)]!==0xc8){const _0x19263f=_0x29d2ac[_0x46a24f(0x1ac)]||_0x46a24f(0x1e5);console[_0x46a24f(0x1a6)](_0x46a24f(0x1ce)),console[_0x46a24f(0x1a6)](_0x46a24f(0x1f2),_0x19263f),loggerService_1[_0x46a24f(0x1a0)]['logWhiteDomainError'](_0x46a24f(0x1e1),'/status','Status\x20API\x20Error:\x20'+_0x19263f);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x19263f);}if(!_0x29d2ac[_0x46a24f(0x1b1)]){console[_0x46a24f(0x1a6)](_0x46a24f(0x19e)),console[_0x46a24f(0x1a6)](_0x46a24f(0x1d7)),loggerService_1['loggerService']['logWhiteDomainError'](_0x46a24f(0x1e1),_0x46a24f(0x1b7),_0x46a24f(0x1c2));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2733c9=_0x46a24f(0x1df);switch(_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1cc)]?.[_0x46a24f(0x1fd)]()){case _0x46a24f(0x1da):_0x2733c9=_0x46a24f(0x1b3);break;case'cancelled':case _0x46a24f(0x1f7):case _0x46a24f(0x1a6):_0x2733c9='FAILED';break;case _0x46a24f(0x1de):case _0x46a24f(0x1a7):_0x2733c9=_0x46a24f(0x19d);break;case _0x46a24f(0x1ef):case _0x46a24f(0x187):case'pending':case _0x46a24f(0x195):default:_0x2733c9=_0x46a24f(0x1df);break;}let _0x349511,_0x2c7b53;if(_0x29d2ac['data'][_0x46a24f(0x1cb)]){const _0x2b9b7a=_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1cb)];console[_0x46a24f(0x180)](_0x46a24f(0x1ca),_0x2b9b7a);const _0x3c11b4=_0x2b9b7a[_0x46a24f(0x1ee)](/IBAN\s+([A-Z0-9]+)/i);_0x3c11b4&&(_0x349511=_0x3c11b4[0x1],console[_0x46a24f(0x180)]('üè¶\x20Extracted\x20IBAN:',_0x349511)),_0x2c7b53=_0x2b9b7a;}const _0x38bb74={'iban':_0x349511,'bankDetails':_0x2c7b53,'transactionId':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1cf)],'coinAddress':_0x29d2ac['data'][_0x46a24f(0x194)],'qrCodeUrl':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1a4)],'expiryTime':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1d3)],'createdOn':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x181)],'confirmedOn':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1c6)]};console[_0x46a24f(0x180)](_0x46a24f(0x183)),console[_0x46a24f(0x180)](_0x46a24f(0x1d4),_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1cc)],'->',_0x2733c9),console[_0x46a24f(0x180)]('Amount:',_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1fc)],_0x29d2ac['data'][_0x46a24f(0x1a8)]),console[_0x46a24f(0x180)](_0x46a24f(0x1f9),_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1cf)]),console[_0x46a24f(0x180)](_0x46a24f(0x186),_0x349511||_0x46a24f(0x192)),console[_0x46a24f(0x180)](_0x46a24f(0x1e7),_0x29d2ac['data'][_0x46a24f(0x181)]),console[_0x46a24f(0x180)](_0x46a24f(0x1e4),_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1c6)]||_0x46a24f(0x1b8));if(_0x29d2ac['data'][_0x46a24f(0x1cc)]?.[_0x46a24f(0x1fd)]()===_0x46a24f(0x187))console[_0x46a24f(0x180)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x29d2ac['data']['Status']?.['toLowerCase']()===_0x46a24f(0x1da)&&console[_0x46a24f(0x180)](_0x46a24f(0x1d2));return{'status':_0x2733c9,'amount':parseFloat(_0x29d2ac['data']['Amount'])||undefined,'currency':_0x29d2ac[_0x46a24f(0x1b1)][_0x46a24f(0x1a8)]||_0x46a24f(0x1ad),'paymentDetails':_0x38bb74};}catch(_0x44ace1){console[_0x46a24f(0x1a6)](_0x46a24f(0x1d9),_0x44ace1),loggerService_1[_0x46a24f(0x1a0)][_0x46a24f(0x1c5)](_0x46a24f(0x1e1),_0x46a24f(0x1b7),_0x44ace1);throw new Error(_0x46a24f(0x191)+(_0x44ace1 instanceof Error?_0x44ace1['message']:'Unknown\x20error'));}}async[a40_0x320d4c(0x1b0)](_0x10be88){const _0x50850a=a40_0x320d4c,_0x2761fa=await this[_0x50850a(0x1e3)](_0x10be88);return{'status':_0x2761fa[_0x50850a(0x1d8)],'amount':_0x2761fa[_0x50850a(0x1c1)],'currency':_0x2761fa[_0x50850a(0x1f6)]};}async[a40_0x320d4c(0x1f1)](_0x1b6007){const _0x1fc7e6=a40_0x320d4c;console[_0x1fc7e6(0x180)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x1b6007);let _0x55f11b=_0x1fc7e6(0x1df);switch(_0x1b6007[_0x1fc7e6(0x1d8)]?.[_0x1fc7e6(0x1fd)]()){case _0x1fc7e6(0x1da):_0x55f11b=_0x1fc7e6(0x1b3);break;case _0x1fc7e6(0x19c):case'failed':case _0x1fc7e6(0x1a6):_0x55f11b=_0x1fc7e6(0x198);break;case'expired':case _0x1fc7e6(0x1a7):_0x55f11b=_0x1fc7e6(0x19d);break;case _0x1fc7e6(0x1c4):case'waiting':case _0x1fc7e6(0x187):case _0x1fc7e6(0x195):default:_0x55f11b=_0x1fc7e6(0x1df);break;}return{'paymentId':_0x1b6007['order_id']||_0x1b6007[_0x1fc7e6(0x182)]||'','status':_0x55f11b,'amount':_0x1b6007[_0x1fc7e6(0x1c1)],'currency':_0x1b6007[_0x1fc7e6(0x1f6)]||_0x1fc7e6(0x1ad)};}}exports[a40_0x320d4c(0x1b9)]=CoinToPayService;