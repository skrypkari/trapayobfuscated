'use strict';const a40_0x30cea4=a40_0x1f12;(function(_0x22cc89,_0x152566){const _0x4bc55c=a40_0x1f12,_0x177cca=_0x22cc89();while(!![]){try{const _0x4ea7c6=-parseInt(_0x4bc55c(0x1ff))/0x1+parseInt(_0x4bc55c(0x229))/0x2*(parseInt(_0x4bc55c(0x240))/0x3)+-parseInt(_0x4bc55c(0x1e2))/0x4*(parseInt(_0x4bc55c(0x21b))/0x5)+parseInt(_0x4bc55c(0x243))/0x6*(-parseInt(_0x4bc55c(0x1dd))/0x7)+parseInt(_0x4bc55c(0x1df))/0x8+parseInt(_0x4bc55c(0x1f8))/0x9*(parseInt(_0x4bc55c(0x210))/0xa)+parseInt(_0x4bc55c(0x1ea))/0xb;if(_0x4ea7c6===_0x152566)break;else _0x177cca['push'](_0x177cca['shift']());}catch(_0x485c39){_0x177cca['push'](_0x177cca['shift']());}}}(a40_0x1156,0xe2405));function a40_0x1156(){const _0x4961b=['\x20EUR','TransactionID','/create','not\x20confirmed','data','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','2238754jPRRax','HTTP\x20error!\x20status:\x20','6590880AJtbmd','PAID','logWhiteDomainRequest','1462452GEilEJ','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','üè¶\x20Payment\x20Detail:','Error\x20details:','Payment\x20URL:','defineProperty','HTTP\x20','15691511eivNZn','logWhiteDomainError','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Business\x20Error:\x20','toLowerCase','match','currency','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Result:','__esModule','not\x20found','27045vlUffb','EUR','Response\x20data:','../loggerService','Status','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','967338QvRnQo','Payment\x20Status:','üè¶\x20Extracted\x20IBAN:','statusText','Headers:','FAILED','TransactionConfirmedOn','PaymentDetail','createPaymentLink','Parsed\x20Result:','Status\x20Text:','JSON\x20Parse\x20Error:\x20','üìä\x20Status\x20check\x20URL:','inputCurrency','Response\x20Time:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20Body:','500WFQFaX','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Status\x20API\x20Error:\x20','result','log','checkPaymentStatus','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','cointopay','15BSQBgp','PENDING','/status','IBAN:','payment_url','Error\x20message:','logWhiteDomainResponse','Confirmed\x20On:','Unknown\x20error\x20from\x20CoinToPay\x20API','awaiting\x20fiat','text','Raw\x20Response\x20Body:','Status:','statusUrl','178nSlHGT','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','TesSoft\x20Payment\x20System/1.0','Unknown\x20error','POST','https://tesoft.uk/gateway/cointopay/status.php','now','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','stack','amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','verifyPayment','Gateway\x20Payment\x20ID:','error','status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ExpiryTime','parse','Status\x20Code:','status_code','message','Created\x20On:','52239ykSmZR','https://tesoft.uk/gateway/cointopay/','stringify','18zMJeQx','CoinToPay\x20API\x20error:\x20','timeout','HTTP\x20Status:','failed','Incomplete\x20response:\x20missing\x20data','pending','Missing\x20data\x20in\x20response','Amount:','paid','order_id','created','cancelled','processWebhook','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Amount','success','expired','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','apiUrl','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Transaction\x20ID:','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','application/json','waiting','Error\x20Message:'];a40_0x1156=function(){return _0x4961b;};return a40_0x1156();}Object[a40_0x30cea4(0x1e8)](exports,a40_0x30cea4(0x1f6),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x30cea4(0x1fb));function a40_0x1f12(_0x2912ca,_0x38c466){const _0x1156f0=a40_0x1156();return a40_0x1f12=function(_0x1f12da,_0x2a07c8){_0x1f12da=_0x1f12da-0x1d6;let _0x26e427=_0x1156f0[_0x1f12da];return _0x26e427;},a40_0x1f12(_0x2912ca,_0x38c466);}class CoinToPayService{constructor(){const _0x49ed08=a40_0x30cea4;this[_0x49ed08(0x256)]=_0x49ed08(0x241),this[_0x49ed08(0x228)]=_0x49ed08(0x22f),console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x49ed08(0x216)](_0x49ed08(0x20b),this[_0x49ed08(0x228)]);}async[a40_0x30cea4(0x207)](_0x5b288c){const _0x2607fe=a40_0x30cea4,{orderId:_0x562abc,amount:_0x184080}=_0x5b288c;console['log'](_0x2607fe(0x231)+_0x184080+_0x2607fe(0x1d6));const _0x370497={'amount':_0x184080},_0x1a339b=Date[_0x2607fe(0x230)]();try{console[_0x2607fe(0x216)](_0x2607fe(0x251)),console['log']('URL:',this[_0x2607fe(0x256)]),console[_0x2607fe(0x216)]('Request\x20Body:',JSON['stringify'](_0x370497,null,0x2)),console[_0x2607fe(0x216)]('Amount:',_0x184080,_0x2607fe(0x20e)),loggerService_1['loggerService'][_0x2607fe(0x1e1)](_0x2607fe(0x21a),_0x2607fe(0x1d8),_0x2607fe(0x22e),_0x370497);const _0xf77eff=await fetch(this[_0x2607fe(0x256)],{'method':_0x2607fe(0x22e),'headers':{'Content-Type':_0x2607fe(0x25c),'Accept':_0x2607fe(0x25c),'User-Agent':_0x2607fe(0x22c)},'body':JSON[_0x2607fe(0x242)](_0x370497)}),_0x461ec3=Date[_0x2607fe(0x230)]()-_0x1a339b;console[_0x2607fe(0x216)](_0x2607fe(0x1dc)),console['log'](_0x2607fe(0x227),_0xf77eff[_0x2607fe(0x238)]),console[_0x2607fe(0x216)](_0x2607fe(0x209),_0xf77eff[_0x2607fe(0x202)]),console[_0x2607fe(0x216)](_0x2607fe(0x203),Object['fromEntries'](_0xf77eff['headers']['entries']())),console['log'](_0x2607fe(0x20d),_0x461ec3+'ms');const _0x279fcf=await _0xf77eff[_0x2607fe(0x225)]();console['log']('Raw\x20Response\x20Body:',_0x279fcf);if(!_0xf77eff['ok']){console[_0x2607fe(0x237)](_0x2607fe(0x234)),console[_0x2607fe(0x237)]('HTTP\x20Status:',_0xf77eff[_0x2607fe(0x238)]),console['error'](_0x2607fe(0x20f),_0x279fcf),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x2607fe(0x1d8),_0xf77eff[_0x2607fe(0x238)],_0x279fcf,_0x461ec3),loggerService_1[_0x2607fe(0x1fe)][_0x2607fe(0x1eb)](_0x2607fe(0x21a),_0x2607fe(0x1d8),_0x2607fe(0x1e9)+_0xf77eff[_0x2607fe(0x238)]+':\x20'+_0x279fcf);throw new Error(_0x2607fe(0x1de)+_0xf77eff[_0x2607fe(0x238)]+_0x2607fe(0x25b)+_0x279fcf);}let _0x4697fb;try{_0x4697fb=JSON[_0x2607fe(0x23b)](_0x279fcf);}catch(_0x449e82){console[_0x2607fe(0x237)](_0x2607fe(0x1fd),_0x449e82),loggerService_1[_0x2607fe(0x1fe)][_0x2607fe(0x1eb)](_0x2607fe(0x21a),'/create',_0x2607fe(0x20a)+_0x449e82);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x279fcf);}console['log'](_0x2607fe(0x1ec)),console[_0x2607fe(0x216)](_0x2607fe(0x208),JSON['stringify'](_0x4697fb,null,0x2)),loggerService_1[_0x2607fe(0x1fe)]['logWhiteDomainResponse'](_0x2607fe(0x21a),'/create',_0xf77eff[_0x2607fe(0x238)],_0x4697fb,_0x461ec3);if(_0x4697fb['error']){const _0x166310=_0x4697fb[_0x2607fe(0x23e)]||_0x4697fb[_0x2607fe(0x237)]||_0x2607fe(0x223);console[_0x2607fe(0x237)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2607fe(0x237)](_0x2607fe(0x25e),_0x166310),loggerService_1[_0x2607fe(0x1fe)][_0x2607fe(0x1eb)](_0x2607fe(0x21a),_0x2607fe(0x1d8),_0x2607fe(0x1ee)+_0x166310);throw new Error(_0x2607fe(0x244)+_0x166310);}if(!_0x4697fb[_0x2607fe(0x21f)]||!_0x4697fb[_0x2607fe(0x212)]){console[_0x2607fe(0x237)](_0x2607fe(0x239)),console[_0x2607fe(0x237)](_0x2607fe(0x1f3)),console[_0x2607fe(0x237)](_0x2607fe(0x1fa),_0x4697fb),loggerService_1[_0x2607fe(0x1fe)]['logWhiteDomainError'](_0x2607fe(0x21a),'/create',_0x2607fe(0x1e3));throw new Error(_0x2607fe(0x211));}return console['log'](_0x2607fe(0x22b)),console[_0x2607fe(0x216)](_0x2607fe(0x236),_0x4697fb[_0x2607fe(0x212)]),console[_0x2607fe(0x216)](_0x2607fe(0x1e7),_0x4697fb[_0x2607fe(0x21f)]),console[_0x2607fe(0x216)](_0x2607fe(0x24b),_0x184080,_0x2607fe(0x1f9)),{'gateway_payment_id':_0x4697fb[_0x2607fe(0x212)],'payment_url':_0x4697fb[_0x2607fe(0x21f)]};}catch(_0x2bf8f4){console[_0x2607fe(0x237)](_0x2607fe(0x1ed)),console['error'](_0x2607fe(0x1e6),_0x2bf8f4),loggerService_1['loggerService']['logWhiteDomainError'](_0x2607fe(0x21a),_0x2607fe(0x1d8),_0x2bf8f4);if(_0x2bf8f4 instanceof Error){console[_0x2607fe(0x237)](_0x2607fe(0x220),_0x2bf8f4[_0x2607fe(0x23e)]),console[_0x2607fe(0x237)]('Error\x20stack:',_0x2bf8f4[_0x2607fe(0x232)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2bf8f4[_0x2607fe(0x23e)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x30cea4(0x217)](_0x32e462){const _0xe22312=a40_0x30cea4,_0x2448a3=Date[_0xe22312(0x230)]();try{console[_0xe22312(0x216)](_0xe22312(0x1e4)+_0x32e462);const _0x4f17ca={'gatewayPaymentId':_0x32e462};loggerService_1[_0xe22312(0x1fe)]['logWhiteDomainRequest'](_0xe22312(0x21a),_0xe22312(0x21d),_0xe22312(0x22e),_0x4f17ca);const _0x53f4e9=await fetch(this['statusUrl'],{'method':_0xe22312(0x22e),'headers':{'Content-Type':_0xe22312(0x25c),'Accept':_0xe22312(0x25c),'User-Agent':_0xe22312(0x22c)},'body':JSON['stringify'](_0x4f17ca)}),_0x1423bb=Date[_0xe22312(0x230)]()-_0x2448a3;console[_0xe22312(0x216)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xe22312(0x216)](_0xe22312(0x227),_0x53f4e9['status']),console[_0xe22312(0x216)](_0xe22312(0x20d),_0x1423bb+'ms');if(!_0x53f4e9['ok']){const _0x28a0e0=await _0x53f4e9['text']();console['error'](_0xe22312(0x246),_0x53f4e9[_0xe22312(0x238)]),console['error']('Response\x20Body:',_0x28a0e0),loggerService_1['loggerService'][_0xe22312(0x221)](_0xe22312(0x21a),_0xe22312(0x21d),_0x53f4e9[_0xe22312(0x238)],_0x28a0e0,_0x1423bb),loggerService_1[_0xe22312(0x1fe)]['logWhiteDomainError'](_0xe22312(0x21a),_0xe22312(0x21d),_0xe22312(0x1e9)+_0x53f4e9[_0xe22312(0x238)]+':\x20'+_0x28a0e0);throw new Error(_0xe22312(0x1de)+_0x53f4e9[_0xe22312(0x238)]);}const _0x255219=await _0x53f4e9[_0xe22312(0x225)]();console[_0xe22312(0x216)](_0xe22312(0x226),_0x255219);let _0x3397ad;try{_0x3397ad=JSON[_0xe22312(0x23b)](_0x255219);}catch(_0x481454){console[_0xe22312(0x237)](_0xe22312(0x1fd),_0x481454),loggerService_1['loggerService'][_0xe22312(0x1eb)](_0xe22312(0x21a),_0xe22312(0x21d),_0xe22312(0x20a)+_0x481454);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x255219);}loggerService_1[_0xe22312(0x1fe)][_0xe22312(0x221)](_0xe22312(0x21a),_0xe22312(0x21d),_0x53f4e9['status'],_0x3397ad,_0x1423bb),console[_0xe22312(0x216)](_0xe22312(0x257)),console['log'](_0xe22312(0x1f5),_0x3397ad[_0xe22312(0x215)]),console[_0xe22312(0x216)](_0xe22312(0x23c),_0x3397ad[_0xe22312(0x23d)]),console[_0xe22312(0x216)](_0xe22312(0x200),_0x3397ad['data']?.[_0xe22312(0x1fc)]),console[_0xe22312(0x216)](_0xe22312(0x24b),_0x3397ad['data']?.[_0xe22312(0x252)]),console[_0xe22312(0x216)]('Currency:',_0x3397ad[_0xe22312(0x1da)]?.[_0xe22312(0x20c)]);if(_0x3397ad[_0xe22312(0x215)]!==_0xe22312(0x253)||_0x3397ad[_0xe22312(0x23d)]!==0xc8){const _0x56dcb0=_0x3397ad[_0xe22312(0x23e)]||_0xe22312(0x1f2);console[_0xe22312(0x237)](_0xe22312(0x218)),console[_0xe22312(0x237)](_0xe22312(0x25e),_0x56dcb0),loggerService_1[_0xe22312(0x1fe)][_0xe22312(0x1eb)](_0xe22312(0x21a),'/status',_0xe22312(0x214)+_0x56dcb0);throw new Error(_0xe22312(0x22a)+_0x56dcb0);}if(!_0x3397ad['data']){console[_0xe22312(0x237)](_0xe22312(0x25a)),console[_0xe22312(0x237)](_0xe22312(0x24a)),loggerService_1[_0xe22312(0x1fe)][_0xe22312(0x1eb)](_0xe22312(0x21a),_0xe22312(0x21d),_0xe22312(0x248));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x23df2e=_0xe22312(0x21c);switch(_0x3397ad[_0xe22312(0x1da)]['Status']?.[_0xe22312(0x1ef)]()){case _0xe22312(0x24c):_0x23df2e=_0xe22312(0x1e0);break;case'cancelled':case'failed':case _0xe22312(0x237):_0x23df2e=_0xe22312(0x204);break;case'expired':case _0xe22312(0x245):_0x23df2e='EXPIRED';break;case'waiting':case'awaiting\x20fiat':case _0xe22312(0x249):case _0xe22312(0x24e):default:_0x23df2e=_0xe22312(0x21c);break;}let _0x7eab74,_0x2947b9;if(_0x3397ad['data']['PaymentDetail']){const _0x2fa22d=_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x206)];console[_0xe22312(0x216)](_0xe22312(0x1e5),_0x2fa22d);const _0x1fbae5=_0x2fa22d[_0xe22312(0x1f0)](/IBAN\s+([A-Z0-9]+)/i);_0x1fbae5&&(_0x7eab74=_0x1fbae5[0x1],console['log'](_0xe22312(0x201),_0x7eab74)),_0x2947b9=_0x2fa22d;}const _0x11118b={'iban':_0x7eab74,'bankDetails':_0x2947b9,'transactionId':_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x1d7)],'coinAddress':_0x3397ad[_0xe22312(0x1da)]['coinAddress'],'qrCodeUrl':_0x3397ad[_0xe22312(0x1da)]['QRCodeURL'],'expiryTime':_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x23a)],'createdOn':_0x3397ad[_0xe22312(0x1da)]['CreatedOn'],'confirmedOn':_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x205)]};console[_0xe22312(0x216)](_0xe22312(0x1db)),console[_0xe22312(0x216)](_0xe22312(0x227),_0x3397ad[_0xe22312(0x1da)]['Status'],'->',_0x23df2e),console[_0xe22312(0x216)](_0xe22312(0x24b),_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x252)],_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x20c)]),console[_0xe22312(0x216)](_0xe22312(0x258),_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x1d7)]),console['log'](_0xe22312(0x21e),_0x7eab74||_0xe22312(0x1f7)),console['log'](_0xe22312(0x23f),_0x3397ad[_0xe22312(0x1da)]['CreatedOn']),console[_0xe22312(0x216)](_0xe22312(0x222),_0x3397ad[_0xe22312(0x1da)]['TransactionConfirmedOn']||_0xe22312(0x1d9));if(_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x1fc)]?.[_0xe22312(0x1ef)]()===_0xe22312(0x224))console['log'](_0xe22312(0x1f4));else _0x3397ad[_0xe22312(0x1da)][_0xe22312(0x1fc)]?.[_0xe22312(0x1ef)]()==='paid'&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x23df2e,'amount':parseFloat(_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x252)])||undefined,'currency':_0x3397ad[_0xe22312(0x1da)][_0xe22312(0x20c)]||_0xe22312(0x1f9),'paymentDetails':_0x11118b};}catch(_0x5c476a){console[_0xe22312(0x237)](_0xe22312(0x219),_0x5c476a),loggerService_1['loggerService'][_0xe22312(0x1eb)](_0xe22312(0x21a),_0xe22312(0x21d),_0x5c476a);throw new Error(_0xe22312(0x255)+(_0x5c476a instanceof Error?_0x5c476a[_0xe22312(0x23e)]:_0xe22312(0x22d)));}}async[a40_0x30cea4(0x235)](_0x5a31e0){const _0x4da46a=a40_0x30cea4,_0x1ed370=await this[_0x4da46a(0x217)](_0x5a31e0);return{'status':_0x1ed370['status'],'amount':_0x1ed370[_0x4da46a(0x233)],'currency':_0x1ed370[_0x4da46a(0x1f1)]};}async[a40_0x30cea4(0x250)](_0x15196c){const _0x13ef0d=a40_0x30cea4;console[_0x13ef0d(0x216)](_0x13ef0d(0x213),_0x15196c);let _0x2b4de8=_0x13ef0d(0x21c);switch(_0x15196c[_0x13ef0d(0x238)]?.[_0x13ef0d(0x1ef)]()){case'paid':_0x2b4de8=_0x13ef0d(0x1e0);break;case _0x13ef0d(0x24f):case _0x13ef0d(0x247):case _0x13ef0d(0x237):_0x2b4de8=_0x13ef0d(0x204);break;case _0x13ef0d(0x254):case _0x13ef0d(0x245):_0x2b4de8='EXPIRED';break;case _0x13ef0d(0x249):case _0x13ef0d(0x25d):case _0x13ef0d(0x224):case _0x13ef0d(0x24e):default:_0x2b4de8='PENDING';break;}return{'paymentId':_0x15196c[_0x13ef0d(0x24d)]||_0x15196c['merchant_reference_id']||'','status':_0x2b4de8,'amount':_0x15196c[_0x13ef0d(0x233)],'currency':_0x15196c[_0x13ef0d(0x1f1)]||_0x13ef0d(0x1f9)};}}exports[a40_0x30cea4(0x259)]=CoinToPayService;