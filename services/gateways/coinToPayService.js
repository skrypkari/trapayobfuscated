'use strict';const a40_0xaf3773=a40_0x2628;(function(_0x1269ea,_0x5b2b4d){const _0x23dd47=a40_0x2628,_0x240c2e=_0x1269ea();while(!![]){try{const _0x4e3327=parseInt(_0x23dd47(0x17c))/0x1+parseInt(_0x23dd47(0x196))/0x2*(parseInt(_0x23dd47(0x159))/0x3)+parseInt(_0x23dd47(0x19d))/0x4*(parseInt(_0x23dd47(0x1ae))/0x5)+parseInt(_0x23dd47(0x170))/0x6*(parseInt(_0x23dd47(0x157))/0x7)+-parseInt(_0x23dd47(0x19c))/0x8+-parseInt(_0x23dd47(0x1cb))/0x9*(parseInt(_0x23dd47(0x165))/0xa)+parseInt(_0x23dd47(0x1b3))/0xb;if(_0x4e3327===_0x5b2b4d)break;else _0x240c2e['push'](_0x240c2e['shift']());}catch(_0x10d6bf){_0x240c2e['push'](_0x240c2e['shift']());}}}(a40_0x2c1c,0x1aea7));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a40_0xaf3773(0x189)]=void 0x0;function a40_0x2628(_0x239674,_0x2d9089){const _0x2c1c5f=a40_0x2c1c();return a40_0x2628=function(_0x26280b,_0x5dd704){_0x26280b=_0x26280b-0x153;let _0x47b154=_0x2c1c5f[_0x26280b];return _0x47b154;},a40_0x2628(_0x239674,_0x2d9089);}const loggerService_1=require(a40_0xaf3773(0x194));function a40_0x2c1c(){const _0x504504=['Created\x20On:','Result:','apiUrl','log','QRCodeURL','waiting','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','parse','JSON\x20Parse\x20Error:\x20','4500oBtEfo','currency','Response\x20Time:','Currency:','createPaymentLink','text','status_code','Amount','data','cancelled','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','amount','/status','TesSoft\x20Payment\x20System/1.0','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','5138MYcadb','EUR','23589gHxYzk','failed','match','Failed\x20to\x20parse\x20JSON\x20response:','üè¶\x20Payment\x20Detail:','Status','order_id','Error\x20Message:','Parsed\x20Result:','Error\x20message:','logWhiteDomainResponse','stringify','3200agUmDM','checkPaymentStatus','Error\x20details:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','message','\x20EUR','FAILED','timeout','expired','toLowerCase','360GrjzOJ','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','success','Unknown\x20error','statusText','URL:','logWhiteDomainError','HTTP\x20error!\x20status:\x20','CoinToPay\x20API\x20error:\x20',',\x20body:\x20','paid','125710QGLTxC','cointopay','inputCurrency','HTTP\x20Status:','Raw\x20Response\x20Body:','headers','Error\x20stack:','Request\x20Body:','POST','status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Amount:','CoinToPayService','fromEntries','PaymentDetail','Response\x20Body:','Incomplete\x20response:\x20missing\x20data','IBAN:','Payment\x20Status:','verifyPayment','logWhiteDomainRequest','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','processWebhook','../loggerService','Payment\x20URL:','16aGdLsK','CoinToPay\x20payment\x20status\x20check\x20error:','created','ExpiryTime','CreatedOn','payment_url','990464pgDQLQ','168284KORFYJ','loggerService','now','awaiting\x20fiat','PAID','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','gateway_payment_id','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','TransactionID','Status\x20API\x20Error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20data\x20in\x20response','EXPIRED','pending','Status\x20Code:','Transaction\x20ID:','statusUrl','15NXBLsX','result','merchant_reference_id','HTTP\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','387068Opyxej','not\x20confirmed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','application/json','Status:','TransactionConfirmedOn','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','error','Unknown\x20error\x20from\x20CoinToPay\x20API','PENDING','Gateway\x20Payment\x20ID:','/create'];a40_0x2c1c=function(){return _0x504504;};return a40_0x2c1c();}class CoinToPayService{constructor(){const _0x44071b=a40_0xaf3773;this[_0x44071b(0x1c2)]='https://tesoft.uk/gateway/cointopay/',this[_0x44071b(0x1ad)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x44071b(0x1c3)](_0x44071b(0x187)),console[_0x44071b(0x1c3)]('üìä\x20Status\x20check\x20URL:',this[_0x44071b(0x1ad)]);}async[a40_0xaf3773(0x1cf)](_0x4a2fa3){const _0x1e362d=a40_0xaf3773,{orderId:_0x3bfe5a,amount:_0x9a52b0}=_0x4a2fa3;console[_0x1e362d(0x1c3)](_0x1e362d(0x1a7)+_0x9a52b0+_0x1e362d(0x16b));const _0x3217e7={'amount':_0x9a52b0},_0x9f9438=Date[_0x1e362d(0x19f)]();try{console[_0x1e362d(0x1c3)](_0x1e362d(0x1c7)),console['log'](_0x1e362d(0x176),this['apiUrl']),console['log'](_0x1e362d(0x183),JSON[_0x1e362d(0x164)](_0x3217e7,null,0x2)),console[_0x1e362d(0x1c3)]('Amount:',_0x9a52b0,_0x1e362d(0x186)),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x1e362d(0x1bf),_0x1e362d(0x184),_0x3217e7);const _0xb8d717=await fetch(this[_0x1e362d(0x1c2)],{'method':'POST','headers':{'Content-Type':_0x1e362d(0x1b7),'Accept':_0x1e362d(0x1b7),'User-Agent':_0x1e362d(0x155)},'body':JSON['stringify'](_0x3217e7)}),_0x39cb6a=Date[_0x1e362d(0x19f)]()-_0x9f9438;console['log'](_0x1e362d(0x1c6)),console[_0x1e362d(0x1c3)](_0x1e362d(0x1b8),_0xb8d717[_0x1e362d(0x185)]),console['log']('Status\x20Text:',_0xb8d717[_0x1e362d(0x175)]),console['log']('Headers:',Object[_0x1e362d(0x18a)](_0xb8d717[_0x1e362d(0x181)]['entries']())),console[_0x1e362d(0x1c3)](_0x1e362d(0x1cd),_0x39cb6a+'ms');const _0x5658a9=await _0xb8d717[_0x1e362d(0x1d0)]();console['log'](_0x1e362d(0x180),_0x5658a9);if(!_0xb8d717['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x1e362d(0x1bb)]('HTTP\x20Status:',_0xb8d717['status']),console[_0x1e362d(0x1bb)]('Response\x20Body:',_0x5658a9),loggerService_1['loggerService'][_0x1e362d(0x163)](_0x1e362d(0x17d),'/create',_0xb8d717[_0x1e362d(0x185)],_0x5658a9,_0x39cb6a),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x1e362d(0x1bf),_0x1e362d(0x1b1)+_0xb8d717[_0x1e362d(0x185)]+':\x20'+_0x5658a9);throw new Error(_0x1e362d(0x178)+_0xb8d717['status']+_0x1e362d(0x17a)+_0x5658a9);}let _0x342519;try{_0x342519=JSON[_0x1e362d(0x1c9)](_0x5658a9);}catch(_0x223fa3){console[_0x1e362d(0x1bb)](_0x1e362d(0x15c),_0x223fa3),loggerService_1['loggerService'][_0x1e362d(0x177)](_0x1e362d(0x17d),_0x1e362d(0x1bf),_0x1e362d(0x1ca)+_0x223fa3);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5658a9);}console[_0x1e362d(0x1c3)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x1e362d(0x1c3)](_0x1e362d(0x161),JSON[_0x1e362d(0x164)](_0x342519,null,0x2)),loggerService_1[_0x1e362d(0x19e)][_0x1e362d(0x163)]('cointopay',_0x1e362d(0x1bf),_0xb8d717['status'],_0x342519,_0x39cb6a);if(_0x342519[_0x1e362d(0x1bb)]){const _0x508a0a=_0x342519['message']||_0x342519[_0x1e362d(0x1bb)]||_0x1e362d(0x1bc);console['error'](_0x1e362d(0x1b2)),console['error'](_0x1e362d(0x160),_0x508a0a),loggerService_1[_0x1e362d(0x19e)][_0x1e362d(0x177)](_0x1e362d(0x17d),_0x1e362d(0x1bf),'Business\x20Error:\x20'+_0x508a0a);throw new Error(_0x1e362d(0x179)+_0x508a0a);}if(!_0x342519['payment_url']||!_0x342519[_0x1e362d(0x1a3)]){console[_0x1e362d(0x1bb)](_0x1e362d(0x1d6)),console['error'](_0x1e362d(0x1a4)),console[_0x1e362d(0x1bb)]('Response\x20data:',_0x342519),loggerService_1[_0x1e362d(0x19e)][_0x1e362d(0x177)](_0x1e362d(0x17d),_0x1e362d(0x1bf),_0x1e362d(0x1b5));throw new Error(_0x1e362d(0x169));}return console[_0x1e362d(0x1c3)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x1e362d(0x1c3)](_0x1e362d(0x1be),_0x342519[_0x1e362d(0x1a3)]),console[_0x1e362d(0x1c3)](_0x1e362d(0x195),_0x342519[_0x1e362d(0x19b)]),console[_0x1e362d(0x1c3)](_0x1e362d(0x188),_0x9a52b0,_0x1e362d(0x158)),{'gateway_payment_id':_0x342519[_0x1e362d(0x1a3)],'payment_url':_0x342519[_0x1e362d(0x19b)]};}catch(_0xf74cc6){console[_0x1e362d(0x1bb)](_0x1e362d(0x1a2)),console[_0x1e362d(0x1bb)](_0x1e362d(0x167),_0xf74cc6),loggerService_1[_0x1e362d(0x19e)][_0x1e362d(0x177)]('cointopay',_0x1e362d(0x1bf),_0xf74cc6);if(_0xf74cc6 instanceof Error){console['error'](_0x1e362d(0x162),_0xf74cc6[_0x1e362d(0x16a)]),console[_0x1e362d(0x1bb)](_0x1e362d(0x182),_0xf74cc6['stack']);throw new Error(_0x1e362d(0x171)+_0xf74cc6[_0x1e362d(0x16a)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0xaf3773(0x166)](_0x1ad0d2){const _0xb2e0e5=a40_0xaf3773,_0x5d2891=Date[_0xb2e0e5(0x19f)]();try{console[_0xb2e0e5(0x1c3)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x1ad0d2);const _0x9c1fc7={'gatewayPaymentId':_0x1ad0d2};loggerService_1[_0xb2e0e5(0x19e)][_0xb2e0e5(0x191)]('cointopay','/status',_0xb2e0e5(0x184),_0x9c1fc7);const _0x2d8c97=await fetch(this[_0xb2e0e5(0x1ad)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0xb2e0e5(0x1b7),'User-Agent':_0xb2e0e5(0x155)},'body':JSON[_0xb2e0e5(0x164)](_0x9c1fc7)}),_0x1fe556=Date[_0xb2e0e5(0x19f)]()-_0x5d2891;console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x172)),console[_0xb2e0e5(0x1c3)]('Status:',_0x2d8c97[_0xb2e0e5(0x185)]),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1cd),_0x1fe556+'ms');if(!_0x2d8c97['ok']){const _0x1f1a96=await _0x2d8c97['text']();console['error'](_0xb2e0e5(0x17f),_0x2d8c97[_0xb2e0e5(0x185)]),console[_0xb2e0e5(0x1bb)](_0xb2e0e5(0x18c),_0x1f1a96),loggerService_1[_0xb2e0e5(0x19e)][_0xb2e0e5(0x163)](_0xb2e0e5(0x17d),_0xb2e0e5(0x154),_0x2d8c97[_0xb2e0e5(0x185)],_0x1f1a96,_0x1fe556),loggerService_1['loggerService'][_0xb2e0e5(0x177)]('cointopay',_0xb2e0e5(0x154),_0xb2e0e5(0x1b1)+_0x2d8c97[_0xb2e0e5(0x185)]+':\x20'+_0x1f1a96);throw new Error(_0xb2e0e5(0x178)+_0x2d8c97[_0xb2e0e5(0x185)]);}const _0x4e932d=await _0x2d8c97['text']();console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x180),_0x4e932d);let _0x504667;try{_0x504667=JSON[_0xb2e0e5(0x1c9)](_0x4e932d);}catch(_0x3b73ce){console[_0xb2e0e5(0x1bb)](_0xb2e0e5(0x15c),_0x3b73ce),loggerService_1[_0xb2e0e5(0x19e)]['logWhiteDomainError'](_0xb2e0e5(0x17d),_0xb2e0e5(0x154),_0xb2e0e5(0x1ca)+_0x3b73ce);throw new Error(_0xb2e0e5(0x156)+_0x4e932d);}loggerService_1[_0xb2e0e5(0x19e)]['logWhiteDomainResponse'](_0xb2e0e5(0x17d),'/status',_0x2d8c97[_0xb2e0e5(0x185)],_0x504667,_0x1fe556),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1ba)),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1c1),_0x504667[_0xb2e0e5(0x1af)]),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1ab),_0x504667[_0xb2e0e5(0x1d1)]),console['log'](_0xb2e0e5(0x18f),_0x504667['data']?.[_0xb2e0e5(0x15e)]),console[_0xb2e0e5(0x1c3)]('Amount:',_0x504667[_0xb2e0e5(0x1d3)]?.[_0xb2e0e5(0x1d2)]),console['log'](_0xb2e0e5(0x1ce),_0x504667[_0xb2e0e5(0x1d3)]?.[_0xb2e0e5(0x17e)]);if(_0x504667['result']!==_0xb2e0e5(0x173)||_0x504667[_0xb2e0e5(0x1d1)]!==0xc8){const _0x3e6da0=_0x504667[_0xb2e0e5(0x16a)]||_0xb2e0e5(0x168);console[_0xb2e0e5(0x1bb)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0xb2e0e5(0x1bb)](_0xb2e0e5(0x160),_0x3e6da0),loggerService_1[_0xb2e0e5(0x19e)][_0xb2e0e5(0x177)](_0xb2e0e5(0x17d),_0xb2e0e5(0x154),_0xb2e0e5(0x1a6)+_0x3e6da0);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x3e6da0);}if(!_0x504667['data']){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xb2e0e5(0x1bb)](_0xb2e0e5(0x1a8)),loggerService_1[_0xb2e0e5(0x19e)][_0xb2e0e5(0x177)]('cointopay',_0xb2e0e5(0x154),_0xb2e0e5(0x18d));throw new Error(_0xb2e0e5(0x1b6));}let _0xfd7467=_0xb2e0e5(0x1bd);switch(_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x15e)]?.[_0xb2e0e5(0x16f)]()){case'paid':_0xfd7467=_0xb2e0e5(0x1a1);break;case _0xb2e0e5(0x1d4):case _0xb2e0e5(0x15a):case'error':_0xfd7467=_0xb2e0e5(0x16c);break;case _0xb2e0e5(0x16e):case _0xb2e0e5(0x16d):_0xfd7467=_0xb2e0e5(0x1a9);break;case _0xb2e0e5(0x1c5):case _0xb2e0e5(0x1a0):case'pending':case'created':default:_0xfd7467='PENDING';break;}let _0x52f926,_0x1c1e89;if(_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x18b)]){const _0x46233d=_0x504667['data'][_0xb2e0e5(0x18b)];console['log'](_0xb2e0e5(0x15d),_0x46233d);const _0x592bb=_0x46233d[_0xb2e0e5(0x15b)](/IBAN\s+([A-Z0-9]+)/i);_0x592bb&&(_0x52f926=_0x592bb[0x1],console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1d5),_0x52f926)),_0x1c1e89=_0x46233d;}const _0x102575={'iban':_0x52f926,'bankDetails':_0x1c1e89,'transactionId':_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1a5)],'coinAddress':_0x504667[_0xb2e0e5(0x1d3)]['coinAddress'],'qrCodeUrl':_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1c4)],'expiryTime':_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x199)],'createdOn':_0x504667['data'][_0xb2e0e5(0x19a)],'confirmedOn':_0x504667['data'][_0xb2e0e5(0x1b9)]};console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1c8)),console['log'](_0xb2e0e5(0x1b8),_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x15e)],'->',_0xfd7467),console[_0xb2e0e5(0x1c3)]('Amount:',_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1d2)],_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x17e)]),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1ac),_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1a5)]),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x18e),_0x52f926||'not\x20found'),console[_0xb2e0e5(0x1c3)](_0xb2e0e5(0x1c0),_0x504667['data'][_0xb2e0e5(0x19a)]),console['log']('Confirmed\x20On:',_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1b9)]||_0xb2e0e5(0x1b4));if(_0x504667['data'][_0xb2e0e5(0x15e)]?.['toLowerCase']()===_0xb2e0e5(0x1a0))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x504667[_0xb2e0e5(0x1d3)]['Status']?.['toLowerCase']()===_0xb2e0e5(0x17b)&&console[_0xb2e0e5(0x1c3)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0xfd7467,'amount':parseFloat(_0x504667[_0xb2e0e5(0x1d3)][_0xb2e0e5(0x1d2)])||undefined,'currency':_0x504667[_0xb2e0e5(0x1d3)]['inputCurrency']||_0xb2e0e5(0x158),'paymentDetails':_0x102575};}catch(_0xa664b8){console['error'](_0xb2e0e5(0x197),_0xa664b8),loggerService_1[_0xb2e0e5(0x19e)][_0xb2e0e5(0x177)](_0xb2e0e5(0x17d),_0xb2e0e5(0x154),_0xa664b8);throw new Error(_0xb2e0e5(0x192)+(_0xa664b8 instanceof Error?_0xa664b8[_0xb2e0e5(0x16a)]:_0xb2e0e5(0x174)));}}async[a40_0xaf3773(0x190)](_0x519b22){const _0x5b7762=a40_0xaf3773,_0x1f2dc3=await this[_0x5b7762(0x166)](_0x519b22);return{'status':_0x1f2dc3[_0x5b7762(0x185)],'amount':_0x1f2dc3[_0x5b7762(0x153)],'currency':_0x1f2dc3[_0x5b7762(0x1cc)]};}async[a40_0xaf3773(0x193)](_0xb29fd9){const _0x2a7c0c=a40_0xaf3773;console[_0x2a7c0c(0x1c3)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0xb29fd9);let _0x3832db=_0x2a7c0c(0x1bd);switch(_0xb29fd9[_0x2a7c0c(0x185)]?.['toLowerCase']()){case _0x2a7c0c(0x17b):_0x3832db=_0x2a7c0c(0x1a1);break;case _0x2a7c0c(0x1d4):case _0x2a7c0c(0x15a):case'error':_0x3832db=_0x2a7c0c(0x16c);break;case _0x2a7c0c(0x16e):case'timeout':_0x3832db=_0x2a7c0c(0x1a9);break;case _0x2a7c0c(0x1aa):case _0x2a7c0c(0x1c5):case _0x2a7c0c(0x1a0):case _0x2a7c0c(0x198):default:_0x3832db=_0x2a7c0c(0x1bd);break;}return{'paymentId':_0xb29fd9[_0x2a7c0c(0x15f)]||_0xb29fd9[_0x2a7c0c(0x1b0)]||'','status':_0x3832db,'amount':_0xb29fd9['amount'],'currency':_0xb29fd9[_0x2a7c0c(0x1cc)]||_0x2a7c0c(0x158)};}}exports[a40_0xaf3773(0x189)]=CoinToPayService;