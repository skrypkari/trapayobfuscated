'use strict';function a41_0x1b67(){const _0x5cef9f=['Amount','message','Response\x20data:','EXPIRED','application/json','Status\x20Code:','POST','Amount:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','text','CoinToPay\x20status\x20API\x20error:\x20','coinAddress','Payment\x20Status:','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20Time:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','created','cointopay','status_code','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','3157236awXtjl','HTTP\x20','not\x20found','10ErcPja','31726480hkxvuh','Transaction\x20ID:','FAILED','Created\x20On:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','verifyPayment','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','cancelled','stringify','payment_url','IBAN:','apiUrl','Payment\x20URL:','6955361HeJfQN','HTTP\x20error!\x20status:\x20','4wDKSXM','loggerService','Status\x20Text:','Unknown\x20error','TransactionConfirmedOn','742042cxcPXb','entries','/create','__esModule','ExpiryTime','Status','checkPaymentStatus','9sUteXc','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','toLowerCase','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','1468416aKWDlb','PENDING','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','defineProperty','timeout','not\x20confirmed','currency','now','logWhiteDomainError','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','10194588rvfIVc','stack','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','fromEntries','inputCurrency','Error\x20message:','https://tesoft.uk/gateway/cointopay/','HTTP\x20Status:','error','Business\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','logWhiteDomainRequest','PaymentDetail','data','Result:','success','statusUrl','TesSoft\x20Payment\x20System/1.0','/status','result','Incomplete\x20response:\x20missing\x20data','Status:','===\x20COINTOPAY\x20SUCCESS\x20===','awaiting\x20fiat','611670jsOERO','Raw\x20Response\x20Body:','failed','order_id','status','logWhiteDomainResponse','PAID','CoinToPayService','Currency:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','CreatedOn','log','paid','\x20EUR','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','üè¶\x20Extracted\x20IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','gateway_payment_id','Error\x20details:','Error\x20Message:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','expired','waiting','üè¶\x20Payment\x20Detail:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','createPaymentLink','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','parse','Failed\x20to\x20parse\x20JSON\x20response:','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','TransactionID'];a41_0x1b67=function(){return _0x5cef9f;};return a41_0x1b67();}const a41_0x1aad23=a41_0x15fb;function a41_0x15fb(_0x586029,_0x48d885){const _0x1b6763=a41_0x1b67();return a41_0x15fb=function(_0x15fb93,_0x11f324){_0x15fb93=_0x15fb93-0x12a;let _0x4b6efa=_0x1b6763[_0x15fb93];return _0x4b6efa;},a41_0x15fb(_0x586029,_0x48d885);}(function(_0x33482a,_0x1c3a6b){const _0x359526=a41_0x15fb,_0x10e52e=_0x33482a();while(!![]){try{const _0x1a07de=-parseInt(_0x359526(0x192))/0x1+-parseInt(_0x359526(0x18d))/0x2*(parseInt(_0x359526(0x144))/0x3)+-parseInt(_0x359526(0x17a))/0x4*(parseInt(_0x359526(0x17d))/0x5)+parseInt(_0x359526(0x12b))/0x6+-parseInt(_0x359526(0x18b))/0x7+parseInt(_0x359526(0x19d))/0x8*(-parseInt(_0x359526(0x199))/0x9)+parseInt(_0x359526(0x17e))/0xa;if(_0x1a07de===_0x1c3a6b)break;else _0x10e52e['push'](_0x10e52e['shift']());}catch(_0x542667){_0x10e52e['push'](_0x10e52e['shift']());}}}(a41_0x1b67,0xebdf3));Object[a41_0x1aad23(0x1a1)](exports,a41_0x1aad23(0x195),{'value':!![]}),exports[a41_0x1aad23(0x14b)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x2a7d03=a41_0x1aad23;this[_0x2a7d03(0x189)]=_0x2a7d03(0x132),this[_0x2a7d03(0x13c)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x2a7d03(0x14d)),console[_0x2a7d03(0x14f)]('üìä\x20Status\x20check\x20URL:',this[_0x2a7d03(0x13c)]);}async[a41_0x1aad23(0x15e)](_0x510efd){const _0x589095=a41_0x1aad23,{orderId:_0x1ef2db,amount:_0x2a5d06}=_0x510efd;console[_0x589095(0x14f)](_0x589095(0x19a)+_0x2a5d06+_0x589095(0x151));const _0x4220fe={'amount':_0x2a5d06},_0x24b2bb=Date['now']();try{console[_0x589095(0x14f)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log']('URL:',this[_0x589095(0x189)]),console[_0x589095(0x14f)]('Request\x20Body:',JSON['stringify'](_0x4220fe,null,0x2)),console['log'](_0x589095(0x16d),_0x2a5d06,_0x589095(0x12d)),loggerService_1[_0x589095(0x18e)][_0x589095(0x137)](_0x589095(0x177),'/create',_0x589095(0x16c),_0x4220fe);const _0x2fd970=await fetch(this[_0x589095(0x189)],{'method':_0x589095(0x16c),'headers':{'Content-Type':_0x589095(0x16a),'Accept':'application/json','User-Agent':_0x589095(0x13d)},'body':JSON[_0x589095(0x186)](_0x4220fe)}),_0x1b27d0=Date[_0x589095(0x1a5)]()-_0x24b2bb;console[_0x589095(0x14f)](_0x589095(0x182)),console['log'](_0x589095(0x141),_0x2fd970[_0x589095(0x148)]),console[_0x589095(0x14f)](_0x589095(0x18f),_0x2fd970['statusText']),console[_0x589095(0x14f)]('Headers:',Object[_0x589095(0x12f)](_0x2fd970['headers'][_0x589095(0x193)]())),console[_0x589095(0x14f)](_0x589095(0x174),_0x1b27d0+'ms');const _0x5b2cb2=await _0x2fd970[_0x589095(0x16f)]();console[_0x589095(0x14f)](_0x589095(0x145),_0x5b2cb2);if(!_0x2fd970['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x589095(0x134)]('HTTP\x20Status:',_0x2fd970[_0x589095(0x148)]),console[_0x589095(0x134)]('Response\x20Body:',_0x5b2cb2),loggerService_1[_0x589095(0x18e)][_0x589095(0x149)](_0x589095(0x177),_0x589095(0x194),_0x2fd970['status'],_0x5b2cb2,_0x1b27d0),loggerService_1[_0x589095(0x18e)][_0x589095(0x1a6)](_0x589095(0x177),_0x589095(0x194),_0x589095(0x17b)+_0x2fd970['status']+':\x20'+_0x5b2cb2);throw new Error(_0x589095(0x18c)+_0x2fd970[_0x589095(0x148)]+',\x20body:\x20'+_0x5b2cb2);}let _0x49c130;try{_0x49c130=JSON[_0x589095(0x161)](_0x5b2cb2);}catch(_0x2f1255){console[_0x589095(0x134)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x2f1255),loggerService_1['loggerService']['logWhiteDomainError'](_0x589095(0x177),_0x589095(0x194),_0x589095(0x15f)+_0x2f1255);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5b2cb2);}console[_0x589095(0x14f)](_0x589095(0x12e)),console[_0x589095(0x14f)]('Parsed\x20Result:',JSON[_0x589095(0x186)](_0x49c130,null,0x2)),loggerService_1[_0x589095(0x18e)][_0x589095(0x149)](_0x589095(0x177),'/create',_0x2fd970[_0x589095(0x148)],_0x49c130,_0x1b27d0);if(_0x49c130[_0x589095(0x134)]){const _0x445b9f=_0x49c130[_0x589095(0x167)]||_0x49c130['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x589095(0x134)](_0x589095(0x164)),console[_0x589095(0x134)](_0x589095(0x158),_0x445b9f),loggerService_1['loggerService'][_0x589095(0x1a6)]('cointopay',_0x589095(0x194),_0x589095(0x135)+_0x445b9f);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x445b9f);}if(!_0x49c130['payment_url']||!_0x49c130['gateway_payment_id']){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x589095(0x134)](_0x589095(0x1a7)),console[_0x589095(0x134)](_0x589095(0x168),_0x49c130),loggerService_1[_0x589095(0x18e)][_0x589095(0x1a6)](_0x589095(0x177),_0x589095(0x194),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x589095(0x12a));}return console['log'](_0x589095(0x142)),console[_0x589095(0x14f)]('Gateway\x20Payment\x20ID:',_0x49c130['gateway_payment_id']),console[_0x589095(0x14f)](_0x589095(0x18a),_0x49c130[_0x589095(0x187)]),console[_0x589095(0x14f)](_0x589095(0x16d),_0x2a5d06,'EUR'),{'gateway_payment_id':_0x49c130[_0x589095(0x156)],'payment_url':_0x49c130['payment_url']};}catch(_0x3778cb){console[_0x589095(0x134)](_0x589095(0x184)),console[_0x589095(0x134)](_0x589095(0x157),_0x3778cb),loggerService_1['loggerService']['logWhiteDomainError'](_0x589095(0x177),_0x589095(0x194),_0x3778cb);if(_0x3778cb instanceof Error){console['error'](_0x589095(0x131),_0x3778cb[_0x589095(0x167)]),console[_0x589095(0x134)]('Error\x20stack:',_0x3778cb[_0x589095(0x12c)]);throw new Error(_0x589095(0x179)+_0x3778cb[_0x589095(0x167)]);}throw new Error(_0x589095(0x160));}}async[a41_0x1aad23(0x198)](_0x17de0a){const _0x44e73e=a41_0x1aad23,_0x46503e=Date[_0x44e73e(0x1a5)]();try{console[_0x44e73e(0x14f)](_0x44e73e(0x15d)+_0x17de0a);const _0x7067f3={'gatewayPaymentId':_0x17de0a};loggerService_1['loggerService'][_0x44e73e(0x137)]('cointopay',_0x44e73e(0x13e),_0x44e73e(0x16c),_0x7067f3);const _0x23cd1d=await fetch(this[_0x44e73e(0x13c)],{'method':_0x44e73e(0x16c),'headers':{'Content-Type':_0x44e73e(0x16a),'Accept':_0x44e73e(0x16a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x44e73e(0x186)](_0x7067f3)}),_0x9ad5aa=Date[_0x44e73e(0x1a5)]()-_0x46503e;console[_0x44e73e(0x14f)](_0x44e73e(0x159)),console[_0x44e73e(0x14f)]('Status:',_0x23cd1d[_0x44e73e(0x148)]),console[_0x44e73e(0x14f)](_0x44e73e(0x174),_0x9ad5aa+'ms');if(!_0x23cd1d['ok']){const _0x44b215=await _0x23cd1d[_0x44e73e(0x16f)]();console[_0x44e73e(0x134)](_0x44e73e(0x133),_0x23cd1d[_0x44e73e(0x148)]),console[_0x44e73e(0x134)]('Response\x20Body:',_0x44b215),loggerService_1[_0x44e73e(0x18e)][_0x44e73e(0x149)]('cointopay',_0x44e73e(0x13e),_0x23cd1d[_0x44e73e(0x148)],_0x44b215,_0x9ad5aa),loggerService_1['loggerService'][_0x44e73e(0x1a6)](_0x44e73e(0x177),_0x44e73e(0x13e),_0x44e73e(0x17b)+_0x23cd1d[_0x44e73e(0x148)]+':\x20'+_0x44b215);throw new Error(_0x44e73e(0x18c)+_0x23cd1d[_0x44e73e(0x148)]);}const _0x2d707e=await _0x23cd1d[_0x44e73e(0x16f)]();console[_0x44e73e(0x14f)](_0x44e73e(0x145),_0x2d707e);let _0x3b56a3;try{_0x3b56a3=JSON['parse'](_0x2d707e);}catch(_0x214f9e){console[_0x44e73e(0x134)](_0x44e73e(0x162),_0x214f9e),loggerService_1[_0x44e73e(0x18e)][_0x44e73e(0x1a6)](_0x44e73e(0x177),_0x44e73e(0x13e),'JSON\x20Parse\x20Error:\x20'+_0x214f9e);throw new Error(_0x44e73e(0x16e)+_0x2d707e);}loggerService_1['loggerService'][_0x44e73e(0x149)](_0x44e73e(0x177),_0x44e73e(0x13e),_0x23cd1d[_0x44e73e(0x148)],_0x3b56a3,_0x9ad5aa),console[_0x44e73e(0x14f)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x44e73e(0x14f)](_0x44e73e(0x13a),_0x3b56a3['result']),console['log'](_0x44e73e(0x16b),_0x3b56a3[_0x44e73e(0x178)]),console[_0x44e73e(0x14f)](_0x44e73e(0x172),_0x3b56a3[_0x44e73e(0x139)]?.[_0x44e73e(0x197)]),console['log']('Amount:',_0x3b56a3['data']?.[_0x44e73e(0x166)]),console[_0x44e73e(0x14f)](_0x44e73e(0x14c),_0x3b56a3[_0x44e73e(0x139)]?.[_0x44e73e(0x130)]);if(_0x3b56a3[_0x44e73e(0x13f)]!==_0x44e73e(0x13b)||_0x3b56a3['status_code']!==0xc8){const _0x2a5179=_0x3b56a3[_0x44e73e(0x167)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x44e73e(0x134)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x44e73e(0x158),_0x2a5179),loggerService_1[_0x44e73e(0x18e)][_0x44e73e(0x1a6)]('cointopay',_0x44e73e(0x13e),_0x44e73e(0x19f)+_0x2a5179);throw new Error(_0x44e73e(0x170)+_0x2a5179);}if(!_0x3b56a3['data']){console[_0x44e73e(0x134)](_0x44e73e(0x1a0)),console[_0x44e73e(0x134)](_0x44e73e(0x163)),loggerService_1[_0x44e73e(0x18e)][_0x44e73e(0x1a6)](_0x44e73e(0x177),_0x44e73e(0x13e),_0x44e73e(0x140));throw new Error(_0x44e73e(0x154));}let _0x84a21a=_0x44e73e(0x19e);switch(_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x197)]?.[_0x44e73e(0x19b)]()){case _0x44e73e(0x150):_0x84a21a='PAID';break;case _0x44e73e(0x185):case _0x44e73e(0x146):case _0x44e73e(0x134):_0x84a21a='FAILED';break;case _0x44e73e(0x15a):case _0x44e73e(0x1a2):_0x84a21a='EXPIRED';break;case _0x44e73e(0x15b):case _0x44e73e(0x143):case'pending':case'created':default:_0x84a21a=_0x44e73e(0x19e);break;}let _0x4f1144,_0x1ae16b;if(_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x138)]){const _0x1d6284=_0x3b56a3[_0x44e73e(0x139)]['PaymentDetail'];console[_0x44e73e(0x14f)](_0x44e73e(0x15c),_0x1d6284);const _0x5f59ed=_0x1d6284['match'](/IBAN\s+([A-Z0-9]+)/i);_0x5f59ed&&(_0x4f1144=_0x5f59ed[0x1],console[_0x44e73e(0x14f)](_0x44e73e(0x153),_0x4f1144)),_0x1ae16b=_0x1d6284;}const _0x4c3f91={'iban':_0x4f1144,'bankDetails':_0x1ae16b,'transactionId':_0x3b56a3['data'][_0x44e73e(0x165)],'coinAddress':_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x171)],'qrCodeUrl':_0x3b56a3[_0x44e73e(0x139)]['QRCodeURL'],'expiryTime':_0x3b56a3['data'][_0x44e73e(0x196)],'createdOn':_0x3b56a3['data']['CreatedOn'],'confirmedOn':_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x191)]};console[_0x44e73e(0x14f)](_0x44e73e(0x136)),console[_0x44e73e(0x14f)](_0x44e73e(0x141),_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x197)],'->',_0x84a21a),console[_0x44e73e(0x14f)](_0x44e73e(0x16d),_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x166)],_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x130)]),console[_0x44e73e(0x14f)](_0x44e73e(0x17f),_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x165)]),console[_0x44e73e(0x14f)](_0x44e73e(0x188),_0x4f1144||_0x44e73e(0x17c)),console['log'](_0x44e73e(0x181),_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x14e)]),console[_0x44e73e(0x14f)]('Confirmed\x20On:',_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x191)]||_0x44e73e(0x1a3));if(_0x3b56a3[_0x44e73e(0x139)][_0x44e73e(0x197)]?.[_0x44e73e(0x19b)]()===_0x44e73e(0x143))console[_0x44e73e(0x14f)](_0x44e73e(0x175));else _0x3b56a3[_0x44e73e(0x139)]['Status']?.[_0x44e73e(0x19b)]()===_0x44e73e(0x150)&&console['log'](_0x44e73e(0x19c));return{'status':_0x84a21a,'amount':parseFloat(_0x3b56a3['data']['Amount'])||undefined,'currency':_0x3b56a3['data'][_0x44e73e(0x130)]||'EUR','paymentDetails':_0x4c3f91};}catch(_0x4a52b3){console[_0x44e73e(0x134)](_0x44e73e(0x173),_0x4a52b3),loggerService_1[_0x44e73e(0x18e)][_0x44e73e(0x1a6)]('cointopay','/status',_0x4a52b3);throw new Error(_0x44e73e(0x155)+(_0x4a52b3 instanceof Error?_0x4a52b3[_0x44e73e(0x167)]:_0x44e73e(0x190)));}}async[a41_0x1aad23(0x183)](_0x105aa3){const _0x4b9391=a41_0x1aad23,_0x13f06b=await this[_0x4b9391(0x198)](_0x105aa3);return{'status':_0x13f06b[_0x4b9391(0x148)],'amount':_0x13f06b['amount'],'currency':_0x13f06b[_0x4b9391(0x1a4)]};}async['processWebhook'](_0x46c5d3){const _0x22f67e=a41_0x1aad23;console[_0x22f67e(0x14f)](_0x22f67e(0x152),_0x46c5d3);let _0x448c66=_0x22f67e(0x19e);switch(_0x46c5d3[_0x22f67e(0x148)]?.['toLowerCase']()){case'paid':_0x448c66=_0x22f67e(0x14a);break;case _0x22f67e(0x185):case _0x22f67e(0x146):case _0x22f67e(0x134):_0x448c66=_0x22f67e(0x180);break;case _0x22f67e(0x15a):case _0x22f67e(0x1a2):_0x448c66=_0x22f67e(0x169);break;case'pending':case _0x22f67e(0x15b):case _0x22f67e(0x143):case _0x22f67e(0x176):default:_0x448c66=_0x22f67e(0x19e);break;}return{'paymentId':_0x46c5d3[_0x22f67e(0x147)]||_0x46c5d3['merchant_reference_id']||'','status':_0x448c66,'amount':_0x46c5d3['amount'],'currency':_0x46c5d3[_0x22f67e(0x1a4)]||'EUR'};}}exports[a41_0x1aad23(0x14b)]=CoinToPayService;