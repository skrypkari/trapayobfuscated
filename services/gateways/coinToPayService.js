'use strict';function a65_0x1123(_0x22f682,_0x5a4429){_0x22f682=_0x22f682-0xf1;const _0x4a8008=a65_0x4a80();let _0x1123ff=_0x4a8008[_0x22f682];return _0x1123ff;}const a65_0x142953=a65_0x1123;function a65_0x4a80(){const _0x202c2b=['application/json','/status','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/','PENDING','created','76sIADSi','processWebhook','cancelled','1851918qotQgp','CreatedOn','not\x20confirmed','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','inputCurrency','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Status','error','Amount','result','status_code','13611vtoynq','Incomplete\x20response:\x20missing\x20data','log','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Response\x20Time:','Status\x20Text:','createPaymentLink','merchant_reference_id','HTTP\x20','coinAddress','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','now','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','apiUrl','statusUrl','9kHYGxK','order_id','Amount:','logWhiteDomainError','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SUCCESS\x20===','awaiting\x20fiat','TransactionConfirmedOn','checkPaymentStatus','3985235RULtzn','defineProperty','statusText','fromEntries','../loggerService','QRCodeURL','Response\x20data:','timeout','\x20EUR','URL:','CoinToPay\x20API\x20error:\x20','Business\x20Error:\x20','message','Confirmed\x20On:','Request\x20Body:','Payment\x20System/1.0','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Payment\x20URL\x20(original):','ExpiryTime','1273125VvTYcS','headers','TransactionID','payment_url','paid','Raw\x20Response\x20Body:','pending','CoinToPay\x20payment\x20status\x20check\x20error:','stringify','gateway_payment_id','toLowerCase','Result:','6795912aqLRKW','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','loggerService','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','currency','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','success','Error\x20message:','PAID','Unknown\x20error','data','status','expired','&alternative=false','entries','FAILED','logWhiteDomainResponse','ðŸ“Š\x20Status\x20check\x20URL:',',\x20body:\x20','PaymentDetail','waiting','HTTP\x20Status:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','__esModule','EUR','Failed\x20to\x20parse\x20JSON\x20response:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','parse','POST','JSON\x20Parse\x20Error:\x20','Payment\x20URL\x20(modified):','146134PUowLu','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','Status:','Missing\x20data\x20in\x20response','Response\x20Body:','cointopay','failed','EXPIRED','572029zcnsJq','Created\x20On:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20Message:','text','logWhiteDomainRequest','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','/create','CoinToPayService'];a65_0x4a80=function(){return _0x202c2b;};return a65_0x4a80();}(function(_0x146e7e,_0x401fe4){const _0x47f379=a65_0x1123,_0x72e268=_0x146e7e();while(!![]){try{const _0xbe38af=parseInt(_0x47f379(0x141))/0x1+parseInt(_0x47f379(0x137))/0x2+-parseInt(_0x47f379(0x162))/0x3*(-parseInt(_0x47f379(0x151))/0x4)+parseInt(_0x47f379(0xf8))/0x5+-parseInt(_0x47f379(0x154))/0x6+parseInt(_0x47f379(0x10b))/0x7+parseInt(_0x47f379(0x117))/0x8*(-parseInt(_0x47f379(0x174))/0x9);if(_0xbe38af===_0x401fe4)break;else _0x72e268['push'](_0x72e268['shift']());}catch(_0x5e3f64){_0x72e268['push'](_0x72e268['shift']());}}}(a65_0x4a80,0x86c8f));Object[a65_0x142953(0xf9)](exports,a65_0x142953(0x12f),{'value':!![]}),exports[a65_0x142953(0x14a)]=void 0x0;const loggerService_1=require(a65_0x142953(0xfc));class CoinToPayService{constructor(){const _0x117885=a65_0x142953;this[_0x117885(0x172)]=_0x117885(0x14e),this['statusUrl']=_0x117885(0xf3),console[_0x117885(0x164)](_0x117885(0x165)),console['log'](_0x117885(0x129),this[_0x117885(0x173)]);}async[a65_0x142953(0x168)](_0x2e035c){const _0x515453=a65_0x142953,{orderId:_0x637052,amount:_0x2e67f4}=_0x2e035c;console['log']('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2e67f4+_0x515453(0x100));const _0x352238={'amount':_0x2e67f4},_0x2ae421=Date[_0x515453(0x16e)]();try{console[_0x515453(0x164)](_0x515453(0x12e)),console[_0x515453(0x164)](_0x515453(0x101),this[_0x515453(0x172)]),console[_0x515453(0x164)](_0x515453(0x106),JSON[_0x515453(0x113)](_0x352238,null,0x2)),console['log'](_0x515453(0xf1),_0x2e67f4,_0x515453(0x147)),loggerService_1[_0x515453(0x119)][_0x515453(0x146)]('cointopay',_0x515453(0x149),_0x515453(0x134),_0x352238);const _0x114f05=await fetch(this[_0x515453(0x172)],{'method':_0x515453(0x134),'headers':{'Content-Type':_0x515453(0x14b),'Accept':_0x515453(0x14b),'User-Agent':_0x515453(0x107)},'body':JSON['stringify'](_0x352238)}),_0x393a3d=Date['now']()-_0x2ae421;console[_0x515453(0x164)](_0x515453(0x16c)),console[_0x515453(0x164)](_0x515453(0x13b),_0x114f05[_0x515453(0x123)]),console[_0x515453(0x164)](_0x515453(0x167),_0x114f05[_0x515453(0xfa)]),console[_0x515453(0x164)]('Headers:',Object[_0x515453(0xfb)](_0x114f05[_0x515453(0x10c)][_0x515453(0x126)]())),console[_0x515453(0x164)](_0x515453(0x166),_0x393a3d+'ms');const _0x55c2ac=await _0x114f05[_0x515453(0x145)]();console['log'](_0x515453(0x110),_0x55c2ac);if(!_0x114f05['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error']('HTTP\x20Status:',_0x114f05[_0x515453(0x123)]),console['error'](_0x515453(0x13d),_0x55c2ac),loggerService_1[_0x515453(0x119)][_0x515453(0x128)](_0x515453(0x13e),_0x515453(0x149),_0x114f05[_0x515453(0x123)],_0x55c2ac,_0x393a3d),loggerService_1[_0x515453(0x119)][_0x515453(0xf2)]('cointopay',_0x515453(0x149),_0x515453(0x16a)+_0x114f05[_0x515453(0x123)]+':\x20'+_0x55c2ac);throw new Error(_0x515453(0x138)+_0x114f05[_0x515453(0x123)]+_0x515453(0x12a)+_0x55c2ac);}let _0x37c858;try{_0x37c858=JSON[_0x515453(0x133)](_0x55c2ac);}catch(_0x2cac7a){console[_0x515453(0x15e)](_0x515453(0x131),_0x2cac7a),loggerService_1['loggerService'][_0x515453(0xf2)](_0x515453(0x13e),_0x515453(0x149),_0x515453(0x135)+_0x2cac7a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x55c2ac);}console[_0x515453(0x164)](_0x515453(0x118)),console[_0x515453(0x164)]('Parsed\x20Result:',JSON['stringify'](_0x37c858,null,0x2)),loggerService_1[_0x515453(0x119)][_0x515453(0x128)]('cointopay',_0x515453(0x149),_0x114f05[_0x515453(0x123)],_0x37c858,_0x393a3d);if(_0x37c858[_0x515453(0x15e)]){const _0x208a22=_0x37c858[_0x515453(0x104)]||_0x37c858[_0x515453(0x15e)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x515453(0x15e)](_0x515453(0x16d)),console['error']('Error\x20Message:',_0x208a22),loggerService_1[_0x515453(0x119)]['logWhiteDomainError'](_0x515453(0x13e),_0x515453(0x149),_0x515453(0x103)+_0x208a22);throw new Error(_0x515453(0x102)+_0x208a22);}if(!_0x37c858['payment_url']||!_0x37c858[_0x515453(0x114)]){console[_0x515453(0x15e)](_0x515453(0x139)),console['error'](_0x515453(0x11a)),console[_0x515453(0x15e)](_0x515453(0xfe),_0x37c858),loggerService_1[_0x515453(0x119)][_0x515453(0xf2)](_0x515453(0x13e),_0x515453(0x149),_0x515453(0x132));throw new Error(_0x515453(0x11c));}console[_0x515453(0x164)](_0x515453(0xf4)),console[_0x515453(0x164)]('Gateway\x20Payment\x20ID:',_0x37c858['gateway_payment_id']),console[_0x515453(0x164)](_0x515453(0x109),_0x37c858[_0x515453(0x10e)]);const _0x1fc323=_0x37c858[_0x515453(0x10e)]+_0x515453(0x125);return console['log'](_0x515453(0x136),_0x1fc323),console[_0x515453(0x164)]('Amount:',_0x2e67f4,'EUR'),{'gateway_payment_id':_0x37c858['gateway_payment_id'],'payment_url':_0x1fc323};}catch(_0xe0dc66){console[_0x515453(0x15e)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0xe0dc66),loggerService_1['loggerService'][_0x515453(0xf2)](_0x515453(0x13e),_0x515453(0x149),_0xe0dc66);if(_0xe0dc66 instanceof Error){console['error'](_0x515453(0x11f),_0xe0dc66[_0x515453(0x104)]),console['error']('Error\x20stack:',_0xe0dc66['stack']);throw new Error(_0x515453(0x143)+_0xe0dc66[_0x515453(0x104)]);}throw new Error(_0x515453(0x171));}}async['checkPaymentStatus'](_0x102f96){const _0x68d913=a65_0x142953,_0x67178=Date[_0x68d913(0x16e)]();try{console[_0x68d913(0x164)](_0x68d913(0x11d)+_0x102f96);const _0x2498fa={'gatewayPaymentId':_0x102f96};loggerService_1[_0x68d913(0x119)][_0x68d913(0x146)](_0x68d913(0x13e),_0x68d913(0x14c),'POST',_0x2498fa);const _0x58e58c=await fetch(this[_0x68d913(0x173)],{'method':'POST','headers':{'Content-Type':_0x68d913(0x14b),'Accept':_0x68d913(0x14b),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x68d913(0x113)](_0x2498fa)}),_0x1c860a=Date['now']()-_0x67178;console[_0x68d913(0x164)](_0x68d913(0x14d)),console[_0x68d913(0x164)](_0x68d913(0x13b),_0x58e58c[_0x68d913(0x123)]),console[_0x68d913(0x164)](_0x68d913(0x166),_0x1c860a+'ms');if(!_0x58e58c['ok']){const _0x1f41c1=await _0x58e58c[_0x68d913(0x145)]();console[_0x68d913(0x15e)](_0x68d913(0x12d),_0x58e58c[_0x68d913(0x123)]),console[_0x68d913(0x15e)](_0x68d913(0x13d),_0x1f41c1),loggerService_1[_0x68d913(0x119)][_0x68d913(0x128)](_0x68d913(0x13e),'/status',_0x58e58c['status'],_0x1f41c1,_0x1c860a),loggerService_1[_0x68d913(0x119)][_0x68d913(0xf2)](_0x68d913(0x13e),'/status',_0x68d913(0x16a)+_0x58e58c[_0x68d913(0x123)]+':\x20'+_0x1f41c1);throw new Error(_0x68d913(0x138)+_0x58e58c[_0x68d913(0x123)]);}const _0x12560e=await _0x58e58c[_0x68d913(0x145)]();console[_0x68d913(0x164)](_0x68d913(0x110),_0x12560e);let _0x180487;try{_0x180487=JSON[_0x68d913(0x133)](_0x12560e);}catch(_0x8efdcb){console[_0x68d913(0x15e)](_0x68d913(0x131),_0x8efdcb),loggerService_1[_0x68d913(0x119)][_0x68d913(0xf2)](_0x68d913(0x13e),_0x68d913(0x14c),_0x68d913(0x135)+_0x8efdcb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x12560e);}loggerService_1['loggerService'][_0x68d913(0x128)](_0x68d913(0x13e),_0x68d913(0x14c),_0x58e58c[_0x68d913(0x123)],_0x180487,_0x1c860a),console[_0x68d913(0x164)](_0x68d913(0x108)),console['log'](_0x68d913(0x116),_0x180487['result']),console[_0x68d913(0x164)]('Status\x20Code:',_0x180487['status_code']),console[_0x68d913(0x164)](_0x68d913(0x159),_0x180487[_0x68d913(0x122)]?.['Status']),console[_0x68d913(0x164)](_0x68d913(0xf1),_0x180487[_0x68d913(0x122)]?.[_0x68d913(0x15f)]),console[_0x68d913(0x164)](_0x68d913(0x13a),_0x180487[_0x68d913(0x122)]?.[_0x68d913(0x158)]);if(_0x180487[_0x68d913(0x160)]!==_0x68d913(0x11e)||_0x180487[_0x68d913(0x161)]!==0xc8){const _0x73e434=_0x180487[_0x68d913(0x104)]||_0x68d913(0x16f);console[_0x68d913(0x15e)](_0x68d913(0x15a)),console[_0x68d913(0x15e)](_0x68d913(0x144),_0x73e434),loggerService_1['loggerService'][_0x68d913(0xf2)]('cointopay',_0x68d913(0x14c),'Status\x20API\x20Error:\x20'+_0x73e434);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x73e434);}if(!_0x180487[_0x68d913(0x122)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x68d913(0x13c)),loggerService_1['loggerService'][_0x68d913(0xf2)](_0x68d913(0x13e),_0x68d913(0x14c),_0x68d913(0x163));throw new Error(_0x68d913(0x157));}let _0x223122=_0x68d913(0x14f);switch(_0x180487[_0x68d913(0x122)]['Status']?.[_0x68d913(0x115)]()){case _0x68d913(0x10f):_0x223122=_0x68d913(0x120);break;case _0x68d913(0x153):case _0x68d913(0x13f):case'error':_0x223122=_0x68d913(0x127);break;case _0x68d913(0x124):case _0x68d913(0xff):_0x223122=_0x68d913(0x140);break;case _0x68d913(0x12c):case _0x68d913(0xf5):case'pending':case _0x68d913(0x150):default:_0x223122='PENDING';break;}let _0x41c9f4,_0x914ad3;if(_0x180487[_0x68d913(0x122)][_0x68d913(0x12b)]){const _0x489b8f=_0x180487[_0x68d913(0x122)][_0x68d913(0x12b)];console[_0x68d913(0x164)]('ðŸ¦\x20Payment\x20Detail:',_0x489b8f);const _0x438de2=_0x489b8f['match'](/IBAN\s+([A-Z0-9]+)/i);_0x438de2&&(_0x41c9f4=_0x438de2[0x1],console[_0x68d913(0x164)]('ðŸ¦\x20Extracted\x20IBAN:',_0x41c9f4)),_0x914ad3=_0x489b8f;}const _0x1cb32a={'iban':_0x41c9f4,'bankDetails':_0x914ad3,'transactionId':_0x180487[_0x68d913(0x122)][_0x68d913(0x10d)],'coinAddress':_0x180487['data'][_0x68d913(0x16b)],'qrCodeUrl':_0x180487[_0x68d913(0x122)][_0x68d913(0xfd)],'expiryTime':_0x180487[_0x68d913(0x122)][_0x68d913(0x10a)],'createdOn':_0x180487[_0x68d913(0x122)][_0x68d913(0x155)],'confirmedOn':_0x180487[_0x68d913(0x122)][_0x68d913(0xf6)]};console[_0x68d913(0x164)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x68d913(0x164)](_0x68d913(0x13b),_0x180487[_0x68d913(0x122)][_0x68d913(0x15d)],'->',_0x223122),console[_0x68d913(0x164)](_0x68d913(0xf1),_0x180487[_0x68d913(0x122)][_0x68d913(0x15f)],_0x180487[_0x68d913(0x122)]['inputCurrency']),console[_0x68d913(0x164)](_0x68d913(0x170),_0x180487[_0x68d913(0x122)][_0x68d913(0x10d)]),console['log']('IBAN:',_0x41c9f4||'not\x20found'),console[_0x68d913(0x164)](_0x68d913(0x142),_0x180487[_0x68d913(0x122)]['CreatedOn']),console[_0x68d913(0x164)](_0x68d913(0x105),_0x180487[_0x68d913(0x122)][_0x68d913(0xf6)]||_0x68d913(0x156));if(_0x180487['data'][_0x68d913(0x15d)]?.[_0x68d913(0x115)]()===_0x68d913(0xf5))console[_0x68d913(0x164)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x180487[_0x68d913(0x122)]['Status']?.[_0x68d913(0x115)]()===_0x68d913(0x10f)&&console['log']('âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x223122,'amount':parseFloat(_0x180487[_0x68d913(0x122)][_0x68d913(0x15f)])||undefined,'currency':_0x180487[_0x68d913(0x122)]['inputCurrency']||_0x68d913(0x130),'paymentDetails':_0x1cb32a};}catch(_0x3d96f8){console[_0x68d913(0x15e)](_0x68d913(0x112),_0x3d96f8),loggerService_1[_0x68d913(0x119)][_0x68d913(0xf2)](_0x68d913(0x13e),_0x68d913(0x14c),_0x3d96f8);throw new Error(_0x68d913(0x15c)+(_0x3d96f8 instanceof Error?_0x3d96f8['message']:_0x68d913(0x121)));}}async['verifyPayment'](_0xbfbc9e){const _0x2850f0=a65_0x142953,_0x149e4f=await this[_0x2850f0(0xf7)](_0xbfbc9e);return{'status':_0x149e4f[_0x2850f0(0x123)],'amount':_0x149e4f[_0x2850f0(0x15b)],'currency':_0x149e4f[_0x2850f0(0x11b)]};}async[a65_0x142953(0x152)](_0x318387){const _0x472144=a65_0x142953;console[_0x472144(0x164)](_0x472144(0x148),_0x318387);let _0x3e3cf4='PENDING';switch(_0x318387[_0x472144(0x123)]?.[_0x472144(0x115)]()){case _0x472144(0x10f):_0x3e3cf4=_0x472144(0x120);break;case _0x472144(0x153):case _0x472144(0x13f):case _0x472144(0x15e):_0x3e3cf4=_0x472144(0x127);break;case _0x472144(0x124):case _0x472144(0xff):_0x3e3cf4=_0x472144(0x140);break;case _0x472144(0x111):case _0x472144(0x12c):case _0x472144(0xf5):case _0x472144(0x150):default:_0x3e3cf4=_0x472144(0x14f);break;}return{'paymentId':_0x318387[_0x472144(0x175)]||_0x318387[_0x472144(0x169)]||'','status':_0x3e3cf4,'amount':_0x318387[_0x472144(0x15b)],'currency':_0x318387[_0x472144(0x11b)]||'EUR'};}}exports[a65_0x142953(0x14a)]=CoinToPayService;