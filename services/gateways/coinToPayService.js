'use strict';const a40_0x3f5a7e=a40_0x52c5;(function(_0x5c16ba,_0x59d81e){const _0x131838=a40_0x52c5,_0x267421=_0x5c16ba();while(!![]){try{const _0xeb0ba4=parseInt(_0x131838(0x1c7))/0x1*(parseInt(_0x131838(0x19a))/0x2)+-parseInt(_0x131838(0x1c8))/0x3+-parseInt(_0x131838(0x188))/0x4*(parseInt(_0x131838(0x182))/0x5)+parseInt(_0x131838(0x173))/0x6+-parseInt(_0x131838(0x1af))/0x7*(-parseInt(_0x131838(0x1cb))/0x8)+-parseInt(_0x131838(0x1a9))/0x9+parseInt(_0x131838(0x17d))/0xa;if(_0xeb0ba4===_0x59d81e)break;else _0x267421['push'](_0x267421['shift']());}catch(_0x4e4885){_0x267421['push'](_0x267421['shift']());}}}(a40_0x5ba0,0x929e8));Object['defineProperty'](exports,a40_0x3f5a7e(0x1ab),{'value':!![]}),exports[a40_0x3f5a7e(0x15c)]=void 0x0;const loggerService_1=require(a40_0x3f5a7e(0x17c));function a40_0x52c5(_0x4c04ed,_0x423bb5){const _0x5ba0bb=a40_0x5ba0();return a40_0x52c5=function(_0x52c5d7,_0x3bdb91){_0x52c5d7=_0x52c5d7-0x152;let _0x323133=_0x5ba0bb[_0x52c5d7];return _0x323133;},a40_0x52c5(_0x4c04ed,_0x423bb5);}class CoinToPayService{constructor(){const _0x21cfc5=a40_0x3f5a7e;this[_0x21cfc5(0x181)]=_0x21cfc5(0x15b),this[_0x21cfc5(0x16b)]=_0x21cfc5(0x194),console['log'](_0x21cfc5(0x1a7)),console[_0x21cfc5(0x16a)]('📊\x20Status\x20check\x20URL:',this[_0x21cfc5(0x16b)]);}async['createPaymentLink'](_0x37be57){const _0x1e5dc7=a40_0x3f5a7e,{orderId:_0x264da0,amount:_0x2393d9}=_0x37be57;console[_0x1e5dc7(0x16a)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2393d9+_0x1e5dc7(0x19d));const _0x1b6f84={'amount':_0x2393d9},_0x3d143d=Date[_0x1e5dc7(0x164)]();try{console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x1cd)),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x15a),this['apiUrl']),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x1bb),JSON['stringify'](_0x1b6f84,null,0x2)),console[_0x1e5dc7(0x16a)]('Amount:',_0x2393d9,_0x1e5dc7(0x1d5)),loggerService_1[_0x1e5dc7(0x18a)][_0x1e5dc7(0x1b3)]('cointopay','/create','POST',_0x1b6f84);const _0x5a267d=await fetch(this['apiUrl'],{'method':_0x1e5dc7(0x16e),'headers':{'Content-Type':_0x1e5dc7(0x16c),'Accept':_0x1e5dc7(0x16c),'User-Agent':_0x1e5dc7(0x160)},'body':JSON[_0x1e5dc7(0x1c5)](_0x1b6f84)}),_0x3fb909=Date[_0x1e5dc7(0x164)]()-_0x3d143d;console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x17b)),console[_0x1e5dc7(0x16a)]('Status:',_0x5a267d['status']),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x162),_0x5a267d[_0x1e5dc7(0x1ca)]),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x191),Object[_0x1e5dc7(0x1b4)](_0x5a267d['headers'][_0x1e5dc7(0x19c)]())),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x18f),_0x3fb909+'ms');const _0xe072=await _0x5a267d[_0x1e5dc7(0x19f)]();console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x1c6),_0xe072);if(!_0x5a267d['ok']){console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1ae)),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1d4),_0x5a267d[_0x1e5dc7(0x179)]),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x18b),_0xe072),loggerService_1['loggerService'][_0x1e5dc7(0x156)](_0x1e5dc7(0x15f),_0x1e5dc7(0x1c4),_0x5a267d[_0x1e5dc7(0x179)],_0xe072,_0x3fb909),loggerService_1[_0x1e5dc7(0x18a)][_0x1e5dc7(0x1a0)](_0x1e5dc7(0x15f),_0x1e5dc7(0x1c4),_0x1e5dc7(0x192)+_0x5a267d['status']+':\x20'+_0xe072);throw new Error(_0x1e5dc7(0x1a5)+_0x5a267d[_0x1e5dc7(0x179)]+',\x20body:\x20'+_0xe072);}let _0x5bcb06;try{_0x5bcb06=JSON['parse'](_0xe072);}catch(_0x2812b6){console[_0x1e5dc7(0x153)](_0x1e5dc7(0x159),_0x2812b6),loggerService_1[_0x1e5dc7(0x18a)]['logWhiteDomainError'](_0x1e5dc7(0x15f),_0x1e5dc7(0x1c4),_0x1e5dc7(0x189)+_0x2812b6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0xe072);}console['log'](_0x1e5dc7(0x1ce)),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x197),JSON['stringify'](_0x5bcb06,null,0x2)),loggerService_1[_0x1e5dc7(0x18a)][_0x1e5dc7(0x156)](_0x1e5dc7(0x15f),'/create',_0x5a267d['status'],_0x5bcb06,_0x3fb909);if(_0x5bcb06[_0x1e5dc7(0x153)]){const _0x35b6f6=_0x5bcb06[_0x1e5dc7(0x158)]||_0x5bcb06[_0x1e5dc7(0x153)]||_0x1e5dc7(0x1ba);console[_0x1e5dc7(0x153)](_0x1e5dc7(0x193)),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1a4),_0x35b6f6),loggerService_1[_0x1e5dc7(0x18a)]['logWhiteDomainError']('cointopay',_0x1e5dc7(0x1c4),_0x1e5dc7(0x1b6)+_0x35b6f6);throw new Error(_0x1e5dc7(0x167)+_0x35b6f6);}if(!_0x5bcb06[_0x1e5dc7(0x170)]||!_0x5bcb06[_0x1e5dc7(0x1b5)]){console[_0x1e5dc7(0x153)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1aa)),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1b7),_0x5bcb06),loggerService_1[_0x1e5dc7(0x18a)][_0x1e5dc7(0x1a0)](_0x1e5dc7(0x15f),_0x1e5dc7(0x1c4),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1e5dc7(0x1b9));}return console['log'](_0x1e5dc7(0x154)),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x195),_0x5bcb06[_0x1e5dc7(0x1b5)]),console[_0x1e5dc7(0x16a)](_0x1e5dc7(0x18e),_0x5bcb06[_0x1e5dc7(0x170)]),console['log'](_0x1e5dc7(0x176),_0x2393d9,'EUR'),{'gateway_payment_id':_0x5bcb06[_0x1e5dc7(0x1b5)],'payment_url':_0x5bcb06[_0x1e5dc7(0x170)]};}catch(_0xf7f1bf){console[_0x1e5dc7(0x153)](_0x1e5dc7(0x1c9)),console['error'](_0x1e5dc7(0x19e),_0xf7f1bf),loggerService_1[_0x1e5dc7(0x18a)]['logWhiteDomainError'](_0x1e5dc7(0x15f),_0x1e5dc7(0x1c4),_0xf7f1bf);if(_0xf7f1bf instanceof Error){console[_0x1e5dc7(0x153)]('Error\x20message:',_0xf7f1bf['message']),console[_0x1e5dc7(0x153)](_0x1e5dc7(0x174),_0xf7f1bf[_0x1e5dc7(0x17e)]);throw new Error(_0x1e5dc7(0x157)+_0xf7f1bf[_0x1e5dc7(0x158)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x3f5a7e(0x15e)](_0x2327d3){const _0x59e613=a40_0x3f5a7e,_0x2ca8a7=Date[_0x59e613(0x164)]();try{console['log'](_0x59e613(0x1c3)+_0x2327d3);const _0x131372={'gatewayPaymentId':_0x2327d3};loggerService_1[_0x59e613(0x18a)][_0x59e613(0x1b3)](_0x59e613(0x15f),_0x59e613(0x1b1),_0x59e613(0x16e),_0x131372);const _0x1239b2=await fetch(this[_0x59e613(0x16b)],{'method':_0x59e613(0x16e),'headers':{'Content-Type':_0x59e613(0x16c),'Accept':_0x59e613(0x16c),'User-Agent':_0x59e613(0x160)},'body':JSON['stringify'](_0x131372)}),_0x36d7dd=Date[_0x59e613(0x164)]()-_0x2ca8a7;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x59e613(0x16a)](_0x59e613(0x17a),_0x1239b2['status']),console[_0x59e613(0x16a)](_0x59e613(0x18f),_0x36d7dd+'ms');if(!_0x1239b2['ok']){const _0x4327bc=await _0x1239b2[_0x59e613(0x19f)]();console['error'](_0x59e613(0x1d4),_0x1239b2[_0x59e613(0x179)]),console['error'](_0x59e613(0x18b),_0x4327bc),loggerService_1['loggerService'][_0x59e613(0x156)](_0x59e613(0x15f),_0x59e613(0x1b1),_0x1239b2['status'],_0x4327bc,_0x36d7dd),loggerService_1[_0x59e613(0x18a)][_0x59e613(0x1a0)](_0x59e613(0x15f),'/status','HTTP\x20'+_0x1239b2['status']+':\x20'+_0x4327bc);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1239b2['status']);}const _0x58e55a=await _0x1239b2[_0x59e613(0x19f)]();console[_0x59e613(0x16a)](_0x59e613(0x1c6),_0x58e55a);let _0x346e56;try{_0x346e56=JSON['parse'](_0x58e55a);}catch(_0x5b0f5d){console[_0x59e613(0x153)](_0x59e613(0x159),_0x5b0f5d),loggerService_1[_0x59e613(0x18a)][_0x59e613(0x1a0)](_0x59e613(0x15f),'/status',_0x59e613(0x189)+_0x5b0f5d);throw new Error(_0x59e613(0x1bc)+_0x58e55a);}loggerService_1[_0x59e613(0x18a)][_0x59e613(0x156)](_0x59e613(0x15f),_0x59e613(0x1b1),_0x1239b2[_0x59e613(0x179)],_0x346e56,_0x36d7dd),console[_0x59e613(0x16a)](_0x59e613(0x196)),console['log']('Result:',_0x346e56[_0x59e613(0x186)]),console[_0x59e613(0x16a)](_0x59e613(0x18c),_0x346e56[_0x59e613(0x163)]),console[_0x59e613(0x16a)](_0x59e613(0x1d3),_0x346e56[_0x59e613(0x1c0)]?.[_0x59e613(0x19b)]),console[_0x59e613(0x16a)](_0x59e613(0x176),_0x346e56[_0x59e613(0x1c0)]?.[_0x59e613(0x1cc)]),console[_0x59e613(0x16a)]('Currency:',_0x346e56[_0x59e613(0x1c0)]?.[_0x59e613(0x1bd)]);if(_0x346e56[_0x59e613(0x186)]!==_0x59e613(0x184)||_0x346e56[_0x59e613(0x163)]!==0xc8){const _0x4792a2=_0x346e56[_0x59e613(0x158)]||_0x59e613(0x1b8);console[_0x59e613(0x153)](_0x59e613(0x175)),console[_0x59e613(0x153)]('Error\x20Message:',_0x4792a2),loggerService_1[_0x59e613(0x18a)][_0x59e613(0x1a0)](_0x59e613(0x15f),_0x59e613(0x1b1),_0x59e613(0x161)+_0x4792a2);throw new Error(_0x59e613(0x165)+_0x4792a2);}if(!_0x346e56[_0x59e613(0x1c0)]){console[_0x59e613(0x153)](_0x59e613(0x168)),console['error'](_0x59e613(0x1a2)),loggerService_1['loggerService'][_0x59e613(0x1a0)](_0x59e613(0x15f),_0x59e613(0x1b1),'Incomplete\x20response:\x20missing\x20data');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x580f4b=_0x59e613(0x18d);switch(_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x19b)]?.[_0x59e613(0x1a1)]()){case'paid':_0x580f4b=_0x59e613(0x1d2);break;case _0x59e613(0x15d):case _0x59e613(0x180):case _0x59e613(0x153):_0x580f4b=_0x59e613(0x1d1);break;case _0x59e613(0x1ad):case _0x59e613(0x1c1):_0x580f4b=_0x59e613(0x1a8);break;case _0x59e613(0x152):case _0x59e613(0x183):case'pending':case _0x59e613(0x1b2):default:_0x580f4b='PENDING';break;}let _0x41e1fb,_0x261539;if(_0x346e56[_0x59e613(0x1c0)]['PaymentDetail']){const _0x49cd73=_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x1d0)];console[_0x59e613(0x16a)](_0x59e613(0x171),_0x49cd73);const _0x30b656=_0x49cd73[_0x59e613(0x17f)](/IBAN\s+([A-Z0-9]+)/i);_0x30b656&&(_0x41e1fb=_0x30b656[0x1],console[_0x59e613(0x16a)](_0x59e613(0x185),_0x41e1fb)),_0x261539=_0x49cd73;}const _0x27b247={'iban':_0x41e1fb,'bankDetails':_0x261539,'transactionId':_0x346e56['data'][_0x59e613(0x155)],'coinAddress':_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x1ac)],'qrCodeUrl':_0x346e56['data'][_0x59e613(0x1be)],'expiryTime':_0x346e56[_0x59e613(0x1c0)]['ExpiryTime'],'createdOn':_0x346e56[_0x59e613(0x1c0)]['CreatedOn'],'confirmedOn':_0x346e56['data'][_0x59e613(0x177)]};console['log'](_0x59e613(0x199)),console[_0x59e613(0x16a)](_0x59e613(0x17a),_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x19b)],'->',_0x580f4b),console[_0x59e613(0x16a)](_0x59e613(0x176),_0x346e56['data'][_0x59e613(0x1cc)],_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x1bd)]),console[_0x59e613(0x16a)](_0x59e613(0x1b0),_0x346e56['data'][_0x59e613(0x155)]),console['log'](_0x59e613(0x169),_0x41e1fb||_0x59e613(0x16f)),console[_0x59e613(0x16a)]('Created\x20On:',_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x178)]),console[_0x59e613(0x16a)](_0x59e613(0x16d),_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x177)]||_0x59e613(0x166));if(_0x346e56['data'][_0x59e613(0x19b)]?.[_0x59e613(0x1a1)]()===_0x59e613(0x183))console[_0x59e613(0x16a)](_0x59e613(0x190));else _0x346e56[_0x59e613(0x1c0)][_0x59e613(0x19b)]?.[_0x59e613(0x1a1)]()==='paid'&&console[_0x59e613(0x16a)](_0x59e613(0x1d6));return{'status':_0x580f4b,'amount':parseFloat(_0x346e56[_0x59e613(0x1c0)][_0x59e613(0x1cc)])||undefined,'currency':_0x346e56['data'][_0x59e613(0x1bd)]||_0x59e613(0x1a3),'paymentDetails':_0x27b247};}catch(_0x6c4138){console['error'](_0x59e613(0x172),_0x6c4138),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/status',_0x6c4138);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x6c4138 instanceof Error?_0x6c4138[_0x59e613(0x158)]:'Unknown\x20error'));}}async['verifyPayment'](_0x430810){const _0x1e00ee=a40_0x3f5a7e,_0x24455c=await this['checkPaymentStatus'](_0x430810);return{'status':_0x24455c['status'],'amount':_0x24455c[_0x1e00ee(0x187)],'currency':_0x24455c[_0x1e00ee(0x1bf)]};}async[a40_0x3f5a7e(0x198)](_0x7337c3){const _0x218dc8=a40_0x3f5a7e;console[_0x218dc8(0x16a)](_0x218dc8(0x1cf),_0x7337c3);let _0x12db88=_0x218dc8(0x18d);switch(_0x7337c3[_0x218dc8(0x179)]?.[_0x218dc8(0x1a1)]()){case _0x218dc8(0x1a6):_0x12db88=_0x218dc8(0x1d2);break;case _0x218dc8(0x15d):case _0x218dc8(0x180):case'error':_0x12db88=_0x218dc8(0x1d1);break;case'expired':case _0x218dc8(0x1c1):_0x12db88=_0x218dc8(0x1a8);break;case'pending':case _0x218dc8(0x152):case _0x218dc8(0x183):case _0x218dc8(0x1b2):default:_0x12db88='PENDING';break;}return{'paymentId':_0x7337c3[_0x218dc8(0x1c2)]||_0x7337c3['merchant_reference_id']||'','status':_0x12db88,'amount':_0x7337c3['amount'],'currency':_0x7337c3[_0x218dc8(0x1bf)]||_0x218dc8(0x1a3)};}}exports['CoinToPayService']=CoinToPayService;function a40_0x5ba0(){const _0x323771=['💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Headers:','HTTP\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/status.php','Gateway\x20Payment\x20ID:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Parsed\x20Result:','processWebhook','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','28066keFLIC','Status','entries','\x20EUR','Error\x20details:','text','logWhiteDomainError','toLowerCase','Missing\x20data\x20in\x20response','EUR','Error\x20Message:','HTTP\x20error!\x20status:\x20','paid','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','EXPIRED','1031643uwmwqy','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','__esModule','coinAddress','expired','===\x20COINTOPAY\x20API\x20ERROR\x20===','113141HboXBh','Transaction\x20ID:','/status','created','logWhiteDomainRequest','fromEntries','gateway_payment_id','Business\x20Error:\x20','Response\x20data:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','inputCurrency','QRCodeURL','currency','data','timeout','order_id','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','/create','stringify','Raw\x20Response\x20Body:','31qtEBgi','3212418HLwuGf','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','statusText','224IxqiRK','Amount','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','PaymentDetail','FAILED','PAID','Payment\x20Status:','HTTP\x20Status:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','waiting','error','===\x20COINTOPAY\x20SUCCESS\x20===','TransactionID','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','message','Failed\x20to\x20parse\x20JSON\x20response:','URL:','https://tesoft.uk/gateway/cointopay/','CoinToPayService','cancelled','checkPaymentStatus','cointopay','TesSoft\x20Payment\x20System/1.0','Status\x20API\x20Error:\x20','Status\x20Text:','status_code','now','CoinToPay\x20status\x20API\x20error:\x20','not\x20confirmed','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','IBAN:','log','statusUrl','application/json','Confirmed\x20On:','POST','not\x20found','payment_url','🏦\x20Payment\x20Detail:','CoinToPay\x20payment\x20status\x20check\x20error:','217308XQUMGh','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Amount:','TransactionConfirmedOn','CreatedOn','status','Status:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','../loggerService','16486830uJhDim','stack','match','failed','apiUrl','3932515cqYtne','awaiting\x20fiat','success','🏦\x20Extracted\x20IBAN:','result','amount','4XlQRgx','JSON\x20Parse\x20Error:\x20','loggerService','Response\x20Body:','Status\x20Code:','PENDING','Payment\x20URL:','Response\x20Time:'];a40_0x5ba0=function(){return _0x323771;};return a40_0x5ba0();}