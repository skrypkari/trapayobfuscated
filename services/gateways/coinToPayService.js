'use strict';const a38_0x49aa75=a38_0x5b7f;(function(_0x32788c,_0x59ac38){const _0x3b3493=a38_0x5b7f,_0x575907=_0x32788c();while(!![]){try{const _0x4d22af=parseInt(_0x3b3493(0x156))/0x1*(parseInt(_0x3b3493(0x148))/0x2)+parseInt(_0x3b3493(0x1af))/0x3*(-parseInt(_0x3b3493(0x1b2))/0x4)+parseInt(_0x3b3493(0x1b9))/0x5+-parseInt(_0x3b3493(0x17b))/0x6+-parseInt(_0x3b3493(0x18a))/0x7*(-parseInt(_0x3b3493(0x15f))/0x8)+-parseInt(_0x3b3493(0x19a))/0x9+parseInt(_0x3b3493(0x15e))/0xa;if(_0x4d22af===_0x59ac38)break;else _0x575907['push'](_0x575907['shift']());}catch(_0x1b750a){_0x575907['push'](_0x575907['shift']());}}}(a38_0xae6b,0x8b325));function a38_0x5b7f(_0x5d7c34,_0x2ced9b){const _0xae6bda=a38_0xae6b();return a38_0x5b7f=function(_0x5b7f81,_0x590254){_0x5b7f81=_0x5b7f81-0x137;let _0x2be6a5=_0xae6bda[_0x5b7f81];return _0x2be6a5;},a38_0x5b7f(_0x5d7c34,_0x2ced9b);}Object[a38_0x49aa75(0x175)](exports,a38_0x49aa75(0x158),{'value':!![]}),exports[a38_0x49aa75(0x167)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x577990=a38_0x49aa75;this[_0x577990(0x191)]=_0x577990(0x18e),this[_0x577990(0x183)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x577990(0x153)](_0x577990(0x19c)),console[_0x577990(0x153)](_0x577990(0x17d),this['statusUrl']);}async['createPaymentLink'](_0x1255cb){const _0x4ff523=a38_0x49aa75,{orderId:_0x3431d3,amount:_0xfb9083}=_0x1255cb;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0xfb9083+_0x4ff523(0x147));const _0x2343bf={'amount':_0xfb9083},_0x3aacef=Date[_0x4ff523(0x152)]();try{console[_0x4ff523(0x153)](_0x4ff523(0x163)),console[_0x4ff523(0x153)](_0x4ff523(0x14f),this['apiUrl']),console[_0x4ff523(0x153)](_0x4ff523(0x174),JSON['stringify'](_0x2343bf,null,0x2)),console[_0x4ff523(0x153)](_0x4ff523(0x13e),_0xfb9083,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x4ff523(0x1a9)](_0x4ff523(0x14c),_0x4ff523(0x197),_0x4ff523(0x17a),_0x2343bf);const _0x1e4395=await fetch(this[_0x4ff523(0x191)],{'method':_0x4ff523(0x17a),'headers':{'Content-Type':_0x4ff523(0x16a),'Accept':_0x4ff523(0x16a),'User-Agent':_0x4ff523(0x13d)},'body':JSON[_0x4ff523(0x157)](_0x2343bf)}),_0x77b068=Date[_0x4ff523(0x152)]()-_0x3aacef;console[_0x4ff523(0x153)](_0x4ff523(0x1a0)),console['log'](_0x4ff523(0x16b),_0x1e4395[_0x4ff523(0x1ba)]),console['log'](_0x4ff523(0x17f),_0x1e4395['statusText']),console[_0x4ff523(0x153)](_0x4ff523(0x13c),Object['fromEntries'](_0x1e4395[_0x4ff523(0x18d)]['entries']())),console[_0x4ff523(0x153)](_0x4ff523(0x19b),_0x77b068+'ms');const _0x2ce7e3=await _0x1e4395[_0x4ff523(0x182)]();console[_0x4ff523(0x153)](_0x4ff523(0x186),_0x2ce7e3);if(!_0x1e4395['ok']){console['error'](_0x4ff523(0x1b1)),console['error'](_0x4ff523(0x198),_0x1e4395[_0x4ff523(0x1ba)]),console[_0x4ff523(0x184)](_0x4ff523(0x146),_0x2ce7e3),loggerService_1['loggerService'][_0x4ff523(0x1b6)](_0x4ff523(0x14c),_0x4ff523(0x197),_0x1e4395[_0x4ff523(0x1ba)],_0x2ce7e3,_0x77b068),loggerService_1[_0x4ff523(0x15a)]['logWhiteDomainError'](_0x4ff523(0x14c),'/create','HTTP\x20'+_0x1e4395['status']+':\x20'+_0x2ce7e3);throw new Error(_0x4ff523(0x164)+_0x1e4395[_0x4ff523(0x1ba)]+_0x4ff523(0x1b5)+_0x2ce7e3);}let _0x586aab;try{_0x586aab=JSON[_0x4ff523(0x170)](_0x2ce7e3);}catch(_0x42e2bd){console[_0x4ff523(0x184)](_0x4ff523(0x159),_0x42e2bd),loggerService_1['loggerService'][_0x4ff523(0x142)](_0x4ff523(0x14c),_0x4ff523(0x197),_0x4ff523(0x190)+_0x42e2bd);throw new Error(_0x4ff523(0x185)+_0x2ce7e3);}console['log'](_0x4ff523(0x16d)),console['log'](_0x4ff523(0x15c),JSON[_0x4ff523(0x157)](_0x586aab,null,0x2)),loggerService_1['loggerService'][_0x4ff523(0x1b6)]('cointopay','/create',_0x1e4395[_0x4ff523(0x1ba)],_0x586aab,_0x77b068);if(_0x586aab[_0x4ff523(0x184)]){const _0xf971bb=_0x586aab['message']||_0x586aab[_0x4ff523(0x184)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x4ff523(0x16e)),console[_0x4ff523(0x184)]('Error\x20Message:',_0xf971bb),loggerService_1['loggerService'][_0x4ff523(0x142)]('cointopay',_0x4ff523(0x197),_0x4ff523(0x14a)+_0xf971bb);throw new Error(_0x4ff523(0x162)+_0xf971bb);}if(!_0x586aab[_0x4ff523(0x199)]||!_0x586aab[_0x4ff523(0x1a7)]){console['error'](_0x4ff523(0x177)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x4ff523(0x184)]('Response\x20data:',_0x586aab),loggerService_1[_0x4ff523(0x15a)][_0x4ff523(0x142)](_0x4ff523(0x14c),_0x4ff523(0x197),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x4ff523(0x16c));}return console['log'](_0x4ff523(0x13b)),console['log']('Gateway\x20Payment\x20ID:',_0x586aab[_0x4ff523(0x1a7)]),console[_0x4ff523(0x153)](_0x4ff523(0x17e),_0x586aab[_0x4ff523(0x199)]),console[_0x4ff523(0x153)](_0x4ff523(0x13e),_0xfb9083,_0x4ff523(0x1b0)),{'gateway_payment_id':_0x586aab['gateway_payment_id'],'payment_url':_0x586aab[_0x4ff523(0x199)]};}catch(_0x50d33c){console[_0x4ff523(0x184)](_0x4ff523(0x171)),console[_0x4ff523(0x184)](_0x4ff523(0x172),_0x50d33c),loggerService_1[_0x4ff523(0x15a)][_0x4ff523(0x142)]('cointopay',_0x4ff523(0x197),_0x50d33c);if(_0x50d33c instanceof Error){console[_0x4ff523(0x184)](_0x4ff523(0x160),_0x50d33c[_0x4ff523(0x13f)]),console[_0x4ff523(0x184)](_0x4ff523(0x141),_0x50d33c[_0x4ff523(0x151)]);throw new Error(_0x4ff523(0x195)+_0x50d33c[_0x4ff523(0x13f)]);}throw new Error(_0x4ff523(0x19e));}}async[a38_0x49aa75(0x1aa)](_0x2fca7d){const _0x5cdc92=a38_0x49aa75,_0x2906e2=Date[_0x5cdc92(0x152)]();try{console[_0x5cdc92(0x153)](_0x5cdc92(0x18b)+_0x2fca7d);const _0x92bbb2={'gatewayPaymentId':_0x2fca7d};loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x1a9)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),'POST',_0x92bbb2);const _0x533833=await fetch(this['statusUrl'],{'method':_0x5cdc92(0x17a),'headers':{'Content-Type':'application/json','Accept':_0x5cdc92(0x16a),'User-Agent':_0x5cdc92(0x13d)},'body':JSON[_0x5cdc92(0x157)](_0x92bbb2)}),_0x58170e=Date['now']()-_0x2906e2;console[_0x5cdc92(0x153)](_0x5cdc92(0x192)),console[_0x5cdc92(0x153)]('Status:',_0x533833['status']),console[_0x5cdc92(0x153)]('Response\x20Time:',_0x58170e+'ms');if(!_0x533833['ok']){const _0x1acd98=await _0x533833[_0x5cdc92(0x182)]();console[_0x5cdc92(0x184)]('HTTP\x20Status:',_0x533833['status']),console[_0x5cdc92(0x184)]('Response\x20Body:',_0x1acd98),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x1b6)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),_0x533833[_0x5cdc92(0x1ba)],_0x1acd98,_0x58170e),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x142)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),'HTTP\x20'+_0x533833[_0x5cdc92(0x1ba)]+':\x20'+_0x1acd98);throw new Error(_0x5cdc92(0x164)+_0x533833[_0x5cdc92(0x1ba)]);}const _0x2ce2f2=await _0x533833['text']();console[_0x5cdc92(0x153)](_0x5cdc92(0x186),_0x2ce2f2);let _0x3616e6;try{_0x3616e6=JSON[_0x5cdc92(0x170)](_0x2ce2f2);}catch(_0x57e481){console[_0x5cdc92(0x184)](_0x5cdc92(0x159),_0x57e481),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x142)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),_0x5cdc92(0x190)+_0x57e481);throw new Error(_0x5cdc92(0x143)+_0x2ce2f2);}loggerService_1['loggerService'][_0x5cdc92(0x1b6)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),_0x533833[_0x5cdc92(0x1ba)],_0x3616e6,_0x58170e),console[_0x5cdc92(0x153)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x5cdc92(0x153)]('Result:',_0x3616e6['result']),console['log'](_0x5cdc92(0x14d),_0x3616e6[_0x5cdc92(0x1ab)]),console[_0x5cdc92(0x153)](_0x5cdc92(0x1a2),_0x3616e6[_0x5cdc92(0x1a8)]?.[_0x5cdc92(0x14b)]),console[_0x5cdc92(0x153)](_0x5cdc92(0x13e),_0x3616e6[_0x5cdc92(0x1a8)]?.[_0x5cdc92(0x150)]),console[_0x5cdc92(0x153)](_0x5cdc92(0x161),_0x3616e6[_0x5cdc92(0x1a8)]?.['inputCurrency']);if(_0x3616e6[_0x5cdc92(0x173)]!==_0x5cdc92(0x169)||_0x3616e6[_0x5cdc92(0x1ab)]!==0xc8){const _0x2d55c2=_0x3616e6[_0x5cdc92(0x13f)]||_0x5cdc92(0x168);console[_0x5cdc92(0x184)](_0x5cdc92(0x1b8)),console[_0x5cdc92(0x184)]('Error\x20Message:',_0x2d55c2),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x142)](_0x5cdc92(0x14c),_0x5cdc92(0x18f),'Status\x20API\x20Error:\x20'+_0x2d55c2);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x2d55c2);}if(!_0x3616e6['data']){console[_0x5cdc92(0x184)](_0x5cdc92(0x1b7)),console[_0x5cdc92(0x184)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x142)]('cointopay',_0x5cdc92(0x18f),_0x5cdc92(0x180));throw new Error(_0x5cdc92(0x165));}let _0x52a7c9='PENDING';switch(_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x14b)]?.['toLowerCase']()){case _0x5cdc92(0x196):_0x52a7c9=_0x5cdc92(0x139);break;case _0x5cdc92(0x187):case _0x5cdc92(0x1b3):case _0x5cdc92(0x184):_0x52a7c9='FAILED';break;case _0x5cdc92(0x154):case'timeout':_0x52a7c9=_0x5cdc92(0x194);break;case _0x5cdc92(0x18c):case'awaiting\x20fiat':case _0x5cdc92(0x1ae):case _0x5cdc92(0x1ac):default:_0x52a7c9='PENDING';break;}let _0x57ad68,_0xfec592;if(_0x3616e6['data'][_0x5cdc92(0x140)]){const _0x4b6d22=_0x3616e6['data']['PaymentDetail'];console['log'](_0x5cdc92(0x1a5),_0x4b6d22);const _0x3d19f7=_0x4b6d22[_0x5cdc92(0x178)](/IBAN\s+([A-Z0-9]+)/i);_0x3d19f7&&(_0x57ad68=_0x3d19f7[0x1],console['log'](_0x5cdc92(0x144),_0x57ad68)),_0xfec592=_0x4b6d22;}const _0x1abfe0={'iban':_0x57ad68,'bankDetails':_0xfec592,'transactionId':_0x3616e6['data']['TransactionID'],'coinAddress':_0x3616e6['data']['coinAddress'],'qrCodeUrl':_0x3616e6[_0x5cdc92(0x1a8)]['QRCodeURL'],'expiryTime':_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x13a)],'createdOn':_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x1b4)],'confirmedOn':_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x16f)]};console['log'](_0x5cdc92(0x176)),console['log'](_0x5cdc92(0x16b),_0x3616e6['data'][_0x5cdc92(0x14b)],'->',_0x52a7c9),console[_0x5cdc92(0x153)](_0x5cdc92(0x13e),_0x3616e6[_0x5cdc92(0x1a8)]['Amount'],_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x137)]),console[_0x5cdc92(0x153)](_0x5cdc92(0x181),_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x17c)]),console['log']('IBAN:',_0x57ad68||_0x5cdc92(0x189)),console['log'](_0x5cdc92(0x138),_0x3616e6[_0x5cdc92(0x1a8)]['CreatedOn']),console[_0x5cdc92(0x153)](_0x5cdc92(0x188),_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x16f)]||_0x5cdc92(0x155));if(_0x3616e6['data'][_0x5cdc92(0x14b)]?.[_0x5cdc92(0x149)]()===_0x5cdc92(0x15d))console[_0x5cdc92(0x153)](_0x5cdc92(0x1ad));else _0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x14b)]?.[_0x5cdc92(0x149)]()===_0x5cdc92(0x196)&&console[_0x5cdc92(0x153)](_0x5cdc92(0x1a4));return{'status':_0x52a7c9,'amount':parseFloat(_0x3616e6['data'][_0x5cdc92(0x150)])||undefined,'currency':_0x3616e6[_0x5cdc92(0x1a8)][_0x5cdc92(0x137)]||_0x5cdc92(0x1b0),'paymentDetails':_0x1abfe0};}catch(_0x15d0aa){console['error'](_0x5cdc92(0x145),_0x15d0aa),loggerService_1[_0x5cdc92(0x15a)][_0x5cdc92(0x142)](_0x5cdc92(0x14c),'/status',_0x15d0aa);throw new Error(_0x5cdc92(0x19f)+(_0x15d0aa instanceof Error?_0x15d0aa['message']:_0x5cdc92(0x1a3)));}}async['verifyPayment'](_0x34b400){const _0x21a4af=a38_0x49aa75,_0x50b289=await this[_0x21a4af(0x1aa)](_0x34b400);return{'status':_0x50b289[_0x21a4af(0x1ba)],'amount':_0x50b289[_0x21a4af(0x19d)],'currency':_0x50b289['currency']};}async[a38_0x49aa75(0x193)](_0x478409){const _0x47bdf9=a38_0x49aa75;console[_0x47bdf9(0x153)](_0x47bdf9(0x14e),_0x478409);let _0x470cf0='PENDING';switch(_0x478409[_0x47bdf9(0x1ba)]?.[_0x47bdf9(0x149)]()){case _0x47bdf9(0x196):_0x470cf0=_0x47bdf9(0x139);break;case _0x47bdf9(0x187):case _0x47bdf9(0x1b3):case _0x47bdf9(0x184):_0x470cf0='FAILED';break;case _0x47bdf9(0x154):case _0x47bdf9(0x15b):_0x470cf0='EXPIRED';break;case _0x47bdf9(0x1ae):case _0x47bdf9(0x18c):case _0x47bdf9(0x15d):case'created':default:_0x470cf0=_0x47bdf9(0x179);break;}return{'paymentId':_0x478409[_0x47bdf9(0x1a1)]||_0x478409[_0x47bdf9(0x166)]||'','status':_0x470cf0,'amount':_0x478409[_0x47bdf9(0x19d)],'currency':_0x478409[_0x47bdf9(0x1a6)]||_0x47bdf9(0x1b0)};}}exports[a38_0x49aa75(0x167)]=CoinToPayService;function a38_0xae6b(){const _0x5865d8=['‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üè¶\x20Payment\x20Detail:','currency','gateway_payment_id','data','logWhiteDomainRequest','checkPaymentStatus','status_code','created','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','pending','15bmjFVI','EUR','===\x20COINTOPAY\x20API\x20ERROR\x20===','890740aowCQJ','failed','CreatedOn',',\x20body:\x20','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','5605970NuQmnI','status','inputCurrency','Created\x20On:','PAID','ExpiryTime','===\x20COINTOPAY\x20SUCCESS\x20===','Headers:','TesSoft\x20Payment\x20System/1.0','Amount:','message','PaymentDetail','Error\x20stack:','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','üè¶\x20Extracted\x20IBAN:','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20Body:','\x20EUR','409846bdRxPB','toLowerCase','Business\x20Error:\x20','Status','cointopay','Status\x20Code:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','URL:','Amount','stack','now','log','expired','not\x20confirmed','1vGqPGE','stringify','__esModule','Failed\x20to\x20parse\x20JSON\x20response:','loggerService','timeout','Parsed\x20Result:','awaiting\x20fiat','13987740FWMGzn','24eTwTAS','Error\x20message:','Currency:','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','HTTP\x20error!\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','merchant_reference_id','CoinToPayService','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','success','application/json','Status:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','TransactionConfirmedOn','parse','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Error\x20details:','result','Request\x20Body:','defineProperty','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','PENDING','POST','5628324LVZdxX','TransactionID','üìä\x20Status\x20check\x20URL:','Payment\x20URL:','Status\x20Text:','Incomplete\x20response:\x20missing\x20data','Transaction\x20ID:','text','statusUrl','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Raw\x20Response\x20Body:','cancelled','Confirmed\x20On:','not\x20found','1615866BqMHeH','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','waiting','headers','https://tesoft.uk/gateway/cointopay/','/status','JSON\x20Parse\x20Error:\x20','apiUrl','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','processWebhook','EXPIRED','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','paid','/create','HTTP\x20Status:','payment_url','7161993pMRGGd','Response\x20Time:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','amount','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','order_id','Payment\x20Status:','Unknown\x20error'];a38_0xae6b=function(){return _0x5865d8;};return a38_0xae6b();}