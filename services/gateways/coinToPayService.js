'use strict';const a57_0x1e771d=a57_0x545f;(function(_0x233806,_0x3ee06c){const _0x2cf38f=a57_0x545f,_0x1d2c5a=_0x233806();while(!![]){try{const _0x437d60=parseInt(_0x2cf38f(0x13c))/0x1+-parseInt(_0x2cf38f(0xc2))/0x2*(parseInt(_0x2cf38f(0xcf))/0x3)+-parseInt(_0x2cf38f(0xf6))/0x4+-parseInt(_0x2cf38f(0x10e))/0x5+-parseInt(_0x2cf38f(0x10d))/0x6+parseInt(_0x2cf38f(0xc8))/0x7*(parseInt(_0x2cf38f(0x135))/0x8)+parseInt(_0x2cf38f(0xd0))/0x9;if(_0x437d60===_0x3ee06c)break;else _0x1d2c5a['push'](_0x1d2c5a['shift']());}catch(_0x4cd147){_0x1d2c5a['push'](_0x1d2c5a['shift']());}}}(a57_0x21d2,0x4725d));function a57_0x545f(_0x5f36e1,_0xb4d75){_0x5f36e1=_0x5f36e1-0xba;const _0x21d229=a57_0x21d2();let _0x545f7d=_0x21d229[_0x5f36e1];return _0x545f7d;}Object[a57_0x1e771d(0xcb)](exports,a57_0x1e771d(0x12b),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a57_0x1e771d(0xd6));class CoinToPayService{constructor(){const _0x219076=a57_0x1e771d;this[_0x219076(0x118)]=_0x219076(0x13e),this['statusUrl']=_0x219076(0xce),console[_0x219076(0xd2)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x219076(0xec),this[_0x219076(0xed)]);}async[a57_0x1e771d(0xca)](_0xe63d6e){const _0x25f4c2=a57_0x1e771d,{orderId:_0x4f2e24,amount:_0xf2a19}=_0xe63d6e;console[_0x25f4c2(0xd2)](_0x25f4c2(0xd8)+_0xf2a19+_0x25f4c2(0xcd));const _0x586a58={'amount':_0xf2a19},_0x20d4ef=Date[_0x25f4c2(0xdf)]();try{console[_0x25f4c2(0xd2)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x25f4c2(0xd2)]('URL:',this[_0x25f4c2(0x118)]),console[_0x25f4c2(0xd2)](_0x25f4c2(0xe7),JSON[_0x25f4c2(0xc5)](_0x586a58,null,0x2)),console[_0x25f4c2(0xd2)]('Amount:',_0xf2a19,_0x25f4c2(0x133)),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0x12e)](_0x25f4c2(0x12c),_0x25f4c2(0xff),_0x25f4c2(0xcc),_0x586a58);const _0x52910e=await fetch(this[_0x25f4c2(0x118)],{'method':_0x25f4c2(0xcc),'headers':{'Content-Type':'application/json','Accept':_0x25f4c2(0xe4),'User-Agent':_0x25f4c2(0xf3)},'body':JSON[_0x25f4c2(0xc5)](_0x586a58)}),_0x33e489=Date[_0x25f4c2(0xdf)]()-_0x20d4ef;console['log'](_0x25f4c2(0xdd)),console[_0x25f4c2(0xd2)](_0x25f4c2(0x11d),_0x52910e[_0x25f4c2(0xe2)]),console[_0x25f4c2(0xd2)](_0x25f4c2(0x131),_0x52910e[_0x25f4c2(0xd7)]),console[_0x25f4c2(0xd2)](_0x25f4c2(0xd1),Object[_0x25f4c2(0x11a)](_0x52910e[_0x25f4c2(0xc3)][_0x25f4c2(0xbb)]())),console[_0x25f4c2(0xd2)]('Response\x20Time:',_0x33e489+'ms');const _0x2278a0=await _0x52910e[_0x25f4c2(0x10c)]();console[_0x25f4c2(0xd2)](_0x25f4c2(0x107),_0x2278a0);if(!_0x52910e['ok']){console[_0x25f4c2(0x11e)](_0x25f4c2(0x101)),console[_0x25f4c2(0x11e)](_0x25f4c2(0x119),_0x52910e[_0x25f4c2(0xe2)]),console['error'](_0x25f4c2(0x10b),_0x2278a0),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0xc9)]('cointopay',_0x25f4c2(0xff),_0x52910e[_0x25f4c2(0xe2)],_0x2278a0,_0x33e489),loggerService_1['loggerService'][_0x25f4c2(0x109)](_0x25f4c2(0x12c),'/create',_0x25f4c2(0x120)+_0x52910e[_0x25f4c2(0xe2)]+':\x20'+_0x2278a0);throw new Error(_0x25f4c2(0xf0)+_0x52910e[_0x25f4c2(0xe2)]+_0x25f4c2(0x139)+_0x2278a0);}let _0x13b99f;try{_0x13b99f=JSON[_0x25f4c2(0x117)](_0x2278a0);}catch(_0x14e16d){console[_0x25f4c2(0x11e)](_0x25f4c2(0xf5),_0x14e16d),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0x109)](_0x25f4c2(0x12c),_0x25f4c2(0xff),_0x25f4c2(0x13d)+_0x14e16d);throw new Error(_0x25f4c2(0x10a)+_0x2278a0);}console['log'](_0x25f4c2(0x12f)),console[_0x25f4c2(0xd2)]('Parsed\x20Result:',JSON[_0x25f4c2(0xc5)](_0x13b99f,null,0x2)),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0xc9)](_0x25f4c2(0x12c),_0x25f4c2(0xff),_0x52910e[_0x25f4c2(0xe2)],_0x13b99f,_0x33e489);if(_0x13b99f[_0x25f4c2(0x11e)]){const _0x435881=_0x13b99f[_0x25f4c2(0xf9)]||_0x13b99f[_0x25f4c2(0x11e)]||_0x25f4c2(0x12a);console[_0x25f4c2(0x11e)](_0x25f4c2(0xfa)),console[_0x25f4c2(0x11e)](_0x25f4c2(0xc4),_0x435881),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0x109)](_0x25f4c2(0x12c),_0x25f4c2(0xff),_0x25f4c2(0xe1)+_0x435881);throw new Error(_0x25f4c2(0x13f)+_0x435881);}if(!_0x13b99f[_0x25f4c2(0x13a)]||!_0x13b99f['gateway_payment_id']){console['error']('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x25f4c2(0x11e)](_0x25f4c2(0xee)),console['error'](_0x25f4c2(0xeb),_0x13b99f),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x25f4c2(0xff),_0x25f4c2(0x124));throw new Error(_0x25f4c2(0x103));}console['log'](_0x25f4c2(0x111)),console[_0x25f4c2(0xd2)](_0x25f4c2(0xfb),_0x13b99f[_0x25f4c2(0x122)]),console['log'](_0x25f4c2(0x114),_0x13b99f['payment_url']);const _0x31a725=_0x13b99f[_0x25f4c2(0x13a)]+_0x25f4c2(0xde);return console[_0x25f4c2(0xd2)](_0x25f4c2(0x130),_0x31a725),console['log'](_0x25f4c2(0x108),_0xf2a19,_0x25f4c2(0x137)),{'gateway_payment_id':_0x13b99f['gateway_payment_id'],'payment_url':_0x31a725};}catch(_0x60b5a5){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x25f4c2(0x11e)]('Error\x20details:',_0x60b5a5),loggerService_1[_0x25f4c2(0x13b)][_0x25f4c2(0x109)](_0x25f4c2(0x12c),_0x25f4c2(0xff),_0x60b5a5);if(_0x60b5a5 instanceof Error){console[_0x25f4c2(0x11e)]('Error\x20message:',_0x60b5a5[_0x25f4c2(0xf9)]),console[_0x25f4c2(0x11e)](_0x25f4c2(0xf2),_0x60b5a5[_0x25f4c2(0x11c)]);throw new Error(_0x25f4c2(0xdc)+_0x60b5a5[_0x25f4c2(0xf9)]);}throw new Error(_0x25f4c2(0x115));}}async['checkPaymentStatus'](_0x5e7f6c){const _0x4379e8=a57_0x1e771d,_0x584e5f=Date[_0x4379e8(0xdf)]();try{console['log'](_0x4379e8(0xea)+_0x5e7f6c);const _0x4a806a={'gatewayPaymentId':_0x5e7f6c};loggerService_1[_0x4379e8(0x13b)][_0x4379e8(0x12e)](_0x4379e8(0x12c),'/status','POST',_0x4a806a);const _0x5bcc4a=await fetch(this[_0x4379e8(0xed)],{'method':_0x4379e8(0xcc),'headers':{'Content-Type':_0x4379e8(0xe4),'Accept':_0x4379e8(0xe4),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4379e8(0xc5)](_0x4a806a)}),_0x5ae146=Date[_0x4379e8(0xdf)]()-_0x584e5f;console[_0x4379e8(0xd2)](_0x4379e8(0xd4)),console['log'](_0x4379e8(0x11d),_0x5bcc4a[_0x4379e8(0xe2)]),console[_0x4379e8(0xd2)](_0x4379e8(0xc7),_0x5ae146+'ms');if(!_0x5bcc4a['ok']){const _0x306ea3=await _0x5bcc4a['text']();console[_0x4379e8(0x11e)](_0x4379e8(0x119),_0x5bcc4a[_0x4379e8(0xe2)]),console[_0x4379e8(0x11e)](_0x4379e8(0x10b),_0x306ea3),loggerService_1[_0x4379e8(0x13b)][_0x4379e8(0xc9)](_0x4379e8(0x12c),_0x4379e8(0xfe),_0x5bcc4a['status'],_0x306ea3,_0x5ae146),loggerService_1[_0x4379e8(0x13b)][_0x4379e8(0x109)]('cointopay',_0x4379e8(0xfe),_0x4379e8(0x120)+_0x5bcc4a[_0x4379e8(0xe2)]+':\x20'+_0x306ea3);throw new Error(_0x4379e8(0xf0)+_0x5bcc4a[_0x4379e8(0xe2)]);}const _0x2430c0=await _0x5bcc4a[_0x4379e8(0x10c)]();console[_0x4379e8(0xd2)]('Raw\x20Response\x20Body:',_0x2430c0);let _0x4bcddd;try{_0x4bcddd=JSON[_0x4379e8(0x117)](_0x2430c0);}catch(_0x4b4af6){console[_0x4379e8(0x11e)](_0x4379e8(0xf5),_0x4b4af6),loggerService_1['loggerService'][_0x4379e8(0x109)](_0x4379e8(0x12c),_0x4379e8(0xfe),_0x4379e8(0x13d)+_0x4b4af6);throw new Error(_0x4379e8(0xe8)+_0x2430c0);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x4379e8(0x12c),_0x4379e8(0xfe),_0x5bcc4a['status'],_0x4bcddd,_0x5ae146),console[_0x4379e8(0xd2)](_0x4379e8(0x104)),console[_0x4379e8(0xd2)](_0x4379e8(0xbd),_0x4bcddd['result']),console[_0x4379e8(0xd2)](_0x4379e8(0x129),_0x4bcddd[_0x4379e8(0xc1)]),console[_0x4379e8(0xd2)]('Payment\x20Status:',_0x4bcddd[_0x4379e8(0x11f)]?.[_0x4379e8(0xba)]),console[_0x4379e8(0xd2)]('Amount:',_0x4bcddd[_0x4379e8(0x11f)]?.['Amount']),console[_0x4379e8(0xd2)]('Currency:',_0x4bcddd[_0x4379e8(0x11f)]?.[_0x4379e8(0x132)]);if(_0x4bcddd[_0x4379e8(0xf8)]!=='success'||_0x4bcddd[_0x4379e8(0xc1)]!==0xc8){const _0x5496ce=_0x4bcddd[_0x4379e8(0xf9)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x4379e8(0x11e)](_0x4379e8(0xc0)),console['error'](_0x4379e8(0xc4),_0x5496ce),loggerService_1[_0x4379e8(0x13b)][_0x4379e8(0x109)](_0x4379e8(0x12c),_0x4379e8(0xfe),_0x4379e8(0xd3)+_0x5496ce);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5496ce);}if(!_0x4bcddd[_0x4379e8(0x11f)]){console[_0x4379e8(0x11e)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4379e8(0x11e)](_0x4379e8(0x125)),loggerService_1[_0x4379e8(0x13b)][_0x4379e8(0x109)](_0x4379e8(0x12c),_0x4379e8(0xfe),_0x4379e8(0x138));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x4e0646=_0x4379e8(0x121);switch(_0x4bcddd['data'][_0x4379e8(0xba)]?.[_0x4379e8(0xdb)]()){case _0x4379e8(0x106):_0x4e0646=_0x4379e8(0xbc);break;case _0x4379e8(0x11b):case _0x4379e8(0x113):case _0x4379e8(0x11e):_0x4e0646=_0x4379e8(0xf7);break;case _0x4379e8(0xf1):case _0x4379e8(0x10f):_0x4e0646=_0x4379e8(0xbe);break;case _0x4379e8(0x102):case _0x4379e8(0xda):case _0x4379e8(0x100):case _0x4379e8(0x126):default:_0x4e0646=_0x4379e8(0x121);break;}let _0x3c51fe,_0x350bee;if(_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0xc6)]){const _0x2c9ded=_0x4bcddd[_0x4379e8(0x11f)]['PaymentDetail'];console['log'](_0x4379e8(0x123),_0x2c9ded);const _0x57a118=_0x2c9ded[_0x4379e8(0xbf)](/IBAN\s+([A-Z0-9]+)/i);_0x57a118&&(_0x3c51fe=_0x57a118[0x1],console[_0x4379e8(0xd2)](_0x4379e8(0xe6),_0x3c51fe)),_0x350bee=_0x2c9ded;}const _0x5f3a9f={'iban':_0x3c51fe,'bankDetails':_0x350bee,'transactionId':_0x4bcddd['data'][_0x4379e8(0x116)],'coinAddress':_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x128)],'qrCodeUrl':_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x134)],'expiryTime':_0x4bcddd['data'][_0x4379e8(0xe5)],'createdOn':_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x136)],'confirmedOn':_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0xef)]};console[_0x4379e8(0xd2)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x4379e8(0xd2)]('Status:',_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0xba)],'->',_0x4e0646),console[_0x4379e8(0xd2)](_0x4379e8(0x108),_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x127)],_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x132)]),console[_0x4379e8(0xd2)]('Transaction\x20ID:',_0x4bcddd['data'][_0x4379e8(0x116)]),console[_0x4379e8(0xd2)](_0x4379e8(0x12d),_0x3c51fe||'not\x20found'),console['log'](_0x4379e8(0x105),_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x136)]),console[_0x4379e8(0xd2)]('Confirmed\x20On:',_0x4bcddd['data'][_0x4379e8(0xef)]||_0x4379e8(0x110));if(_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0xba)]?.[_0x4379e8(0xdb)]()==='awaiting\x20fiat')console[_0x4379e8(0xd2)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0xba)]?.[_0x4379e8(0xdb)]()==='paid'&&console[_0x4379e8(0xd2)](_0x4379e8(0xe9));return{'status':_0x4e0646,'amount':parseFloat(_0x4bcddd['data'][_0x4379e8(0x127)])||undefined,'currency':_0x4bcddd[_0x4379e8(0x11f)][_0x4379e8(0x132)]||_0x4379e8(0x137),'paymentDetails':_0x5f3a9f};}catch(_0x45fbe3){console[_0x4379e8(0x11e)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x45fbe3),loggerService_1['loggerService']['logWhiteDomainError'](_0x4379e8(0x12c),'/status',_0x45fbe3);throw new Error(_0x4379e8(0xd5)+(_0x45fbe3 instanceof Error?_0x45fbe3[_0x4379e8(0xf9)]:'Unknown\x20error'));}}async['verifyPayment'](_0x1571e7){const _0x3a6ccd=a57_0x1e771d,_0x4e15e1=await this[_0x3a6ccd(0xe0)](_0x1571e7);return{'status':_0x4e15e1[_0x3a6ccd(0xe2)],'amount':_0x4e15e1[_0x3a6ccd(0x112)],'currency':_0x4e15e1[_0x3a6ccd(0xd9)]};}async[a57_0x1e771d(0xfd)](_0x1de32b){const _0x45a28b=a57_0x1e771d;console[_0x45a28b(0xd2)](_0x45a28b(0xf4),_0x1de32b);let _0xc36ef9=_0x45a28b(0x121);switch(_0x1de32b[_0x45a28b(0xe2)]?.['toLowerCase']()){case _0x45a28b(0x106):_0xc36ef9=_0x45a28b(0xbc);break;case _0x45a28b(0x11b):case _0x45a28b(0x113):case'error':_0xc36ef9=_0x45a28b(0xf7);break;case _0x45a28b(0xf1):case _0x45a28b(0x10f):_0xc36ef9=_0x45a28b(0xbe);break;case _0x45a28b(0x100):case _0x45a28b(0x102):case _0x45a28b(0xda):case _0x45a28b(0x126):default:_0xc36ef9=_0x45a28b(0x121);break;}return{'paymentId':_0x1de32b['order_id']||_0x1de32b[_0x45a28b(0xfc)]||'','status':_0xc36ef9,'amount':_0x1de32b[_0x45a28b(0x112)],'currency':_0x1de32b[_0x45a28b(0xd9)]||_0x45a28b(0x137)};}}exports[a57_0x1e771d(0xe3)]=CoinToPayService;function a57_0x21d2(){const _0xad875c=['Raw\x20Response\x20Body:','Amount:','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Body:','text','96666BDIuHI','1402970POGGMi','timeout','not\x20confirmed','===\x20COINTOPAY\x20SUCCESS\x20===','amount','failed','Payment\x20URL\x20(original):','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','TransactionID','parse','apiUrl','HTTP\x20Status:','fromEntries','cancelled','stack','Status:','error','data','HTTP\x20','PENDING','gateway_payment_id','üè¶\x20Payment\x20Detail:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Missing\x20data\x20in\x20response','created','Amount','coinAddress','Status\x20Code:','Unknown\x20error\x20from\x20CoinToPay\x20API','__esModule','cointopay','IBAN:','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Payment\x20URL\x20(modified):','Status\x20Text:','inputCurrency','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','QRCodeURL','1893680JEQXHl','CreatedOn','EUR','Incomplete\x20response:\x20missing\x20data',',\x20body:\x20','payment_url','loggerService','49533gkNPYA','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','CoinToPay\x20API\x20error:\x20','Status','entries','PAID','Result:','EXPIRED','match','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','status_code','118eWbmVZ','headers','Error\x20Message:','stringify','PaymentDetail','Response\x20Time:','7JGOqDv','logWhiteDomainResponse','createPaymentLink','defineProperty','POST','\x20EUR','https://tesoft.uk/gateway/cointopay/status.php','7521VIwLmm','4804092nHmFtQ','Headers:','log','Status\x20API\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','../loggerService','statusText','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','currency','awaiting\x20fiat','toLowerCase','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','&alternative=false','now','checkPaymentStatus','Business\x20Error:\x20','status','CoinToPayService','application/json','ExpiryTime','üè¶\x20Extracted\x20IBAN:','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Response\x20data:','üìä\x20Status\x20check\x20URL:','statusUrl','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','TransactionConfirmedOn','HTTP\x20error!\x20status:\x20','expired','Error\x20stack:','Payment\x20System/1.0','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20parse\x20JSON\x20response:','335968VJKjtw','FAILED','result','message','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Gateway\x20Payment\x20ID:','merchant_reference_id','processWebhook','/status','/create','pending','===\x20COINTOPAY\x20API\x20ERROR\x20===','waiting','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Created\x20On:','paid'];a57_0x21d2=function(){return _0xad875c;};return a57_0x21d2();}