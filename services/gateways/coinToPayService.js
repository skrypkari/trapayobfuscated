'use strict';const a40_0x519081=a40_0x2b09;(function(_0x2596be,_0x395a5c){const _0xebc58=a40_0x2b09,_0x107698=_0x2596be();while(!![]){try{const _0x437a68=-parseInt(_0xebc58(0x15a))/0x1*(parseInt(_0xebc58(0x186))/0x2)+-parseInt(_0xebc58(0x139))/0x3+parseInt(_0xebc58(0x151))/0x4*(-parseInt(_0xebc58(0x109))/0x5)+parseInt(_0xebc58(0x165))/0x6+parseInt(_0xebc58(0x129))/0x7*(-parseInt(_0xebc58(0x178))/0x8)+-parseInt(_0xebc58(0x13e))/0x9*(-parseInt(_0xebc58(0x16a))/0xa)+parseInt(_0xebc58(0x114))/0xb;if(_0x437a68===_0x395a5c)break;else _0x107698['push'](_0x107698['shift']());}catch(_0x68858a){_0x107698['push'](_0x107698['shift']());}}}(a40_0xe98d,0x59ba7));function a40_0x2b09(_0x14c0af,_0x4087a3){const _0xe98d1d=a40_0xe98d();return a40_0x2b09=function(_0x2b0956,_0x796f6a){_0x2b0956=_0x2b0956-0x109;let _0x581fe6=_0xe98d1d[_0x2b0956];return _0x581fe6;},a40_0x2b09(_0x14c0af,_0x4087a3);}Object['defineProperty'](exports,a40_0x519081(0x145),{'value':!![]}),exports[a40_0x519081(0x12b)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x5a52d6=a40_0x519081;this['apiUrl']=_0x5a52d6(0x133),this[_0x5a52d6(0x177)]=_0x5a52d6(0x154),console[_0x5a52d6(0x122)](_0x5a52d6(0x123)),console[_0x5a52d6(0x122)](_0x5a52d6(0x156),this[_0x5a52d6(0x177)]);}async[a40_0x519081(0x124)](_0x45c320){const _0x489b40=a40_0x519081,{orderId:_0x3b8bb4,amount:_0x529bb3}=_0x45c320;console[_0x489b40(0x122)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x529bb3+_0x489b40(0x163));const _0x143831={'amount':_0x529bb3},_0x3e46ff=Date['now']();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x489b40(0x122)](_0x489b40(0x18a),this['apiUrl']),console['log'](_0x489b40(0x131),JSON[_0x489b40(0x12f)](_0x143831,null,0x2)),console['log'](_0x489b40(0x113),_0x529bb3,_0x489b40(0x13b)),loggerService_1['loggerService'][_0x489b40(0x161)](_0x489b40(0x18c),'/create',_0x489b40(0x138),_0x143831);const _0x390900=await fetch(this[_0x489b40(0x17a)],{'method':'POST','headers':{'Content-Type':_0x489b40(0x125),'Accept':'application/json','User-Agent':_0x489b40(0x118)},'body':JSON['stringify'](_0x143831)}),_0x64f70c=Date[_0x489b40(0x10f)]()-_0x3e46ff;console[_0x489b40(0x122)](_0x489b40(0x17c)),console[_0x489b40(0x122)](_0x489b40(0x18e),_0x390900[_0x489b40(0x14e)]),console[_0x489b40(0x122)]('Status\x20Text:',_0x390900[_0x489b40(0x170)]),console['log'](_0x489b40(0x148),Object[_0x489b40(0x17f)](_0x390900[_0x489b40(0x158)][_0x489b40(0x16f)]())),console['log'](_0x489b40(0x164),_0x64f70c+'ms');const _0x4bf81e=await _0x390900['text']();console[_0x489b40(0x122)](_0x489b40(0x146),_0x4bf81e);if(!_0x390900['ok']){console[_0x489b40(0x188)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x489b40(0x188)]('HTTP\x20Status:',_0x390900[_0x489b40(0x14e)]),console[_0x489b40(0x188)](_0x489b40(0x11a),_0x4bf81e),loggerService_1['loggerService'][_0x489b40(0x16b)]('cointopay',_0x489b40(0x149),_0x390900[_0x489b40(0x14e)],_0x4bf81e,_0x64f70c),loggerService_1[_0x489b40(0x132)]['logWhiteDomainError'](_0x489b40(0x18c),'/create',_0x489b40(0x17d)+_0x390900[_0x489b40(0x14e)]+':\x20'+_0x4bf81e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x390900[_0x489b40(0x14e)]+_0x489b40(0x159)+_0x4bf81e);}let _0x27d815;try{_0x27d815=JSON[_0x489b40(0x171)](_0x4bf81e);}catch(_0x92a352){console[_0x489b40(0x188)](_0x489b40(0x116),_0x92a352),loggerService_1[_0x489b40(0x132)][_0x489b40(0x12e)](_0x489b40(0x18c),_0x489b40(0x149),_0x489b40(0x110)+_0x92a352);throw new Error(_0x489b40(0x144)+_0x4bf81e);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x489b40(0x122)]('Parsed\x20Result:',JSON[_0x489b40(0x12f)](_0x27d815,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x489b40(0x149),_0x390900[_0x489b40(0x14e)],_0x27d815,_0x64f70c);if(_0x27d815[_0x489b40(0x188)]){const _0x1f7fdc=_0x27d815[_0x489b40(0x15d)]||_0x27d815[_0x489b40(0x188)]||_0x489b40(0x187);console['error'](_0x489b40(0x15f)),console['error']('Error\x20Message:',_0x1f7fdc),loggerService_1[_0x489b40(0x132)][_0x489b40(0x12e)](_0x489b40(0x18c),_0x489b40(0x149),'Business\x20Error:\x20'+_0x1f7fdc);throw new Error(_0x489b40(0x136)+_0x1f7fdc);}if(!_0x27d815[_0x489b40(0x13f)]||!_0x27d815[_0x489b40(0x189)]){console[_0x489b40(0x188)](_0x489b40(0x10a)),console[_0x489b40(0x188)](_0x489b40(0x17b)),console[_0x489b40(0x188)](_0x489b40(0x140),_0x27d815),loggerService_1[_0x489b40(0x132)][_0x489b40(0x12e)](_0x489b40(0x18c),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x489b40(0x112));}return console['log'](_0x489b40(0x147)),console[_0x489b40(0x122)](_0x489b40(0x10d),_0x27d815[_0x489b40(0x189)]),console['log'](_0x489b40(0x14d),_0x27d815[_0x489b40(0x13f)]),console[_0x489b40(0x122)](_0x489b40(0x113),_0x529bb3,_0x489b40(0x180)),{'gateway_payment_id':_0x27d815[_0x489b40(0x189)],'payment_url':_0x27d815[_0x489b40(0x13f)]};}catch(_0x16aeb0){console['error'](_0x489b40(0x15e)),console[_0x489b40(0x188)](_0x489b40(0x185),_0x16aeb0),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x489b40(0x149),_0x16aeb0);if(_0x16aeb0 instanceof Error){console[_0x489b40(0x188)](_0x489b40(0x182),_0x16aeb0['message']),console[_0x489b40(0x188)](_0x489b40(0x181),_0x16aeb0[_0x489b40(0x128)]);throw new Error(_0x489b40(0x111)+_0x16aeb0[_0x489b40(0x15d)]);}throw new Error(_0x489b40(0x11f));}}async[a40_0x519081(0x17e)](_0x28eb6a){const _0x17df0b=a40_0x519081,_0x7aa8eb=Date[_0x17df0b(0x10f)]();try{console['log']('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x28eb6a);const _0x3fe562={'gatewayPaymentId':_0x28eb6a};loggerService_1[_0x17df0b(0x132)]['logWhiteDomainRequest']('cointopay','/status',_0x17df0b(0x138),_0x3fe562);const _0x1cc055=await fetch(this[_0x17df0b(0x177)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x17df0b(0x125),'User-Agent':_0x17df0b(0x118)},'body':JSON[_0x17df0b(0x12f)](_0x3fe562)}),_0x575a7d=Date['now']()-_0x7aa8eb;console['log'](_0x17df0b(0x14a)),console[_0x17df0b(0x122)](_0x17df0b(0x18e),_0x1cc055['status']),console[_0x17df0b(0x122)](_0x17df0b(0x164),_0x575a7d+'ms');if(!_0x1cc055['ok']){const _0x1f5d85=await _0x1cc055[_0x17df0b(0x150)]();console['error'](_0x17df0b(0x12d),_0x1cc055[_0x17df0b(0x14e)]),console['error'](_0x17df0b(0x11a),_0x1f5d85),loggerService_1[_0x17df0b(0x132)][_0x17df0b(0x16b)](_0x17df0b(0x18c),_0x17df0b(0x120),_0x1cc055['status'],_0x1f5d85,_0x575a7d),loggerService_1[_0x17df0b(0x132)]['logWhiteDomainError']('cointopay','/status','HTTP\x20'+_0x1cc055['status']+':\x20'+_0x1f5d85);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1cc055[_0x17df0b(0x14e)]);}const _0x2e1d13=await _0x1cc055['text']();console['log']('Raw\x20Response\x20Body:',_0x2e1d13);let _0x19243b;try{_0x19243b=JSON[_0x17df0b(0x171)](_0x2e1d13);}catch(_0x27e3ed){console[_0x17df0b(0x188)](_0x17df0b(0x116),_0x27e3ed),loggerService_1[_0x17df0b(0x132)]['logWhiteDomainError'](_0x17df0b(0x18c),_0x17df0b(0x120),'JSON\x20Parse\x20Error:\x20'+_0x27e3ed);throw new Error(_0x17df0b(0x179)+_0x2e1d13);}loggerService_1['loggerService'][_0x17df0b(0x16b)]('cointopay',_0x17df0b(0x120),_0x1cc055[_0x17df0b(0x14e)],_0x19243b,_0x575a7d),console[_0x17df0b(0x122)](_0x17df0b(0x18d)),console[_0x17df0b(0x122)](_0x17df0b(0x162),_0x19243b[_0x17df0b(0x119)]),console[_0x17df0b(0x122)](_0x17df0b(0x168),_0x19243b[_0x17df0b(0x16e)]),console['log'](_0x17df0b(0x16c),_0x19243b[_0x17df0b(0x130)]?.[_0x17df0b(0x117)]),console[_0x17df0b(0x122)](_0x17df0b(0x113),_0x19243b['data']?.[_0x17df0b(0x11d)]),console[_0x17df0b(0x122)]('Currency:',_0x19243b[_0x17df0b(0x130)]?.[_0x17df0b(0x18f)]);if(_0x19243b[_0x17df0b(0x119)]!=='success'||_0x19243b[_0x17df0b(0x16e)]!==0xc8){const _0x5e2934=_0x19243b[_0x17df0b(0x15d)]||_0x17df0b(0x12a);console['error'](_0x17df0b(0x175)),console[_0x17df0b(0x188)](_0x17df0b(0x134),_0x5e2934),loggerService_1['loggerService'][_0x17df0b(0x12e)](_0x17df0b(0x18c),_0x17df0b(0x120),'Status\x20API\x20Error:\x20'+_0x5e2934);throw new Error(_0x17df0b(0x155)+_0x5e2934);}if(!_0x19243b[_0x17df0b(0x130)]){console['error'](_0x17df0b(0x13a)),console[_0x17df0b(0x188)](_0x17df0b(0x176)),loggerService_1[_0x17df0b(0x132)][_0x17df0b(0x12e)](_0x17df0b(0x18c),_0x17df0b(0x120),_0x17df0b(0x152));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2f8e99=_0x17df0b(0x135);switch(_0x19243b['data'][_0x17df0b(0x117)]?.[_0x17df0b(0x172)]()){case _0x17df0b(0x173):_0x2f8e99=_0x17df0b(0x190);break;case _0x17df0b(0x141):case _0x17df0b(0x10e):case'error':_0x2f8e99=_0x17df0b(0x126);break;case _0x17df0b(0x13c):case'timeout':_0x2f8e99=_0x17df0b(0x11c);break;case _0x17df0b(0x127):case _0x17df0b(0x14c):case _0x17df0b(0x137):case _0x17df0b(0x143):default:_0x2f8e99=_0x17df0b(0x135);break;}let _0x159881,_0x2ec21b;if(_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x13d)]){const _0x406e9a=_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x13d)];console['log'](_0x17df0b(0x167),_0x406e9a);const _0x46d9fb=_0x406e9a['match'](/IBAN\s+([A-Z0-9]+)/i);_0x46d9fb&&(_0x159881=_0x46d9fb[0x1],console['log'](_0x17df0b(0x15b),_0x159881)),_0x2ec21b=_0x406e9a;}const _0xb71433={'iban':_0x159881,'bankDetails':_0x2ec21b,'transactionId':_0x19243b['data']['TransactionID'],'coinAddress':_0x19243b['data'][_0x17df0b(0x18b)],'qrCodeUrl':_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x10c)],'expiryTime':_0x19243b['data']['ExpiryTime'],'createdOn':_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x15c)],'confirmedOn':_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x184)]};console['log'](_0x17df0b(0x11b)),console[_0x17df0b(0x122)](_0x17df0b(0x18e),_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x117)],'->',_0x2f8e99),console[_0x17df0b(0x122)]('Amount:',_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x11d)],_0x19243b['data'][_0x17df0b(0x18f)]),console[_0x17df0b(0x122)](_0x17df0b(0x14f),_0x19243b['data'][_0x17df0b(0x142)]),console[_0x17df0b(0x122)](_0x17df0b(0x169),_0x159881||'not\x20found'),console['log'](_0x17df0b(0x10b),_0x19243b[_0x17df0b(0x130)]['CreatedOn']),console[_0x17df0b(0x122)]('Confirmed\x20On:',_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x184)]||_0x17df0b(0x183));if(_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x117)]?.[_0x17df0b(0x172)]()===_0x17df0b(0x14c))console[_0x17df0b(0x122)](_0x17df0b(0x12c));else _0x19243b[_0x17df0b(0x130)][_0x17df0b(0x117)]?.[_0x17df0b(0x172)]()===_0x17df0b(0x173)&&console['log'](_0x17df0b(0x121));return{'status':_0x2f8e99,'amount':parseFloat(_0x19243b[_0x17df0b(0x130)]['Amount'])||undefined,'currency':_0x19243b[_0x17df0b(0x130)][_0x17df0b(0x18f)]||_0x17df0b(0x180),'paymentDetails':_0xb71433};}catch(_0xded9a8){console[_0x17df0b(0x188)](_0x17df0b(0x153),_0xded9a8),loggerService_1[_0x17df0b(0x132)][_0x17df0b(0x12e)](_0x17df0b(0x18c),_0x17df0b(0x120),_0xded9a8);throw new Error(_0x17df0b(0x157)+(_0xded9a8 instanceof Error?_0xded9a8[_0x17df0b(0x15d)]:'Unknown\x20error'));}}async[a40_0x519081(0x166)](_0x122626){const _0x2146e4=a40_0x519081,_0x3ba6b8=await this[_0x2146e4(0x17e)](_0x122626);return{'status':_0x3ba6b8[_0x2146e4(0x14e)],'amount':_0x3ba6b8[_0x2146e4(0x16d)],'currency':_0x3ba6b8[_0x2146e4(0x14b)]};}async[a40_0x519081(0x174)](_0x11fa1c){const _0x422b32=a40_0x519081;console[_0x422b32(0x122)](_0x422b32(0x11e),_0x11fa1c);let _0x145596=_0x422b32(0x135);switch(_0x11fa1c[_0x422b32(0x14e)]?.['toLowerCase']()){case _0x422b32(0x173):_0x145596=_0x422b32(0x190);break;case _0x422b32(0x141):case _0x422b32(0x10e):case _0x422b32(0x188):_0x145596=_0x422b32(0x126);break;case _0x422b32(0x13c):case _0x422b32(0x115):_0x145596=_0x422b32(0x11c);break;case _0x422b32(0x137):case _0x422b32(0x127):case _0x422b32(0x14c):case'created':default:_0x145596=_0x422b32(0x135);break;}return{'paymentId':_0x11fa1c[_0x422b32(0x160)]||_0x11fa1c['merchant_reference_id']||'','status':_0x145596,'amount':_0x11fa1c['amount'],'currency':_0x11fa1c[_0x422b32(0x14b)]||_0x422b32(0x180)};}}exports[a40_0x519081(0x12b)]=CoinToPayService;function a40_0xe98d(){const _0x87edc8=['awaiting\x20fiat','Payment\x20URL:','status','Transaction\x20ID:','text','245008yBUPvD','Incomplete\x20response:\x20missing\x20data','CoinToPay\x20payment\x20status\x20check\x20error:','https://tesoft.uk/gateway/cointopay/status.php','CoinToPay\x20status\x20API\x20error:\x20','📊\x20Status\x20check\x20URL:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','headers',',\x20body:\x20','961wuHLOI','🏦\x20Extracted\x20IBAN:','CreatedOn','message','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','order_id','logWhiteDomainRequest','Result:','\x20EUR','Response\x20Time:','2893866KjxpgU','verifyPayment','🏦\x20Payment\x20Detail:','Status\x20Code:','IBAN:','5717470JhFArS','logWhiteDomainResponse','Payment\x20Status:','amount','status_code','entries','statusText','parse','toLowerCase','paid','processWebhook','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Missing\x20data\x20in\x20response','statusUrl','48akIElq','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','apiUrl','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20','checkPaymentStatus','fromEntries','EUR','Error\x20stack:','Error\x20message:','not\x20confirmed','TransactionConfirmedOn','Error\x20details:','1522ageWqY','Unknown\x20error\x20from\x20CoinToPay\x20API','error','gateway_payment_id','URL:','coinAddress','cointopay','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status:','inputCurrency','PAID','35xUgrIC','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Created\x20On:','QRCodeURL','Gateway\x20Payment\x20ID:','failed','now','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Amount:','14317204snwmVB','timeout','Failed\x20to\x20parse\x20JSON\x20response:','Status','TesSoft\x20Payment\x20System/1.0','result','Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','EXPIRED','Amount','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','/status','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','log','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','createPaymentLink','application/json','FAILED','waiting','stack','180705sNcmFU','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','CoinToPayService','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20Status:','logWhiteDomainError','stringify','data','Request\x20Body:','loggerService','https://tesoft.uk/gateway/cointopay/','Error\x20Message:','PENDING','CoinToPay\x20API\x20error:\x20','pending','POST','2019360tmHRLZ','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','expired','PaymentDetail','9hSqnFR','payment_url','Response\x20data:','cancelled','TransactionID','created','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','__esModule','Raw\x20Response\x20Body:','===\x20COINTOPAY\x20SUCCESS\x20===','Headers:','/create','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','currency'];a40_0xe98d=function(){return _0x87edc8;};return a40_0xe98d();}