'use strict';function a41_0x224a(_0x1fd43d,_0x219bf5){const _0x3c94ff=a41_0x3c94();return a41_0x224a=function(_0x224add,_0x34491d){_0x224add=_0x224add-0x74;let _0x1bfdd0=_0x3c94ff[_0x224add];return _0x1bfdd0;},a41_0x224a(_0x1fd43d,_0x219bf5);}const a41_0x2df0ce=a41_0x224a;(function(_0x136d06,_0x2efb65){const _0x7d770=a41_0x224a,_0x45ebb3=_0x136d06();while(!![]){try{const _0x556035=parseInt(_0x7d770(0xbf))/0x1+parseInt(_0x7d770(0x9e))/0x2*(parseInt(_0x7d770(0xa5))/0x3)+parseInt(_0x7d770(0xb0))/0x4+parseInt(_0x7d770(0x74))/0x5*(-parseInt(_0x7d770(0x8c))/0x6)+parseInt(_0x7d770(0xa3))/0x7*(parseInt(_0x7d770(0xc5))/0x8)+parseInt(_0x7d770(0x88))/0x9+parseInt(_0x7d770(0x8a))/0xa*(-parseInt(_0x7d770(0x81))/0xb);if(_0x556035===_0x2efb65)break;else _0x45ebb3['push'](_0x45ebb3['shift']());}catch(_0x3585d4){_0x45ebb3['push'](_0x45ebb3['shift']());}}}(a41_0x3c94,0x44a9c));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a41_0x2df0ce(0x80)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x1cb210=a41_0x2df0ce;this[_0x1cb210(0xc3)]=_0x1cb210(0xaa),this[_0x1cb210(0x8f)]=_0x1cb210(0x84),console[_0x1cb210(0xc8)](_0x1cb210(0xaf)),console['log'](_0x1cb210(0xde),this[_0x1cb210(0x8f)]);}async['createPaymentLink'](_0x19d2f9){const _0x1c791d=a41_0x2df0ce,{orderId:_0x3ae307,amount:_0x1f252e}=_0x19d2f9;console[_0x1c791d(0xc8)](_0x1c791d(0x7c)+_0x1f252e+_0x1c791d(0x75));const _0x2e17b3={'amount':_0x1f252e},_0x5ae4a2=Date[_0x1c791d(0xe4)]();try{console[_0x1c791d(0xc8)](_0x1c791d(0x79)),console[_0x1c791d(0xc8)]('URL:',this[_0x1c791d(0xc3)]),console[_0x1c791d(0xc8)](_0x1c791d(0xc4),JSON[_0x1c791d(0xae)](_0x2e17b3,null,0x2)),console[_0x1c791d(0xc8)](_0x1c791d(0xcf),_0x1f252e,_0x1c791d(0x76)),loggerService_1[_0x1c791d(0x8b)]['logWhiteDomainRequest'](_0x1c791d(0x99),_0x1c791d(0xa2),_0x1c791d(0xb7),_0x2e17b3);const _0x4c89f5=await fetch(this[_0x1c791d(0xc3)],{'method':_0x1c791d(0xb7),'headers':{'Content-Type':_0x1c791d(0xdf),'Accept':_0x1c791d(0xdf),'User-Agent':_0x1c791d(0x82)},'body':JSON[_0x1c791d(0xae)](_0x2e17b3)}),_0x324414=Date[_0x1c791d(0xe4)]()-_0x5ae4a2;console['log'](_0x1c791d(0x86)),console[_0x1c791d(0xc8)](_0x1c791d(0xa1),_0x4c89f5[_0x1c791d(0xe6)]),console[_0x1c791d(0xc8)]('Status\x20Text:',_0x4c89f5['statusText']),console['log']('Headers:',Object[_0x1c791d(0xa6)](_0x4c89f5[_0x1c791d(0x7a)][_0x1c791d(0xcd)]())),console[_0x1c791d(0xc8)]('Response\x20Time:',_0x324414+'ms');const _0x5f3aa5=await _0x4c89f5[_0x1c791d(0xb8)]();console[_0x1c791d(0xc8)]('Raw\x20Response\x20Body:',_0x5f3aa5);if(!_0x4c89f5['ok']){console[_0x1c791d(0xb9)](_0x1c791d(0xd0)),console[_0x1c791d(0xb9)](_0x1c791d(0xc9),_0x4c89f5[_0x1c791d(0xe6)]),console[_0x1c791d(0xb9)](_0x1c791d(0xa9),_0x5f3aa5),loggerService_1['loggerService'][_0x1c791d(0x87)](_0x1c791d(0x99),_0x1c791d(0xa2),_0x4c89f5[_0x1c791d(0xe6)],_0x5f3aa5,_0x324414),loggerService_1[_0x1c791d(0x8b)]['logWhiteDomainError'](_0x1c791d(0x99),'/create','HTTP\x20'+_0x4c89f5['status']+':\x20'+_0x5f3aa5);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4c89f5['status']+_0x1c791d(0xd4)+_0x5f3aa5);}let _0x24d97d;try{_0x24d97d=JSON[_0x1c791d(0x83)](_0x5f3aa5);}catch(_0x3a07ce){console[_0x1c791d(0xb9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3a07ce),loggerService_1['loggerService'][_0x1c791d(0xcb)](_0x1c791d(0x99),'/create',_0x1c791d(0x78)+_0x3a07ce);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5f3aa5);}console['log']('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x1c791d(0xc8)](_0x1c791d(0xc1),JSON['stringify'](_0x24d97d,null,0x2)),loggerService_1['loggerService'][_0x1c791d(0x87)]('cointopay',_0x1c791d(0xa2),_0x4c89f5[_0x1c791d(0xe6)],_0x24d97d,_0x324414);if(_0x24d97d[_0x1c791d(0xb9)]){const _0x1da3da=_0x24d97d[_0x1c791d(0xb4)]||_0x24d97d[_0x1c791d(0xb9)]||_0x1c791d(0xc6);console[_0x1c791d(0xb9)](_0x1c791d(0x7d)),console['error']('Error\x20Message:',_0x1da3da),loggerService_1[_0x1c791d(0x8b)][_0x1c791d(0xcb)](_0x1c791d(0x99),_0x1c791d(0xa2),'Business\x20Error:\x20'+_0x1da3da);throw new Error(_0x1c791d(0x9b)+_0x1da3da);}if(!_0x24d97d[_0x1c791d(0xac)]||!_0x24d97d[_0x1c791d(0xdd)]){console['error'](_0x1c791d(0xdb)),console['error'](_0x1c791d(0xce)),console[_0x1c791d(0xb9)](_0x1c791d(0xb5),_0x24d97d),loggerService_1[_0x1c791d(0x8b)]['logWhiteDomainError'](_0x1c791d(0x99),_0x1c791d(0xa2),_0x1c791d(0x7f));throw new Error(_0x1c791d(0xd6));}return console[_0x1c791d(0xc8)](_0x1c791d(0xd3)),console[_0x1c791d(0xc8)](_0x1c791d(0xe2),_0x24d97d[_0x1c791d(0xdd)]),console[_0x1c791d(0xc8)](_0x1c791d(0x90),_0x24d97d[_0x1c791d(0xac)]),console[_0x1c791d(0xc8)](_0x1c791d(0xcf),_0x1f252e,_0x1c791d(0xed)),{'gateway_payment_id':_0x24d97d[_0x1c791d(0xdd)],'payment_url':_0x24d97d[_0x1c791d(0xac)]};}catch(_0x3e70fa){console['error'](_0x1c791d(0xc2)),console[_0x1c791d(0xb9)]('Error\x20details:',_0x3e70fa),loggerService_1['loggerService']['logWhiteDomainError'](_0x1c791d(0x99),'/create',_0x3e70fa);if(_0x3e70fa instanceof Error){console[_0x1c791d(0xb9)]('Error\x20message:',_0x3e70fa[_0x1c791d(0xb4)]),console[_0x1c791d(0xb9)](_0x1c791d(0x98),_0x3e70fa[_0x1c791d(0x97)]);throw new Error(_0x1c791d(0xea)+_0x3e70fa['message']);}throw new Error(_0x1c791d(0xd7));}}async[a41_0x2df0ce(0x9c)](_0x2112af){const _0x1e4f6b=a41_0x2df0ce,_0xce3065=Date[_0x1e4f6b(0xe4)]();try{console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xb6)+_0x2112af);const _0x3754eb={'gatewayPaymentId':_0x2112af};loggerService_1[_0x1e4f6b(0x8b)][_0x1e4f6b(0xd8)]('cointopay',_0x1e4f6b(0xe7),_0x1e4f6b(0xb7),_0x3754eb);const _0x20995e=await fetch(this[_0x1e4f6b(0x8f)],{'method':_0x1e4f6b(0xb7),'headers':{'Content-Type':_0x1e4f6b(0xdf),'Accept':_0x1e4f6b(0xdf),'User-Agent':_0x1e4f6b(0x82)},'body':JSON['stringify'](_0x3754eb)}),_0x4a5dd4=Date[_0x1e4f6b(0xe4)]()-_0xce3065;console[_0x1e4f6b(0xc8)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xa1),_0x20995e[_0x1e4f6b(0xe6)]),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xa4),_0x4a5dd4+'ms');if(!_0x20995e['ok']){const _0x853854=await _0x20995e[_0x1e4f6b(0xb8)]();console[_0x1e4f6b(0xb9)](_0x1e4f6b(0xc9),_0x20995e[_0x1e4f6b(0xe6)]),console[_0x1e4f6b(0xb9)](_0x1e4f6b(0xa9),_0x853854),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),_0x20995e[_0x1e4f6b(0xe6)],_0x853854,_0x4a5dd4),loggerService_1[_0x1e4f6b(0x8b)]['logWhiteDomainError'](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),'HTTP\x20'+_0x20995e[_0x1e4f6b(0xe6)]+':\x20'+_0x853854);throw new Error(_0x1e4f6b(0xa0)+_0x20995e[_0x1e4f6b(0xe6)]);}const _0x314e6b=await _0x20995e[_0x1e4f6b(0xb8)]();console[_0x1e4f6b(0xc8)]('Raw\x20Response\x20Body:',_0x314e6b);let _0xe9daef;try{_0xe9daef=JSON['parse'](_0x314e6b);}catch(_0x996976){console[_0x1e4f6b(0xb9)](_0x1e4f6b(0x7e),_0x996976),loggerService_1[_0x1e4f6b(0x8b)][_0x1e4f6b(0xcb)](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),_0x1e4f6b(0x78)+_0x996976);throw new Error(_0x1e4f6b(0xd5)+_0x314e6b);}loggerService_1[_0x1e4f6b(0x8b)][_0x1e4f6b(0x87)](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),_0x20995e[_0x1e4f6b(0xe6)],_0xe9daef,_0x4a5dd4),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0xe9daef['result']),console[_0x1e4f6b(0xc8)]('Status\x20Code:',_0xe9daef[_0x1e4f6b(0xef)]),console['log'](_0x1e4f6b(0xd9),_0xe9daef['data']?.[_0x1e4f6b(0xe9)]),console['log'](_0x1e4f6b(0xcf),_0xe9daef[_0x1e4f6b(0xb1)]?.[_0x1e4f6b(0xe8)]),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0x93),_0xe9daef[_0x1e4f6b(0xb1)]?.[_0x1e4f6b(0xd2)]);if(_0xe9daef['result']!==_0x1e4f6b(0x95)||_0xe9daef[_0x1e4f6b(0xef)]!==0xc8){const _0x5e63e6=_0xe9daef[_0x1e4f6b(0xb4)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x1e4f6b(0x77)),console['error']('Error\x20Message:',_0x5e63e6),loggerService_1['loggerService'][_0x1e4f6b(0xcb)](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),'Status\x20API\x20Error:\x20'+_0x5e63e6);throw new Error(_0x1e4f6b(0xb2)+_0x5e63e6);}if(!_0xe9daef['data']){console[_0x1e4f6b(0xb9)](_0x1e4f6b(0xda)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError'](_0x1e4f6b(0x99),_0x1e4f6b(0xe7),_0x1e4f6b(0xca));throw new Error(_0x1e4f6b(0xcc));}let _0x257e5b='PENDING';switch(_0xe9daef[_0x1e4f6b(0xb1)]['Status']?.[_0x1e4f6b(0x7b)]()){case'paid':_0x257e5b=_0x1e4f6b(0xbb);break;case'cancelled':case'failed':case'error':_0x257e5b='FAILED';break;case _0x1e4f6b(0xbd):case _0x1e4f6b(0xb3):_0x257e5b='EXPIRED';break;case _0x1e4f6b(0xe1):case _0x1e4f6b(0xf0):case _0x1e4f6b(0xbc):case _0x1e4f6b(0x89):default:_0x257e5b=_0x1e4f6b(0xc0);break;}let _0x26d5a6,_0x294c27;if(_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xbe)]){const _0x39a433=_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xbe)];console['log'](_0x1e4f6b(0x9d),_0x39a433);const _0x2d70e4=_0x39a433[_0x1e4f6b(0xdc)](/IBAN\s+([A-Z0-9]+)/i);_0x2d70e4&&(_0x26d5a6=_0x2d70e4[0x1],console[_0x1e4f6b(0xc8)](_0x1e4f6b(0x9f),_0x26d5a6)),_0x294c27=_0x39a433;}const _0x53ee64={'iban':_0x26d5a6,'bankDetails':_0x294c27,'transactionId':_0xe9daef['data'][_0x1e4f6b(0xee)],'coinAddress':_0xe9daef[_0x1e4f6b(0xb1)]['coinAddress'],'qrCodeUrl':_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xec)],'expiryTime':_0xe9daef['data']['ExpiryTime'],'createdOn':_0xe9daef['data'][_0x1e4f6b(0xe0)],'confirmedOn':_0xe9daef[_0x1e4f6b(0xb1)]['TransactionConfirmedOn']};console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xd1)),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xa1),_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xe9)],'->',_0x257e5b),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xcf),_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xe8)],_0xe9daef[_0x1e4f6b(0xb1)]['inputCurrency']),console[_0x1e4f6b(0xc8)]('Transaction\x20ID:',_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xee)]),console['log'](_0x1e4f6b(0x96),_0x26d5a6||'not\x20found'),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xa7),_0xe9daef[_0x1e4f6b(0xb1)]['CreatedOn']),console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xe5),_0xe9daef['data'][_0x1e4f6b(0xf1)]||_0x1e4f6b(0x91));if(_0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xe9)]?.[_0x1e4f6b(0x7b)]()==='awaiting\x20fiat')console[_0x1e4f6b(0xc8)]('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xe9daef[_0x1e4f6b(0xb1)][_0x1e4f6b(0xe9)]?.[_0x1e4f6b(0x7b)]()==='paid'&&console[_0x1e4f6b(0xc8)](_0x1e4f6b(0xe3));return{'status':_0x257e5b,'amount':parseFloat(_0xe9daef['data']['Amount'])||undefined,'currency':_0xe9daef['data'][_0x1e4f6b(0xd2)]||'EUR','paymentDetails':_0x53ee64};}catch(_0x3ec3d4){console['error'](_0x1e4f6b(0xab),_0x3ec3d4),loggerService_1[_0x1e4f6b(0x8b)][_0x1e4f6b(0xcb)]('cointopay',_0x1e4f6b(0xe7),_0x3ec3d4);throw new Error(_0x1e4f6b(0x8d)+(_0x3ec3d4 instanceof Error?_0x3ec3d4[_0x1e4f6b(0xb4)]:_0x1e4f6b(0xeb)));}}async[a41_0x2df0ce(0xa8)](_0x227465){const _0x286e33=a41_0x2df0ce,_0x5be6ff=await this[_0x286e33(0x9c)](_0x227465);return{'status':_0x5be6ff[_0x286e33(0xe6)],'amount':_0x5be6ff[_0x286e33(0x94)],'currency':_0x5be6ff[_0x286e33(0x92)]};}async[a41_0x2df0ce(0x8e)](_0x140cfb){const _0x3a39fb=a41_0x2df0ce;console[_0x3a39fb(0xc8)](_0x3a39fb(0x85),_0x140cfb);let _0x4e58ae=_0x3a39fb(0xc0);switch(_0x140cfb[_0x3a39fb(0xe6)]?.[_0x3a39fb(0x7b)]()){case'paid':_0x4e58ae='PAID';break;case _0x3a39fb(0x9a):case _0x3a39fb(0xad):case'error':_0x4e58ae=_0x3a39fb(0xba);break;case _0x3a39fb(0xbd):case'timeout':_0x4e58ae=_0x3a39fb(0xc7);break;case'pending':case _0x3a39fb(0xe1):case _0x3a39fb(0xf0):case _0x3a39fb(0x89):default:_0x4e58ae=_0x3a39fb(0xc0);break;}return{'paymentId':_0x140cfb['order_id']||_0x140cfb['merchant_reference_id']||'','status':_0x4e58ae,'amount':_0x140cfb['amount'],'currency':_0x140cfb[_0x3a39fb(0x92)]||_0x3a39fb(0xed)};}}function a41_0x3c94(){const _0x35345d=['Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','logWhiteDomainResponse','194076ayjWvW','created','548140mHFjbL','loggerService','18kcaGIz','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','processWebhook','statusUrl','Payment\x20URL:','not\x20confirmed','currency','Currency:','amount','success','IBAN:','stack','Error\x20stack:','cointopay','cancelled','CoinToPay\x20API\x20error:\x20','checkPaymentStatus','🏦\x20Payment\x20Detail:','147038oJOVaA','🏦\x20Extracted\x20IBAN:','HTTP\x20error!\x20status:\x20','Status:','/create','7lXUOTb','Response\x20Time:','9aWeqJz','fromEntries','Created\x20On:','verifyPayment','Response\x20Body:','https://tesoft.uk/gateway/cointopay/','CoinToPay\x20payment\x20status\x20check\x20error:','payment_url','failed','stringify','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1078132kePzZp','data','CoinToPay\x20status\x20API\x20error:\x20','timeout','message','Response\x20data:','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','POST','text','error','FAILED','PAID','pending','expired','PaymentDetail','376889YzOMyW','PENDING','Parsed\x20Result:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','apiUrl','Request\x20Body:','1837336iTnRjR','Unknown\x20error\x20from\x20CoinToPay\x20API','EXPIRED','log','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20data','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','entries','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Amount:','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','inputCurrency','===\x20COINTOPAY\x20SUCCESS\x20===',',\x20body:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','logWhiteDomainRequest','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','match','gateway_payment_id','📊\x20Status\x20check\x20URL:','application/json','CreatedOn','waiting','Gateway\x20Payment\x20ID:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','now','Confirmed\x20On:','status','/status','Amount','Status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Unknown\x20error','QRCodeURL','EUR','TransactionID','status_code','awaiting\x20fiat','TransactionConfirmedOn','390020jBAWBu','\x20EUR','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','headers','toLowerCase','🪙\x20Creating\x20CoinToPay\x20payment:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPayService','121PHuibv','TesSoft\x20Payment\x20System/1.0','parse','https://tesoft.uk/gateway/cointopay/status.php'];a41_0x3c94=function(){return _0x35345d;};return a41_0x3c94();}exports[a41_0x2df0ce(0x80)]=CoinToPayService;