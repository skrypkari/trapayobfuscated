'use strict';const a43_0x48012a=a43_0x4dd8;function a43_0x4dd8(_0x9905e8,_0x47df40){const _0x376fe1=a43_0x376f();return a43_0x4dd8=function(_0x4dd8f9,_0x5a2c9f){_0x4dd8f9=_0x4dd8f9-0x1ea;let _0x57d319=_0x376fe1[_0x4dd8f9];return _0x57d319;},a43_0x4dd8(_0x9905e8,_0x47df40);}(function(_0x495e7c,_0x510292){const _0x5319a3=a43_0x4dd8,_0x4e4294=_0x495e7c();while(!![]){try{const _0x17d997=-parseInt(_0x5319a3(0x24e))/0x1*(-parseInt(_0x5319a3(0x248))/0x2)+parseInt(_0x5319a3(0x22f))/0x3*(-parseInt(_0x5319a3(0x24f))/0x4)+-parseInt(_0x5319a3(0x228))/0x5*(-parseInt(_0x5319a3(0x1ed))/0x6)+-parseInt(_0x5319a3(0x252))/0x7+parseInt(_0x5319a3(0x272))/0x8+-parseInt(_0x5319a3(0x20f))/0x9*(parseInt(_0x5319a3(0x20c))/0xa)+parseInt(_0x5319a3(0x21d))/0xb;if(_0x17d997===_0x510292)break;else _0x4e4294['push'](_0x4e4294['shift']());}catch(_0x36ef24){_0x4e4294['push'](_0x4e4294['shift']());}}}(a43_0x376f,0x23e97));function a43_0x376f(){const _0x46131b=['\x20EUR','HTTP\x20','Transaction\x20ID:','inputCurrency','cointopay','https://tesoft.uk/gateway/cointopay/','https://tesoft.uk/gateway/cointopay/status.php','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','awaiting\x20fiat','waiting','logWhiteDomainRequest','currency','Request\x20Body:','Unknown\x20error','PaymentDetail','match','PENDING','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status\x20API\x20Error:\x20','defineProperty','logWhiteDomainError','Amount',',\x20body:\x20','115544pACDhR','processWebhook','order_id','text','Currency:','JSON\x20Parse\x20Error:\x20','timeout','96ODnxOb','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Status:','expired','Created\x20On:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','now','PAID','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Business\x20Error:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','toLowerCase','loggerService','cancelled','not\x20confirmed','created','FAILED','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','result','TesSoft\x20Payment\x20System/1.0','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','checkPaymentStatus','===\x20COINTOPAY\x20SUCCESS\x20===','Status','10LPncXA','Parsed\x20Result:','statusUrl','2239065kgicKP','üè¶\x20Extracted\x20IBAN:','status_code','Response\x20data:','pending','fromEntries','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CoinToPayService','not\x20found','Payment\x20URL:','stack','message','failed','error','4189075IjoUdf','__esModule','data','Missing\x20data\x20in\x20response','EUR','TransactionConfirmedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','stringify','gateway_payment_id','TransactionID','../loggerService','90845XGrsiv','payment_url','success','log','/status','createPaymentLink','paid','39NJMyKL','coinAddress','Status\x20Text:','Raw\x20Response\x20Body:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','amount','apiUrl','logWhiteDomainResponse','statusText','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','application/json','üè¶\x20Payment\x20Detail:','Amount:','HTTP\x20Status:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Result:','parse','URL:','Payment\x20Status:','Status\x20Code:','Incomplete\x20response:\x20missing\x20data','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20Message:','CoinToPay\x20payment\x20status\x20check\x20error:','15860tVvTUM','Error\x20message:','Response\x20Body:','POST','Error\x20stack:','status','13abBxWh','70376HzMLDN','/create','EXPIRED','1151220Imnimg','===\x20COINTOPAY\x20API\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Response\x20Time:','üìä\x20Status\x20check\x20URL:','Confirmed\x20On:','entries'];a43_0x376f=function(){return _0x46131b;};return a43_0x376f();}Object[a43_0x48012a(0x26e)](exports,a43_0x48012a(0x21e),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a43_0x48012a(0x227));class CoinToPayService{constructor(){const _0x13da12=a43_0x48012a;this[_0x13da12(0x235)]=_0x13da12(0x25e),this[_0x13da12(0x20e)]=_0x13da12(0x25f),console[_0x13da12(0x22b)](_0x13da12(0x239)),console[_0x13da12(0x22b)](_0x13da12(0x256),this[_0x13da12(0x20e)]);}async[a43_0x48012a(0x22d)](_0x56eb25){const _0x27e941=a43_0x48012a,{orderId:_0xe2f1c3,amount:_0x3a0879}=_0x56eb25;console[_0x27e941(0x22b)](_0x27e941(0x1ee)+_0x3a0879+_0x27e941(0x259));const _0x27a1b7={'amount':_0x3a0879},_0x3992d4=Date[_0x27e941(0x1f4)]();try{console[_0x27e941(0x22b)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x27e941(0x22b)](_0x27e941(0x241),this['apiUrl']),console[_0x27e941(0x22b)](_0x27e941(0x266),JSON['stringify'](_0x27a1b7,null,0x2)),console[_0x27e941(0x22b)]('Amount:',_0x3a0879,_0x27e941(0x23e)),loggerService_1['loggerService'][_0x27e941(0x264)](_0x27e941(0x25d),_0x27e941(0x250),'POST',_0x27a1b7);const _0x5cafb1=await fetch(this[_0x27e941(0x235)],{'method':_0x27e941(0x24b),'headers':{'Content-Type':'application/json','Accept':_0x27e941(0x23a),'User-Agent':_0x27e941(0x203)},'body':JSON['stringify'](_0x27a1b7)}),_0x20946d=Date[_0x27e941(0x1f4)]()-_0x3992d4;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x27e941(0x1ef),_0x5cafb1[_0x27e941(0x24d)]),console[_0x27e941(0x22b)](_0x27e941(0x231),_0x5cafb1[_0x27e941(0x237)]),console['log']('Headers:',Object[_0x27e941(0x214)](_0x5cafb1['headers'][_0x27e941(0x258)]())),console[_0x27e941(0x22b)](_0x27e941(0x255),_0x20946d+'ms');const _0x2af74b=await _0x5cafb1[_0x27e941(0x275)]();console[_0x27e941(0x22b)](_0x27e941(0x232),_0x2af74b);if(!_0x5cafb1['ok']){console[_0x27e941(0x21c)](_0x27e941(0x253)),console[_0x27e941(0x21c)](_0x27e941(0x23d),_0x5cafb1[_0x27e941(0x24d)]),console[_0x27e941(0x21c)](_0x27e941(0x24a),_0x2af74b),loggerService_1[_0x27e941(0x1fc)][_0x27e941(0x236)](_0x27e941(0x25d),_0x27e941(0x250),_0x5cafb1[_0x27e941(0x24d)],_0x2af74b,_0x20946d),loggerService_1[_0x27e941(0x1fc)][_0x27e941(0x26f)]('cointopay',_0x27e941(0x250),'HTTP\x20'+_0x5cafb1[_0x27e941(0x24d)]+':\x20'+_0x2af74b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5cafb1['status']+_0x27e941(0x271)+_0x2af74b);}let _0x140744;try{_0x140744=JSON[_0x27e941(0x240)](_0x2af74b);}catch(_0x246069){console[_0x27e941(0x21c)](_0x27e941(0x207),_0x246069),loggerService_1[_0x27e941(0x1fc)][_0x27e941(0x26f)](_0x27e941(0x25d),_0x27e941(0x250),_0x27e941(0x1eb)+_0x246069);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2af74b);}console[_0x27e941(0x22b)](_0x27e941(0x208)),console[_0x27e941(0x22b)](_0x27e941(0x20d),JSON[_0x27e941(0x224)](_0x140744,null,0x2)),loggerService_1['loggerService'][_0x27e941(0x236)](_0x27e941(0x25d),'/create',_0x5cafb1[_0x27e941(0x24d)],_0x140744,_0x20946d);if(_0x140744[_0x27e941(0x21c)]){const _0x235ae9=_0x140744['message']||_0x140744['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x27e941(0x26c)),console[_0x27e941(0x21c)](_0x27e941(0x246),_0x235ae9),loggerService_1['loggerService'][_0x27e941(0x26f)]('cointopay','/create',_0x27e941(0x1f7)+_0x235ae9);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x235ae9);}if(!_0x140744[_0x27e941(0x229)]||!_0x140744[_0x27e941(0x225)]){console[_0x27e941(0x21c)](_0x27e941(0x215)),console['error'](_0x27e941(0x233)),console[_0x27e941(0x21c)](_0x27e941(0x212),_0x140744),loggerService_1[_0x27e941(0x1fc)][_0x27e941(0x26f)](_0x27e941(0x25d),_0x27e941(0x250),_0x27e941(0x254));throw new Error(_0x27e941(0x206));}return console['log'](_0x27e941(0x20a)),console['log']('Gateway\x20Payment\x20ID:',_0x140744[_0x27e941(0x225)]),console[_0x27e941(0x22b)](_0x27e941(0x218),_0x140744['payment_url']),console[_0x27e941(0x22b)](_0x27e941(0x23c),_0x3a0879,_0x27e941(0x221)),{'gateway_payment_id':_0x140744['gateway_payment_id'],'payment_url':_0x140744[_0x27e941(0x229)]};}catch(_0x29d03d){console[_0x27e941(0x21c)](_0x27e941(0x223)),console['error']('Error\x20details:',_0x29d03d),loggerService_1[_0x27e941(0x1fc)][_0x27e941(0x26f)](_0x27e941(0x25d),_0x27e941(0x250),_0x29d03d);if(_0x29d03d instanceof Error){console[_0x27e941(0x21c)](_0x27e941(0x249),_0x29d03d[_0x27e941(0x21a)]),console[_0x27e941(0x21c)](_0x27e941(0x24c),_0x29d03d[_0x27e941(0x219)]);throw new Error(_0x27e941(0x245)+_0x29d03d[_0x27e941(0x21a)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x48012a(0x209)](_0x5160b7){const _0x836b3b=a43_0x48012a,_0x165e11=Date['now']();try{console[_0x836b3b(0x22b)](_0x836b3b(0x1f8)+_0x5160b7);const _0x1797f8={'gatewayPaymentId':_0x5160b7};loggerService_1[_0x836b3b(0x1fc)][_0x836b3b(0x264)](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x836b3b(0x24b),_0x1797f8);const _0x5e465b=await fetch(this['statusUrl'],{'method':_0x836b3b(0x24b),'headers':{'Content-Type':'application/json','Accept':_0x836b3b(0x23a),'User-Agent':_0x836b3b(0x203)},'body':JSON['stringify'](_0x1797f8)}),_0x20029d=Date[_0x836b3b(0x1f4)]()-_0x165e11;console[_0x836b3b(0x22b)](_0x836b3b(0x1fa)),console[_0x836b3b(0x22b)]('Status:',_0x5e465b[_0x836b3b(0x24d)]),console[_0x836b3b(0x22b)](_0x836b3b(0x255),_0x20029d+'ms');if(!_0x5e465b['ok']){const _0x59b2f8=await _0x5e465b[_0x836b3b(0x275)]();console[_0x836b3b(0x21c)](_0x836b3b(0x23d),_0x5e465b['status']),console['error'](_0x836b3b(0x24a),_0x59b2f8),loggerService_1[_0x836b3b(0x1fc)][_0x836b3b(0x236)]('cointopay',_0x836b3b(0x22c),_0x5e465b[_0x836b3b(0x24d)],_0x59b2f8,_0x20029d),loggerService_1[_0x836b3b(0x1fc)][_0x836b3b(0x26f)](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x836b3b(0x25a)+_0x5e465b[_0x836b3b(0x24d)]+':\x20'+_0x59b2f8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5e465b[_0x836b3b(0x24d)]);}const _0x462c3a=await _0x5e465b[_0x836b3b(0x275)]();console['log'](_0x836b3b(0x232),_0x462c3a);let _0x4f328d;try{_0x4f328d=JSON[_0x836b3b(0x240)](_0x462c3a);}catch(_0x355e57){console[_0x836b3b(0x21c)](_0x836b3b(0x207),_0x355e57),loggerService_1[_0x836b3b(0x1fc)]['logWhiteDomainError'](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x836b3b(0x1eb)+_0x355e57);throw new Error(_0x836b3b(0x26b)+_0x462c3a);}loggerService_1[_0x836b3b(0x1fc)][_0x836b3b(0x236)](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x5e465b[_0x836b3b(0x24d)],_0x4f328d,_0x20029d),console[_0x836b3b(0x22b)](_0x836b3b(0x201)),console[_0x836b3b(0x22b)](_0x836b3b(0x23f),_0x4f328d[_0x836b3b(0x202)]),console[_0x836b3b(0x22b)](_0x836b3b(0x243),_0x4f328d[_0x836b3b(0x211)]),console[_0x836b3b(0x22b)](_0x836b3b(0x242),_0x4f328d[_0x836b3b(0x21f)]?.[_0x836b3b(0x20b)]),console[_0x836b3b(0x22b)]('Amount:',_0x4f328d[_0x836b3b(0x21f)]?.[_0x836b3b(0x270)]),console[_0x836b3b(0x22b)](_0x836b3b(0x1ea),_0x4f328d[_0x836b3b(0x21f)]?.['inputCurrency']);if(_0x4f328d[_0x836b3b(0x202)]!==_0x836b3b(0x22a)||_0x4f328d[_0x836b3b(0x211)]!==0xc8){const _0x20f716=_0x4f328d[_0x836b3b(0x21a)]||_0x836b3b(0x1f6);console[_0x836b3b(0x21c)](_0x836b3b(0x1f9)),console[_0x836b3b(0x21c)](_0x836b3b(0x246),_0x20f716),loggerService_1['loggerService'][_0x836b3b(0x26f)]('cointopay',_0x836b3b(0x22c),_0x836b3b(0x26d)+_0x20f716);throw new Error(_0x836b3b(0x204)+_0x20f716);}if(!_0x4f328d['data']){console[_0x836b3b(0x21c)](_0x836b3b(0x205)),console[_0x836b3b(0x21c)](_0x836b3b(0x220)),loggerService_1[_0x836b3b(0x1fc)][_0x836b3b(0x26f)](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x836b3b(0x244));throw new Error(_0x836b3b(0x238));}let _0x29fa55='PENDING';switch(_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x20b)]?.['toLowerCase']()){case _0x836b3b(0x22e):_0x29fa55=_0x836b3b(0x1f5);break;case _0x836b3b(0x1fd):case _0x836b3b(0x21b):case'error':_0x29fa55=_0x836b3b(0x200);break;case _0x836b3b(0x1f0):case _0x836b3b(0x1ec):_0x29fa55=_0x836b3b(0x251);break;case _0x836b3b(0x263):case _0x836b3b(0x262):case _0x836b3b(0x213):case _0x836b3b(0x1ff):default:_0x29fa55=_0x836b3b(0x26a);break;}let _0x263045,_0x530c7d;if(_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x268)]){const _0x36ea2a=_0x4f328d['data']['PaymentDetail'];console[_0x836b3b(0x22b)](_0x836b3b(0x23b),_0x36ea2a);const _0x40162a=_0x36ea2a[_0x836b3b(0x269)](/IBAN\s+([A-Z0-9]+)/i);_0x40162a&&(_0x263045=_0x40162a[0x1],console[_0x836b3b(0x22b)](_0x836b3b(0x210),_0x263045)),_0x530c7d=_0x36ea2a;}const _0x4614ea={'iban':_0x263045,'bankDetails':_0x530c7d,'transactionId':_0x4f328d['data'][_0x836b3b(0x226)],'coinAddress':_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x230)],'qrCodeUrl':_0x4f328d[_0x836b3b(0x21f)]['QRCodeURL'],'expiryTime':_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x260)],'createdOn':_0x4f328d[_0x836b3b(0x21f)]['CreatedOn'],'confirmedOn':_0x4f328d['data']['TransactionConfirmedOn']};console[_0x836b3b(0x22b)](_0x836b3b(0x261)),console['log']('Status:',_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x20b)],'->',_0x29fa55),console['log'](_0x836b3b(0x23c),_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x270)],_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x25c)]),console[_0x836b3b(0x22b)](_0x836b3b(0x25b),_0x4f328d[_0x836b3b(0x21f)]['TransactionID']),console[_0x836b3b(0x22b)]('IBAN:',_0x263045||_0x836b3b(0x217)),console[_0x836b3b(0x22b)](_0x836b3b(0x1f1),_0x4f328d['data']['CreatedOn']),console['log'](_0x836b3b(0x257),_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x222)]||_0x836b3b(0x1fe));if(_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x20b)]?.[_0x836b3b(0x1fb)]()===_0x836b3b(0x262))console[_0x836b3b(0x22b)](_0x836b3b(0x1f2));else _0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x20b)]?.[_0x836b3b(0x1fb)]()===_0x836b3b(0x22e)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x29fa55,'amount':parseFloat(_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x270)])||undefined,'currency':_0x4f328d[_0x836b3b(0x21f)][_0x836b3b(0x25c)]||_0x836b3b(0x221),'paymentDetails':_0x4614ea};}catch(_0x1cb3e0){console[_0x836b3b(0x21c)](_0x836b3b(0x247),_0x1cb3e0),loggerService_1['loggerService'][_0x836b3b(0x26f)](_0x836b3b(0x25d),_0x836b3b(0x22c),_0x1cb3e0);throw new Error(_0x836b3b(0x1f3)+(_0x1cb3e0 instanceof Error?_0x1cb3e0[_0x836b3b(0x21a)]:_0x836b3b(0x267)));}}async['verifyPayment'](_0x23a285){const _0x1e3ec1=a43_0x48012a,_0xb04802=await this[_0x1e3ec1(0x209)](_0x23a285);return{'status':_0xb04802[_0x1e3ec1(0x24d)],'amount':_0xb04802[_0x1e3ec1(0x234)],'currency':_0xb04802[_0x1e3ec1(0x265)]};}async[a43_0x48012a(0x273)](_0x24287d){const _0x5ecfb4=a43_0x48012a;console[_0x5ecfb4(0x22b)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x24287d);let _0x3d4090=_0x5ecfb4(0x26a);switch(_0x24287d[_0x5ecfb4(0x24d)]?.[_0x5ecfb4(0x1fb)]()){case _0x5ecfb4(0x22e):_0x3d4090=_0x5ecfb4(0x1f5);break;case _0x5ecfb4(0x1fd):case _0x5ecfb4(0x21b):case'error':_0x3d4090=_0x5ecfb4(0x200);break;case _0x5ecfb4(0x1f0):case _0x5ecfb4(0x1ec):_0x3d4090=_0x5ecfb4(0x251);break;case _0x5ecfb4(0x213):case'waiting':case _0x5ecfb4(0x262):case _0x5ecfb4(0x1ff):default:_0x3d4090=_0x5ecfb4(0x26a);break;}return{'paymentId':_0x24287d[_0x5ecfb4(0x274)]||_0x24287d['merchant_reference_id']||'','status':_0x3d4090,'amount':_0x24287d[_0x5ecfb4(0x234)],'currency':_0x24287d[_0x5ecfb4(0x265)]||_0x5ecfb4(0x221)};}}exports[a43_0x48012a(0x216)]=CoinToPayService;