'use strict';function a38_0xdad6(){const _0x1ea31f=['amount','data','loggerService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','failed','QRCodeURL','PENDING','order_id',',\x20body:\x20','Error\x20stack:','TesSoft\x20Payment\x20System/1.0','application/json','Transaction\x20ID:','/create','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','CreatedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','entries','Status\x20Text:','PaymentDetail','expired','===\x20COINTOPAY\x20API\x20ERROR\x20===','JSON\x20Parse\x20Error:\x20','payment_url','message','statusUrl','Response\x20Body:','__esModule','4CUWzqK','/status','Raw\x20Response\x20Body:','HTTP\x20Status:','status','Status:','inputCurrency','Business\x20Error:\x20','\x20EUR','toLowerCase','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','60215oYVfSe','logWhiteDomainResponse','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','logWhiteDomainError','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Status','CoinToPay\x20status\x20API\x20error:\x20','stringify','error','9783eJFLsw','CoinToPay\x20API\x20error:\x20','match','42OFqvlz','now','not\x20confirmed','coinAddress','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','POST','logWhiteDomainRequest','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','üè¶\x20Extracted\x20IBAN:','EUR','processWebhook','IBAN:','stack','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','fromEntries','text','awaiting\x20fiat','Amount:','Error\x20details:','headers','Missing\x20data\x20in\x20response','statusText','parse','HTTP\x20error!\x20status:\x20','TransactionID','timeout','207918VeztZm','13498aazbqX','CoinToPayService','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','result','merchant_reference_id','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','checkPaymentStatus','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üè¶\x20Payment\x20Detail:','Currency:','PAID','üìä\x20Status\x20check\x20URL:','Created\x20On:','created','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Amount','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','154735cXDOCk','793573xaqGuf','currency','Unknown\x20error','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','cancelled','EXPIRED','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','40mkbhxq','Status\x20API\x20Error:\x20','apiUrl','Error\x20message:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','status_code','TransactionConfirmedOn','FAILED','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Response\x20Time:','defineProperty','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','paid','530gckBfK','verifyPayment','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','../loggerService','1130190UBUcZZ'];a38_0xdad6=function(){return _0x1ea31f;};return a38_0xdad6();}const a38_0x373ca6=a38_0x2c19;(function(_0x4f93be,_0x50e96f){const _0x32722b=a38_0x2c19,_0x3efa7b=_0x4f93be();while(!![]){try{const _0x46b681=parseInt(_0x32722b(0x198))/0x1+-parseInt(_0x32722b(0x199))/0x2*(parseInt(_0x32722b(0x1fd))/0x3)+parseInt(_0x32722b(0x1e4))/0x4*(-parseInt(_0x32722b(0x1ef))/0x5)+-parseInt(_0x32722b(0x1c6))/0x6+-parseInt(_0x32722b(0x1ac))/0x7*(-parseInt(_0x32722b(0x1b4))/0x8)+parseInt(_0x32722b(0x1fa))/0x9*(parseInt(_0x32722b(0x1c2))/0xa)+parseInt(_0x32722b(0x1ad))/0xb;if(_0x46b681===_0x50e96f)break;else _0x3efa7b['push'](_0x3efa7b['shift']());}catch(_0x3175fe){_0x3efa7b['push'](_0x3efa7b['shift']());}}}(a38_0xdad6,0x256d7));Object[a38_0x373ca6(0x1bf)](exports,a38_0x373ca6(0x1e3),{'value':!![]}),exports[a38_0x373ca6(0x19a)]=void 0x0;const loggerService_1=require(a38_0x373ca6(0x1c5));class CoinToPayService{constructor(){const _0x3603b9=a38_0x373ca6;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3603b9(0x1d6)](_0x3603b9(0x18b)),console[_0x3603b9(0x1d6)](_0x3603b9(0x1a6),this[_0x3603b9(0x1e1)]);}async['createPaymentLink'](_0xca8a5b){const _0x3712f6=a38_0x373ca6,{orderId:_0x160129,amount:_0x4722c3}=_0xca8a5b;console['log'](_0x3712f6(0x1b8)+_0x4722c3+_0x3712f6(0x1ec));const _0x192eba={'amount':_0x4722c3},_0x4ca084=Date[_0x3712f6(0x1fe)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log']('URL:',this[_0x3712f6(0x1b6)]),console[_0x3712f6(0x1d6)]('Request\x20Body:',JSON[_0x3712f6(0x1f8)](_0x192eba,null,0x2)),console[_0x3712f6(0x1d6)](_0x3712f6(0x18f),_0x4722c3,_0x3712f6(0x185)),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x184)](_0x3712f6(0x19f),'/create',_0x3712f6(0x183),_0x192eba);const _0x366132=await fetch(this[_0x3712f6(0x1b6)],{'method':_0x3712f6(0x183),'headers':{'Content-Type':_0x3712f6(0x1d2),'Accept':_0x3712f6(0x1d2),'User-Agent':_0x3712f6(0x1d1)},'body':JSON['stringify'](_0x192eba)}),_0x433c1a=Date[_0x3712f6(0x1fe)]()-_0x4ca084;console[_0x3712f6(0x1d6)](_0x3712f6(0x1b0)),console[_0x3712f6(0x1d6)](_0x3712f6(0x1e9),_0x366132[_0x3712f6(0x1e8)]),console[_0x3712f6(0x1d6)](_0x3712f6(0x1da),_0x366132[_0x3712f6(0x193)]),console[_0x3712f6(0x1d6)]('Headers:',Object[_0x3712f6(0x18c)](_0x366132[_0x3712f6(0x191)][_0x3712f6(0x1d9)]())),console['log']('Response\x20Time:',_0x433c1a+'ms');const _0x4f6e41=await _0x366132[_0x3712f6(0x18d)]();console[_0x3712f6(0x1d6)](_0x3712f6(0x1e6),_0x4f6e41);if(!_0x366132['ok']){console[_0x3712f6(0x1f9)](_0x3712f6(0x1dd)),console[_0x3712f6(0x1f9)](_0x3712f6(0x1e7),_0x366132['status']),console[_0x3712f6(0x1f9)](_0x3712f6(0x1e2),_0x4f6e41),loggerService_1['loggerService'][_0x3712f6(0x1f0)]('cointopay',_0x3712f6(0x1d4),_0x366132[_0x3712f6(0x1e8)],_0x4f6e41,_0x433c1a),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x1f4)](_0x3712f6(0x19f),_0x3712f6(0x1d4),'HTTP\x20'+_0x366132[_0x3712f6(0x1e8)]+':\x20'+_0x4f6e41);throw new Error(_0x3712f6(0x195)+_0x366132['status']+_0x3712f6(0x1cf)+_0x4f6e41);}let _0x52ef06;try{_0x52ef06=JSON[_0x3712f6(0x194)](_0x4f6e41);}catch(_0x1d0e0f){console[_0x3712f6(0x1f9)](_0x3712f6(0x19e),_0x1d0e0f),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x1f4)]('cointopay','/create',_0x3712f6(0x1de)+_0x1d0e0f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x4f6e41);}console[_0x3712f6(0x1d6)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x3712f6(0x1d6)]('Parsed\x20Result:',JSON[_0x3712f6(0x1f8)](_0x52ef06,null,0x2)),loggerService_1[_0x3712f6(0x1c9)]['logWhiteDomainResponse'](_0x3712f6(0x19f),_0x3712f6(0x1d4),_0x366132[_0x3712f6(0x1e8)],_0x52ef06,_0x433c1a);if(_0x52ef06[_0x3712f6(0x1f9)]){const _0x24be22=_0x52ef06[_0x3712f6(0x1e0)]||_0x52ef06['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x3712f6(0x1f9)](_0x3712f6(0x1ca)),console[_0x3712f6(0x1f9)]('Error\x20Message:',_0x24be22),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x1f4)]('cointopay',_0x3712f6(0x1d4),_0x3712f6(0x1eb)+_0x24be22);throw new Error(_0x3712f6(0x1fb)+_0x24be22);}if(!_0x52ef06[_0x3712f6(0x1df)]||!_0x52ef06[_0x3712f6(0x1f2)]){console[_0x3712f6(0x1f9)](_0x3712f6(0x1d5)),console[_0x3712f6(0x1f9)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x3712f6(0x1f9)]('Response\x20data:',_0x52ef06),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x1f4)](_0x3712f6(0x19f),_0x3712f6(0x1d4),_0x3712f6(0x1ee));throw new Error(_0x3712f6(0x1a0));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log']('Gateway\x20Payment\x20ID:',_0x52ef06['gateway_payment_id']),console[_0x3712f6(0x1d6)]('Payment\x20URL:',_0x52ef06[_0x3712f6(0x1df)]),console['log'](_0x3712f6(0x18f),_0x4722c3,'EUR'),{'gateway_payment_id':_0x52ef06[_0x3712f6(0x1f2)],'payment_url':_0x52ef06[_0x3712f6(0x1df)]};}catch(_0x5d4b1d){console[_0x3712f6(0x1f9)](_0x3712f6(0x1bd)),console[_0x3712f6(0x1f9)](_0x3712f6(0x190),_0x5d4b1d),loggerService_1[_0x3712f6(0x1c9)][_0x3712f6(0x1f4)](_0x3712f6(0x19f),_0x3712f6(0x1d4),_0x5d4b1d);if(_0x5d4b1d instanceof Error){console[_0x3712f6(0x1f9)](_0x3712f6(0x1b7),_0x5d4b1d[_0x3712f6(0x1e0)]),console[_0x3712f6(0x1f9)](_0x3712f6(0x1d0),_0x5d4b1d[_0x3712f6(0x18a)]);throw new Error(_0x3712f6(0x1b3)+_0x5d4b1d['message']);}throw new Error(_0x3712f6(0x1d8));}}async[a38_0x373ca6(0x1a1)](_0x15989b){const _0x55791c=a38_0x373ca6,_0x3ccbae=Date['now']();try{console[_0x55791c(0x1d6)](_0x55791c(0x1ab)+_0x15989b);const _0x9adc04={'gatewayPaymentId':_0x15989b};loggerService_1[_0x55791c(0x1c9)][_0x55791c(0x184)](_0x55791c(0x19f),'/status',_0x55791c(0x183),_0x9adc04);const _0x5e374a=await fetch(this[_0x55791c(0x1e1)],{'method':_0x55791c(0x183),'headers':{'Content-Type':_0x55791c(0x1d2),'Accept':_0x55791c(0x1d2),'User-Agent':_0x55791c(0x1d1)},'body':JSON[_0x55791c(0x1f8)](_0x9adc04)}),_0x5804db=Date[_0x55791c(0x1fe)]()-_0x3ccbae;console[_0x55791c(0x1d6)](_0x55791c(0x1f3)),console[_0x55791c(0x1d6)](_0x55791c(0x1e9),_0x5e374a[_0x55791c(0x1e8)]),console['log'](_0x55791c(0x1be),_0x5804db+'ms');if(!_0x5e374a['ok']){const _0x1454b6=await _0x5e374a[_0x55791c(0x18d)]();console['error'](_0x55791c(0x1e7),_0x5e374a['status']),console[_0x55791c(0x1f9)](_0x55791c(0x1e2),_0x1454b6),loggerService_1[_0x55791c(0x1c9)][_0x55791c(0x1f0)]('cointopay',_0x55791c(0x1e5),_0x5e374a[_0x55791c(0x1e8)],_0x1454b6,_0x5804db),loggerService_1['loggerService'][_0x55791c(0x1f4)]('cointopay',_0x55791c(0x1e5),'HTTP\x20'+_0x5e374a['status']+':\x20'+_0x1454b6);throw new Error(_0x55791c(0x195)+_0x5e374a[_0x55791c(0x1e8)]);}const _0x3a4109=await _0x5e374a[_0x55791c(0x18d)]();console[_0x55791c(0x1d6)]('Raw\x20Response\x20Body:',_0x3a4109);let _0xfe1f31;try{_0xfe1f31=JSON['parse'](_0x3a4109);}catch(_0x209858){console[_0x55791c(0x1f9)](_0x55791c(0x19e),_0x209858),loggerService_1[_0x55791c(0x1c9)]['logWhiteDomainError'](_0x55791c(0x19f),_0x55791c(0x1e5),_0x55791c(0x1de)+_0x209858);throw new Error(_0x55791c(0x1f1)+_0x3a4109);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x55791c(0x19f),'/status',_0x5e374a[_0x55791c(0x1e8)],_0xfe1f31,_0x5804db),console[_0x55791c(0x1d6)](_0x55791c(0x1bc)),console[_0x55791c(0x1d6)]('Result:',_0xfe1f31['result']),console[_0x55791c(0x1d6)]('Status\x20Code:',_0xfe1f31[_0x55791c(0x1b9)]),console[_0x55791c(0x1d6)]('Payment\x20Status:',_0xfe1f31[_0x55791c(0x1c8)]?.[_0x55791c(0x1f6)]),console[_0x55791c(0x1d6)](_0x55791c(0x18f),_0xfe1f31[_0x55791c(0x1c8)]?.[_0x55791c(0x1aa)]),console[_0x55791c(0x1d6)](_0x55791c(0x1a4),_0xfe1f31[_0x55791c(0x1c8)]?.[_0x55791c(0x1ea)]);if(_0xfe1f31[_0x55791c(0x19c)]!=='success'||_0xfe1f31[_0x55791c(0x1b9)]!==0xc8){const _0xc7d217=_0xfe1f31[_0x55791c(0x1e0)]||_0x55791c(0x1c4);console['error'](_0x55791c(0x19b)),console[_0x55791c(0x1f9)]('Error\x20Message:',_0xc7d217),loggerService_1[_0x55791c(0x1c9)][_0x55791c(0x1f4)](_0x55791c(0x19f),_0x55791c(0x1e5),_0x55791c(0x1b5)+_0xc7d217);throw new Error(_0x55791c(0x1f7)+_0xc7d217);}if(!_0xfe1f31[_0x55791c(0x1c8)]){console[_0x55791c(0x1f9)](_0x55791c(0x1a2)),console['error'](_0x55791c(0x192)),loggerService_1[_0x55791c(0x1c9)][_0x55791c(0x1f4)](_0x55791c(0x19f),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x55791c(0x1f5));}let _0x55e093='PENDING';switch(_0xfe1f31['data'][_0x55791c(0x1f6)]?.[_0x55791c(0x1ed)]()){case'paid':_0x55e093=_0x55791c(0x1a5);break;case _0x55791c(0x1b1):case _0x55791c(0x1cb):case _0x55791c(0x1f9):_0x55e093=_0x55791c(0x1bb);break;case'expired':case _0x55791c(0x197):_0x55e093=_0x55791c(0x1b2);break;case'waiting':case _0x55791c(0x18e):case'pending':case _0x55791c(0x1a8):default:_0x55e093=_0x55791c(0x1cd);break;}let _0x73575d,_0x31ae76;if(_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1db)]){const _0x492918=_0xfe1f31['data'][_0x55791c(0x1db)];console['log'](_0x55791c(0x1a3),_0x492918);const _0x2aab4b=_0x492918[_0x55791c(0x1fc)](/IBAN\s+([A-Z0-9]+)/i);_0x2aab4b&&(_0x73575d=_0x2aab4b[0x1],console[_0x55791c(0x1d6)](_0x55791c(0x186),_0x73575d)),_0x31ae76=_0x492918;}const _0x16fd02={'iban':_0x73575d,'bankDetails':_0x31ae76,'transactionId':_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x196)],'coinAddress':_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x200)],'qrCodeUrl':_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1cc)],'expiryTime':_0xfe1f31[_0x55791c(0x1c8)]['ExpiryTime'],'createdOn':_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1d7)],'confirmedOn':_0xfe1f31[_0x55791c(0x1c8)]['TransactionConfirmedOn']};console[_0x55791c(0x1d6)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x55791c(0x1d6)](_0x55791c(0x1e9),_0xfe1f31['data'][_0x55791c(0x1f6)],'->',_0x55e093),console['log']('Amount:',_0xfe1f31['data'][_0x55791c(0x1aa)],_0xfe1f31['data']['inputCurrency']),console['log'](_0x55791c(0x1d3),_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x196)]),console[_0x55791c(0x1d6)](_0x55791c(0x189),_0x73575d||'not\x20found'),console[_0x55791c(0x1d6)](_0x55791c(0x1a7),_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1d7)]),console[_0x55791c(0x1d6)]('Confirmed\x20On:',_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1ba)]||_0x55791c(0x1ff));if(_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1f6)]?.['toLowerCase']()===_0x55791c(0x18e))console['log'](_0x55791c(0x201));else _0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1f6)]?.[_0x55791c(0x1ed)]()===_0x55791c(0x1c1)&&console[_0x55791c(0x1d6)](_0x55791c(0x1c0));return{'status':_0x55e093,'amount':parseFloat(_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1aa)])||undefined,'currency':_0xfe1f31[_0x55791c(0x1c8)][_0x55791c(0x1ea)]||_0x55791c(0x187),'paymentDetails':_0x16fd02};}catch(_0x3872aa){console[_0x55791c(0x1f9)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x3872aa),loggerService_1['loggerService'][_0x55791c(0x1f4)]('cointopay','/status',_0x3872aa);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3872aa instanceof Error?_0x3872aa[_0x55791c(0x1e0)]:_0x55791c(0x1af)));}}async[a38_0x373ca6(0x1c3)](_0xa608cb){const _0x23b205=a38_0x373ca6,_0x29b67c=await this[_0x23b205(0x1a1)](_0xa608cb);return{'status':_0x29b67c[_0x23b205(0x1e8)],'amount':_0x29b67c[_0x23b205(0x1c7)],'currency':_0x29b67c[_0x23b205(0x1ae)]};}async[a38_0x373ca6(0x188)](_0x6682fd){const _0x26ed1a=a38_0x373ca6;console[_0x26ed1a(0x1d6)](_0x26ed1a(0x1a9),_0x6682fd);let _0x5efe48=_0x26ed1a(0x1cd);switch(_0x6682fd[_0x26ed1a(0x1e8)]?.['toLowerCase']()){case _0x26ed1a(0x1c1):_0x5efe48='PAID';break;case _0x26ed1a(0x1b1):case _0x26ed1a(0x1cb):case'error':_0x5efe48=_0x26ed1a(0x1bb);break;case _0x26ed1a(0x1dc):case _0x26ed1a(0x197):_0x5efe48=_0x26ed1a(0x1b2);break;case'pending':case'waiting':case _0x26ed1a(0x18e):case _0x26ed1a(0x1a8):default:_0x5efe48=_0x26ed1a(0x1cd);break;}return{'paymentId':_0x6682fd[_0x26ed1a(0x1ce)]||_0x6682fd[_0x26ed1a(0x19d)]||'','status':_0x5efe48,'amount':_0x6682fd['amount'],'currency':_0x6682fd[_0x26ed1a(0x1ae)]||_0x26ed1a(0x187)};}}function a38_0x2c19(_0x28bff5,_0x51c607){const _0xdad674=a38_0xdad6();return a38_0x2c19=function(_0x2c19dc,_0x243f9b){_0x2c19dc=_0x2c19dc-0x183;let _0xb43878=_0xdad674[_0x2c19dc];return _0xb43878;},a38_0x2c19(_0x28bff5,_0x51c607);}exports[a38_0x373ca6(0x19a)]=CoinToPayService;