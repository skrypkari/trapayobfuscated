'use strict';const a46_0x2dd086=a46_0x354b;function a46_0x354b(_0xa2f543,_0x36981a){const _0x33e373=a46_0x33e3();return a46_0x354b=function(_0x354b8e,_0x303da5){_0x354b8e=_0x354b8e-0xa7;let _0x2118fa=_0x33e373[_0x354b8e];return _0x2118fa;},a46_0x354b(_0xa2f543,_0x36981a);}function a46_0x33e3(){const _0x1b4865=['EXPIRED','application/json','IBAN:','paid','../loggerService','POST','Created\x20On:','PaymentDetail','FAILED','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CreatedOn','coinAddress','/create','logWhiteDomainResponse','Status:','payment_url','Request\x20Body:','üè¶\x20Extracted\x20IBAN:','8182614YyxRxx','Payment\x20Status:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20Status:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','statusUrl','inputCurrency','TransactionID','order_id','183545PcOmia','Payment\x20URL:','message','Currency:','Amount','cancelled','checkPaymentStatus','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20ERROR\x20===','result','Response\x20Body:','cointopay','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','defineProperty','pending','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Status\x20API\x20Error:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','HTTP\x20','PENDING','fromEntries','created','6tusuWu','now','toLowerCase','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','1084568WZeKKc','Status\x20Code:','https://tesoft.uk/gateway/cointopay/','currency','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','EUR','Status\x20Text:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CoinToPay\x20status\x20API\x20error:\x20','PAID','Result:','URL:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','amount','36UcNTAH','stringify','data','processWebhook','2083278fmeVvj','error','parse','7354613JmrWaH','Business\x20Error:\x20','failed','status','https://tesoft.uk/gateway/cointopay/status.php','Headers:','Incomplete\x20response:\x20missing\x20data','HTTP\x20error!\x20status:\x20','apiUrl','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','JSON\x20Parse\x20Error:\x20','üè¶\x20Payment\x20Detail:','1459965arykAm','awaiting\x20fiat','Response\x20data:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','success','2497900ISWEyN','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','52wPOnzn','gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount:','Unknown\x20error','Confirmed\x20On:','CoinToPayService','waiting','__esModule','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','TransactionConfirmedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','not\x20found','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','logWhiteDomainError','status_code','log','/status','entries','timeout','Error\x20details:','verifyPayment','logWhiteDomainRequest','expired','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','text','1FQvSlf','Response\x20Time:','Error\x20Message:','not\x20confirmed','merchant_reference_id',',\x20body:\x20','Failed\x20to\x20parse\x20JSON\x20response:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','createPaymentLink','loggerService'];a46_0x33e3=function(){return _0x1b4865;};return a46_0x33e3();}(function(_0x59df66,_0x4cf9f6){const _0x5c533f=a46_0x354b,_0x51a91d=_0x59df66();while(!![]){try{const _0x36229c=-parseInt(_0x5c533f(0xba))/0x1*(-parseInt(_0x5c533f(0x110))/0x2)+-parseInt(_0x5c533f(0x11f))/0x3+parseInt(_0x5c533f(0x128))/0x4*(-parseInt(_0x5c533f(0xe1))/0x5)+parseInt(_0x5c533f(0xf9))/0x6*(-parseInt(_0x5c533f(0x113))/0x7)+-parseInt(_0x5c533f(0xfd))/0x8*(-parseInt(_0x5c533f(0x10c))/0x9)+parseInt(_0x5c533f(0x124))/0xa+parseInt(_0x5c533f(0xd8))/0xb;if(_0x36229c===_0x4cf9f6)break;else _0x51a91d['push'](_0x51a91d['shift']());}catch(_0x76d5d3){_0x51a91d['push'](_0x51a91d['shift']());}}}(a46_0x33e3,0x89770));Object[a46_0x2dd086(0xee)](exports,a46_0x2dd086(0x130),{'value':!![]}),exports[a46_0x2dd086(0x12e)]=void 0x0;const loggerService_1=require(a46_0x2dd086(0xc9));class CoinToPayService{constructor(){const _0xc01fd5=a46_0x2dd086;this['apiUrl']=_0xc01fd5(0xff),this['statusUrl']=_0xc01fd5(0x117),console[_0xc01fd5(0xaf)](_0xc01fd5(0xf4)),console['log']('üìä\x20Status\x20check\x20URL:',this[_0xc01fd5(0xdd)]);}async[a46_0x2dd086(0xc3)](_0x417c93){const _0x55fa2d=a46_0x2dd086,{orderId:_0x568dea,amount:_0xa2f7}=_0x417c93;console['log'](_0x55fa2d(0xce)+_0xa2f7+'\x20EUR');const _0x111ae6={'amount':_0xa2f7},_0x4354b1=Date[_0x55fa2d(0xfa)]();try{console[_0x55fa2d(0xaf)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x55fa2d(0xaf)](_0x55fa2d(0x109),this[_0x55fa2d(0x11b)]),console['log'](_0x55fa2d(0xd6),JSON[_0x55fa2d(0x10d)](_0x111ae6,null,0x2)),console[_0x55fa2d(0xaf)](_0x55fa2d(0x12b),_0xa2f7,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x55fa2d(0xb5)](_0x55fa2d(0xec),_0x55fa2d(0xd2),_0x55fa2d(0xca),_0x111ae6);const _0x2ea90c=await fetch(this[_0x55fa2d(0x11b)],{'method':_0x55fa2d(0xca),'headers':{'Content-Type':_0x55fa2d(0xc6),'Accept':_0x55fa2d(0xc6),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x55fa2d(0x10d)](_0x111ae6)}),_0x1e0699=Date[_0x55fa2d(0xfa)]()-_0x4354b1;console[_0x55fa2d(0xaf)](_0x55fa2d(0x102)),console[_0x55fa2d(0xaf)]('Status:',_0x2ea90c[_0x55fa2d(0x116)]),console['log'](_0x55fa2d(0x104),_0x2ea90c['statusText']),console[_0x55fa2d(0xaf)](_0x55fa2d(0x118),Object[_0x55fa2d(0xf7)](_0x2ea90c['headers'][_0x55fa2d(0xb1)]())),console['log'](_0x55fa2d(0xbb),_0x1e0699+'ms');const _0x266922=await _0x2ea90c['text']();console['log'](_0x55fa2d(0xa7),_0x266922);if(!_0x2ea90c['ok']){console[_0x55fa2d(0x111)](_0x55fa2d(0xe9)),console[_0x55fa2d(0x111)](_0x55fa2d(0xdb),_0x2ea90c[_0x55fa2d(0x116)]),console[_0x55fa2d(0x111)](_0x55fa2d(0xeb),_0x266922),loggerService_1[_0x55fa2d(0xc4)][_0x55fa2d(0xd3)](_0x55fa2d(0xec),'/create',_0x2ea90c[_0x55fa2d(0x116)],_0x266922,_0x1e0699),loggerService_1[_0x55fa2d(0xc4)]['logWhiteDomainError'](_0x55fa2d(0xec),'/create',_0x55fa2d(0xf5)+_0x2ea90c['status']+':\x20'+_0x266922);throw new Error(_0x55fa2d(0x11a)+_0x2ea90c[_0x55fa2d(0x116)]+_0x55fa2d(0xbf)+_0x266922);}let _0x34fbf8;try{_0x34fbf8=JSON[_0x55fa2d(0x112)](_0x266922);}catch(_0x1c985d){console[_0x55fa2d(0x111)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x1c985d),loggerService_1[_0x55fa2d(0xc4)]['logWhiteDomainError'](_0x55fa2d(0xec),_0x55fa2d(0xd2),_0x55fa2d(0x11d)+_0x1c985d);throw new Error(_0x55fa2d(0xf2)+_0x266922);}console['log'](_0x55fa2d(0x12a)),console[_0x55fa2d(0xaf)]('Parsed\x20Result:',JSON[_0x55fa2d(0x10d)](_0x34fbf8,null,0x2)),loggerService_1[_0x55fa2d(0xc4)][_0x55fa2d(0xd3)]('cointopay',_0x55fa2d(0xd2),_0x2ea90c[_0x55fa2d(0x116)],_0x34fbf8,_0x1e0699);if(_0x34fbf8[_0x55fa2d(0x111)]){const _0x43c1e7=_0x34fbf8[_0x55fa2d(0xe3)]||_0x34fbf8[_0x55fa2d(0x111)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x55fa2d(0x111)](_0x55fa2d(0x127)),console[_0x55fa2d(0x111)](_0x55fa2d(0xbc),_0x43c1e7),loggerService_1[_0x55fa2d(0xc4)][_0x55fa2d(0xad)](_0x55fa2d(0xec),'/create',_0x55fa2d(0x114)+_0x43c1e7);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x43c1e7);}if(!_0x34fbf8['payment_url']||!_0x34fbf8[_0x55fa2d(0x129)]){console[_0x55fa2d(0x111)](_0x55fa2d(0xfc)),console['error'](_0x55fa2d(0x101)),console[_0x55fa2d(0x111)](_0x55fa2d(0x121),_0x34fbf8),loggerService_1[_0x55fa2d(0xc4)][_0x55fa2d(0xad)](_0x55fa2d(0xec),'/create',_0x55fa2d(0xcf));throw new Error(_0x55fa2d(0xda));}return console[_0x55fa2d(0xaf)](_0x55fa2d(0xf1)),console[_0x55fa2d(0xaf)]('Gateway\x20Payment\x20ID:',_0x34fbf8['gateway_payment_id']),console[_0x55fa2d(0xaf)](_0x55fa2d(0xe2),_0x34fbf8[_0x55fa2d(0xd5)]),console['log'](_0x55fa2d(0x12b),_0xa2f7,_0x55fa2d(0x103)),{'gateway_payment_id':_0x34fbf8['gateway_payment_id'],'payment_url':_0x34fbf8[_0x55fa2d(0xd5)]};}catch(_0x54445c){console[_0x55fa2d(0x111)](_0x55fa2d(0xaa)),console['error'](_0x55fa2d(0xb3),_0x54445c),loggerService_1[_0x55fa2d(0xc4)]['logWhiteDomainError'](_0x55fa2d(0xec),'/create',_0x54445c);if(_0x54445c instanceof Error){console[_0x55fa2d(0x111)]('Error\x20message:',_0x54445c['message']),console[_0x55fa2d(0x111)]('Error\x20stack:',_0x54445c['stack']);throw new Error(_0x55fa2d(0xc1)+_0x54445c[_0x55fa2d(0xe3)]);}throw new Error(_0x55fa2d(0x10a));}}async[a46_0x2dd086(0xe7)](_0x49252a){const _0x982b3c=a46_0x2dd086,_0x5d1324=Date['now']();try{console[_0x982b3c(0xaf)](_0x982b3c(0x11c)+_0x49252a);const _0x362dd2={'gatewayPaymentId':_0x49252a};loggerService_1[_0x982b3c(0xc4)]['logWhiteDomainRequest'](_0x982b3c(0xec),_0x982b3c(0xb0),_0x982b3c(0xca),_0x362dd2);const _0x5baa4e=await fetch(this[_0x982b3c(0xdd)],{'method':'POST','headers':{'Content-Type':_0x982b3c(0xc6),'Accept':_0x982b3c(0xc6),'User-Agent':_0x982b3c(0xb7)},'body':JSON[_0x982b3c(0x10d)](_0x362dd2)}),_0x278134=Date[_0x982b3c(0xfa)]()-_0x5d1324;console['log'](_0x982b3c(0xdc)),console['log'](_0x982b3c(0xd4),_0x5baa4e[_0x982b3c(0x116)]),console[_0x982b3c(0xaf)](_0x982b3c(0xbb),_0x278134+'ms');if(!_0x5baa4e['ok']){const _0x6783e0=await _0x5baa4e[_0x982b3c(0xb9)]();console[_0x982b3c(0x111)](_0x982b3c(0xdb),_0x5baa4e[_0x982b3c(0x116)]),console['error'](_0x982b3c(0xeb),_0x6783e0),loggerService_1['loggerService'][_0x982b3c(0xd3)](_0x982b3c(0xec),_0x982b3c(0xb0),_0x5baa4e[_0x982b3c(0x116)],_0x6783e0,_0x278134),loggerService_1['loggerService']['logWhiteDomainError'](_0x982b3c(0xec),_0x982b3c(0xb0),_0x982b3c(0xf5)+_0x5baa4e[_0x982b3c(0x116)]+':\x20'+_0x6783e0);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5baa4e[_0x982b3c(0x116)]);}const _0x3d0c40=await _0x5baa4e[_0x982b3c(0xb9)]();console['log'](_0x982b3c(0xa7),_0x3d0c40);let _0xbe3856;try{_0xbe3856=JSON['parse'](_0x3d0c40);}catch(_0x35f686){console[_0x982b3c(0x111)](_0x982b3c(0xc0),_0x35f686),loggerService_1[_0x982b3c(0xc4)][_0x982b3c(0xad)](_0x982b3c(0xec),'/status',_0x982b3c(0x11d)+_0x35f686);throw new Error(_0x982b3c(0xed)+_0x3d0c40);}loggerService_1[_0x982b3c(0xc4)][_0x982b3c(0xd3)]('cointopay','/status',_0x5baa4e['status'],_0xbe3856,_0x278134),console[_0x982b3c(0xaf)](_0x982b3c(0x122)),console[_0x982b3c(0xaf)](_0x982b3c(0x108),_0xbe3856[_0x982b3c(0xea)]),console[_0x982b3c(0xaf)](_0x982b3c(0xfe),_0xbe3856[_0x982b3c(0xae)]),console[_0x982b3c(0xaf)](_0x982b3c(0xd9),_0xbe3856['data']?.[_0x982b3c(0x126)]),console[_0x982b3c(0xaf)](_0x982b3c(0x12b),_0xbe3856[_0x982b3c(0x10e)]?.[_0x982b3c(0xe5)]),console[_0x982b3c(0xaf)](_0x982b3c(0xe4),_0xbe3856[_0x982b3c(0x10e)]?.[_0x982b3c(0xde)]);if(_0xbe3856[_0x982b3c(0xea)]!==_0x982b3c(0x123)||_0xbe3856[_0x982b3c(0xae)]!==0xc8){const _0x49d813=_0xbe3856[_0x982b3c(0xe3)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x982b3c(0x111)](_0x982b3c(0xb8)),console['error'](_0x982b3c(0xbc),_0x49d813),loggerService_1[_0x982b3c(0xc4)]['logWhiteDomainError']('cointopay','/status',_0x982b3c(0xf3)+_0x49d813);throw new Error(_0x982b3c(0x106)+_0x49d813);}if(!_0xbe3856[_0x982b3c(0x10e)]){console[_0x982b3c(0x111)](_0x982b3c(0x125)),console[_0x982b3c(0x111)](_0x982b3c(0xf0)),loggerService_1['loggerService'][_0x982b3c(0xad)](_0x982b3c(0xec),_0x982b3c(0xb0),_0x982b3c(0x119));throw new Error(_0x982b3c(0xa8));}let _0x4aad17=_0x982b3c(0xf6);switch(_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0x126)]?.[_0x982b3c(0xfb)]()){case _0x982b3c(0xc8):_0x4aad17=_0x982b3c(0x107);break;case _0x982b3c(0xe6):case _0x982b3c(0x115):case _0x982b3c(0x111):_0x4aad17='FAILED';break;case _0x982b3c(0xb6):case _0x982b3c(0xb2):_0x4aad17='EXPIRED';break;case _0x982b3c(0x12f):case _0x982b3c(0x120):case'pending':case _0x982b3c(0xf8):default:_0x4aad17=_0x982b3c(0xf6);break;}let _0x2fe8c4,_0x573f9b;if(_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xcc)]){const _0x13f63c=_0xbe3856['data'][_0x982b3c(0xcc)];console[_0x982b3c(0xaf)](_0x982b3c(0x11e),_0x13f63c);const _0x41996e=_0x13f63c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x41996e&&(_0x2fe8c4=_0x41996e[0x1],console[_0x982b3c(0xaf)](_0x982b3c(0xd7),_0x2fe8c4)),_0x573f9b=_0x13f63c;}const _0x4ddcc0={'iban':_0x2fe8c4,'bankDetails':_0x573f9b,'transactionId':_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xdf)],'coinAddress':_0xbe3856['data'][_0x982b3c(0xd1)],'qrCodeUrl':_0xbe3856[_0x982b3c(0x10e)]['QRCodeURL'],'expiryTime':_0xbe3856[_0x982b3c(0x10e)]['ExpiryTime'],'createdOn':_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xd0)],'confirmedOn':_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xa9)]};console[_0x982b3c(0xaf)](_0x982b3c(0xc2)),console[_0x982b3c(0xaf)](_0x982b3c(0xd4),_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0x126)],'->',_0x4aad17),console[_0x982b3c(0xaf)](_0x982b3c(0x12b),_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xe5)],_0xbe3856['data'][_0x982b3c(0xde)]),console[_0x982b3c(0xaf)]('Transaction\x20ID:',_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xdf)]),console[_0x982b3c(0xaf)](_0x982b3c(0xc7),_0x2fe8c4||_0x982b3c(0xab)),console[_0x982b3c(0xaf)](_0x982b3c(0xcb),_0xbe3856[_0x982b3c(0x10e)]['CreatedOn']),console[_0x982b3c(0xaf)](_0x982b3c(0x12d),_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0xa9)]||_0x982b3c(0xbd));if(_0xbe3856[_0x982b3c(0x10e)][_0x982b3c(0x126)]?.[_0x982b3c(0xfb)]()===_0x982b3c(0x120))console[_0x982b3c(0xaf)](_0x982b3c(0xac));else _0xbe3856[_0x982b3c(0x10e)]['Status']?.[_0x982b3c(0xfb)]()===_0x982b3c(0xc8)&&console[_0x982b3c(0xaf)](_0x982b3c(0x105));return{'status':_0x4aad17,'amount':parseFloat(_0xbe3856[_0x982b3c(0x10e)]['Amount'])||undefined,'currency':_0xbe3856['data'][_0x982b3c(0xde)]||'EUR','paymentDetails':_0x4ddcc0};}catch(_0x2419dd){console['error'](_0x982b3c(0xe8),_0x2419dd),loggerService_1[_0x982b3c(0xc4)][_0x982b3c(0xad)](_0x982b3c(0xec),_0x982b3c(0xb0),_0x2419dd);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2419dd instanceof Error?_0x2419dd[_0x982b3c(0xe3)]:_0x982b3c(0x12c)));}}async[a46_0x2dd086(0xb4)](_0x151e4a){const _0x8a51ff=a46_0x2dd086,_0x26a123=await this[_0x8a51ff(0xe7)](_0x151e4a);return{'status':_0x26a123[_0x8a51ff(0x116)],'amount':_0x26a123[_0x8a51ff(0x10b)],'currency':_0x26a123[_0x8a51ff(0x100)]};}async[a46_0x2dd086(0x10f)](_0x3d8e27){const _0x2b9173=a46_0x2dd086;console[_0x2b9173(0xaf)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3d8e27);let _0x48130d='PENDING';switch(_0x3d8e27[_0x2b9173(0x116)]?.['toLowerCase']()){case'paid':_0x48130d=_0x2b9173(0x107);break;case _0x2b9173(0xe6):case _0x2b9173(0x115):case _0x2b9173(0x111):_0x48130d=_0x2b9173(0xcd);break;case _0x2b9173(0xb6):case'timeout':_0x48130d=_0x2b9173(0xc5);break;case _0x2b9173(0xef):case _0x2b9173(0x12f):case _0x2b9173(0x120):case _0x2b9173(0xf8):default:_0x48130d=_0x2b9173(0xf6);break;}return{'paymentId':_0x3d8e27[_0x2b9173(0xe0)]||_0x3d8e27[_0x2b9173(0xbe)]||'','status':_0x48130d,'amount':_0x3d8e27[_0x2b9173(0x10b)],'currency':_0x3d8e27[_0x2b9173(0x100)]||_0x2b9173(0x103)};}}exports['CoinToPayService']=CoinToPayService;