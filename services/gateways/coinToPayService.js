'use strict';const a40_0xabcfaf=a40_0xbe93;(function(_0x117b39,_0x5c59af){const _0x102e8b=a40_0xbe93,_0x58b328=_0x117b39();while(!![]){try{const _0x1706be=-parseInt(_0x102e8b(0x23a))/0x1+-parseInt(_0x102e8b(0x256))/0x2+-parseInt(_0x102e8b(0x1f2))/0x3*(parseInt(_0x102e8b(0x266))/0x4)+parseInt(_0x102e8b(0x21a))/0x5*(parseInt(_0x102e8b(0x237))/0x6)+parseInt(_0x102e8b(0x262))/0x7*(parseInt(_0x102e8b(0x24e))/0x8)+-parseInt(_0x102e8b(0x245))/0x9+-parseInt(_0x102e8b(0x26c))/0xa*(-parseInt(_0x102e8b(0x228))/0xb);if(_0x1706be===_0x5c59af)break;else _0x58b328['push'](_0x58b328['shift']());}catch(_0x35c64b){_0x58b328['push'](_0x58b328['shift']());}}}(a40_0x3b22,0xc9ee1));Object[a40_0xabcfaf(0x204)](exports,a40_0xabcfaf(0x252),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a40_0xbe93(_0x56073a,_0x39c4f){const _0x3b2276=a40_0x3b22();return a40_0xbe93=function(_0xbe93c7,_0x836c4a){_0xbe93c7=_0xbe93c7-0x1ee;let _0x567851=_0x3b2276[_0xbe93c7];return _0x567851;},a40_0xbe93(_0x56073a,_0x39c4f);}const loggerService_1=require(a40_0xabcfaf(0x218));class CoinToPayService{constructor(){const _0x5696b2=a40_0xabcfaf;this[_0x5696b2(0x263)]=_0x5696b2(0x264),this[_0x5696b2(0x211)]=_0x5696b2(0x246),console[_0x5696b2(0x261)](_0x5696b2(0x26a)),console['log'](_0x5696b2(0x20c),this[_0x5696b2(0x211)]);}async['createPaymentLink'](_0x520140){const _0x2d203e=a40_0xabcfaf,{orderId:_0x4bbe9a,amount:_0x336113}=_0x520140;console['log'](_0x2d203e(0x250)+_0x336113+_0x2d203e(0x1fe));const _0x3e03c7={'amount':_0x336113},_0xbf65ed=Date[_0x2d203e(0x1fa)]();try{console[_0x2d203e(0x261)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x2d203e(0x21f),this[_0x2d203e(0x263)]),console[_0x2d203e(0x261)]('Request\x20Body:',JSON[_0x2d203e(0x1ff)](_0x3e03c7,null,0x2)),console[_0x2d203e(0x261)](_0x2d203e(0x205),_0x336113,_0x2d203e(0x22e)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2d203e(0x217),_0x2d203e(0x24b),_0x2d203e(0x1f0),_0x3e03c7);const _0x446c99=await fetch(this[_0x2d203e(0x263)],{'method':_0x2d203e(0x1f0),'headers':{'Content-Type':_0x2d203e(0x229),'Accept':_0x2d203e(0x229),'User-Agent':_0x2d203e(0x23b)},'body':JSON[_0x2d203e(0x1ff)](_0x3e03c7)}),_0x2c9e4a=Date['now']()-_0xbf65ed;console[_0x2d203e(0x261)](_0x2d203e(0x231)),console[_0x2d203e(0x261)](_0x2d203e(0x23f),_0x446c99[_0x2d203e(0x1fc)]),console[_0x2d203e(0x261)]('Status\x20Text:',_0x446c99['statusText']),console['log'](_0x2d203e(0x1fb),Object[_0x2d203e(0x1f9)](_0x446c99[_0x2d203e(0x258)][_0x2d203e(0x201)]())),console[_0x2d203e(0x261)](_0x2d203e(0x249),_0x2c9e4a+'ms');const _0x3c85a7=await _0x446c99[_0x2d203e(0x271)]();console[_0x2d203e(0x261)](_0x2d203e(0x20b),_0x3c85a7);if(!_0x446c99['ok']){console[_0x2d203e(0x20a)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x2d203e(0x22c),_0x446c99[_0x2d203e(0x1fc)]),console[_0x2d203e(0x20a)](_0x2d203e(0x23e),_0x3c85a7),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2d203e(0x217),_0x2d203e(0x24b),_0x446c99[_0x2d203e(0x1fc)],_0x3c85a7,_0x2c9e4a),loggerService_1[_0x2d203e(0x26d)][_0x2d203e(0x22d)](_0x2d203e(0x217),_0x2d203e(0x24b),_0x2d203e(0x224)+_0x446c99['status']+':\x20'+_0x3c85a7);throw new Error(_0x2d203e(0x253)+_0x446c99[_0x2d203e(0x1fc)]+_0x2d203e(0x25f)+_0x3c85a7);}let _0x37de40;try{_0x37de40=JSON[_0x2d203e(0x203)](_0x3c85a7);}catch(_0x860787){console[_0x2d203e(0x20a)](_0x2d203e(0x216),_0x860787),loggerService_1[_0x2d203e(0x26d)][_0x2d203e(0x22d)]('cointopay',_0x2d203e(0x24b),_0x2d203e(0x207)+_0x860787);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3c85a7);}console[_0x2d203e(0x261)](_0x2d203e(0x1f6)),console[_0x2d203e(0x261)](_0x2d203e(0x243),JSON[_0x2d203e(0x1ff)](_0x37de40,null,0x2)),loggerService_1[_0x2d203e(0x26d)]['logWhiteDomainResponse'](_0x2d203e(0x217),_0x2d203e(0x24b),_0x446c99[_0x2d203e(0x1fc)],_0x37de40,_0x2c9e4a);if(_0x37de40[_0x2d203e(0x20a)]){const _0x26c7ac=_0x37de40[_0x2d203e(0x214)]||_0x37de40['error']||_0x2d203e(0x222);console[_0x2d203e(0x20a)](_0x2d203e(0x20e)),console[_0x2d203e(0x20a)]('Error\x20Message:',_0x26c7ac),loggerService_1[_0x2d203e(0x26d)][_0x2d203e(0x22d)]('cointopay','/create',_0x2d203e(0x22b)+_0x26c7ac);throw new Error(_0x2d203e(0x240)+_0x26c7ac);}if(!_0x37de40[_0x2d203e(0x21d)]||!_0x37de40[_0x2d203e(0x242)]){console[_0x2d203e(0x20a)](_0x2d203e(0x227)),console[_0x2d203e(0x20a)](_0x2d203e(0x235)),console[_0x2d203e(0x20a)](_0x2d203e(0x212),_0x37de40),loggerService_1[_0x2d203e(0x26d)]['logWhiteDomainError']('cointopay','/create',_0x2d203e(0x213));throw new Error(_0x2d203e(0x23c));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x2d203e(0x276),_0x37de40['gateway_payment_id']),console[_0x2d203e(0x261)](_0x2d203e(0x265),_0x37de40['payment_url']),console[_0x2d203e(0x261)]('Amount:',_0x336113,_0x2d203e(0x25c)),{'gateway_payment_id':_0x37de40[_0x2d203e(0x242)],'payment_url':_0x37de40[_0x2d203e(0x21d)]};}catch(_0x13aff8){console[_0x2d203e(0x20a)](_0x2d203e(0x25e)),console[_0x2d203e(0x20a)](_0x2d203e(0x209),_0x13aff8),loggerService_1[_0x2d203e(0x26d)][_0x2d203e(0x22d)](_0x2d203e(0x217),'/create',_0x13aff8);if(_0x13aff8 instanceof Error){console[_0x2d203e(0x20a)](_0x2d203e(0x255),_0x13aff8[_0x2d203e(0x214)]),console[_0x2d203e(0x20a)](_0x2d203e(0x226),_0x13aff8[_0x2d203e(0x238)]);throw new Error(_0x2d203e(0x225)+_0x13aff8[_0x2d203e(0x214)]);}throw new Error(_0x2d203e(0x273));}}async[a40_0xabcfaf(0x23d)](_0x1a2936){const _0x1ac18c=a40_0xabcfaf,_0x108552=Date[_0x1ac18c(0x1fa)]();try{console[_0x1ac18c(0x261)](_0x1ac18c(0x26e)+_0x1a2936);const _0x254855={'gatewayPaymentId':_0x1a2936};loggerService_1[_0x1ac18c(0x26d)][_0x1ac18c(0x210)](_0x1ac18c(0x217),_0x1ac18c(0x219),_0x1ac18c(0x1f0),_0x254855);const _0x82bfd=await fetch(this[_0x1ac18c(0x211)],{'method':_0x1ac18c(0x1f0),'headers':{'Content-Type':'application/json','Accept':_0x1ac18c(0x229),'User-Agent':_0x1ac18c(0x23b)},'body':JSON[_0x1ac18c(0x1ff)](_0x254855)}),_0x9576e8=Date[_0x1ac18c(0x1fa)]()-_0x108552;console['log'](_0x1ac18c(0x21b)),console[_0x1ac18c(0x261)](_0x1ac18c(0x23f),_0x82bfd['status']),console[_0x1ac18c(0x261)]('Response\x20Time:',_0x9576e8+'ms');if(!_0x82bfd['ok']){const _0x266b74=await _0x82bfd[_0x1ac18c(0x271)]();console[_0x1ac18c(0x20a)](_0x1ac18c(0x22c),_0x82bfd[_0x1ac18c(0x1fc)]),console['error']('Response\x20Body:',_0x266b74),loggerService_1['loggerService'][_0x1ac18c(0x21e)]('cointopay',_0x1ac18c(0x219),_0x82bfd[_0x1ac18c(0x1fc)],_0x266b74,_0x9576e8),loggerService_1[_0x1ac18c(0x26d)]['logWhiteDomainError'](_0x1ac18c(0x217),_0x1ac18c(0x219),_0x1ac18c(0x224)+_0x82bfd['status']+':\x20'+_0x266b74);throw new Error(_0x1ac18c(0x253)+_0x82bfd[_0x1ac18c(0x1fc)]);}const _0x5bb369=await _0x82bfd['text']();console[_0x1ac18c(0x261)](_0x1ac18c(0x20b),_0x5bb369);let _0x4b0f55;try{_0x4b0f55=JSON[_0x1ac18c(0x203)](_0x5bb369);}catch(_0x3550a5){console[_0x1ac18c(0x20a)](_0x1ac18c(0x216),_0x3550a5),loggerService_1[_0x1ac18c(0x26d)][_0x1ac18c(0x22d)](_0x1ac18c(0x217),_0x1ac18c(0x219),_0x1ac18c(0x207)+_0x3550a5);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x5bb369);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1ac18c(0x217),_0x1ac18c(0x219),_0x82bfd[_0x1ac18c(0x1fc)],_0x4b0f55,_0x9576e8),console[_0x1ac18c(0x261)](_0x1ac18c(0x1f1)),console[_0x1ac18c(0x261)](_0x1ac18c(0x272),_0x4b0f55['result']),console[_0x1ac18c(0x261)]('Status\x20Code:',_0x4b0f55[_0x1ac18c(0x26f)]),console['log'](_0x1ac18c(0x20d),_0x4b0f55[_0x1ac18c(0x24c)]?.[_0x1ac18c(0x267)]),console[_0x1ac18c(0x261)](_0x1ac18c(0x205),_0x4b0f55[_0x1ac18c(0x24c)]?.['Amount']),console['log'](_0x1ac18c(0x269),_0x4b0f55['data']?.[_0x1ac18c(0x26b)]);if(_0x4b0f55['result']!==_0x1ac18c(0x277)||_0x4b0f55[_0x1ac18c(0x26f)]!==0xc8){const _0x275b57=_0x4b0f55['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x1ac18c(0x20a)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x1ac18c(0x20a)](_0x1ac18c(0x268),_0x275b57),loggerService_1['loggerService']['logWhiteDomainError'](_0x1ac18c(0x217),_0x1ac18c(0x219),'Status\x20API\x20Error:\x20'+_0x275b57);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x275b57);}if(!_0x4b0f55[_0x1ac18c(0x24c)]){console[_0x1ac18c(0x20a)](_0x1ac18c(0x202)),console[_0x1ac18c(0x20a)](_0x1ac18c(0x251)),loggerService_1[_0x1ac18c(0x26d)]['logWhiteDomainError'](_0x1ac18c(0x217),_0x1ac18c(0x219),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1ac18c(0x1f8));}let _0x391c70='PENDING';switch(_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x267)]?.[_0x1ac18c(0x25a)]()){case _0x1ac18c(0x257):_0x391c70='PAID';break;case'cancelled':case _0x1ac18c(0x248):case _0x1ac18c(0x20a):_0x391c70=_0x1ac18c(0x241);break;case _0x1ac18c(0x236):case _0x1ac18c(0x239):_0x391c70=_0x1ac18c(0x1f5);break;case _0x1ac18c(0x24f):case _0x1ac18c(0x274):case _0x1ac18c(0x275):case _0x1ac18c(0x24a):default:_0x391c70=_0x1ac18c(0x232);break;}let _0x3bfe92,_0x184c3a;if(_0x4b0f55['data'][_0x1ac18c(0x233)]){const _0xf100bb=_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x233)];console[_0x1ac18c(0x261)](_0x1ac18c(0x25d),_0xf100bb);const _0x227c30=_0xf100bb[_0x1ac18c(0x24d)](/IBAN\s+([A-Z0-9]+)/i);_0x227c30&&(_0x3bfe92=_0x227c30[0x1],console[_0x1ac18c(0x261)](_0x1ac18c(0x223),_0x3bfe92)),_0x184c3a=_0xf100bb;}const _0x492153={'iban':_0x3bfe92,'bankDetails':_0x184c3a,'transactionId':_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x1fd)],'coinAddress':_0x4b0f55['data'][_0x1ac18c(0x1f4)],'qrCodeUrl':_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x254)],'expiryTime':_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x259)],'createdOn':_0x4b0f55[_0x1ac18c(0x24c)]['CreatedOn'],'confirmedOn':_0x4b0f55['data'][_0x1ac18c(0x22a)]};console[_0x1ac18c(0x261)](_0x1ac18c(0x1ee)),console['log'](_0x1ac18c(0x23f),_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x267)],'->',_0x391c70),console[_0x1ac18c(0x261)](_0x1ac18c(0x205),_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x206)],_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x26b)]),console[_0x1ac18c(0x261)]('Transaction\x20ID:',_0x4b0f55['data'][_0x1ac18c(0x1fd)]),console['log'](_0x1ac18c(0x221),_0x3bfe92||_0x1ac18c(0x230)),console['log'](_0x1ac18c(0x20f),_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x208)]),console[_0x1ac18c(0x261)]('Confirmed\x20On:',_0x4b0f55[_0x1ac18c(0x24c)]['TransactionConfirmedOn']||_0x1ac18c(0x215));if(_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x267)]?.['toLowerCase']()===_0x1ac18c(0x274))console[_0x1ac18c(0x261)](_0x1ac18c(0x1ef));else _0x4b0f55[_0x1ac18c(0x24c)]['Status']?.[_0x1ac18c(0x25a)]()===_0x1ac18c(0x257)&&console[_0x1ac18c(0x261)](_0x1ac18c(0x22f));return{'status':_0x391c70,'amount':parseFloat(_0x4b0f55[_0x1ac18c(0x24c)]['Amount'])||undefined,'currency':_0x4b0f55[_0x1ac18c(0x24c)][_0x1ac18c(0x26b)]||_0x1ac18c(0x25c),'paymentDetails':_0x492153};}catch(_0x168b9c){console[_0x1ac18c(0x20a)](_0x1ac18c(0x220),_0x168b9c),loggerService_1['loggerService'][_0x1ac18c(0x22d)](_0x1ac18c(0x217),_0x1ac18c(0x219),_0x168b9c);throw new Error(_0x1ac18c(0x1f3)+(_0x168b9c instanceof Error?_0x168b9c[_0x1ac18c(0x214)]:_0x1ac18c(0x200)));}}async[a40_0xabcfaf(0x244)](_0x33afd5){const _0x5d173d=a40_0xabcfaf,_0x58ba30=await this[_0x5d173d(0x23d)](_0x33afd5);return{'status':_0x58ba30[_0x5d173d(0x1fc)],'amount':_0x58ba30[_0x5d173d(0x260)],'currency':_0x58ba30['currency']};}async[a40_0xabcfaf(0x270)](_0x367753){const _0x6b0faf=a40_0xabcfaf;console[_0x6b0faf(0x261)](_0x6b0faf(0x234),_0x367753);let _0x512b34='PENDING';switch(_0x367753[_0x6b0faf(0x1fc)]?.[_0x6b0faf(0x25a)]()){case _0x6b0faf(0x257):_0x512b34=_0x6b0faf(0x25b);break;case'cancelled':case'failed':case'error':_0x512b34=_0x6b0faf(0x241);break;case _0x6b0faf(0x236):case'timeout':_0x512b34=_0x6b0faf(0x1f5);break;case _0x6b0faf(0x275):case _0x6b0faf(0x24f):case _0x6b0faf(0x274):case'created':default:_0x512b34='PENDING';break;}return{'paymentId':_0x367753['order_id']||_0x367753[_0x6b0faf(0x1f7)]||'','status':_0x512b34,'amount':_0x367753[_0x6b0faf(0x260)],'currency':_0x367753[_0x6b0faf(0x21c)]||'EUR'};}}exports[a40_0xabcfaf(0x247)]=CoinToPayService;function a40_0x3b22(){const _0x3518ee=['CreatedOn','Error\x20details:','error','Raw\x20Response\x20Body:','📊\x20Status\x20check\x20URL:','Payment\x20Status:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Created\x20On:','logWhiteDomainRequest','statusUrl','Response\x20data:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','message','not\x20confirmed','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','../loggerService','/status','15495MKeXGm','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','currency','payment_url','logWhiteDomainResponse','URL:','CoinToPay\x20payment\x20status\x20check\x20error:','IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20API','🏦\x20Extracted\x20IBAN:','HTTP\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20stack:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','7744rXkWBn','application/json','TransactionConfirmedOn','Business\x20Error:\x20','HTTP\x20Status:','logWhiteDomainError','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','not\x20found','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PENDING','PaymentDetail','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','expired','1242wiYDoK','stack','timeout','186352uxsvDa','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','checkPaymentStatus','Response\x20Body:','Status:','CoinToPay\x20API\x20error:\x20','FAILED','gateway_payment_id','Parsed\x20Result:','verifyPayment','9266454hWsPcC','https://tesoft.uk/gateway/cointopay/status.php','CoinToPayService','failed','Response\x20Time:','created','/create','data','match','3704rqbVkN','waiting','🪙\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20data\x20in\x20response','__esModule','HTTP\x20error!\x20status:\x20','QRCodeURL','Error\x20message:','2330022OoZASn','paid','headers','ExpiryTime','toLowerCase','PAID','EUR','🏦\x20Payment\x20Detail:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===',',\x20body:\x20','amount','log','17612bwGutb','apiUrl','https://tesoft.uk/gateway/cointopay/','Payment\x20URL:','188fVlusB','Status','Error\x20Message:','Currency:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','inputCurrency','29690qrLrVI','loggerService','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','status_code','processWebhook','text','Result:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','awaiting\x20fiat','pending','Gateway\x20Payment\x20ID:','success','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','POST','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','43947iBZWSs','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','coinAddress','EXPIRED','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','fromEntries','now','Headers:','status','TransactionID','\x20EUR','stringify','Unknown\x20error','entries','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','parse','defineProperty','Amount:','Amount','JSON\x20Parse\x20Error:\x20'];a40_0x3b22=function(){return _0x3518ee;};return a40_0x3b22();}