'use strict';function a38_0x2c42(){const _0x11dcf5=['309561oEHBZO','90XNhENc','Error\x20stack:',',\x20body:\x20','paid','2862708sWRBrs','application/json','3340GLgFgM','gateway_payment_id','üè¶\x20Extracted\x20IBAN:','parse','Response\x20Body:','status','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','payment_url','not\x20found','now','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','URL:','Unknown\x20error','Raw\x20Response\x20Body:','Status:','pending','timeout','Failed\x20to\x20parse\x20JSON\x20response:','PaymentDetail','not\x20confirmed','message','TransactionConfirmedOn','merchant_reference_id','JSON\x20Parse\x20Error:\x20','150961ehtHyN','7177518vktGNF','Response\x20Time:','Incomplete\x20response:\x20missing\x20data','/status','statusText','IBAN:','logWhiteDomainError','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','10mqCvZL','CoinToPayService','Status\x20Text:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','created','Error\x20Message:','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','3995225tVWxyt','EUR','Payment\x20Status:','POST','CreatedOn','Missing\x20data\x20in\x20response','entries','Amount','EXPIRED','CoinToPay\x20status\x20API\x20error:\x20','inputCurrency','üè¶\x20Payment\x20Detail:','verifyPayment','waiting','toLowerCase','HTTP\x20','Status\x20API\x20Error:\x20','FAILED','Error\x20details:','currency','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','TransactionID','\x20EUR','checkPaymentStatus','order_id','https://tesoft.uk/gateway/cointopay/status.php','coinAddress','/create','result','apiUrl','failed','status_code','7393776BIFGEN','PAID','Currency:','220rdVRMr','loggerService','error','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','PENDING','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Business\x20Error:\x20','data','Status','QRCodeURL','cointopay','awaiting\x20fiat','stringify','üìä\x20Status\x20check\x20URL:','Request\x20Body:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','statusUrl','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','expired','Transaction\x20ID:','stack','Gateway\x20Payment\x20ID:','match','__esModule','Error\x20message:','text','createPaymentLink','defineProperty','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','TesSoft\x20Payment\x20System/1.0','Created\x20On:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','Confirmed\x20On:','amount','log','261KRjbOp','8iHoqaJ','logWhiteDomainResponse'];a38_0x2c42=function(){return _0x11dcf5;};return a38_0x2c42();}const a38_0x417fda=a38_0x2301;(function(_0x63b045,_0x221fd9){const _0x18a305=a38_0x2301,_0x48a8a3=_0x63b045();while(!![]){try{const _0x5d1ebe=parseInt(_0x18a305(0x9b))/0x1*(-parseInt(_0x18a305(0x7a))/0x2)+-parseInt(_0x18a305(0x79))/0x3*(parseInt(_0x18a305(0x83))/0x4)+-parseInt(_0x18a305(0xae))/0x5+parseInt(_0x18a305(0x7d))/0x6*(-parseInt(_0x18a305(0x7c))/0x7)+-parseInt(_0x18a305(0xd0))/0x8+parseInt(_0x18a305(0x9c))/0x9*(-parseInt(_0x18a305(0xa4))/0xa)+parseInt(_0x18a305(0xd3))/0xb*(parseInt(_0x18a305(0x81))/0xc);if(_0x5d1ebe===_0x221fd9)break;else _0x48a8a3['push'](_0x48a8a3['shift']());}catch(_0x445722){_0x48a8a3['push'](_0x48a8a3['shift']());}}}(a38_0x2c42,0xde4f1));Object[a38_0x417fda(0x6e)](exports,a38_0x417fda(0x6a),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x38f7e5=a38_0x417fda;this[_0x38f7e5(0xcd)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x38f7e5(0xc9),console[_0x38f7e5(0x78)](_0x38f7e5(0x71)),console[_0x38f7e5(0x78)](_0x38f7e5(0xe3),this['statusUrl']);}async[a38_0x417fda(0x6d)](_0x640fde){const _0x33c153=a38_0x417fda,{orderId:_0x2eea5d,amount:_0x41220f}=_0x640fde;console[_0x33c153(0x78)](_0x33c153(0xc4)+_0x41220f+_0x33c153(0xc6));const _0x27a4a1={'amount':_0x41220f},_0x176d86=Date['now']();try{console[_0x33c153(0x78)](_0x33c153(0xd6)),console[_0x33c153(0x78)](_0x33c153(0x8e),this[_0x33c153(0xcd)]),console[_0x33c153(0x78)](_0x33c153(0xe4),JSON['stringify'](_0x27a4a1,null,0x2)),console[_0x33c153(0x78)]('Amount:',_0x41220f,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x33c153(0xe7)](_0x33c153(0xe0),_0x33c153(0xcb),_0x33c153(0xb1),_0x27a4a1);const _0x59fbcd=await fetch(this[_0x33c153(0xcd)],{'method':_0x33c153(0xb1),'headers':{'Content-Type':_0x33c153(0x82),'Accept':_0x33c153(0x82),'User-Agent':_0x33c153(0x72)},'body':JSON['stringify'](_0x27a4a1)}),_0x3b9e83=Date[_0x33c153(0x8c)]()-_0x176d86;console[_0x33c153(0x78)](_0x33c153(0x6f)),console['log'](_0x33c153(0x91),_0x59fbcd[_0x33c153(0x88)]),console[_0x33c153(0x78)](_0x33c153(0xa6),_0x59fbcd[_0x33c153(0xa0)]),console[_0x33c153(0x78)]('Headers:',Object['fromEntries'](_0x59fbcd['headers'][_0x33c153(0xb4)]())),console[_0x33c153(0x78)](_0x33c153(0x9d),_0x3b9e83+'ms');const _0x521573=await _0x59fbcd['text']();console[_0x33c153(0x78)]('Raw\x20Response\x20Body:',_0x521573);if(!_0x59fbcd['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x33c153(0xd5)](_0x33c153(0x70),_0x59fbcd[_0x33c153(0x88)]),console[_0x33c153(0xd5)](_0x33c153(0x87),_0x521573),loggerService_1[_0x33c153(0xd4)]['logWhiteDomainResponse'](_0x33c153(0xe0),_0x33c153(0xcb),_0x59fbcd['status'],_0x521573,_0x3b9e83),loggerService_1[_0x33c153(0xd4)][_0x33c153(0xa2)]('cointopay','/create',_0x33c153(0xbd)+_0x59fbcd[_0x33c153(0x88)]+':\x20'+_0x521573);throw new Error(_0x33c153(0xab)+_0x59fbcd['status']+_0x33c153(0x7f)+_0x521573);}let _0x29715d;try{_0x29715d=JSON[_0x33c153(0x86)](_0x521573);}catch(_0x1e916a){console[_0x33c153(0xd5)](_0x33c153(0x94),_0x1e916a),loggerService_1[_0x33c153(0xd4)][_0x33c153(0xa2)](_0x33c153(0xe0),_0x33c153(0xcb),'JSON\x20Parse\x20Error:\x20'+_0x1e916a);throw new Error(_0x33c153(0xa8)+_0x521573);}console[_0x33c153(0x78)](_0x33c153(0xd7)),console[_0x33c153(0x78)]('Parsed\x20Result:',JSON[_0x33c153(0xe2)](_0x29715d,null,0x2)),loggerService_1['loggerService'][_0x33c153(0x7b)]('cointopay',_0x33c153(0xcb),_0x59fbcd[_0x33c153(0x88)],_0x29715d,_0x3b9e83);if(_0x29715d[_0x33c153(0xd5)]){const _0x3f9f12=_0x29715d['message']||_0x29715d[_0x33c153(0xd5)]||_0x33c153(0xc2);console[_0x33c153(0xd5)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x33c153(0xd5)](_0x33c153(0xaa),_0x3f9f12),loggerService_1['loggerService']['logWhiteDomainError'](_0x33c153(0xe0),_0x33c153(0xcb),_0x33c153(0xdc)+_0x3f9f12);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x3f9f12);}if(!_0x29715d[_0x33c153(0x8a)]||!_0x29715d[_0x33c153(0x84)]){console[_0x33c153(0xd5)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x33c153(0xd5)](_0x33c153(0xad)),console[_0x33c153(0xd5)]('Response\x20data:',_0x29715d),loggerService_1['loggerService'][_0x33c153(0xa2)](_0x33c153(0xe0),_0x33c153(0xcb),_0x33c153(0x74));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x33c153(0x78)](_0x33c153(0x68),_0x29715d[_0x33c153(0x84)]),console[_0x33c153(0x78)]('Payment\x20URL:',_0x29715d[_0x33c153(0x8a)]),console[_0x33c153(0x78)]('Amount:',_0x41220f,_0x33c153(0xaf)),{'gateway_payment_id':_0x29715d[_0x33c153(0x84)],'payment_url':_0x29715d[_0x33c153(0x8a)]};}catch(_0x4db836){console[_0x33c153(0xd5)](_0x33c153(0x8d)),console['error'](_0x33c153(0xc0),_0x4db836),loggerService_1[_0x33c153(0xd4)]['logWhiteDomainError'](_0x33c153(0xe0),_0x33c153(0xcb),_0x4db836);if(_0x4db836 instanceof Error){console['error'](_0x33c153(0x6b),_0x4db836['message']),console[_0x33c153(0xd5)](_0x33c153(0x7e),_0x4db836[_0x33c153(0x67)]);throw new Error(_0x33c153(0x89)+_0x4db836[_0x33c153(0x97)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x2bd6f3){const _0x2d80c4=a38_0x417fda,_0xd52f72=Date[_0x2d80c4(0x8c)]();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x2bd6f3);const _0x1be313={'gatewayPaymentId':_0x2bd6f3};loggerService_1[_0x2d80c4(0xd4)][_0x2d80c4(0xe7)]('cointopay',_0x2d80c4(0x9f),_0x2d80c4(0xb1),_0x1be313);const _0x105960=await fetch(this[_0x2d80c4(0xe6)],{'method':'POST','headers':{'Content-Type':_0x2d80c4(0x82),'Accept':_0x2d80c4(0x82),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2d80c4(0xe2)](_0x1be313)}),_0x213eb0=Date['now']()-_0xd52f72;console[_0x2d80c4(0x78)](_0x2d80c4(0xdb)),console['log'](_0x2d80c4(0x91),_0x105960[_0x2d80c4(0x88)]),console['log'](_0x2d80c4(0x9d),_0x213eb0+'ms');if(!_0x105960['ok']){const _0x3db37b=await _0x105960[_0x2d80c4(0x6c)]();console['error'](_0x2d80c4(0x70),_0x105960[_0x2d80c4(0x88)]),console[_0x2d80c4(0xd5)](_0x2d80c4(0x87),_0x3db37b),loggerService_1[_0x2d80c4(0xd4)][_0x2d80c4(0x7b)]('cointopay','/status',_0x105960[_0x2d80c4(0x88)],_0x3db37b,_0x213eb0),loggerService_1['loggerService'][_0x2d80c4(0xa2)](_0x2d80c4(0xe0),'/status','HTTP\x20'+_0x105960[_0x2d80c4(0x88)]+':\x20'+_0x3db37b);throw new Error(_0x2d80c4(0xab)+_0x105960[_0x2d80c4(0x88)]);}const _0x5a46a1=await _0x105960[_0x2d80c4(0x6c)]();console[_0x2d80c4(0x78)](_0x2d80c4(0x90),_0x5a46a1);let _0x54ddf2;try{_0x54ddf2=JSON[_0x2d80c4(0x86)](_0x5a46a1);}catch(_0x5bbb44){console[_0x2d80c4(0xd5)](_0x2d80c4(0x94),_0x5bbb44),loggerService_1[_0x2d80c4(0xd4)]['logWhiteDomainError'](_0x2d80c4(0xe0),_0x2d80c4(0x9f),_0x2d80c4(0x9a)+_0x5bbb44);throw new Error(_0x2d80c4(0xa3)+_0x5a46a1);}loggerService_1[_0x2d80c4(0xd4)]['logWhiteDomainResponse'](_0x2d80c4(0xe0),'/status',_0x105960['status'],_0x54ddf2,_0x213eb0),console['log'](_0x2d80c4(0xe5)),console[_0x2d80c4(0x78)]('Result:',_0x54ddf2[_0x2d80c4(0xcc)]),console['log']('Status\x20Code:',_0x54ddf2[_0x2d80c4(0xcf)]),console['log'](_0x2d80c4(0xb0),_0x54ddf2['data']?.[_0x2d80c4(0xde)]),console[_0x2d80c4(0x78)]('Amount:',_0x54ddf2[_0x2d80c4(0xdd)]?.['Amount']),console[_0x2d80c4(0x78)](_0x2d80c4(0xd2),_0x54ddf2[_0x2d80c4(0xdd)]?.[_0x2d80c4(0xb8)]);if(_0x54ddf2['result']!=='success'||_0x54ddf2['status_code']!==0xc8){const _0x5863ce=_0x54ddf2['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x2d80c4(0xd5)](_0x2d80c4(0xaa),_0x5863ce),loggerService_1[_0x2d80c4(0xd4)]['logWhiteDomainError']('cointopay',_0x2d80c4(0x9f),_0x2d80c4(0xbe)+_0x5863ce);throw new Error(_0x2d80c4(0xb7)+_0x5863ce);}if(!_0x54ddf2[_0x2d80c4(0xdd)]){console[_0x2d80c4(0xd5)](_0x2d80c4(0xac)),console[_0x2d80c4(0xd5)](_0x2d80c4(0xb3)),loggerService_1[_0x2d80c4(0xd4)]['logWhiteDomainError'](_0x2d80c4(0xe0),'/status',_0x2d80c4(0x9e));throw new Error(_0x2d80c4(0xda));}let _0x469207=_0x2d80c4(0xd9);switch(_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xde)]?.['toLowerCase']()){case _0x2d80c4(0x80):_0x469207=_0x2d80c4(0xd1);break;case _0x2d80c4(0x75):case _0x2d80c4(0xce):case _0x2d80c4(0xd5):_0x469207=_0x2d80c4(0xbf);break;case'expired':case _0x2d80c4(0x93):_0x469207=_0x2d80c4(0xb6);break;case _0x2d80c4(0xbb):case _0x2d80c4(0xe1):case _0x2d80c4(0x92):case'created':default:_0x469207=_0x2d80c4(0xd9);break;}let _0xb0408e,_0x445528;if(_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0x95)]){const _0x579a8f=_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0x95)];console[_0x2d80c4(0x78)](_0x2d80c4(0xb9),_0x579a8f);const _0x236193=_0x579a8f[_0x2d80c4(0x69)](/IBAN\s+([A-Z0-9]+)/i);_0x236193&&(_0xb0408e=_0x236193[0x1],console[_0x2d80c4(0x78)](_0x2d80c4(0x85),_0xb0408e)),_0x445528=_0x579a8f;}const _0x433336={'iban':_0xb0408e,'bankDetails':_0x445528,'transactionId':_0x54ddf2[_0x2d80c4(0xdd)]['TransactionID'],'coinAddress':_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xca)],'qrCodeUrl':_0x54ddf2['data'][_0x2d80c4(0xdf)],'expiryTime':_0x54ddf2['data']['ExpiryTime'],'createdOn':_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xb2)],'confirmedOn':_0x54ddf2[_0x2d80c4(0xdd)]['TransactionConfirmedOn']};console[_0x2d80c4(0x78)](_0x2d80c4(0x64)),console[_0x2d80c4(0x78)](_0x2d80c4(0x91),_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xde)],'->',_0x469207),console[_0x2d80c4(0x78)]('Amount:',_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xb5)],_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xb8)]),console[_0x2d80c4(0x78)](_0x2d80c4(0x66),_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xc5)]),console[_0x2d80c4(0x78)](_0x2d80c4(0xa1),_0xb0408e||_0x2d80c4(0x8b)),console['log'](_0x2d80c4(0x73),_0x54ddf2['data'][_0x2d80c4(0xb2)]),console['log'](_0x2d80c4(0x76),_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0x98)]||_0x2d80c4(0x96));if(_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xde)]?.[_0x2d80c4(0xbc)]()===_0x2d80c4(0xe1))console[_0x2d80c4(0x78)](_0x2d80c4(0xa7));else _0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xde)]?.[_0x2d80c4(0xbc)]()===_0x2d80c4(0x80)&&console['log'](_0x2d80c4(0xd8));return{'status':_0x469207,'amount':parseFloat(_0x54ddf2[_0x2d80c4(0xdd)][_0x2d80c4(0xb5)])||undefined,'currency':_0x54ddf2['data'][_0x2d80c4(0xb8)]||_0x2d80c4(0xaf),'paymentDetails':_0x433336};}catch(_0x4d2abb){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4d2abb),loggerService_1[_0x2d80c4(0xd4)]['logWhiteDomainError']('cointopay',_0x2d80c4(0x9f),_0x4d2abb);throw new Error(_0x2d80c4(0xc3)+(_0x4d2abb instanceof Error?_0x4d2abb[_0x2d80c4(0x97)]:_0x2d80c4(0x8f)));}}async[a38_0x417fda(0xba)](_0x2c2b7d){const _0x14df62=a38_0x417fda,_0x345964=await this[_0x14df62(0xc7)](_0x2c2b7d);return{'status':_0x345964['status'],'amount':_0x345964[_0x14df62(0x77)],'currency':_0x345964['currency']};}async['processWebhook'](_0x344546){const _0x9049b0=a38_0x417fda;console[_0x9049b0(0x78)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x344546);let _0x27407d=_0x9049b0(0xd9);switch(_0x344546[_0x9049b0(0x88)]?.[_0x9049b0(0xbc)]()){case _0x9049b0(0x80):_0x27407d=_0x9049b0(0xd1);break;case _0x9049b0(0x75):case _0x9049b0(0xce):case _0x9049b0(0xd5):_0x27407d=_0x9049b0(0xbf);break;case _0x9049b0(0x65):case _0x9049b0(0x93):_0x27407d='EXPIRED';break;case _0x9049b0(0x92):case _0x9049b0(0xbb):case _0x9049b0(0xe1):case _0x9049b0(0xa9):default:_0x27407d=_0x9049b0(0xd9);break;}return{'paymentId':_0x344546[_0x9049b0(0xc8)]||_0x344546[_0x9049b0(0x99)]||'','status':_0x27407d,'amount':_0x344546[_0x9049b0(0x77)],'currency':_0x344546[_0x9049b0(0xc1)]||_0x9049b0(0xaf)};}}function a38_0x2301(_0x3637fe,_0x5dde50){const _0x2c42cc=a38_0x2c42();return a38_0x2301=function(_0x230120,_0x333452){_0x230120=_0x230120-0x64;let _0x5cb979=_0x2c42cc[_0x230120];return _0x5cb979;},a38_0x2301(_0x3637fe,_0x5dde50);}exports[a38_0x417fda(0xa5)]=CoinToPayService;