'use strict';const a65_0x54c631=a65_0x1742;function a65_0x1742(_0x143198,_0x45641c){_0x143198=_0x143198-0x1da;const _0x26ab85=a65_0x26ab();let _0x17429b=_0x26ab85[_0x143198];return _0x17429b;}function a65_0x26ab(){const _0xe1ff0=['15cpGfzm','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','logWhiteDomainRequest','processWebhook','pending','Request\x20Body:','CoinToPay\x20payment\x20status\x20check\x20error:','checkPaymentStatus','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',',\x20body:\x20','failed','apiUrl','currency','stringify','1667883MZaYSd','Status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','application/json','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','11nUkBAj','data','31422tHrbNW','Response\x20data:','Status\x20Code:','JSON\x20Parse\x20Error:\x20','inputCurrency','paid','Payment\x20System/1.0','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Currency:','\x20EUR','merchant_reference_id','entries','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','coinAddress','&alternative=false','/create','stack','awaiting\x20fiat','Unknown\x20error','statusText','order_id','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','CreatedOn','HTTP\x20error!\x20status:\x20','success','headers','Error\x20Message:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','QRCodeURL','expired','TransactionConfirmedOn','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Created\x20On:','PaymentDetail','===\x20COINTOPAY\x20API\x20ERROR\x20===','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Error\x20message:','Response\x20Body:','Gateway\x20Payment\x20ID:','/status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','defineProperty','44005PoClqG','318jaFomd','Missing\x20data\x20in\x20response','status_code','logWhiteDomainResponse','loggerService','not\x20confirmed','CoinToPay\x20API\x20error:\x20','Payment\x20URL\x20(modified):','FAILED','gateway_payment_id','Status\x20API\x20Error:\x20','POST','cancelled','===\x20COINTOPAY\x20SUCCESS\x20===','10008BOIXGf','Status:','TransactionID','Transaction\x20ID:','createPaymentLink','Amount','Raw\x20Response\x20Body:','timeout','EXPIRED','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','PAID','EUR','63JweCyf','1065708xmorWh','Business\x20Error:\x20','toLowerCase','text','Incomplete\x20response:\x20missing\x20data','result','Payment\x20URL\x20(original):','__esModule','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/status.php','message','Unknown\x20error\x20from\x20CoinToPay\x20API','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','cointopay','PENDING','now','ðŸ¦\x20Extracted\x20IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','https://tesoft.uk/gateway/cointopay/','1121264kgDNKY','Failed\x20to\x20parse\x20JSON\x20response:','1099RAkLAq','6276TIUBqx','IBAN:','Headers:','Confirmed\x20On:','Payment\x20Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Status\x20Text:','fromEntries','Amount:','waiting','error','not\x20found','statusUrl','Response\x20Time:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainError','created','1938350ypfEIz','Error\x20stack:','log','ðŸ¦\x20Payment\x20Detail:','parse','match'];a65_0x26ab=function(){return _0xe1ff0;};return a65_0x26ab();}(function(_0x27f253,_0x23a86b){const _0x3dbeba=a65_0x1742,_0x5a2e3e=_0x27f253();while(!![]){try{const _0x1da951=parseInt(_0x3dbeba(0x25a))/0x1*(-parseInt(_0x3dbeba(0x228))/0x2)+-parseInt(_0x3dbeba(0x1f1))/0x3+-parseInt(_0x3dbeba(0x243))/0x4*(parseInt(_0x3dbeba(0x1e3))/0x5)+parseInt(_0x3dbeba(0x1f9))/0x6*(parseInt(_0x3dbeba(0x259))/0x7)+-parseInt(_0x3dbeba(0x257))/0x8*(parseInt(_0x3dbeba(0x242))/0x9)+parseInt(_0x3dbeba(0x1dd))/0xa*(parseInt(_0x3dbeba(0x1f7))/0xb)+-parseInt(_0x3dbeba(0x236))/0xc*(-parseInt(_0x3dbeba(0x227))/0xd);if(_0x1da951===_0x23a86b)break;else _0x5a2e3e['push'](_0x5a2e3e['shift']());}catch(_0x129f3b){_0x5a2e3e['push'](_0x5a2e3e['shift']());}}}(a65_0x26ab,0x7b446));Object[a65_0x54c631(0x226)](exports,a65_0x54c631(0x24a),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x3e4ceb=a65_0x54c631;this['apiUrl']=_0x3e4ceb(0x256),this['statusUrl']=_0x3e4ceb(0x24d),console['log'](_0x3e4ceb(0x24b)),console[_0x3e4ceb(0x1df)]('ðŸ“Š\x20Status\x20check\x20URL:',this[_0x3e4ceb(0x266)]);}async[a65_0x54c631(0x23a)](_0x3dae88){const _0x3a5aee=a65_0x54c631,{orderId:_0x49080c,amount:_0x4874b7}=_0x3dae88;console[_0x3a5aee(0x1df)]('ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4874b7+_0x3a5aee(0x203));const _0x43cb61={'amount':_0x4874b7},_0x36a3cb=Date[_0x3a5aee(0x253)]();try{console['log'](_0x3a5aee(0x20f)),console[_0x3a5aee(0x1df)]('URL:',this[_0x3a5aee(0x1ee)]),console['log'](_0x3a5aee(0x1e8),JSON['stringify'](_0x43cb61,null,0x2)),console[_0x3a5aee(0x1df)](_0x3a5aee(0x262),_0x4874b7,_0x3a5aee(0x250)),loggerService_1[_0x3a5aee(0x22c)][_0x3a5aee(0x1e5)](_0x3a5aee(0x251),_0x3a5aee(0x209),_0x3a5aee(0x233),_0x43cb61);const _0x1678f0=await fetch(this[_0x3a5aee(0x1ee)],{'method':_0x3a5aee(0x233),'headers':{'Content-Type':_0x3a5aee(0x1f4),'Accept':'application/json','User-Agent':_0x3a5aee(0x1ff)},'body':JSON['stringify'](_0x43cb61)}),_0x43a85b=Date['now']()-_0x36a3cb;console[_0x3a5aee(0x1df)](_0x3a5aee(0x1f5)),console[_0x3a5aee(0x1df)](_0x3a5aee(0x237),_0x1678f0['status']),console[_0x3a5aee(0x1df)](_0x3a5aee(0x260),_0x1678f0[_0x3a5aee(0x20d)]),console[_0x3a5aee(0x1df)](_0x3a5aee(0x25c),Object[_0x3a5aee(0x261)](_0x1678f0[_0x3a5aee(0x213)][_0x3a5aee(0x205)]())),console[_0x3a5aee(0x1df)](_0x3a5aee(0x267),_0x43a85b+'ms');const _0x4b55ec=await _0x1678f0[_0x3a5aee(0x246)]();console[_0x3a5aee(0x1df)](_0x3a5aee(0x23c),_0x4b55ec);if(!_0x1678f0['ok']){console[_0x3a5aee(0x264)](_0x3a5aee(0x21f)),console['error'](_0x3a5aee(0x1f6),_0x1678f0[_0x3a5aee(0x21a)]),console[_0x3a5aee(0x264)]('Response\x20Body:',_0x4b55ec),loggerService_1[_0x3a5aee(0x22c)][_0x3a5aee(0x22b)]('cointopay',_0x3a5aee(0x209),_0x1678f0[_0x3a5aee(0x21a)],_0x4b55ec,_0x43a85b),loggerService_1[_0x3a5aee(0x22c)][_0x3a5aee(0x1db)](_0x3a5aee(0x251),_0x3a5aee(0x209),'HTTP\x20'+_0x1678f0[_0x3a5aee(0x21a)]+':\x20'+_0x4b55ec);throw new Error(_0x3a5aee(0x211)+_0x1678f0[_0x3a5aee(0x21a)]+_0x3a5aee(0x1ec)+_0x4b55ec);}let _0x234fa9;try{_0x234fa9=JSON[_0x3a5aee(0x1e1)](_0x4b55ec);}catch(_0x9c993a){console['error'](_0x3a5aee(0x258),_0x9c993a),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x3a5aee(0x1fc)+_0x9c993a);throw new Error(_0x3a5aee(0x1f3)+_0x4b55ec);}console[_0x3a5aee(0x1df)](_0x3a5aee(0x201)),console[_0x3a5aee(0x1df)](_0x3a5aee(0x200),JSON[_0x3a5aee(0x1f0)](_0x234fa9,null,0x2)),loggerService_1[_0x3a5aee(0x22c)][_0x3a5aee(0x22b)](_0x3a5aee(0x251),_0x3a5aee(0x209),_0x1678f0['status'],_0x234fa9,_0x43a85b);if(_0x234fa9[_0x3a5aee(0x264)]){const _0x11f043=_0x234fa9[_0x3a5aee(0x24e)]||_0x234fa9[_0x3a5aee(0x264)]||_0x3a5aee(0x24f);console[_0x3a5aee(0x264)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x3a5aee(0x264)](_0x3a5aee(0x214),_0x11f043),loggerService_1[_0x3a5aee(0x22c)]['logWhiteDomainError'](_0x3a5aee(0x251),_0x3a5aee(0x209),_0x3a5aee(0x244)+_0x11f043);throw new Error(_0x3a5aee(0x22e)+_0x11f043);}if(!_0x234fa9['payment_url']||!_0x234fa9[_0x3a5aee(0x231)]){console[_0x3a5aee(0x264)](_0x3a5aee(0x21b)),console['error'](_0x3a5aee(0x215)),console[_0x3a5aee(0x264)](_0x3a5aee(0x1fa),_0x234fa9),loggerService_1['loggerService'][_0x3a5aee(0x1db)](_0x3a5aee(0x251),_0x3a5aee(0x209),_0x3a5aee(0x225));throw new Error(_0x3a5aee(0x1da));}console[_0x3a5aee(0x1df)](_0x3a5aee(0x235)),console[_0x3a5aee(0x1df)](_0x3a5aee(0x223),_0x234fa9[_0x3a5aee(0x231)]),console[_0x3a5aee(0x1df)](_0x3a5aee(0x249),_0x234fa9['payment_url']);const _0x123a14=_0x234fa9['payment_url']+_0x3a5aee(0x208);return console['log'](_0x3a5aee(0x22f),_0x123a14),console[_0x3a5aee(0x1df)](_0x3a5aee(0x262),_0x4874b7,_0x3a5aee(0x241)),{'gateway_payment_id':_0x234fa9[_0x3a5aee(0x231)],'payment_url':_0x123a14};}catch(_0x4d6b7b){console[_0x3a5aee(0x264)](_0x3a5aee(0x25f)),console['error']('Error\x20details:',_0x4d6b7b),loggerService_1[_0x3a5aee(0x22c)][_0x3a5aee(0x1db)](_0x3a5aee(0x251),_0x3a5aee(0x209),_0x4d6b7b);if(_0x4d6b7b instanceof Error){console['error'](_0x3a5aee(0x221),_0x4d6b7b['message']),console[_0x3a5aee(0x264)](_0x3a5aee(0x1de),_0x4d6b7b[_0x3a5aee(0x20a)]);throw new Error(_0x3a5aee(0x206)+_0x4d6b7b[_0x3a5aee(0x24e)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x1ab3e0){const _0x1e35dc=a65_0x54c631,_0x4179cc=Date['now']();try{console[_0x1e35dc(0x1df)]('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x1ab3e0);const _0x1b6143={'gatewayPaymentId':_0x1ab3e0};loggerService_1[_0x1e35dc(0x22c)][_0x1e35dc(0x1e5)](_0x1e35dc(0x251),'/status',_0x1e35dc(0x233),_0x1b6143);const _0x37a9a4=await fetch(this['statusUrl'],{'method':_0x1e35dc(0x233),'headers':{'Content-Type':_0x1e35dc(0x1f4),'Accept':_0x1e35dc(0x1f4),'User-Agent':_0x1e35dc(0x1ff)},'body':JSON[_0x1e35dc(0x1f0)](_0x1b6143)}),_0x2c6d42=Date[_0x1e35dc(0x253)]()-_0x4179cc;console[_0x1e35dc(0x1df)](_0x1e35dc(0x1e4)),console[_0x1e35dc(0x1df)](_0x1e35dc(0x237),_0x37a9a4[_0x1e35dc(0x21a)]),console[_0x1e35dc(0x1df)](_0x1e35dc(0x267),_0x2c6d42+'ms');if(!_0x37a9a4['ok']){const _0x5586d9=await _0x37a9a4[_0x1e35dc(0x246)]();console['error'](_0x1e35dc(0x1f6),_0x37a9a4[_0x1e35dc(0x21a)]),console[_0x1e35dc(0x264)](_0x1e35dc(0x222),_0x5586d9),loggerService_1[_0x1e35dc(0x22c)]['logWhiteDomainResponse'](_0x1e35dc(0x251),'/status',_0x37a9a4[_0x1e35dc(0x21a)],_0x5586d9,_0x2c6d42),loggerService_1[_0x1e35dc(0x22c)][_0x1e35dc(0x1db)]('cointopay',_0x1e35dc(0x224),'HTTP\x20'+_0x37a9a4[_0x1e35dc(0x21a)]+':\x20'+_0x5586d9);throw new Error(_0x1e35dc(0x211)+_0x37a9a4['status']);}const _0x2956fc=await _0x37a9a4[_0x1e35dc(0x246)]();console[_0x1e35dc(0x1df)]('Raw\x20Response\x20Body:',_0x2956fc);let _0x2e02c9;try{_0x2e02c9=JSON[_0x1e35dc(0x1e1)](_0x2956fc);}catch(_0x3d6914){console[_0x1e35dc(0x264)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3d6914),loggerService_1[_0x1e35dc(0x22c)][_0x1e35dc(0x1db)](_0x1e35dc(0x251),_0x1e35dc(0x224),_0x1e35dc(0x1fc)+_0x3d6914);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x2956fc);}loggerService_1[_0x1e35dc(0x22c)]['logWhiteDomainResponse'](_0x1e35dc(0x251),_0x1e35dc(0x224),_0x37a9a4[_0x1e35dc(0x21a)],_0x2e02c9,_0x2c6d42),console[_0x1e35dc(0x1df)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x1e35dc(0x1df)]('Result:',_0x2e02c9['result']),console[_0x1e35dc(0x1df)](_0x1e35dc(0x1fb),_0x2e02c9['status_code']),console[_0x1e35dc(0x1df)](_0x1e35dc(0x25e),_0x2e02c9[_0x1e35dc(0x1f8)]?.[_0x1e35dc(0x1f2)]),console[_0x1e35dc(0x1df)](_0x1e35dc(0x262),_0x2e02c9['data']?.[_0x1e35dc(0x23b)]),console[_0x1e35dc(0x1df)](_0x1e35dc(0x202),_0x2e02c9[_0x1e35dc(0x1f8)]?.[_0x1e35dc(0x1fd)]);if(_0x2e02c9[_0x1e35dc(0x248)]!==_0x1e35dc(0x212)||_0x2e02c9[_0x1e35dc(0x22a)]!==0xc8){const _0xb44888=_0x2e02c9['message']||_0x1e35dc(0x219);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x1e35dc(0x264)](_0x1e35dc(0x214),_0xb44888),loggerService_1[_0x1e35dc(0x22c)][_0x1e35dc(0x1db)](_0x1e35dc(0x251),_0x1e35dc(0x224),_0x1e35dc(0x232)+_0xb44888);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0xb44888);}if(!_0x2e02c9[_0x1e35dc(0x1f8)]){console['error'](_0x1e35dc(0x24c)),console[_0x1e35dc(0x264)](_0x1e35dc(0x229)),loggerService_1[_0x1e35dc(0x22c)]['logWhiteDomainError']('cointopay',_0x1e35dc(0x224),_0x1e35dc(0x247));throw new Error(_0x1e35dc(0x255));}let _0x5c2c72=_0x1e35dc(0x252);switch(_0x2e02c9[_0x1e35dc(0x1f8)]['Status']?.[_0x1e35dc(0x245)]()){case _0x1e35dc(0x1fe):_0x5c2c72=_0x1e35dc(0x240);break;case _0x1e35dc(0x234):case _0x1e35dc(0x1ed):case _0x1e35dc(0x264):_0x5c2c72=_0x1e35dc(0x230);break;case'expired':case _0x1e35dc(0x23d):_0x5c2c72=_0x1e35dc(0x23e);break;case'waiting':case _0x1e35dc(0x20b):case _0x1e35dc(0x1e7):case _0x1e35dc(0x1dc):default:_0x5c2c72=_0x1e35dc(0x252);break;}let _0x5e3fd7,_0x30fb25;if(_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x21e)]){const _0x45b742=_0x2e02c9[_0x1e35dc(0x1f8)]['PaymentDetail'];console[_0x1e35dc(0x1df)](_0x1e35dc(0x1e0),_0x45b742);const _0x2e5725=_0x45b742[_0x1e35dc(0x1e2)](/IBAN\s+([A-Z0-9]+)/i);_0x2e5725&&(_0x5e3fd7=_0x2e5725[0x1],console[_0x1e35dc(0x1df)](_0x1e35dc(0x254),_0x5e3fd7)),_0x30fb25=_0x45b742;}const _0x3f219b={'iban':_0x5e3fd7,'bankDetails':_0x30fb25,'transactionId':_0x2e02c9['data'][_0x1e35dc(0x238)],'coinAddress':_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x207)],'qrCodeUrl':_0x2e02c9['data'][_0x1e35dc(0x216)],'expiryTime':_0x2e02c9['data']['ExpiryTime'],'createdOn':_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x210)],'confirmedOn':_0x2e02c9[_0x1e35dc(0x1f8)]['TransactionConfirmedOn']};console[_0x1e35dc(0x1df)](_0x1e35dc(0x21c)),console[_0x1e35dc(0x1df)](_0x1e35dc(0x237),_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x1f2)],'->',_0x5c2c72),console[_0x1e35dc(0x1df)]('Amount:',_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x23b)],_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x1fd)]),console[_0x1e35dc(0x1df)](_0x1e35dc(0x239),_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x238)]),console[_0x1e35dc(0x1df)](_0x1e35dc(0x25b),_0x5e3fd7||_0x1e35dc(0x265)),console[_0x1e35dc(0x1df)](_0x1e35dc(0x21d),_0x2e02c9['data']['CreatedOn']),console['log'](_0x1e35dc(0x25d),_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x218)]||_0x1e35dc(0x22d));if(_0x2e02c9[_0x1e35dc(0x1f8)]['Status']?.[_0x1e35dc(0x245)]()===_0x1e35dc(0x20b))console[_0x1e35dc(0x1df)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x1f2)]?.[_0x1e35dc(0x245)]()===_0x1e35dc(0x1fe)&&console['log'](_0x1e35dc(0x220));return{'status':_0x5c2c72,'amount':parseFloat(_0x2e02c9[_0x1e35dc(0x1f8)][_0x1e35dc(0x23b)])||undefined,'currency':_0x2e02c9['data'][_0x1e35dc(0x1fd)]||'EUR','paymentDetails':_0x3f219b};}catch(_0x3746c0){console[_0x1e35dc(0x264)](_0x1e35dc(0x1e9),_0x3746c0),loggerService_1['loggerService'][_0x1e35dc(0x1db)]('cointopay',_0x1e35dc(0x224),_0x3746c0);throw new Error(_0x1e35dc(0x23f)+(_0x3746c0 instanceof Error?_0x3746c0[_0x1e35dc(0x24e)]:_0x1e35dc(0x20c)));}}async['verifyPayment'](_0x31ddc3){const _0x3b32b0=a65_0x54c631,_0x4c87b7=await this[_0x3b32b0(0x1ea)](_0x31ddc3);return{'status':_0x4c87b7[_0x3b32b0(0x21a)],'amount':_0x4c87b7['amount'],'currency':_0x4c87b7['currency']};}async[a65_0x54c631(0x1e6)](_0x2271ba){const _0xe0bfac=a65_0x54c631;console[_0xe0bfac(0x1df)](_0xe0bfac(0x1eb),_0x2271ba);let _0x48dfc3=_0xe0bfac(0x252);switch(_0x2271ba[_0xe0bfac(0x21a)]?.[_0xe0bfac(0x245)]()){case _0xe0bfac(0x1fe):_0x48dfc3=_0xe0bfac(0x240);break;case _0xe0bfac(0x234):case _0xe0bfac(0x1ed):case _0xe0bfac(0x264):_0x48dfc3=_0xe0bfac(0x230);break;case _0xe0bfac(0x217):case'timeout':_0x48dfc3=_0xe0bfac(0x23e);break;case'pending':case _0xe0bfac(0x263):case _0xe0bfac(0x20b):case'created':default:_0x48dfc3=_0xe0bfac(0x252);break;}return{'paymentId':_0x2271ba[_0xe0bfac(0x20e)]||_0x2271ba[_0xe0bfac(0x204)]||'','status':_0x48dfc3,'amount':_0x2271ba['amount'],'currency':_0x2271ba[_0xe0bfac(0x1ef)]||_0xe0bfac(0x241)};}}exports['CoinToPayService']=CoinToPayService;