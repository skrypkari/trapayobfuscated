'use strict';const a41_0x3d0e37=a41_0x414c;(function(_0x37b509,_0x54cfb6){const _0x3f2f56=a41_0x414c,_0x2072e6=_0x37b509();while(!![]){try{const _0x5b764c=-parseInt(_0x3f2f56(0x1e6))/0x1*(-parseInt(_0x3f2f56(0x1b3))/0x2)+parseInt(_0x3f2f56(0x1ab))/0x3*(parseInt(_0x3f2f56(0x1c4))/0x4)+-parseInt(_0x3f2f56(0x202))/0x5+parseInt(_0x3f2f56(0x1d4))/0x6+-parseInt(_0x3f2f56(0x192))/0x7*(parseInt(_0x3f2f56(0x1c9))/0x8)+parseInt(_0x3f2f56(0x203))/0x9+-parseInt(_0x3f2f56(0x1d2))/0xa*(parseInt(_0x3f2f56(0x1a2))/0xb);if(_0x5b764c===_0x54cfb6)break;else _0x2072e6['push'](_0x2072e6['shift']());}catch(_0xe25a40){_0x2072e6['push'](_0x2072e6['shift']());}}}(a41_0x4fc7,0xc0143));Object['defineProperty'](exports,a41_0x3d0e37(0x18b),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a41_0x4fc7(){const _0x58c97b=['Error\x20message:','fromEntries','HTTP\x20Status:','status_code','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Error\x20Message:','===\x20COINTOPAY\x20SUCCESS\x20===','1037192KwxGHp','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Response\x20Body:','paid','currency','196504ZEcRZM','message','result','now','waiting','statusText','HTTP\x20error!\x20status:\x20','Headers:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','30350akRGfz','error','7489944TYeIgN','Gateway\x20Payment\x20ID:','üè¶\x20Extracted\x20IBAN:','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20stack:','processWebhook','Request\x20Body:','toLowerCase','üìä\x20Status\x20check\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','\x20EUR','PaymentDetail','match','Status','timeout','awaiting\x20fiat','953qVRiAJ','Result:','../loggerService','status','statusUrl','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','TransactionID','/create','https://tesoft.uk/gateway/cointopay/status.php','pending','data','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Status\x20Text:','checkPaymentStatus','TransactionConfirmedOn','QRCodeURL','Raw\x20Response\x20Body:','not\x20found','headers','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Payment\x20URL:','FAILED','loggerService','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','https://tesoft.uk/gateway/cointopay/','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','HTTP\x20','950795AjwFmw','10127583CMnImd','amount','log','text','order_id','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','cointopay','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Status:','apiUrl','EUR','Error\x20details:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PENDING','__esModule','Parsed\x20Result:','Amount','Confirmed\x20On:','logWhiteDomainResponse','Amount:','coinAddress','343KXPTHP','PAID','expired','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','TesSoft\x20Payment\x20System/1.0','Business\x20Error:\x20','inputCurrency','failed','stack','CoinToPay\x20API\x20error:\x20','success','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Status\x20API\x20Error:\x20','POST','2068IWCqha',',\x20body:\x20','merchant_reference_id','createPaymentLink','EXPIRED','logWhiteDomainError','gateway_payment_id','parse','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','3EYRSzO','application/json','CreatedOn','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainRequest','Response\x20Time:','JSON\x20Parse\x20Error:\x20','ExpiryTime','248JhwxvG','CoinToPay\x20status\x20API\x20error:\x20','cancelled','payment_url','stringify','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','verifyPayment'];a41_0x4fc7=function(){return _0x58c97b;};return a41_0x4fc7();}const loggerService_1=require(a41_0x3d0e37(0x1e8));class CoinToPayService{constructor(){const _0x40d219=a41_0x3d0e37;this[_0x40d219(0x186)]=_0x40d219(0x1ff),this[_0x40d219(0x1ea)]=_0x40d219(0x1ee),console[_0x40d219(0x205)](_0x40d219(0x1bf)),console[_0x40d219(0x205)](_0x40d219(0x1de),this[_0x40d219(0x1ea)]);}async[a41_0x3d0e37(0x1a5)](_0x303dda){const _0x307b7b=a41_0x3d0e37,{orderId:_0x2200c2,amount:_0x2dc772}=_0x303dda;console[_0x307b7b(0x205)](_0x307b7b(0x1fe)+_0x2dc772+_0x307b7b(0x1e0));const _0x265547={'amount':_0x2dc772},_0x22b76b=Date[_0x307b7b(0x1cc)]();try{console[_0x307b7b(0x205)](_0x307b7b(0x196)),console[_0x307b7b(0x205)]('URL:',this[_0x307b7b(0x186)]),console[_0x307b7b(0x205)](_0x307b7b(0x1dc),JSON['stringify'](_0x265547,null,0x2)),console[_0x307b7b(0x205)](_0x307b7b(0x190),_0x2dc772,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x307b7b(0x1af)](_0x307b7b(0x183),_0x307b7b(0x1ed),'POST',_0x265547);const _0x55a498=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x307b7b(0x1ac),'Accept':_0x307b7b(0x1ac),'User-Agent':_0x307b7b(0x197)},'body':JSON[_0x307b7b(0x1b7)](_0x265547)}),_0xad6e6f=Date['now']()-_0x22b76b;console[_0x307b7b(0x205)](_0x307b7b(0x20b)),console['log'](_0x307b7b(0x185),_0x55a498[_0x307b7b(0x1e9)]),console[_0x307b7b(0x205)](_0x307b7b(0x1f2),_0x55a498[_0x307b7b(0x1ce)]),console[_0x307b7b(0x205)](_0x307b7b(0x1d0),Object[_0x307b7b(0x1bc)](_0x55a498[_0x307b7b(0x1f8)]['entries']())),console[_0x307b7b(0x205)](_0x307b7b(0x1b0),_0xad6e6f+'ms');const _0x14b134=await _0x55a498[_0x307b7b(0x206)]();console['log'](_0x307b7b(0x1f6),_0x14b134);if(!_0x55a498['ok']){console[_0x307b7b(0x1d3)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x307b7b(0x1d3)](_0x307b7b(0x1bd),_0x55a498[_0x307b7b(0x1e9)]),console[_0x307b7b(0x1d3)](_0x307b7b(0x1c6),_0x14b134),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x307b7b(0x1ed),_0x55a498[_0x307b7b(0x1e9)],_0x14b134,_0xad6e6f),loggerService_1[_0x307b7b(0x1fd)][_0x307b7b(0x1a7)](_0x307b7b(0x183),_0x307b7b(0x1ed),_0x307b7b(0x201)+_0x55a498[_0x307b7b(0x1e9)]+':\x20'+_0x14b134);throw new Error(_0x307b7b(0x1cf)+_0x55a498['status']+_0x307b7b(0x1a3)+_0x14b134);}let _0x21a513;try{_0x21a513=JSON[_0x307b7b(0x1a9)](_0x14b134);}catch(_0x372649){console[_0x307b7b(0x1d3)](_0x307b7b(0x208),_0x372649),loggerService_1['loggerService'][_0x307b7b(0x1a7)](_0x307b7b(0x183),_0x307b7b(0x1ed),_0x307b7b(0x1b1)+_0x372649);throw new Error(_0x307b7b(0x19f)+_0x14b134);}console[_0x307b7b(0x205)](_0x307b7b(0x209)),console[_0x307b7b(0x205)](_0x307b7b(0x18c),JSON[_0x307b7b(0x1b7)](_0x21a513,null,0x2)),loggerService_1[_0x307b7b(0x1fd)][_0x307b7b(0x18f)](_0x307b7b(0x183),_0x307b7b(0x1ed),_0x55a498[_0x307b7b(0x1e9)],_0x21a513,_0xad6e6f);if(_0x21a513[_0x307b7b(0x1d3)]){const _0x199bc3=_0x21a513[_0x307b7b(0x1ca)]||_0x21a513[_0x307b7b(0x1d3)]||_0x307b7b(0x1b8);console[_0x307b7b(0x1d3)](_0x307b7b(0x184)),console[_0x307b7b(0x1d3)](_0x307b7b(0x1c2),_0x199bc3),loggerService_1[_0x307b7b(0x1fd)][_0x307b7b(0x1a7)](_0x307b7b(0x183),_0x307b7b(0x1ed),_0x307b7b(0x198)+_0x199bc3);throw new Error(_0x307b7b(0x19c)+_0x199bc3);}if(!_0x21a513[_0x307b7b(0x1b6)]||!_0x21a513[_0x307b7b(0x1a8)]){console[_0x307b7b(0x1d3)](_0x307b7b(0x189)),console[_0x307b7b(0x1d3)](_0x307b7b(0x1ae)),console['error'](_0x307b7b(0x19e),_0x21a513),loggerService_1['loggerService']['logWhiteDomainError'](_0x307b7b(0x183),_0x307b7b(0x1ed),_0x307b7b(0x1d9));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x307b7b(0x205)](_0x307b7b(0x1c3)),console[_0x307b7b(0x205)](_0x307b7b(0x1d5),_0x21a513[_0x307b7b(0x1a8)]),console[_0x307b7b(0x205)](_0x307b7b(0x1fb),_0x21a513[_0x307b7b(0x1b6)]),console[_0x307b7b(0x205)]('Amount:',_0x2dc772,_0x307b7b(0x187)),{'gateway_payment_id':_0x21a513['gateway_payment_id'],'payment_url':_0x21a513['payment_url']};}catch(_0x58d1f3){console['error'](_0x307b7b(0x1aa)),console[_0x307b7b(0x1d3)](_0x307b7b(0x188),_0x58d1f3),loggerService_1[_0x307b7b(0x1fd)][_0x307b7b(0x1a7)](_0x307b7b(0x183),'/create',_0x58d1f3);if(_0x58d1f3 instanceof Error){console['error'](_0x307b7b(0x1bb),_0x58d1f3['message']),console[_0x307b7b(0x1d3)](_0x307b7b(0x1da),_0x58d1f3[_0x307b7b(0x19b)]);throw new Error(_0x307b7b(0x1c5)+_0x58d1f3[_0x307b7b(0x1ca)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x432413){const _0x484b9e=a41_0x3d0e37,_0x49a693=Date[_0x484b9e(0x1cc)]();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x432413);const _0x496ce4={'gatewayPaymentId':_0x432413};loggerService_1[_0x484b9e(0x1fd)][_0x484b9e(0x1af)]('cointopay','/status',_0x484b9e(0x1a1),_0x496ce4);const _0x583d6f=await fetch(this[_0x484b9e(0x1ea)],{'method':_0x484b9e(0x1a1),'headers':{'Content-Type':_0x484b9e(0x1ac),'Accept':'application/json','User-Agent':_0x484b9e(0x197)},'body':JSON['stringify'](_0x496ce4)}),_0x670fce=Date[_0x484b9e(0x1cc)]()-_0x49a693;console[_0x484b9e(0x205)](_0x484b9e(0x1eb)),console[_0x484b9e(0x205)]('Status:',_0x583d6f['status']),console['log']('Response\x20Time:',_0x670fce+'ms');if(!_0x583d6f['ok']){const _0x5881de=await _0x583d6f[_0x484b9e(0x206)]();console[_0x484b9e(0x1d3)]('HTTP\x20Status:',_0x583d6f[_0x484b9e(0x1e9)]),console[_0x484b9e(0x1d3)](_0x484b9e(0x1c6),_0x5881de),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x484b9e(0x183),'/status',_0x583d6f[_0x484b9e(0x1e9)],_0x5881de,_0x670fce),loggerService_1[_0x484b9e(0x1fd)]['logWhiteDomainError'](_0x484b9e(0x183),_0x484b9e(0x1b9),'HTTP\x20'+_0x583d6f[_0x484b9e(0x1e9)]+':\x20'+_0x5881de);throw new Error('HTTP\x20error!\x20status:\x20'+_0x583d6f[_0x484b9e(0x1e9)]);}const _0x2925ec=await _0x583d6f['text']();console[_0x484b9e(0x205)](_0x484b9e(0x1f6),_0x2925ec);let _0x5a5b62;try{_0x5a5b62=JSON[_0x484b9e(0x1a9)](_0x2925ec);}catch(_0x2eb495){console['error'](_0x484b9e(0x208),_0x2eb495),loggerService_1[_0x484b9e(0x1fd)][_0x484b9e(0x1a7)](_0x484b9e(0x183),_0x484b9e(0x1b9),_0x484b9e(0x1b1)+_0x2eb495);throw new Error(_0x484b9e(0x1fa)+_0x2925ec);}loggerService_1[_0x484b9e(0x1fd)]['logWhiteDomainResponse'](_0x484b9e(0x183),_0x484b9e(0x1b9),_0x583d6f[_0x484b9e(0x1e9)],_0x5a5b62,_0x670fce),console['log'](_0x484b9e(0x1f9)),console[_0x484b9e(0x205)](_0x484b9e(0x1e7),_0x5a5b62[_0x484b9e(0x1cb)]),console[_0x484b9e(0x205)]('Status\x20Code:',_0x5a5b62[_0x484b9e(0x1be)]),console[_0x484b9e(0x205)]('Payment\x20Status:',_0x5a5b62[_0x484b9e(0x1f0)]?.[_0x484b9e(0x1e3)]),console[_0x484b9e(0x205)](_0x484b9e(0x190),_0x5a5b62[_0x484b9e(0x1f0)]?.['Amount']),console[_0x484b9e(0x205)]('Currency:',_0x5a5b62[_0x484b9e(0x1f0)]?.[_0x484b9e(0x199)]);if(_0x5a5b62[_0x484b9e(0x1cb)]!==_0x484b9e(0x19d)||_0x5a5b62['status_code']!==0xc8){const _0x350b46=_0x5a5b62[_0x484b9e(0x1ca)]||_0x484b9e(0x200);console['error'](_0x484b9e(0x1f1)),console[_0x484b9e(0x1d3)](_0x484b9e(0x1c2),_0x350b46),loggerService_1['loggerService'][_0x484b9e(0x1a7)](_0x484b9e(0x183),_0x484b9e(0x1b9),_0x484b9e(0x1a0)+_0x350b46);throw new Error(_0x484b9e(0x1b4)+_0x350b46);}if(!_0x5a5b62[_0x484b9e(0x1f0)]){console[_0x484b9e(0x1d3)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x484b9e(0x1fd)]['logWhiteDomainError'](_0x484b9e(0x183),'/status',_0x484b9e(0x195));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5c832a='PENDING';switch(_0x5a5b62['data'][_0x484b9e(0x1e3)]?.[_0x484b9e(0x1dd)]()){case _0x484b9e(0x1c7):_0x5c832a=_0x484b9e(0x193);break;case _0x484b9e(0x1b5):case _0x484b9e(0x19a):case _0x484b9e(0x1d3):_0x5c832a='FAILED';break;case'expired':case _0x484b9e(0x1e4):_0x5c832a=_0x484b9e(0x1a6);break;case'waiting':case'awaiting\x20fiat':case _0x484b9e(0x1ef):case'created':default:_0x5c832a=_0x484b9e(0x18a);break;}let _0x4a3df5,_0x345f42;if(_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1e1)]){const _0x1e334d=_0x5a5b62['data'][_0x484b9e(0x1e1)];console[_0x484b9e(0x205)]('üè¶\x20Payment\x20Detail:',_0x1e334d);const _0x4f45a5=_0x1e334d[_0x484b9e(0x1e2)](/IBAN\s+([A-Z0-9]+)/i);_0x4f45a5&&(_0x4a3df5=_0x4f45a5[0x1],console[_0x484b9e(0x205)](_0x484b9e(0x1d6),_0x4a3df5)),_0x345f42=_0x1e334d;}const _0x4e85d2={'iban':_0x4a3df5,'bankDetails':_0x345f42,'transactionId':_0x5a5b62['data'][_0x484b9e(0x1ec)],'coinAddress':_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x191)],'qrCodeUrl':_0x5a5b62['data'][_0x484b9e(0x1f5)],'expiryTime':_0x5a5b62['data'][_0x484b9e(0x1b2)],'createdOn':_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1ad)],'confirmedOn':_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1f4)]};console[_0x484b9e(0x205)](_0x484b9e(0x1d8)),console['log']('Status:',_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1e3)],'->',_0x5c832a),console[_0x484b9e(0x205)](_0x484b9e(0x190),_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x18d)],_0x5a5b62['data'][_0x484b9e(0x199)]),console['log'](_0x484b9e(0x20a),_0x5a5b62['data'][_0x484b9e(0x1ec)]),console[_0x484b9e(0x205)]('IBAN:',_0x4a3df5||_0x484b9e(0x1f7)),console[_0x484b9e(0x205)]('Created\x20On:',_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1ad)]),console[_0x484b9e(0x205)](_0x484b9e(0x18e),_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x1f4)]||_0x484b9e(0x1d7));if(_0x5a5b62['data'][_0x484b9e(0x1e3)]?.[_0x484b9e(0x1dd)]()==='awaiting\x20fiat')console[_0x484b9e(0x205)](_0x484b9e(0x1c1));else _0x5a5b62['data'][_0x484b9e(0x1e3)]?.['toLowerCase']()==='paid'&&console[_0x484b9e(0x205)](_0x484b9e(0x1d1));return{'status':_0x5c832a,'amount':parseFloat(_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x18d)])||undefined,'currency':_0x5a5b62[_0x484b9e(0x1f0)][_0x484b9e(0x199)]||'EUR','paymentDetails':_0x4e85d2};}catch(_0x13ee5b){console[_0x484b9e(0x1d3)](_0x484b9e(0x1df),_0x13ee5b),loggerService_1['loggerService'][_0x484b9e(0x1a7)]('cointopay','/status',_0x13ee5b);throw new Error(_0x484b9e(0x1c0)+(_0x13ee5b instanceof Error?_0x13ee5b[_0x484b9e(0x1ca)]:'Unknown\x20error'));}}async[a41_0x3d0e37(0x1ba)](_0x1f4902){const _0x598674=a41_0x3d0e37,_0x2ea209=await this[_0x598674(0x1f3)](_0x1f4902);return{'status':_0x2ea209[_0x598674(0x1e9)],'amount':_0x2ea209[_0x598674(0x204)],'currency':_0x2ea209[_0x598674(0x1c8)]};}async[a41_0x3d0e37(0x1db)](_0x6269e2){const _0x443fba=a41_0x3d0e37;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x6269e2);let _0x23fe2d=_0x443fba(0x18a);switch(_0x6269e2[_0x443fba(0x1e9)]?.[_0x443fba(0x1dd)]()){case'paid':_0x23fe2d=_0x443fba(0x193);break;case _0x443fba(0x1b5):case _0x443fba(0x19a):case _0x443fba(0x1d3):_0x23fe2d=_0x443fba(0x1fc);break;case _0x443fba(0x194):case'timeout':_0x23fe2d='EXPIRED';break;case _0x443fba(0x1ef):case _0x443fba(0x1cd):case _0x443fba(0x1e5):case'created':default:_0x23fe2d='PENDING';break;}return{'paymentId':_0x6269e2[_0x443fba(0x207)]||_0x6269e2[_0x443fba(0x1a4)]||'','status':_0x23fe2d,'amount':_0x6269e2[_0x443fba(0x204)],'currency':_0x6269e2[_0x443fba(0x1c8)]||'EUR'};}}function a41_0x414c(_0x569522,_0x186fad){const _0x4fc7f9=a41_0x4fc7();return a41_0x414c=function(_0x414c2d,_0x553371){_0x414c2d=_0x414c2d-0x183;let _0x1c3604=_0x4fc7f9[_0x414c2d];return _0x1c3604;},a41_0x414c(_0x569522,_0x186fad);}exports['CoinToPayService']=CoinToPayService;