'use strict';function a43_0x4596(){const _0x488a21=['Response\x20Time:','defineProperty','message','TransactionConfirmedOn','Amount:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','application/json','/create','not\x20found','verifyPayment','Status','gateway_payment_id','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Error\x20Message:','Payment\x20Status:','Status\x20Code:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','1404048IvqwAY','EXPIRED','error','QRCodeURL','1394930hkeJkb','createPaymentLink','Amount','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','not\x20confirmed','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20stack:','Business\x20Error:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','match','HTTP\x20error!\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Body:','2028306UIKfRX','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status','292928pIOcWS','TransactionID','waiting','Response\x20data:','Parsed\x20Result:','735632GDYJtn','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','PaymentDetail','HTTP\x20','Transaction\x20ID:','inputCurrency','üè¶\x20Payment\x20Detail:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Raw\x20Response\x20Body:','paid','stringify','amount','Payment\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','payment_url','success','Status:','EUR','Status\x20Text:','CoinToPay\x20API\x20error:\x20','/status','28LpDwSn','Error\x20details:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','HTTP\x20Status:','ExpiryTime','üìä\x20Status\x20check\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','Unknown\x20error\x20from\x20CoinToPay\x20API','Gateway\x20Payment\x20ID:','toLowerCase','statusUrl','FAILED','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20ERROR\x20===','\x20EUR','345ookGCj','currency','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','__esModule','CreatedOn','TesSoft\x20Payment\x20System/1.0','URL:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','failed','JSON\x20Parse\x20Error:\x20','timeout','PENDING','now','coinAddress','Request\x20Body:','PAID','log','parse','data',',\x20body:\x20','merchant_reference_id','Result:','===\x20COINTOPAY\x20SUCCESS\x20===','logWhiteDomainError','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','text','status_code','statusText','loggerService','checkPaymentStatus','CoinToPayService','POST','https://tesoft.uk/gateway/cointopay/','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status\x20API\x20Error:\x20','801174AseLME','created','pending','IBAN:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','fromEntries','cointopay','cancelled','logWhiteDomainResponse','result','expired'];a43_0x4596=function(){return _0x488a21;};return a43_0x4596();}const a43_0x109c8a=a43_0x4d73;(function(_0x1f3d08,_0x2189e1){const _0x5e0c7e=a43_0x4d73,_0x5bf915=_0x1f3d08();while(!![]){try{const _0x3c52c5=-parseInt(_0x5e0c7e(0x1d3))/0x1+-parseInt(_0x5e0c7e(0x1a1))/0x2+parseInt(_0x5e0c7e(0x202))/0x3*(parseInt(_0x5e0c7e(0x1ef))/0x4)+parseInt(_0x5e0c7e(0x1c2))/0x5+parseInt(_0x5e0c7e(0x1be))/0x6+parseInt(_0x5e0c7e(0x1d0))/0x7+parseInt(_0x5e0c7e(0x1d8))/0x8;if(_0x3c52c5===_0x2189e1)break;else _0x5bf915['push'](_0x5bf915['shift']());}catch(_0x36a617){_0x5bf915['push'](_0x5bf915['shift']());}}}(a43_0x4596,0x3150c));function a43_0x4d73(_0x5121d1,_0x1b414f){const _0x459621=a43_0x4596();return a43_0x4d73=function(_0x4d73ae,_0x2c2744){_0x4d73ae=_0x4d73ae-0x17e;let _0x46d9f0=_0x459621[_0x4d73ae];return _0x46d9f0;},a43_0x4d73(_0x5121d1,_0x1b414f);}Object[a43_0x109c8a(0x1ad)](exports,a43_0x109c8a(0x180),{'value':!![]}),exports[a43_0x109c8a(0x19b)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x412813=a43_0x109c8a;this['apiUrl']=_0x412813(0x19d),this[_0x412813(0x1fb)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x412813(0x1e0)),console[_0x412813(0x18d)](_0x412813(0x1f6),this['statusUrl']);}async[a43_0x109c8a(0x1c3)](_0x22d316){const _0x549adb=a43_0x109c8a,{orderId:_0x478f44,amount:_0x1dad87}=_0x22d316;console[_0x549adb(0x18d)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x1dad87+_0x549adb(0x201));const _0x10170f={'amount':_0x1dad87},_0x3fad1a=Date['now']();try{console[_0x549adb(0x18d)](_0x549adb(0x1f2)),console[_0x549adb(0x18d)](_0x549adb(0x183),this['apiUrl']),console[_0x549adb(0x18d)](_0x549adb(0x18b),JSON['stringify'](_0x10170f,null,0x2)),console[_0x549adb(0x18d)](_0x549adb(0x1b0),_0x1dad87,_0x549adb(0x1d9)),loggerService_1[_0x549adb(0x199)][_0x549adb(0x1b8)]('cointopay','/create',_0x549adb(0x19c),_0x10170f);const _0x55c1da=await fetch(this['apiUrl'],{'method':_0x549adb(0x19c),'headers':{'Content-Type':_0x549adb(0x1b2),'Accept':_0x549adb(0x1b2),'User-Agent':_0x549adb(0x182)},'body':JSON[_0x549adb(0x1e3)](_0x10170f)}),_0x45f15a=Date[_0x549adb(0x189)]()-_0x3fad1a;console[_0x549adb(0x18d)](_0x549adb(0x1d1)),console[_0x549adb(0x18d)](_0x549adb(0x1ea),_0x55c1da[_0x549adb(0x1d2)]),console[_0x549adb(0x18d)](_0x549adb(0x1ec),_0x55c1da[_0x549adb(0x198)]),console[_0x549adb(0x18d)]('Headers:',Object[_0x549adb(0x1a6)](_0x55c1da['headers']['entries']())),console[_0x549adb(0x18d)](_0x549adb(0x1ac),_0x45f15a+'ms');const _0x2eab60=await _0x55c1da[_0x549adb(0x196)]();console[_0x549adb(0x18d)](_0x549adb(0x1e1),_0x2eab60);if(!_0x55c1da['ok']){console[_0x549adb(0x1c0)](_0x549adb(0x200)),console['error'](_0x549adb(0x1f4),_0x55c1da[_0x549adb(0x1d2)]),console[_0x549adb(0x1c0)](_0x549adb(0x1cf),_0x2eab60),loggerService_1[_0x549adb(0x199)][_0x549adb(0x1a9)]('cointopay','/create',_0x55c1da['status'],_0x2eab60,_0x45f15a),loggerService_1['loggerService'][_0x549adb(0x194)](_0x549adb(0x1a7),'/create',_0x549adb(0x1dc)+_0x55c1da[_0x549adb(0x1d2)]+':\x20'+_0x2eab60);throw new Error(_0x549adb(0x1cd)+_0x55c1da[_0x549adb(0x1d2)]+_0x549adb(0x190)+_0x2eab60);}let _0x1e28e5;try{_0x1e28e5=JSON[_0x549adb(0x18e)](_0x2eab60);}catch(_0x270c9d){console[_0x549adb(0x1c0)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x270c9d),loggerService_1[_0x549adb(0x199)][_0x549adb(0x194)]('cointopay',_0x549adb(0x1b3),_0x549adb(0x186)+_0x270c9d);throw new Error(_0x549adb(0x1ce)+_0x2eab60);}console[_0x549adb(0x18d)](_0x549adb(0x1b9)),console['log'](_0x549adb(0x1d7),JSON[_0x549adb(0x1e3)](_0x1e28e5,null,0x2)),loggerService_1[_0x549adb(0x199)][_0x549adb(0x1a9)](_0x549adb(0x1a7),_0x549adb(0x1b3),_0x55c1da['status'],_0x1e28e5,_0x45f15a);if(_0x1e28e5[_0x549adb(0x1c0)]){const _0x21d8d2=_0x1e28e5[_0x549adb(0x1ae)]||_0x1e28e5[_0x549adb(0x1c0)]||_0x549adb(0x1f8);console[_0x549adb(0x1c0)](_0x549adb(0x1e7)),console[_0x549adb(0x1c0)]('Error\x20Message:',_0x21d8d2),loggerService_1[_0x549adb(0x199)]['logWhiteDomainError'](_0x549adb(0x1a7),_0x549adb(0x1b3),_0x549adb(0x1c9)+_0x21d8d2);throw new Error(_0x549adb(0x1ed)+_0x21d8d2);}if(!_0x1e28e5[_0x549adb(0x1e8)]||!_0x1e28e5['gateway_payment_id']){console['error'](_0x549adb(0x1fe)),console[_0x549adb(0x1c0)](_0x549adb(0x1f1)),console[_0x549adb(0x1c0)](_0x549adb(0x1d6),_0x1e28e5),loggerService_1['loggerService'][_0x549adb(0x194)](_0x549adb(0x1a7),_0x549adb(0x1b3),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x549adb(0x1e6));}return console[_0x549adb(0x18d)](_0x549adb(0x193)),console['log'](_0x549adb(0x1f9),_0x1e28e5[_0x549adb(0x1b7)]),console['log'](_0x549adb(0x1e5),_0x1e28e5['payment_url']),console['log']('Amount:',_0x1dad87,_0x549adb(0x1eb)),{'gateway_payment_id':_0x1e28e5[_0x549adb(0x1b7)],'payment_url':_0x1e28e5[_0x549adb(0x1e8)]};}catch(_0x268f3b){console[_0x549adb(0x1c0)](_0x549adb(0x1fd)),console[_0x549adb(0x1c0)](_0x549adb(0x1f0),_0x268f3b),loggerService_1[_0x549adb(0x199)][_0x549adb(0x194)]('cointopay','/create',_0x268f3b);if(_0x268f3b instanceof Error){console[_0x549adb(0x1c0)](_0x549adb(0x1f3),_0x268f3b[_0x549adb(0x1ae)]),console['error'](_0x549adb(0x1c8),_0x268f3b['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x268f3b[_0x549adb(0x1ae)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x109c8a(0x19a)](_0x4ebf51){const _0x1e3399=a43_0x109c8a,_0x4250a1=Date['now']();try{console[_0x1e3399(0x18d)](_0x1e3399(0x195)+_0x4ebf51);const _0x2c8276={'gatewayPaymentId':_0x4ebf51};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x1e3399(0x1ee),'POST',_0x2c8276);const _0x2cb267=await fetch(this[_0x1e3399(0x1fb)],{'method':_0x1e3399(0x19c),'headers':{'Content-Type':'application/json','Accept':_0x1e3399(0x1b2),'User-Agent':_0x1e3399(0x182)},'body':JSON[_0x1e3399(0x1e3)](_0x2c8276)}),_0x42f42e=Date['now']()-_0x4250a1;console[_0x1e3399(0x18d)](_0x1e3399(0x17f)),console['log']('Status:',_0x2cb267[_0x1e3399(0x1d2)]),console[_0x1e3399(0x18d)](_0x1e3399(0x1ac),_0x42f42e+'ms');if(!_0x2cb267['ok']){const _0x10c093=await _0x2cb267[_0x1e3399(0x196)]();console[_0x1e3399(0x1c0)]('HTTP\x20Status:',_0x2cb267[_0x1e3399(0x1d2)]),console[_0x1e3399(0x1c0)]('Response\x20Body:',_0x10c093),loggerService_1[_0x1e3399(0x199)][_0x1e3399(0x1a9)](_0x1e3399(0x1a7),_0x1e3399(0x1ee),_0x2cb267[_0x1e3399(0x1d2)],_0x10c093,_0x42f42e),loggerService_1['loggerService'][_0x1e3399(0x194)]('cointopay',_0x1e3399(0x1ee),_0x1e3399(0x1dc)+_0x2cb267[_0x1e3399(0x1d2)]+':\x20'+_0x10c093);throw new Error(_0x1e3399(0x1cd)+_0x2cb267[_0x1e3399(0x1d2)]);}const _0x375c10=await _0x2cb267['text']();console['log']('Raw\x20Response\x20Body:',_0x375c10);let _0x1be1ae;try{_0x1be1ae=JSON['parse'](_0x375c10);}catch(_0x2b219f){console[_0x1e3399(0x1c0)](_0x1e3399(0x1c7),_0x2b219f),loggerService_1[_0x1e3399(0x199)][_0x1e3399(0x194)](_0x1e3399(0x1a7),_0x1e3399(0x1ee),_0x1e3399(0x186)+_0x2b219f);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x375c10);}loggerService_1[_0x1e3399(0x199)]['logWhiteDomainResponse'](_0x1e3399(0x1a7),'/status',_0x2cb267[_0x1e3399(0x1d2)],_0x1be1ae,_0x42f42e),console[_0x1e3399(0x18d)](_0x1e3399(0x1cb)),console[_0x1e3399(0x18d)](_0x1e3399(0x192),_0x1be1ae[_0x1e3399(0x1aa)]),console['log'](_0x1e3399(0x1bc),_0x1be1ae[_0x1e3399(0x197)]),console[_0x1e3399(0x18d)](_0x1e3399(0x1bb),_0x1be1ae[_0x1e3399(0x18f)]?.[_0x1e3399(0x1b6)]),console[_0x1e3399(0x18d)](_0x1e3399(0x1b0),_0x1be1ae[_0x1e3399(0x18f)]?.[_0x1e3399(0x1c4)]),console[_0x1e3399(0x18d)]('Currency:',_0x1be1ae['data']?.[_0x1e3399(0x1de)]);if(_0x1be1ae[_0x1e3399(0x1aa)]!==_0x1e3399(0x1e9)||_0x1be1ae[_0x1e3399(0x197)]!==0xc8){const _0x21fb30=_0x1be1ae[_0x1e3399(0x1ae)]||_0x1e3399(0x1b1);console[_0x1e3399(0x1c0)](_0x1e3399(0x1da)),console[_0x1e3399(0x1c0)](_0x1e3399(0x1ba),_0x21fb30),loggerService_1[_0x1e3399(0x199)][_0x1e3399(0x194)](_0x1e3399(0x1a7),_0x1e3399(0x1ee),_0x1e3399(0x1a0)+_0x21fb30);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x21fb30);}if(!_0x1be1ae['data']){console[_0x1e3399(0x1c0)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x1e3399(0x199)][_0x1e3399(0x194)](_0x1e3399(0x1a7),_0x1e3399(0x1ee),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1e3399(0x1c5));}let _0x4f305b='PENDING';switch(_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1b6)]?.[_0x1e3399(0x1fa)]()){case _0x1e3399(0x1e2):_0x4f305b=_0x1e3399(0x18c);break;case _0x1e3399(0x1a8):case _0x1e3399(0x185):case'error':_0x4f305b=_0x1e3399(0x1fc);break;case _0x1e3399(0x1ab):case _0x1e3399(0x187):_0x4f305b=_0x1e3399(0x1bf);break;case _0x1e3399(0x1d5):case _0x1e3399(0x1ff):case _0x1e3399(0x1a3):case _0x1e3399(0x1a2):default:_0x4f305b=_0x1e3399(0x188);break;}let _0x33c229,_0x5d7e9e;if(_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1db)]){const _0xbb3ba4=_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1db)];console[_0x1e3399(0x18d)](_0x1e3399(0x1df),_0xbb3ba4);const _0x2870f2=_0xbb3ba4[_0x1e3399(0x1cc)](/IBAN\s+([A-Z0-9]+)/i);_0x2870f2&&(_0x33c229=_0x2870f2[0x1],console[_0x1e3399(0x18d)](_0x1e3399(0x19e),_0x33c229)),_0x5d7e9e=_0xbb3ba4;}const _0x5303e1={'iban':_0x33c229,'bankDetails':_0x5d7e9e,'transactionId':_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1d4)],'coinAddress':_0x1be1ae['data'][_0x1e3399(0x18a)],'qrCodeUrl':_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1c1)],'expiryTime':_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1f5)],'createdOn':_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x181)],'confirmedOn':_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1af)]};console[_0x1e3399(0x18d)](_0x1e3399(0x19f)),console[_0x1e3399(0x18d)](_0x1e3399(0x1ea),_0x1be1ae[_0x1e3399(0x18f)]['Status'],'->',_0x4f305b),console['log'](_0x1e3399(0x1b0),_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1c4)],_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1de)]),console[_0x1e3399(0x18d)](_0x1e3399(0x1dd),_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1d4)]),console[_0x1e3399(0x18d)](_0x1e3399(0x1a4),_0x33c229||_0x1e3399(0x1b4)),console['log']('Created\x20On:',_0x1be1ae[_0x1e3399(0x18f)]['CreatedOn']),console['log']('Confirmed\x20On:',_0x1be1ae['data'][_0x1e3399(0x1af)]||_0x1e3399(0x1c6));if(_0x1be1ae[_0x1e3399(0x18f)][_0x1e3399(0x1b6)]?.['toLowerCase']()===_0x1e3399(0x1ff))console[_0x1e3399(0x18d)](_0x1e3399(0x1a5));else _0x1be1ae['data'][_0x1e3399(0x1b6)]?.['toLowerCase']()===_0x1e3399(0x1e2)&&console['log'](_0x1e3399(0x1bd));return{'status':_0x4f305b,'amount':parseFloat(_0x1be1ae['data']['Amount'])||undefined,'currency':_0x1be1ae['data'][_0x1e3399(0x1de)]||_0x1e3399(0x1eb),'paymentDetails':_0x5303e1};}catch(_0x6cb280){console[_0x1e3399(0x1c0)](_0x1e3399(0x1f7),_0x6cb280),loggerService_1[_0x1e3399(0x199)][_0x1e3399(0x194)](_0x1e3399(0x1a7),'/status',_0x6cb280);throw new Error(_0x1e3399(0x1ca)+(_0x6cb280 instanceof Error?_0x6cb280[_0x1e3399(0x1ae)]:'Unknown\x20error'));}}async[a43_0x109c8a(0x1b5)](_0x107ffa){const _0x556303=a43_0x109c8a,_0x3bc19b=await this[_0x556303(0x19a)](_0x107ffa);return{'status':_0x3bc19b[_0x556303(0x1d2)],'amount':_0x3bc19b[_0x556303(0x1e4)],'currency':_0x3bc19b[_0x556303(0x17e)]};}async['processWebhook'](_0x1232ae){const _0x2aac0e=a43_0x109c8a;console[_0x2aac0e(0x18d)](_0x2aac0e(0x184),_0x1232ae);let _0x10da85=_0x2aac0e(0x188);switch(_0x1232ae[_0x2aac0e(0x1d2)]?.['toLowerCase']()){case _0x2aac0e(0x1e2):_0x10da85=_0x2aac0e(0x18c);break;case'cancelled':case'failed':case _0x2aac0e(0x1c0):_0x10da85='FAILED';break;case _0x2aac0e(0x1ab):case _0x2aac0e(0x187):_0x10da85=_0x2aac0e(0x1bf);break;case _0x2aac0e(0x1a3):case _0x2aac0e(0x1d5):case'awaiting\x20fiat':case _0x2aac0e(0x1a2):default:_0x10da85=_0x2aac0e(0x188);break;}return{'paymentId':_0x1232ae['order_id']||_0x1232ae[_0x2aac0e(0x191)]||'','status':_0x10da85,'amount':_0x1232ae['amount'],'currency':_0x1232ae[_0x2aac0e(0x17e)]||_0x2aac0e(0x1eb)};}}exports[a43_0x109c8a(0x19b)]=CoinToPayService;