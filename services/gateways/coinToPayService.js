'use strict';const a46_0x2555eb=a46_0x20bf;function a46_0x20bf(_0x4eae94,_0x58d442){const _0x2c3b06=a46_0x2c3b();return a46_0x20bf=function(_0x20bf50,_0x522d5a){_0x20bf50=_0x20bf50-0x16b;let _0x3cd126=_0x2c3b06[_0x20bf50];return _0x3cd126;},a46_0x20bf(_0x4eae94,_0x58d442);}(function(_0x4cb85,_0x4545ec){const _0x2841dc=a46_0x20bf,_0x32beac=_0x4cb85();while(!![]){try{const _0x2e48d7=-parseInt(_0x2841dc(0x1b2))/0x1*(-parseInt(_0x2841dc(0x19e))/0x2)+parseInt(_0x2841dc(0x17f))/0x3+-parseInt(_0x2841dc(0x1c5))/0x4+-parseInt(_0x2841dc(0x17e))/0x5*(parseInt(_0x2841dc(0x17b))/0x6)+-parseInt(_0x2841dc(0x174))/0x7*(-parseInt(_0x2841dc(0x18f))/0x8)+-parseInt(_0x2841dc(0x19b))/0x9*(-parseInt(_0x2841dc(0x1ba))/0xa)+-parseInt(_0x2841dc(0x1ad))/0xb;if(_0x2e48d7===_0x4545ec)break;else _0x32beac['push'](_0x32beac['shift']());}catch(_0x32b87c){_0x32beac['push'](_0x32beac['shift']());}}}(a46_0x2c3b,0xa6fc2));function a46_0x2c3b(){const _0x1cffcf=['cointopay','pending','message','data','898686CbAbpi','Error\x20details:','paid','2WdHDyO','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Result:','Gateway\x20Payment\x20ID:','üè¶\x20Payment\x20Detail:','error','HTTP\x20Status:','Incomplete\x20response:\x20missing\x20data','Status\x20Text:','createPaymentLink','Raw\x20Response\x20Body:','PENDING','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','entries','timeout','13743213VaGfFM','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/cointopay/','IBAN:','1096189SYKQMi','Status','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','apiUrl','CreatedOn','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','status','Status:','10oKfrii','application/json',',\x20body:\x20','Status\x20API\x20Error:\x20','CoinToPay\x20API\x20error:\x20','PaymentDetail','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Headers:','checkPaymentStatus','Response\x20Time:','===\x20COINTOPAY\x20API\x20ERROR\x20===','1960588LCQbMk','Error\x20Message:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','waiting','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','PAID','Created\x20On:','gateway_payment_id','Amount:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','awaiting\x20fiat','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','URL:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainRequest','match','created','result','üìä\x20Status\x20check\x20URL:','logWhiteDomainResponse','cancelled','Response\x20Body:','EUR','toLowerCase','now','inputCurrency','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','verifyPayment','stringify','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','amount','HTTP\x20','QRCodeURL','currency','statusUrl','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','/create','Amount','success','378413nJCWlS','text','parse','Error\x20message:','CoinToPayService','ExpiryTime','defineProperty','12dDFQJg','POST','loggerService','1805440bzhtRu','3740598TNfDKY','log','Transaction\x20ID:','Response\x20data:','payment_url','not\x20confirmed','statusText','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TransactionConfirmedOn','Confirmed\x20On:','Status\x20Code:','EXPIRED','expired','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainError','Parsed\x20Result:','104TNqybV','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','\x20EUR','fromEntries','/status','status_code','Request\x20Body:','Unknown\x20error'];a46_0x2c3b=function(){return _0x1cffcf;};return a46_0x2c3b();}Object[a46_0x2555eb(0x17a)](exports,'__esModule',{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x3bb337=a46_0x2555eb;this[_0x3bb337(0x1b5)]=_0x3bb337(0x1b0),this[_0x3bb337(0x16f)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3bb337(0x180)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x3bb337(0x180)](_0x3bb337(0x1dd),this['statusUrl']);}async[a46_0x2555eb(0x1a7)](_0x49cd02){const _0x20f296=a46_0x2555eb,{orderId:_0x13c144,amount:_0x2c0452}=_0x49cd02;console[_0x20f296(0x180)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2c0452+_0x20f296(0x191));const _0x4565d7={'amount':_0x2c0452},_0x137bcb=Date[_0x20f296(0x1e3)]();try{console[_0x20f296(0x180)](_0x20f296(0x19f)),console[_0x20f296(0x180)](_0x20f296(0x1d5),this[_0x20f296(0x1b5)]),console[_0x20f296(0x180)](_0x20f296(0x195),JSON['stringify'](_0x4565d7,null,0x2)),console[_0x20f296(0x180)](_0x20f296(0x1cf),_0x2c0452,_0x20f296(0x1c7)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x20f296(0x197),'/create','POST',_0x4565d7);const _0xc876bd=await fetch(this[_0x20f296(0x1b5)],{'method':'POST','headers':{'Content-Type':_0x20f296(0x1bb),'Accept':_0x20f296(0x1bb),'User-Agent':_0x20f296(0x1d1)},'body':JSON[_0x20f296(0x1e7)](_0x4565d7)}),_0x353365=Date['now']()-_0x137bcb;console[_0x20f296(0x180)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x20f296(0x1b9),_0xc876bd[_0x20f296(0x1b8)]),console['log'](_0x20f296(0x1a6),_0xc876bd[_0x20f296(0x185)]),console[_0x20f296(0x180)](_0x20f296(0x1c1),Object[_0x20f296(0x192)](_0xc876bd['headers'][_0x20f296(0x1ab)]())),console[_0x20f296(0x180)](_0x20f296(0x1c3),_0x353365+'ms');const _0x4aa04f=await _0xc876bd[_0x20f296(0x175)]();console[_0x20f296(0x180)]('Raw\x20Response\x20Body:',_0x4aa04f);if(!_0xc876bd['ok']){console[_0x20f296(0x1a3)](_0x20f296(0x1c4)),console[_0x20f296(0x1a3)](_0x20f296(0x1a4),_0xc876bd[_0x20f296(0x1b8)]),console[_0x20f296(0x1a3)](_0x20f296(0x1e0),_0x4aa04f),loggerService_1['loggerService'][_0x20f296(0x1de)](_0x20f296(0x197),'/create',_0xc876bd[_0x20f296(0x1b8)],_0x4aa04f,_0x353365),loggerService_1['loggerService'][_0x20f296(0x18d)](_0x20f296(0x197),_0x20f296(0x171),_0x20f296(0x16c)+_0xc876bd[_0x20f296(0x1b8)]+':\x20'+_0x4aa04f);throw new Error('HTTP\x20error!\x20status:\x20'+_0xc876bd['status']+_0x20f296(0x1bc)+_0x4aa04f);}let _0x1f7f8e;try{_0x1f7f8e=JSON[_0x20f296(0x176)](_0x4aa04f);}catch(_0x222f56){console['error'](_0x20f296(0x1af),_0x222f56),loggerService_1[_0x20f296(0x17d)][_0x20f296(0x18d)]('cointopay',_0x20f296(0x171),'JSON\x20Parse\x20Error:\x20'+_0x222f56);throw new Error(_0x20f296(0x1ae)+_0x4aa04f);}console[_0x20f296(0x180)](_0x20f296(0x1d0)),console[_0x20f296(0x180)](_0x20f296(0x18e),JSON['stringify'](_0x1f7f8e,null,0x2)),loggerService_1['loggerService'][_0x20f296(0x1de)](_0x20f296(0x197),_0x20f296(0x171),_0xc876bd[_0x20f296(0x1b8)],_0x1f7f8e,_0x353365);if(_0x1f7f8e[_0x20f296(0x1a3)]){const _0x4d5d14=_0x1f7f8e[_0x20f296(0x199)]||_0x1f7f8e[_0x20f296(0x1a3)]||_0x20f296(0x1d8);console['error'](_0x20f296(0x1c0)),console['error'](_0x20f296(0x1c6),_0x4d5d14),loggerService_1[_0x20f296(0x17d)][_0x20f296(0x18d)](_0x20f296(0x197),'/create','Business\x20Error:\x20'+_0x4d5d14);throw new Error(_0x20f296(0x1be)+_0x4d5d14);}if(!_0x1f7f8e['payment_url']||!_0x1f7f8e[_0x20f296(0x1ce)]){console[_0x20f296(0x1a3)](_0x20f296(0x1d4)),console['error'](_0x20f296(0x1e8)),console[_0x20f296(0x1a3)](_0x20f296(0x182),_0x1f7f8e),loggerService_1[_0x20f296(0x17d)]['logWhiteDomainError']('cointopay',_0x20f296(0x171),_0x20f296(0x190));throw new Error(_0x20f296(0x1d7));}return console[_0x20f296(0x180)](_0x20f296(0x1d3)),console['log'](_0x20f296(0x1a1),_0x1f7f8e[_0x20f296(0x1ce)]),console['log']('Payment\x20URL:',_0x1f7f8e[_0x20f296(0x183)]),console[_0x20f296(0x180)](_0x20f296(0x1cf),_0x2c0452,'EUR'),{'gateway_payment_id':_0x1f7f8e[_0x20f296(0x1ce)],'payment_url':_0x1f7f8e['payment_url']};}catch(_0x23acac){console[_0x20f296(0x1a3)](_0x20f296(0x1aa)),console[_0x20f296(0x1a3)](_0x20f296(0x19c),_0x23acac),loggerService_1[_0x20f296(0x17d)][_0x20f296(0x18d)](_0x20f296(0x197),_0x20f296(0x171),_0x23acac);if(_0x23acac instanceof Error){console['error'](_0x20f296(0x177),_0x23acac[_0x20f296(0x199)]),console[_0x20f296(0x1a3)]('Error\x20stack:',_0x23acac['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x23acac[_0x20f296(0x199)]);}throw new Error(_0x20f296(0x1c9));}}async[a46_0x2555eb(0x1c2)](_0x47cd03){const _0x318677=a46_0x2555eb,_0x2a57bd=Date[_0x318677(0x1e3)]();try{console[_0x318677(0x180)](_0x318677(0x170)+_0x47cd03);const _0x3e63f5={'gatewayPaymentId':_0x47cd03};loggerService_1[_0x318677(0x17d)][_0x318677(0x1d9)](_0x318677(0x197),_0x318677(0x193),'POST',_0x3e63f5);const _0x232e5c=await fetch(this[_0x318677(0x16f)],{'method':_0x318677(0x17c),'headers':{'Content-Type':'application/json','Accept':_0x318677(0x1bb),'User-Agent':_0x318677(0x1d1)},'body':JSON[_0x318677(0x1e7)](_0x3e63f5)}),_0x41bde0=Date[_0x318677(0x1e3)]()-_0x2a57bd;console[_0x318677(0x180)](_0x318677(0x1b7)),console[_0x318677(0x180)](_0x318677(0x1b9),_0x232e5c[_0x318677(0x1b8)]),console['log'](_0x318677(0x1c3),_0x41bde0+'ms');if(!_0x232e5c['ok']){const _0x576118=await _0x232e5c[_0x318677(0x175)]();console['error'](_0x318677(0x1a4),_0x232e5c['status']),console[_0x318677(0x1a3)]('Response\x20Body:',_0x576118),loggerService_1[_0x318677(0x17d)][_0x318677(0x1de)]('cointopay','/status',_0x232e5c[_0x318677(0x1b8)],_0x576118,_0x41bde0),loggerService_1['loggerService'][_0x318677(0x18d)](_0x318677(0x197),_0x318677(0x193),_0x318677(0x16c)+_0x232e5c[_0x318677(0x1b8)]+':\x20'+_0x576118);throw new Error('HTTP\x20error!\x20status:\x20'+_0x232e5c[_0x318677(0x1b8)]);}const _0x3a38e8=await _0x232e5c[_0x318677(0x175)]();console[_0x318677(0x180)](_0x318677(0x1a8),_0x3a38e8);let _0xd6ac1c;try{_0xd6ac1c=JSON['parse'](_0x3a38e8);}catch(_0x1c36ad){console[_0x318677(0x1a3)](_0x318677(0x1af),_0x1c36ad),loggerService_1[_0x318677(0x17d)][_0x318677(0x18d)](_0x318677(0x197),'/status',_0x318677(0x1c8)+_0x1c36ad);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x3a38e8);}loggerService_1[_0x318677(0x17d)]['logWhiteDomainResponse'](_0x318677(0x197),_0x318677(0x193),_0x232e5c[_0x318677(0x1b8)],_0xd6ac1c,_0x41bde0),console[_0x318677(0x180)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x318677(0x180)](_0x318677(0x1a0),_0xd6ac1c['result']),console[_0x318677(0x180)](_0x318677(0x189),_0xd6ac1c[_0x318677(0x194)]),console[_0x318677(0x180)]('Payment\x20Status:',_0xd6ac1c[_0x318677(0x19a)]?.['Status']),console[_0x318677(0x180)](_0x318677(0x1cf),_0xd6ac1c[_0x318677(0x19a)]?.[_0x318677(0x172)]),console[_0x318677(0x180)]('Currency:',_0xd6ac1c[_0x318677(0x19a)]?.['inputCurrency']);if(_0xd6ac1c[_0x318677(0x1dc)]!==_0x318677(0x173)||_0xd6ac1c[_0x318677(0x194)]!==0xc8){const _0x4202cb=_0xd6ac1c[_0x318677(0x199)]||_0x318677(0x1cb);console[_0x318677(0x1a3)](_0x318677(0x1b4)),console['error'](_0x318677(0x1c6),_0x4202cb),loggerService_1[_0x318677(0x17d)][_0x318677(0x18d)](_0x318677(0x197),'/status',_0x318677(0x1bd)+_0x4202cb);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x4202cb);}if(!_0xd6ac1c[_0x318677(0x19a)]){console[_0x318677(0x1a3)](_0x318677(0x18c)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError'](_0x318677(0x197),'/status',_0x318677(0x1a5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x161d2b=_0x318677(0x1a9);switch(_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x1b3)]?.['toLowerCase']()){case _0x318677(0x19d):_0x161d2b=_0x318677(0x1cc);break;case _0x318677(0x1df):case'failed':case _0x318677(0x1a3):_0x161d2b='FAILED';break;case _0x318677(0x18b):case _0x318677(0x1ac):_0x161d2b='EXPIRED';break;case'waiting':case _0x318677(0x1d2):case _0x318677(0x198):case _0x318677(0x1db):default:_0x161d2b='PENDING';break;}let _0x231b21,_0x4cc0bd;if(_0xd6ac1c[_0x318677(0x19a)]['PaymentDetail']){const _0x17f53f=_0xd6ac1c['data'][_0x318677(0x1bf)];console['log'](_0x318677(0x1a2),_0x17f53f);const _0x3a8a97=_0x17f53f[_0x318677(0x1da)](/IBAN\s+([A-Z0-9]+)/i);_0x3a8a97&&(_0x231b21=_0x3a8a97[0x1],console[_0x318677(0x180)]('üè¶\x20Extracted\x20IBAN:',_0x231b21)),_0x4cc0bd=_0x17f53f;}const _0x2ca85c={'iban':_0x231b21,'bankDetails':_0x4cc0bd,'transactionId':_0xd6ac1c[_0x318677(0x19a)]['TransactionID'],'coinAddress':_0xd6ac1c[_0x318677(0x19a)]['coinAddress'],'qrCodeUrl':_0xd6ac1c['data'][_0x318677(0x16d)],'expiryTime':_0xd6ac1c['data'][_0x318677(0x179)],'createdOn':_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x1b6)],'confirmedOn':_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x187)]};console[_0x318677(0x180)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x318677(0x180)](_0x318677(0x1b9),_0xd6ac1c['data'][_0x318677(0x1b3)],'->',_0x161d2b),console[_0x318677(0x180)]('Amount:',_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x172)],_0xd6ac1c['data'][_0x318677(0x1e4)]),console['log'](_0x318677(0x181),_0xd6ac1c[_0x318677(0x19a)]['TransactionID']),console[_0x318677(0x180)](_0x318677(0x1b1),_0x231b21||'not\x20found'),console[_0x318677(0x180)](_0x318677(0x1cd),_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x1b6)]),console[_0x318677(0x180)](_0x318677(0x188),_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x187)]||_0x318677(0x184));if(_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x1b3)]?.[_0x318677(0x1e2)]()===_0x318677(0x1d2))console[_0x318677(0x180)](_0x318677(0x186));else _0xd6ac1c['data'][_0x318677(0x1b3)]?.[_0x318677(0x1e2)]()===_0x318677(0x19d)&&console[_0x318677(0x180)](_0x318677(0x1e5));return{'status':_0x161d2b,'amount':parseFloat(_0xd6ac1c[_0x318677(0x19a)][_0x318677(0x172)])||undefined,'currency':_0xd6ac1c['data']['inputCurrency']||_0x318677(0x1e1),'paymentDetails':_0x2ca85c};}catch(_0x3192f3){console[_0x318677(0x1a3)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x3192f3),loggerService_1['loggerService'][_0x318677(0x18d)](_0x318677(0x197),_0x318677(0x193),_0x3192f3);throw new Error(_0x318677(0x1d6)+(_0x3192f3 instanceof Error?_0x3192f3[_0x318677(0x199)]:_0x318677(0x196)));}}async[a46_0x2555eb(0x1e6)](_0x34e420){const _0xb61203=a46_0x2555eb,_0x5305d2=await this['checkPaymentStatus'](_0x34e420);return{'status':_0x5305d2[_0xb61203(0x1b8)],'amount':_0x5305d2[_0xb61203(0x16b)],'currency':_0x5305d2[_0xb61203(0x16e)]};}async['processWebhook'](_0x7be26e){const _0x121065=a46_0x2555eb;console[_0x121065(0x180)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x7be26e);let _0x3b9319='PENDING';switch(_0x7be26e[_0x121065(0x1b8)]?.[_0x121065(0x1e2)]()){case _0x121065(0x19d):_0x3b9319=_0x121065(0x1cc);break;case _0x121065(0x1df):case'failed':case'error':_0x3b9319='FAILED';break;case'expired':case _0x121065(0x1ac):_0x3b9319=_0x121065(0x18a);break;case _0x121065(0x198):case _0x121065(0x1ca):case _0x121065(0x1d2):case _0x121065(0x1db):default:_0x3b9319=_0x121065(0x1a9);break;}return{'paymentId':_0x7be26e['order_id']||_0x7be26e['merchant_reference_id']||'','status':_0x3b9319,'amount':_0x7be26e['amount'],'currency':_0x7be26e[_0x121065(0x16e)]||_0x121065(0x1e1)};}}exports[a46_0x2555eb(0x178)]=CoinToPayService;