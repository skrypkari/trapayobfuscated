'use strict';function a38_0x315a(){const _0x35ff15=['success','94702feFMGa','logWhiteDomainError','Unknown\x20error','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','text','pending','statusUrl','logWhiteDomainRequest','10TiDkOZ','expired','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','TesSoft\x20Payment\x20System/1.0','5113157jmtNYg','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','cointopay','inputCurrency','Response\x20data:','Error\x20stack:','defineProperty','CoinToPayService','payment_url','EXPIRED','parse','8uzkbVZ','CoinToPay\x20API\x20error:\x20','36nNsGAU','headers','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','result','match','Currency:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Payment\x20Status:','checkPaymentStatus','merchant_reference_id','PaymentDetail','Payment\x20URL:','Error\x20Message:','../loggerService','JSON\x20Parse\x20Error:\x20','Amount','20741930jsmnzz','timeout','waiting','Response\x20Body:','Response\x20Time:','Status:','ðŸ“Š\x20Status\x20check\x20URL:','Created\x20On:','ðŸ¦\x20Payment\x20Detail:','created','loggerService','IBAN:','error','\x20EUR','577870VPvgxt','not\x20found','Confirmed\x20On:','message','status_code','Missing\x20data\x20in\x20response','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','TransactionID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','now','entries','application/json','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','HTTP\x20','POST','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','status','HTTP\x20Status:','URL:','2108844kXSneW','Status\x20Text:','ðŸ¦\x20Extracted\x20IBAN:','gateway_payment_id','Status','FAILED','fromEntries','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','690IACFJt','paid','Raw\x20Response\x20Body:','EUR','PENDING','Unknown\x20error\x20from\x20CoinToPay\x20API','log','toLowerCase','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Request\x20Body:','createPaymentLink','131517CtrQOZ','===\x20COINTOPAY\x20SUCCESS\x20===','stack','HTTP\x20error!\x20status:\x20','QRCodeURL','Error\x20message:','Incomplete\x20response:\x20missing\x20data','amount','/status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','data','stringify','Result:','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','2896122mVDkCJ','currency','PAID','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','failed',',\x20body:\x20','Status\x20Code:','logWhiteDomainResponse','Parsed\x20Result:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','/create','__esModule','statusText','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','apiUrl','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','TransactionConfirmedOn','awaiting\x20fiat','Amount:'];a38_0x315a=function(){return _0x35ff15;};return a38_0x315a();}const a38_0xa1e423=a38_0x5ba5;(function(_0x2f7c7f,_0x9f2e10){const _0x502851=a38_0x5ba5,_0x51fef9=_0x2f7c7f();while(!![]){try{const _0x317735=-parseInt(_0x502851(0x1cf))/0x1*(-parseInt(_0x502851(0x1c6))/0x2)+parseInt(_0x502851(0x1af))/0x3+-parseInt(_0x502851(0x157))/0x4*(-parseInt(_0x502851(0x175))/0x5)+parseInt(_0x502851(0x18c))/0x6+-parseInt(_0x502851(0x1d3))/0x7*(-parseInt(_0x502851(0x155))/0x8)+parseInt(_0x502851(0x19f))/0x9*(-parseInt(_0x502851(0x194))/0xa)+-parseInt(_0x502851(0x167))/0xb;if(_0x317735===_0x9f2e10)break;else _0x51fef9['push'](_0x51fef9['shift']());}catch(_0x2dd07a){_0x51fef9['push'](_0x51fef9['shift']());}}}(a38_0x315a,0xa2da8));Object[a38_0xa1e423(0x150)](exports,a38_0xa1e423(0x1bb),{'value':!![]}),exports[a38_0xa1e423(0x151)]=void 0x0;const loggerService_1=require(a38_0xa1e423(0x164));class CoinToPayService{constructor(){const _0x8088ae=a38_0xa1e423;this[_0x8088ae(0x1be)]=_0x8088ae(0x1c9),this[_0x8088ae(0x1cd)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x8088ae(0x1a9)),console['log'](_0x8088ae(0x16d),this[_0x8088ae(0x1cd)]);}async[a38_0xa1e423(0x19e)](_0x27cfe4){const _0x3e1fda=a38_0xa1e423,{orderId:_0x5c77b3,amount:_0x4e981d}=_0x27cfe4;console[_0x3e1fda(0x19a)](_0x3e1fda(0x159)+_0x4e981d+_0x3e1fda(0x174));const _0x57c45c={'amount':_0x4e981d},_0x156671=Date[_0x3e1fda(0x180)]();try{console[_0x3e1fda(0x19a)](_0x3e1fda(0x1bd)),console[_0x3e1fda(0x19a)](_0x3e1fda(0x18b),this['apiUrl']),console[_0x3e1fda(0x19a)](_0x3e1fda(0x19d),JSON[_0x3e1fda(0x1ab)](_0x57c45c,null,0x2)),console[_0x3e1fda(0x19a)](_0x3e1fda(0x1c4),_0x4e981d,_0x3e1fda(0x1c0)),loggerService_1['loggerService'][_0x3e1fda(0x1ce)]('cointopay',_0x3e1fda(0x1ba),_0x3e1fda(0x186),_0x57c45c);const _0x3e4e10=await fetch(this[_0x3e1fda(0x1be)],{'method':_0x3e1fda(0x186),'headers':{'Content-Type':_0x3e1fda(0x182),'Accept':_0x3e1fda(0x182),'User-Agent':_0x3e1fda(0x1d2)},'body':JSON[_0x3e1fda(0x1ab)](_0x57c45c)}),_0xf389a4=Date['now']()-_0x156671;console[_0x3e1fda(0x19a)](_0x3e1fda(0x1d1)),console[_0x3e1fda(0x19a)](_0x3e1fda(0x16c),_0x3e4e10['status']),console[_0x3e1fda(0x19a)](_0x3e1fda(0x18d),_0x3e4e10[_0x3e1fda(0x1bc)]),console['log']('Headers:',Object[_0x3e1fda(0x192)](_0x3e4e10[_0x3e1fda(0x158)][_0x3e1fda(0x181)]())),console['log'](_0x3e1fda(0x16b),_0xf389a4+'ms');const _0x3d50ad=await _0x3e4e10[_0x3e1fda(0x1cb)]();console[_0x3e1fda(0x19a)](_0x3e1fda(0x196),_0x3d50ad);if(!_0x3e4e10['ok']){console['error'](_0x3e1fda(0x1ae)),console[_0x3e1fda(0x173)]('HTTP\x20Status:',_0x3e4e10[_0x3e1fda(0x189)]),console['error'](_0x3e1fda(0x16a),_0x3d50ad),loggerService_1[_0x3e1fda(0x171)][_0x3e1fda(0x1b7)]('cointopay',_0x3e1fda(0x1ba),_0x3e4e10[_0x3e1fda(0x189)],_0x3d50ad,_0xf389a4),loggerService_1[_0x3e1fda(0x171)][_0x3e1fda(0x1c7)](_0x3e1fda(0x14c),_0x3e1fda(0x1ba),_0x3e1fda(0x185)+_0x3e4e10['status']+':\x20'+_0x3d50ad);throw new Error(_0x3e1fda(0x1a2)+_0x3e4e10['status']+_0x3e1fda(0x1b5)+_0x3d50ad);}let _0xf3c76f;try{_0xf3c76f=JSON['parse'](_0x3d50ad);}catch(_0x56b119){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x56b119),loggerService_1[_0x3e1fda(0x171)]['logWhiteDomainError'](_0x3e1fda(0x14c),'/create','JSON\x20Parse\x20Error:\x20'+_0x56b119);throw new Error(_0x3e1fda(0x183)+_0x3d50ad);}console['log'](_0x3e1fda(0x1c1)),console['log'](_0x3e1fda(0x1b8),JSON[_0x3e1fda(0x1ab)](_0xf3c76f,null,0x2)),loggerService_1['loggerService'][_0x3e1fda(0x1b7)](_0x3e1fda(0x14c),'/create',_0x3e4e10[_0x3e1fda(0x189)],_0xf3c76f,_0xf389a4);if(_0xf3c76f[_0x3e1fda(0x173)]){const _0x549eb4=_0xf3c76f[_0x3e1fda(0x178)]||_0xf3c76f[_0x3e1fda(0x173)]||_0x3e1fda(0x199);console['error'](_0x3e1fda(0x1ca)),console['error'](_0x3e1fda(0x163),_0x549eb4),loggerService_1[_0x3e1fda(0x171)][_0x3e1fda(0x1c7)]('cointopay','/create','Business\x20Error:\x20'+_0x549eb4);throw new Error(_0x3e1fda(0x156)+_0x549eb4);}if(!_0xf3c76f['payment_url']||!_0xf3c76f[_0x3e1fda(0x18f)]){console['error'](_0x3e1fda(0x1a8)),console[_0x3e1fda(0x173)](_0x3e1fda(0x1b9)),console[_0x3e1fda(0x173)](_0x3e1fda(0x14e),_0xf3c76f),loggerService_1[_0x3e1fda(0x171)][_0x3e1fda(0x1c7)]('cointopay',_0x3e1fda(0x1ba),_0x3e1fda(0x15d));throw new Error(_0x3e1fda(0x17e));}return console['log'](_0x3e1fda(0x1a0)),console[_0x3e1fda(0x19a)]('Gateway\x20Payment\x20ID:',_0xf3c76f[_0x3e1fda(0x18f)]),console['log'](_0x3e1fda(0x162),_0xf3c76f[_0x3e1fda(0x152)]),console[_0x3e1fda(0x19a)](_0x3e1fda(0x1c4),_0x4e981d,'EUR'),{'gateway_payment_id':_0xf3c76f[_0x3e1fda(0x18f)],'payment_url':_0xf3c76f[_0x3e1fda(0x152)]};}catch(_0xe757b1){console['error'](_0x3e1fda(0x17f)),console['error']('Error\x20details:',_0xe757b1),loggerService_1['loggerService'][_0x3e1fda(0x1c7)](_0x3e1fda(0x14c),_0x3e1fda(0x1ba),_0xe757b1);if(_0xe757b1 instanceof Error){console[_0x3e1fda(0x173)](_0x3e1fda(0x1a4),_0xe757b1['message']),console[_0x3e1fda(0x173)](_0x3e1fda(0x14f),_0xe757b1[_0x3e1fda(0x1a1)]);throw new Error(_0x3e1fda(0x193)+_0xe757b1[_0x3e1fda(0x178)]);}throw new Error(_0x3e1fda(0x184));}}async[a38_0xa1e423(0x15f)](_0x3557c8){const _0x2215d0=a38_0xa1e423,_0x3d3c6d=Date[_0x2215d0(0x180)]();try{console[_0x2215d0(0x19a)](_0x2215d0(0x17b)+_0x3557c8);const _0x1b1124={'gatewayPaymentId':_0x3557c8};loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1ce)]('cointopay',_0x2215d0(0x1a7),_0x2215d0(0x186),_0x1b1124);const _0x291b37=await fetch(this[_0x2215d0(0x1cd)],{'method':_0x2215d0(0x186),'headers':{'Content-Type':_0x2215d0(0x182),'Accept':_0x2215d0(0x182),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2215d0(0x1ab)](_0x1b1124)}),_0x7714ac=Date[_0x2215d0(0x180)]()-_0x3d3c6d;console[_0x2215d0(0x19a)](_0x2215d0(0x1b2)),console[_0x2215d0(0x19a)](_0x2215d0(0x16c),_0x291b37[_0x2215d0(0x189)]),console[_0x2215d0(0x19a)](_0x2215d0(0x16b),_0x7714ac+'ms');if(!_0x291b37['ok']){const _0x1b76e1=await _0x291b37[_0x2215d0(0x1cb)]();console[_0x2215d0(0x173)](_0x2215d0(0x18a),_0x291b37[_0x2215d0(0x189)]),console[_0x2215d0(0x173)](_0x2215d0(0x16a),_0x1b76e1),loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1b7)](_0x2215d0(0x14c),_0x2215d0(0x1a7),_0x291b37[_0x2215d0(0x189)],_0x1b76e1,_0x7714ac),loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1c7)](_0x2215d0(0x14c),_0x2215d0(0x1a7),_0x2215d0(0x185)+_0x291b37[_0x2215d0(0x189)]+':\x20'+_0x1b76e1);throw new Error('HTTP\x20error!\x20status:\x20'+_0x291b37[_0x2215d0(0x189)]);}const _0x3d047e=await _0x291b37['text']();console['log'](_0x2215d0(0x196),_0x3d047e);let _0x518b87;try{_0x518b87=JSON[_0x2215d0(0x154)](_0x3d047e);}catch(_0x4010fc){console[_0x2215d0(0x173)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4010fc),loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1c7)]('cointopay',_0x2215d0(0x1a7),_0x2215d0(0x165)+_0x4010fc);throw new Error(_0x2215d0(0x17c)+_0x3d047e);}loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1b7)]('cointopay',_0x2215d0(0x1a7),_0x291b37[_0x2215d0(0x189)],_0x518b87,_0x7714ac),console[_0x2215d0(0x19a)](_0x2215d0(0x188)),console[_0x2215d0(0x19a)](_0x2215d0(0x1ac),_0x518b87[_0x2215d0(0x15a)]),console[_0x2215d0(0x19a)](_0x2215d0(0x1b6),_0x518b87[_0x2215d0(0x179)]),console[_0x2215d0(0x19a)](_0x2215d0(0x15e),_0x518b87[_0x2215d0(0x1aa)]?.['Status']),console[_0x2215d0(0x19a)]('Amount:',_0x518b87[_0x2215d0(0x1aa)]?.[_0x2215d0(0x166)]),console[_0x2215d0(0x19a)](_0x2215d0(0x15c),_0x518b87[_0x2215d0(0x1aa)]?.['inputCurrency']);if(_0x518b87['result']!==_0x2215d0(0x1c5)||_0x518b87[_0x2215d0(0x179)]!==0xc8){const _0x2ac3f6=_0x518b87[_0x2215d0(0x178)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x2215d0(0x173)](_0x2215d0(0x1b3)),console[_0x2215d0(0x173)](_0x2215d0(0x163),_0x2ac3f6),loggerService_1[_0x2215d0(0x171)]['logWhiteDomainError']('cointopay','/status','Status\x20API\x20Error:\x20'+_0x2ac3f6);throw new Error(_0x2215d0(0x1ad)+_0x2ac3f6);}if(!_0x518b87[_0x2215d0(0x1aa)]){console[_0x2215d0(0x173)](_0x2215d0(0x19c)),console[_0x2215d0(0x173)](_0x2215d0(0x17a)),loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1c7)]('cointopay','/status',_0x2215d0(0x1a5));throw new Error(_0x2215d0(0x1bf));}let _0x583461=_0x2215d0(0x198);switch(_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x190)]?.[_0x2215d0(0x19b)]()){case'paid':_0x583461=_0x2215d0(0x1b1);break;case'cancelled':case'failed':case _0x2215d0(0x173):_0x583461='FAILED';break;case _0x2215d0(0x1d0):case _0x2215d0(0x168):_0x583461='EXPIRED';break;case'waiting':case _0x2215d0(0x1c3):case _0x2215d0(0x1cc):case _0x2215d0(0x170):default:_0x583461=_0x2215d0(0x198);break;}let _0x2a03a6,_0x1ca6b0;if(_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x161)]){const _0x412f1b=_0x518b87[_0x2215d0(0x1aa)]['PaymentDetail'];console[_0x2215d0(0x19a)](_0x2215d0(0x16f),_0x412f1b);const _0x16253a=_0x412f1b[_0x2215d0(0x15b)](/IBAN\s+([A-Z0-9]+)/i);_0x16253a&&(_0x2a03a6=_0x16253a[0x1],console[_0x2215d0(0x19a)](_0x2215d0(0x18e),_0x2a03a6)),_0x1ca6b0=_0x412f1b;}const _0x27509c={'iban':_0x2a03a6,'bankDetails':_0x1ca6b0,'transactionId':_0x518b87['data'][_0x2215d0(0x17d)],'coinAddress':_0x518b87[_0x2215d0(0x1aa)]['coinAddress'],'qrCodeUrl':_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x1a3)],'expiryTime':_0x518b87[_0x2215d0(0x1aa)]['ExpiryTime'],'createdOn':_0x518b87[_0x2215d0(0x1aa)]['CreatedOn'],'confirmedOn':_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x1c2)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x2215d0(0x19a)]('Status:',_0x518b87['data'][_0x2215d0(0x190)],'->',_0x583461),console[_0x2215d0(0x19a)](_0x2215d0(0x1c4),_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x166)],_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x14d)]),console['log']('Transaction\x20ID:',_0x518b87[_0x2215d0(0x1aa)]['TransactionID']),console['log'](_0x2215d0(0x172),_0x2a03a6||_0x2215d0(0x176)),console['log'](_0x2215d0(0x16e),_0x518b87[_0x2215d0(0x1aa)]['CreatedOn']),console[_0x2215d0(0x19a)](_0x2215d0(0x177),_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x1c2)]||'not\x20confirmed');if(_0x518b87['data'][_0x2215d0(0x190)]?.[_0x2215d0(0x19b)]()==='awaiting\x20fiat')console[_0x2215d0(0x19a)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x518b87['data'][_0x2215d0(0x190)]?.[_0x2215d0(0x19b)]()===_0x2215d0(0x195)&&console[_0x2215d0(0x19a)](_0x2215d0(0x187));return{'status':_0x583461,'amount':parseFloat(_0x518b87[_0x2215d0(0x1aa)][_0x2215d0(0x166)])||undefined,'currency':_0x518b87[_0x2215d0(0x1aa)]['inputCurrency']||_0x2215d0(0x197),'paymentDetails':_0x27509c};}catch(_0x37437a){console[_0x2215d0(0x173)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x37437a),loggerService_1[_0x2215d0(0x171)][_0x2215d0(0x1c7)]('cointopay','/status',_0x37437a);throw new Error(_0x2215d0(0x14b)+(_0x37437a instanceof Error?_0x37437a[_0x2215d0(0x178)]:_0x2215d0(0x1c8)));}}async['verifyPayment'](_0x43fadb){const _0x179bc6=a38_0xa1e423,_0x1c4690=await this['checkPaymentStatus'](_0x43fadb);return{'status':_0x1c4690[_0x179bc6(0x189)],'amount':_0x1c4690[_0x179bc6(0x1a6)],'currency':_0x1c4690[_0x179bc6(0x1b0)]};}async['processWebhook'](_0x3fd80c){const _0x112af5=a38_0xa1e423;console[_0x112af5(0x19a)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x3fd80c);let _0xf3e629=_0x112af5(0x198);switch(_0x3fd80c[_0x112af5(0x189)]?.[_0x112af5(0x19b)]()){case _0x112af5(0x195):_0xf3e629=_0x112af5(0x1b1);break;case'cancelled':case _0x112af5(0x1b4):case _0x112af5(0x173):_0xf3e629=_0x112af5(0x191);break;case'expired':case _0x112af5(0x168):_0xf3e629=_0x112af5(0x153);break;case _0x112af5(0x1cc):case _0x112af5(0x169):case _0x112af5(0x1c3):case _0x112af5(0x170):default:_0xf3e629=_0x112af5(0x198);break;}return{'paymentId':_0x3fd80c['order_id']||_0x3fd80c[_0x112af5(0x160)]||'','status':_0xf3e629,'amount':_0x3fd80c[_0x112af5(0x1a6)],'currency':_0x3fd80c['currency']||_0x112af5(0x197)};}}function a38_0x5ba5(_0x16ccfe,_0x37420d){const _0x315a8c=a38_0x315a();return a38_0x5ba5=function(_0x5ba53a,_0x131d28){_0x5ba53a=_0x5ba53a-0x14b;let _0x2ff9b2=_0x315a8c[_0x5ba53a];return _0x2ff9b2;},a38_0x5ba5(_0x16ccfe,_0x37420d);}exports['CoinToPayService']=CoinToPayService;