'use strict';const a38_0x4bd4ba=a38_0x2266;(function(_0x876034,_0x4da921){const _0x3cd8b0=a38_0x2266,_0x392590=_0x876034();while(!![]){try{const _0x4576e2=-parseInt(_0x3cd8b0(0x143))/0x1*(-parseInt(_0x3cd8b0(0x126))/0x2)+-parseInt(_0x3cd8b0(0x112))/0x3+-parseInt(_0x3cd8b0(0x115))/0x4*(-parseInt(_0x3cd8b0(0x153))/0x5)+parseInt(_0x3cd8b0(0x12c))/0x6*(-parseInt(_0x3cd8b0(0x131))/0x7)+-parseInt(_0x3cd8b0(0x179))/0x8+-parseInt(_0x3cd8b0(0x12b))/0x9*(parseInt(_0x3cd8b0(0x16c))/0xa)+-parseInt(_0x3cd8b0(0x132))/0xb*(-parseInt(_0x3cd8b0(0x163))/0xc);if(_0x4576e2===_0x4da921)break;else _0x392590['push'](_0x392590['shift']());}catch(_0x1ccd7c){_0x392590['push'](_0x392590['shift']());}}}(a38_0x5924,0x761cf));function a38_0x2266(_0x1c4bb7,_0x33f375){const _0x592496=a38_0x5924();return a38_0x2266=function(_0x226660,_0x263541){_0x226660=_0x226660-0x100;let _0x4e4590=_0x592496[_0x226660];return _0x4e4590;},a38_0x2266(_0x1c4bb7,_0x33f375);}Object[a38_0x4bd4ba(0x162)](exports,a38_0x4bd4ba(0x14a),{'value':!![]}),exports[a38_0x4bd4ba(0x173)]=void 0x0;const loggerService_1=require(a38_0x4bd4ba(0x152));class CoinToPayService{constructor(){const _0x4b246a=a38_0x4bd4ba;this[_0x4b246a(0x167)]=_0x4b246a(0x156),this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x4b246a(0x10e)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x4b246a(0x148),this[_0x4b246a(0x16f)]);}async[a38_0x4bd4ba(0x106)](_0x38a029){const _0x1b38c7=a38_0x4bd4ba,{orderId:_0x36a699,amount:_0x3df7aa}=_0x38a029;console[_0x1b38c7(0x10e)](_0x1b38c7(0x17f)+_0x3df7aa+_0x1b38c7(0x101));const _0x3e5f9f={'amount':_0x3df7aa},_0xa7878e=Date[_0x1b38c7(0x129)]();try{console[_0x1b38c7(0x10e)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1b38c7(0x10e)](_0x1b38c7(0x128),this['apiUrl']),console[_0x1b38c7(0x10e)](_0x1b38c7(0x139),JSON['stringify'](_0x3e5f9f,null,0x2)),console[_0x1b38c7(0x10e)](_0x1b38c7(0x150),_0x3df7aa,_0x1b38c7(0x136)),loggerService_1[_0x1b38c7(0x12d)][_0x1b38c7(0x182)](_0x1b38c7(0x14e),_0x1b38c7(0x11d),_0x1b38c7(0x118),_0x3e5f9f);const _0x22882c=await fetch(this[_0x1b38c7(0x167)],{'method':_0x1b38c7(0x118),'headers':{'Content-Type':_0x1b38c7(0x138),'Accept':'application/json','User-Agent':_0x1b38c7(0x177)},'body':JSON[_0x1b38c7(0x178)](_0x3e5f9f)}),_0x4fa667=Date['now']()-_0xa7878e;console[_0x1b38c7(0x10e)](_0x1b38c7(0x15c)),console[_0x1b38c7(0x10e)](_0x1b38c7(0x110),_0x22882c[_0x1b38c7(0x184)]),console['log'](_0x1b38c7(0x11b),_0x22882c[_0x1b38c7(0x161)]),console[_0x1b38c7(0x10e)]('Headers:',Object[_0x1b38c7(0x169)](_0x22882c[_0x1b38c7(0x127)]['entries']())),console['log'](_0x1b38c7(0x155),_0x4fa667+'ms');const _0x3a28b5=await _0x22882c[_0x1b38c7(0x141)]();console[_0x1b38c7(0x10e)](_0x1b38c7(0x15f),_0x3a28b5);if(!_0x22882c['ok']){console[_0x1b38c7(0x108)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x1b38c7(0x108)](_0x1b38c7(0x120),_0x22882c[_0x1b38c7(0x184)]),console['error']('Response\x20Body:',_0x3a28b5),loggerService_1['loggerService'][_0x1b38c7(0x171)]('cointopay','/create',_0x22882c['status'],_0x3a28b5,_0x4fa667),loggerService_1['loggerService'][_0x1b38c7(0x12e)](_0x1b38c7(0x14e),_0x1b38c7(0x11d),_0x1b38c7(0x13c)+_0x22882c[_0x1b38c7(0x184)]+':\x20'+_0x3a28b5);throw new Error(_0x1b38c7(0x125)+_0x22882c[_0x1b38c7(0x184)]+',\x20body:\x20'+_0x3a28b5);}let _0x21148b;try{_0x21148b=JSON['parse'](_0x3a28b5);}catch(_0x474d24){console['error'](_0x1b38c7(0x11e),_0x474d24),loggerService_1[_0x1b38c7(0x12d)][_0x1b38c7(0x12e)](_0x1b38c7(0x14e),_0x1b38c7(0x11d),'JSON\x20Parse\x20Error:\x20'+_0x474d24);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3a28b5);}console[_0x1b38c7(0x10e)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x1b38c7(0x10e)](_0x1b38c7(0x16e),JSON[_0x1b38c7(0x178)](_0x21148b,null,0x2)),loggerService_1[_0x1b38c7(0x12d)][_0x1b38c7(0x171)]('cointopay',_0x1b38c7(0x11d),_0x22882c[_0x1b38c7(0x184)],_0x21148b,_0x4fa667);if(_0x21148b[_0x1b38c7(0x108)]){const _0x329739=_0x21148b[_0x1b38c7(0x14b)]||_0x21148b[_0x1b38c7(0x108)]||_0x1b38c7(0x102);console[_0x1b38c7(0x108)](_0x1b38c7(0x166)),console['error'](_0x1b38c7(0x107),_0x329739),loggerService_1['loggerService'][_0x1b38c7(0x12e)]('cointopay',_0x1b38c7(0x11d),_0x1b38c7(0x14c)+_0x329739);throw new Error(_0x1b38c7(0x13f)+_0x329739);}if(!_0x21148b[_0x1b38c7(0x186)]||!_0x21148b[_0x1b38c7(0x121)]){console[_0x1b38c7(0x108)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1b38c7(0x108)](_0x1b38c7(0x16d)),console[_0x1b38c7(0x108)](_0x1b38c7(0x172),_0x21148b),loggerService_1[_0x1b38c7(0x12d)][_0x1b38c7(0x12e)]('cointopay',_0x1b38c7(0x11d),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1b38c7(0x140));}return console[_0x1b38c7(0x10e)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x1b38c7(0x10e)](_0x1b38c7(0x15b),_0x21148b[_0x1b38c7(0x121)]),console[_0x1b38c7(0x10e)](_0x1b38c7(0x135),_0x21148b[_0x1b38c7(0x186)]),console[_0x1b38c7(0x10e)]('Amount:',_0x3df7aa,_0x1b38c7(0x10b)),{'gateway_payment_id':_0x21148b[_0x1b38c7(0x121)],'payment_url':_0x21148b[_0x1b38c7(0x186)]};}catch(_0x4d752e){console[_0x1b38c7(0x108)](_0x1b38c7(0x168)),console[_0x1b38c7(0x108)](_0x1b38c7(0x117),_0x4d752e),loggerService_1['loggerService'][_0x1b38c7(0x12e)](_0x1b38c7(0x14e),_0x1b38c7(0x11d),_0x4d752e);if(_0x4d752e instanceof Error){console[_0x1b38c7(0x108)](_0x1b38c7(0x17a),_0x4d752e[_0x1b38c7(0x14b)]),console['error']('Error\x20stack:',_0x4d752e['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x4d752e['message']);}throw new Error(_0x1b38c7(0x116));}}async[a38_0x4bd4ba(0x154)](_0x46f623){const _0x558ce8=a38_0x4bd4ba,_0x14f4a5=Date[_0x558ce8(0x129)]();try{console[_0x558ce8(0x10e)](_0x558ce8(0x114)+_0x46f623);const _0x49e288={'gatewayPaymentId':_0x46f623};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x558ce8(0x185),'POST',_0x49e288);const _0x5b6bbe=await fetch(this[_0x558ce8(0x16f)],{'method':'POST','headers':{'Content-Type':_0x558ce8(0x138),'Accept':'application/json','User-Agent':_0x558ce8(0x177)},'body':JSON[_0x558ce8(0x178)](_0x49e288)}),_0x557b2e=Date[_0x558ce8(0x129)]()-_0x14f4a5;console[_0x558ce8(0x10e)](_0x558ce8(0x13e)),console[_0x558ce8(0x10e)](_0x558ce8(0x110),_0x5b6bbe[_0x558ce8(0x184)]),console[_0x558ce8(0x10e)](_0x558ce8(0x155),_0x557b2e+'ms');if(!_0x5b6bbe['ok']){const _0x1adf28=await _0x5b6bbe['text']();console['error'](_0x558ce8(0x120),_0x5b6bbe[_0x558ce8(0x184)]),console[_0x558ce8(0x108)](_0x558ce8(0x16a),_0x1adf28),loggerService_1[_0x558ce8(0x12d)][_0x558ce8(0x171)](_0x558ce8(0x14e),_0x558ce8(0x185),_0x5b6bbe['status'],_0x1adf28,_0x557b2e),loggerService_1[_0x558ce8(0x12d)][_0x558ce8(0x12e)](_0x558ce8(0x14e),_0x558ce8(0x185),_0x558ce8(0x13c)+_0x5b6bbe[_0x558ce8(0x184)]+':\x20'+_0x1adf28);throw new Error(_0x558ce8(0x125)+_0x5b6bbe[_0x558ce8(0x184)]);}const _0x5840c4=await _0x5b6bbe['text']();console[_0x558ce8(0x10e)](_0x558ce8(0x15f),_0x5840c4);let _0xc74234;try{_0xc74234=JSON[_0x558ce8(0x183)](_0x5840c4);}catch(_0x28106e){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x28106e),loggerService_1[_0x558ce8(0x12d)]['logWhiteDomainError'](_0x558ce8(0x14e),_0x558ce8(0x185),_0x558ce8(0x149)+_0x28106e);throw new Error(_0x558ce8(0x11f)+_0x5840c4);}loggerService_1[_0x558ce8(0x12d)]['logWhiteDomainResponse'](_0x558ce8(0x14e),_0x558ce8(0x185),_0x5b6bbe[_0x558ce8(0x184)],_0xc74234,_0x557b2e),console[_0x558ce8(0x10e)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x558ce8(0x10e)](_0x558ce8(0x13b),_0xc74234[_0x558ce8(0x146)]),console[_0x558ce8(0x10e)](_0x558ce8(0x181),_0xc74234['status_code']),console[_0x558ce8(0x10e)](_0x558ce8(0x170),_0xc74234['data']?.[_0x558ce8(0x105)]),console[_0x558ce8(0x10e)](_0x558ce8(0x150),_0xc74234['data']?.[_0x558ce8(0x147)]),console[_0x558ce8(0x10e)](_0x558ce8(0x16b),_0xc74234[_0x558ce8(0x187)]?.[_0x558ce8(0x122)]);if(_0xc74234['result']!==_0x558ce8(0x145)||_0xc74234[_0x558ce8(0x137)]!==0xc8){const _0xc8503d=_0xc74234[_0x558ce8(0x14b)]||_0x558ce8(0x113);console[_0x558ce8(0x108)](_0x558ce8(0x12f)),console[_0x558ce8(0x108)](_0x558ce8(0x107),_0xc8503d),loggerService_1[_0x558ce8(0x12d)][_0x558ce8(0x12e)](_0x558ce8(0x14e),'/status',_0x558ce8(0x15e)+_0xc8503d);throw new Error(_0x558ce8(0x175)+_0xc8503d);}if(!_0xc74234[_0x558ce8(0x187)]){console[_0x558ce8(0x108)](_0x558ce8(0x165)),console[_0x558ce8(0x108)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x558ce8(0x12e)](_0x558ce8(0x14e),_0x558ce8(0x185),_0x558ce8(0x119));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x54f27b=_0x558ce8(0x144);switch(_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x105)]?.['toLowerCase']()){case _0x558ce8(0x10d):_0x54f27b=_0x558ce8(0x13d);break;case'cancelled':case _0x558ce8(0x10a):case _0x558ce8(0x108):_0x54f27b=_0x558ce8(0x17e);break;case _0x558ce8(0x160):case _0x558ce8(0x10c):_0x54f27b=_0x558ce8(0x159);break;case _0x558ce8(0x142):case'awaiting\x20fiat':case'pending':case _0x558ce8(0x124):default:_0x54f27b='PENDING';break;}let _0x278795,_0x27cb2e;if(_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x123)]){const _0x5bb7a5=_0xc74234['data'][_0x558ce8(0x123)];console[_0x558ce8(0x10e)](_0x558ce8(0x151),_0x5bb7a5);const _0x32ed0e=_0x5bb7a5[_0x558ce8(0x17d)](/IBAN\s+([A-Z0-9]+)/i);_0x32ed0e&&(_0x278795=_0x32ed0e[0x1],console['log'](_0x558ce8(0x109),_0x278795)),_0x27cb2e=_0x5bb7a5;}const _0x3ef0b9={'iban':_0x278795,'bankDetails':_0x27cb2e,'transactionId':_0xc74234[_0x558ce8(0x187)]['TransactionID'],'coinAddress':_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x13a)],'qrCodeUrl':_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x104)],'expiryTime':_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x17b)],'createdOn':_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x133)],'confirmedOn':_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x100)]};console[_0x558ce8(0x10e)](_0x558ce8(0x103)),console[_0x558ce8(0x10e)]('Status:',_0xc74234['data'][_0x558ce8(0x105)],'->',_0x54f27b),console[_0x558ce8(0x10e)]('Amount:',_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x147)],_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x122)]),console[_0x558ce8(0x10e)]('Transaction\x20ID:',_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x14d)]),console['log']('IBAN:',_0x278795||_0x558ce8(0x130)),console['log'](_0x558ce8(0x158),_0xc74234['data'][_0x558ce8(0x133)]),console[_0x558ce8(0x10e)]('Confirmed\x20On:',_0xc74234[_0x558ce8(0x187)]['TransactionConfirmedOn']||_0x558ce8(0x10f));if(_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x105)]?.[_0x558ce8(0x11a)]()===_0x558ce8(0x111))console[_0x558ce8(0x10e)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xc74234[_0x558ce8(0x187)][_0x558ce8(0x105)]?.['toLowerCase']()===_0x558ce8(0x10d)&&console['log'](_0x558ce8(0x12a));return{'status':_0x54f27b,'amount':parseFloat(_0xc74234[_0x558ce8(0x187)][_0x558ce8(0x147)])||undefined,'currency':_0xc74234[_0x558ce8(0x187)]['inputCurrency']||_0x558ce8(0x10b),'paymentDetails':_0x3ef0b9};}catch(_0xdeb424){console['error'](_0x558ce8(0x157),_0xdeb424),loggerService_1[_0x558ce8(0x12d)][_0x558ce8(0x12e)](_0x558ce8(0x14e),_0x558ce8(0x185),_0xdeb424);throw new Error(_0x558ce8(0x17c)+(_0xdeb424 instanceof Error?_0xdeb424['message']:_0x558ce8(0x11c)));}}async[a38_0x4bd4ba(0x180)](_0x41a071){const _0x52ee0e=a38_0x4bd4ba,_0x39cc59=await this[_0x52ee0e(0x154)](_0x41a071);return{'status':_0x39cc59[_0x52ee0e(0x184)],'amount':_0x39cc59[_0x52ee0e(0x14f)],'currency':_0x39cc59[_0x52ee0e(0x174)]};}async[a38_0x4bd4ba(0x164)](_0x420c57){const _0x2a9234=a38_0x4bd4ba;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x420c57);let _0x55161f='PENDING';switch(_0x420c57[_0x2a9234(0x184)]?.[_0x2a9234(0x11a)]()){case _0x2a9234(0x10d):_0x55161f=_0x2a9234(0x13d);break;case _0x2a9234(0x176):case _0x2a9234(0x10a):case _0x2a9234(0x108):_0x55161f=_0x2a9234(0x17e);break;case _0x2a9234(0x160):case _0x2a9234(0x10c):_0x55161f='EXPIRED';break;case _0x2a9234(0x134):case'waiting':case'awaiting\x20fiat':case'created':default:_0x55161f=_0x2a9234(0x144);break;}return{'paymentId':_0x420c57[_0x2a9234(0x15d)]||_0x420c57[_0x2a9234(0x15a)]||'','status':_0x55161f,'amount':_0x420c57[_0x2a9234(0x14f)],'currency':_0x420c57[_0x2a9234(0x174)]||'EUR'};}}exports[a38_0x4bd4ba(0x173)]=CoinToPayService;function a38_0x5924(){const _0x21abb5=['POST','Incomplete\x20response:\x20missing\x20data','toLowerCase','Status\x20Text:','Unknown\x20error','/create','Failed\x20to\x20parse\x20JSON\x20response:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20Status:','gateway_payment_id','inputCurrency','PaymentDetail','created','HTTP\x20error!\x20status:\x20','76llcbFN','headers','URL:','now','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','4581hrmpXf','6mcjCWh','loggerService','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','not\x20found','2640218FEqDMZ','6928647HvGyDp','CreatedOn','pending','Payment\x20URL:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','status_code','application/json','Request\x20Body:','coinAddress','Result:','HTTP\x20','PAID','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','text','waiting','15374CJHAxu','PENDING','success','result','Amount','üìä\x20Status\x20check\x20URL:','JSON\x20Parse\x20Error:\x20','__esModule','message','Business\x20Error:\x20','TransactionID','cointopay','amount','Amount:','üè¶\x20Payment\x20Detail:','../loggerService','5oPOHZq','checkPaymentStatus','Response\x20Time:','https://tesoft.uk/gateway/cointopay/','CoinToPay\x20payment\x20status\x20check\x20error:','Created\x20On:','EXPIRED','merchant_reference_id','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','order_id','Status\x20API\x20Error:\x20','Raw\x20Response\x20Body:','expired','statusText','defineProperty','12PMwIOe','processWebhook','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','apiUrl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','fromEntries','Response\x20Body:','Currency:','3110HPdmgl','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Parsed\x20Result:','statusUrl','Payment\x20Status:','logWhiteDomainResponse','Response\x20data:','CoinToPayService','currency','CoinToPay\x20status\x20API\x20error:\x20','cancelled','TesSoft\x20Payment\x20System/1.0','stringify','808192SWkPBT','Error\x20message:','ExpiryTime','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','match','FAILED','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','verifyPayment','Status\x20Code:','logWhiteDomainRequest','parse','status','/status','payment_url','data','TransactionConfirmedOn','\x20EUR','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','QRCodeURL','Status','createPaymentLink','Error\x20Message:','error','üè¶\x20Extracted\x20IBAN:','failed','EUR','timeout','paid','log','not\x20confirmed','Status:','awaiting\x20fiat','2197821nUniiO','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','2555224zAcNEJ','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Error\x20details:'];a38_0x5924=function(){return _0x21abb5;};return a38_0x5924();}