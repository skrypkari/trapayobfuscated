'use strict';function a46_0x4ada(){const _0x3b2223=['Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Gateway\x20Payment\x20ID:','now','gateway_payment_id','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','pending','480mKSehn','14870NvEMrW','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Error\x20stack:','97IUnUtd','Business\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','QRCodeURL','Amount:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Status:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','üìä\x20Status\x20check\x20URL:','Status\x20Text:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','created','Error\x20message:','/status','success','Transaction\x20ID:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','cointopay','Unknown\x20error','parse','Payment\x20Status:','Response\x20Time:','780695bhGohn','Unknown\x20error\x20from\x20CoinToPay\x20API','Result:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','merchant_reference_id','Confirmed\x20On:','defineProperty','üè¶\x20Extracted\x20IBAN:','FAILED','HTTP\x20Status:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','text','PENDING','status_code','inputCurrency','PAID','URL:','\x20EUR','order_id','expired','error','Payment\x20URL:','stringify','statusUrl','failed','11WfEdmM','match','JSON\x20Parse\x20Error:\x20','PaymentDetail','data','../loggerService','verifyPayment','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPay\x20status\x20API\x20error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','coinAddress','createPaymentLink','2684536kFtNSN','payment_url','not\x20confirmed','__esModule','18981IedWss','timeout','TransactionID','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Body:','HTTP\x20','Response\x20data:','/create','===\x20COINTOPAY\x20SUCCESS\x20===','üè¶\x20Payment\x20Detail:','Parsed\x20Result:','Failed\x20to\x20parse\x20JSON\x20response:','Raw\x20Response\x20Body:','paid','logWhiteDomainError','stack','CreatedOn','status','Incomplete\x20response:\x20missing\x20data','amount','EUR','statusText','Payment\x20System/1.0','processWebhook','logWhiteDomainResponse','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','checkPaymentStatus','Amount','https://tesoft.uk/gateway/cointopay/status.php','apiUrl','Status\x20Code:','30qAnGtK','166wNQPMj','11820960bTmIiK','toLowerCase','6995786AohKOb','TransactionConfirmedOn','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','fromEntries','CoinToPay\x20payment\x20status\x20check\x20error:',',\x20body:\x20','application/json','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','ExpiryTime','awaiting\x20fiat','log','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','not\x20found','cancelled','Currency:','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','loggerService','Headers:','27RSJNMg','result','message','Error\x20Message:','waiting','POST','===\x20COINTOPAY\x20API\x20ERROR\x20==='];a46_0x4ada=function(){return _0x3b2223;};return a46_0x4ada();}const a46_0x4f1d9e=a46_0xbb7e;function a46_0xbb7e(_0x524993,_0x24439f){const _0x4adafc=a46_0x4ada();return a46_0xbb7e=function(_0xbb7ee5,_0x1c899e){_0xbb7ee5=_0xbb7ee5-0x1d8;let _0x17d925=_0x4adafc[_0xbb7ee5];return _0x17d925;},a46_0xbb7e(_0x524993,_0x24439f);}(function(_0x2d295a,_0x4df704){const _0x1603e2=a46_0xbb7e,_0x3a32eb=_0x2d295a();while(!![]){try{const _0x5dda4d=-parseInt(_0x1603e2(0x253))/0x1*(parseInt(_0x1603e2(0x22b))/0x2)+parseInt(_0x1603e2(0x20a))/0x3*(parseInt(_0x1603e2(0x24f))/0x4)+-parseInt(_0x1603e2(0x1de))/0x5*(-parseInt(_0x1603e2(0x22a))/0x6)+parseInt(_0x1603e2(0x22e))/0x7+-parseInt(_0x1603e2(0x206))/0x8*(parseInt(_0x1603e2(0x242))/0x9)+parseInt(_0x1603e2(0x250))/0xa*(parseInt(_0x1603e2(0x1f7))/0xb)+-parseInt(_0x1603e2(0x22c))/0xc;if(_0x5dda4d===_0x4df704)break;else _0x3a32eb['push'](_0x3a32eb['shift']());}catch(_0x3bde62){_0x3a32eb['push'](_0x3a32eb['shift']());}}}(a46_0x4ada,0x8413c));Object[a46_0x4f1d9e(0x1e4)](exports,a46_0x4f1d9e(0x209),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a46_0x4f1d9e(0x1fc));class CoinToPayService{constructor(){const _0x5747e6=a46_0x4f1d9e;this[_0x5747e6(0x228)]='https://tesoft.uk/gateway/cointopay/',this[_0x5747e6(0x1f5)]=_0x5747e6(0x227),console[_0x5747e6(0x238)](_0x5747e6(0x24d)),console['log'](_0x5747e6(0x25c),this['statusUrl']);}async[a46_0x4f1d9e(0x205)](_0x331105){const _0x18c461=a46_0x4f1d9e,{orderId:_0x5bca7a,amount:_0x2fbb0a}=_0x331105;console['log'](_0x18c461(0x259)+_0x2fbb0a+_0x18c461(0x1ef));const _0x1be9b1={'amount':_0x2fbb0a},_0x38b7ca=Date['now']();try{console[_0x18c461(0x238)](_0x18c461(0x200)),console[_0x18c461(0x238)](_0x18c461(0x1ee),this['apiUrl']),console[_0x18c461(0x238)]('Request\x20Body:',JSON[_0x18c461(0x1f4)](_0x1be9b1,null,0x2)),console[_0x18c461(0x238)](_0x18c461(0x258),_0x2fbb0a,_0x18c461(0x25b)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x18c461(0x1d9),'/create',_0x18c461(0x247),_0x1be9b1);const _0x4bbd95=await fetch(this['apiUrl'],{'method':_0x18c461(0x247),'headers':{'Content-Type':_0x18c461(0x234),'Accept':_0x18c461(0x234),'User-Agent':_0x18c461(0x221)},'body':JSON[_0x18c461(0x1f4)](_0x1be9b1)}),_0x321214=Date[_0x18c461(0x24b)]()-_0x38b7ca;console[_0x18c461(0x238)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x18c461(0x238)](_0x18c461(0x25a),_0x4bbd95['status']),console[_0x18c461(0x238)](_0x18c461(0x25d),_0x4bbd95[_0x18c461(0x220)]),console[_0x18c461(0x238)](_0x18c461(0x241),Object[_0x18c461(0x231)](_0x4bbd95['headers']['entries']())),console[_0x18c461(0x238)](_0x18c461(0x1dd),_0x321214+'ms');const _0x4ba473=await _0x4bbd95['text']();console[_0x18c461(0x238)]('Raw\x20Response\x20Body:',_0x4ba473);if(!_0x4bbd95['ok']){console[_0x18c461(0x1f2)](_0x18c461(0x248)),console[_0x18c461(0x1f2)](_0x18c461(0x1e7),_0x4bbd95['status']),console[_0x18c461(0x1f2)](_0x18c461(0x20f),_0x4ba473),loggerService_1[_0x18c461(0x240)][_0x18c461(0x223)](_0x18c461(0x1d9),_0x18c461(0x212),_0x4bbd95[_0x18c461(0x21c)],_0x4ba473,_0x321214),loggerService_1[_0x18c461(0x240)][_0x18c461(0x219)](_0x18c461(0x1d9),_0x18c461(0x212),_0x18c461(0x210)+_0x4bbd95[_0x18c461(0x21c)]+':\x20'+_0x4ba473);throw new Error(_0x18c461(0x23d)+_0x4bbd95[_0x18c461(0x21c)]+_0x18c461(0x233)+_0x4ba473);}let _0x3f1e70;try{_0x3f1e70=JSON[_0x18c461(0x1db)](_0x4ba473);}catch(_0x1526a8){console[_0x18c461(0x1f2)](_0x18c461(0x216),_0x1526a8),loggerService_1[_0x18c461(0x240)][_0x18c461(0x219)](_0x18c461(0x1d9),_0x18c461(0x212),'JSON\x20Parse\x20Error:\x20'+_0x1526a8);throw new Error(_0x18c461(0x20e)+_0x4ba473);}console['log'](_0x18c461(0x224)),console[_0x18c461(0x238)](_0x18c461(0x215),JSON[_0x18c461(0x1f4)](_0x3f1e70,null,0x2)),loggerService_1[_0x18c461(0x240)][_0x18c461(0x223)](_0x18c461(0x1d9),_0x18c461(0x212),_0x4bbd95[_0x18c461(0x21c)],_0x3f1e70,_0x321214);if(_0x3f1e70[_0x18c461(0x1f2)]){const _0x1e54f6=_0x3f1e70[_0x18c461(0x244)]||_0x3f1e70[_0x18c461(0x1f2)]||_0x18c461(0x1df);console[_0x18c461(0x1f2)](_0x18c461(0x235)),console[_0x18c461(0x1f2)](_0x18c461(0x245),_0x1e54f6),loggerService_1[_0x18c461(0x240)]['logWhiteDomainError'](_0x18c461(0x1d9),_0x18c461(0x212),_0x18c461(0x254)+_0x1e54f6);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x1e54f6);}if(!_0x3f1e70[_0x18c461(0x207)]||!_0x3f1e70[_0x18c461(0x24c)]){console[_0x18c461(0x1f2)](_0x18c461(0x264)),console[_0x18c461(0x1f2)](_0x18c461(0x230)),console[_0x18c461(0x1f2)](_0x18c461(0x211),_0x3f1e70),loggerService_1[_0x18c461(0x240)][_0x18c461(0x219)](_0x18c461(0x1d9),_0x18c461(0x212),_0x18c461(0x203));throw new Error(_0x18c461(0x201));}return console[_0x18c461(0x238)](_0x18c461(0x213)),console[_0x18c461(0x238)](_0x18c461(0x24a),_0x3f1e70[_0x18c461(0x24c)]),console['log'](_0x18c461(0x1f3),_0x3f1e70[_0x18c461(0x207)]),console['log'](_0x18c461(0x258),_0x2fbb0a,_0x18c461(0x21f)),{'gateway_payment_id':_0x3f1e70[_0x18c461(0x24c)],'payment_url':_0x3f1e70[_0x18c461(0x207)]};}catch(_0x156680){console[_0x18c461(0x1f2)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x18c461(0x1f2)]('Error\x20details:',_0x156680),loggerService_1['loggerService'][_0x18c461(0x219)](_0x18c461(0x1d9),_0x18c461(0x212),_0x156680);if(_0x156680 instanceof Error){console[_0x18c461(0x1f2)](_0x18c461(0x260),_0x156680['message']),console[_0x18c461(0x1f2)](_0x18c461(0x252),_0x156680[_0x18c461(0x21a)]);throw new Error(_0x18c461(0x256)+_0x156680['message']);}throw new Error(_0x18c461(0x1fe));}}async['checkPaymentStatus'](_0xc2588d){const _0x35c1e7=a46_0x4f1d9e,_0x5a744b=Date[_0x35c1e7(0x24b)]();try{console[_0x35c1e7(0x238)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0xc2588d);const _0x1b2734={'gatewayPaymentId':_0xc2588d};loggerService_1[_0x35c1e7(0x240)]['logWhiteDomainRequest'](_0x35c1e7(0x1d9),_0x35c1e7(0x261),_0x35c1e7(0x247),_0x1b2734);const _0x2012ce=await fetch(this['statusUrl'],{'method':_0x35c1e7(0x247),'headers':{'Content-Type':_0x35c1e7(0x234),'Accept':'application/json','User-Agent':_0x35c1e7(0x221)},'body':JSON[_0x35c1e7(0x1f4)](_0x1b2734)}),_0x392e7=Date[_0x35c1e7(0x24b)]()-_0x5a744b;console[_0x35c1e7(0x238)](_0x35c1e7(0x23e)),console[_0x35c1e7(0x238)](_0x35c1e7(0x25a),_0x2012ce['status']),console[_0x35c1e7(0x238)](_0x35c1e7(0x1dd),_0x392e7+'ms');if(!_0x2012ce['ok']){const _0x396fc8=await _0x2012ce['text']();console['error'](_0x35c1e7(0x1e7),_0x2012ce[_0x35c1e7(0x21c)]),console[_0x35c1e7(0x1f2)](_0x35c1e7(0x20f),_0x396fc8),loggerService_1[_0x35c1e7(0x240)][_0x35c1e7(0x223)]('cointopay',_0x35c1e7(0x261),_0x2012ce[_0x35c1e7(0x21c)],_0x396fc8,_0x392e7),loggerService_1[_0x35c1e7(0x240)][_0x35c1e7(0x219)]('cointopay',_0x35c1e7(0x261),'HTTP\x20'+_0x2012ce[_0x35c1e7(0x21c)]+':\x20'+_0x396fc8);throw new Error(_0x35c1e7(0x23d)+_0x2012ce['status']);}const _0x536227=await _0x2012ce[_0x35c1e7(0x1e9)]();console['log'](_0x35c1e7(0x217),_0x536227);let _0x5315ef;try{_0x5315ef=JSON[_0x35c1e7(0x1db)](_0x536227);}catch(_0x5caba5){console[_0x35c1e7(0x1f2)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5caba5),loggerService_1[_0x35c1e7(0x240)][_0x35c1e7(0x219)](_0x35c1e7(0x1d9),_0x35c1e7(0x261),_0x35c1e7(0x1f9)+_0x5caba5);throw new Error(_0x35c1e7(0x1e1)+_0x536227);}loggerService_1[_0x35c1e7(0x240)][_0x35c1e7(0x223)](_0x35c1e7(0x1d9),_0x35c1e7(0x261),_0x2012ce[_0x35c1e7(0x21c)],_0x5315ef,_0x392e7),console[_0x35c1e7(0x238)](_0x35c1e7(0x239)),console[_0x35c1e7(0x238)](_0x35c1e7(0x1e0),_0x5315ef[_0x35c1e7(0x243)]),console[_0x35c1e7(0x238)](_0x35c1e7(0x229),_0x5315ef[_0x35c1e7(0x1eb)]),console[_0x35c1e7(0x238)](_0x35c1e7(0x1dc),_0x5315ef[_0x35c1e7(0x1fb)]?.[_0x35c1e7(0x1ff)]),console[_0x35c1e7(0x238)](_0x35c1e7(0x258),_0x5315ef[_0x35c1e7(0x1fb)]?.['Amount']),console[_0x35c1e7(0x238)](_0x35c1e7(0x23c),_0x5315ef[_0x35c1e7(0x1fb)]?.[_0x35c1e7(0x1ec)]);if(_0x5315ef[_0x35c1e7(0x243)]!==_0x35c1e7(0x262)||_0x5315ef[_0x35c1e7(0x1eb)]!==0xc8){const _0x4582b2=_0x5315ef[_0x35c1e7(0x244)]||_0x35c1e7(0x249);console[_0x35c1e7(0x1f2)](_0x35c1e7(0x20d)),console[_0x35c1e7(0x1f2)](_0x35c1e7(0x245),_0x4582b2),loggerService_1[_0x35c1e7(0x240)]['logWhiteDomainError'](_0x35c1e7(0x1d9),_0x35c1e7(0x261),'Status\x20API\x20Error:\x20'+_0x4582b2);throw new Error(_0x35c1e7(0x202)+_0x4582b2);}if(!_0x5315ef['data']){console['error'](_0x35c1e7(0x255)),console[_0x35c1e7(0x1f2)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService']['logWhiteDomainError'](_0x35c1e7(0x1d9),_0x35c1e7(0x261),_0x35c1e7(0x21d));throw new Error(_0x35c1e7(0x25e));}let _0x4222b7=_0x35c1e7(0x1ea);switch(_0x5315ef['data'][_0x35c1e7(0x1ff)]?.['toLowerCase']()){case _0x35c1e7(0x218):_0x4222b7=_0x35c1e7(0x1ed);break;case'cancelled':case _0x35c1e7(0x1f6):case'error':_0x4222b7=_0x35c1e7(0x1e6);break;case _0x35c1e7(0x1f1):case _0x35c1e7(0x20b):_0x4222b7='EXPIRED';break;case _0x35c1e7(0x246):case _0x35c1e7(0x237):case _0x35c1e7(0x24e):case'created':default:_0x4222b7=_0x35c1e7(0x1ea);break;}let _0x2589e3,_0x80aa56;if(_0x5315ef['data'][_0x35c1e7(0x1fa)]){const _0x2724de=_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x1fa)];console[_0x35c1e7(0x238)](_0x35c1e7(0x214),_0x2724de);const _0x7d81f3=_0x2724de[_0x35c1e7(0x1f8)](/IBAN\s+([A-Z0-9]+)/i);_0x7d81f3&&(_0x2589e3=_0x7d81f3[0x1],console[_0x35c1e7(0x238)](_0x35c1e7(0x1e5),_0x2589e3)),_0x80aa56=_0x2724de;}const _0x4f7c7c={'iban':_0x2589e3,'bankDetails':_0x80aa56,'transactionId':_0x5315ef['data'][_0x35c1e7(0x20c)],'coinAddress':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x204)],'qrCodeUrl':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x257)],'expiryTime':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x236)],'createdOn':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x21b)],'confirmedOn':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x22f)]};console[_0x35c1e7(0x238)](_0x35c1e7(0x1d8)),console[_0x35c1e7(0x238)]('Status:',_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x1ff)],'->',_0x4222b7),console['log'](_0x35c1e7(0x258),_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x226)],_0x5315ef[_0x35c1e7(0x1fb)]['inputCurrency']),console[_0x35c1e7(0x238)](_0x35c1e7(0x263),_0x5315ef['data'][_0x35c1e7(0x20c)]),console['log']('IBAN:',_0x2589e3||_0x35c1e7(0x23a)),console[_0x35c1e7(0x238)]('Created\x20On:',_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x21b)]),console[_0x35c1e7(0x238)](_0x35c1e7(0x1e3),_0x5315ef['data']['TransactionConfirmedOn']||_0x35c1e7(0x208));if(_0x5315ef['data'][_0x35c1e7(0x1ff)]?.['toLowerCase']()===_0x35c1e7(0x237))console['log'](_0x35c1e7(0x1e8));else _0x5315ef['data']['Status']?.[_0x35c1e7(0x22d)]()===_0x35c1e7(0x218)&&console[_0x35c1e7(0x238)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x4222b7,'amount':parseFloat(_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x226)])||undefined,'currency':_0x5315ef[_0x35c1e7(0x1fb)][_0x35c1e7(0x1ec)]||'EUR','paymentDetails':_0x4f7c7c};}catch(_0x56425b){console[_0x35c1e7(0x1f2)](_0x35c1e7(0x232),_0x56425b),loggerService_1[_0x35c1e7(0x240)][_0x35c1e7(0x219)]('cointopay',_0x35c1e7(0x261),_0x56425b);throw new Error(_0x35c1e7(0x251)+(_0x56425b instanceof Error?_0x56425b[_0x35c1e7(0x244)]:_0x35c1e7(0x1da)));}}async[a46_0x4f1d9e(0x1fd)](_0x34ad9c){const _0x5c9fcb=a46_0x4f1d9e,_0x1cedbd=await this[_0x5c9fcb(0x225)](_0x34ad9c);return{'status':_0x1cedbd[_0x5c9fcb(0x21c)],'amount':_0x1cedbd[_0x5c9fcb(0x21e)],'currency':_0x1cedbd['currency']};}async[a46_0x4f1d9e(0x222)](_0x13f882){const _0x199da1=a46_0x4f1d9e;console[_0x199da1(0x238)](_0x199da1(0x23f),_0x13f882);let _0x1c3bca='PENDING';switch(_0x13f882[_0x199da1(0x21c)]?.['toLowerCase']()){case'paid':_0x1c3bca='PAID';break;case _0x199da1(0x23b):case _0x199da1(0x1f6):case _0x199da1(0x1f2):_0x1c3bca=_0x199da1(0x1e6);break;case _0x199da1(0x1f1):case _0x199da1(0x20b):_0x1c3bca='EXPIRED';break;case _0x199da1(0x24e):case'waiting':case _0x199da1(0x237):case _0x199da1(0x25f):default:_0x1c3bca=_0x199da1(0x1ea);break;}return{'paymentId':_0x13f882[_0x199da1(0x1f0)]||_0x13f882[_0x199da1(0x1e2)]||'','status':_0x1c3bca,'amount':_0x13f882[_0x199da1(0x21e)],'currency':_0x13f882['currency']||'EUR'};}}exports['CoinToPayService']=CoinToPayService;