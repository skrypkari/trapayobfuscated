'use strict';const a40_0x308720=a40_0x2d58;(function(_0x54c7d7,_0x4da072){const _0x3015f0=a40_0x2d58,_0x350f27=_0x54c7d7();while(!![]){try{const _0x43037f=parseInt(_0x3015f0(0xcd))/0x1+-parseInt(_0x3015f0(0x8d))/0x2+parseInt(_0x3015f0(0xd0))/0x3+parseInt(_0x3015f0(0xb4))/0x4*(-parseInt(_0x3015f0(0xc5))/0x5)+parseInt(_0x3015f0(0xd3))/0x6+-parseInt(_0x3015f0(0x9a))/0x7+parseInt(_0x3015f0(0xe8))/0x8*(-parseInt(_0x3015f0(0xbf))/0x9);if(_0x43037f===_0x4da072)break;else _0x350f27['push'](_0x350f27['shift']());}catch(_0x120217){_0x350f27['push'](_0x350f27['shift']());}}}(a40_0x4a6c,0xf2a3b));Object[a40_0x308720(0xb3)](exports,a40_0x308720(0x92),{'value':!![]}),exports[a40_0x308720(0xb9)]=void 0x0;const loggerService_1=require(a40_0x308720(0xc9));function a40_0x2d58(_0x5277c1,_0xfb71f5){const _0x4a6cd9=a40_0x4a6c();return a40_0x2d58=function(_0x2d5804,_0x364f9f){_0x2d5804=_0x2d5804-0x76;let _0x2a775b=_0x4a6cd9[_0x2d5804];return _0x2a775b;},a40_0x2d58(_0x5277c1,_0xfb71f5);}class CoinToPayService{constructor(){const _0x1e203f=a40_0x308720;this[_0x1e203f(0x7b)]='https://tesoft.uk/gateway/cointopay/',this[_0x1e203f(0xb2)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x1e203f(0x84)](_0x1e203f(0x81)),console[_0x1e203f(0x84)]('📊\x20Status\x20check\x20URL:',this['statusUrl']);}async[a40_0x308720(0x95)](_0x1ccddc){const _0x224c69=a40_0x308720,{orderId:_0x200992,amount:_0x334312}=_0x1ccddc;console[_0x224c69(0x84)](_0x224c69(0x83)+_0x334312+_0x224c69(0x7e));const _0x546666={'amount':_0x334312},_0x21b8a6=Date[_0x224c69(0xd5)]();try{console[_0x224c69(0x84)](_0x224c69(0x78)),console['log'](_0x224c69(0xe3),this[_0x224c69(0x7b)]),console['log'](_0x224c69(0xe0),JSON[_0x224c69(0xc2)](_0x546666,null,0x2)),console['log'](_0x224c69(0xde),_0x334312,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay','/create',_0x224c69(0x8e),_0x546666);const _0x25f6b7=await fetch(this['apiUrl'],{'method':_0x224c69(0x8e),'headers':{'Content-Type':_0x224c69(0x8f),'Accept':_0x224c69(0x8f),'User-Agent':_0x224c69(0xaf)},'body':JSON[_0x224c69(0xc2)](_0x546666)}),_0x33be59=Date[_0x224c69(0xd5)]()-_0x21b8a6;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x224c69(0x84)](_0x224c69(0xcb),_0x25f6b7[_0x224c69(0x96)]),console[_0x224c69(0x84)](_0x224c69(0xb0),_0x25f6b7[_0x224c69(0xda)]),console[_0x224c69(0x84)](_0x224c69(0xa0),Object[_0x224c69(0xc1)](_0x25f6b7[_0x224c69(0xc3)][_0x224c69(0xea)]())),console[_0x224c69(0x84)](_0x224c69(0xe6),_0x33be59+'ms');const _0x2e9a3e=await _0x25f6b7[_0x224c69(0xa2)]();console[_0x224c69(0x84)](_0x224c69(0x94),_0x2e9a3e);if(!_0x25f6b7['ok']){console[_0x224c69(0xac)](_0x224c69(0xa1)),console['error']('HTTP\x20Status:',_0x25f6b7['status']),console[_0x224c69(0xac)](_0x224c69(0x9f),_0x2e9a3e),loggerService_1[_0x224c69(0xc4)][_0x224c69(0xbd)](_0x224c69(0xf0),_0x224c69(0xc6),_0x25f6b7['status'],_0x2e9a3e,_0x33be59),loggerService_1[_0x224c69(0xc4)][_0x224c69(0xd9)]('cointopay','/create',_0x224c69(0x7a)+_0x25f6b7['status']+':\x20'+_0x2e9a3e);throw new Error(_0x224c69(0xa7)+_0x25f6b7[_0x224c69(0x96)]+',\x20body:\x20'+_0x2e9a3e);}let _0x5f27b5;try{_0x5f27b5=JSON['parse'](_0x2e9a3e);}catch(_0x34bdbc){console['error'](_0x224c69(0xf4),_0x34bdbc),loggerService_1[_0x224c69(0xc4)][_0x224c69(0xd9)](_0x224c69(0xf0),'/create','JSON\x20Parse\x20Error:\x20'+_0x34bdbc);throw new Error(_0x224c69(0xf1)+_0x2e9a3e);}console[_0x224c69(0x84)](_0x224c69(0x76)),console[_0x224c69(0x84)](_0x224c69(0x89),JSON[_0x224c69(0xc2)](_0x5f27b5,null,0x2)),loggerService_1[_0x224c69(0xc4)]['logWhiteDomainResponse'](_0x224c69(0xf0),'/create',_0x25f6b7[_0x224c69(0x96)],_0x5f27b5,_0x33be59);if(_0x5f27b5['error']){const _0x551779=_0x5f27b5[_0x224c69(0xd1)]||_0x5f27b5[_0x224c69(0xac)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x224c69(0xac)](_0x224c69(0x7d)),console[_0x224c69(0xac)](_0x224c69(0xd4),_0x551779),loggerService_1[_0x224c69(0xc4)][_0x224c69(0xd9)](_0x224c69(0xf0),_0x224c69(0xc6),_0x224c69(0xee)+_0x551779);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x551779);}if(!_0x5f27b5[_0x224c69(0xed)]||!_0x5f27b5['gateway_payment_id']){console['error'](_0x224c69(0xa4)),console[_0x224c69(0xac)](_0x224c69(0xec)),console['error'](_0x224c69(0xf2),_0x5f27b5),loggerService_1[_0x224c69(0xc4)][_0x224c69(0xd9)](_0x224c69(0xf0),_0x224c69(0xc6),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x224c69(0x99));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x224c69(0x84)](_0x224c69(0xc7),_0x5f27b5[_0x224c69(0xef)]),console[_0x224c69(0x84)](_0x224c69(0x91),_0x5f27b5[_0x224c69(0xed)]),console[_0x224c69(0x84)]('Amount:',_0x334312,_0x224c69(0xe7)),{'gateway_payment_id':_0x5f27b5[_0x224c69(0xef)],'payment_url':_0x5f27b5[_0x224c69(0xed)]};}catch(_0x16089e){console[_0x224c69(0xac)](_0x224c69(0x7c)),console['error'](_0x224c69(0xe1),_0x16089e),loggerService_1['loggerService'][_0x224c69(0xd9)]('cointopay',_0x224c69(0xc6),_0x16089e);if(_0x16089e instanceof Error){console[_0x224c69(0xac)](_0x224c69(0x79),_0x16089e[_0x224c69(0xd1)]),console[_0x224c69(0xac)](_0x224c69(0xc8),_0x16089e[_0x224c69(0xae)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x16089e[_0x224c69(0xd1)]);}throw new Error(_0x224c69(0xab));}}async[a40_0x308720(0xb7)](_0x3a4a1e){const _0x3e2427=a40_0x308720,_0xaf548d=Date[_0x3e2427(0xd5)]();try{console[_0x3e2427(0x84)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x3a4a1e);const _0x520a70={'gatewayPaymentId':_0x3a4a1e};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x3e2427(0x8e),_0x520a70);const _0x2dfde6=await fetch(this[_0x3e2427(0xb2)],{'method':_0x3e2427(0x8e),'headers':{'Content-Type':'application/json','Accept':_0x3e2427(0x8f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3e2427(0xc2)](_0x520a70)}),_0x45d6ae=Date[_0x3e2427(0xd5)]()-_0xaf548d;console['log'](_0x3e2427(0xe2)),console[_0x3e2427(0x84)](_0x3e2427(0xcb),_0x2dfde6['status']),console[_0x3e2427(0x84)](_0x3e2427(0xe6),_0x45d6ae+'ms');if(!_0x2dfde6['ok']){const _0x2fd030=await _0x2dfde6[_0x3e2427(0xa2)]();console[_0x3e2427(0xac)](_0x3e2427(0xeb),_0x2dfde6['status']),console[_0x3e2427(0xac)](_0x3e2427(0x9f),_0x2fd030),loggerService_1[_0x3e2427(0xc4)][_0x3e2427(0xbd)](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x2dfde6[_0x3e2427(0x96)],_0x2fd030,_0x45d6ae),loggerService_1[_0x3e2427(0xc4)][_0x3e2427(0xd9)](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x3e2427(0x7a)+_0x2dfde6[_0x3e2427(0x96)]+':\x20'+_0x2fd030);throw new Error(_0x3e2427(0xa7)+_0x2dfde6['status']);}const _0x4cebaf=await _0x2dfde6['text']();console['log'](_0x3e2427(0x94),_0x4cebaf);let _0x3736d0;try{_0x3736d0=JSON[_0x3e2427(0xd2)](_0x4cebaf);}catch(_0x3b6405){console[_0x3e2427(0xac)](_0x3e2427(0xf4),_0x3b6405),loggerService_1[_0x3e2427(0xc4)][_0x3e2427(0xd9)](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x3e2427(0xdb)+_0x3b6405);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4cebaf);}loggerService_1[_0x3e2427(0xc4)]['logWhiteDomainResponse']('cointopay',_0x3e2427(0xbe),_0x2dfde6[_0x3e2427(0x96)],_0x3736d0,_0x45d6ae),console['log'](_0x3e2427(0xce)),console[_0x3e2427(0x84)](_0x3e2427(0x97),_0x3736d0[_0x3e2427(0x93)]),console[_0x3e2427(0x84)]('Status\x20Code:',_0x3736d0['status_code']),console[_0x3e2427(0x84)](_0x3e2427(0xe4),_0x3736d0[_0x3e2427(0x80)]?.[_0x3e2427(0xca)]),console[_0x3e2427(0x84)](_0x3e2427(0xde),_0x3736d0['data']?.['Amount']),console['log'](_0x3e2427(0xf6),_0x3736d0[_0x3e2427(0x80)]?.[_0x3e2427(0xa5)]);if(_0x3736d0[_0x3e2427(0x93)]!==_0x3e2427(0xe9)||_0x3736d0['status_code']!==0xc8){const _0x3e8984=_0x3736d0['message']||_0x3e2427(0xf5);console[_0x3e2427(0xac)](_0x3e2427(0xf3)),console['error'](_0x3e2427(0xd4),_0x3e8984),loggerService_1['loggerService'][_0x3e2427(0xd9)](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x3e2427(0x88)+_0x3e8984);throw new Error(_0x3e2427(0xa6)+_0x3e8984);}if(!_0x3736d0[_0x3e2427(0x80)]){console[_0x3e2427(0xac)](_0x3e2427(0xaa)),console[_0x3e2427(0xac)](_0x3e2427(0x8a)),loggerService_1[_0x3e2427(0xc4)][_0x3e2427(0xd9)](_0x3e2427(0xf0),_0x3e2427(0xbe),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3e2427(0x98));}let _0xf6553e=_0x3e2427(0x8c);switch(_0x3736d0['data'][_0x3e2427(0xca)]?.[_0x3e2427(0xb1)]()){case _0x3e2427(0x77):_0xf6553e=_0x3e2427(0xa9);break;case'cancelled':case _0x3e2427(0xb8):case'error':_0xf6553e=_0x3e2427(0xc0);break;case'expired':case _0x3e2427(0x9e):_0xf6553e=_0x3e2427(0x9b);break;case'waiting':case _0x3e2427(0xb5):case _0x3e2427(0x87):case'created':default:_0xf6553e=_0x3e2427(0x8c);break;}let _0x43db73,_0x4460f4;if(_0x3736d0[_0x3e2427(0x80)]['PaymentDetail']){const _0x4ce043=_0x3736d0[_0x3e2427(0x80)]['PaymentDetail'];console['log']('🏦\x20Payment\x20Detail:',_0x4ce043);const _0x1f5540=_0x4ce043[_0x3e2427(0xd6)](/IBAN\s+([A-Z0-9]+)/i);_0x1f5540&&(_0x43db73=_0x1f5540[0x1],console['log'](_0x3e2427(0xad),_0x43db73)),_0x4460f4=_0x4ce043;}const _0x2550a6={'iban':_0x43db73,'bankDetails':_0x4460f4,'transactionId':_0x3736d0['data']['TransactionID'],'coinAddress':_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xcc)],'qrCodeUrl':_0x3736d0['data']['QRCodeURL'],'expiryTime':_0x3736d0[_0x3e2427(0x80)]['ExpiryTime'],'createdOn':_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xa3)],'confirmedOn':_0x3736d0['data'][_0x3e2427(0x86)]};console[_0x3e2427(0x84)](_0x3e2427(0xd8)),console['log'](_0x3e2427(0xcb),_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xca)],'->',_0xf6553e),console[_0x3e2427(0x84)]('Amount:',_0x3736d0[_0x3e2427(0x80)]['Amount'],_0x3736d0[_0x3e2427(0x80)]['inputCurrency']),console[_0x3e2427(0x84)]('Transaction\x20ID:',_0x3736d0['data']['TransactionID']),console[_0x3e2427(0x84)](_0x3e2427(0xcf),_0x43db73||_0x3e2427(0xbb)),console[_0x3e2427(0x84)](_0x3e2427(0xb6),_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xa3)]),console[_0x3e2427(0x84)](_0x3e2427(0xdd),_0x3736d0[_0x3e2427(0x80)]['TransactionConfirmedOn']||'not\x20confirmed');if(_0x3736d0['data'][_0x3e2427(0xca)]?.[_0x3e2427(0xb1)]()===_0x3e2427(0xb5))console[_0x3e2427(0x84)](_0x3e2427(0x82));else _0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xca)]?.[_0x3e2427(0xb1)]()===_0x3e2427(0x77)&&console[_0x3e2427(0x84)](_0x3e2427(0xa8));return{'status':_0xf6553e,'amount':parseFloat(_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0x90)])||undefined,'currency':_0x3736d0[_0x3e2427(0x80)][_0x3e2427(0xa5)]||'EUR','paymentDetails':_0x2550a6};}catch(_0x56d90c){console['error'](_0x3e2427(0xba),_0x56d90c),loggerService_1[_0x3e2427(0xc4)][_0x3e2427(0xd9)](_0x3e2427(0xf0),_0x3e2427(0xbe),_0x56d90c);throw new Error(_0x3e2427(0x85)+(_0x56d90c instanceof Error?_0x56d90c[_0x3e2427(0xd1)]:_0x3e2427(0x8b)));}}async['verifyPayment'](_0x980a98){const _0x24d7b0=a40_0x308720,_0x318af4=await this['checkPaymentStatus'](_0x980a98);return{'status':_0x318af4[_0x24d7b0(0x96)],'amount':_0x318af4[_0x24d7b0(0xe5)],'currency':_0x318af4[_0x24d7b0(0xbc)]};}async['processWebhook'](_0x42dee8){const _0x113582=a40_0x308720;console['log'](_0x113582(0xdf),_0x42dee8);let _0x5e71e8=_0x113582(0x8c);switch(_0x42dee8[_0x113582(0x96)]?.['toLowerCase']()){case _0x113582(0x77):_0x5e71e8=_0x113582(0xa9);break;case _0x113582(0xdc):case'failed':case _0x113582(0xac):_0x5e71e8=_0x113582(0xc0);break;case _0x113582(0xd7):case'timeout':_0x5e71e8='EXPIRED';break;case _0x113582(0x87):case _0x113582(0x9d):case'awaiting\x20fiat':case'created':default:_0x5e71e8=_0x113582(0x8c);break;}return{'paymentId':_0x42dee8[_0x113582(0x9c)]||_0x42dee8[_0x113582(0x7f)]||'','status':_0x5e71e8,'amount':_0x42dee8['amount'],'currency':_0x42dee8[_0x113582(0xbc)]||_0x113582(0xe7)};}}function a40_0x4a6c(){const _0x1d71f9=['12znDkch','awaiting\x20fiat','Created\x20On:','checkPaymentStatus','failed','CoinToPayService','CoinToPay\x20payment\x20status\x20check\x20error:','not\x20found','currency','logWhiteDomainResponse','/status','1083474WDkJPm','FAILED','fromEntries','stringify','headers','loggerService','1414625CqVJaW','/create','Gateway\x20Payment\x20ID:','Error\x20stack:','../loggerService','Status','Status:','coinAddress','1833056CQrUbj','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','IBAN:','5004030mOBuaD','message','parse','11005602OkxNrp','Error\x20Message:','now','match','expired','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','logWhiteDomainError','statusText','JSON\x20Parse\x20Error:\x20','cancelled','Confirmed\x20On:','Amount:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Request\x20Body:','Error\x20details:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','URL:','Payment\x20Status:','amount','Response\x20Time:','EUR','176vjXcJC','success','entries','HTTP\x20Status:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','payment_url','Business\x20Error:\x20','gateway_payment_id','cointopay','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20data:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Currency:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','paid','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','HTTP\x20','apiUrl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','\x20EUR','merchant_reference_id','data','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','🪙\x20Creating\x20CoinToPay\x20payment:\x20','log','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TransactionConfirmedOn','pending','Status\x20API\x20Error:\x20','Parsed\x20Result:','Missing\x20data\x20in\x20response','Unknown\x20error','PENDING','553446tLSTwM','POST','application/json','Amount','Payment\x20URL:','__esModule','result','Raw\x20Response\x20Body:','createPaymentLink','status','Result:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3972444TcsXTr','EXPIRED','order_id','waiting','timeout','Response\x20Body:','Headers:','===\x20COINTOPAY\x20API\x20ERROR\x20===','text','CreatedOn','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','inputCurrency','CoinToPay\x20status\x20API\x20error:\x20','HTTP\x20error!\x20status:\x20','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','PAID','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','error','🏦\x20Extracted\x20IBAN:','stack','TesSoft\x20Payment\x20System/1.0','Status\x20Text:','toLowerCase','statusUrl','defineProperty'];a40_0x4a6c=function(){return _0x1d71f9;};return a40_0x4a6c();}exports[a40_0x308720(0xb9)]=CoinToPayService;