'use strict';const a44_0x2cdee8=a44_0x5921;(function(_0x5ed787,_0x35e457){const _0x50a9e2=a44_0x5921,_0x1462f5=_0x5ed787();while(!![]){try{const _0x46b73c=-parseInt(_0x50a9e2(0x133))/0x1+-parseInt(_0x50a9e2(0x12f))/0x2*(parseInt(_0x50a9e2(0x10e))/0x3)+parseInt(_0x50a9e2(0x161))/0x4+-parseInt(_0x50a9e2(0x13f))/0x5*(-parseInt(_0x50a9e2(0x154))/0x6)+-parseInt(_0x50a9e2(0x122))/0x7*(-parseInt(_0x50a9e2(0x116))/0x8)+-parseInt(_0x50a9e2(0x158))/0x9*(-parseInt(_0x50a9e2(0x188))/0xa)+-parseInt(_0x50a9e2(0x13b))/0xb;if(_0x46b73c===_0x35e457)break;else _0x1462f5['push'](_0x1462f5['shift']());}catch(_0x4541e1){_0x1462f5['push'](_0x1462f5['shift']());}}}(a44_0x15e8,0x3841a));Object[a44_0x2cdee8(0x113)](exports,'__esModule',{'value':!![]}),exports[a44_0x2cdee8(0x11a)]=void 0x0;function a44_0x15e8(){const _0x1a045b=['676zLsAdr','üè¶\x20Extracted\x20IBAN:','pending','message','277799STfNAs','Business\x20Error:\x20','TransactionID','Status\x20Text:','entries','IBAN:','Currency:','error','4751417bOXHnU','Unknown\x20error\x20from\x20CoinToPay\x20API','Error\x20Message:','cancelled','1860915KnGmQQ','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Confirmed\x20On:','stringify','fromEntries','not\x20found','parse','success','apiUrl','failed','Missing\x20data\x20in\x20response','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20data:','toLowerCase','Raw\x20Response\x20Body:','Status\x20API\x20Error:\x20','CreatedOn','PAID','HTTP\x20Status:','Request\x20Body:','order_id','6SNdtVg','POST','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','üè¶\x20Payment\x20Detail:','4491HetHNr','createPaymentLink','verifyPayment','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','result','/create','QRCodeURL','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','CoinToPay\x20API\x20error:\x20','1564152JYKUuW','PaymentDetail','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20parse\x20JSON\x20response:','Response\x20Time:','merchant_reference_id','paid','URL:','Payment\x20Status:','cointopay','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','HTTP\x20error!\x20status:\x20','logWhiteDomainResponse','payment_url','EUR','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','log','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','now','Response\x20Body:','logWhiteDomainRequest','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','JSON\x20Parse\x20Error:\x20','TransactionConfirmedOn','headers','Error\x20message:','gateway_payment_id','data','Status\x20Code:','Created\x20On:',',\x20body:\x20','https://tesoft.uk/gateway/cointopay/status.php','ExpiryTime','https://tesoft.uk/gateway/cointopay/','amount','waiting','TesSoft\x20Payment\x20System/1.0','1420oPdSXd','statusText','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','checkPaymentStatus','expired','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','created','status_code','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Error\x20stack:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CoinToPay\x20status\x20API\x20error:\x20','Gateway\x20Payment\x20ID:','Status:','1941CrLPvX','inputCurrency','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status','text','defineProperty','status','awaiting\x20fiat','104EitNrC','HTTP\x20','application/json','loggerService','CoinToPayService','match','FAILED','/status','Amount','statusUrl','Headers:','CoinToPay\x20payment\x20status\x20check\x20error:','174881uwIBMK','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Result:','currency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainError','PENDING','stack','Transaction\x20ID:','===\x20COINTOPAY\x20SUCCESS\x20===','EXPIRED','Amount:','../loggerService'];a44_0x15e8=function(){return _0x1a045b;};return a44_0x15e8();}const loggerService_1=require(a44_0x2cdee8(0x12e));function a44_0x5921(_0x3889b3,_0x1e15d6){const _0x15e8b3=a44_0x15e8();return a44_0x5921=function(_0x59210b,_0x55a79a){_0x59210b=_0x59210b-0x108;let _0x4dac4d=_0x15e8b3[_0x59210b];return _0x4dac4d;},a44_0x5921(_0x3889b3,_0x1e15d6);}class CoinToPayService{constructor(){const _0x2b46d4=a44_0x2cdee8;this[_0x2b46d4(0x147)]=_0x2b46d4(0x184),this['statusUrl']=_0x2b46d4(0x182),console[_0x2b46d4(0x172)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log']('üìä\x20Status\x20check\x20URL:',this[_0x2b46d4(0x11f)]);}async[a44_0x2cdee8(0x159)](_0x2dc839){const _0x360823=a44_0x2cdee8,{orderId:_0x1324af,amount:_0x50ac5a}=_0x2dc839;console[_0x360823(0x172)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x50ac5a+'\x20EUR');const _0x107cc4={'amount':_0x50ac5a},_0x12a930=Date[_0x360823(0x175)]();try{console[_0x360823(0x172)](_0x360823(0x16b)),console['log'](_0x360823(0x168),this[_0x360823(0x147)]),console[_0x360823(0x172)](_0x360823(0x152),JSON[_0x360823(0x142)](_0x107cc4,null,0x2)),console['log'](_0x360823(0x12d),_0x50ac5a,_0x360823(0x14a)),loggerService_1[_0x360823(0x119)]['logWhiteDomainRequest']('cointopay',_0x360823(0x15d),_0x360823(0x155),_0x107cc4);const _0x249f5b=await fetch(this[_0x360823(0x147)],{'method':_0x360823(0x155),'headers':{'Content-Type':'application/json','Accept':_0x360823(0x118),'User-Agent':_0x360823(0x187)},'body':JSON['stringify'](_0x107cc4)}),_0x5b4203=Date[_0x360823(0x175)]()-_0x12a930;console['log'](_0x360823(0x123)),console['log']('Status:',_0x249f5b['status']),console[_0x360823(0x172)](_0x360823(0x136),_0x249f5b[_0x360823(0x189)]),console['log'](_0x360823(0x120),Object[_0x360823(0x143)](_0x249f5b[_0x360823(0x17b)][_0x360823(0x137)]())),console[_0x360823(0x172)](_0x360823(0x165),_0x5b4203+'ms');const _0x5e0a3a=await _0x249f5b[_0x360823(0x112)]();console[_0x360823(0x172)](_0x360823(0x14d),_0x5e0a3a);if(!_0x249f5b['ok']){console[_0x360823(0x13a)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x360823(0x13a)](_0x360823(0x151),_0x249f5b[_0x360823(0x114)]),console[_0x360823(0x13a)]('Response\x20Body:',_0x5e0a3a),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x360823(0x15d),_0x249f5b[_0x360823(0x114)],_0x5e0a3a,_0x5b4203),loggerService_1[_0x360823(0x119)]['logWhiteDomainError'](_0x360823(0x16a),_0x360823(0x15d),_0x360823(0x117)+_0x249f5b[_0x360823(0x114)]+':\x20'+_0x5e0a3a);throw new Error(_0x360823(0x16c)+_0x249f5b[_0x360823(0x114)]+_0x360823(0x181)+_0x5e0a3a);}let _0x1282d8;try{_0x1282d8=JSON[_0x360823(0x145)](_0x5e0a3a);}catch(_0xb5ea34){console[_0x360823(0x13a)](_0x360823(0x164),_0xb5ea34),loggerService_1['loggerService'][_0x360823(0x127)](_0x360823(0x16a),'/create','JSON\x20Parse\x20Error:\x20'+_0xb5ea34);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x5e0a3a);}console[_0x360823(0x172)](_0x360823(0x18d)),console[_0x360823(0x172)]('Parsed\x20Result:',JSON[_0x360823(0x142)](_0x1282d8,null,0x2)),loggerService_1[_0x360823(0x119)][_0x360823(0x16d)](_0x360823(0x16a),_0x360823(0x15d),_0x249f5b[_0x360823(0x114)],_0x1282d8,_0x5b4203);if(_0x1282d8[_0x360823(0x13a)]){const _0x54f7ef=_0x1282d8['message']||_0x1282d8[_0x360823(0x13a)]||_0x360823(0x13c);console[_0x360823(0x13a)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x360823(0x13d),_0x54f7ef),loggerService_1['loggerService'][_0x360823(0x127)](_0x360823(0x16a),_0x360823(0x15d),_0x360823(0x134)+_0x54f7ef);throw new Error(_0x360823(0x160)+_0x54f7ef);}if(!_0x1282d8[_0x360823(0x16e)]||!_0x1282d8[_0x360823(0x17d)]){console[_0x360823(0x13a)](_0x360823(0x110)),console[_0x360823(0x13a)](_0x360823(0x15f)),console[_0x360823(0x13a)](_0x360823(0x14b),_0x1282d8),loggerService_1['loggerService'][_0x360823(0x127)]('cointopay',_0x360823(0x15d),_0x360823(0x10a));throw new Error(_0x360823(0x173));}return console[_0x360823(0x172)](_0x360823(0x12b)),console[_0x360823(0x172)](_0x360823(0x10c),_0x1282d8[_0x360823(0x17d)]),console[_0x360823(0x172)]('Payment\x20URL:',_0x1282d8['payment_url']),console[_0x360823(0x172)]('Amount:',_0x50ac5a,_0x360823(0x16f)),{'gateway_payment_id':_0x1282d8[_0x360823(0x17d)],'payment_url':_0x1282d8[_0x360823(0x16e)]};}catch(_0x1f5f44){console[_0x360823(0x13a)](_0x360823(0x190)),console['error']('Error\x20details:',_0x1f5f44),loggerService_1[_0x360823(0x119)][_0x360823(0x127)]('cointopay',_0x360823(0x15d),_0x1f5f44);if(_0x1f5f44 instanceof Error){console['error'](_0x360823(0x17c),_0x1f5f44[_0x360823(0x132)]),console['error'](_0x360823(0x109),_0x1f5f44[_0x360823(0x129)]);throw new Error(_0x360823(0x126)+_0x1f5f44['message']);}throw new Error(_0x360823(0x156));}}async['checkPaymentStatus'](_0x33794f){const _0x4790ab=a44_0x2cdee8,_0x26b139=Date[_0x4790ab(0x175)]();try{console['log'](_0x4790ab(0x170)+_0x33794f);const _0x594afc={'gatewayPaymentId':_0x33794f};loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x177)](_0x4790ab(0x16a),_0x4790ab(0x11d),_0x4790ab(0x155),_0x594afc);const _0x3857a7=await fetch(this[_0x4790ab(0x11f)],{'method':_0x4790ab(0x155),'headers':{'Content-Type':'application/json','Accept':_0x4790ab(0x118),'User-Agent':_0x4790ab(0x187)},'body':JSON[_0x4790ab(0x142)](_0x594afc)}),_0x834855=Date['now']()-_0x26b139;console[_0x4790ab(0x172)](_0x4790ab(0x140)),console[_0x4790ab(0x172)](_0x4790ab(0x10d),_0x3857a7[_0x4790ab(0x114)]),console[_0x4790ab(0x172)](_0x4790ab(0x165),_0x834855+'ms');if(!_0x3857a7['ok']){const _0x28e482=await _0x3857a7[_0x4790ab(0x112)]();console[_0x4790ab(0x13a)](_0x4790ab(0x151),_0x3857a7['status']),console[_0x4790ab(0x13a)](_0x4790ab(0x176),_0x28e482),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x16d)]('cointopay','/status',_0x3857a7[_0x4790ab(0x114)],_0x28e482,_0x834855),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x127)](_0x4790ab(0x16a),_0x4790ab(0x11d),'HTTP\x20'+_0x3857a7[_0x4790ab(0x114)]+':\x20'+_0x28e482);throw new Error(_0x4790ab(0x16c)+_0x3857a7[_0x4790ab(0x114)]);}const _0x4cd53c=await _0x3857a7[_0x4790ab(0x112)]();console['log']('Raw\x20Response\x20Body:',_0x4cd53c);let _0x32115b;try{_0x32115b=JSON[_0x4790ab(0x145)](_0x4cd53c);}catch(_0x239066){console['error'](_0x4790ab(0x164),_0x239066),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x127)](_0x4790ab(0x16a),_0x4790ab(0x11d),_0x4790ab(0x179)+_0x239066);throw new Error(_0x4790ab(0x108)+_0x4cd53c);}loggerService_1[_0x4790ab(0x119)]['logWhiteDomainResponse'](_0x4790ab(0x16a),_0x4790ab(0x11d),_0x3857a7[_0x4790ab(0x114)],_0x32115b,_0x834855),console[_0x4790ab(0x172)](_0x4790ab(0x18a)),console[_0x4790ab(0x172)](_0x4790ab(0x124),_0x32115b['result']),console[_0x4790ab(0x172)](_0x4790ab(0x17f),_0x32115b[_0x4790ab(0x18f)]),console['log'](_0x4790ab(0x169),_0x32115b['data']?.[_0x4790ab(0x111)]),console[_0x4790ab(0x172)](_0x4790ab(0x12d),_0x32115b[_0x4790ab(0x17e)]?.['Amount']),console['log'](_0x4790ab(0x139),_0x32115b[_0x4790ab(0x17e)]?.['inputCurrency']);if(_0x32115b[_0x4790ab(0x15c)]!==_0x4790ab(0x146)||_0x32115b[_0x4790ab(0x18f)]!==0xc8){const _0x33021e=_0x32115b[_0x4790ab(0x132)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x4790ab(0x13a)](_0x4790ab(0x174)),console[_0x4790ab(0x13a)](_0x4790ab(0x13d),_0x33021e),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x127)](_0x4790ab(0x16a),_0x4790ab(0x11d),_0x4790ab(0x14e)+_0x33021e);throw new Error(_0x4790ab(0x10b)+_0x33021e);}if(!_0x32115b[_0x4790ab(0x17e)]){console[_0x4790ab(0x13a)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x4790ab(0x13a)](_0x4790ab(0x149)),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x127)](_0x4790ab(0x16a),_0x4790ab(0x11d),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x4790ab(0x171));}let _0x580e7e='PENDING';switch(_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x111)]?.[_0x4790ab(0x14c)]()){case _0x4790ab(0x167):_0x580e7e=_0x4790ab(0x150);break;case _0x4790ab(0x13e):case _0x4790ab(0x148):case'error':_0x580e7e=_0x4790ab(0x11c);break;case _0x4790ab(0x18c):case'timeout':_0x580e7e=_0x4790ab(0x12c);break;case _0x4790ab(0x186):case _0x4790ab(0x115):case _0x4790ab(0x131):case _0x4790ab(0x18e):default:_0x580e7e=_0x4790ab(0x128);break;}let _0x18c16c,_0x20aa5e;if(_0x32115b['data']['PaymentDetail']){const _0x34ac39=_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x162)];console['log'](_0x4790ab(0x157),_0x34ac39);const _0x3eb937=_0x34ac39[_0x4790ab(0x11b)](/IBAN\s+([A-Z0-9]+)/i);_0x3eb937&&(_0x18c16c=_0x3eb937[0x1],console[_0x4790ab(0x172)](_0x4790ab(0x130),_0x18c16c)),_0x20aa5e=_0x34ac39;}const _0x2e32f3={'iban':_0x18c16c,'bankDetails':_0x20aa5e,'transactionId':_0x32115b['data']['TransactionID'],'coinAddress':_0x32115b[_0x4790ab(0x17e)]['coinAddress'],'qrCodeUrl':_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x15e)],'expiryTime':_0x32115b['data'][_0x4790ab(0x183)],'createdOn':_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x14f)],'confirmedOn':_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x17a)]};console[_0x4790ab(0x172)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x4790ab(0x172)](_0x4790ab(0x10d),_0x32115b['data'][_0x4790ab(0x111)],'->',_0x580e7e),console[_0x4790ab(0x172)]('Amount:',_0x32115b[_0x4790ab(0x17e)]['Amount'],_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x10f)]),console['log'](_0x4790ab(0x12a),_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x135)]),console[_0x4790ab(0x172)](_0x4790ab(0x138),_0x18c16c||_0x4790ab(0x144)),console[_0x4790ab(0x172)](_0x4790ab(0x180),_0x32115b[_0x4790ab(0x17e)]['CreatedOn']),console[_0x4790ab(0x172)](_0x4790ab(0x141),_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x17a)]||'not\x20confirmed');if(_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x111)]?.['toLowerCase']()===_0x4790ab(0x115))console[_0x4790ab(0x172)](_0x4790ab(0x15b));else _0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x111)]?.[_0x4790ab(0x14c)]()===_0x4790ab(0x167)&&console[_0x4790ab(0x172)](_0x4790ab(0x163));return{'status':_0x580e7e,'amount':parseFloat(_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x11e)])||undefined,'currency':_0x32115b[_0x4790ab(0x17e)][_0x4790ab(0x10f)]||_0x4790ab(0x16f),'paymentDetails':_0x2e32f3};}catch(_0x1e65da){console[_0x4790ab(0x13a)](_0x4790ab(0x121),_0x1e65da),loggerService_1[_0x4790ab(0x119)][_0x4790ab(0x127)]('cointopay',_0x4790ab(0x11d),_0x1e65da);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1e65da instanceof Error?_0x1e65da['message']:'Unknown\x20error'));}}async[a44_0x2cdee8(0x15a)](_0x4bcd08){const _0x4326ad=a44_0x2cdee8,_0x5927e7=await this[_0x4326ad(0x18b)](_0x4bcd08);return{'status':_0x5927e7[_0x4326ad(0x114)],'amount':_0x5927e7[_0x4326ad(0x185)],'currency':_0x5927e7['currency']};}async['processWebhook'](_0x44c05f){const _0x3d5ef5=a44_0x2cdee8;console[_0x3d5ef5(0x172)](_0x3d5ef5(0x178),_0x44c05f);let _0x45e839='PENDING';switch(_0x44c05f[_0x3d5ef5(0x114)]?.[_0x3d5ef5(0x14c)]()){case _0x3d5ef5(0x167):_0x45e839='PAID';break;case'cancelled':case'failed':case'error':_0x45e839=_0x3d5ef5(0x11c);break;case _0x3d5ef5(0x18c):case'timeout':_0x45e839='EXPIRED';break;case _0x3d5ef5(0x131):case _0x3d5ef5(0x186):case _0x3d5ef5(0x115):case _0x3d5ef5(0x18e):default:_0x45e839='PENDING';break;}return{'paymentId':_0x44c05f[_0x3d5ef5(0x153)]||_0x44c05f[_0x3d5ef5(0x166)]||'','status':_0x45e839,'amount':_0x44c05f[_0x3d5ef5(0x185)],'currency':_0x44c05f[_0x3d5ef5(0x125)]||_0x3d5ef5(0x16f)};}}exports[a44_0x2cdee8(0x11a)]=CoinToPayService;