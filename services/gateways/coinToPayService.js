'use strict';const a40_0x2aa387=a40_0x3423;(function(_0x60f62d,_0x18e979){const _0x4a1252=a40_0x3423,_0x295082=_0x60f62d();while(!![]){try{const _0x403753=-parseInt(_0x4a1252(0x118))/0x1+parseInt(_0x4a1252(0xf8))/0x2+-parseInt(_0x4a1252(0xc0))/0x3+parseInt(_0x4a1252(0xf1))/0x4*(parseInt(_0x4a1252(0xf9))/0x5)+-parseInt(_0x4a1252(0x122))/0x6+-parseInt(_0x4a1252(0x115))/0x7+parseInt(_0x4a1252(0x106))/0x8;if(_0x403753===_0x18e979)break;else _0x295082['push'](_0x295082['shift']());}catch(_0x17902d){_0x295082['push'](_0x295082['shift']());}}}(a40_0x28dd,0xab623));function a40_0x28dd(){const _0xfc27e2=['apiUrl','HTTP\x20error!\x20status:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','log','172BUFQwv','checkPaymentStatus','pending','logWhiteDomainResponse','JSON\x20Parse\x20Error:\x20','logWhiteDomainError','üìä\x20Status\x20check\x20URL:','2197806ZSPMaE','133230zQoQiL','Error\x20message:','Unknown\x20error','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','currency','merchant_reference_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','https://tesoft.uk/gateway/cointopay/','Raw\x20Response\x20Body:','data','status_code','Response\x20data:','\x20EUR','1688472xAlXxz','inputCurrency','status','Response\x20Body:','https://tesoft.uk/gateway/cointopay/status.php','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','order_id','Error\x20Message:','EXPIRED','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','failed','awaiting\x20fiat','processWebhook','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','502082QaWCzM','cancelled','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','800970mDcZnx','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cointopay','success','Failed\x20to\x20parse\x20JSON\x20response:','defineProperty','timeout','Created\x20On:','PAID','Status','3951360vzrgVY','payment_url','Business\x20Error:\x20','Currency:','stack','not\x20found','statusText','createPaymentLink','Headers:','Error\x20details:','logWhiteDomainRequest','coinAddress','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Response\x20Time:','Payment\x20Status:','application/json','CoinToPay\x20payment\x20status\x20check\x20error:','TransactionID','/create','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','POST','message','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','fromEntries','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','created','Status\x20API\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','error','loggerService','EUR','text','Amount','===\x20COINTOPAY\x20SUCCESS\x20===','667491NGDQMp','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','FAILED','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','URL:','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','amount','Error\x20stack:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','parse','/status','Result:','waiting','match','paid','entries','Status\x20Text:','gateway_payment_id','CoinToPayService','verifyPayment','toLowerCase','../loggerService','Missing\x20data\x20in\x20response','HTTP\x20','CreatedOn','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Payment\x20URL:','headers','now','TesSoft\x20Payment\x20System/1.0','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount:','stringify','CoinToPay\x20API\x20error:\x20','PENDING','expired','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','HTTP\x20Status:','Status:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','statusUrl','===\x20COINTOPAY\x20API\x20ERROR\x20===','Parsed\x20Result:'];a40_0x28dd=function(){return _0xfc27e2;};return a40_0x28dd();}Object[a40_0x2aa387(0x11d)](exports,'__esModule',{'value':!![]}),exports[a40_0x2aa387(0xd4)]=void 0x0;function a40_0x3423(_0x2d1f2e,_0xdb5ab5){const _0x28ddc4=a40_0x28dd();return a40_0x3423=function(_0x3423a3,_0x59542c){_0x3423a3=_0x3423a3-0xb0;let _0x36bf7a=_0x28ddc4[_0x3423a3];return _0x36bf7a;},a40_0x3423(_0x2d1f2e,_0xdb5ab5);}const loggerService_1=require(a40_0x2aa387(0xd7));class CoinToPayService{constructor(){const _0x4b1c9a=a40_0x2aa387;this[_0x4b1c9a(0xed)]=_0x4b1c9a(0x100),this[_0x4b1c9a(0xea)]=_0x4b1c9a(0x10a),console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x4b1c9a(0xf0)](_0x4b1c9a(0xf7),this['statusUrl']);}async[a40_0x2aa387(0x129)](_0x1bf42a){const _0x3ef539=a40_0x2aa387,{orderId:_0x151e74,amount:_0x44312d}=_0x1bf42a;console[_0x3ef539(0xf0)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x44312d+_0x3ef539(0x105));const _0x26bbbe={'amount':_0x44312d},_0x92edd1=Date[_0x3ef539(0xde)]();try{console[_0x3ef539(0xf0)](_0x3ef539(0xe9)),console['log'](_0x3ef539(0xc4),this[_0x3ef539(0xed)]),console[_0x3ef539(0xf0)]('Request\x20Body:',JSON[_0x3ef539(0xe2)](_0x26bbbe,null,0x2)),console[_0x3ef539(0xf0)](_0x3ef539(0xe1),_0x44312d,_0x3ef539(0xef)),loggerService_1[_0x3ef539(0xbb)][_0x3ef539(0x12c)](_0x3ef539(0x11a),_0x3ef539(0x134),_0x3ef539(0xb1),_0x26bbbe);const _0x5b3fd4=await fetch(this[_0x3ef539(0xed)],{'method':'POST','headers':{'Content-Type':_0x3ef539(0x131),'Accept':_0x3ef539(0x131),'User-Agent':_0x3ef539(0xdf)},'body':JSON[_0x3ef539(0xe2)](_0x26bbbe)}),_0x26d222=Date['now']()-_0x92edd1;console['log'](_0x3ef539(0xc6)),console['log']('Status:',_0x5b3fd4[_0x3ef539(0x108)]),console[_0x3ef539(0xf0)](_0x3ef539(0xd2),_0x5b3fd4[_0x3ef539(0x128)]),console[_0x3ef539(0xf0)](_0x3ef539(0x12a),Object[_0x3ef539(0xb4)](_0x5b3fd4[_0x3ef539(0xdd)][_0x3ef539(0xd1)]())),console['log']('Response\x20Time:',_0x26d222+'ms');const _0x42f938=await _0x5b3fd4[_0x3ef539(0xbd)]();console[_0x3ef539(0xf0)](_0x3ef539(0x101),_0x42f938);if(!_0x5b3fd4['ok']){console[_0x3ef539(0xba)](_0x3ef539(0xeb)),console[_0x3ef539(0xba)](_0x3ef539(0xe7),_0x5b3fd4[_0x3ef539(0x108)]),console[_0x3ef539(0xba)](_0x3ef539(0x109),_0x42f938),loggerService_1[_0x3ef539(0xbb)][_0x3ef539(0xf4)](_0x3ef539(0x11a),'/create',_0x5b3fd4[_0x3ef539(0x108)],_0x42f938,_0x26d222),loggerService_1[_0x3ef539(0xbb)][_0x3ef539(0xf6)](_0x3ef539(0x11a),'/create',_0x3ef539(0xd9)+_0x5b3fd4[_0x3ef539(0x108)]+':\x20'+_0x42f938);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5b3fd4[_0x3ef539(0x108)]+',\x20body:\x20'+_0x42f938);}let _0x4690d0;try{_0x4690d0=JSON[_0x3ef539(0xcb)](_0x42f938);}catch(_0x493772){console[_0x3ef539(0xba)](_0x3ef539(0x11c),_0x493772),loggerService_1[_0x3ef539(0xbb)]['logWhiteDomainError'](_0x3ef539(0x11a),_0x3ef539(0x134),_0x3ef539(0xf5)+_0x493772);throw new Error(_0x3ef539(0xca)+_0x42f938);}console['log'](_0x3ef539(0x110)),console[_0x3ef539(0xf0)](_0x3ef539(0xec),JSON[_0x3ef539(0xe2)](_0x4690d0,null,0x2)),loggerService_1[_0x3ef539(0xbb)][_0x3ef539(0xf4)](_0x3ef539(0x11a),_0x3ef539(0x134),_0x5b3fd4[_0x3ef539(0x108)],_0x4690d0,_0x26d222);if(_0x4690d0[_0x3ef539(0xba)]){const _0x3914db=_0x4690d0[_0x3ef539(0xb2)]||_0x4690d0['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x3ef539(0xba)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x3ef539(0x10d),_0x3914db),loggerService_1[_0x3ef539(0xbb)]['logWhiteDomainError'](_0x3ef539(0x11a),_0x3ef539(0x134),_0x3ef539(0x124)+_0x3914db);throw new Error(_0x3ef539(0xe3)+_0x3914db);}if(!_0x4690d0[_0x3ef539(0x123)]||!_0x4690d0[_0x3ef539(0xd3)]){console[_0x3ef539(0xba)](_0x3ef539(0xb0)),console[_0x3ef539(0xba)](_0x3ef539(0x114)),console[_0x3ef539(0xba)](_0x3ef539(0x104),_0x4690d0),loggerService_1[_0x3ef539(0xbb)]['logWhiteDomainError']('cointopay',_0x3ef539(0x134),_0x3ef539(0xc1));throw new Error(_0x3ef539(0x119));}return console[_0x3ef539(0xf0)](_0x3ef539(0xbf)),console[_0x3ef539(0xf0)]('Gateway\x20Payment\x20ID:',_0x4690d0[_0x3ef539(0xd3)]),console[_0x3ef539(0xf0)](_0x3ef539(0xdc),_0x4690d0[_0x3ef539(0x123)]),console['log'](_0x3ef539(0xe1),_0x44312d,'EUR'),{'gateway_payment_id':_0x4690d0[_0x3ef539(0xd3)],'payment_url':_0x4690d0[_0x3ef539(0x123)]};}catch(_0x5e2559){console[_0x3ef539(0xba)](_0x3ef539(0xe6)),console[_0x3ef539(0xba)](_0x3ef539(0x12b),_0x5e2559),loggerService_1[_0x3ef539(0xbb)]['logWhiteDomainError'](_0x3ef539(0x11a),_0x3ef539(0x134),_0x5e2559);if(_0x5e2559 instanceof Error){console[_0x3ef539(0xba)](_0x3ef539(0xfa),_0x5e2559[_0x3ef539(0xb2)]),console[_0x3ef539(0xba)](_0x3ef539(0xc9),_0x5e2559[_0x3ef539(0x126)]);throw new Error(_0x3ef539(0xb9)+_0x5e2559[_0x3ef539(0xb2)]);}throw new Error(_0x3ef539(0xdb));}}async[a40_0x2aa387(0xf2)](_0x2ab0d4){const _0x3491c1=a40_0x2aa387,_0x9041d6=Date[_0x3491c1(0xde)]();try{console[_0x3491c1(0xf0)](_0x3491c1(0x117)+_0x2ab0d4);const _0x2e442b={'gatewayPaymentId':_0x2ab0d4};loggerService_1['loggerService']['logWhiteDomainRequest'](_0x3491c1(0x11a),_0x3491c1(0xcc),_0x3491c1(0xb1),_0x2e442b);const _0x3a5b02=await fetch(this[_0x3491c1(0xea)],{'method':_0x3491c1(0xb1),'headers':{'Content-Type':'application/json','Accept':_0x3491c1(0x131),'User-Agent':_0x3491c1(0xdf)},'body':JSON[_0x3491c1(0xe2)](_0x2e442b)}),_0x5ccc92=Date['now']()-_0x9041d6;console[_0x3491c1(0xf0)](_0x3491c1(0xc7)),console[_0x3491c1(0xf0)]('Status:',_0x3a5b02['status']),console[_0x3491c1(0xf0)](_0x3491c1(0x12f),_0x5ccc92+'ms');if(!_0x3a5b02['ok']){const _0x22064f=await _0x3a5b02[_0x3491c1(0xbd)]();console[_0x3491c1(0xba)](_0x3491c1(0xe7),_0x3a5b02[_0x3491c1(0x108)]),console[_0x3491c1(0xba)]('Response\x20Body:',_0x22064f),loggerService_1['loggerService'][_0x3491c1(0xf4)](_0x3491c1(0x11a),'/status',_0x3a5b02[_0x3491c1(0x108)],_0x22064f,_0x5ccc92),loggerService_1[_0x3491c1(0xbb)]['logWhiteDomainError']('cointopay',_0x3491c1(0xcc),_0x3491c1(0xd9)+_0x3a5b02[_0x3491c1(0x108)]+':\x20'+_0x22064f);throw new Error(_0x3491c1(0xee)+_0x3a5b02[_0x3491c1(0x108)]);}const _0x45e72f=await _0x3a5b02['text']();console['log'](_0x3491c1(0x101),_0x45e72f);let _0x33f9c3;try{_0x33f9c3=JSON['parse'](_0x45e72f);}catch(_0x4db50d){console[_0x3491c1(0xba)](_0x3491c1(0x11c),_0x4db50d),loggerService_1['loggerService'][_0x3491c1(0xf6)](_0x3491c1(0x11a),'/status',_0x3491c1(0xf5)+_0x4db50d);throw new Error(_0x3491c1(0x10f)+_0x45e72f);}loggerService_1[_0x3491c1(0xbb)][_0x3491c1(0xf4)](_0x3491c1(0x11a),_0x3491c1(0xcc),_0x3a5b02[_0x3491c1(0x108)],_0x33f9c3,_0x5ccc92),console[_0x3491c1(0xf0)](_0x3491c1(0xff)),console['log'](_0x3491c1(0xcd),_0x33f9c3['result']),console[_0x3491c1(0xf0)]('Status\x20Code:',_0x33f9c3[_0x3491c1(0x103)]),console[_0x3491c1(0xf0)](_0x3491c1(0x130),_0x33f9c3[_0x3491c1(0x102)]?.[_0x3491c1(0x121)]),console['log']('Amount:',_0x33f9c3[_0x3491c1(0x102)]?.[_0x3491c1(0xbe)]),console[_0x3491c1(0xf0)](_0x3491c1(0x125),_0x33f9c3[_0x3491c1(0x102)]?.[_0x3491c1(0x107)]);if(_0x33f9c3['result']!==_0x3491c1(0x11b)||_0x33f9c3[_0x3491c1(0x103)]!==0xc8){const _0x1c2d64=_0x33f9c3['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x3491c1(0xba)](_0x3491c1(0x135)),console[_0x3491c1(0xba)](_0x3491c1(0x10d),_0x1c2d64),loggerService_1[_0x3491c1(0xbb)]['logWhiteDomainError'](_0x3491c1(0x11a),'/status',_0x3491c1(0xb8)+_0x1c2d64);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1c2d64);}if(!_0x33f9c3[_0x3491c1(0x102)]){console[_0x3491c1(0xba)](_0x3491c1(0xb6)),console[_0x3491c1(0xba)](_0x3491c1(0xd8)),loggerService_1[_0x3491c1(0xbb)][_0x3491c1(0xf6)](_0x3491c1(0x11a),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3491c1(0x10b));}let _0x580b72='PENDING';switch(_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0x121)]?.[_0x3491c1(0xd6)]()){case _0x3491c1(0xd0):_0x580b72=_0x3491c1(0x120);break;case _0x3491c1(0x116):case _0x3491c1(0x111):case _0x3491c1(0xba):_0x580b72=_0x3491c1(0xc2);break;case _0x3491c1(0xe5):case _0x3491c1(0x11e):_0x580b72=_0x3491c1(0x10e);break;case _0x3491c1(0xce):case'awaiting\x20fiat':case _0x3491c1(0xf3):case _0x3491c1(0xb7):default:_0x580b72=_0x3491c1(0xe4);break;}let _0x59cfdb,_0x402c57;if(_0x33f9c3[_0x3491c1(0x102)]['PaymentDetail']){const _0x292daf=_0x33f9c3[_0x3491c1(0x102)]['PaymentDetail'];console[_0x3491c1(0xf0)](_0x3491c1(0xc5),_0x292daf);const _0x5bc789=_0x292daf[_0x3491c1(0xcf)](/IBAN\s+([A-Z0-9]+)/i);_0x5bc789&&(_0x59cfdb=_0x5bc789[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x59cfdb)),_0x402c57=_0x292daf;}const _0x2b7ff4={'iban':_0x59cfdb,'bankDetails':_0x402c57,'transactionId':_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0x133)],'coinAddress':_0x33f9c3['data'][_0x3491c1(0x12d)],'qrCodeUrl':_0x33f9c3[_0x3491c1(0x102)]['QRCodeURL'],'expiryTime':_0x33f9c3[_0x3491c1(0x102)]['ExpiryTime'],'createdOn':_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0xda)],'confirmedOn':_0x33f9c3[_0x3491c1(0x102)]['TransactionConfirmedOn']};console[_0x3491c1(0xf0)](_0x3491c1(0x12e)),console[_0x3491c1(0xf0)](_0x3491c1(0xe8),_0x33f9c3[_0x3491c1(0x102)]['Status'],'->',_0x580b72),console[_0x3491c1(0xf0)](_0x3491c1(0xe1),_0x33f9c3['data']['Amount'],_0x33f9c3['data'][_0x3491c1(0x107)]),console[_0x3491c1(0xf0)]('Transaction\x20ID:',_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0x133)]),console[_0x3491c1(0xf0)]('IBAN:',_0x59cfdb||_0x3491c1(0x127)),console['log'](_0x3491c1(0x11f),_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0xda)]),console[_0x3491c1(0xf0)]('Confirmed\x20On:',_0x33f9c3['data'][_0x3491c1(0xb5)]||'not\x20confirmed');if(_0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0x121)]?.[_0x3491c1(0xd6)]()===_0x3491c1(0x112))console[_0x3491c1(0xf0)](_0x3491c1(0xfc));else _0x33f9c3[_0x3491c1(0x102)][_0x3491c1(0x121)]?.['toLowerCase']()==='paid'&&console[_0x3491c1(0xf0)](_0x3491c1(0xb3));return{'status':_0x580b72,'amount':parseFloat(_0x33f9c3['data']['Amount'])||undefined,'currency':_0x33f9c3[_0x3491c1(0x102)]['inputCurrency']||'EUR','paymentDetails':_0x2b7ff4};}catch(_0x320b44){console[_0x3491c1(0xba)](_0x3491c1(0x132),_0x320b44),loggerService_1[_0x3491c1(0xbb)][_0x3491c1(0xf6)](_0x3491c1(0x11a),'/status',_0x320b44);throw new Error(_0x3491c1(0xe0)+(_0x320b44 instanceof Error?_0x320b44['message']:_0x3491c1(0xfb)));}}async[a40_0x2aa387(0xd5)](_0x1a5a93){const _0x48575d=a40_0x2aa387,_0x258b81=await this[_0x48575d(0xf2)](_0x1a5a93);return{'status':_0x258b81[_0x48575d(0x108)],'amount':_0x258b81[_0x48575d(0xc8)],'currency':_0x258b81[_0x48575d(0xfd)]};}async[a40_0x2aa387(0x113)](_0x4e9971){const _0x56c8dc=a40_0x2aa387;console[_0x56c8dc(0xf0)](_0x56c8dc(0xc3),_0x4e9971);let _0x489d8f=_0x56c8dc(0xe4);switch(_0x4e9971['status']?.[_0x56c8dc(0xd6)]()){case _0x56c8dc(0xd0):_0x489d8f=_0x56c8dc(0x120);break;case _0x56c8dc(0x116):case _0x56c8dc(0x111):case _0x56c8dc(0xba):_0x489d8f=_0x56c8dc(0xc2);break;case'expired':case _0x56c8dc(0x11e):_0x489d8f=_0x56c8dc(0x10e);break;case _0x56c8dc(0xf3):case _0x56c8dc(0xce):case _0x56c8dc(0x112):case'created':default:_0x489d8f='PENDING';break;}return{'paymentId':_0x4e9971[_0x56c8dc(0x10c)]||_0x4e9971[_0x56c8dc(0xfe)]||'','status':_0x489d8f,'amount':_0x4e9971['amount'],'currency':_0x4e9971[_0x56c8dc(0xfd)]||_0x56c8dc(0xbc)};}}exports[a40_0x2aa387(0xd4)]=CoinToPayService;