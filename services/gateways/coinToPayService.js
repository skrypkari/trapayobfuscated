'use strict';const a43_0x23300f=a43_0xf3ad;(function(_0x1b5113,_0x14d6d6){const _0x3c7c3e=a43_0xf3ad,_0x307d73=_0x1b5113();while(!![]){try{const _0x1d2741=-parseInt(_0x3c7c3e(0x133))/0x1*(-parseInt(_0x3c7c3e(0x18b))/0x2)+parseInt(_0x3c7c3e(0x192))/0x3*(-parseInt(_0x3c7c3e(0x130))/0x4)+parseInt(_0x3c7c3e(0x139))/0x5*(parseInt(_0x3c7c3e(0x167))/0x6)+-parseInt(_0x3c7c3e(0x155))/0x7*(-parseInt(_0x3c7c3e(0x18e))/0x8)+parseInt(_0x3c7c3e(0x15e))/0x9*(-parseInt(_0x3c7c3e(0x17c))/0xa)+-parseInt(_0x3c7c3e(0x172))/0xb+parseInt(_0x3c7c3e(0x16e))/0xc*(parseInt(_0x3c7c3e(0x141))/0xd);if(_0x1d2741===_0x14d6d6)break;else _0x307d73['push'](_0x307d73['shift']());}catch(_0x3ae12b){_0x307d73['push'](_0x307d73['shift']());}}}(a43_0x32a5,0x516ee));Object[a43_0x23300f(0x18a)](exports,'__esModule',{'value':!![]}),exports[a43_0x23300f(0x12a)]=void 0x0;const loggerService_1=require(a43_0x23300f(0x191));class CoinToPayService{constructor(){const _0x573c1a=a43_0x23300f;this[_0x573c1a(0x14e)]='https://tesoft.uk/gateway/cointopay/',this[_0x573c1a(0x193)]=_0x573c1a(0x151),console['log']('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x573c1a(0x128)](_0x573c1a(0x181),this[_0x573c1a(0x193)]);}async[a43_0x23300f(0x17b)](_0x15483a){const _0x5c0e24=a43_0x23300f,{orderId:_0xc79fd9,amount:_0x5f08e7}=_0x15483a;console[_0x5c0e24(0x128)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x5f08e7+_0x5c0e24(0x17f));const _0x5463f3={'amount':_0x5f08e7},_0x4d75d9=Date[_0x5c0e24(0x17d)]();try{console['log'](_0x5c0e24(0x19e)),console[_0x5c0e24(0x128)](_0x5c0e24(0x1ac),this[_0x5c0e24(0x14e)]),console[_0x5c0e24(0x128)](_0x5c0e24(0x16d),JSON['stringify'](_0x5463f3,null,0x2)),console[_0x5c0e24(0x128)]('Amount:',_0x5f08e7,_0x5c0e24(0x184)),loggerService_1['loggerService'][_0x5c0e24(0x177)]('cointopay',_0x5c0e24(0x185),_0x5c0e24(0x183),_0x5463f3);const _0x594217=await fetch(this[_0x5c0e24(0x14e)],{'method':_0x5c0e24(0x183),'headers':{'Content-Type':_0x5c0e24(0x15a),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5463f3)}),_0x36277c=Date[_0x5c0e24(0x17d)]()-_0x4d75d9;console[_0x5c0e24(0x128)](_0x5c0e24(0x19d)),console[_0x5c0e24(0x128)]('Status:',_0x594217[_0x5c0e24(0x15d)]),console[_0x5c0e24(0x128)](_0x5c0e24(0x158),_0x594217['statusText']),console['log'](_0x5c0e24(0x1ad),Object[_0x5c0e24(0x13a)](_0x594217['headers'][_0x5c0e24(0x166)]())),console['log']('Response\x20Time:',_0x36277c+'ms');const _0x5838bf=await _0x594217[_0x5c0e24(0x140)]();console[_0x5c0e24(0x128)](_0x5c0e24(0x179),_0x5838bf);if(!_0x594217['ok']){console[_0x5c0e24(0x162)](_0x5c0e24(0x150)),console[_0x5c0e24(0x162)]('HTTP\x20Status:',_0x594217['status']),console[_0x5c0e24(0x162)](_0x5c0e24(0x173),_0x5838bf),loggerService_1[_0x5c0e24(0x19f)]['logWhiteDomainResponse'](_0x5c0e24(0x14c),'/create',_0x594217['status'],_0x5838bf,_0x36277c),loggerService_1['loggerService'][_0x5c0e24(0x148)]('cointopay','/create',_0x5c0e24(0x156)+_0x594217[_0x5c0e24(0x15d)]+':\x20'+_0x5838bf);throw new Error(_0x5c0e24(0x182)+_0x594217[_0x5c0e24(0x15d)]+_0x5c0e24(0x19b)+_0x5838bf);}let _0x860a54;try{_0x860a54=JSON['parse'](_0x5838bf);}catch(_0x4826a8){console[_0x5c0e24(0x162)](_0x5c0e24(0x147),_0x4826a8),loggerService_1[_0x5c0e24(0x19f)][_0x5c0e24(0x148)](_0x5c0e24(0x14c),_0x5c0e24(0x185),_0x5c0e24(0x16c)+_0x4826a8);throw new Error(_0x5c0e24(0x134)+_0x5838bf);}console[_0x5c0e24(0x128)](_0x5c0e24(0x198)),console[_0x5c0e24(0x128)](_0x5c0e24(0x163),JSON['stringify'](_0x860a54,null,0x2)),loggerService_1['loggerService'][_0x5c0e24(0x127)](_0x5c0e24(0x14c),'/create',_0x594217[_0x5c0e24(0x15d)],_0x860a54,_0x36277c);if(_0x860a54['error']){const _0x47a3da=_0x860a54[_0x5c0e24(0x129)]||_0x860a54['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x5c0e24(0x162)](_0x5c0e24(0x18f)),console[_0x5c0e24(0x162)](_0x5c0e24(0x132),_0x47a3da),loggerService_1['loggerService'][_0x5c0e24(0x148)](_0x5c0e24(0x14c),_0x5c0e24(0x185),_0x5c0e24(0x124)+_0x47a3da);throw new Error(_0x5c0e24(0x12b)+_0x47a3da);}if(!_0x860a54[_0x5c0e24(0x190)]||!_0x860a54[_0x5c0e24(0x189)]){console[_0x5c0e24(0x162)](_0x5c0e24(0x131)),console[_0x5c0e24(0x162)](_0x5c0e24(0x15b)),console[_0x5c0e24(0x162)](_0x5c0e24(0x1a7),_0x860a54),loggerService_1[_0x5c0e24(0x19f)][_0x5c0e24(0x148)]('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x5c0e24(0x16a));}return console[_0x5c0e24(0x128)](_0x5c0e24(0x143)),console[_0x5c0e24(0x128)](_0x5c0e24(0x138),_0x860a54['gateway_payment_id']),console['log'](_0x5c0e24(0x194),_0x860a54['payment_url']),console[_0x5c0e24(0x128)]('Amount:',_0x5f08e7,_0x5c0e24(0x13e)),{'gateway_payment_id':_0x860a54['gateway_payment_id'],'payment_url':_0x860a54['payment_url']};}catch(_0x3f34ec){console[_0x5c0e24(0x162)](_0x5c0e24(0x171)),console[_0x5c0e24(0x162)]('Error\x20details:',_0x3f34ec),loggerService_1[_0x5c0e24(0x19f)][_0x5c0e24(0x148)](_0x5c0e24(0x14c),_0x5c0e24(0x185),_0x3f34ec);if(_0x3f34ec instanceof Error){console[_0x5c0e24(0x162)]('Error\x20message:',_0x3f34ec['message']),console[_0x5c0e24(0x162)](_0x5c0e24(0x13d),_0x3f34ec['stack']);throw new Error(_0x5c0e24(0x154)+_0x3f34ec[_0x5c0e24(0x129)]);}throw new Error(_0x5c0e24(0x1a5));}}async[a43_0x23300f(0x12d)](_0x19e0d7){const _0xfd2a28=a43_0x23300f,_0x524405=Date[_0xfd2a28(0x17d)]();try{console[_0xfd2a28(0x128)](_0xfd2a28(0x199)+_0x19e0d7);const _0x46d806={'gatewayPaymentId':_0x19e0d7};loggerService_1[_0xfd2a28(0x19f)][_0xfd2a28(0x177)](_0xfd2a28(0x14c),_0xfd2a28(0x175),_0xfd2a28(0x183),_0x46d806);const _0x1557c2=await fetch(this['statusUrl'],{'method':_0xfd2a28(0x183),'headers':{'Content-Type':_0xfd2a28(0x15a),'Accept':'application/json','User-Agent':_0xfd2a28(0x170)},'body':JSON[_0xfd2a28(0x144)](_0x46d806)}),_0x3a7ea9=Date[_0xfd2a28(0x17d)]()-_0x524405;console[_0xfd2a28(0x128)](_0xfd2a28(0x14b)),console['log'](_0xfd2a28(0x18c),_0x1557c2[_0xfd2a28(0x15d)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x178),_0x3a7ea9+'ms');if(!_0x1557c2['ok']){const _0x3b6cd2=await _0x1557c2[_0xfd2a28(0x140)]();console['error'](_0xfd2a28(0x195),_0x1557c2[_0xfd2a28(0x15d)]),console[_0xfd2a28(0x162)](_0xfd2a28(0x173),_0x3b6cd2),loggerService_1[_0xfd2a28(0x19f)][_0xfd2a28(0x127)](_0xfd2a28(0x14c),_0xfd2a28(0x175),_0x1557c2[_0xfd2a28(0x15d)],_0x3b6cd2,_0x3a7ea9),loggerService_1['loggerService'][_0xfd2a28(0x148)]('cointopay',_0xfd2a28(0x175),_0xfd2a28(0x156)+_0x1557c2[_0xfd2a28(0x15d)]+':\x20'+_0x3b6cd2);throw new Error(_0xfd2a28(0x182)+_0x1557c2[_0xfd2a28(0x15d)]);}const _0x40e80b=await _0x1557c2[_0xfd2a28(0x140)]();console['log']('Raw\x20Response\x20Body:',_0x40e80b);let _0x1b3db3;try{_0x1b3db3=JSON[_0xfd2a28(0x165)](_0x40e80b);}catch(_0x43c315){console[_0xfd2a28(0x162)](_0xfd2a28(0x147),_0x43c315),loggerService_1[_0xfd2a28(0x19f)][_0xfd2a28(0x148)](_0xfd2a28(0x14c),'/status',_0xfd2a28(0x16c)+_0x43c315);throw new Error(_0xfd2a28(0x137)+_0x40e80b);}loggerService_1[_0xfd2a28(0x19f)][_0xfd2a28(0x127)](_0xfd2a28(0x14c),_0xfd2a28(0x175),_0x1557c2[_0xfd2a28(0x15d)],_0x1b3db3,_0x3a7ea9),console[_0xfd2a28(0x128)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0xfd2a28(0x128)]('Result:',_0x1b3db3[_0xfd2a28(0x186)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x153),_0x1b3db3[_0xfd2a28(0x13f)]),console[_0xfd2a28(0x128)]('Payment\x20Status:',_0x1b3db3['data']?.[_0xfd2a28(0x149)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x161),_0x1b3db3[_0xfd2a28(0x1aa)]?.['Amount']),console[_0xfd2a28(0x128)](_0xfd2a28(0x12e),_0x1b3db3['data']?.[_0xfd2a28(0x14d)]);if(_0x1b3db3[_0xfd2a28(0x186)]!==_0xfd2a28(0x14a)||_0x1b3db3['status_code']!==0xc8){const _0x42b129=_0x1b3db3[_0xfd2a28(0x129)]||_0xfd2a28(0x17a);console[_0xfd2a28(0x162)](_0xfd2a28(0x169)),console[_0xfd2a28(0x162)](_0xfd2a28(0x132),_0x42b129),loggerService_1[_0xfd2a28(0x19f)][_0xfd2a28(0x148)](_0xfd2a28(0x14c),_0xfd2a28(0x175),'Status\x20API\x20Error:\x20'+_0x42b129);throw new Error(_0xfd2a28(0x1a2)+_0x42b129);}if(!_0x1b3db3['data']){console[_0xfd2a28(0x162)](_0xfd2a28(0x17e)),console[_0xfd2a28(0x162)](_0xfd2a28(0x12c)),loggerService_1[_0xfd2a28(0x19f)]['logWhiteDomainError'](_0xfd2a28(0x14c),_0xfd2a28(0x175),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0xfd2a28(0x15c));}let _0x1c9706=_0xfd2a28(0x1a9);switch(_0x1b3db3['data'][_0xfd2a28(0x149)]?.[_0xfd2a28(0x125)]()){case _0xfd2a28(0x1a8):_0x1c9706='PAID';break;case _0xfd2a28(0x19a):case _0xfd2a28(0x152):case _0xfd2a28(0x162):_0x1c9706=_0xfd2a28(0x16f);break;case'expired':case _0xfd2a28(0x1a1):_0x1c9706=_0xfd2a28(0x176);break;case'waiting':case _0xfd2a28(0x168):case _0xfd2a28(0x14f):case _0xfd2a28(0x159):default:_0x1c9706=_0xfd2a28(0x1a9);break;}let _0x567a2f,_0x57947c;if(_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x164)]){const _0x2c9a30=_0x1b3db3['data']['PaymentDetail'];console[_0xfd2a28(0x128)]('🏦\x20Payment\x20Detail:',_0x2c9a30);const _0x5292ac=_0x2c9a30['match'](/IBAN\s+([A-Z0-9]+)/i);_0x5292ac&&(_0x567a2f=_0x5292ac[0x1],console[_0xfd2a28(0x128)](_0xfd2a28(0x188),_0x567a2f)),_0x57947c=_0x2c9a30;}const _0x40a0d8={'iban':_0x567a2f,'bankDetails':_0x57947c,'transactionId':_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x160)],'coinAddress':_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x142)],'qrCodeUrl':_0x1b3db3[_0xfd2a28(0x1aa)]['QRCodeURL'],'expiryTime':_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x180)],'createdOn':_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x19c)],'confirmedOn':_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x15f)]};console['log'](_0xfd2a28(0x136)),console[_0xfd2a28(0x128)](_0xfd2a28(0x18c),_0x1b3db3['data'][_0xfd2a28(0x149)],'->',_0x1c9706),console[_0xfd2a28(0x128)](_0xfd2a28(0x161),_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x135)],_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x14d)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x145),_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x160)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x126),_0x567a2f||_0xfd2a28(0x1a3)),console[_0xfd2a28(0x128)]('Created\x20On:',_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x19c)]),console[_0xfd2a28(0x128)](_0xfd2a28(0x196),_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x15f)]||_0xfd2a28(0x174));if(_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x149)]?.[_0xfd2a28(0x125)]()===_0xfd2a28(0x168))console[_0xfd2a28(0x128)](_0xfd2a28(0x12f));else _0x1b3db3['data']['Status']?.[_0xfd2a28(0x125)]()===_0xfd2a28(0x1a8)&&console[_0xfd2a28(0x128)](_0xfd2a28(0x18d));return{'status':_0x1c9706,'amount':parseFloat(_0x1b3db3[_0xfd2a28(0x1aa)][_0xfd2a28(0x135)])||undefined,'currency':_0x1b3db3[_0xfd2a28(0x1aa)]['inputCurrency']||'EUR','paymentDetails':_0x40a0d8};}catch(_0x3d77df){console[_0xfd2a28(0x162)](_0xfd2a28(0x1a4),_0x3d77df),loggerService_1[_0xfd2a28(0x19f)]['logWhiteDomainError'](_0xfd2a28(0x14c),_0xfd2a28(0x175),_0x3d77df);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3d77df instanceof Error?_0x3d77df[_0xfd2a28(0x129)]:_0xfd2a28(0x146)));}}async[a43_0x23300f(0x1a0)](_0x4fdbf2){const _0x5ed8f4=a43_0x23300f,_0x1e05f8=await this[_0x5ed8f4(0x12d)](_0x4fdbf2);return{'status':_0x1e05f8[_0x5ed8f4(0x15d)],'amount':_0x1e05f8[_0x5ed8f4(0x1a6)],'currency':_0x1e05f8[_0x5ed8f4(0x157)]};}async[a43_0x23300f(0x13b)](_0x5d5f84){const _0x120b98=a43_0x23300f;console['log'](_0x120b98(0x1ab),_0x5d5f84);let _0x395a0f=_0x120b98(0x1a9);switch(_0x5d5f84['status']?.[_0x120b98(0x125)]()){case'paid':_0x395a0f=_0x120b98(0x16b);break;case _0x120b98(0x19a):case _0x120b98(0x152):case _0x120b98(0x162):_0x395a0f=_0x120b98(0x16f);break;case _0x120b98(0x13c):case _0x120b98(0x1a1):_0x395a0f=_0x120b98(0x176);break;case _0x120b98(0x14f):case'waiting':case _0x120b98(0x168):case _0x120b98(0x159):default:_0x395a0f=_0x120b98(0x1a9);break;}return{'paymentId':_0x5d5f84[_0x120b98(0x197)]||_0x5d5f84[_0x120b98(0x187)]||'','status':_0x395a0f,'amount':_0x5d5f84[_0x120b98(0x1a6)],'currency':_0x5d5f84[_0x120b98(0x157)]||'EUR'};}}exports[a43_0x23300f(0x12a)]=CoinToPayService;function a43_0xf3ad(_0x529548,_0x13c4de){const _0x32a597=a43_0x32a5();return a43_0xf3ad=function(_0xf3adf8,_0x1858fd){_0xf3adf8=_0xf3adf8-0x124;let _0x2c0f87=_0x32a597[_0xf3adf8];return _0x2c0f87;},a43_0xf3ad(_0x529548,_0x13c4de);}function a43_0x32a5(){const _0x2c044c=['toLowerCase','IBAN:','logWhiteDomainResponse','log','message','CoinToPayService','CoinToPay\x20API\x20error:\x20','Missing\x20data\x20in\x20response','checkPaymentStatus','Currency:','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','340xIbngB','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20Message:','91GTvwDe','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Amount','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Gateway\x20Payment\x20ID:','145295jzMDoE','fromEntries','processWebhook','expired','Error\x20stack:','EUR','status_code','text','212550VyiMNh','coinAddress','===\x20COINTOPAY\x20SUCCESS\x20===','stringify','Transaction\x20ID:','Unknown\x20error','Failed\x20to\x20parse\x20JSON\x20response:','logWhiteDomainError','Status','success','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','cointopay','inputCurrency','apiUrl','pending','===\x20COINTOPAY\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/status.php','failed','Status\x20Code:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','4375EUpwVE','HTTP\x20','currency','Status\x20Text:','created','application/json','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','status','5243877USesUf','TransactionConfirmedOn','TransactionID','Amount:','error','Parsed\x20Result:','PaymentDetail','parse','entries','24VXpwoY','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PAID','JSON\x20Parse\x20Error:\x20','Request\x20Body:','516iwkllj','FAILED','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','6967851RDdnob','Response\x20Body:','not\x20confirmed','/status','EXPIRED','logWhiteDomainRequest','Response\x20Time:','Raw\x20Response\x20Body:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','createPaymentLink','10pEeSob','now','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','\x20EUR','ExpiryTime','📊\x20Status\x20check\x20URL:','HTTP\x20error!\x20status:\x20','POST','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','/create','result','merchant_reference_id','🏦\x20Extracted\x20IBAN:','gateway_payment_id','defineProperty','5636EhDHWS','Status:','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','6472IWGIQY','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','payment_url','../loggerService','1119irzuJU','statusUrl','Payment\x20URL:','HTTP\x20Status:','Confirmed\x20On:','order_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cancelled',',\x20body:\x20','CreatedOn','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','loggerService','verifyPayment','timeout','CoinToPay\x20status\x20API\x20error:\x20','not\x20found','CoinToPay\x20payment\x20status\x20check\x20error:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','amount','Response\x20data:','paid','PENDING','data','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','URL:','Headers:','Business\x20Error:\x20'];a43_0x32a5=function(){return _0x2c044c;};return a43_0x32a5();}