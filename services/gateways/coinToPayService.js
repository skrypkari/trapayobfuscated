'use strict';const a40_0x47e507=a40_0x41fe;function a40_0x41fe(_0x3791fa,_0x230f0b){const _0x42e380=a40_0x42e3();return a40_0x41fe=function(_0x41feec,_0x446c2b){_0x41feec=_0x41feec-0xec;let _0xc02eef=_0x42e380[_0x41feec];return _0xc02eef;},a40_0x41fe(_0x3791fa,_0x230f0b);}(function(_0x151360,_0x1aeaea){const _0x3f90ee=a40_0x41fe,_0x57ad26=_0x151360();while(!![]){try{const _0x277db3=-parseInt(_0x3f90ee(0x103))/0x1+-parseInt(_0x3f90ee(0x15b))/0x2+parseInt(_0x3f90ee(0xf9))/0x3+-parseInt(_0x3f90ee(0x128))/0x4*(parseInt(_0x3f90ee(0xfd))/0x5)+-parseInt(_0x3f90ee(0x109))/0x6*(-parseInt(_0x3f90ee(0x166))/0x7)+parseInt(_0x3f90ee(0x135))/0x8+-parseInt(_0x3f90ee(0x140))/0x9*(-parseInt(_0x3f90ee(0x132))/0xa);if(_0x277db3===_0x1aeaea)break;else _0x57ad26['push'](_0x57ad26['shift']());}catch(_0x2ed9b8){_0x57ad26['push'](_0x57ad26['shift']());}}}(a40_0x42e3,0x91280));function a40_0x42e3(){const _0x5708b6=['fromEntries','message','CoinToPay\x20API\x20error:\x20','match','logWhiteDomainError','TesSoft\x20Payment\x20System/1.0','IBAN:','verifyPayment','3989764iVePnD','currency','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Missing\x20data\x20in\x20response','EUR','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','data','Headers:','Status\x20API\x20Error:\x20','toLowerCase','190OMKrmW','headers',',\x20body:\x20','2148736qdeQhm','TransactionID','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','expired','log','merchant_reference_id','stringify','loggerService','stack','order_id','failed','723024MNbeFk','https://tesoft.uk/gateway/cointopay/','CreatedOn','Raw\x20Response\x20Body:','ExpiryTime','EXPIRED','logWhiteDomainResponse','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Parsed\x20Result:','HTTP\x20Status:','success','apiUrl','__esModule','PENDING','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/status.php','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Response\x20Body:','Created\x20On:','checkPaymentStatus','PAID','Business\x20Error:\x20','1097322aghIsS','timeout','JSON\x20Parse\x20Error:\x20','entries','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','statusText','status','coinAddress','Currency:','status_code','Error\x20details:','203HOMCJv','Response\x20Time:','===\x20COINTOPAY\x20SUCCESS\x20===','not\x20found','created','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Confirmed\x20On:','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','createPaymentLink','CoinToPayService','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status','Status:','Request\x20Body:','/status','now','payment_url','Error\x20stack:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Amount:','statusUrl','error','Payment\x20Status:','PaymentDetail','/create','üè¶\x20Payment\x20Detail:','CoinToPay\x20status\x20API\x20error:\x20','1745991fSddjZ','result','gateway_payment_id','parse','5PQcnCX','../loggerService','amount','üè¶\x20Extracted\x20IBAN:','inputCurrency','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','592170FpUFHS','waiting','Error\x20Message:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Transaction\x20ID:','cointopay','73626qgHYAA','Unknown\x20error\x20from\x20CoinToPay\x20API','Status\x20Code:','awaiting\x20fiat','Unknown\x20error','pending','Amount','TransactionConfirmedOn','cancelled','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','üìä\x20Status\x20check\x20URL:','POST','paid','FAILED','Error\x20message:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Result:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','application/json'];a40_0x42e3=function(){return _0x5708b6;};return a40_0x42e3();}Object['defineProperty'](exports,a40_0x47e507(0x14e),{'value':!![]}),exports[a40_0x47e507(0x171)]=void 0x0;const loggerService_1=require(a40_0x47e507(0xfe));class CoinToPayService{constructor(){const _0x895a41=a40_0x47e507;this[_0x895a41(0x14d)]=_0x895a41(0x141),this[_0x895a41(0xf2)]=_0x895a41(0x154),console[_0x895a41(0x139)](_0x895a41(0x11e)),console[_0x895a41(0x139)](_0x895a41(0x113),this[_0x895a41(0xf2)]);}async[a40_0x47e507(0x170)](_0x109f8f){const _0x694755=a40_0x47e507,{orderId:_0x144453,amount:_0x6e431b}=_0x109f8f;console[_0x694755(0x139)](_0x694755(0x112)+_0x6e431b+'\x20EUR');const _0x4e0a6e={'amount':_0x6e431b},_0x59e19f=Date[_0x694755(0xed)]();try{console['log'](_0x694755(0x150)),console[_0x694755(0x139)]('URL:',this[_0x694755(0x14d)]),console[_0x694755(0x139)](_0x694755(0x176),JSON[_0x694755(0x13b)](_0x4e0a6e,null,0x2)),console[_0x694755(0x139)](_0x694755(0xf1),_0x6e431b,_0x694755(0x12a)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x694755(0x108),_0x694755(0xf6),'POST',_0x4e0a6e);const _0x541bcb=await fetch(this[_0x694755(0x14d)],{'method':_0x694755(0x114),'headers':{'Content-Type':'application/json','Accept':_0x694755(0x11f),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x694755(0x13b)](_0x4e0a6e)}),_0x448bad=Date['now']()-_0x59e19f;console['log'](_0x694755(0x106)),console[_0x694755(0x139)](_0x694755(0x175),_0x541bcb[_0x694755(0x161)]),console[_0x694755(0x139)]('Status\x20Text:',_0x541bcb[_0x694755(0x160)]),console['log'](_0x694755(0x12f),Object[_0x694755(0x120)](_0x541bcb[_0x694755(0x133)][_0x694755(0x15e)]())),console[_0x694755(0x139)](_0x694755(0x167),_0x448bad+'ms');const _0x5d9ac0=await _0x541bcb['text']();console['log']('Raw\x20Response\x20Body:',_0x5d9ac0);if(!_0x541bcb['ok']){console[_0x694755(0xf3)](_0x694755(0x16f)),console[_0x694755(0xf3)]('HTTP\x20Status:',_0x541bcb[_0x694755(0x161)]),console[_0x694755(0xf3)](_0x694755(0x156),_0x5d9ac0),loggerService_1[_0x694755(0x13c)][_0x694755(0x146)](_0x694755(0x108),_0x694755(0xf6),_0x541bcb[_0x694755(0x161)],_0x5d9ac0,_0x448bad),loggerService_1['loggerService'][_0x694755(0x124)]('cointopay',_0x694755(0xf6),'HTTP\x20'+_0x541bcb['status']+':\x20'+_0x5d9ac0);throw new Error(_0x694755(0x16e)+_0x541bcb[_0x694755(0x161)]+_0x694755(0x134)+_0x5d9ac0);}let _0x4b5e4f;try{_0x4b5e4f=JSON[_0x694755(0xfc)](_0x5d9ac0);}catch(_0x140399){console[_0x694755(0xf3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x140399),loggerService_1[_0x694755(0x13c)][_0x694755(0x124)](_0x694755(0x108),_0x694755(0xf6),_0x694755(0x15d)+_0x140399);throw new Error(_0x694755(0x11d)+_0x5d9ac0);}console[_0x694755(0x139)](_0x694755(0x11c)),console['log'](_0x694755(0x14a),JSON['stringify'](_0x4b5e4f,null,0x2)),loggerService_1['loggerService'][_0x694755(0x146)]('cointopay',_0x694755(0xf6),_0x541bcb['status'],_0x4b5e4f,_0x448bad);if(_0x4b5e4f[_0x694755(0xf3)]){const _0x54ea4c=_0x4b5e4f[_0x694755(0x121)]||_0x4b5e4f[_0x694755(0xf3)]||_0x694755(0x10a);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x694755(0xf3)](_0x694755(0x105),_0x54ea4c),loggerService_1[_0x694755(0x13c)][_0x694755(0x124)]('cointopay',_0x694755(0xf6),_0x694755(0x15a)+_0x54ea4c);throw new Error(_0x694755(0x122)+_0x54ea4c);}if(!_0x4b5e4f['payment_url']||!_0x4b5e4f['gateway_payment_id']){console['error'](_0x694755(0x148)),console[_0x694755(0xf3)](_0x694755(0x102)),console[_0x694755(0xf3)]('Response\x20data:',_0x4b5e4f),loggerService_1['loggerService'][_0x694755(0x124)]('cointopay',_0x694755(0xf6),_0x694755(0x137));throw new Error(_0x694755(0x15f));}return console[_0x694755(0x139)](_0x694755(0x168)),console['log']('Gateway\x20Payment\x20ID:',_0x4b5e4f[_0x694755(0xfb)]),console[_0x694755(0x139)]('Payment\x20URL:',_0x4b5e4f[_0x694755(0xee)]),console[_0x694755(0x139)]('Amount:',_0x6e431b,'EUR'),{'gateway_payment_id':_0x4b5e4f[_0x694755(0xfb)],'payment_url':_0x4b5e4f['payment_url']};}catch(_0x4d5720){console['error'](_0x694755(0xf0)),console[_0x694755(0xf3)](_0x694755(0x165),_0x4d5720),loggerService_1['loggerService']['logWhiteDomainError'](_0x694755(0x108),_0x694755(0xf6),_0x4d5720);if(_0x4d5720 instanceof Error){console[_0x694755(0xf3)](_0x694755(0x117),_0x4d5720[_0x694755(0x121)]),console[_0x694755(0xf3)](_0x694755(0xef),_0x4d5720[_0x694755(0x13d)]);throw new Error(_0x694755(0x11b)+_0x4d5720['message']);}throw new Error(_0x694755(0x12d));}}async[a40_0x47e507(0x158)](_0x45050a){const _0x4fa332=a40_0x47e507,_0x33697d=Date[_0x4fa332(0xed)]();try{console[_0x4fa332(0x139)](_0x4fa332(0x173)+_0x45050a);const _0x263ddf={'gatewayPaymentId':_0x45050a};loggerService_1[_0x4fa332(0x13c)]['logWhiteDomainRequest'](_0x4fa332(0x108),_0x4fa332(0xec),_0x4fa332(0x114),_0x263ddf);const _0x411e62=await fetch(this[_0x4fa332(0xf2)],{'method':_0x4fa332(0x114),'headers':{'Content-Type':_0x4fa332(0x11f),'Accept':_0x4fa332(0x11f),'User-Agent':_0x4fa332(0x125)},'body':JSON['stringify'](_0x263ddf)}),_0x22908c=Date['now']()-_0x33697d;console[_0x4fa332(0x139)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x4fa332(0x139)](_0x4fa332(0x175),_0x411e62[_0x4fa332(0x161)]),console[_0x4fa332(0x139)](_0x4fa332(0x167),_0x22908c+'ms');if(!_0x411e62['ok']){const _0x56fc06=await _0x411e62['text']();console[_0x4fa332(0xf3)](_0x4fa332(0x14b),_0x411e62[_0x4fa332(0x161)]),console['error'](_0x4fa332(0x156),_0x56fc06),loggerService_1['loggerService'][_0x4fa332(0x146)]('cointopay','/status',_0x411e62[_0x4fa332(0x161)],_0x56fc06,_0x22908c),loggerService_1[_0x4fa332(0x13c)]['logWhiteDomainError'](_0x4fa332(0x108),_0x4fa332(0xec),'HTTP\x20'+_0x411e62['status']+':\x20'+_0x56fc06);throw new Error(_0x4fa332(0x16e)+_0x411e62[_0x4fa332(0x161)]);}const _0x54ced4=await _0x411e62['text']();console[_0x4fa332(0x139)](_0x4fa332(0x143),_0x54ced4);let _0x211859;try{_0x211859=JSON['parse'](_0x54ced4);}catch(_0x5014ca){console[_0x4fa332(0xf3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x5014ca),loggerService_1['loggerService'][_0x4fa332(0x124)](_0x4fa332(0x108),_0x4fa332(0xec),_0x4fa332(0x15d)+_0x5014ca);throw new Error(_0x4fa332(0x11a)+_0x54ced4);}loggerService_1[_0x4fa332(0x13c)][_0x4fa332(0x146)](_0x4fa332(0x108),'/status',_0x411e62[_0x4fa332(0x161)],_0x211859,_0x22908c),console[_0x4fa332(0x139)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x4fa332(0x119),_0x211859[_0x4fa332(0xfa)]),console[_0x4fa332(0x139)](_0x4fa332(0x10b),_0x211859['status_code']),console['log'](_0x4fa332(0xf4),_0x211859[_0x4fa332(0x12e)]?.[_0x4fa332(0x174)]),console[_0x4fa332(0x139)](_0x4fa332(0xf1),_0x211859[_0x4fa332(0x12e)]?.[_0x4fa332(0x10f)]),console[_0x4fa332(0x139)](_0x4fa332(0x163),_0x211859[_0x4fa332(0x12e)]?.[_0x4fa332(0x101)]);if(_0x211859[_0x4fa332(0xfa)]!==_0x4fa332(0x14c)||_0x211859[_0x4fa332(0x164)]!==0xc8){const _0x3caaa5=_0x211859[_0x4fa332(0x121)]||_0x4fa332(0x147);console['error'](_0x4fa332(0x153)),console[_0x4fa332(0xf3)](_0x4fa332(0x105),_0x3caaa5),loggerService_1[_0x4fa332(0x13c)][_0x4fa332(0x124)](_0x4fa332(0x108),_0x4fa332(0xec),_0x4fa332(0x130)+_0x3caaa5);throw new Error(_0x4fa332(0xf8)+_0x3caaa5);}if(!_0x211859[_0x4fa332(0x12e)]){console[_0x4fa332(0xf3)](_0x4fa332(0x152)),console[_0x4fa332(0xf3)](_0x4fa332(0x12b)),loggerService_1[_0x4fa332(0x13c)][_0x4fa332(0x124)](_0x4fa332(0x108),_0x4fa332(0xec),_0x4fa332(0x151));throw new Error(_0x4fa332(0x118));}let _0x5b92be=_0x4fa332(0x14f);switch(_0x211859[_0x4fa332(0x12e)]['Status']?.[_0x4fa332(0x131)]()){case _0x4fa332(0x115):_0x5b92be=_0x4fa332(0x159);break;case _0x4fa332(0x111):case _0x4fa332(0x13f):case _0x4fa332(0xf3):_0x5b92be=_0x4fa332(0x116);break;case _0x4fa332(0x138):case _0x4fa332(0x15c):_0x5b92be=_0x4fa332(0x145);break;case _0x4fa332(0x104):case _0x4fa332(0x10c):case'pending':case _0x4fa332(0x16a):default:_0x5b92be='PENDING';break;}let _0x371fb4,_0x1eb21e;if(_0x211859[_0x4fa332(0x12e)][_0x4fa332(0xf5)]){const _0x5277c2=_0x211859[_0x4fa332(0x12e)][_0x4fa332(0xf5)];console[_0x4fa332(0x139)](_0x4fa332(0xf7),_0x5277c2);const _0x1eb7ff=_0x5277c2[_0x4fa332(0x123)](/IBAN\s+([A-Z0-9]+)/i);_0x1eb7ff&&(_0x371fb4=_0x1eb7ff[0x1],console[_0x4fa332(0x139)](_0x4fa332(0x100),_0x371fb4)),_0x1eb21e=_0x5277c2;}const _0x513e00={'iban':_0x371fb4,'bankDetails':_0x1eb21e,'transactionId':_0x211859['data'][_0x4fa332(0x136)],'coinAddress':_0x211859[_0x4fa332(0x12e)][_0x4fa332(0x162)],'qrCodeUrl':_0x211859[_0x4fa332(0x12e)]['QRCodeURL'],'expiryTime':_0x211859[_0x4fa332(0x12e)][_0x4fa332(0x144)],'createdOn':_0x211859[_0x4fa332(0x12e)]['CreatedOn'],'confirmedOn':_0x211859['data']['TransactionConfirmedOn']};console['log'](_0x4fa332(0x16c)),console[_0x4fa332(0x139)]('Status:',_0x211859[_0x4fa332(0x12e)][_0x4fa332(0x174)],'->',_0x5b92be),console['log'](_0x4fa332(0xf1),_0x211859[_0x4fa332(0x12e)]['Amount'],_0x211859['data'][_0x4fa332(0x101)]),console[_0x4fa332(0x139)](_0x4fa332(0x107),_0x211859['data']['TransactionID']),console['log'](_0x4fa332(0x126),_0x371fb4||_0x4fa332(0x169)),console[_0x4fa332(0x139)](_0x4fa332(0x157),_0x211859['data'][_0x4fa332(0x142)]),console[_0x4fa332(0x139)](_0x4fa332(0x16d),_0x211859['data'][_0x4fa332(0x110)]||_0x4fa332(0x16b));if(_0x211859['data'][_0x4fa332(0x174)]?.[_0x4fa332(0x131)]()===_0x4fa332(0x10c))console[_0x4fa332(0x139)](_0x4fa332(0x149));else _0x211859[_0x4fa332(0x12e)][_0x4fa332(0x174)]?.[_0x4fa332(0x131)]()===_0x4fa332(0x115)&&console[_0x4fa332(0x139)](_0x4fa332(0x172));return{'status':_0x5b92be,'amount':parseFloat(_0x211859[_0x4fa332(0x12e)]['Amount'])||undefined,'currency':_0x211859['data'][_0x4fa332(0x101)]||_0x4fa332(0x12c),'paymentDetails':_0x513e00};}catch(_0x300c10){console[_0x4fa332(0xf3)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x300c10),loggerService_1[_0x4fa332(0x13c)][_0x4fa332(0x124)]('cointopay',_0x4fa332(0xec),_0x300c10);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x300c10 instanceof Error?_0x300c10['message']:_0x4fa332(0x10d)));}}async[a40_0x47e507(0x127)](_0x2ff7f4){const _0x39158c=a40_0x47e507,_0x6fde44=await this[_0x39158c(0x158)](_0x2ff7f4);return{'status':_0x6fde44['status'],'amount':_0x6fde44['amount'],'currency':_0x6fde44[_0x39158c(0x129)]};}async['processWebhook'](_0x1389ec){const _0x1a5ec6=a40_0x47e507;console[_0x1a5ec6(0x139)](_0x1a5ec6(0x155),_0x1389ec);let _0x361452=_0x1a5ec6(0x14f);switch(_0x1389ec[_0x1a5ec6(0x161)]?.['toLowerCase']()){case _0x1a5ec6(0x115):_0x361452=_0x1a5ec6(0x159);break;case _0x1a5ec6(0x111):case _0x1a5ec6(0x13f):case _0x1a5ec6(0xf3):_0x361452='FAILED';break;case _0x1a5ec6(0x138):case _0x1a5ec6(0x15c):_0x361452='EXPIRED';break;case _0x1a5ec6(0x10e):case _0x1a5ec6(0x104):case _0x1a5ec6(0x10c):case _0x1a5ec6(0x16a):default:_0x361452=_0x1a5ec6(0x14f);break;}return{'paymentId':_0x1389ec[_0x1a5ec6(0x13e)]||_0x1389ec[_0x1a5ec6(0x13a)]||'','status':_0x361452,'amount':_0x1389ec[_0x1a5ec6(0xff)],'currency':_0x1389ec['currency']||_0x1a5ec6(0x12c)};}}exports['CoinToPayService']=CoinToPayService;