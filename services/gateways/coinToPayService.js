'use strict';const a38_0x247630=a38_0x2c2b;(function(_0x560657,_0x2c8bc9){const _0x49b8ad=a38_0x2c2b,_0x1bfd44=_0x560657();while(!![]){try{const _0x212ad1=-parseInt(_0x49b8ad(0x1bf))/0x1+-parseInt(_0x49b8ad(0x1a8))/0x2+parseInt(_0x49b8ad(0x1cc))/0x3*(parseInt(_0x49b8ad(0x1b0))/0x4)+-parseInt(_0x49b8ad(0x1fe))/0x5+parseInt(_0x49b8ad(0x1c2))/0x6+-parseInt(_0x49b8ad(0x18b))/0x7*(parseInt(_0x49b8ad(0x186))/0x8)+parseInt(_0x49b8ad(0x187))/0x9;if(_0x212ad1===_0x2c8bc9)break;else _0x1bfd44['push'](_0x1bfd44['shift']());}catch(_0x219fe9){_0x1bfd44['push'](_0x1bfd44['shift']());}}}(a38_0x4a63,0x94872));Object[a38_0x247630(0x1df)](exports,a38_0x247630(0x18f),{'value':!![]}),exports[a38_0x247630(0x1cb)]=void 0x0;function a38_0x2c2b(_0x1b63aa,_0x121cb0){const _0x4a6308=a38_0x4a63();return a38_0x2c2b=function(_0x2c2b60,_0x522fcc){_0x2c2b60=_0x2c2b60-0x17b;let _0x4c8a4a=_0x4a6308[_0x2c2b60];return _0x4c8a4a;},a38_0x2c2b(_0x1b63aa,_0x121cb0);}function a38_0x4a63(){const _0x394c6e=['TransactionConfirmedOn','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','timeout','processWebhook','Incomplete\x20response:\x20missing\x20data','PaymentDetail','apiUrl','statusText','Raw\x20Response\x20Body:','paid','5899220JiRliG','checkPaymentStatus','fromEntries','CreatedOn','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','URL:','loggerService','gateway_payment_id','cancelled','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','logWhiteDomainResponse','coinAddress','pending','üè¶\x20Payment\x20Detail:','created','üè¶\x20Extracted\x20IBAN:','652952INLyrI','17566605eXlXHp','error','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','14sqVMZv','Error\x20message:','statusUrl','awaiting\x20fiat','__esModule','Confirmed\x20On:','/create','TesSoft\x20Payment\x20System/1.0','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','EXPIRED','===\x20COINTOPAY\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','Status\x20Code:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id',',\x20body:\x20','Parsed\x20Result:','Error\x20stack:','===\x20COINTOPAY\x20API\x20ERROR\x20===','expired','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status:','Payment\x20Status:','\x20EUR','POST','Response\x20Time:','https://tesoft.uk/gateway/cointopay/status.php','cointopay','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','578200NRJZnl','amount','stringify','Request\x20Body:','currency','match','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','4175124QAeNZv','/status','Error\x20details:','CoinToPay\x20payment\x20status\x20check\x20error:','HTTP\x20Status:','status_code','ExpiryTime','text','../loggerService','Currency:','Response\x20Body:','inputCurrency','status','Unknown\x20error','message','1209262fMClVa','application/json','Result:','2725128gxOxdN','verifyPayment','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','failed','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','result','PAID','CoinToPayService','3CmgmpG','HTTP\x20error!\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount','payment_url','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount:','parse','Payment\x20URL:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','not\x20confirmed','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','not\x20found','toLowerCase','IBAN:','Failed\x20to\x20parse\x20JSON\x20response:','Gateway\x20Payment\x20ID:','defineProperty','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Created\x20On:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','data','waiting','FAILED','QRCodeURL','Unknown\x20error\x20from\x20CoinToPay\x20API','stack','Business\x20Error:\x20','Status','EUR','TransactionID','log','Error\x20Message:','Status\x20Text:','logWhiteDomainError','PENDING','now','HTTP\x20'];a38_0x4a63=function(){return _0x394c6e;};return a38_0x4a63();}const loggerService_1=require(a38_0x247630(0x1b8));class CoinToPayService{constructor(){const _0x106d71=a38_0x247630;this[_0x106d71(0x1fa)]='https://tesoft.uk/gateway/cointopay/',this[_0x106d71(0x18d)]=_0x106d71(0x1a5),console[_0x106d71(0x1ed)](_0x106d71(0x1c5)),console[_0x106d71(0x1ed)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0xaf5dfe){const _0x105d8a=a38_0x247630,{orderId:_0x1bb434,amount:_0x3a65b3}=_0xaf5dfe;console[_0x105d8a(0x1ed)](_0x105d8a(0x19e)+_0x3a65b3+_0x105d8a(0x1a2));const _0x4c98e9={'amount':_0x3a65b3},_0x561b7e=Date[_0x105d8a(0x1f2)]();try{console['log'](_0x105d8a(0x1d5)),console['log'](_0x105d8a(0x203),this['apiUrl']),console[_0x105d8a(0x1ed)](_0x105d8a(0x1ab),JSON['stringify'](_0x4c98e9,null,0x2)),console[_0x105d8a(0x1ed)]('Amount:',_0x3a65b3,_0x105d8a(0x1ae)),loggerService_1[_0x105d8a(0x17b)]['logWhiteDomainRequest'](_0x105d8a(0x1a6),'/create','POST',_0x4c98e9);const _0x2364f6=await fetch(this[_0x105d8a(0x1fa)],{'method':_0x105d8a(0x1a3),'headers':{'Content-Type':_0x105d8a(0x1c0),'Accept':_0x105d8a(0x1c0),'User-Agent':_0x105d8a(0x192)},'body':JSON[_0x105d8a(0x1aa)](_0x4c98e9)}),_0x2a5a87=Date['now']()-_0x561b7e;console[_0x105d8a(0x1ed)](_0x105d8a(0x1c8)),console['log'](_0x105d8a(0x1a0),_0x2364f6[_0x105d8a(0x1bc)]),console[_0x105d8a(0x1ed)](_0x105d8a(0x1ef),_0x2364f6[_0x105d8a(0x1fb)]),console[_0x105d8a(0x1ed)]('Headers:',Object[_0x105d8a(0x200)](_0x2364f6['headers']['entries']())),console[_0x105d8a(0x1ed)](_0x105d8a(0x1a4),_0x2a5a87+'ms');const _0x5a898e=await _0x2364f6[_0x105d8a(0x1b7)]();console[_0x105d8a(0x1ed)]('Raw\x20Response\x20Body:',_0x5a898e);if(!_0x2364f6['ok']){console[_0x105d8a(0x188)](_0x105d8a(0x19c)),console[_0x105d8a(0x188)](_0x105d8a(0x1b4),_0x2364f6[_0x105d8a(0x1bc)]),console[_0x105d8a(0x188)](_0x105d8a(0x1ba),_0x5a898e),loggerService_1[_0x105d8a(0x17b)][_0x105d8a(0x180)](_0x105d8a(0x1a6),_0x105d8a(0x191),_0x2364f6[_0x105d8a(0x1bc)],_0x5a898e,_0x2a5a87),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x105d8a(0x1f3)+_0x2364f6[_0x105d8a(0x1bc)]+':\x20'+_0x5a898e);throw new Error(_0x105d8a(0x1cd)+_0x2364f6[_0x105d8a(0x1bc)]+_0x105d8a(0x199)+_0x5a898e);}let _0x10874e;try{_0x10874e=JSON['parse'](_0x5a898e);}catch(_0x5b2075){console['error'](_0x105d8a(0x1dd),_0x5b2075),loggerService_1['loggerService']['logWhiteDomainError'](_0x105d8a(0x1a6),_0x105d8a(0x191),_0x105d8a(0x196)+_0x5b2075);throw new Error(_0x105d8a(0x1f5)+_0x5a898e);}console['log'](_0x105d8a(0x1ce)),console[_0x105d8a(0x1ed)](_0x105d8a(0x19a),JSON['stringify'](_0x10874e,null,0x2)),loggerService_1[_0x105d8a(0x17b)]['logWhiteDomainResponse'](_0x105d8a(0x1a6),_0x105d8a(0x191),_0x2364f6[_0x105d8a(0x1bc)],_0x10874e,_0x2a5a87);if(_0x10874e[_0x105d8a(0x188)]){const _0x52a811=_0x10874e[_0x105d8a(0x1be)]||_0x10874e['error']||_0x105d8a(0x1e7);console[_0x105d8a(0x188)](_0x105d8a(0x1d7)),console['error'](_0x105d8a(0x1ee),_0x52a811),loggerService_1[_0x105d8a(0x17b)][_0x105d8a(0x1f0)](_0x105d8a(0x1a6),_0x105d8a(0x191),_0x105d8a(0x1e9)+_0x52a811);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x52a811);}if(!_0x10874e[_0x105d8a(0x1d0)]||!_0x10874e['gateway_payment_id']){console['error'](_0x105d8a(0x202)),console[_0x105d8a(0x188)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x105d8a(0x188)]('Response\x20data:',_0x10874e),loggerService_1['loggerService'][_0x105d8a(0x1f0)]('cointopay',_0x105d8a(0x191),_0x105d8a(0x198));throw new Error(_0x105d8a(0x19f));}return console['log'](_0x105d8a(0x195)),console[_0x105d8a(0x1ed)](_0x105d8a(0x1de),_0x10874e[_0x105d8a(0x17c)]),console[_0x105d8a(0x1ed)](_0x105d8a(0x1d4),_0x10874e['payment_url']),console['log']('Amount:',_0x3a65b3,'EUR'),{'gateway_payment_id':_0x10874e[_0x105d8a(0x17c)],'payment_url':_0x10874e['payment_url']};}catch(_0x3176b6){console[_0x105d8a(0x188)](_0x105d8a(0x1d9)),console['error'](_0x105d8a(0x1b2),_0x3176b6),loggerService_1[_0x105d8a(0x17b)][_0x105d8a(0x1f0)](_0x105d8a(0x1a6),_0x105d8a(0x191),_0x3176b6);if(_0x3176b6 instanceof Error){console[_0x105d8a(0x188)](_0x105d8a(0x18c),_0x3176b6['message']),console[_0x105d8a(0x188)](_0x105d8a(0x19b),_0x3176b6[_0x105d8a(0x1e8)]);throw new Error(_0x105d8a(0x1e0)+_0x3176b6[_0x105d8a(0x1be)]);}throw new Error(_0x105d8a(0x1a7));}}async['checkPaymentStatus'](_0x2dab30){const _0x37aeb2=a38_0x247630,_0x3bed37=Date[_0x37aeb2(0x1f2)]();try{console[_0x37aeb2(0x1ed)](_0x37aeb2(0x18a)+_0x2dab30);const _0x576b10={'gatewayPaymentId':_0x2dab30};loggerService_1['loggerService'][_0x37aeb2(0x17e)](_0x37aeb2(0x1a6),_0x37aeb2(0x1b1),_0x37aeb2(0x1a3),_0x576b10);const _0x5b05d0=await fetch(this[_0x37aeb2(0x18d)],{'method':_0x37aeb2(0x1a3),'headers':{'Content-Type':_0x37aeb2(0x1c0),'Accept':_0x37aeb2(0x1c0),'User-Agent':_0x37aeb2(0x192)},'body':JSON['stringify'](_0x576b10)}),_0x3d6e23=Date[_0x37aeb2(0x1f2)]()-_0x3bed37;console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1d6)),console['log'](_0x37aeb2(0x1a0),_0x5b05d0['status']),console['log']('Response\x20Time:',_0x3d6e23+'ms');if(!_0x5b05d0['ok']){const _0xab6a13=await _0x5b05d0[_0x37aeb2(0x1b7)]();console[_0x37aeb2(0x188)](_0x37aeb2(0x1b4),_0x5b05d0[_0x37aeb2(0x1bc)]),console[_0x37aeb2(0x188)](_0x37aeb2(0x1ba),_0xab6a13),loggerService_1[_0x37aeb2(0x17b)][_0x37aeb2(0x180)](_0x37aeb2(0x1a6),_0x37aeb2(0x1b1),_0x5b05d0[_0x37aeb2(0x1bc)],_0xab6a13,_0x3d6e23),loggerService_1[_0x37aeb2(0x17b)][_0x37aeb2(0x1f0)]('cointopay',_0x37aeb2(0x1b1),_0x37aeb2(0x1f3)+_0x5b05d0[_0x37aeb2(0x1bc)]+':\x20'+_0xab6a13);throw new Error(_0x37aeb2(0x1cd)+_0x5b05d0[_0x37aeb2(0x1bc)]);}const _0x45b550=await _0x5b05d0[_0x37aeb2(0x1b7)]();console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1fc),_0x45b550);let _0x1c5dca;try{_0x1c5dca=JSON[_0x37aeb2(0x1d3)](_0x45b550);}catch(_0x347a27){console[_0x37aeb2(0x188)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x347a27),loggerService_1['loggerService'][_0x37aeb2(0x1f0)](_0x37aeb2(0x1a6),'/status',_0x37aeb2(0x196)+_0x347a27);throw new Error(_0x37aeb2(0x1c4)+_0x45b550);}loggerService_1[_0x37aeb2(0x17b)][_0x37aeb2(0x180)](_0x37aeb2(0x1a6),'/status',_0x5b05d0['status'],_0x1c5dca,_0x3d6e23),console[_0x37aeb2(0x1ed)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1c1),_0x1c5dca[_0x37aeb2(0x1c9)]),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x197),_0x1c5dca[_0x37aeb2(0x1b5)]),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1a1),_0x1c5dca[_0x37aeb2(0x1e3)]?.[_0x37aeb2(0x1ea)]),console[_0x37aeb2(0x1ed)]('Amount:',_0x1c5dca[_0x37aeb2(0x1e3)]?.[_0x37aeb2(0x1cf)]),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1b9),_0x1c5dca['data']?.['inputCurrency']);if(_0x1c5dca['result']!=='success'||_0x1c5dca[_0x37aeb2(0x1b5)]!==0xc8){const _0x107d14=_0x1c5dca[_0x37aeb2(0x1be)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x37aeb2(0x193)),console[_0x37aeb2(0x188)](_0x37aeb2(0x1ee),_0x107d14),loggerService_1[_0x37aeb2(0x17b)][_0x37aeb2(0x1f0)](_0x37aeb2(0x1a6),_0x37aeb2(0x1b1),'Status\x20API\x20Error:\x20'+_0x107d14);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x107d14);}if(!_0x1c5dca[_0x37aeb2(0x1e3)]){console[_0x37aeb2(0x188)](_0x37aeb2(0x17f)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x37aeb2(0x17b)]['logWhiteDomainError'](_0x37aeb2(0x1a6),_0x37aeb2(0x1b1),_0x37aeb2(0x1f8));throw new Error(_0x37aeb2(0x189));}let _0x1a4403=_0x37aeb2(0x1f1);switch(_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1ea)]?.[_0x37aeb2(0x1db)]()){case _0x37aeb2(0x1fd):_0x1a4403=_0x37aeb2(0x1ca);break;case _0x37aeb2(0x17d):case _0x37aeb2(0x1c6):case _0x37aeb2(0x188):_0x1a4403=_0x37aeb2(0x1e5);break;case _0x37aeb2(0x19d):case _0x37aeb2(0x1f6):_0x1a4403=_0x37aeb2(0x194);break;case _0x37aeb2(0x1e4):case _0x37aeb2(0x18e):case'pending':case _0x37aeb2(0x184):default:_0x1a4403=_0x37aeb2(0x1f1);break;}let _0x5950ae,_0x4e9ee3;if(_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1f9)]){const _0x16db1f=_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1f9)];console['log'](_0x37aeb2(0x183),_0x16db1f);const _0x9afac=_0x16db1f[_0x37aeb2(0x1ad)](/IBAN\s+([A-Z0-9]+)/i);_0x9afac&&(_0x5950ae=_0x9afac[0x1],console[_0x37aeb2(0x1ed)](_0x37aeb2(0x185),_0x5950ae)),_0x4e9ee3=_0x16db1f;}const _0x396ce7={'iban':_0x5950ae,'bankDetails':_0x4e9ee3,'transactionId':_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1ec)],'coinAddress':_0x1c5dca['data'][_0x37aeb2(0x181)],'qrCodeUrl':_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1e6)],'expiryTime':_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1b6)],'createdOn':_0x1c5dca['data'][_0x37aeb2(0x201)],'confirmedOn':_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1f4)]};console['log'](_0x37aeb2(0x1af)),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1a0),_0x1c5dca['data']['Status'],'->',_0x1a4403),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1d2),_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1cf)],_0x1c5dca['data'][_0x37aeb2(0x1bb)]),console[_0x37aeb2(0x1ed)]('Transaction\x20ID:',_0x1c5dca[_0x37aeb2(0x1e3)]['TransactionID']),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1dc),_0x5950ae||_0x37aeb2(0x1da)),console['log'](_0x37aeb2(0x1e1),_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x201)]),console[_0x37aeb2(0x1ed)](_0x37aeb2(0x190),_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1f4)]||_0x37aeb2(0x1d8));if(_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1ea)]?.['toLowerCase']()===_0x37aeb2(0x18e))console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1c7));else _0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1ea)]?.[_0x37aeb2(0x1db)]()===_0x37aeb2(0x1fd)&&console[_0x37aeb2(0x1ed)](_0x37aeb2(0x1e2));return{'status':_0x1a4403,'amount':parseFloat(_0x1c5dca[_0x37aeb2(0x1e3)][_0x37aeb2(0x1cf)])||undefined,'currency':_0x1c5dca['data']['inputCurrency']||_0x37aeb2(0x1eb),'paymentDetails':_0x396ce7};}catch(_0x2b6949){console['error'](_0x37aeb2(0x1b3),_0x2b6949),loggerService_1[_0x37aeb2(0x17b)]['logWhiteDomainError']('cointopay','/status',_0x2b6949);throw new Error(_0x37aeb2(0x1d1)+(_0x2b6949 instanceof Error?_0x2b6949['message']:_0x37aeb2(0x1bd)));}}async[a38_0x247630(0x1c3)](_0x2111ac){const _0x5102b1=a38_0x247630,_0x37d28a=await this[_0x5102b1(0x1ff)](_0x2111ac);return{'status':_0x37d28a[_0x5102b1(0x1bc)],'amount':_0x37d28a[_0x5102b1(0x1a9)],'currency':_0x37d28a[_0x5102b1(0x1ac)]};}async[a38_0x247630(0x1f7)](_0x4c404d){const _0x3a2c88=a38_0x247630;console[_0x3a2c88(0x1ed)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4c404d);let _0x43efb9=_0x3a2c88(0x1f1);switch(_0x4c404d[_0x3a2c88(0x1bc)]?.['toLowerCase']()){case _0x3a2c88(0x1fd):_0x43efb9='PAID';break;case'cancelled':case'failed':case _0x3a2c88(0x188):_0x43efb9='FAILED';break;case'expired':case _0x3a2c88(0x1f6):_0x43efb9='EXPIRED';break;case _0x3a2c88(0x182):case'waiting':case'awaiting\x20fiat':case _0x3a2c88(0x184):default:_0x43efb9=_0x3a2c88(0x1f1);break;}return{'paymentId':_0x4c404d['order_id']||_0x4c404d['merchant_reference_id']||'','status':_0x43efb9,'amount':_0x4c404d[_0x3a2c88(0x1a9)],'currency':_0x4c404d['currency']||_0x3a2c88(0x1eb)};}}exports[a38_0x247630(0x1cb)]=CoinToPayService;