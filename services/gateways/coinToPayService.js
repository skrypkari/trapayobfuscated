'use strict';const a40_0x43cbfb=a40_0x5d9c;function a40_0x5d9c(_0xbe4a3f,_0x34f487){const _0x3179a3=a40_0x3179();return a40_0x5d9c=function(_0x5d9cc9,_0x42be27){_0x5d9cc9=_0x5d9cc9-0xb8;let _0x2fdfab=_0x3179a3[_0x5d9cc9];return _0x2fdfab;},a40_0x5d9c(_0xbe4a3f,_0x34f487);}(function(_0x44c4f6,_0xc8ff7c){const _0x2f25b2=a40_0x5d9c,_0x12fbdb=_0x44c4f6();while(!![]){try{const _0xd494d1=parseInt(_0x2f25b2(0x11b))/0x1+parseInt(_0x2f25b2(0xe4))/0x2*(-parseInt(_0x2f25b2(0xf8))/0x3)+parseInt(_0x2f25b2(0xc6))/0x4*(parseInt(_0x2f25b2(0xce))/0x5)+-parseInt(_0x2f25b2(0x11e))/0x6*(-parseInt(_0x2f25b2(0x120))/0x7)+parseInt(_0x2f25b2(0x12f))/0x8+parseInt(_0x2f25b2(0xc4))/0x9*(-parseInt(_0x2f25b2(0xf1))/0xa)+-parseInt(_0x2f25b2(0x132))/0xb;if(_0xd494d1===_0xc8ff7c)break;else _0x12fbdb['push'](_0x12fbdb['shift']());}catch(_0x744b7){_0x12fbdb['push'](_0x12fbdb['shift']());}}}(a40_0x3179,0x850b8));Object['defineProperty'](exports,a40_0x43cbfb(0x10d),{'value':!![]}),exports[a40_0x43cbfb(0xeb)]=void 0x0;const loggerService_1=require(a40_0x43cbfb(0xf7));function a40_0x3179(){const _0x44d468=['verifyPayment','log','gateway_payment_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','waiting','__esModule','not\x20found','success','created','statusUrl','HTTP\x20Status:','timeout','fromEntries','EUR','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','stringify','TransactionID','logWhiteDomainRequest','https://tesoft.uk/gateway/cointopay/','400646cxwata','Error\x20Message:','match','411834bluvaN','PaymentDetail','49rVQJiA','not\x20confirmed','Amount','\x20EUR','Error\x20stack:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','result','expired','status_code','Error\x20message:','Amount:','Parsed\x20Result:','Status','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','amount','8177536FWKFqB','Incomplete\x20response:\x20missing\x20data','status','3799796VAffRu','CoinToPay\x20API\x20error:\x20','Headers:','Payment\x20Status:','Response\x20data:','Raw\x20Response\x20Body:','Confirmed\x20On:','Response\x20Body:','awaiting\x20fiat','error','message','HTTP\x20','order_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Business\x20Error:\x20','Payment\x20URL:','38547vEVMsn','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','372136xyteRI','cointopay','pending','EXPIRED','üè¶\x20Payment\x20Detail:','HTTP\x20error!\x20status:\x20','POST','loggerService','25kxHrvz','ExpiryTime','Failed\x20to\x20parse\x20JSON\x20response:','apiUrl','PAID','/status','headers','Response\x20Time:','/create','Status\x20API\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainResponse','coinAddress','QRCodeURL','TransactionConfirmedOn','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','statusText','PENDING',',\x20body:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','8170srHzqq','CreatedOn','IBAN:','stack','entries','payment_url','text','CoinToPayService','data','merchant_reference_id','cancelled','now','FAILED','1410KUgIOO','Request\x20Body:','checkPaymentStatus','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','parse','paid','../loggerService','642sSRWQg','toLowerCase','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','JSON\x20Parse\x20Error:\x20','Result:','logWhiteDomainError','===\x20COINTOPAY\x20API\x20ERROR\x20===','TesSoft\x20Payment\x20System/1.0','currency','Status:','application/json','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='];a40_0x3179=function(){return _0x44d468;};return a40_0x3179();}class CoinToPayService{constructor(){const _0x5d560b=a40_0x43cbfb;this[_0x5d560b(0xd1)]=_0x5d560b(0x11a),this[_0x5d560b(0x111)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x5d560b(0x109)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x5d560b(0x109)]('üìä\x20Status\x20check\x20URL:',this[_0x5d560b(0x111)]);}async['createPaymentLink'](_0x5b83d0){const _0x6f46fc=a40_0x43cbfb,{orderId:_0x25f08b,amount:_0x1cb7e0}=_0x5b83d0;console['log']('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x1cb7e0+_0x6f46fc(0x123));const _0xec242a={'amount':_0x1cb7e0},_0x528053=Date[_0x6f46fc(0xef)]();try{console[_0x6f46fc(0x109)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x6f46fc(0x109)]('URL:',this[_0x6f46fc(0xd1)]),console[_0x6f46fc(0x109)](_0x6f46fc(0xf2),JSON[_0x6f46fc(0x117)](_0xec242a,null,0x2)),console['log'](_0x6f46fc(0x12a),_0x1cb7e0,_0x6f46fc(0x10b)),loggerService_1[_0x6f46fc(0xcd)][_0x6f46fc(0x119)](_0x6f46fc(0xc7),_0x6f46fc(0xd6),_0x6f46fc(0xcc),_0xec242a);const _0x1d08fb=await fetch(this[_0x6f46fc(0xd1)],{'method':_0x6f46fc(0xcc),'headers':{'Content-Type':_0x6f46fc(0x102),'Accept':_0x6f46fc(0x102),'User-Agent':_0x6f46fc(0xff)},'body':JSON['stringify'](_0xec242a)}),_0x11a6cc=Date['now']()-_0x528053;console[_0x6f46fc(0x109)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x6f46fc(0x101),_0x1d08fb[_0x6f46fc(0x131)]),console[_0x6f46fc(0x109)]('Status\x20Text:',_0x1d08fb[_0x6f46fc(0xdf)]),console[_0x6f46fc(0x109)](_0x6f46fc(0x134),Object[_0x6f46fc(0x114)](_0x1d08fb[_0x6f46fc(0xd4)][_0x6f46fc(0xe8)]())),console[_0x6f46fc(0x109)](_0x6f46fc(0xd5),_0x11a6cc+'ms');const _0x53756f=await _0x1d08fb[_0x6f46fc(0xea)]();console['log'](_0x6f46fc(0x137),_0x53756f);if(!_0x1d08fb['ok']){console[_0x6f46fc(0xba)](_0x6f46fc(0xfe)),console['error'](_0x6f46fc(0x112),_0x1d08fb[_0x6f46fc(0x131)]),console['error'](_0x6f46fc(0xb8),_0x53756f),loggerService_1[_0x6f46fc(0xcd)][_0x6f46fc(0xda)](_0x6f46fc(0xc7),_0x6f46fc(0xd6),_0x1d08fb['status'],_0x53756f,_0x11a6cc),loggerService_1[_0x6f46fc(0xcd)][_0x6f46fc(0xfd)](_0x6f46fc(0xc7),_0x6f46fc(0xd6),'HTTP\x20'+_0x1d08fb['status']+':\x20'+_0x53756f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1d08fb['status']+_0x6f46fc(0xe1)+_0x53756f);}let _0x2bbaa8;try{_0x2bbaa8=JSON['parse'](_0x53756f);}catch(_0x112a97){console[_0x6f46fc(0xba)](_0x6f46fc(0xd0),_0x112a97),loggerService_1['loggerService'][_0x6f46fc(0xfd)](_0x6f46fc(0xc7),'/create','JSON\x20Parse\x20Error:\x20'+_0x112a97);throw new Error(_0x6f46fc(0xfa)+_0x53756f);}console[_0x6f46fc(0x109)](_0x6f46fc(0x103)),console[_0x6f46fc(0x109)](_0x6f46fc(0x12b),JSON[_0x6f46fc(0x117)](_0x2bbaa8,null,0x2)),loggerService_1[_0x6f46fc(0xcd)][_0x6f46fc(0xda)](_0x6f46fc(0xc7),_0x6f46fc(0xd6),_0x1d08fb[_0x6f46fc(0x131)],_0x2bbaa8,_0x11a6cc);if(_0x2bbaa8[_0x6f46fc(0xba)]){const _0x2d83ae=_0x2bbaa8[_0x6f46fc(0xbb)]||_0x2bbaa8['error']||_0x6f46fc(0xd9);console[_0x6f46fc(0xba)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x6f46fc(0x11c),_0x2d83ae),loggerService_1[_0x6f46fc(0xcd)]['logWhiteDomainError'](_0x6f46fc(0xc7),_0x6f46fc(0xd6),_0x6f46fc(0xc2)+_0x2d83ae);throw new Error(_0x6f46fc(0x133)+_0x2d83ae);}if(!_0x2bbaa8[_0x6f46fc(0xe9)]||!_0x2bbaa8[_0x6f46fc(0x10a)]){console[_0x6f46fc(0xba)](_0x6f46fc(0xc1)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x6f46fc(0x136),_0x2bbaa8),loggerService_1[_0x6f46fc(0xcd)]['logWhiteDomainError'](_0x6f46fc(0xc7),_0x6f46fc(0xd6),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x6f46fc(0xc0));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x6f46fc(0x109)](_0x6f46fc(0x106),_0x2bbaa8[_0x6f46fc(0x10a)]),console['log'](_0x6f46fc(0xc3),_0x2bbaa8[_0x6f46fc(0xe9)]),console[_0x6f46fc(0x109)]('Amount:',_0x1cb7e0,_0x6f46fc(0x115)),{'gateway_payment_id':_0x2bbaa8[_0x6f46fc(0x10a)],'payment_url':_0x2bbaa8[_0x6f46fc(0xe9)]};}catch(_0x39477c){console[_0x6f46fc(0xba)](_0x6f46fc(0xf4)),console[_0x6f46fc(0xba)]('Error\x20details:',_0x39477c),loggerService_1[_0x6f46fc(0xcd)][_0x6f46fc(0xfd)](_0x6f46fc(0xc7),_0x6f46fc(0xd6),_0x39477c);if(_0x39477c instanceof Error){console[_0x6f46fc(0xba)](_0x6f46fc(0x129),_0x39477c[_0x6f46fc(0xbb)]),console['error'](_0x6f46fc(0x124),_0x39477c[_0x6f46fc(0xe7)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x39477c[_0x6f46fc(0xbb)]);}throw new Error(_0x6f46fc(0x105));}}async[a40_0x43cbfb(0xf3)](_0x75572d){const _0x235b36=a40_0x43cbfb,_0x4deb37=Date[_0x235b36(0xef)]();try{console[_0x235b36(0x109)](_0x235b36(0x125)+_0x75572d);const _0x17d477={'gatewayPaymentId':_0x75572d};loggerService_1[_0x235b36(0xcd)][_0x235b36(0x119)](_0x235b36(0xc7),_0x235b36(0xd3),'POST',_0x17d477);const _0x267c6b=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x235b36(0x102),'Accept':_0x235b36(0x102),'User-Agent':_0x235b36(0xff)},'body':JSON[_0x235b36(0x117)](_0x17d477)}),_0x3cd5dd=Date[_0x235b36(0xef)]()-_0x4deb37;console[_0x235b36(0x109)](_0x235b36(0x12d)),console['log'](_0x235b36(0x101),_0x267c6b['status']),console[_0x235b36(0x109)](_0x235b36(0xd5),_0x3cd5dd+'ms');if(!_0x267c6b['ok']){const _0x562207=await _0x267c6b[_0x235b36(0xea)]();console['error'](_0x235b36(0x112),_0x267c6b[_0x235b36(0x131)]),console[_0x235b36(0xba)]('Response\x20Body:',_0x562207),loggerService_1[_0x235b36(0xcd)][_0x235b36(0xda)](_0x235b36(0xc7),'/status',_0x267c6b[_0x235b36(0x131)],_0x562207,_0x3cd5dd),loggerService_1['loggerService'][_0x235b36(0xfd)](_0x235b36(0xc7),_0x235b36(0xd3),_0x235b36(0xbc)+_0x267c6b[_0x235b36(0x131)]+':\x20'+_0x562207);throw new Error(_0x235b36(0xcb)+_0x267c6b[_0x235b36(0x131)]);}const _0x11ff13=await _0x267c6b[_0x235b36(0xea)]();console[_0x235b36(0x109)](_0x235b36(0x137),_0x11ff13);let _0x5c4e69;try{_0x5c4e69=JSON[_0x235b36(0xf5)](_0x11ff13);}catch(_0x33cb84){console['error'](_0x235b36(0xd0),_0x33cb84),loggerService_1[_0x235b36(0xcd)]['logWhiteDomainError']('cointopay',_0x235b36(0xd3),_0x235b36(0xfb)+_0x33cb84);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x11ff13);}loggerService_1[_0x235b36(0xcd)]['logWhiteDomainResponse'](_0x235b36(0xc7),'/status',_0x267c6b[_0x235b36(0x131)],_0x5c4e69,_0x3cd5dd),console[_0x235b36(0x109)](_0x235b36(0xbf)),console[_0x235b36(0x109)](_0x235b36(0xfc),_0x5c4e69['result']),console[_0x235b36(0x109)]('Status\x20Code:',_0x5c4e69[_0x235b36(0x128)]),console[_0x235b36(0x109)](_0x235b36(0x135),_0x5c4e69[_0x235b36(0xec)]?.[_0x235b36(0x12c)]),console[_0x235b36(0x109)](_0x235b36(0x12a),_0x5c4e69[_0x235b36(0xec)]?.[_0x235b36(0x122)]),console[_0x235b36(0x109)]('Currency:',_0x5c4e69[_0x235b36(0xec)]?.['inputCurrency']);if(_0x5c4e69[_0x235b36(0x126)]!==_0x235b36(0x10f)||_0x5c4e69['status_code']!==0xc8){const _0x11ddf0=_0x5c4e69[_0x235b36(0xbb)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x235b36(0xba)](_0x235b36(0xc5)),console[_0x235b36(0xba)](_0x235b36(0x11c),_0x11ddf0),loggerService_1[_0x235b36(0xcd)]['logWhiteDomainError'](_0x235b36(0xc7),'/status',_0x235b36(0xd7)+_0x11ddf0);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x11ddf0);}if(!_0x5c4e69[_0x235b36(0xec)]){console['error'](_0x235b36(0x107)),console[_0x235b36(0xba)](_0x235b36(0x104)),loggerService_1[_0x235b36(0xcd)][_0x235b36(0xfd)](_0x235b36(0xc7),_0x235b36(0xd3),_0x235b36(0x130));throw new Error(_0x235b36(0xd8));}let _0x27f5cc='PENDING';switch(_0x5c4e69[_0x235b36(0xec)][_0x235b36(0x12c)]?.[_0x235b36(0xf9)]()){case _0x235b36(0xf6):_0x27f5cc=_0x235b36(0xd2);break;case _0x235b36(0xee):case'failed':case _0x235b36(0xba):_0x27f5cc=_0x235b36(0xf0);break;case _0x235b36(0x127):case'timeout':_0x27f5cc=_0x235b36(0xc9);break;case _0x235b36(0x10c):case'awaiting\x20fiat':case'pending':case _0x235b36(0x110):default:_0x27f5cc=_0x235b36(0xe0);break;}let _0x5657f7,_0x2ed94e;if(_0x5c4e69[_0x235b36(0xec)][_0x235b36(0x11f)]){const _0x3b774a=_0x5c4e69[_0x235b36(0xec)][_0x235b36(0x11f)];console[_0x235b36(0x109)](_0x235b36(0xca),_0x3b774a);const _0x346b6b=_0x3b774a[_0x235b36(0x11d)](/IBAN\s+([A-Z0-9]+)/i);_0x346b6b&&(_0x5657f7=_0x346b6b[0x1],console[_0x235b36(0x109)]('üè¶\x20Extracted\x20IBAN:',_0x5657f7)),_0x2ed94e=_0x3b774a;}const _0x7e4b7f={'iban':_0x5657f7,'bankDetails':_0x2ed94e,'transactionId':_0x5c4e69['data'][_0x235b36(0x118)],'coinAddress':_0x5c4e69[_0x235b36(0xec)][_0x235b36(0xdb)],'qrCodeUrl':_0x5c4e69['data'][_0x235b36(0xdc)],'expiryTime':_0x5c4e69[_0x235b36(0xec)][_0x235b36(0xcf)],'createdOn':_0x5c4e69[_0x235b36(0xec)][_0x235b36(0xe5)],'confirmedOn':_0x5c4e69[_0x235b36(0xec)]['TransactionConfirmedOn']};console['log'](_0x235b36(0xde)),console[_0x235b36(0x109)](_0x235b36(0x101),_0x5c4e69[_0x235b36(0xec)][_0x235b36(0x12c)],'->',_0x27f5cc),console['log'](_0x235b36(0x12a),_0x5c4e69[_0x235b36(0xec)]['Amount'],_0x5c4e69['data']['inputCurrency']),console['log']('Transaction\x20ID:',_0x5c4e69['data'][_0x235b36(0x118)]),console[_0x235b36(0x109)](_0x235b36(0xe6),_0x5657f7||_0x235b36(0x10e)),console['log']('Created\x20On:',_0x5c4e69[_0x235b36(0xec)][_0x235b36(0xe5)]),console[_0x235b36(0x109)](_0x235b36(0x138),_0x5c4e69[_0x235b36(0xec)][_0x235b36(0xdd)]||_0x235b36(0x121));if(_0x5c4e69[_0x235b36(0xec)]['Status']?.[_0x235b36(0xf9)]()===_0x235b36(0xb9))console[_0x235b36(0x109)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x5c4e69[_0x235b36(0xec)][_0x235b36(0x12c)]?.[_0x235b36(0xf9)]()===_0x235b36(0xf6)&&console[_0x235b36(0x109)](_0x235b36(0xbe));return{'status':_0x27f5cc,'amount':parseFloat(_0x5c4e69['data'][_0x235b36(0x122)])||undefined,'currency':_0x5c4e69[_0x235b36(0xec)]['inputCurrency']||_0x235b36(0x115),'paymentDetails':_0x7e4b7f};}catch(_0x413e17){console['error'](_0x235b36(0xe2),_0x413e17),loggerService_1[_0x235b36(0xcd)][_0x235b36(0xfd)](_0x235b36(0xc7),_0x235b36(0xd3),_0x413e17);throw new Error(_0x235b36(0x116)+(_0x413e17 instanceof Error?_0x413e17[_0x235b36(0xbb)]:'Unknown\x20error'));}}async[a40_0x43cbfb(0x108)](_0x2ddd11){const _0x501a94=a40_0x43cbfb,_0x4d7f3f=await this[_0x501a94(0xf3)](_0x2ddd11);return{'status':_0x4d7f3f[_0x501a94(0x131)],'amount':_0x4d7f3f['amount'],'currency':_0x4d7f3f[_0x501a94(0x100)]};}async['processWebhook'](_0x1e06a9){const _0x4445b2=a40_0x43cbfb;console[_0x4445b2(0x109)](_0x4445b2(0xe3),_0x1e06a9);let _0x446330='PENDING';switch(_0x1e06a9[_0x4445b2(0x131)]?.[_0x4445b2(0xf9)]()){case _0x4445b2(0xf6):_0x446330='PAID';break;case _0x4445b2(0xee):case'failed':case'error':_0x446330=_0x4445b2(0xf0);break;case _0x4445b2(0x127):case _0x4445b2(0x113):_0x446330=_0x4445b2(0xc9);break;case _0x4445b2(0xc8):case _0x4445b2(0x10c):case'awaiting\x20fiat':case'created':default:_0x446330=_0x4445b2(0xe0);break;}return{'paymentId':_0x1e06a9[_0x4445b2(0xbd)]||_0x1e06a9[_0x4445b2(0xed)]||'','status':_0x446330,'amount':_0x1e06a9[_0x4445b2(0x12e)],'currency':_0x1e06a9[_0x4445b2(0x100)]||_0x4445b2(0x115)};}}exports[a40_0x43cbfb(0xeb)]=CoinToPayService;