'use strict';const a49_0x5542b9=a49_0x342a;function a49_0x6380(){const _0x330cd0=['Headers:','Incomplete\x20response:\x20missing\x20data','HTTP\x20','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','statusText','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','gateway_payment_id','HTTP\x20error!\x20status:\x20','logWhiteDomainError','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','520604kBuZAK','created','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','result','Unknown\x20error\x20from\x20CoinToPay\x20API','defineProperty','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','inputCurrency','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','EXPIRED','entries','../loggerService','Payment\x20System/1.0','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','42fyYYzn','text','1181082uKxcSo','10663904GoraKh','statusUrl','waiting','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','2597886sgWdQP','pending','amount','toLowerCase','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status:','application/json','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status\x20Code:','Response\x20Body:','Amount:','status','processWebhook','https://tesoft.uk/gateway/cointopay/','verifyPayment','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','checkPaymentStatus','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','coinAddress','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','not\x20confirmed','===\x20COINTOPAY\x20SUCCESS\x20===','JSON\x20Parse\x20Error:\x20','📊\x20Status\x20check\x20URL:','log','Error\x20message:','success','IBAN:','Created\x20On:','Business\x20Error:\x20','__esModule','EUR','message','HTTP\x20Status:','TransactionConfirmedOn','TransactionID','750936QloMCW','CoinToPay\x20API\x20error:\x20','status_code','Payment\x20Status:','createPaymentLink','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Missing\x20data\x20in\x20response','Status','paid','parse','headers','merchant_reference_id','Error\x20Message:','stringify','Payment\x20URL\x20(original):',',\x20body:\x20','Payment\x20URL\x20(modified):','CoinToPay\x20status\x20API\x20error:\x20','cointopay','URL:','https://tesoft.uk/gateway/cointopay/status.php','2604772BinTbK','PENDING','logWhiteDomainResponse','CoinToPay\x20payment\x20status\x20check\x20error:','Error\x20stack:','Result:','/status','logWhiteDomainRequest','FAILED','CoinToPayService','data','Raw\x20Response\x20Body:','Status\x20Text:','payment_url','ExpiryTime','Gateway\x20Payment\x20ID:','POST','apiUrl','expired','now','currency','Error\x20details:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','cancelled','/create','PaymentDetail','Amount','timeout','\x20EUR','CreatedOn','5819800aUGavD','Parsed\x20Result:','failed','Unknown\x20error','not\x20found','Response\x20data:','&alternative=false','loggerService','Currency:','Failed\x20to\x20parse\x20JSON\x20response:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'];a49_0x6380=function(){return _0x330cd0;};return a49_0x6380();}(function(_0x4694eb,_0x5e24a7){const _0x534b8e=a49_0x342a,_0x5c8587=_0x4694eb();while(!![]){try{const _0x483283=parseInt(_0x534b8e(0x125))/0x1+parseInt(_0x534b8e(0xfe))/0x2+-parseInt(_0x534b8e(0xf9))/0x3+-parseInt(_0x534b8e(0xb2))/0x4+-parseInt(_0x534b8e(0xd0))/0x5+parseInt(_0x534b8e(0xf7))/0x6*(-parseInt(_0x534b8e(0xe8))/0x7)+parseInt(_0x534b8e(0xfa))/0x8;if(_0x483283===_0x5e24a7)break;else _0x5c8587['push'](_0x5c8587['shift']());}catch(_0x1f7912){_0x5c8587['push'](_0x5c8587['shift']());}}}(a49_0x6380,0x9f868));function a49_0x342a(_0x344b65,_0xb0e364){const _0x6380fd=a49_0x6380();return a49_0x342a=function(_0x342a6e,_0x5a00f2){_0x342a6e=_0x342a6e-0xa3;let _0x28cdf6=_0x6380fd[_0x342a6e];return _0x28cdf6;},a49_0x342a(_0x344b65,_0xb0e364);}Object[a49_0x5542b9(0xed)](exports,a49_0x5542b9(0x11f),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a49_0x5542b9(0xf4));class CoinToPayService{constructor(){const _0x7b341c=a49_0x5542b9;this[_0x7b341c(0xc3)]=_0x7b341c(0x10d),this[_0x7b341c(0xfb)]=_0x7b341c(0xb1),console[_0x7b341c(0x119)](_0x7b341c(0xde)),console[_0x7b341c(0x119)](_0x7b341c(0x118),this[_0x7b341c(0xfb)]);}async[a49_0x5542b9(0x129)](_0x1b1ff5){const _0xeb9184=a49_0x5542b9,{orderId:_0x74a2c2,amount:_0xf46d0c}=_0x1b1ff5;console[_0xeb9184(0x119)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0xf46d0c+_0xeb9184(0xce));const _0x2f4ffa={'amount':_0xf46d0c},_0x40216f=Date[_0xeb9184(0xc5)]();try{console['log'](_0xeb9184(0x10f)),console[_0xeb9184(0x119)](_0xeb9184(0xb0),this[_0xeb9184(0xc3)]),console[_0xeb9184(0x119)]('Request\x20Body:',JSON['stringify'](_0x2f4ffa,null,0x2)),console[_0xeb9184(0x119)]('Amount:',_0xf46d0c,_0xeb9184(0x102)),loggerService_1[_0xeb9184(0xd7)][_0xeb9184(0xb9)](_0xeb9184(0xaf),_0xeb9184(0xca),_0xeb9184(0xc2),_0x2f4ffa);const _0x2d535a=await fetch(this[_0xeb9184(0xc3)],{'method':_0xeb9184(0xc2),'headers':{'Content-Type':_0xeb9184(0x106),'Accept':_0xeb9184(0x106),'User-Agent':_0xeb9184(0xf5)},'body':JSON[_0xeb9184(0xaa)](_0x2f4ffa)}),_0x15a1e2=Date[_0xeb9184(0xc5)]()-_0x40216f;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0xeb9184(0x105),_0x2d535a[_0xeb9184(0x10b)]),console[_0xeb9184(0x119)](_0xeb9184(0xbe),_0x2d535a[_0xeb9184(0xe2)]),console[_0xeb9184(0x119)](_0xeb9184(0xdb),Object['fromEntries'](_0x2d535a[_0xeb9184(0xa7)][_0xeb9184(0xf3)]())),console['log']('Response\x20Time:',_0x15a1e2+'ms');const _0x33918e=await _0x2d535a[_0xeb9184(0xf8)]();console[_0xeb9184(0x119)](_0xeb9184(0xbd),_0x33918e);if(!_0x2d535a['ok']){console[_0xeb9184(0xf0)](_0xeb9184(0x107)),console['error'](_0xeb9184(0x122),_0x2d535a['status']),console[_0xeb9184(0xf0)](_0xeb9184(0x109),_0x33918e),loggerService_1[_0xeb9184(0xd7)]['logWhiteDomainResponse']('cointopay',_0xeb9184(0xca),_0x2d535a[_0xeb9184(0x10b)],_0x33918e,_0x15a1e2),loggerService_1[_0xeb9184(0xd7)]['logWhiteDomainError']('cointopay',_0xeb9184(0xca),_0xeb9184(0xdd)+_0x2d535a[_0xeb9184(0x10b)]+':\x20'+_0x33918e);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2d535a[_0xeb9184(0x10b)]+_0xeb9184(0xac)+_0x33918e);}let _0x536ad0;try{_0x536ad0=JSON[_0xeb9184(0xa6)](_0x33918e);}catch(_0x32257f){console[_0xeb9184(0xf0)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x32257f),loggerService_1[_0xeb9184(0xd7)][_0xeb9184(0xe6)](_0xeb9184(0xaf),_0xeb9184(0xca),_0xeb9184(0x117)+_0x32257f);throw new Error(_0xeb9184(0x12b)+_0x33918e);}console[_0xeb9184(0x119)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0xeb9184(0x119)](_0xeb9184(0xd1),JSON[_0xeb9184(0xaa)](_0x536ad0,null,0x2)),loggerService_1['loggerService'][_0xeb9184(0xb4)](_0xeb9184(0xaf),_0xeb9184(0xca),_0x2d535a[_0xeb9184(0x10b)],_0x536ad0,_0x15a1e2);if(_0x536ad0['error']){const _0x21f530=_0x536ad0[_0xeb9184(0x121)]||_0x536ad0[_0xeb9184(0xf0)]||_0xeb9184(0xec);console[_0xeb9184(0xf0)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xeb9184(0xf0)]('Error\x20Message:',_0x21f530),loggerService_1['loggerService'][_0xeb9184(0xe6)](_0xeb9184(0xaf),_0xeb9184(0xca),_0xeb9184(0x11e)+_0x21f530);throw new Error(_0xeb9184(0x126)+_0x21f530);}if(!_0x536ad0[_0xeb9184(0xbf)]||!_0x536ad0[_0xeb9184(0xe4)]){console[_0xeb9184(0xf0)](_0xeb9184(0x12a)),console['error'](_0xeb9184(0xda)),console['error'](_0xeb9184(0xd5),_0x536ad0),loggerService_1['loggerService'][_0xeb9184(0xe6)](_0xeb9184(0xaf),_0xeb9184(0xca),_0xeb9184(0xea));throw new Error(_0xeb9184(0xe3));}console[_0xeb9184(0x119)](_0xeb9184(0x116)),console['log'](_0xeb9184(0xc1),_0x536ad0[_0xeb9184(0xe4)]),console['log'](_0xeb9184(0xab),_0x536ad0[_0xeb9184(0xbf)]);const _0x2ff7c8=_0x536ad0[_0xeb9184(0xbf)]+_0xeb9184(0xd6);return console[_0xeb9184(0x119)](_0xeb9184(0xad),_0x2ff7c8),console['log'](_0xeb9184(0x10a),_0xf46d0c,'EUR'),{'gateway_payment_id':_0x536ad0[_0xeb9184(0xe4)],'payment_url':_0x2ff7c8};}catch(_0x339f89){console[_0xeb9184(0xf0)](_0xeb9184(0xc8)),console[_0xeb9184(0xf0)](_0xeb9184(0xc7),_0x339f89),loggerService_1[_0xeb9184(0xd7)][_0xeb9184(0xe6)](_0xeb9184(0xaf),_0xeb9184(0xca),_0x339f89);if(_0x339f89 instanceof Error){console[_0xeb9184(0xf0)](_0xeb9184(0x11a),_0x339f89[_0xeb9184(0x121)]),console[_0xeb9184(0xf0)](_0xeb9184(0xb6),_0x339f89['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x339f89[_0xeb9184(0x121)]);}throw new Error(_0xeb9184(0xe1));}}async[a49_0x5542b9(0x110)](_0x3ab068){const _0x5878fd=a49_0x5542b9,_0x46f09e=Date[_0x5878fd(0xc5)]();try{console[_0x5878fd(0x119)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x3ab068);const _0x5f131c={'gatewayPaymentId':_0x3ab068};loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xb9)]('cointopay','/status','POST',_0x5f131c);const _0x4bb93c=await fetch(this[_0x5878fd(0xfb)],{'method':'POST','headers':{'Content-Type':_0x5878fd(0x106),'Accept':_0x5878fd(0x106),'User-Agent':_0x5878fd(0xf5)},'body':JSON[_0x5878fd(0xaa)](_0x5f131c)}),_0x25771e=Date['now']()-_0x46f09e;console[_0x5878fd(0x119)](_0x5878fd(0xee)),console[_0x5878fd(0x119)](_0x5878fd(0x105),_0x4bb93c[_0x5878fd(0x10b)]),console[_0x5878fd(0x119)]('Response\x20Time:',_0x25771e+'ms');if(!_0x4bb93c['ok']){const _0x1215b8=await _0x4bb93c[_0x5878fd(0xf8)]();console[_0x5878fd(0xf0)](_0x5878fd(0x122),_0x4bb93c['status']),console[_0x5878fd(0xf0)](_0x5878fd(0x109),_0x1215b8),loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xb4)](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x4bb93c[_0x5878fd(0x10b)],_0x1215b8,_0x25771e),loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xe6)](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x5878fd(0xdd)+_0x4bb93c[_0x5878fd(0x10b)]+':\x20'+_0x1215b8);throw new Error(_0x5878fd(0xe5)+_0x4bb93c['status']);}const _0x59c1a6=await _0x4bb93c[_0x5878fd(0xf8)]();console['log']('Raw\x20Response\x20Body:',_0x59c1a6);let _0x4f9eb4;try{_0x4f9eb4=JSON[_0x5878fd(0xa6)](_0x59c1a6);}catch(_0x488146){console[_0x5878fd(0xf0)](_0x5878fd(0xd9),_0x488146),loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xe6)](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x5878fd(0x117)+_0x488146);throw new Error(_0x5878fd(0xf1)+_0x59c1a6);}loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xb4)](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x4bb93c[_0x5878fd(0x10b)],_0x4f9eb4,_0x25771e),console[_0x5878fd(0x119)](_0x5878fd(0x114)),console[_0x5878fd(0x119)](_0x5878fd(0xb7),_0x4f9eb4[_0x5878fd(0xeb)]),console[_0x5878fd(0x119)](_0x5878fd(0x108),_0x4f9eb4[_0x5878fd(0x127)]),console[_0x5878fd(0x119)](_0x5878fd(0x128),_0x4f9eb4[_0x5878fd(0xbc)]?.[_0x5878fd(0xa4)]),console['log'](_0x5878fd(0x10a),_0x4f9eb4[_0x5878fd(0xbc)]?.[_0x5878fd(0xcc)]),console[_0x5878fd(0x119)](_0x5878fd(0xd8),_0x4f9eb4[_0x5878fd(0xbc)]?.[_0x5878fd(0xef)]);if(_0x4f9eb4['result']!==_0x5878fd(0x11b)||_0x4f9eb4[_0x5878fd(0x127)]!==0xc8){const _0x200527=_0x4f9eb4[_0x5878fd(0x121)]||_0x5878fd(0xfd);console[_0x5878fd(0xf0)](_0x5878fd(0x111)),console[_0x5878fd(0xf0)](_0x5878fd(0xa9),_0x200527),loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xe6)](_0x5878fd(0xaf),_0x5878fd(0xb8),'Status\x20API\x20Error:\x20'+_0x200527);throw new Error(_0x5878fd(0xae)+_0x200527);}if(!_0x4f9eb4[_0x5878fd(0xbc)]){console[_0x5878fd(0xf0)](_0x5878fd(0x103)),console[_0x5878fd(0xf0)](_0x5878fd(0xa3)),loggerService_1[_0x5878fd(0xd7)]['logWhiteDomainError'](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x5878fd(0xdc));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x4b1aa2='PENDING';switch(_0x4f9eb4[_0x5878fd(0xbc)]['Status']?.[_0x5878fd(0x101)]()){case'paid':_0x4b1aa2='PAID';break;case _0x5878fd(0xc9):case _0x5878fd(0xd2):case _0x5878fd(0xf0):_0x4b1aa2=_0x5878fd(0xba);break;case _0x5878fd(0xc4):case _0x5878fd(0xcd):_0x4b1aa2='EXPIRED';break;case _0x5878fd(0xfc):case _0x5878fd(0xdf):case _0x5878fd(0xff):case'created':default:_0x4b1aa2=_0x5878fd(0xb3);break;}let _0x48b5e3,_0x1aa2e8;if(_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xcb)]){const _0x52f546=_0x4f9eb4['data'][_0x5878fd(0xcb)];console[_0x5878fd(0x119)]('🏦\x20Payment\x20Detail:',_0x52f546);const _0x26e3c8=_0x52f546['match'](/IBAN\s+([A-Z0-9]+)/i);_0x26e3c8&&(_0x48b5e3=_0x26e3c8[0x1],console[_0x5878fd(0x119)]('🏦\x20Extracted\x20IBAN:',_0x48b5e3)),_0x1aa2e8=_0x52f546;}const _0x1101a9={'iban':_0x48b5e3,'bankDetails':_0x1aa2e8,'transactionId':_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0x124)],'coinAddress':_0x4f9eb4['data'][_0x5878fd(0x112)],'qrCodeUrl':_0x4f9eb4[_0x5878fd(0xbc)]['QRCodeURL'],'expiryTime':_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xc0)],'createdOn':_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xcf)],'confirmedOn':_0x4f9eb4['data'][_0x5878fd(0x123)]};console[_0x5878fd(0x119)](_0x5878fd(0xe0)),console[_0x5878fd(0x119)]('Status:',_0x4f9eb4['data'][_0x5878fd(0xa4)],'->',_0x4b1aa2),console['log'](_0x5878fd(0x10a),_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xcc)],_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xef)]),console[_0x5878fd(0x119)]('Transaction\x20ID:',_0x4f9eb4[_0x5878fd(0xbc)]['TransactionID']),console[_0x5878fd(0x119)](_0x5878fd(0x11c),_0x48b5e3||_0x5878fd(0xd4)),console['log'](_0x5878fd(0x11d),_0x4f9eb4[_0x5878fd(0xbc)]['CreatedOn']),console[_0x5878fd(0x119)](_0x5878fd(0x113),_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0x123)]||_0x5878fd(0x115));if(_0x4f9eb4[_0x5878fd(0xbc)]['Status']?.[_0x5878fd(0x101)]()===_0x5878fd(0xdf))console[_0x5878fd(0x119)](_0x5878fd(0x104));else _0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xa4)]?.[_0x5878fd(0x101)]()===_0x5878fd(0xa5)&&console[_0x5878fd(0x119)](_0x5878fd(0x12c));return{'status':_0x4b1aa2,'amount':parseFloat(_0x4f9eb4[_0x5878fd(0xbc)][_0x5878fd(0xcc)])||undefined,'currency':_0x4f9eb4[_0x5878fd(0xbc)]['inputCurrency']||_0x5878fd(0x120),'paymentDetails':_0x1101a9};}catch(_0x19102a){console[_0x5878fd(0xf0)](_0x5878fd(0xb5),_0x19102a),loggerService_1[_0x5878fd(0xd7)][_0x5878fd(0xe6)](_0x5878fd(0xaf),_0x5878fd(0xb8),_0x19102a);throw new Error(_0x5878fd(0xe7)+(_0x19102a instanceof Error?_0x19102a[_0x5878fd(0x121)]:_0x5878fd(0xd3)));}}async[a49_0x5542b9(0x10e)](_0x56fd23){const _0x2867a5=a49_0x5542b9,_0x47361e=await this['checkPaymentStatus'](_0x56fd23);return{'status':_0x47361e[_0x2867a5(0x10b)],'amount':_0x47361e['amount'],'currency':_0x47361e['currency']};}async[a49_0x5542b9(0x10c)](_0xdef991){const _0x116350=a49_0x5542b9;console[_0x116350(0x119)](_0x116350(0xf6),_0xdef991);let _0xa0fc8a=_0x116350(0xb3);switch(_0xdef991['status']?.[_0x116350(0x101)]()){case _0x116350(0xa5):_0xa0fc8a='PAID';break;case'cancelled':case _0x116350(0xd2):case _0x116350(0xf0):_0xa0fc8a='FAILED';break;case _0x116350(0xc4):case'timeout':_0xa0fc8a=_0x116350(0xf2);break;case _0x116350(0xff):case'waiting':case _0x116350(0xdf):case _0x116350(0xe9):default:_0xa0fc8a=_0x116350(0xb3);break;}return{'paymentId':_0xdef991['order_id']||_0xdef991[_0x116350(0xa8)]||'','status':_0xa0fc8a,'amount':_0xdef991[_0x116350(0x100)],'currency':_0xdef991[_0x116350(0xc6)]||_0x116350(0x120)};}}exports[a49_0x5542b9(0xbb)]=CoinToPayService;