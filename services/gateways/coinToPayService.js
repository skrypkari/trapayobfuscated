'use strict';const a40_0x196be0=a40_0x5f15;function a40_0x5f15(_0x358aeb,_0x589c70){const _0x13f95c=a40_0x13f9();return a40_0x5f15=function(_0x5f1525,_0x1d1154){_0x5f1525=_0x5f1525-0x107;let _0x5793e5=_0x13f95c[_0x5f1525];return _0x5793e5;},a40_0x5f15(_0x358aeb,_0x589c70);}(function(_0x5b2184,_0x598976){const _0x142584=a40_0x5f15,_0x20c4d7=_0x5b2184();while(!![]){try{const _0x37c394=parseInt(_0x142584(0x16e))/0x1*(-parseInt(_0x142584(0x120))/0x2)+-parseInt(_0x142584(0x14d))/0x3*(-parseInt(_0x142584(0x11d))/0x4)+parseInt(_0x142584(0x154))/0x5+parseInt(_0x142584(0x178))/0x6+-parseInt(_0x142584(0x14e))/0x7+parseInt(_0x142584(0x185))/0x8*(-parseInt(_0x142584(0x139))/0x9)+parseInt(_0x142584(0x16d))/0xa*(-parseInt(_0x142584(0x151))/0xb);if(_0x37c394===_0x598976)break;else _0x20c4d7['push'](_0x20c4d7['shift']());}catch(_0x2b263b){_0x20c4d7['push'](_0x20c4d7['shift']());}}}(a40_0x13f9,0x62741));Object['defineProperty'](exports,a40_0x196be0(0x108),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x196be0(0x171));class CoinToPayService{constructor(){const _0xb4806d=a40_0x196be0;this[_0xb4806d(0x143)]=_0xb4806d(0x142),this[_0xb4806d(0x110)]=_0xb4806d(0x13b),console[_0xb4806d(0x163)](_0xb4806d(0x169)),console['log'](_0xb4806d(0x164),this[_0xb4806d(0x110)]);}async[a40_0x196be0(0x160)](_0x4de23f){const _0x15be61=a40_0x196be0,{orderId:_0x4e2b0b,amount:_0x26d27f}=_0x4de23f;console[_0x15be61(0x163)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x26d27f+_0x15be61(0x116));const _0x12c090={'amount':_0x26d27f},_0x61fc94=Date[_0x15be61(0x11e)]();try{console[_0x15be61(0x163)](_0x15be61(0x189)),console[_0x15be61(0x163)](_0x15be61(0x15b),this[_0x15be61(0x143)]),console[_0x15be61(0x163)](_0x15be61(0x187),JSON[_0x15be61(0x173)](_0x12c090,null,0x2)),console['log'](_0x15be61(0x17a),_0x26d27f,_0x15be61(0x180)),loggerService_1[_0x15be61(0x153)]['logWhiteDomainRequest']('cointopay',_0x15be61(0x167),_0x15be61(0x126),_0x12c090);const _0x1af7ad=await fetch(this[_0x15be61(0x143)],{'method':_0x15be61(0x126),'headers':{'Content-Type':_0x15be61(0x13a),'Accept':_0x15be61(0x13a),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x12c090)}),_0x4d280a=Date[_0x15be61(0x11e)]()-_0x61fc94;console[_0x15be61(0x163)](_0x15be61(0x162)),console[_0x15be61(0x163)](_0x15be61(0x17d),_0x1af7ad[_0x15be61(0x168)]),console[_0x15be61(0x163)](_0x15be61(0x119),_0x1af7ad[_0x15be61(0x16f)]),console[_0x15be61(0x163)](_0x15be61(0x14b),Object['fromEntries'](_0x1af7ad[_0x15be61(0x11a)][_0x15be61(0x10e)]())),console['log'](_0x15be61(0x118),_0x4d280a+'ms');const _0x30d908=await _0x1af7ad[_0x15be61(0x12a)]();console[_0x15be61(0x163)](_0x15be61(0x18a),_0x30d908);if(!_0x1af7ad['ok']){console[_0x15be61(0x135)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console['error'](_0x15be61(0x113),_0x1af7ad[_0x15be61(0x168)]),console[_0x15be61(0x135)](_0x15be61(0x15f),_0x30d908),loggerService_1[_0x15be61(0x153)][_0x15be61(0x10d)]('cointopay',_0x15be61(0x167),_0x1af7ad['status'],_0x30d908,_0x4d280a),loggerService_1[_0x15be61(0x153)][_0x15be61(0x18b)](_0x15be61(0x124),_0x15be61(0x167),_0x15be61(0x184)+_0x1af7ad['status']+':\x20'+_0x30d908);throw new Error(_0x15be61(0x138)+_0x1af7ad[_0x15be61(0x168)]+',\x20body:\x20'+_0x30d908);}let _0x4feb3d;try{_0x4feb3d=JSON[_0x15be61(0x10a)](_0x30d908);}catch(_0x923634){console['error'](_0x15be61(0x141),_0x923634),loggerService_1[_0x15be61(0x153)][_0x15be61(0x18b)](_0x15be61(0x124),_0x15be61(0x167),_0x15be61(0x157)+_0x923634);throw new Error(_0x15be61(0x133)+_0x30d908);}console[_0x15be61(0x163)](_0x15be61(0x117)),console[_0x15be61(0x163)](_0x15be61(0x112),JSON[_0x15be61(0x173)](_0x4feb3d,null,0x2)),loggerService_1[_0x15be61(0x153)][_0x15be61(0x10d)]('cointopay','/create',_0x1af7ad[_0x15be61(0x168)],_0x4feb3d,_0x4d280a);if(_0x4feb3d[_0x15be61(0x135)]){const _0x35b67d=_0x4feb3d[_0x15be61(0x15a)]||_0x4feb3d[_0x15be61(0x135)]||_0x15be61(0x152);console[_0x15be61(0x135)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x15be61(0x135)]('Error\x20Message:',_0x35b67d),loggerService_1[_0x15be61(0x153)][_0x15be61(0x18b)](_0x15be61(0x124),_0x15be61(0x167),_0x15be61(0x161)+_0x35b67d);throw new Error(_0x15be61(0x17c)+_0x35b67d);}if(!_0x4feb3d[_0x15be61(0x179)]||!_0x4feb3d[_0x15be61(0x175)]){console[_0x15be61(0x135)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x15be61(0x135)](_0x15be61(0x121)),console[_0x15be61(0x135)](_0x15be61(0x13f),_0x4feb3d),loggerService_1[_0x15be61(0x153)][_0x15be61(0x18b)](_0x15be61(0x124),_0x15be61(0x167),_0x15be61(0x172));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x15be61(0x163)](_0x15be61(0x186)),console['log'](_0x15be61(0x155),_0x4feb3d['gateway_payment_id']),console['log']('Payment\x20URL:',_0x4feb3d[_0x15be61(0x179)]),console[_0x15be61(0x163)](_0x15be61(0x17a),_0x26d27f,_0x15be61(0x11f)),{'gateway_payment_id':_0x4feb3d['gateway_payment_id'],'payment_url':_0x4feb3d[_0x15be61(0x179)]};}catch(_0x4648aa){console[_0x15be61(0x135)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x15be61(0x135)](_0x15be61(0x109),_0x4648aa),loggerService_1[_0x15be61(0x153)][_0x15be61(0x18b)](_0x15be61(0x124),_0x15be61(0x167),_0x4648aa);if(_0x4648aa instanceof Error){console[_0x15be61(0x135)](_0x15be61(0x134),_0x4648aa[_0x15be61(0x15a)]),console['error'](_0x15be61(0x12f),_0x4648aa[_0x15be61(0x128)]);throw new Error(_0x15be61(0x12b)+_0x4648aa['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x1f6271){const _0xc982e9=a40_0x196be0,_0x3af053=Date[_0xc982e9(0x11e)]();try{console[_0xc982e9(0x163)](_0xc982e9(0x10c)+_0x1f6271);const _0x1c7317={'gatewayPaymentId':_0x1f6271};loggerService_1[_0xc982e9(0x153)][_0xc982e9(0x13e)](_0xc982e9(0x124),_0xc982e9(0x16b),'POST',_0x1c7317);const _0x543ad8=await fetch(this[_0xc982e9(0x110)],{'method':'POST','headers':{'Content-Type':_0xc982e9(0x13a),'Accept':'application/json','User-Agent':_0xc982e9(0x166)},'body':JSON['stringify'](_0x1c7317)}),_0x267922=Date[_0xc982e9(0x11e)]()-_0x3af053;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0xc982e9(0x17d),_0x543ad8[_0xc982e9(0x168)]),console[_0xc982e9(0x163)]('Response\x20Time:',_0x267922+'ms');if(!_0x543ad8['ok']){const _0xc00a6e=await _0x543ad8[_0xc982e9(0x12a)]();console['error'](_0xc982e9(0x113),_0x543ad8[_0xc982e9(0x168)]),console[_0xc982e9(0x135)](_0xc982e9(0x15f),_0xc00a6e),loggerService_1[_0xc982e9(0x153)][_0xc982e9(0x10d)](_0xc982e9(0x124),_0xc982e9(0x16b),_0x543ad8['status'],_0xc00a6e,_0x267922),loggerService_1[_0xc982e9(0x153)][_0xc982e9(0x18b)](_0xc982e9(0x124),'/status',_0xc982e9(0x184)+_0x543ad8[_0xc982e9(0x168)]+':\x20'+_0xc00a6e);throw new Error(_0xc982e9(0x138)+_0x543ad8[_0xc982e9(0x168)]);}const _0x4fa8d2=await _0x543ad8[_0xc982e9(0x12a)]();console[_0xc982e9(0x163)](_0xc982e9(0x18a),_0x4fa8d2);let _0x2e9232;try{_0x2e9232=JSON[_0xc982e9(0x10a)](_0x4fa8d2);}catch(_0x484e31){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x484e31),loggerService_1[_0xc982e9(0x153)][_0xc982e9(0x18b)](_0xc982e9(0x124),_0xc982e9(0x16b),_0xc982e9(0x157)+_0x484e31);throw new Error(_0xc982e9(0x188)+_0x4fa8d2);}loggerService_1[_0xc982e9(0x153)]['logWhiteDomainResponse'](_0xc982e9(0x124),_0xc982e9(0x16b),_0x543ad8[_0xc982e9(0x168)],_0x2e9232,_0x267922),console[_0xc982e9(0x163)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0xc982e9(0x163)]('Result:',_0x2e9232[_0xc982e9(0x140)]),console[_0xc982e9(0x163)](_0xc982e9(0x132),_0x2e9232['status_code']),console[_0xc982e9(0x163)](_0xc982e9(0x156),_0x2e9232[_0xc982e9(0x10b)]?.[_0xc982e9(0x10f)]),console[_0xc982e9(0x163)]('Amount:',_0x2e9232[_0xc982e9(0x10b)]?.[_0xc982e9(0x123)]),console['log'](_0xc982e9(0x17e),_0x2e9232[_0xc982e9(0x10b)]?.[_0xc982e9(0x147)]);if(_0x2e9232[_0xc982e9(0x140)]!==_0xc982e9(0x11b)||_0x2e9232['status_code']!==0xc8){const _0x887d47=_0x2e9232['message']||_0xc982e9(0x129);console[_0xc982e9(0x135)](_0xc982e9(0x176)),console['error'](_0xc982e9(0x183),_0x887d47),loggerService_1['loggerService'][_0xc982e9(0x18b)](_0xc982e9(0x124),_0xc982e9(0x16b),_0xc982e9(0x159)+_0x887d47);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x887d47);}if(!_0x2e9232[_0xc982e9(0x10b)]){console['error'](_0xc982e9(0x12e)),console[_0xc982e9(0x135)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0xc982e9(0x18b)](_0xc982e9(0x124),_0xc982e9(0x16b),_0xc982e9(0x149));throw new Error(_0xc982e9(0x144));}let _0x124092=_0xc982e9(0x182);switch(_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x10f)]?.[_0xc982e9(0x137)]()){case _0xc982e9(0x145):_0x124092='PAID';break;case _0xc982e9(0x122):case'failed':case _0xc982e9(0x135):_0x124092=_0xc982e9(0x18d);break;case _0xc982e9(0x15d):case _0xc982e9(0x148):_0x124092=_0xc982e9(0x15e);break;case _0xc982e9(0x130):case _0xc982e9(0x136):case _0xc982e9(0x18c):case _0xc982e9(0x131):default:_0x124092=_0xc982e9(0x182);break;}let _0x1947c1,_0x7acb62;if(_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x181)]){const _0x2f5384=_0x2e9232['data'][_0xc982e9(0x181)];console['log'](_0xc982e9(0x114),_0x2f5384);const _0x243e47=_0x2f5384['match'](/IBAN\s+([A-Z0-9]+)/i);_0x243e47&&(_0x1947c1=_0x243e47[0x1],console['log'](_0xc982e9(0x146),_0x1947c1)),_0x7acb62=_0x2f5384;}const _0x2fe771={'iban':_0x1947c1,'bankDetails':_0x7acb62,'transactionId':_0x2e9232['data'][_0xc982e9(0x14a)],'coinAddress':_0x2e9232[_0xc982e9(0x10b)]['coinAddress'],'qrCodeUrl':_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x12c)],'expiryTime':_0x2e9232[_0xc982e9(0x10b)]['ExpiryTime'],'createdOn':_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x127)],'confirmedOn':_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x170)]};console[_0xc982e9(0x163)](_0xc982e9(0x165)),console[_0xc982e9(0x163)](_0xc982e9(0x17d),_0x2e9232['data'][_0xc982e9(0x10f)],'->',_0x124092),console[_0xc982e9(0x163)](_0xc982e9(0x17a),_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x123)],_0x2e9232['data'][_0xc982e9(0x147)]),console[_0xc982e9(0x163)](_0xc982e9(0x12d),_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x14a)]),console[_0xc982e9(0x163)](_0xc982e9(0x150),_0x1947c1||_0xc982e9(0x158)),console['log']('Created\x20On:',_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x127)]),console[_0xc982e9(0x163)](_0xc982e9(0x17b),_0x2e9232['data']['TransactionConfirmedOn']||_0xc982e9(0x111));if(_0x2e9232[_0xc982e9(0x10b)]['Status']?.[_0xc982e9(0x137)]()==='awaiting\x20fiat')console[_0xc982e9(0x163)](_0xc982e9(0x16a));else _0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x10f)]?.[_0xc982e9(0x137)]()===_0xc982e9(0x145)&&console[_0xc982e9(0x163)](_0xc982e9(0x11c));return{'status':_0x124092,'amount':parseFloat(_0x2e9232[_0xc982e9(0x10b)][_0xc982e9(0x123)])||undefined,'currency':_0x2e9232['data'][_0xc982e9(0x147)]||'EUR','paymentDetails':_0x2fe771};}catch(_0x2b158c){console[_0xc982e9(0x135)](_0xc982e9(0x125),_0x2b158c),loggerService_1['loggerService'][_0xc982e9(0x18b)](_0xc982e9(0x124),_0xc982e9(0x16b),_0x2b158c);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x2b158c instanceof Error?_0x2b158c[_0xc982e9(0x15a)]:_0xc982e9(0x15c)));}}async[a40_0x196be0(0x16c)](_0x38159a){const _0x409809=a40_0x196be0,_0x5d4ba4=await this[_0x409809(0x115)](_0x38159a);return{'status':_0x5d4ba4[_0x409809(0x168)],'amount':_0x5d4ba4[_0x409809(0x13c)],'currency':_0x5d4ba4[_0x409809(0x174)]};}async[a40_0x196be0(0x107)](_0x403cbf){const _0x515864=a40_0x196be0;console['log'](_0x515864(0x14f),_0x403cbf);let _0x55e0d6='PENDING';switch(_0x403cbf[_0x515864(0x168)]?.[_0x515864(0x137)]()){case _0x515864(0x145):_0x55e0d6=_0x515864(0x13d);break;case _0x515864(0x122):case'failed':case _0x515864(0x135):_0x55e0d6=_0x515864(0x18d);break;case _0x515864(0x15d):case'timeout':_0x55e0d6=_0x515864(0x15e);break;case _0x515864(0x18c):case'waiting':case _0x515864(0x136):case _0x515864(0x131):default:_0x55e0d6='PENDING';break;}return{'paymentId':_0x403cbf[_0x515864(0x177)]||_0x403cbf[_0x515864(0x17f)]||'','status':_0x55e0d6,'amount':_0x403cbf[_0x515864(0x13c)],'currency':_0x403cbf[_0x515864(0x174)]||_0x515864(0x11f)};}}exports[a40_0x196be0(0x14c)]=CoinToPayService;function a40_0x13f9(){const _0x5e5d92=['Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','cancelled','Amount','cointopay','CoinToPay\x20payment\x20status\x20check\x20error:','POST','CreatedOn','stack','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','text','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','QRCodeURL','Transaction\x20ID:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20stack:','waiting','created','Status\x20Code:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Error\x20message:','error','awaiting\x20fiat','toLowerCase','HTTP\x20error!\x20status:\x20','5871897NWaMsC','application/json','https://tesoft.uk/gateway/cointopay/status.php','amount','PAID','logWhiteDomainRequest','Response\x20data:','result','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/cointopay/','apiUrl','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','paid','🏦\x20Extracted\x20IBAN:','inputCurrency','timeout','Incomplete\x20response:\x20missing\x20data','TransactionID','Headers:','CoinToPayService','872817yfGyHX','2693117qYBSSt','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','IBAN:','58223dCxGAn','Unknown\x20error\x20from\x20CoinToPay\x20API','loggerService','3733105npmBSF','Gateway\x20Payment\x20ID:','Payment\x20Status:','JSON\x20Parse\x20Error:\x20','not\x20found','Status\x20API\x20Error:\x20','message','URL:','Unknown\x20error','expired','EXPIRED','Response\x20Body:','createPaymentLink','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','log','📊\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','TesSoft\x20Payment\x20System/1.0','/create','status','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','/status','verifyPayment','690uacbVJ','64mwLXqa','statusText','TransactionConfirmedOn','../loggerService','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','stringify','currency','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','order_id','2874018KPbcVa','payment_url','Amount:','Confirmed\x20On:','CoinToPay\x20API\x20error:\x20','Status:','Currency:','merchant_reference_id','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','PaymentDetail','PENDING','Error\x20Message:','HTTP\x20','8uHiFal','===\x20COINTOPAY\x20SUCCESS\x20===','Request\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Raw\x20Response\x20Body:','logWhiteDomainError','pending','FAILED','processWebhook','__esModule','Error\x20details:','parse','data','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','logWhiteDomainResponse','entries','Status','statusUrl','not\x20confirmed','Parsed\x20Result:','HTTP\x20Status:','🏦\x20Payment\x20Detail:','checkPaymentStatus','\x20EUR','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Response\x20Time:','Status\x20Text:','headers','success','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','8NnkegG','now','EUR','58ExuwPZ'];a40_0x13f9=function(){return _0x5e5d92;};return a40_0x13f9();}