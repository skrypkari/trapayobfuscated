'use strict';const a40_0x13209f=a40_0x4199;(function(_0x10fc73,_0xbfddc9){const _0x2c4ef0=a40_0x4199,_0x5253f7=_0x10fc73();while(!![]){try{const _0x5a84e5=-parseInt(_0x2c4ef0(0xf0))/0x1*(-parseInt(_0x2c4ef0(0xf1))/0x2)+-parseInt(_0x2c4ef0(0xf4))/0x3*(-parseInt(_0x2c4ef0(0xc3))/0x4)+-parseInt(_0x2c4ef0(0xbb))/0x5*(-parseInt(_0x2c4ef0(0x117))/0x6)+parseInt(_0x2c4ef0(0xae))/0x7*(-parseInt(_0x2c4ef0(0xb6))/0x8)+parseInt(_0x2c4ef0(0xc6))/0x9+parseInt(_0x2c4ef0(0x10a))/0xa+-parseInt(_0x2c4ef0(0x101))/0xb;if(_0x5a84e5===_0xbfddc9)break;else _0x5253f7['push'](_0x5253f7['shift']());}catch(_0x3dedb1){_0x5253f7['push'](_0x5253f7['shift']());}}}(a40_0x38bd,0xaff4c));function a40_0x4199(_0x3354b9,_0x507cb5){const _0x38bd51=a40_0x38bd();return a40_0x4199=function(_0x419958,_0x17bc3c){_0x419958=_0x419958-0xa7;let _0x404a4c=_0x38bd51[_0x419958];return _0x404a4c;},a40_0x4199(_0x3354b9,_0x507cb5);}function a40_0x38bd(){const _0x461d9b=['===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','3ZQrWXS','797602WQVdOz','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20data:','728943AoAlQz','TransactionConfirmedOn','error','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20API','amount','EUR','payment_url','POST','Error\x20details:','paid','32166750YbBJCT','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','status_code','Payment\x20URL:','pending','toLowerCase','apiUrl','Status:','../loggerService','8846060UwmrQo','now','CoinToPayService','not\x20found','text','entries','ExpiryTime','Missing\x20data\x20in\x20response','cointopay','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','inputCurrency','QRCodeURL','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','102012jcBlWP','PaymentDetail','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','currency','Result:','Incomplete\x20response:\x20missing\x20data','cancelled','awaiting\x20fiat','Status\x20API\x20Error:\x20','log','Status','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status\x20Code:','data','Parsed\x20Result:','/create','Failed\x20to\x20parse\x20JSON\x20response:','PAID','Transaction\x20ID:','gateway_payment_id','CoinToPay\x20status\x20API\x20error:\x20','application/json','statusUrl','processWebhook','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Unknown\x20error','stack','TransactionID','\x20EUR','logWhiteDomainResponse','Created\x20On:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','checkPaymentStatus','statusText','Status\x20Text:','4431gDmnkS','coinAddress','success',',\x20body:\x20','merchant_reference_id','https://tesoft.uk/gateway/cointopay/','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Raw\x20Response\x20Body:','17016wJFOXp','EXPIRED','match','FAILED','logWhiteDomainRequest','290shOTPa','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20','https://tesoft.uk/gateway/cointopay/status.php','parse','loggerService','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','20RJtVYM','Error\x20Message:','logWhiteDomainError','6383943vHyBrN','URL:','HTTP\x20Status:','__esModule','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount','TesSoft\x20Payment\x20System/1.0','fromEntries','headers','waiting','created','defineProperty','stringify','Amount:','Response\x20Body:','failed','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Headers:','CoinToPay\x20API\x20error:\x20','Error\x20message:','üè¶\x20Payment\x20Detail:','HTTP\x20error!\x20status:\x20','order_id','CreatedOn','status','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','expired','message','/status','result','PENDING','Confirmed\x20On:','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','IBAN:','timeout','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','createPaymentLink'];a40_0x38bd=function(){return _0x461d9b;};return a40_0x38bd();}Object[a40_0x13209f(0xd1)](exports,a40_0x13209f(0xc9),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x13209f(0x109));class CoinToPayService{constructor(){const _0x30015=a40_0x13209f;this['apiUrl']=_0x30015(0xb3),this[_0x30015(0x12e)]=_0x30015(0xbe),console[_0x30015(0x120)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x30015(0x120)](_0x30015(0xee),this['statusUrl']);}async[a40_0x13209f(0xeb)](_0x4cb96a){const _0x18e023=a40_0x13209f,{orderId:_0x15bfad,amount:_0x15f6d2}=_0x4cb96a;console[_0x18e023(0x120)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x15f6d2+_0x18e023(0xa7));const _0x254b6c={'amount':_0x15f6d2},_0x38f66d=Date[_0x18e023(0x10b)]();try{console[_0x18e023(0x120)](_0x18e023(0xec)),console[_0x18e023(0x120)](_0x18e023(0xc7),this[_0x18e023(0x107)]),console[_0x18e023(0x120)](_0x18e023(0xc1),JSON['stringify'](_0x254b6c,null,0x2)),console[_0x18e023(0x120)](_0x18e023(0xd3),_0x15f6d2,_0x18e023(0xf2)),loggerService_1[_0x18e023(0xc0)][_0x18e023(0xba)](_0x18e023(0x112),_0x18e023(0x127),_0x18e023(0xfe),_0x254b6c);const _0x51c316=await fetch(this[_0x18e023(0x107)],{'method':_0x18e023(0xfe),'headers':{'Content-Type':_0x18e023(0x12d),'Accept':_0x18e023(0x12d),'User-Agent':_0x18e023(0xcc)},'body':JSON['stringify'](_0x254b6c)}),_0xfb4104=Date[_0x18e023(0x10b)]()-_0x38f66d;console[_0x18e023(0x120)](_0x18e023(0xf8)),console[_0x18e023(0x120)]('Status:',_0x51c316[_0x18e023(0xde)]),console[_0x18e023(0x120)](_0x18e023(0xad),_0x51c316[_0x18e023(0xac)]),console[_0x18e023(0x120)](_0x18e023(0xd7),Object[_0x18e023(0xcd)](_0x51c316[_0x18e023(0xce)][_0x18e023(0x10f)]())),console[_0x18e023(0x120)]('Response\x20Time:',_0xfb4104+'ms');const _0xe6c3a6=await _0x51c316[_0x18e023(0x10e)]();console[_0x18e023(0x120)](_0x18e023(0xb5),_0xe6c3a6);if(!_0x51c316['ok']){console['error'](_0x18e023(0x123)),console['error'](_0x18e023(0xc8),_0x51c316[_0x18e023(0xde)]),console[_0x18e023(0xf6)]('Response\x20Body:',_0xe6c3a6),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x18e023(0x112),_0x18e023(0x127),_0x51c316[_0x18e023(0xde)],_0xe6c3a6,_0xfb4104),loggerService_1[_0x18e023(0xc0)][_0x18e023(0xc5)](_0x18e023(0x112),_0x18e023(0x127),_0x18e023(0xbd)+_0x51c316[_0x18e023(0xde)]+':\x20'+_0xe6c3a6);throw new Error(_0x18e023(0xdb)+_0x51c316['status']+_0x18e023(0xb1)+_0xe6c3a6);}let _0x48e48d;try{_0x48e48d=JSON[_0x18e023(0xbf)](_0xe6c3a6);}catch(_0x252b70){console[_0x18e023(0xf6)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x252b70),loggerService_1[_0x18e023(0xc0)]['logWhiteDomainError']('cointopay',_0x18e023(0x127),_0x18e023(0xf9)+_0x252b70);throw new Error(_0x18e023(0xd6)+_0xe6c3a6);}console[_0x18e023(0x120)](_0x18e023(0xed)),console[_0x18e023(0x120)](_0x18e023(0x126),JSON['stringify'](_0x48e48d,null,0x2)),loggerService_1[_0x18e023(0xc0)][_0x18e023(0xa8)](_0x18e023(0x112),_0x18e023(0x127),_0x51c316[_0x18e023(0xde)],_0x48e48d,_0xfb4104);if(_0x48e48d['error']){const _0x24e4c3=_0x48e48d[_0x18e023(0xe1)]||_0x48e48d[_0x18e023(0xf6)]||_0x18e023(0xfa);console['error'](_0x18e023(0xef)),console['error'](_0x18e023(0xc4),_0x24e4c3),loggerService_1[_0x18e023(0xc0)][_0x18e023(0xc5)](_0x18e023(0x112),_0x18e023(0x127),'Business\x20Error:\x20'+_0x24e4c3);throw new Error(_0x18e023(0xd8)+_0x24e4c3);}if(!_0x48e48d['payment_url']||!_0x48e48d[_0x18e023(0x12b)]){console[_0x18e023(0xf6)](_0x18e023(0x113)),console[_0x18e023(0xf6)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x18e023(0xf6)](_0x18e023(0xf3),_0x48e48d),loggerService_1['loggerService'][_0x18e023(0xc5)]('cointopay',_0x18e023(0x127),_0x18e023(0xaa));throw new Error(_0x18e023(0x102));}return console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x18e023(0x120)](_0x18e023(0xe6),_0x48e48d[_0x18e023(0x12b)]),console[_0x18e023(0x120)](_0x18e023(0x104),_0x48e48d['payment_url']),console[_0x18e023(0x120)](_0x18e023(0xd3),_0x15f6d2,_0x18e023(0xfc)),{'gateway_payment_id':_0x48e48d['gateway_payment_id'],'payment_url':_0x48e48d[_0x18e023(0xfd)]};}catch(_0x1340c7){console[_0x18e023(0xf6)](_0x18e023(0x130)),console[_0x18e023(0xf6)](_0x18e023(0xff),_0x1340c7),loggerService_1[_0x18e023(0xc0)][_0x18e023(0xc5)](_0x18e023(0x112),_0x18e023(0x127),_0x1340c7);if(_0x1340c7 instanceof Error){console['error'](_0x18e023(0xd9),_0x1340c7[_0x18e023(0xe1)]),console[_0x18e023(0xf6)]('Error\x20stack:',_0x1340c7[_0x18e023(0x133)]);throw new Error(_0x18e023(0x119)+_0x1340c7[_0x18e023(0xe1)]);}throw new Error(_0x18e023(0xea));}}async[a40_0x13209f(0xab)](_0x3d6b74){const _0x26682c=a40_0x13209f,_0x486131=Date[_0x26682c(0x10b)]();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x3d6b74);const _0x1e3477={'gatewayPaymentId':_0x3d6b74};loggerService_1[_0x26682c(0xc0)][_0x26682c(0xba)](_0x26682c(0x112),_0x26682c(0xe2),_0x26682c(0xfe),_0x1e3477);const _0x30e8c0=await fetch(this[_0x26682c(0x12e)],{'method':_0x26682c(0xfe),'headers':{'Content-Type':'application/json','Accept':_0x26682c(0x12d),'User-Agent':_0x26682c(0xcc)},'body':JSON[_0x26682c(0xd2)](_0x1e3477)}),_0x192a01=Date[_0x26682c(0x10b)]()-_0x486131;console[_0x26682c(0x120)](_0x26682c(0xc2)),console[_0x26682c(0x120)](_0x26682c(0x108),_0x30e8c0[_0x26682c(0xde)]),console[_0x26682c(0x120)]('Response\x20Time:',_0x192a01+'ms');if(!_0x30e8c0['ok']){const _0x961d35=await _0x30e8c0['text']();console[_0x26682c(0xf6)](_0x26682c(0xc8),_0x30e8c0['status']),console[_0x26682c(0xf6)](_0x26682c(0xd4),_0x961d35),loggerService_1[_0x26682c(0xc0)][_0x26682c(0xa8)](_0x26682c(0x112),'/status',_0x30e8c0['status'],_0x961d35,_0x192a01),loggerService_1[_0x26682c(0xc0)][_0x26682c(0xc5)]('cointopay','/status',_0x26682c(0xbd)+_0x30e8c0[_0x26682c(0xde)]+':\x20'+_0x961d35);throw new Error(_0x26682c(0xdb)+_0x30e8c0[_0x26682c(0xde)]);}const _0x324e0c=await _0x30e8c0[_0x26682c(0x10e)]();console['log'](_0x26682c(0xb5),_0x324e0c);let _0x36543a;try{_0x36543a=JSON['parse'](_0x324e0c);}catch(_0x144dc7){console[_0x26682c(0xf6)](_0x26682c(0x128),_0x144dc7),loggerService_1[_0x26682c(0xc0)][_0x26682c(0xc5)](_0x26682c(0x112),'/status',_0x26682c(0xf9)+_0x144dc7);throw new Error(_0x26682c(0xbc)+_0x324e0c);}loggerService_1[_0x26682c(0xc0)][_0x26682c(0xa8)](_0x26682c(0x112),_0x26682c(0xe2),_0x30e8c0['status'],_0x36543a,_0x192a01),console[_0x26682c(0x120)](_0x26682c(0xb4)),console[_0x26682c(0x120)](_0x26682c(0x11b),_0x36543a[_0x26682c(0xe3)]),console[_0x26682c(0x120)](_0x26682c(0x124),_0x36543a[_0x26682c(0x103)]),console[_0x26682c(0x120)]('Payment\x20Status:',_0x36543a[_0x26682c(0x125)]?.[_0x26682c(0x121)]),console[_0x26682c(0x120)]('Amount:',_0x36543a['data']?.[_0x26682c(0xcb)]),console[_0x26682c(0x120)]('Currency:',_0x36543a[_0x26682c(0x125)]?.[_0x26682c(0x114)]);if(_0x36543a[_0x26682c(0xe3)]!==_0x26682c(0xb0)||_0x36543a[_0x26682c(0x103)]!==0xc8){const _0x310af3=_0x36543a['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x26682c(0xf6)](_0x26682c(0x131)),console[_0x26682c(0xf6)](_0x26682c(0xc4),_0x310af3),loggerService_1[_0x26682c(0xc0)][_0x26682c(0xc5)](_0x26682c(0x112),'/status',_0x26682c(0x11f)+_0x310af3);throw new Error(_0x26682c(0x12c)+_0x310af3);}if(!_0x36543a[_0x26682c(0x125)]){console['error'](_0x26682c(0xe7)),console['error'](_0x26682c(0x111)),loggerService_1['loggerService'][_0x26682c(0xc5)](_0x26682c(0x112),_0x26682c(0xe2),_0x26682c(0x11c));throw new Error(_0x26682c(0x122));}let _0x5dcdc8=_0x26682c(0xe4);switch(_0x36543a[_0x26682c(0x125)][_0x26682c(0x121)]?.[_0x26682c(0x106)]()){case _0x26682c(0x100):_0x5dcdc8='PAID';break;case _0x26682c(0x11d):case _0x26682c(0xd5):case _0x26682c(0xf6):_0x5dcdc8=_0x26682c(0xb9);break;case _0x26682c(0xe0):case _0x26682c(0xe9):_0x5dcdc8=_0x26682c(0xb7);break;case _0x26682c(0xcf):case'awaiting\x20fiat':case _0x26682c(0x105):case _0x26682c(0xd0):default:_0x5dcdc8=_0x26682c(0xe4);break;}let _0x4949a2,_0xa67c8e;if(_0x36543a[_0x26682c(0x125)]['PaymentDetail']){const _0x3c34a1=_0x36543a[_0x26682c(0x125)][_0x26682c(0x118)];console['log'](_0x26682c(0xda),_0x3c34a1);const _0x28c760=_0x3c34a1[_0x26682c(0xb8)](/IBAN\s+([A-Z0-9]+)/i);_0x28c760&&(_0x4949a2=_0x28c760[0x1],console[_0x26682c(0x120)]('üè¶\x20Extracted\x20IBAN:',_0x4949a2)),_0xa67c8e=_0x3c34a1;}const _0x42ced0={'iban':_0x4949a2,'bankDetails':_0xa67c8e,'transactionId':_0x36543a['data'][_0x26682c(0x134)],'coinAddress':_0x36543a[_0x26682c(0x125)][_0x26682c(0xaf)],'qrCodeUrl':_0x36543a[_0x26682c(0x125)][_0x26682c(0x115)],'expiryTime':_0x36543a['data'][_0x26682c(0x110)],'createdOn':_0x36543a[_0x26682c(0x125)][_0x26682c(0xdd)],'confirmedOn':_0x36543a[_0x26682c(0x125)][_0x26682c(0xf5)]};console['log'](_0x26682c(0xf7)),console['log'](_0x26682c(0x108),_0x36543a[_0x26682c(0x125)][_0x26682c(0x121)],'->',_0x5dcdc8),console['log']('Amount:',_0x36543a['data']['Amount'],_0x36543a['data']['inputCurrency']),console[_0x26682c(0x120)](_0x26682c(0x12a),_0x36543a[_0x26682c(0x125)][_0x26682c(0x134)]),console[_0x26682c(0x120)](_0x26682c(0xe8),_0x4949a2||_0x26682c(0x10d)),console[_0x26682c(0x120)](_0x26682c(0xa9),_0x36543a[_0x26682c(0x125)]['CreatedOn']),console[_0x26682c(0x120)](_0x26682c(0xe5),_0x36543a[_0x26682c(0x125)][_0x26682c(0xf5)]||'not\x20confirmed');if(_0x36543a['data']['Status']?.[_0x26682c(0x106)]()===_0x26682c(0x11e))console[_0x26682c(0x120)](_0x26682c(0xdf));else _0x36543a['data']['Status']?.[_0x26682c(0x106)]()===_0x26682c(0x100)&&console[_0x26682c(0x120)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x5dcdc8,'amount':parseFloat(_0x36543a[_0x26682c(0x125)]['Amount'])||undefined,'currency':_0x36543a['data'][_0x26682c(0x114)]||_0x26682c(0xfc),'paymentDetails':_0x42ced0};}catch(_0x13e711){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x13e711),loggerService_1[_0x26682c(0xc0)][_0x26682c(0xc5)](_0x26682c(0x112),_0x26682c(0xe2),_0x13e711);throw new Error(_0x26682c(0xca)+(_0x13e711 instanceof Error?_0x13e711[_0x26682c(0xe1)]:_0x26682c(0x132)));}}async['verifyPayment'](_0x597320){const _0xd00fde=a40_0x13209f,_0xb09d7b=await this[_0xd00fde(0xab)](_0x597320);return{'status':_0xb09d7b[_0xd00fde(0xde)],'amount':_0xb09d7b[_0xd00fde(0xfb)],'currency':_0xb09d7b[_0xd00fde(0x11a)]};}async[a40_0x13209f(0x12f)](_0x410bc6){const _0x28b605=a40_0x13209f;console[_0x28b605(0x120)](_0x28b605(0x116),_0x410bc6);let _0x3cb077=_0x28b605(0xe4);switch(_0x410bc6['status']?.['toLowerCase']()){case _0x28b605(0x100):_0x3cb077=_0x28b605(0x129);break;case _0x28b605(0x11d):case _0x28b605(0xd5):case'error':_0x3cb077=_0x28b605(0xb9);break;case _0x28b605(0xe0):case'timeout':_0x3cb077=_0x28b605(0xb7);break;case'pending':case _0x28b605(0xcf):case'awaiting\x20fiat':case _0x28b605(0xd0):default:_0x3cb077=_0x28b605(0xe4);break;}return{'paymentId':_0x410bc6[_0x28b605(0xdc)]||_0x410bc6[_0x28b605(0xb2)]||'','status':_0x3cb077,'amount':_0x410bc6[_0x28b605(0xfb)],'currency':_0x410bc6[_0x28b605(0x11a)]||'EUR'};}}exports[a40_0x13209f(0x10c)]=CoinToPayService;