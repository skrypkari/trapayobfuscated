'use strict';const a38_0x2f4045=a38_0x5843;(function(_0x5376c0,_0x198391){const _0x1cc979=a38_0x5843,_0x3d073f=_0x5376c0();while(!![]){try{const _0x3c8443=-parseInt(_0x1cc979(0xc2))/0x1*(parseInt(_0x1cc979(0xe3))/0x2)+parseInt(_0x1cc979(0xa3))/0x3+parseInt(_0x1cc979(0xda))/0x4+parseInt(_0x1cc979(0x8b))/0x5*(-parseInt(_0x1cc979(0xd5))/0x6)+parseInt(_0x1cc979(0xc5))/0x7+parseInt(_0x1cc979(0xd4))/0x8*(-parseInt(_0x1cc979(0xb3))/0x9)+parseInt(_0x1cc979(0xa6))/0xa;if(_0x3c8443===_0x198391)break;else _0x3d073f['push'](_0x3d073f['shift']());}catch(_0x2e384a){_0x3d073f['push'](_0x3d073f['shift']());}}}(a38_0x5566,0xf247f));function a38_0x5566(){const _0x2d688f=['\x20EUR','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','398467pqJtNq','gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','8620374HHPlmU','pending','Error\x20Message:','CoinToPay\x20status\x20API\x20error:\x20','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','order_id','Payment\x20URL:','POST','JSON\x20Parse\x20Error:\x20','not\x20found','log','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','200hkNGCt','708xeaGnJ','Error\x20stack:','status','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Missing\x20data\x20in\x20response','3251032dKEIHL','statusText','https://tesoft.uk/gateway/cointopay/status.php','EXPIRED','Gateway\x20Payment\x20ID:','Unknown\x20error\x20from\x20CoinToPay\x20API','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainResponse','Status','4hhQaSM','HTTP\x20error!\x20status:\x20','IBAN:','failed','inputCurrency','message','Incomplete\x20response:\x20missing\x20data','Parsed\x20Result:','created','data','CreatedOn','Unknown\x20error','PENDING','parse','Request\x20Body:','Status\x20API\x20Error:\x20','PaymentDetail','Amount','toLowerCase','success','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','TesSoft\x20Payment\x20System/1.0','ðŸ¦\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Response\x20data:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','CoinToPayService','text','Transaction\x20ID:','timeout',',\x20body:\x20','Failed\x20to\x20parse\x20JSON\x20response:','ðŸ¦\x20Extracted\x20IBAN:','PAID','paid','EUR','Status:','TransactionID','status_code','fromEntries','checkPaymentStatus','apiUrl','Status\x20Text:','Confirmed\x20On:','defineProperty','30915HXFrpl','logWhiteDomainError','/create','/status','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','error','HTTP\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Result:','Business\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','stringify','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20Code:','awaiting\x20fiat','Response\x20Time:','cointopay','===\x20COINTOPAY\x20SUCCESS\x20===','not\x20confirmed','result','Response\x20Body:','processWebhook','Error\x20message:','HTTP\x20Status:','4581264AshCtY','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','3862080xMLmVr','verifyPayment','CoinToPay\x20payment\x20status\x20check\x20error:','Headers:','FAILED','headers','waiting','now','https://tesoft.uk/gateway/cointopay/','Amount:','application/json','logWhiteDomainRequest','Raw\x20Response\x20Body:','517905hhhTDl','loggerService','payment_url','TransactionConfirmedOn','===\x20COINTOPAY\x20API\x20ERROR\x20===','QRCodeURL','currency','cancelled','stack','ðŸ“Š\x20Status\x20check\x20URL:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','statusUrl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='];a38_0x5566=function(){return _0x2d688f;};return a38_0x5566();}Object[a38_0x2f4045(0x8a)](exports,'__esModule',{'value':!![]}),exports[a38_0x2f4045(0xff)]=void 0x0;function a38_0x5843(_0x20af8a,_0x2e575a){const _0x55667e=a38_0x5566();return a38_0x5843=function(_0x584378,_0x4475f8){_0x584378=_0x584378-0x83;let _0x326c98=_0x55667e[_0x584378];return _0x326c98;},a38_0x5843(_0x20af8a,_0x2e575a);}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0xb6eddd=a38_0x2f4045;this['apiUrl']=_0xb6eddd(0xae),this[_0xb6eddd(0xbe)]=_0xb6eddd(0xdc),console[_0xb6eddd(0xd0)](_0xb6eddd(0xc9)),console[_0xb6eddd(0xd0)](_0xb6eddd(0xbc),this[_0xb6eddd(0xbe)]);}async['createPaymentLink'](_0x1f44f1){const _0x31c5be=a38_0x2f4045,{orderId:_0x2b317f,amount:_0x5c190c}=_0x1f44f1;console[_0x31c5be(0xd0)](_0x31c5be(0xfc)+_0x5c190c+_0x31c5be(0xc0));const _0x1dc5bf={'amount':_0x5c190c},_0x2474eb=Date[_0x31c5be(0xad)]();try{console['log'](_0x31c5be(0xfa)),console[_0x31c5be(0xd0)]('URL:',this[_0x31c5be(0x87)]),console[_0x31c5be(0xd0)](_0x31c5be(0xf1),JSON[_0x31c5be(0x96)](_0x1dc5bf,null,0x2)),console['log'](_0x31c5be(0xaf),_0x5c190c,_0x31c5be(0xfe)),loggerService_1[_0x31c5be(0xb4)][_0x31c5be(0xb1)](_0x31c5be(0x9b),_0x31c5be(0x8d),_0x31c5be(0xcd),_0x1dc5bf);const _0x4ade39=await fetch(this[_0x31c5be(0x87)],{'method':_0x31c5be(0xcd),'headers':{'Content-Type':_0x31c5be(0xb0),'Accept':'application/json','User-Agent':_0x31c5be(0xf8)},'body':JSON[_0x31c5be(0x96)](_0x1dc5bf)}),_0x3c654a=Date[_0x31c5be(0xad)]()-_0x2474eb;console[_0x31c5be(0xd0)](_0x31c5be(0xd2)),console[_0x31c5be(0xd0)](_0x31c5be(0x109),_0x4ade39[_0x31c5be(0xd7)]),console[_0x31c5be(0xd0)](_0x31c5be(0x88),_0x4ade39[_0x31c5be(0xdb)]),console[_0x31c5be(0xd0)](_0x31c5be(0xa9),Object[_0x31c5be(0x85)](_0x4ade39[_0x31c5be(0xab)]['entries']())),console['log'](_0x31c5be(0x9a),_0x3c654a+'ms');const _0x3b8a53=await _0x4ade39[_0x31c5be(0x100)]();console['log'](_0x31c5be(0xb2),_0x3b8a53);if(!_0x4ade39['ok']){console[_0x31c5be(0x90)](_0x31c5be(0xb7)),console['error'](_0x31c5be(0xa2),_0x4ade39[_0x31c5be(0xd7)]),console[_0x31c5be(0x90)]('Response\x20Body:',_0x3b8a53),loggerService_1['loggerService'][_0x31c5be(0xe1)](_0x31c5be(0x9b),_0x31c5be(0x8d),_0x4ade39['status'],_0x3b8a53,_0x3c654a),loggerService_1[_0x31c5be(0xb4)]['logWhiteDomainError']('cointopay',_0x31c5be(0x8d),_0x31c5be(0x91)+_0x4ade39[_0x31c5be(0xd7)]+':\x20'+_0x3b8a53);throw new Error(_0x31c5be(0xe4)+_0x4ade39[_0x31c5be(0xd7)]+_0x31c5be(0x103)+_0x3b8a53);}let _0x3e7a1b;try{_0x3e7a1b=JSON['parse'](_0x3b8a53);}catch(_0x419739){console[_0x31c5be(0x90)](_0x31c5be(0x104),_0x419739),loggerService_1[_0x31c5be(0xb4)][_0x31c5be(0x8c)](_0x31c5be(0x9b),_0x31c5be(0x8d),_0x31c5be(0xce)+_0x419739);throw new Error(_0x31c5be(0xc4)+_0x3b8a53);}console['log'](_0x31c5be(0xbd)),console[_0x31c5be(0xd0)](_0x31c5be(0xea),JSON[_0x31c5be(0x96)](_0x3e7a1b,null,0x2)),loggerService_1[_0x31c5be(0xb4)][_0x31c5be(0xe1)](_0x31c5be(0x9b),'/create',_0x4ade39[_0x31c5be(0xd7)],_0x3e7a1b,_0x3c654a);if(_0x3e7a1b[_0x31c5be(0x90)]){const _0x849d67=_0x3e7a1b[_0x31c5be(0xe8)]||_0x3e7a1b[_0x31c5be(0x90)]||_0x31c5be(0xdf);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x31c5be(0xc7),_0x849d67),loggerService_1[_0x31c5be(0xb4)][_0x31c5be(0x8c)]('cointopay',_0x31c5be(0x8d),_0x31c5be(0x94)+_0x849d67);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x849d67);}if(!_0x3e7a1b['payment_url']||!_0x3e7a1b[_0x31c5be(0xc3)]){console[_0x31c5be(0x90)](_0x31c5be(0xd3)),console['error'](_0x31c5be(0xe0)),console['error'](_0x31c5be(0xfb),_0x3e7a1b),loggerService_1[_0x31c5be(0xb4)][_0x31c5be(0x8c)](_0x31c5be(0x9b),_0x31c5be(0x8d),_0x31c5be(0xa5));throw new Error(_0x31c5be(0x97));}return console[_0x31c5be(0xd0)](_0x31c5be(0x9c)),console['log'](_0x31c5be(0xde),_0x3e7a1b[_0x31c5be(0xc3)]),console[_0x31c5be(0xd0)](_0x31c5be(0xcc),_0x3e7a1b[_0x31c5be(0xb5)]),console[_0x31c5be(0xd0)](_0x31c5be(0xaf),_0x5c190c,_0x31c5be(0x108)),{'gateway_payment_id':_0x3e7a1b['gateway_payment_id'],'payment_url':_0x3e7a1b[_0x31c5be(0xb5)]};}catch(_0x1f9d3d){console['error'](_0x31c5be(0xbf)),console['error']('Error\x20details:',_0x1f9d3d),loggerService_1['loggerService'][_0x31c5be(0x8c)]('cointopay','/create',_0x1f9d3d);if(_0x1f9d3d instanceof Error){console[_0x31c5be(0x90)](_0x31c5be(0xa1),_0x1f9d3d[_0x31c5be(0xe8)]),console[_0x31c5be(0x90)](_0x31c5be(0xd6),_0x1f9d3d[_0x31c5be(0xbb)]);throw new Error(_0x31c5be(0xf7)+_0x1f9d3d[_0x31c5be(0xe8)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a38_0x2f4045(0x86)](_0x3a578d){const _0x2db90d=a38_0x2f4045,_0x1fa047=Date[_0x2db90d(0xad)]();try{console[_0x2db90d(0xd0)](_0x2db90d(0xd8)+_0x3a578d);const _0x50038c={'gatewayPaymentId':_0x3a578d};loggerService_1[_0x2db90d(0xb4)][_0x2db90d(0xb1)](_0x2db90d(0x9b),'/status',_0x2db90d(0xcd),_0x50038c);const _0xed85a2=await fetch(this[_0x2db90d(0xbe)],{'method':_0x2db90d(0xcd),'headers':{'Content-Type':_0x2db90d(0xb0),'Accept':_0x2db90d(0xb0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x2db90d(0x96)](_0x50038c)}),_0x5e94d3=Date[_0x2db90d(0xad)]()-_0x1fa047;console[_0x2db90d(0xd0)](_0x2db90d(0x95)),console[_0x2db90d(0xd0)](_0x2db90d(0x109),_0xed85a2['status']),console[_0x2db90d(0xd0)](_0x2db90d(0x9a),_0x5e94d3+'ms');if(!_0xed85a2['ok']){const _0x24f5fe=await _0xed85a2[_0x2db90d(0x100)]();console[_0x2db90d(0x90)](_0x2db90d(0xa2),_0xed85a2[_0x2db90d(0xd7)]),console[_0x2db90d(0x90)](_0x2db90d(0x9f),_0x24f5fe),loggerService_1['loggerService'][_0x2db90d(0xe1)](_0x2db90d(0x9b),'/status',_0xed85a2['status'],_0x24f5fe,_0x5e94d3),loggerService_1[_0x2db90d(0xb4)][_0x2db90d(0x8c)](_0x2db90d(0x9b),'/status',_0x2db90d(0x91)+_0xed85a2[_0x2db90d(0xd7)]+':\x20'+_0x24f5fe);throw new Error(_0x2db90d(0xe4)+_0xed85a2['status']);}const _0x26601c=await _0xed85a2['text']();console['log'](_0x2db90d(0xb2),_0x26601c);let _0x37fcf3;try{_0x37fcf3=JSON[_0x2db90d(0xf0)](_0x26601c);}catch(_0x28eb29){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x28eb29),loggerService_1['loggerService'][_0x2db90d(0x8c)](_0x2db90d(0x9b),'/status',_0x2db90d(0xce)+_0x28eb29);throw new Error(_0x2db90d(0xfd)+_0x26601c);}loggerService_1[_0x2db90d(0xb4)][_0x2db90d(0xe1)](_0x2db90d(0x9b),_0x2db90d(0x8e),_0xed85a2['status'],_0x37fcf3,_0x5e94d3),console[_0x2db90d(0xd0)](_0x2db90d(0x92)),console[_0x2db90d(0xd0)](_0x2db90d(0x93),_0x37fcf3[_0x2db90d(0x9e)]),console[_0x2db90d(0xd0)](_0x2db90d(0x98),_0x37fcf3[_0x2db90d(0x84)]),console[_0x2db90d(0xd0)]('Payment\x20Status:',_0x37fcf3['data']?.[_0x2db90d(0xe2)]),console[_0x2db90d(0xd0)](_0x2db90d(0xaf),_0x37fcf3[_0x2db90d(0xec)]?.[_0x2db90d(0xf4)]),console['log']('Currency:',_0x37fcf3[_0x2db90d(0xec)]?.[_0x2db90d(0xe7)]);if(_0x37fcf3['result']!==_0x2db90d(0xf6)||_0x37fcf3[_0x2db90d(0x84)]!==0xc8){const _0x69e37=_0x37fcf3['message']||_0x2db90d(0x8f);console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x2db90d(0xc7),_0x69e37),loggerService_1[_0x2db90d(0xb4)]['logWhiteDomainError']('cointopay',_0x2db90d(0x8e),_0x2db90d(0xf2)+_0x69e37);throw new Error(_0x2db90d(0xc8)+_0x69e37);}if(!_0x37fcf3[_0x2db90d(0xec)]){console[_0x2db90d(0x90)](_0x2db90d(0xa4)),console[_0x2db90d(0x90)](_0x2db90d(0xd9)),loggerService_1[_0x2db90d(0xb4)][_0x2db90d(0x8c)](_0x2db90d(0x9b),'/status',_0x2db90d(0xe9));throw new Error(_0x2db90d(0xd1));}let _0x5b7d18=_0x2db90d(0xef);switch(_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe2)]?.[_0x2db90d(0xf5)]()){case _0x2db90d(0x107):_0x5b7d18=_0x2db90d(0x106);break;case _0x2db90d(0xba):case _0x2db90d(0xe6):case'error':_0x5b7d18=_0x2db90d(0xaa);break;case'expired':case _0x2db90d(0x102):_0x5b7d18=_0x2db90d(0xdd);break;case _0x2db90d(0xac):case'awaiting\x20fiat':case _0x2db90d(0xc6):case _0x2db90d(0xeb):default:_0x5b7d18=_0x2db90d(0xef);break;}let _0x2842d1,_0x10a57c;if(_0x37fcf3['data'][_0x2db90d(0xf3)]){const _0x3cdd4c=_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xf3)];console['log'](_0x2db90d(0xf9),_0x3cdd4c);const _0x3ca3ab=_0x3cdd4c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x3ca3ab&&(_0x2842d1=_0x3ca3ab[0x1],console['log'](_0x2db90d(0x105),_0x2842d1)),_0x10a57c=_0x3cdd4c;}const _0x9ac12e={'iban':_0x2842d1,'bankDetails':_0x10a57c,'transactionId':_0x37fcf3['data']['TransactionID'],'coinAddress':_0x37fcf3[_0x2db90d(0xec)]['coinAddress'],'qrCodeUrl':_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xb8)],'expiryTime':_0x37fcf3['data']['ExpiryTime'],'createdOn':_0x37fcf3['data'][_0x2db90d(0xed)],'confirmedOn':_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xb6)]};console[_0x2db90d(0xd0)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x2db90d(0xd0)](_0x2db90d(0x109),_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe2)],'->',_0x5b7d18),console[_0x2db90d(0xd0)](_0x2db90d(0xaf),_0x37fcf3[_0x2db90d(0xec)]['Amount'],_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe7)]),console[_0x2db90d(0xd0)](_0x2db90d(0x101),_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0x83)]),console[_0x2db90d(0xd0)](_0x2db90d(0xe5),_0x2842d1||_0x2db90d(0xcf)),console[_0x2db90d(0xd0)]('Created\x20On:',_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xed)]),console['log'](_0x2db90d(0x89),_0x37fcf3['data'][_0x2db90d(0xb6)]||_0x2db90d(0x9d));if(_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe2)]?.['toLowerCase']()===_0x2db90d(0x99))console[_0x2db90d(0xd0)]('ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe2)]?.['toLowerCase']()===_0x2db90d(0x107)&&console[_0x2db90d(0xd0)](_0x2db90d(0xc1));return{'status':_0x5b7d18,'amount':parseFloat(_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xf4)])||undefined,'currency':_0x37fcf3[_0x2db90d(0xec)][_0x2db90d(0xe7)]||_0x2db90d(0x108),'paymentDetails':_0x9ac12e};}catch(_0x296faf){console[_0x2db90d(0x90)](_0x2db90d(0xa8),_0x296faf),loggerService_1[_0x2db90d(0xb4)]['logWhiteDomainError'](_0x2db90d(0x9b),_0x2db90d(0x8e),_0x296faf);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x296faf instanceof Error?_0x296faf[_0x2db90d(0xe8)]:_0x2db90d(0xee)));}}async[a38_0x2f4045(0xa7)](_0x21461b){const _0x22e5ed=a38_0x2f4045,_0x9f4e7f=await this['checkPaymentStatus'](_0x21461b);return{'status':_0x9f4e7f['status'],'amount':_0x9f4e7f['amount'],'currency':_0x9f4e7f[_0x22e5ed(0xb9)]};}async[a38_0x2f4045(0xa0)](_0xf3f622){const _0x1aa0e0=a38_0x2f4045;console[_0x1aa0e0(0xd0)](_0x1aa0e0(0xca),_0xf3f622);let _0x5c88db='PENDING';switch(_0xf3f622[_0x1aa0e0(0xd7)]?.[_0x1aa0e0(0xf5)]()){case _0x1aa0e0(0x107):_0x5c88db=_0x1aa0e0(0x106);break;case _0x1aa0e0(0xba):case _0x1aa0e0(0xe6):case _0x1aa0e0(0x90):_0x5c88db=_0x1aa0e0(0xaa);break;case'expired':case _0x1aa0e0(0x102):_0x5c88db=_0x1aa0e0(0xdd);break;case _0x1aa0e0(0xc6):case'waiting':case _0x1aa0e0(0x99):case _0x1aa0e0(0xeb):default:_0x5c88db='PENDING';break;}return{'paymentId':_0xf3f622[_0x1aa0e0(0xcb)]||_0xf3f622['merchant_reference_id']||'','status':_0x5c88db,'amount':_0xf3f622['amount'],'currency':_0xf3f622[_0x1aa0e0(0xb9)]||_0x1aa0e0(0x108)};}}exports[a38_0x2f4045(0xff)]=CoinToPayService;