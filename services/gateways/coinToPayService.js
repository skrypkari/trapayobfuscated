'use strict';const a65_0x839783=a65_0x5c34;(function(_0x3f6e2c,_0x4aa658){const _0x12cb89=a65_0x5c34,_0x42292a=_0x3f6e2c();while(!![]){try{const _0x4a3900=parseInt(_0x12cb89(0x1a4))/0x1*(-parseInt(_0x12cb89(0x192))/0x2)+-parseInt(_0x12cb89(0x1eb))/0x3*(parseInt(_0x12cb89(0x1b2))/0x4)+-parseInt(_0x12cb89(0x216))/0x5*(-parseInt(_0x12cb89(0x1d9))/0x6)+-parseInt(_0x12cb89(0x1ef))/0x7+-parseInt(_0x12cb89(0x1a8))/0x8+parseInt(_0x12cb89(0x18e))/0x9+-parseInt(_0x12cb89(0x1e1))/0xa*(-parseInt(_0x12cb89(0x1a2))/0xb);if(_0x4a3900===_0x4aa658)break;else _0x42292a['push'](_0x42292a['shift']());}catch(_0x5503b0){_0x42292a['push'](_0x42292a['shift']());}}}(a65_0x3a94,0xbb0e1));function a65_0x5c34(_0xb1daee,_0x5b3d64){_0xb1daee=_0xb1daee-0x18a;const _0x3a9491=a65_0x3a94();let _0x5c348c=_0x3a9491[_0xb1daee];return _0x5c348c;}Object['defineProperty'](exports,a65_0x839783(0x1dd),{'value':!![]}),exports[a65_0x839783(0x206)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x1c888d=a65_0x839783;this[_0x1c888d(0x1df)]=_0x1c888d(0x1c2),this['statusUrl']=_0x1c888d(0x1d8),console[_0x1c888d(0x197)](_0x1c888d(0x1d6)),console[_0x1c888d(0x197)](_0x1c888d(0x1de),this[_0x1c888d(0x20d)]);}async[a65_0x839783(0x214)](_0x38ec1f){const _0x99da91=a65_0x839783,{orderId:_0x5e51a8,amount:_0x34d4c9}=_0x38ec1f;console[_0x99da91(0x197)](_0x99da91(0x201)+_0x34d4c9+_0x99da91(0x1ba));const _0x4aa916={'amount':_0x34d4c9},_0x58bfa8=Date[_0x99da91(0x1aa)]();try{console[_0x99da91(0x197)](_0x99da91(0x1cd)),console[_0x99da91(0x197)](_0x99da91(0x1f3),this['apiUrl']),console[_0x99da91(0x197)](_0x99da91(0x199),JSON[_0x99da91(0x1ff)](_0x4aa916,null,0x2)),console['log']('Amount:',_0x34d4c9,_0x99da91(0x1a0)),loggerService_1[_0x99da91(0x1c6)][_0x99da91(0x207)](_0x99da91(0x1e4),_0x99da91(0x18d),'POST',_0x4aa916);const _0x4c7d16=await fetch(this['apiUrl'],{'method':_0x99da91(0x1a1),'headers':{'Content-Type':_0x99da91(0x190),'Accept':'application/json','User-Agent':_0x99da91(0x1f7)},'body':JSON[_0x99da91(0x1ff)](_0x4aa916)}),_0x46ae5e=Date[_0x99da91(0x1aa)]()-_0x58bfa8;console[_0x99da91(0x197)](_0x99da91(0x1f5)),console[_0x99da91(0x197)](_0x99da91(0x1db),_0x4c7d16['status']),console[_0x99da91(0x197)](_0x99da91(0x1e5),_0x4c7d16[_0x99da91(0x1c9)]),console[_0x99da91(0x197)](_0x99da91(0x1ea),Object[_0x99da91(0x1bf)](_0x4c7d16[_0x99da91(0x211)][_0x99da91(0x203)]())),console[_0x99da91(0x197)](_0x99da91(0x18c),_0x46ae5e+'ms');const _0x373f19=await _0x4c7d16['text']();console[_0x99da91(0x197)]('Raw\x20Response\x20Body:',_0x373f19);if(!_0x4c7d16['ok']){console[_0x99da91(0x213)](_0x99da91(0x1c7)),console['error'](_0x99da91(0x191),_0x4c7d16[_0x99da91(0x1e6)]),console['error'](_0x99da91(0x1f4),_0x373f19),loggerService_1[_0x99da91(0x1c6)][_0x99da91(0x195)]('cointopay','/create',_0x4c7d16[_0x99da91(0x1e6)],_0x373f19,_0x46ae5e),loggerService_1[_0x99da91(0x1c6)][_0x99da91(0x1ac)](_0x99da91(0x1e4),_0x99da91(0x18d),'HTTP\x20'+_0x4c7d16[_0x99da91(0x1e6)]+':\x20'+_0x373f19);throw new Error(_0x99da91(0x1e8)+_0x4c7d16[_0x99da91(0x1e6)]+_0x99da91(0x1ec)+_0x373f19);}let _0x449a4d;try{_0x449a4d=JSON[_0x99da91(0x1a7)](_0x373f19);}catch(_0x4bd7d5){console[_0x99da91(0x213)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4bd7d5),loggerService_1['loggerService']['logWhiteDomainError'](_0x99da91(0x1e4),_0x99da91(0x18d),'JSON\x20Parse\x20Error:\x20'+_0x4bd7d5);throw new Error(_0x99da91(0x1e2)+_0x373f19);}console['log'](_0x99da91(0x18f)),console[_0x99da91(0x197)](_0x99da91(0x1b3),JSON['stringify'](_0x449a4d,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x99da91(0x1e4),_0x99da91(0x18d),_0x4c7d16[_0x99da91(0x1e6)],_0x449a4d,_0x46ae5e);if(_0x449a4d['error']){const _0x3bdc0d=_0x449a4d[_0x99da91(0x1b5)]||_0x449a4d[_0x99da91(0x213)]||_0x99da91(0x20e);console[_0x99da91(0x213)](_0x99da91(0x212)),console['error']('Error\x20Message:',_0x3bdc0d),loggerService_1['loggerService'][_0x99da91(0x1ac)](_0x99da91(0x1e4),_0x99da91(0x18d),_0x99da91(0x209)+_0x3bdc0d);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x3bdc0d);}if(!_0x449a4d['payment_url']||!_0x449a4d[_0x99da91(0x208)]){console[_0x99da91(0x213)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x99da91(0x213)](_0x99da91(0x1d1)),console[_0x99da91(0x213)](_0x99da91(0x1b0),_0x449a4d),loggerService_1[_0x99da91(0x1c6)][_0x99da91(0x1ac)]('cointopay',_0x99da91(0x18d),_0x99da91(0x1d5));throw new Error(_0x99da91(0x19d));}console[_0x99da91(0x197)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x99da91(0x1d3),_0x449a4d[_0x99da91(0x208)]),console[_0x99da91(0x197)](_0x99da91(0x1a6),_0x449a4d['payment_url']);const _0x1cdc50=_0x449a4d[_0x99da91(0x1c0)]+_0x99da91(0x20a);return console[_0x99da91(0x197)](_0x99da91(0x210),_0x1cdc50),console[_0x99da91(0x197)](_0x99da91(0x18a),_0x34d4c9,_0x99da91(0x20b)),{'gateway_payment_id':_0x449a4d[_0x99da91(0x208)],'payment_url':_0x1cdc50};}catch(_0x5ce4df){console[_0x99da91(0x213)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x5ce4df),loggerService_1['loggerService'][_0x99da91(0x1ac)]('cointopay',_0x99da91(0x18d),_0x5ce4df);if(_0x5ce4df instanceof Error){console[_0x99da91(0x213)](_0x99da91(0x19e),_0x5ce4df['message']),console[_0x99da91(0x213)](_0x99da91(0x1d0),_0x5ce4df[_0x99da91(0x1ce)]);throw new Error(_0x99da91(0x1e0)+_0x5ce4df['message']);}throw new Error(_0x99da91(0x1f8));}}async['checkPaymentStatus'](_0x3b2741){const _0xae9e6d=a65_0x839783,_0x186d02=Date['now']();try{console[_0xae9e6d(0x197)](_0xae9e6d(0x1ed)+_0x3b2741);const _0x412bdd={'gatewayPaymentId':_0x3b2741};loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x207)](_0xae9e6d(0x1e4),_0xae9e6d(0x204),_0xae9e6d(0x1a1),_0x412bdd);const _0x29f150=await fetch(this[_0xae9e6d(0x20d)],{'method':_0xae9e6d(0x1a1),'headers':{'Content-Type':_0xae9e6d(0x190),'Accept':'application/json','User-Agent':_0xae9e6d(0x1f7)},'body':JSON[_0xae9e6d(0x1ff)](_0x412bdd)}),_0x465836=Date['now']()-_0x186d02;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xae9e6d(0x197)](_0xae9e6d(0x1db),_0x29f150[_0xae9e6d(0x1e6)]),console['log'](_0xae9e6d(0x18c),_0x465836+'ms');if(!_0x29f150['ok']){const _0x1bcee8=await _0x29f150[_0xae9e6d(0x1c8)]();console[_0xae9e6d(0x213)]('HTTP\x20Status:',_0x29f150[_0xae9e6d(0x1e6)]),console[_0xae9e6d(0x213)]('Response\x20Body:',_0x1bcee8),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xae9e6d(0x1e4),_0xae9e6d(0x204),_0x29f150['status'],_0x1bcee8,_0x465836),loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x1ac)](_0xae9e6d(0x1e4),'/status',_0xae9e6d(0x1fa)+_0x29f150['status']+':\x20'+_0x1bcee8);throw new Error(_0xae9e6d(0x1e8)+_0x29f150[_0xae9e6d(0x1e6)]);}const _0x4ac40b=await _0x29f150['text']();console['log'](_0xae9e6d(0x1ae),_0x4ac40b);let _0x326843;try{_0x326843=JSON['parse'](_0x4ac40b);}catch(_0x2f0810){console['error'](_0xae9e6d(0x1f6),_0x2f0810),loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x1ac)](_0xae9e6d(0x1e4),_0xae9e6d(0x204),'JSON\x20Parse\x20Error:\x20'+_0x2f0810);throw new Error(_0xae9e6d(0x1fb)+_0x4ac40b);}loggerService_1[_0xae9e6d(0x1c6)]['logWhiteDomainResponse'](_0xae9e6d(0x1e4),_0xae9e6d(0x204),_0x29f150[_0xae9e6d(0x1e6)],_0x326843,_0x465836),console[_0xae9e6d(0x197)](_0xae9e6d(0x1cb)),console[_0xae9e6d(0x197)](_0xae9e6d(0x1be),_0x326843['result']),console[_0xae9e6d(0x197)](_0xae9e6d(0x1f0),_0x326843['status_code']),console['log'](_0xae9e6d(0x1d4),_0x326843[_0xae9e6d(0x194)]?.[_0xae9e6d(0x1ee)]),console[_0xae9e6d(0x197)](_0xae9e6d(0x18a),_0x326843[_0xae9e6d(0x194)]?.[_0xae9e6d(0x19f)]),console[_0xae9e6d(0x197)](_0xae9e6d(0x1bc),_0x326843[_0xae9e6d(0x194)]?.[_0xae9e6d(0x1f1)]);if(_0x326843['result']!==_0xae9e6d(0x215)||_0x326843[_0xae9e6d(0x1a9)]!==0xc8){const _0xba0133=_0x326843[_0xae9e6d(0x1b5)]||_0xae9e6d(0x1d2);console[_0xae9e6d(0x213)](_0xae9e6d(0x1cc)),console['error'](_0xae9e6d(0x18b),_0xba0133),loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x1ac)](_0xae9e6d(0x1e4),'/status','Status\x20API\x20Error:\x20'+_0xba0133);throw new Error(_0xae9e6d(0x1bd)+_0xba0133);}if(!_0x326843[_0xae9e6d(0x194)]){console[_0xae9e6d(0x213)](_0xae9e6d(0x1c4)),console[_0xae9e6d(0x213)](_0xae9e6d(0x1dc)),loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x1ac)](_0xae9e6d(0x1e4),_0xae9e6d(0x204),_0xae9e6d(0x1f9));throw new Error(_0xae9e6d(0x1af));}let _0xac695a=_0xae9e6d(0x1cf);switch(_0x326843[_0xae9e6d(0x194)]['Status']?.['toLowerCase']()){case _0xae9e6d(0x19b):_0xac695a=_0xae9e6d(0x1bb);break;case _0xae9e6d(0x1b6):case'failed':case _0xae9e6d(0x213):_0xac695a=_0xae9e6d(0x1b1);break;case _0xae9e6d(0x193):case'timeout':_0xac695a=_0xae9e6d(0x1fe);break;case _0xae9e6d(0x1c5):case _0xae9e6d(0x19a):case _0xae9e6d(0x1b9):case _0xae9e6d(0x1c3):default:_0xac695a=_0xae9e6d(0x1cf);break;}let _0x3f7d6c,_0x10945f;if(_0x326843['data']['PaymentDetail']){const _0x5cb37c=_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1f2)];console[_0xae9e6d(0x197)](_0xae9e6d(0x1fc),_0x5cb37c);const _0xf7d5ff=_0x5cb37c[_0xae9e6d(0x196)](/IBAN\s+([A-Z0-9]+)/i);_0xf7d5ff&&(_0x3f7d6c=_0xf7d5ff[0x1],console['log'](_0xae9e6d(0x1fd),_0x3f7d6c)),_0x10945f=_0x5cb37c;}const _0x5e28ff={'iban':_0x3f7d6c,'bankDetails':_0x10945f,'transactionId':_0x326843['data'][_0xae9e6d(0x1ca)],'coinAddress':_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1a5)],'qrCodeUrl':_0x326843[_0xae9e6d(0x194)]['QRCodeURL'],'expiryTime':_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1d7)],'createdOn':_0x326843[_0xae9e6d(0x194)]['CreatedOn'],'confirmedOn':_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x19c)]};console[_0xae9e6d(0x197)](_0xae9e6d(0x1e7)),console['log'](_0xae9e6d(0x1db),_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1ee)],'->',_0xac695a),console[_0xae9e6d(0x197)]('Amount:',_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x19f)],_0x326843[_0xae9e6d(0x194)]['inputCurrency']),console[_0xae9e6d(0x197)](_0xae9e6d(0x1e9),_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1ca)]),console['log'](_0xae9e6d(0x1b8),_0x3f7d6c||'not\x20found'),console['log'](_0xae9e6d(0x1c1),_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x20c)]),console[_0xae9e6d(0x197)](_0xae9e6d(0x1b4),_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x19c)]||_0xae9e6d(0x1a3));if(_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1ee)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0xae9e6d(0x197)](_0xae9e6d(0x1da));else _0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1ee)]?.[_0xae9e6d(0x1b7)]()===_0xae9e6d(0x19b)&&console['log'](_0xae9e6d(0x198));return{'status':_0xac695a,'amount':parseFloat(_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x19f)])||undefined,'currency':_0x326843[_0xae9e6d(0x194)][_0xae9e6d(0x1f1)]||'EUR','paymentDetails':_0x5e28ff};}catch(_0x1d647f){console[_0xae9e6d(0x213)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x1d647f),loggerService_1[_0xae9e6d(0x1c6)][_0xae9e6d(0x1ac)](_0xae9e6d(0x1e4),_0xae9e6d(0x204),_0x1d647f);throw new Error(_0xae9e6d(0x205)+(_0x1d647f instanceof Error?_0x1d647f[_0xae9e6d(0x1b5)]:_0xae9e6d(0x1ad)));}}async['verifyPayment'](_0x4ce318){const _0x2b6da9=a65_0x839783,_0x152ab3=await this[_0x2b6da9(0x200)](_0x4ce318);return{'status':_0x152ab3[_0x2b6da9(0x1e6)],'amount':_0x152ab3[_0x2b6da9(0x1ab)],'currency':_0x152ab3[_0x2b6da9(0x20f)]};}async['processWebhook'](_0x1cbb3d){const _0x44d652=a65_0x839783;console[_0x44d652(0x197)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x1cbb3d);let _0x7eb679=_0x44d652(0x1cf);switch(_0x1cbb3d[_0x44d652(0x1e6)]?.['toLowerCase']()){case _0x44d652(0x19b):_0x7eb679=_0x44d652(0x1bb);break;case _0x44d652(0x1b6):case _0x44d652(0x1e3):case _0x44d652(0x213):_0x7eb679=_0x44d652(0x1b1);break;case _0x44d652(0x193):case'timeout':_0x7eb679=_0x44d652(0x1fe);break;case'pending':case'waiting':case _0x44d652(0x19a):case _0x44d652(0x1c3):default:_0x7eb679='PENDING';break;}return{'paymentId':_0x1cbb3d['order_id']||_0x1cbb3d[_0x44d652(0x202)]||'','status':_0x7eb679,'amount':_0x1cbb3d[_0x44d652(0x1ab)],'currency':_0x1cbb3d[_0x44d652(0x20f)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;function a65_0x3a94(){const _0x20712b=['10YFoRYK','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','failed','cointopay','Status\x20Text:','status','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','HTTP\x20error!\x20status:\x20','Transaction\x20ID:','Headers:','512901naAIwt',',\x20body:\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status','4073727yVCxQJ','Status\x20Code:','inputCurrency','PaymentDetail','URL:','Response\x20Body:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Failed\x20to\x20parse\x20JSON\x20response:','Payment\x20System/1.0','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Incomplete\x20response:\x20missing\x20data','HTTP\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','üè¶\x20Payment\x20Detail:','üè¶\x20Extracted\x20IBAN:','EXPIRED','stringify','checkPaymentStatus','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','merchant_reference_id','entries','/status','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','CoinToPayService','logWhiteDomainRequest','gateway_payment_id','Business\x20Error:\x20','&alternative=false','EUR','CreatedOn','statusUrl','Unknown\x20error\x20from\x20CoinToPay\x20API','currency','Payment\x20URL\x20(modified):','headers','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','error','createPaymentLink','success','5PGDRkW','Amount:','Error\x20Message:','Response\x20Time:','/create','6908499RFRXVg','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','application/json','HTTP\x20Status:','14KPNtQV','expired','data','logWhiteDomainResponse','match','log','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Request\x20Body:','awaiting\x20fiat','paid','TransactionConfirmedOn','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20message:','Amount','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','POST','37835743NSOMgX','not\x20confirmed','152899PZyKfI','coinAddress','Payment\x20URL\x20(original):','parse','10074120aSgeol','status_code','now','amount','logWhiteDomainError','Unknown\x20error','Raw\x20Response\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Response\x20data:','FAILED','28ynHRfx','Parsed\x20Result:','Confirmed\x20On:','message','cancelled','toLowerCase','IBAN:','pending','\x20EUR','PAID','Currency:','CoinToPay\x20status\x20API\x20error:\x20','Result:','fromEntries','payment_url','Created\x20On:','https://tesoft.uk/gateway/cointopay/','created','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','waiting','loggerService','===\x20COINTOPAY\x20API\x20ERROR\x20===','text','statusText','TransactionID','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','stack','PENDING','Error\x20stack:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Gateway\x20Payment\x20ID:','Payment\x20Status:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','ExpiryTime','https://tesoft.uk/gateway/cointopay/status.php','4003446ugLraP','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status:','Missing\x20data\x20in\x20response','__esModule','üìä\x20Status\x20check\x20URL:','apiUrl','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'];a65_0x3a94=function(){return _0x20712b;};return a65_0x3a94();}