'use strict';const a43_0x37f428=a43_0x3f87;(function(_0x51e087,_0x13f299){const _0x3e212a=a43_0x3f87,_0x401223=_0x51e087();while(!![]){try{const _0x36e08f=parseInt(_0x3e212a(0x161))/0x1*(parseInt(_0x3e212a(0x130))/0x2)+parseInt(_0x3e212a(0x179))/0x3+parseInt(_0x3e212a(0x182))/0x4+-parseInt(_0x3e212a(0x12f))/0x5+-parseInt(_0x3e212a(0x15a))/0x6*(-parseInt(_0x3e212a(0x15e))/0x7)+parseInt(_0x3e212a(0x187))/0x8*(parseInt(_0x3e212a(0x174))/0x9)+-parseInt(_0x3e212a(0x15d))/0xa;if(_0x36e08f===_0x13f299)break;else _0x401223['push'](_0x401223['shift']());}catch(_0x270034){_0x401223['push'](_0x401223['shift']());}}}(a43_0x2a9c,0x5f8c7));Object['defineProperty'](exports,a43_0x37f428(0x121),{'value':!![]}),exports[a43_0x37f428(0x11a)]=void 0x0;function a43_0x2a9c(){const _0x1c879e=['apiUrl','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','pending','===\x20COINTOPAY\x20API\x20ERROR\x20===','Status','processWebhook','stack','inputCurrency','expired','toLowerCase','TransactionConfirmedOn','Unknown\x20error','Response\x20data:','order_id','Headers:','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','failed','coinAddress','Amount:','Error\x20message:','Incomplete\x20response:\x20missing\x20data','paid','QRCodeURL','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API',',\x20body:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Business\x20Error:\x20','222QwxqMc','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Currency:','19389350OWGKQB','142261JpQaUa','merchant_reference_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','399319OoqxeV','error','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','log','loggerService','fromEntries','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','/status','logWhiteDomainError','Status\x20Code:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Payment\x20Status:','Transaction\x20ID:','CoinToPay\x20API\x20error:\x20','EUR','CreatedOn','Missing\x20data\x20in\x20response','HTTP\x20Status:','185085MUFvlK','payment_url','checkPaymentStatus','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','593778XvunCv','HTTP\x20error!\x20status:\x20','Amount','Error\x20details:','TransactionID','CoinToPay\x20payment\x20status\x20check\x20error:','Confirmed\x20On:','application/json','status_code','2369732EOaZab','text','üè¶\x20Extracted\x20IBAN:','status','Raw\x20Response\x20Body:','296TyBclD','FAILED','gateway_payment_id','IBAN:','Payment\x20URL:','TesSoft\x20Payment\x20System/1.0','parse','stringify','Response\x20Time:','HTTP\x20','üè¶\x20Payment\x20Detail:','awaiting\x20fiat','message','/create','match','PaymentDetail','Status:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','entries','Request\x20Body:','EXPIRED','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','currency','result','logWhiteDomainResponse','PENDING','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20Text:','POST','CoinToPayService','now','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','headers','Unknown\x20error\x20from\x20CoinToPay\x20API','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Error\x20Message:','__esModule','ExpiryTime','Created\x20On:','Failed\x20to\x20parse\x20JSON\x20response:','cointopay','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','waiting','URL:','Response\x20Body:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','1861160sWVHew','2nmPznZ','JSON\x20Parse\x20Error:\x20','timeout','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','created','https://tesoft.uk/gateway/cointopay/','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cancelled','Error\x20stack:','Result:','Status\x20API\x20Error:\x20','statusText','data','verifyPayment'];a43_0x2a9c=function(){return _0x1c879e;};return a43_0x2a9c();}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x2fa3b4=a43_0x37f428;this[_0x2fa3b4(0x13e)]=_0x2fa3b4(0x135),this['statusUrl']=_0x2fa3b4(0x111),console[_0x2fa3b4(0x164)](_0x2fa3b4(0x177)),console[_0x2fa3b4(0x164)]('üìä\x20Status\x20check\x20URL:',this['statusUrl']);}async['createPaymentLink'](_0x29cbab){const _0x1e7bd2=a43_0x37f428,{orderId:_0x1d2332,amount:_0x57974d}=_0x29cbab;console['log'](_0x1e7bd2(0x158)+_0x57974d+'\x20EUR');const _0x4a0260={'amount':_0x57974d},_0x316a3e=Date['now']();try{console[_0x1e7bd2(0x164)](_0x1e7bd2(0x11c)),console[_0x1e7bd2(0x164)](_0x1e7bd2(0x12b),this[_0x1e7bd2(0x13e)]),console['log'](_0x1e7bd2(0x10f),JSON[_0x1e7bd2(0x18e)](_0x4a0260,null,0x2)),console[_0x1e7bd2(0x164)](_0x1e7bd2(0x151),_0x57974d,_0x1e7bd2(0x178)),loggerService_1[_0x1e7bd2(0x165)]['logWhiteDomainRequest'](_0x1e7bd2(0x125),_0x1e7bd2(0x194),_0x1e7bd2(0x119),_0x4a0260);const _0x41c9ac=await fetch(this['apiUrl'],{'method':_0x1e7bd2(0x119),'headers':{'Content-Type':'application/json','Accept':_0x1e7bd2(0x180),'User-Agent':_0x1e7bd2(0x18c)},'body':JSON[_0x1e7bd2(0x18e)](_0x4a0260)}),_0x2295db=Date[_0x1e7bd2(0x11b)]()-_0x316a3e;console['log'](_0x1e7bd2(0x167)),console['log']('Status:',_0x41c9ac[_0x1e7bd2(0x185)]),console[_0x1e7bd2(0x164)](_0x1e7bd2(0x118),_0x41c9ac[_0x1e7bd2(0x13b)]),console['log'](_0x1e7bd2(0x14c),Object[_0x1e7bd2(0x166)](_0x41c9ac[_0x1e7bd2(0x11d)][_0x1e7bd2(0x19a)]())),console[_0x1e7bd2(0x164)]('Response\x20Time:',_0x2295db+'ms');const _0x2b8a92=await _0x41c9ac['text']();console[_0x1e7bd2(0x164)](_0x1e7bd2(0x186),_0x2b8a92);if(!_0x41c9ac['ok']){console[_0x1e7bd2(0x162)](_0x1e7bd2(0x141)),console[_0x1e7bd2(0x162)]('HTTP\x20Status:',_0x41c9ac['status']),console['error'](_0x1e7bd2(0x12c),_0x2b8a92),loggerService_1['loggerService'][_0x1e7bd2(0x115)](_0x1e7bd2(0x125),_0x1e7bd2(0x194),_0x41c9ac[_0x1e7bd2(0x185)],_0x2b8a92,_0x2295db),loggerService_1[_0x1e7bd2(0x165)]['logWhiteDomainError'](_0x1e7bd2(0x125),_0x1e7bd2(0x194),_0x1e7bd2(0x190)+_0x41c9ac[_0x1e7bd2(0x185)]+':\x20'+_0x2b8a92);throw new Error(_0x1e7bd2(0x17a)+_0x41c9ac[_0x1e7bd2(0x185)]+_0x1e7bd2(0x157)+_0x2b8a92);}let _0xffe504;try{_0xffe504=JSON[_0x1e7bd2(0x18d)](_0x2b8a92);}catch(_0x1c2259){console[_0x1e7bd2(0x162)](_0x1e7bd2(0x124),_0x1c2259),loggerService_1['loggerService']['logWhiteDomainError'](_0x1e7bd2(0x125),_0x1e7bd2(0x194),_0x1e7bd2(0x131)+_0x1c2259);throw new Error(_0x1e7bd2(0x14e)+_0x2b8a92);}console[_0x1e7bd2(0x164)](_0x1e7bd2(0x12d)),console['log']('Parsed\x20Result:',JSON[_0x1e7bd2(0x18e)](_0xffe504,null,0x2)),loggerService_1[_0x1e7bd2(0x165)]['logWhiteDomainResponse']('cointopay',_0x1e7bd2(0x194),_0x41c9ac[_0x1e7bd2(0x185)],_0xffe504,_0x2295db);if(_0xffe504[_0x1e7bd2(0x162)]){const _0x482af3=_0xffe504[_0x1e7bd2(0x193)]||_0xffe504['error']||_0x1e7bd2(0x11e);console[_0x1e7bd2(0x162)](_0x1e7bd2(0x133)),console[_0x1e7bd2(0x162)](_0x1e7bd2(0x120),_0x482af3),loggerService_1[_0x1e7bd2(0x165)][_0x1e7bd2(0x169)](_0x1e7bd2(0x125),'/create',_0x1e7bd2(0x159)+_0x482af3);throw new Error(_0x1e7bd2(0x16f)+_0x482af3);}if(!_0xffe504['payment_url']||!_0xffe504[_0x1e7bd2(0x189)]){console['error'](_0x1e7bd2(0x16b)),console[_0x1e7bd2(0x162)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1e7bd2(0x162)](_0x1e7bd2(0x14a),_0xffe504),loggerService_1[_0x1e7bd2(0x165)][_0x1e7bd2(0x169)](_0x1e7bd2(0x125),_0x1e7bd2(0x194),_0x1e7bd2(0x128));throw new Error(_0x1e7bd2(0x136));}return console[_0x1e7bd2(0x164)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x1e7bd2(0x164)]('Gateway\x20Payment\x20ID:',_0xffe504[_0x1e7bd2(0x189)]),console[_0x1e7bd2(0x164)](_0x1e7bd2(0x18b),_0xffe504['payment_url']),console['log'](_0x1e7bd2(0x151),_0x57974d,_0x1e7bd2(0x170)),{'gateway_payment_id':_0xffe504['gateway_payment_id'],'payment_url':_0xffe504[_0x1e7bd2(0x175)]};}catch(_0x3b930a){console['error'](_0x1e7bd2(0x198)),console[_0x1e7bd2(0x162)](_0x1e7bd2(0x17c),_0x3b930a),loggerService_1[_0x1e7bd2(0x165)][_0x1e7bd2(0x169)](_0x1e7bd2(0x125),'/create',_0x3b930a);if(_0x3b930a instanceof Error){console[_0x1e7bd2(0x162)](_0x1e7bd2(0x152),_0x3b930a[_0x1e7bd2(0x193)]),console[_0x1e7bd2(0x162)](_0x1e7bd2(0x138),_0x3b930a[_0x1e7bd2(0x144)]);throw new Error(_0x1e7bd2(0x11f)+_0x3b930a['message']);}throw new Error(_0x1e7bd2(0x117));}}async['checkPaymentStatus'](_0x15910a){const _0xf075cd=a43_0x37f428,_0x3aa235=Date[_0xf075cd(0x11b)]();try{console[_0xf075cd(0x164)](_0xf075cd(0x15b)+_0x15910a);const _0x296ea8={'gatewayPaymentId':_0x15910a};loggerService_1[_0xf075cd(0x165)]['logWhiteDomainRequest'](_0xf075cd(0x125),_0xf075cd(0x168),_0xf075cd(0x119),_0x296ea8);const _0x10a65b=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0xf075cd(0x180),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0xf075cd(0x18e)](_0x296ea8)}),_0x573675=Date['now']()-_0x3aa235;console[_0xf075cd(0x164)](_0xf075cd(0x16c)),console[_0xf075cd(0x164)](_0xf075cd(0x197),_0x10a65b[_0xf075cd(0x185)]),console['log'](_0xf075cd(0x18f),_0x573675+'ms');if(!_0x10a65b['ok']){const _0x438250=await _0x10a65b[_0xf075cd(0x183)]();console[_0xf075cd(0x162)](_0xf075cd(0x173),_0x10a65b[_0xf075cd(0x185)]),console[_0xf075cd(0x162)](_0xf075cd(0x12c),_0x438250),loggerService_1[_0xf075cd(0x165)][_0xf075cd(0x115)](_0xf075cd(0x125),'/status',_0x10a65b['status'],_0x438250,_0x573675),loggerService_1['loggerService'][_0xf075cd(0x169)](_0xf075cd(0x125),_0xf075cd(0x168),_0xf075cd(0x190)+_0x10a65b[_0xf075cd(0x185)]+':\x20'+_0x438250);throw new Error(_0xf075cd(0x17a)+_0x10a65b[_0xf075cd(0x185)]);}const _0x5e8f77=await _0x10a65b['text']();console[_0xf075cd(0x164)](_0xf075cd(0x186),_0x5e8f77);let _0x48fb7f;try{_0x48fb7f=JSON[_0xf075cd(0x18d)](_0x5e8f77);}catch(_0x3ce8dc){console[_0xf075cd(0x162)](_0xf075cd(0x124),_0x3ce8dc),loggerService_1[_0xf075cd(0x165)]['logWhiteDomainError']('cointopay','/status',_0xf075cd(0x131)+_0x3ce8dc);throw new Error(_0xf075cd(0x163)+_0x5e8f77);}loggerService_1[_0xf075cd(0x165)][_0xf075cd(0x115)](_0xf075cd(0x125),'/status',_0x10a65b[_0xf075cd(0x185)],_0x48fb7f,_0x573675),console[_0xf075cd(0x164)](_0xf075cd(0x13f)),console[_0xf075cd(0x164)](_0xf075cd(0x139),_0x48fb7f[_0xf075cd(0x114)]),console['log'](_0xf075cd(0x16a),_0x48fb7f[_0xf075cd(0x181)]),console[_0xf075cd(0x164)](_0xf075cd(0x16d),_0x48fb7f[_0xf075cd(0x13c)]?.[_0xf075cd(0x142)]),console['log'](_0xf075cd(0x151),_0x48fb7f[_0xf075cd(0x13c)]?.[_0xf075cd(0x17b)]),console[_0xf075cd(0x164)](_0xf075cd(0x15c),_0x48fb7f[_0xf075cd(0x13c)]?.['inputCurrency']);if(_0x48fb7f['result']!=='success'||_0x48fb7f['status_code']!==0xc8){const _0x1c6288=_0x48fb7f[_0xf075cd(0x193)]||_0xf075cd(0x156);console[_0xf075cd(0x162)](_0xf075cd(0x199)),console[_0xf075cd(0x162)](_0xf075cd(0x120),_0x1c6288),loggerService_1[_0xf075cd(0x165)][_0xf075cd(0x169)](_0xf075cd(0x125),_0xf075cd(0x168),_0xf075cd(0x13a)+_0x1c6288);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x1c6288);}if(!_0x48fb7f[_0xf075cd(0x13c)]){console[_0xf075cd(0x162)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xf075cd(0x162)](_0xf075cd(0x172)),loggerService_1[_0xf075cd(0x165)][_0xf075cd(0x169)](_0xf075cd(0x125),_0xf075cd(0x168),_0xf075cd(0x153));throw new Error(_0xf075cd(0x129));}let _0x396003=_0xf075cd(0x116);switch(_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x142)]?.[_0xf075cd(0x147)]()){case _0xf075cd(0x154):_0x396003='PAID';break;case'cancelled':case _0xf075cd(0x14f):case _0xf075cd(0x162):_0x396003='FAILED';break;case'expired':case _0xf075cd(0x132):_0x396003=_0xf075cd(0x110);break;case _0xf075cd(0x12a):case _0xf075cd(0x192):case _0xf075cd(0x140):case _0xf075cd(0x134):default:_0x396003=_0xf075cd(0x116);break;}let _0x26bc16,_0x2976bf;if(_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x196)]){const _0x5ad107=_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x196)];console[_0xf075cd(0x164)](_0xf075cd(0x191),_0x5ad107);const _0x22801a=_0x5ad107[_0xf075cd(0x195)](/IBAN\s+([A-Z0-9]+)/i);_0x22801a&&(_0x26bc16=_0x22801a[0x1],console[_0xf075cd(0x164)](_0xf075cd(0x184),_0x26bc16)),_0x2976bf=_0x5ad107;}const _0x4fa54f={'iban':_0x26bc16,'bankDetails':_0x2976bf,'transactionId':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x17d)],'coinAddress':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x150)],'qrCodeUrl':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x155)],'expiryTime':_0x48fb7f['data'][_0xf075cd(0x122)],'createdOn':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x171)],'confirmedOn':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x148)]};console[_0xf075cd(0x164)](_0xf075cd(0x112)),console[_0xf075cd(0x164)](_0xf075cd(0x197),_0x48fb7f[_0xf075cd(0x13c)]['Status'],'->',_0x396003),console[_0xf075cd(0x164)](_0xf075cd(0x151),_0x48fb7f['data'][_0xf075cd(0x17b)],_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x145)]),console['log'](_0xf075cd(0x16e),_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x17d)]),console[_0xf075cd(0x164)](_0xf075cd(0x18a),_0x26bc16||'not\x20found'),console[_0xf075cd(0x164)](_0xf075cd(0x123),_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x171)]),console['log'](_0xf075cd(0x17f),_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x148)]||'not\x20confirmed');if(_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x142)]?.[_0xf075cd(0x147)]()===_0xf075cd(0x192))console[_0xf075cd(0x164)](_0xf075cd(0x160));else _0x48fb7f['data'][_0xf075cd(0x142)]?.[_0xf075cd(0x147)]()===_0xf075cd(0x154)&&console[_0xf075cd(0x164)](_0xf075cd(0x12e));return{'status':_0x396003,'amount':parseFloat(_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x17b)])||undefined,'currency':_0x48fb7f[_0xf075cd(0x13c)][_0xf075cd(0x145)]||_0xf075cd(0x170),'paymentDetails':_0x4fa54f};}catch(_0x5400e4){console[_0xf075cd(0x162)](_0xf075cd(0x17e),_0x5400e4),loggerService_1[_0xf075cd(0x165)][_0xf075cd(0x169)](_0xf075cd(0x125),_0xf075cd(0x168),_0x5400e4);throw new Error(_0xf075cd(0x126)+(_0x5400e4 instanceof Error?_0x5400e4[_0xf075cd(0x193)]:_0xf075cd(0x149)));}}async[a43_0x37f428(0x13d)](_0x367cf7){const _0x523317=a43_0x37f428,_0x36a1d0=await this[_0x523317(0x176)](_0x367cf7);return{'status':_0x36a1d0['status'],'amount':_0x36a1d0[_0x523317(0x14d)],'currency':_0x36a1d0[_0x523317(0x113)]};}async[a43_0x37f428(0x143)](_0x12ac2d){const _0x1027d1=a43_0x37f428;console[_0x1027d1(0x164)](_0x1027d1(0x127),_0x12ac2d);let _0x35e3d7=_0x1027d1(0x116);switch(_0x12ac2d[_0x1027d1(0x185)]?.['toLowerCase']()){case'paid':_0x35e3d7='PAID';break;case _0x1027d1(0x137):case'failed':case _0x1027d1(0x162):_0x35e3d7=_0x1027d1(0x188);break;case _0x1027d1(0x146):case'timeout':_0x35e3d7=_0x1027d1(0x110);break;case _0x1027d1(0x140):case _0x1027d1(0x12a):case _0x1027d1(0x192):case _0x1027d1(0x134):default:_0x35e3d7='PENDING';break;}return{'paymentId':_0x12ac2d[_0x1027d1(0x14b)]||_0x12ac2d[_0x1027d1(0x15f)]||'','status':_0x35e3d7,'amount':_0x12ac2d['amount'],'currency':_0x12ac2d['currency']||'EUR'};}}function a43_0x3f87(_0x228f00,_0x1a9413){const _0x2a9cc1=a43_0x2a9c();return a43_0x3f87=function(_0x3f8744,_0x23d27c){_0x3f8744=_0x3f8744-0x10f;let _0x2afc43=_0x2a9cc1[_0x3f8744];return _0x2afc43;},a43_0x3f87(_0x228f00,_0x1a9413);}exports[a43_0x37f428(0x11a)]=CoinToPayService;