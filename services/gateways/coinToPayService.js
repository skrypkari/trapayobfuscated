'use strict';const a43_0x13cd11=a43_0x3877;(function(_0x7fe016,_0x3139ae){const _0x5f5cd8=a43_0x3877,_0x3c41a7=_0x7fe016();while(!![]){try{const _0x5dd59b=parseInt(_0x5f5cd8(0x200))/0x1*(parseInt(_0x5f5cd8(0x1a1))/0x2)+parseInt(_0x5f5cd8(0x1d3))/0x3+-parseInt(_0x5f5cd8(0x1a7))/0x4+parseInt(_0x5f5cd8(0x1c2))/0x5*(parseInt(_0x5f5cd8(0x1b0))/0x6)+parseInt(_0x5f5cd8(0x196))/0x7*(-parseInt(_0x5f5cd8(0x1e1))/0x8)+-parseInt(_0x5f5cd8(0x1f7))/0x9*(-parseInt(_0x5f5cd8(0x20a))/0xa)+-parseInt(_0x5f5cd8(0x1ac))/0xb;if(_0x5dd59b===_0x3139ae)break;else _0x3c41a7['push'](_0x3c41a7['shift']());}catch(_0x1bc982){_0x3c41a7['push'](_0x3c41a7['shift']());}}}(a43_0x5a79,0xd50a6));Object[a43_0x13cd11(0x207)](exports,'__esModule',{'value':!![]}),exports[a43_0x13cd11(0x1ef)]=void 0x0;function a43_0x5a79(){const _0x4da1b5=['log','https://tesoft.uk/gateway/cointopay/','Status\x20Code:','logWhiteDomainError','Status\x20Text:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','awaiting\x20fiat','üè¶\x20Extracted\x20IBAN:','verifyPayment','TransactionID','CoinToPayService','logWhiteDomainRequest','timeout','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','fromEntries','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','544059xnMDDp','PAID','/status','Error\x20message:','data','coinAddress','headers','logWhiteDomainResponse','stack','9664uJQGXa','entries','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','now','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','PaymentDetail','defineProperty','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','HTTP\x20error!\x20status:\x20','240Fxoepu','statusUrl','merchant_reference_id','Status\x20API\x20Error:\x20','Currency:','inputCurrency','üìä\x20Status\x20check\x20URL:','Unknown\x20error','Error\x20stack:','Response\x20data:','message','POST','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Amount:','Created\x20On:','Amount','877618KOsKOw','../loggerService','not\x20confirmed','Response\x20Time:','processWebhook','Raw\x20Response\x20Body:','checkPaymentStatus','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','Business\x20Error:\x20','TesSoft\x20Payment\x20System/1.0','158xMheQL','stringify','Gateway\x20Payment\x20ID:','/create','ExpiryTime','status','3534972ObdHmD','\x20EUR','order_id','cointopay','Incomplete\x20response:\x20missing\x20data','6968841XyKIhc','paid','Headers:','error','6njHdsf','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','QRCodeURL','Unknown\x20error\x20from\x20CoinToPay\x20API','application/json','amount','failed','result','Transaction\x20ID:','currency','apiUrl','Request\x20Body:','success','Error\x20details:','status_code','FAILED','===\x20COINTOPAY\x20SUCCESS\x20===','796105kRZjHb','pending','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','gateway_payment_id','payment_url','statusText','Missing\x20data\x20in\x20response','Status','Error\x20Message:','JSON\x20Parse\x20Error:\x20','https://tesoft.uk/gateway/cointopay/status.php','toLowerCase','cancelled','425283FftswU','created','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','createPaymentLink','EUR','PENDING','CreatedOn','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','parse','waiting','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Status:','8kCyXVE','loggerService','CoinToPay\x20status\x20API\x20error:\x20','text'];a43_0x5a79=function(){return _0x4da1b5;};return a43_0x5a79();}function a43_0x3877(_0x38269d,_0x4741c6){const _0x5a7983=a43_0x5a79();return a43_0x3877=function(_0x387778,_0x5b4a25){_0x387778=_0x387778-0x18c;let _0x40077b=_0x5a7983[_0x387778];return _0x40077b;},a43_0x3877(_0x38269d,_0x4741c6);}const loggerService_1=require(a43_0x13cd11(0x197));class CoinToPayService{constructor(){const _0x375690=a43_0x13cd11;this[_0x375690(0x1bb)]=_0x375690(0x1e6),this[_0x375690(0x20b)]=_0x375690(0x1d0),console[_0x375690(0x1e5)](_0x375690(0x1f2)),console['log'](_0x375690(0x18c),this['statusUrl']);}async[a43_0x13cd11(0x1d6)](_0x5af5b9){const _0x2b337e=a43_0x13cd11,{orderId:_0x3f4377,amount:_0x3e2600}=_0x5af5b9;console[_0x2b337e(0x1e5)](_0x2b337e(0x208)+_0x3e2600+_0x2b337e(0x1a8));const _0x46f71a={'amount':_0x3e2600},_0x50ca05=Date['now']();try{console[_0x2b337e(0x1e5)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x2b337e(0x1e5)]('URL:',this[_0x2b337e(0x1bb)]),console[_0x2b337e(0x1e5)](_0x2b337e(0x1bc),JSON[_0x2b337e(0x1a2)](_0x46f71a,null,0x2)),console[_0x2b337e(0x1e5)](_0x2b337e(0x193),_0x3e2600,_0x2b337e(0x1da)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2b337e(0x1aa),_0x2b337e(0x1a4),_0x2b337e(0x191),_0x46f71a);const _0xd7ac9c=await fetch(this['apiUrl'],{'method':_0x2b337e(0x191),'headers':{'Content-Type':_0x2b337e(0x1b5),'Accept':_0x2b337e(0x1b5),'User-Agent':_0x2b337e(0x1a0)},'body':JSON[_0x2b337e(0x1a2)](_0x46f71a)}),_0x4b3a27=Date[_0x2b337e(0x203)]()-_0x50ca05;console[_0x2b337e(0x1e5)](_0x2b337e(0x1c5)),console[_0x2b337e(0x1e5)](_0x2b337e(0x1e0),_0xd7ac9c[_0x2b337e(0x1a6)]),console[_0x2b337e(0x1e5)](_0x2b337e(0x1e9),_0xd7ac9c[_0x2b337e(0x1cb)]),console[_0x2b337e(0x1e5)](_0x2b337e(0x1ae),Object[_0x2b337e(0x1f4)](_0xd7ac9c[_0x2b337e(0x1fd)][_0x2b337e(0x201)]())),console[_0x2b337e(0x1e5)](_0x2b337e(0x199),_0x4b3a27+'ms');const _0x3560c7=await _0xd7ac9c[_0x2b337e(0x1e4)]();console[_0x2b337e(0x1e5)](_0x2b337e(0x19b),_0x3560c7);if(!_0xd7ac9c['ok']){console[_0x2b337e(0x1af)](_0x2b337e(0x1f6)),console[_0x2b337e(0x1af)](_0x2b337e(0x1c6),_0xd7ac9c[_0x2b337e(0x1a6)]),console[_0x2b337e(0x1af)]('Response\x20Body:',_0x3560c7),loggerService_1[_0x2b337e(0x1e2)][_0x2b337e(0x1fe)](_0x2b337e(0x1aa),_0x2b337e(0x1a4),_0xd7ac9c[_0x2b337e(0x1a6)],_0x3560c7,_0x4b3a27),loggerService_1[_0x2b337e(0x1e2)][_0x2b337e(0x1e8)](_0x2b337e(0x1aa),'/create',_0x2b337e(0x1de)+_0xd7ac9c[_0x2b337e(0x1a6)]+':\x20'+_0x3560c7);throw new Error('HTTP\x20error!\x20status:\x20'+_0xd7ac9c[_0x2b337e(0x1a6)]+',\x20body:\x20'+_0x3560c7);}let _0x167b8b;try{_0x167b8b=JSON[_0x2b337e(0x1dc)](_0x3560c7);}catch(_0x3b1f45){console['error'](_0x2b337e(0x19e),_0x3b1f45),loggerService_1[_0x2b337e(0x1e2)][_0x2b337e(0x1e8)](_0x2b337e(0x1aa),_0x2b337e(0x1a4),_0x2b337e(0x1cf)+_0x3b1f45);throw new Error(_0x2b337e(0x1c7)+_0x3560c7);}console['log'](_0x2b337e(0x1c4)),console[_0x2b337e(0x1e5)]('Parsed\x20Result:',JSON[_0x2b337e(0x1a2)](_0x167b8b,null,0x2)),loggerService_1[_0x2b337e(0x1e2)]['logWhiteDomainResponse'](_0x2b337e(0x1aa),'/create',_0xd7ac9c[_0x2b337e(0x1a6)],_0x167b8b,_0x4b3a27);if(_0x167b8b[_0x2b337e(0x1af)]){const _0x1b76d6=_0x167b8b[_0x2b337e(0x190)]||_0x167b8b[_0x2b337e(0x1af)]||_0x2b337e(0x1b4);console[_0x2b337e(0x1af)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x2b337e(0x1af)](_0x2b337e(0x1ce),_0x1b76d6),loggerService_1['loggerService'][_0x2b337e(0x1e8)]('cointopay',_0x2b337e(0x1a4),_0x2b337e(0x19f)+_0x1b76d6);throw new Error(_0x2b337e(0x1b1)+_0x1b76d6);}if(!_0x167b8b['payment_url']||!_0x167b8b[_0x2b337e(0x1c9)]){console[_0x2b337e(0x1af)](_0x2b337e(0x1b2)),console['error'](_0x2b337e(0x1ea)),console[_0x2b337e(0x1af)](_0x2b337e(0x18f),_0x167b8b),loggerService_1['loggerService'][_0x2b337e(0x1e8)]('cointopay',_0x2b337e(0x1a4),_0x2b337e(0x204));throw new Error(_0x2b337e(0x1f3));}return console[_0x2b337e(0x1e5)](_0x2b337e(0x1c1)),console['log'](_0x2b337e(0x1a3),_0x167b8b[_0x2b337e(0x1c9)]),console[_0x2b337e(0x1e5)]('Payment\x20URL:',_0x167b8b[_0x2b337e(0x1ca)]),console[_0x2b337e(0x1e5)](_0x2b337e(0x193),_0x3e2600,_0x2b337e(0x1d7)),{'gateway_payment_id':_0x167b8b[_0x2b337e(0x1c9)],'payment_url':_0x167b8b[_0x2b337e(0x1ca)]};}catch(_0xfe0b4e){console[_0x2b337e(0x1af)](_0x2b337e(0x1db)),console[_0x2b337e(0x1af)](_0x2b337e(0x1be),_0xfe0b4e),loggerService_1[_0x2b337e(0x1e2)]['logWhiteDomainError']('cointopay',_0x2b337e(0x1a4),_0xfe0b4e);if(_0xfe0b4e instanceof Error){console[_0x2b337e(0x1af)](_0x2b337e(0x1fa),_0xfe0b4e['message']),console['error'](_0x2b337e(0x18e),_0xfe0b4e[_0x2b337e(0x1ff)]);throw new Error(_0x2b337e(0x192)+_0xfe0b4e[_0x2b337e(0x190)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x13cd11(0x19c)](_0x3dc08b){const _0x3750e1=a43_0x13cd11,_0x5ab57e=Date[_0x3750e1(0x203)]();try{console['log'](_0x3750e1(0x1f5)+_0x3dc08b);const _0x1b5a7b={'gatewayPaymentId':_0x3dc08b};loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1f0)](_0x3750e1(0x1aa),'/status',_0x3750e1(0x191),_0x1b5a7b);const _0x56cf1d=await fetch(this[_0x3750e1(0x20b)],{'method':_0x3750e1(0x191),'headers':{'Content-Type':_0x3750e1(0x1b5),'Accept':_0x3750e1(0x1b5),'User-Agent':_0x3750e1(0x1a0)},'body':JSON[_0x3750e1(0x1a2)](_0x1b5a7b)}),_0x31afd4=Date[_0x3750e1(0x203)]()-_0x5ab57e;console[_0x3750e1(0x1e5)](_0x3750e1(0x1df)),console['log'](_0x3750e1(0x1e0),_0x56cf1d['status']),console['log'](_0x3750e1(0x199),_0x31afd4+'ms');if(!_0x56cf1d['ok']){const _0x447f0f=await _0x56cf1d[_0x3750e1(0x1e4)]();console[_0x3750e1(0x1af)]('HTTP\x20Status:',_0x56cf1d[_0x3750e1(0x1a6)]),console[_0x3750e1(0x1af)]('Response\x20Body:',_0x447f0f),loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1fe)](_0x3750e1(0x1aa),_0x3750e1(0x1f9),_0x56cf1d['status'],_0x447f0f,_0x31afd4),loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1e8)]('cointopay',_0x3750e1(0x1f9),'HTTP\x20'+_0x56cf1d[_0x3750e1(0x1a6)]+':\x20'+_0x447f0f);throw new Error(_0x3750e1(0x209)+_0x56cf1d[_0x3750e1(0x1a6)]);}const _0x294bfa=await _0x56cf1d['text']();console['log'](_0x3750e1(0x19b),_0x294bfa);let _0x31bc8e;try{_0x31bc8e=JSON['parse'](_0x294bfa);}catch(_0x2c020a){console['error'](_0x3750e1(0x19e),_0x2c020a),loggerService_1['loggerService'][_0x3750e1(0x1e8)]('cointopay',_0x3750e1(0x1f9),_0x3750e1(0x1cf)+_0x2c020a);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x294bfa);}loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1fe)]('cointopay',_0x3750e1(0x1f9),_0x56cf1d[_0x3750e1(0x1a6)],_0x31bc8e,_0x31afd4),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x3750e1(0x1e5)]('Result:',_0x31bc8e['result']),console[_0x3750e1(0x1e5)](_0x3750e1(0x1e7),_0x31bc8e['status_code']),console[_0x3750e1(0x1e5)]('Payment\x20Status:',_0x31bc8e[_0x3750e1(0x1fb)]?.[_0x3750e1(0x1cd)]),console['log'](_0x3750e1(0x193),_0x31bc8e['data']?.[_0x3750e1(0x195)]),console[_0x3750e1(0x1e5)](_0x3750e1(0x20e),_0x31bc8e[_0x3750e1(0x1fb)]?.[_0x3750e1(0x20f)]);if(_0x31bc8e[_0x3750e1(0x1b8)]!==_0x3750e1(0x1bd)||_0x31bc8e[_0x3750e1(0x1bf)]!==0xc8){const _0x16584c=_0x31bc8e[_0x3750e1(0x190)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console['error'](_0x3750e1(0x1d5)),console[_0x3750e1(0x1af)]('Error\x20Message:',_0x16584c),loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1e8)](_0x3750e1(0x1aa),'/status',_0x3750e1(0x20d)+_0x16584c);throw new Error(_0x3750e1(0x1e3)+_0x16584c);}if(!_0x31bc8e[_0x3750e1(0x1fb)]){console[_0x3750e1(0x1af)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x3750e1(0x1cc)),loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1e8)](_0x3750e1(0x1aa),_0x3750e1(0x1f9),_0x3750e1(0x1ab));throw new Error(_0x3750e1(0x1c8));}let _0x7fda4e='PENDING';switch(_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1cd)]?.[_0x3750e1(0x1d1)]()){case'paid':_0x7fda4e=_0x3750e1(0x1f8);break;case _0x3750e1(0x1d2):case'failed':case _0x3750e1(0x1af):_0x7fda4e=_0x3750e1(0x1c0);break;case'expired':case _0x3750e1(0x1f1):_0x7fda4e=_0x3750e1(0x19d);break;case'waiting':case _0x3750e1(0x1eb):case _0x3750e1(0x1c3):case _0x3750e1(0x1d4):default:_0x7fda4e='PENDING';break;}let _0x4f6b90,_0x16766d;if(_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x206)]){const _0x27e639=_0x31bc8e[_0x3750e1(0x1fb)]['PaymentDetail'];console['log']('üè¶\x20Payment\x20Detail:',_0x27e639);const _0x540a48=_0x27e639['match'](/IBAN\s+([A-Z0-9]+)/i);_0x540a48&&(_0x4f6b90=_0x540a48[0x1],console[_0x3750e1(0x1e5)](_0x3750e1(0x1ec),_0x4f6b90)),_0x16766d=_0x27e639;}const _0x14c826={'iban':_0x4f6b90,'bankDetails':_0x16766d,'transactionId':_0x31bc8e['data'][_0x3750e1(0x1ee)],'coinAddress':_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1fc)],'qrCodeUrl':_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1b3)],'expiryTime':_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1a5)],'createdOn':_0x31bc8e[_0x3750e1(0x1fb)]['CreatedOn'],'confirmedOn':_0x31bc8e[_0x3750e1(0x1fb)]['TransactionConfirmedOn']};console[_0x3750e1(0x1e5)](_0x3750e1(0x202)),console[_0x3750e1(0x1e5)]('Status:',_0x31bc8e['data']['Status'],'->',_0x7fda4e),console[_0x3750e1(0x1e5)](_0x3750e1(0x193),_0x31bc8e[_0x3750e1(0x1fb)]['Amount'],_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x20f)]),console['log'](_0x3750e1(0x1b9),_0x31bc8e['data'][_0x3750e1(0x1ee)]),console['log']('IBAN:',_0x4f6b90||'not\x20found'),console[_0x3750e1(0x1e5)](_0x3750e1(0x194),_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1d9)]),console['log']('Confirmed\x20On:',_0x31bc8e[_0x3750e1(0x1fb)]['TransactionConfirmedOn']||_0x3750e1(0x198));if(_0x31bc8e['data'][_0x3750e1(0x1cd)]?.[_0x3750e1(0x1d1)]()===_0x3750e1(0x1eb))console['log'](_0x3750e1(0x205));else _0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x1cd)]?.[_0x3750e1(0x1d1)]()===_0x3750e1(0x1ad)&&console[_0x3750e1(0x1e5)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x7fda4e,'amount':parseFloat(_0x31bc8e['data'][_0x3750e1(0x195)])||undefined,'currency':_0x31bc8e[_0x3750e1(0x1fb)][_0x3750e1(0x20f)]||_0x3750e1(0x1d7),'paymentDetails':_0x14c826};}catch(_0x391777){console[_0x3750e1(0x1af)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x391777),loggerService_1[_0x3750e1(0x1e2)][_0x3750e1(0x1e8)](_0x3750e1(0x1aa),_0x3750e1(0x1f9),_0x391777);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x391777 instanceof Error?_0x391777['message']:_0x3750e1(0x18d)));}}async[a43_0x13cd11(0x1ed)](_0x3729d4){const _0x1c451b=a43_0x13cd11,_0xc35ebf=await this[_0x1c451b(0x19c)](_0x3729d4);return{'status':_0xc35ebf[_0x1c451b(0x1a6)],'amount':_0xc35ebf[_0x1c451b(0x1b6)],'currency':_0xc35ebf['currency']};}async[a43_0x13cd11(0x19a)](_0x2d0c04){const _0x55e8fa=a43_0x13cd11;console[_0x55e8fa(0x1e5)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x2d0c04);let _0x1b846b=_0x55e8fa(0x1d8);switch(_0x2d0c04[_0x55e8fa(0x1a6)]?.[_0x55e8fa(0x1d1)]()){case _0x55e8fa(0x1ad):_0x1b846b=_0x55e8fa(0x1f8);break;case _0x55e8fa(0x1d2):case _0x55e8fa(0x1b7):case _0x55e8fa(0x1af):_0x1b846b='FAILED';break;case'expired':case _0x55e8fa(0x1f1):_0x1b846b=_0x55e8fa(0x19d);break;case'pending':case _0x55e8fa(0x1dd):case _0x55e8fa(0x1eb):case _0x55e8fa(0x1d4):default:_0x1b846b=_0x55e8fa(0x1d8);break;}return{'paymentId':_0x2d0c04[_0x55e8fa(0x1a9)]||_0x2d0c04[_0x55e8fa(0x20c)]||'','status':_0x1b846b,'amount':_0x2d0c04[_0x55e8fa(0x1b6)],'currency':_0x2d0c04[_0x55e8fa(0x1ba)]||'EUR'};}}exports[a43_0x13cd11(0x1ef)]=CoinToPayService;