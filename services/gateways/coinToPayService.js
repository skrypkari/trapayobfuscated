'use strict';const a44_0x17c41f=a44_0x51bf;(function(_0x2d35c1,_0x17e533){const _0x274fd7=a44_0x51bf,_0x42d2b3=_0x2d35c1();while(!![]){try{const _0x4fb29a=parseInt(_0x274fd7(0x1af))/0x1*(parseInt(_0x274fd7(0x206))/0x2)+parseInt(_0x274fd7(0x1ba))/0x3*(-parseInt(_0x274fd7(0x21f))/0x4)+parseInt(_0x274fd7(0x1de))/0x5+-parseInt(_0x274fd7(0x1b0))/0x6+-parseInt(_0x274fd7(0x224))/0x7*(parseInt(_0x274fd7(0x1df))/0x8)+-parseInt(_0x274fd7(0x1c6))/0x9+parseInt(_0x274fd7(0x1c2))/0xa;if(_0x4fb29a===_0x17e533)break;else _0x42d2b3['push'](_0x42d2b3['shift']());}catch(_0x448e9d){_0x42d2b3['push'](_0x42d2b3['shift']());}}}(a44_0x500f,0x904ff));function a44_0x500f(){const _0x5488a3=['Request\x20Body:','waiting','Incomplete\x20response:\x20missing\x20data','pending','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','EXPIRED','Error\x20Message:','FAILED','text','logWhiteDomainResponse','https://tesoft.uk/gateway/cointopay/','error','Payment\x20Status:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Transaction\x20ID:','loggerService','Error\x20details:','cointopay','27276uPQYjd','message','Currency:','Missing\x20data\x20in\x20response','Response\x20data:','42cTqosq','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionID','PaymentDetail','data',',\x20body:\x20','QRCodeURL','HTTP\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','logWhiteDomainRequest','gateway_payment_id','Failed\x20to\x20parse\x20JSON\x20response:','POST','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','CoinToPayService','22238KrwEiL','2438664PaeYRr','Amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','EUR','apiUrl','not\x20confirmed','Raw\x20Response\x20Body:','PENDING','paid','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','81cuDlkk','status','===\x20COINTOPAY\x20SUCCESS\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Payment\x20URL:','statusText','currency','now','12874430tDPIIy','HTTP\x20error!\x20status:\x20','/create','Unknown\x20error\x20from\x20CoinToPay\x20API','175383vamAOr','/status','application/json','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','merchant_reference_id','status_code','JSON\x20Parse\x20Error:\x20','Error\x20stack:','logWhiteDomainError','timeout','match','log','stringify','Confirmed\x20On:','parse','entries','https://tesoft.uk/gateway/cointopay/status.php','failed','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','success','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','createPaymentLink','1888470zYBpia','648304WYzddn','created','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','order_id','Unknown\x20error','URL:','Parsed\x20Result:','result','Amount:','Gateway\x20Payment\x20ID:','HTTP\x20','headers','Result:','Response\x20Time:','Status\x20Code:','amount','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','CreatedOn','\x20EUR','toLowerCase','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','inputCurrency','Business\x20Error:\x20','üè¶\x20Extracted\x20IBAN:','defineProperty','PAID','Status\x20API\x20Error:\x20','expired','payment_url','cancelled','Status\x20Text:','Created\x20On:','not\x20found','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','IBAN:','coinAddress','Response\x20Body:','stack','Status','2DEexos','statusUrl','checkPaymentStatus','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','TransactionConfirmedOn'];a44_0x500f=function(){return _0x5488a3;};return a44_0x500f();}Object[a44_0x17c41f(0x1f7)](exports,'__esModule',{'value':!![]}),exports[a44_0x17c41f(0x1ae)]=void 0x0;function a44_0x51bf(_0x3f0898,_0xce6e2c){const _0x500f4e=a44_0x500f();return a44_0x51bf=function(_0x51bf40,_0x199249){_0x51bf40=_0x51bf40-0x1a9;let _0xad7638=_0x500f4e[_0x51bf40];return _0xad7638;},a44_0x51bf(_0x3f0898,_0xce6e2c);}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x57d45a=a44_0x17c41f;this[_0x57d45a(0x1b4)]=_0x57d45a(0x216),this[_0x57d45a(0x207)]=_0x57d45a(0x1d6),console['log']('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x57d45a(0x1d1)]('üìä\x20Status\x20check\x20URL:',this[_0x57d45a(0x207)]);}async[a44_0x17c41f(0x1dd)](_0x5c26fc){const _0x22bd3b=a44_0x17c41f,{orderId:_0x5ed459,amount:_0x2195b6}=_0x5c26fc;console[_0x22bd3b(0x1d1)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x2195b6+_0x22bd3b(0x1f1));const _0x5d628d={'amount':_0x2195b6},_0x37d1af=Date[_0x22bd3b(0x1c1)]();try{console['log'](_0x22bd3b(0x1b9)),console['log'](_0x22bd3b(0x1e4),this[_0x22bd3b(0x1b4)]),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x20b),JSON[_0x22bd3b(0x1d2)](_0x5d628d,null,0x2)),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1e7),_0x2195b6,_0x22bd3b(0x1ad)),loggerService_1[_0x22bd3b(0x21c)]['logWhiteDomainRequest']('cointopay',_0x22bd3b(0x1c4),_0x22bd3b(0x1ac),_0x5d628d);const _0x4b3e41=await fetch(this[_0x22bd3b(0x1b4)],{'method':_0x22bd3b(0x1ac),'headers':{'Content-Type':'application/json','Accept':_0x22bd3b(0x1c8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x5d628d)}),_0x15d333=Date['now']()-_0x37d1af;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x22bd3b(0x1d1)]('Status:',_0x4b3e41['status']),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1fd),_0x4b3e41[_0x22bd3b(0x1bf)]),console[_0x22bd3b(0x1d1)]('Headers:',Object['fromEntries'](_0x4b3e41[_0x22bd3b(0x1ea)][_0x22bd3b(0x1d5)]())),console[_0x22bd3b(0x1d1)]('Response\x20Time:',_0x15d333+'ms');const _0x356622=await _0x4b3e41['text']();console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1b6),_0x356622);if(!_0x4b3e41['ok']){console[_0x22bd3b(0x217)](_0x22bd3b(0x1b2)),console['error'](_0x22bd3b(0x22b),_0x4b3e41[_0x22bd3b(0x1bb)]),console[_0x22bd3b(0x217)]('Response\x20Body:',_0x356622),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x4b3e41[_0x22bd3b(0x1bb)],_0x356622,_0x15d333),loggerService_1[_0x22bd3b(0x21c)][_0x22bd3b(0x1ce)]('cointopay',_0x22bd3b(0x1c4),_0x22bd3b(0x1e9)+_0x4b3e41['status']+':\x20'+_0x356622);throw new Error(_0x22bd3b(0x1c3)+_0x4b3e41[_0x22bd3b(0x1bb)]+_0x22bd3b(0x229)+_0x356622);}let _0x5adcda;try{_0x5adcda=JSON[_0x22bd3b(0x1d4)](_0x356622);}catch(_0x1d9ab5){console[_0x22bd3b(0x217)](_0x22bd3b(0x1ab),_0x1d9ab5),loggerService_1['loggerService']['logWhiteDomainError'](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x22bd3b(0x1cc)+_0x1d9ab5);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x356622);}console['log'](_0x22bd3b(0x1e1)),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1e5),JSON[_0x22bd3b(0x1d2)](_0x5adcda,null,0x2)),loggerService_1['loggerService'][_0x22bd3b(0x215)](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x4b3e41['status'],_0x5adcda,_0x15d333);if(_0x5adcda[_0x22bd3b(0x217)]){const _0x1c9802=_0x5adcda['message']||_0x5adcda['error']||_0x22bd3b(0x1c5);console[_0x22bd3b(0x217)](_0x22bd3b(0x1ef)),console['error'](_0x22bd3b(0x212),_0x1c9802),loggerService_1[_0x22bd3b(0x21c)][_0x22bd3b(0x1ce)](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x22bd3b(0x1f5)+_0x1c9802);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x1c9802);}if(!_0x5adcda['payment_url']||!_0x5adcda[_0x22bd3b(0x1aa)]){console['error'](_0x22bd3b(0x20f)),console[_0x22bd3b(0x217)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console['error'](_0x22bd3b(0x223),_0x5adcda),loggerService_1[_0x22bd3b(0x21c)]['logWhiteDomainError'](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x22bd3b(0x219));throw new Error(_0x22bd3b(0x225));}return console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1bc)),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1e8),_0x5adcda[_0x22bd3b(0x1aa)]),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1be),_0x5adcda[_0x22bd3b(0x1fb)]),console[_0x22bd3b(0x1d1)](_0x22bd3b(0x1e7),_0x2195b6,_0x22bd3b(0x1b3)),{'gateway_payment_id':_0x5adcda[_0x22bd3b(0x1aa)],'payment_url':_0x5adcda[_0x22bd3b(0x1fb)]};}catch(_0x2f70ba){console[_0x22bd3b(0x217)](_0x22bd3b(0x1d8)),console[_0x22bd3b(0x217)](_0x22bd3b(0x21d),_0x2f70ba),loggerService_1[_0x22bd3b(0x21c)][_0x22bd3b(0x1ce)](_0x22bd3b(0x21e),_0x22bd3b(0x1c4),_0x2f70ba);if(_0x2f70ba instanceof Error){console['error']('Error\x20message:',_0x2f70ba['message']),console[_0x22bd3b(0x217)](_0x22bd3b(0x1cd),_0x2f70ba[_0x22bd3b(0x204)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2f70ba[_0x22bd3b(0x220)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a44_0x17c41f(0x208)](_0x2fca3f){const _0x20d020=a44_0x17c41f,_0x15802f=Date[_0x20d020(0x1c1)]();try{console[_0x20d020(0x1d1)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x2fca3f);const _0x50ebc9={'gatewayPaymentId':_0x2fca3f};loggerService_1['loggerService'][_0x20d020(0x1a9)](_0x20d020(0x21e),'/status',_0x20d020(0x1ac),_0x50ebc9);const _0x5930ac=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x20d020(0x1c8),'Accept':_0x20d020(0x1c8),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x20d020(0x1d2)](_0x50ebc9)}),_0x4d9112=Date['now']()-_0x15802f;console[_0x20d020(0x1d1)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x20d020(0x1d1)](_0x20d020(0x210),_0x5930ac['status']),console[_0x20d020(0x1d1)](_0x20d020(0x1ec),_0x4d9112+'ms');if(!_0x5930ac['ok']){const _0x42a94b=await _0x5930ac[_0x20d020(0x214)]();console['error'](_0x20d020(0x22b),_0x5930ac[_0x20d020(0x1bb)]),console[_0x20d020(0x217)](_0x20d020(0x203),_0x42a94b),loggerService_1[_0x20d020(0x21c)][_0x20d020(0x215)]('cointopay',_0x20d020(0x1c7),_0x5930ac[_0x20d020(0x1bb)],_0x42a94b,_0x4d9112),loggerService_1[_0x20d020(0x21c)][_0x20d020(0x1ce)](_0x20d020(0x21e),'/status','HTTP\x20'+_0x5930ac[_0x20d020(0x1bb)]+':\x20'+_0x42a94b);throw new Error(_0x20d020(0x1c3)+_0x5930ac[_0x20d020(0x1bb)]);}const _0x5b67f7=await _0x5930ac[_0x20d020(0x214)]();console[_0x20d020(0x1d1)](_0x20d020(0x1b6),_0x5b67f7);let _0x518e53;try{_0x518e53=JSON[_0x20d020(0x1d4)](_0x5b67f7);}catch(_0x4b7e58){console[_0x20d020(0x217)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x4b7e58),loggerService_1[_0x20d020(0x21c)][_0x20d020(0x1ce)](_0x20d020(0x21e),'/status',_0x20d020(0x1cc)+_0x4b7e58);throw new Error(_0x20d020(0x21a)+_0x5b67f7);}loggerService_1[_0x20d020(0x21c)]['logWhiteDomainResponse'](_0x20d020(0x21e),_0x20d020(0x1c7),_0x5930ac[_0x20d020(0x1bb)],_0x518e53,_0x4d9112),console['log'](_0x20d020(0x1c9)),console[_0x20d020(0x1d1)](_0x20d020(0x1eb),_0x518e53[_0x20d020(0x1e6)]),console[_0x20d020(0x1d1)](_0x20d020(0x1ed),_0x518e53[_0x20d020(0x1cb)]),console[_0x20d020(0x1d1)](_0x20d020(0x218),_0x518e53[_0x20d020(0x228)]?.[_0x20d020(0x205)]),console[_0x20d020(0x1d1)]('Amount:',_0x518e53[_0x20d020(0x228)]?.['Amount']),console[_0x20d020(0x1d1)](_0x20d020(0x221),_0x518e53[_0x20d020(0x228)]?.['inputCurrency']);if(_0x518e53[_0x20d020(0x1e6)]!==_0x20d020(0x1da)||_0x518e53[_0x20d020(0x1cb)]!==0xc8){const _0x4b016c=_0x518e53[_0x20d020(0x220)]||_0x20d020(0x209);console[_0x20d020(0x217)](_0x20d020(0x1f3)),console[_0x20d020(0x217)](_0x20d020(0x212),_0x4b016c),loggerService_1[_0x20d020(0x21c)][_0x20d020(0x1ce)](_0x20d020(0x21e),_0x20d020(0x1c7),_0x20d020(0x1f9)+_0x4b016c);throw new Error(_0x20d020(0x22c)+_0x4b016c);}if(!_0x518e53[_0x20d020(0x228)]){console[_0x20d020(0x217)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x20d020(0x217)](_0x20d020(0x222)),loggerService_1[_0x20d020(0x21c)]['logWhiteDomainError']('cointopay',_0x20d020(0x1c7),_0x20d020(0x20d));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x9a776a=_0x20d020(0x1b7);switch(_0x518e53['data'][_0x20d020(0x205)]?.[_0x20d020(0x1f2)]()){case _0x20d020(0x1b8):_0x9a776a=_0x20d020(0x1f8);break;case _0x20d020(0x1fc):case _0x20d020(0x1d7):case _0x20d020(0x217):_0x9a776a=_0x20d020(0x213);break;case _0x20d020(0x1fa):case _0x20d020(0x1cf):_0x9a776a=_0x20d020(0x211);break;case'waiting':case'awaiting\x20fiat':case'pending':case'created':default:_0x9a776a=_0x20d020(0x1b7);break;}let _0xb086,_0x36bc17;if(_0x518e53[_0x20d020(0x228)]['PaymentDetail']){const _0x20a61b=_0x518e53['data'][_0x20d020(0x227)];console['log']('üè¶\x20Payment\x20Detail:',_0x20a61b);const _0x8c870e=_0x20a61b[_0x20d020(0x1d0)](/IBAN\s+([A-Z0-9]+)/i);_0x8c870e&&(_0xb086=_0x8c870e[0x1],console[_0x20d020(0x1d1)](_0x20d020(0x1f6),_0xb086)),_0x36bc17=_0x20a61b;}const _0x522463={'iban':_0xb086,'bankDetails':_0x36bc17,'transactionId':_0x518e53[_0x20d020(0x228)]['TransactionID'],'coinAddress':_0x518e53[_0x20d020(0x228)][_0x20d020(0x202)],'qrCodeUrl':_0x518e53[_0x20d020(0x228)][_0x20d020(0x22a)],'expiryTime':_0x518e53[_0x20d020(0x228)]['ExpiryTime'],'createdOn':_0x518e53[_0x20d020(0x228)][_0x20d020(0x1f0)],'confirmedOn':_0x518e53[_0x20d020(0x228)][_0x20d020(0x20a)]};console[_0x20d020(0x1d1)](_0x20d020(0x200)),console[_0x20d020(0x1d1)]('Status:',_0x518e53['data'][_0x20d020(0x205)],'->',_0x9a776a),console[_0x20d020(0x1d1)](_0x20d020(0x1e7),_0x518e53['data']['Amount'],_0x518e53['data'][_0x20d020(0x1f4)]),console[_0x20d020(0x1d1)](_0x20d020(0x21b),_0x518e53['data'][_0x20d020(0x226)]),console[_0x20d020(0x1d1)](_0x20d020(0x201),_0xb086||_0x20d020(0x1ff)),console[_0x20d020(0x1d1)](_0x20d020(0x1fe),_0x518e53[_0x20d020(0x228)][_0x20d020(0x1f0)]),console[_0x20d020(0x1d1)](_0x20d020(0x1d3),_0x518e53[_0x20d020(0x228)][_0x20d020(0x20a)]||_0x20d020(0x1b5));if(_0x518e53[_0x20d020(0x228)][_0x20d020(0x205)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x20d020(0x1d1)](_0x20d020(0x1bd));else _0x518e53['data'][_0x20d020(0x205)]?.[_0x20d020(0x1f2)]()===_0x20d020(0x1b8)&&console['log'](_0x20d020(0x1d9));return{'status':_0x9a776a,'amount':parseFloat(_0x518e53[_0x20d020(0x228)][_0x20d020(0x1b1)])||undefined,'currency':_0x518e53[_0x20d020(0x228)]['inputCurrency']||_0x20d020(0x1b3),'paymentDetails':_0x522463};}catch(_0x1e5619){console[_0x20d020(0x217)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x1e5619),loggerService_1[_0x20d020(0x21c)][_0x20d020(0x1ce)](_0x20d020(0x21e),'/status',_0x1e5619);throw new Error(_0x20d020(0x1db)+(_0x1e5619 instanceof Error?_0x1e5619['message']:_0x20d020(0x1e3)));}}async['verifyPayment'](_0x31166e){const _0x5eda04=a44_0x17c41f,_0x7ecf3b=await this[_0x5eda04(0x208)](_0x31166e);return{'status':_0x7ecf3b[_0x5eda04(0x1bb)],'amount':_0x7ecf3b[_0x5eda04(0x1ee)],'currency':_0x7ecf3b[_0x5eda04(0x1c0)]};}async['processWebhook'](_0xf2ddb0){const _0x4743c1=a44_0x17c41f;console[_0x4743c1(0x1d1)](_0x4743c1(0x1dc),_0xf2ddb0);let _0x2b9a3d=_0x4743c1(0x1b7);switch(_0xf2ddb0[_0x4743c1(0x1bb)]?.['toLowerCase']()){case'paid':_0x2b9a3d=_0x4743c1(0x1f8);break;case _0x4743c1(0x1fc):case _0x4743c1(0x1d7):case _0x4743c1(0x217):_0x2b9a3d=_0x4743c1(0x213);break;case _0x4743c1(0x1fa):case _0x4743c1(0x1cf):_0x2b9a3d=_0x4743c1(0x211);break;case _0x4743c1(0x20e):case _0x4743c1(0x20c):case'awaiting\x20fiat':case _0x4743c1(0x1e0):default:_0x2b9a3d=_0x4743c1(0x1b7);break;}return{'paymentId':_0xf2ddb0[_0x4743c1(0x1e2)]||_0xf2ddb0[_0x4743c1(0x1ca)]||'','status':_0x2b9a3d,'amount':_0xf2ddb0[_0x4743c1(0x1ee)],'currency':_0xf2ddb0[_0x4743c1(0x1c0)]||_0x4743c1(0x1b3)};}}exports['CoinToPayService']=CoinToPayService;