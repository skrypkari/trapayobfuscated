'use strict';const a40_0x2c16c6=a40_0x5ac3;(function(_0x5d9536,_0xabb9cd){const _0x98f730=a40_0x5ac3,_0x2a37b2=_0x5d9536();while(!![]){try{const _0x37243b=-parseInt(_0x98f730(0x106))/0x1+-parseInt(_0x98f730(0x108))/0x2+parseInt(_0x98f730(0x130))/0x3+-parseInt(_0x98f730(0x179))/0x4+parseInt(_0x98f730(0x13e))/0x5*(-parseInt(_0x98f730(0x138))/0x6)+parseInt(_0x98f730(0x115))/0x7*(parseInt(_0x98f730(0x11a))/0x8)+parseInt(_0x98f730(0x132))/0x9*(parseInt(_0x98f730(0x174))/0xa);if(_0x37243b===_0xabb9cd)break;else _0x2a37b2['push'](_0x2a37b2['shift']());}catch(_0x279258){_0x2a37b2['push'](_0x2a37b2['shift']());}}}(a40_0x294c,0xde7e6));function a40_0x294c(){const _0x510672=['10xsAEpv','TransactionID','checkPaymentStatus','Status:','stack','not\x20found','Status','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','payment_url','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','data','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Request\x20Body:','Parsed\x20Result:','verifyPayment','CoinToPay\x20API\x20error:\x20','failed','Raw\x20Response\x20Body:','Gateway\x20Payment\x20ID:','Status\x20Text:','Amount','===\x20COINTOPAY\x20API\x20ERROR\x20===','Confirmed\x20On:','defineProperty','timeout','pending','HTTP\x20Status:','https://tesoft.uk/gateway/cointopay/status.php','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TesSoft\x20Payment\x20System/1.0','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','message','cointopay','Missing\x20data\x20in\x20response','Payment\x20Status:','coinAddress','EXPIRED','Headers:','Failed\x20to\x20parse\x20JSON\x20response:','Amount:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Incomplete\x20response:\x20missing\x20data','HTTP\x20','fromEntries','Status\x20Code:','application/json','üìä\x20Status\x20check\x20URL:','result','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','logWhiteDomainRequest','apiUrl','884460lKINzj','toLowerCase','/status','statusUrl','not\x20confirmed','241164rPTvAS','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CreatedOn','createPaymentLink','merchant_reference_id','status_code','text','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','parse','CoinToPayService','expired','PAID','TransactionConfirmedOn','\x20EUR','Error\x20message:','Response\x20Body:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','now','JSON\x20Parse\x20Error:\x20','/create','waiting','Unknown\x20error','===\x20COINTOPAY\x20SUCCESS\x20===','order_id','675403BFNGsG','__esModule','1133752ZfQRJA','awaiting\x20fiat','Error\x20Message:','log','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','loggerService','match','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','status','logWhiteDomainError','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','currency','703283hzWNWF','Status\x20API\x20Error:\x20','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','logWhiteDomainResponse','104TUafrl','Error\x20details:','PENDING','created','CoinToPay\x20payment\x20status\x20check\x20error:','CoinToPay\x20status\x20API\x20error:\x20','QRCodeURL','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','stringify','üè¶\x20Extracted\x20IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','cancelled','inputCurrency','error','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','FAILED','Currency:','amount','statusText','paid','2501205chySyM','success','99EmmQQk','Response\x20Time:','Error\x20stack:','IBAN:','gateway_payment_id','headers','2696502TZxjaL','URL:','Payment\x20URL:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','https://tesoft.uk/gateway/cointopay/'];a40_0x294c=function(){return _0x510672;};return a40_0x294c();}Object[a40_0x2c16c6(0x156)](exports,a40_0x2c16c6(0x107),{'value':!![]}),exports[a40_0x2c16c6(0x182)]=void 0x0;const loggerService_1=require('../loggerService');function a40_0x5ac3(_0x29d1f1,_0x54b28b){const _0x294c5c=a40_0x294c();return a40_0x5ac3=function(_0x5ac3e8,_0xdbbee6){_0x5ac3e8=_0x5ac3e8-0xff;let _0x57ee04=_0x294c5c[_0x5ac3e8];return _0x57ee04;},a40_0x5ac3(_0x29d1f1,_0x54b28b);}class CoinToPayService{constructor(){const _0x10a739=a40_0x2c16c6;this[_0x10a739(0x173)]=_0x10a739(0x13d),this[_0x10a739(0x177)]=_0x10a739(0x15a),console['log'](_0x10a739(0x121)),console[_0x10a739(0x10b)](_0x10a739(0x16e),this[_0x10a739(0x177)]);}async[a40_0x2c16c6(0x17c)](_0x3845cf){const _0xa58055=a40_0x2c16c6,{orderId:_0x3128e5,amount:_0xd89435}=_0x3845cf;console['log'](_0xa58055(0x180)+_0xd89435+_0xa58055(0x186));const _0x6f1a4e={'amount':_0xd89435},_0x2cf7e0=Date[_0xa58055(0xff)]();try{console['log'](_0xa58055(0x168)),console[_0xa58055(0x10b)](_0xa58055(0x139),this[_0xa58055(0x173)]),console[_0xa58055(0x10b)](_0xa58055(0x14b),JSON[_0xa58055(0x123)](_0x6f1a4e,null,0x2)),console[_0xa58055(0x10b)](_0xa58055(0x167),_0xd89435,_0xa58055(0x126)),loggerService_1['loggerService'][_0xa58055(0x172)]('cointopay',_0xa58055(0x101),'POST',_0x6f1a4e);const _0x5037f4=await fetch(this[_0xa58055(0x173)],{'method':'POST','headers':{'Content-Type':_0xa58055(0x16d),'Accept':'application/json','User-Agent':_0xa58055(0x15d)},'body':JSON[_0xa58055(0x123)](_0x6f1a4e)}),_0x2a05d2=Date[_0xa58055(0xff)]()-_0x2cf7e0;console[_0xa58055(0x10b)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xa58055(0x10b)](_0xa58055(0x141),_0x5037f4['status']),console['log'](_0xa58055(0x152),_0x5037f4[_0xa58055(0x12e)]),console[_0xa58055(0x10b)](_0xa58055(0x165),Object[_0xa58055(0x16b)](_0x5037f4[_0xa58055(0x137)]['entries']())),console[_0xa58055(0x10b)](_0xa58055(0x133),_0x2a05d2+'ms');const _0x27de08=await _0x5037f4[_0xa58055(0x17f)]();console['log'](_0xa58055(0x150),_0x27de08);if(!_0x5037f4['ok']){console['error'](_0xa58055(0x154)),console[_0xa58055(0x129)]('HTTP\x20Status:',_0x5037f4[_0xa58055(0x110)]),console[_0xa58055(0x129)]('Response\x20Body:',_0x27de08),loggerService_1[_0xa58055(0x10d)][_0xa58055(0x119)]('cointopay',_0xa58055(0x101),_0x5037f4[_0xa58055(0x110)],_0x27de08,_0x2a05d2),loggerService_1['loggerService'][_0xa58055(0x111)](_0xa58055(0x160),'/create',_0xa58055(0x16a)+_0x5037f4['status']+':\x20'+_0x27de08);throw new Error(_0xa58055(0x117)+_0x5037f4[_0xa58055(0x110)]+',\x20body:\x20'+_0x27de08);}let _0xfad386;try{_0xfad386=JSON[_0xa58055(0x181)](_0x27de08);}catch(_0x2625b0){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x2625b0),loggerService_1[_0xa58055(0x10d)][_0xa58055(0x111)](_0xa58055(0x160),_0xa58055(0x101),_0xa58055(0x100)+_0x2625b0);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x27de08);}console[_0xa58055(0x10b)](_0xa58055(0x14a)),console[_0xa58055(0x10b)](_0xa58055(0x14c),JSON[_0xa58055(0x123)](_0xfad386,null,0x2)),loggerService_1[_0xa58055(0x10d)]['logWhiteDomainResponse'](_0xa58055(0x160),_0xa58055(0x101),_0x5037f4['status'],_0xfad386,_0x2a05d2);if(_0xfad386[_0xa58055(0x129)]){const _0x530adf=_0xfad386['message']||_0xfad386['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0xa58055(0x12a)),console[_0xa58055(0x129)](_0xa58055(0x10a),_0x530adf),loggerService_1['loggerService'][_0xa58055(0x111)](_0xa58055(0x160),_0xa58055(0x101),'Business\x20Error:\x20'+_0x530adf);throw new Error(_0xa58055(0x14e)+_0x530adf);}if(!_0xfad386['payment_url']||!_0xfad386['gateway_payment_id']){console[_0xa58055(0x129)](_0xa58055(0x15c)),console['error'](_0xa58055(0x15e)),console[_0xa58055(0x129)]('Response\x20data:',_0xfad386),loggerService_1['loggerService'][_0xa58055(0x111)](_0xa58055(0x160),_0xa58055(0x101),_0xa58055(0x118));throw new Error(_0xa58055(0x170));}return console['log'](_0xa58055(0x104)),console['log'](_0xa58055(0x151),_0xfad386['gateway_payment_id']),console[_0xa58055(0x10b)](_0xa58055(0x13a),_0xfad386['payment_url']),console[_0xa58055(0x10b)]('Amount:',_0xd89435,'EUR'),{'gateway_payment_id':_0xfad386[_0xa58055(0x136)],'payment_url':_0xfad386[_0xa58055(0x146)]};}catch(_0x4f41ad){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0xa58055(0x11b),_0x4f41ad),loggerService_1[_0xa58055(0x10d)][_0xa58055(0x111)](_0xa58055(0x160),'/create',_0x4f41ad);if(_0x4f41ad instanceof Error){console[_0xa58055(0x129)](_0xa58055(0x187),_0x4f41ad['message']),console[_0xa58055(0x129)](_0xa58055(0x134),_0x4f41ad[_0xa58055(0x142)]);throw new Error(_0xa58055(0x13c)+_0x4f41ad[_0xa58055(0x15f)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x2c16c6(0x140)](_0x33fd0e){const _0x5b731a=a40_0x2c16c6,_0x37b88c=Date[_0x5b731a(0xff)]();try{console[_0x5b731a(0x10b)](_0x5b731a(0x147)+_0x33fd0e);const _0x1522cb={'gatewayPaymentId':_0x33fd0e};loggerService_1[_0x5b731a(0x10d)][_0x5b731a(0x172)]('cointopay',_0x5b731a(0x176),_0x5b731a(0x171),_0x1522cb);const _0x8ad7ad=await fetch(this[_0x5b731a(0x177)],{'method':_0x5b731a(0x171),'headers':{'Content-Type':_0x5b731a(0x16d),'Accept':_0x5b731a(0x16d),'User-Agent':_0x5b731a(0x15d)},'body':JSON['stringify'](_0x1522cb)}),_0x4c0910=Date[_0x5b731a(0xff)]()-_0x37b88c;console['log'](_0x5b731a(0x113)),console['log']('Status:',_0x8ad7ad[_0x5b731a(0x110)]),console[_0x5b731a(0x10b)](_0x5b731a(0x133),_0x4c0910+'ms');if(!_0x8ad7ad['ok']){const _0x50b961=await _0x8ad7ad[_0x5b731a(0x17f)]();console['error'](_0x5b731a(0x159),_0x8ad7ad[_0x5b731a(0x110)]),console[_0x5b731a(0x129)](_0x5b731a(0x188),_0x50b961),loggerService_1['loggerService'][_0x5b731a(0x119)](_0x5b731a(0x160),'/status',_0x8ad7ad[_0x5b731a(0x110)],_0x50b961,_0x4c0910),loggerService_1['loggerService']['logWhiteDomainError'](_0x5b731a(0x160),_0x5b731a(0x176),_0x5b731a(0x16a)+_0x8ad7ad['status']+':\x20'+_0x50b961);throw new Error(_0x5b731a(0x117)+_0x8ad7ad[_0x5b731a(0x110)]);}const _0x5d0447=await _0x8ad7ad['text']();console[_0x5b731a(0x10b)]('Raw\x20Response\x20Body:',_0x5d0447);let _0xd70847;try{_0xd70847=JSON[_0x5b731a(0x181)](_0x5d0447);}catch(_0x1a0c09){console[_0x5b731a(0x129)](_0x5b731a(0x166),_0x1a0c09),loggerService_1[_0x5b731a(0x10d)][_0x5b731a(0x111)]('cointopay',_0x5b731a(0x176),_0x5b731a(0x100)+_0x1a0c09);throw new Error(_0x5b731a(0x10f)+_0x5d0447);}loggerService_1[_0x5b731a(0x10d)][_0x5b731a(0x119)](_0x5b731a(0x160),_0x5b731a(0x176),_0x8ad7ad[_0x5b731a(0x110)],_0xd70847,_0x4c0910),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x5b731a(0x10b)]('Result:',_0xd70847[_0x5b731a(0x16f)]),console[_0x5b731a(0x10b)](_0x5b731a(0x16c),_0xd70847[_0x5b731a(0x17e)]),console['log'](_0x5b731a(0x162),_0xd70847[_0x5b731a(0x149)]?.[_0x5b731a(0x144)]),console[_0x5b731a(0x10b)](_0x5b731a(0x167),_0xd70847['data']?.[_0x5b731a(0x153)]),console[_0x5b731a(0x10b)](_0x5b731a(0x12c),_0xd70847['data']?.[_0x5b731a(0x128)]);if(_0xd70847[_0x5b731a(0x16f)]!==_0x5b731a(0x131)||_0xd70847[_0x5b731a(0x17e)]!==0xc8){const _0x19931c=_0xd70847['message']||_0x5b731a(0x125);console[_0x5b731a(0x129)](_0x5b731a(0x145)),console[_0x5b731a(0x129)]('Error\x20Message:',_0x19931c),loggerService_1[_0x5b731a(0x10d)][_0x5b731a(0x111)](_0x5b731a(0x160),'/status',_0x5b731a(0x116)+_0x19931c);throw new Error(_0x5b731a(0x11f)+_0x19931c);}if(!_0xd70847[_0x5b731a(0x149)]){console[_0x5b731a(0x129)](_0x5b731a(0x13b)),console[_0x5b731a(0x129)](_0x5b731a(0x161)),loggerService_1[_0x5b731a(0x10d)][_0x5b731a(0x111)](_0x5b731a(0x160),'/status',_0x5b731a(0x169));throw new Error(_0x5b731a(0x122));}let _0x2b8c5c=_0x5b731a(0x11c);switch(_0xd70847['data']['Status']?.[_0x5b731a(0x175)]()){case _0x5b731a(0x12f):_0x2b8c5c=_0x5b731a(0x184);break;case _0x5b731a(0x127):case'failed':case _0x5b731a(0x129):_0x2b8c5c='FAILED';break;case'expired':case _0x5b731a(0x157):_0x2b8c5c=_0x5b731a(0x164);break;case _0x5b731a(0x102):case _0x5b731a(0x109):case _0x5b731a(0x158):case _0x5b731a(0x11d):default:_0x2b8c5c=_0x5b731a(0x11c);break;}let _0x130081,_0x10fc74;if(_0xd70847[_0x5b731a(0x149)]['PaymentDetail']){const _0x312237=_0xd70847['data']['PaymentDetail'];console[_0x5b731a(0x10b)](_0x5b731a(0x15b),_0x312237);const _0x1523a8=_0x312237[_0x5b731a(0x10e)](/IBAN\s+([A-Z0-9]+)/i);_0x1523a8&&(_0x130081=_0x1523a8[0x1],console[_0x5b731a(0x10b)](_0x5b731a(0x124),_0x130081)),_0x10fc74=_0x312237;}const _0x173786={'iban':_0x130081,'bankDetails':_0x10fc74,'transactionId':_0xd70847['data'][_0x5b731a(0x13f)],'coinAddress':_0xd70847['data'][_0x5b731a(0x163)],'qrCodeUrl':_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x120)],'expiryTime':_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x112)],'createdOn':_0xd70847[_0x5b731a(0x149)]['CreatedOn'],'confirmedOn':_0xd70847['data'][_0x5b731a(0x185)]};console[_0x5b731a(0x10b)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5b731a(0x10b)]('Status:',_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x144)],'->',_0x2b8c5c),console[_0x5b731a(0x10b)](_0x5b731a(0x167),_0xd70847[_0x5b731a(0x149)]['Amount'],_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x128)]),console[_0x5b731a(0x10b)]('Transaction\x20ID:',_0xd70847['data'][_0x5b731a(0x13f)]),console[_0x5b731a(0x10b)](_0x5b731a(0x135),_0x130081||_0x5b731a(0x143)),console[_0x5b731a(0x10b)]('Created\x20On:',_0xd70847['data'][_0x5b731a(0x17b)]),console[_0x5b731a(0x10b)](_0x5b731a(0x155),_0xd70847['data'][_0x5b731a(0x185)]||_0x5b731a(0x178));if(_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x144)]?.[_0x5b731a(0x175)]()==='awaiting\x20fiat')console[_0x5b731a(0x10b)](_0x5b731a(0x189));else _0xd70847[_0x5b731a(0x149)][_0x5b731a(0x144)]?.['toLowerCase']()===_0x5b731a(0x12f)&&console['log'](_0x5b731a(0x10c));return{'status':_0x2b8c5c,'amount':parseFloat(_0xd70847[_0x5b731a(0x149)][_0x5b731a(0x153)])||undefined,'currency':_0xd70847[_0x5b731a(0x149)]['inputCurrency']||'EUR','paymentDetails':_0x173786};}catch(_0x1c0fa2){console['error'](_0x5b731a(0x11e),_0x1c0fa2),loggerService_1['loggerService'][_0x5b731a(0x111)]('cointopay','/status',_0x1c0fa2);throw new Error(_0x5b731a(0x148)+(_0x1c0fa2 instanceof Error?_0x1c0fa2[_0x5b731a(0x15f)]:_0x5b731a(0x103)));}}async[a40_0x2c16c6(0x14d)](_0x1c5de6){const _0x21ac21=a40_0x2c16c6,_0x5e3083=await this[_0x21ac21(0x140)](_0x1c5de6);return{'status':_0x5e3083[_0x21ac21(0x110)],'amount':_0x5e3083['amount'],'currency':_0x5e3083['currency']};}async['processWebhook'](_0x3159ac){const _0x50c2bc=a40_0x2c16c6;console[_0x50c2bc(0x10b)](_0x50c2bc(0x17a),_0x3159ac);let _0x1109f3=_0x50c2bc(0x11c);switch(_0x3159ac[_0x50c2bc(0x110)]?.[_0x50c2bc(0x175)]()){case _0x50c2bc(0x12f):_0x1109f3=_0x50c2bc(0x184);break;case _0x50c2bc(0x127):case _0x50c2bc(0x14f):case _0x50c2bc(0x129):_0x1109f3=_0x50c2bc(0x12b);break;case _0x50c2bc(0x183):case _0x50c2bc(0x157):_0x1109f3=_0x50c2bc(0x164);break;case _0x50c2bc(0x158):case _0x50c2bc(0x102):case _0x50c2bc(0x109):case _0x50c2bc(0x11d):default:_0x1109f3='PENDING';break;}return{'paymentId':_0x3159ac[_0x50c2bc(0x105)]||_0x3159ac[_0x50c2bc(0x17d)]||'','status':_0x1109f3,'amount':_0x3159ac[_0x50c2bc(0x12d)],'currency':_0x3159ac[_0x50c2bc(0x114)]||'EUR'};}}exports[a40_0x2c16c6(0x182)]=CoinToPayService;