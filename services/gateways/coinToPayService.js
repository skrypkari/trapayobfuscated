'use strict';const a40_0x13aafc=a40_0x593b;function a40_0x593b(_0x6ea96c,_0x29f01f){const _0x5785c0=a40_0x5785();return a40_0x593b=function(_0x593b3f,_0x35ca21){_0x593b3f=_0x593b3f-0x97;let _0x41a75f=_0x5785c0[_0x593b3f];return _0x41a75f;},a40_0x593b(_0x6ea96c,_0x29f01f);}(function(_0x4e2712,_0xd81f1){const _0x213385=a40_0x593b,_0x2b06d0=_0x4e2712();while(!![]){try{const _0x348b95=parseInt(_0x213385(0xe4))/0x1+parseInt(_0x213385(0xbd))/0x2*(parseInt(_0x213385(0x10b))/0x3)+parseInt(_0x213385(0xc9))/0x4*(parseInt(_0x213385(0xf3))/0x5)+parseInt(_0x213385(0xa8))/0x6+parseInt(_0x213385(0xa0))/0x7+parseInt(_0x213385(0xb5))/0x8*(parseInt(_0x213385(0x9b))/0x9)+parseInt(_0x213385(0x10d))/0xa*(-parseInt(_0x213385(0xf8))/0xb);if(_0x348b95===_0xd81f1)break;else _0x2b06d0['push'](_0x2b06d0['shift']());}catch(_0x4604d2){_0x2b06d0['push'](_0x2b06d0['shift']());}}}(a40_0x5785,0xd3be0));Object['defineProperty'](exports,a40_0x13aafc(0xde),{'value':!![]}),exports[a40_0x13aafc(0xdf)]=void 0x0;function a40_0x5785(){const _0x56e7f4=['üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status:','error','cancelled','merchant_reference_id','FAILED','HTTP\x20','Business\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status','Unknown\x20error','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','match','inputCurrency','URL:','Unknown\x20error\x20from\x20CoinToPay\x20API','6705kkkyXz','loggerService','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','entries','3660867mPAbvj','status_code','now','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','pending','stringify','statusText','processWebhook','2476908yDzbgh','payment_url','Created\x20On:',',\x20body:\x20','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','HTTP\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Response\x20Time:','logWhiteDomainRequest','TesSoft\x20Payment\x20System/1.0','EXPIRED','3208UFFEht','EUR','logWhiteDomainError','Incomplete\x20response:\x20missing\x20data','application/json','stack','data','apiUrl','78714UzLKLK','Status\x20API\x20Error:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','/status','Error\x20details:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN:','created','/create','TransactionConfirmedOn','order_id','Failed\x20to\x20parse\x20JSON\x20response:','409428smdDIH','Request\x20Body:','currency','JSON\x20Parse\x20Error:\x20','logWhiteDomainResponse','fromEntries','Raw\x20Response\x20Body:','Status\x20Code:','Transaction\x20ID:','awaiting\x20fiat','amount','üìä\x20Status\x20check\x20URL:','PAID','verifyPayment','message','Result:','===\x20COINTOPAY\x20API\x20ERROR\x20===','cointopay','PaymentDetail','Missing\x20data\x20in\x20response','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','__esModule','CoinToPayService','expired','coinAddress','result','Error\x20stack:','592600mQKgIW','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','POST','https://tesoft.uk/gateway/cointopay/status.php','Gateway\x20Payment\x20ID:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','CoinToPay\x20payment\x20status\x20check\x20error:','statusUrl','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','timeout','TransactionID','Error\x20Message:','üè¶\x20Payment\x20Detail:','text','55TeLEXc','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Headers:','waiting','Amount:','2002187wNfTDK','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','failed','checkPaymentStatus','Amount','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','toLowerCase','paid','gateway_payment_id','PENDING','success','HTTP\x20error!\x20status:\x20','Payment\x20URL:','CreatedOn','not\x20confirmed','log','===\x20COINTOPAY\x20SUCCESS\x20===','63bowpMA','Confirmed\x20On:','160YQqQiv'];a40_0x5785=function(){return _0x56e7f4;};return a40_0x5785();}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x30ed18=a40_0x13aafc;this[_0x30ed18(0xbc)]='https://tesoft.uk/gateway/cointopay/',this[_0x30ed18(0xec)]=_0x30ed18(0xe8),console[_0x30ed18(0x109)](_0x30ed18(0xf4)),console[_0x30ed18(0x109)](_0x30ed18(0xd4),this[_0x30ed18(0xec)]);}async['createPaymentLink'](_0x5cbca4){const _0x179f8d=a40_0x13aafc,{orderId:_0x308f91,amount:_0x144ed8}=_0x5cbca4;console['log'](_0x179f8d(0xf9)+_0x144ed8+'\x20EUR');const _0x511949={'amount':_0x144ed8},_0x41653e=Date[_0x179f8d(0xa2)]();try{console['log'](_0x179f8d(0xea)),console[_0x179f8d(0x109)](_0x179f8d(0x99),this[_0x179f8d(0xbc)]),console['log'](_0x179f8d(0xca),JSON['stringify'](_0x511949,null,0x2)),console[_0x179f8d(0x109)]('Amount:',_0x144ed8,_0x179f8d(0xdd)),loggerService_1[_0x179f8d(0x9c)][_0x179f8d(0xb2)]('cointopay',_0x179f8d(0xc5),_0x179f8d(0xe7),_0x511949);const _0x1876b6=await fetch(this['apiUrl'],{'method':_0x179f8d(0xe7),'headers':{'Content-Type':_0x179f8d(0xb9),'Accept':_0x179f8d(0xb9),'User-Agent':_0x179f8d(0xb3)},'body':JSON['stringify'](_0x511949)}),_0x34d393=Date['now']()-_0x41653e;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x179f8d(0x109)](_0x179f8d(0x10f),_0x1876b6[_0x179f8d(0xaf)]),console[_0x179f8d(0x109)]('Status\x20Text:',_0x1876b6[_0x179f8d(0xa6)]),console[_0x179f8d(0x109)](_0x179f8d(0xf5),Object[_0x179f8d(0xce)](_0x1876b6['headers'][_0x179f8d(0x9f)]())),console[_0x179f8d(0x109)](_0x179f8d(0xb1),_0x34d393+'ms');const _0x4ee088=await _0x1876b6['text']();console[_0x179f8d(0x109)]('Raw\x20Response\x20Body:',_0x4ee088);if(!_0x1876b6['ok']){console[_0x179f8d(0x110)](_0x179f8d(0xd9)),console[_0x179f8d(0x110)]('HTTP\x20Status:',_0x1876b6[_0x179f8d(0xaf)]),console[_0x179f8d(0x110)]('Response\x20Body:',_0x4ee088),loggerService_1[_0x179f8d(0x9c)]['logWhiteDomainResponse'](_0x179f8d(0xda),_0x179f8d(0xc5),_0x1876b6[_0x179f8d(0xaf)],_0x4ee088,_0x34d393),loggerService_1[_0x179f8d(0x9c)]['logWhiteDomainError'](_0x179f8d(0xda),'/create','HTTP\x20'+_0x1876b6[_0x179f8d(0xaf)]+':\x20'+_0x4ee088);throw new Error(_0x179f8d(0x105)+_0x1876b6[_0x179f8d(0xaf)]+_0x179f8d(0xab)+_0x4ee088);}let _0x32f7c8;try{_0x32f7c8=JSON['parse'](_0x4ee088);}catch(_0x5f338d){console[_0x179f8d(0x110)](_0x179f8d(0xc8),_0x5f338d),loggerService_1['loggerService'][_0x179f8d(0xb7)](_0x179f8d(0xda),_0x179f8d(0xc5),_0x179f8d(0xcc)+_0x5f338d);throw new Error(_0x179f8d(0xb0)+_0x4ee088);}console[_0x179f8d(0x109)](_0x179f8d(0x119)),console[_0x179f8d(0x109)]('Parsed\x20Result:',JSON[_0x179f8d(0xa5)](_0x32f7c8,null,0x2)),loggerService_1[_0x179f8d(0x9c)][_0x179f8d(0xcd)](_0x179f8d(0xda),_0x179f8d(0xc5),_0x1876b6[_0x179f8d(0xaf)],_0x32f7c8,_0x34d393);if(_0x32f7c8[_0x179f8d(0x110)]){const _0x4d201e=_0x32f7c8[_0x179f8d(0xd7)]||_0x32f7c8[_0x179f8d(0x110)]||_0x179f8d(0x9a);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x179f8d(0xf0),_0x4d201e),loggerService_1['loggerService'][_0x179f8d(0xb7)]('cointopay',_0x179f8d(0xc5),_0x179f8d(0x115)+_0x4d201e);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x4d201e);}if(!_0x32f7c8[_0x179f8d(0xa9)]||!_0x32f7c8[_0x179f8d(0x102)]){console[_0x179f8d(0x110)](_0x179f8d(0xfe)),console[_0x179f8d(0x110)](_0x179f8d(0xfd)),console[_0x179f8d(0x110)]('Response\x20data:',_0x32f7c8),loggerService_1[_0x179f8d(0x9c)][_0x179f8d(0xb7)](_0x179f8d(0xda),_0x179f8d(0xc5),_0x179f8d(0xbf));throw new Error(_0x179f8d(0xe5));}return console[_0x179f8d(0x109)](_0x179f8d(0x10a)),console['log'](_0x179f8d(0xe9),_0x32f7c8[_0x179f8d(0x102)]),console['log'](_0x179f8d(0x106),_0x32f7c8[_0x179f8d(0xa9)]),console['log'](_0x179f8d(0xf7),_0x144ed8,_0x179f8d(0xb6)),{'gateway_payment_id':_0x32f7c8[_0x179f8d(0x102)],'payment_url':_0x32f7c8[_0x179f8d(0xa9)]};}catch(_0x2b8ea8){console[_0x179f8d(0x110)](_0x179f8d(0x9e)),console[_0x179f8d(0x110)](_0x179f8d(0xc1),_0x2b8ea8),loggerService_1[_0x179f8d(0x9c)][_0x179f8d(0xb7)](_0x179f8d(0xda),'/create',_0x2b8ea8);if(_0x2b8ea8 instanceof Error){console[_0x179f8d(0x110)]('Error\x20message:',_0x2b8ea8[_0x179f8d(0xd7)]),console[_0x179f8d(0x110)](_0x179f8d(0xe3),_0x2b8ea8[_0x179f8d(0xba)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2b8ea8[_0x179f8d(0xd7)]);}throw new Error(_0x179f8d(0x116));}}async[a40_0x13aafc(0xfb)](_0xca1928){const _0x2c21fb=a40_0x13aafc,_0x4d00e2=Date[_0x2c21fb(0xa2)]();try{console['log']('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0xca1928);const _0x3c2f29={'gatewayPaymentId':_0xca1928};loggerService_1[_0x2c21fb(0x9c)]['logWhiteDomainRequest']('cointopay',_0x2c21fb(0xc0),_0x2c21fb(0xe7),_0x3c2f29);const _0x758bf=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x2c21fb(0xb9),'Accept':_0x2c21fb(0xb9),'User-Agent':_0x2c21fb(0xb3)},'body':JSON[_0x2c21fb(0xa5)](_0x3c2f29)}),_0x234546=Date[_0x2c21fb(0xa2)]()-_0x4d00e2;console[_0x2c21fb(0x109)](_0x2c21fb(0xc2)),console[_0x2c21fb(0x109)](_0x2c21fb(0x10f),_0x758bf[_0x2c21fb(0xaf)]),console[_0x2c21fb(0x109)]('Response\x20Time:',_0x234546+'ms');if(!_0x758bf['ok']){const _0x4c4b7f=await _0x758bf[_0x2c21fb(0xf2)]();console[_0x2c21fb(0x110)](_0x2c21fb(0xad),_0x758bf[_0x2c21fb(0xaf)]),console[_0x2c21fb(0x110)]('Response\x20Body:',_0x4c4b7f),loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xcd)]('cointopay','/status',_0x758bf[_0x2c21fb(0xaf)],_0x4c4b7f,_0x234546),loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xb7)](_0x2c21fb(0xda),_0x2c21fb(0xc0),_0x2c21fb(0x114)+_0x758bf[_0x2c21fb(0xaf)]+':\x20'+_0x4c4b7f);throw new Error(_0x2c21fb(0x105)+_0x758bf[_0x2c21fb(0xaf)]);}const _0x628f88=await _0x758bf[_0x2c21fb(0xf2)]();console['log'](_0x2c21fb(0xcf),_0x628f88);let _0x2a5871;try{_0x2a5871=JSON['parse'](_0x628f88);}catch(_0x38c492){console[_0x2c21fb(0x110)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x38c492),loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xb7)](_0x2c21fb(0xda),_0x2c21fb(0xc0),_0x2c21fb(0xcc)+_0x38c492);throw new Error(_0x2c21fb(0xa3)+_0x628f88);}loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xcd)]('cointopay','/status',_0x758bf[_0x2c21fb(0xaf)],_0x2a5871,_0x234546),console[_0x2c21fb(0x109)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x2c21fb(0xd8),_0x2a5871[_0x2c21fb(0xe2)]),console[_0x2c21fb(0x109)](_0x2c21fb(0xd0),_0x2a5871[_0x2c21fb(0xa1)]),console[_0x2c21fb(0x109)]('Payment\x20Status:',_0x2a5871[_0x2c21fb(0xbb)]?.['Status']),console[_0x2c21fb(0x109)](_0x2c21fb(0xf7),_0x2a5871[_0x2c21fb(0xbb)]?.[_0x2c21fb(0xfc)]),console[_0x2c21fb(0x109)](_0x2c21fb(0xff),_0x2a5871[_0x2c21fb(0xbb)]?.[_0x2c21fb(0x98)]);if(_0x2a5871[_0x2c21fb(0xe2)]!==_0x2c21fb(0x104)||_0x2a5871[_0x2c21fb(0xa1)]!==0xc8){const _0x18f7e7=_0x2a5871['message']||_0x2c21fb(0xed);console[_0x2c21fb(0x110)](_0x2c21fb(0xae)),console[_0x2c21fb(0x110)](_0x2c21fb(0xf0),_0x18f7e7),loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xb7)](_0x2c21fb(0xda),'/status',_0x2c21fb(0xbe)+_0x18f7e7);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x18f7e7);}if(!_0x2a5871[_0x2c21fb(0xbb)]){console[_0x2c21fb(0x110)](_0x2c21fb(0xe6)),console['error'](_0x2c21fb(0xdc)),loggerService_1[_0x2c21fb(0x9c)]['logWhiteDomainError'](_0x2c21fb(0xda),_0x2c21fb(0xc0),_0x2c21fb(0xb8));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5bfff2=_0x2c21fb(0x103);switch(_0x2a5871['data'][_0x2c21fb(0x117)]?.[_0x2c21fb(0x100)]()){case _0x2c21fb(0x101):_0x5bfff2='PAID';break;case _0x2c21fb(0x111):case _0x2c21fb(0xfa):case _0x2c21fb(0x110):_0x5bfff2=_0x2c21fb(0x113);break;case _0x2c21fb(0xe0):case _0x2c21fb(0xee):_0x5bfff2=_0x2c21fb(0xb4);break;case _0x2c21fb(0xf6):case'awaiting\x20fiat':case'pending':case _0x2c21fb(0xc4):default:_0x5bfff2=_0x2c21fb(0x103);break;}let _0x28d763,_0x4fd027;if(_0x2a5871['data']['PaymentDetail']){const _0x55f9d4=_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xdb)];console[_0x2c21fb(0x109)](_0x2c21fb(0xf1),_0x55f9d4);const _0x2e6408=_0x55f9d4[_0x2c21fb(0x97)](/IBAN\s+([A-Z0-9]+)/i);_0x2e6408&&(_0x28d763=_0x2e6408[0x1],console[_0x2c21fb(0x109)](_0x2c21fb(0xc3),_0x28d763)),_0x4fd027=_0x55f9d4;}const _0x3d4527={'iban':_0x28d763,'bankDetails':_0x4fd027,'transactionId':_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xef)],'coinAddress':_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xe1)],'qrCodeUrl':_0x2a5871[_0x2c21fb(0xbb)]['QRCodeURL'],'expiryTime':_0x2a5871['data']['ExpiryTime'],'createdOn':_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0x107)],'confirmedOn':_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xc6)]};console[_0x2c21fb(0x109)](_0x2c21fb(0x9d)),console[_0x2c21fb(0x109)]('Status:',_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0x117)],'->',_0x5bfff2),console[_0x2c21fb(0x109)](_0x2c21fb(0xf7),_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xfc)],_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0x98)]),console[_0x2c21fb(0x109)](_0x2c21fb(0xd1),_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0xef)]),console[_0x2c21fb(0x109)]('IBAN:',_0x28d763||'not\x20found'),console[_0x2c21fb(0x109)](_0x2c21fb(0xaa),_0x2a5871['data']['CreatedOn']),console[_0x2c21fb(0x109)](_0x2c21fb(0x10c),_0x2a5871['data'][_0x2c21fb(0xc6)]||_0x2c21fb(0x108));if(_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0x117)]?.[_0x2c21fb(0x100)]()==='awaiting\x20fiat')console[_0x2c21fb(0x109)](_0x2c21fb(0x10e));else _0x2a5871['data'][_0x2c21fb(0x117)]?.['toLowerCase']()===_0x2c21fb(0x101)&&console[_0x2c21fb(0x109)](_0x2c21fb(0x11a));return{'status':_0x5bfff2,'amount':parseFloat(_0x2a5871['data'][_0x2c21fb(0xfc)])||undefined,'currency':_0x2a5871[_0x2c21fb(0xbb)][_0x2c21fb(0x98)]||_0x2c21fb(0xb6),'paymentDetails':_0x3d4527};}catch(_0x1a8250){console[_0x2c21fb(0x110)](_0x2c21fb(0xeb),_0x1a8250),loggerService_1[_0x2c21fb(0x9c)][_0x2c21fb(0xb7)](_0x2c21fb(0xda),'/status',_0x1a8250);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x1a8250 instanceof Error?_0x1a8250[_0x2c21fb(0xd7)]:_0x2c21fb(0x118)));}}async[a40_0x13aafc(0xd6)](_0x5bb130){const _0xaee818=a40_0x13aafc,_0x14b2ff=await this[_0xaee818(0xfb)](_0x5bb130);return{'status':_0x14b2ff[_0xaee818(0xaf)],'amount':_0x14b2ff['amount'],'currency':_0x14b2ff[_0xaee818(0xcb)]};}async[a40_0x13aafc(0xa7)](_0x152257){const _0x548d38=a40_0x13aafc;console['log'](_0x548d38(0xac),_0x152257);let _0x398278=_0x548d38(0x103);switch(_0x152257[_0x548d38(0xaf)]?.[_0x548d38(0x100)]()){case _0x548d38(0x101):_0x398278=_0x548d38(0xd5);break;case _0x548d38(0x111):case'failed':case'error':_0x398278=_0x548d38(0x113);break;case _0x548d38(0xe0):case _0x548d38(0xee):_0x398278=_0x548d38(0xb4);break;case _0x548d38(0xa4):case _0x548d38(0xf6):case _0x548d38(0xd2):case'created':default:_0x398278=_0x548d38(0x103);break;}return{'paymentId':_0x152257[_0x548d38(0xc7)]||_0x152257[_0x548d38(0x112)]||'','status':_0x398278,'amount':_0x152257[_0x548d38(0xd3)],'currency':_0x152257['currency']||_0x548d38(0xb6)};}}exports['CoinToPayService']=CoinToPayService;