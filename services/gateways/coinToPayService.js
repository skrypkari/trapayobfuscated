'use strict';const a41_0xa92ff2=a41_0x31e2;(function(_0x3a186e,_0x38d2a4){const _0x4e1aad=a41_0x31e2,_0x5265b8=_0x3a186e();while(!![]){try{const _0x5a5460=parseInt(_0x4e1aad(0xf5))/0x1+-parseInt(_0x4e1aad(0x122))/0x2*(parseInt(_0x4e1aad(0x164))/0x3)+parseInt(_0x4e1aad(0x145))/0x4+-parseInt(_0x4e1aad(0xfb))/0x5+parseInt(_0x4e1aad(0x16b))/0x6*(-parseInt(_0x4e1aad(0xf8))/0x7)+parseInt(_0x4e1aad(0x11c))/0x8+parseInt(_0x4e1aad(0x125))/0x9*(parseInt(_0x4e1aad(0x15f))/0xa);if(_0x5a5460===_0x38d2a4)break;else _0x5265b8['push'](_0x5265b8['shift']());}catch(_0x59a0d3){_0x5265b8['push'](_0x5265b8['shift']());}}}(a41_0x4f83,0xaa91f));Object['defineProperty'](exports,a41_0xa92ff2(0x109),{'value':!![]}),exports[a41_0xa92ff2(0x172)]=void 0x0;function a41_0x31e2(_0x223218,_0x48d727){const _0x4f837e=a41_0x4f83();return a41_0x31e2=function(_0x31e254,_0x402dad){_0x31e254=_0x31e254-0xec;let _0x4badea=_0x4f837e[_0x31e254];return _0x4badea;},a41_0x31e2(_0x223218,_0x48d727);}function a41_0x4f83(){const _0x3dfcdd=['CoinToPay\x20API\x20error:\x20','QRCodeURL','match','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','created','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','not\x20found','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','TransactionID','Payment\x20URL:','Confirmed\x20On:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20Status:','status','awaiting\x20fiat','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','../loggerService','payment_url','amount','merchant_reference_id','/create','verifyPayment','2448880MWuPfD','Amount:','CreatedOn','status_code','IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20API','paid','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','error','Amount','HTTP\x20error!\x20status:\x20','Status\x20Code:','PaymentDetail','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','statusUrl','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','message','entries','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','loggerService','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','URL:','Error\x20message:','Status\x20API\x20Error:\x20','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','5770pWRuLV','Request\x20Body:','Headers:','text','FAILED','12MugbuZ','stack','HTTP\x20','log','waiting','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20API\x20ERROR\x20===','33954priHHw','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Gateway\x20Payment\x20ID:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','\x20EUR','https://tesoft.uk/gateway/cointopay/','Transaction\x20ID:','CoinToPayService','result','EXPIRED','data','Parsed\x20Result:','Status','/status','pending','Status:','Missing\x20data\x20in\x20response','Response\x20Time:','not\x20confirmed','665232PgSLPO','PENDING','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1232NBkPjx','Raw\x20Response\x20Body:','parse','535335xddZWG','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','timeout','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Created\x20On:','logWhiteDomainRequest','headers','currency','logWhiteDomainError','logWhiteDomainResponse','ExpiryTime','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','inputCurrency','Result:','__esModule','PAID','TransactionConfirmedOn','application/json','CoinToPay\x20status\x20API\x20error:\x20','Currency:','now','failed','Response\x20Body:','Failed\x20to\x20parse\x20JSON\x20response:','Error\x20details:','https://tesoft.uk/gateway/cointopay/status.php','checkPaymentStatus','Error\x20stack:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Error\x20Message:','POST','===\x20COINTOPAY\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','442224eewApo','Status\x20Text:','TesSoft\x20Payment\x20System/1.0','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','apiUrl','Response\x20data:','479838GLfExW','cointopay','toLowerCase','22284AaulSn','Payment\x20Status:','stringify','gateway_payment_id','JSON\x20Parse\x20Error:\x20','EUR',',\x20body:\x20','üè¶\x20Payment\x20Detail:'];a41_0x4f83=function(){return _0x3dfcdd;};return a41_0x4f83();}const loggerService_1=require(a41_0xa92ff2(0x13f));class CoinToPayService{constructor(){const _0x5c9774=a41_0xa92ff2;this[_0x5c9774(0x120)]=_0x5c9774(0x170),this[_0x5c9774(0x153)]=_0x5c9774(0x114),console['log'](_0x5c9774(0xf7)),console[_0x5c9774(0x167)]('üìä\x20Status\x20check\x20URL:',this[_0x5c9774(0x153)]);}async['createPaymentLink'](_0x5bd00f){const _0xa7425d=a41_0xa92ff2,{orderId:_0x38cd69,amount:_0x5d76a0}=_0x5bd00f;console[_0xa7425d(0x167)](_0xa7425d(0x136)+_0x5d76a0+_0xa7425d(0x16f));const _0x33cc22={'amount':_0x5d76a0},_0x4a20c2=Date['now']();try{console[_0xa7425d(0x167)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0xa7425d(0x167)](_0xa7425d(0x15a),this[_0xa7425d(0x120)]),console[_0xa7425d(0x167)](_0xa7425d(0x160),JSON['stringify'](_0x33cc22,null,0x2)),console[_0xa7425d(0x167)](_0xa7425d(0x146),_0x5d76a0,_0xa7425d(0x16e)),loggerService_1['loggerService'][_0xa7425d(0x100)](_0xa7425d(0x123),_0xa7425d(0x143),_0xa7425d(0x119),_0x33cc22);const _0x293889=await fetch(this[_0xa7425d(0x120)],{'method':_0xa7425d(0x119),'headers':{'Content-Type':_0xa7425d(0x10c),'Accept':'application/json','User-Agent':_0xa7425d(0x11e)},'body':JSON['stringify'](_0x33cc22)}),_0x13b417=Date[_0xa7425d(0x10f)]()-_0x4a20c2;console[_0xa7425d(0x167)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0xa7425d(0x167)](_0xa7425d(0xf1),_0x293889['status']),console['log'](_0xa7425d(0x11d),_0x293889['statusText']),console[_0xa7425d(0x167)](_0xa7425d(0x161),Object['fromEntries'](_0x293889[_0xa7425d(0x101)][_0xa7425d(0x156)]())),console[_0xa7425d(0x167)](_0xa7425d(0xf3),_0x13b417+'ms');const _0x508c99=await _0x293889[_0xa7425d(0x162)]();console[_0xa7425d(0x167)](_0xa7425d(0xf9),_0x508c99);if(!_0x293889['ok']){console[_0xa7425d(0x14d)](_0xa7425d(0x16a)),console[_0xa7425d(0x14d)](_0xa7425d(0x13b),_0x293889[_0xa7425d(0x13c)]),console[_0xa7425d(0x14d)](_0xa7425d(0x111),_0x508c99),loggerService_1[_0xa7425d(0x158)][_0xa7425d(0x104)](_0xa7425d(0x123),_0xa7425d(0x143),_0x293889[_0xa7425d(0x13c)],_0x508c99,_0x13b417),loggerService_1['loggerService'][_0xa7425d(0x103)]('cointopay',_0xa7425d(0x143),_0xa7425d(0x166)+_0x293889[_0xa7425d(0x13c)]+':\x20'+_0x508c99);throw new Error(_0xa7425d(0x14f)+_0x293889[_0xa7425d(0x13c)]+_0xa7425d(0x12b)+_0x508c99);}let _0xc5b49a;try{_0xc5b49a=JSON[_0xa7425d(0xfa)](_0x508c99);}catch(_0x489990){console[_0xa7425d(0x14d)](_0xa7425d(0x112),_0x489990),loggerService_1['loggerService'][_0xa7425d(0x103)](_0xa7425d(0x123),_0xa7425d(0x143),_0xa7425d(0x129)+_0x489990);throw new Error(_0xa7425d(0x11f)+_0x508c99);}console[_0xa7425d(0x167)](_0xa7425d(0x152)),console[_0xa7425d(0x167)](_0xa7425d(0xed),JSON[_0xa7425d(0x127)](_0xc5b49a,null,0x2)),loggerService_1[_0xa7425d(0x158)][_0xa7425d(0x104)](_0xa7425d(0x123),_0xa7425d(0x143),_0x293889['status'],_0xc5b49a,_0x13b417);if(_0xc5b49a[_0xa7425d(0x14d)]){const _0x126ec1=_0xc5b49a['message']||_0xc5b49a[_0xa7425d(0x14d)]||_0xa7425d(0x14a);console[_0xa7425d(0x14d)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xa7425d(0x14d)](_0xa7425d(0x118),_0x126ec1),loggerService_1[_0xa7425d(0x158)]['logWhiteDomainError']('cointopay',_0xa7425d(0x143),'Business\x20Error:\x20'+_0x126ec1);throw new Error(_0xa7425d(0x12d)+_0x126ec1);}if(!_0xc5b49a[_0xa7425d(0x140)]||!_0xc5b49a[_0xa7425d(0x128)]){console[_0xa7425d(0x14d)](_0xa7425d(0x133)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0xa7425d(0x14d)](_0xa7425d(0x121),_0xc5b49a),loggerService_1[_0xa7425d(0x158)][_0xa7425d(0x103)](_0xa7425d(0x123),_0xa7425d(0x143),_0xa7425d(0x11b));throw new Error(_0xa7425d(0x13a));}return console[_0xa7425d(0x167)](_0xa7425d(0x11a)),console[_0xa7425d(0x167)](_0xa7425d(0x16d),_0xc5b49a['gateway_payment_id']),console['log'](_0xa7425d(0x138),_0xc5b49a[_0xa7425d(0x140)]),console[_0xa7425d(0x167)](_0xa7425d(0x146),_0x5d76a0,'EUR'),{'gateway_payment_id':_0xc5b49a[_0xa7425d(0x128)],'payment_url':_0xc5b49a[_0xa7425d(0x140)]};}catch(_0x428c77){console[_0xa7425d(0x14d)](_0xa7425d(0x154)),console['error'](_0xa7425d(0x113),_0x428c77),loggerService_1[_0xa7425d(0x158)][_0xa7425d(0x103)]('cointopay',_0xa7425d(0x143),_0x428c77);if(_0x428c77 instanceof Error){console[_0xa7425d(0x14d)](_0xa7425d(0x15b),_0x428c77['message']),console[_0xa7425d(0x14d)](_0xa7425d(0x116),_0x428c77[_0xa7425d(0x165)]);throw new Error(_0xa7425d(0x159)+_0x428c77[_0xa7425d(0x155)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a41_0xa92ff2(0x115)](_0x4449c3){const _0x3474f1=a41_0xa92ff2,_0xc82b94=Date[_0x3474f1(0x10f)]();try{console[_0x3474f1(0x167)](_0x3474f1(0x16c)+_0x4449c3);const _0x52fc42={'gatewayPaymentId':_0x4449c3};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x3474f1(0xef),_0x3474f1(0x119),_0x52fc42);const _0x5545b1=await fetch(this[_0x3474f1(0x153)],{'method':'POST','headers':{'Content-Type':_0x3474f1(0x10c),'Accept':_0x3474f1(0x10c),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3474f1(0x127)](_0x52fc42)}),_0x43665d=Date[_0x3474f1(0x10f)]()-_0xc82b94;console[_0x3474f1(0x167)](_0x3474f1(0x13e)),console[_0x3474f1(0x167)](_0x3474f1(0xf1),_0x5545b1['status']),console['log'](_0x3474f1(0xf3),_0x43665d+'ms');if(!_0x5545b1['ok']){const _0x435516=await _0x5545b1[_0x3474f1(0x162)]();console[_0x3474f1(0x14d)](_0x3474f1(0x13b),_0x5545b1[_0x3474f1(0x13c)]),console[_0x3474f1(0x14d)]('Response\x20Body:',_0x435516),loggerService_1[_0x3474f1(0x158)][_0x3474f1(0x104)](_0x3474f1(0x123),_0x3474f1(0xef),_0x5545b1['status'],_0x435516,_0x43665d),loggerService_1[_0x3474f1(0x158)][_0x3474f1(0x103)](_0x3474f1(0x123),_0x3474f1(0xef),_0x3474f1(0x166)+_0x5545b1['status']+':\x20'+_0x435516);throw new Error(_0x3474f1(0x14f)+_0x5545b1[_0x3474f1(0x13c)]);}const _0x3138d7=await _0x5545b1[_0x3474f1(0x162)]();console[_0x3474f1(0x167)](_0x3474f1(0xf9),_0x3138d7);let _0x1e6381;try{_0x1e6381=JSON['parse'](_0x3138d7);}catch(_0x17d6fa){console[_0x3474f1(0x14d)](_0x3474f1(0x112),_0x17d6fa),loggerService_1[_0x3474f1(0x158)][_0x3474f1(0x103)](_0x3474f1(0x123),_0x3474f1(0xef),_0x3474f1(0x129)+_0x17d6fa);throw new Error(_0x3474f1(0x134)+_0x3138d7);}loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay',_0x3474f1(0xef),_0x5545b1[_0x3474f1(0x13c)],_0x1e6381,_0x43665d),console[_0x3474f1(0x167)](_0x3474f1(0x130)),console[_0x3474f1(0x167)](_0x3474f1(0x108),_0x1e6381[_0x3474f1(0x173)]),console[_0x3474f1(0x167)](_0x3474f1(0x150),_0x1e6381[_0x3474f1(0x148)]),console['log'](_0x3474f1(0x126),_0x1e6381['data']?.['Status']),console[_0x3474f1(0x167)](_0x3474f1(0x146),_0x1e6381['data']?.[_0x3474f1(0x14e)]),console[_0x3474f1(0x167)](_0x3474f1(0x10e),_0x1e6381[_0x3474f1(0xec)]?.['inputCurrency']);if(_0x1e6381['result']!=='success'||_0x1e6381['status_code']!==0xc8){const _0x58c3a4=_0x1e6381[_0x3474f1(0x155)]||_0x3474f1(0xfe);console[_0x3474f1(0x14d)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x3474f1(0x14d)](_0x3474f1(0x118),_0x58c3a4),loggerService_1['loggerService'][_0x3474f1(0x103)](_0x3474f1(0x123),_0x3474f1(0xef),_0x3474f1(0x15c)+_0x58c3a4);throw new Error(_0x3474f1(0x10d)+_0x58c3a4);}if(!_0x1e6381[_0x3474f1(0xec)]){console[_0x3474f1(0x14d)](_0x3474f1(0xfc)),console[_0x3474f1(0x14d)](_0x3474f1(0xf2)),loggerService_1[_0x3474f1(0x158)]['logWhiteDomainError'](_0x3474f1(0x123),_0x3474f1(0xef),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x3474f1(0x15e));}let _0x2080f8=_0x3474f1(0xf6);switch(_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0xee)]?.[_0x3474f1(0x124)]()){case'paid':_0x2080f8='PAID';break;case _0x3474f1(0x15d):case _0x3474f1(0x110):case _0x3474f1(0x14d):_0x2080f8=_0x3474f1(0x163);break;case'expired':case _0x3474f1(0xfd):_0x2080f8=_0x3474f1(0x174);break;case _0x3474f1(0x168):case _0x3474f1(0x13d):case _0x3474f1(0xf0):case _0x3474f1(0x131):default:_0x2080f8=_0x3474f1(0xf6);break;}let _0x264487,_0x357bba;if(_0x1e6381['data'][_0x3474f1(0x151)]){const _0x17db04=_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x151)];console[_0x3474f1(0x167)](_0x3474f1(0x12c),_0x17db04);const _0x536f59=_0x17db04[_0x3474f1(0x12f)](/IBAN\s+([A-Z0-9]+)/i);_0x536f59&&(_0x264487=_0x536f59[0x1],console[_0x3474f1(0x167)](_0x3474f1(0x132),_0x264487)),_0x357bba=_0x17db04;}const _0x5e804d={'iban':_0x264487,'bankDetails':_0x357bba,'transactionId':_0x1e6381[_0x3474f1(0xec)]['TransactionID'],'coinAddress':_0x1e6381[_0x3474f1(0xec)]['coinAddress'],'qrCodeUrl':_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x12e)],'expiryTime':_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x105)],'createdOn':_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x147)],'confirmedOn':_0x1e6381['data'][_0x3474f1(0x10b)]};console[_0x3474f1(0x167)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3474f1(0x167)]('Status:',_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0xee)],'->',_0x2080f8),console[_0x3474f1(0x167)]('Amount:',_0x1e6381['data'][_0x3474f1(0x14e)],_0x1e6381[_0x3474f1(0xec)]['inputCurrency']),console[_0x3474f1(0x167)](_0x3474f1(0x171),_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x137)]),console[_0x3474f1(0x167)](_0x3474f1(0x149),_0x264487||_0x3474f1(0x135)),console[_0x3474f1(0x167)](_0x3474f1(0xff),_0x1e6381[_0x3474f1(0xec)]['CreatedOn']),console[_0x3474f1(0x167)](_0x3474f1(0x139),_0x1e6381[_0x3474f1(0xec)]['TransactionConfirmedOn']||_0x3474f1(0xf4));if(_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0xee)]?.[_0x3474f1(0x124)]()===_0x3474f1(0x13d))console[_0x3474f1(0x167)](_0x3474f1(0x157));else _0x1e6381[_0x3474f1(0xec)][_0x3474f1(0xee)]?.[_0x3474f1(0x124)]()===_0x3474f1(0x14b)&&console[_0x3474f1(0x167)](_0x3474f1(0x117));return{'status':_0x2080f8,'amount':parseFloat(_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x14e)])||undefined,'currency':_0x1e6381[_0x3474f1(0xec)][_0x3474f1(0x107)]||_0x3474f1(0x12a),'paymentDetails':_0x5e804d};}catch(_0x2e77f4){console[_0x3474f1(0x14d)](_0x3474f1(0x169),_0x2e77f4),loggerService_1['loggerService'][_0x3474f1(0x103)](_0x3474f1(0x123),_0x3474f1(0xef),_0x2e77f4);throw new Error(_0x3474f1(0x14c)+(_0x2e77f4 instanceof Error?_0x2e77f4[_0x3474f1(0x155)]:'Unknown\x20error'));}}async[a41_0xa92ff2(0x144)](_0x1e79f7){const _0x33d110=a41_0xa92ff2,_0x51a7db=await this[_0x33d110(0x115)](_0x1e79f7);return{'status':_0x51a7db[_0x33d110(0x13c)],'amount':_0x51a7db[_0x33d110(0x141)],'currency':_0x51a7db['currency']};}async['processWebhook'](_0x57e38a){const _0x24e88b=a41_0xa92ff2;console['log'](_0x24e88b(0x106),_0x57e38a);let _0x711281=_0x24e88b(0xf6);switch(_0x57e38a['status']?.['toLowerCase']()){case _0x24e88b(0x14b):_0x711281=_0x24e88b(0x10a);break;case _0x24e88b(0x15d):case _0x24e88b(0x110):case'error':_0x711281=_0x24e88b(0x163);break;case'expired':case _0x24e88b(0xfd):_0x711281=_0x24e88b(0x174);break;case'pending':case _0x24e88b(0x168):case'awaiting\x20fiat':case'created':default:_0x711281=_0x24e88b(0xf6);break;}return{'paymentId':_0x57e38a['order_id']||_0x57e38a[_0x24e88b(0x142)]||'','status':_0x711281,'amount':_0x57e38a[_0x24e88b(0x141)],'currency':_0x57e38a[_0x24e88b(0x102)]||_0x24e88b(0x12a)};}}exports[a41_0xa92ff2(0x172)]=CoinToPayService;