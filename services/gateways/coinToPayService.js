'use strict';const a41_0x51b7a9=a41_0x3128;(function(_0x1a5aae,_0x5c08b5){const _0x44cffa=a41_0x3128,_0x563ed8=_0x1a5aae();while(!![]){try{const _0x448c9f=-parseInt(_0x44cffa(0x1db))/0x1+parseInt(_0x44cffa(0x1cc))/0x2+-parseInt(_0x44cffa(0x1e8))/0x3+-parseInt(_0x44cffa(0x20a))/0x4+parseInt(_0x44cffa(0x223))/0x5*(-parseInt(_0x44cffa(0x225))/0x6)+parseInt(_0x44cffa(0x1e3))/0x7*(-parseInt(_0x44cffa(0x220))/0x8)+parseInt(_0x44cffa(0x1f7))/0x9;if(_0x448c9f===_0x5c08b5)break;else _0x563ed8['push'](_0x563ed8['shift']());}catch(_0x37d4e9){_0x563ed8['push'](_0x563ed8['shift']());}}}(a41_0x331d,0xcfd6c));Object[a41_0x51b7a9(0x229)](exports,a41_0x51b7a9(0x1bb),{'value':!![]}),exports[a41_0x51b7a9(0x219)]=void 0x0;function a41_0x331d(){const _0x5cf7ca=['CoinToPay\x20status\x20API\x20error:\x20','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','HTTP\x20','payment_url','Unknown\x20error','match','loggerService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','inputCurrency','Confirmed\x20On:','IBAN:','statusText','error','toLowerCase','JSON\x20Parse\x20Error:\x20','log','logWhiteDomainRequest','5438944rIiUwU','PAID','/status','Failed\x20to\x20parse\x20JSON\x20response:','fromEntries','status','stack','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Status','Status\x20Text:','Raw\x20Response\x20Body:','Response\x20Time:','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Status\x20Code:','CoinToPayService','message','application/json','not\x20confirmed','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','logWhiteDomainResponse','Parsed\x20Result:','3336URzpmw','Amount:','Error\x20details:','35DjSozm','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','310536AhGtji','===\x20COINTOPAY\x20API\x20ERROR\x20===','Response\x20Body:','EUR','defineProperty','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','pending','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','data','PENDING','üè¶\x20Extracted\x20IBAN:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','entries','checkPaymentStatus','now','statusUrl','URL:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','failed','parse','Request\x20Body:','Incomplete\x20response:\x20missing\x20data','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Currency:','currency','POST','PaymentDetail','__esModule',',\x20body:\x20','Error\x20stack:','CoinToPay\x20payment\x20status\x20check\x20error:','created','apiUrl','createPaymentLink','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','/create','order_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','TransactionConfirmedOn','Result:','ExpiryTime','Gateway\x20Payment\x20ID:','merchant_reference_id','410120ycAFDQ','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status:','TransactionID','paid','CreatedOn','coinAddress','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','EXPIRED','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','expired','logWhiteDomainError','Amount','327146PvwIDM','Error\x20message:','Headers:','\x20EUR','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/cointopay/status.php','not\x20found','FAILED','1442mLPmsq','HTTP\x20Status:','Response\x20data:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','awaiting\x20fiat','3741585qIssvY','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','result','headers','waiting','amount','üìä\x20Status\x20check\x20URL:','../loggerService','Missing\x20data\x20in\x20response','stringify','Created\x20On:','cointopay','status_code','text','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','36256671iyOGIk'];a41_0x331d=function(){return _0x5cf7ca;};return a41_0x331d();}function a41_0x3128(_0x3151d1,_0x7c8f3b){const _0x331dd0=a41_0x331d();return a41_0x3128=function(_0x312828,_0x78a905){_0x312828=_0x312828-0x1ab;let _0x4b9e54=_0x331dd0[_0x312828];return _0x4b9e54;},a41_0x3128(_0x3151d1,_0x7c8f3b);}const loggerService_1=require(a41_0x51b7a9(0x1ef));class CoinToPayService{constructor(){const _0x41b284=a41_0x51b7a9;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x41b284(0x1ae)]=_0x41b284(0x1e0),console['log'](_0x41b284(0x1df)),console[_0x41b284(0x208)](_0x41b284(0x1ee),this[_0x41b284(0x1ae)]);}async[a41_0x51b7a9(0x1c1)](_0x4db057){const _0x23bdcf=a41_0x51b7a9,{orderId:_0x3651b8,amount:_0x40c8b9}=_0x4db057;console[_0x23bdcf(0x208)](_0x23bdcf(0x1f6)+_0x40c8b9+_0x23bdcf(0x1de));const _0x59e766={'amount':_0x40c8b9},_0x21d740=Date['now']();try{console[_0x23bdcf(0x208)](_0x23bdcf(0x1d3)),console[_0x23bdcf(0x208)](_0x23bdcf(0x1af),this['apiUrl']),console[_0x23bdcf(0x208)](_0x23bdcf(0x1b3),JSON['stringify'](_0x59e766,null,0x2)),console['log'](_0x23bdcf(0x221),_0x40c8b9,_0x23bdcf(0x224)),loggerService_1[_0x23bdcf(0x1fe)][_0x23bdcf(0x209)](_0x23bdcf(0x1f3),_0x23bdcf(0x1c4),_0x23bdcf(0x1b9),_0x59e766);const _0x461eb3=await fetch(this[_0x23bdcf(0x1c0)],{'method':'POST','headers':{'Content-Type':_0x23bdcf(0x21b),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x59e766)}),_0xc428e9=Date[_0x23bdcf(0x1ad)]()-_0x21d740;console[_0x23bdcf(0x208)](_0x23bdcf(0x1c2)),console[_0x23bdcf(0x208)]('Status:',_0x461eb3[_0x23bdcf(0x20f)]),console[_0x23bdcf(0x208)](_0x23bdcf(0x213),_0x461eb3[_0x23bdcf(0x204)]),console[_0x23bdcf(0x208)](_0x23bdcf(0x1dd),Object[_0x23bdcf(0x20e)](_0x461eb3[_0x23bdcf(0x1eb)][_0x23bdcf(0x1ab)]())),console[_0x23bdcf(0x208)]('Response\x20Time:',_0xc428e9+'ms');const _0x5b60f6=await _0x461eb3['text']();console[_0x23bdcf(0x208)](_0x23bdcf(0x214),_0x5b60f6);if(!_0x461eb3['ok']){console[_0x23bdcf(0x205)](_0x23bdcf(0x226)),console[_0x23bdcf(0x205)](_0x23bdcf(0x1e4),_0x461eb3['status']),console['error']('Response\x20Body:',_0x5b60f6),loggerService_1[_0x23bdcf(0x1fe)]['logWhiteDomainResponse']('cointopay','/create',_0x461eb3['status'],_0x5b60f6,_0xc428e9),loggerService_1['loggerService'][_0x23bdcf(0x1d9)](_0x23bdcf(0x1f3),_0x23bdcf(0x1c4),'HTTP\x20'+_0x461eb3[_0x23bdcf(0x20f)]+':\x20'+_0x5b60f6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x461eb3[_0x23bdcf(0x20f)]+_0x23bdcf(0x1bc)+_0x5b60f6);}let _0x27cd6d;try{_0x27cd6d=JSON[_0x23bdcf(0x1b2)](_0x5b60f6);}catch(_0x5c2f7d){console['error'](_0x23bdcf(0x20d),_0x5c2f7d),loggerService_1[_0x23bdcf(0x1fe)]['logWhiteDomainError'](_0x23bdcf(0x1f3),_0x23bdcf(0x1c4),'JSON\x20Parse\x20Error:\x20'+_0x5c2f7d);throw new Error(_0x23bdcf(0x231)+_0x5b60f6);}console[_0x23bdcf(0x208)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x23bdcf(0x208)](_0x23bdcf(0x21f),JSON[_0x23bdcf(0x1f1)](_0x27cd6d,null,0x2)),loggerService_1[_0x23bdcf(0x1fe)][_0x23bdcf(0x21e)](_0x23bdcf(0x1f3),_0x23bdcf(0x1c4),_0x461eb3[_0x23bdcf(0x20f)],_0x27cd6d,_0xc428e9);if(_0x27cd6d[_0x23bdcf(0x205)]){const _0x5dac7a=_0x27cd6d['message']||_0x27cd6d['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x23bdcf(0x205)](_0x23bdcf(0x1ff)),console['error'](_0x23bdcf(0x216),_0x5dac7a),loggerService_1[_0x23bdcf(0x1fe)][_0x23bdcf(0x1d9)](_0x23bdcf(0x1f3),'/create','Business\x20Error:\x20'+_0x5dac7a);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5dac7a);}if(!_0x27cd6d[_0x23bdcf(0x1fb)]||!_0x27cd6d['gateway_payment_id']){console[_0x23bdcf(0x205)](_0x23bdcf(0x1cd)),console[_0x23bdcf(0x205)](_0x23bdcf(0x1e9)),console[_0x23bdcf(0x205)](_0x23bdcf(0x1e5),_0x27cd6d),loggerService_1[_0x23bdcf(0x1fe)][_0x23bdcf(0x1d9)](_0x23bdcf(0x1f3),'/create',_0x23bdcf(0x200));throw new Error(_0x23bdcf(0x22a));}return console[_0x23bdcf(0x208)](_0x23bdcf(0x1b5)),console[_0x23bdcf(0x208)](_0x23bdcf(0x1ca),_0x27cd6d[_0x23bdcf(0x1d6)]),console[_0x23bdcf(0x208)]('Payment\x20URL:',_0x27cd6d['payment_url']),console[_0x23bdcf(0x208)](_0x23bdcf(0x221),_0x40c8b9,_0x23bdcf(0x228)),{'gateway_payment_id':_0x27cd6d[_0x23bdcf(0x1d6)],'payment_url':_0x27cd6d['payment_url']};}catch(_0x17cd49){console[_0x23bdcf(0x205)](_0x23bdcf(0x1c3)),console[_0x23bdcf(0x205)](_0x23bdcf(0x222),_0x17cd49),loggerService_1[_0x23bdcf(0x1fe)][_0x23bdcf(0x1d9)](_0x23bdcf(0x1f3),_0x23bdcf(0x1c4),_0x17cd49);if(_0x17cd49 instanceof Error){console['error'](_0x23bdcf(0x1dc),_0x17cd49[_0x23bdcf(0x21a)]),console[_0x23bdcf(0x205)](_0x23bdcf(0x1bd),_0x17cd49[_0x23bdcf(0x210)]);throw new Error(_0x23bdcf(0x217)+_0x17cd49[_0x23bdcf(0x21a)]);}throw new Error(_0x23bdcf(0x1c6));}}async[a41_0x51b7a9(0x1ac)](_0x148c33){const _0x24846c=a41_0x51b7a9,_0x4ca8e4=Date[_0x24846c(0x1ad)]();try{console[_0x24846c(0x208)](_0x24846c(0x1b0)+_0x148c33);const _0x14630d={'gatewayPaymentId':_0x148c33};loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x209)](_0x24846c(0x1f3),_0x24846c(0x20c),_0x24846c(0x1b9),_0x14630d);const _0x27bdc5=await fetch(this[_0x24846c(0x1ae)],{'method':'POST','headers':{'Content-Type':_0x24846c(0x21b),'Accept':_0x24846c(0x21b),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x14630d)}),_0x3715a2=Date[_0x24846c(0x1ad)]()-_0x4ca8e4;console[_0x24846c(0x208)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x24846c(0x208)](_0x24846c(0x1ce),_0x27bdc5[_0x24846c(0x20f)]),console[_0x24846c(0x208)](_0x24846c(0x215),_0x3715a2+'ms');if(!_0x27bdc5['ok']){const _0x251ddc=await _0x27bdc5[_0x24846c(0x1f5)]();console[_0x24846c(0x205)](_0x24846c(0x1e4),_0x27bdc5['status']),console['error'](_0x24846c(0x227),_0x251ddc),loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x21e)](_0x24846c(0x1f3),_0x24846c(0x20c),_0x27bdc5['status'],_0x251ddc,_0x3715a2),loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x1d9)](_0x24846c(0x1f3),'/status',_0x24846c(0x1fa)+_0x27bdc5[_0x24846c(0x20f)]+':\x20'+_0x251ddc);throw new Error('HTTP\x20error!\x20status:\x20'+_0x27bdc5[_0x24846c(0x20f)]);}const _0x859225=await _0x27bdc5[_0x24846c(0x1f5)]();console[_0x24846c(0x208)](_0x24846c(0x214),_0x859225);let _0x40076a;try{_0x40076a=JSON[_0x24846c(0x1b2)](_0x859225);}catch(_0x2ba945){console[_0x24846c(0x205)](_0x24846c(0x20d),_0x2ba945),loggerService_1['loggerService'][_0x24846c(0x1d9)]('cointopay',_0x24846c(0x20c),_0x24846c(0x207)+_0x2ba945);throw new Error(_0x24846c(0x22b)+_0x859225);}loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x21e)](_0x24846c(0x1f3),_0x24846c(0x20c),_0x27bdc5[_0x24846c(0x20f)],_0x40076a,_0x3715a2),console['log'](_0x24846c(0x1b6)),console[_0x24846c(0x208)](_0x24846c(0x1c8),_0x40076a[_0x24846c(0x1ea)]),console[_0x24846c(0x208)](_0x24846c(0x218),_0x40076a['status_code']),console[_0x24846c(0x208)]('Payment\x20Status:',_0x40076a[_0x24846c(0x22e)]?.[_0x24846c(0x212)]),console[_0x24846c(0x208)](_0x24846c(0x221),_0x40076a['data']?.[_0x24846c(0x1da)]),console[_0x24846c(0x208)](_0x24846c(0x1b7),_0x40076a[_0x24846c(0x22e)]?.[_0x24846c(0x201)]);if(_0x40076a[_0x24846c(0x1ea)]!=='success'||_0x40076a[_0x24846c(0x1f4)]!==0xc8){const _0x4d3c56=_0x40076a[_0x24846c(0x21a)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x24846c(0x205)](_0x24846c(0x1d7)),console[_0x24846c(0x205)]('Error\x20Message:',_0x4d3c56),loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x1d9)](_0x24846c(0x1f3),_0x24846c(0x20c),'Status\x20API\x20Error:\x20'+_0x4d3c56);throw new Error(_0x24846c(0x1f8)+_0x4d3c56);}if(!_0x40076a[_0x24846c(0x22e)]){console[_0x24846c(0x205)](_0x24846c(0x22d)),console['error'](_0x24846c(0x1f0)),loggerService_1[_0x24846c(0x1fe)]['logWhiteDomainError'](_0x24846c(0x1f3),_0x24846c(0x20c),_0x24846c(0x1b4));throw new Error(_0x24846c(0x1e6));}let _0x41317f='PENDING';switch(_0x40076a[_0x24846c(0x22e)]['Status']?.[_0x24846c(0x206)]()){case _0x24846c(0x1d0):_0x41317f=_0x24846c(0x20b);break;case'cancelled':case'failed':case _0x24846c(0x205):_0x41317f=_0x24846c(0x1e2);break;case _0x24846c(0x1d8):case'timeout':_0x41317f=_0x24846c(0x1d4);break;case'waiting':case _0x24846c(0x1e7):case _0x24846c(0x22c):case _0x24846c(0x1bf):default:_0x41317f=_0x24846c(0x22f);break;}let _0x3dfd39,_0x12e3b7;if(_0x40076a[_0x24846c(0x22e)]['PaymentDetail']){const _0x3e11c5=_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1ba)];console[_0x24846c(0x208)]('üè¶\x20Payment\x20Detail:',_0x3e11c5);const _0x20900d=_0x3e11c5[_0x24846c(0x1fd)](/IBAN\s+([A-Z0-9]+)/i);_0x20900d&&(_0x3dfd39=_0x20900d[0x1],console[_0x24846c(0x208)](_0x24846c(0x230),_0x3dfd39)),_0x12e3b7=_0x3e11c5;}const _0x17458f={'iban':_0x3dfd39,'bankDetails':_0x12e3b7,'transactionId':_0x40076a['data']['TransactionID'],'coinAddress':_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1d2)],'qrCodeUrl':_0x40076a[_0x24846c(0x22e)]['QRCodeURL'],'expiryTime':_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1c9)],'createdOn':_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1d1)],'confirmedOn':_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1c7)]};console[_0x24846c(0x208)](_0x24846c(0x211)),console['log'](_0x24846c(0x1ce),_0x40076a['data'][_0x24846c(0x212)],'->',_0x41317f),console['log'](_0x24846c(0x221),_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1da)],_0x40076a[_0x24846c(0x22e)][_0x24846c(0x201)]),console[_0x24846c(0x208)]('Transaction\x20ID:',_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1cf)]),console[_0x24846c(0x208)](_0x24846c(0x203),_0x3dfd39||_0x24846c(0x1e1)),console[_0x24846c(0x208)](_0x24846c(0x1f2),_0x40076a['data'][_0x24846c(0x1d1)]),console[_0x24846c(0x208)](_0x24846c(0x202),_0x40076a[_0x24846c(0x22e)][_0x24846c(0x1c7)]||_0x24846c(0x21c));if(_0x40076a[_0x24846c(0x22e)][_0x24846c(0x212)]?.[_0x24846c(0x206)]()===_0x24846c(0x1e7))console[_0x24846c(0x208)](_0x24846c(0x1f9));else _0x40076a[_0x24846c(0x22e)]['Status']?.['toLowerCase']()===_0x24846c(0x1d0)&&console[_0x24846c(0x208)](_0x24846c(0x1d5));return{'status':_0x41317f,'amount':parseFloat(_0x40076a['data'][_0x24846c(0x1da)])||undefined,'currency':_0x40076a[_0x24846c(0x22e)][_0x24846c(0x201)]||_0x24846c(0x228),'paymentDetails':_0x17458f};}catch(_0x54b238){console[_0x24846c(0x205)](_0x24846c(0x1be),_0x54b238),loggerService_1[_0x24846c(0x1fe)][_0x24846c(0x1d9)](_0x24846c(0x1f3),_0x24846c(0x20c),_0x54b238);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x54b238 instanceof Error?_0x54b238['message']:_0x24846c(0x1fc)));}}async['verifyPayment'](_0x263fdf){const _0xd26eac=a41_0x51b7a9,_0x3e87e6=await this[_0xd26eac(0x1ac)](_0x263fdf);return{'status':_0x3e87e6['status'],'amount':_0x3e87e6[_0xd26eac(0x1ed)],'currency':_0x3e87e6[_0xd26eac(0x1b8)]};}async['processWebhook'](_0x44b6bb){const _0x283c84=a41_0x51b7a9;console[_0x283c84(0x208)](_0x283c84(0x21d),_0x44b6bb);let _0x3b03ec=_0x283c84(0x22f);switch(_0x44b6bb[_0x283c84(0x20f)]?.['toLowerCase']()){case _0x283c84(0x1d0):_0x3b03ec='PAID';break;case'cancelled':case _0x283c84(0x1b1):case'error':_0x3b03ec=_0x283c84(0x1e2);break;case'expired':case'timeout':_0x3b03ec='EXPIRED';break;case _0x283c84(0x22c):case _0x283c84(0x1ec):case'awaiting\x20fiat':case _0x283c84(0x1bf):default:_0x3b03ec='PENDING';break;}return{'paymentId':_0x44b6bb[_0x283c84(0x1c5)]||_0x44b6bb[_0x283c84(0x1cb)]||'','status':_0x3b03ec,'amount':_0x44b6bb[_0x283c84(0x1ed)],'currency':_0x44b6bb[_0x283c84(0x1b8)]||_0x283c84(0x228)};}}exports['CoinToPayService']=CoinToPayService;