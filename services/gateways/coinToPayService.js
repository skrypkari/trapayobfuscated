'use strict';const a43_0x45a1c7=a43_0x4e41;(function(_0x1a00a9,_0x3dd67d){const _0x4848d0=a43_0x4e41,_0xccd4be=_0x1a00a9();while(!![]){try{const _0x54cb6f=parseInt(_0x4848d0(0x81))/0x1*(parseInt(_0x4848d0(0xaa))/0x2)+parseInt(_0x4848d0(0x98))/0x3*(-parseInt(_0x4848d0(0xc5))/0x4)+parseInt(_0x4848d0(0xab))/0x5+parseInt(_0x4848d0(0x87))/0x6*(-parseInt(_0x4848d0(0xe2))/0x7)+-parseInt(_0x4848d0(0xa8))/0x8+-parseInt(_0x4848d0(0xd5))/0x9+parseInt(_0x4848d0(0xc4))/0xa;if(_0x54cb6f===_0x3dd67d)break;else _0xccd4be['push'](_0xccd4be['shift']());}catch(_0x1b35d5){_0xccd4be['push'](_0xccd4be['shift']());}}}(a43_0xd1be,0x28246));Object['defineProperty'](exports,a43_0x45a1c7(0xad),{'value':!![]}),exports[a43_0x45a1c7(0x7f)]=void 0x0;const loggerService_1=require(a43_0x45a1c7(0xc9));function a43_0xd1be(){const _0xa1f2c4=['https://tesoft.uk/gateway/cointopay/status.php','data','Amount:','logWhiteDomainResponse','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','TesSoft\x20Payment\x20System/1.0','now','currency','üè¶\x20Payment\x20Detail:','506597yVMcOD','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','amount',',\x20body:\x20','status','üè¶\x20Extracted\x20IBAN:','waiting','PENDING','EUR','Error\x20message:','message','/create','Response\x20Body:','coinAddress','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Incomplete\x20response:\x20missing\x20data','Created\x20On:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','failed','HTTP\x20Status:','Status:','Error\x20stack:','ExpiryTime','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','QRCodeURL','awaiting\x20fiat','TransactionConfirmedOn','CoinToPayService','success','18532jwvcOj','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Parsed\x20Result:','POST','toLowerCase','stringify','12FnzSDB','/status','not\x20confirmed','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','fromEntries','stack','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','loggerService','Result:','HTTP\x20','statusUrl','FAILED','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','EXPIRED','match','created','3PABNOJ','cointopay','gateway_payment_id','Business\x20Error:\x20','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','merchant_reference_id','PAID','IBAN:','apiUrl','entries','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','statusText','expired','Confirmed\x20On:','Status','107416GJnfyP','cancelled','10oPypfs','469780iozuHr','üìä\x20Status\x20check\x20URL:','__esModule','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','timeout','checkPaymentStatus','payment_url','Response\x20data:','result','https://tesoft.uk/gateway/cointopay/','Failed\x20to\x20parse\x20JSON\x20response:','verifyPayment','inputCurrency','application/json','text','paid','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','logWhiteDomainError','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','order_id','status_code','CoinToPay\x20API\x20error:\x20','Status\x20Text:','PaymentDetail','error','4723610PfLfXk','443616AzvdOA','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Gateway\x20Payment\x20ID:','../loggerService','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20API\x20ERROR\x20===','Payment\x20Status:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Amount','logWhiteDomainRequest','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','\x20EUR','pending','Response\x20Time:','CoinToPay\x20status\x20API\x20error:\x20','2029338YVUbQO','log','Raw\x20Response\x20Body:','CreatedOn'];a43_0xd1be=function(){return _0xa1f2c4;};return a43_0xd1be();}function a43_0x4e41(_0x15c80f,_0x1fc5bf){const _0xd1bed5=a43_0xd1be();return a43_0x4e41=function(_0x4e41e2,_0x262be0){_0x4e41e2=_0x4e41e2-0x6d;let _0x441ea5=_0xd1bed5[_0x4e41e2];return _0x441ea5;},a43_0x4e41(_0x15c80f,_0x1fc5bf);}class CoinToPayService{constructor(){const _0x4d12e8=a43_0x45a1c7;this['apiUrl']=_0x4d12e8(0xb4),this['statusUrl']=_0x4d12e8(0xd9),console[_0x4d12e8(0xd6)](_0x4d12e8(0xe3)),console[_0x4d12e8(0xd6)](_0x4d12e8(0xac),this[_0x4d12e8(0x91)]);}async['createPaymentLink'](_0x428448){const _0x2ea5f1=a43_0x45a1c7,{orderId:_0x14008f,amount:_0x2c93be}=_0x428448;console[_0x2ea5f1(0xd6)](_0x2ea5f1(0x94)+_0x2c93be+_0x2ea5f1(0xd1));const _0x4ab0e9={'amount':_0x2c93be},_0x2f1919=Date[_0x2ea5f1(0xdf)]();try{console[_0x2ea5f1(0xd6)](_0x2ea5f1(0x8d)),console[_0x2ea5f1(0xd6)]('URL:',this[_0x2ea5f1(0xa1)]),console[_0x2ea5f1(0xd6)]('Request\x20Body:',JSON[_0x2ea5f1(0x86)](_0x4ab0e9,null,0x2)),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0xdb),_0x2c93be,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xcf)](_0x2ea5f1(0x99),_0x2ea5f1(0xed),_0x2ea5f1(0x84),_0x4ab0e9);const _0x5aa382=await fetch(this['apiUrl'],{'method':_0x2ea5f1(0x84),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x2ea5f1(0xde)},'body':JSON['stringify'](_0x4ab0e9)}),_0x740ef6=Date['now']()-_0x2f1919;console[_0x2ea5f1(0xd6)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0x78),_0x5aa382[_0x2ea5f1(0xe6)]),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0xc1),_0x5aa382[_0x2ea5f1(0xa4)]),console['log']('Headers:',Object[_0x2ea5f1(0x8b)](_0x5aa382['headers'][_0x2ea5f1(0xa2)]())),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0xd3),_0x740ef6+'ms');const _0x2ef48e=await _0x5aa382[_0x2ea5f1(0xb9)]();console[_0x2ea5f1(0xd6)](_0x2ea5f1(0xd7),_0x2ef48e);if(!_0x5aa382['ok']){console[_0x2ea5f1(0xc3)](_0x2ea5f1(0xcb)),console[_0x2ea5f1(0xc3)](_0x2ea5f1(0x77),_0x5aa382[_0x2ea5f1(0xe6)]),console[_0x2ea5f1(0xc3)](_0x2ea5f1(0x6d),_0x2ef48e),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xdc)]('cointopay',_0x2ea5f1(0xed),_0x5aa382[_0x2ea5f1(0xe6)],_0x2ef48e,_0x740ef6),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xbc)](_0x2ea5f1(0x99),_0x2ea5f1(0xed),'HTTP\x20'+_0x5aa382[_0x2ea5f1(0xe6)]+':\x20'+_0x2ef48e);throw new Error(_0x2ea5f1(0xc6)+_0x5aa382['status']+_0x2ea5f1(0xe5)+_0x2ef48e);}let _0x5deba5;try{_0x5deba5=JSON[_0x2ea5f1(0x9c)](_0x2ef48e);}catch(_0x28d41c){console[_0x2ea5f1(0xc3)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x28d41c),loggerService_1[_0x2ea5f1(0x8e)]['logWhiteDomainError'](_0x2ea5f1(0x99),'/create',_0x2ea5f1(0x74)+_0x28d41c);throw new Error(_0x2ea5f1(0x72)+_0x2ef48e);}console[_0x2ea5f1(0xd6)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0x83),JSON[_0x2ea5f1(0x86)](_0x5deba5,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x2ea5f1(0x99),_0x2ea5f1(0xed),_0x5aa382[_0x2ea5f1(0xe6)],_0x5deba5,_0x740ef6);if(_0x5deba5[_0x2ea5f1(0xc3)]){const _0x14d1d0=_0x5deba5['message']||_0x5deba5[_0x2ea5f1(0xc3)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x2ea5f1(0xc3)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x14d1d0),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xbc)](_0x2ea5f1(0x99),'/create',_0x2ea5f1(0x9b)+_0x14d1d0);throw new Error(_0x2ea5f1(0xc0)+_0x14d1d0);}if(!_0x5deba5[_0x2ea5f1(0xb1)]||!_0x5deba5['gateway_payment_id']){console['error'](_0x2ea5f1(0x93)),console[_0x2ea5f1(0xc3)](_0x2ea5f1(0xd0)),console[_0x2ea5f1(0xc3)](_0x2ea5f1(0xb2),_0x5deba5),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xbc)]('cointopay',_0x2ea5f1(0xed),_0x2ea5f1(0xcd));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x2ea5f1(0xd6)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x2ea5f1(0xd6)](_0x2ea5f1(0xc8),_0x5deba5[_0x2ea5f1(0x9a)]),console[_0x2ea5f1(0xd6)]('Payment\x20URL:',_0x5deba5[_0x2ea5f1(0xb1)]),console[_0x2ea5f1(0xd6)]('Amount:',_0x2c93be,_0x2ea5f1(0xea)),{'gateway_payment_id':_0x5deba5[_0x2ea5f1(0x9a)],'payment_url':_0x5deba5[_0x2ea5f1(0xb1)]};}catch(_0x1d0fce){console[_0x2ea5f1(0xc3)](_0x2ea5f1(0x8a)),console[_0x2ea5f1(0xc3)]('Error\x20details:',_0x1d0fce),loggerService_1[_0x2ea5f1(0x8e)][_0x2ea5f1(0xbc)](_0x2ea5f1(0x99),_0x2ea5f1(0xed),_0x1d0fce);if(_0x1d0fce instanceof Error){console['error'](_0x2ea5f1(0xeb),_0x1d0fce[_0x2ea5f1(0xec)]),console[_0x2ea5f1(0xc3)](_0x2ea5f1(0x79),_0x1d0fce[_0x2ea5f1(0x8c)]);throw new Error(_0x2ea5f1(0xbd)+_0x1d0fce[_0x2ea5f1(0xec)]);}throw new Error(_0x2ea5f1(0x9d));}}async[a43_0x45a1c7(0xb0)](_0x13cdaa){const _0x51c604=a43_0x45a1c7,_0x544ccd=Date[_0x51c604(0xdf)]();try{console['log'](_0x51c604(0x6f)+_0x13cdaa);const _0x2a1c3c={'gatewayPaymentId':_0x13cdaa};loggerService_1[_0x51c604(0x8e)][_0x51c604(0xcf)](_0x51c604(0x99),'/status','POST',_0x2a1c3c);const _0x2e6c4a=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x51c604(0xb8),'Accept':_0x51c604(0xb8),'User-Agent':_0x51c604(0xde)},'body':JSON[_0x51c604(0x86)](_0x2a1c3c)}),_0x81a5d8=Date[_0x51c604(0xdf)]()-_0x544ccd;console['log'](_0x51c604(0x75)),console[_0x51c604(0xd6)]('Status:',_0x2e6c4a[_0x51c604(0xe6)]),console[_0x51c604(0xd6)](_0x51c604(0xd3),_0x81a5d8+'ms');if(!_0x2e6c4a['ok']){const _0x3b80c5=await _0x2e6c4a[_0x51c604(0xb9)]();console[_0x51c604(0xc3)]('HTTP\x20Status:',_0x2e6c4a[_0x51c604(0xe6)]),console['error'](_0x51c604(0x6d),_0x3b80c5),loggerService_1['loggerService'][_0x51c604(0xdc)](_0x51c604(0x99),_0x51c604(0x88),_0x2e6c4a[_0x51c604(0xe6)],_0x3b80c5,_0x81a5d8),loggerService_1[_0x51c604(0x8e)][_0x51c604(0xbc)]('cointopay',_0x51c604(0x88),_0x51c604(0x90)+_0x2e6c4a[_0x51c604(0xe6)]+':\x20'+_0x3b80c5);throw new Error(_0x51c604(0xc6)+_0x2e6c4a[_0x51c604(0xe6)]);}const _0x5586c2=await _0x2e6c4a[_0x51c604(0xb9)]();console[_0x51c604(0xd6)](_0x51c604(0xd7),_0x5586c2);let _0x72eeed;try{_0x72eeed=JSON[_0x51c604(0x9c)](_0x5586c2);}catch(_0x374d30){console[_0x51c604(0xc3)](_0x51c604(0xb5),_0x374d30),loggerService_1['loggerService'][_0x51c604(0xbc)](_0x51c604(0x99),'/status',_0x51c604(0x74)+_0x374d30);throw new Error(_0x51c604(0x7b)+_0x5586c2);}loggerService_1[_0x51c604(0x8e)]['logWhiteDomainResponse'](_0x51c604(0x99),_0x51c604(0x88),_0x2e6c4a[_0x51c604(0xe6)],_0x72eeed,_0x81a5d8),console[_0x51c604(0xd6)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x51c604(0xd6)](_0x51c604(0x8f),_0x72eeed[_0x51c604(0xb3)]),console[_0x51c604(0xd6)]('Status\x20Code:',_0x72eeed[_0x51c604(0xbf)]),console['log'](_0x51c604(0xcc),_0x72eeed['data']?.[_0x51c604(0xa7)]),console['log']('Amount:',_0x72eeed[_0x51c604(0xda)]?.['Amount']),console[_0x51c604(0xd6)]('Currency:',_0x72eeed[_0x51c604(0xda)]?.[_0x51c604(0xb7)]);if(_0x72eeed[_0x51c604(0xb3)]!==_0x51c604(0x80)||_0x72eeed[_0x51c604(0xbf)]!==0xc8){const _0x35a1ee=_0x72eeed['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x51c604(0xc3)](_0x51c604(0xbb)),console['error']('Error\x20Message:',_0x35a1ee),loggerService_1['loggerService'][_0x51c604(0xbc)]('cointopay',_0x51c604(0x88),'Status\x20API\x20Error:\x20'+_0x35a1ee);throw new Error(_0x51c604(0xd4)+_0x35a1ee);}if(!_0x72eeed['data']){console[_0x51c604(0xc3)](_0x51c604(0xae)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x51c604(0x8e)][_0x51c604(0xbc)]('cointopay',_0x51c604(0x88),_0x51c604(0x70));throw new Error(_0x51c604(0xdd));}let _0x440703=_0x51c604(0xe9);switch(_0x72eeed[_0x51c604(0xda)]['Status']?.[_0x51c604(0x85)]()){case _0x51c604(0xba):_0x440703=_0x51c604(0x9f);break;case _0x51c604(0xa9):case _0x51c604(0x76):case _0x51c604(0xc3):_0x440703=_0x51c604(0x92);break;case _0x51c604(0xa5):case _0x51c604(0xaf):_0x440703=_0x51c604(0x95);break;case _0x51c604(0xe8):case _0x51c604(0x7d):case _0x51c604(0xd2):case _0x51c604(0x97):default:_0x440703=_0x51c604(0xe9);break;}let _0x41df37,_0x1bdb59;if(_0x72eeed[_0x51c604(0xda)][_0x51c604(0xc2)]){const _0x5d32f6=_0x72eeed[_0x51c604(0xda)]['PaymentDetail'];console[_0x51c604(0xd6)](_0x51c604(0xe1),_0x5d32f6);const _0x59a8a2=_0x5d32f6[_0x51c604(0x96)](/IBAN\s+([A-Z0-9]+)/i);_0x59a8a2&&(_0x41df37=_0x59a8a2[0x1],console['log'](_0x51c604(0xe7),_0x41df37)),_0x1bdb59=_0x5d32f6;}const _0x16412e={'iban':_0x41df37,'bankDetails':_0x1bdb59,'transactionId':_0x72eeed['data']['TransactionID'],'coinAddress':_0x72eeed[_0x51c604(0xda)][_0x51c604(0x6e)],'qrCodeUrl':_0x72eeed[_0x51c604(0xda)][_0x51c604(0x7c)],'expiryTime':_0x72eeed[_0x51c604(0xda)][_0x51c604(0x7a)],'createdOn':_0x72eeed[_0x51c604(0xda)][_0x51c604(0xd8)],'confirmedOn':_0x72eeed['data'][_0x51c604(0x7e)]};console[_0x51c604(0xd6)](_0x51c604(0xc7)),console['log'](_0x51c604(0x78),_0x72eeed[_0x51c604(0xda)]['Status'],'->',_0x440703),console[_0x51c604(0xd6)](_0x51c604(0xdb),_0x72eeed['data'][_0x51c604(0xce)],_0x72eeed[_0x51c604(0xda)][_0x51c604(0xb7)]),console[_0x51c604(0xd6)]('Transaction\x20ID:',_0x72eeed[_0x51c604(0xda)]['TransactionID']),console[_0x51c604(0xd6)](_0x51c604(0xa0),_0x41df37||'not\x20found'),console[_0x51c604(0xd6)](_0x51c604(0x71),_0x72eeed[_0x51c604(0xda)]['CreatedOn']),console[_0x51c604(0xd6)](_0x51c604(0xa6),_0x72eeed[_0x51c604(0xda)][_0x51c604(0x7e)]||_0x51c604(0x89));if(_0x72eeed[_0x51c604(0xda)][_0x51c604(0xa7)]?.[_0x51c604(0x85)]()===_0x51c604(0x7d))console[_0x51c604(0xd6)](_0x51c604(0xca));else _0x72eeed['data'][_0x51c604(0xa7)]?.[_0x51c604(0x85)]()===_0x51c604(0xba)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x440703,'amount':parseFloat(_0x72eeed[_0x51c604(0xda)][_0x51c604(0xce)])||undefined,'currency':_0x72eeed['data'][_0x51c604(0xb7)]||'EUR','paymentDetails':_0x16412e};}catch(_0x48cda8){console[_0x51c604(0xc3)](_0x51c604(0x73),_0x48cda8),loggerService_1['loggerService']['logWhiteDomainError'](_0x51c604(0x99),_0x51c604(0x88),_0x48cda8);throw new Error(_0x51c604(0xa3)+(_0x48cda8 instanceof Error?_0x48cda8[_0x51c604(0xec)]:'Unknown\x20error'));}}async[a43_0x45a1c7(0xb6)](_0x2c171f){const _0x3baf14=a43_0x45a1c7,_0x42cf74=await this['checkPaymentStatus'](_0x2c171f);return{'status':_0x42cf74['status'],'amount':_0x42cf74[_0x3baf14(0xe4)],'currency':_0x42cf74[_0x3baf14(0xe0)]};}async['processWebhook'](_0x4708e7){const _0x54101f=a43_0x45a1c7;console[_0x54101f(0xd6)](_0x54101f(0x82),_0x4708e7);let _0xb49636='PENDING';switch(_0x4708e7[_0x54101f(0xe6)]?.[_0x54101f(0x85)]()){case _0x54101f(0xba):_0xb49636=_0x54101f(0x9f);break;case _0x54101f(0xa9):case'failed':case _0x54101f(0xc3):_0xb49636=_0x54101f(0x92);break;case _0x54101f(0xa5):case'timeout':_0xb49636=_0x54101f(0x95);break;case _0x54101f(0xd2):case _0x54101f(0xe8):case _0x54101f(0x7d):case _0x54101f(0x97):default:_0xb49636=_0x54101f(0xe9);break;}return{'paymentId':_0x4708e7[_0x54101f(0xbe)]||_0x4708e7[_0x54101f(0x9e)]||'','status':_0xb49636,'amount':_0x4708e7[_0x54101f(0xe4)],'currency':_0x4708e7[_0x54101f(0xe0)]||_0x54101f(0xea)};}}exports['CoinToPayService']=CoinToPayService;