'use strict';const a43_0xf2badb=a43_0x24e7;(function(_0xba9a88,_0x1317c0){const _0x2f536d=a43_0x24e7,_0x287d02=_0xba9a88();while(!![]){try{const _0xe12c6a=-parseInt(_0x2f536d(0x173))/0x1*(parseInt(_0x2f536d(0x18b))/0x2)+-parseInt(_0x2f536d(0x1b1))/0x3+parseInt(_0x2f536d(0x182))/0x4+-parseInt(_0x2f536d(0x1c9))/0x5*(parseInt(_0x2f536d(0x1b6))/0x6)+parseInt(_0x2f536d(0x1ad))/0x7+-parseInt(_0x2f536d(0x1a0))/0x8*(parseInt(_0x2f536d(0x168))/0x9)+-parseInt(_0x2f536d(0x17c))/0xa*(-parseInt(_0x2f536d(0x194))/0xb);if(_0xe12c6a===_0x1317c0)break;else _0x287d02['push'](_0x287d02['shift']());}catch(_0xaf5edc){_0x287d02['push'](_0x287d02['shift']());}}}(a43_0x5a17,0xd482c));function a43_0x5a17(){const _0x238a02=['TransactionConfirmedOn','EXPIRED','HTTP\x20error!\x20status:\x20','../loggerService','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/cointopay/','https://tesoft.uk/gateway/cointopay/status.php','Response\x20Time:','inputCurrency','CoinToPay\x20status\x20API\x20error:\x20','not\x20found','Raw\x20Response\x20Body:','stack','waiting','Headers:','TesSoft\x20Payment\x20System/1.0','Missing\x20data\x20in\x20response','log','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','timeout','cointopay','__esModule','logWhiteDomainError','63hwigwT','createPaymentLink','status_code','amount','Unknown\x20error','PAID','now','Response\x20Body:','awaiting\x20fiat','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','QRCodeURL','53757syYFdr','Payment\x20Status:','result','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','error','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Status:','===\x20COINTOPAY\x20SUCCESS\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','8579540vobhZM','ExpiryTime','FAILED','Status\x20API\x20Error:\x20','CreatedOn','data','852872gZjZYl','merchant_reference_id','parse','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','entries','loggerService','statusUrl','Status','fromEntries','36DCiyWv','created','stringify','Error\x20message:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','toLowerCase','text','URL:','Currency:','44EETtTJ','PaymentDetail',',\x20body:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','currency','Error\x20Message:','apiUrl','headers','Error\x20details:','JSON\x20Parse\x20Error:\x20','Parsed\x20Result:','CoinToPay\x20payment\x20status\x20check\x20error:','1330328WpZCRq','order_id','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Confirmed\x20On:','success','logWhiteDomainRequest','\x20EUR','PENDING','checkPaymentStatus','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','application/json','statusText','üè¶\x20Extracted\x20IBAN:','7788655FGzyEf','logWhiteDomainResponse','expired','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','151443tFIjPB','Payment\x20URL:','verifyPayment','Amount','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','6eboepR','failed','POST','Result:','EUR','Status\x20Text:','Gateway\x20Payment\x20ID:','gateway_payment_id','message','üè¶\x20Payment\x20Detail:','Request\x20Body:','not\x20confirmed','Amount:','IBAN:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20stack:','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20ERROR\x20===','status','8525555djPFVF','/create','üìä\x20Status\x20check\x20URL:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','payment_url','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','coinAddress','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Business\x20Error:\x20','/status','cancelled','HTTP\x20','paid','HTTP\x20Status:','TransactionID'];a43_0x5a17=function(){return _0x238a02;};return a43_0x5a17();}function a43_0x24e7(_0x25e83a,_0x41c860){const _0x5a17e5=a43_0x5a17();return a43_0x24e7=function(_0x24e7b9,_0x17cd36){_0x24e7b9=_0x24e7b9-0x141;let _0x486e4a=_0x5a17e5[_0x24e7b9];return _0x486e4a;},a43_0x24e7(_0x25e83a,_0x41c860);}Object['defineProperty'](exports,a43_0xf2badb(0x166),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a43_0xf2badb(0x154));class CoinToPayService{constructor(){const _0x2465fb=a43_0xf2badb;this['apiUrl']=_0x2465fb(0x156),this[_0x2465fb(0x188)]=_0x2465fb(0x157),console[_0x2465fb(0x162)](_0x2465fb(0x155)),console[_0x2465fb(0x162)](_0x2465fb(0x142),this[_0x2465fb(0x188)]);}async[a43_0xf2badb(0x169)](_0x3bb645){const _0x41ed3e=a43_0xf2badb,{orderId:_0x51f826,amount:_0x353d37}=_0x3bb645;console['log'](_0x41ed3e(0x18f)+_0x353d37+_0x41ed3e(0x1a6));const _0x4226f7={'amount':_0x353d37},_0x1347e5=Date[_0x41ed3e(0x16e)]();try{console['log'](_0x41ed3e(0x1c4)),console[_0x41ed3e(0x162)](_0x41ed3e(0x192),this[_0x41ed3e(0x19a)]),console['log'](_0x41ed3e(0x1c0),JSON[_0x41ed3e(0x18d)](_0x4226f7,null,0x2)),console[_0x41ed3e(0x162)](_0x41ed3e(0x1c2),_0x353d37,_0x41ed3e(0x148)),loggerService_1[_0x41ed3e(0x187)]['logWhiteDomainRequest'](_0x41ed3e(0x165),'/create',_0x41ed3e(0x1b8),_0x4226f7);const _0x2aadae=await fetch(this[_0x41ed3e(0x19a)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x41ed3e(0x1aa),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x41ed3e(0x18d)](_0x4226f7)}),_0x59e16f=Date['now']()-_0x1347e5;console[_0x41ed3e(0x162)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x41ed3e(0x162)](_0x41ed3e(0x179),_0x2aadae['status']),console[_0x41ed3e(0x162)](_0x41ed3e(0x1bb),_0x2aadae[_0x41ed3e(0x1ab)]),console[_0x41ed3e(0x162)](_0x41ed3e(0x15f),Object[_0x41ed3e(0x18a)](_0x2aadae[_0x41ed3e(0x19b)][_0x41ed3e(0x186)]())),console[_0x41ed3e(0x162)](_0x41ed3e(0x158),_0x59e16f+'ms');const _0x2939b7=await _0x2aadae[_0x41ed3e(0x191)]();console[_0x41ed3e(0x162)](_0x41ed3e(0x15c),_0x2939b7);if(!_0x2aadae['ok']){console[_0x41ed3e(0x177)](_0x41ed3e(0x1c7)),console[_0x41ed3e(0x177)](_0x41ed3e(0x14f),_0x2aadae[_0x41ed3e(0x1c8)]),console[_0x41ed3e(0x177)](_0x41ed3e(0x16f),_0x2939b7),loggerService_1[_0x41ed3e(0x187)][_0x41ed3e(0x1ae)](_0x41ed3e(0x165),_0x41ed3e(0x141),_0x2aadae[_0x41ed3e(0x1c8)],_0x2939b7,_0x59e16f),loggerService_1[_0x41ed3e(0x187)]['logWhiteDomainError'](_0x41ed3e(0x165),_0x41ed3e(0x141),_0x41ed3e(0x14d)+_0x2aadae[_0x41ed3e(0x1c8)]+':\x20'+_0x2939b7);throw new Error(_0x41ed3e(0x153)+_0x2aadae['status']+_0x41ed3e(0x196)+_0x2939b7);}let _0x27c313;try{_0x27c313=JSON[_0x41ed3e(0x184)](_0x2939b7);}catch(_0x442cc4){console['error'](_0x41ed3e(0x1c6),_0x442cc4),loggerService_1[_0x41ed3e(0x187)][_0x41ed3e(0x167)](_0x41ed3e(0x165),_0x41ed3e(0x141),_0x41ed3e(0x19d)+_0x442cc4);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x2939b7);}console[_0x41ed3e(0x162)](_0x41ed3e(0x1b5)),console[_0x41ed3e(0x162)](_0x41ed3e(0x19e),JSON[_0x41ed3e(0x18d)](_0x27c313,null,0x2)),loggerService_1['loggerService'][_0x41ed3e(0x1ae)]('cointopay',_0x41ed3e(0x141),_0x2aadae[_0x41ed3e(0x1c8)],_0x27c313,_0x59e16f);if(_0x27c313[_0x41ed3e(0x177)]){const _0x57f8bb=_0x27c313[_0x41ed3e(0x1be)]||_0x27c313['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x41ed3e(0x177)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x41ed3e(0x177)]('Error\x20Message:',_0x57f8bb),loggerService_1[_0x41ed3e(0x187)][_0x41ed3e(0x167)](_0x41ed3e(0x165),_0x41ed3e(0x141),_0x41ed3e(0x14a)+_0x57f8bb);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x57f8bb);}if(!_0x27c313[_0x41ed3e(0x144)]||!_0x27c313[_0x41ed3e(0x1bd)]){console[_0x41ed3e(0x177)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x41ed3e(0x177)](_0x41ed3e(0x171)),console[_0x41ed3e(0x177)]('Response\x20data:',_0x27c313),loggerService_1[_0x41ed3e(0x187)]['logWhiteDomainError']('cointopay',_0x41ed3e(0x141),_0x41ed3e(0x17b));throw new Error(_0x41ed3e(0x197));}return console[_0x41ed3e(0x162)](_0x41ed3e(0x17a)),console['log'](_0x41ed3e(0x1bc),_0x27c313[_0x41ed3e(0x1bd)]),console[_0x41ed3e(0x162)](_0x41ed3e(0x1b2),_0x27c313[_0x41ed3e(0x144)]),console[_0x41ed3e(0x162)](_0x41ed3e(0x1c2),_0x353d37,'EUR'),{'gateway_payment_id':_0x27c313[_0x41ed3e(0x1bd)],'payment_url':_0x27c313['payment_url']};}catch(_0xf7023b){console[_0x41ed3e(0x177)](_0x41ed3e(0x185)),console[_0x41ed3e(0x177)](_0x41ed3e(0x19c),_0xf7023b),loggerService_1['loggerService'][_0x41ed3e(0x167)](_0x41ed3e(0x165),_0x41ed3e(0x141),_0xf7023b);if(_0xf7023b instanceof Error){console[_0x41ed3e(0x177)](_0x41ed3e(0x18e),_0xf7023b[_0x41ed3e(0x1be)]),console['error'](_0x41ed3e(0x1c5),_0xf7023b[_0x41ed3e(0x15d)]);throw new Error(_0x41ed3e(0x178)+_0xf7023b['message']);}throw new Error(_0x41ed3e(0x143));}}async[a43_0xf2badb(0x1a8)](_0x316c46){const _0xe86fad=a43_0xf2badb,_0x1888f0=Date[_0xe86fad(0x16e)]();try{console['log'](_0xe86fad(0x145)+_0x316c46);const _0x388867={'gatewayPaymentId':_0x316c46};loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x1a5)](_0xe86fad(0x165),_0xe86fad(0x14b),_0xe86fad(0x1b8),_0x388867);const _0x12849c=await fetch(this[_0xe86fad(0x188)],{'method':_0xe86fad(0x1b8),'headers':{'Content-Type':'application/json','Accept':_0xe86fad(0x1aa),'User-Agent':_0xe86fad(0x160)},'body':JSON[_0xe86fad(0x18d)](_0x388867)}),_0x46182a=Date['now']()-_0x1888f0;console[_0xe86fad(0x162)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xe86fad(0x162)](_0xe86fad(0x179),_0x12849c[_0xe86fad(0x1c8)]),console['log'](_0xe86fad(0x158),_0x46182a+'ms');if(!_0x12849c['ok']){const _0x4960c4=await _0x12849c[_0xe86fad(0x191)]();console[_0xe86fad(0x177)]('HTTP\x20Status:',_0x12849c[_0xe86fad(0x1c8)]),console[_0xe86fad(0x177)]('Response\x20Body:',_0x4960c4),loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x1ae)](_0xe86fad(0x165),_0xe86fad(0x14b),_0x12849c[_0xe86fad(0x1c8)],_0x4960c4,_0x46182a),loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x167)](_0xe86fad(0x165),_0xe86fad(0x14b),_0xe86fad(0x14d)+_0x12849c[_0xe86fad(0x1c8)]+':\x20'+_0x4960c4);throw new Error(_0xe86fad(0x153)+_0x12849c[_0xe86fad(0x1c8)]);}const _0xc7aaa5=await _0x12849c['text']();console[_0xe86fad(0x162)](_0xe86fad(0x15c),_0xc7aaa5);let _0x2358bf;try{_0x2358bf=JSON[_0xe86fad(0x184)](_0xc7aaa5);}catch(_0x987860){console['error'](_0xe86fad(0x1c6),_0x987860),loggerService_1['loggerService'][_0xe86fad(0x167)](_0xe86fad(0x165),_0xe86fad(0x14b),_0xe86fad(0x19d)+_0x987860);throw new Error(_0xe86fad(0x1a9)+_0xc7aaa5);}loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x1ae)]('cointopay',_0xe86fad(0x14b),_0x12849c[_0xe86fad(0x1c8)],_0x2358bf,_0x46182a),console[_0xe86fad(0x162)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0xe86fad(0x162)](_0xe86fad(0x1b9),_0x2358bf[_0xe86fad(0x175)]),console[_0xe86fad(0x162)]('Status\x20Code:',_0x2358bf[_0xe86fad(0x16a)]),console[_0xe86fad(0x162)](_0xe86fad(0x174),_0x2358bf[_0xe86fad(0x181)]?.['Status']),console[_0xe86fad(0x162)]('Amount:',_0x2358bf[_0xe86fad(0x181)]?.[_0xe86fad(0x1b4)]),console[_0xe86fad(0x162)](_0xe86fad(0x193),_0x2358bf[_0xe86fad(0x181)]?.[_0xe86fad(0x159)]);if(_0x2358bf[_0xe86fad(0x175)]!==_0xe86fad(0x1a4)||_0x2358bf[_0xe86fad(0x16a)]!==0xc8){const _0x34e25e=_0x2358bf['message']||_0xe86fad(0x163);console[_0xe86fad(0x177)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0xe86fad(0x177)](_0xe86fad(0x199),_0x34e25e),loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x167)]('cointopay',_0xe86fad(0x14b),_0xe86fad(0x17f)+_0x34e25e);throw new Error(_0xe86fad(0x15a)+_0x34e25e);}if(!_0x2358bf['data']){console[_0xe86fad(0x177)](_0xe86fad(0x149)),console['error'](_0xe86fad(0x161)),loggerService_1[_0xe86fad(0x187)][_0xe86fad(0x167)](_0xe86fad(0x165),_0xe86fad(0x14b),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0xe86fad(0x147));}let _0x4cfa5a=_0xe86fad(0x1a7);switch(_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x189)]?.['toLowerCase']()){case _0xe86fad(0x14e):_0x4cfa5a='PAID';break;case _0xe86fad(0x14c):case _0xe86fad(0x1b7):case _0xe86fad(0x177):_0x4cfa5a='FAILED';break;case _0xe86fad(0x1af):case _0xe86fad(0x164):_0x4cfa5a=_0xe86fad(0x152);break;case _0xe86fad(0x15e):case'awaiting\x20fiat':case'pending':case _0xe86fad(0x18c):default:_0x4cfa5a=_0xe86fad(0x1a7);break;}let _0x2c15a5,_0x1769cf;if(_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x195)]){const _0x3d3b4c=_0x2358bf['data']['PaymentDetail'];console[_0xe86fad(0x162)](_0xe86fad(0x1bf),_0x3d3b4c);const _0x21de11=_0x3d3b4c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x21de11&&(_0x2c15a5=_0x21de11[0x1],console[_0xe86fad(0x162)](_0xe86fad(0x1ac),_0x2c15a5)),_0x1769cf=_0x3d3b4c;}const _0x1e13f2={'iban':_0x2c15a5,'bankDetails':_0x1769cf,'transactionId':_0x2358bf[_0xe86fad(0x181)]['TransactionID'],'coinAddress':_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x146)],'qrCodeUrl':_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x172)],'expiryTime':_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x17d)],'createdOn':_0x2358bf[_0xe86fad(0x181)]['CreatedOn'],'confirmedOn':_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x151)]};console[_0xe86fad(0x162)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0xe86fad(0x162)](_0xe86fad(0x179),_0x2358bf['data'][_0xe86fad(0x189)],'->',_0x4cfa5a),console['log'](_0xe86fad(0x1c2),_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x1b4)],_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x159)]),console[_0xe86fad(0x162)]('Transaction\x20ID:',_0x2358bf['data'][_0xe86fad(0x150)]),console['log'](_0xe86fad(0x1c3),_0x2c15a5||_0xe86fad(0x15b)),console[_0xe86fad(0x162)]('Created\x20On:',_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x180)]),console[_0xe86fad(0x162)](_0xe86fad(0x1a3),_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x151)]||_0xe86fad(0x1c1));if(_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x189)]?.['toLowerCase']()===_0xe86fad(0x170))console[_0xe86fad(0x162)](_0xe86fad(0x1a2));else _0x2358bf[_0xe86fad(0x181)]['Status']?.['toLowerCase']()===_0xe86fad(0x14e)&&console[_0xe86fad(0x162)](_0xe86fad(0x176));return{'status':_0x4cfa5a,'amount':parseFloat(_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x1b4)])||undefined,'currency':_0x2358bf[_0xe86fad(0x181)][_0xe86fad(0x159)]||_0xe86fad(0x1ba),'paymentDetails':_0x1e13f2};}catch(_0x42cbfc){console[_0xe86fad(0x177)](_0xe86fad(0x19f),_0x42cbfc),loggerService_1[_0xe86fad(0x187)]['logWhiteDomainError'](_0xe86fad(0x165),_0xe86fad(0x14b),_0x42cbfc);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x42cbfc instanceof Error?_0x42cbfc[_0xe86fad(0x1be)]:_0xe86fad(0x16c)));}}async[a43_0xf2badb(0x1b3)](_0x96f5ad){const _0x43e048=a43_0xf2badb,_0x425fe0=await this[_0x43e048(0x1a8)](_0x96f5ad);return{'status':_0x425fe0['status'],'amount':_0x425fe0['amount'],'currency':_0x425fe0[_0x43e048(0x198)]};}async['processWebhook'](_0x5959f8){const _0x57d751=a43_0xf2badb;console[_0x57d751(0x162)](_0x57d751(0x1b0),_0x5959f8);let _0x300d73=_0x57d751(0x1a7);switch(_0x5959f8['status']?.[_0x57d751(0x190)]()){case'paid':_0x300d73=_0x57d751(0x16d);break;case _0x57d751(0x14c):case _0x57d751(0x1b7):case _0x57d751(0x177):_0x300d73=_0x57d751(0x17e);break;case'expired':case _0x57d751(0x164):_0x300d73=_0x57d751(0x152);break;case'pending':case'waiting':case _0x57d751(0x170):case'created':default:_0x300d73=_0x57d751(0x1a7);break;}return{'paymentId':_0x5959f8[_0x57d751(0x1a1)]||_0x5959f8[_0x57d751(0x183)]||'','status':_0x300d73,'amount':_0x5959f8[_0x57d751(0x16b)],'currency':_0x5959f8[_0x57d751(0x198)]||_0x57d751(0x1ba)};}}exports['CoinToPayService']=CoinToPayService;