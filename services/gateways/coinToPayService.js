'use strict';const a40_0x4da03b=a40_0x3c45;(function(_0x1239f3,_0x20ccaf){const _0x46d5d6=a40_0x3c45,_0x13e4af=_0x1239f3();while(!![]){try{const _0x1e7e6c=-parseInt(_0x46d5d6(0x15e))/0x1+parseInt(_0x46d5d6(0x1a1))/0x2+parseInt(_0x46d5d6(0x17a))/0x3+parseInt(_0x46d5d6(0x18d))/0x4+-parseInt(_0x46d5d6(0x185))/0x5*(parseInt(_0x46d5d6(0x186))/0x6)+parseInt(_0x46d5d6(0x16b))/0x7*(parseInt(_0x46d5d6(0x168))/0x8)+-parseInt(_0x46d5d6(0x1a5))/0x9*(parseInt(_0x46d5d6(0x167))/0xa);if(_0x1e7e6c===_0x20ccaf)break;else _0x13e4af['push'](_0x13e4af['shift']());}catch(_0x230b8b){_0x13e4af['push'](_0x13e4af['shift']());}}}(a40_0xdef0,0x5dd4e));function a40_0x3c45(_0x257389,_0x403709){const _0xdef084=a40_0xdef0();return a40_0x3c45=function(_0x3c4560,_0x3cf68f){_0x3c4560=_0x3c4560-0x13b;let _0x45fb47=_0xdef084[_0x3c4560];return _0x45fb47;},a40_0x3c45(_0x257389,_0x403709);}Object[a40_0x4da03b(0x153)](exports,a40_0x4da03b(0x15a),{'value':!![]}),exports[a40_0x4da03b(0x176)]=void 0x0;const loggerService_1=require(a40_0x4da03b(0x155));class CoinToPayService{constructor(){const _0xdcf73d=a40_0x4da03b;this[_0xdcf73d(0x144)]='https://tesoft.uk/gateway/cointopay/',this[_0xdcf73d(0x165)]=_0xdcf73d(0x16d),console['log'](_0xdcf73d(0x1b2)),console['log']('📊\x20Status\x20check\x20URL:',this[_0xdcf73d(0x165)]);}async['createPaymentLink'](_0x212921){const _0x14961a=a40_0x4da03b,{orderId:_0x557b98,amount:_0x1eae54}=_0x212921;console[_0x14961a(0x14b)](_0x14961a(0x17f)+_0x1eae54+'\x20EUR');const _0x1a1302={'amount':_0x1eae54},_0x5daefb=Date['now']();try{console['log'](_0x14961a(0x19e)),console[_0x14961a(0x14b)]('URL:',this[_0x14961a(0x144)]),console[_0x14961a(0x14b)]('Request\x20Body:',JSON[_0x14961a(0x1b1)](_0x1a1302,null,0x2)),console['log'](_0x14961a(0x14d),_0x1eae54,_0x14961a(0x1ab)),loggerService_1[_0x14961a(0x1b0)][_0x14961a(0x195)](_0x14961a(0x15c),'/create',_0x14961a(0x1ae),_0x1a1302);const _0x46c97d=await fetch(this[_0x14961a(0x144)],{'method':_0x14961a(0x1ae),'headers':{'Content-Type':_0x14961a(0x187),'Accept':_0x14961a(0x187),'User-Agent':_0x14961a(0x1a4)},'body':JSON[_0x14961a(0x1b1)](_0x1a1302)}),_0x200e80=Date['now']()-_0x5daefb;console[_0x14961a(0x14b)](_0x14961a(0x178)),console[_0x14961a(0x14b)](_0x14961a(0x162),_0x46c97d[_0x14961a(0x171)]),console[_0x14961a(0x14b)](_0x14961a(0x13c),_0x46c97d[_0x14961a(0x149)]),console['log']('Headers:',Object[_0x14961a(0x189)](_0x46c97d[_0x14961a(0x1b5)][_0x14961a(0x16c)]())),console[_0x14961a(0x14b)](_0x14961a(0x18f),_0x200e80+'ms');const _0x2b89a8=await _0x46c97d[_0x14961a(0x19a)]();console[_0x14961a(0x14b)](_0x14961a(0x1c0),_0x2b89a8);if(!_0x46c97d['ok']){console[_0x14961a(0x192)](_0x14961a(0x1a0)),console['error'](_0x14961a(0x169),_0x46c97d[_0x14961a(0x171)]),console['error']('Response\x20Body:',_0x2b89a8),loggerService_1[_0x14961a(0x1b0)][_0x14961a(0x14e)](_0x14961a(0x15c),'/create',_0x46c97d['status'],_0x2b89a8,_0x200e80),loggerService_1[_0x14961a(0x1b0)]['logWhiteDomainError']('cointopay',_0x14961a(0x180),'HTTP\x20'+_0x46c97d[_0x14961a(0x171)]+':\x20'+_0x2b89a8);throw new Error('HTTP\x20error!\x20status:\x20'+_0x46c97d[_0x14961a(0x171)]+_0x14961a(0x1ad)+_0x2b89a8);}let _0x2e89c2;try{_0x2e89c2=JSON[_0x14961a(0x1c1)](_0x2b89a8);}catch(_0x232285){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x232285),loggerService_1['loggerService'][_0x14961a(0x175)](_0x14961a(0x15c),_0x14961a(0x180),_0x14961a(0x197)+_0x232285);throw new Error(_0x14961a(0x13d)+_0x2b89a8);}console[_0x14961a(0x14b)](_0x14961a(0x141)),console['log'](_0x14961a(0x1b3),JSON[_0x14961a(0x1b1)](_0x2e89c2,null,0x2)),loggerService_1[_0x14961a(0x1b0)]['logWhiteDomainResponse'](_0x14961a(0x15c),_0x14961a(0x180),_0x46c97d[_0x14961a(0x171)],_0x2e89c2,_0x200e80);if(_0x2e89c2[_0x14961a(0x192)]){const _0x3c9a7a=_0x2e89c2[_0x14961a(0x143)]||_0x2e89c2[_0x14961a(0x192)]||_0x14961a(0x140);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x14961a(0x1bf),_0x3c9a7a),loggerService_1[_0x14961a(0x1b0)]['logWhiteDomainError']('cointopay',_0x14961a(0x180),_0x14961a(0x19d)+_0x3c9a7a);throw new Error(_0x14961a(0x157)+_0x3c9a7a);}if(!_0x2e89c2[_0x14961a(0x13e)]||!_0x2e89c2[_0x14961a(0x15f)]){console[_0x14961a(0x192)](_0x14961a(0x1b8)),console[_0x14961a(0x192)](_0x14961a(0x146)),console[_0x14961a(0x192)](_0x14961a(0x161),_0x2e89c2),loggerService_1[_0x14961a(0x1b0)][_0x14961a(0x175)]('cointopay',_0x14961a(0x180),_0x14961a(0x19b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console['log'](_0x14961a(0x150)),console[_0x14961a(0x14b)](_0x14961a(0x1a9),_0x2e89c2[_0x14961a(0x15f)]),console['log'](_0x14961a(0x193),_0x2e89c2[_0x14961a(0x13e)]),console[_0x14961a(0x14b)](_0x14961a(0x14d),_0x1eae54,_0x14961a(0x15d)),{'gateway_payment_id':_0x2e89c2[_0x14961a(0x15f)],'payment_url':_0x2e89c2['payment_url']};}catch(_0x401069){console['error'](_0x14961a(0x174)),console[_0x14961a(0x192)](_0x14961a(0x148),_0x401069),loggerService_1['loggerService']['logWhiteDomainError'](_0x14961a(0x15c),_0x14961a(0x180),_0x401069);if(_0x401069 instanceof Error){console[_0x14961a(0x192)](_0x14961a(0x1b9),_0x401069[_0x14961a(0x143)]),console[_0x14961a(0x192)](_0x14961a(0x147),_0x401069[_0x14961a(0x158)]);throw new Error(_0x14961a(0x1c2)+_0x401069[_0x14961a(0x143)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x192bdd){const _0x2043d8=a40_0x4da03b,_0x44db5b=Date[_0x2043d8(0x145)]();try{console[_0x2043d8(0x14b)](_0x2043d8(0x1ba)+_0x192bdd);const _0x4926bd={'gatewayPaymentId':_0x192bdd};loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x195)](_0x2043d8(0x15c),'/status',_0x2043d8(0x1ae),_0x4926bd);const _0x40c37d=await fetch(this[_0x2043d8(0x165)],{'method':'POST','headers':{'Content-Type':_0x2043d8(0x187),'Accept':_0x2043d8(0x187),'User-Agent':_0x2043d8(0x1a4)},'body':JSON[_0x2043d8(0x1b1)](_0x4926bd)}),_0x5a8203=Date['now']()-_0x44db5b;console['log'](_0x2043d8(0x156)),console[_0x2043d8(0x14b)](_0x2043d8(0x162),_0x40c37d['status']),console['log'](_0x2043d8(0x18f),_0x5a8203+'ms');if(!_0x40c37d['ok']){const _0x5b5562=await _0x40c37d[_0x2043d8(0x19a)]();console[_0x2043d8(0x192)](_0x2043d8(0x169),_0x40c37d[_0x2043d8(0x171)]),console[_0x2043d8(0x192)](_0x2043d8(0x1ac),_0x5b5562),loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x14e)](_0x2043d8(0x15c),_0x2043d8(0x1af),_0x40c37d[_0x2043d8(0x171)],_0x5b5562,_0x5a8203),loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x175)](_0x2043d8(0x15c),_0x2043d8(0x1af),_0x2043d8(0x1b7)+_0x40c37d[_0x2043d8(0x171)]+':\x20'+_0x5b5562);throw new Error(_0x2043d8(0x199)+_0x40c37d[_0x2043d8(0x171)]);}const _0x597b11=await _0x40c37d[_0x2043d8(0x19a)]();console[_0x2043d8(0x14b)](_0x2043d8(0x1c0),_0x597b11);let _0x38e30d;try{_0x38e30d=JSON[_0x2043d8(0x1c1)](_0x597b11);}catch(_0x8f6b1f){console[_0x2043d8(0x192)](_0x2043d8(0x154),_0x8f6b1f),loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x175)](_0x2043d8(0x15c),_0x2043d8(0x1af),_0x2043d8(0x197)+_0x8f6b1f);throw new Error(_0x2043d8(0x152)+_0x597b11);}loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x14e)](_0x2043d8(0x15c),_0x2043d8(0x1af),_0x40c37d[_0x2043d8(0x171)],_0x38e30d,_0x5a8203),console[_0x2043d8(0x14b)](_0x2043d8(0x1bb)),console[_0x2043d8(0x14b)]('Result:',_0x38e30d[_0x2043d8(0x14c)]),console[_0x2043d8(0x14b)]('Status\x20Code:',_0x38e30d['status_code']),console[_0x2043d8(0x14b)](_0x2043d8(0x164),_0x38e30d[_0x2043d8(0x1b4)]?.[_0x2043d8(0x151)]),console[_0x2043d8(0x14b)]('Amount:',_0x38e30d[_0x2043d8(0x1b4)]?.['Amount']),console['log'](_0x2043d8(0x18e),_0x38e30d[_0x2043d8(0x1b4)]?.[_0x2043d8(0x188)]);if(_0x38e30d['result']!==_0x2043d8(0x166)||_0x38e30d[_0x2043d8(0x1c4)]!==0xc8){const _0x5e78ca=_0x38e30d[_0x2043d8(0x143)]||_0x2043d8(0x160);console[_0x2043d8(0x192)](_0x2043d8(0x173)),console['error']('Error\x20Message:',_0x5e78ca),loggerService_1['loggerService'][_0x2043d8(0x175)]('cointopay','/status',_0x2043d8(0x1b6)+_0x5e78ca);throw new Error(_0x2043d8(0x14a)+_0x5e78ca);}if(!_0x38e30d[_0x2043d8(0x1b4)]){console[_0x2043d8(0x192)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x2043d8(0x192)](_0x2043d8(0x172)),loggerService_1[_0x2043d8(0x1b0)]['logWhiteDomainError']('cointopay','/status',_0x2043d8(0x17d));throw new Error(_0x2043d8(0x17e));}let _0x350f5f=_0x2043d8(0x170);switch(_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x151)]?.[_0x2043d8(0x1be)]()){case'paid':_0x350f5f=_0x2043d8(0x184);break;case _0x2043d8(0x18b):case _0x2043d8(0x16e):case _0x2043d8(0x192):_0x350f5f=_0x2043d8(0x1c3);break;case _0x2043d8(0x1aa):case _0x2043d8(0x16f):_0x350f5f=_0x2043d8(0x196);break;case'waiting':case _0x2043d8(0x14f):case'pending':case _0x2043d8(0x182):default:_0x350f5f='PENDING';break;}let _0x5ea4a9,_0x54c44c;if(_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x198)]){const _0x1b15c3=_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x198)];console[_0x2043d8(0x14b)](_0x2043d8(0x15b),_0x1b15c3);const _0x3d838a=_0x1b15c3['match'](/IBAN\s+([A-Z0-9]+)/i);_0x3d838a&&(_0x5ea4a9=_0x3d838a[0x1],console['log'](_0x2043d8(0x177),_0x5ea4a9)),_0x54c44c=_0x1b15c3;}const _0x783094={'iban':_0x5ea4a9,'bankDetails':_0x54c44c,'transactionId':_0x38e30d[_0x2043d8(0x1b4)]['TransactionID'],'coinAddress':_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x159)],'qrCodeUrl':_0x38e30d['data']['QRCodeURL'],'expiryTime':_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x190)],'createdOn':_0x38e30d['data'][_0x2043d8(0x17b)],'confirmedOn':_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x13f)]};console[_0x2043d8(0x14b)](_0x2043d8(0x183)),console[_0x2043d8(0x14b)](_0x2043d8(0x162),_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x151)],'->',_0x350f5f),console[_0x2043d8(0x14b)](_0x2043d8(0x14d),_0x38e30d[_0x2043d8(0x1b4)]['Amount'],_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x188)]),console[_0x2043d8(0x14b)](_0x2043d8(0x163),_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x17c)]),console[_0x2043d8(0x14b)](_0x2043d8(0x18c),_0x5ea4a9||_0x2043d8(0x1bc)),console[_0x2043d8(0x14b)](_0x2043d8(0x19c),_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x17b)]),console[_0x2043d8(0x14b)]('Confirmed\x20On:',_0x38e30d['data'][_0x2043d8(0x13f)]||_0x2043d8(0x13b));if(_0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x151)]?.[_0x2043d8(0x1be)]()===_0x2043d8(0x14f))console[_0x2043d8(0x14b)](_0x2043d8(0x1a3));else _0x38e30d[_0x2043d8(0x1b4)][_0x2043d8(0x151)]?.[_0x2043d8(0x1be)]()===_0x2043d8(0x142)&&console[_0x2043d8(0x14b)](_0x2043d8(0x191));return{'status':_0x350f5f,'amount':parseFloat(_0x38e30d['data'][_0x2043d8(0x1a8)])||undefined,'currency':_0x38e30d[_0x2043d8(0x1b4)]['inputCurrency']||'EUR','paymentDetails':_0x783094};}catch(_0x455192){console[_0x2043d8(0x192)](_0x2043d8(0x194),_0x455192),loggerService_1[_0x2043d8(0x1b0)][_0x2043d8(0x175)](_0x2043d8(0x15c),_0x2043d8(0x1af),_0x455192);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x455192 instanceof Error?_0x455192['message']:_0x2043d8(0x1bd)));}}async['verifyPayment'](_0x23be11){const _0x48c689=a40_0x4da03b,_0x245bc9=await this['checkPaymentStatus'](_0x23be11);return{'status':_0x245bc9[_0x48c689(0x171)],'amount':_0x245bc9[_0x48c689(0x16a)],'currency':_0x245bc9[_0x48c689(0x179)]};}async[a40_0x4da03b(0x181)](_0x3cb9ec){const _0x28f9e0=a40_0x4da03b;console[_0x28f9e0(0x14b)](_0x28f9e0(0x19f),_0x3cb9ec);let _0x435ae4=_0x28f9e0(0x170);switch(_0x3cb9ec[_0x28f9e0(0x171)]?.[_0x28f9e0(0x1be)]()){case _0x28f9e0(0x142):_0x435ae4='PAID';break;case _0x28f9e0(0x18b):case _0x28f9e0(0x16e):case _0x28f9e0(0x192):_0x435ae4='FAILED';break;case _0x28f9e0(0x1aa):case _0x28f9e0(0x16f):_0x435ae4='EXPIRED';break;case _0x28f9e0(0x1a6):case _0x28f9e0(0x1a7):case _0x28f9e0(0x14f):case _0x28f9e0(0x182):default:_0x435ae4=_0x28f9e0(0x170);break;}return{'paymentId':_0x3cb9ec[_0x28f9e0(0x18a)]||_0x3cb9ec[_0x28f9e0(0x1a2)]||'','status':_0x435ae4,'amount':_0x3cb9ec[_0x28f9e0(0x16a)],'currency':_0x3cb9ec['currency']||_0x28f9e0(0x15d)};}}function a40_0xdef0(){const _0x551958=['inputCurrency','fromEntries','order_id','cancelled','IBAN:','2222536snfDPP','Currency:','Response\x20Time:','ExpiryTime','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','error','Payment\x20URL:','CoinToPay\x20payment\x20status\x20check\x20error:','logWhiteDomainRequest','EXPIRED','JSON\x20Parse\x20Error:\x20','PaymentDetail','HTTP\x20error!\x20status:\x20','text','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Created\x20On:','Business\x20Error:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20API\x20ERROR\x20===','1016222rCgsqB','merchant_reference_id','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TesSoft\x20Payment\x20System/1.0','2439uTVrfq','pending','waiting','Amount','Gateway\x20Payment\x20ID:','expired','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20Body:',',\x20body:\x20','POST','/status','loggerService','stringify','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Parsed\x20Result:','data','headers','Status\x20API\x20Error:\x20','HTTP\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20message:','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','not\x20found','Unknown\x20error','toLowerCase','Error\x20Message:','Raw\x20Response\x20Body:','parse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','FAILED','status_code','not\x20confirmed','Status\x20Text:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','payment_url','TransactionConfirmedOn','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','paid','message','apiUrl','now','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Error\x20stack:','Error\x20details:','statusText','CoinToPay\x20status\x20API\x20error:\x20','log','result','Amount:','logWhiteDomainResponse','awaiting\x20fiat','===\x20COINTOPAY\x20SUCCESS\x20===','Status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','defineProperty','Failed\x20to\x20parse\x20JSON\x20response:','../loggerService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay\x20API\x20error:\x20','stack','coinAddress','__esModule','🏦\x20Payment\x20Detail:','cointopay','EUR','660929sXIaDC','gateway_payment_id','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Response\x20data:','Status:','Transaction\x20ID:','Payment\x20Status:','statusUrl','success','15670LMJdQn','1140848DesDQI','HTTP\x20Status:','amount','7mesInT','entries','https://tesoft.uk/gateway/cointopay/status.php','failed','timeout','PENDING','status','Missing\x20data\x20in\x20response','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainError','CoinToPayService','🏦\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','currency','1404501cfzvBq','CreatedOn','TransactionID','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','🪙\x20Creating\x20CoinToPay\x20payment:\x20','/create','processWebhook','created','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','PAID','511495dFchVq','12ZjPZRF','application/json'];a40_0xdef0=function(){return _0x551958;};return a40_0xdef0();}exports[a40_0x4da03b(0x176)]=CoinToPayService;