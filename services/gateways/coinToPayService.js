'use strict';const a38_0x249958=a38_0x5e4a;(function(_0x2331f6,_0x5955c9){const _0x186190=a38_0x5e4a,_0x3a45b0=_0x2331f6();while(!![]){try{const _0x349dc1=parseInt(_0x186190(0x144))/0x1*(-parseInt(_0x186190(0x187))/0x2)+parseInt(_0x186190(0x19b))/0x3+-parseInt(_0x186190(0x1a2))/0x4+parseInt(_0x186190(0x1aa))/0x5+parseInt(_0x186190(0x19c))/0x6+-parseInt(_0x186190(0x17b))/0x7+-parseInt(_0x186190(0x159))/0x8*(-parseInt(_0x186190(0x136))/0x9);if(_0x349dc1===_0x5955c9)break;else _0x3a45b0['push'](_0x3a45b0['shift']());}catch(_0x4549e5){_0x3a45b0['push'](_0x3a45b0['shift']());}}}(a38_0xee7c,0x7179a));function a38_0xee7c(){const _0x1f9721=['stringify','Unknown\x20error\x20from\x20CoinToPay\x20API','statusUrl','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','order_id','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','status_code','logWhiteDomainError','merchant_reference_id','Payment\x20Status:','pending','text','EUR','Failed\x20to\x20parse\x20JSON\x20response:','POST','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','309218YLaFwu','statusText','log','expired','Status:','Created\x20On:','/create','error','created','toLowerCase','defineProperty','CoinToPay\x20payment\x20status\x20check\x20error:','52HGKJEl','../loggerService','inputCurrency','Status','Amount','Error\x20Message:','TransactionID','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','EXPIRED','Currency:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','headers','Parsed\x20Result:','Payment\x20URL:','üìä\x20Status\x20check\x20URL:','QRCodeURL','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','payment_url','822879MOSXlU','2036808fglsFf','ExpiryTime','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','not\x20confirmed','awaiting\x20fiat','/status','1049304MBcswA','HTTP\x20Status:','https://tesoft.uk/gateway/cointopay/status.php','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CreatedOn','logWhiteDomainResponse','logWhiteDomainRequest','checkPaymentStatus','400950DUNhHD','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','currency','FAILED','not\x20found','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Raw\x20Response\x20Body:','waiting','JSON\x20Parse\x20Error:\x20','11889HwLBxJ','application/json','timeout','Amount:','gateway_payment_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','createPaymentLink','Incomplete\x20response:\x20missing\x20data','result','failed','HTTP\x20','success','match','TesSoft\x20Payment\x20System/1.0','3173xOVSXc','now','üè¶\x20Extracted\x20IBAN:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','loggerService',',\x20body:\x20','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','status','Response\x20Time:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','parse','paid','Missing\x20data\x20in\x20response','Status\x20API\x20Error:\x20','Unknown\x20error','PENDING','PAID','===\x20COINTOPAY\x20API\x20ERROR\x20===','Request\x20Body:','cancelled','968dAilwh','apiUrl','data','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','__esModule','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','message','verifyPayment','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Response\x20Body:','Status\x20Code:','amount','cointopay','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','\x20EUR','Gateway\x20Payment\x20ID:','processWebhook'];a38_0xee7c=function(){return _0x1f9721;};return a38_0xee7c();}Object[a38_0x249958(0x185)](exports,a38_0x249958(0x15e),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a38_0x249958(0x188));class CoinToPayService{constructor(){const _0x5eb844=a38_0x249958;this[_0x5eb844(0x15a)]='https://tesoft.uk/gateway/cointopay/',this[_0x5eb844(0x16d)]=_0x5eb844(0x1a4),console[_0x5eb844(0x17d)](_0x5eb844(0x147)),console[_0x5eb844(0x17d)](_0x5eb844(0x195),this[_0x5eb844(0x16d)]);}async[a38_0x249958(0x13c)](_0x378913){const _0x3dacc1=a38_0x249958,{orderId:_0x28da75,amount:_0xceff14}=_0x378913;console[_0x3dacc1(0x17d)](_0x3dacc1(0x191)+_0xceff14+_0x3dacc1(0x168));const _0x223f18={'amount':_0xceff14},_0x5283fe=Date[_0x3dacc1(0x145)]();try{console[_0x3dacc1(0x17d)](_0x3dacc1(0x18e)),console[_0x3dacc1(0x17d)]('URL:',this[_0x3dacc1(0x15a)]),console[_0x3dacc1(0x17d)](_0x3dacc1(0x157),JSON[_0x3dacc1(0x16b)](_0x223f18,null,0x2)),console['log']('Amount:',_0xceff14,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x3dacc1(0x148)]['logWhiteDomainRequest']('cointopay',_0x3dacc1(0x181),_0x3dacc1(0x179),_0x223f18);const _0x1a14bd=await fetch(this[_0x3dacc1(0x15a)],{'method':_0x3dacc1(0x179),'headers':{'Content-Type':'application/json','Accept':_0x3dacc1(0x137),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3dacc1(0x16b)](_0x223f18)}),_0x167d04=Date[_0x3dacc1(0x145)]()-_0x5283fe;console['log'](_0x3dacc1(0x14b)),console['log'](_0x3dacc1(0x17f),_0x1a14bd[_0x3dacc1(0x14c)]),console[_0x3dacc1(0x17d)]('Status\x20Text:',_0x1a14bd[_0x3dacc1(0x17c)]),console[_0x3dacc1(0x17d)]('Headers:',Object['fromEntries'](_0x1a14bd[_0x3dacc1(0x192)]['entries']())),console['log'](_0x3dacc1(0x14d),_0x167d04+'ms');const _0x3a9bf7=await _0x1a14bd[_0x3dacc1(0x176)]();console[_0x3dacc1(0x17d)](_0x3dacc1(0x1b0),_0x3a9bf7);if(!_0x1a14bd['ok']){console[_0x3dacc1(0x182)](_0x3dacc1(0x156)),console['error'](_0x3dacc1(0x1a3),_0x1a14bd['status']),console[_0x3dacc1(0x182)]('Response\x20Body:',_0x3a9bf7),loggerService_1['loggerService'][_0x3dacc1(0x1a7)](_0x3dacc1(0x166),'/create',_0x1a14bd[_0x3dacc1(0x14c)],_0x3a9bf7,_0x167d04),loggerService_1[_0x3dacc1(0x148)]['logWhiteDomainError'](_0x3dacc1(0x166),_0x3dacc1(0x181),_0x3dacc1(0x140)+_0x1a14bd[_0x3dacc1(0x14c)]+':\x20'+_0x3a9bf7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x1a14bd[_0x3dacc1(0x14c)]+_0x3dacc1(0x149)+_0x3a9bf7);}let _0x9b001e;try{_0x9b001e=JSON[_0x3dacc1(0x14f)](_0x3a9bf7);}catch(_0x5d6417){console['error'](_0x3dacc1(0x178),_0x5d6417),loggerService_1['loggerService'][_0x3dacc1(0x172)](_0x3dacc1(0x166),_0x3dacc1(0x181),_0x3dacc1(0x1b2)+_0x5d6417);throw new Error(_0x3dacc1(0x167)+_0x3a9bf7);}console[_0x3dacc1(0x17d)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x3dacc1(0x17d)](_0x3dacc1(0x193),JSON[_0x3dacc1(0x16b)](_0x9b001e,null,0x2)),loggerService_1[_0x3dacc1(0x148)][_0x3dacc1(0x1a7)](_0x3dacc1(0x166),_0x3dacc1(0x181),_0x1a14bd[_0x3dacc1(0x14c)],_0x9b001e,_0x167d04);if(_0x9b001e['error']){const _0x368cbf=_0x9b001e['message']||_0x9b001e[_0x3dacc1(0x182)]||_0x3dacc1(0x16c);console[_0x3dacc1(0x182)](_0x3dacc1(0x197)),console['error'](_0x3dacc1(0x18c),_0x368cbf),loggerService_1['loggerService'][_0x3dacc1(0x172)](_0x3dacc1(0x166),_0x3dacc1(0x181),'Business\x20Error:\x20'+_0x368cbf);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x368cbf);}if(!_0x9b001e[_0x3dacc1(0x19a)]||!_0x9b001e[_0x3dacc1(0x13a)]){console['error'](_0x3dacc1(0x15c)),console[_0x3dacc1(0x182)](_0x3dacc1(0x199)),console[_0x3dacc1(0x182)]('Response\x20data:',_0x9b001e),loggerService_1[_0x3dacc1(0x148)]['logWhiteDomainError'](_0x3dacc1(0x166),_0x3dacc1(0x181),_0x3dacc1(0x15d));throw new Error(_0x3dacc1(0x1ab));}return console[_0x3dacc1(0x17d)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x3dacc1(0x17d)](_0x3dacc1(0x169),_0x9b001e['gateway_payment_id']),console[_0x3dacc1(0x17d)](_0x3dacc1(0x194),_0x9b001e[_0x3dacc1(0x19a)]),console['log']('Amount:',_0xceff14,_0x3dacc1(0x177)),{'gateway_payment_id':_0x9b001e[_0x3dacc1(0x13a)],'payment_url':_0x9b001e[_0x3dacc1(0x19a)]};}catch(_0x303270){console[_0x3dacc1(0x182)](_0x3dacc1(0x17a)),console[_0x3dacc1(0x182)]('Error\x20details:',_0x303270),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x3dacc1(0x181),_0x303270);if(_0x303270 instanceof Error){console[_0x3dacc1(0x182)]('Error\x20message:',_0x303270[_0x3dacc1(0x160)]),console[_0x3dacc1(0x182)]('Error\x20stack:',_0x303270['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x303270[_0x3dacc1(0x160)]);}throw new Error(_0x3dacc1(0x198));}}async['checkPaymentStatus'](_0x122ce5){const _0xa02d5f=a38_0x249958,_0xe0421b=Date[_0xa02d5f(0x145)]();try{console[_0xa02d5f(0x17d)](_0xa02d5f(0x15f)+_0x122ce5);const _0x5e956f={'gatewayPaymentId':_0x122ce5};loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x1a8)](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0xa02d5f(0x179),_0x5e956f);const _0x197b9e=await fetch(this[_0xa02d5f(0x16d)],{'method':_0xa02d5f(0x179),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0xa02d5f(0x143)},'body':JSON[_0xa02d5f(0x16b)](_0x5e956f)}),_0x358d49=Date[_0xa02d5f(0x145)]()-_0xe0421b;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xa02d5f(0x17d)](_0xa02d5f(0x17f),_0x197b9e[_0xa02d5f(0x14c)]),console[_0xa02d5f(0x17d)]('Response\x20Time:',_0x358d49+'ms');if(!_0x197b9e['ok']){const _0x354341=await _0x197b9e[_0xa02d5f(0x176)]();console[_0xa02d5f(0x182)]('HTTP\x20Status:',_0x197b9e[_0xa02d5f(0x14c)]),console['error'](_0xa02d5f(0x163),_0x354341),loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x1a7)](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0x197b9e[_0xa02d5f(0x14c)],_0x354341,_0x358d49),loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x172)](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0xa02d5f(0x140)+_0x197b9e['status']+':\x20'+_0x354341);throw new Error(_0xa02d5f(0x14a)+_0x197b9e[_0xa02d5f(0x14c)]);}const _0x1efcc6=await _0x197b9e[_0xa02d5f(0x176)]();console['log'](_0xa02d5f(0x1b0),_0x1efcc6);let _0x28ea53;try{_0x28ea53=JSON['parse'](_0x1efcc6);}catch(_0x177476){console[_0xa02d5f(0x182)](_0xa02d5f(0x178),_0x177476),loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x172)](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0xa02d5f(0x1b2)+_0x177476);throw new Error(_0xa02d5f(0x162)+_0x1efcc6);}loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x1a7)](_0xa02d5f(0x166),'/status',_0x197b9e[_0xa02d5f(0x14c)],_0x28ea53,_0x358d49),console[_0xa02d5f(0x17d)](_0xa02d5f(0x14e)),console[_0xa02d5f(0x17d)]('Result:',_0x28ea53[_0xa02d5f(0x13e)]),console[_0xa02d5f(0x17d)](_0xa02d5f(0x164),_0x28ea53[_0xa02d5f(0x171)]),console[_0xa02d5f(0x17d)](_0xa02d5f(0x174),_0x28ea53[_0xa02d5f(0x15b)]?.[_0xa02d5f(0x18a)]),console[_0xa02d5f(0x17d)](_0xa02d5f(0x139),_0x28ea53['data']?.[_0xa02d5f(0x18b)]),console[_0xa02d5f(0x17d)](_0xa02d5f(0x190),_0x28ea53[_0xa02d5f(0x15b)]?.['inputCurrency']);if(_0x28ea53['result']!==_0xa02d5f(0x141)||_0x28ea53[_0xa02d5f(0x171)]!==0xc8){const _0x27e9ff=_0x28ea53[_0xa02d5f(0x160)]||_0xa02d5f(0x170);console[_0xa02d5f(0x182)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0xa02d5f(0x182)](_0xa02d5f(0x18c),_0x27e9ff),loggerService_1[_0xa02d5f(0x148)]['logWhiteDomainError'](_0xa02d5f(0x166),'/status',_0xa02d5f(0x152)+_0x27e9ff);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x27e9ff);}if(!_0x28ea53['data']){console[_0xa02d5f(0x182)](_0xa02d5f(0x16e)),console[_0xa02d5f(0x182)](_0xa02d5f(0x151)),loggerService_1[_0xa02d5f(0x148)][_0xa02d5f(0x172)](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0xa02d5f(0x13d));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x5b7196=_0xa02d5f(0x154);switch(_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x18a)]?.[_0xa02d5f(0x184)]()){case _0xa02d5f(0x150):_0x5b7196='PAID';break;case _0xa02d5f(0x158):case _0xa02d5f(0x13f):case'error':_0x5b7196=_0xa02d5f(0x1ad);break;case'expired':case'timeout':_0x5b7196=_0xa02d5f(0x18f);break;case _0xa02d5f(0x1b1):case _0xa02d5f(0x1a0):case _0xa02d5f(0x175):case _0xa02d5f(0x183):default:_0x5b7196=_0xa02d5f(0x154);break;}let _0x152388,_0x3349b4;if(_0x28ea53[_0xa02d5f(0x15b)]['PaymentDetail']){const _0x402894=_0x28ea53['data']['PaymentDetail'];console[_0xa02d5f(0x17d)]('üè¶\x20Payment\x20Detail:',_0x402894);const _0x22eec1=_0x402894[_0xa02d5f(0x142)](/IBAN\s+([A-Z0-9]+)/i);_0x22eec1&&(_0x152388=_0x22eec1[0x1],console[_0xa02d5f(0x17d)](_0xa02d5f(0x146),_0x152388)),_0x3349b4=_0x402894;}const _0xf17d84={'iban':_0x152388,'bankDetails':_0x3349b4,'transactionId':_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x18d)],'coinAddress':_0x28ea53[_0xa02d5f(0x15b)]['coinAddress'],'qrCodeUrl':_0x28ea53['data'][_0xa02d5f(0x196)],'expiryTime':_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x19d)],'createdOn':_0x28ea53['data'][_0xa02d5f(0x1a6)],'confirmedOn':_0x28ea53[_0xa02d5f(0x15b)]['TransactionConfirmedOn']};console[_0xa02d5f(0x17d)](_0xa02d5f(0x19e)),console[_0xa02d5f(0x17d)](_0xa02d5f(0x17f),_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x18a)],'->',_0x5b7196),console[_0xa02d5f(0x17d)](_0xa02d5f(0x139),_0x28ea53['data'][_0xa02d5f(0x18b)],_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x189)]),console[_0xa02d5f(0x17d)]('Transaction\x20ID:',_0x28ea53[_0xa02d5f(0x15b)]['TransactionID']),console[_0xa02d5f(0x17d)]('IBAN:',_0x152388||_0xa02d5f(0x1ae)),console[_0xa02d5f(0x17d)](_0xa02d5f(0x180),_0x28ea53[_0xa02d5f(0x15b)]['CreatedOn']),console[_0xa02d5f(0x17d)]('Confirmed\x20On:',_0x28ea53['data']['TransactionConfirmedOn']||_0xa02d5f(0x19f));if(_0x28ea53['data'][_0xa02d5f(0x18a)]?.[_0xa02d5f(0x184)]()==='awaiting\x20fiat')console[_0xa02d5f(0x17d)](_0xa02d5f(0x1a5));else _0x28ea53['data'][_0xa02d5f(0x18a)]?.[_0xa02d5f(0x184)]()===_0xa02d5f(0x150)&&console[_0xa02d5f(0x17d)](_0xa02d5f(0x13b));return{'status':_0x5b7196,'amount':parseFloat(_0x28ea53[_0xa02d5f(0x15b)][_0xa02d5f(0x18b)])||undefined,'currency':_0x28ea53['data'][_0xa02d5f(0x189)]||'EUR','paymentDetails':_0xf17d84};}catch(_0x580aba){console[_0xa02d5f(0x182)](_0xa02d5f(0x186),_0x580aba),loggerService_1[_0xa02d5f(0x148)]['logWhiteDomainError'](_0xa02d5f(0x166),_0xa02d5f(0x1a1),_0x580aba);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x580aba instanceof Error?_0x580aba[_0xa02d5f(0x160)]:_0xa02d5f(0x153)));}}async[a38_0x249958(0x161)](_0x1b3828){const _0x165b31=a38_0x249958,_0x5517ea=await this[_0x165b31(0x1a9)](_0x1b3828);return{'status':_0x5517ea['status'],'amount':_0x5517ea['amount'],'currency':_0x5517ea['currency']};}async[a38_0x249958(0x16a)](_0x305d60){const _0x17deac=a38_0x249958;console[_0x17deac(0x17d)](_0x17deac(0x1af),_0x305d60);let _0x29b234=_0x17deac(0x154);switch(_0x305d60[_0x17deac(0x14c)]?.[_0x17deac(0x184)]()){case _0x17deac(0x150):_0x29b234=_0x17deac(0x155);break;case'cancelled':case'failed':case _0x17deac(0x182):_0x29b234=_0x17deac(0x1ad);break;case _0x17deac(0x17e):case _0x17deac(0x138):_0x29b234='EXPIRED';break;case _0x17deac(0x175):case _0x17deac(0x1b1):case _0x17deac(0x1a0):case _0x17deac(0x183):default:_0x29b234=_0x17deac(0x154);break;}return{'paymentId':_0x305d60[_0x17deac(0x16f)]||_0x305d60[_0x17deac(0x173)]||'','status':_0x29b234,'amount':_0x305d60[_0x17deac(0x165)],'currency':_0x305d60[_0x17deac(0x1ac)]||_0x17deac(0x177)};}}function a38_0x5e4a(_0x255934,_0x56ede0){const _0xee7cac=a38_0xee7c();return a38_0x5e4a=function(_0x5e4a5c,_0x3da829){_0x5e4a5c=_0x5e4a5c-0x136;let _0x4065a9=_0xee7cac[_0x5e4a5c];return _0x4065a9;},a38_0x5e4a(_0x255934,_0x56ede0);}exports['CoinToPayService']=CoinToPayService;