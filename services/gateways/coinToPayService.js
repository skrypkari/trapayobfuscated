'use strict';const a40_0x35db18=a40_0x55c8;(function(_0x5425ba,_0x4a423e){const _0x5ea709=a40_0x55c8,_0x44e5cb=_0x5425ba();while(!![]){try{const _0x1a1f41=parseInt(_0x5ea709(0x1fb))/0x1+parseInt(_0x5ea709(0x24e))/0x2+parseInt(_0x5ea709(0x242))/0x3*(-parseInt(_0x5ea709(0x1d1))/0x4)+parseInt(_0x5ea709(0x1ee))/0x5+parseInt(_0x5ea709(0x233))/0x6*(-parseInt(_0x5ea709(0x235))/0x7)+parseInt(_0x5ea709(0x1dc))/0x8+-parseInt(_0x5ea709(0x1e8))/0x9;if(_0x1a1f41===_0x4a423e)break;else _0x44e5cb['push'](_0x44e5cb['shift']());}catch(_0x560fb2){_0x44e5cb['push'](_0x44e5cb['shift']());}}}(a40_0x1089,0xdcc52));function a40_0x55c8(_0x3d2fb3,_0x3f6683){const _0x1089d2=a40_0x1089();return a40_0x55c8=function(_0x55c8c7,_0x41f880){_0x55c8c7=_0x55c8c7-0x1d1;let _0x2b57b4=_0x1089d2[_0x55c8c7];return _0x2b57b4;},a40_0x55c8(_0x3d2fb3,_0x3f6683);}Object[a40_0x35db18(0x215)](exports,a40_0x35db18(0x238),{'value':!![]}),exports[a40_0x35db18(0x224)]=void 0x0;const loggerService_1=require(a40_0x35db18(0x207));class CoinToPayService{constructor(){const _0x5d4f79=a40_0x35db18;this['apiUrl']=_0x5d4f79(0x24c),this['statusUrl']=_0x5d4f79(0x255),console[_0x5d4f79(0x1e5)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console['log'](_0x5d4f79(0x213),this[_0x5d4f79(0x212)]);}async[a40_0x35db18(0x1d4)](_0x129562){const _0x1e9fe2=a40_0x35db18,{orderId:_0x548161,amount:_0x59e9da}=_0x129562;console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x21f)+_0x59e9da+_0x1e9fe2(0x23d));const _0x81cbad={'amount':_0x59e9da},_0x294f3a=Date['now']();try{console[_0x1e9fe2(0x1e5)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1e9fe2(0x1e5)]('URL:',this['apiUrl']),console['log'](_0x1e9fe2(0x23e),JSON['stringify'](_0x81cbad,null,0x2)),console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x216),_0x59e9da,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x1e9fe2(0x1f4)]['logWhiteDomainRequest'](_0x1e9fe2(0x226),_0x1e9fe2(0x249),_0x1e9fe2(0x1d6),_0x81cbad);const _0x40fd84=await fetch(this[_0x1e9fe2(0x237)],{'method':_0x1e9fe2(0x1d6),'headers':{'Content-Type':'application/json','Accept':_0x1e9fe2(0x227),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1e9fe2(0x1f3)](_0x81cbad)}),_0x273b96=Date[_0x1e9fe2(0x1ea)]()-_0x294f3a;console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x208)),console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x248),_0x40fd84[_0x1e9fe2(0x1f9)]),console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x205),_0x40fd84[_0x1e9fe2(0x21a)]),console[_0x1e9fe2(0x1e5)]('Headers:',Object[_0x1e9fe2(0x23c)](_0x40fd84[_0x1e9fe2(0x21c)][_0x1e9fe2(0x230)]())),console['log'](_0x1e9fe2(0x24f),_0x273b96+'ms');const _0x1ff0f7=await _0x40fd84[_0x1e9fe2(0x228)]();console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x1d7),_0x1ff0f7);if(!_0x40fd84['ok']){console['error'](_0x1e9fe2(0x20f)),console['error']('HTTP\x20Status:',_0x40fd84[_0x1e9fe2(0x1f9)]),console[_0x1e9fe2(0x246)](_0x1e9fe2(0x1fc),_0x1ff0f7),loggerService_1[_0x1e9fe2(0x1f4)]['logWhiteDomainResponse'](_0x1e9fe2(0x226),'/create',_0x40fd84[_0x1e9fe2(0x1f9)],_0x1ff0f7,_0x273b96),loggerService_1['loggerService'][_0x1e9fe2(0x254)](_0x1e9fe2(0x226),_0x1e9fe2(0x249),_0x1e9fe2(0x23a)+_0x40fd84[_0x1e9fe2(0x1f9)]+':\x20'+_0x1ff0f7);throw new Error(_0x1e9fe2(0x250)+_0x40fd84['status']+',\x20body:\x20'+_0x1ff0f7);}let _0xc44587;try{_0xc44587=JSON[_0x1e9fe2(0x1ff)](_0x1ff0f7);}catch(_0x2b0957){console[_0x1e9fe2(0x246)](_0x1e9fe2(0x1e7),_0x2b0957),loggerService_1['loggerService'][_0x1e9fe2(0x254)](_0x1e9fe2(0x226),_0x1e9fe2(0x249),'JSON\x20Parse\x20Error:\x20'+_0x2b0957);throw new Error(_0x1e9fe2(0x245)+_0x1ff0f7);}console['log'](_0x1e9fe2(0x21d)),console[_0x1e9fe2(0x1e5)]('Parsed\x20Result:',JSON['stringify'](_0xc44587,null,0x2)),loggerService_1[_0x1e9fe2(0x1f4)]['logWhiteDomainResponse'](_0x1e9fe2(0x226),_0x1e9fe2(0x249),_0x40fd84[_0x1e9fe2(0x1f9)],_0xc44587,_0x273b96);if(_0xc44587[_0x1e9fe2(0x246)]){const _0x5385f2=_0xc44587[_0x1e9fe2(0x225)]||_0xc44587[_0x1e9fe2(0x246)]||_0x1e9fe2(0x1db);console[_0x1e9fe2(0x246)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x1e9fe2(0x246)](_0x1e9fe2(0x218),_0x5385f2),loggerService_1['loggerService'][_0x1e9fe2(0x254)](_0x1e9fe2(0x226),_0x1e9fe2(0x249),_0x1e9fe2(0x24b)+_0x5385f2);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x5385f2);}if(!_0xc44587[_0x1e9fe2(0x22b)]||!_0xc44587[_0x1e9fe2(0x22a)]){console[_0x1e9fe2(0x246)](_0x1e9fe2(0x210)),console['error'](_0x1e9fe2(0x20d)),console[_0x1e9fe2(0x246)](_0x1e9fe2(0x1e1),_0xc44587),loggerService_1[_0x1e9fe2(0x1f4)][_0x1e9fe2(0x254)](_0x1e9fe2(0x226),_0x1e9fe2(0x249),_0x1e9fe2(0x1fe));throw new Error(_0x1e9fe2(0x1ed));}return console[_0x1e9fe2(0x1e5)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x1e9fe2(0x1e5)]('Gateway\x20Payment\x20ID:',_0xc44587[_0x1e9fe2(0x22a)]),console[_0x1e9fe2(0x1e5)](_0x1e9fe2(0x217),_0xc44587[_0x1e9fe2(0x22b)]),console['log']('Amount:',_0x59e9da,_0x1e9fe2(0x1f5)),{'gateway_payment_id':_0xc44587[_0x1e9fe2(0x22a)],'payment_url':_0xc44587[_0x1e9fe2(0x22b)]};}catch(_0x4d0a6a){console[_0x1e9fe2(0x246)](_0x1e9fe2(0x209)),console[_0x1e9fe2(0x246)](_0x1e9fe2(0x200),_0x4d0a6a),loggerService_1[_0x1e9fe2(0x1f4)]['logWhiteDomainError']('cointopay',_0x1e9fe2(0x249),_0x4d0a6a);if(_0x4d0a6a instanceof Error){console[_0x1e9fe2(0x246)]('Error\x20message:',_0x4d0a6a['message']),console[_0x1e9fe2(0x246)](_0x1e9fe2(0x1de),_0x4d0a6a['stack']);throw new Error(_0x1e9fe2(0x20e)+_0x4d0a6a[_0x1e9fe2(0x225)]);}throw new Error(_0x1e9fe2(0x206));}}async[a40_0x35db18(0x1f2)](_0x121f3d){const _0x1d416e=a40_0x35db18,_0x799b7b=Date[_0x1d416e(0x1ea)]();try{console['log'](_0x1d416e(0x1ef)+_0x121f3d);const _0x47d39b={'gatewayPaymentId':_0x121f3d};loggerService_1[_0x1d416e(0x1f4)][_0x1d416e(0x1d9)](_0x1d416e(0x226),_0x1d416e(0x220),_0x1d416e(0x1d6),_0x47d39b);const _0x2278b9=await fetch(this[_0x1d416e(0x212)],{'method':_0x1d416e(0x1d6),'headers':{'Content-Type':_0x1d416e(0x227),'Accept':_0x1d416e(0x227),'User-Agent':_0x1d416e(0x1e4)},'body':JSON[_0x1d416e(0x1f3)](_0x47d39b)}),_0x420314=Date[_0x1d416e(0x1ea)]()-_0x799b7b;console[_0x1d416e(0x1e5)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1d416e(0x1e5)]('Status:',_0x2278b9['status']),console['log']('Response\x20Time:',_0x420314+'ms');if(!_0x2278b9['ok']){const _0x2a3bd6=await _0x2278b9['text']();console[_0x1d416e(0x246)](_0x1d416e(0x1d2),_0x2278b9[_0x1d416e(0x1f9)]),console['error'](_0x1d416e(0x1fc),_0x2a3bd6),loggerService_1['loggerService'][_0x1d416e(0x1e2)](_0x1d416e(0x226),_0x1d416e(0x220),_0x2278b9['status'],_0x2a3bd6,_0x420314),loggerService_1['loggerService']['logWhiteDomainError'](_0x1d416e(0x226),_0x1d416e(0x220),_0x1d416e(0x23a)+_0x2278b9[_0x1d416e(0x1f9)]+':\x20'+_0x2a3bd6);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2278b9[_0x1d416e(0x1f9)]);}const _0x3475eb=await _0x2278b9['text']();console[_0x1d416e(0x1e5)]('Raw\x20Response\x20Body:',_0x3475eb);let _0x3e2405;try{_0x3e2405=JSON[_0x1d416e(0x1ff)](_0x3475eb);}catch(_0x330e5a){console['error'](_0x1d416e(0x1e7),_0x330e5a),loggerService_1['loggerService']['logWhiteDomainError'](_0x1d416e(0x226),_0x1d416e(0x220),_0x1d416e(0x1ec)+_0x330e5a);throw new Error(_0x1d416e(0x1f7)+_0x3475eb);}loggerService_1[_0x1d416e(0x1f4)][_0x1d416e(0x1e2)](_0x1d416e(0x226),_0x1d416e(0x220),_0x2278b9[_0x1d416e(0x1f9)],_0x3e2405,_0x420314),console[_0x1d416e(0x1e5)](_0x1d416e(0x252)),console['log'](_0x1d416e(0x1fd),_0x3e2405[_0x1d416e(0x204)]),console[_0x1d416e(0x1e5)]('Status\x20Code:',_0x3e2405[_0x1d416e(0x202)]),console[_0x1d416e(0x1e5)](_0x1d416e(0x22f),_0x3e2405[_0x1d416e(0x1da)]?.['Status']),console[_0x1d416e(0x1e5)](_0x1d416e(0x216),_0x3e2405[_0x1d416e(0x1da)]?.[_0x1d416e(0x22e)]),console[_0x1d416e(0x1e5)](_0x1d416e(0x211),_0x3e2405['data']?.[_0x1d416e(0x1f8)]);if(_0x3e2405[_0x1d416e(0x204)]!=='success'||_0x3e2405[_0x1d416e(0x202)]!==0xc8){const _0x24f948=_0x3e2405[_0x1d416e(0x225)]||_0x1d416e(0x21b);console[_0x1d416e(0x246)](_0x1d416e(0x22d)),console[_0x1d416e(0x246)](_0x1d416e(0x218),_0x24f948),loggerService_1[_0x1d416e(0x1f4)][_0x1d416e(0x254)]('cointopay',_0x1d416e(0x220),_0x1d416e(0x20c)+_0x24f948);throw new Error(_0x1d416e(0x1d3)+_0x24f948);}if(!_0x3e2405[_0x1d416e(0x1da)]){console[_0x1d416e(0x246)](_0x1d416e(0x20b)),console['error'](_0x1d416e(0x236)),loggerService_1[_0x1d416e(0x1f4)][_0x1d416e(0x254)](_0x1d416e(0x226),_0x1d416e(0x220),_0x1d416e(0x1e0));throw new Error(_0x1d416e(0x1df));}let _0x26bce7='PENDING';switch(_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x229)]?.[_0x1d416e(0x219)]()){case _0x1d416e(0x239):_0x26bce7=_0x1d416e(0x23b);break;case _0x1d416e(0x221):case _0x1d416e(0x1d8):case'error':_0x26bce7=_0x1d416e(0x234);break;case'expired':case _0x1d416e(0x23f):_0x26bce7=_0x1d416e(0x244);break;case _0x1d416e(0x232):case'awaiting\x20fiat':case'pending':case _0x1d416e(0x20a):default:_0x26bce7='PENDING';break;}let _0x2745a9,_0x45c590;if(_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1eb)]){const _0x459af2=_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1eb)];console[_0x1d416e(0x1e5)]('🏦\x20Payment\x20Detail:',_0x459af2);const _0x2a3d98=_0x459af2['match'](/IBAN\s+([A-Z0-9]+)/i);_0x2a3d98&&(_0x2745a9=_0x2a3d98[0x1],console['log'](_0x1d416e(0x214),_0x2745a9)),_0x45c590=_0x459af2;}const _0x1e47fb={'iban':_0x2745a9,'bankDetails':_0x45c590,'transactionId':_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1dd)],'coinAddress':_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x241)],'qrCodeUrl':_0x3e2405[_0x1d416e(0x1da)]['QRCodeURL'],'expiryTime':_0x3e2405['data'][_0x1d416e(0x1e9)],'createdOn':_0x3e2405[_0x1d416e(0x1da)]['CreatedOn'],'confirmedOn':_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x231)]};console['log'](_0x1d416e(0x203)),console[_0x1d416e(0x1e5)](_0x1d416e(0x248),_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x229)],'->',_0x26bce7),console[_0x1d416e(0x1e5)](_0x1d416e(0x216),_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x22e)],_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1f8)]),console['log'](_0x1d416e(0x1f6),_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1dd)]),console[_0x1d416e(0x1e5)](_0x1d416e(0x1d5),_0x2745a9||_0x1d416e(0x223)),console[_0x1d416e(0x1e5)](_0x1d416e(0x1e6),_0x3e2405['data']['CreatedOn']),console[_0x1d416e(0x1e5)](_0x1d416e(0x24a),_0x3e2405['data'][_0x1d416e(0x231)]||_0x1d416e(0x22c));if(_0x3e2405['data']['Status']?.[_0x1d416e(0x219)]()===_0x1d416e(0x21e))console['log']('💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x229)]?.[_0x1d416e(0x219)]()==='paid'&&console[_0x1d416e(0x1e5)](_0x1d416e(0x1fa));return{'status':_0x26bce7,'amount':parseFloat(_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x22e)])||undefined,'currency':_0x3e2405[_0x1d416e(0x1da)][_0x1d416e(0x1f8)]||_0x1d416e(0x1f5),'paymentDetails':_0x1e47fb};}catch(_0x6083ab){console[_0x1d416e(0x246)](_0x1d416e(0x243),_0x6083ab),loggerService_1['loggerService'][_0x1d416e(0x254)](_0x1d416e(0x226),'/status',_0x6083ab);throw new Error(_0x1d416e(0x253)+(_0x6083ab instanceof Error?_0x6083ab[_0x1d416e(0x225)]:_0x1d416e(0x240)));}}async[a40_0x35db18(0x256)](_0xb0d3cb){const _0x21d550=a40_0x35db18,_0x356e1d=await this[_0x21d550(0x1f2)](_0xb0d3cb);return{'status':_0x356e1d[_0x21d550(0x1f9)],'amount':_0x356e1d[_0x21d550(0x24d)],'currency':_0x356e1d[_0x21d550(0x222)]};}async[a40_0x35db18(0x1f0)](_0x623301){const _0x199a7e=a40_0x35db18;console[_0x199a7e(0x1e5)](_0x199a7e(0x1e3),_0x623301);let _0x3db606=_0x199a7e(0x1f1);switch(_0x623301[_0x199a7e(0x1f9)]?.[_0x199a7e(0x219)]()){case _0x199a7e(0x239):_0x3db606='PAID';break;case _0x199a7e(0x221):case _0x199a7e(0x1d8):case _0x199a7e(0x246):_0x3db606=_0x199a7e(0x234);break;case _0x199a7e(0x201):case _0x199a7e(0x23f):_0x3db606='EXPIRED';break;case'pending':case _0x199a7e(0x232):case _0x199a7e(0x21e):case'created':default:_0x3db606=_0x199a7e(0x1f1);break;}return{'paymentId':_0x623301[_0x199a7e(0x247)]||_0x623301[_0x199a7e(0x251)]||'','status':_0x3db606,'amount':_0x623301[_0x199a7e(0x24d)],'currency':_0x623301['currency']||_0x199a7e(0x1f5)};}}exports[a40_0x35db18(0x224)]=CoinToPayService;function a40_0x1089(){const _0x4ad704=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','error','order_id','Status:','/create','Confirmed\x20On:','Business\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','amount','2601354LNjWxq','Response\x20Time:','HTTP\x20error!\x20status:\x20','merchant_reference_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','logWhiteDomainError','https://tesoft.uk/gateway/cointopay/status.php','verifyPayment','107788BtOHNz','HTTP\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','createPaymentLink','IBAN:','POST','Raw\x20Response\x20Body:','failed','logWhiteDomainRequest','data','Unknown\x20error\x20from\x20CoinToPay\x20API','7270248TtiNST','TransactionID','Error\x20stack:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Incomplete\x20response:\x20missing\x20data','Response\x20data:','logWhiteDomainResponse','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','TesSoft\x20Payment\x20System/1.0','log','Created\x20On:','Failed\x20to\x20parse\x20JSON\x20response:','21049830cWRoro','ExpiryTime','now','PaymentDetail','JSON\x20Parse\x20Error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','4863835Dlkrup','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','processWebhook','PENDING','checkPaymentStatus','stringify','loggerService','EUR','Transaction\x20ID:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','inputCurrency','status','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','422124MCtlZJ','Response\x20Body:','Result:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','parse','Error\x20details:','expired','status_code','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','result','Status\x20Text:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','../loggerService','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','created','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Status\x20API\x20Error:\x20','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Currency:','statusUrl','📊\x20Status\x20check\x20URL:','🏦\x20Extracted\x20IBAN:','defineProperty','Amount:','Payment\x20URL:','Error\x20Message:','toLowerCase','statusText','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','headers','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','awaiting\x20fiat','🪙\x20Creating\x20CoinToPay\x20payment:\x20','/status','cancelled','currency','not\x20found','CoinToPayService','message','cointopay','application/json','text','Status','gateway_payment_id','payment_url','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Amount','Payment\x20Status:','entries','TransactionConfirmedOn','waiting','96RVFcxd','FAILED','75502qkoreD','Missing\x20data\x20in\x20response','apiUrl','__esModule','paid','HTTP\x20','PAID','fromEntries','\x20EUR','Request\x20Body:','timeout','Unknown\x20error','coinAddress','21OVfHTK','CoinToPay\x20payment\x20status\x20check\x20error:','EXPIRED'];a40_0x1089=function(){return _0x4ad704;};return a40_0x1089();}