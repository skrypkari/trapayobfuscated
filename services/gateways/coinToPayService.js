'use strict';const a47_0x44669a=a47_0x3b07;function a47_0x569a(){const _0x269431=['ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','merchant_reference_id','CoinToPay\x20API\x20error:\x20','ExpiryTime','Confirmed\x20On:','EUR','CreatedOn','fromEntries','created','196062CMzonC','https://tesoft.uk/gateway/cointopay/','HTTP\x20','checkPaymentStatus','amount','inputCurrency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','log','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Request\x20Body:','4FKQDRO','Error\x20Message:','2237736qsXjWL','EXPIRED','TransactionID','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','gateway_payment_id','status','PaymentDetail','2830260HguJLb','message','Error\x20details:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','failed','/status','cointopay','===\x20COINTOPAY\x20SUCCESS\x20===','loggerService','Response\x20Body:','CoinToPay\x20status\x20API\x20error:\x20','16984gJSmwF','Gateway\x20Payment\x20ID:','Incomplete\x20response:\x20missing\x20data','not\x20found','cancelled','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','POST','waiting','Response\x20Time:','status_code','parse','stack','Headers:','logWhiteDomainError','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Response\x20data:','7917140NcVfBq','PAID','Currency:','data','Raw\x20Response\x20Body:','42GCKymS','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','stringify','CoinToPayService','1045916hUiNAk','text','üè¶\x20Extracted\x20IBAN:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','__esModule','QRCodeURL','TransactionConfirmedOn','HTTP\x20error!\x20status:\x20','FAILED','üè¶\x20Payment\x20Detail:','error','payment_url','/create','Status','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','application/json','defineProperty','toLowerCase','statusUrl','Status\x20Code:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Error\x20stack:','awaiting\x20fiat','Created\x20On:','JSON\x20Parse\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount','Amount:','410426sghMQP','pending',',\x20body:\x20','Unknown\x20error','not\x20confirmed','1908oJThvy','apiUrl','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','PENDING','order_id','Missing\x20data\x20in\x20response','HTTP\x20Status:','logWhiteDomainResponse','Status:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20message:','result','now','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','timeout','headers','../loggerService','currency','expired','Payment\x20System/1.0','paid','Business\x20Error:\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Transaction\x20ID:','CoinToPay\x20payment\x20status\x20check\x20error:','Status\x20API\x20Error:\x20'];a47_0x569a=function(){return _0x269431;};return a47_0x569a();}function a47_0x3b07(_0x31443b,_0xc2fe30){const _0x569adc=a47_0x569a();return a47_0x3b07=function(_0x3b0783,_0x9ab31b){_0x3b0783=_0x3b0783-0xb4;let _0xa2497=_0x569adc[_0x3b0783];return _0xa2497;},a47_0x3b07(_0x31443b,_0xc2fe30);}(function(_0x13c411,_0x328294){const _0x14c881=a47_0x3b07,_0x1b85eb=_0x13c411();while(!![]){try{const _0x1c3be3=-parseInt(_0x14c881(0xc5))/0x1+parseInt(_0x14c881(0x127))/0x2+parseInt(_0x14c881(0xfa))/0x3+parseInt(_0x14c881(0xf8))/0x4*(parseInt(_0x14c881(0x101))/0x5)+-parseInt(_0x14c881(0xee))/0x6*(-parseInt(_0x14c881(0x123))/0x7)+-parseInt(_0x14c881(0x10d))/0x8*(parseInt(_0x14c881(0xca))/0x9)+-parseInt(_0x14c881(0x11e))/0xa;if(_0x1c3be3===_0x328294)break;else _0x1b85eb['push'](_0x1b85eb['shift']());}catch(_0x45edef){_0x1b85eb['push'](_0x1b85eb['shift']());}}}(a47_0x569a,0x5c790));Object[a47_0x44669a(0xb7)](exports,a47_0x44669a(0x12b),{'value':!![]}),exports[a47_0x44669a(0x126)]=void 0x0;const loggerService_1=require(a47_0x44669a(0xdb));class CoinToPayService{constructor(){const _0x317810=a47_0x44669a;this['apiUrl']=_0x317810(0xef),this[_0x317810(0xb9)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x317810(0xe1)),console[_0x317810(0xf5)]('üìä\x20Status\x20check\x20URL:',this[_0x317810(0xb9)]);}async['createPaymentLink'](_0x121522){const _0x2414e1=a47_0x44669a,{orderId:_0x48c36b,amount:_0x2b8f13}=_0x121522;console[_0x2414e1(0xf5)](_0x2414e1(0xe5)+_0x2b8f13+'\x20EUR');const _0x4ec63c={'amount':_0x2b8f13},_0x356134=Date[_0x2414e1(0xd6)]();try{console[_0x2414e1(0xf5)](_0x2414e1(0x11c)),console['log']('URL:',this[_0x2414e1(0xcb)]),console[_0x2414e1(0xf5)](_0x2414e1(0xf7),JSON[_0x2414e1(0x125)](_0x4ec63c,null,0x2)),console[_0x2414e1(0xf5)](_0x2414e1(0xc4),_0x2b8f13,_0x2414e1(0x11b)),loggerService_1[_0x2414e1(0x10a)]['logWhiteDomainRequest'](_0x2414e1(0x108),_0x2414e1(0x133),_0x2414e1(0x113),_0x4ec63c);const _0x5594a3=await fetch(this[_0x2414e1(0xcb)],{'method':_0x2414e1(0x113),'headers':{'Content-Type':_0x2414e1(0xb6),'Accept':'application/json','User-Agent':_0x2414e1(0xde)},'body':JSON[_0x2414e1(0x125)](_0x4ec63c)}),_0x2c0ea0=Date['now']()-_0x356134;console[_0x2414e1(0xf5)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2414e1(0xf5)](_0x2414e1(0xd2),_0x5594a3[_0x2414e1(0xff)]),console[_0x2414e1(0xf5)]('Status\x20Text:',_0x5594a3['statusText']),console[_0x2414e1(0xf5)](_0x2414e1(0x119),Object[_0x2414e1(0xec)](_0x5594a3[_0x2414e1(0xda)]['entries']())),console[_0x2414e1(0xf5)](_0x2414e1(0x115),_0x2c0ea0+'ms');const _0x183757=await _0x5594a3[_0x2414e1(0x128)]();console['log'](_0x2414e1(0x122),_0x183757);if(!_0x5594a3['ok']){console[_0x2414e1(0x131)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x2414e1(0x131)](_0x2414e1(0xd0),_0x5594a3[_0x2414e1(0xff)]),console[_0x2414e1(0x131)](_0x2414e1(0x10b),_0x183757),loggerService_1[_0x2414e1(0x10a)][_0x2414e1(0xd1)]('cointopay',_0x2414e1(0x133),_0x5594a3[_0x2414e1(0xff)],_0x183757,_0x2c0ea0),loggerService_1[_0x2414e1(0x10a)][_0x2414e1(0x11a)](_0x2414e1(0x108),_0x2414e1(0x133),_0x2414e1(0xf0)+_0x5594a3[_0x2414e1(0xff)]+':\x20'+_0x183757);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5594a3[_0x2414e1(0xff)]+_0x2414e1(0xc7)+_0x183757);}let _0x335d9b;try{_0x335d9b=JSON[_0x2414e1(0x117)](_0x183757);}catch(_0xe5d002){console[_0x2414e1(0x131)](_0x2414e1(0xb4),_0xe5d002),loggerService_1[_0x2414e1(0x10a)]['logWhiteDomainError']('cointopay',_0x2414e1(0x133),_0x2414e1(0xbf)+_0xe5d002);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x183757);}console[_0x2414e1(0xf5)](_0x2414e1(0xc2)),console[_0x2414e1(0xf5)]('Parsed\x20Result:',JSON[_0x2414e1(0x125)](_0x335d9b,null,0x2)),loggerService_1[_0x2414e1(0x10a)][_0x2414e1(0xd1)](_0x2414e1(0x108),_0x2414e1(0x133),_0x5594a3['status'],_0x335d9b,_0x2c0ea0);if(_0x335d9b[_0x2414e1(0x131)]){const _0x303a75=_0x335d9b['message']||_0x335d9b[_0x2414e1(0x131)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x2414e1(0x131)](_0x2414e1(0xb5)),console[_0x2414e1(0x131)]('Error\x20Message:',_0x303a75),loggerService_1[_0x2414e1(0x10a)][_0x2414e1(0x11a)]('cointopay','/create',_0x2414e1(0xe0)+_0x303a75);throw new Error(_0x2414e1(0xe7)+_0x303a75);}if(!_0x335d9b['payment_url']||!_0x335d9b['gateway_payment_id']){console[_0x2414e1(0x131)](_0x2414e1(0xd3)),console['error']('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x2414e1(0x131)](_0x2414e1(0x11d),_0x335d9b),loggerService_1[_0x2414e1(0x10a)][_0x2414e1(0x11a)](_0x2414e1(0x108),_0x2414e1(0x133),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x2414e1(0xf5)](_0x2414e1(0x109)),console[_0x2414e1(0xf5)](_0x2414e1(0x10e),_0x335d9b[_0x2414e1(0xfe)]),console[_0x2414e1(0xf5)]('Payment\x20URL:',_0x335d9b['payment_url']),console[_0x2414e1(0xf5)]('Amount:',_0x2b8f13,_0x2414e1(0xea)),{'gateway_payment_id':_0x335d9b[_0x2414e1(0xfe)],'payment_url':_0x335d9b[_0x2414e1(0x132)]};}catch(_0x25a5c7){console['error'](_0x2414e1(0xfd)),console['error'](_0x2414e1(0x103),_0x25a5c7),loggerService_1['loggerService'][_0x2414e1(0x11a)](_0x2414e1(0x108),'/create',_0x25a5c7);if(_0x25a5c7 instanceof Error){console['error'](_0x2414e1(0xd4),_0x25a5c7['message']),console['error'](_0x2414e1(0xbc),_0x25a5c7[_0x2414e1(0x118)]);throw new Error(_0x2414e1(0xf6)+_0x25a5c7[_0x2414e1(0x102)]);}throw new Error(_0x2414e1(0xf4));}}async[a47_0x44669a(0xf1)](_0x4b292c){const _0x5aafcf=a47_0x44669a,_0x2d1eab=Date[_0x5aafcf(0xd6)]();try{console[_0x5aafcf(0xf5)](_0x5aafcf(0xcc)+_0x4b292c);const _0x63c70e={'gatewayPaymentId':_0x4b292c};loggerService_1['loggerService']['logWhiteDomainRequest']('cointopay',_0x5aafcf(0x107),_0x5aafcf(0x113),_0x63c70e);const _0x298596=await fetch(this[_0x5aafcf(0xb9)],{'method':'POST','headers':{'Content-Type':_0x5aafcf(0xb6),'Accept':_0x5aafcf(0xb6),'User-Agent':'Payment\x20System/1.0'},'body':JSON['stringify'](_0x63c70e)}),_0x3bf06e=Date[_0x5aafcf(0xd6)]()-_0x2d1eab;console[_0x5aafcf(0xf5)](_0x5aafcf(0xc0)),console[_0x5aafcf(0xf5)](_0x5aafcf(0xd2),_0x298596[_0x5aafcf(0xff)]),console['log'](_0x5aafcf(0x115),_0x3bf06e+'ms');if(!_0x298596['ok']){const _0x44cdea=await _0x298596['text']();console['error'](_0x5aafcf(0xd0),_0x298596[_0x5aafcf(0xff)]),console[_0x5aafcf(0x131)](_0x5aafcf(0x10b),_0x44cdea),loggerService_1[_0x5aafcf(0x10a)][_0x5aafcf(0xd1)](_0x5aafcf(0x108),'/status',_0x298596[_0x5aafcf(0xff)],_0x44cdea,_0x3bf06e),loggerService_1[_0x5aafcf(0x10a)][_0x5aafcf(0x11a)](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x5aafcf(0xf0)+_0x298596['status']+':\x20'+_0x44cdea);throw new Error(_0x5aafcf(0x12e)+_0x298596[_0x5aafcf(0xff)]);}const _0x367319=await _0x298596[_0x5aafcf(0x128)]();console[_0x5aafcf(0xf5)](_0x5aafcf(0x122),_0x367319);let _0xc94ad;try{_0xc94ad=JSON[_0x5aafcf(0x117)](_0x367319);}catch(_0x56e2fa){console[_0x5aafcf(0x131)](_0x5aafcf(0xb4),_0x56e2fa),loggerService_1['loggerService'][_0x5aafcf(0x11a)](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x5aafcf(0xbf)+_0x56e2fa);throw new Error(_0x5aafcf(0x112)+_0x367319);}loggerService_1[_0x5aafcf(0x10a)][_0x5aafcf(0xd1)](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x298596['status'],_0xc94ad,_0x3bf06e),console['log'](_0x5aafcf(0xc1)),console[_0x5aafcf(0xf5)]('Result:',_0xc94ad[_0x5aafcf(0xd5)]),console[_0x5aafcf(0xf5)](_0x5aafcf(0xba),_0xc94ad[_0x5aafcf(0x116)]),console[_0x5aafcf(0xf5)](_0x5aafcf(0xd7),_0xc94ad['data']?.[_0x5aafcf(0x134)]),console['log'](_0x5aafcf(0xc4),_0xc94ad[_0x5aafcf(0x121)]?.[_0x5aafcf(0xc3)]),console[_0x5aafcf(0xf5)](_0x5aafcf(0x120),_0xc94ad[_0x5aafcf(0x121)]?.[_0x5aafcf(0xf3)]);if(_0xc94ad[_0x5aafcf(0xd5)]!=='success'||_0xc94ad[_0x5aafcf(0x116)]!==0xc8){const _0x24e50d=_0xc94ad[_0x5aafcf(0x102)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x5aafcf(0x131)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5aafcf(0x131)](_0x5aafcf(0xf9),_0x24e50d),loggerService_1[_0x5aafcf(0x10a)][_0x5aafcf(0x11a)](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x5aafcf(0xe4)+_0x24e50d);throw new Error(_0x5aafcf(0x10c)+_0x24e50d);}if(!_0xc94ad[_0x5aafcf(0x121)]){console[_0x5aafcf(0x131)](_0x5aafcf(0x104)),console[_0x5aafcf(0x131)](_0x5aafcf(0xcf)),loggerService_1[_0x5aafcf(0x10a)][_0x5aafcf(0x11a)](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x5aafcf(0x10f));throw new Error(_0x5aafcf(0x12a));}let _0x159c43=_0x5aafcf(0xcd);switch(_0xc94ad['data']['Status']?.[_0x5aafcf(0xb8)]()){case'paid':_0x159c43=_0x5aafcf(0x11f);break;case _0x5aafcf(0x111):case _0x5aafcf(0x106):case _0x5aafcf(0x131):_0x159c43=_0x5aafcf(0x12f);break;case _0x5aafcf(0xdd):case _0x5aafcf(0xd9):_0x159c43=_0x5aafcf(0xfb);break;case'waiting':case _0x5aafcf(0xbd):case'pending':case _0x5aafcf(0xed):default:_0x159c43=_0x5aafcf(0xcd);break;}let _0x617e23,_0x10e050;if(_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0x100)]){const _0x2d41cd=_0xc94ad['data'][_0x5aafcf(0x100)];console[_0x5aafcf(0xf5)](_0x5aafcf(0x130),_0x2d41cd);const _0x28641b=_0x2d41cd['match'](/IBAN\s+([A-Z0-9]+)/i);_0x28641b&&(_0x617e23=_0x28641b[0x1],console[_0x5aafcf(0xf5)](_0x5aafcf(0x129),_0x617e23)),_0x10e050=_0x2d41cd;}const _0x1ded36={'iban':_0x617e23,'bankDetails':_0x10e050,'transactionId':_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xfc)],'coinAddress':_0xc94ad['data']['coinAddress'],'qrCodeUrl':_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0x12c)],'expiryTime':_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xe8)],'createdOn':_0xc94ad['data']['CreatedOn'],'confirmedOn':_0xc94ad['data'][_0x5aafcf(0x12d)]};console['log'](_0x5aafcf(0xd8)),console[_0x5aafcf(0xf5)](_0x5aafcf(0xd2),_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0x134)],'->',_0x159c43),console[_0x5aafcf(0xf5)](_0x5aafcf(0xc4),_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xc3)],_0xc94ad[_0x5aafcf(0x121)]['inputCurrency']),console['log'](_0x5aafcf(0xe2),_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xfc)]),console[_0x5aafcf(0xf5)]('IBAN:',_0x617e23||_0x5aafcf(0x110)),console[_0x5aafcf(0xf5)](_0x5aafcf(0xbe),_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xeb)]),console['log'](_0x5aafcf(0xe9),_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0x12d)]||_0x5aafcf(0xc9));if(_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0x134)]?.[_0x5aafcf(0xb8)]()===_0x5aafcf(0xbd))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0xc94ad['data']['Status']?.[_0x5aafcf(0xb8)]()===_0x5aafcf(0xdf)&&console['log'](_0x5aafcf(0x124));return{'status':_0x159c43,'amount':parseFloat(_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xc3)])||undefined,'currency':_0xc94ad[_0x5aafcf(0x121)][_0x5aafcf(0xf3)]||_0x5aafcf(0xea),'paymentDetails':_0x1ded36};}catch(_0x212760){console['error'](_0x5aafcf(0xe3),_0x212760),loggerService_1['loggerService']['logWhiteDomainError'](_0x5aafcf(0x108),_0x5aafcf(0x107),_0x212760);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x212760 instanceof Error?_0x212760[_0x5aafcf(0x102)]:_0x5aafcf(0xc8)));}}async['verifyPayment'](_0x5b5569){const _0x366f96=a47_0x44669a,_0x591927=await this[_0x366f96(0xf1)](_0x5b5569);return{'status':_0x591927['status'],'amount':_0x591927[_0x366f96(0xf2)],'currency':_0x591927[_0x366f96(0xdc)]};}async[a47_0x44669a(0x105)](_0x142edb){const _0x2b5b8f=a47_0x44669a;console['log'](_0x2b5b8f(0xbb),_0x142edb);let _0x169d35='PENDING';switch(_0x142edb[_0x2b5b8f(0xff)]?.[_0x2b5b8f(0xb8)]()){case _0x2b5b8f(0xdf):_0x169d35='PAID';break;case _0x2b5b8f(0x111):case _0x2b5b8f(0x106):case _0x2b5b8f(0x131):_0x169d35=_0x2b5b8f(0x12f);break;case _0x2b5b8f(0xdd):case _0x2b5b8f(0xd9):_0x169d35=_0x2b5b8f(0xfb);break;case _0x2b5b8f(0xc6):case _0x2b5b8f(0x114):case _0x2b5b8f(0xbd):case'created':default:_0x169d35=_0x2b5b8f(0xcd);break;}return{'paymentId':_0x142edb[_0x2b5b8f(0xce)]||_0x142edb[_0x2b5b8f(0xe6)]||'','status':_0x169d35,'amount':_0x142edb['amount'],'currency':_0x142edb['currency']||_0x2b5b8f(0xea)};}}exports[a47_0x44669a(0x126)]=CoinToPayService;