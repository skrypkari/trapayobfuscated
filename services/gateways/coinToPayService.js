'use strict';function a41_0x5cf7(){const _0x25785c=['error','TesSoft\x20Payment\x20System/1.0','25uUjHxM','Response\x20data:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ExpiryTime','logWhiteDomainError','Amount','defineProperty','https://tesoft.uk/gateway/cointopay/','text','üè¶\x20Payment\x20Detail:','Error\x20message:','Amount:','https://tesoft.uk/gateway/cointopay/status.php','Result:','logWhiteDomainRequest','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Payment\x20URL:','3780195EhVKqO','/status','Failed\x20to\x20parse\x20JSON\x20response:','Gateway\x20Payment\x20ID:','POST','payment_url','not\x20found','expired','created','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20SUCCESS\x20===','apiUrl','cointopay','status','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Response\x20Time:','JSON\x20Parse\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','awaiting\x20fiat','entries','Incomplete\x20response:\x20missing\x20data','26366QjGnGp','CreatedOn','FAILED','PaymentDetail','data','PENDING','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','status_code','result','TransactionConfirmedOn','EXPIRED','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','parse','currency','failed','toLowerCase','logWhiteDomainResponse','Payment\x20Status:','CoinToPay\x20status\x20API\x20error:\x20','pending','timeout','inputCurrency','verifyPayment','1338102RkjzhP','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','Error\x20stack:','now','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionID','__esModule','cancelled','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','PAID','Status\x20API\x20Error:\x20','statusUrl','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Headers:','order_id','success','10996110wZikiZ','paid','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','\x20EUR','CoinToPay\x20API\x20error:\x20','Status:','CoinToPayService','not\x20confirmed','QRCodeURL','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20API\x20ERROR\x20===','Raw\x20Response\x20Body:','Status\x20Code:','log','message','stringify','Status\x20Text:','HTTP\x20error!\x20status:\x20','Parsed\x20Result:','waiting','EUR','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','13790576bUEDLy','Status','stack',',\x20body:\x20','7949137BLBfgj','6159024cIQmBO','Currency:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','üìä\x20Status\x20check\x20URL:','fromEntries','Error\x20details:','processWebhook','statusText','üè¶\x20Extracted\x20IBAN:','70Tjpmvr','Error\x20Message:','URL:','Transaction\x20ID:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','HTTP\x20Status:','loggerService','amount','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','IBAN:','gateway_payment_id','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','checkPaymentStatus','headers','application/json','/create'];a41_0x5cf7=function(){return _0x25785c;};return a41_0x5cf7();}const a41_0x14773f=a41_0x3e1d;(function(_0x5457f8,_0x3d5132){const _0x139350=a41_0x3e1d,_0x3ceacb=_0x5457f8();while(!![]){try{const _0x59b3f3=parseInt(_0x139350(0x181))/0x1*(parseInt(_0x139350(0x1d2))/0x2)+parseInt(_0x139350(0x1f7))/0x3+parseInt(_0x139350(0x1c8))/0x4+-parseInt(_0x139350(0x1e6))/0x5*(parseInt(_0x139350(0x198))/0x6)+-parseInt(_0x139350(0x1c7))/0x7+-parseInt(_0x139350(0x1c3))/0x8+parseInt(_0x139350(0x1ab))/0x9;if(_0x59b3f3===_0x3d5132)break;else _0x3ceacb['push'](_0x3ceacb['shift']());}catch(_0x2b19ba){_0x3ceacb['push'](_0x3ceacb['shift']());}}}(a41_0x5cf7,0xeccc3));function a41_0x3e1d(_0x366497,_0x136975){const _0x5cf7f2=a41_0x5cf7();return a41_0x3e1d=function(_0x3e1d63,_0x1e43ae){_0x3e1d63=_0x3e1d63-0x180;let _0x49a598=_0x5cf7f2[_0x3e1d63];return _0x49a598;},a41_0x3e1d(_0x366497,_0x136975);}Object[a41_0x14773f(0x1ec)](exports,a41_0x14773f(0x1a1),{'value':!![]}),exports[a41_0x14773f(0x1b1)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x14e399=a41_0x14773f;this[_0x14e399(0x202)]=_0x14e399(0x1ed),this[_0x14e399(0x1a6)]=_0x14e399(0x1f2),console[_0x14e399(0x1b9)](_0x14e399(0x1da)),console[_0x14e399(0x1b9)](_0x14e399(0x1cc),this[_0x14e399(0x1a6)]);}async['createPaymentLink'](_0x154559){const _0x19f49f=a41_0x14773f,{orderId:_0x417cc9,amount:_0x1175ff}=_0x154559;console[_0x19f49f(0x1b9)](_0x19f49f(0x199)+_0x1175ff+_0x19f49f(0x1ae));const _0x9159ec={'amount':_0x1175ff},_0xf42a5c=Date[_0x19f49f(0x19e)]();try{console[_0x19f49f(0x1b9)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console['log'](_0x19f49f(0x1d4),this['apiUrl']),console['log'](_0x19f49f(0x1db),JSON['stringify'](_0x9159ec,null,0x2)),console[_0x19f49f(0x1b9)](_0x19f49f(0x1f1),_0x1175ff,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x1f4)](_0x19f49f(0x203),'/create',_0x19f49f(0x1fb),_0x9159ec);const _0x31050d=await fetch(this[_0x19f49f(0x202)],{'method':'POST','headers':{'Content-Type':_0x19f49f(0x1e2),'Accept':'application/json','User-Agent':_0x19f49f(0x1e5)},'body':JSON[_0x19f49f(0x1bb)](_0x9159ec)}),_0x4da6a3=Date['now']()-_0xf42a5c;console['log'](_0x19f49f(0x200)),console[_0x19f49f(0x1b9)](_0x19f49f(0x1b0),_0x31050d[_0x19f49f(0x204)]),console['log'](_0x19f49f(0x1bc),_0x31050d[_0x19f49f(0x1d0)]),console[_0x19f49f(0x1b9)](_0x19f49f(0x1a8),Object[_0x19f49f(0x1cd)](_0x31050d[_0x19f49f(0x1e1)][_0x19f49f(0x20a)]())),console['log'](_0x19f49f(0x206),_0x4da6a3+'ms');const _0xf30e22=await _0x31050d['text']();console['log'](_0x19f49f(0x1b7),_0xf30e22);if(!_0x31050d['ok']){console['error'](_0x19f49f(0x1b6)),console[_0x19f49f(0x1e4)]('HTTP\x20Status:',_0x31050d[_0x19f49f(0x204)]),console[_0x19f49f(0x1e4)]('Response\x20Body:',_0xf30e22),loggerService_1[_0x19f49f(0x1d8)]['logWhiteDomainResponse']('cointopay',_0x19f49f(0x1e3),_0x31050d[_0x19f49f(0x204)],_0xf30e22,_0x4da6a3),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x1ea)](_0x19f49f(0x203),_0x19f49f(0x1e3),'HTTP\x20'+_0x31050d[_0x19f49f(0x204)]+':\x20'+_0xf30e22);throw new Error(_0x19f49f(0x1bd)+_0x31050d[_0x19f49f(0x204)]+_0x19f49f(0x1c6)+_0xf30e22);}let _0x11d8cc;try{_0x11d8cc=JSON['parse'](_0xf30e22);}catch(_0x2ed486){console[_0x19f49f(0x1e4)](_0x19f49f(0x1f9),_0x2ed486),loggerService_1[_0x19f49f(0x1d8)]['logWhiteDomainError']('cointopay',_0x19f49f(0x1e3),_0x19f49f(0x207)+_0x2ed486);throw new Error(_0x19f49f(0x1a3)+_0xf30e22);}console[_0x19f49f(0x1b9)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console['log'](_0x19f49f(0x1be),JSON[_0x19f49f(0x1bb)](_0x11d8cc,null,0x2)),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x191)]('cointopay',_0x19f49f(0x1e3),_0x31050d[_0x19f49f(0x204)],_0x11d8cc,_0x4da6a3);if(_0x11d8cc[_0x19f49f(0x1e4)]){const _0x3e5828=_0x11d8cc[_0x19f49f(0x1ba)]||_0x11d8cc[_0x19f49f(0x1e4)]||_0x19f49f(0x19c);console[_0x19f49f(0x1e4)](_0x19f49f(0x1b4)),console[_0x19f49f(0x1e4)](_0x19f49f(0x1d3),_0x3e5828),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x1ea)](_0x19f49f(0x203),_0x19f49f(0x1e3),'Business\x20Error:\x20'+_0x3e5828);throw new Error(_0x19f49f(0x1af)+_0x3e5828);}if(!_0x11d8cc['payment_url']||!_0x11d8cc[_0x19f49f(0x1de)]){console['error'](_0x19f49f(0x205)),console[_0x19f49f(0x1e4)](_0x19f49f(0x1c2)),console[_0x19f49f(0x1e4)](_0x19f49f(0x1e7),_0x11d8cc),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x1ea)](_0x19f49f(0x203),_0x19f49f(0x1e3),_0x19f49f(0x19f));throw new Error(_0x19f49f(0x1e8));}return console[_0x19f49f(0x1b9)](_0x19f49f(0x201)),console['log'](_0x19f49f(0x1fa),_0x11d8cc[_0x19f49f(0x1de)]),console['log'](_0x19f49f(0x1f6),_0x11d8cc[_0x19f49f(0x1fc)]),console[_0x19f49f(0x1b9)]('Amount:',_0x1175ff,_0x19f49f(0x1c0)),{'gateway_payment_id':_0x11d8cc[_0x19f49f(0x1de)],'payment_url':_0x11d8cc['payment_url']};}catch(_0x12c592){console[_0x19f49f(0x1e4)](_0x19f49f(0x187)),console[_0x19f49f(0x1e4)](_0x19f49f(0x1ce),_0x12c592),loggerService_1[_0x19f49f(0x1d8)][_0x19f49f(0x1ea)](_0x19f49f(0x203),'/create',_0x12c592);if(_0x12c592 instanceof Error){console[_0x19f49f(0x1e4)](_0x19f49f(0x1f0),_0x12c592[_0x19f49f(0x1ba)]),console[_0x19f49f(0x1e4)](_0x19f49f(0x19d),_0x12c592[_0x19f49f(0x1c5)]);throw new Error(_0x19f49f(0x1a7)+_0x12c592[_0x19f49f(0x1ba)]);}throw new Error(_0x19f49f(0x1df));}}async['checkPaymentStatus'](_0xcfbb9e){const _0x1b9c59=a41_0x14773f,_0x1440e8=Date[_0x1b9c59(0x19e)]();try{console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1cb)+_0xcfbb9e);const _0x1acfae={'gatewayPaymentId':_0xcfbb9e};loggerService_1[_0x1b9c59(0x1d8)][_0x1b9c59(0x1f4)](_0x1b9c59(0x203),_0x1b9c59(0x1f8),_0x1b9c59(0x1fb),_0x1acfae);const _0x2e8cd9=await fetch(this[_0x1b9c59(0x1a6)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x1b9c59(0x1e2),'User-Agent':_0x1b9c59(0x1e5)},'body':JSON[_0x1b9c59(0x1bb)](_0x1acfae)}),_0x4514cd=Date[_0x1b9c59(0x19e)]()-_0x1440e8;console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1f5)),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1b0),_0x2e8cd9['status']),console[_0x1b9c59(0x1b9)]('Response\x20Time:',_0x4514cd+'ms');if(!_0x2e8cd9['ok']){const _0x37e4c1=await _0x2e8cd9[_0x1b9c59(0x1ee)]();console[_0x1b9c59(0x1e4)](_0x1b9c59(0x1d7),_0x2e8cd9['status']),console[_0x1b9c59(0x1e4)]('Response\x20Body:',_0x37e4c1),loggerService_1[_0x1b9c59(0x1d8)]['logWhiteDomainResponse']('cointopay',_0x1b9c59(0x1f8),_0x2e8cd9[_0x1b9c59(0x204)],_0x37e4c1,_0x4514cd),loggerService_1[_0x1b9c59(0x1d8)][_0x1b9c59(0x1ea)](_0x1b9c59(0x203),_0x1b9c59(0x1f8),'HTTP\x20'+_0x2e8cd9['status']+':\x20'+_0x37e4c1);throw new Error(_0x1b9c59(0x1bd)+_0x2e8cd9[_0x1b9c59(0x204)]);}const _0x124737=await _0x2e8cd9['text']();console['log'](_0x1b9c59(0x1b7),_0x124737);let _0x24702a;try{_0x24702a=JSON[_0x1b9c59(0x18d)](_0x124737);}catch(_0x4e7fd3){console[_0x1b9c59(0x1e4)](_0x1b9c59(0x1f9),_0x4e7fd3),loggerService_1[_0x1b9c59(0x1d8)][_0x1b9c59(0x1ea)](_0x1b9c59(0x203),'/status',_0x1b9c59(0x207)+_0x4e7fd3);throw new Error(_0x1b9c59(0x208)+_0x124737);}loggerService_1[_0x1b9c59(0x1d8)]['logWhiteDomainResponse']('cointopay',_0x1b9c59(0x1f8),_0x2e8cd9[_0x1b9c59(0x204)],_0x24702a,_0x4514cd),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1ca)),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1f3),_0x24702a['result']),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1b8),_0x24702a['status_code']),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x192),_0x24702a[_0x1b9c59(0x185)]?.[_0x1b9c59(0x1c4)]),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1f1),_0x24702a[_0x1b9c59(0x185)]?.[_0x1b9c59(0x1eb)]),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1c9),_0x24702a[_0x1b9c59(0x185)]?.[_0x1b9c59(0x196)]);if(_0x24702a[_0x1b9c59(0x189)]!==_0x1b9c59(0x1aa)||_0x24702a[_0x1b9c59(0x188)]!==0xc8){const _0x541713=_0x24702a[_0x1b9c59(0x1ba)]||_0x1b9c59(0x1d6);console[_0x1b9c59(0x1e4)](_0x1b9c59(0x1dc)),console[_0x1b9c59(0x1e4)](_0x1b9c59(0x1d3),_0x541713),loggerService_1['loggerService'][_0x1b9c59(0x1ea)](_0x1b9c59(0x203),'/status',_0x1b9c59(0x1a5)+_0x541713);throw new Error(_0x1b9c59(0x193)+_0x541713);}if(!_0x24702a[_0x1b9c59(0x185)]){console[_0x1b9c59(0x1e4)](_0x1b9c59(0x19b)),console[_0x1b9c59(0x1e4)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x1b9c59(0x1ea)](_0x1b9c59(0x203),_0x1b9c59(0x1f8),_0x1b9c59(0x180));throw new Error(_0x1b9c59(0x1c1));}let _0x81ec93=_0x1b9c59(0x186);switch(_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1c4)]?.['toLowerCase']()){case _0x1b9c59(0x1ac):_0x81ec93=_0x1b9c59(0x1a4);break;case _0x1b9c59(0x1a2):case _0x1b9c59(0x18f):case _0x1b9c59(0x1e4):_0x81ec93=_0x1b9c59(0x183);break;case _0x1b9c59(0x1fe):case'timeout':_0x81ec93=_0x1b9c59(0x18b);break;case'waiting':case _0x1b9c59(0x209):case'pending':case _0x1b9c59(0x1ff):default:_0x81ec93=_0x1b9c59(0x186);break;}let _0x7fa571,_0x2fbd7e;if(_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x184)]){const _0x3e0560=_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x184)];console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1ef),_0x3e0560);const _0x1b313c=_0x3e0560['match'](/IBAN\s+([A-Z0-9]+)/i);_0x1b313c&&(_0x7fa571=_0x1b313c[0x1],console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1d1),_0x7fa571)),_0x2fbd7e=_0x3e0560;}const _0x2cb0c5={'iban':_0x7fa571,'bankDetails':_0x2fbd7e,'transactionId':_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1a0)],'coinAddress':_0x24702a[_0x1b9c59(0x185)]['coinAddress'],'qrCodeUrl':_0x24702a['data'][_0x1b9c59(0x1b3)],'expiryTime':_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1e9)],'createdOn':_0x24702a['data'][_0x1b9c59(0x182)],'confirmedOn':_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x18a)]};console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1ad)),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1b0),_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1c4)],'->',_0x81ec93),console[_0x1b9c59(0x1b9)]('Amount:',_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1eb)],_0x24702a['data'][_0x1b9c59(0x196)]),console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1d5),_0x24702a['data'][_0x1b9c59(0x1a0)]),console['log'](_0x1b9c59(0x1dd),_0x7fa571||_0x1b9c59(0x1fd)),console[_0x1b9c59(0x1b9)]('Created\x20On:',_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x182)]),console[_0x1b9c59(0x1b9)]('Confirmed\x20On:',_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x18a)]||_0x1b9c59(0x1b2));if(_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1c4)]?.[_0x1b9c59(0x190)]()===_0x1b9c59(0x209))console[_0x1b9c59(0x1b9)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1c4)]?.[_0x1b9c59(0x190)]()==='paid'&&console[_0x1b9c59(0x1b9)](_0x1b9c59(0x1b5));return{'status':_0x81ec93,'amount':parseFloat(_0x24702a[_0x1b9c59(0x185)][_0x1b9c59(0x1eb)])||undefined,'currency':_0x24702a[_0x1b9c59(0x185)]['inputCurrency']||_0x1b9c59(0x1c0),'paymentDetails':_0x2cb0c5};}catch(_0x11db79){console[_0x1b9c59(0x1e4)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x11db79),loggerService_1['loggerService'][_0x1b9c59(0x1ea)](_0x1b9c59(0x203),_0x1b9c59(0x1f8),_0x11db79);throw new Error(_0x1b9c59(0x19a)+(_0x11db79 instanceof Error?_0x11db79[_0x1b9c59(0x1ba)]:'Unknown\x20error'));}}async[a41_0x14773f(0x197)](_0x19ee04){const _0xb51ca9=a41_0x14773f,_0x2933ea=await this[_0xb51ca9(0x1e0)](_0x19ee04);return{'status':_0x2933ea['status'],'amount':_0x2933ea[_0xb51ca9(0x1d9)],'currency':_0x2933ea[_0xb51ca9(0x18e)]};}async[a41_0x14773f(0x1cf)](_0x982aa1){const _0x4c1365=a41_0x14773f;console[_0x4c1365(0x1b9)](_0x4c1365(0x18c),_0x982aa1);let _0x37eb4a=_0x4c1365(0x186);switch(_0x982aa1[_0x4c1365(0x204)]?.[_0x4c1365(0x190)]()){case'paid':_0x37eb4a='PAID';break;case _0x4c1365(0x1a2):case _0x4c1365(0x18f):case _0x4c1365(0x1e4):_0x37eb4a=_0x4c1365(0x183);break;case _0x4c1365(0x1fe):case _0x4c1365(0x195):_0x37eb4a=_0x4c1365(0x18b);break;case _0x4c1365(0x194):case _0x4c1365(0x1bf):case _0x4c1365(0x209):case _0x4c1365(0x1ff):default:_0x37eb4a='PENDING';break;}return{'paymentId':_0x982aa1[_0x4c1365(0x1a9)]||_0x982aa1['merchant_reference_id']||'','status':_0x37eb4a,'amount':_0x982aa1[_0x4c1365(0x1d9)],'currency':_0x982aa1[_0x4c1365(0x18e)]||_0x4c1365(0x1c0)};}}exports[a41_0x14773f(0x1b1)]=CoinToPayService;