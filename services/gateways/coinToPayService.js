'use strict';function a57_0x2e1d(_0x5a668e,_0x386271){_0x5a668e=_0x5a668e-0x147;const _0x3a1404=a57_0x3a14();let _0x2e1d21=_0x3a1404[_0x5a668e];return _0x2e1d21;}const a57_0x327b17=a57_0x2e1d;function a57_0x3a14(){const _0x1a5842=['Error\x20message:','error','checkPaymentStatus','Error\x20stack:','6323718ODYOFu','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','loggerService','statusText','text','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','TransactionID','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','toLowerCase','gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','470rDCTVa','JSON\x20Parse\x20Error:\x20','Status','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Status\x20Code:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','\x20EUR','CreatedOn','now','parse','__esModule','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Confirmed\x20On:','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','499778XkXDEL','CoinToPay\x20API\x20error:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','order_id','11348RmOvzy','data','Response\x20Body:','inputCurrency','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','status','Status:','verifyPayment','match','awaiting\x20fiat','1093092qzLYCt','payment_url','Result:','Failed\x20to\x20parse\x20JSON\x20response:','cancelled','Currency:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','result','entries','ðŸ¦\x20Payment\x20Detail:','Created\x20On:','Missing\x20data\x20in\x20response','createPaymentLink','stringify','Business\x20Error:\x20','EUR','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Payment\x20System/1.0','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','../loggerService','Amount:','Unknown\x20error','===\x20COINTOPAY\x20SUCCESS\x20===','merchant_reference_id','QRCodeURL','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','651kNMdPH','headers','CoinToPay\x20status\x20API\x20error:\x20','Response\x20Time:','https://tesoft.uk/gateway/cointopay/','Transaction\x20ID:','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','statusUrl','HTTP\x20','92331XLoehE','log','currency','coinAddress','stack','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','===\x20COINTOPAY\x20API\x20ERROR\x20===','&alternative=false','EXPIRED','processWebhook','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','POST','application/json','expired','fromEntries','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','waiting','PaymentDetail','logWhiteDomainResponse','Unknown\x20error\x20from\x20CoinToPay\x20API','cointopay','failed','status_code','paid','FAILED','/status','Parsed\x20Result:','CoinToPayService','Gateway\x20Payment\x20ID:','PENDING','151590tgjGGJ','Request\x20Body:','PAID','24yDiyss','Response\x20data:','apiUrl','Payment\x20URL\x20(modified):','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','URL:','logWhiteDomainError','HTTP\x20error!\x20status:\x20','logWhiteDomainRequest','Error\x20Message:','Raw\x20Response\x20Body:','timeout','1628368jIeUAe','message','ðŸ“Š\x20Status\x20check\x20URL:','ExpiryTime','pending','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20details:','/create','created','Payment\x20Status:','Amount','defineProperty','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','not\x20confirmed','TransactionConfirmedOn','amount'];a57_0x3a14=function(){return _0x1a5842;};return a57_0x3a14();}(function(_0x5e7a47,_0xfc1af5){const _0x5f5a36=a57_0x2e1d,_0x3c7dc6=_0x5e7a47();while(!![]){try{const _0x4deafd=parseInt(_0x5f5a36(0x180))/0x1+-parseInt(_0x5f5a36(0x18e))/0x2+parseInt(_0x5f5a36(0x1a8))/0x3*(-parseInt(_0x5f5a36(0x184))/0x4)+-parseInt(_0x5f5a36(0x1d1))/0x5+parseInt(_0x5f5a36(0x165))/0x6+parseInt(_0x5f5a36(0x151))/0x7*(parseInt(_0x5f5a36(0x1d4))/0x8)+parseInt(_0x5f5a36(0x1b1))/0x9*(-parseInt(_0x5f5a36(0x171))/0xa);if(_0x4deafd===_0xfc1af5)break;else _0x3c7dc6['push'](_0x3c7dc6['shift']());}catch(_0x4eb26e){_0x3c7dc6['push'](_0x3c7dc6['shift']());}}}(a57_0x3a14,0x8cda9));Object[a57_0x327b17(0x15c)](exports,a57_0x327b17(0x17c),{'value':!![]}),exports[a57_0x327b17(0x1ce)]=void 0x0;const loggerService_1=require(a57_0x327b17(0x1a1));class CoinToPayService{constructor(){const _0x225918=a57_0x327b17;this[_0x225918(0x1d6)]=_0x225918(0x1ac),this[_0x225918(0x1af)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x225918(0x1b2)](_0x225918(0x1ae)),console[_0x225918(0x1b2)](_0x225918(0x153),this[_0x225918(0x1af)]);}async[a57_0x327b17(0x19a)](_0x1f89a1){const _0x2d9c71=a57_0x327b17,{orderId:_0x1e2181,amount:_0x1dbc5c}=_0x1f89a1;console['log'](_0x2d9c71(0x16b)+_0x1dbc5c+_0x2d9c71(0x178));const _0x2cd90c={'amount':_0x1dbc5c},_0x2b8a14=Date['now']();try{console['log'](_0x2d9c71(0x156)),console[_0x2d9c71(0x1b2)](_0x2d9c71(0x14a),this[_0x2d9c71(0x1d6)]),console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1d2),JSON[_0x2d9c71(0x19b)](_0x2cd90c,null,0x2)),console['log'](_0x2d9c71(0x1a2),_0x1dbc5c,_0x2d9c71(0x1b7)),loggerService_1[_0x2d9c71(0x167)][_0x2d9c71(0x14d)]('cointopay',_0x2d9c71(0x158),_0x2d9c71(0x1be),_0x2cd90c);const _0x27ab7f=await fetch(this[_0x2d9c71(0x1d6)],{'method':_0x2d9c71(0x1be),'headers':{'Content-Type':_0x2d9c71(0x1bf),'Accept':_0x2d9c71(0x1bf),'User-Agent':_0x2d9c71(0x19f)},'body':JSON[_0x2d9c71(0x19b)](_0x2cd90c)}),_0x2c4af6=Date[_0x2d9c71(0x17a)]()-_0x2b8a14;console[_0x2d9c71(0x1b2)](_0x2d9c71(0x19e)),console['log'](_0x2d9c71(0x18a),_0x27ab7f[_0x2d9c71(0x189)]),console[_0x2d9c71(0x1b2)]('Status\x20Text:',_0x27ab7f[_0x2d9c71(0x168)]),console['log']('Headers:',Object[_0x2d9c71(0x1c1)](_0x27ab7f[_0x2d9c71(0x1a9)][_0x2d9c71(0x196)]())),console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1ab),_0x2c4af6+'ms');const _0x38ef33=await _0x27ab7f[_0x2d9c71(0x169)]();console[_0x2d9c71(0x1b2)](_0x2d9c71(0x14f),_0x38ef33);if(!_0x27ab7f['ok']){console[_0x2d9c71(0x162)](_0x2d9c71(0x1b8)),console[_0x2d9c71(0x162)](_0x2d9c71(0x148),_0x27ab7f[_0x2d9c71(0x189)]),console['error'](_0x2d9c71(0x186),_0x38ef33),loggerService_1['loggerService'][_0x2d9c71(0x1c5)](_0x2d9c71(0x1c7),'/create',_0x27ab7f[_0x2d9c71(0x189)],_0x38ef33,_0x2c4af6),loggerService_1[_0x2d9c71(0x167)]['logWhiteDomainError'](_0x2d9c71(0x1c7),_0x2d9c71(0x158),'HTTP\x20'+_0x27ab7f[_0x2d9c71(0x189)]+':\x20'+_0x38ef33);throw new Error(_0x2d9c71(0x14c)+_0x27ab7f[_0x2d9c71(0x189)]+',\x20body:\x20'+_0x38ef33);}let _0x1d413a;try{_0x1d413a=JSON[_0x2d9c71(0x17b)](_0x38ef33);}catch(_0x3d6fa1){console[_0x2d9c71(0x162)](_0x2d9c71(0x191),_0x3d6fa1),loggerService_1[_0x2d9c71(0x167)][_0x2d9c71(0x14b)]('cointopay',_0x2d9c71(0x158),_0x2d9c71(0x172)+_0x3d6fa1);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x38ef33);}console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1bc)),console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1cd),JSON[_0x2d9c71(0x19b)](_0x1d413a,null,0x2)),loggerService_1['loggerService'][_0x2d9c71(0x1c5)]('cointopay',_0x2d9c71(0x158),_0x27ab7f['status'],_0x1d413a,_0x2c4af6);if(_0x1d413a[_0x2d9c71(0x162)]){const _0xbfd6c7=_0x1d413a['message']||_0x1d413a[_0x2d9c71(0x162)]||_0x2d9c71(0x1c6);console[_0x2d9c71(0x162)](_0x2d9c71(0x176)),console[_0x2d9c71(0x162)](_0x2d9c71(0x14e),_0xbfd6c7),loggerService_1[_0x2d9c71(0x167)][_0x2d9c71(0x14b)](_0x2d9c71(0x1c7),_0x2d9c71(0x158),_0x2d9c71(0x19c)+_0xbfd6c7);throw new Error(_0x2d9c71(0x181)+_0xbfd6c7);}if(!_0x1d413a[_0x2d9c71(0x18f)]||!_0x1d413a[_0x2d9c71(0x16f)]){console['error'](_0x2d9c71(0x17d)),console[_0x2d9c71(0x162)](_0x2d9c71(0x174)),console[_0x2d9c71(0x162)](_0x2d9c71(0x1d5),_0x1d413a),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x2d9c71(0x158),_0x2d9c71(0x1bd));throw new Error(_0x2d9c71(0x1a7));}console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1a4)),console[_0x2d9c71(0x1b2)](_0x2d9c71(0x1cf),_0x1d413a[_0x2d9c71(0x16f)]),console[_0x2d9c71(0x1b2)]('Payment\x20URL\x20(original):',_0x1d413a['payment_url']);const _0x51f3c3=_0x1d413a[_0x2d9c71(0x18f)]+_0x2d9c71(0x1b9);return console[_0x2d9c71(0x1b2)](_0x2d9c71(0x147),_0x51f3c3),console['log'](_0x2d9c71(0x1a2),_0x1dbc5c,_0x2d9c71(0x19d)),{'gateway_payment_id':_0x1d413a[_0x2d9c71(0x16f)],'payment_url':_0x51f3c3};}catch(_0x8f40f2){console[_0x2d9c71(0x162)](_0x2d9c71(0x166)),console[_0x2d9c71(0x162)](_0x2d9c71(0x157),_0x8f40f2),loggerService_1[_0x2d9c71(0x167)][_0x2d9c71(0x14b)]('cointopay',_0x2d9c71(0x158),_0x8f40f2);if(_0x8f40f2 instanceof Error){console[_0x2d9c71(0x162)](_0x2d9c71(0x161),_0x8f40f2[_0x2d9c71(0x152)]),console['error'](_0x2d9c71(0x164),_0x8f40f2[_0x2d9c71(0x1b5)]);throw new Error(_0x2d9c71(0x177)+_0x8f40f2[_0x2d9c71(0x152)]);}throw new Error(_0x2d9c71(0x194));}}async[a57_0x327b17(0x163)](_0x279707){const _0x9829e9=a57_0x327b17,_0x713b3a=Date[_0x9829e9(0x17a)]();try{console[_0x9829e9(0x1b2)](_0x9829e9(0x15d)+_0x279707);const _0x5735fb={'gatewayPaymentId':_0x279707};loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x14d)](_0x9829e9(0x1c7),_0x9829e9(0x1cc),'POST',_0x5735fb);const _0x4c9b80=await fetch(this[_0x9829e9(0x1af)],{'method':_0x9829e9(0x1be),'headers':{'Content-Type':_0x9829e9(0x1bf),'Accept':_0x9829e9(0x1bf),'User-Agent':_0x9829e9(0x19f)},'body':JSON['stringify'](_0x5735fb)}),_0x1b2ed7=Date[_0x9829e9(0x17a)]()-_0x713b3a;console[_0x9829e9(0x1b2)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x9829e9(0x1b2)](_0x9829e9(0x18a),_0x4c9b80[_0x9829e9(0x189)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x1ab),_0x1b2ed7+'ms');if(!_0x4c9b80['ok']){const _0x3bf47b=await _0x4c9b80[_0x9829e9(0x169)]();console[_0x9829e9(0x162)](_0x9829e9(0x148),_0x4c9b80['status']),console[_0x9829e9(0x162)](_0x9829e9(0x186),_0x3bf47b),loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x1c5)](_0x9829e9(0x1c7),'/status',_0x4c9b80[_0x9829e9(0x189)],_0x3bf47b,_0x1b2ed7),loggerService_1[_0x9829e9(0x167)]['logWhiteDomainError'](_0x9829e9(0x1c7),_0x9829e9(0x1cc),_0x9829e9(0x1b0)+_0x4c9b80[_0x9829e9(0x189)]+':\x20'+_0x3bf47b);throw new Error(_0x9829e9(0x14c)+_0x4c9b80[_0x9829e9(0x189)]);}const _0x4febc4=await _0x4c9b80['text']();console['log'](_0x9829e9(0x14f),_0x4febc4);let _0x36cb34;try{_0x36cb34=JSON[_0x9829e9(0x17b)](_0x4febc4);}catch(_0x5bffeb){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5bffeb),loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x14b)](_0x9829e9(0x1c7),_0x9829e9(0x1cc),'JSON\x20Parse\x20Error:\x20'+_0x5bffeb);throw new Error(_0x9829e9(0x149)+_0x4febc4);}loggerService_1['loggerService'][_0x9829e9(0x1c5)]('cointopay',_0x9829e9(0x1cc),_0x4c9b80[_0x9829e9(0x189)],_0x36cb34,_0x1b2ed7),console['log'](_0x9829e9(0x170)),console['log'](_0x9829e9(0x190),_0x36cb34[_0x9829e9(0x195)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x175),_0x36cb34[_0x9829e9(0x1c9)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x15a),_0x36cb34['data']?.[_0x9829e9(0x173)]),console['log'](_0x9829e9(0x1a2),_0x36cb34['data']?.[_0x9829e9(0x15b)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x193),_0x36cb34['data']?.[_0x9829e9(0x187)]);if(_0x36cb34[_0x9829e9(0x195)]!=='success'||_0x36cb34[_0x9829e9(0x1c9)]!==0xc8){const _0x51c400=_0x36cb34[_0x9829e9(0x152)]||_0x9829e9(0x1c2);console[_0x9829e9(0x162)](_0x9829e9(0x188)),console[_0x9829e9(0x162)](_0x9829e9(0x14e),_0x51c400),loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x14b)](_0x9829e9(0x1c7),_0x9829e9(0x1cc),'Status\x20API\x20Error:\x20'+_0x51c400);throw new Error(_0x9829e9(0x1aa)+_0x51c400);}if(!_0x36cb34['data']){console[_0x9829e9(0x162)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x9829e9(0x199)),loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x14b)]('cointopay',_0x9829e9(0x1cc),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x9829e9(0x1a0));}let _0x2a33d4=_0x9829e9(0x1d0);switch(_0x36cb34[_0x9829e9(0x185)]['Status']?.[_0x9829e9(0x16e)]()){case'paid':_0x2a33d4=_0x9829e9(0x1d3);break;case _0x9829e9(0x192):case _0x9829e9(0x1c8):case _0x9829e9(0x162):_0x2a33d4=_0x9829e9(0x1cb);break;case _0x9829e9(0x1c0):case _0x9829e9(0x150):_0x2a33d4=_0x9829e9(0x1ba);break;case _0x9829e9(0x1c3):case _0x9829e9(0x18d):case'pending':case _0x9829e9(0x159):default:_0x2a33d4='PENDING';break;}let _0x537d0a,_0x1c8eba;if(_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x1c4)]){const _0x1d672f=_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x1c4)];console[_0x9829e9(0x1b2)](_0x9829e9(0x197),_0x1d672f);const _0x17396a=_0x1d672f[_0x9829e9(0x18c)](/IBAN\s+([A-Z0-9]+)/i);_0x17396a&&(_0x537d0a=_0x17396a[0x1],console['log']('ðŸ¦\x20Extracted\x20IBAN:',_0x537d0a)),_0x1c8eba=_0x1d672f;}const _0x5dfe08={'iban':_0x537d0a,'bankDetails':_0x1c8eba,'transactionId':_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x16c)],'coinAddress':_0x36cb34['data'][_0x9829e9(0x1b4)],'qrCodeUrl':_0x36cb34['data'][_0x9829e9(0x1a6)],'expiryTime':_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x154)],'createdOn':_0x36cb34['data'][_0x9829e9(0x179)],'confirmedOn':_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x15f)]};console[_0x9829e9(0x1b2)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x9829e9(0x1b2)](_0x9829e9(0x18a),_0x36cb34['data'][_0x9829e9(0x173)],'->',_0x2a33d4),console['log'](_0x9829e9(0x1a2),_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x15b)],_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x187)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x1ad),_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x16c)]),console[_0x9829e9(0x1b2)]('IBAN:',_0x537d0a||'not\x20found'),console[_0x9829e9(0x1b2)](_0x9829e9(0x198),_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x179)]),console[_0x9829e9(0x1b2)](_0x9829e9(0x17e),_0x36cb34['data']['TransactionConfirmedOn']||_0x9829e9(0x15e));if(_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x173)]?.['toLowerCase']()===_0x9829e9(0x18d))console[_0x9829e9(0x1b2)](_0x9829e9(0x1b6));else _0x36cb34['data'][_0x9829e9(0x173)]?.['toLowerCase']()===_0x9829e9(0x1ca)&&console[_0x9829e9(0x1b2)](_0x9829e9(0x17f));return{'status':_0x2a33d4,'amount':parseFloat(_0x36cb34['data'][_0x9829e9(0x15b)])||undefined,'currency':_0x36cb34[_0x9829e9(0x185)][_0x9829e9(0x187)]||_0x9829e9(0x19d),'paymentDetails':_0x5dfe08};}catch(_0x50f8bf){console[_0x9829e9(0x162)](_0x9829e9(0x182),_0x50f8bf),loggerService_1[_0x9829e9(0x167)][_0x9829e9(0x14b)]('cointopay',_0x9829e9(0x1cc),_0x50f8bf);throw new Error(_0x9829e9(0x16d)+(_0x50f8bf instanceof Error?_0x50f8bf['message']:_0x9829e9(0x1a3)));}}async[a57_0x327b17(0x18b)](_0xbd4e4f){const _0x5af810=a57_0x327b17,_0x84aa6b=await this['checkPaymentStatus'](_0xbd4e4f);return{'status':_0x84aa6b['status'],'amount':_0x84aa6b[_0x5af810(0x160)],'currency':_0x84aa6b[_0x5af810(0x1b3)]};}async[a57_0x327b17(0x1bb)](_0x33584a){const _0x386d06=a57_0x327b17;console['log'](_0x386d06(0x16a),_0x33584a);let _0x554e13=_0x386d06(0x1d0);switch(_0x33584a['status']?.['toLowerCase']()){case _0x386d06(0x1ca):_0x554e13=_0x386d06(0x1d3);break;case _0x386d06(0x192):case _0x386d06(0x1c8):case'error':_0x554e13='FAILED';break;case _0x386d06(0x1c0):case _0x386d06(0x150):_0x554e13=_0x386d06(0x1ba);break;case _0x386d06(0x155):case _0x386d06(0x1c3):case _0x386d06(0x18d):case _0x386d06(0x159):default:_0x554e13=_0x386d06(0x1d0);break;}return{'paymentId':_0x33584a[_0x386d06(0x183)]||_0x33584a[_0x386d06(0x1a5)]||'','status':_0x554e13,'amount':_0x33584a[_0x386d06(0x160)],'currency':_0x33584a['currency']||_0x386d06(0x19d)};}}exports['CoinToPayService']=CoinToPayService;