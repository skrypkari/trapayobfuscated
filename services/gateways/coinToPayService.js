'use strict';const a43_0x391ea7=a43_0x5d8f;(function(_0x385485,_0x32f13c){const _0xe2c69=a43_0x5d8f,_0x50bd9f=_0x385485();while(!![]){try{const _0x125dbc=parseInt(_0xe2c69(0x150))/0x1*(-parseInt(_0xe2c69(0x166))/0x2)+parseInt(_0xe2c69(0x16b))/0x3*(-parseInt(_0xe2c69(0x13c))/0x4)+parseInt(_0xe2c69(0x117))/0x5*(-parseInt(_0xe2c69(0x156))/0x6)+parseInt(_0xe2c69(0x15f))/0x7*(-parseInt(_0xe2c69(0x14d))/0x8)+parseInt(_0xe2c69(0x14c))/0x9*(-parseInt(_0xe2c69(0x148))/0xa)+-parseInt(_0xe2c69(0x115))/0xb*(-parseInt(_0xe2c69(0x114))/0xc)+-parseInt(_0xe2c69(0x157))/0xd*(-parseInt(_0xe2c69(0x13b))/0xe);if(_0x125dbc===_0x32f13c)break;else _0x50bd9f['push'](_0x50bd9f['shift']());}catch(_0x3fd965){_0x50bd9f['push'](_0x50bd9f['shift']());}}}(a43_0x3542,0x5f829));function a43_0x3542(){const _0x3993fb=['HTTP\x20','application/json','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Result:','merchant_reference_id','apiUrl','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','parse','cancelled','IBAN:','logWhiteDomainError','Gateway\x20Payment\x20ID:','inputCurrency','Headers:','log','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','result','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','PAID','16233182Ulrvxf','8TfXphI','Error\x20message:','Business\x20Error:\x20','PENDING','entries','statusText','QRCodeURL','Currency:','https://tesoft.uk/gateway/cointopay/','failed','cointopay','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','6001980isvQHO','HTTP\x20Status:','Created\x20On:','Missing\x20data\x20in\x20response','9kBiymx','24ZzhAwY','Response\x20Body:','awaiting\x20fiat','203691ILdiHt','TesSoft\x20Payment\x20System/1.0','Raw\x20Response\x20Body:','/status','fromEntries','../loggerService','3912642Mrbapw','26IbQBtK','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','logWhiteDomainResponse','HTTP\x20error!\x20status:\x20','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','createPaymentLink','\x20EUR','Amount','1709113HJRPUu','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','message','coinAddress','created','error','status','2pmASnK','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','amount','JSON\x20Parse\x20Error:\x20','EUR','188124pYXtPf','Payment\x20Status:','pending','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','data','Status','not\x20found','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','loggerService','CoinToPayService','text','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','payment_url','headers','status_code','Error\x20Message:','üè¶\x20Extracted\x20IBAN:','TransactionID','Amount:','checkPaymentStatus','https://tesoft.uk/gateway/cointopay/status.php','EXPIRED','processWebhook','Transaction\x20ID:','paid','now','logWhiteDomainRequest','stringify','match','ExpiryTime','verifyPayment','__esModule','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','POST','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20COINTOPAY\x20API\x20ERROR\x20===','Request\x20Body:','===\x20COINTOPAY\x20SUCCESS\x20===','gateway_payment_id','expired','timeout','Response\x20Time:','Error\x20details:','/create','Failed\x20to\x20parse\x20JSON\x20response:','waiting','Status\x20Text:','96rlBIzT','530849nMzvaz','Status:','5OEBJpt','TransactionConfirmedOn','Confirmed\x20On:','PaymentDetail','Response\x20data:','order_id','toLowerCase','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Unknown\x20error','CreatedOn','statusUrl','üìä\x20Status\x20check\x20URL:'];a43_0x3542=function(){return _0x3993fb;};return a43_0x3542();}Object['defineProperty'](exports,a43_0x391ea7(0x103),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a43_0x391ea7(0x155));function a43_0x5d8f(_0x21ba03,_0x5e07be){const _0x3542a0=a43_0x3542();return a43_0x5d8f=function(_0x5d8fac,_0x9d5ada){_0x5d8fac=_0x5d8fac-0xf5;let _0xd51163=_0x3542a0[_0x5d8fac];return _0xd51163;},a43_0x5d8f(_0x21ba03,_0x5e07be);}class CoinToPayService{constructor(){const _0x5e8bab=a43_0x391ea7;this[_0x5e8bab(0x128)]=_0x5e8bab(0x144),this[_0x5e8bab(0x121)]=_0x5e8bab(0xf8),console[_0x5e8bab(0x133)](_0x5e8bab(0x147)),console['log'](_0x5e8bab(0x122),this['statusUrl']);}async[a43_0x391ea7(0x15c)](_0x5d57ab){const _0x1a4adf=a43_0x391ea7,{orderId:_0x7e2945,amount:_0x4b5749}=_0x5d57ab;console[_0x1a4adf(0x133)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x4b5749+_0x1a4adf(0x15d));const _0x48c74e={'amount':_0x4b5749},_0x16b412=Date[_0x1a4adf(0xfd)]();try{console[_0x1a4adf(0x133)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x1a4adf(0x133)]('URL:',this[_0x1a4adf(0x128)]),console[_0x1a4adf(0x133)](_0x1a4adf(0x109),JSON[_0x1a4adf(0xff)](_0x48c74e,null,0x2)),console[_0x1a4adf(0x133)](_0x1a4adf(0xf6),_0x4b5749,_0x1a4adf(0x134)),loggerService_1[_0x1a4adf(0x175)][_0x1a4adf(0xfe)]('cointopay',_0x1a4adf(0x110),_0x1a4adf(0x106),_0x48c74e);const _0x2a1357=await fetch(this[_0x1a4adf(0x128)],{'method':_0x1a4adf(0x106),'headers':{'Content-Type':_0x1a4adf(0x124),'Accept':'application/json','User-Agent':_0x1a4adf(0x151)},'body':JSON[_0x1a4adf(0xff)](_0x48c74e)}),_0x374007=Date[_0x1a4adf(0xfd)]()-_0x16b412;console['log'](_0x1a4adf(0x12a)),console[_0x1a4adf(0x133)](_0x1a4adf(0x116),_0x2a1357['status']),console[_0x1a4adf(0x133)](_0x1a4adf(0x113),_0x2a1357[_0x1a4adf(0x141)]),console['log'](_0x1a4adf(0x132),Object[_0x1a4adf(0x154)](_0x2a1357[_0x1a4adf(0x17a)][_0x1a4adf(0x140)]())),console[_0x1a4adf(0x133)](_0x1a4adf(0x10e),_0x374007+'ms');const _0x529936=await _0x2a1357['text']();console[_0x1a4adf(0x133)](_0x1a4adf(0x152),_0x529936);if(!_0x2a1357['ok']){console[_0x1a4adf(0x164)](_0x1a4adf(0x108)),console[_0x1a4adf(0x164)](_0x1a4adf(0x149),_0x2a1357['status']),console[_0x1a4adf(0x164)](_0x1a4adf(0x14e),_0x529936),loggerService_1[_0x1a4adf(0x175)]['logWhiteDomainResponse']('cointopay','/create',_0x2a1357[_0x1a4adf(0x165)],_0x529936,_0x374007),loggerService_1[_0x1a4adf(0x175)][_0x1a4adf(0x12f)](_0x1a4adf(0x146),_0x1a4adf(0x110),_0x1a4adf(0x123)+_0x2a1357[_0x1a4adf(0x165)]+':\x20'+_0x529936);throw new Error(_0x1a4adf(0x15a)+_0x2a1357['status']+',\x20body:\x20'+_0x529936);}let _0x3f9825;try{_0x3f9825=JSON[_0x1a4adf(0x12c)](_0x529936);}catch(_0x500472){console[_0x1a4adf(0x164)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x500472),loggerService_1['loggerService'][_0x1a4adf(0x12f)](_0x1a4adf(0x146),_0x1a4adf(0x110),_0x1a4adf(0x169)+_0x500472);throw new Error(_0x1a4adf(0x138)+_0x529936);}console[_0x1a4adf(0x133)](_0x1a4adf(0x167)),console[_0x1a4adf(0x133)]('Parsed\x20Result:',JSON['stringify'](_0x3f9825,null,0x2)),loggerService_1[_0x1a4adf(0x175)]['logWhiteDomainResponse'](_0x1a4adf(0x146),_0x1a4adf(0x110),_0x2a1357[_0x1a4adf(0x165)],_0x3f9825,_0x374007);if(_0x3f9825[_0x1a4adf(0x164)]){const _0x157235=_0x3f9825[_0x1a4adf(0x161)]||_0x3f9825['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x1a4adf(0x164)](_0x1a4adf(0x12b)),console[_0x1a4adf(0x164)](_0x1a4adf(0x17c),_0x157235),loggerService_1[_0x1a4adf(0x175)][_0x1a4adf(0x12f)](_0x1a4adf(0x146),_0x1a4adf(0x110),_0x1a4adf(0x13e)+_0x157235);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x157235);}if(!_0x3f9825[_0x1a4adf(0x179)]||!_0x3f9825[_0x1a4adf(0x10b)]){console[_0x1a4adf(0x164)](_0x1a4adf(0x104)),console[_0x1a4adf(0x164)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x1a4adf(0x164)](_0x1a4adf(0x11b),_0x3f9825),loggerService_1[_0x1a4adf(0x175)][_0x1a4adf(0x12f)](_0x1a4adf(0x146),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1a4adf(0x16f));}return console[_0x1a4adf(0x133)](_0x1a4adf(0x10a)),console['log'](_0x1a4adf(0x130),_0x3f9825[_0x1a4adf(0x10b)]),console[_0x1a4adf(0x133)]('Payment\x20URL:',_0x3f9825[_0x1a4adf(0x179)]),console[_0x1a4adf(0x133)](_0x1a4adf(0xf6),_0x4b5749,_0x1a4adf(0x16a)),{'gateway_payment_id':_0x3f9825[_0x1a4adf(0x10b)],'payment_url':_0x3f9825['payment_url']};}catch(_0x2e75ff){console[_0x1a4adf(0x164)](_0x1a4adf(0x160)),console['error'](_0x1a4adf(0x10f),_0x2e75ff),loggerService_1['loggerService'][_0x1a4adf(0x12f)](_0x1a4adf(0x146),_0x1a4adf(0x110),_0x2e75ff);if(_0x2e75ff instanceof Error){console[_0x1a4adf(0x164)](_0x1a4adf(0x13d),_0x2e75ff[_0x1a4adf(0x161)]),console[_0x1a4adf(0x164)]('Error\x20stack:',_0x2e75ff['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x2e75ff['message']);}throw new Error(_0x1a4adf(0x135));}}async[a43_0x391ea7(0xf7)](_0x380670){const _0x298d9f=a43_0x391ea7,_0x3269c2=Date[_0x298d9f(0xfd)]();try{console[_0x298d9f(0x133)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x380670);const _0xf641e3={'gatewayPaymentId':_0x380670};loggerService_1[_0x298d9f(0x175)]['logWhiteDomainRequest'](_0x298d9f(0x146),'/status',_0x298d9f(0x106),_0xf641e3);const _0x26c96c=await fetch(this[_0x298d9f(0x121)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x298d9f(0x124),'User-Agent':_0x298d9f(0x151)},'body':JSON['stringify'](_0xf641e3)}),_0x3bf1c2=Date['now']()-_0x3269c2;console[_0x298d9f(0x133)](_0x298d9f(0x174)),console['log'](_0x298d9f(0x116),_0x26c96c[_0x298d9f(0x165)]),console[_0x298d9f(0x133)](_0x298d9f(0x10e),_0x3bf1c2+'ms');if(!_0x26c96c['ok']){const _0x788d3b=await _0x26c96c[_0x298d9f(0x177)]();console[_0x298d9f(0x164)]('HTTP\x20Status:',_0x26c96c['status']),console['error'](_0x298d9f(0x14e),_0x788d3b),loggerService_1[_0x298d9f(0x175)][_0x298d9f(0x159)](_0x298d9f(0x146),_0x298d9f(0x153),_0x26c96c[_0x298d9f(0x165)],_0x788d3b,_0x3bf1c2),loggerService_1[_0x298d9f(0x175)]['logWhiteDomainError']('cointopay',_0x298d9f(0x153),_0x298d9f(0x123)+_0x26c96c[_0x298d9f(0x165)]+':\x20'+_0x788d3b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x26c96c[_0x298d9f(0x165)]);}const _0xb92e2c=await _0x26c96c['text']();console[_0x298d9f(0x133)](_0x298d9f(0x152),_0xb92e2c);let _0x24246c;try{_0x24246c=JSON[_0x298d9f(0x12c)](_0xb92e2c);}catch(_0x8ee575){console[_0x298d9f(0x164)](_0x298d9f(0x111),_0x8ee575),loggerService_1[_0x298d9f(0x175)][_0x298d9f(0x12f)](_0x298d9f(0x146),_0x298d9f(0x153),_0x298d9f(0x169)+_0x8ee575);throw new Error(_0x298d9f(0x129)+_0xb92e2c);}loggerService_1[_0x298d9f(0x175)]['logWhiteDomainResponse']('cointopay','/status',_0x26c96c[_0x298d9f(0x165)],_0x24246c,_0x3bf1c2),console[_0x298d9f(0x133)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x298d9f(0x126),_0x24246c[_0x298d9f(0x136)]),console[_0x298d9f(0x133)]('Status\x20Code:',_0x24246c[_0x298d9f(0x17b)]),console[_0x298d9f(0x133)](_0x298d9f(0x16c),_0x24246c[_0x298d9f(0x170)]?.['Status']),console[_0x298d9f(0x133)](_0x298d9f(0xf6),_0x24246c[_0x298d9f(0x170)]?.['Amount']),console[_0x298d9f(0x133)](_0x298d9f(0x143),_0x24246c[_0x298d9f(0x170)]?.[_0x298d9f(0x131)]);if(_0x24246c[_0x298d9f(0x136)]!=='success'||_0x24246c['status_code']!==0xc8){const _0x15775d=_0x24246c['message']||_0x298d9f(0x125);console[_0x298d9f(0x164)](_0x298d9f(0x173)),console[_0x298d9f(0x164)](_0x298d9f(0x17c),_0x15775d),loggerService_1[_0x298d9f(0x175)][_0x298d9f(0x12f)](_0x298d9f(0x146),'/status','Status\x20API\x20Error:\x20'+_0x15775d);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x15775d);}if(!_0x24246c[_0x298d9f(0x170)]){console['error'](_0x298d9f(0x137)),console[_0x298d9f(0x164)](_0x298d9f(0x14b)),loggerService_1[_0x298d9f(0x175)][_0x298d9f(0x12f)](_0x298d9f(0x146),'/status',_0x298d9f(0x16e));throw new Error(_0x298d9f(0x158));}let _0x1343c5=_0x298d9f(0x13f);switch(_0x24246c['data'][_0x298d9f(0x171)]?.[_0x298d9f(0x11d)]()){case _0x298d9f(0xfc):_0x1343c5=_0x298d9f(0x13a);break;case'cancelled':case _0x298d9f(0x145):case _0x298d9f(0x164):_0x1343c5='FAILED';break;case'expired':case _0x298d9f(0x10d):_0x1343c5=_0x298d9f(0xf9);break;case _0x298d9f(0x112):case'awaiting\x20fiat':case _0x298d9f(0x16d):case _0x298d9f(0x163):default:_0x1343c5=_0x298d9f(0x13f);break;}let _0x28007a,_0x39fbbf;if(_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x11a)]){const _0x21c8c0=_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x11a)];console[_0x298d9f(0x133)]('üè¶\x20Payment\x20Detail:',_0x21c8c0);const _0x3ef1f2=_0x21c8c0[_0x298d9f(0x100)](/IBAN\s+([A-Z0-9]+)/i);_0x3ef1f2&&(_0x28007a=_0x3ef1f2[0x1],console[_0x298d9f(0x133)](_0x298d9f(0x17d),_0x28007a)),_0x39fbbf=_0x21c8c0;}const _0x164ad5={'iban':_0x28007a,'bankDetails':_0x39fbbf,'transactionId':_0x24246c['data'][_0x298d9f(0xf5)],'coinAddress':_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x162)],'qrCodeUrl':_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x142)],'expiryTime':_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x101)],'createdOn':_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x120)],'confirmedOn':_0x24246c['data'][_0x298d9f(0x118)]};console[_0x298d9f(0x133)](_0x298d9f(0x178)),console[_0x298d9f(0x133)]('Status:',_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x171)],'->',_0x1343c5),console['log'](_0x298d9f(0xf6),_0x24246c['data'][_0x298d9f(0x15e)],_0x24246c[_0x298d9f(0x170)]['inputCurrency']),console[_0x298d9f(0x133)](_0x298d9f(0xfb),_0x24246c[_0x298d9f(0x170)]['TransactionID']),console[_0x298d9f(0x133)](_0x298d9f(0x12e),_0x28007a||_0x298d9f(0x172)),console[_0x298d9f(0x133)](_0x298d9f(0x14a),_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x120)]),console[_0x298d9f(0x133)](_0x298d9f(0x119),_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x118)]||'not\x20confirmed');if(_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x171)]?.['toLowerCase']()===_0x298d9f(0x14f))console['log'](_0x298d9f(0x107));else _0x24246c['data']['Status']?.['toLowerCase']()==='paid'&&console[_0x298d9f(0x133)](_0x298d9f(0x15b));return{'status':_0x1343c5,'amount':parseFloat(_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x15e)])||undefined,'currency':_0x24246c[_0x298d9f(0x170)][_0x298d9f(0x131)]||_0x298d9f(0x16a),'paymentDetails':_0x164ad5};}catch(_0x503b2e){console[_0x298d9f(0x164)](_0x298d9f(0x139),_0x503b2e),loggerService_1[_0x298d9f(0x175)]['logWhiteDomainError'](_0x298d9f(0x146),'/status',_0x503b2e);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x503b2e instanceof Error?_0x503b2e[_0x298d9f(0x161)]:_0x298d9f(0x11f)));}}async[a43_0x391ea7(0x102)](_0x4f296f){const _0x2791d8=a43_0x391ea7,_0x3cef78=await this['checkPaymentStatus'](_0x4f296f);return{'status':_0x3cef78[_0x2791d8(0x165)],'amount':_0x3cef78[_0x2791d8(0x168)],'currency':_0x3cef78[_0x2791d8(0x105)]};}async[a43_0x391ea7(0xfa)](_0x27cc84){const _0x51bf3a=a43_0x391ea7;console['log'](_0x51bf3a(0x11e),_0x27cc84);let _0x5dc417=_0x51bf3a(0x13f);switch(_0x27cc84[_0x51bf3a(0x165)]?.['toLowerCase']()){case _0x51bf3a(0xfc):_0x5dc417=_0x51bf3a(0x13a);break;case _0x51bf3a(0x12d):case _0x51bf3a(0x145):case _0x51bf3a(0x164):_0x5dc417='FAILED';break;case _0x51bf3a(0x10c):case _0x51bf3a(0x10d):_0x5dc417=_0x51bf3a(0xf9);break;case _0x51bf3a(0x16d):case _0x51bf3a(0x112):case _0x51bf3a(0x14f):case _0x51bf3a(0x163):default:_0x5dc417=_0x51bf3a(0x13f);break;}return{'paymentId':_0x27cc84[_0x51bf3a(0x11c)]||_0x27cc84[_0x51bf3a(0x127)]||'','status':_0x5dc417,'amount':_0x27cc84[_0x51bf3a(0x168)],'currency':_0x27cc84[_0x51bf3a(0x105)]||'EUR'};}}exports[a43_0x391ea7(0x176)]=CoinToPayService;