'use strict';const a49_0x1bd9be=a49_0x32fe;(function(_0x53f43f,_0x1aebee){const _0x396aaa=a49_0x32fe,_0x54f04d=_0x53f43f();while(!![]){try{const _0x1f6e38=parseInt(_0x396aaa(0x15a))/0x1+-parseInt(_0x396aaa(0x157))/0x2*(-parseInt(_0x396aaa(0x10e))/0x3)+parseInt(_0x396aaa(0x145))/0x4+parseInt(_0x396aaa(0x15b))/0x5+-parseInt(_0x396aaa(0x152))/0x6*(parseInt(_0x396aaa(0x144))/0x7)+-parseInt(_0x396aaa(0x13e))/0x8+parseInt(_0x396aaa(0xfc))/0x9*(-parseInt(_0x396aaa(0x149))/0xa);if(_0x1f6e38===_0x1aebee)break;else _0x54f04d['push'](_0x54f04d['shift']());}catch(_0x2e717e){_0x54f04d['push'](_0x54f04d['shift']());}}}(a49_0x3e17,0x2c272));Object[a49_0x1bd9be(0x169)](exports,a49_0x1bd9be(0x103),{'value':!![]}),exports[a49_0x1bd9be(0x163)]=void 0x0;function a49_0x3e17(){const _0xfc98ca=['HTTP\x20','CoinToPay\x20status\x20API\x20error:\x20','üìä\x20Status\x20check\x20URL:','logWhiteDomainResponse','status','stringify','https://tesoft.uk/gateway/cointopay/','text','CoinToPay\x20API\x20error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Transaction\x20ID:','apiUrl','Amount','1019853KhJsfM','Payment\x20URL\x20(modified):','logWhiteDomainRequest','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','order_id','Status\x20Text:','cancelled','__esModule','gateway_payment_id','Request\x20Body:','PAID','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','waiting','Created\x20On:','error','Payment\x20URL\x20(original):','Response\x20Body:',',\x20body:\x20','15EEeLgy','match','headers','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','/status','awaiting\x20fiat','Status\x20Code:','currency','POST','Missing\x20data\x20in\x20response','Currency:','message','payment_url','JSON\x20Parse\x20Error:\x20','verifyPayment','failed','statusUrl','toLowerCase','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','PENDING','createPaymentLink','Confirmed\x20On:','Response\x20Time:','parse','created','Amount:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üè¶\x20Payment\x20Detail:','https://tesoft.uk/gateway/cointopay/status.php','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','TransactionConfirmedOn','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','TransactionID','not\x20confirmed','checkPaymentStatus','HTTP\x20Status:','data','PaymentDetail','merchant_reference_id','Error\x20details:','CreatedOn','stack','/create','not\x20found','URL:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','1210224HZKsrp','Headers:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','loggerService','fromEntries','175FwBxCd','1277360lOdEDe','paid','application/json','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','30ruTkVE','logWhiteDomainError','log','statusText','cointopay','HTTP\x20error!\x20status:\x20','Status','Payment\x20System/1.0','inputCurrency','7914PSmjhK','pending','Error\x20Message:','success','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','41000ogSUnk','amount','now','21919UztliP','1306475HDwqKi','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','timeout','processWebhook','===\x20COINTOPAY\x20API\x20ERROR\x20===','EUR','status_code','CoinToPayService','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','QRCodeURL','Status:','defineProperty','result','Raw\x20Response\x20Body:','EXPIRED','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='];a49_0x3e17=function(){return _0xfc98ca;};return a49_0x3e17();}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0xe1fead=a49_0x1bd9be;this[_0xe1fead(0x179)]=_0xe1fead(0x174),this[_0xe1fead(0x11e)]=_0xe1fead(0x12c),console[_0xe1fead(0x14b)](_0xe1fead(0x12a)),console[_0xe1fead(0x14b)](_0xe1fead(0x170),this[_0xe1fead(0x11e)]);}async[a49_0x1bd9be(0x124)](_0x70ece){const _0x578a88=a49_0x1bd9be,{orderId:_0x8ec0c0,amount:_0x312d20}=_0x70ece;console[_0x578a88(0x14b)]('ü™ô\x20Creating\x20CoinToPay\x20payment:\x20'+_0x312d20+'\x20EUR');const _0x4962f9={'amount':_0x312d20},_0x540ff5=Date[_0x578a88(0x159)]();try{console[_0x578a88(0x14b)](_0x578a88(0x121)),console[_0x578a88(0x14b)](_0x578a88(0x13c),this[_0x578a88(0x179)]),console[_0x578a88(0x14b)](_0x578a88(0x105),JSON['stringify'](_0x4962f9,null,0x2)),console['log']('Amount:',_0x312d20,_0x578a88(0x111)),loggerService_1['loggerService'][_0x578a88(0xfe)](_0x578a88(0x14d),_0x578a88(0x13a),'POST',_0x4962f9);const _0x3b26d4=await fetch(this[_0x578a88(0x179)],{'method':'POST','headers':{'Content-Type':_0x578a88(0x147),'Accept':_0x578a88(0x147),'User-Agent':_0x578a88(0x150)},'body':JSON['stringify'](_0x4962f9)}),_0xced6e5=Date[_0x578a88(0x159)]()-_0x540ff5;console[_0x578a88(0x14b)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x578a88(0x168),_0x3b26d4[_0x578a88(0x172)]),console['log'](_0x578a88(0x101),_0x3b26d4[_0x578a88(0x14c)]),console['log'](_0x578a88(0x13f),Object[_0x578a88(0x143)](_0x3b26d4[_0x578a88(0x110)]['entries']())),console[_0x578a88(0x14b)](_0x578a88(0x126),_0xced6e5+'ms');const _0x1ac488=await _0x3b26d4[_0x578a88(0x175)]();console[_0x578a88(0x14b)](_0x578a88(0x16b),_0x1ac488);if(!_0x3b26d4['ok']){console[_0x578a88(0x10a)](_0x578a88(0x160)),console['error'](_0x578a88(0x133),_0x3b26d4['status']),console['error'](_0x578a88(0x10c),_0x1ac488),loggerService_1[_0x578a88(0x142)][_0x578a88(0x171)](_0x578a88(0x14d),'/create',_0x3b26d4[_0x578a88(0x172)],_0x1ac488,_0xced6e5),loggerService_1[_0x578a88(0x142)][_0x578a88(0x14a)](_0x578a88(0x14d),_0x578a88(0x13a),_0x578a88(0x16e)+_0x3b26d4['status']+':\x20'+_0x1ac488);throw new Error(_0x578a88(0x14e)+_0x3b26d4['status']+_0x578a88(0x10d)+_0x1ac488);}let _0x70bd24;try{_0x70bd24=JSON[_0x578a88(0x127)](_0x1ac488);}catch(_0x3971ab){console[_0x578a88(0x10a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x3971ab),loggerService_1[_0x578a88(0x142)]['logWhiteDomainError']('cointopay',_0x578a88(0x13a),_0x578a88(0x11b)+_0x3971ab);throw new Error(_0x578a88(0x165)+_0x1ac488);}console[_0x578a88(0x14b)](_0x578a88(0x122)),console[_0x578a88(0x14b)]('Parsed\x20Result:',JSON['stringify'](_0x70bd24,null,0x2)),loggerService_1[_0x578a88(0x142)][_0x578a88(0x171)](_0x578a88(0x14d),_0x578a88(0x13a),_0x3b26d4[_0x578a88(0x172)],_0x70bd24,_0xced6e5);if(_0x70bd24['error']){const _0x4c607e=_0x70bd24[_0x578a88(0x119)]||_0x70bd24['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x578a88(0x140)),console[_0x578a88(0x10a)](_0x578a88(0x154),_0x4c607e),loggerService_1[_0x578a88(0x142)][_0x578a88(0x14a)]('cointopay','/create','Business\x20Error:\x20'+_0x4c607e);throw new Error(_0x578a88(0x176)+_0x4c607e);}if(!_0x70bd24['payment_url']||!_0x70bd24[_0x578a88(0x104)]){console['error'](_0x578a88(0x12f)),console[_0x578a88(0x10a)](_0x578a88(0x120)),console[_0x578a88(0x10a)]('Response\x20data:',_0x70bd24),loggerService_1['loggerService'][_0x578a88(0x14a)]('cointopay','/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x578a88(0x166));}console['log']('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log']('Gateway\x20Payment\x20ID:',_0x70bd24[_0x578a88(0x104)]),console[_0x578a88(0x14b)](_0x578a88(0x10b),_0x70bd24['payment_url']);const _0x447742=_0x70bd24[_0x578a88(0x11a)]+'&alternative=false';return console[_0x578a88(0x14b)](_0x578a88(0xfd),_0x447742),console[_0x578a88(0x14b)](_0x578a88(0x129),_0x312d20,_0x578a88(0x161)),{'gateway_payment_id':_0x70bd24[_0x578a88(0x104)],'payment_url':_0x447742};}catch(_0x31f2a3){console[_0x578a88(0x10a)](_0x578a88(0x16d)),console[_0x578a88(0x10a)](_0x578a88(0x137),_0x31f2a3),loggerService_1[_0x578a88(0x142)][_0x578a88(0x14a)](_0x578a88(0x14d),_0x578a88(0x13a),_0x31f2a3);if(_0x31f2a3 instanceof Error){console[_0x578a88(0x10a)]('Error\x20message:',_0x31f2a3[_0x578a88(0x119)]),console['error']('Error\x20stack:',_0x31f2a3[_0x578a88(0x139)]);throw new Error(_0x578a88(0x156)+_0x31f2a3[_0x578a88(0x119)]);}throw new Error(_0x578a88(0x177));}}async['checkPaymentStatus'](_0x446c8c){const _0x307b34=a49_0x1bd9be,_0x4f8b2c=Date['now']();try{console[_0x307b34(0x14b)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x446c8c);const _0x387477={'gatewayPaymentId':_0x446c8c};loggerService_1[_0x307b34(0x142)][_0x307b34(0xfe)](_0x307b34(0x14d),'/status','POST',_0x387477);const _0x37855f=await fetch(this['statusUrl'],{'method':_0x307b34(0x116),'headers':{'Content-Type':_0x307b34(0x147),'Accept':_0x307b34(0x147),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x307b34(0x173)](_0x387477)}),_0x5c42f8=Date['now']()-_0x4f8b2c;console[_0x307b34(0x14b)](_0x307b34(0x148)),console[_0x307b34(0x14b)](_0x307b34(0x168),_0x37855f[_0x307b34(0x172)]),console['log'](_0x307b34(0x126),_0x5c42f8+'ms');if(!_0x37855f['ok']){const _0x259f85=await _0x37855f['text']();console['error'](_0x307b34(0x133),_0x37855f[_0x307b34(0x172)]),console['error'](_0x307b34(0x10c),_0x259f85),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x307b34(0x14d),'/status',_0x37855f['status'],_0x259f85,_0x5c42f8),loggerService_1[_0x307b34(0x142)]['logWhiteDomainError'](_0x307b34(0x14d),'/status',_0x307b34(0x16e)+_0x37855f['status']+':\x20'+_0x259f85);throw new Error('HTTP\x20error!\x20status:\x20'+_0x37855f[_0x307b34(0x172)]);}const _0x321dc1=await _0x37855f['text']();console[_0x307b34(0x14b)](_0x307b34(0x16b),_0x321dc1);let _0x12aab2;try{_0x12aab2=JSON['parse'](_0x321dc1);}catch(_0x264cad){console[_0x307b34(0x10a)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x264cad),loggerService_1[_0x307b34(0x142)][_0x307b34(0x14a)](_0x307b34(0x14d),_0x307b34(0x112),'JSON\x20Parse\x20Error:\x20'+_0x264cad);throw new Error(_0x307b34(0x15c)+_0x321dc1);}loggerService_1[_0x307b34(0x142)][_0x307b34(0x171)](_0x307b34(0x14d),_0x307b34(0x112),_0x37855f['status'],_0x12aab2,_0x5c42f8),console[_0x307b34(0x14b)](_0x307b34(0x141)),console['log']('Result:',_0x12aab2[_0x307b34(0x16a)]),console['log'](_0x307b34(0x114),_0x12aab2['status_code']),console[_0x307b34(0x14b)]('Payment\x20Status:',_0x12aab2[_0x307b34(0x134)]?.[_0x307b34(0x14f)]),console['log'](_0x307b34(0x129),_0x12aab2[_0x307b34(0x134)]?.[_0x307b34(0xfb)]),console['log'](_0x307b34(0x118),_0x12aab2[_0x307b34(0x134)]?.[_0x307b34(0x151)]);if(_0x12aab2[_0x307b34(0x16a)]!==_0x307b34(0x155)||_0x12aab2[_0x307b34(0x162)]!==0xc8){const _0x205cef=_0x12aab2[_0x307b34(0x119)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x307b34(0x10a)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error']('Error\x20Message:',_0x205cef),loggerService_1[_0x307b34(0x142)][_0x307b34(0x14a)]('cointopay','/status','Status\x20API\x20Error:\x20'+_0x205cef);throw new Error(_0x307b34(0x16f)+_0x205cef);}if(!_0x12aab2[_0x307b34(0x134)]){console[_0x307b34(0x10a)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x307b34(0x10a)](_0x307b34(0x117)),loggerService_1[_0x307b34(0x142)][_0x307b34(0x14a)]('cointopay','/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x307b34(0x164));}let _0x5b0741=_0x307b34(0x123);switch(_0x12aab2[_0x307b34(0x134)]['Status']?.['toLowerCase']()){case _0x307b34(0x146):_0x5b0741=_0x307b34(0x106);break;case _0x307b34(0x102):case _0x307b34(0x11d):case _0x307b34(0x10a):_0x5b0741='FAILED';break;case'expired':case _0x307b34(0x15e):_0x5b0741=_0x307b34(0x16c);break;case _0x307b34(0x108):case _0x307b34(0x113):case'pending':case _0x307b34(0x128):default:_0x5b0741='PENDING';break;}let _0x302be6,_0x47286a;if(_0x12aab2['data']['PaymentDetail']){const _0x26632f=_0x12aab2[_0x307b34(0x134)][_0x307b34(0x135)];console[_0x307b34(0x14b)](_0x307b34(0x12b),_0x26632f);const _0xafe751=_0x26632f[_0x307b34(0x10f)](/IBAN\s+([A-Z0-9]+)/i);_0xafe751&&(_0x302be6=_0xafe751[0x1],console[_0x307b34(0x14b)]('üè¶\x20Extracted\x20IBAN:',_0x302be6)),_0x47286a=_0x26632f;}const _0x47657e={'iban':_0x302be6,'bankDetails':_0x47286a,'transactionId':_0x12aab2[_0x307b34(0x134)][_0x307b34(0x130)],'coinAddress':_0x12aab2['data']['coinAddress'],'qrCodeUrl':_0x12aab2[_0x307b34(0x134)][_0x307b34(0x167)],'expiryTime':_0x12aab2[_0x307b34(0x134)]['ExpiryTime'],'createdOn':_0x12aab2[_0x307b34(0x134)][_0x307b34(0x138)],'confirmedOn':_0x12aab2['data'][_0x307b34(0x12e)]};console[_0x307b34(0x14b)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log'](_0x307b34(0x168),_0x12aab2[_0x307b34(0x134)][_0x307b34(0x14f)],'->',_0x5b0741),console[_0x307b34(0x14b)](_0x307b34(0x129),_0x12aab2[_0x307b34(0x134)]['Amount'],_0x12aab2[_0x307b34(0x134)][_0x307b34(0x151)]),console['log'](_0x307b34(0x178),_0x12aab2['data']['TransactionID']),console[_0x307b34(0x14b)]('IBAN:',_0x302be6||_0x307b34(0x13b)),console[_0x307b34(0x14b)](_0x307b34(0x109),_0x12aab2[_0x307b34(0x134)][_0x307b34(0x138)]),console[_0x307b34(0x14b)](_0x307b34(0x125),_0x12aab2[_0x307b34(0x134)]['TransactionConfirmedOn']||_0x307b34(0x131));if(_0x12aab2['data'][_0x307b34(0x14f)]?.[_0x307b34(0x11f)]()===_0x307b34(0x113))console[_0x307b34(0x14b)](_0x307b34(0x12d));else _0x12aab2[_0x307b34(0x134)][_0x307b34(0x14f)]?.['toLowerCase']()===_0x307b34(0x146)&&console[_0x307b34(0x14b)](_0x307b34(0x13d));return{'status':_0x5b0741,'amount':parseFloat(_0x12aab2['data'][_0x307b34(0xfb)])||undefined,'currency':_0x12aab2[_0x307b34(0x134)][_0x307b34(0x151)]||_0x307b34(0x161),'paymentDetails':_0x47657e};}catch(_0x4b3de8){console[_0x307b34(0x10a)](_0x307b34(0x15d),_0x4b3de8),loggerService_1[_0x307b34(0x142)]['logWhiteDomainError'](_0x307b34(0x14d),'/status',_0x4b3de8);throw new Error(_0x307b34(0xff)+(_0x4b3de8 instanceof Error?_0x4b3de8['message']:'Unknown\x20error'));}}async[a49_0x1bd9be(0x11c)](_0x2be872){const _0x28b7e9=a49_0x1bd9be,_0x159d35=await this[_0x28b7e9(0x132)](_0x2be872);return{'status':_0x159d35[_0x28b7e9(0x172)],'amount':_0x159d35[_0x28b7e9(0x158)],'currency':_0x159d35[_0x28b7e9(0x115)]};}async[a49_0x1bd9be(0x15f)](_0x100fb1){const _0x3701e3=a49_0x1bd9be;console['log'](_0x3701e3(0x107),_0x100fb1);let _0x2e7ca6=_0x3701e3(0x123);switch(_0x100fb1[_0x3701e3(0x172)]?.[_0x3701e3(0x11f)]()){case'paid':_0x2e7ca6=_0x3701e3(0x106);break;case _0x3701e3(0x102):case _0x3701e3(0x11d):case _0x3701e3(0x10a):_0x2e7ca6='FAILED';break;case'expired':case _0x3701e3(0x15e):_0x2e7ca6=_0x3701e3(0x16c);break;case _0x3701e3(0x153):case _0x3701e3(0x108):case _0x3701e3(0x113):case'created':default:_0x2e7ca6=_0x3701e3(0x123);break;}return{'paymentId':_0x100fb1[_0x3701e3(0x100)]||_0x100fb1[_0x3701e3(0x136)]||'','status':_0x2e7ca6,'amount':_0x100fb1[_0x3701e3(0x158)],'currency':_0x100fb1['currency']||'EUR'};}}function a49_0x32fe(_0x485c22,_0x40a348){const _0x3e17fa=a49_0x3e17();return a49_0x32fe=function(_0x32fe20,_0x2e59a3){_0x32fe20=_0x32fe20-0xfb;let _0x8a8756=_0x3e17fa[_0x32fe20];return _0x8a8756;},a49_0x32fe(_0x485c22,_0x40a348);}exports[a49_0x1bd9be(0x163)]=CoinToPayService;