'use strict';const a41_0x2daa42=a41_0x483f;(function(_0x4bb504,_0x36fd73){const _0x5ea722=a41_0x483f,_0x272bca=_0x4bb504();while(!![]){try{const _0x1a6197=-parseInt(_0x5ea722(0x112))/0x1+parseInt(_0x5ea722(0x127))/0x2*(parseInt(_0x5ea722(0x104))/0x3)+-parseInt(_0x5ea722(0x14c))/0x4*(parseInt(_0x5ea722(0x11d))/0x5)+parseInt(_0x5ea722(0x10e))/0x6*(-parseInt(_0x5ea722(0xd0))/0x7)+-parseInt(_0x5ea722(0x134))/0x8+parseInt(_0x5ea722(0x103))/0x9+-parseInt(_0x5ea722(0xe1))/0xa*(-parseInt(_0x5ea722(0x136))/0xb);if(_0x1a6197===_0x36fd73)break;else _0x272bca['push'](_0x272bca['shift']());}catch(_0x1c73ad){_0x272bca['push'](_0x272bca['shift']());}}}(a41_0x4207,0xd3baf));Object[a41_0x2daa42(0xd5)](exports,a41_0x2daa42(0x105),{'value':!![]}),exports[a41_0x2daa42(0xec)]=void 0x0;const loggerService_1=require(a41_0x2daa42(0x113));function a41_0x4207(){const _0x416478=['ExpiryTime','Parsed\x20Result:','Amount','waiting','Error\x20Message:','IBAN:','verifyPayment','currency','1224601fEiuNj','Failed\x20to\x20parse\x20JSON\x20response:','awaiting\x20fiat','CoinToPay\x20payment\x20status\x20check\x20error:','Unknown\x20error','defineProperty','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','data','HTTP\x20Status:','not\x20confirmed','FAILED','pending','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','stringify','Gateway\x20Payment\x20ID:','Status\x20API\x20Error:\x20','üìä\x20Status\x20check\x20URL:','540gnUjwX','===\x20COINTOPAY\x20API\x20ERROR\x20===','Error\x20message:','match','EXPIRED','TransactionID','gateway_payment_id','error','paid','EUR','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','CoinToPayService','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','createPaymentLink','message','Error\x20details:','POST','logWhiteDomainRequest','processWebhook','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status','HTTP\x20error!\x20status:\x20','log','apiUrl','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','/create','failed','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','statusUrl','CoinToPay\x20API\x20error:\x20','cointopay','Missing\x20data\x20in\x20response','Raw\x20Response\x20Body:','HTTP\x20','10841940QnoNLJ','573Upagrw','__esModule','JSON\x20Parse\x20Error:\x20','stack','application/json','https://tesoft.uk/gateway/cointopay/','Confirmed\x20On:','toLowerCase','\x20EUR','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','54CRCWFY','logWhiteDomainResponse','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','1180267zjczUb','../loggerService','inputCurrency','Unknown\x20error\x20from\x20CoinToPay\x20API','Incomplete\x20response:\x20missing\x20data','entries','Response\x20data:','Amount:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Status\x20Text:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','355omlPkq','logWhiteDomainError','status_code','Payment\x20URL:','Status:','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','expired','https://tesoft.uk/gateway/cointopay/status.php','Headers:','statusText','16446SldBdW','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','payment_url','Response\x20Body:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','PAID','fromEntries','Payment\x20Status:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','QRCodeURL','not\x20found','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','checkPaymentStatus','12806264BUcACR','cancelled','533962grEleG','status','now','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','created','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','success','Business\x20Error:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','result','PaymentDetail','Result:','CreatedOn','parse','timeout','loggerService','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Currency:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','text','PENDING','9788hterqR','TesSoft\x20Payment\x20System/1.0','Status\x20Code:','üè¶\x20Payment\x20Detail:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TransactionConfirmedOn','/status','üè¶\x20Extracted\x20IBAN:','order_id'];a41_0x4207=function(){return _0x416478;};return a41_0x4207();}function a41_0x483f(_0x1fd860,_0x13797a){const _0x420762=a41_0x4207();return a41_0x483f=function(_0x483f00,_0xa1a954){_0x483f00=_0x483f00-0xcb;let _0x453bb6=_0x420762[_0x483f00];return _0x453bb6;},a41_0x483f(_0x1fd860,_0x13797a);}class CoinToPayService{constructor(){const _0x436cbe=a41_0x2daa42;this[_0x436cbe(0xf8)]=_0x436cbe(0x109),this[_0x436cbe(0xfd)]=_0x436cbe(0x124),console['log'](_0x436cbe(0x110)),console[_0x436cbe(0xf7)](_0x436cbe(0xe0),this['statusUrl']);}async[a41_0x2daa42(0xee)](_0x2550e2){const _0x5ce4d7=a41_0x2daa42,{orderId:_0x1abe2f,amount:_0x775898}=_0x2550e2;console['log'](_0x5ce4d7(0x13f)+_0x775898+_0x5ce4d7(0x10c));const _0x38de9d={'amount':_0x775898},_0x5b0113=Date[_0x5ce4d7(0x138)]();try{console['log'](_0x5ce4d7(0x122)),console['log']('URL:',this[_0x5ce4d7(0xf8)]),console[_0x5ce4d7(0xf7)]('Request\x20Body:',JSON[_0x5ce4d7(0xdd)](_0x38de9d,null,0x2)),console[_0x5ce4d7(0xf7)]('Amount:',_0x775898,_0x5ce4d7(0xf4)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x5ce4d7(0xff),_0x5ce4d7(0xfa),'POST',_0x38de9d);const _0x32e9d7=await fetch(this[_0x5ce4d7(0xf8)],{'method':_0x5ce4d7(0xf1),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x5ce4d7(0x14d)},'body':JSON[_0x5ce4d7(0xdd)](_0x38de9d)}),_0x440dc0=Date[_0x5ce4d7(0x138)]()-_0x5b0113;console[_0x5ce4d7(0xf7)](_0x5ce4d7(0x11c)),console[_0x5ce4d7(0xf7)](_0x5ce4d7(0x121),_0x32e9d7[_0x5ce4d7(0x137)]),console[_0x5ce4d7(0xf7)](_0x5ce4d7(0x11b),_0x32e9d7[_0x5ce4d7(0x126)]),console[_0x5ce4d7(0xf7)](_0x5ce4d7(0x125),Object[_0x5ce4d7(0x12d)](_0x32e9d7['headers'][_0x5ce4d7(0x117)]())),console['log']('Response\x20Time:',_0x440dc0+'ms');const _0x3347b8=await _0x32e9d7['text']();console['log']('Raw\x20Response\x20Body:',_0x3347b8);if(!_0x32e9d7['ok']){console['error'](_0x5ce4d7(0xe2)),console[_0x5ce4d7(0xe8)](_0x5ce4d7(0xd8),_0x32e9d7[_0x5ce4d7(0x137)]),console[_0x5ce4d7(0xe8)](_0x5ce4d7(0x12a),_0x3347b8),loggerService_1[_0x5ce4d7(0x146)][_0x5ce4d7(0x10f)]('cointopay',_0x5ce4d7(0xfa),_0x32e9d7[_0x5ce4d7(0x137)],_0x3347b8,_0x440dc0),loggerService_1[_0x5ce4d7(0x146)]['logWhiteDomainError'](_0x5ce4d7(0xff),_0x5ce4d7(0xfa),_0x5ce4d7(0x102)+_0x32e9d7[_0x5ce4d7(0x137)]+':\x20'+_0x3347b8);throw new Error(_0x5ce4d7(0xf6)+_0x32e9d7[_0x5ce4d7(0x137)]+',\x20body:\x20'+_0x3347b8);}let _0x508a0a;try{_0x508a0a=JSON[_0x5ce4d7(0x144)](_0x3347b8);}catch(_0x3225a6){console[_0x5ce4d7(0xe8)](_0x5ce4d7(0xd1),_0x3225a6),loggerService_1['loggerService']['logWhiteDomainError'](_0x5ce4d7(0xff),_0x5ce4d7(0xfa),'JSON\x20Parse\x20Error:\x20'+_0x3225a6);throw new Error(_0x5ce4d7(0x13a)+_0x3347b8);}console[_0x5ce4d7(0xf7)](_0x5ce4d7(0xfc)),console[_0x5ce4d7(0xf7)](_0x5ce4d7(0x158),JSON[_0x5ce4d7(0xdd)](_0x508a0a,null,0x2)),loggerService_1[_0x5ce4d7(0x146)][_0x5ce4d7(0x10f)]('cointopay','/create',_0x32e9d7[_0x5ce4d7(0x137)],_0x508a0a,_0x440dc0);if(_0x508a0a[_0x5ce4d7(0xe8)]){const _0x1552b1=_0x508a0a[_0x5ce4d7(0xef)]||_0x508a0a['error']||_0x5ce4d7(0x115);console[_0x5ce4d7(0xe8)](_0x5ce4d7(0x149)),console[_0x5ce4d7(0xe8)](_0x5ce4d7(0xcc),_0x1552b1),loggerService_1['loggerService']['logWhiteDomainError'](_0x5ce4d7(0xff),_0x5ce4d7(0xfa),_0x5ce4d7(0x13e)+_0x1552b1);throw new Error(_0x5ce4d7(0xfe)+_0x1552b1);}if(!_0x508a0a[_0x5ce4d7(0x129)]||!_0x508a0a[_0x5ce4d7(0xe7)]){console['error'](_0x5ce4d7(0xed)),console[_0x5ce4d7(0xe8)](_0x5ce4d7(0x139)),console['error'](_0x5ce4d7(0x118),_0x508a0a),loggerService_1[_0x5ce4d7(0x146)]['logWhiteDomainError'](_0x5ce4d7(0xff),_0x5ce4d7(0xfa),_0x5ce4d7(0x10d));throw new Error(_0x5ce4d7(0x147));}return console[_0x5ce4d7(0xf7)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x5ce4d7(0xde),_0x508a0a['gateway_payment_id']),console['log'](_0x5ce4d7(0x120),_0x508a0a['payment_url']),console['log'](_0x5ce4d7(0x119),_0x775898,'EUR'),{'gateway_payment_id':_0x508a0a['gateway_payment_id'],'payment_url':_0x508a0a[_0x5ce4d7(0x129)]};}catch(_0x4f954f){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x5ce4d7(0xe8)](_0x5ce4d7(0xf0),_0x4f954f),loggerService_1['loggerService'][_0x5ce4d7(0x11e)]('cointopay',_0x5ce4d7(0xfa),_0x4f954f);if(_0x4f954f instanceof Error){console[_0x5ce4d7(0xe8)](_0x5ce4d7(0xe3),_0x4f954f[_0x5ce4d7(0xef)]),console[_0x5ce4d7(0xe8)]('Error\x20stack:',_0x4f954f[_0x5ce4d7(0x107)]);throw new Error(_0x5ce4d7(0x111)+_0x4f954f[_0x5ce4d7(0xef)]);}throw new Error(_0x5ce4d7(0xd6));}}async[a41_0x2daa42(0x133)](_0x9fb244){const _0x56bf58=a41_0x2daa42,_0x468234=Date[_0x56bf58(0x138)]();try{console[_0x56bf58(0xf7)](_0x56bf58(0x11a)+_0x9fb244);const _0xba76e2={'gatewayPaymentId':_0x9fb244};loggerService_1[_0x56bf58(0x146)][_0x56bf58(0xf2)](_0x56bf58(0xff),_0x56bf58(0x154),_0x56bf58(0xf1),_0xba76e2);const _0x129382=await fetch(this['statusUrl'],{'method':_0x56bf58(0xf1),'headers':{'Content-Type':'application/json','Accept':_0x56bf58(0x108),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x56bf58(0xdd)](_0xba76e2)}),_0x82c483=Date[_0x56bf58(0x138)]()-_0x468234;console[_0x56bf58(0xf7)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x56bf58(0xf7)]('Status:',_0x129382['status']),console[_0x56bf58(0xf7)]('Response\x20Time:',_0x82c483+'ms');if(!_0x129382['ok']){const _0x2e299b=await _0x129382[_0x56bf58(0x14a)]();console[_0x56bf58(0xe8)]('HTTP\x20Status:',_0x129382['status']),console[_0x56bf58(0xe8)](_0x56bf58(0x12a),_0x2e299b),loggerService_1[_0x56bf58(0x146)][_0x56bf58(0x10f)](_0x56bf58(0xff),_0x56bf58(0x154),_0x129382[_0x56bf58(0x137)],_0x2e299b,_0x82c483),loggerService_1[_0x56bf58(0x146)][_0x56bf58(0x11e)]('cointopay',_0x56bf58(0x154),_0x56bf58(0x102)+_0x129382[_0x56bf58(0x137)]+':\x20'+_0x2e299b);throw new Error('HTTP\x20error!\x20status:\x20'+_0x129382[_0x56bf58(0x137)]);}const _0x20a6df=await _0x129382[_0x56bf58(0x14a)]();console[_0x56bf58(0xf7)](_0x56bf58(0x101),_0x20a6df);let _0x44d2ec;try{_0x44d2ec=JSON[_0x56bf58(0x144)](_0x20a6df);}catch(_0x53ee06){console[_0x56bf58(0xe8)](_0x56bf58(0xd1),_0x53ee06),loggerService_1[_0x56bf58(0x146)]['logWhiteDomainError'](_0x56bf58(0xff),_0x56bf58(0x154),_0x56bf58(0x106)+_0x53ee06);throw new Error(_0x56bf58(0x128)+_0x20a6df);}loggerService_1['loggerService'][_0x56bf58(0x10f)](_0x56bf58(0xff),_0x56bf58(0x154),_0x129382['status'],_0x44d2ec,_0x82c483),console[_0x56bf58(0xf7)](_0x56bf58(0x12b)),console[_0x56bf58(0xf7)](_0x56bf58(0x142),_0x44d2ec[_0x56bf58(0x140)]),console[_0x56bf58(0xf7)](_0x56bf58(0x14e),_0x44d2ec[_0x56bf58(0x11f)]),console[_0x56bf58(0xf7)](_0x56bf58(0x12e),_0x44d2ec[_0x56bf58(0xd7)]?.['Status']),console['log']('Amount:',_0x44d2ec[_0x56bf58(0xd7)]?.[_0x56bf58(0x159)]),console['log'](_0x56bf58(0x148),_0x44d2ec[_0x56bf58(0xd7)]?.['inputCurrency']);if(_0x44d2ec[_0x56bf58(0x140)]!==_0x56bf58(0x13d)||_0x44d2ec[_0x56bf58(0x11f)]!==0xc8){const _0x5d3dc5=_0x44d2ec['message']||_0x56bf58(0x13c);console[_0x56bf58(0xe8)](_0x56bf58(0x150)),console['error']('Error\x20Message:',_0x5d3dc5),loggerService_1[_0x56bf58(0x146)]['logWhiteDomainError']('cointopay',_0x56bf58(0x154),_0x56bf58(0xdf)+_0x5d3dc5);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5d3dc5);}if(!_0x44d2ec[_0x56bf58(0xd7)]){console[_0x56bf58(0xe8)](_0x56bf58(0xf9)),console['error'](_0x56bf58(0x100)),loggerService_1[_0x56bf58(0x146)][_0x56bf58(0x11e)](_0x56bf58(0xff),_0x56bf58(0x154),_0x56bf58(0x116));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x261764=_0x56bf58(0x14b);switch(_0x44d2ec['data'][_0x56bf58(0xf5)]?.['toLowerCase']()){case _0x56bf58(0xe9):_0x261764=_0x56bf58(0x12c);break;case _0x56bf58(0x135):case'failed':case'error':_0x261764='FAILED';break;case _0x56bf58(0x123):case'timeout':_0x261764=_0x56bf58(0xe5);break;case _0x56bf58(0xcb):case _0x56bf58(0xd2):case _0x56bf58(0xdb):case _0x56bf58(0x13b):default:_0x261764='PENDING';break;}let _0x2fb577,_0x8c7014;if(_0x44d2ec[_0x56bf58(0xd7)]['PaymentDetail']){const _0x41a334=_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0x141)];console[_0x56bf58(0xf7)](_0x56bf58(0x14f),_0x41a334);const _0x91ec04=_0x41a334[_0x56bf58(0xe4)](/IBAN\s+([A-Z0-9]+)/i);_0x91ec04&&(_0x2fb577=_0x91ec04[0x1],console['log'](_0x56bf58(0x155),_0x2fb577)),_0x8c7014=_0x41a334;}const _0x54a217={'iban':_0x2fb577,'bankDetails':_0x8c7014,'transactionId':_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0xe6)],'coinAddress':_0x44d2ec[_0x56bf58(0xd7)]['coinAddress'],'qrCodeUrl':_0x44d2ec['data'][_0x56bf58(0x130)],'expiryTime':_0x44d2ec['data'][_0x56bf58(0x157)],'createdOn':_0x44d2ec['data'][_0x56bf58(0x143)],'confirmedOn':_0x44d2ec['data']['TransactionConfirmedOn']};console[_0x56bf58(0xf7)](_0x56bf58(0xdc)),console['log'](_0x56bf58(0x121),_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0xf5)],'->',_0x261764),console[_0x56bf58(0xf7)](_0x56bf58(0x119),_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0x159)],_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0x114)]),console[_0x56bf58(0xf7)]('Transaction\x20ID:',_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0xe6)]),console[_0x56bf58(0xf7)](_0x56bf58(0xcd),_0x2fb577||_0x56bf58(0x131)),console[_0x56bf58(0xf7)]('Created\x20On:',_0x44d2ec['data'][_0x56bf58(0x143)]),console[_0x56bf58(0xf7)](_0x56bf58(0x10a),_0x44d2ec['data'][_0x56bf58(0x153)]||_0x56bf58(0xd9));if(_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0xf5)]?.[_0x56bf58(0x10b)]()===_0x56bf58(0xd2))console[_0x56bf58(0xf7)](_0x56bf58(0xeb));else _0x44d2ec['data'][_0x56bf58(0xf5)]?.['toLowerCase']()===_0x56bf58(0xe9)&&console[_0x56bf58(0xf7)](_0x56bf58(0x12f));return{'status':_0x261764,'amount':parseFloat(_0x44d2ec[_0x56bf58(0xd7)][_0x56bf58(0x159)])||undefined,'currency':_0x44d2ec['data'][_0x56bf58(0x114)]||_0x56bf58(0xea),'paymentDetails':_0x54a217};}catch(_0x33b0ab){console['error'](_0x56bf58(0xd3),_0x33b0ab),loggerService_1[_0x56bf58(0x146)][_0x56bf58(0x11e)](_0x56bf58(0xff),_0x56bf58(0x154),_0x33b0ab);throw new Error(_0x56bf58(0x152)+(_0x33b0ab instanceof Error?_0x33b0ab[_0x56bf58(0xef)]:_0x56bf58(0xd4)));}}async[a41_0x2daa42(0xce)](_0x39f4fe){const _0x1138f9=a41_0x2daa42,_0xf552ed=await this['checkPaymentStatus'](_0x39f4fe);return{'status':_0xf552ed[_0x1138f9(0x137)],'amount':_0xf552ed['amount'],'currency':_0xf552ed[_0x1138f9(0xcf)]};}async[a41_0x2daa42(0xf3)](_0x351076){const _0x26dc7d=a41_0x2daa42;console[_0x26dc7d(0xf7)](_0x26dc7d(0x132),_0x351076);let _0x3a0701=_0x26dc7d(0x14b);switch(_0x351076[_0x26dc7d(0x137)]?.[_0x26dc7d(0x10b)]()){case _0x26dc7d(0xe9):_0x3a0701=_0x26dc7d(0x12c);break;case _0x26dc7d(0x135):case _0x26dc7d(0xfb):case _0x26dc7d(0xe8):_0x3a0701=_0x26dc7d(0xda);break;case _0x26dc7d(0x123):case _0x26dc7d(0x145):_0x3a0701=_0x26dc7d(0xe5);break;case _0x26dc7d(0xdb):case _0x26dc7d(0xcb):case'awaiting\x20fiat':case'created':default:_0x3a0701=_0x26dc7d(0x14b);break;}return{'paymentId':_0x351076[_0x26dc7d(0x156)]||_0x351076['merchant_reference_id']||'','status':_0x3a0701,'amount':_0x351076[_0x26dc7d(0x151)],'currency':_0x351076['currency']||_0x26dc7d(0xea)};}}exports[a41_0x2daa42(0xec)]=CoinToPayService;