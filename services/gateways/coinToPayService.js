'use strict';const a59_0x533338=a59_0x3e00;(function(_0x5f45d5,_0x211643){const _0x239192=a59_0x3e00,_0x2a34f3=_0x5f45d5();while(!![]){try{const _0x26a017=parseInt(_0x239192(0x19f))/0x1*(parseInt(_0x239192(0x16a))/0x2)+-parseInt(_0x239192(0x17d))/0x3+-parseInt(_0x239192(0x13c))/0x4*(-parseInt(_0x239192(0x181))/0x5)+-parseInt(_0x239192(0x160))/0x6*(parseInt(_0x239192(0x198))/0x7)+parseInt(_0x239192(0x17f))/0x8*(-parseInt(_0x239192(0x130))/0x9)+parseInt(_0x239192(0x16d))/0xa+-parseInt(_0x239192(0x1a0))/0xb*(-parseInt(_0x239192(0x139))/0xc);if(_0x26a017===_0x211643)break;else _0x2a34f3['push'](_0x2a34f3['shift']());}catch(_0x44cb66){_0x2a34f3['push'](_0x2a34f3['shift']());}}}(a59_0x5a8d,0xc892a));function a59_0x3e00(_0x9e84e0,_0x3426e7){_0x9e84e0=_0x9e84e0-0x115;const _0x5a8d20=a59_0x5a8d();let _0x3e00fd=_0x5a8d20[_0x9e84e0];return _0x3e00fd;}Object[a59_0x533338(0x125)](exports,a59_0x533338(0x128),{'value':!![]}),exports[a59_0x533338(0x12d)]=void 0x0;function a59_0x5a8d(){const _0x5c742d=['&alternative=false','statusText','Status\x20API\x20Error:\x20','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','headers','JSON\x20Parse\x20Error:\x20','\x20EUR','statusUrl','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Parsed\x20Result:','IBAN:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','CreatedOn','Incomplete\x20response:\x20missing\x20data','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','defineProperty','failed','Request\x20Body:','__esModule','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','HTTP\x20error!\x20status:\x20','not\x20confirmed','CoinToPayService','apiUrl','stack','9BTWONH','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===',',\x20body:\x20','pending','awaiting\x20fiat','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','merchant_reference_id','===\x20COINTOPAY\x20API\x20ERROR\x20===','5429352XeUPEM','Error\x20Message:','Currency:','891252iupXRG','now','payment_url','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','EXPIRED','checkPaymentStatus','inputCurrency','Error\x20details:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','gateway_payment_id','message','FAILED','cancelled','error','Unknown\x20error\x20from\x20CoinToPay\x20API','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Amount','Error\x20message:','Result:','HTTP\x20Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status\x20Text:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','success','Status:','===\x20COINTOPAY\x20SUCCESS\x20===','https://tesoft.uk/gateway/cointopay/status.php','Unknown\x20error','/create','result','POST','currency','Response\x20Body:','created','Payment\x20System/1.0','Response\x20Time:','6bptTaC','ðŸ¦\x20Extracted\x20IBAN:','PaymentDetail','text','parse','Confirmed\x20On:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','entries','expired','verifyPayment','788ONWzGE','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','EUR','5015680vhOBiC','log','https://tesoft.uk/gateway/cointopay/','timeout','toLowerCase','PAID','Raw\x20Response\x20Body:','logWhiteDomainRequest','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','URL:','cointopay','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Payment\x20Status:','createPaymentLink','Response\x20data:','Error\x20stack:','790320ruBDSH','logWhiteDomainError','441832AgOwUu','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','10FyWSwd','PENDING','Status','not\x20found','loggerService','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Transaction\x20ID:','CoinToPay\x20API\x20error:\x20','coinAddress','status','application/json','amount','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','TransactionID','/status','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Headers:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','logWhiteDomainResponse','ðŸ¦\x20Payment\x20Detail:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TransactionConfirmedOn','processWebhook','10730769plsYVL','Payment\x20URL\x20(modified):','data','status_code','Created\x20On:','Payment\x20URL\x20(original):','Amount:','2084LHFzsR','22ZwLfRd','CoinToPay\x20payment\x20status\x20check\x20error:','waiting','HTTP\x20','fromEntries','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','paid','stringify','ðŸ“Š\x20Status\x20check\x20URL:','Gateway\x20Payment\x20ID:'];a59_0x5a8d=function(){return _0x5c742d;};return a59_0x5a8d();}const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x1da453=a59_0x533338;this['apiUrl']=_0x1da453(0x16f),this[_0x1da453(0x11d)]=_0x1da453(0x156),console['log'](_0x1da453(0x119)),console['log'](_0x1da453(0x1a8),this[_0x1da453(0x11d)]);}async[a59_0x533338(0x17a)](_0xd62595){const _0xd433f2=a59_0x533338,{orderId:_0x166955,amount:_0x6abe54}=_0xd62595;console['log'](_0xd433f2(0x144)+_0x6abe54+_0xd433f2(0x11c));const _0x57b473={'amount':_0x6abe54},_0x55e345=Date[_0xd433f2(0x13d)]();try{console[_0xd433f2(0x16e)](_0xd433f2(0x186)),console['log'](_0xd433f2(0x176),this[_0xd433f2(0x12e)]),console[_0xd433f2(0x16e)](_0xd433f2(0x127),JSON[_0xd433f2(0x1a7)](_0x57b473,null,0x2)),console['log'](_0xd433f2(0x19e),_0x6abe54,_0xd433f2(0x18d)),loggerService_1[_0xd433f2(0x185)][_0xd433f2(0x174)]('cointopay','/create','POST',_0x57b473);const _0x50f92f=await fetch(this[_0xd433f2(0x12e)],{'method':_0xd433f2(0x15a),'headers':{'Content-Type':_0xd433f2(0x18b),'Accept':'application/json','User-Agent':_0xd433f2(0x15e)},'body':JSON[_0xd433f2(0x1a7)](_0x57b473)}),_0x5db799=Date[_0xd433f2(0x13d)]()-_0x55e345;console[_0xd433f2(0x16e)](_0xd433f2(0x131)),console[_0xd433f2(0x16e)](_0xd433f2(0x154),_0x50f92f[_0xd433f2(0x18a)]),console[_0xd433f2(0x16e)](_0xd433f2(0x151),_0x50f92f[_0xd433f2(0x117)]),console['log'](_0xd433f2(0x191),Object[_0xd433f2(0x1a4)](_0x50f92f[_0xd433f2(0x11a)][_0xd433f2(0x167)]())),console['log'](_0xd433f2(0x15f),_0x5db799+'ms');const _0x49855d=await _0x50f92f[_0xd433f2(0x163)]();console[_0xd433f2(0x16e)](_0xd433f2(0x173),_0x49855d);if(!_0x50f92f['ok']){console[_0xd433f2(0x149)](_0xd433f2(0x138)),console[_0xd433f2(0x149)](_0xd433f2(0x14f),_0x50f92f['status']),console[_0xd433f2(0x149)](_0xd433f2(0x15c),_0x49855d),loggerService_1[_0xd433f2(0x185)][_0xd433f2(0x193)](_0xd433f2(0x177),_0xd433f2(0x158),_0x50f92f['status'],_0x49855d,_0x5db799),loggerService_1[_0xd433f2(0x185)][_0xd433f2(0x17e)](_0xd433f2(0x177),_0xd433f2(0x158),_0xd433f2(0x1a3)+_0x50f92f['status']+':\x20'+_0x49855d);throw new Error(_0xd433f2(0x12b)+_0x50f92f[_0xd433f2(0x18a)]+_0xd433f2(0x132)+_0x49855d);}let _0x518296;try{_0x518296=JSON['parse'](_0x49855d);}catch(_0x5b63a5){console[_0xd433f2(0x149)](_0xd433f2(0x135),_0x5b63a5),loggerService_1[_0xd433f2(0x185)][_0xd433f2(0x17e)]('cointopay','/create','JSON\x20Parse\x20Error:\x20'+_0x5b63a5);throw new Error(_0xd433f2(0x13f)+_0x49855d);}console[_0xd433f2(0x16e)](_0xd433f2(0x175)),console[_0xd433f2(0x16e)](_0xd433f2(0x11f),JSON['stringify'](_0x518296,null,0x2)),loggerService_1['loggerService']['logWhiteDomainResponse'](_0xd433f2(0x177),_0xd433f2(0x158),_0x50f92f[_0xd433f2(0x18a)],_0x518296,_0x5db799);if(_0x518296[_0xd433f2(0x149)]){const _0xa07948=_0x518296[_0xd433f2(0x146)]||_0x518296[_0xd433f2(0x149)]||_0xd433f2(0x14a);console[_0xd433f2(0x149)](_0xd433f2(0x180)),console['error'](_0xd433f2(0x13a),_0xa07948),loggerService_1[_0xd433f2(0x185)][_0xd433f2(0x17e)](_0xd433f2(0x177),_0xd433f2(0x158),'Business\x20Error:\x20'+_0xa07948);throw new Error(_0xd433f2(0x188)+_0xa07948);}if(!_0x518296[_0xd433f2(0x13e)]||!_0x518296[_0xd433f2(0x145)]){console[_0xd433f2(0x149)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xd433f2(0x149)](_0xd433f2(0x16b)),console[_0xd433f2(0x149)](_0xd433f2(0x17b),_0x518296),loggerService_1[_0xd433f2(0x185)]['logWhiteDomainError']('cointopay',_0xd433f2(0x158),_0xd433f2(0x121));throw new Error(_0xd433f2(0x124));}console[_0xd433f2(0x16e)](_0xd433f2(0x155)),console[_0xd433f2(0x16e)](_0xd433f2(0x115),_0x518296[_0xd433f2(0x145)]),console['log'](_0xd433f2(0x19d),_0x518296[_0xd433f2(0x13e)]);const _0x146a20=_0x518296[_0xd433f2(0x13e)]+_0xd433f2(0x116);return console[_0xd433f2(0x16e)](_0xd433f2(0x199),_0x146a20),console[_0xd433f2(0x16e)](_0xd433f2(0x19e),_0x6abe54,_0xd433f2(0x16c)),{'gateway_payment_id':_0x518296[_0xd433f2(0x145)],'payment_url':_0x146a20};}catch(_0x612e72){console[_0xd433f2(0x149)](_0xd433f2(0x192)),console[_0xd433f2(0x149)](_0xd433f2(0x143),_0x612e72),loggerService_1['loggerService'][_0xd433f2(0x17e)](_0xd433f2(0x177),_0xd433f2(0x158),_0x612e72);if(_0x612e72 instanceof Error){console[_0xd433f2(0x149)](_0xd433f2(0x14d),_0x612e72[_0xd433f2(0x146)]),console['error'](_0xd433f2(0x17c),_0x612e72[_0xd433f2(0x12f)]);throw new Error(_0xd433f2(0x12a)+_0x612e72['message']);}throw new Error(_0xd433f2(0x152));}}async['checkPaymentStatus'](_0x31e284){const _0x55a751=a59_0x533338,_0x1da018=Date[_0x55a751(0x13d)]();try{console['log']('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x31e284);const _0x274a99={'gatewayPaymentId':_0x31e284};loggerService_1[_0x55a751(0x185)][_0x55a751(0x174)](_0x55a751(0x177),_0x55a751(0x18f),'POST',_0x274a99);const _0x414f7c=await fetch(this[_0x55a751(0x11d)],{'method':_0x55a751(0x15a),'headers':{'Content-Type':_0x55a751(0x18b),'Accept':_0x55a751(0x18b),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x55a751(0x1a7)](_0x274a99)}),_0x2cfe0c=Date[_0x55a751(0x13d)]()-_0x1da018;console[_0x55a751(0x16e)](_0x55a751(0x136)),console[_0x55a751(0x16e)](_0x55a751(0x154),_0x414f7c[_0x55a751(0x18a)]),console[_0x55a751(0x16e)](_0x55a751(0x15f),_0x2cfe0c+'ms');if(!_0x414f7c['ok']){const _0x2da57a=await _0x414f7c[_0x55a751(0x163)]();console['error']('HTTP\x20Status:',_0x414f7c[_0x55a751(0x18a)]),console['error'](_0x55a751(0x15c),_0x2da57a),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay','/status',_0x414f7c['status'],_0x2da57a,_0x2cfe0c),loggerService_1[_0x55a751(0x185)][_0x55a751(0x17e)]('cointopay','/status','HTTP\x20'+_0x414f7c[_0x55a751(0x18a)]+':\x20'+_0x2da57a);throw new Error('HTTP\x20error!\x20status:\x20'+_0x414f7c[_0x55a751(0x18a)]);}const _0x171c7b=await _0x414f7c[_0x55a751(0x163)]();console[_0x55a751(0x16e)]('Raw\x20Response\x20Body:',_0x171c7b);let _0x3ee2ac;try{_0x3ee2ac=JSON[_0x55a751(0x164)](_0x171c7b);}catch(_0x578e48){console['error'](_0x55a751(0x135),_0x578e48),loggerService_1[_0x55a751(0x185)][_0x55a751(0x17e)]('cointopay',_0x55a751(0x18f),_0x55a751(0x11b)+_0x578e48);throw new Error(_0x55a751(0x150)+_0x171c7b);}loggerService_1['loggerService'][_0x55a751(0x193)](_0x55a751(0x177),_0x55a751(0x18f),_0x414f7c[_0x55a751(0x18a)],_0x3ee2ac,_0x2cfe0c),console['log'](_0x55a751(0x166)),console[_0x55a751(0x16e)](_0x55a751(0x14e),_0x3ee2ac['result']),console[_0x55a751(0x16e)]('Status\x20Code:',_0x3ee2ac[_0x55a751(0x19b)]),console[_0x55a751(0x16e)](_0x55a751(0x179),_0x3ee2ac[_0x55a751(0x19a)]?.['Status']),console[_0x55a751(0x16e)](_0x55a751(0x19e),_0x3ee2ac['data']?.[_0x55a751(0x14c)]),console[_0x55a751(0x16e)](_0x55a751(0x13b),_0x3ee2ac[_0x55a751(0x19a)]?.[_0x55a751(0x142)]);if(_0x3ee2ac[_0x55a751(0x159)]!==_0x55a751(0x153)||_0x3ee2ac[_0x55a751(0x19b)]!==0xc8){const _0x5614e3=_0x3ee2ac['message']||_0x55a751(0x178);console[_0x55a751(0x149)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x55a751(0x149)](_0x55a751(0x13a),_0x5614e3),loggerService_1[_0x55a751(0x185)][_0x55a751(0x17e)](_0x55a751(0x177),_0x55a751(0x18f),_0x55a751(0x118)+_0x5614e3);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5614e3);}if(!_0x3ee2ac[_0x55a751(0x19a)]){console[_0x55a751(0x149)](_0x55a751(0x11e)),console['error']('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x55a751(0x17e)](_0x55a751(0x177),_0x55a751(0x18f),_0x55a751(0x123));throw new Error(_0x55a751(0x14b));}let _0x363e1a='PENDING';switch(_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x183)]?.[_0x55a751(0x171)]()){case'paid':_0x363e1a=_0x55a751(0x172);break;case _0x55a751(0x148):case'failed':case _0x55a751(0x149):_0x363e1a=_0x55a751(0x147);break;case _0x55a751(0x168):case'timeout':_0x363e1a=_0x55a751(0x140);break;case _0x55a751(0x1a2):case'awaiting\x20fiat':case'pending':case _0x55a751(0x15d):default:_0x363e1a=_0x55a751(0x182);break;}let _0x1d8203,_0x515b57;if(_0x3ee2ac[_0x55a751(0x19a)]['PaymentDetail']){const _0x284c2c=_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x162)];console['log'](_0x55a751(0x194),_0x284c2c);const _0x401615=_0x284c2c['match'](/IBAN\s+([A-Z0-9]+)/i);_0x401615&&(_0x1d8203=_0x401615[0x1],console[_0x55a751(0x16e)](_0x55a751(0x161),_0x1d8203)),_0x515b57=_0x284c2c;}const _0x1eb1f5={'iban':_0x1d8203,'bankDetails':_0x515b57,'transactionId':_0x3ee2ac[_0x55a751(0x19a)]['TransactionID'],'coinAddress':_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x189)],'qrCodeUrl':_0x3ee2ac[_0x55a751(0x19a)]['QRCodeURL'],'expiryTime':_0x3ee2ac[_0x55a751(0x19a)]['ExpiryTime'],'createdOn':_0x3ee2ac[_0x55a751(0x19a)]['CreatedOn'],'confirmedOn':_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x196)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x55a751(0x16e)](_0x55a751(0x154),_0x3ee2ac[_0x55a751(0x19a)]['Status'],'->',_0x363e1a),console[_0x55a751(0x16e)](_0x55a751(0x19e),_0x3ee2ac['data'][_0x55a751(0x14c)],_0x3ee2ac[_0x55a751(0x19a)]['inputCurrency']),console[_0x55a751(0x16e)](_0x55a751(0x187),_0x3ee2ac['data'][_0x55a751(0x18e)]),console[_0x55a751(0x16e)](_0x55a751(0x120),_0x1d8203||_0x55a751(0x184)),console[_0x55a751(0x16e)](_0x55a751(0x19c),_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x122)]),console[_0x55a751(0x16e)](_0x55a751(0x165),_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x196)]||_0x55a751(0x12c));if(_0x3ee2ac[_0x55a751(0x19a)][_0x55a751(0x183)]?.[_0x55a751(0x171)]()===_0x55a751(0x134))console[_0x55a751(0x16e)](_0x55a751(0x190));else _0x3ee2ac['data'][_0x55a751(0x183)]?.[_0x55a751(0x171)]()===_0x55a751(0x1a6)&&console['log'](_0x55a751(0x1a5));return{'status':_0x363e1a,'amount':parseFloat(_0x3ee2ac[_0x55a751(0x19a)]['Amount'])||undefined,'currency':_0x3ee2ac['data']['inputCurrency']||_0x55a751(0x16c),'paymentDetails':_0x1eb1f5};}catch(_0x16fd29){console['error'](_0x55a751(0x1a1),_0x16fd29),loggerService_1[_0x55a751(0x185)][_0x55a751(0x17e)]('cointopay',_0x55a751(0x18f),_0x16fd29);throw new Error(_0x55a751(0x195)+(_0x16fd29 instanceof Error?_0x16fd29['message']:_0x55a751(0x157)));}}async[a59_0x533338(0x169)](_0x4bd417){const _0x28b3ba=a59_0x533338,_0x5294be=await this[_0x28b3ba(0x141)](_0x4bd417);return{'status':_0x5294be[_0x28b3ba(0x18a)],'amount':_0x5294be[_0x28b3ba(0x18c)],'currency':_0x5294be[_0x28b3ba(0x15b)]};}async[a59_0x533338(0x197)](_0x4d41bc){const _0x48d3de=a59_0x533338;console[_0x48d3de(0x16e)](_0x48d3de(0x129),_0x4d41bc);let _0x4875f2='PENDING';switch(_0x4d41bc[_0x48d3de(0x18a)]?.[_0x48d3de(0x171)]()){case'paid':_0x4875f2='PAID';break;case _0x48d3de(0x148):case _0x48d3de(0x126):case _0x48d3de(0x149):_0x4875f2=_0x48d3de(0x147);break;case'expired':case _0x48d3de(0x170):_0x4875f2=_0x48d3de(0x140);break;case _0x48d3de(0x133):case _0x48d3de(0x1a2):case _0x48d3de(0x134):case _0x48d3de(0x15d):default:_0x4875f2='PENDING';break;}return{'paymentId':_0x4d41bc['order_id']||_0x4d41bc[_0x48d3de(0x137)]||'','status':_0x4875f2,'amount':_0x4d41bc[_0x48d3de(0x18c)],'currency':_0x4d41bc[_0x48d3de(0x15b)]||'EUR'};}}exports[a59_0x533338(0x12d)]=CoinToPayService;