'use strict';const a47_0x19ece9=a47_0x346f;function a47_0x346f(_0x329dea,_0x276549){const _0x393989=a47_0x3939();return a47_0x346f=function(_0x346f20,_0x5d0ff9){_0x346f20=_0x346f20-0x134;let _0x3ce2e1=_0x393989[_0x346f20];return _0x3ce2e1;},a47_0x346f(_0x329dea,_0x276549);}(function(_0x209852,_0xc31e3e){const _0x20722f=a47_0x346f,_0x44815c=_0x209852();while(!![]){try{const _0x1f9005=parseInt(_0x20722f(0x17d))/0x1+-parseInt(_0x20722f(0x13d))/0x2+-parseInt(_0x20722f(0x1ac))/0x3*(parseInt(_0x20722f(0x185))/0x4)+parseInt(_0x20722f(0x147))/0x5+parseInt(_0x20722f(0x196))/0x6*(-parseInt(_0x20722f(0x1b2))/0x7)+parseInt(_0x20722f(0x154))/0x8+parseInt(_0x20722f(0x1a2))/0x9;if(_0x1f9005===_0xc31e3e)break;else _0x44815c['push'](_0x44815c['shift']());}catch(_0x2fb5d2){_0x44815c['push'](_0x44815c['shift']());}}}(a47_0x3939,0xbad69));function a47_0x3939(){const _0x5301c0=['Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PAID','TransactionID','688714NycOiS','logWhiteDomainRequest','Payment\x20System/1.0','Currency:','Response\x20Time:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','fromEntries','CreatedOn','4KgjawA','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','apiUrl','Response\x20Body:','logWhiteDomainError','created','CoinToPay\x20payment\x20status\x20check\x20error:','paid','loggerService','cointopay','error','currency','headers','Failed\x20to\x20parse\x20JSON\x20response:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','IBAN:','awaiting\x20fiat','48BkHFlt','status','PENDING','Status','QRCodeURL','inputCurrency','ExpiryTime','Status\x20API\x20Error:\x20','statusUrl','HTTP\x20error!\x20status:\x20','stack','Created\x20On:','2347956fUePdR','https://tesoft.uk/gateway/cointopay/status.php','data','logWhiteDomainResponse','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','PaymentDetail','JSON\x20Parse\x20Error:\x20','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','2201139KgBQeU','text','Payment\x20URL\x20(original):','===\x20COINTOPAY\x20SUCCESS\x20===','Gateway\x20Payment\x20ID:','Status:','545524SWQFrV','üè¶\x20Extracted\x20IBAN:','CoinToPay\x20status\x20API\x20error:\x20','POST','payment_url','merchant_reference_id','Headers:','checkPaymentStatus','Response\x20data:','/status','stringify','Incomplete\x20response:\x20missing\x20data','Transaction\x20ID:','CoinToPay\x20API\x20error:\x20','EUR','158706udonXD','TransactionConfirmedOn','application/json','Raw\x20Response\x20Body:','result','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','statusText','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status\x20Code:','3626280PZENcI','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Error\x20message:','CoinToPayService','pending','__esModule','Unknown\x20error','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','coinAddress','Amount:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','message','4215656DRtehb','toLowerCase','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','failed','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','log','gateway_payment_id','amount','Missing\x20data\x20in\x20response','Result:','verifyPayment','HTTP\x20Status:','URL:','FAILED','now','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','not\x20confirmed','waiting','Error\x20Message:','&alternative=false','not\x20found','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','parse','cancelled','order_id','Request\x20Body:','status_code','timeout','Business\x20Error:\x20','/create','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===',',\x20body:\x20','processWebhook','üìä\x20Status\x20check\x20URL:','https://tesoft.uk/gateway/cointopay/','Amount','EXPIRED'];a47_0x3939=function(){return _0x5301c0;};return a47_0x3939();}Object['defineProperty'](exports,a47_0x19ece9(0x14d),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x320a60=a47_0x19ece9;this[_0x320a60(0x187)]=_0x320a60(0x177),this[_0x320a60(0x19e)]=_0x320a60(0x1a3),console[_0x320a60(0x159)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x320a60(0x159)](_0x320a60(0x176),this[_0x320a60(0x19e)]);}async['createPaymentLink'](_0x4d1d86){const _0x3845cf=a47_0x19ece9,{orderId:_0x277b30,amount:_0x10733b}=_0x4d1d86;console[_0x3845cf(0x159)](_0x3845cf(0x163)+_0x10733b+'\x20EUR');const _0x5d183a={'amount':_0x10733b},_0x90fdcf=Date['now']();try{console[_0x3845cf(0x159)](_0x3845cf(0x145)),console[_0x3845cf(0x159)](_0x3845cf(0x160),this['apiUrl']),console[_0x3845cf(0x159)](_0x3845cf(0x16e),JSON[_0x3845cf(0x138)](_0x5d183a,null,0x2)),console[_0x3845cf(0x159)](_0x3845cf(0x151),_0x10733b,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x17e)](_0x3845cf(0x18e),'/create',_0x3845cf(0x1b5),_0x5d183a);const _0x812b8a=await fetch(this[_0x3845cf(0x187)],{'method':'POST','headers':{'Content-Type':_0x3845cf(0x13f),'Accept':'application/json','User-Agent':_0x3845cf(0x17f)},'body':JSON[_0x3845cf(0x138)](_0x5d183a)}),_0x332f7c=Date[_0x3845cf(0x162)]()-_0x90fdcf;console[_0x3845cf(0x159)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log']('Status:',_0x812b8a['status']),console[_0x3845cf(0x159)]('Status\x20Text:',_0x812b8a[_0x3845cf(0x143)]),console[_0x3845cf(0x159)](_0x3845cf(0x134),Object[_0x3845cf(0x183)](_0x812b8a[_0x3845cf(0x191)]['entries']())),console[_0x3845cf(0x159)]('Response\x20Time:',_0x332f7c+'ms');const _0x423abc=await _0x812b8a[_0x3845cf(0x1ad)]();console[_0x3845cf(0x159)](_0x3845cf(0x140),_0x423abc);if(!_0x812b8a['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x3845cf(0x18f)](_0x3845cf(0x15f),_0x812b8a['status']),console[_0x3845cf(0x18f)](_0x3845cf(0x188),_0x423abc),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x1a5)](_0x3845cf(0x18e),_0x3845cf(0x172),_0x812b8a['status'],_0x423abc,_0x332f7c),loggerService_1['loggerService'][_0x3845cf(0x189)]('cointopay',_0x3845cf(0x172),_0x3845cf(0x1aa)+_0x812b8a[_0x3845cf(0x197)]+':\x20'+_0x423abc);throw new Error(_0x3845cf(0x19f)+_0x812b8a[_0x3845cf(0x197)]+_0x3845cf(0x174)+_0x423abc);}let _0x18867f;try{_0x18867f=JSON[_0x3845cf(0x16b)](_0x423abc);}catch(_0x167e90){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x167e90),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x189)](_0x3845cf(0x18e),_0x3845cf(0x172),_0x3845cf(0x1a9)+_0x167e90);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x423abc);}console['log'](_0x3845cf(0x193)),console[_0x3845cf(0x159)]('Parsed\x20Result:',JSON['stringify'](_0x18867f,null,0x2)),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x1a5)]('cointopay','/create',_0x812b8a[_0x3845cf(0x197)],_0x18867f,_0x332f7c);if(_0x18867f['error']){const _0x4735b0=_0x18867f[_0x3845cf(0x153)]||_0x18867f[_0x3845cf(0x18f)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x3845cf(0x18f)](_0x3845cf(0x14f)),console[_0x3845cf(0x18f)](_0x3845cf(0x166),_0x4735b0),loggerService_1['loggerService']['logWhiteDomainError'](_0x3845cf(0x18e),_0x3845cf(0x172),_0x3845cf(0x171)+_0x4735b0);throw new Error(_0x3845cf(0x13b)+_0x4735b0);}if(!_0x18867f[_0x3845cf(0x1b6)]||!_0x18867f[_0x3845cf(0x15a)]){console[_0x3845cf(0x18f)](_0x3845cf(0x173)),console[_0x3845cf(0x18f)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x3845cf(0x18f)](_0x3845cf(0x136),_0x18867f),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x189)]('cointopay',_0x3845cf(0x172),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x3845cf(0x144));}console['log'](_0x3845cf(0x1af)),console[_0x3845cf(0x159)](_0x3845cf(0x1b0),_0x18867f[_0x3845cf(0x15a)]),console[_0x3845cf(0x159)](_0x3845cf(0x1ae),_0x18867f[_0x3845cf(0x1b6)]);const _0x519a10=_0x18867f['payment_url']+_0x3845cf(0x167);return console['log']('Payment\x20URL\x20(modified):',_0x519a10),console['log'](_0x3845cf(0x151),_0x10733b,_0x3845cf(0x13c)),{'gateway_payment_id':_0x18867f[_0x3845cf(0x15a)],'payment_url':_0x519a10};}catch(_0x5c040c){console[_0x3845cf(0x18f)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error']('Error\x20details:',_0x5c040c),loggerService_1[_0x3845cf(0x18d)][_0x3845cf(0x189)](_0x3845cf(0x18e),'/create',_0x5c040c);if(_0x5c040c instanceof Error){console[_0x3845cf(0x18f)](_0x3845cf(0x14a),_0x5c040c[_0x3845cf(0x153)]),console[_0x3845cf(0x18f)](_0x3845cf(0x148),_0x5c040c[_0x3845cf(0x1a0)]);throw new Error(_0x3845cf(0x152)+_0x5c040c[_0x3845cf(0x153)]);}throw new Error(_0x3845cf(0x1a6));}}async[a47_0x19ece9(0x135)](_0x5184ac){const _0x57400c=a47_0x19ece9,_0x382824=Date[_0x57400c(0x162)]();try{console['log'](_0x57400c(0x156)+_0x5184ac);const _0x2a8546={'gatewayPaymentId':_0x5184ac};loggerService_1[_0x57400c(0x18d)][_0x57400c(0x17e)](_0x57400c(0x18e),_0x57400c(0x137),_0x57400c(0x1b5),_0x2a8546);const _0x346c84=await fetch(this['statusUrl'],{'method':_0x57400c(0x1b5),'headers':{'Content-Type':'application/json','Accept':_0x57400c(0x13f),'User-Agent':_0x57400c(0x17f)},'body':JSON['stringify'](_0x2a8546)}),_0x453e15=Date[_0x57400c(0x162)]()-_0x382824;console[_0x57400c(0x159)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x57400c(0x159)](_0x57400c(0x1b1),_0x346c84[_0x57400c(0x197)]),console[_0x57400c(0x159)](_0x57400c(0x181),_0x453e15+'ms');if(!_0x346c84['ok']){const _0x47f43f=await _0x346c84[_0x57400c(0x1ad)]();console[_0x57400c(0x18f)](_0x57400c(0x15f),_0x346c84['status']),console[_0x57400c(0x18f)](_0x57400c(0x188),_0x47f43f),loggerService_1[_0x57400c(0x18d)][_0x57400c(0x1a5)]('cointopay',_0x57400c(0x137),_0x346c84['status'],_0x47f43f,_0x453e15),loggerService_1[_0x57400c(0x18d)][_0x57400c(0x189)](_0x57400c(0x18e),_0x57400c(0x137),_0x57400c(0x1aa)+_0x346c84[_0x57400c(0x197)]+':\x20'+_0x47f43f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x346c84[_0x57400c(0x197)]);}const _0x4dad1c=await _0x346c84[_0x57400c(0x1ad)]();console[_0x57400c(0x159)](_0x57400c(0x140),_0x4dad1c);let _0x5b0e7e;try{_0x5b0e7e=JSON[_0x57400c(0x16b)](_0x4dad1c);}catch(_0x12a74a){console[_0x57400c(0x18f)](_0x57400c(0x192),_0x12a74a),loggerService_1['loggerService'][_0x57400c(0x189)]('cointopay',_0x57400c(0x137),_0x57400c(0x1a9)+_0x12a74a);throw new Error(_0x57400c(0x17a)+_0x4dad1c);}loggerService_1[_0x57400c(0x18d)][_0x57400c(0x1a5)](_0x57400c(0x18e),'/status',_0x346c84['status'],_0x5b0e7e,_0x453e15),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x57400c(0x159)](_0x57400c(0x15d),_0x5b0e7e[_0x57400c(0x141)]),console['log'](_0x57400c(0x146),_0x5b0e7e[_0x57400c(0x16f)]),console[_0x57400c(0x159)]('Payment\x20Status:',_0x5b0e7e[_0x57400c(0x1a4)]?.[_0x57400c(0x199)]),console[_0x57400c(0x159)](_0x57400c(0x151),_0x5b0e7e[_0x57400c(0x1a4)]?.[_0x57400c(0x178)]),console[_0x57400c(0x159)](_0x57400c(0x180),_0x5b0e7e[_0x57400c(0x1a4)]?.[_0x57400c(0x19b)]);if(_0x5b0e7e[_0x57400c(0x141)]!=='success'||_0x5b0e7e['status_code']!==0xc8){const _0x1b25d3=_0x5b0e7e['message']||_0x57400c(0x186);console[_0x57400c(0x18f)](_0x57400c(0x1ab)),console[_0x57400c(0x18f)](_0x57400c(0x166),_0x1b25d3),loggerService_1[_0x57400c(0x18d)][_0x57400c(0x189)](_0x57400c(0x18e),'/status',_0x57400c(0x19d)+_0x1b25d3);throw new Error(_0x57400c(0x1b4)+_0x1b25d3);}if(!_0x5b0e7e[_0x57400c(0x1a4)]){console[_0x57400c(0x18f)](_0x57400c(0x149)),console[_0x57400c(0x18f)](_0x57400c(0x15c)),loggerService_1[_0x57400c(0x18d)]['logWhiteDomainError']('cointopay','/status',_0x57400c(0x139));throw new Error(_0x57400c(0x182));}let _0x302e5a=_0x57400c(0x198);switch(_0x5b0e7e[_0x57400c(0x1a4)]['Status']?.[_0x57400c(0x155)]()){case _0x57400c(0x18c):_0x302e5a=_0x57400c(0x17b);break;case _0x57400c(0x16c):case _0x57400c(0x157):case'error':_0x302e5a='FAILED';break;case'expired':case _0x57400c(0x170):_0x302e5a='EXPIRED';break;case _0x57400c(0x165):case _0x57400c(0x195):case _0x57400c(0x14c):case _0x57400c(0x18a):default:_0x302e5a=_0x57400c(0x198);break;}let _0xb0c55b,_0x456b96;if(_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x1a8)]){const _0x4bd3f9=_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x1a8)];console['log']('üè¶\x20Payment\x20Detail:',_0x4bd3f9);const _0x4eaec8=_0x4bd3f9['match'](/IBAN\s+([A-Z0-9]+)/i);_0x4eaec8&&(_0xb0c55b=_0x4eaec8[0x1],console['log'](_0x57400c(0x1b3),_0xb0c55b)),_0x456b96=_0x4bd3f9;}const _0x143320={'iban':_0xb0c55b,'bankDetails':_0x456b96,'transactionId':_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x17c)],'coinAddress':_0x5b0e7e['data'][_0x57400c(0x150)],'qrCodeUrl':_0x5b0e7e['data'][_0x57400c(0x19a)],'expiryTime':_0x5b0e7e['data'][_0x57400c(0x19c)],'createdOn':_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x184)],'confirmedOn':_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x13e)]};console[_0x57400c(0x159)](_0x57400c(0x142)),console[_0x57400c(0x159)](_0x57400c(0x1b1),_0x5b0e7e[_0x57400c(0x1a4)]['Status'],'->',_0x302e5a),console['log'](_0x57400c(0x151),_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x178)],_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x19b)]),console['log'](_0x57400c(0x13a),_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x17c)]),console[_0x57400c(0x159)](_0x57400c(0x194),_0xb0c55b||_0x57400c(0x168)),console[_0x57400c(0x159)](_0x57400c(0x1a1),_0x5b0e7e['data']['CreatedOn']),console[_0x57400c(0x159)]('Confirmed\x20On:',_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x13e)]||_0x57400c(0x164));if(_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x199)]?.[_0x57400c(0x155)]()===_0x57400c(0x195))console['log'](_0x57400c(0x16a));else _0x5b0e7e['data'][_0x57400c(0x199)]?.[_0x57400c(0x155)]()===_0x57400c(0x18c)&&console[_0x57400c(0x159)](_0x57400c(0x169));return{'status':_0x302e5a,'amount':parseFloat(_0x5b0e7e['data'][_0x57400c(0x178)])||undefined,'currency':_0x5b0e7e[_0x57400c(0x1a4)][_0x57400c(0x19b)]||_0x57400c(0x13c),'paymentDetails':_0x143320};}catch(_0x3b36b8){console[_0x57400c(0x18f)](_0x57400c(0x18b),_0x3b36b8),loggerService_1[_0x57400c(0x18d)][_0x57400c(0x189)](_0x57400c(0x18e),_0x57400c(0x137),_0x3b36b8);throw new Error(_0x57400c(0x1a7)+(_0x3b36b8 instanceof Error?_0x3b36b8[_0x57400c(0x153)]:_0x57400c(0x14e)));}}async[a47_0x19ece9(0x15e)](_0x2329dc){const _0x2e16ce=a47_0x19ece9,_0x2c77af=await this[_0x2e16ce(0x135)](_0x2329dc);return{'status':_0x2c77af[_0x2e16ce(0x197)],'amount':_0x2c77af[_0x2e16ce(0x15b)],'currency':_0x2c77af[_0x2e16ce(0x190)]};}async[a47_0x19ece9(0x175)](_0x5695bd){const _0x53c3cf=a47_0x19ece9;console[_0x53c3cf(0x159)](_0x53c3cf(0x158),_0x5695bd);let _0x3d4be5='PENDING';switch(_0x5695bd[_0x53c3cf(0x197)]?.[_0x53c3cf(0x155)]()){case _0x53c3cf(0x18c):_0x3d4be5=_0x53c3cf(0x17b);break;case _0x53c3cf(0x16c):case _0x53c3cf(0x157):case _0x53c3cf(0x18f):_0x3d4be5=_0x53c3cf(0x161);break;case'expired':case _0x53c3cf(0x170):_0x3d4be5=_0x53c3cf(0x179);break;case'pending':case _0x53c3cf(0x165):case _0x53c3cf(0x195):case _0x53c3cf(0x18a):default:_0x3d4be5='PENDING';break;}return{'paymentId':_0x5695bd[_0x53c3cf(0x16d)]||_0x5695bd[_0x53c3cf(0x1b7)]||'','status':_0x3d4be5,'amount':_0x5695bd[_0x53c3cf(0x15b)],'currency':_0x5695bd['currency']||_0x53c3cf(0x13c)};}}exports[a47_0x19ece9(0x14b)]=CoinToPayService;