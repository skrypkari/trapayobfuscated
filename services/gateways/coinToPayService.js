'use strict';const a49_0x473dfb=a49_0x2a62;function a49_0x2b94(){const _0x8d232b=['paid','text','status','PAID','gateway_payment_id','8161090RYoBTH','Status','verifyPayment','stack','created','pending','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Payment\x20URL\x20(modified):','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20Status:','application/json','Headers:','expired','failed','Error\x20stack:','logWhiteDomainRequest','fromEntries','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','1976442jFkYPF','cancelled','Amount','üìä\x20Status\x20check\x20URL:','TransactionID','738912PeoASM','not\x20found','Payment\x20URL\x20(original):','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','payment_url','amount','inputCurrency','EXPIRED','statusText','Created\x20On:','error','/create','POST','Amount:','===\x20COINTOPAY\x20SUCCESS\x20===','Transaction\x20ID:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20details:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','HTTP\x20error!\x20status:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','IBAN:','573489WYGuBT','URL:','Request\x20Body:','üè¶\x20Extracted\x20IBAN:','parse','CoinToPayService','stringify','defineProperty','__esModule','Error\x20message:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','cointopay','Result:','FAILED','result','now','waiting','CoinToPay\x20payment\x20status\x20check\x20error:','logWhiteDomainResponse','https://tesoft.uk/gateway/cointopay/','loggerService','CoinToPay\x20status\x20API\x20error:\x20','Missing\x20data\x20in\x20response','CreatedOn','timeout','checkPaymentStatus','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Confirmed\x20On:','===\x20COINTOPAY\x20API\x20ERROR\x20===','apiUrl','Response\x20data:','Payment\x20Status:','processWebhook','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Parsed\x20Result:','match','Payment\x20System/1.0','logWhiteDomainError','HTTP\x20','toLowerCase','Incomplete\x20response:\x20missing\x20data','EUR','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Unknown\x20error','JSON\x20Parse\x20Error:\x20','createPaymentLink','currency','log','Failed\x20to\x20parse\x20JSON\x20response:','status_code','Response\x20Body:','PaymentDetail','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','CoinToPay\x20API\x20error:\x20','message','Error\x20Message:','541339oyUSZx','order_id','TransactionConfirmedOn','Currency:','1910216ebtJrK','success','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Status\x20Text:','/status','Raw\x20Response\x20Body:','Business\x20Error:\x20','Status\x20API\x20Error:\x20','awaiting\x20fiat','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','headers','PENDING','../loggerService','data','4140545EsQzLg','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','statusUrl','Response\x20Time:','&alternative=false','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'];a49_0x2b94=function(){return _0x8d232b;};return a49_0x2b94();}(function(_0x4bb4bd,_0x40dd52){const _0x1dfccc=a49_0x2a62,_0x51f90e=_0x4bb4bd();while(!![]){try{const _0x351463=-parseInt(_0x1dfccc(0x138))/0x1+-parseInt(_0x1dfccc(0x16d))/0x2+parseInt(_0x1dfccc(0x184))/0x3+-parseInt(_0x1dfccc(0x13c))/0x4+parseInt(_0x1dfccc(0x14b))/0x5+-parseInt(_0x1dfccc(0x168))/0x6+parseInt(_0x1dfccc(0x156))/0x7;if(_0x351463===_0x40dd52)break;else _0x51f90e['push'](_0x51f90e['shift']());}catch(_0x2342ea){_0x51f90e['push'](_0x51f90e['shift']());}}}(a49_0x2b94,0x721ba));Object[a49_0x473dfb(0x18b)](exports,a49_0x473dfb(0x18c),{'value':!![]}),exports[a49_0x473dfb(0x189)]=void 0x0;const loggerService_1=require(a49_0x473dfb(0x149));class CoinToPayService{constructor(){const _0x54c16d=a49_0x473dfb;this[_0x54c16d(0x11c)]=_0x54c16d(0x197),this[_0x54c16d(0x14d)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x54c16d(0x12f)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x54c16d(0x12f)](_0x54c16d(0x16b),this[_0x54c16d(0x14d)]);}async[a49_0x473dfb(0x12d)](_0x401e4f){const _0x79c155=a49_0x473dfb,{orderId:_0x4dcdf9,amount:_0x36ca60}=_0x401e4f;console['log'](_0x79c155(0x15c)+_0x36ca60+'\x20EUR');const _0x36d56f={'amount':_0x36ca60},_0x622e5=Date[_0x79c155(0x193)]();try{console[_0x79c155(0x12f)](_0x79c155(0x145)),console[_0x79c155(0x12f)](_0x79c155(0x185),this['apiUrl']),console['log'](_0x79c155(0x186),JSON[_0x79c155(0x18a)](_0x36d56f,null,0x2)),console[_0x79c155(0x12f)]('Amount:',_0x36ca60,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x79c155(0x198)][_0x79c155(0x165)](_0x79c155(0x18f),_0x79c155(0x179),_0x79c155(0x17a),_0x36d56f);const _0xe2f46a=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x79c155(0x160),'Accept':_0x79c155(0x160),'User-Agent':_0x79c155(0x124)},'body':JSON[_0x79c155(0x18a)](_0x36d56f)}),_0x42ccd0=Date['now']()-_0x622e5;console[_0x79c155(0x12f)](_0x79c155(0x180)),console[_0x79c155(0x12f)]('Status:',_0xe2f46a[_0x79c155(0x153)]),console[_0x79c155(0x12f)](_0x79c155(0x13f),_0xe2f46a[_0x79c155(0x176)]),console[_0x79c155(0x12f)](_0x79c155(0x161),Object[_0x79c155(0x166)](_0xe2f46a[_0x79c155(0x147)]['entries']())),console[_0x79c155(0x12f)](_0x79c155(0x14e),_0x42ccd0+'ms');const _0x31e69f=await _0xe2f46a[_0x79c155(0x152)]();console[_0x79c155(0x12f)](_0x79c155(0x141),_0x31e69f);if(!_0xe2f46a['ok']){console['error'](_0x79c155(0x11b)),console['error'](_0x79c155(0x15f),_0xe2f46a[_0x79c155(0x153)]),console['error'](_0x79c155(0x132),_0x31e69f),loggerService_1[_0x79c155(0x198)][_0x79c155(0x196)](_0x79c155(0x18f),_0x79c155(0x179),_0xe2f46a[_0x79c155(0x153)],_0x31e69f,_0x42ccd0),loggerService_1[_0x79c155(0x198)][_0x79c155(0x125)](_0x79c155(0x18f),_0x79c155(0x179),_0x79c155(0x126)+_0xe2f46a[_0x79c155(0x153)]+':\x20'+_0x31e69f);throw new Error(_0x79c155(0x181)+_0xe2f46a[_0x79c155(0x153)]+',\x20body:\x20'+_0x31e69f);}let _0x17f2d4;try{_0x17f2d4=JSON[_0x79c155(0x188)](_0x31e69f);}catch(_0x2faf97){console[_0x79c155(0x178)](_0x79c155(0x130),_0x2faf97),loggerService_1[_0x79c155(0x198)][_0x79c155(0x125)]('cointopay',_0x79c155(0x179),_0x79c155(0x12c)+_0x2faf97);throw new Error(_0x79c155(0x121)+_0x31e69f);}console[_0x79c155(0x12f)](_0x79c155(0x18e)),console[_0x79c155(0x12f)](_0x79c155(0x122),JSON[_0x79c155(0x18a)](_0x17f2d4,null,0x2)),loggerService_1[_0x79c155(0x198)][_0x79c155(0x196)](_0x79c155(0x18f),_0x79c155(0x179),_0xe2f46a[_0x79c155(0x153)],_0x17f2d4,_0x42ccd0);if(_0x17f2d4['error']){const _0x4b1ca7=_0x17f2d4[_0x79c155(0x136)]||_0x17f2d4['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x79c155(0x178)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x79c155(0x178)](_0x79c155(0x137),_0x4b1ca7),loggerService_1[_0x79c155(0x198)][_0x79c155(0x125)](_0x79c155(0x18f),'/create',_0x79c155(0x142)+_0x4b1ca7);throw new Error(_0x79c155(0x135)+_0x4b1ca7);}if(!_0x17f2d4[_0x79c155(0x172)]||!_0x17f2d4[_0x79c155(0x155)]){console[_0x79c155(0x178)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x79c155(0x178)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x79c155(0x178)](_0x79c155(0x11d),_0x17f2d4),loggerService_1['loggerService']['logWhiteDomainError']('cointopay','/create',_0x79c155(0x17e));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x79c155(0x12f)](_0x79c155(0x17c)),console[_0x79c155(0x12f)]('Gateway\x20Payment\x20ID:',_0x17f2d4[_0x79c155(0x155)]),console[_0x79c155(0x12f)](_0x79c155(0x16f),_0x17f2d4[_0x79c155(0x172)]);const _0x5516e5=_0x17f2d4[_0x79c155(0x172)]+_0x79c155(0x14f);return console[_0x79c155(0x12f)](_0x79c155(0x15d),_0x5516e5),console[_0x79c155(0x12f)](_0x79c155(0x17b),_0x36ca60,_0x79c155(0x129)),{'gateway_payment_id':_0x17f2d4[_0x79c155(0x155)],'payment_url':_0x5516e5};}catch(_0x25edb7){console[_0x79c155(0x178)](_0x79c155(0x134)),console['error'](_0x79c155(0x17f),_0x25edb7),loggerService_1[_0x79c155(0x198)][_0x79c155(0x125)]('cointopay','/create',_0x25edb7);if(_0x25edb7 instanceof Error){console[_0x79c155(0x178)](_0x79c155(0x18d),_0x25edb7[_0x79c155(0x136)]),console[_0x79c155(0x178)](_0x79c155(0x164),_0x25edb7[_0x79c155(0x159)]);throw new Error(_0x79c155(0x182)+_0x25edb7['message']);}throw new Error(_0x79c155(0x119));}}async[a49_0x473dfb(0x118)](_0x521561){const _0x4ab1be=a49_0x473dfb,_0x4c9c41=Date[_0x4ab1be(0x193)]();try{console[_0x4ab1be(0x12f)](_0x4ab1be(0x150)+_0x521561);const _0x437291={'gatewayPaymentId':_0x521561};loggerService_1['loggerService'][_0x4ab1be(0x165)](_0x4ab1be(0x18f),_0x4ab1be(0x140),_0x4ab1be(0x17a),_0x437291);const _0x57dd12=await fetch(this[_0x4ab1be(0x14d)],{'method':'POST','headers':{'Content-Type':_0x4ab1be(0x160),'Accept':_0x4ab1be(0x160),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x4ab1be(0x18a)](_0x437291)}),_0x448de3=Date[_0x4ab1be(0x193)]()-_0x4c9c41;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x4ab1be(0x12f)]('Status:',_0x57dd12[_0x4ab1be(0x153)]),console[_0x4ab1be(0x12f)]('Response\x20Time:',_0x448de3+'ms');if(!_0x57dd12['ok']){const _0x47cff9=await _0x57dd12['text']();console[_0x4ab1be(0x178)](_0x4ab1be(0x15f),_0x57dd12[_0x4ab1be(0x153)]),console['error'](_0x4ab1be(0x132),_0x47cff9),loggerService_1[_0x4ab1be(0x198)]['logWhiteDomainResponse']('cointopay','/status',_0x57dd12[_0x4ab1be(0x153)],_0x47cff9,_0x448de3),loggerService_1['loggerService'][_0x4ab1be(0x125)](_0x4ab1be(0x18f),_0x4ab1be(0x140),'HTTP\x20'+_0x57dd12['status']+':\x20'+_0x47cff9);throw new Error(_0x4ab1be(0x181)+_0x57dd12[_0x4ab1be(0x153)]);}const _0x25c739=await _0x57dd12[_0x4ab1be(0x152)]();console[_0x4ab1be(0x12f)](_0x4ab1be(0x141),_0x25c739);let _0x3e24d4;try{_0x3e24d4=JSON[_0x4ab1be(0x188)](_0x25c739);}catch(_0x48aa70){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x48aa70),loggerService_1['loggerService'][_0x4ab1be(0x125)](_0x4ab1be(0x18f),_0x4ab1be(0x140),'JSON\x20Parse\x20Error:\x20'+_0x48aa70);throw new Error(_0x4ab1be(0x15e)+_0x25c739);}loggerService_1[_0x4ab1be(0x198)][_0x4ab1be(0x196)](_0x4ab1be(0x18f),_0x4ab1be(0x140),_0x57dd12[_0x4ab1be(0x153)],_0x3e24d4,_0x448de3),console[_0x4ab1be(0x12f)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x4ab1be(0x12f)](_0x4ab1be(0x190),_0x3e24d4['result']),console[_0x4ab1be(0x12f)]('Status\x20Code:',_0x3e24d4[_0x4ab1be(0x131)]),console[_0x4ab1be(0x12f)](_0x4ab1be(0x11e),_0x3e24d4[_0x4ab1be(0x14a)]?.[_0x4ab1be(0x157)]),console[_0x4ab1be(0x12f)]('Amount:',_0x3e24d4['data']?.['Amount']),console['log'](_0x4ab1be(0x13b),_0x3e24d4[_0x4ab1be(0x14a)]?.[_0x4ab1be(0x174)]);if(_0x3e24d4[_0x4ab1be(0x192)]!==_0x4ab1be(0x13d)||_0x3e24d4[_0x4ab1be(0x131)]!==0xc8){const _0x552013=_0x3e24d4[_0x4ab1be(0x136)]||_0x4ab1be(0x13e);console['error'](_0x4ab1be(0x12a)),console['error']('Error\x20Message:',_0x552013),loggerService_1['loggerService']['logWhiteDomainError'](_0x4ab1be(0x18f),_0x4ab1be(0x140),_0x4ab1be(0x143)+_0x552013);throw new Error(_0x4ab1be(0x199)+_0x552013);}if(!_0x3e24d4[_0x4ab1be(0x14a)]){console['error'](_0x4ab1be(0x14c)),console[_0x4ab1be(0x178)](_0x4ab1be(0x19a)),loggerService_1[_0x4ab1be(0x198)][_0x4ab1be(0x125)](_0x4ab1be(0x18f),_0x4ab1be(0x140),_0x4ab1be(0x128));throw new Error(_0x4ab1be(0x167));}let _0x3d7aa0=_0x4ab1be(0x148);switch(_0x3e24d4['data'][_0x4ab1be(0x157)]?.['toLowerCase']()){case'paid':_0x3d7aa0=_0x4ab1be(0x154);break;case _0x4ab1be(0x169):case _0x4ab1be(0x163):case _0x4ab1be(0x178):_0x3d7aa0=_0x4ab1be(0x191);break;case _0x4ab1be(0x162):case _0x4ab1be(0x117):_0x3d7aa0=_0x4ab1be(0x175);break;case _0x4ab1be(0x194):case _0x4ab1be(0x144):case _0x4ab1be(0x15b):case _0x4ab1be(0x15a):default:_0x3d7aa0=_0x4ab1be(0x148);break;}let _0x394954,_0x17d106;if(_0x3e24d4[_0x4ab1be(0x14a)]['PaymentDetail']){const _0x37091a=_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x133)];console[_0x4ab1be(0x12f)]('üè¶\x20Payment\x20Detail:',_0x37091a);const _0x5d39f6=_0x37091a[_0x4ab1be(0x123)](/IBAN\s+([A-Z0-9]+)/i);_0x5d39f6&&(_0x394954=_0x5d39f6[0x1],console[_0x4ab1be(0x12f)](_0x4ab1be(0x187),_0x394954)),_0x17d106=_0x37091a;}const _0x35bd3f={'iban':_0x394954,'bankDetails':_0x17d106,'transactionId':_0x3e24d4['data'][_0x4ab1be(0x16c)],'coinAddress':_0x3e24d4[_0x4ab1be(0x14a)]['coinAddress'],'qrCodeUrl':_0x3e24d4[_0x4ab1be(0x14a)]['QRCodeURL'],'expiryTime':_0x3e24d4[_0x4ab1be(0x14a)]['ExpiryTime'],'createdOn':_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x19b)],'confirmedOn':_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x13a)]};console[_0x4ab1be(0x12f)](_0x4ab1be(0x171)),console[_0x4ab1be(0x12f)]('Status:',_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x157)],'->',_0x3d7aa0),console[_0x4ab1be(0x12f)](_0x4ab1be(0x17b),_0x3e24d4['data'][_0x4ab1be(0x16a)],_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x174)]),console[_0x4ab1be(0x12f)](_0x4ab1be(0x17d),_0x3e24d4['data'][_0x4ab1be(0x16c)]),console[_0x4ab1be(0x12f)](_0x4ab1be(0x183),_0x394954||_0x4ab1be(0x16e)),console[_0x4ab1be(0x12f)](_0x4ab1be(0x177),_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x19b)]),console[_0x4ab1be(0x12f)](_0x4ab1be(0x11a),_0x3e24d4['data'][_0x4ab1be(0x13a)]||'not\x20confirmed');if(_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x157)]?.['toLowerCase']()==='awaiting\x20fiat')console[_0x4ab1be(0x12f)](_0x4ab1be(0x146));else _0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x157)]?.[_0x4ab1be(0x127)]()===_0x4ab1be(0x151)&&console['log']('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x3d7aa0,'amount':parseFloat(_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x16a)])||undefined,'currency':_0x3e24d4[_0x4ab1be(0x14a)][_0x4ab1be(0x174)]||_0x4ab1be(0x129),'paymentDetails':_0x35bd3f};}catch(_0x5ce56c){console[_0x4ab1be(0x178)](_0x4ab1be(0x195),_0x5ce56c),loggerService_1[_0x4ab1be(0x198)]['logWhiteDomainError'](_0x4ab1be(0x18f),_0x4ab1be(0x140),_0x5ce56c);throw new Error(_0x4ab1be(0x120)+(_0x5ce56c instanceof Error?_0x5ce56c[_0x4ab1be(0x136)]:_0x4ab1be(0x12b)));}}async[a49_0x473dfb(0x158)](_0x340e2d){const _0xa9fbe7=a49_0x473dfb,_0x885e9a=await this['checkPaymentStatus'](_0x340e2d);return{'status':_0x885e9a[_0xa9fbe7(0x153)],'amount':_0x885e9a[_0xa9fbe7(0x173)],'currency':_0x885e9a[_0xa9fbe7(0x12e)]};}async[a49_0x473dfb(0x11f)](_0x11c983){const _0x5dd0b4=a49_0x473dfb;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x11c983);let _0x4870a9=_0x5dd0b4(0x148);switch(_0x11c983[_0x5dd0b4(0x153)]?.[_0x5dd0b4(0x127)]()){case _0x5dd0b4(0x151):_0x4870a9=_0x5dd0b4(0x154);break;case _0x5dd0b4(0x169):case'failed':case'error':_0x4870a9=_0x5dd0b4(0x191);break;case'expired':case'timeout':_0x4870a9=_0x5dd0b4(0x175);break;case'pending':case _0x5dd0b4(0x194):case _0x5dd0b4(0x144):case'created':default:_0x4870a9=_0x5dd0b4(0x148);break;}return{'paymentId':_0x11c983[_0x5dd0b4(0x139)]||_0x11c983[_0x5dd0b4(0x170)]||'','status':_0x4870a9,'amount':_0x11c983[_0x5dd0b4(0x173)],'currency':_0x11c983[_0x5dd0b4(0x12e)]||_0x5dd0b4(0x129)};}}function a49_0x2a62(_0x5bfd15,_0x13393c){const _0x2b94d4=a49_0x2b94();return a49_0x2a62=function(_0x2a6281,_0x202992){_0x2a6281=_0x2a6281-0x117;let _0x56718b=_0x2b94d4[_0x2a6281];return _0x56718b;},a49_0x2a62(_0x5bfd15,_0x13393c);}exports[a49_0x473dfb(0x189)]=CoinToPayService;