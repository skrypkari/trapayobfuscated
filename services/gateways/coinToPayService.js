'use strict';function a40_0x4ab0(){const _0x1424bd=['merchant_reference_id','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','loggerService','CreatedOn','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TransactionConfirmedOn','verifyPayment','FAILED','Error\x20Message:','Failed\x20to\x20parse\x20JSON\x20response:','failed','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','1090aIfMla','Response\x20data:','status_code','statusUrl','25554LewwIn','===\x20COINTOPAY\x20SUCCESS\x20===','application/json','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20API\x20ERROR\x20===','Gateway\x20Payment\x20ID:','match','TesSoft\x20Payment\x20System/1.0','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','\x20EUR','statusText','https://tesoft.uk/gateway/cointopay/','payment_url','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Missing\x20data\x20in\x20response','Business\x20Error:\x20','data','Unknown\x20error\x20from\x20CoinToPay\x20API','expired','Response\x20Body:','HTTP\x20','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','498832xLLlzE','status','../loggerService','checkPaymentStatus','not\x20confirmed','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Created\x20On:','fromEntries','now',',\x20body:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','processWebhook','createPaymentLink','ExpiryTime','PAID','/create','Headers:','Parsed\x20Result:','message','JSON\x20Parse\x20Error:\x20','waiting','Status:','Transaction\x20ID:','Status','cointopay','Amount:','logWhiteDomainResponse','/status','created','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','CoinToPayService','2465937omCGDw','2XrfNYz','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','CoinToPay\x20API\x20error:\x20','PENDING','toLowerCase','currency','495175FFaqnQ','Confirmed\x20On:','cancelled','logWhiteDomainRequest','pending','üìä\x20Status\x20check\x20URL:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','timeout','https://tesoft.uk/gateway/cointopay/status.php','Error\x20stack:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','5VXSlHs','899235KgOCQg','__esModule','HTTP\x20Status:','stack','Amount','entries','Unknown\x20error','Request\x20Body:','Response\x20Time:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','not\x20found','PaymentDetail','EUR','HTTP\x20error!\x20status:\x20','parse','POST','Raw\x20Response\x20Body:','apiUrl','logWhiteDomainError','üè¶\x20Payment\x20Detail:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Result:','198224hOdopr','gateway_payment_id','awaiting\x20fiat','IBAN:','EXPIRED','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','120835VrvptQ','log','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','959GzlWVZ','error','stringify','headers','Incomplete\x20response:\x20missing\x20data','CoinToPay\x20payment\x20status\x20check\x20error:','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','inputCurrency'];a40_0x4ab0=function(){return _0x1424bd;};return a40_0x4ab0();}const a40_0x530d5a=a40_0x38e3;(function(_0x3cfa2d,_0x191a5a){const _0xc3c7de=a40_0x38e3,_0x344b96=_0x3cfa2d();while(!![]){try{const _0x460e81=parseInt(_0xc3c7de(0x1a7))/0x1*(-parseInt(_0xc3c7de(0x1a0))/0x2)+parseInt(_0xc3c7de(0x1b5))/0x3+-parseInt(_0xc3c7de(0x180))/0x4*(-parseInt(_0xc3c7de(0x1b4))/0x5)+parseInt(_0xc3c7de(0x16a))/0x6*(-parseInt(_0xc3c7de(0x150))/0x7)+parseInt(_0xc3c7de(0x147))/0x8+-parseInt(_0xc3c7de(0x19f))/0x9+parseInt(_0xc3c7de(0x166))/0xa*(parseInt(_0xc3c7de(0x14d))/0xb);if(_0x460e81===_0x191a5a)break;else _0x344b96['push'](_0x344b96['shift']());}catch(_0x1e4354){_0x344b96['push'](_0x344b96['shift']());}}}(a40_0x4ab0,0x47c39));Object['defineProperty'](exports,a40_0x530d5a(0x1b6),{'value':!![]}),exports[a40_0x530d5a(0x19e)]=void 0x0;function a40_0x38e3(_0x4966e3,_0x58b5b4){const _0x4ab039=a40_0x4ab0();return a40_0x38e3=function(_0x38e318,_0x5b1792){_0x38e318=_0x38e318-0x13f;let _0x2b8a2a=_0x4ab039[_0x38e318];return _0x2b8a2a;},a40_0x38e3(_0x4966e3,_0x58b5b4);}const loggerService_1=require(a40_0x530d5a(0x182));class CoinToPayService{constructor(){const _0x12700a=a40_0x530d5a;this[_0x12700a(0x142)]=_0x12700a(0x175),this[_0x12700a(0x169)]=_0x12700a(0x1b0),console[_0x12700a(0x14e)](_0x12700a(0x17f)),console[_0x12700a(0x14e)](_0x12700a(0x1ac),this[_0x12700a(0x169)]);}async[a40_0x530d5a(0x18c)](_0x1bdbe4){const _0x5a7fd3=a40_0x530d5a,{orderId:_0x45ddfa,amount:_0x58325d}=_0x1bdbe4;console['log'](_0x5a7fd3(0x156)+_0x58325d+_0x5a7fd3(0x173));const _0x56feb7={'amount':_0x58325d},_0x53b554=Date[_0x5a7fd3(0x188)]();try{console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x1a1)),console[_0x5a7fd3(0x14e)]('URL:',this[_0x5a7fd3(0x142)]),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x1bc),JSON['stringify'](_0x56feb7,null,0x2)),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x199),_0x58325d,_0x5a7fd3(0x18a)),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x1aa)]('cointopay',_0x5a7fd3(0x18f),_0x5a7fd3(0x140),_0x56feb7);const _0x3b6766=await fetch(this[_0x5a7fd3(0x142)],{'method':_0x5a7fd3(0x140),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x5a7fd3(0x171)},'body':JSON[_0x5a7fd3(0x152)](_0x56feb7)}),_0x27a94d=Date[_0x5a7fd3(0x188)]()-_0x53b554;console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x19d)),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x195),_0x3b6766[_0x5a7fd3(0x181)]),console[_0x5a7fd3(0x14e)]('Status\x20Text:',_0x3b6766[_0x5a7fd3(0x174)]),console['log'](_0x5a7fd3(0x190),Object[_0x5a7fd3(0x187)](_0x3b6766[_0x5a7fd3(0x153)][_0x5a7fd3(0x1ba)]())),console['log'](_0x5a7fd3(0x1bd),_0x27a94d+'ms');const _0x413534=await _0x3b6766['text']();console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x141),_0x413534);if(!_0x3b6766['ok']){console[_0x5a7fd3(0x151)](_0x5a7fd3(0x16e)),console[_0x5a7fd3(0x151)](_0x5a7fd3(0x1b7),_0x3b6766[_0x5a7fd3(0x181)]),console[_0x5a7fd3(0x151)](_0x5a7fd3(0x17d),_0x413534),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x19a)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),_0x3b6766[_0x5a7fd3(0x181)],_0x413534,_0x27a94d),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x143)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),'HTTP\x20'+_0x3b6766[_0x5a7fd3(0x181)]+':\x20'+_0x413534);throw new Error(_0x5a7fd3(0x1c3)+_0x3b6766[_0x5a7fd3(0x181)]+_0x5a7fd3(0x189)+_0x413534);}let _0x1849bd;try{_0x1849bd=JSON[_0x5a7fd3(0x13f)](_0x413534);}catch(_0x307122){console['error'](_0x5a7fd3(0x163),_0x307122),loggerService_1[_0x5a7fd3(0x15c)]['logWhiteDomainError']('cointopay',_0x5a7fd3(0x18f),_0x5a7fd3(0x193)+_0x307122);throw new Error(_0x5a7fd3(0x1be)+_0x413534);}console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x1a2)),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x191),JSON[_0x5a7fd3(0x152)](_0x1849bd,null,0x2)),loggerService_1['loggerService'][_0x5a7fd3(0x19a)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),_0x3b6766[_0x5a7fd3(0x181)],_0x1849bd,_0x27a94d);if(_0x1849bd[_0x5a7fd3(0x151)]){const _0x11bf43=_0x1849bd[_0x5a7fd3(0x192)]||_0x1849bd['error']||_0x5a7fd3(0x17b);console[_0x5a7fd3(0x151)](_0x5a7fd3(0x185)),console[_0x5a7fd3(0x151)](_0x5a7fd3(0x162),_0x11bf43),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x143)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),_0x5a7fd3(0x179)+_0x11bf43);throw new Error(_0x5a7fd3(0x1a3)+_0x11bf43);}if(!_0x1849bd[_0x5a7fd3(0x176)]||!_0x1849bd[_0x5a7fd3(0x148)]){console[_0x5a7fd3(0x151)](_0x5a7fd3(0x14c)),console[_0x5a7fd3(0x151)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x5a7fd3(0x151)](_0x5a7fd3(0x167),_0x1849bd),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x143)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x16b)),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x16f),_0x1849bd[_0x5a7fd3(0x148)]),console[_0x5a7fd3(0x14e)]('Payment\x20URL:',_0x1849bd[_0x5a7fd3(0x176)]),console[_0x5a7fd3(0x14e)](_0x5a7fd3(0x199),_0x58325d,_0x5a7fd3(0x1c2)),{'gateway_payment_id':_0x1849bd['gateway_payment_id'],'payment_url':_0x1849bd['payment_url']};}catch(_0x3b10b7){console[_0x5a7fd3(0x151)](_0x5a7fd3(0x1ae)),console[_0x5a7fd3(0x151)]('Error\x20details:',_0x3b10b7),loggerService_1[_0x5a7fd3(0x15c)][_0x5a7fd3(0x143)](_0x5a7fd3(0x198),_0x5a7fd3(0x18f),_0x3b10b7);if(_0x3b10b7 instanceof Error){console[_0x5a7fd3(0x151)]('Error\x20message:',_0x3b10b7[_0x5a7fd3(0x192)]),console['error'](_0x5a7fd3(0x1b1),_0x3b10b7[_0x5a7fd3(0x1b8)]);throw new Error(_0x5a7fd3(0x158)+_0x3b10b7[_0x5a7fd3(0x192)]);}throw new Error(_0x5a7fd3(0x177));}}async[a40_0x530d5a(0x183)](_0x443fbf){const _0xd52d41=a40_0x530d5a,_0x48c5c2=Date['now']();try{console['log'](_0xd52d41(0x172)+_0x443fbf);const _0x4aa085={'gatewayPaymentId':_0x443fbf};loggerService_1['loggerService'][_0xd52d41(0x1aa)](_0xd52d41(0x198),'/status',_0xd52d41(0x140),_0x4aa085);const _0x459fdc=await fetch(this['statusUrl'],{'method':_0xd52d41(0x140),'headers':{'Content-Type':_0xd52d41(0x16c),'Accept':_0xd52d41(0x16c),'User-Agent':_0xd52d41(0x171)},'body':JSON['stringify'](_0x4aa085)}),_0x2c4fa9=Date[_0xd52d41(0x188)]()-_0x48c5c2;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0xd52d41(0x14e)](_0xd52d41(0x195),_0x459fdc[_0xd52d41(0x181)]),console[_0xd52d41(0x14e)](_0xd52d41(0x1bd),_0x2c4fa9+'ms');if(!_0x459fdc['ok']){const _0x3fb5c4=await _0x459fdc['text']();console[_0xd52d41(0x151)]('HTTP\x20Status:',_0x459fdc['status']),console['error']('Response\x20Body:',_0x3fb5c4),loggerService_1[_0xd52d41(0x15c)][_0xd52d41(0x19a)](_0xd52d41(0x198),_0xd52d41(0x19b),_0x459fdc[_0xd52d41(0x181)],_0x3fb5c4,_0x2c4fa9),loggerService_1[_0xd52d41(0x15c)][_0xd52d41(0x143)](_0xd52d41(0x198),_0xd52d41(0x19b),_0xd52d41(0x17e)+_0x459fdc[_0xd52d41(0x181)]+':\x20'+_0x3fb5c4);throw new Error(_0xd52d41(0x1c3)+_0x459fdc[_0xd52d41(0x181)]);}const _0x57e38c=await _0x459fdc['text']();console[_0xd52d41(0x14e)](_0xd52d41(0x141),_0x57e38c);let _0x1ddb5d;try{_0x1ddb5d=JSON[_0xd52d41(0x13f)](_0x57e38c);}catch(_0xab3732){console[_0xd52d41(0x151)](_0xd52d41(0x163),_0xab3732),loggerService_1[_0xd52d41(0x15c)][_0xd52d41(0x143)](_0xd52d41(0x198),_0xd52d41(0x19b),'JSON\x20Parse\x20Error:\x20'+_0xab3732);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x57e38c);}loggerService_1[_0xd52d41(0x15c)][_0xd52d41(0x19a)](_0xd52d41(0x198),_0xd52d41(0x19b),_0x459fdc[_0xd52d41(0x181)],_0x1ddb5d,_0x2c4fa9),console[_0xd52d41(0x14e)](_0xd52d41(0x145)),console[_0xd52d41(0x14e)](_0xd52d41(0x146),_0x1ddb5d['result']),console[_0xd52d41(0x14e)]('Status\x20Code:',_0x1ddb5d['status_code']),console['log']('Payment\x20Status:',_0x1ddb5d[_0xd52d41(0x17a)]?.['Status']),console[_0xd52d41(0x14e)](_0xd52d41(0x199),_0x1ddb5d['data']?.[_0xd52d41(0x1b9)]),console[_0xd52d41(0x14e)]('Currency:',_0x1ddb5d[_0xd52d41(0x17a)]?.[_0xd52d41(0x159)]);if(_0x1ddb5d['result']!=='success'||_0x1ddb5d[_0xd52d41(0x168)]!==0xc8){const _0x4e403c=_0x1ddb5d['message']||_0xd52d41(0x14f);console[_0xd52d41(0x151)](_0xd52d41(0x1b2)),console['error']('Error\x20Message:',_0x4e403c),loggerService_1['loggerService'][_0xd52d41(0x143)](_0xd52d41(0x198),_0xd52d41(0x19b),'Status\x20API\x20Error:\x20'+_0x4e403c);throw new Error(_0xd52d41(0x157)+_0x4e403c);}if(!_0x1ddb5d[_0xd52d41(0x17a)]){console[_0xd52d41(0x151)](_0xd52d41(0x1ad)),console[_0xd52d41(0x151)](_0xd52d41(0x178)),loggerService_1['loggerService'][_0xd52d41(0x143)]('cointopay',_0xd52d41(0x19b),_0xd52d41(0x154));throw new Error(_0xd52d41(0x1bf));}let _0x21e8eb=_0xd52d41(0x1a4);switch(_0x1ddb5d['data'][_0xd52d41(0x197)]?.[_0xd52d41(0x1a5)]()){case'paid':_0x21e8eb='PAID';break;case _0xd52d41(0x1a9):case _0xd52d41(0x164):case _0xd52d41(0x151):_0x21e8eb=_0xd52d41(0x161);break;case _0xd52d41(0x17c):case _0xd52d41(0x1af):_0x21e8eb=_0xd52d41(0x14b);break;case _0xd52d41(0x194):case _0xd52d41(0x149):case _0xd52d41(0x1ab):case _0xd52d41(0x19c):default:_0x21e8eb=_0xd52d41(0x1a4);break;}let _0x375c50,_0x2de59a;if(_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x1c1)]){const _0x52e986=_0x1ddb5d[_0xd52d41(0x17a)]['PaymentDetail'];console[_0xd52d41(0x14e)](_0xd52d41(0x144),_0x52e986);const _0x1e784d=_0x52e986[_0xd52d41(0x170)](/IBAN\s+([A-Z0-9]+)/i);_0x1e784d&&(_0x375c50=_0x1e784d[0x1],console[_0xd52d41(0x14e)]('üè¶\x20Extracted\x20IBAN:',_0x375c50)),_0x2de59a=_0x52e986;}const _0xcfc27={'iban':_0x375c50,'bankDetails':_0x2de59a,'transactionId':_0x1ddb5d[_0xd52d41(0x17a)]['TransactionID'],'coinAddress':_0x1ddb5d['data']['coinAddress'],'qrCodeUrl':_0x1ddb5d[_0xd52d41(0x17a)]['QRCodeURL'],'expiryTime':_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x18d)],'createdOn':_0x1ddb5d[_0xd52d41(0x17a)]['CreatedOn'],'confirmedOn':_0x1ddb5d['data'][_0xd52d41(0x15f)]};console[_0xd52d41(0x14e)](_0xd52d41(0x165)),console[_0xd52d41(0x14e)](_0xd52d41(0x195),_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x197)],'->',_0x21e8eb),console[_0xd52d41(0x14e)](_0xd52d41(0x199),_0x1ddb5d['data'][_0xd52d41(0x1b9)],_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x159)]),console['log'](_0xd52d41(0x196),_0x1ddb5d[_0xd52d41(0x17a)]['TransactionID']),console[_0xd52d41(0x14e)](_0xd52d41(0x14a),_0x375c50||_0xd52d41(0x1c0)),console['log'](_0xd52d41(0x186),_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x15d)]),console[_0xd52d41(0x14e)](_0xd52d41(0x1a8),_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x15f)]||_0xd52d41(0x184));if(_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x197)]?.[_0xd52d41(0x1a5)]()===_0xd52d41(0x149))console['log'](_0xd52d41(0x1b3));else _0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x197)]?.[_0xd52d41(0x1a5)]()==='paid'&&console[_0xd52d41(0x14e)](_0xd52d41(0x15b));return{'status':_0x21e8eb,'amount':parseFloat(_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x1b9)])||undefined,'currency':_0x1ddb5d[_0xd52d41(0x17a)][_0xd52d41(0x159)]||_0xd52d41(0x1c2),'paymentDetails':_0xcfc27};}catch(_0x2a234d){console[_0xd52d41(0x151)](_0xd52d41(0x155),_0x2a234d),loggerService_1[_0xd52d41(0x15c)][_0xd52d41(0x143)](_0xd52d41(0x198),_0xd52d41(0x19b),_0x2a234d);throw new Error(_0xd52d41(0x15e)+(_0x2a234d instanceof Error?_0x2a234d[_0xd52d41(0x192)]:_0xd52d41(0x1bb)));}}async[a40_0x530d5a(0x160)](_0x140a74){const _0x34a859=a40_0x530d5a,_0x5ccabf=await this['checkPaymentStatus'](_0x140a74);return{'status':_0x5ccabf[_0x34a859(0x181)],'amount':_0x5ccabf['amount'],'currency':_0x5ccabf[_0x34a859(0x1a6)]};}async[a40_0x530d5a(0x18b)](_0x477add){const _0x256177=a40_0x530d5a;console['log'](_0x256177(0x16d),_0x477add);let _0x19f4f6=_0x256177(0x1a4);switch(_0x477add[_0x256177(0x181)]?.['toLowerCase']()){case'paid':_0x19f4f6=_0x256177(0x18e);break;case _0x256177(0x1a9):case'failed':case _0x256177(0x151):_0x19f4f6='FAILED';break;case _0x256177(0x17c):case _0x256177(0x1af):_0x19f4f6=_0x256177(0x14b);break;case _0x256177(0x1ab):case _0x256177(0x194):case _0x256177(0x149):case _0x256177(0x19c):default:_0x19f4f6=_0x256177(0x1a4);break;}return{'paymentId':_0x477add['order_id']||_0x477add[_0x256177(0x15a)]||'','status':_0x19f4f6,'amount':_0x477add['amount'],'currency':_0x477add['currency']||_0x256177(0x1c2)};}}exports[a40_0x530d5a(0x19e)]=CoinToPayService;