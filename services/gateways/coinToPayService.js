'use strict';const a41_0x56a83f=a41_0x94b2;(function(_0x27f5c2,_0x4944e5){const _0x1382c5=a41_0x94b2,_0x3fd105=_0x27f5c2();while(!![]){try{const _0x4a1b10=-parseInt(_0x1382c5(0x1a2))/0x1*(-parseInt(_0x1382c5(0x19b))/0x2)+-parseInt(_0x1382c5(0x1c7))/0x3*(parseInt(_0x1382c5(0x1e6))/0x4)+-parseInt(_0x1382c5(0x1c2))/0x5*(-parseInt(_0x1382c5(0x1b9))/0x6)+-parseInt(_0x1382c5(0x18b))/0x7+parseInt(_0x1382c5(0x208))/0x8+parseInt(_0x1382c5(0x202))/0x9*(-parseInt(_0x1382c5(0x1ae))/0xa)+-parseInt(_0x1382c5(0x1bf))/0xb;if(_0x4a1b10===_0x4944e5)break;else _0x3fd105['push'](_0x3fd105['shift']());}catch(_0x18735f){_0x3fd105['push'](_0x3fd105['shift']());}}}(a41_0x18c6,0x736e2));function a41_0x18c6(){const _0x14f155=['Response\x20Body:','2202326qnZBEz','apiUrl','üè¶\x20Payment\x20Detail:','Error\x20stack:','EXPIRED','üè¶\x20Extracted\x20IBAN:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','status_code','Amount','\x20EUR','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','paid','Payment\x20Status:','processWebhook','Status\x20Code:','verifyPayment','25750LsBWML','logWhiteDomainRequest','Headers:','Transaction\x20ID:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','73QtPqjb','waiting','statusUrl','ExpiryTime','message','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Response\x20Time:','Unknown\x20error\x20from\x20CoinToPay\x20API','checkPaymentStatus','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','../loggerService','text','247870rDHKdS','Status\x20API\x20Error:\x20','PENDING','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Error\x20Message:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Status','Confirmed\x20On:','result','expired','headers','34470feymeK','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','data','stack','2719464XjJUIM','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','HTTP\x20Status:','775PBHBhY','cancelled','timeout','success','EUR','8049RVYwjy','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','TransactionConfirmedOn','Business\x20Error:\x20','cointopay','gateway_payment_id','Parsed\x20Result:','/status','stringify','JSON\x20Parse\x20Error:\x20','IBAN:','coinAddress','PaymentDetail','CoinToPay\x20status\x20API\x20error:\x20','pending','https://tesoft.uk/gateway/cointopay/status.php','Error\x20details:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CoinToPay\x20payment\x20status\x20check\x20error:','awaiting\x20fiat','HTTP\x20','application/json','log','status','logWhiteDomainError','Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20error!\x20status:\x20','Gateway\x20Payment\x20ID:','Amount:','statusText','1244USSesv','Created\x20On:','Unknown\x20error','Result:','match','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','CreatedOn','Request\x20Body:','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','failed','POST','loggerService','not\x20found','toLowerCase','amount','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','order_id','FAILED','error','TransactionID','üìä\x20Status\x20check\x20URL:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Raw\x20Response\x20Body:','logWhiteDomainResponse','PAID','Response\x20data:','306nxcrYY','Failed\x20to\x20parse\x20JSON\x20response:',',\x20body:\x20','CoinToPayService','created','now','7051720XrjUFL','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','payment_url','inputCurrency','/create','fromEntries'];a41_0x18c6=function(){return _0x14f155;};return a41_0x18c6();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a41_0x56a83f(0x205)]=void 0x0;function a41_0x94b2(_0x4c3059,_0x13c913){const _0x18c6b2=a41_0x18c6();return a41_0x94b2=function(_0x94b29e,_0x1e3dbd){_0x94b29e=_0x94b29e-0x189;let _0x30d12b=_0x18c6b2[_0x94b29e];return _0x30d12b;},a41_0x94b2(_0x4c3059,_0x13c913);}const loggerService_1=require(a41_0x56a83f(0x1ac));class CoinToPayService{constructor(){const _0x844d56=a41_0x56a83f;this[_0x844d56(0x18c)]=_0x844d56(0x20a),this[_0x844d56(0x1a4)]=_0x844d56(0x1d6),console['log'](_0x844d56(0x209)),console[_0x844d56(0x1dd)](_0x844d56(0x1fc),this['statusUrl']);}async['createPaymentLink'](_0x2fd8f2){const _0x1e3eac=a41_0x56a83f,{orderId:_0x1b5cec,amount:_0x332b30}=_0x2fd8f2;console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1a1)+_0x332b30+_0x1e3eac(0x194));const _0x93916c={'amount':_0x332b30},_0x136414=Date[_0x1e3eac(0x207)]();try{console[_0x1e3eac(0x1dd)](_0x1e3eac(0x195)),console[_0x1e3eac(0x1dd)]('URL:',this[_0x1e3eac(0x18c)]),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1ed),JSON[_0x1e3eac(0x1cf)](_0x93916c,null,0x2)),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1e4),_0x332b30,_0x1e3eac(0x1b3)),loggerService_1[_0x1e3eac(0x1f2)]['logWhiteDomainRequest'](_0x1e3eac(0x1cb),_0x1e3eac(0x20e),_0x1e3eac(0x1f1),_0x93916c);const _0x328197=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x1e3eac(0x1dc),'Accept':_0x1e3eac(0x1dc),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1e3eac(0x1cf)](_0x93916c)}),_0x483255=Date[_0x1e3eac(0x207)]()-_0x136414;console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1b1)),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1e0),_0x328197[_0x1e3eac(0x1de)]),console[_0x1e3eac(0x1dd)]('Status\x20Text:',_0x328197[_0x1e3eac(0x1e5)]),console['log'](_0x1e3eac(0x19d),Object[_0x1e3eac(0x189)](_0x328197[_0x1e3eac(0x1b8)]['entries']())),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1a8),_0x483255+'ms');const _0x33ab58=await _0x328197[_0x1e3eac(0x1ad)]();console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1fe),_0x33ab58);if(!_0x328197['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x1c1),_0x328197['status']),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x18a),_0x33ab58),loggerService_1[_0x1e3eac(0x1f2)]['logWhiteDomainResponse'](_0x1e3eac(0x1cb),_0x1e3eac(0x20e),_0x328197[_0x1e3eac(0x1de)],_0x33ab58,_0x483255),loggerService_1[_0x1e3eac(0x1f2)][_0x1e3eac(0x1df)]('cointopay',_0x1e3eac(0x20e),_0x1e3eac(0x1db)+_0x328197[_0x1e3eac(0x1de)]+':\x20'+_0x33ab58);throw new Error(_0x1e3eac(0x1e2)+_0x328197[_0x1e3eac(0x1de)]+_0x1e3eac(0x204)+_0x33ab58);}let _0x128474;try{_0x128474=JSON['parse'](_0x33ab58);}catch(_0x1c1dc1){console[_0x1e3eac(0x1fa)](_0x1e3eac(0x203),_0x1c1dc1),loggerService_1['loggerService']['logWhiteDomainError'](_0x1e3eac(0x1cb),_0x1e3eac(0x20e),_0x1e3eac(0x1d0)+_0x1c1dc1);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x33ab58);}console['log'](_0x1e3eac(0x1ef)),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1cd),JSON[_0x1e3eac(0x1cf)](_0x128474,null,0x2)),loggerService_1[_0x1e3eac(0x1f2)]['logWhiteDomainResponse'](_0x1e3eac(0x1cb),_0x1e3eac(0x20e),_0x328197[_0x1e3eac(0x1de)],_0x128474,_0x483255);if(_0x128474['error']){const _0x224fb9=_0x128474[_0x1e3eac(0x1a6)]||_0x128474[_0x1e3eac(0x1fa)]||_0x1e3eac(0x1a9);console['error'](_0x1e3eac(0x191)),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x1b2),_0x224fb9),loggerService_1[_0x1e3eac(0x1f2)]['logWhiteDomainError']('cointopay','/create',_0x1e3eac(0x1ca)+_0x224fb9);throw new Error(_0x1e3eac(0x1ba)+_0x224fb9);}if(!_0x128474[_0x1e3eac(0x20c)]||!_0x128474[_0x1e3eac(0x1cc)]){console[_0x1e3eac(0x1fa)](_0x1e3eac(0x1ab)),console['error'](_0x1e3eac(0x1a7)),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x201),_0x128474),loggerService_1[_0x1e3eac(0x1f2)][_0x1e3eac(0x1df)]('cointopay',_0x1e3eac(0x20e),_0x1e3eac(0x1c8));throw new Error(_0x1e3eac(0x1ee));}return console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1f6)),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1e3),_0x128474[_0x1e3eac(0x1cc)]),console[_0x1e3eac(0x1dd)]('Payment\x20URL:',_0x128474[_0x1e3eac(0x20c)]),console[_0x1e3eac(0x1dd)](_0x1e3eac(0x1e4),_0x332b30,'EUR'),{'gateway_payment_id':_0x128474[_0x1e3eac(0x1cc)],'payment_url':_0x128474[_0x1e3eac(0x20c)]};}catch(_0x592bf8){console[_0x1e3eac(0x1fa)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x1d7),_0x592bf8),loggerService_1[_0x1e3eac(0x1f2)][_0x1e3eac(0x1df)](_0x1e3eac(0x1cb),'/create',_0x592bf8);if(_0x592bf8 instanceof Error){console[_0x1e3eac(0x1fa)]('Error\x20message:',_0x592bf8[_0x1e3eac(0x1a6)]),console[_0x1e3eac(0x1fa)](_0x1e3eac(0x18e),_0x592bf8[_0x1e3eac(0x1be)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x592bf8[_0x1e3eac(0x1a6)]);}throw new Error(_0x1e3eac(0x19f));}}async[a41_0x56a83f(0x1aa)](_0x4cd7d6){const _0x1489c9=a41_0x56a83f,_0x14b072=Date[_0x1489c9(0x207)]();try{console['log'](_0x1489c9(0x1bc)+_0x4cd7d6);const _0x47b3cb={'gatewayPaymentId':_0x4cd7d6};loggerService_1[_0x1489c9(0x1f2)][_0x1489c9(0x19c)](_0x1489c9(0x1cb),_0x1489c9(0x1ce),_0x1489c9(0x1f1),_0x47b3cb);const _0xa0ade1=await fetch(this[_0x1489c9(0x1a4)],{'method':_0x1489c9(0x1f1),'headers':{'Content-Type':_0x1489c9(0x1dc),'Accept':_0x1489c9(0x1dc),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x1489c9(0x1cf)](_0x47b3cb)}),_0xd59cab=Date[_0x1489c9(0x207)]()-_0x14b072;console['log'](_0x1489c9(0x20b)),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e0),_0xa0ade1['status']),console[_0x1489c9(0x1dd)](_0x1489c9(0x1a8),_0xd59cab+'ms');if(!_0xa0ade1['ok']){const _0x11480b=await _0xa0ade1['text']();console[_0x1489c9(0x1fa)](_0x1489c9(0x1c1),_0xa0ade1[_0x1489c9(0x1de)]),console[_0x1489c9(0x1fa)](_0x1489c9(0x18a),_0x11480b),loggerService_1[_0x1489c9(0x1f2)]['logWhiteDomainResponse']('cointopay',_0x1489c9(0x1ce),_0xa0ade1[_0x1489c9(0x1de)],_0x11480b,_0xd59cab),loggerService_1[_0x1489c9(0x1f2)]['logWhiteDomainError']('cointopay',_0x1489c9(0x1ce),_0x1489c9(0x1db)+_0xa0ade1[_0x1489c9(0x1de)]+':\x20'+_0x11480b);throw new Error(_0x1489c9(0x1e2)+_0xa0ade1[_0x1489c9(0x1de)]);}const _0x458095=await _0xa0ade1[_0x1489c9(0x1ad)]();console[_0x1489c9(0x1dd)](_0x1489c9(0x1fe),_0x458095);let _0x4d7d2f;try{_0x4d7d2f=JSON['parse'](_0x458095);}catch(_0x16ccc6){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x16ccc6),loggerService_1[_0x1489c9(0x1f2)][_0x1489c9(0x1df)](_0x1489c9(0x1cb),_0x1489c9(0x1ce),'JSON\x20Parse\x20Error:\x20'+_0x16ccc6);throw new Error(_0x1489c9(0x1e1)+_0x458095);}loggerService_1[_0x1489c9(0x1f2)][_0x1489c9(0x1ff)](_0x1489c9(0x1cb),_0x1489c9(0x1ce),_0xa0ade1['status'],_0x4d7d2f,_0xd59cab),console[_0x1489c9(0x1dd)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e9),_0x4d7d2f[_0x1489c9(0x1b6)]),console[_0x1489c9(0x1dd)](_0x1489c9(0x199),_0x4d7d2f['status_code']),console[_0x1489c9(0x1dd)](_0x1489c9(0x197),_0x4d7d2f[_0x1489c9(0x1bd)]?.[_0x1489c9(0x1b4)]),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e4),_0x4d7d2f['data']?.[_0x1489c9(0x193)]),console[_0x1489c9(0x1dd)]('Currency:',_0x4d7d2f[_0x1489c9(0x1bd)]?.[_0x1489c9(0x20d)]);if(_0x4d7d2f['result']!==_0x1489c9(0x1c5)||_0x4d7d2f[_0x1489c9(0x192)]!==0xc8){const _0x1d5a78=_0x4d7d2f[_0x1489c9(0x1a6)]||_0x1489c9(0x1c0);console[_0x1489c9(0x1fa)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console['error'](_0x1489c9(0x1b2),_0x1d5a78),loggerService_1[_0x1489c9(0x1f2)]['logWhiteDomainError'](_0x1489c9(0x1cb),_0x1489c9(0x1ce),_0x1489c9(0x1af)+_0x1d5a78);throw new Error(_0x1489c9(0x1d4)+_0x1d5a78);}if(!_0x4d7d2f[_0x1489c9(0x1bd)]){console[_0x1489c9(0x1fa)](_0x1489c9(0x1f7)),console[_0x1489c9(0x1fa)]('Missing\x20data\x20in\x20response'),loggerService_1['loggerService'][_0x1489c9(0x1df)](_0x1489c9(0x1cb),'/status','Incomplete\x20response:\x20missing\x20data');throw new Error(_0x1489c9(0x1fd));}let _0x21abdb='PENDING';switch(_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1b4)]?.['toLowerCase']()){case'paid':_0x21abdb=_0x1489c9(0x200);break;case _0x1489c9(0x1c3):case _0x1489c9(0x1f0):case'error':_0x21abdb=_0x1489c9(0x1f9);break;case'expired':case _0x1489c9(0x1c4):_0x21abdb=_0x1489c9(0x18f);break;case _0x1489c9(0x1a3):case _0x1489c9(0x1da):case _0x1489c9(0x1d5):case'created':default:_0x21abdb='PENDING';break;}let _0x44c852,_0x2296f0;if(_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1d3)]){const _0x151bb5=_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1d3)];console[_0x1489c9(0x1dd)](_0x1489c9(0x18d),_0x151bb5);const _0x5eba3a=_0x151bb5[_0x1489c9(0x1ea)](/IBAN\s+([A-Z0-9]+)/i);_0x5eba3a&&(_0x44c852=_0x5eba3a[0x1],console['log'](_0x1489c9(0x190),_0x44c852)),_0x2296f0=_0x151bb5;}const _0x5676e0={'iban':_0x44c852,'bankDetails':_0x2296f0,'transactionId':_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1fb)],'coinAddress':_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1d2)],'qrCodeUrl':_0x4d7d2f[_0x1489c9(0x1bd)]['QRCodeURL'],'expiryTime':_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1a5)],'createdOn':_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1ec)],'confirmedOn':_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1c9)]};console[_0x1489c9(0x1dd)](_0x1489c9(0x1bb)),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e0),_0x4d7d2f['data'][_0x1489c9(0x1b4)],'->',_0x21abdb),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e4),_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x193)],_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x20d)]),console[_0x1489c9(0x1dd)](_0x1489c9(0x19e),_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1fb)]),console[_0x1489c9(0x1dd)](_0x1489c9(0x1d1),_0x44c852||_0x1489c9(0x1f3)),console[_0x1489c9(0x1dd)](_0x1489c9(0x1e7),_0x4d7d2f['data'][_0x1489c9(0x1ec)]),console['log'](_0x1489c9(0x1b5),_0x4d7d2f['data'][_0x1489c9(0x1c9)]||'not\x20confirmed');if(_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x1b4)]?.[_0x1489c9(0x1f4)]()==='awaiting\x20fiat')console[_0x1489c9(0x1dd)]('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x4d7d2f[_0x1489c9(0x1bd)]['Status']?.[_0x1489c9(0x1f4)]()===_0x1489c9(0x196)&&console['log'](_0x1489c9(0x1eb));return{'status':_0x21abdb,'amount':parseFloat(_0x4d7d2f[_0x1489c9(0x1bd)][_0x1489c9(0x193)])||undefined,'currency':_0x4d7d2f[_0x1489c9(0x1bd)]['inputCurrency']||_0x1489c9(0x1c6),'paymentDetails':_0x5676e0};}catch(_0x2ff9e9){console[_0x1489c9(0x1fa)](_0x1489c9(0x1d9),_0x2ff9e9),loggerService_1[_0x1489c9(0x1f2)][_0x1489c9(0x1df)](_0x1489c9(0x1cb),_0x1489c9(0x1ce),_0x2ff9e9);throw new Error(_0x1489c9(0x1a0)+(_0x2ff9e9 instanceof Error?_0x2ff9e9[_0x1489c9(0x1a6)]:_0x1489c9(0x1e8)));}}async[a41_0x56a83f(0x19a)](_0xc3e41e){const _0xc0191f=a41_0x56a83f,_0x4ee91b=await this[_0xc0191f(0x1aa)](_0xc3e41e);return{'status':_0x4ee91b['status'],'amount':_0x4ee91b['amount'],'currency':_0x4ee91b['currency']};}async[a41_0x56a83f(0x198)](_0x3443f1){const _0x382218=a41_0x56a83f;console[_0x382218(0x1dd)](_0x382218(0x1d8),_0x3443f1);let _0x33b585=_0x382218(0x1b0);switch(_0x3443f1[_0x382218(0x1de)]?.[_0x382218(0x1f4)]()){case _0x382218(0x196):_0x33b585=_0x382218(0x200);break;case _0x382218(0x1c3):case _0x382218(0x1f0):case _0x382218(0x1fa):_0x33b585=_0x382218(0x1f9);break;case _0x382218(0x1b7):case _0x382218(0x1c4):_0x33b585='EXPIRED';break;case'pending':case _0x382218(0x1a3):case'awaiting\x20fiat':case _0x382218(0x206):default:_0x33b585=_0x382218(0x1b0);break;}return{'paymentId':_0x3443f1[_0x382218(0x1f8)]||_0x3443f1['merchant_reference_id']||'','status':_0x33b585,'amount':_0x3443f1[_0x382218(0x1f5)],'currency':_0x3443f1['currency']||_0x382218(0x1c6)};}}exports[a41_0x56a83f(0x205)]=CoinToPayService;