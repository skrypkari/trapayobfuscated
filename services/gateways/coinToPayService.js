'use strict';function a40_0x288c(){const _0x3f754b=['PaymentDetail','EUR','🪙\x20Creating\x20CoinToPay\x20payment:\x20','Headers:','message','Status\x20API\x20Error:\x20','amount','443625TaXXLz',',\x20body:\x20','coinAddress','/status','Currency:','fromEntries','2571687pvNNbU','gateway_payment_id','text','Unknown\x20error','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','4098RmQbMX','data','logWhiteDomainError','CoinToPay\x20status\x20API\x20error:\x20','https://tesoft.uk/gateway/cointopay/','log','status_code','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Created\x20On:','IBAN:','entries','Status:','status','===\x20COINTOPAY\x20SUCCESS\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','90lUTXKN','Transaction\x20ID:','not\x20confirmed','Amount','apiUrl','Confirmed\x20On:','706111yjwCQL','cointopay','now','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','stringify','CoinToPayService','Response\x20data:','Error\x20stack:','created','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','HTTP\x20error!\x20status:\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','awaiting\x20fiat','PENDING','merchant_reference_id','TesSoft\x20Payment\x20System/1.0','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Business\x20Error:\x20','Status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','212224XMlezd','application/json','Request\x20Body:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','CreatedOn','458BviVCA','Response\x20Time:','/create','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','logWhiteDomainRequest','result','1178184iAtGhR','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Missing\x20data\x20in\x20response','CoinToPay\x20API\x20error:\x20','Parsed\x20Result:','defineProperty','../loggerService','Payment\x20URL:','failed','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','stack','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','statusUrl','pending','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','paid','Amount:','success','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Incomplete\x20response:\x20missing\x20data','Raw\x20Response\x20Body:','checkPaymentStatus','toLowerCase','Status\x20Text:','parse','timeout','not\x20found','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Error\x20message:','JSON\x20Parse\x20Error:\x20','currency','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','URL:','Payment\x20Status:','error','POST','logWhiteDomainResponse','order_id','PAID','headers','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','payment_url','statusText','📊\x20Status\x20check\x20URL:','HTTP\x20Status:','Unknown\x20error\x20from\x20CoinToPay\x20API','FAILED','Gateway\x20Payment\x20ID:','__esModule','TransactionConfirmedOn','verifyPayment','Response\x20Body:','\x20EUR','27010kdkZiu','TransactionID','processWebhook','Error\x20Message:','createPaymentLink','loggerService','cancelled','https://tesoft.uk/gateway/cointopay/status.php','Failed\x20to\x20parse\x20JSON\x20response:','inputCurrency'];a40_0x288c=function(){return _0x3f754b;};return a40_0x288c();}function a40_0x34fa(_0x517454,_0x4b4783){const _0x288caa=a40_0x288c();return a40_0x34fa=function(_0x34fae2,_0x4c9382){_0x34fae2=_0x34fae2-0xe3;let _0x7f5135=_0x288caa[_0x34fae2];return _0x7f5135;},a40_0x34fa(_0x517454,_0x4b4783);}const a40_0x29ebdb=a40_0x34fa;(function(_0x4f14eb,_0x14e36e){const _0x44d759=a40_0x34fa,_0x22823b=_0x4f14eb();while(!![]){try{const _0x483c9f=parseInt(_0x44d759(0x15c))/0x1+parseInt(_0x44d759(0x10e))/0x2*(-parseInt(_0x44d759(0x167))/0x3)+-parseInt(_0x44d759(0x108))/0x4+parseInt(_0x44d759(0x14b))/0x5*(-parseInt(_0x44d759(0xee))/0x6)+parseInt(_0x44d759(0xf4))/0x7+-parseInt(_0x44d759(0x114))/0x8+parseInt(_0x44d759(0x162))/0x9;if(_0x483c9f===_0x14e36e)break;else _0x22823b['push'](_0x22823b['shift']());}catch(_0x281d41){_0x22823b['push'](_0x22823b['shift']());}}}(a40_0x288c,0x39a24));Object[a40_0x29ebdb(0x119)](exports,a40_0x29ebdb(0x146),{'value':!![]}),exports[a40_0x29ebdb(0xf9)]=void 0x0;const loggerService_1=require(a40_0x29ebdb(0x11a));class CoinToPayService{constructor(){const _0x6242b7=a40_0x29ebdb;this[_0x6242b7(0xf2)]=_0x6242b7(0xe3),this['statusUrl']=_0x6242b7(0x152),console['log'](_0x6242b7(0xf7)),console[_0x6242b7(0xe4)](_0x6242b7(0x141),this[_0x6242b7(0x120)]);}async[a40_0x29ebdb(0x14f)](_0x3ba1bc){const _0x2f55d6=a40_0x29ebdb,{orderId:_0x1f43ee,amount:_0x1a0332}=_0x3ba1bc;console[_0x2f55d6(0xe4)](_0x2f55d6(0x157)+_0x1a0332+_0x2f55d6(0x14a));const _0x1208fd={'amount':_0x1a0332},_0x53847e=Date[_0x2f55d6(0xf6)]();try{console[_0x2f55d6(0xe4)](_0x2f55d6(0x130)),console['log'](_0x2f55d6(0x136),this['apiUrl']),console[_0x2f55d6(0xe4)](_0x2f55d6(0x10a),JSON[_0x2f55d6(0xf8)](_0x1208fd,null,0x2)),console[_0x2f55d6(0xe4)](_0x2f55d6(0x125),_0x1a0332,_0x2f55d6(0x122)),loggerService_1[_0x2f55d6(0x150)][_0x2f55d6(0x112)](_0x2f55d6(0xf5),_0x2f55d6(0x110),_0x2f55d6(0x139),_0x1208fd);const _0x5c9b2f=await fetch(this[_0x2f55d6(0xf2)],{'method':'POST','headers':{'Content-Type':_0x2f55d6(0x109),'Accept':_0x2f55d6(0x109),'User-Agent':_0x2f55d6(0x103)},'body':JSON[_0x2f55d6(0xf8)](_0x1208fd)}),_0x11366c=Date[_0x2f55d6(0xf6)]()-_0x53847e;console[_0x2f55d6(0xe4)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2f55d6(0xe4)]('Status:',_0x5c9b2f[_0x2f55d6(0xeb)]),console[_0x2f55d6(0xe4)](_0x2f55d6(0x12c),_0x5c9b2f[_0x2f55d6(0x140)]),console[_0x2f55d6(0xe4)](_0x2f55d6(0x158),Object[_0x2f55d6(0x161)](_0x5c9b2f[_0x2f55d6(0x13d)][_0x2f55d6(0xe9)]())),console['log'](_0x2f55d6(0x10f),_0x11366c+'ms');const _0xf31cab=await _0x5c9b2f['text']();console[_0x2f55d6(0xe4)](_0x2f55d6(0x129),_0xf31cab);if(!_0x5c9b2f['ok']){console[_0x2f55d6(0x138)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x2f55d6(0x138)](_0x2f55d6(0x142),_0x5c9b2f['status']),console[_0x2f55d6(0x138)](_0x2f55d6(0x149),_0xf31cab),loggerService_1['loggerService'][_0x2f55d6(0x13a)]('cointopay',_0x2f55d6(0x110),_0x5c9b2f[_0x2f55d6(0xeb)],_0xf31cab,_0x11366c),loggerService_1['loggerService']['logWhiteDomainError'](_0x2f55d6(0xf5),_0x2f55d6(0x110),'HTTP\x20'+_0x5c9b2f[_0x2f55d6(0xeb)]+':\x20'+_0xf31cab);throw new Error('HTTP\x20error!\x20status:\x20'+_0x5c9b2f['status']+_0x2f55d6(0x15d)+_0xf31cab);}let _0x579243;try{_0x579243=JSON['parse'](_0xf31cab);}catch(_0x45f98c){console[_0x2f55d6(0x138)](_0x2f55d6(0x153),_0x45f98c),loggerService_1['loggerService'][_0x2f55d6(0x169)](_0x2f55d6(0xf5),_0x2f55d6(0x110),_0x2f55d6(0x132)+_0x45f98c);throw new Error(_0x2f55d6(0x107)+_0xf31cab);}console[_0x2f55d6(0xe4)](_0x2f55d6(0x115)),console[_0x2f55d6(0xe4)](_0x2f55d6(0x118),JSON[_0x2f55d6(0xf8)](_0x579243,null,0x2)),loggerService_1[_0x2f55d6(0x150)][_0x2f55d6(0x13a)](_0x2f55d6(0xf5),_0x2f55d6(0x110),_0x5c9b2f[_0x2f55d6(0xeb)],_0x579243,_0x11366c);if(_0x579243['error']){const _0x428fc7=_0x579243['message']||_0x579243['error']||_0x2f55d6(0x143);console[_0x2f55d6(0x138)](_0x2f55d6(0x166)),console[_0x2f55d6(0x138)](_0x2f55d6(0x14e),_0x428fc7),loggerService_1[_0x2f55d6(0x150)][_0x2f55d6(0x169)]('cointopay',_0x2f55d6(0x110),_0x2f55d6(0x105)+_0x428fc7);throw new Error(_0x2f55d6(0x117)+_0x428fc7);}if(!_0x579243[_0x2f55d6(0x13f)]||!_0x579243[_0x2f55d6(0x163)]){console[_0x2f55d6(0x138)](_0x2f55d6(0x10b)),console[_0x2f55d6(0x138)](_0x2f55d6(0xfd)),console[_0x2f55d6(0x138)](_0x2f55d6(0xfa),_0x579243),loggerService_1[_0x2f55d6(0x150)][_0x2f55d6(0x169)](_0x2f55d6(0xf5),_0x2f55d6(0x110),_0x2f55d6(0xff));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x2f55d6(0xe4)](_0x2f55d6(0xec)),console[_0x2f55d6(0xe4)](_0x2f55d6(0x145),_0x579243[_0x2f55d6(0x163)]),console['log'](_0x2f55d6(0x11b),_0x579243[_0x2f55d6(0x13f)]),console[_0x2f55d6(0xe4)](_0x2f55d6(0x125),_0x1a0332,_0x2f55d6(0x156)),{'gateway_payment_id':_0x579243[_0x2f55d6(0x163)],'payment_url':_0x579243[_0x2f55d6(0x13f)]};}catch(_0x31e028){console[_0x2f55d6(0x138)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x2f55d6(0x138)]('Error\x20details:',_0x31e028),loggerService_1['loggerService']['logWhiteDomainError'](_0x2f55d6(0xf5),_0x2f55d6(0x110),_0x31e028);if(_0x31e028 instanceof Error){console[_0x2f55d6(0x138)](_0x2f55d6(0x131),_0x31e028[_0x2f55d6(0x159)]),console['error'](_0x2f55d6(0xfb),_0x31e028[_0x2f55d6(0x11e)]);throw new Error(_0x2f55d6(0x111)+_0x31e028[_0x2f55d6(0x159)]);}throw new Error(_0x2f55d6(0x127));}}async['checkPaymentStatus'](_0x1623ff){const _0x3cf331=a40_0x29ebdb,_0x1e1906=Date[_0x3cf331(0xf6)]();try{console[_0x3cf331(0xe4)](_0x3cf331(0x104)+_0x1623ff);const _0x57349b={'gatewayPaymentId':_0x1623ff};loggerService_1[_0x3cf331(0x150)][_0x3cf331(0x112)](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x3cf331(0x139),_0x57349b);const _0x6d6785=await fetch(this[_0x3cf331(0x120)],{'method':'POST','headers':{'Content-Type':_0x3cf331(0x109),'Accept':_0x3cf331(0x109),'User-Agent':_0x3cf331(0x103)},'body':JSON[_0x3cf331(0xf8)](_0x57349b)}),_0x4e48f6=Date[_0x3cf331(0xf6)]()-_0x1e1906;console[_0x3cf331(0xe4)](_0x3cf331(0x13e)),console['log'](_0x3cf331(0xea),_0x6d6785[_0x3cf331(0xeb)]),console['log'](_0x3cf331(0x10f),_0x4e48f6+'ms');if(!_0x6d6785['ok']){const _0x1c6006=await _0x6d6785[_0x3cf331(0x164)]();console[_0x3cf331(0x138)](_0x3cf331(0x142),_0x6d6785[_0x3cf331(0xeb)]),console[_0x3cf331(0x138)](_0x3cf331(0x149),_0x1c6006),loggerService_1[_0x3cf331(0x150)][_0x3cf331(0x13a)](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x6d6785[_0x3cf331(0xeb)],_0x1c6006,_0x4e48f6),loggerService_1[_0x3cf331(0x150)]['logWhiteDomainError'](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x3cf331(0x135)+_0x6d6785['status']+':\x20'+_0x1c6006);throw new Error(_0x3cf331(0xfe)+_0x6d6785[_0x3cf331(0xeb)]);}const _0x5bcf98=await _0x6d6785['text']();console[_0x3cf331(0xe4)](_0x3cf331(0x129),_0x5bcf98);let _0x5c6b7d;try{_0x5c6b7d=JSON[_0x3cf331(0x12d)](_0x5bcf98);}catch(_0x4014c8){console['error'](_0x3cf331(0x153),_0x4014c8),loggerService_1[_0x3cf331(0x150)]['logWhiteDomainError'](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x3cf331(0x132)+_0x4014c8);throw new Error(_0x3cf331(0x11f)+_0x5bcf98);}loggerService_1[_0x3cf331(0x150)][_0x3cf331(0x13a)]('cointopay',_0x3cf331(0x15f),_0x6d6785[_0x3cf331(0xeb)],_0x5c6b7d,_0x4e48f6),console[_0x3cf331(0xe4)](_0x3cf331(0x10c)),console[_0x3cf331(0xe4)]('Result:',_0x5c6b7d['result']),console['log']('Status\x20Code:',_0x5c6b7d[_0x3cf331(0xe5)]),console[_0x3cf331(0xe4)](_0x3cf331(0x137),_0x5c6b7d[_0x3cf331(0x168)]?.[_0x3cf331(0x106)]),console[_0x3cf331(0xe4)](_0x3cf331(0x125),_0x5c6b7d[_0x3cf331(0x168)]?.[_0x3cf331(0xf1)]),console[_0x3cf331(0xe4)](_0x3cf331(0x160),_0x5c6b7d['data']?.[_0x3cf331(0x154)]);if(_0x5c6b7d[_0x3cf331(0x113)]!==_0x3cf331(0x126)||_0x5c6b7d[_0x3cf331(0xe5)]!==0xc8){const _0x4ada55=_0x5c6b7d[_0x3cf331(0x159)]||_0x3cf331(0x123);console[_0x3cf331(0x138)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x3cf331(0x138)]('Error\x20Message:',_0x4ada55),loggerService_1[_0x3cf331(0x150)][_0x3cf331(0x169)](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x3cf331(0x15a)+_0x4ada55);throw new Error(_0x3cf331(0x16a)+_0x4ada55);}if(!_0x5c6b7d['data']){console[_0x3cf331(0x138)](_0x3cf331(0x134)),console[_0x3cf331(0x138)](_0x3cf331(0x116)),loggerService_1[_0x3cf331(0x150)]['logWhiteDomainError'](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x3cf331(0x128));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x2c1cd8='PENDING';switch(_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x106)]?.[_0x3cf331(0x12b)]()){case _0x3cf331(0x124):_0x2c1cd8=_0x3cf331(0x13c);break;case _0x3cf331(0x151):case _0x3cf331(0x11c):case _0x3cf331(0x138):_0x2c1cd8=_0x3cf331(0x144);break;case'expired':case _0x3cf331(0x12e):_0x2c1cd8='EXPIRED';break;case'waiting':case'awaiting\x20fiat':case _0x3cf331(0x121):case _0x3cf331(0xfc):default:_0x2c1cd8=_0x3cf331(0x101);break;}let _0xc704be,_0x129c5f;if(_0x5c6b7d[_0x3cf331(0x168)]['PaymentDetail']){const _0x37c5c1=_0x5c6b7d['data'][_0x3cf331(0x155)];console['log']('🏦\x20Payment\x20Detail:',_0x37c5c1);const _0x1de411=_0x37c5c1['match'](/IBAN\s+([A-Z0-9]+)/i);_0x1de411&&(_0xc704be=_0x1de411[0x1],console[_0x3cf331(0xe4)]('🏦\x20Extracted\x20IBAN:',_0xc704be)),_0x129c5f=_0x37c5c1;}const _0x1cf8ed={'iban':_0xc704be,'bankDetails':_0x129c5f,'transactionId':_0x5c6b7d['data']['TransactionID'],'coinAddress':_0x5c6b7d['data'][_0x3cf331(0x15e)],'qrCodeUrl':_0x5c6b7d['data']['QRCodeURL'],'expiryTime':_0x5c6b7d['data']['ExpiryTime'],'createdOn':_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x10d)],'confirmedOn':_0x5c6b7d[_0x3cf331(0x168)]['TransactionConfirmedOn']};console[_0x3cf331(0xe4)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3cf331(0xe4)](_0x3cf331(0xea),_0x5c6b7d[_0x3cf331(0x168)]['Status'],'->',_0x2c1cd8),console[_0x3cf331(0xe4)]('Amount:',_0x5c6b7d[_0x3cf331(0x168)]['Amount'],_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x154)]),console[_0x3cf331(0xe4)](_0x3cf331(0xef),_0x5c6b7d['data'][_0x3cf331(0x14c)]),console[_0x3cf331(0xe4)](_0x3cf331(0xe8),_0xc704be||_0x3cf331(0x12f)),console['log'](_0x3cf331(0xe7),_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x10d)]),console[_0x3cf331(0xe4)](_0x3cf331(0xf3),_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x147)]||_0x3cf331(0xf0));if(_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x106)]?.[_0x3cf331(0x12b)]()===_0x3cf331(0x100))console[_0x3cf331(0xe4)](_0x3cf331(0xed));else _0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x106)]?.[_0x3cf331(0x12b)]()==='paid'&&console['log'](_0x3cf331(0x11d));return{'status':_0x2c1cd8,'amount':parseFloat(_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0xf1)])||undefined,'currency':_0x5c6b7d[_0x3cf331(0x168)][_0x3cf331(0x154)]||'EUR','paymentDetails':_0x1cf8ed};}catch(_0x349776){console['error']('CoinToPay\x20payment\x20status\x20check\x20error:',_0x349776),loggerService_1['loggerService'][_0x3cf331(0x169)](_0x3cf331(0xf5),_0x3cf331(0x15f),_0x349776);throw new Error(_0x3cf331(0xe6)+(_0x349776 instanceof Error?_0x349776[_0x3cf331(0x159)]:_0x3cf331(0x165)));}}async[a40_0x29ebdb(0x148)](_0x40cad2){const _0x51504a=a40_0x29ebdb,_0x430687=await this[_0x51504a(0x12a)](_0x40cad2);return{'status':_0x430687['status'],'amount':_0x430687[_0x51504a(0x15b)],'currency':_0x430687[_0x51504a(0x133)]};}async[a40_0x29ebdb(0x14d)](_0x784375){const _0x35dba0=a40_0x29ebdb;console[_0x35dba0(0xe4)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x784375);let _0x476d9d='PENDING';switch(_0x784375[_0x35dba0(0xeb)]?.[_0x35dba0(0x12b)]()){case'paid':_0x476d9d=_0x35dba0(0x13c);break;case'cancelled':case _0x35dba0(0x11c):case _0x35dba0(0x138):_0x476d9d=_0x35dba0(0x144);break;case'expired':case _0x35dba0(0x12e):_0x476d9d='EXPIRED';break;case _0x35dba0(0x121):case'waiting':case _0x35dba0(0x100):case _0x35dba0(0xfc):default:_0x476d9d=_0x35dba0(0x101);break;}return{'paymentId':_0x784375[_0x35dba0(0x13b)]||_0x784375[_0x35dba0(0x102)]||'','status':_0x476d9d,'amount':_0x784375[_0x35dba0(0x15b)],'currency':_0x784375[_0x35dba0(0x133)]||_0x35dba0(0x156)};}}exports[a40_0x29ebdb(0xf9)]=CoinToPayService;