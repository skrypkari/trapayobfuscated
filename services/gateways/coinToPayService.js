'use strict';const a57_0x305348=a57_0x29df;(function(_0x535fb7,_0x65798d){const _0x3a82f4=a57_0x29df,_0x59687e=_0x535fb7();while(!![]){try{const _0x536346=parseInt(_0x3a82f4(0xd8))/0x1+-parseInt(_0x3a82f4(0xbd))/0x2+-parseInt(_0x3a82f4(0xdd))/0x3+-parseInt(_0x3a82f4(0xc8))/0x4+parseInt(_0x3a82f4(0x84))/0x5*(parseInt(_0x3a82f4(0x94))/0x6)+-parseInt(_0x3a82f4(0x7a))/0x7*(parseInt(_0x3a82f4(0xfa))/0x8)+-parseInt(_0x3a82f4(0xb1))/0x9*(-parseInt(_0x3a82f4(0xc1))/0xa);if(_0x536346===_0x65798d)break;else _0x59687e['push'](_0x59687e['shift']());}catch(_0x25ed7a){_0x59687e['push'](_0x59687e['shift']());}}}(a57_0xfa58,0x29f13));Object[a57_0x305348(0x9c)](exports,a57_0x305348(0xc0),{'value':!![]}),exports[a57_0x305348(0xaa)]=void 0x0;function a57_0x29df(_0x47559e,_0x24a11d){_0x47559e=_0x47559e-0x7a;const _0xfa5870=a57_0xfa58();let _0x29dfe0=_0xfa5870[_0x47559e];return _0x29dfe0;}const loggerService_1=require(a57_0x305348(0xe7));class CoinToPayService{constructor(){const _0x35c5f6=a57_0x305348;this[_0x35c5f6(0x81)]=_0x35c5f6(0xad),this[_0x35c5f6(0xa1)]=_0x35c5f6(0xc7),console[_0x35c5f6(0xe9)](_0x35c5f6(0xa8)),console[_0x35c5f6(0xe9)](_0x35c5f6(0xa9),this['statusUrl']);}async[a57_0x305348(0x99)](_0x4d0bfe){const _0x211b27=a57_0x305348,{orderId:_0x5ef14d,amount:_0x5b99d6}=_0x4d0bfe;console['log'](_0x211b27(0xf0)+_0x5b99d6+_0x211b27(0xf8));const _0x417a4c={'amount':_0x5b99d6},_0x49b021=Date[_0x211b27(0xfb)]();try{console[_0x211b27(0xe9)](_0x211b27(0xea)),console[_0x211b27(0xe9)](_0x211b27(0xf1),this[_0x211b27(0x81)]),console[_0x211b27(0xe9)]('Request\x20Body:',JSON[_0x211b27(0x7c)](_0x417a4c,null,0x2)),console[_0x211b27(0xe9)]('Amount:',_0x5b99d6,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x211b27(0x89)]['logWhiteDomainRequest'](_0x211b27(0x8f),_0x211b27(0xbb),_0x211b27(0x86),_0x417a4c);const _0x14aa7e=await fetch(this[_0x211b27(0x81)],{'method':_0x211b27(0x86),'headers':{'Content-Type':_0x211b27(0xda),'Accept':_0x211b27(0xda),'User-Agent':_0x211b27(0xba)},'body':JSON[_0x211b27(0x7c)](_0x417a4c)}),_0x4bb1f5=Date[_0x211b27(0xfb)]()-_0x49b021;console[_0x211b27(0xe9)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console['log'](_0x211b27(0xbe),_0x14aa7e[_0x211b27(0xc6)]),console[_0x211b27(0xe9)](_0x211b27(0xd0),_0x14aa7e[_0x211b27(0xd3)]),console[_0x211b27(0xe9)]('Headers:',Object[_0x211b27(0x93)](_0x14aa7e['headers']['entries']())),console['log'](_0x211b27(0xd5),_0x4bb1f5+'ms');const _0x671be8=await _0x14aa7e['text']();console[_0x211b27(0xe9)](_0x211b27(0xed),_0x671be8);if(!_0x14aa7e['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x211b27(0xcf)](_0x211b27(0xa7),_0x14aa7e[_0x211b27(0xc6)]),console[_0x211b27(0xcf)](_0x211b27(0x82),_0x671be8),loggerService_1[_0x211b27(0x89)][_0x211b27(0xf4)](_0x211b27(0x8f),_0x211b27(0xbb),_0x14aa7e[_0x211b27(0xc6)],_0x671be8,_0x4bb1f5),loggerService_1['loggerService']['logWhiteDomainError'](_0x211b27(0x8f),_0x211b27(0xbb),'HTTP\x20'+_0x14aa7e[_0x211b27(0xc6)]+':\x20'+_0x671be8);throw new Error(_0x211b27(0x9d)+_0x14aa7e[_0x211b27(0xc6)]+',\x20body:\x20'+_0x671be8);}let _0x1027cb;try{_0x1027cb=JSON[_0x211b27(0xaf)](_0x671be8);}catch(_0xfef19b){console[_0x211b27(0xcf)](_0x211b27(0xe6),_0xfef19b),loggerService_1[_0x211b27(0x89)]['logWhiteDomainError'](_0x211b27(0x8f),_0x211b27(0xbb),'JSON\x20Parse\x20Error:\x20'+_0xfef19b);throw new Error(_0x211b27(0xdb)+_0x671be8);}console[_0x211b27(0xe9)](_0x211b27(0x7d)),console[_0x211b27(0xe9)](_0x211b27(0xca),JSON['stringify'](_0x1027cb,null,0x2)),loggerService_1[_0x211b27(0x89)][_0x211b27(0xf4)](_0x211b27(0x8f),_0x211b27(0xbb),_0x14aa7e[_0x211b27(0xc6)],_0x1027cb,_0x4bb1f5);if(_0x1027cb[_0x211b27(0xcf)]){const _0x53c8a8=_0x1027cb[_0x211b27(0x92)]||_0x1027cb[_0x211b27(0xcf)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console['error'](_0x211b27(0xa5)),console[_0x211b27(0xcf)](_0x211b27(0xe8),_0x53c8a8),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x211b27(0xbb),_0x211b27(0xcc)+_0x53c8a8);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x53c8a8);}if(!_0x1027cb['payment_url']||!_0x1027cb[_0x211b27(0xa6)]){console[_0x211b27(0xcf)](_0x211b27(0x9a)),console[_0x211b27(0xcf)](_0x211b27(0xb8)),console[_0x211b27(0xcf)](_0x211b27(0xb6),_0x1027cb),loggerService_1[_0x211b27(0x89)]['logWhiteDomainError'](_0x211b27(0x8f),_0x211b27(0xbb),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console[_0x211b27(0xe9)](_0x211b27(0xf2)),console[_0x211b27(0xe9)](_0x211b27(0x8c),_0x1027cb[_0x211b27(0xa6)]),console[_0x211b27(0xe9)](_0x211b27(0xce),_0x1027cb[_0x211b27(0xe5)]);const _0x47702c=_0x1027cb[_0x211b27(0xe5)]+_0x211b27(0x9f);return console['log'](_0x211b27(0x80),_0x47702c),console[_0x211b27(0xe9)]('Amount:',_0x5b99d6,_0x211b27(0xb5)),{'gateway_payment_id':_0x1027cb[_0x211b27(0xa6)],'payment_url':_0x47702c};}catch(_0x120a06){console[_0x211b27(0xcf)](_0x211b27(0xb2)),console[_0x211b27(0xcf)](_0x211b27(0xd9),_0x120a06),loggerService_1[_0x211b27(0x89)]['logWhiteDomainError']('cointopay',_0x211b27(0xbb),_0x120a06);if(_0x120a06 instanceof Error){console['error'](_0x211b27(0xb3),_0x120a06['message']),console['error']('Error\x20stack:',_0x120a06[_0x211b27(0x8e)]);throw new Error(_0x211b27(0xa3)+_0x120a06['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0xf9c8){const _0x564732=a57_0x305348,_0x462de3=Date['now']();try{console[_0x564732(0xe9)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0xf9c8);const _0x1e3c8c={'gatewayPaymentId':_0xf9c8};loggerService_1[_0x564732(0x89)][_0x564732(0x87)](_0x564732(0x8f),'/status',_0x564732(0x86),_0x1e3c8c);const _0x382297=await fetch(this['statusUrl'],{'method':_0x564732(0x86),'headers':{'Content-Type':'application/json','Accept':_0x564732(0xda),'User-Agent':_0x564732(0xba)},'body':JSON[_0x564732(0x7c)](_0x1e3c8c)}),_0x56d53d=Date[_0x564732(0xfb)]()-_0x462de3;console[_0x564732(0xe9)](_0x564732(0xd6)),console['log']('Status:',_0x382297[_0x564732(0xc6)]),console[_0x564732(0xe9)]('Response\x20Time:',_0x56d53d+'ms');if(!_0x382297['ok']){const _0xab8808=await _0x382297[_0x564732(0xa2)]();console['error']('HTTP\x20Status:',_0x382297[_0x564732(0xc6)]),console[_0x564732(0xcf)](_0x564732(0x82),_0xab8808),loggerService_1[_0x564732(0x89)][_0x564732(0xf4)](_0x564732(0x8f),_0x564732(0xeb),_0x382297[_0x564732(0xc6)],_0xab8808,_0x56d53d),loggerService_1[_0x564732(0x89)][_0x564732(0xb9)](_0x564732(0x8f),_0x564732(0xeb),_0x564732(0xe1)+_0x382297[_0x564732(0xc6)]+':\x20'+_0xab8808);throw new Error(_0x564732(0x9d)+_0x382297[_0x564732(0xc6)]);}const _0x1348db=await _0x382297[_0x564732(0xa2)]();console[_0x564732(0xe9)](_0x564732(0xed),_0x1348db);let _0x49be40;try{_0x49be40=JSON['parse'](_0x1348db);}catch(_0x5bd3e6){console['error'](_0x564732(0xe6),_0x5bd3e6),loggerService_1['loggerService'][_0x564732(0xb9)](_0x564732(0x8f),_0x564732(0xeb),_0x564732(0x91)+_0x5bd3e6);throw new Error(_0x564732(0xef)+_0x1348db);}loggerService_1[_0x564732(0x89)][_0x564732(0xf4)](_0x564732(0x8f),'/status',_0x382297[_0x564732(0xc6)],_0x49be40,_0x56d53d),console[_0x564732(0xe9)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log']('Result:',_0x49be40['result']),console[_0x564732(0xe9)](_0x564732(0xe4),_0x49be40[_0x564732(0xe0)]),console[_0x564732(0xe9)](_0x564732(0xab),_0x49be40[_0x564732(0xbf)]?.['Status']),console[_0x564732(0xe9)](_0x564732(0x7e),_0x49be40[_0x564732(0xbf)]?.[_0x564732(0x83)]),console[_0x564732(0xe9)](_0x564732(0xb4),_0x49be40[_0x564732(0xbf)]?.[_0x564732(0x9e)]);if(_0x49be40['result']!==_0x564732(0x95)||_0x49be40['status_code']!==0xc8){const _0x515dda=_0x49be40[_0x564732(0x92)]||_0x564732(0xc4);console[_0x564732(0xcf)](_0x564732(0x97)),console[_0x564732(0xcf)](_0x564732(0xe8),_0x515dda),loggerService_1[_0x564732(0x89)][_0x564732(0xb9)](_0x564732(0x8f),'/status','Status\x20API\x20Error:\x20'+_0x515dda);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x515dda);}if(!_0x49be40[_0x564732(0xbf)]){console[_0x564732(0xcf)](_0x564732(0xf5)),console['error'](_0x564732(0x8b)),loggerService_1['loggerService'][_0x564732(0xb9)]('cointopay',_0x564732(0xeb),_0x564732(0xe2));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x347508=_0x564732(0xb7);switch(_0x49be40[_0x564732(0xbf)]['Status']?.[_0x564732(0xf6)]()){case _0x564732(0xcd):_0x347508='PAID';break;case _0x564732(0xc3):case'failed':case'error':_0x347508=_0x564732(0x88);break;case _0x564732(0xc9):case _0x564732(0x8d):_0x347508=_0x564732(0xec);break;case'waiting':case _0x564732(0xd4):case _0x564732(0x8a):case _0x564732(0x7b):default:_0x347508=_0x564732(0xb7);break;}let _0xf89d29,_0x10052d;if(_0x49be40['data'][_0x564732(0xd2)]){const _0x30b46c=_0x49be40[_0x564732(0xbf)][_0x564732(0xd2)];console['log'](_0x564732(0xae),_0x30b46c);const _0x15e353=_0x30b46c[_0x564732(0xa0)](/IBAN\s+([A-Z0-9]+)/i);_0x15e353&&(_0xf89d29=_0x15e353[0x1],console[_0x564732(0xe9)](_0x564732(0xf7),_0xf89d29)),_0x10052d=_0x30b46c;}const _0x2d5ae1={'iban':_0xf89d29,'bankDetails':_0x10052d,'transactionId':_0x49be40['data'][_0x564732(0xd7)],'coinAddress':_0x49be40[_0x564732(0xbf)][_0x564732(0xdf)],'qrCodeUrl':_0x49be40[_0x564732(0xbf)]['QRCodeURL'],'expiryTime':_0x49be40['data'][_0x564732(0x7f)],'createdOn':_0x49be40['data'][_0x564732(0xa4)],'confirmedOn':_0x49be40['data'][_0x564732(0xf3)]};console[_0x564732(0xe9)](_0x564732(0xde)),console[_0x564732(0xe9)](_0x564732(0xbe),_0x49be40['data']['Status'],'->',_0x347508),console[_0x564732(0xe9)](_0x564732(0x7e),_0x49be40['data'][_0x564732(0x83)],_0x49be40[_0x564732(0xbf)]['inputCurrency']),console[_0x564732(0xe9)](_0x564732(0xcb),_0x49be40['data'][_0x564732(0xd7)]),console[_0x564732(0xe9)]('IBAN:',_0xf89d29||_0x564732(0xe3)),console[_0x564732(0xe9)](_0x564732(0xc2),_0x49be40[_0x564732(0xbf)][_0x564732(0xa4)]),console[_0x564732(0xe9)](_0x564732(0xbc),_0x49be40[_0x564732(0xbf)][_0x564732(0xf3)]||_0x564732(0xd1));if(_0x49be40[_0x564732(0xbf)][_0x564732(0xee)]?.[_0x564732(0xf6)]()==='awaiting\x20fiat')console['log'](_0x564732(0xb0));else _0x49be40[_0x564732(0xbf)][_0x564732(0xee)]?.[_0x564732(0xf6)]()==='paid'&&console[_0x564732(0xe9)](_0x564732(0xac));return{'status':_0x347508,'amount':parseFloat(_0x49be40[_0x564732(0xbf)][_0x564732(0x83)])||undefined,'currency':_0x49be40[_0x564732(0xbf)]['inputCurrency']||_0x564732(0xb5),'paymentDetails':_0x2d5ae1};}catch(_0x16809d){console[_0x564732(0xcf)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x16809d),loggerService_1['loggerService'][_0x564732(0xb9)]('cointopay','/status',_0x16809d);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x16809d instanceof Error?_0x16809d['message']:_0x564732(0xf9)));}}async[a57_0x305348(0xc5)](_0x1aa629){const _0x4d920c=a57_0x305348,_0x4e232f=await this['checkPaymentStatus'](_0x1aa629);return{'status':_0x4e232f['status'],'amount':_0x4e232f[_0x4d920c(0xdc)],'currency':_0x4e232f['currency']};}async[a57_0x305348(0x9b)](_0x5ea298){const _0xc511dd=a57_0x305348;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x5ea298);let _0x37b037='PENDING';switch(_0x5ea298[_0xc511dd(0xc6)]?.['toLowerCase']()){case _0xc511dd(0xcd):_0x37b037=_0xc511dd(0x85);break;case'cancelled':case'failed':case'error':_0x37b037=_0xc511dd(0x88);break;case _0xc511dd(0xc9):case'timeout':_0x37b037=_0xc511dd(0xec);break;case _0xc511dd(0x8a):case'waiting':case _0xc511dd(0xd4):case _0xc511dd(0x7b):default:_0x37b037=_0xc511dd(0xb7);break;}return{'paymentId':_0x5ea298[_0xc511dd(0x90)]||_0x5ea298[_0xc511dd(0x98)]||'','status':_0x37b037,'amount':_0x5ea298[_0xc511dd(0xdc)],'currency':_0x5ea298[_0xc511dd(0x96)]||'EUR'};}}exports[a57_0x305348(0xaa)]=CoinToPayService;function a57_0xfa58(){const _0x534b74=['parse','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','12618wBGUKV','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Error\x20message:','Currency:','EUR','Response\x20data:','PENDING','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','logWhiteDomainError','Payment\x20System/1.0','/create','Confirmed\x20On:','64860YGzuaY','Status:','data','__esModule','140FTNQOp','Created\x20On:','cancelled','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','verifyPayment','status','https://tesoft.uk/gateway/cointopay/status.php','1299640cXeEXW','expired','Parsed\x20Result:','Transaction\x20ID:','Business\x20Error:\x20','paid','Payment\x20URL\x20(original):','error','Status\x20Text:','not\x20confirmed','PaymentDetail','statusText','awaiting\x20fiat','Response\x20Time:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','TransactionID','343218bZRAzO','Error\x20details:','application/json','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','amount','16077iSUByy','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','coinAddress','status_code','HTTP\x20','Incomplete\x20response:\x20missing\x20data','not\x20found','Status\x20Code:','payment_url','Failed\x20to\x20parse\x20JSON\x20response:','../loggerService','Error\x20Message:','log','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','/status','EXPIRED','Raw\x20Response\x20Body:','Status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','URL:','===\x20COINTOPAY\x20SUCCESS\x20===','TransactionConfirmedOn','logWhiteDomainResponse','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','toLowerCase','üè¶\x20Extracted\x20IBAN:','\x20EUR','Unknown\x20error','104JUURjt','now','10661ZajuCj','created','stringify','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Amount:','ExpiryTime','Payment\x20URL\x20(modified):','apiUrl','Response\x20Body:','Amount','957235FOPQNs','PAID','POST','logWhiteDomainRequest','FAILED','loggerService','pending','Missing\x20data\x20in\x20response','Gateway\x20Payment\x20ID:','timeout','stack','cointopay','order_id','JSON\x20Parse\x20Error:\x20','message','fromEntries','6CbLnvE','success','currency','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','merchant_reference_id','createPaymentLink','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','processWebhook','defineProperty','HTTP\x20error!\x20status:\x20','inputCurrency','&alternative=false','match','statusUrl','text','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','CreatedOn','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','gateway_payment_id','HTTP\x20Status:','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','üìä\x20Status\x20check\x20URL:','CoinToPayService','Payment\x20Status:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','https://tesoft.uk/gateway/cointopay/','üè¶\x20Payment\x20Detail:'];a57_0xfa58=function(){return _0x534b74;};return a57_0xfa58();}