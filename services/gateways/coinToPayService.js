'use strict';function a47_0x1c46(){const _0x3400c1=['===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','text','PAID','Headers:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','/create','FAILED','inputCurrency','Payment\x20URL\x20(modified):','569218cvuBon','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','987764nbZvMb','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','logWhiteDomainRequest','Result:','checkPaymentStatus','902048QkshKM','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','awaiting\x20fiat','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20message:','Parsed\x20Result:','__esModule','not\x20found','PENDING','URL:','9UFtYmd','TransactionID','cointopay','6676614QATAQC','headers','CoinToPayService','EXPIRED','Status','gateway_payment_id','entries','error','JSON\x20Parse\x20Error:\x20','payment_url','Error\x20details:','coinAddress','Status\x20Code:','statusUrl','CoinToPay\x20status\x20API\x20error:\x20','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','log','PaymentDetail','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','failed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','2088440VzukeR','processWebhook','cancelled','4847720qLOejq','Payment\x20System/1.0','createPaymentLink','status_code','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','24731NFTJCq','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','now','Currency:','üìä\x20Status\x20check\x20URL:','currency','statusText','../loggerService','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','Request\x20Body:','Business\x20Error:\x20','Amount:','HTTP\x20error!\x20status:\x20','9DLTBcH','created','Raw\x20Response\x20Body:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','\x20EUR','toLowerCase','result','paid','application/json','success','parse','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','https://tesoft.uk/gateway/cointopay/','1096YaVxOK','===\x20COINTOPAY\x20API\x20ERROR\x20===','message','defineProperty','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SUCCESS\x20===','QRCodeURL','Amount','apiUrl','Status\x20Text:','verifyPayment','not\x20confirmed','data','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','IBAN:','logWhiteDomainResponse','TransactionConfirmedOn','üè¶\x20Payment\x20Detail:','CreatedOn','Transaction\x20ID:','loggerService','POST','status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Payment\x20Status:','logWhiteDomainError','Error\x20Message:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','stack','waiting','CoinToPay\x20API\x20error:\x20','merchant_reference_id','stringify','pending','Failed\x20to\x20parse\x20JSON\x20response:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','/status','expired','Status:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','fromEntries','EUR','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20Time:','Incomplete\x20response:\x20missing\x20data'];a47_0x1c46=function(){return _0x3400c1;};return a47_0x1c46();}const a47_0x4dbafa=a47_0xe14e;(function(_0x54a8a7,_0x3021e3){const _0x325a26=a47_0xe14e,_0x5dbdf1=_0x54a8a7();while(!![]){try{const _0x472328=-parseInt(_0x325a26(0xca))/0x1+parseInt(_0x325a26(0xcc))/0x2+-parseInt(_0x325a26(0xdb))/0x3*(parseInt(_0x325a26(0xd1))/0x4)+parseInt(_0x325a26(0xf3))/0x5+parseInt(_0x325a26(0xde))/0x6+parseInt(_0x325a26(0xfc))/0x7*(parseInt(_0x325a26(0x117))/0x8)+-parseInt(_0x325a26(0x109))/0x9*(parseInt(_0x325a26(0xf6))/0xa);if(_0x472328===_0x3021e3)break;else _0x5dbdf1['push'](_0x5dbdf1['shift']());}catch(_0x82dafd){_0x5dbdf1['push'](_0x5dbdf1['shift']());}}}(a47_0x1c46,0xbde6a));Object[a47_0x4dbafa(0x11a)](exports,a47_0x4dbafa(0xd7),{'value':!![]}),exports[a47_0x4dbafa(0xe0)]=void 0x0;const loggerService_1=require(a47_0x4dbafa(0x103));function a47_0xe14e(_0x4cd91f,_0x419ee7){const _0x1c4668=a47_0x1c46();return a47_0xe14e=function(_0xe14eea,_0x2ea7a6){_0xe14eea=_0xe14eea-0xa4;let _0x8cd587=_0x1c4668[_0xe14eea];return _0x8cd587;},a47_0xe14e(_0x4cd91f,_0x419ee7);}class CoinToPayService{constructor(){const _0x4bc35c=a47_0x4dbafa;this[_0x4bc35c(0x11f)]=_0x4bc35c(0x116),this[_0x4bc35c(0xeb)]=_0x4bc35c(0x11b),console['log'](_0x4bc35c(0xfd)),console['log'](_0x4bc35c(0x100),this['statusUrl']);}async[a47_0x4dbafa(0xf8)](_0x50dd02){const _0x170b14=a47_0x4dbafa,{orderId:_0x2ac384,amount:_0x1f7027}=_0x50dd02;console[_0x170b14(0xee)](_0x170b14(0xcd)+_0x1f7027+_0x170b14(0x10d));const _0x19646b={'amount':_0x1f7027},_0x16e70e=Date[_0x170b14(0xfe)]();try{console[_0x170b14(0xee)](_0x170b14(0xc1)),console[_0x170b14(0xee)](_0x170b14(0xda),this[_0x170b14(0x11f)]),console[_0x170b14(0xee)](_0x170b14(0x105),JSON[_0x170b14(0xb4)](_0x19646b,null,0x2)),console[_0x170b14(0xee)]('Amount:',_0x1f7027,_0x170b14(0xab)),loggerService_1[_0x170b14(0xa8)][_0x170b14(0xce)]('cointopay','/create',_0x170b14(0xa9),_0x19646b);const _0x4aa713=await fetch(this[_0x170b14(0x11f)],{'method':_0x170b14(0xa9),'headers':{'Content-Type':'application/json','Accept':_0x170b14(0x111),'User-Agent':_0x170b14(0xf7)},'body':JSON[_0x170b14(0xb4)](_0x19646b)}),_0x4afd6f=Date[_0x170b14(0xfe)]()-_0x16e70e;console[_0x170b14(0xee)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x170b14(0xee)](_0x170b14(0xba),_0x4aa713[_0x170b14(0xaa)]),console['log'](_0x170b14(0x120),_0x4aa713[_0x170b14(0x102)]),console[_0x170b14(0xee)](_0x170b14(0xc4),Object[_0x170b14(0xbc)](_0x4aa713[_0x170b14(0xdf)][_0x170b14(0xe4)]())),console[_0x170b14(0xee)](_0x170b14(0xbf),_0x4afd6f+'ms');const _0x3f595d=await _0x4aa713[_0x170b14(0xc2)]();console[_0x170b14(0xee)](_0x170b14(0x10b),_0x3f595d);if(!_0x4aa713['ok']){console[_0x170b14(0xe5)](_0x170b14(0x118)),console[_0x170b14(0xe5)]('HTTP\x20Status:',_0x4aa713[_0x170b14(0xaa)]),console[_0x170b14(0xe5)]('Response\x20Body:',_0x3f595d),loggerService_1[_0x170b14(0xa8)][_0x170b14(0x126)](_0x170b14(0xdd),_0x170b14(0xc6),_0x4aa713[_0x170b14(0xaa)],_0x3f595d,_0x4afd6f),loggerService_1['loggerService'][_0x170b14(0xad)]('cointopay','/create','HTTP\x20'+_0x4aa713[_0x170b14(0xaa)]+':\x20'+_0x3f595d);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4aa713['status']+',\x20body:\x20'+_0x3f595d);}let _0x4bc06a;try{_0x4bc06a=JSON[_0x170b14(0x113)](_0x3f595d);}catch(_0x2750db){console[_0x170b14(0xe5)](_0x170b14(0xb6),_0x2750db),loggerService_1[_0x170b14(0xa8)]['logWhiteDomainError'](_0x170b14(0xdd),'/create',_0x170b14(0xe6)+_0x2750db);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x3f595d);}console[_0x170b14(0xee)](_0x170b14(0xc5)),console[_0x170b14(0xee)](_0x170b14(0xd6),JSON['stringify'](_0x4bc06a,null,0x2)),loggerService_1[_0x170b14(0xa8)][_0x170b14(0x126)](_0x170b14(0xdd),_0x170b14(0xc6),_0x4aa713[_0x170b14(0xaa)],_0x4bc06a,_0x4afd6f);if(_0x4bc06a[_0x170b14(0xe5)]){const _0x43a505=_0x4bc06a[_0x170b14(0x119)]||_0x4bc06a[_0x170b14(0xe5)]||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x170b14(0xe5)](_0x170b14(0x104)),console[_0x170b14(0xe5)](_0x170b14(0xae),_0x43a505),loggerService_1['loggerService'][_0x170b14(0xad)](_0x170b14(0xdd),_0x170b14(0xc6),_0x170b14(0x106)+_0x43a505);throw new Error(_0x170b14(0xb2)+_0x43a505);}if(!_0x4bc06a['payment_url']||!_0x4bc06a[_0x170b14(0xe3)]){console[_0x170b14(0xe5)](_0x170b14(0xed)),console[_0x170b14(0xe5)](_0x170b14(0xfb)),console['error']('Response\x20data:',_0x4bc06a),loggerService_1[_0x170b14(0xa8)][_0x170b14(0xad)](_0x170b14(0xdd),_0x170b14(0xc6),_0x170b14(0xf2));throw new Error(_0x170b14(0xd4));}console[_0x170b14(0xee)](_0x170b14(0x11c)),console[_0x170b14(0xee)]('Gateway\x20Payment\x20ID:',_0x4bc06a[_0x170b14(0xe3)]),console[_0x170b14(0xee)]('Payment\x20URL\x20(original):',_0x4bc06a[_0x170b14(0xe7)]);const _0x33b2fd=_0x4bc06a['payment_url']+'&alternative=false';return console[_0x170b14(0xee)](_0x170b14(0xc9),_0x33b2fd),console['log'](_0x170b14(0x107),_0x1f7027,_0x170b14(0xbd)),{'gateway_payment_id':_0x4bc06a['gateway_payment_id'],'payment_url':_0x33b2fd};}catch(_0x50c008){console[_0x170b14(0xe5)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x170b14(0xe5)](_0x170b14(0xe8),_0x50c008),loggerService_1[_0x170b14(0xa8)]['logWhiteDomainError'](_0x170b14(0xdd),_0x170b14(0xc6),_0x50c008);if(_0x50c008 instanceof Error){console[_0x170b14(0xe5)](_0x170b14(0xd5),_0x50c008[_0x170b14(0x119)]),console[_0x170b14(0xe5)]('Error\x20stack:',_0x50c008[_0x170b14(0xb0)]);throw new Error(_0x170b14(0xaf)+_0x50c008[_0x170b14(0x119)]);}throw new Error(_0x170b14(0xcb));}}async['checkPaymentStatus'](_0x5d0317){const _0x37f1d8=a47_0x4dbafa,_0x3fbde1=Date[_0x37f1d8(0xfe)]();try{console[_0x37f1d8(0xee)]('üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x5d0317);const _0x3529b2={'gatewayPaymentId':_0x5d0317};loggerService_1['loggerService'][_0x37f1d8(0xce)](_0x37f1d8(0xdd),_0x37f1d8(0xb8),'POST',_0x3529b2);const _0x3ac66e=await fetch(this['statusUrl'],{'method':_0x37f1d8(0xa9),'headers':{'Content-Type':_0x37f1d8(0x111),'Accept':_0x37f1d8(0x111),'User-Agent':_0x37f1d8(0xf7)},'body':JSON['stringify'](_0x3529b2)}),_0x1bf6b3=Date[_0x37f1d8(0xfe)]()-_0x3fbde1;console['log'](_0x37f1d8(0xf0)),console[_0x37f1d8(0xee)](_0x37f1d8(0xba),_0x3ac66e[_0x37f1d8(0xaa)]),console['log']('Response\x20Time:',_0x1bf6b3+'ms');if(!_0x3ac66e['ok']){const _0x41adf4=await _0x3ac66e['text']();console['error']('HTTP\x20Status:',_0x3ac66e[_0x37f1d8(0xaa)]),console['error']('Response\x20Body:',_0x41adf4),loggerService_1[_0x37f1d8(0xa8)][_0x37f1d8(0x126)](_0x37f1d8(0xdd),_0x37f1d8(0xb8),_0x3ac66e[_0x37f1d8(0xaa)],_0x41adf4,_0x1bf6b3),loggerService_1[_0x37f1d8(0xa8)]['logWhiteDomainError'](_0x37f1d8(0xdd),_0x37f1d8(0xb8),'HTTP\x20'+_0x3ac66e[_0x37f1d8(0xaa)]+':\x20'+_0x41adf4);throw new Error(_0x37f1d8(0x108)+_0x3ac66e[_0x37f1d8(0xaa)]);}const _0x4287a6=await _0x3ac66e['text']();console[_0x37f1d8(0xee)](_0x37f1d8(0x10b),_0x4287a6);let _0x55b739;try{_0x55b739=JSON[_0x37f1d8(0x113)](_0x4287a6);}catch(_0x5187fc){console[_0x37f1d8(0xe5)](_0x37f1d8(0xb6),_0x5187fc),loggerService_1[_0x37f1d8(0xa8)]['logWhiteDomainError'](_0x37f1d8(0xdd),_0x37f1d8(0xb8),_0x37f1d8(0xe6)+_0x5187fc);throw new Error(_0x37f1d8(0xbb)+_0x4287a6);}loggerService_1['loggerService'][_0x37f1d8(0x126)](_0x37f1d8(0xdd),_0x37f1d8(0xb8),_0x3ac66e[_0x37f1d8(0xaa)],_0x55b739,_0x1bf6b3),console[_0x37f1d8(0xee)](_0x37f1d8(0x124)),console['log'](_0x37f1d8(0xcf),_0x55b739[_0x37f1d8(0x10f)]),console['log'](_0x37f1d8(0xea),_0x55b739[_0x37f1d8(0xf9)]),console[_0x37f1d8(0xee)](_0x37f1d8(0xac),_0x55b739[_0x37f1d8(0x123)]?.[_0x37f1d8(0xe2)]),console['log'](_0x37f1d8(0x107),_0x55b739[_0x37f1d8(0x123)]?.[_0x37f1d8(0x11e)]),console[_0x37f1d8(0xee)](_0x37f1d8(0xff),_0x55b739[_0x37f1d8(0x123)]?.['inputCurrency']);if(_0x55b739['result']!==_0x37f1d8(0x112)||_0x55b739[_0x37f1d8(0xf9)]!==0xc8){const _0x3e3744=_0x55b739[_0x37f1d8(0x119)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x37f1d8(0xe5)](_0x37f1d8(0x115)),console[_0x37f1d8(0xe5)](_0x37f1d8(0xae),_0x3e3744),loggerService_1[_0x37f1d8(0xa8)][_0x37f1d8(0xad)](_0x37f1d8(0xdd),_0x37f1d8(0xb8),'Status\x20API\x20Error:\x20'+_0x3e3744);throw new Error(_0x37f1d8(0xec)+_0x3e3744);}if(!_0x55b739[_0x37f1d8(0x123)]){console['error'](_0x37f1d8(0xfa)),console[_0x37f1d8(0xe5)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x37f1d8(0xa8)]['logWhiteDomainError'](_0x37f1d8(0xdd),_0x37f1d8(0xb8),_0x37f1d8(0xc0));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x473a16=_0x37f1d8(0xd9);switch(_0x55b739['data']['Status']?.[_0x37f1d8(0x10e)]()){case'paid':_0x473a16=_0x37f1d8(0xc3);break;case _0x37f1d8(0xf5):case _0x37f1d8(0xf1):case'error':_0x473a16=_0x37f1d8(0xc7);break;case _0x37f1d8(0xb9):case'timeout':_0x473a16=_0x37f1d8(0xe1);break;case'waiting':case _0x37f1d8(0xd3):case _0x37f1d8(0xb5):case _0x37f1d8(0x10a):default:_0x473a16=_0x37f1d8(0xd9);break;}let _0x2b22ac,_0x6bc84;if(_0x55b739['data'][_0x37f1d8(0xef)]){const _0x47ad76=_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xef)];console[_0x37f1d8(0xee)](_0x37f1d8(0xa5),_0x47ad76);const _0xa4ca4f=_0x47ad76['match'](/IBAN\s+([A-Z0-9]+)/i);_0xa4ca4f&&(_0x2b22ac=_0xa4ca4f[0x1],console['log']('üè¶\x20Extracted\x20IBAN:',_0x2b22ac)),_0x6bc84=_0x47ad76;}const _0x11181f={'iban':_0x2b22ac,'bankDetails':_0x6bc84,'transactionId':_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xdc)],'coinAddress':_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xe9)],'qrCodeUrl':_0x55b739['data'][_0x37f1d8(0x11d)],'expiryTime':_0x55b739[_0x37f1d8(0x123)]['ExpiryTime'],'createdOn':_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xa6)],'confirmedOn':_0x55b739[_0x37f1d8(0x123)]['TransactionConfirmedOn']};console[_0x37f1d8(0xee)](_0x37f1d8(0xb7)),console[_0x37f1d8(0xee)](_0x37f1d8(0xba),_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xe2)],'->',_0x473a16),console[_0x37f1d8(0xee)](_0x37f1d8(0x107),_0x55b739[_0x37f1d8(0x123)]['Amount'],_0x55b739['data'][_0x37f1d8(0xc8)]),console[_0x37f1d8(0xee)](_0x37f1d8(0xa7),_0x55b739['data']['TransactionID']),console[_0x37f1d8(0xee)](_0x37f1d8(0x125),_0x2b22ac||_0x37f1d8(0xd8)),console[_0x37f1d8(0xee)]('Created\x20On:',_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xa6)]),console[_0x37f1d8(0xee)]('Confirmed\x20On:',_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xa4)]||_0x37f1d8(0x122));if(_0x55b739[_0x37f1d8(0x123)]['Status']?.[_0x37f1d8(0x10e)]()==='awaiting\x20fiat')console[_0x37f1d8(0xee)](_0x37f1d8(0xd2));else _0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0xe2)]?.['toLowerCase']()==='paid'&&console[_0x37f1d8(0xee)](_0x37f1d8(0x114));return{'status':_0x473a16,'amount':parseFloat(_0x55b739[_0x37f1d8(0x123)][_0x37f1d8(0x11e)])||undefined,'currency':_0x55b739['data']['inputCurrency']||_0x37f1d8(0xbd),'paymentDetails':_0x11181f};}catch(_0x120f11){console[_0x37f1d8(0xe5)](_0x37f1d8(0xbe),_0x120f11),loggerService_1[_0x37f1d8(0xa8)][_0x37f1d8(0xad)]('cointopay',_0x37f1d8(0xb8),_0x120f11);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x120f11 instanceof Error?_0x120f11[_0x37f1d8(0x119)]:'Unknown\x20error'));}}async[a47_0x4dbafa(0x121)](_0x287a10){const _0x5c3b3f=a47_0x4dbafa,_0x55b49e=await this[_0x5c3b3f(0xd0)](_0x287a10);return{'status':_0x55b49e[_0x5c3b3f(0xaa)],'amount':_0x55b49e['amount'],'currency':_0x55b49e[_0x5c3b3f(0x101)]};}async[a47_0x4dbafa(0xf4)](_0x2fbbdd){const _0x4774f2=a47_0x4dbafa;console['log'](_0x4774f2(0x10c),_0x2fbbdd);let _0x374b65='PENDING';switch(_0x2fbbdd[_0x4774f2(0xaa)]?.[_0x4774f2(0x10e)]()){case _0x4774f2(0x110):_0x374b65='PAID';break;case _0x4774f2(0xf5):case _0x4774f2(0xf1):case _0x4774f2(0xe5):_0x374b65=_0x4774f2(0xc7);break;case _0x4774f2(0xb9):case'timeout':_0x374b65='EXPIRED';break;case'pending':case _0x4774f2(0xb1):case _0x4774f2(0xd3):case _0x4774f2(0x10a):default:_0x374b65='PENDING';break;}return{'paymentId':_0x2fbbdd['order_id']||_0x2fbbdd[_0x4774f2(0xb3)]||'','status':_0x374b65,'amount':_0x2fbbdd['amount'],'currency':_0x2fbbdd['currency']||_0x4774f2(0xbd)};}}exports['CoinToPayService']=CoinToPayService;