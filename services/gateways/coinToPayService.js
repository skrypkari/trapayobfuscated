'use strict';const a40_0x30ea66=a40_0x29c9;(function(_0x2636c1,_0x2d971a){const _0x51d708=a40_0x29c9,_0x346df4=_0x2636c1();while(!![]){try{const _0x2113b7=parseInt(_0x51d708(0x1bf))/0x1+parseInt(_0x51d708(0x172))/0x2*(-parseInt(_0x51d708(0x155))/0x3)+-parseInt(_0x51d708(0x17f))/0x4*(-parseInt(_0x51d708(0x178))/0x5)+parseInt(_0x51d708(0x183))/0x6*(parseInt(_0x51d708(0x165))/0x7)+-parseInt(_0x51d708(0x1a9))/0x8+parseInt(_0x51d708(0x18c))/0x9+parseInt(_0x51d708(0x162))/0xa;if(_0x2113b7===_0x2d971a)break;else _0x346df4['push'](_0x346df4['shift']());}catch(_0x5a7871){_0x346df4['push'](_0x346df4['shift']());}}}(a40_0x5237,0x3fb79));function a40_0x5237(){const _0x3eaa09=['HTTP\x20error!\x20status:\x20','not\x20confirmed','CreatedOn','PAID','cancelled','text','order_id','currency','parse','674404QcZqbq','===\x20COINTOPAY\x20SUCCESS\x20===','message','/create','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','216245ReaMQO','not\x20found','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','Headers:','Parsed\x20Result:','created','48ujMKLp','CoinToPayService','QRCodeURL','fromEntries','11058gIzRHK','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Created\x20On:','payment_url','Confirmed\x20On:','../loggerService','Gateway\x20Payment\x20ID:','toLowerCase','awaiting\x20fiat','155511RjqtqK','error','EXPIRED','Failed\x20to\x20parse\x20JSON\x20response:','https://tesoft.uk/gateway/cointopay/status.php','createPaymentLink','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','processWebhook','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','HTTP\x20Status:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','POST','checkPaymentStatus','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','statusUrl','expired','TesSoft\x20Payment\x20System/1.0','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','amount','logWhiteDomainRequest','Business\x20Error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','inputCurrency','PaymentDetail','Amount','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','2661504HRPDma','entries','TransactionConfirmedOn','__esModule','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Amount:','EUR','ExpiryTime','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','cointopay','Response\x20Time:','Result:','Response\x20Body:','waiting','status_code','logWhiteDomainResponse','data','now','/status','result','===\x20COINTOPAY\x20API\x20ERROR\x20===','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','302093fBczms','verifyPayment','Error\x20details:','merchant_reference_id','logWhiteDomainError','loggerService','paid','HTTP\x20','application/json','URL:','defineProperty','Raw\x20Response\x20Body:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===',',\x20body:\x20','üè¶\x20Payment\x20Detail:','Status:','JSON\x20Parse\x20Error:\x20','stack','pending','failed','üè¶\x20Extracted\x20IBAN:','3CVXTIj','Status','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PENDING','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','log','CoinToPay\x20status\x20API\x20error:\x20','Transaction\x20ID:','TransactionID','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Unknown\x20error','gateway_payment_id','stringify','906720ZViBqF','status','IBAN:','7hJDecW','timeout','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20Text:'];a40_0x5237=function(){return _0x3eaa09;};return a40_0x5237();}Object[a40_0x30ea66(0x14a)](exports,a40_0x30ea66(0x1ac),{'value':!![]}),exports[a40_0x30ea66(0x180)]=void 0x0;function a40_0x29c9(_0x447eae,_0x3f74b6){const _0x5237e7=a40_0x5237();return a40_0x29c9=function(_0x29c976,_0x3ccb7b){_0x29c976=_0x29c976-0x143;let _0x5895f4=_0x5237e7[_0x29c976];return _0x5895f4;},a40_0x29c9(_0x447eae,_0x3f74b6);}const loggerService_1=require(a40_0x30ea66(0x188));class CoinToPayService{constructor(){const _0x1b9070=a40_0x30ea66;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x1b9070(0x190),console[_0x1b9070(0x15a)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x1b9070(0x15a)]('üìä\x20Status\x20check\x20URL:',this[_0x1b9070(0x19b)]);}async[a40_0x30ea66(0x191)](_0x1bac19){const _0x29ca1c=a40_0x30ea66,{orderId:_0xec8dc0,amount:_0x541cab}=_0x1bac19;console[_0x29ca1c(0x15a)](_0x29ca1c(0x199)+_0x541cab+'\x20EUR');const _0x1d45db={'amount':_0x541cab},_0x513f05=Date[_0x29ca1c(0x1ba)]();try{console[_0x29ca1c(0x15a)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x29ca1c(0x15a)](_0x29ca1c(0x149),this['apiUrl']),console['log']('Request\x20Body:',JSON[_0x29ca1c(0x161)](_0x1d45db,null,0x2)),console[_0x29ca1c(0x15a)](_0x29ca1c(0x1ae),_0x541cab,_0x29ca1c(0x1a3)),loggerService_1['loggerService'][_0x29ca1c(0x1a1)](_0x29ca1c(0x1b2),_0x29ca1c(0x175),_0x29ca1c(0x197),_0x1d45db);const _0x20f96c=await fetch(this['apiUrl'],{'method':_0x29ca1c(0x197),'headers':{'Content-Type':_0x29ca1c(0x148),'Accept':_0x29ca1c(0x148),'User-Agent':_0x29ca1c(0x19d)},'body':JSON[_0x29ca1c(0x161)](_0x1d45db)}),_0x404d3e=Date[_0x29ca1c(0x1ba)]()-_0x513f05;console['log'](_0x29ca1c(0x1b1)),console[_0x29ca1c(0x15a)](_0x29ca1c(0x14f),_0x20f96c[_0x29ca1c(0x163)]),console[_0x29ca1c(0x15a)](_0x29ca1c(0x168),_0x20f96c['statusText']),console[_0x29ca1c(0x15a)](_0x29ca1c(0x17c),Object[_0x29ca1c(0x182)](_0x20f96c['headers'][_0x29ca1c(0x1aa)]())),console[_0x29ca1c(0x15a)](_0x29ca1c(0x1b3),_0x404d3e+'ms');const _0x29448f=await _0x20f96c[_0x29ca1c(0x16e)]();console[_0x29ca1c(0x15a)](_0x29ca1c(0x14b),_0x29448f);if(!_0x20f96c['ok']){console['error'](_0x29ca1c(0x1bd)),console[_0x29ca1c(0x18d)](_0x29ca1c(0x195),_0x20f96c[_0x29ca1c(0x163)]),console[_0x29ca1c(0x18d)]('Response\x20Body:',_0x29448f),loggerService_1[_0x29ca1c(0x145)]['logWhiteDomainResponse'](_0x29ca1c(0x1b2),_0x29ca1c(0x175),_0x20f96c[_0x29ca1c(0x163)],_0x29448f,_0x404d3e),loggerService_1['loggerService'][_0x29ca1c(0x144)]('cointopay','/create',_0x29ca1c(0x147)+_0x20f96c['status']+':\x20'+_0x29448f);throw new Error(_0x29ca1c(0x169)+_0x20f96c[_0x29ca1c(0x163)]+_0x29ca1c(0x14d)+_0x29448f);}let _0x5ec280;try{_0x5ec280=JSON[_0x29ca1c(0x171)](_0x29448f);}catch(_0x29e94d){console['error'](_0x29ca1c(0x18f),_0x29e94d),loggerService_1[_0x29ca1c(0x145)]['logWhiteDomainError'](_0x29ca1c(0x1b2),'/create','JSON\x20Parse\x20Error:\x20'+_0x29e94d);throw new Error(_0x29ca1c(0x15e)+_0x29448f);}console[_0x29ca1c(0x15a)](_0x29ca1c(0x17a)),console[_0x29ca1c(0x15a)](_0x29ca1c(0x17d),JSON['stringify'](_0x5ec280,null,0x2)),loggerService_1[_0x29ca1c(0x145)]['logWhiteDomainResponse']('cointopay',_0x29ca1c(0x175),_0x20f96c[_0x29ca1c(0x163)],_0x5ec280,_0x404d3e);if(_0x5ec280[_0x29ca1c(0x18d)]){const _0x3477bd=_0x5ec280['message']||_0x5ec280['error']||_0x29ca1c(0x17b);console['error']('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x29ca1c(0x18d)]('Error\x20Message:',_0x3477bd),loggerService_1[_0x29ca1c(0x145)][_0x29ca1c(0x144)](_0x29ca1c(0x1b2),_0x29ca1c(0x175),_0x29ca1c(0x1a2)+_0x3477bd);throw new Error('CoinToPay\x20API\x20error:\x20'+_0x3477bd);}if(!_0x5ec280['payment_url']||!_0x5ec280['gateway_payment_id']){console[_0x29ca1c(0x18d)](_0x29ca1c(0x177)),console[_0x29ca1c(0x18d)]('Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response'),console[_0x29ca1c(0x18d)]('Response\x20data:',_0x5ec280),loggerService_1[_0x29ca1c(0x145)][_0x29ca1c(0x144)](_0x29ca1c(0x1b2),_0x29ca1c(0x175),_0x29ca1c(0x167));throw new Error(_0x29ca1c(0x157));}return console[_0x29ca1c(0x15a)](_0x29ca1c(0x173)),console[_0x29ca1c(0x15a)](_0x29ca1c(0x189),_0x5ec280[_0x29ca1c(0x160)]),console[_0x29ca1c(0x15a)]('Payment\x20URL:',_0x5ec280['payment_url']),console[_0x29ca1c(0x15a)](_0x29ca1c(0x1ae),_0x541cab,'EUR'),{'gateway_payment_id':_0x5ec280['gateway_payment_id'],'payment_url':_0x5ec280[_0x29ca1c(0x186)]};}catch(_0x405579){console['error'](_0x29ca1c(0x176)),console[_0x29ca1c(0x18d)](_0x29ca1c(0x1c1),_0x405579),loggerService_1[_0x29ca1c(0x145)][_0x29ca1c(0x144)](_0x29ca1c(0x1b2),'/create',_0x405579);if(_0x405579 instanceof Error){console[_0x29ca1c(0x18d)]('Error\x20message:',_0x405579[_0x29ca1c(0x174)]),console['error']('Error\x20stack:',_0x405579[_0x29ca1c(0x151)]);throw new Error(_0x29ca1c(0x19a)+_0x405579['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a40_0x30ea66(0x198)](_0x275066){const _0x4549bc=a40_0x30ea66,_0x51b798=Date[_0x4549bc(0x1ba)]();try{console['log'](_0x4549bc(0x192)+_0x275066);const _0x5a05ed={'gatewayPaymentId':_0x275066};loggerService_1[_0x4549bc(0x145)][_0x4549bc(0x1a1)](_0x4549bc(0x1b2),'/status','POST',_0x5a05ed);const _0xb72df9=await fetch(this[_0x4549bc(0x19b)],{'method':_0x4549bc(0x197),'headers':{'Content-Type':'application/json','Accept':_0x4549bc(0x148),'User-Agent':_0x4549bc(0x19d)},'body':JSON[_0x4549bc(0x161)](_0x5a05ed)}),_0x325ba8=Date[_0x4549bc(0x1ba)]()-_0x51b798;console['log'](_0x4549bc(0x194)),console[_0x4549bc(0x15a)](_0x4549bc(0x14f),_0xb72df9[_0x4549bc(0x163)]),console[_0x4549bc(0x15a)](_0x4549bc(0x1b3),_0x325ba8+'ms');if(!_0xb72df9['ok']){const _0x37dfbf=await _0xb72df9[_0x4549bc(0x16e)]();console[_0x4549bc(0x18d)]('HTTP\x20Status:',_0xb72df9[_0x4549bc(0x163)]),console[_0x4549bc(0x18d)](_0x4549bc(0x1b5),_0x37dfbf),loggerService_1[_0x4549bc(0x145)][_0x4549bc(0x1b8)](_0x4549bc(0x1b2),'/status',_0xb72df9[_0x4549bc(0x163)],_0x37dfbf,_0x325ba8),loggerService_1[_0x4549bc(0x145)][_0x4549bc(0x144)](_0x4549bc(0x1b2),_0x4549bc(0x1bb),_0x4549bc(0x147)+_0xb72df9[_0x4549bc(0x163)]+':\x20'+_0x37dfbf);throw new Error(_0x4549bc(0x169)+_0xb72df9[_0x4549bc(0x163)]);}const _0x2865f2=await _0xb72df9[_0x4549bc(0x16e)]();console[_0x4549bc(0x15a)](_0x4549bc(0x14b),_0x2865f2);let _0x1fe9ed;try{_0x1fe9ed=JSON[_0x4549bc(0x171)](_0x2865f2);}catch(_0x49c4be){console[_0x4549bc(0x18d)](_0x4549bc(0x18f),_0x49c4be),loggerService_1[_0x4549bc(0x145)]['logWhiteDomainError'](_0x4549bc(0x1b2),_0x4549bc(0x1bb),_0x4549bc(0x150)+_0x49c4be);throw new Error(_0x4549bc(0x184)+_0x2865f2);}loggerService_1['loggerService'][_0x4549bc(0x1b8)]('cointopay','/status',_0xb72df9['status'],_0x1fe9ed,_0x325ba8),console[_0x4549bc(0x15a)](_0x4549bc(0x14c)),console['log'](_0x4549bc(0x1b4),_0x1fe9ed[_0x4549bc(0x1bc)]),console[_0x4549bc(0x15a)]('Status\x20Code:',_0x1fe9ed[_0x4549bc(0x1b7)]),console[_0x4549bc(0x15a)](_0x4549bc(0x1a7),_0x1fe9ed[_0x4549bc(0x1b9)]?.[_0x4549bc(0x156)]),console['log'](_0x4549bc(0x1ae),_0x1fe9ed[_0x4549bc(0x1b9)]?.[_0x4549bc(0x1a6)]),console[_0x4549bc(0x15a)]('Currency:',_0x1fe9ed['data']?.[_0x4549bc(0x1a4)]);if(_0x1fe9ed['result']!=='success'||_0x1fe9ed['status_code']!==0xc8){const _0x2f99d6=_0x1fe9ed[_0x4549bc(0x174)]||_0x4549bc(0x19f);console[_0x4549bc(0x18d)](_0x4549bc(0x1a8)),console[_0x4549bc(0x18d)]('Error\x20Message:',_0x2f99d6),loggerService_1[_0x4549bc(0x145)][_0x4549bc(0x144)](_0x4549bc(0x1b2),'/status','Status\x20API\x20Error:\x20'+_0x2f99d6);throw new Error(_0x4549bc(0x15b)+_0x2f99d6);}if(!_0x1fe9ed[_0x4549bc(0x1b9)]){console['error']('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x4549bc(0x145)][_0x4549bc(0x144)]('cointopay',_0x4549bc(0x1bb),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x4549bc(0x19e));}let _0x42639e='PENDING';switch(_0x1fe9ed['data'][_0x4549bc(0x156)]?.[_0x4549bc(0x18a)]()){case'paid':_0x42639e=_0x4549bc(0x16c);break;case _0x4549bc(0x16d):case _0x4549bc(0x153):case _0x4549bc(0x18d):_0x42639e='FAILED';break;case _0x4549bc(0x19c):case _0x4549bc(0x166):_0x42639e=_0x4549bc(0x18e);break;case'waiting':case _0x4549bc(0x18b):case _0x4549bc(0x152):case _0x4549bc(0x17e):default:_0x42639e=_0x4549bc(0x158);break;}let _0x18e009,_0x58269c;if(_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1a5)]){const _0x919264=_0x1fe9ed['data'][_0x4549bc(0x1a5)];console[_0x4549bc(0x15a)](_0x4549bc(0x14e),_0x919264);const _0x1057ee=_0x919264['match'](/IBAN\s+([A-Z0-9]+)/i);_0x1057ee&&(_0x18e009=_0x1057ee[0x1],console[_0x4549bc(0x15a)](_0x4549bc(0x154),_0x18e009)),_0x58269c=_0x919264;}const _0x4def2d={'iban':_0x18e009,'bankDetails':_0x58269c,'transactionId':_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x15d)],'coinAddress':_0x1fe9ed[_0x4549bc(0x1b9)]['coinAddress'],'qrCodeUrl':_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x181)],'expiryTime':_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1b0)],'createdOn':_0x1fe9ed['data'][_0x4549bc(0x16b)],'confirmedOn':_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1ab)]};console[_0x4549bc(0x15a)](_0x4549bc(0x159)),console[_0x4549bc(0x15a)](_0x4549bc(0x14f),_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x156)],'->',_0x42639e),console['log'](_0x4549bc(0x1ae),_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1a6)],_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1a4)]),console[_0x4549bc(0x15a)](_0x4549bc(0x15c),_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x15d)]),console[_0x4549bc(0x15a)](_0x4549bc(0x164),_0x18e009||_0x4549bc(0x179)),console[_0x4549bc(0x15a)](_0x4549bc(0x185),_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x16b)]),console[_0x4549bc(0x15a)](_0x4549bc(0x187),_0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x1ab)]||_0x4549bc(0x16a));if(_0x1fe9ed['data']['Status']?.[_0x4549bc(0x18a)]()===_0x4549bc(0x18b))console['log'](_0x4549bc(0x1be));else _0x1fe9ed[_0x4549bc(0x1b9)][_0x4549bc(0x156)]?.[_0x4549bc(0x18a)]()===_0x4549bc(0x146)&&console[_0x4549bc(0x15a)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x42639e,'amount':parseFloat(_0x1fe9ed[_0x4549bc(0x1b9)]['Amount'])||undefined,'currency':_0x1fe9ed[_0x4549bc(0x1b9)]['inputCurrency']||_0x4549bc(0x1af),'paymentDetails':_0x4def2d};}catch(_0x5e5ac7){console[_0x4549bc(0x18d)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x5e5ac7),loggerService_1['loggerService'][_0x4549bc(0x144)](_0x4549bc(0x1b2),_0x4549bc(0x1bb),_0x5e5ac7);throw new Error(_0x4549bc(0x1ad)+(_0x5e5ac7 instanceof Error?_0x5e5ac7[_0x4549bc(0x174)]:_0x4549bc(0x15f)));}}async[a40_0x30ea66(0x1c0)](_0x120dd9){const _0x24d808=a40_0x30ea66,_0x2e6afb=await this[_0x24d808(0x198)](_0x120dd9);return{'status':_0x2e6afb[_0x24d808(0x163)],'amount':_0x2e6afb[_0x24d808(0x1a0)],'currency':_0x2e6afb[_0x24d808(0x170)]};}async[a40_0x30ea66(0x193)](_0x4e78f6){const _0xe71da1=a40_0x30ea66;console['log'](_0xe71da1(0x196),_0x4e78f6);let _0xd59b0d='PENDING';switch(_0x4e78f6['status']?.[_0xe71da1(0x18a)]()){case _0xe71da1(0x146):_0xd59b0d=_0xe71da1(0x16c);break;case'cancelled':case'failed':case'error':_0xd59b0d='FAILED';break;case _0xe71da1(0x19c):case'timeout':_0xd59b0d=_0xe71da1(0x18e);break;case _0xe71da1(0x152):case _0xe71da1(0x1b6):case _0xe71da1(0x18b):case _0xe71da1(0x17e):default:_0xd59b0d=_0xe71da1(0x158);break;}return{'paymentId':_0x4e78f6[_0xe71da1(0x16f)]||_0x4e78f6[_0xe71da1(0x143)]||'','status':_0xd59b0d,'amount':_0x4e78f6[_0xe71da1(0x1a0)],'currency':_0x4e78f6['currency']||'EUR'};}}exports[a40_0x30ea66(0x180)]=CoinToPayService;