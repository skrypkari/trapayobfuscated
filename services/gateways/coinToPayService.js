'use strict';const a40_0x49c95c=a40_0x2ad5;(function(_0x48d07a,_0x1e251a){const _0xd1ae66=a40_0x2ad5,_0x1d6d80=_0x48d07a();while(!![]){try{const _0x3b9c93=parseInt(_0xd1ae66(0xca))/0x1+-parseInt(_0xd1ae66(0x123))/0x2+parseInt(_0xd1ae66(0x140))/0x3*(parseInt(_0xd1ae66(0xcc))/0x4)+parseInt(_0xd1ae66(0xf6))/0x5*(-parseInt(_0xd1ae66(0xdd))/0x6)+-parseInt(_0xd1ae66(0x127))/0x7+parseInt(_0xd1ae66(0xd1))/0x8*(parseInt(_0xd1ae66(0x113))/0x9)+parseInt(_0xd1ae66(0xd6))/0xa;if(_0x3b9c93===_0x1e251a)break;else _0x1d6d80['push'](_0x1d6d80['shift']());}catch(_0x78cb84){_0x1d6d80['push'](_0x1d6d80['shift']());}}}(a40_0x5411,0xce0a4));Object[a40_0x49c95c(0x149)](exports,a40_0x49c95c(0x14d),{'value':!![]}),exports[a40_0x49c95c(0xf1)]=void 0x0;const loggerService_1=require(a40_0x49c95c(0xd0));class CoinToPayService{constructor(){const _0x2f3440=a40_0x49c95c;this['apiUrl']=_0x2f3440(0xc7),this[_0x2f3440(0xda)]=_0x2f3440(0x12c),console[_0x2f3440(0x13e)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x2f3440(0x13e)](_0x2f3440(0x139),this[_0x2f3440(0xda)]);}async[a40_0x49c95c(0x13d)](_0x57048d){const _0x512c13=a40_0x49c95c,{orderId:_0x3d82b7,amount:_0x2c942d}=_0x57048d;console[_0x512c13(0x13e)](_0x512c13(0xf4)+_0x2c942d+_0x512c13(0x121));const _0x4b7392={'amount':_0x2c942d},_0x24d86a=Date[_0x512c13(0xe9)]();try{console[_0x512c13(0x13e)]('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x512c13(0x13e)](_0x512c13(0x119),this[_0x512c13(0x11f)]),console['log'](_0x512c13(0x106),JSON['stringify'](_0x4b7392,null,0x2)),console[_0x512c13(0x13e)](_0x512c13(0x144),_0x2c942d,_0x512c13(0xf5)),loggerService_1['loggerService'][_0x512c13(0x150)](_0x512c13(0x10c),'/create',_0x512c13(0xee),_0x4b7392);const _0x3aa020=await fetch(this[_0x512c13(0x11f)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':_0x512c13(0x11b),'User-Agent':_0x512c13(0x14a)},'body':JSON[_0x512c13(0xd7)](_0x4b7392)}),_0x1bc69a=Date['now']()-_0x24d86a;console[_0x512c13(0x13e)](_0x512c13(0xe4)),console[_0x512c13(0x13e)](_0x512c13(0x120),_0x3aa020[_0x512c13(0x115)]),console[_0x512c13(0x13e)](_0x512c13(0xf2),_0x3aa020[_0x512c13(0x125)]),console[_0x512c13(0x13e)](_0x512c13(0x126),Object[_0x512c13(0xcd)](_0x3aa020[_0x512c13(0xd4)][_0x512c13(0x124)]())),console[_0x512c13(0x13e)](_0x512c13(0x130),_0x1bc69a+'ms');const _0x300427=await _0x3aa020[_0x512c13(0x137)]();console['log']('Raw\x20Response\x20Body:',_0x300427);if(!_0x3aa020['ok']){console['error'](_0x512c13(0x10d)),console['error'](_0x512c13(0x118),_0x3aa020['status']),console[_0x512c13(0x13b)](_0x512c13(0x135),_0x300427),loggerService_1[_0x512c13(0x103)]['logWhiteDomainResponse'](_0x512c13(0x10c),_0x512c13(0xed),_0x3aa020[_0x512c13(0x115)],_0x300427,_0x1bc69a),loggerService_1[_0x512c13(0x103)][_0x512c13(0x13c)](_0x512c13(0x10c),'/create',_0x512c13(0x146)+_0x3aa020[_0x512c13(0x115)]+':\x20'+_0x300427);throw new Error(_0x512c13(0x10b)+_0x3aa020['status']+',\x20body:\x20'+_0x300427);}let _0x4961f8;try{_0x4961f8=JSON[_0x512c13(0x132)](_0x300427);}catch(_0x4daf18){console[_0x512c13(0x13b)](_0x512c13(0x10a),_0x4daf18),loggerService_1[_0x512c13(0x103)][_0x512c13(0x13c)](_0x512c13(0x10c),_0x512c13(0xed),_0x512c13(0x12e)+_0x4daf18);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x300427);}console[_0x512c13(0x13e)](_0x512c13(0x142)),console[_0x512c13(0x13e)](_0x512c13(0x14c),JSON['stringify'](_0x4961f8,null,0x2)),loggerService_1[_0x512c13(0x103)]['logWhiteDomainResponse']('cointopay',_0x512c13(0xed),_0x3aa020[_0x512c13(0x115)],_0x4961f8,_0x1bc69a);if(_0x4961f8[_0x512c13(0x13b)]){const _0x34e055=_0x4961f8[_0x512c13(0xe6)]||_0x4961f8[_0x512c13(0x13b)]||_0x512c13(0x108);console[_0x512c13(0x13b)](_0x512c13(0xcf)),console[_0x512c13(0x13b)](_0x512c13(0x138),_0x34e055),loggerService_1[_0x512c13(0x103)]['logWhiteDomainError']('cointopay',_0x512c13(0xed),_0x512c13(0xe1)+_0x34e055);throw new Error(_0x512c13(0xea)+_0x34e055);}if(!_0x4961f8[_0x512c13(0x13f)]||!_0x4961f8[_0x512c13(0x12b)]){console[_0x512c13(0x13b)](_0x512c13(0xd2)),console['error'](_0x512c13(0x11a)),console[_0x512c13(0x13b)](_0x512c13(0x13a),_0x4961f8),loggerService_1[_0x512c13(0x103)][_0x512c13(0x13c)]('cointopay',_0x512c13(0xed),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x512c13(0xc9));}return console[_0x512c13(0x13e)](_0x512c13(0xfd)),console['log'](_0x512c13(0xdb),_0x4961f8[_0x512c13(0x12b)]),console['log']('Payment\x20URL:',_0x4961f8['payment_url']),console[_0x512c13(0x13e)]('Amount:',_0x2c942d,'EUR'),{'gateway_payment_id':_0x4961f8[_0x512c13(0x12b)],'payment_url':_0x4961f8[_0x512c13(0x13f)]};}catch(_0x2a58e3){console['error'](_0x512c13(0x102)),console['error'](_0x512c13(0xd9),_0x2a58e3),loggerService_1[_0x512c13(0x103)][_0x512c13(0x13c)]('cointopay',_0x512c13(0xed),_0x2a58e3);if(_0x2a58e3 instanceof Error){console[_0x512c13(0x13b)](_0x512c13(0x10e),_0x2a58e3['message']),console['error']('Error\x20stack:',_0x2a58e3[_0x512c13(0x112)]);throw new Error(_0x512c13(0xe0)+_0x2a58e3[_0x512c13(0xe6)]);}throw new Error(_0x512c13(0x11e));}}async[a40_0x49c95c(0xc6)](_0x514444){const _0x4815c1=a40_0x49c95c,_0x3f03cd=Date['now']();try{console[_0x4815c1(0x13e)](_0x4815c1(0xf7)+_0x514444);const _0x54b964={'gatewayPaymentId':_0x514444};loggerService_1[_0x4815c1(0x103)]['logWhiteDomainRequest'](_0x4815c1(0x10c),_0x4815c1(0x109),_0x4815c1(0xee),_0x54b964);const _0x53f071=await fetch(this[_0x4815c1(0xda)],{'method':_0x4815c1(0xee),'headers':{'Content-Type':_0x4815c1(0x11b),'Accept':_0x4815c1(0x11b),'User-Agent':_0x4815c1(0x14a)},'body':JSON[_0x4815c1(0xd7)](_0x54b964)}),_0x5a6ffe=Date[_0x4815c1(0xe9)]()-_0x3f03cd;console[_0x4815c1(0x13e)](_0x4815c1(0x107)),console[_0x4815c1(0x13e)](_0x4815c1(0x120),_0x53f071[_0x4815c1(0x115)]),console[_0x4815c1(0x13e)](_0x4815c1(0x130),_0x5a6ffe+'ms');if(!_0x53f071['ok']){const _0x52faa3=await _0x53f071[_0x4815c1(0x137)]();console[_0x4815c1(0x13b)](_0x4815c1(0x118),_0x53f071[_0x4815c1(0x115)]),console[_0x4815c1(0x13b)](_0x4815c1(0x135),_0x52faa3),loggerService_1[_0x4815c1(0x103)][_0x4815c1(0xff)](_0x4815c1(0x10c),_0x4815c1(0x109),_0x53f071[_0x4815c1(0x115)],_0x52faa3,_0x5a6ffe),loggerService_1[_0x4815c1(0x103)][_0x4815c1(0x13c)]('cointopay','/status',_0x4815c1(0x146)+_0x53f071[_0x4815c1(0x115)]+':\x20'+_0x52faa3);throw new Error('HTTP\x20error!\x20status:\x20'+_0x53f071[_0x4815c1(0x115)]);}const _0x20f9ed=await _0x53f071[_0x4815c1(0x137)]();console['log'](_0x4815c1(0x12a),_0x20f9ed);let _0x1569a1;try{_0x1569a1=JSON[_0x4815c1(0x132)](_0x20f9ed);}catch(_0x3940d2){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x3940d2),loggerService_1[_0x4815c1(0x103)][_0x4815c1(0x13c)]('cointopay',_0x4815c1(0x109),_0x4815c1(0x12e)+_0x3940d2);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x20f9ed);}loggerService_1['loggerService'][_0x4815c1(0xff)](_0x4815c1(0x10c),_0x4815c1(0x109),_0x53f071[_0x4815c1(0x115)],_0x1569a1,_0x5a6ffe),console['log'](_0x4815c1(0x110)),console[_0x4815c1(0x13e)](_0x4815c1(0x122),_0x1569a1['result']),console[_0x4815c1(0x13e)](_0x4815c1(0x12f),_0x1569a1[_0x4815c1(0xc5)]),console[_0x4815c1(0x13e)]('Payment\x20Status:',_0x1569a1[_0x4815c1(0x145)]?.['Status']),console['log'](_0x4815c1(0x144),_0x1569a1[_0x4815c1(0x145)]?.[_0x4815c1(0xec)]),console['log'](_0x4815c1(0x141),_0x1569a1[_0x4815c1(0x145)]?.[_0x4815c1(0x114)]);if(_0x1569a1[_0x4815c1(0xcb)]!==_0x4815c1(0x117)||_0x1569a1[_0x4815c1(0xc5)]!==0xc8){const _0xc88b96=_0x1569a1['message']||_0x4815c1(0xe8);console[_0x4815c1(0x13b)](_0x4815c1(0x148)),console[_0x4815c1(0x13b)](_0x4815c1(0x138),_0xc88b96),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x4815c1(0x109),_0x4815c1(0xd5)+_0xc88b96);throw new Error(_0x4815c1(0x131)+_0xc88b96);}if(!_0x1569a1[_0x4815c1(0x145)]){console['error'](_0x4815c1(0x11d)),console[_0x4815c1(0x13b)](_0x4815c1(0x133)),loggerService_1[_0x4815c1(0x103)]['logWhiteDomainError'](_0x4815c1(0x10c),_0x4815c1(0x109),_0x4815c1(0xfa));throw new Error(_0x4815c1(0x101));}let _0x48e4e5=_0x4815c1(0xe5);switch(_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0xfb)]?.[_0x4815c1(0xf3)]()){case _0x4815c1(0x116):_0x48e4e5=_0x4815c1(0xd3);break;case _0x4815c1(0xdc):case _0x4815c1(0xeb):case'error':_0x48e4e5=_0x4815c1(0xf0);break;case'expired':case _0x4815c1(0x143):_0x48e4e5='EXPIRED';break;case _0x4815c1(0xc8):case _0x4815c1(0x104):case _0x4815c1(0xe2):case _0x4815c1(0x134):default:_0x48e4e5=_0x4815c1(0xe5);break;}let _0x5d4596,_0x46ec5a;if(_0x1569a1[_0x4815c1(0x145)]['PaymentDetail']){const _0x4ba678=_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0x100)];console['log'](_0x4815c1(0xe3),_0x4ba678);const _0x5c1c9c=_0x4ba678[_0x4815c1(0xde)](/IBAN\s+([A-Z0-9]+)/i);_0x5c1c9c&&(_0x5d4596=_0x5c1c9c[0x1],console['log']('🏦\x20Extracted\x20IBAN:',_0x5d4596)),_0x46ec5a=_0x4ba678;}const _0x40ed85={'iban':_0x5d4596,'bankDetails':_0x46ec5a,'transactionId':_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0x129)],'coinAddress':_0x1569a1['data'][_0x4815c1(0x128)],'qrCodeUrl':_0x1569a1[_0x4815c1(0x145)]['QRCodeURL'],'expiryTime':_0x1569a1[_0x4815c1(0x145)]['ExpiryTime'],'createdOn':_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0xfc)],'confirmedOn':_0x1569a1[_0x4815c1(0x145)]['TransactionConfirmedOn']};console[_0x4815c1(0x13e)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x4815c1(0x13e)]('Status:',_0x1569a1[_0x4815c1(0x145)]['Status'],'->',_0x48e4e5),console[_0x4815c1(0x13e)](_0x4815c1(0x144),_0x1569a1[_0x4815c1(0x145)]['Amount'],_0x1569a1['data']['inputCurrency']),console[_0x4815c1(0x13e)](_0x4815c1(0x14f),_0x1569a1[_0x4815c1(0x145)]['TransactionID']),console[_0x4815c1(0x13e)](_0x4815c1(0xe7),_0x5d4596||_0x4815c1(0xdf)),console[_0x4815c1(0x13e)]('Created\x20On:',_0x1569a1[_0x4815c1(0x145)]['CreatedOn']),console[_0x4815c1(0x13e)](_0x4815c1(0xf8),_0x1569a1['data'][_0x4815c1(0x105)]||_0x4815c1(0x147));if(_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0xfb)]?.[_0x4815c1(0xf3)]()==='awaiting\x20fiat')console[_0x4815c1(0x13e)](_0x4815c1(0xfe));else _0x1569a1['data'][_0x4815c1(0xfb)]?.[_0x4815c1(0xf3)]()===_0x4815c1(0x116)&&console[_0x4815c1(0x13e)](_0x4815c1(0x111));return{'status':_0x48e4e5,'amount':parseFloat(_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0xec)])||undefined,'currency':_0x1569a1[_0x4815c1(0x145)][_0x4815c1(0x114)]||_0x4815c1(0x10f),'paymentDetails':_0x40ed85};}catch(_0x4bbe85){console[_0x4815c1(0x13b)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4bbe85),loggerService_1[_0x4815c1(0x103)][_0x4815c1(0x13c)](_0x4815c1(0x10c),_0x4815c1(0x109),_0x4bbe85);throw new Error(_0x4815c1(0x14e)+(_0x4bbe85 instanceof Error?_0x4bbe85[_0x4815c1(0xe6)]:_0x4815c1(0x136)));}}async[a40_0x49c95c(0xf9)](_0x59d848){const _0x17798c=a40_0x49c95c,_0x2672a5=await this[_0x17798c(0xc6)](_0x59d848);return{'status':_0x2672a5['status'],'amount':_0x2672a5[_0x17798c(0x12d)],'currency':_0x2672a5['currency']};}async['processWebhook'](_0x398be1){const _0x3f8ebe=a40_0x49c95c;console[_0x3f8ebe(0x13e)](_0x3f8ebe(0x11c),_0x398be1);let _0x173d00=_0x3f8ebe(0xe5);switch(_0x398be1['status']?.['toLowerCase']()){case _0x3f8ebe(0x116):_0x173d00=_0x3f8ebe(0xd3);break;case _0x3f8ebe(0xdc):case _0x3f8ebe(0xeb):case'error':_0x173d00=_0x3f8ebe(0xf0);break;case _0x3f8ebe(0xce):case _0x3f8ebe(0x143):_0x173d00=_0x3f8ebe(0xd8);break;case'pending':case _0x3f8ebe(0xc8):case _0x3f8ebe(0x104):case _0x3f8ebe(0x134):default:_0x173d00=_0x3f8ebe(0xe5);break;}return{'paymentId':_0x398be1['order_id']||_0x398be1[_0x3f8ebe(0xef)]||'','status':_0x173d00,'amount':_0x398be1[_0x3f8ebe(0x12d)],'currency':_0x398be1[_0x3f8ebe(0x14b)]||_0x3f8ebe(0x10f)};}}exports[a40_0x49c95c(0xf1)]=CoinToPayService;function a40_0x2ad5(_0x4ae789,_0x2dc529){const _0x541195=a40_0x5411();return a40_0x2ad5=function(_0x2ad51d,_0x4df64b){_0x2ad51d=_0x2ad51d-0xc5;let _0xabd6c0=_0x541195[_0x2ad51d];return _0xabd6c0;},a40_0x2ad5(_0x4ae789,_0x2dc529);}function a40_0x5411(){const _0x2ff22e=['Response\x20data:','error','logWhiteDomainError','createPaymentLink','log','payment_url','51gOKpYO','Currency:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','timeout','Amount:','data','HTTP\x20','not\x20confirmed','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','defineProperty','TesSoft\x20Payment\x20System/1.0','currency','Parsed\x20Result:','__esModule','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Transaction\x20ID:','logWhiteDomainRequest','status_code','checkPaymentStatus','https://tesoft.uk/gateway/cointopay/','waiting','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','203372rPPOLQ','result','13736LLKJji','fromEntries','expired','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','../loggerService','728bPgzQx','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAID','headers','Status\x20API\x20Error:\x20','22824410pXuysS','stringify','EXPIRED','Error\x20details:','statusUrl','Gateway\x20Payment\x20ID:','cancelled','18pSucMa','match','not\x20found','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Business\x20Error:\x20','pending','🏦\x20Payment\x20Detail:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','PENDING','message','IBAN:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','now','CoinToPay\x20API\x20error:\x20','failed','Amount','/create','POST','merchant_reference_id','FAILED','CoinToPayService','Status\x20Text:','toLowerCase','🪙\x20Creating\x20CoinToPay\x20payment:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','449510PKwLtG','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Confirmed\x20On:','verifyPayment','Incomplete\x20response:\x20missing\x20data','Status','CreatedOn','===\x20COINTOPAY\x20SUCCESS\x20===','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','logWhiteDomainResponse','PaymentDetail','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','loggerService','awaiting\x20fiat','TransactionConfirmedOn','Request\x20Body:','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','/status','Failed\x20to\x20parse\x20JSON\x20response:','HTTP\x20error!\x20status:\x20','cointopay','===\x20COINTOPAY\x20API\x20ERROR\x20===','Error\x20message:','EUR','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','stack','8298WxScmA','inputCurrency','status','paid','success','HTTP\x20Status:','URL:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','application/json','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','apiUrl','Status:','\x20EUR','Result:','661178KLjzmp','entries','statusText','Headers:','8287006eXAEif','coinAddress','TransactionID','Raw\x20Response\x20Body:','gateway_payment_id','https://tesoft.uk/gateway/cointopay/status.php','amount','JSON\x20Parse\x20Error:\x20','Status\x20Code:','Response\x20Time:','CoinToPay\x20status\x20API\x20error:\x20','parse','Missing\x20data\x20in\x20response','created','Response\x20Body:','Unknown\x20error','text','Error\x20Message:','📊\x20Status\x20check\x20URL:'];a40_0x5411=function(){return _0x2ff22e;};return a40_0x5411();}