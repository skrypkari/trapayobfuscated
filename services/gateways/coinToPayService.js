'use strict';const a43_0x546e85=a43_0x26ed;function a43_0x26ed(_0x5d90da,_0x5ac190){const _0x910fd=a43_0x910f();return a43_0x26ed=function(_0x26edf0,_0x493be9){_0x26edf0=_0x26edf0-0xe8;let _0x20d1ac=_0x910fd[_0x26edf0];return _0x20d1ac;},a43_0x26ed(_0x5d90da,_0x5ac190);}(function(_0xc18457,_0x2d76ee){const _0x5265aa=a43_0x26ed,_0x8f9118=_0xc18457();while(!![]){try{const _0x58c2bf=parseInt(_0x5265aa(0x104))/0x1+parseInt(_0x5265aa(0x148))/0x2+-parseInt(_0x5265aa(0x135))/0x3*(parseInt(_0x5265aa(0x140))/0x4)+parseInt(_0x5265aa(0x113))/0x5*(-parseInt(_0x5265aa(0x12d))/0x6)+parseInt(_0x5265aa(0x14b))/0x7*(-parseInt(_0x5265aa(0x106))/0x8)+parseInt(_0x5265aa(0x16b))/0x9*(parseInt(_0x5265aa(0xfc))/0xa)+-parseInt(_0x5265aa(0xea))/0xb*(-parseInt(_0x5265aa(0x118))/0xc);if(_0x58c2bf===_0x2d76ee)break;else _0x8f9118['push'](_0x8f9118['shift']());}catch(_0x4cbabb){_0x8f9118['push'](_0x8f9118['shift']());}}}(a43_0x910f,0x920d8));function a43_0x910f(){const _0x25ce61=['failed','HTTP\x20','Gateway\x20Payment\x20ID:','status_code','TransactionID','pending','Response\x20Body:','application/json','payment_url','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','cointopay','parse','Request\x20Body:','waiting','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Status','inputCurrency','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','stack','Amount:','1035vnvXbF','result','Error\x20Message:','33XaEIwV','expired','EUR','ExpiryTime','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','checkPaymentStatus','gateway_payment_id','Amount','amount','FAILED','fromEntries','Unknown\x20error','paid','===\x20COINTOPAY\x20API\x20ERROR\x20===','/create','Transaction\x20ID:','82290bKtjoY','Unknown\x20error\x20from\x20CoinToPay\x20API','HTTP\x20Status:','error','URL:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','PENDING','logWhiteDomainResponse','172367iKEbDk','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','40424GriESc','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Incomplete\x20response:\x20missing\x20data','createPaymentLink','text','CoinToPay\x20API\x20error:\x20','Error\x20details:','message','logWhiteDomainRequest','Result:','not\x20found','log','2759215IjKkdL','https://tesoft.uk/gateway/cointopay/','===\x20COINTOPAY\x20SUCCESS\x20===','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','4646544vWgZod','IBAN:','Status\x20Code:','Payment\x20Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Response\x20data:','match','PaymentDetail','https://tesoft.uk/gateway/cointopay/status.php','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','now','Failed\x20to\x20parse\x20JSON\x20response:','awaiting\x20fiat','status','success','headers','Response\x20Time:','cancelled','apiUrl','Payment\x20URL:','currency','6FfzCQA','created','CoinToPayService','Currency:','TesSoft\x20Payment\x20System/1.0','Status:','QRCodeURL','📊\x20Status\x20check\x20URL:','96vcrtZh','loggerService','Status\x20API\x20Error:\x20','toLowerCase','HTTP\x20error!\x20status:\x20','logWhiteDomainError','CreatedOn','POST','PAID','Raw\x20Response\x20Body:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','91016GytJGJ','../loggerService','Headers:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Missing\x20data\x20in\x20response','CoinToPay\x20status\x20API\x20error:\x20','statusText','Error\x20message:','297284MkmERX','not\x20confirmed','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','763ThfVyO','stringify','Parsed\x20Result:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','data','/status','Status\x20Text:','Business\x20Error:\x20','\x20EUR','statusUrl','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API'];a43_0x910f=function(){return _0x25ce61;};return a43_0x910f();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a43_0x546e85(0x12f)]=void 0x0;const loggerService_1=require(a43_0x546e85(0x141));class CoinToPayService{constructor(){const _0x5087db=a43_0x546e85;this[_0x5087db(0x12a)]=_0x5087db(0x114),this[_0x5087db(0x155)]=_0x5087db(0x120),console['log']('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x5087db(0x112)](_0x5087db(0x134),this[_0x5087db(0x155)]);}async[a43_0x546e85(0x10a)](_0x2c682d){const _0x1b384b=a43_0x546e85,{orderId:_0x153d7f,amount:_0x737e80}=_0x2c682d;console[_0x1b384b(0x112)]('🪙\x20Creating\x20CoinToPay\x20payment:\x20'+_0x737e80+_0x1b384b(0x154));const _0x1a5c25={'amount':_0x737e80},_0x348930=Date[_0x1b384b(0x122)]();try{console[_0x1b384b(0x112)](_0x1b384b(0x168)),console[_0x1b384b(0x112)](_0x1b384b(0x100),this['apiUrl']),console[_0x1b384b(0x112)](_0x1b384b(0x163),JSON[_0x1b384b(0x14c)](_0x1a5c25,null,0x2)),console[_0x1b384b(0x112)]('Amount:',_0x737e80,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x10f)](_0x1b384b(0x161),_0x1b384b(0xfa),'POST',_0x1a5c25);const _0xa7e041=await fetch(this[_0x1b384b(0x12a)],{'method':'POST','headers':{'Content-Type':_0x1b384b(0x15e),'Accept':'application/json','User-Agent':_0x1b384b(0x131)},'body':JSON[_0x1b384b(0x14c)](_0x1a5c25)}),_0x1dacc0=Date[_0x1b384b(0x122)]()-_0x348930;console[_0x1b384b(0x112)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x1b384b(0x112)](_0x1b384b(0x132),_0xa7e041[_0x1b384b(0x125)]),console['log'](_0x1b384b(0x152),_0xa7e041[_0x1b384b(0x146)]),console[_0x1b384b(0x112)](_0x1b384b(0x142),Object[_0x1b384b(0xf6)](_0xa7e041[_0x1b384b(0x127)]['entries']())),console[_0x1b384b(0x112)](_0x1b384b(0x128),_0x1dacc0+'ms');const _0x3a52aa=await _0xa7e041[_0x1b384b(0x10b)]();console[_0x1b384b(0x112)](_0x1b384b(0x13e),_0x3a52aa);if(!_0xa7e041['ok']){console[_0x1b384b(0xff)](_0x1b384b(0xf9)),console[_0x1b384b(0xff)](_0x1b384b(0xfe),_0xa7e041[_0x1b384b(0x125)]),console[_0x1b384b(0xff)](_0x1b384b(0x15d),_0x3a52aa),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x103)]('cointopay',_0x1b384b(0xfa),_0xa7e041['status'],_0x3a52aa,_0x1dacc0),loggerService_1['loggerService']['logWhiteDomainError'](_0x1b384b(0x161),_0x1b384b(0xfa),_0x1b384b(0x158)+_0xa7e041[_0x1b384b(0x125)]+':\x20'+_0x3a52aa);throw new Error(_0x1b384b(0x139)+_0xa7e041[_0x1b384b(0x125)]+',\x20body:\x20'+_0x3a52aa);}let _0x3e5311;try{_0x3e5311=JSON[_0x1b384b(0x162)](_0x3a52aa);}catch(_0x1a3701){console[_0x1b384b(0xff)](_0x1b384b(0x123),_0x1a3701),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x13a)]('cointopay',_0x1b384b(0xfa),'JSON\x20Parse\x20Error:\x20'+_0x1a3701);throw new Error(_0x1b384b(0xee)+_0x3a52aa);}console[_0x1b384b(0x112)](_0x1b384b(0x14e)),console[_0x1b384b(0x112)](_0x1b384b(0x14d),JSON[_0x1b384b(0x14c)](_0x3e5311,null,0x2)),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x103)]('cointopay',_0x1b384b(0xfa),_0xa7e041[_0x1b384b(0x125)],_0x3e5311,_0x1dacc0);if(_0x3e5311[_0x1b384b(0xff)]){const _0x163e59=_0x3e5311[_0x1b384b(0x10e)]||_0x3e5311[_0x1b384b(0xff)]||_0x1b384b(0xfd);console[_0x1b384b(0xff)](_0x1b384b(0x14f)),console[_0x1b384b(0xff)](_0x1b384b(0xe9),_0x163e59),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x13a)]('cointopay',_0x1b384b(0xfa),_0x1b384b(0x153)+_0x163e59);throw new Error(_0x1b384b(0x10c)+_0x163e59);}if(!_0x3e5311['payment_url']||!_0x3e5311[_0x1b384b(0xf2)]){console[_0x1b384b(0xff)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x1b384b(0xff)](_0x1b384b(0x13f)),console[_0x1b384b(0xff)](_0x1b384b(0x11d),_0x3e5311),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x13a)](_0x1b384b(0x161),_0x1b384b(0xfa),_0x1b384b(0x14a));throw new Error(_0x1b384b(0x160));}return console[_0x1b384b(0x112)](_0x1b384b(0x115)),console[_0x1b384b(0x112)](_0x1b384b(0x159),_0x3e5311[_0x1b384b(0xf2)]),console['log'](_0x1b384b(0x12b),_0x3e5311[_0x1b384b(0x15f)]),console['log'](_0x1b384b(0x16a),_0x737e80,_0x1b384b(0xec)),{'gateway_payment_id':_0x3e5311[_0x1b384b(0xf2)],'payment_url':_0x3e5311[_0x1b384b(0x15f)]};}catch(_0x63cb0f){console['error'](_0x1b384b(0x121)),console[_0x1b384b(0xff)](_0x1b384b(0x10d),_0x63cb0f),loggerService_1[_0x1b384b(0x136)][_0x1b384b(0x13a)]('cointopay',_0x1b384b(0xfa),_0x63cb0f);if(_0x63cb0f instanceof Error){console[_0x1b384b(0xff)](_0x1b384b(0x147),_0x63cb0f['message']),console[_0x1b384b(0xff)]('Error\x20stack:',_0x63cb0f[_0x1b384b(0x169)]);throw new Error(_0x1b384b(0x143)+_0x63cb0f[_0x1b384b(0x10e)]);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a43_0x546e85(0xf1)](_0x4f05d7){const _0x1d3bde=a43_0x546e85,_0x4e80f1=Date[_0x1d3bde(0x122)]();try{console[_0x1d3bde(0x112)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x4f05d7);const _0x34bca9={'gatewayPaymentId':_0x4f05d7};loggerService_1[_0x1d3bde(0x136)][_0x1d3bde(0x10f)]('cointopay',_0x1d3bde(0x151),_0x1d3bde(0x13c),_0x34bca9);const _0x5eaf8a=await fetch(this[_0x1d3bde(0x155)],{'method':_0x1d3bde(0x13c),'headers':{'Content-Type':_0x1d3bde(0x15e),'Accept':'application/json','User-Agent':_0x1d3bde(0x131)},'body':JSON[_0x1d3bde(0x14c)](_0x34bca9)}),_0x5cd110=Date[_0x1d3bde(0x122)]()-_0x4e80f1;console[_0x1d3bde(0x112)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x1d3bde(0x112)](_0x1d3bde(0x132),_0x5eaf8a['status']),console[_0x1d3bde(0x112)](_0x1d3bde(0x128),_0x5cd110+'ms');if(!_0x5eaf8a['ok']){const _0x40fa4e=await _0x5eaf8a[_0x1d3bde(0x10b)]();console[_0x1d3bde(0xff)](_0x1d3bde(0xfe),_0x5eaf8a[_0x1d3bde(0x125)]),console[_0x1d3bde(0xff)](_0x1d3bde(0x15d),_0x40fa4e),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x1d3bde(0x161),'/status',_0x5eaf8a[_0x1d3bde(0x125)],_0x40fa4e,_0x5cd110),loggerService_1[_0x1d3bde(0x136)]['logWhiteDomainError']('cointopay',_0x1d3bde(0x151),_0x1d3bde(0x158)+_0x5eaf8a[_0x1d3bde(0x125)]+':\x20'+_0x40fa4e);throw new Error(_0x1d3bde(0x139)+_0x5eaf8a[_0x1d3bde(0x125)]);}const _0x5be19f=await _0x5eaf8a[_0x1d3bde(0x10b)]();console[_0x1d3bde(0x112)](_0x1d3bde(0x13e),_0x5be19f);let _0x467a84;try{_0x467a84=JSON[_0x1d3bde(0x162)](_0x5be19f);}catch(_0x5a6a6d){console['error'](_0x1d3bde(0x123),_0x5a6a6d),loggerService_1['loggerService'][_0x1d3bde(0x13a)](_0x1d3bde(0x161),'/status','JSON\x20Parse\x20Error:\x20'+_0x5a6a6d);throw new Error(_0x1d3bde(0xf0)+_0x5be19f);}loggerService_1['loggerService'][_0x1d3bde(0x103)](_0x1d3bde(0x161),_0x1d3bde(0x151),_0x5eaf8a[_0x1d3bde(0x125)],_0x467a84,_0x5cd110),console[_0x1d3bde(0x112)](_0x1d3bde(0x165)),console['log'](_0x1d3bde(0x110),_0x467a84['result']),console['log'](_0x1d3bde(0x11a),_0x467a84['status_code']),console[_0x1d3bde(0x112)](_0x1d3bde(0x11b),_0x467a84[_0x1d3bde(0x150)]?.[_0x1d3bde(0x166)]),console[_0x1d3bde(0x112)](_0x1d3bde(0x16a),_0x467a84[_0x1d3bde(0x150)]?.[_0x1d3bde(0xf3)]),console[_0x1d3bde(0x112)](_0x1d3bde(0x130),_0x467a84[_0x1d3bde(0x150)]?.[_0x1d3bde(0x167)]);if(_0x467a84[_0x1d3bde(0xe8)]!==_0x1d3bde(0x126)||_0x467a84[_0x1d3bde(0x15a)]!==0xc8){const _0x29bad9=_0x467a84[_0x1d3bde(0x10e)]||_0x1d3bde(0x156);console[_0x1d3bde(0xff)](_0x1d3bde(0x11c)),console[_0x1d3bde(0xff)](_0x1d3bde(0xe9),_0x29bad9),loggerService_1[_0x1d3bde(0x136)][_0x1d3bde(0x13a)](_0x1d3bde(0x161),_0x1d3bde(0x151),_0x1d3bde(0x137)+_0x29bad9);throw new Error(_0x1d3bde(0x145)+_0x29bad9);}if(!_0x467a84['data']){console['error'](_0x1d3bde(0x117)),console[_0x1d3bde(0xff)](_0x1d3bde(0x144)),loggerService_1['loggerService'][_0x1d3bde(0x13a)](_0x1d3bde(0x161),_0x1d3bde(0x151),_0x1d3bde(0x109));throw new Error(_0x1d3bde(0x108));}let _0x14018f=_0x1d3bde(0x102);switch(_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x166)]?.[_0x1d3bde(0x138)]()){case'paid':_0x14018f=_0x1d3bde(0x13d);break;case _0x1d3bde(0x129):case _0x1d3bde(0x157):case _0x1d3bde(0xff):_0x14018f='FAILED';break;case'expired':case'timeout':_0x14018f='EXPIRED';break;case _0x1d3bde(0x164):case _0x1d3bde(0x124):case'pending':case _0x1d3bde(0x12e):default:_0x14018f=_0x1d3bde(0x102);break;}let _0x184ded,_0x43c130;if(_0x467a84['data'][_0x1d3bde(0x11f)]){const _0x563742=_0x467a84['data'][_0x1d3bde(0x11f)];console[_0x1d3bde(0x112)]('🏦\x20Payment\x20Detail:',_0x563742);const _0x347a58=_0x563742[_0x1d3bde(0x11e)](/IBAN\s+([A-Z0-9]+)/i);_0x347a58&&(_0x184ded=_0x347a58[0x1],console['log']('🏦\x20Extracted\x20IBAN:',_0x184ded)),_0x43c130=_0x563742;}const _0x58b8d2={'iban':_0x184ded,'bankDetails':_0x43c130,'transactionId':_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x15b)],'coinAddress':_0x467a84[_0x1d3bde(0x150)]['coinAddress'],'qrCodeUrl':_0x467a84['data'][_0x1d3bde(0x133)],'expiryTime':_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0xed)],'createdOn':_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x13b)],'confirmedOn':_0x467a84[_0x1d3bde(0x150)]['TransactionConfirmedOn']};console['log'](_0x1d3bde(0x101)),console[_0x1d3bde(0x112)](_0x1d3bde(0x132),_0x467a84[_0x1d3bde(0x150)]['Status'],'->',_0x14018f),console[_0x1d3bde(0x112)](_0x1d3bde(0x16a),_0x467a84['data'][_0x1d3bde(0xf3)],_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x167)]),console[_0x1d3bde(0x112)](_0x1d3bde(0xfb),_0x467a84['data']['TransactionID']),console[_0x1d3bde(0x112)](_0x1d3bde(0x119),_0x184ded||_0x1d3bde(0x111)),console[_0x1d3bde(0x112)]('Created\x20On:',_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x13b)]),console[_0x1d3bde(0x112)]('Confirmed\x20On:',_0x467a84['data']['TransactionConfirmedOn']||_0x1d3bde(0x149));if(_0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x166)]?.[_0x1d3bde(0x138)]()===_0x1d3bde(0x124))console[_0x1d3bde(0x112)](_0x1d3bde(0xef));else _0x467a84[_0x1d3bde(0x150)][_0x1d3bde(0x166)]?.[_0x1d3bde(0x138)]()===_0x1d3bde(0xf8)&&console[_0x1d3bde(0x112)](_0x1d3bde(0x107));return{'status':_0x14018f,'amount':parseFloat(_0x467a84[_0x1d3bde(0x150)]['Amount'])||undefined,'currency':_0x467a84[_0x1d3bde(0x150)]['inputCurrency']||'EUR','paymentDetails':_0x58b8d2};}catch(_0x229eb2){console[_0x1d3bde(0xff)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x229eb2),loggerService_1[_0x1d3bde(0x136)]['logWhiteDomainError'](_0x1d3bde(0x161),_0x1d3bde(0x151),_0x229eb2);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x229eb2 instanceof Error?_0x229eb2[_0x1d3bde(0x10e)]:_0x1d3bde(0xf7)));}}async['verifyPayment'](_0x447d54){const _0x2f3c09=a43_0x546e85,_0x4e812d=await this[_0x2f3c09(0xf1)](_0x447d54);return{'status':_0x4e812d[_0x2f3c09(0x125)],'amount':_0x4e812d[_0x2f3c09(0xf4)],'currency':_0x4e812d[_0x2f3c09(0x12c)]};}async['processWebhook'](_0x23367e){const _0x9cd689=a43_0x546e85;console[_0x9cd689(0x112)](_0x9cd689(0x105),_0x23367e);let _0x448c37=_0x9cd689(0x102);switch(_0x23367e['status']?.[_0x9cd689(0x138)]()){case _0x9cd689(0xf8):_0x448c37=_0x9cd689(0x13d);break;case _0x9cd689(0x129):case _0x9cd689(0x157):case'error':_0x448c37=_0x9cd689(0xf5);break;case _0x9cd689(0xeb):case'timeout':_0x448c37='EXPIRED';break;case _0x9cd689(0x15c):case _0x9cd689(0x164):case _0x9cd689(0x124):case _0x9cd689(0x12e):default:_0x448c37='PENDING';break;}return{'paymentId':_0x23367e['order_id']||_0x23367e[_0x9cd689(0x116)]||'','status':_0x448c37,'amount':_0x23367e[_0x9cd689(0xf4)],'currency':_0x23367e[_0x9cd689(0x12c)]||_0x9cd689(0xec)};}}exports[a43_0x546e85(0x12f)]=CoinToPayService;