'use strict';const a55_0x143314=a55_0x54bc;(function(_0x504bbe,_0x17ad06){const _0x99398e=a55_0x54bc,_0x3e4846=_0x504bbe();while(!![]){try{const _0x32f235=parseInt(_0x99398e(0x242))/0x1+parseInt(_0x99398e(0x251))/0x2*(-parseInt(_0x99398e(0x1fe))/0x3)+-parseInt(_0x99398e(0x235))/0x4+-parseInt(_0x99398e(0x244))/0x5+parseInt(_0x99398e(0x1fa))/0x6*(parseInt(_0x99398e(0x219))/0x7)+parseInt(_0x99398e(0x222))/0x8+-parseInt(_0x99398e(0x25f))/0x9*(parseInt(_0x99398e(0x241))/0xa);if(_0x32f235===_0x17ad06)break;else _0x3e4846['push'](_0x3e4846['shift']());}catch(_0x37b6d2){_0x3e4846['push'](_0x3e4846['shift']());}}}(a55_0x1483,0x8528c));Object[a55_0x143314(0x201)](exports,a55_0x143314(0x234),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a55_0x143314(0x24d));class CoinToPayService{constructor(){const _0x572480=a55_0x143314;this[_0x572480(0x265)]='https://tesoft.uk/gateway/cointopay/',this[_0x572480(0x20d)]=_0x572480(0x24a),console[_0x572480(0x24b)]('ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x572480(0x24b)](_0x572480(0x1fd),this[_0x572480(0x20d)]);}async['createPaymentLink'](_0x27e32b){const _0x1002df=a55_0x143314,{orderId:_0xeb2420,amount:_0x1e316c}=_0x27e32b;console[_0x1002df(0x24b)](_0x1002df(0x236)+_0x1e316c+_0x1002df(0x207));const _0x2c0052={'amount':_0x1e316c},_0x3c4f7d=Date['now']();try{console['log'](_0x1002df(0x247)),console[_0x1002df(0x24b)]('URL:',this[_0x1002df(0x265)]),console['log'](_0x1002df(0x226),JSON[_0x1002df(0x22f)](_0x2c0052,null,0x2)),console[_0x1002df(0x24b)](_0x1002df(0x25c),_0x1e316c,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x1002df(0x26e)][_0x1002df(0x223)](_0x1002df(0x1ee),_0x1002df(0x210),_0x1002df(0x212),_0x2c0052);const _0x530aa0=await fetch(this['apiUrl'],{'method':_0x1002df(0x212),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0x1002df(0x206)},'body':JSON['stringify'](_0x2c0052)}),_0x3e01ea=Date[_0x1002df(0x23e)]()-_0x3c4f7d;console[_0x1002df(0x24b)](_0x1002df(0x246)),console['log']('Status:',_0x530aa0['status']),console[_0x1002df(0x24b)](_0x1002df(0x255),_0x530aa0[_0x1002df(0x266)]),console[_0x1002df(0x24b)](_0x1002df(0x213),Object['fromEntries'](_0x530aa0[_0x1002df(0x26b)][_0x1002df(0x1fc)]())),console[_0x1002df(0x24b)](_0x1002df(0x20b),_0x3e01ea+'ms');const _0x22f1ae=await _0x530aa0[_0x1002df(0x269)]();console[_0x1002df(0x24b)](_0x1002df(0x26f),_0x22f1ae);if(!_0x530aa0['ok']){console[_0x1002df(0x1ed)](_0x1002df(0x225)),console[_0x1002df(0x1ed)](_0x1002df(0x204),_0x530aa0[_0x1002df(0x23b)]),console[_0x1002df(0x1ed)](_0x1002df(0x249),_0x22f1ae),loggerService_1[_0x1002df(0x26e)][_0x1002df(0x22b)](_0x1002df(0x1ee),_0x1002df(0x210),_0x530aa0[_0x1002df(0x23b)],_0x22f1ae,_0x3e01ea),loggerService_1[_0x1002df(0x26e)]['logWhiteDomainError'](_0x1002df(0x1ee),_0x1002df(0x210),_0x1002df(0x262)+_0x530aa0[_0x1002df(0x23b)]+':\x20'+_0x22f1ae);throw new Error(_0x1002df(0x1ff)+_0x530aa0[_0x1002df(0x23b)]+_0x1002df(0x1e9)+_0x22f1ae);}let _0x2b71b7;try{_0x2b71b7=JSON['parse'](_0x22f1ae);}catch(_0x59bcd6){console[_0x1002df(0x1ed)](_0x1002df(0x1f0),_0x59bcd6),loggerService_1[_0x1002df(0x26e)][_0x1002df(0x23a)]('cointopay',_0x1002df(0x210),_0x1002df(0x214)+_0x59bcd6);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20'+_0x22f1ae);}console[_0x1002df(0x24b)](_0x1002df(0x25e)),console[_0x1002df(0x24b)](_0x1002df(0x24c),JSON[_0x1002df(0x22f)](_0x2b71b7,null,0x2)),loggerService_1[_0x1002df(0x26e)]['logWhiteDomainResponse'](_0x1002df(0x1ee),_0x1002df(0x210),_0x530aa0[_0x1002df(0x23b)],_0x2b71b7,_0x3e01ea);if(_0x2b71b7[_0x1002df(0x1ed)]){const _0x25b76c=_0x2b71b7[_0x1002df(0x264)]||_0x2b71b7[_0x1002df(0x1ed)]||_0x1002df(0x228);console[_0x1002df(0x1ed)](_0x1002df(0x1f9)),console[_0x1002df(0x1ed)](_0x1002df(0x23d),_0x25b76c),loggerService_1['loggerService']['logWhiteDomainError'](_0x1002df(0x1ee),'/create','Business\x20Error:\x20'+_0x25b76c);throw new Error(_0x1002df(0x232)+_0x25b76c);}if(!_0x2b71b7['payment_url']||!_0x2b71b7[_0x1002df(0x1ec)]){console[_0x1002df(0x1ed)](_0x1002df(0x227)),console[_0x1002df(0x1ed)](_0x1002df(0x248)),console[_0x1002df(0x1ed)](_0x1002df(0x208),_0x2b71b7),loggerService_1['loggerService'][_0x1002df(0x23a)](_0x1002df(0x1ee),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x1002df(0x217));}console[_0x1002df(0x24b)](_0x1002df(0x25d)),console[_0x1002df(0x24b)](_0x1002df(0x221),_0x2b71b7[_0x1002df(0x1ec)]),console[_0x1002df(0x24b)](_0x1002df(0x263),_0x2b71b7[_0x1002df(0x243)]);const _0x4468e5=_0x2b71b7[_0x1002df(0x243)]+_0x1002df(0x20a);return console[_0x1002df(0x24b)](_0x1002df(0x254),_0x4468e5),console[_0x1002df(0x24b)](_0x1002df(0x25c),_0x1e316c,'EUR'),{'gateway_payment_id':_0x2b71b7[_0x1002df(0x1ec)],'payment_url':_0x4468e5};}catch(_0xcf543b){console[_0x1002df(0x1ed)](_0x1002df(0x21c)),console[_0x1002df(0x1ed)](_0x1002df(0x1f6),_0xcf543b),loggerService_1[_0x1002df(0x26e)]['logWhiteDomainError'](_0x1002df(0x1ee),_0x1002df(0x210),_0xcf543b);if(_0xcf543b instanceof Error){console[_0x1002df(0x1ed)]('Error\x20message:',_0xcf543b[_0x1002df(0x264)]),console['error'](_0x1002df(0x1fb),_0xcf543b[_0x1002df(0x1f7)]);throw new Error(_0x1002df(0x215)+_0xcf543b[_0x1002df(0x264)]);}throw new Error(_0x1002df(0x224));}}async[a55_0x143314(0x252)](_0x4870b0){const _0x28777b=a55_0x143314,_0x396240=Date[_0x28777b(0x23e)]();try{console['log'](_0x28777b(0x1f5)+_0x4870b0);const _0x1de224={'gatewayPaymentId':_0x4870b0};loggerService_1[_0x28777b(0x26e)][_0x28777b(0x223)](_0x28777b(0x1ee),_0x28777b(0x22c),_0x28777b(0x212),_0x1de224);const _0xe45639=await fetch(this[_0x28777b(0x20d)],{'method':'POST','headers':{'Content-Type':_0x28777b(0x23c),'Accept':'application/json','User-Agent':_0x28777b(0x206)},'body':JSON[_0x28777b(0x22f)](_0x1de224)}),_0x4215a5=Date[_0x28777b(0x23e)]()-_0x396240;console[_0x28777b(0x24b)](_0x28777b(0x24e)),console[_0x28777b(0x24b)](_0x28777b(0x230),_0xe45639[_0x28777b(0x23b)]),console[_0x28777b(0x24b)](_0x28777b(0x20b),_0x4215a5+'ms');if(!_0xe45639['ok']){const _0x33ae96=await _0xe45639[_0x28777b(0x269)]();console[_0x28777b(0x1ed)](_0x28777b(0x204),_0xe45639[_0x28777b(0x23b)]),console[_0x28777b(0x1ed)](_0x28777b(0x249),_0x33ae96),loggerService_1[_0x28777b(0x26e)]['logWhiteDomainResponse']('cointopay',_0x28777b(0x22c),_0xe45639['status'],_0x33ae96,_0x4215a5),loggerService_1[_0x28777b(0x26e)]['logWhiteDomainError'](_0x28777b(0x1ee),'/status',_0x28777b(0x262)+_0xe45639[_0x28777b(0x23b)]+':\x20'+_0x33ae96);throw new Error(_0x28777b(0x1ff)+_0xe45639[_0x28777b(0x23b)]);}const _0x1add9c=await _0xe45639[_0x28777b(0x269)]();console[_0x28777b(0x24b)](_0x28777b(0x26f),_0x1add9c);let _0x2f66ce;try{_0x2f66ce=JSON['parse'](_0x1add9c);}catch(_0x3759b9){console['error'](_0x28777b(0x1f0),_0x3759b9),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x28777b(0x22c),_0x28777b(0x214)+_0x3759b9);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x1add9c);}loggerService_1[_0x28777b(0x26e)][_0x28777b(0x22b)](_0x28777b(0x1ee),_0x28777b(0x22c),_0xe45639[_0x28777b(0x23b)],_0x2f66ce,_0x4215a5),console[_0x28777b(0x24b)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x28777b(0x24b)](_0x28777b(0x259),_0x2f66ce[_0x28777b(0x21b)]),console[_0x28777b(0x24b)](_0x28777b(0x267),_0x2f66ce[_0x28777b(0x211)]),console[_0x28777b(0x24b)](_0x28777b(0x240),_0x2f66ce[_0x28777b(0x205)]?.[_0x28777b(0x238)]),console[_0x28777b(0x24b)](_0x28777b(0x25c),_0x2f66ce[_0x28777b(0x205)]?.[_0x28777b(0x237)]),console['log'](_0x28777b(0x203),_0x2f66ce[_0x28777b(0x205)]?.[_0x28777b(0x257)]);if(_0x2f66ce['result']!==_0x28777b(0x25b)||_0x2f66ce[_0x28777b(0x211)]!==0xc8){const _0x1c1c70=_0x2f66ce['message']||_0x28777b(0x20f);console[_0x28777b(0x1ed)](_0x28777b(0x200)),console['error'](_0x28777b(0x23d),_0x1c1c70),loggerService_1[_0x28777b(0x26e)][_0x28777b(0x23a)](_0x28777b(0x1ee),'/status',_0x28777b(0x20e)+_0x1c1c70);throw new Error(_0x28777b(0x253)+_0x1c1c70);}if(!_0x2f66ce[_0x28777b(0x205)]){console[_0x28777b(0x1ed)](_0x28777b(0x22e)),console[_0x28777b(0x1ed)](_0x28777b(0x1f4)),loggerService_1['loggerService'][_0x28777b(0x23a)]('cointopay',_0x28777b(0x22c),_0x28777b(0x24f));throw new Error(_0x28777b(0x22a));}let _0x156ffc=_0x28777b(0x1eb);switch(_0x2f66ce[_0x28777b(0x205)]['Status']?.['toLowerCase']()){case _0x28777b(0x209):_0x156ffc=_0x28777b(0x1ea);break;case _0x28777b(0x229):case'failed':case _0x28777b(0x1ed):_0x156ffc=_0x28777b(0x22d);break;case _0x28777b(0x26c):case _0x28777b(0x23f):_0x156ffc=_0x28777b(0x1f1);break;case _0x28777b(0x20c):case _0x28777b(0x260):case _0x28777b(0x1f3):case _0x28777b(0x26d):default:_0x156ffc='PENDING';break;}let _0x76e4d4,_0x27b928;if(_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x218)]){const _0x23c802=_0x2f66ce['data'][_0x28777b(0x218)];console[_0x28777b(0x24b)]('üè¶\x20Payment\x20Detail:',_0x23c802);const _0x6d8e1=_0x23c802[_0x28777b(0x233)](/IBAN\s+([A-Z0-9]+)/i);_0x6d8e1&&(_0x76e4d4=_0x6d8e1[0x1],console['log'](_0x28777b(0x239),_0x76e4d4)),_0x27b928=_0x23c802;}const _0x126f51={'iban':_0x76e4d4,'bankDetails':_0x27b928,'transactionId':_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x258)],'coinAddress':_0x2f66ce[_0x28777b(0x205)]['coinAddress'],'qrCodeUrl':_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x268)],'expiryTime':_0x2f66ce[_0x28777b(0x205)]['ExpiryTime'],'createdOn':_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x1f8)],'confirmedOn':_0x2f66ce['data'][_0x28777b(0x21e)]};console[_0x28777b(0x24b)](_0x28777b(0x1ef)),console['log'](_0x28777b(0x230),_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x238)],'->',_0x156ffc),console['log'](_0x28777b(0x25c),_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x237)],_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x257)]),console[_0x28777b(0x24b)](_0x28777b(0x1f2),_0x2f66ce['data'][_0x28777b(0x258)]),console[_0x28777b(0x24b)]('IBAN:',_0x76e4d4||_0x28777b(0x245)),console[_0x28777b(0x24b)](_0x28777b(0x21f),_0x2f66ce['data'][_0x28777b(0x1f8)]),console[_0x28777b(0x24b)]('Confirmed\x20On:',_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x21e)]||_0x28777b(0x26a));if(_0x2f66ce[_0x28777b(0x205)]['Status']?.[_0x28777b(0x220)]()===_0x28777b(0x260))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x2f66ce[_0x28777b(0x205)][_0x28777b(0x238)]?.[_0x28777b(0x220)]()===_0x28777b(0x209)&&console[_0x28777b(0x24b)](_0x28777b(0x261));return{'status':_0x156ffc,'amount':parseFloat(_0x2f66ce['data'][_0x28777b(0x237)])||undefined,'currency':_0x2f66ce[_0x28777b(0x205)][_0x28777b(0x257)]||'EUR','paymentDetails':_0x126f51};}catch(_0x4bff85){console[_0x28777b(0x1ed)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4bff85),loggerService_1[_0x28777b(0x26e)][_0x28777b(0x23a)](_0x28777b(0x1ee),'/status',_0x4bff85);throw new Error(_0x28777b(0x21d)+(_0x4bff85 instanceof Error?_0x4bff85[_0x28777b(0x264)]:'Unknown\x20error'));}}async['verifyPayment'](_0x14e7c1){const _0x42141e=a55_0x143314,_0x34f6ed=await this[_0x42141e(0x252)](_0x14e7c1);return{'status':_0x34f6ed[_0x42141e(0x23b)],'amount':_0x34f6ed[_0x42141e(0x202)],'currency':_0x34f6ed['currency']};}async[a55_0x143314(0x25a)](_0x58ef92){const _0x564375=a55_0x143314;console[_0x564375(0x24b)](_0x564375(0x256),_0x58ef92);let _0x1cde8c=_0x564375(0x1eb);switch(_0x58ef92[_0x564375(0x23b)]?.['toLowerCase']()){case _0x564375(0x209):_0x1cde8c=_0x564375(0x1ea);break;case _0x564375(0x229):case _0x564375(0x231):case _0x564375(0x1ed):_0x1cde8c=_0x564375(0x22d);break;case _0x564375(0x26c):case _0x564375(0x23f):_0x1cde8c='EXPIRED';break;case _0x564375(0x1f3):case _0x564375(0x20c):case _0x564375(0x260):case'created':default:_0x1cde8c=_0x564375(0x1eb);break;}return{'paymentId':_0x58ef92[_0x564375(0x21a)]||_0x58ef92[_0x564375(0x216)]||'','status':_0x1cde8c,'amount':_0x58ef92['amount'],'currency':_0x58ef92['currency']||_0x564375(0x250)};}}function a55_0x54bc(_0xb317de,_0x40c0c1){_0xb317de=_0xb317de-0x1e9;const _0x148368=a55_0x1483();let _0x54bc1f=_0x148368[_0xb317de];return _0x54bc1f;}function a55_0x1483(){const _0x5c7489=['===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','stringify','Status:','failed','CoinToPay\x20API\x20error:\x20','match','__esModule','402440pscHIB','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Amount','Status','üè¶\x20Extracted\x20IBAN:','logWhiteDomainError','status','application/json','Error\x20Message:','now','timeout','Payment\x20Status:','91010koKxXY','1078308eEsTNS','payment_url','3586105aXBARR','not\x20found','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Response\x20Body:','https://tesoft.uk/gateway/cointopay/status.php','log','Parsed\x20Result:','../loggerService','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Incomplete\x20response:\x20missing\x20data','EUR','14HDanJy','checkPaymentStatus','CoinToPay\x20status\x20API\x20error:\x20','Payment\x20URL\x20(modified):','Status\x20Text:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','inputCurrency','TransactionID','Result:','processWebhook','success','Amount:','===\x20COINTOPAY\x20SUCCESS\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','549nLmSDS','awaiting\x20fiat','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','HTTP\x20','Payment\x20URL\x20(original):','message','apiUrl','statusText','Status\x20Code:','QRCodeURL','text','not\x20confirmed','headers','expired','created','loggerService','Raw\x20Response\x20Body:',',\x20body:\x20','PAID','PENDING','gateway_payment_id','error','cointopay','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','Transaction\x20ID:','pending','Missing\x20data\x20in\x20response','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Error\x20details:','stack','CreatedOn','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','4080918RNduMk','Error\x20stack:','entries','üìä\x20Status\x20check\x20URL:','64815xIluOo','HTTP\x20error!\x20status:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','defineProperty','amount','Currency:','HTTP\x20Status:','data','Payment\x20System/1.0','\x20EUR','Response\x20data:','paid','&alternative=false','Response\x20Time:','waiting','statusUrl','Status\x20API\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','/create','status_code','POST','Headers:','JSON\x20Parse\x20Error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','merchant_reference_id','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PaymentDetail','7iUfFgb','order_id','result','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TransactionConfirmedOn','Created\x20On:','toLowerCase','Gateway\x20Payment\x20ID:','2489488aBzFai','logWhiteDomainRequest','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','===\x20COINTOPAY\x20API\x20ERROR\x20===','Request\x20Body:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','logWhiteDomainResponse','/status','FAILED'];a55_0x1483=function(){return _0x5c7489;};return a55_0x1483();}exports['CoinToPayService']=CoinToPayService;