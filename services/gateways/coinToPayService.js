'use strict';const a44_0x1e9f6d=a44_0x139a;(function(_0x51cdff,_0x572800){const _0x4d6397=a44_0x139a,_0x1601e5=_0x51cdff();while(!![]){try{const _0x1becc5=parseInt(_0x4d6397(0x1ab))/0x1*(parseInt(_0x4d6397(0x1e2))/0x2)+parseInt(_0x4d6397(0x18b))/0x3+parseInt(_0x4d6397(0x19c))/0x4+-parseInt(_0x4d6397(0x1e9))/0x5*(-parseInt(_0x4d6397(0x1d7))/0x6)+-parseInt(_0x4d6397(0x1e1))/0x7+parseInt(_0x4d6397(0x1c7))/0x8*(-parseInt(_0x4d6397(0x195))/0x9)+-parseInt(_0x4d6397(0x198))/0xa;if(_0x1becc5===_0x572800)break;else _0x1601e5['push'](_0x1601e5['shift']());}catch(_0x365039){_0x1601e5['push'](_0x1601e5['shift']());}}}(a44_0x247d,0xb01ec));Object['defineProperty'](exports,a44_0x1e9f6d(0x1d5),{'value':!![]}),exports[a44_0x1e9f6d(0x1c0)]=void 0x0;const loggerService_1=require(a44_0x1e9f6d(0x1a9));class CoinToPayService{constructor(){const _0x26d4e0=a44_0x1e9f6d;this[_0x26d4e0(0x1f1)]=_0x26d4e0(0x1e3),this[_0x26d4e0(0x1bd)]=_0x26d4e0(0x1d2),console['log'](_0x26d4e0(0x1b7)),console[_0x26d4e0(0x1f7)](_0x26d4e0(0x1c4),this[_0x26d4e0(0x1bd)]);}async[a44_0x1e9f6d(0x1ec)](_0x2350e1){const _0x244f57=a44_0x1e9f6d,{orderId:_0x6ea1c2,amount:_0x2fd347}=_0x2350e1;console[_0x244f57(0x1f7)](_0x244f57(0x203)+_0x2fd347+_0x244f57(0x1d3));const _0x76209e={'amount':_0x2fd347},_0x4e1589=Date[_0x244f57(0x1be)]();try{console[_0x244f57(0x1f7)](_0x244f57(0x1bc)),console[_0x244f57(0x1f7)](_0x244f57(0x1fc),this[_0x244f57(0x1f1)]),console[_0x244f57(0x1f7)](_0x244f57(0x1d4),JSON['stringify'](_0x76209e,null,0x2)),console[_0x244f57(0x1f7)]('Amount:',_0x2fd347,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1[_0x244f57(0x1b5)][_0x244f57(0x1a5)]('cointopay',_0x244f57(0x1ed),_0x244f57(0x190),_0x76209e);const _0x17913b=await fetch(this['apiUrl'],{'method':_0x244f57(0x190),'headers':{'Content-Type':'application/json','Accept':_0x244f57(0x209),'User-Agent':_0x244f57(0x19b)},'body':JSON[_0x244f57(0x1cf)](_0x76209e)}),_0x54a26f=Date[_0x244f57(0x1be)]()-_0x4e1589;console[_0x244f57(0x1f7)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x244f57(0x1f7)](_0x244f57(0x1ca),_0x17913b['status']),console[_0x244f57(0x1f7)]('Status\x20Text:',_0x17913b[_0x244f57(0x193)]),console['log'](_0x244f57(0x1b1),Object[_0x244f57(0x20e)](_0x17913b['headers'][_0x244f57(0x18e)]())),console[_0x244f57(0x1f7)]('Response\x20Time:',_0x54a26f+'ms');const _0x46a40d=await _0x17913b[_0x244f57(0x1b9)]();console[_0x244f57(0x1f7)](_0x244f57(0x1a3),_0x46a40d);if(!_0x17913b['ok']){console[_0x244f57(0x189)](_0x244f57(0x1f3)),console[_0x244f57(0x189)](_0x244f57(0x1bf),_0x17913b[_0x244f57(0x1d1)]),console[_0x244f57(0x189)](_0x244f57(0x18f),_0x46a40d),loggerService_1[_0x244f57(0x1b5)][_0x244f57(0x1a1)]('cointopay',_0x244f57(0x1ed),_0x17913b[_0x244f57(0x1d1)],_0x46a40d,_0x54a26f),loggerService_1['loggerService'][_0x244f57(0x206)]('cointopay','/create',_0x244f57(0x191)+_0x17913b[_0x244f57(0x1d1)]+':\x20'+_0x46a40d);throw new Error(_0x244f57(0x192)+_0x17913b['status']+_0x244f57(0x197)+_0x46a40d);}let _0x2c4d74;try{_0x2c4d74=JSON['parse'](_0x46a40d);}catch(_0x355c6a){console['error'](_0x244f57(0x1eb),_0x355c6a),loggerService_1[_0x244f57(0x1b5)][_0x244f57(0x206)]('cointopay',_0x244f57(0x1ed),_0x244f57(0x18c)+_0x355c6a);throw new Error(_0x244f57(0x1a6)+_0x46a40d);}console[_0x244f57(0x1f7)](_0x244f57(0x1cd)),console['log'](_0x244f57(0x1f9),JSON['stringify'](_0x2c4d74,null,0x2)),loggerService_1['loggerService'][_0x244f57(0x1a1)]('cointopay',_0x244f57(0x1ed),_0x17913b['status'],_0x2c4d74,_0x54a26f);if(_0x2c4d74['error']){const _0x521fcf=_0x2c4d74[_0x244f57(0x1db)]||_0x2c4d74[_0x244f57(0x189)]||_0x244f57(0x1f2);console['error'](_0x244f57(0x208)),console[_0x244f57(0x189)]('Error\x20Message:',_0x521fcf),loggerService_1[_0x244f57(0x1b5)][_0x244f57(0x206)](_0x244f57(0x20d),_0x244f57(0x1ed),_0x244f57(0x1dd)+_0x521fcf);throw new Error(_0x244f57(0x199)+_0x521fcf);}if(!_0x2c4d74['payment_url']||!_0x2c4d74[_0x244f57(0x1a0)]){console[_0x244f57(0x189)](_0x244f57(0x1b8)),console['error'](_0x244f57(0x1ef)),console[_0x244f57(0x189)](_0x244f57(0x19e),_0x2c4d74),loggerService_1[_0x244f57(0x1b5)]['logWhiteDomainError'](_0x244f57(0x20d),_0x244f57(0x1ed),_0x244f57(0x1c5));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x244f57(0x1f7)](_0x244f57(0x19a)),console[_0x244f57(0x1f7)]('Gateway\x20Payment\x20ID:',_0x2c4d74[_0x244f57(0x1a0)]),console[_0x244f57(0x1f7)](_0x244f57(0x1a8),_0x2c4d74[_0x244f57(0x1ad)]),console['log'](_0x244f57(0x1b6),_0x2fd347,_0x244f57(0x1d0)),{'gateway_payment_id':_0x2c4d74[_0x244f57(0x1a0)],'payment_url':_0x2c4d74[_0x244f57(0x1ad)]};}catch(_0x29e919){console[_0x244f57(0x189)](_0x244f57(0x1af)),console[_0x244f57(0x189)](_0x244f57(0x1ba),_0x29e919),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x244f57(0x1ed),_0x29e919);if(_0x29e919 instanceof Error){console[_0x244f57(0x189)](_0x244f57(0x1dc),_0x29e919[_0x244f57(0x1db)]),console[_0x244f57(0x189)](_0x244f57(0x1e4),_0x29e919[_0x244f57(0x1fd)]);throw new Error(_0x244f57(0x1fe)+_0x29e919['message']);}throw new Error(_0x244f57(0x202));}}async[a44_0x1e9f6d(0x200)](_0x43d21a){const _0x20b718=a44_0x1e9f6d,_0x2a4728=Date['now']();try{console['log']('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x43d21a);const _0x1f1630={'gatewayPaymentId':_0x43d21a};loggerService_1[_0x20b718(0x1b5)][_0x20b718(0x1a5)](_0x20b718(0x20d),_0x20b718(0x1b4),_0x20b718(0x190),_0x1f1630);const _0x7b2e35=await fetch(this['statusUrl'],{'method':'POST','headers':{'Content-Type':_0x20b718(0x209),'Accept':'application/json','User-Agent':_0x20b718(0x19b)},'body':JSON[_0x20b718(0x1cf)](_0x1f1630)}),_0x2f110f=Date[_0x20b718(0x1be)]()-_0x2a4728;console[_0x20b718(0x1f7)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console['log'](_0x20b718(0x1ca),_0x7b2e35[_0x20b718(0x1d1)]),console[_0x20b718(0x1f7)](_0x20b718(0x1d8),_0x2f110f+'ms');if(!_0x7b2e35['ok']){const _0x5aae30=await _0x7b2e35['text']();console[_0x20b718(0x189)]('HTTP\x20Status:',_0x7b2e35[_0x20b718(0x1d1)]),console[_0x20b718(0x189)]('Response\x20Body:',_0x5aae30),loggerService_1[_0x20b718(0x1b5)][_0x20b718(0x1a1)]('cointopay',_0x20b718(0x1b4),_0x7b2e35[_0x20b718(0x1d1)],_0x5aae30,_0x2f110f),loggerService_1[_0x20b718(0x1b5)][_0x20b718(0x206)](_0x20b718(0x20d),_0x20b718(0x1b4),_0x20b718(0x191)+_0x7b2e35[_0x20b718(0x1d1)]+':\x20'+_0x5aae30);throw new Error(_0x20b718(0x192)+_0x7b2e35[_0x20b718(0x1d1)]);}const _0x1289e9=await _0x7b2e35[_0x20b718(0x1b9)]();console[_0x20b718(0x1f7)](_0x20b718(0x1a3),_0x1289e9);let _0xfe4524;try{_0xfe4524=JSON['parse'](_0x1289e9);}catch(_0x1104cb){console[_0x20b718(0x189)](_0x20b718(0x1eb),_0x1104cb),loggerService_1['loggerService'][_0x20b718(0x206)](_0x20b718(0x20d),_0x20b718(0x1b4),_0x20b718(0x18c)+_0x1104cb);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x1289e9);}loggerService_1[_0x20b718(0x1b5)][_0x20b718(0x1a1)](_0x20b718(0x20d),_0x20b718(0x1b4),_0x7b2e35[_0x20b718(0x1d1)],_0xfe4524,_0x2f110f),console[_0x20b718(0x1f7)](_0x20b718(0x1aa)),console[_0x20b718(0x1f7)]('Result:',_0xfe4524[_0x20b718(0x1b2)]),console[_0x20b718(0x1f7)](_0x20b718(0x1ae),_0xfe4524[_0x20b718(0x19f)]),console['log']('Payment\x20Status:',_0xfe4524[_0x20b718(0x1e7)]?.[_0x20b718(0x196)]),console[_0x20b718(0x1f7)](_0x20b718(0x1b6),_0xfe4524[_0x20b718(0x1e7)]?.[_0x20b718(0x1b3)]),console[_0x20b718(0x1f7)](_0x20b718(0x1c1),_0xfe4524[_0x20b718(0x1e7)]?.['inputCurrency']);if(_0xfe4524['result']!=='success'||_0xfe4524[_0x20b718(0x19f)]!==0xc8){const _0x482a13=_0xfe4524[_0x20b718(0x1db)]||_0x20b718(0x1e6);console[_0x20b718(0x189)](_0x20b718(0x20a)),console[_0x20b718(0x189)](_0x20b718(0x1ee),_0x482a13),loggerService_1[_0x20b718(0x1b5)]['logWhiteDomainError']('cointopay','/status',_0x20b718(0x1c3)+_0x482a13);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x482a13);}if(!_0xfe4524['data']){console[_0x20b718(0x189)](_0x20b718(0x1cc)),console['error'](_0x20b718(0x1f8)),loggerService_1['loggerService']['logWhiteDomainError'](_0x20b718(0x20d),'/status',_0x20b718(0x1ff));throw new Error(_0x20b718(0x1c6));}let _0x273076=_0x20b718(0x188);switch(_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x196)]?.[_0x20b718(0x1a2)]()){case _0x20b718(0x1f5):_0x273076=_0x20b718(0x1a7);break;case'cancelled':case _0x20b718(0x1b0):case _0x20b718(0x189):_0x273076=_0x20b718(0x1cb);break;case _0x20b718(0x20b):case _0x20b718(0x1f0):_0x273076=_0x20b718(0x1de);break;case _0x20b718(0x1df):case _0x20b718(0x18d):case _0x20b718(0x1c2):case _0x20b718(0x1da):default:_0x273076=_0x20b718(0x188);break;}let _0x31e95d,_0x26f2b2;if(_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1f6)]){const _0x299bed=_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1f6)];console['log'](_0x20b718(0x20c),_0x299bed);const _0x241131=_0x299bed['match'](/IBAN\s+([A-Z0-9]+)/i);_0x241131&&(_0x31e95d=_0x241131[0x1],console['log'](_0x20b718(0x1a4),_0x31e95d)),_0x26f2b2=_0x299bed;}const _0x2b72a3={'iban':_0x31e95d,'bankDetails':_0x26f2b2,'transactionId':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1e0)],'coinAddress':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x18a)],'qrCodeUrl':_0xfe4524['data'][_0x20b718(0x205)],'expiryTime':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1d6)],'createdOn':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1e5)],'confirmedOn':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1c8)]};console[_0x20b718(0x1f7)](_0x20b718(0x1ac)),console['log'](_0x20b718(0x1ca),_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x196)],'->',_0x273076),console[_0x20b718(0x1f7)](_0x20b718(0x1b6),_0xfe4524['data'][_0x20b718(0x1b3)],_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1d9)]),console[_0x20b718(0x1f7)]('Transaction\x20ID:',_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1e0)]),console[_0x20b718(0x1f7)]('IBAN:',_0x31e95d||_0x20b718(0x207)),console['log'](_0x20b718(0x194),_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1e5)]),console[_0x20b718(0x1f7)]('Confirmed\x20On:',_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1c8)]||_0x20b718(0x1c9));if(_0xfe4524['data']['Status']?.[_0x20b718(0x1a2)]()==='awaiting\x20fiat')console['log'](_0x20b718(0x1ea));else _0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x196)]?.[_0x20b718(0x1a2)]()===_0x20b718(0x1f5)&&console[_0x20b718(0x1f7)](_0x20b718(0x1f4));return{'status':_0x273076,'amount':parseFloat(_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1b3)])||undefined,'currency':_0xfe4524[_0x20b718(0x1e7)][_0x20b718(0x1d9)]||'EUR','paymentDetails':_0x2b72a3};}catch(_0x4b3455){console['error'](_0x20b718(0x19d),_0x4b3455),loggerService_1[_0x20b718(0x1b5)][_0x20b718(0x206)](_0x20b718(0x20d),_0x20b718(0x1b4),_0x4b3455);throw new Error(_0x20b718(0x1bb)+(_0x4b3455 instanceof Error?_0x4b3455[_0x20b718(0x1db)]:_0x20b718(0x1fa)));}}async[a44_0x1e9f6d(0x1fb)](_0x4aff99){const _0x5e6d63=a44_0x1e9f6d,_0xa6f0e3=await this['checkPaymentStatus'](_0x4aff99);return{'status':_0xa6f0e3[_0x5e6d63(0x1d1)],'amount':_0xa6f0e3[_0x5e6d63(0x201)],'currency':_0xa6f0e3[_0x5e6d63(0x1e8)]};}async['processWebhook'](_0x454439){const _0x370d10=a44_0x1e9f6d;console[_0x370d10(0x1f7)](_0x370d10(0x1ce),_0x454439);let _0x18208e=_0x370d10(0x188);switch(_0x454439[_0x370d10(0x1d1)]?.[_0x370d10(0x1a2)]()){case _0x370d10(0x1f5):_0x18208e=_0x370d10(0x1a7);break;case'cancelled':case _0x370d10(0x1b0):case _0x370d10(0x189):_0x18208e=_0x370d10(0x1cb);break;case _0x370d10(0x20b):case _0x370d10(0x1f0):_0x18208e='EXPIRED';break;case _0x370d10(0x1c2):case'waiting':case _0x370d10(0x18d):case _0x370d10(0x1da):default:_0x18208e=_0x370d10(0x188);break;}return{'paymentId':_0x454439[_0x370d10(0x204)]||_0x454439['merchant_reference_id']||'','status':_0x18208e,'amount':_0x454439['amount'],'currency':_0x454439['currency']||_0x370d10(0x1d0)};}}function a44_0x139a(_0x8a9ed1,_0xd8a919){const _0x247da0=a44_0x247d();return a44_0x139a=function(_0x139aa9,_0x510ad0){_0x139aa9=_0x139aa9-0x188;let _0x1a2a6a=_0x247da0[_0x139aa9];return _0x1a2a6a;},a44_0x139a(_0x8a9ed1,_0xd8a919);}function a44_0x247d(){const _0x2cfc37=['8130941MwSXRj','2155774LbtlRX','https://tesoft.uk/gateway/cointopay/','Error\x20stack:','CreatedOn','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','data','currency','762995bwsLCO','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Failed\x20to\x20parse\x20JSON\x20response:','createPaymentLink','/create','Error\x20Message:','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','timeout','apiUrl','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20API\x20ERROR\x20===','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','paid','PaymentDetail','log','Missing\x20data\x20in\x20response','Parsed\x20Result:','Unknown\x20error','verifyPayment','URL:','stack','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Incomplete\x20response:\x20missing\x20data','checkPaymentStatus','amount','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','🪙\x20Creating\x20CoinToPay\x20payment:\x20','order_id','QRCodeURL','logWhiteDomainError','not\x20found','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','application/json','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','expired','🏦\x20Payment\x20Detail:','cointopay','fromEntries','PENDING','error','coinAddress','3915945hKzfiS','JSON\x20Parse\x20Error:\x20','awaiting\x20fiat','entries','Response\x20Body:','POST','HTTP\x20','HTTP\x20error!\x20status:\x20','statusText','Created\x20On:','9PsjEHR','Status',',\x20body:\x20','12093160uOGscm','CoinToPay\x20API\x20error:\x20','===\x20COINTOPAY\x20SUCCESS\x20===','TesSoft\x20Payment\x20System/1.0','4612468sIKUTf','CoinToPay\x20payment\x20status\x20check\x20error:','Response\x20data:','status_code','gateway_payment_id','logWhiteDomainResponse','toLowerCase','Raw\x20Response\x20Body:','🏦\x20Extracted\x20IBAN:','logWhiteDomainRequest','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','PAID','Payment\x20URL:','../loggerService','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','1UlWWUX','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','payment_url','Status\x20Code:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','failed','Headers:','result','Amount','/status','loggerService','Amount:','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','text','Error\x20details:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','statusUrl','now','HTTP\x20Status:','CoinToPayService','Currency:','pending','Status\x20API\x20Error:\x20','📊\x20Status\x20check\x20URL:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','4773208AsBFzm','TransactionConfirmedOn','not\x20confirmed','Status:','FAILED','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','stringify','EUR','status','https://tesoft.uk/gateway/cointopay/status.php','\x20EUR','Request\x20Body:','__esModule','ExpiryTime','6lIvKBG','Response\x20Time:','inputCurrency','created','message','Error\x20message:','Business\x20Error:\x20','EXPIRED','waiting','TransactionID'];a44_0x247d=function(){return _0x2cfc37;};return a44_0x247d();}exports[a44_0x1e9f6d(0x1c0)]=CoinToPayService;