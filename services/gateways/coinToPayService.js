'use strict';const a40_0x3350fe=a40_0x42c5;function a40_0x46be(){const _0x2e0dda=['stringify','cancelled','HTTP\x20','timeout','logWhiteDomainResponse','success','üìä\x20Status\x20check\x20URL:','Parsed\x20Result:','https://tesoft.uk/gateway/cointopay/status.php','QRCodeURL','entries','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','üè¶\x20Extracted\x20IBAN:','341sojgET','__esModule','/create','error','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Unknown\x20error\x20from\x20CoinToPay\x20API','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','HTTP\x20error!\x20status:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Error\x20details:','defineProperty','Error\x20message:','TesSoft\x20Payment\x20System/1.0','Raw\x20Response\x20Body:','toLowerCase','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','711819YbAZvg','Failed\x20to\x20parse\x20JSON\x20response:','Gateway\x20Payment\x20ID:','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','551332nnCcDe','URL:','../loggerService','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','POST','Result:','text','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','67465NYewIK','apiUrl','not\x20confirmed','currency','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','match','PENDING','fromEntries','verifyPayment','Missing\x20data\x20in\x20response','EXPIRED','200LFtGYU','1879278VcOchl','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Status','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ExpiryTime','logWhiteDomainError','6RmUDvx','HTTP\x20Status:','log','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','gateway_payment_id','CreatedOn','CoinToPay\x20API\x20error:\x20','awaiting\x20fiat','===\x20COINTOPAY\x20SUCCESS\x20===','Business\x20Error:\x20','status_code','Response\x20data:','PAID','headers','statusUrl','inputCurrency','now','loggerService','status','Status\x20Code:','statusText','parse','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','amount','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','result','stack','message','waiting','Error\x20Message:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Transaction\x20ID:','TransactionID','Response\x20Body:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','Amount','Response\x20Time:','created','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','EUR','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','checkPaymentStatus','90GpTMkx','TransactionConfirmedOn','createPaymentLink','Status:','paid','Currency:','Headers:','cointopay','Error\x20stack:','application/json','order_id','coinAddress','PaymentDetail','Amount:','IBAN:','not\x20found','processWebhook','\x20EUR','2592504KPbMvY','Confirmed\x20On:','data','5KKkKht','payment_url','JSON\x20Parse\x20Error:\x20','Incomplete\x20response:\x20missing\x20data','CoinToPayService','8838XmqYMf','/status','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','expired','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','7RpIhSP','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','merchant_reference_id','CoinToPay\x20status\x20API\x20error:\x20'];a40_0x46be=function(){return _0x2e0dda;};return a40_0x46be();}function a40_0x42c5(_0x3c0fc3,_0x47f745){const _0x46bea9=a40_0x46be();return a40_0x42c5=function(_0x42c540,_0x3a7369){_0x42c540=_0x42c540-0x1ce;let _0x2e1bd3=_0x46bea9[_0x42c540];return _0x2e1bd3;},a40_0x42c5(_0x3c0fc3,_0x47f745);}(function(_0x6205c9,_0x3fa753){const _0x57684b=a40_0x42c5,_0x29fdc7=_0x6205c9();while(!![]){try{const _0x1e3557=parseInt(_0x57684b(0x1d6))/0x1*(parseInt(_0x57684b(0x1e8))/0x2)+parseInt(_0x57684b(0x255))/0x3+parseInt(_0x57684b(0x1ce))/0x4*(-parseInt(_0x57684b(0x228))/0x5)+parseInt(_0x57684b(0x1e2))/0x6*(-parseInt(_0x57684b(0x232))/0x7)+-parseInt(_0x57684b(0x1e1))/0x8*(parseInt(_0x57684b(0x22d))/0x9)+parseInt(_0x57684b(0x213))/0xa*(-parseInt(_0x57684b(0x244))/0xb)+parseInt(_0x57684b(0x225))/0xc;if(_0x1e3557===_0x3fa753)break;else _0x29fdc7['push'](_0x29fdc7['shift']());}catch(_0x499cad){_0x29fdc7['push'](_0x29fdc7['shift']());}}}(a40_0x46be,0x2be7b));Object[a40_0x3350fe(0x24f)](exports,a40_0x3350fe(0x245),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a40_0x3350fe(0x1d0));class CoinToPayService{constructor(){const _0x3fca93=a40_0x3350fe;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this[_0x3fca93(0x1f6)]=_0x3fca93(0x23e),console['log'](_0x3fca93(0x248)),console[_0x3fca93(0x1ea)](_0x3fca93(0x23c),this[_0x3fca93(0x1f6)]);}async[a40_0x3350fe(0x215)](_0x4ebb50){const _0x6cc673=a40_0x3350fe,{orderId:_0x5a3312,amount:_0x210baa}=_0x4ebb50;console['log'](_0x6cc673(0x241)+_0x210baa+_0x6cc673(0x224));const _0x245031={'amount':_0x210baa},_0xe07ef2=Date[_0x6cc673(0x1f8)]();try{console['log'](_0x6cc673(0x233)),console['log'](_0x6cc673(0x1cf),this[_0x6cc673(0x1d7)]),console[_0x6cc673(0x1ea)]('Request\x20Body:',JSON[_0x6cc673(0x236)](_0x245031,null,0x2)),console['log']('Amount:',_0x210baa,_0x6cc673(0x1e5)),loggerService_1[_0x6cc673(0x1f9)]['logWhiteDomainRequest'](_0x6cc673(0x21a),_0x6cc673(0x246),_0x6cc673(0x1d2),_0x245031);const _0x25b539=await fetch(this[_0x6cc673(0x1d7)],{'method':_0x6cc673(0x1d2),'headers':{'Content-Type':_0x6cc673(0x21c),'Accept':_0x6cc673(0x21c),'User-Agent':_0x6cc673(0x251)},'body':JSON['stringify'](_0x245031)}),_0x2fa6f2=Date['now']()-_0xe07ef2;console['log'](_0x6cc673(0x1eb)),console[_0x6cc673(0x1ea)](_0x6cc673(0x216),_0x25b539[_0x6cc673(0x1fa)]),console['log']('Status\x20Text:',_0x25b539[_0x6cc673(0x1fc)]),console[_0x6cc673(0x1ea)](_0x6cc673(0x219),Object[_0x6cc673(0x1dd)](_0x25b539[_0x6cc673(0x1f5)][_0x6cc673(0x240)]())),console[_0x6cc673(0x1ea)]('Response\x20Time:',_0x2fa6f2+'ms');const _0x868b1c=await _0x25b539['text']();console[_0x6cc673(0x1ea)](_0x6cc673(0x252),_0x868b1c);if(!_0x25b539['ok']){console[_0x6cc673(0x247)](_0x6cc673(0x206)),console[_0x6cc673(0x247)](_0x6cc673(0x1e9),_0x25b539['status']),console['error']('Response\x20Body:',_0x868b1c),loggerService_1[_0x6cc673(0x1f9)]['logWhiteDomainResponse'](_0x6cc673(0x21a),_0x6cc673(0x246),_0x25b539[_0x6cc673(0x1fa)],_0x868b1c,_0x2fa6f2),loggerService_1[_0x6cc673(0x1f9)][_0x6cc673(0x1e7)]('cointopay',_0x6cc673(0x246),_0x6cc673(0x238)+_0x25b539['status']+':\x20'+_0x868b1c);throw new Error(_0x6cc673(0x24c)+_0x25b539[_0x6cc673(0x1fa)]+',\x20body:\x20'+_0x868b1c);}let _0x5b7d96;try{_0x5b7d96=JSON[_0x6cc673(0x1fd)](_0x868b1c);}catch(_0x398753){console['error'](_0x6cc673(0x256),_0x398753),loggerService_1[_0x6cc673(0x1f9)][_0x6cc673(0x1e7)](_0x6cc673(0x21a),'/create',_0x6cc673(0x22a)+_0x398753);throw new Error(_0x6cc673(0x20a)+_0x868b1c);}console['log'](_0x6cc673(0x254)),console[_0x6cc673(0x1ea)](_0x6cc673(0x23d),JSON[_0x6cc673(0x236)](_0x5b7d96,null,0x2)),loggerService_1[_0x6cc673(0x1f9)][_0x6cc673(0x23a)](_0x6cc673(0x21a),'/create',_0x25b539['status'],_0x5b7d96,_0x2fa6f2);if(_0x5b7d96[_0x6cc673(0x247)]){const _0x2d99e8=_0x5b7d96[_0x6cc673(0x203)]||_0x5b7d96[_0x6cc673(0x247)]||_0x6cc673(0x24a);console['error'](_0x6cc673(0x22f)),console[_0x6cc673(0x247)](_0x6cc673(0x205),_0x2d99e8),loggerService_1[_0x6cc673(0x1f9)]['logWhiteDomainError'](_0x6cc673(0x21a),_0x6cc673(0x246),_0x6cc673(0x1f1)+_0x2d99e8);throw new Error(_0x6cc673(0x1ee)+_0x2d99e8);}if(!_0x5b7d96['payment_url']||!_0x5b7d96[_0x6cc673(0x1ec)]){console[_0x6cc673(0x247)](_0x6cc673(0x249)),console[_0x6cc673(0x247)](_0x6cc673(0x1fe)),console[_0x6cc673(0x247)](_0x6cc673(0x1f3),_0x5b7d96),loggerService_1[_0x6cc673(0x1f9)][_0x6cc673(0x1e7)](_0x6cc673(0x21a),'/create',_0x6cc673(0x24b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x6cc673(0x1ea)](_0x6cc673(0x1f0)),console['log'](_0x6cc673(0x257),_0x5b7d96[_0x6cc673(0x1ec)]),console['log']('Payment\x20URL:',_0x5b7d96[_0x6cc673(0x229)]),console[_0x6cc673(0x1ea)]('Amount:',_0x210baa,_0x6cc673(0x210)),{'gateway_payment_id':_0x5b7d96[_0x6cc673(0x1ec)],'payment_url':_0x5b7d96['payment_url']};}catch(_0x3f1736){console[_0x6cc673(0x247)](_0x6cc673(0x20f)),console[_0x6cc673(0x247)](_0x6cc673(0x24e),_0x3f1736),loggerService_1['loggerService']['logWhiteDomainError'](_0x6cc673(0x21a),_0x6cc673(0x246),_0x3f1736);if(_0x3f1736 instanceof Error){console[_0x6cc673(0x247)](_0x6cc673(0x250),_0x3f1736[_0x6cc673(0x203)]),console['error'](_0x6cc673(0x21b),_0x3f1736[_0x6cc673(0x202)]);throw new Error(_0x6cc673(0x211)+_0x3f1736[_0x6cc673(0x203)]);}throw new Error(_0x6cc673(0x1da));}}async[a40_0x3350fe(0x212)](_0x480401){const _0xc546c5=a40_0x3350fe,_0x3be29f=Date[_0xc546c5(0x1f8)]();try{console[_0xc546c5(0x1ea)](_0xc546c5(0x1d5)+_0x480401);const _0x217d1a={'gatewayPaymentId':_0x480401};loggerService_1[_0xc546c5(0x1f9)]['logWhiteDomainRequest'](_0xc546c5(0x21a),_0xc546c5(0x22e),_0xc546c5(0x1d2),_0x217d1a);const _0x4a9edf=await fetch(this[_0xc546c5(0x1f6)],{'method':_0xc546c5(0x1d2),'headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0xc546c5(0x251)},'body':JSON[_0xc546c5(0x236)](_0x217d1a)}),_0x593a8c=Date['now']()-_0x3be29f;console[_0xc546c5(0x1ea)](_0xc546c5(0x20b)),console[_0xc546c5(0x1ea)](_0xc546c5(0x216),_0x4a9edf['status']),console[_0xc546c5(0x1ea)](_0xc546c5(0x20d),_0x593a8c+'ms');if(!_0x4a9edf['ok']){const _0x399f40=await _0x4a9edf[_0xc546c5(0x1d4)]();console[_0xc546c5(0x247)]('HTTP\x20Status:',_0x4a9edf[_0xc546c5(0x1fa)]),console[_0xc546c5(0x247)](_0xc546c5(0x209),_0x399f40),loggerService_1[_0xc546c5(0x1f9)][_0xc546c5(0x23a)](_0xc546c5(0x21a),_0xc546c5(0x22e),_0x4a9edf[_0xc546c5(0x1fa)],_0x399f40,_0x593a8c),loggerService_1['loggerService'][_0xc546c5(0x1e7)](_0xc546c5(0x21a),_0xc546c5(0x22e),'HTTP\x20'+_0x4a9edf[_0xc546c5(0x1fa)]+':\x20'+_0x399f40);throw new Error('HTTP\x20error!\x20status:\x20'+_0x4a9edf[_0xc546c5(0x1fa)]);}const _0x258b9c=await _0x4a9edf[_0xc546c5(0x1d4)]();console[_0xc546c5(0x1ea)](_0xc546c5(0x252),_0x258b9c);let _0x226b72;try{_0x226b72=JSON[_0xc546c5(0x1fd)](_0x258b9c);}catch(_0x252def){console['error'](_0xc546c5(0x256),_0x252def),loggerService_1[_0xc546c5(0x1f9)]['logWhiteDomainError'](_0xc546c5(0x21a),_0xc546c5(0x22e),_0xc546c5(0x22a)+_0x252def);throw new Error(_0xc546c5(0x200)+_0x258b9c);}loggerService_1[_0xc546c5(0x1f9)][_0xc546c5(0x23a)]('cointopay','/status',_0x4a9edf[_0xc546c5(0x1fa)],_0x226b72,_0x593a8c),console[_0xc546c5(0x1ea)](_0xc546c5(0x242)),console['log'](_0xc546c5(0x1d3),_0x226b72[_0xc546c5(0x201)]),console['log'](_0xc546c5(0x1fb),_0x226b72[_0xc546c5(0x1f2)]),console['log']('Payment\x20Status:',_0x226b72['data']?.[_0xc546c5(0x1e4)]),console[_0xc546c5(0x1ea)]('Amount:',_0x226b72[_0xc546c5(0x227)]?.[_0xc546c5(0x20c)]),console[_0xc546c5(0x1ea)](_0xc546c5(0x218),_0x226b72[_0xc546c5(0x227)]?.[_0xc546c5(0x1f7)]);if(_0x226b72[_0xc546c5(0x201)]!==_0xc546c5(0x23b)||_0x226b72[_0xc546c5(0x1f2)]!==0xc8){const _0x688678=_0x226b72[_0xc546c5(0x203)]||_0xc546c5(0x24d);console[_0xc546c5(0x247)](_0xc546c5(0x1e3)),console['error'](_0xc546c5(0x205),_0x688678),loggerService_1[_0xc546c5(0x1f9)][_0xc546c5(0x1e7)](_0xc546c5(0x21a),'/status','Status\x20API\x20Error:\x20'+_0x688678);throw new Error(_0xc546c5(0x235)+_0x688678);}if(!_0x226b72[_0xc546c5(0x227)]){console[_0xc546c5(0x247)](_0xc546c5(0x231)),console[_0xc546c5(0x247)](_0xc546c5(0x1df)),loggerService_1['loggerService'][_0xc546c5(0x1e7)](_0xc546c5(0x21a),_0xc546c5(0x22e),_0xc546c5(0x22b));throw new Error(_0xc546c5(0x258));}let _0x345774=_0xc546c5(0x1dc);switch(_0x226b72[_0xc546c5(0x227)]['Status']?.[_0xc546c5(0x253)]()){case _0xc546c5(0x217):_0x345774='PAID';break;case _0xc546c5(0x237):case'failed':case'error':_0x345774='FAILED';break;case _0xc546c5(0x230):case _0xc546c5(0x239):_0x345774=_0xc546c5(0x1e0);break;case'waiting':case'awaiting\x20fiat':case'pending':case _0xc546c5(0x20e):default:_0x345774='PENDING';break;}let _0x2318ca,_0x1c5e00;if(_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x21f)]){const _0x3e8a89=_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x21f)];console[_0xc546c5(0x1ea)]('üè¶\x20Payment\x20Detail:',_0x3e8a89);const _0x4bbb7c=_0x3e8a89[_0xc546c5(0x1db)](/IBAN\s+([A-Z0-9]+)/i);_0x4bbb7c&&(_0x2318ca=_0x4bbb7c[0x1],console['log'](_0xc546c5(0x243),_0x2318ca)),_0x1c5e00=_0x3e8a89;}const _0x52ba36={'iban':_0x2318ca,'bankDetails':_0x1c5e00,'transactionId':_0x226b72[_0xc546c5(0x227)]['TransactionID'],'coinAddress':_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x21e)],'qrCodeUrl':_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x23f)],'expiryTime':_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1e6)],'createdOn':_0x226b72[_0xc546c5(0x227)]['CreatedOn'],'confirmedOn':_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x214)]};console['log'](_0xc546c5(0x1d1)),console['log'](_0xc546c5(0x216),_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1e4)],'->',_0x345774),console['log'](_0xc546c5(0x220),_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x20c)],_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1f7)]),console[_0xc546c5(0x1ea)](_0xc546c5(0x207),_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x208)]),console[_0xc546c5(0x1ea)](_0xc546c5(0x221),_0x2318ca||_0xc546c5(0x222)),console[_0xc546c5(0x1ea)]('Created\x20On:',_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1ed)]),console['log'](_0xc546c5(0x226),_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x214)]||_0xc546c5(0x1d8));if(_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1e4)]?.[_0xc546c5(0x253)]()===_0xc546c5(0x1ef))console['log']('üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)');else _0x226b72[_0xc546c5(0x227)]['Status']?.[_0xc546c5(0x253)]()===_0xc546c5(0x217)&&console[_0xc546c5(0x1ea)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x345774,'amount':parseFloat(_0x226b72['data']['Amount'])||undefined,'currency':_0x226b72[_0xc546c5(0x227)][_0xc546c5(0x1f7)]||_0xc546c5(0x210),'paymentDetails':_0x52ba36};}catch(_0x3cae94){console[_0xc546c5(0x247)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x3cae94),loggerService_1[_0xc546c5(0x1f9)]['logWhiteDomainError'](_0xc546c5(0x21a),'/status',_0x3cae94);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x3cae94 instanceof Error?_0x3cae94[_0xc546c5(0x203)]:'Unknown\x20error'));}}async[a40_0x3350fe(0x1de)](_0x5a7644){const _0x108c49=a40_0x3350fe,_0x8506ab=await this[_0x108c49(0x212)](_0x5a7644);return{'status':_0x8506ab['status'],'amount':_0x8506ab[_0x108c49(0x1ff)],'currency':_0x8506ab[_0x108c49(0x1d9)]};}async[a40_0x3350fe(0x223)](_0x2e2b40){const _0x409dec=a40_0x3350fe;console[_0x409dec(0x1ea)]('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x2e2b40);let _0x335849=_0x409dec(0x1dc);switch(_0x2e2b40[_0x409dec(0x1fa)]?.[_0x409dec(0x253)]()){case _0x409dec(0x217):_0x335849=_0x409dec(0x1f4);break;case _0x409dec(0x237):case'failed':case'error':_0x335849='FAILED';break;case _0x409dec(0x230):case _0x409dec(0x239):_0x335849=_0x409dec(0x1e0);break;case'pending':case _0x409dec(0x204):case _0x409dec(0x1ef):case _0x409dec(0x20e):default:_0x335849=_0x409dec(0x1dc);break;}return{'paymentId':_0x2e2b40[_0x409dec(0x21d)]||_0x2e2b40[_0x409dec(0x234)]||'','status':_0x335849,'amount':_0x2e2b40[_0x409dec(0x1ff)],'currency':_0x2e2b40['currency']||'EUR'};}}exports[a40_0x3350fe(0x22c)]=CoinToPayService;