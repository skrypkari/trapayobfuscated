'use strict';const a41_0x188a58=a41_0x56e8;(function(_0x2b3ebb,_0x25481b){const _0x1fa471=a41_0x56e8,_0x2a78ed=_0x2b3ebb();while(!![]){try{const _0x2de710=-parseInt(_0x1fa471(0x156))/0x1+parseInt(_0x1fa471(0x15b))/0x2*(-parseInt(_0x1fa471(0x1a9))/0x3)+parseInt(_0x1fa471(0x195))/0x4+-parseInt(_0x1fa471(0x161))/0x5*(parseInt(_0x1fa471(0x171))/0x6)+-parseInt(_0x1fa471(0x15f))/0x7*(-parseInt(_0x1fa471(0x190))/0x8)+-parseInt(_0x1fa471(0x1aa))/0x9*(-parseInt(_0x1fa471(0x16f))/0xa)+-parseInt(_0x1fa471(0x1c4))/0xb;if(_0x2de710===_0x25481b)break;else _0x2a78ed['push'](_0x2a78ed['shift']());}catch(_0x263449){_0x2a78ed['push'](_0x2a78ed['shift']());}}}(a41_0x4238,0x45800));Object[a41_0x188a58(0x184)](exports,'__esModule',{'value':!![]}),exports[a41_0x188a58(0x16a)]=void 0x0;const loggerService_1=require(a41_0x188a58(0x189));class CoinToPayService{constructor(){const _0x1265b2=a41_0x188a58;this[_0x1265b2(0x164)]=_0x1265b2(0x1cc),this[_0x1265b2(0x1cd)]=_0x1265b2(0x170),console[_0x1265b2(0x173)]('🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy'),console[_0x1265b2(0x173)](_0x1265b2(0x175),this[_0x1265b2(0x1cd)]);}async[a41_0x188a58(0x1ac)](_0x18544a){const _0x55892c=a41_0x188a58,{orderId:_0x5a6fce,amount:_0x503f40}=_0x18544a;console[_0x55892c(0x173)](_0x55892c(0x1b6)+_0x503f40+_0x55892c(0x182));const _0x495fc9={'amount':_0x503f40},_0x4ad0e9=Date[_0x55892c(0x1a5)]();try{console[_0x55892c(0x173)](_0x55892c(0x19a)),console[_0x55892c(0x173)](_0x55892c(0x1c1),this[_0x55892c(0x164)]),console['log'](_0x55892c(0x1a1),JSON['stringify'](_0x495fc9,null,0x2)),console['log'](_0x55892c(0x17d),_0x503f40,'EUR\x20(always\x20EUR\x20for\x20CoinToPay)'),loggerService_1['loggerService'][_0x55892c(0x159)](_0x55892c(0x1bf),'/create','POST',_0x495fc9);const _0xa32ee4=await fetch(this[_0x55892c(0x164)],{'method':'POST','headers':{'Content-Type':_0x55892c(0x1cf),'Accept':_0x55892c(0x1cf),'User-Agent':_0x55892c(0x163)},'body':JSON[_0x55892c(0x193)](_0x495fc9)}),_0x2947df=Date['now']()-_0x4ad0e9;console['log'](_0x55892c(0x155)),console[_0x55892c(0x173)](_0x55892c(0x1bb),_0xa32ee4[_0x55892c(0x162)]),console[_0x55892c(0x173)]('Status\x20Text:',_0xa32ee4[_0x55892c(0x191)]),console[_0x55892c(0x173)](_0x55892c(0x1d1),Object[_0x55892c(0x185)](_0xa32ee4[_0x55892c(0x183)][_0x55892c(0x1af)]())),console['log'](_0x55892c(0x1a3),_0x2947df+'ms');const _0x1a925c=await _0xa32ee4['text']();console['log'](_0x55892c(0x1b3),_0x1a925c);if(!_0xa32ee4['ok']){console[_0x55892c(0x196)](_0x55892c(0x165)),console[_0x55892c(0x196)](_0x55892c(0x176),_0xa32ee4['status']),console['error'](_0x55892c(0x181),_0x1a925c),loggerService_1['loggerService'][_0x55892c(0x18b)]('cointopay',_0x55892c(0x1c3),_0xa32ee4[_0x55892c(0x162)],_0x1a925c,_0x2947df),loggerService_1[_0x55892c(0x186)][_0x55892c(0x17a)](_0x55892c(0x1bf),_0x55892c(0x1c3),_0x55892c(0x19b)+_0xa32ee4['status']+':\x20'+_0x1a925c);throw new Error(_0x55892c(0x1ab)+_0xa32ee4[_0x55892c(0x162)]+_0x55892c(0x172)+_0x1a925c);}let _0xeb69d1;try{_0xeb69d1=JSON[_0x55892c(0x1a7)](_0x1a925c);}catch(_0x134b72){console['error'](_0x55892c(0x1d0),_0x134b72),loggerService_1[_0x55892c(0x186)]['logWhiteDomainError'](_0x55892c(0x1bf),_0x55892c(0x1c3),_0x55892c(0x197)+_0x134b72);throw new Error(_0x55892c(0x1b7)+_0x1a925c);}console[_0x55892c(0x173)](_0x55892c(0x198)),console[_0x55892c(0x173)](_0x55892c(0x1a4),JSON[_0x55892c(0x193)](_0xeb69d1,null,0x2)),loggerService_1[_0x55892c(0x186)][_0x55892c(0x18b)](_0x55892c(0x1bf),_0x55892c(0x1c3),_0xa32ee4[_0x55892c(0x162)],_0xeb69d1,_0x2947df);if(_0xeb69d1[_0x55892c(0x196)]){const _0xe484ad=_0xeb69d1['message']||_0xeb69d1['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x55892c(0x196)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0x55892c(0x196)](_0x55892c(0x187),_0xe484ad),loggerService_1[_0x55892c(0x186)][_0x55892c(0x17a)](_0x55892c(0x1bf),_0x55892c(0x1c3),_0x55892c(0x1cb)+_0xe484ad);throw new Error(_0x55892c(0x16d)+_0xe484ad);}if(!_0xeb69d1[_0x55892c(0x179)]||!_0xeb69d1['gateway_payment_id']){console[_0x55892c(0x196)](_0x55892c(0x1c8)),console[_0x55892c(0x196)](_0x55892c(0x1a8)),console[_0x55892c(0x196)](_0x55892c(0x18a),_0xeb69d1),loggerService_1[_0x55892c(0x186)][_0x55892c(0x17a)](_0x55892c(0x1bf),_0x55892c(0x1c3),_0x55892c(0x19c));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}return console[_0x55892c(0x173)](_0x55892c(0x1b2)),console[_0x55892c(0x173)](_0x55892c(0x178),_0xeb69d1[_0x55892c(0x16b)]),console[_0x55892c(0x173)]('Payment\x20URL:',_0xeb69d1[_0x55892c(0x179)]),console[_0x55892c(0x173)]('Amount:',_0x503f40,_0x55892c(0x16e)),{'gateway_payment_id':_0xeb69d1[_0x55892c(0x16b)],'payment_url':_0xeb69d1[_0x55892c(0x179)]};}catch(_0x44dacf){console[_0x55892c(0x196)](_0x55892c(0x17b)),console[_0x55892c(0x196)](_0x55892c(0x18f),_0x44dacf),loggerService_1[_0x55892c(0x186)]['logWhiteDomainError'](_0x55892c(0x1bf),'/create',_0x44dacf);if(_0x44dacf instanceof Error){console[_0x55892c(0x196)](_0x55892c(0x1b4),_0x44dacf['message']),console[_0x55892c(0x196)]('Error\x20stack:',_0x44dacf['stack']);throw new Error(_0x55892c(0x1ca)+_0x44dacf['message']);}throw new Error(_0x55892c(0x17c));}}async[a41_0x188a58(0x192)](_0x12eece){const _0x37584a=a41_0x188a58,_0x3db2f4=Date[_0x37584a(0x1a5)]();try{console[_0x37584a(0x173)]('📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x12eece);const _0x1d0134={'gatewayPaymentId':_0x12eece};loggerService_1[_0x37584a(0x186)][_0x37584a(0x159)](_0x37584a(0x1bf),'/status','POST',_0x1d0134);const _0x110e4=await fetch(this[_0x37584a(0x1cd)],{'method':'POST','headers':{'Content-Type':_0x37584a(0x1cf),'Accept':_0x37584a(0x1cf),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x37584a(0x193)](_0x1d0134)}),_0x4bd636=Date[_0x37584a(0x1a5)]()-_0x3db2f4;console[_0x37584a(0x173)](_0x37584a(0x18d)),console[_0x37584a(0x173)](_0x37584a(0x1bb),_0x110e4[_0x37584a(0x162)]),console[_0x37584a(0x173)](_0x37584a(0x1a3),_0x4bd636+'ms');if(!_0x110e4['ok']){const _0x4017c3=await _0x110e4['text']();console[_0x37584a(0x196)](_0x37584a(0x176),_0x110e4['status']),console['error'](_0x37584a(0x181),_0x4017c3),loggerService_1[_0x37584a(0x186)][_0x37584a(0x18b)](_0x37584a(0x1bf),_0x37584a(0x1ae),_0x110e4[_0x37584a(0x162)],_0x4017c3,_0x4bd636),loggerService_1[_0x37584a(0x186)][_0x37584a(0x17a)]('cointopay',_0x37584a(0x1ae),_0x37584a(0x19b)+_0x110e4[_0x37584a(0x162)]+':\x20'+_0x4017c3);throw new Error(_0x37584a(0x1ab)+_0x110e4[_0x37584a(0x162)]);}const _0x4e1f1e=await _0x110e4['text']();console[_0x37584a(0x173)](_0x37584a(0x1b3),_0x4e1f1e);let _0x473d5d;try{_0x473d5d=JSON[_0x37584a(0x1a7)](_0x4e1f1e);}catch(_0x48fcab){console[_0x37584a(0x196)](_0x37584a(0x1d0),_0x48fcab),loggerService_1[_0x37584a(0x186)][_0x37584a(0x17a)](_0x37584a(0x1bf),_0x37584a(0x1ae),_0x37584a(0x197)+_0x48fcab);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x4e1f1e);}loggerService_1[_0x37584a(0x186)][_0x37584a(0x18b)](_0x37584a(0x1bf),_0x37584a(0x1ae),_0x110e4['status'],_0x473d5d,_0x4bd636),console[_0x37584a(0x173)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x37584a(0x1d3),_0x473d5d[_0x37584a(0x1d2)]),console[_0x37584a(0x173)](_0x37584a(0x152),_0x473d5d[_0x37584a(0x1c0)]),console['log'](_0x37584a(0x194),_0x473d5d[_0x37584a(0x199)]?.['Status']),console[_0x37584a(0x173)]('Amount:',_0x473d5d[_0x37584a(0x199)]?.[_0x37584a(0x166)]),console[_0x37584a(0x173)]('Currency:',_0x473d5d[_0x37584a(0x199)]?.['inputCurrency']);if(_0x473d5d[_0x37584a(0x1d2)]!==_0x37584a(0x158)||_0x473d5d[_0x37584a(0x1c0)]!==0xc8){const _0x1108f8=_0x473d5d['message']||_0x37584a(0x19f);console[_0x37584a(0x196)](_0x37584a(0x1bc)),console[_0x37584a(0x196)](_0x37584a(0x187),_0x1108f8),loggerService_1[_0x37584a(0x186)][_0x37584a(0x17a)]('cointopay',_0x37584a(0x1ae),_0x37584a(0x177)+_0x1108f8);throw new Error(_0x37584a(0x1be)+_0x1108f8);}if(!_0x473d5d[_0x37584a(0x199)]){console[_0x37584a(0x196)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x37584a(0x186)][_0x37584a(0x17a)](_0x37584a(0x1bf),_0x37584a(0x1ae),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x37584a(0x19e));}let _0x1f877c=_0x37584a(0x18e);switch(_0x473d5d[_0x37584a(0x199)][_0x37584a(0x157)]?.[_0x37584a(0x188)]()){case _0x37584a(0x1c2):_0x1f877c=_0x37584a(0x180);break;case _0x37584a(0x18c):case _0x37584a(0x174):case'error':_0x1f877c=_0x37584a(0x1c9);break;case'expired':case _0x37584a(0x1ce):_0x1f877c='EXPIRED';break;case _0x37584a(0x1b5):case'awaiting\x20fiat':case _0x37584a(0x150):case _0x37584a(0x167):default:_0x1f877c=_0x37584a(0x18e);break;}let _0x4fb865,_0x50f041;if(_0x473d5d['data']['PaymentDetail']){const _0x54b550=_0x473d5d[_0x37584a(0x199)][_0x37584a(0x153)];console[_0x37584a(0x173)](_0x37584a(0x1c5),_0x54b550);const _0x4bf62e=_0x54b550['match'](/IBAN\s+([A-Z0-9]+)/i);_0x4bf62e&&(_0x4fb865=_0x4bf62e[0x1],console['log'](_0x37584a(0x160),_0x4fb865)),_0x50f041=_0x54b550;}const _0x4ea700={'iban':_0x4fb865,'bankDetails':_0x50f041,'transactionId':_0x473d5d['data'][_0x37584a(0x1a2)],'coinAddress':_0x473d5d[_0x37584a(0x199)][_0x37584a(0x15d)],'qrCodeUrl':_0x473d5d[_0x37584a(0x199)][_0x37584a(0x1ba)],'expiryTime':_0x473d5d['data'][_0x37584a(0x19d)],'createdOn':_0x473d5d['data'][_0x37584a(0x1c6)],'confirmedOn':_0x473d5d[_0x37584a(0x199)][_0x37584a(0x17f)]};console[_0x37584a(0x173)](_0x37584a(0x16c)),console[_0x37584a(0x173)](_0x37584a(0x1bb),_0x473d5d[_0x37584a(0x199)]['Status'],'->',_0x1f877c),console['log'](_0x37584a(0x17d),_0x473d5d[_0x37584a(0x199)][_0x37584a(0x166)],_0x473d5d[_0x37584a(0x199)][_0x37584a(0x154)]),console[_0x37584a(0x173)](_0x37584a(0x1b1),_0x473d5d[_0x37584a(0x199)][_0x37584a(0x1a2)]),console[_0x37584a(0x173)](_0x37584a(0x15e),_0x4fb865||_0x37584a(0x151)),console[_0x37584a(0x173)]('Created\x20On:',_0x473d5d[_0x37584a(0x199)][_0x37584a(0x1c6)]),console[_0x37584a(0x173)]('Confirmed\x20On:',_0x473d5d['data'][_0x37584a(0x17f)]||'not\x20confirmed');if(_0x473d5d[_0x37584a(0x199)][_0x37584a(0x157)]?.[_0x37584a(0x188)]()===_0x37584a(0x15a))console['log'](_0x37584a(0x168));else _0x473d5d[_0x37584a(0x199)][_0x37584a(0x157)]?.['toLowerCase']()==='paid'&&console[_0x37584a(0x173)](_0x37584a(0x1ad));return{'status':_0x1f877c,'amount':parseFloat(_0x473d5d[_0x37584a(0x199)]['Amount'])||undefined,'currency':_0x473d5d[_0x37584a(0x199)][_0x37584a(0x154)]||_0x37584a(0x16e),'paymentDetails':_0x4ea700};}catch(_0x4394c5){console[_0x37584a(0x196)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x4394c5),loggerService_1[_0x37584a(0x186)][_0x37584a(0x17a)]('cointopay',_0x37584a(0x1ae),_0x4394c5);throw new Error(_0x37584a(0x1b9)+(_0x4394c5 instanceof Error?_0x4394c5[_0x37584a(0x15c)]:'Unknown\x20error'));}}async['verifyPayment'](_0x3861bb){const _0x35c308=a41_0x188a58,_0x24b7be=await this[_0x35c308(0x192)](_0x3861bb);return{'status':_0x24b7be[_0x35c308(0x162)],'amount':_0x24b7be['amount'],'currency':_0x24b7be[_0x35c308(0x169)]};}async[a41_0x188a58(0x1a6)](_0x1fb804){const _0x22e67a=a41_0x188a58;console[_0x22e67a(0x173)](_0x22e67a(0x1bd),_0x1fb804);let _0x3bc2cf=_0x22e67a(0x18e);switch(_0x1fb804[_0x22e67a(0x162)]?.[_0x22e67a(0x188)]()){case _0x22e67a(0x1c2):_0x3bc2cf=_0x22e67a(0x180);break;case'cancelled':case'failed':case'error':_0x3bc2cf=_0x22e67a(0x1c9);break;case _0x22e67a(0x1b0):case'timeout':_0x3bc2cf=_0x22e67a(0x1c7);break;case _0x22e67a(0x150):case _0x22e67a(0x1b5):case'awaiting\x20fiat':case _0x22e67a(0x167):default:_0x3bc2cf=_0x22e67a(0x18e);break;}return{'paymentId':_0x1fb804[_0x22e67a(0x1a0)]||_0x1fb804[_0x22e67a(0x17e)]||'','status':_0x3bc2cf,'amount':_0x1fb804[_0x22e67a(0x1b8)],'currency':_0x1fb804[_0x22e67a(0x169)]||'EUR'};}}exports[a41_0x188a58(0x16a)]=CoinToPayService;function a41_0x56e8(_0x2d7739,_0x62c5c1){const _0x4238cc=a41_0x4238();return a41_0x56e8=function(_0x56e8ae,_0x8737ad){_0x56e8ae=_0x56e8ae-0x150;let _0xf241b7=_0x4238cc[_0x56e8ae];return _0xf241b7;},a41_0x56e8(_0x2d7739,_0x62c5c1);}function a41_0x4238(){const _0x4ca774=['awaiting\x20fiat','2QHIRPM','message','coinAddress','IBAN:','49rVoGjO','🏦\x20Extracted\x20IBAN:','202175AfDgPD','status','TesSoft\x20Payment\x20System/1.0','apiUrl','===\x20COINTOPAY\x20API\x20ERROR\x20===','Amount','created','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','currency','CoinToPayService','gateway_payment_id','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','CoinToPay\x20API\x20error:\x20','EUR','5666330nlLUiH','https://tesoft.uk/gateway/cointopay/status.php','18UTzfND',',\x20body:\x20','log','failed','📊\x20Status\x20check\x20URL:','HTTP\x20Status:','Status\x20API\x20Error:\x20','Gateway\x20Payment\x20ID:','payment_url','logWhiteDomainError','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Amount:','merchant_reference_id','TransactionConfirmedOn','PAID','Response\x20Body:','\x20EUR','headers','defineProperty','fromEntries','loggerService','Error\x20Message:','toLowerCase','../loggerService','Response\x20data:','logWhiteDomainResponse','cancelled','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','PENDING','Error\x20details:','467680QpHFeN','statusText','checkPaymentStatus','stringify','Payment\x20Status:','2023008Tlfmdz','error','JSON\x20Parse\x20Error:\x20','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','data','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','HTTP\x20','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','ExpiryTime','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','order_id','Request\x20Body:','TransactionID','Response\x20Time:','Parsed\x20Result:','now','processWebhook','parse','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','8106qLNWsZ','9XAIkyM','HTTP\x20error!\x20status:\x20','createPaymentLink','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','/status','entries','expired','Transaction\x20ID:','===\x20COINTOPAY\x20SUCCESS\x20===','Raw\x20Response\x20Body:','Error\x20message:','waiting','🪙\x20Creating\x20CoinToPay\x20payment:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','amount','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','QRCodeURL','Status:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','CoinToPay\x20status\x20API\x20error:\x20','cointopay','status_code','URL:','paid','/create','11538637CvVpmX','🏦\x20Payment\x20Detail:','CreatedOn','EXPIRED','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Business\x20Error:\x20','https://tesoft.uk/gateway/cointopay/','statusUrl','timeout','application/json','Failed\x20to\x20parse\x20JSON\x20response:','Headers:','result','Result:','pending','not\x20found','Status\x20Code:','PaymentDetail','inputCurrency','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','23959ACBJNc','Status','success','logWhiteDomainRequest'];a41_0x4238=function(){return _0x4ca774;};return a41_0x4238();}