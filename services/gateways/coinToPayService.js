'use strict';const a38_0x1f95c6=a38_0x7364;(function(_0x3d9cab,_0x22708a){const _0x1b3003=a38_0x7364,_0x15b07b=_0x3d9cab();while(!![]){try{const _0x2d2936=-parseInt(_0x1b3003(0x124))/0x1*(parseInt(_0x1b3003(0x172))/0x2)+-parseInt(_0x1b3003(0x127))/0x3+parseInt(_0x1b3003(0x167))/0x4+parseInt(_0x1b3003(0x123))/0x5+parseInt(_0x1b3003(0x12b))/0x6*(-parseInt(_0x1b3003(0x173))/0x7)+parseInt(_0x1b3003(0x116))/0x8*(parseInt(_0x1b3003(0x103))/0x9)+-parseInt(_0x1b3003(0x170))/0xa;if(_0x2d2936===_0x22708a)break;else _0x15b07b['push'](_0x15b07b['shift']());}catch(_0x10f9ed){_0x15b07b['push'](_0x15b07b['shift']());}}}(a38_0x4393,0xc3a59));function a38_0x4393(){const _0x3b7b87=['checkPaymentStatus','Error\x20Message:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','6zaiUHz','verifyPayment','cancelled','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','createPaymentLink','EUR','Gateway\x20Payment\x20ID:','ExpiryTime','Transaction\x20ID:','\x20EUR','Raw\x20Response\x20Body:','failed','===\x20COINTOPAY\x20API\x20ERROR\x20===','expired','error','processWebhook','Status\x20Text:','gateway_payment_id','timeout','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Payment\x20Status:','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Amount','Currency:','PaymentDetail','Unknown\x20error','Response\x20data:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','__esModule','order_id','Payment\x20URL:','log','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','IBAN:','match','defineProperty','coinAddress','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','statusUrl','Response\x20Time:','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','POST','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','inputCurrency','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','cointopay','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','currency','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','entries','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','loggerService','CoinToPayService','stack','Status:','üè¶\x20Extracted\x20IBAN:','result','now','4139896VCZRzp','apiUrl','Status','CreatedOn','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','Amount:','Status\x20Code:','TransactionID','Error\x20message:','12861340HGGMuY','headers','56EDceUx','2962547rJOQfj','Confirmed\x20On:','success','amount','JSON\x20Parse\x20Error:\x20','not\x20confirmed','merchant_reference_id','fromEntries','EXPIRED','awaiting\x20fiat','stringify','CoinToPay\x20API\x20error:\x20','waiting','/status','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','HTTP\x20','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','message','status_code','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','toLowerCase','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20data\x20in\x20response','data','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainResponse','9502596zRSdYQ','TransactionConfirmedOn','https://tesoft.uk/gateway/cointopay/','logWhiteDomainError','HTTP\x20Status:','FAILED','Failed\x20to\x20parse\x20JSON\x20response:','CoinToPay\x20payment\x20status\x20check\x20error:','text','PAID','HTTP\x20error!\x20status:\x20','/create','status','payment_url','CoinToPay\x20status\x20API\x20error:\x20','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','PENDING','created','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','8pvMYtn','application/json','üè¶\x20Payment\x20Detail:','not\x20found','parse','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','paid','logWhiteDomainRequest','URL:','Created\x20On:','Incomplete\x20response:\x20missing\x20data','üìä\x20Status\x20check\x20URL:','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','7927765aazHgC','15287GjhQtG','TesSoft\x20Payment\x20System/1.0','pending','2212833xmETRG'];a38_0x4393=function(){return _0x3b7b87;};return a38_0x4393();}Object[a38_0x1f95c6(0x14e)](exports,a38_0x1f95c6(0x147),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require('../loggerService');function a38_0x7364(_0x4cc7d6,_0x2ad1d4){const _0x439342=a38_0x4393();return a38_0x7364=function(_0x7364ed,_0x3d9a71){_0x7364ed=_0x7364ed-0xfc;let _0x664f9c=_0x439342[_0x7364ed];return _0x664f9c;},a38_0x7364(_0x4cc7d6,_0x2ad1d4);}class CoinToPayService{constructor(){const _0x1a13b8=a38_0x1f95c6;this[_0x1a13b8(0x168)]=_0x1a13b8(0x105),this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x1a13b8(0x14a)](_0x1a13b8(0x12e)),console[_0x1a13b8(0x14a)](_0x1a13b8(0x121),this['statusUrl']);}async[a38_0x1f95c6(0x12f)](_0x245d1e){const _0x39e82a=a38_0x1f95c6,{orderId:_0x319aee,amount:_0x1df685}=_0x245d1e;console[_0x39e82a(0x14a)](_0x39e82a(0xfe)+_0x1df685+_0x39e82a(0x134));const _0x387557={'amount':_0x1df685},_0x36b77c=Date['now']();try{console[_0x39e82a(0x14a)](_0x39e82a(0xfc)),console[_0x39e82a(0x14a)](_0x39e82a(0x11e),this[_0x39e82a(0x168)]),console['log']('Request\x20Body:',JSON[_0x39e82a(0x17d)](_0x387557,null,0x2)),console['log'](_0x39e82a(0x16c),_0x1df685,_0x39e82a(0x112)),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x11d)](_0x39e82a(0x159),_0x39e82a(0x10e),'POST',_0x387557);const _0x5e3c0e=await fetch(this['apiUrl'],{'method':_0x39e82a(0x154),'headers':{'Content-Type':_0x39e82a(0x117),'Accept':_0x39e82a(0x117),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x39e82a(0x17d)](_0x387557)}),_0x26d168=Date[_0x39e82a(0x166)]()-_0x36b77c;console[_0x39e82a(0x14a)](_0x39e82a(0x140)),console[_0x39e82a(0x14a)](_0x39e82a(0x163),_0x5e3c0e[_0x39e82a(0x10f)]),console[_0x39e82a(0x14a)](_0x39e82a(0x13b),_0x5e3c0e['statusText']),console[_0x39e82a(0x14a)]('Headers:',Object[_0x39e82a(0x17a)](_0x5e3c0e[_0x39e82a(0x171)][_0x39e82a(0x15e)]())),console[_0x39e82a(0x14a)](_0x39e82a(0x152),_0x26d168+'ms');const _0x13a300=await _0x5e3c0e[_0x39e82a(0x10b)]();console[_0x39e82a(0x14a)]('Raw\x20Response\x20Body:',_0x13a300);if(!_0x5e3c0e['ok']){console['error'](_0x39e82a(0x137)),console[_0x39e82a(0x139)]('HTTP\x20Status:',_0x5e3c0e['status']),console['error']('Response\x20Body:',_0x13a300),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x102)]('cointopay','/create',_0x5e3c0e['status'],_0x13a300,_0x26d168),loggerService_1[_0x39e82a(0x160)]['logWhiteDomainError'](_0x39e82a(0x159),_0x39e82a(0x10e),_0x39e82a(0x182)+_0x5e3c0e[_0x39e82a(0x10f)]+':\x20'+_0x13a300);throw new Error(_0x39e82a(0x10d)+_0x5e3c0e[_0x39e82a(0x10f)]+',\x20body:\x20'+_0x13a300);}let _0x1f5cff;try{_0x1f5cff=JSON[_0x39e82a(0x11a)](_0x13a300);}catch(_0x55ce83){console[_0x39e82a(0x139)](_0x39e82a(0x109),_0x55ce83),loggerService_1['loggerService'][_0x39e82a(0x106)]('cointopay',_0x39e82a(0x10e),'JSON\x20Parse\x20Error:\x20'+_0x55ce83);throw new Error(_0x39e82a(0x146)+_0x13a300);}console[_0x39e82a(0x14a)](_0x39e82a(0x155)),console[_0x39e82a(0x14a)]('Parsed\x20Result:',JSON[_0x39e82a(0x17d)](_0x1f5cff,null,0x2)),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x102)](_0x39e82a(0x159),'/create',_0x5e3c0e[_0x39e82a(0x10f)],_0x1f5cff,_0x26d168);if(_0x1f5cff[_0x39e82a(0x139)]){const _0x586998=_0x1f5cff[_0x39e82a(0x184)]||_0x1f5cff[_0x39e82a(0x139)]||_0x39e82a(0x101);console[_0x39e82a(0x139)](_0x39e82a(0x15d)),console['error'](_0x39e82a(0x129),_0x586998),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x106)](_0x39e82a(0x159),'/create','Business\x20Error:\x20'+_0x586998);throw new Error(_0x39e82a(0x17e)+_0x586998);}if(!_0x1f5cff[_0x39e82a(0x110)]||!_0x1f5cff[_0x39e82a(0x13c)]){console['error'](_0x39e82a(0x15a)),console[_0x39e82a(0x139)](_0x39e82a(0x15f)),console['error'](_0x39e82a(0x145),_0x1f5cff),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x106)](_0x39e82a(0x159),'/create',_0x39e82a(0x122));throw new Error(_0x39e82a(0x115));}return console[_0x39e82a(0x14a)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x39e82a(0x14a)](_0x39e82a(0x131),_0x1f5cff['gateway_payment_id']),console[_0x39e82a(0x14a)](_0x39e82a(0x149),_0x1f5cff[_0x39e82a(0x110)]),console[_0x39e82a(0x14a)](_0x39e82a(0x16c),_0x1df685,_0x39e82a(0x130)),{'gateway_payment_id':_0x1f5cff['gateway_payment_id'],'payment_url':_0x1f5cff['payment_url']};}catch(_0x16a20e){console[_0x39e82a(0x139)](_0x39e82a(0x16b)),console[_0x39e82a(0x139)]('Error\x20details:',_0x16a20e),loggerService_1[_0x39e82a(0x160)][_0x39e82a(0x106)](_0x39e82a(0x159),_0x39e82a(0x10e),_0x16a20e);if(_0x16a20e instanceof Error){console[_0x39e82a(0x139)](_0x39e82a(0x16f),_0x16a20e['message']),console[_0x39e82a(0x139)]('Error\x20stack:',_0x16a20e[_0x39e82a(0x162)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x16a20e[_0x39e82a(0x184)]);}throw new Error(_0x39e82a(0x13e));}}async[a38_0x1f95c6(0x128)](_0x5f51ca){const _0x18c989=a38_0x1f95c6,_0x556a40=Date[_0x18c989(0x166)]();try{console['log'](_0x18c989(0x183)+_0x5f51ca);const _0xd9d734={'gatewayPaymentId':_0x5f51ca};loggerService_1[_0x18c989(0x160)][_0x18c989(0x11d)](_0x18c989(0x159),'/status',_0x18c989(0x154),_0xd9d734);const _0x558c77=await fetch(this[_0x18c989(0x151)],{'method':'POST','headers':{'Content-Type':_0x18c989(0x117),'Accept':_0x18c989(0x117),'User-Agent':_0x18c989(0x125)},'body':JSON[_0x18c989(0x17d)](_0xd9d734)}),_0x5b071e=Date[_0x18c989(0x166)]()-_0x556a40;console[_0x18c989(0x14a)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x18c989(0x14a)](_0x18c989(0x163),_0x558c77[_0x18c989(0x10f)]),console['log'](_0x18c989(0x152),_0x5b071e+'ms');if(!_0x558c77['ok']){const _0x455b44=await _0x558c77[_0x18c989(0x10b)]();console['error'](_0x18c989(0x107),_0x558c77[_0x18c989(0x10f)]),console[_0x18c989(0x139)]('Response\x20Body:',_0x455b44),loggerService_1[_0x18c989(0x160)][_0x18c989(0x102)](_0x18c989(0x159),_0x18c989(0x180),_0x558c77['status'],_0x455b44,_0x5b071e),loggerService_1[_0x18c989(0x160)]['logWhiteDomainError'](_0x18c989(0x159),_0x18c989(0x180),_0x18c989(0x182)+_0x558c77[_0x18c989(0x10f)]+':\x20'+_0x455b44);throw new Error(_0x18c989(0x10d)+_0x558c77[_0x18c989(0x10f)]);}const _0x41f32c=await _0x558c77[_0x18c989(0x10b)]();console[_0x18c989(0x14a)](_0x18c989(0x135),_0x41f32c);let _0x30f16a;try{_0x30f16a=JSON['parse'](_0x41f32c);}catch(_0x14f33d){console[_0x18c989(0x139)](_0x18c989(0x109),_0x14f33d),loggerService_1['loggerService'][_0x18c989(0x106)](_0x18c989(0x159),_0x18c989(0x180),_0x18c989(0x177)+_0x14f33d);throw new Error(_0x18c989(0x181)+_0x41f32c);}loggerService_1[_0x18c989(0x160)]['logWhiteDomainResponse'](_0x18c989(0x159),_0x18c989(0x180),_0x558c77[_0x18c989(0x10f)],_0x30f16a,_0x5b071e),console['log'](_0x18c989(0x158)),console[_0x18c989(0x14a)]('Result:',_0x30f16a[_0x18c989(0x165)]),console[_0x18c989(0x14a)](_0x18c989(0x16d),_0x30f16a[_0x18c989(0x185)]),console[_0x18c989(0x14a)](_0x18c989(0x13f),_0x30f16a[_0x18c989(0x100)]?.[_0x18c989(0x169)]),console[_0x18c989(0x14a)](_0x18c989(0x16c),_0x30f16a[_0x18c989(0x100)]?.['Amount']),console[_0x18c989(0x14a)](_0x18c989(0x142),_0x30f16a[_0x18c989(0x100)]?.[_0x18c989(0x156)]);if(_0x30f16a['result']!==_0x18c989(0x175)||_0x30f16a['status_code']!==0xc8){const _0x2d14ab=_0x30f16a['message']||_0x18c989(0x12a);console[_0x18c989(0x139)](_0x18c989(0x150)),console[_0x18c989(0x139)]('Error\x20Message:',_0x2d14ab),loggerService_1[_0x18c989(0x160)][_0x18c989(0x106)]('cointopay',_0x18c989(0x180),'Status\x20API\x20Error:\x20'+_0x2d14ab);throw new Error(_0x18c989(0x111)+_0x2d14ab);}if(!_0x30f16a[_0x18c989(0x100)]){console[_0x18c989(0x139)](_0x18c989(0x14b)),console['error'](_0x18c989(0xff)),loggerService_1['loggerService'][_0x18c989(0x106)](_0x18c989(0x159),_0x18c989(0x180),_0x18c989(0x120));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0xcf388c=_0x18c989(0x113);switch(_0x30f16a[_0x18c989(0x100)][_0x18c989(0x169)]?.[_0x18c989(0xfd)]()){case _0x18c989(0x11c):_0xcf388c=_0x18c989(0x10c);break;case _0x18c989(0x12d):case'failed':case _0x18c989(0x139):_0xcf388c=_0x18c989(0x108);break;case _0x18c989(0x138):case _0x18c989(0x13d):_0xcf388c=_0x18c989(0x17b);break;case _0x18c989(0x17f):case _0x18c989(0x17c):case _0x18c989(0x126):case _0x18c989(0x114):default:_0xcf388c='PENDING';break;}let _0x2375b4,_0x2d9633;if(_0x30f16a[_0x18c989(0x100)][_0x18c989(0x143)]){const _0x18c4be=_0x30f16a['data'][_0x18c989(0x143)];console[_0x18c989(0x14a)](_0x18c989(0x118),_0x18c4be);const _0x34d745=_0x18c4be[_0x18c989(0x14d)](/IBAN\s+([A-Z0-9]+)/i);_0x34d745&&(_0x2375b4=_0x34d745[0x1],console[_0x18c989(0x14a)](_0x18c989(0x164),_0x2375b4)),_0x2d9633=_0x18c4be;}const _0x30a83f={'iban':_0x2375b4,'bankDetails':_0x2d9633,'transactionId':_0x30f16a['data'][_0x18c989(0x16e)],'coinAddress':_0x30f16a[_0x18c989(0x100)][_0x18c989(0x14f)],'qrCodeUrl':_0x30f16a[_0x18c989(0x100)]['QRCodeURL'],'expiryTime':_0x30f16a['data'][_0x18c989(0x132)],'createdOn':_0x30f16a[_0x18c989(0x100)]['CreatedOn'],'confirmedOn':_0x30f16a['data']['TransactionConfirmedOn']};console[_0x18c989(0x14a)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x18c989(0x14a)](_0x18c989(0x163),_0x30f16a[_0x18c989(0x100)]['Status'],'->',_0xcf388c),console['log'](_0x18c989(0x16c),_0x30f16a[_0x18c989(0x100)][_0x18c989(0x141)],_0x30f16a['data']['inputCurrency']),console[_0x18c989(0x14a)](_0x18c989(0x133),_0x30f16a[_0x18c989(0x100)]['TransactionID']),console[_0x18c989(0x14a)](_0x18c989(0x14c),_0x2375b4||_0x18c989(0x119)),console[_0x18c989(0x14a)](_0x18c989(0x11f),_0x30f16a[_0x18c989(0x100)][_0x18c989(0x16a)]),console[_0x18c989(0x14a)](_0x18c989(0x174),_0x30f16a[_0x18c989(0x100)][_0x18c989(0x104)]||_0x18c989(0x178));if(_0x30f16a[_0x18c989(0x100)]['Status']?.[_0x18c989(0xfd)]()===_0x18c989(0x17c))console[_0x18c989(0x14a)](_0x18c989(0x11b));else _0x30f16a[_0x18c989(0x100)][_0x18c989(0x169)]?.[_0x18c989(0xfd)]()===_0x18c989(0x11c)&&console[_0x18c989(0x14a)](_0x18c989(0x15c));return{'status':_0xcf388c,'amount':parseFloat(_0x30f16a[_0x18c989(0x100)][_0x18c989(0x141)])||undefined,'currency':_0x30f16a['data'][_0x18c989(0x156)]||_0x18c989(0x130),'paymentDetails':_0x30a83f};}catch(_0x33c942){console['error'](_0x18c989(0x10a),_0x33c942),loggerService_1['loggerService'][_0x18c989(0x106)](_0x18c989(0x159),_0x18c989(0x180),_0x33c942);throw new Error(_0x18c989(0x157)+(_0x33c942 instanceof Error?_0x33c942[_0x18c989(0x184)]:_0x18c989(0x144)));}}async[a38_0x1f95c6(0x12c)](_0x535a69){const _0x1f5039=a38_0x1f95c6,_0x519ba7=await this[_0x1f5039(0x128)](_0x535a69);return{'status':_0x519ba7[_0x1f5039(0x10f)],'amount':_0x519ba7['amount'],'currency':_0x519ba7['currency']};}async[a38_0x1f95c6(0x13a)](_0x404812){const _0x49869d=a38_0x1f95c6;console[_0x49869d(0x14a)](_0x49869d(0x153),_0x404812);let _0x5ac567=_0x49869d(0x113);switch(_0x404812[_0x49869d(0x10f)]?.[_0x49869d(0xfd)]()){case _0x49869d(0x11c):_0x5ac567='PAID';break;case _0x49869d(0x12d):case _0x49869d(0x136):case _0x49869d(0x139):_0x5ac567=_0x49869d(0x108);break;case _0x49869d(0x138):case'timeout':_0x5ac567=_0x49869d(0x17b);break;case _0x49869d(0x126):case _0x49869d(0x17f):case _0x49869d(0x17c):case _0x49869d(0x114):default:_0x5ac567=_0x49869d(0x113);break;}return{'paymentId':_0x404812[_0x49869d(0x148)]||_0x404812[_0x49869d(0x179)]||'','status':_0x5ac567,'amount':_0x404812[_0x49869d(0x176)],'currency':_0x404812[_0x49869d(0x15b)]||_0x49869d(0x130)};}}exports[a38_0x1f95c6(0x161)]=CoinToPayService;