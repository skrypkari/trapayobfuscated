'use strict';const a55_0x17c5d5=a55_0x41e8;(function(_0x1e6d08,_0x5ec6bd){const _0x4c03e3=a55_0x41e8,_0x477e61=_0x1e6d08();while(!![]){try{const _0x5e22b1=-parseInt(_0x4c03e3(0xb7))/0x1+-parseInt(_0x4c03e3(0xf7))/0x2*(parseInt(_0x4c03e3(0x10d))/0x3)+-parseInt(_0x4c03e3(0xfe))/0x4*(parseInt(_0x4c03e3(0xb3))/0x5)+parseInt(_0x4c03e3(0xed))/0x6+-parseInt(_0x4c03e3(0x11d))/0x7+parseInt(_0x4c03e3(0xb2))/0x8+-parseInt(_0x4c03e3(0x126))/0x9*(-parseInt(_0x4c03e3(0xc4))/0xa);if(_0x5e22b1===_0x5ec6bd)break;else _0x477e61['push'](_0x477e61['shift']());}catch(_0x5b7939){_0x477e61['push'](_0x477e61['shift']());}}}(a55_0x2901,0x7fec8));Object[a55_0x17c5d5(0x11f)](exports,a55_0x17c5d5(0x120),{'value':!![]}),exports['CoinToPayService']=void 0x0;function a55_0x41e8(_0x55ec79,_0x5a57ca){_0x55ec79=_0x55ec79-0xa0;const _0x2901ae=a55_0x2901();let _0x41e810=_0x2901ae[_0x55ec79];return _0x41e810;}const loggerService_1=require(a55_0x17c5d5(0xdb));class CoinToPayService{constructor(){const _0x3f37fb=a55_0x17c5d5;this[_0x3f37fb(0xd1)]=_0x3f37fb(0xad),this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x3f37fb(0x12a)](_0x3f37fb(0xe5)),console[_0x3f37fb(0x12a)](_0x3f37fb(0xc8),this[_0x3f37fb(0xde)]);}async[a55_0x17c5d5(0xd7)](_0x1570cb){const _0x417408=a55_0x17c5d5,{orderId:_0x5043cb,amount:_0x875a31}=_0x1570cb;console['log'](_0x417408(0x11c)+_0x875a31+_0x417408(0xa4));const _0x2f4c3e={'amount':_0x875a31},_0x188451=Date[_0x417408(0xc7)]();try{console[_0x417408(0x12a)](_0x417408(0xc5)),console[_0x417408(0x12a)](_0x417408(0xae),this[_0x417408(0xd1)]),console[_0x417408(0x12a)](_0x417408(0xef),JSON[_0x417408(0xe8)](_0x2f4c3e,null,0x2)),console[_0x417408(0x12a)](_0x417408(0xca),_0x875a31,_0x417408(0xcd)),loggerService_1[_0x417408(0x129)][_0x417408(0x109)](_0x417408(0xdc),'/create','POST',_0x2f4c3e);const _0x4391d3=await fetch(this[_0x417408(0xd1)],{'method':_0x417408(0xa9),'headers':{'Content-Type':_0x417408(0xd5),'Accept':_0x417408(0xd5),'User-Agent':_0x417408(0x104)},'body':JSON[_0x417408(0xe8)](_0x2f4c3e)}),_0x44096d=Date[_0x417408(0xc7)]()-_0x188451;console[_0x417408(0x12a)](_0x417408(0x121)),console['log'](_0x417408(0xc6),_0x4391d3[_0x417408(0xb1)]),console[_0x417408(0x12a)](_0x417408(0x119),_0x4391d3[_0x417408(0xe3)]),console['log'](_0x417408(0xfb),Object[_0x417408(0x101)](_0x4391d3[_0x417408(0x105)][_0x417408(0x10a)]())),console[_0x417408(0x12a)](_0x417408(0xa1),_0x44096d+'ms');const _0x1f8659=await _0x4391d3[_0x417408(0xf6)]();console[_0x417408(0x12a)](_0x417408(0xfd),_0x1f8659);if(!_0x4391d3['ok']){console[_0x417408(0x11b)](_0x417408(0xcf)),console['error'](_0x417408(0xe1),_0x4391d3['status']),console[_0x417408(0x11b)](_0x417408(0xff),_0x1f8659),loggerService_1['loggerService'][_0x417408(0xf0)](_0x417408(0xdc),_0x417408(0x110),_0x4391d3[_0x417408(0xb1)],_0x1f8659,_0x44096d),loggerService_1['loggerService'][_0x417408(0x115)](_0x417408(0xdc),'/create',_0x417408(0xd2)+_0x4391d3[_0x417408(0xb1)]+':\x20'+_0x1f8659);throw new Error(_0x417408(0x103)+_0x4391d3[_0x417408(0xb1)]+_0x417408(0xaf)+_0x1f8659);}let _0x25a26e;try{_0x25a26e=JSON[_0x417408(0x117)](_0x1f8659);}catch(_0x47cb3a){console[_0x417408(0x11b)](_0x417408(0xcc),_0x47cb3a),loggerService_1[_0x417408(0x129)][_0x417408(0x115)](_0x417408(0xdc),_0x417408(0x110),_0x417408(0xba)+_0x47cb3a);throw new Error(_0x417408(0xf2)+_0x1f8659);}console['log'](_0x417408(0xe2)),console[_0x417408(0x12a)](_0x417408(0xdd),JSON[_0x417408(0xe8)](_0x25a26e,null,0x2)),loggerService_1[_0x417408(0x129)][_0x417408(0xf0)]('cointopay',_0x417408(0x110),_0x4391d3[_0x417408(0xb1)],_0x25a26e,_0x44096d);if(_0x25a26e[_0x417408(0x11b)]){const _0x3053d6=_0x25a26e['message']||_0x25a26e[_0x417408(0x11b)]||_0x417408(0x114);console[_0x417408(0x11b)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console['error'](_0x417408(0xa5),_0x3053d6),loggerService_1[_0x417408(0x129)]['logWhiteDomainError'](_0x417408(0xdc),_0x417408(0x110),_0x417408(0x108)+_0x3053d6);throw new Error(_0x417408(0xe0)+_0x3053d6);}if(!_0x25a26e['payment_url']||!_0x25a26e[_0x417408(0xbe)]){console[_0x417408(0x11b)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x417408(0x11b)](_0x417408(0xaa)),console[_0x417408(0x11b)]('Response\x20data:',_0x25a26e),loggerService_1[_0x417408(0x129)][_0x417408(0x115)](_0x417408(0xdc),_0x417408(0x110),_0x417408(0xe9));throw new Error(_0x417408(0xc1));}console[_0x417408(0x12a)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console[_0x417408(0x12a)](_0x417408(0xac),_0x25a26e[_0x417408(0xbe)]),console[_0x417408(0x12a)](_0x417408(0xc0),_0x25a26e[_0x417408(0x10f)]);const _0x3af5da=_0x25a26e[_0x417408(0x10f)]+_0x417408(0x100);return console[_0x417408(0x12a)](_0x417408(0xa0),_0x3af5da),console[_0x417408(0x12a)](_0x417408(0xca),_0x875a31,_0x417408(0x11e)),{'gateway_payment_id':_0x25a26e[_0x417408(0xbe)],'payment_url':_0x3af5da};}catch(_0x545906){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console['error'](_0x417408(0xe6),_0x545906),loggerService_1[_0x417408(0x129)][_0x417408(0x115)](_0x417408(0xdc),_0x417408(0x110),_0x545906);if(_0x545906 instanceof Error){console[_0x417408(0x11b)](_0x417408(0x10e),_0x545906[_0x417408(0x10c)]),console['error'](_0x417408(0xf3),_0x545906[_0x417408(0xd8)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x545906['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async[a55_0x17c5d5(0xec)](_0x3a6d83){const _0x44f97b=a55_0x17c5d5,_0x2f3a4a=Date[_0x44f97b(0xc7)]();try{console[_0x44f97b(0x12a)](_0x44f97b(0xf9)+_0x3a6d83);const _0x3d9d53={'gatewayPaymentId':_0x3a6d83};loggerService_1[_0x44f97b(0x129)][_0x44f97b(0x109)](_0x44f97b(0xdc),_0x44f97b(0x111),_0x44f97b(0xa9),_0x3d9d53);const _0x2ffcd3=await fetch(this[_0x44f97b(0xde)],{'method':'POST','headers':{'Content-Type':_0x44f97b(0xd5),'Accept':_0x44f97b(0xd5),'User-Agent':_0x44f97b(0x104)},'body':JSON[_0x44f97b(0xe8)](_0x3d9d53)}),_0x3b1991=Date['now']()-_0x2f3a4a;console[_0x44f97b(0x12a)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x44f97b(0x12a)](_0x44f97b(0xc6),_0x2ffcd3['status']),console[_0x44f97b(0x12a)]('Response\x20Time:',_0x3b1991+'ms');if(!_0x2ffcd3['ok']){const _0x26afd7=await _0x2ffcd3['text']();console[_0x44f97b(0x11b)](_0x44f97b(0xe1),_0x2ffcd3[_0x44f97b(0xb1)]),console['error'](_0x44f97b(0xff),_0x26afd7),loggerService_1[_0x44f97b(0x129)]['logWhiteDomainResponse'](_0x44f97b(0xdc),_0x44f97b(0x111),_0x2ffcd3[_0x44f97b(0xb1)],_0x26afd7,_0x3b1991),loggerService_1[_0x44f97b(0x129)][_0x44f97b(0x115)]('cointopay',_0x44f97b(0x111),_0x44f97b(0xd2)+_0x2ffcd3[_0x44f97b(0xb1)]+':\x20'+_0x26afd7);throw new Error('HTTP\x20error!\x20status:\x20'+_0x2ffcd3[_0x44f97b(0xb1)]);}const _0xb84227=await _0x2ffcd3[_0x44f97b(0xf6)]();console[_0x44f97b(0x12a)]('Raw\x20Response\x20Body:',_0xb84227);let _0x54ce36;try{_0x54ce36=JSON['parse'](_0xb84227);}catch(_0x534591){console[_0x44f97b(0x11b)](_0x44f97b(0xcc),_0x534591),loggerService_1['loggerService'][_0x44f97b(0x115)]('cointopay','/status','JSON\x20Parse\x20Error:\x20'+_0x534591);throw new Error(_0x44f97b(0x123)+_0xb84227);}loggerService_1['loggerService']['logWhiteDomainResponse'](_0x44f97b(0xdc),_0x44f97b(0x111),_0x2ffcd3['status'],_0x54ce36,_0x3b1991),console[_0x44f97b(0x12a)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x44f97b(0x12a)](_0x44f97b(0xfa),_0x54ce36[_0x44f97b(0x106)]),console[_0x44f97b(0x12a)](_0x44f97b(0xea),_0x54ce36[_0x44f97b(0xeb)]),console[_0x44f97b(0x12a)](_0x44f97b(0xf4),_0x54ce36[_0x44f97b(0x10b)]?.['Status']),console[_0x44f97b(0x12a)](_0x44f97b(0xca),_0x54ce36[_0x44f97b(0x10b)]?.[_0x44f97b(0xee)]),console[_0x44f97b(0x12a)]('Currency:',_0x54ce36['data']?.[_0x44f97b(0xbc)]);if(_0x54ce36['result']!=='success'||_0x54ce36[_0x44f97b(0xeb)]!==0xc8){const _0x3c503f=_0x54ce36[_0x44f97b(0x10c)]||_0x44f97b(0xbb);console['error'](_0x44f97b(0x116)),console[_0x44f97b(0x11b)](_0x44f97b(0xa5),_0x3c503f),loggerService_1[_0x44f97b(0x129)][_0x44f97b(0x115)]('cointopay','/status',_0x44f97b(0xf1)+_0x3c503f);throw new Error(_0x44f97b(0x118)+_0x3c503f);}if(!_0x54ce36[_0x44f97b(0x10b)]){console['error'](_0x44f97b(0xb5)),console[_0x44f97b(0x11b)](_0x44f97b(0x113)),loggerService_1['loggerService'][_0x44f97b(0x115)](_0x44f97b(0xdc),_0x44f97b(0x111),_0x44f97b(0x122));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x3456bf=_0x44f97b(0x124);switch(_0x54ce36['data']['Status']?.[_0x44f97b(0xda)]()){case _0x44f97b(0xb9):_0x3456bf=_0x44f97b(0xa8);break;case'cancelled':case _0x44f97b(0xe7):case _0x44f97b(0x11b):_0x3456bf='FAILED';break;case'expired':case _0x44f97b(0xd9):_0x3456bf=_0x44f97b(0xb8);break;case _0x44f97b(0xe4):case _0x44f97b(0xd6):case _0x44f97b(0xa3):case _0x44f97b(0xbf):default:_0x3456bf=_0x44f97b(0x124);break;}let _0x3ac16b,_0x1ed8c3;if(_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xc2)]){const _0x5c7438=_0x54ce36['data']['PaymentDetail'];console['log'](_0x44f97b(0x128),_0x5c7438);const _0x35390a=_0x5c7438[_0x44f97b(0xab)](/IBAN\s+([A-Z0-9]+)/i);_0x35390a&&(_0x3ac16b=_0x35390a[0x1],console[_0x44f97b(0x12a)](_0x44f97b(0xfc),_0x3ac16b)),_0x1ed8c3=_0x5c7438;}const _0xff5c43={'iban':_0x3ac16b,'bankDetails':_0x1ed8c3,'transactionId':_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0x12b)],'coinAddress':_0x54ce36['data'][_0x44f97b(0x127)],'qrCodeUrl':_0x54ce36[_0x44f97b(0x10b)]['QRCodeURL'],'expiryTime':_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0x107)],'createdOn':_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xf5)],'confirmedOn':_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0x125)]};console[_0x44f97b(0x12a)](_0x44f97b(0xd3)),console[_0x44f97b(0x12a)](_0x44f97b(0xc6),_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xb4)],'->',_0x3456bf),console[_0x44f97b(0x12a)](_0x44f97b(0xca),_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xee)],_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xbc)]),console[_0x44f97b(0x12a)](_0x44f97b(0xa6),_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0x12b)]),console[_0x44f97b(0x12a)](_0x44f97b(0xc3),_0x3ac16b||_0x44f97b(0x12c)),console[_0x44f97b(0x12a)](_0x44f97b(0xdf),_0x54ce36[_0x44f97b(0x10b)]['CreatedOn']),console[_0x44f97b(0x12a)](_0x44f97b(0xc9),_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0x125)]||_0x44f97b(0x102));if(_0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xb4)]?.[_0x44f97b(0xda)]()===_0x44f97b(0xd6))console[_0x44f97b(0x12a)](_0x44f97b(0xa2));else _0x54ce36[_0x44f97b(0x10b)][_0x44f97b(0xb4)]?.['toLowerCase']()===_0x44f97b(0xb9)&&console['log'](_0x44f97b(0xce));return{'status':_0x3456bf,'amount':parseFloat(_0x54ce36['data']['Amount'])||undefined,'currency':_0x54ce36['data'][_0x44f97b(0xbc)]||_0x44f97b(0x11e),'paymentDetails':_0xff5c43};}catch(_0x84a743){console[_0x44f97b(0x11b)](_0x44f97b(0xb0),_0x84a743),loggerService_1[_0x44f97b(0x129)][_0x44f97b(0x115)](_0x44f97b(0xdc),_0x44f97b(0x111),_0x84a743);throw new Error(_0x44f97b(0xd0)+(_0x84a743 instanceof Error?_0x84a743[_0x44f97b(0x10c)]:_0x44f97b(0xa7)));}}async['verifyPayment'](_0x15e991){const _0x2d8ad2=a55_0x17c5d5,_0x3b5877=await this[_0x2d8ad2(0xec)](_0x15e991);return{'status':_0x3b5877[_0x2d8ad2(0xb1)],'amount':_0x3b5877[_0x2d8ad2(0x11a)],'currency':_0x3b5877[_0x2d8ad2(0xf8)]};}async[a55_0x17c5d5(0xcb)](_0x48161a){const _0x37e707=a55_0x17c5d5;console[_0x37e707(0x12a)](_0x37e707(0xbd),_0x48161a);let _0x869ffc='PENDING';switch(_0x48161a[_0x37e707(0xb1)]?.[_0x37e707(0xda)]()){case _0x37e707(0xb9):_0x869ffc=_0x37e707(0xa8);break;case _0x37e707(0xd4):case _0x37e707(0xe7):case _0x37e707(0x11b):_0x869ffc=_0x37e707(0x12d);break;case'expired':case'timeout':_0x869ffc=_0x37e707(0xb8);break;case _0x37e707(0xa3):case'waiting':case _0x37e707(0xd6):case _0x37e707(0xbf):default:_0x869ffc=_0x37e707(0x124);break;}return{'paymentId':_0x48161a[_0x37e707(0x112)]||_0x48161a['merchant_reference_id']||'','status':_0x869ffc,'amount':_0x48161a['amount'],'currency':_0x48161a['currency']||_0x37e707(0x11e)};}}exports[a55_0x17c5d5(0xb6)]=CoinToPayService;function a55_0x2901(){const _0x400a1f=['Amount:','processWebhook','Failed\x20to\x20parse\x20JSON\x20response:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','===\x20COINTOPAY\x20API\x20ERROR\x20===','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','apiUrl','HTTP\x20','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','cancelled','application/json','awaiting\x20fiat','createPaymentLink','stack','timeout','toLowerCase','../loggerService','cointopay','Parsed\x20Result:','statusUrl','Created\x20On:','CoinToPay\x20API\x20error:\x20','HTTP\x20Status:','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','statusText','waiting','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Error\x20details:','failed','stringify','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Status\x20Code:','status_code','checkPaymentStatus','697500dPkcnF','Amount','Request\x20Body:','logWhiteDomainResponse','Status\x20API\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Error\x20stack:','Payment\x20Status:','CreatedOn','text','219606aZOSgZ','currency','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Result:','Headers:','üè¶\x20Extracted\x20IBAN:','Raw\x20Response\x20Body:','172OuZpkw','Response\x20Body:','&alternative=false','fromEntries','not\x20confirmed','HTTP\x20error!\x20status:\x20','Payment\x20System/1.0','headers','result','ExpiryTime','Business\x20Error:\x20','logWhiteDomainRequest','entries','data','message','21BGlCFJ','Error\x20message:','payment_url','/create','/status','order_id','Missing\x20data\x20in\x20response','Unknown\x20error\x20from\x20CoinToPay\x20API','logWhiteDomainError','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','parse','CoinToPay\x20status\x20API\x20error:\x20','Status\x20Text:','amount','error','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','7094136hoZJSa','EUR','defineProperty','__esModule','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','Incomplete\x20response:\x20missing\x20data','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','PENDING','TransactionConfirmedOn','90PMTliz','coinAddress','üè¶\x20Payment\x20Detail:','loggerService','log','TransactionID','not\x20found','FAILED','Payment\x20URL\x20(modified):','Response\x20Time:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','pending','\x20EUR','Error\x20Message:','Transaction\x20ID:','Unknown\x20error','PAID','POST','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','match','Gateway\x20Payment\x20ID:','https://tesoft.uk/gateway/cointopay/','URL:',',\x20body:\x20','CoinToPay\x20payment\x20status\x20check\x20error:','status','4355728dHrAsD','27070xdgLAI','Status','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','CoinToPayService','601179UDFsjT','EXPIRED','paid','JSON\x20Parse\x20Error:\x20','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','inputCurrency','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','gateway_payment_id','created','Payment\x20URL\x20(original):','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','PaymentDetail','IBAN:','2479310moltoE','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Status:','now','üìä\x20Status\x20check\x20URL:','Confirmed\x20On:'];a55_0x2901=function(){return _0x400a1f;};return a55_0x2901();}