'use strict';const a44_0x2792c0=a44_0x44f2;function a44_0x44f2(_0x68a195,_0x410a00){const _0x56f54a=a44_0x56f5();return a44_0x44f2=function(_0x44f213,_0xebdda7){_0x44f213=_0x44f213-0x145;let _0x3ad5cd=_0x56f54a[_0x44f213];return _0x3ad5cd;},a44_0x44f2(_0x68a195,_0x410a00);}(function(_0x5e2f2a,_0x16182d){const _0x18a1ae=a44_0x44f2,_0xf5a2e6=_0x5e2f2a();while(!![]){try{const _0x320a0b=parseInt(_0x18a1ae(0x18e))/0x1+-parseInt(_0x18a1ae(0x164))/0x2+-parseInt(_0x18a1ae(0x1ab))/0x3*(parseInt(_0x18a1ae(0x19e))/0x4)+parseInt(_0x18a1ae(0x1a4))/0x5*(parseInt(_0x18a1ae(0x196))/0x6)+parseInt(_0x18a1ae(0x1ae))/0x7+parseInt(_0x18a1ae(0x15a))/0x8+-parseInt(_0x18a1ae(0x16e))/0x9;if(_0x320a0b===_0x16182d)break;else _0xf5a2e6['push'](_0xf5a2e6['shift']());}catch(_0xe7233b){_0xf5a2e6['push'](_0xf5a2e6['shift']());}}}(a44_0x56f5,0xc7631));Object[a44_0x2792c0(0x18c)](exports,a44_0x2792c0(0x170),{'value':!![]}),exports[a44_0x2792c0(0x165)]=void 0x0;function a44_0x56f5(){const _0xf08409=['üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','28266498AtdEwo','QRCodeURL','__esModule','PaymentDetail','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','now','not\x20found','üè¶\x20Payment\x20Detail:','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Response\x20Body:','../loggerService','success','stringify','Status\x20API\x20Error:\x20','cointopay','match','paid','CoinToPay\x20API\x20error:\x20','payment_url','headers','Unknown\x20error','Headers:','Error\x20details:','===\x20COINTOPAY\x20API\x20ERROR\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','created','FAILED','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','defineProperty','statusUrl','526274OZkWeH','Status\x20Text:','Gateway\x20Payment\x20ID:','result','parse','cancelled',',\x20body:\x20','TransactionConfirmedOn','6IfRHyO','loggerService','pending','Response\x20data:','text','logWhiteDomainRequest','PENDING','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','16yjtZdU','error','expired','Business\x20Error:\x20','JSON\x20Parse\x20Error:\x20','EUR','7939990nBCXqA','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','status','currency','Payment\x20URL:','apiUrl','status_code','199371otVYeP','CreatedOn','HTTP\x20error!\x20status:\x20','7086485qpJoqd','awaiting\x20fiat','application/json','waiting','logWhiteDomainResponse','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Created\x20On:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','HTTP\x20','inputCurrency','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Result:','Amount:','failed','amount','data','Status\x20Code:','logWhiteDomainError','Unknown\x20error\x20from\x20CoinToPay\x20API','coinAddress','message','toLowerCase','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','EXPIRED','TransactionID','log','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','merchant_reference_id','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','/status','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20Message:','/create','Raw\x20Response\x20Body:','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','createPaymentLink','ExpiryTime','fromEntries','statusText','9298720bNzcfr','Currency:','Status','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','checkPaymentStatus','processWebhook','Failed\x20to\x20parse\x20JSON\x20response:','gateway_payment_id','timeout','üè¶\x20Extracted\x20IBAN:','131456ncoRaQ','CoinToPayService','HTTP\x20Status:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Response\x20Time:','Amount','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','POST','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'];a44_0x56f5=function(){return _0xf08409;};return a44_0x56f5();}const loggerService_1=require(a44_0x2792c0(0x17a));class CoinToPayService{constructor(){const _0x378ee9=a44_0x2792c0;this['apiUrl']='https://tesoft.uk/gateway/cointopay/',this['statusUrl']='https://tesoft.uk/gateway/cointopay/status.php',console[_0x378ee9(0x14b)](_0x378ee9(0x172)),console[_0x378ee9(0x14b)]('üìä\x20Status\x20check\x20URL:',this[_0x378ee9(0x18d)]);}async[a44_0x2792c0(0x156)](_0xd394d0){const _0x2ef9a4=a44_0x2792c0,{orderId:_0x1da994,amount:_0xee212c}=_0xd394d0;console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x19d)+_0xee212c+'\x20EUR');const _0x1b9055={'amount':_0xee212c},_0x45df8f=Date[_0x2ef9a4(0x175)]();try{console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x16a)),console['log']('URL:',this[_0x2ef9a4(0x1a9)]),console[_0x2ef9a4(0x14b)]('Request\x20Body:',JSON[_0x2ef9a4(0x17c)](_0x1b9055,null,0x2)),console['log'](_0x2ef9a4(0x1ba),_0xee212c,_0x2ef9a4(0x178)),loggerService_1['loggerService']['logWhiteDomainRequest'](_0x2ef9a4(0x17e),_0x2ef9a4(0x153),'POST',_0x1b9055);const _0x2a0f8e=await fetch(this[_0x2ef9a4(0x1a9)],{'method':'POST','headers':{'Content-Type':_0x2ef9a4(0x1b0),'Accept':_0x2ef9a4(0x1b0),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x1b9055)}),_0x29c4d3=Date[_0x2ef9a4(0x175)]()-_0x45df8f;console[_0x2ef9a4(0x14b)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x2ef9a4(0x14b)]('Status:',_0x2a0f8e['status']),console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x18f),_0x2a0f8e[_0x2ef9a4(0x159)]),console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x185),Object[_0x2ef9a4(0x158)](_0x2a0f8e[_0x2ef9a4(0x183)]['entries']())),console['log'](_0x2ef9a4(0x168),_0x29c4d3+'ms');const _0x3874c2=await _0x2a0f8e[_0x2ef9a4(0x19a)]();console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x154),_0x3874c2);if(!_0x2a0f8e['ok']){console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x187)),console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x166),_0x2a0f8e[_0x2ef9a4(0x1a6)]),console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x179),_0x3874c2),loggerService_1['loggerService'][_0x2ef9a4(0x1b2)](_0x2ef9a4(0x17e),_0x2ef9a4(0x153),_0x2a0f8e[_0x2ef9a4(0x1a6)],_0x3874c2,_0x29c4d3),loggerService_1[_0x2ef9a4(0x197)]['logWhiteDomainError'](_0x2ef9a4(0x17e),_0x2ef9a4(0x153),'HTTP\x20'+_0x2a0f8e[_0x2ef9a4(0x1a6)]+':\x20'+_0x3874c2);throw new Error(_0x2ef9a4(0x1ad)+_0x2a0f8e['status']+_0x2ef9a4(0x194)+_0x3874c2);}let _0x45b15a;try{_0x45b15a=JSON[_0x2ef9a4(0x192)](_0x3874c2);}catch(_0x33451f){console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x160),_0x33451f),loggerService_1[_0x2ef9a4(0x197)][_0x2ef9a4(0x1bf)]('cointopay',_0x2ef9a4(0x153),_0x2ef9a4(0x1a2)+_0x33451f);throw new Error(_0x2ef9a4(0x14f)+_0x3874c2);}console['log'](_0x2ef9a4(0x1a5)),console[_0x2ef9a4(0x14b)]('Parsed\x20Result:',JSON[_0x2ef9a4(0x17c)](_0x45b15a,null,0x2)),loggerService_1[_0x2ef9a4(0x197)][_0x2ef9a4(0x1b2)]('cointopay',_0x2ef9a4(0x153),_0x2a0f8e[_0x2ef9a4(0x1a6)],_0x45b15a,_0x29c4d3);if(_0x45b15a[_0x2ef9a4(0x19f)]){const _0x5b3054=_0x45b15a['message']||_0x45b15a[_0x2ef9a4(0x19f)]||_0x2ef9a4(0x1c0);console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x1b5)),console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x152),_0x5b3054),loggerService_1['loggerService'][_0x2ef9a4(0x1bf)](_0x2ef9a4(0x17e),_0x2ef9a4(0x153),_0x2ef9a4(0x1a1)+_0x5b3054);throw new Error(_0x2ef9a4(0x181)+_0x5b3054);}if(!_0x45b15a[_0x2ef9a4(0x182)]||!_0x45b15a['gateway_payment_id']){console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x14e)),console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x1b8)),console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x199),_0x45b15a),loggerService_1['loggerService']['logWhiteDomainError'](_0x2ef9a4(0x17e),_0x2ef9a4(0x153),_0x2ef9a4(0x151));throw new Error(_0x2ef9a4(0x1b3));}return console[_0x2ef9a4(0x14b)]('===\x20COINTOPAY\x20SUCCESS\x20==='),console['log'](_0x2ef9a4(0x190),_0x45b15a['gateway_payment_id']),console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x1a8),_0x45b15a[_0x2ef9a4(0x182)]),console[_0x2ef9a4(0x14b)](_0x2ef9a4(0x1ba),_0xee212c,_0x2ef9a4(0x1a3)),{'gateway_payment_id':_0x45b15a[_0x2ef9a4(0x161)],'payment_url':_0x45b15a['payment_url']};}catch(_0x53dbf6){console[_0x2ef9a4(0x19f)](_0x2ef9a4(0x15d)),console['error'](_0x2ef9a4(0x186),_0x53dbf6),loggerService_1[_0x2ef9a4(0x197)][_0x2ef9a4(0x1bf)]('cointopay',_0x2ef9a4(0x153),_0x53dbf6);if(_0x53dbf6 instanceof Error){console[_0x2ef9a4(0x19f)]('Error\x20message:',_0x53dbf6[_0x2ef9a4(0x146)]),console[_0x2ef9a4(0x19f)]('Error\x20stack:',_0x53dbf6['stack']);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x53dbf6[_0x2ef9a4(0x146)]);}throw new Error(_0x2ef9a4(0x167));}}async[a44_0x2792c0(0x15e)](_0x17645e){const _0x5cbb2d=a44_0x2792c0,_0x3cd7b0=Date[_0x5cbb2d(0x175)]();try{console['log'](_0x5cbb2d(0x16c)+_0x17645e);const _0x550f8c={'gatewayPaymentId':_0x17645e};loggerService_1[_0x5cbb2d(0x197)][_0x5cbb2d(0x19b)](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),_0x5cbb2d(0x16b),_0x550f8c);const _0x85e327=await fetch(this[_0x5cbb2d(0x18d)],{'method':_0x5cbb2d(0x16b),'headers':{'Content-Type':_0x5cbb2d(0x1b0),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x5cbb2d(0x17c)](_0x550f8c)}),_0x482dca=Date[_0x5cbb2d(0x175)]()-_0x3cd7b0;console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x18b)),console[_0x5cbb2d(0x14b)]('Status:',_0x85e327[_0x5cbb2d(0x1a6)]),console['log'](_0x5cbb2d(0x168),_0x482dca+'ms');if(!_0x85e327['ok']){const _0x7eb572=await _0x85e327[_0x5cbb2d(0x19a)]();console['error'](_0x5cbb2d(0x166),_0x85e327[_0x5cbb2d(0x1a6)]),console['error']('Response\x20Body:',_0x7eb572),loggerService_1['loggerService'][_0x5cbb2d(0x1b2)](_0x5cbb2d(0x17e),'/status',_0x85e327[_0x5cbb2d(0x1a6)],_0x7eb572,_0x482dca),loggerService_1['loggerService'][_0x5cbb2d(0x1bf)](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),_0x5cbb2d(0x1b6)+_0x85e327['status']+':\x20'+_0x7eb572);throw new Error('HTTP\x20error!\x20status:\x20'+_0x85e327[_0x5cbb2d(0x1a6)]);}const _0x2e1785=await _0x85e327['text']();console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x154),_0x2e1785);let _0x523252;try{_0x523252=JSON[_0x5cbb2d(0x192)](_0x2e1785);}catch(_0x4a486d){console[_0x5cbb2d(0x19f)](_0x5cbb2d(0x160),_0x4a486d),loggerService_1[_0x5cbb2d(0x197)][_0x5cbb2d(0x1bf)](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),_0x5cbb2d(0x1a2)+_0x4a486d);throw new Error(_0x5cbb2d(0x188)+_0x2e1785);}loggerService_1[_0x5cbb2d(0x197)]['logWhiteDomainResponse'](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),_0x85e327['status'],_0x523252,_0x482dca),console[_0x5cbb2d(0x14b)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console['log'](_0x5cbb2d(0x1b9),_0x523252[_0x5cbb2d(0x191)]),console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x1be),_0x523252[_0x5cbb2d(0x1aa)]),console[_0x5cbb2d(0x14b)]('Payment\x20Status:',_0x523252[_0x5cbb2d(0x1bd)]?.[_0x5cbb2d(0x15c)]),console['log'](_0x5cbb2d(0x1ba),_0x523252[_0x5cbb2d(0x1bd)]?.[_0x5cbb2d(0x169)]),console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x15b),_0x523252[_0x5cbb2d(0x1bd)]?.[_0x5cbb2d(0x1b7)]);if(_0x523252[_0x5cbb2d(0x191)]!==_0x5cbb2d(0x17b)||_0x523252[_0x5cbb2d(0x1aa)]!==0xc8){const _0x566cdc=_0x523252[_0x5cbb2d(0x146)]||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x5cbb2d(0x19f)]('===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20==='),console[_0x5cbb2d(0x19f)](_0x5cbb2d(0x152),_0x566cdc),loggerService_1[_0x5cbb2d(0x197)][_0x5cbb2d(0x1bf)](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),_0x5cbb2d(0x17d)+_0x566cdc);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x566cdc);}if(!_0x523252[_0x5cbb2d(0x1bd)]){console[_0x5cbb2d(0x19f)](_0x5cbb2d(0x174)),console[_0x5cbb2d(0x19f)]('Missing\x20data\x20in\x20response'),loggerService_1[_0x5cbb2d(0x197)][_0x5cbb2d(0x1bf)](_0x5cbb2d(0x17e),_0x5cbb2d(0x150),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x5cbb2d(0x14c));}let _0x1949d9=_0x5cbb2d(0x19c);switch(_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x15c)]?.[_0x5cbb2d(0x147)]()){case _0x5cbb2d(0x180):_0x1949d9='PAID';break;case _0x5cbb2d(0x193):case'failed':case _0x5cbb2d(0x19f):_0x1949d9=_0x5cbb2d(0x18a);break;case _0x5cbb2d(0x1a0):case'timeout':_0x1949d9=_0x5cbb2d(0x149);break;case _0x5cbb2d(0x1b1):case'awaiting\x20fiat':case _0x5cbb2d(0x198):case _0x5cbb2d(0x189):default:_0x1949d9=_0x5cbb2d(0x19c);break;}let _0x3cec0d,_0x200b51;if(_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x171)]){const _0xb1a667=_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x171)];console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x177),_0xb1a667);const _0x81cc5b=_0xb1a667[_0x5cbb2d(0x17f)](/IBAN\s+([A-Z0-9]+)/i);_0x81cc5b&&(_0x3cec0d=_0x81cc5b[0x1],console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x163),_0x3cec0d)),_0x200b51=_0xb1a667;}const _0x316a16={'iban':_0x3cec0d,'bankDetails':_0x200b51,'transactionId':_0x523252['data'][_0x5cbb2d(0x14a)],'coinAddress':_0x523252['data'][_0x5cbb2d(0x145)],'qrCodeUrl':_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x16f)],'expiryTime':_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x157)],'createdOn':_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x1ac)],'confirmedOn':_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x195)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console['log']('Status:',_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x15c)],'->',_0x1949d9),console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x1ba),_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x169)],_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x1b7)]),console[_0x5cbb2d(0x14b)]('Transaction\x20ID:',_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x14a)]),console[_0x5cbb2d(0x14b)]('IBAN:',_0x3cec0d||_0x5cbb2d(0x176)),console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x1b4),_0x523252['data'][_0x5cbb2d(0x1ac)]),console[_0x5cbb2d(0x14b)]('Confirmed\x20On:',_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x195)]||'not\x20confirmed');if(_0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x15c)]?.['toLowerCase']()===_0x5cbb2d(0x1af))console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x16d));else _0x523252[_0x5cbb2d(0x1bd)][_0x5cbb2d(0x15c)]?.[_0x5cbb2d(0x147)]()===_0x5cbb2d(0x180)&&console[_0x5cbb2d(0x14b)](_0x5cbb2d(0x155));return{'status':_0x1949d9,'amount':parseFloat(_0x523252['data'][_0x5cbb2d(0x169)])||undefined,'currency':_0x523252['data'][_0x5cbb2d(0x1b7)]||_0x5cbb2d(0x1a3),'paymentDetails':_0x316a16};}catch(_0x5beeec){console[_0x5cbb2d(0x19f)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x5beeec),loggerService_1['loggerService'][_0x5cbb2d(0x1bf)](_0x5cbb2d(0x17e),'/status',_0x5beeec);throw new Error(_0x5cbb2d(0x148)+(_0x5beeec instanceof Error?_0x5beeec[_0x5cbb2d(0x146)]:_0x5cbb2d(0x184)));}}async['verifyPayment'](_0x5ee022){const _0x580e60=a44_0x2792c0,_0x4aa0df=await this[_0x580e60(0x15e)](_0x5ee022);return{'status':_0x4aa0df[_0x580e60(0x1a6)],'amount':_0x4aa0df['amount'],'currency':_0x4aa0df[_0x580e60(0x1a7)]};}async[a44_0x2792c0(0x15f)](_0x4c3505){const _0x29fb4c=a44_0x2792c0;console['log'](_0x29fb4c(0x173),_0x4c3505);let _0x2b9141='PENDING';switch(_0x4c3505[_0x29fb4c(0x1a6)]?.[_0x29fb4c(0x147)]()){case _0x29fb4c(0x180):_0x2b9141='PAID';break;case _0x29fb4c(0x193):case _0x29fb4c(0x1bb):case _0x29fb4c(0x19f):_0x2b9141=_0x29fb4c(0x18a);break;case'expired':case _0x29fb4c(0x162):_0x2b9141=_0x29fb4c(0x149);break;case _0x29fb4c(0x198):case'waiting':case _0x29fb4c(0x1af):case _0x29fb4c(0x189):default:_0x2b9141=_0x29fb4c(0x19c);break;}return{'paymentId':_0x4c3505['order_id']||_0x4c3505[_0x29fb4c(0x14d)]||'','status':_0x2b9141,'amount':_0x4c3505[_0x29fb4c(0x1bc)],'currency':_0x4c3505['currency']||_0x29fb4c(0x1a3)};}}exports[a44_0x2792c0(0x165)]=CoinToPayService;