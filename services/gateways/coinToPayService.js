'use strict';const a49_0x55a0c3=a49_0x7af1;(function(_0x374705,_0x56d977){const _0x556104=a49_0x7af1,_0x4a64b4=_0x374705();while(!![]){try{const _0x2cd4d8=-parseInt(_0x556104(0x1f7))/0x1*(-parseInt(_0x556104(0x1b5))/0x2)+parseInt(_0x556104(0x207))/0x3+parseInt(_0x556104(0x1aa))/0x4+parseInt(_0x556104(0x1f9))/0x5*(parseInt(_0x556104(0x1f8))/0x6)+parseInt(_0x556104(0x1db))/0x7+parseInt(_0x556104(0x193))/0x8*(parseInt(_0x556104(0x1e9))/0x9)+-parseInt(_0x556104(0x1c5))/0xa;if(_0x2cd4d8===_0x56d977)break;else _0x4a64b4['push'](_0x4a64b4['shift']());}catch(_0xf1914d){_0x4a64b4['push'](_0x4a64b4['shift']());}}}(a49_0x3f66,0x8300d));function a49_0x3f66(){const _0x332155=['Unknown\x20error\x20from\x20CoinToPay\x20API','TransactionID','../loggerService','Failed\x20to\x20parse\x20JSON\x20response:','EXPIRED','EUR','8AwxYOS','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','failed','ExpiryTime','/status','Gateway\x20Payment\x20ID:','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','Status\x20API\x20Error:\x20','Currency:','__esModule','parse','===\x20COINTOPAY\x20API\x20ERROR\x20===','Response\x20data:','createPaymentLink','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','gateway_payment_id','fromEntries','Error\x20Message:','HTTP\x20error!\x20status:\x20','logWhiteDomainRequest','üè¶\x20Payment\x20Detail:','success','CreatedOn','2291536mNNvCn','https://tesoft.uk/gateway/cointopay/','/create','Error\x20message:','Created\x20On:','loggerService','Parsed\x20Result:','defineProperty','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','message','verifyPayment','2bYUsPe','status','HTTP\x20Status:','üìä\x20Status\x20check\x20URL:','\x20EUR','Payment\x20System/1.0','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','logWhiteDomainResponse','inputCurrency','Amount','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','coinAddress','Status:','timeout','apiUrl','PaymentDetail','22187490ErQtvh','cancelled','text','cointopay','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','application/json','Result:','expired','payment_url','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','not\x20confirmed','JSON\x20Parse\x20Error:\x20','Response\x20Body:','HTTP\x20','Status','waiting','error','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','checkPaymentStatus','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','created','üè¶\x20Extracted\x20IBAN:','1166641KwYPjm','URL:','Payment\x20Status:','Payment\x20URL\x20(original):','match','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','&alternative=false','amount','result','statusText','Transaction\x20ID:','not\x20found','QRCodeURL','paid','3164193RKfbeq','data','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','CoinToPay\x20API\x20error:\x20','toLowerCase','===\x20COINTOPAY\x20SUCCESS\x20===','statusUrl','PAID','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Incomplete\x20response:\x20missing\x20data','pending','POST','awaiting\x20fiat','status_code','776857sjsDUZ','397644QXxTVC','15tcqBXt','Raw\x20Response\x20Body:','stringify','Request\x20Body:','stack','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','log','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','merchant_reference_id','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Amount:','processWebhook','currency','entries','2065605PRStFW','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','TransactionConfirmedOn','Response\x20Time:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','logWhiteDomainError','Status\x20Code:','Payment\x20URL\x20(modified):','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','PENDING','now','FAILED'];a49_0x3f66=function(){return _0x332155;};return a49_0x3f66();}Object[a49_0x55a0c3(0x1b1)](exports,a49_0x55a0c3(0x19c),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a49_0x55a0c3(0x18f));function a49_0x7af1(_0x53b7ee,_0xd0b7d6){const _0x3f667b=a49_0x3f66();return a49_0x7af1=function(_0x7af153,_0xcb490){_0x7af153=_0x7af153-0x186;let _0x23aff7=_0x3f667b[_0x7af153];return _0x23aff7;},a49_0x7af1(_0x53b7ee,_0xd0b7d6);}class CoinToPayService{constructor(){const _0x2bbdb4=a49_0x55a0c3;this[_0x2bbdb4(0x1c3)]=_0x2bbdb4(0x1ab),this[_0x2bbdb4(0x1ef)]='https://tesoft.uk/gateway/cointopay/status.php',console[_0x2bbdb4(0x1ff)](_0x2bbdb4(0x1d6)),console[_0x2bbdb4(0x1ff)](_0x2bbdb4(0x1b8),this['statusUrl']);}async[a49_0x55a0c3(0x1a0)](_0x2ae160){const _0xfc00d9=a49_0x55a0c3,{orderId:_0x2b8f87,amount:_0x53accb}=_0x2ae160;console['log'](_0xfc00d9(0x1a1)+_0x53accb+_0xfc00d9(0x1b9));const _0x36f7a8={'amount':_0x53accb},_0x30cc92=Date[_0xfc00d9(0x18b)]();try{console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1c9)),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1dc),this[_0xfc00d9(0x1c3)]),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1fc),JSON[_0xfc00d9(0x1fb)](_0x36f7a8,null,0x2)),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x203),_0x53accb,_0xfc00d9(0x1eb)),loggerService_1[_0xfc00d9(0x1af)][_0xfc00d9(0x1a6)](_0xfc00d9(0x1c8),_0xfc00d9(0x1ac),'POST',_0x36f7a8);const _0x400203=await fetch(this[_0xfc00d9(0x1c3)],{'method':'POST','headers':{'Content-Type':'application/json','Accept':'application/json','User-Agent':_0xfc00d9(0x1ba)},'body':JSON[_0xfc00d9(0x1fb)](_0x36f7a8)}),_0xfd1fd=Date['now']()-_0x30cc92;console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1d8)),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1c1),_0x400203[_0xfc00d9(0x1b6)]),console['log']('Status\x20Text:',_0x400203[_0xfc00d9(0x1e4)]),console[_0xfc00d9(0x1ff)]('Headers:',Object[_0xfc00d9(0x1a3)](_0x400203['headers'][_0xfc00d9(0x206)]())),console['log'](_0xfc00d9(0x20a),_0xfd1fd+'ms');const _0x5938c2=await _0x400203['text']();console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1fa),_0x5938c2);if(!_0x400203['ok']){console[_0xfc00d9(0x1d5)](_0xfc00d9(0x19e)),console[_0xfc00d9(0x1d5)](_0xfc00d9(0x1b7),_0x400203[_0xfc00d9(0x1b6)]),console[_0xfc00d9(0x1d5)](_0xfc00d9(0x1d1),_0x5938c2),loggerService_1[_0xfc00d9(0x1af)][_0xfc00d9(0x1bc)](_0xfc00d9(0x1c8),_0xfc00d9(0x1ac),_0x400203[_0xfc00d9(0x1b6)],_0x5938c2,_0xfd1fd),loggerService_1['loggerService'][_0xfc00d9(0x186)](_0xfc00d9(0x1c8),'/create',_0xfc00d9(0x1d2)+_0x400203['status']+':\x20'+_0x5938c2);throw new Error(_0xfc00d9(0x1a5)+_0x400203[_0xfc00d9(0x1b6)]+',\x20body:\x20'+_0x5938c2);}let _0xb0fb46;try{_0xb0fb46=JSON[_0xfc00d9(0x19d)](_0x5938c2);}catch(_0x4d8101){console['error'](_0xfc00d9(0x190),_0x4d8101),loggerService_1[_0xfc00d9(0x1af)]['logWhiteDomainError'](_0xfc00d9(0x1c8),_0xfc00d9(0x1ac),_0xfc00d9(0x1d0)+_0x4d8101);throw new Error(_0xfc00d9(0x1f1)+_0x5938c2);}console['log'](_0xfc00d9(0x1b2)),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x1b0),JSON['stringify'](_0xb0fb46,null,0x2)),loggerService_1[_0xfc00d9(0x1af)]['logWhiteDomainResponse'](_0xfc00d9(0x1c8),_0xfc00d9(0x1ac),_0x400203[_0xfc00d9(0x1b6)],_0xb0fb46,_0xfd1fd);if(_0xb0fb46[_0xfc00d9(0x1d5)]){const _0x568783=_0xb0fb46[_0xfc00d9(0x1b3)]||_0xb0fb46[_0xfc00d9(0x1d5)]||_0xfc00d9(0x18d);console[_0xfc00d9(0x1d5)]('===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20==='),console[_0xfc00d9(0x1d5)](_0xfc00d9(0x1a4),_0x568783),loggerService_1['loggerService']['logWhiteDomainError'](_0xfc00d9(0x1c8),'/create','Business\x20Error:\x20'+_0x568783);throw new Error(_0xfc00d9(0x1ec)+_0x568783);}if(!_0xb0fb46['payment_url']||!_0xb0fb46[_0xfc00d9(0x1a2)]){console[_0xfc00d9(0x1d5)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0xfc00d9(0x1d5)](_0xfc00d9(0x208)),console[_0xfc00d9(0x1d5)](_0xfc00d9(0x19f),_0xb0fb46),loggerService_1[_0xfc00d9(0x1af)][_0xfc00d9(0x186)](_0xfc00d9(0x1c8),_0xfc00d9(0x1ac),'Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0xfc00d9(0x1bf));}console['log'](_0xfc00d9(0x1ee)),console[_0xfc00d9(0x1ff)](_0xfc00d9(0x198),_0xb0fb46[_0xfc00d9(0x1a2)]),console['log'](_0xfc00d9(0x1de),_0xb0fb46[_0xfc00d9(0x1cd)]);const _0x589de8=_0xb0fb46['payment_url']+_0xfc00d9(0x1e1);return console[_0xfc00d9(0x1ff)](_0xfc00d9(0x188),_0x589de8),console['log'](_0xfc00d9(0x203),_0x53accb,_0xfc00d9(0x192)),{'gateway_payment_id':_0xb0fb46['gateway_payment_id'],'payment_url':_0x589de8};}catch(_0x429c60){console[_0xfc00d9(0x1d5)](_0xfc00d9(0x1e0)),console[_0xfc00d9(0x1d5)]('Error\x20details:',_0x429c60),loggerService_1['loggerService'][_0xfc00d9(0x186)]('cointopay','/create',_0x429c60);if(_0x429c60 instanceof Error){console[_0xfc00d9(0x1d5)](_0xfc00d9(0x1ad),_0x429c60[_0xfc00d9(0x1b3)]),console[_0xfc00d9(0x1d5)]('Error\x20stack:',_0x429c60[_0xfc00d9(0x1fd)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x429c60['message']);}throw new Error(_0xfc00d9(0x194));}}async[a49_0x55a0c3(0x1d7)](_0x3c3182){const _0x31a868=a49_0x55a0c3,_0x38aeb1=Date[_0x31a868(0x18b)]();try{console[_0x31a868(0x1ff)](_0x31a868(0x20b)+_0x3c3182);const _0x4c60a3={'gatewayPaymentId':_0x3c3182};loggerService_1[_0x31a868(0x1af)][_0x31a868(0x1a6)]('cointopay',_0x31a868(0x197),'POST',_0x4c60a3);const _0x31e3e8=await fetch(this[_0x31a868(0x1ef)],{'method':_0x31a868(0x1f4),'headers':{'Content-Type':_0x31a868(0x1ca),'Accept':'application/json','User-Agent':_0x31a868(0x1ba)},'body':JSON[_0x31a868(0x1fb)](_0x4c60a3)}),_0x2a572d=Date['now']()-_0x38aeb1;console[_0x31a868(0x1ff)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x31a868(0x1ff)](_0x31a868(0x1c1),_0x31e3e8[_0x31a868(0x1b6)]),console[_0x31a868(0x1ff)]('Response\x20Time:',_0x2a572d+'ms');if(!_0x31e3e8['ok']){const _0x22d6d3=await _0x31e3e8[_0x31a868(0x1c7)]();console[_0x31a868(0x1d5)]('HTTP\x20Status:',_0x31e3e8[_0x31a868(0x1b6)]),console['error'](_0x31a868(0x1d1),_0x22d6d3),loggerService_1[_0x31a868(0x1af)][_0x31a868(0x1bc)](_0x31a868(0x1c8),'/status',_0x31e3e8[_0x31a868(0x1b6)],_0x22d6d3,_0x2a572d),loggerService_1[_0x31a868(0x1af)][_0x31a868(0x186)]('cointopay',_0x31a868(0x197),'HTTP\x20'+_0x31e3e8[_0x31a868(0x1b6)]+':\x20'+_0x22d6d3);throw new Error(_0x31a868(0x1a5)+_0x31e3e8[_0x31a868(0x1b6)]);}const _0x3fb1f6=await _0x31e3e8['text']();console[_0x31a868(0x1ff)](_0x31a868(0x1fa),_0x3fb1f6);let _0x5af9af;try{_0x5af9af=JSON[_0x31a868(0x19d)](_0x3fb1f6);}catch(_0x162498){console[_0x31a868(0x1d5)](_0x31a868(0x190),_0x162498),loggerService_1[_0x31a868(0x1af)][_0x31a868(0x186)](_0x31a868(0x1c8),_0x31a868(0x197),'JSON\x20Parse\x20Error:\x20'+_0x162498);throw new Error(_0x31a868(0x200)+_0x3fb1f6);}loggerService_1[_0x31a868(0x1af)][_0x31a868(0x1bc)]('cointopay','/status',_0x31e3e8[_0x31a868(0x1b6)],_0x5af9af,_0x2a572d),console[_0x31a868(0x1ff)]('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x31a868(0x1ff)](_0x31a868(0x1cb),_0x5af9af[_0x31a868(0x1e3)]),console[_0x31a868(0x1ff)](_0x31a868(0x187),_0x5af9af['status_code']),console[_0x31a868(0x1ff)](_0x31a868(0x1dd),_0x5af9af['data']?.[_0x31a868(0x1d3)]),console[_0x31a868(0x1ff)](_0x31a868(0x203),_0x5af9af[_0x31a868(0x1ea)]?.[_0x31a868(0x1be)]),console[_0x31a868(0x1ff)](_0x31a868(0x19b),_0x5af9af[_0x31a868(0x1ea)]?.[_0x31a868(0x1bd)]);if(_0x5af9af['result']!==_0x31a868(0x1a8)||_0x5af9af[_0x31a868(0x1f6)]!==0xc8){const _0x5c566d=_0x5af9af[_0x31a868(0x1b3)]||_0x31a868(0x189);console[_0x31a868(0x1d5)](_0x31a868(0x202)),console[_0x31a868(0x1d5)](_0x31a868(0x1a4),_0x5c566d),loggerService_1[_0x31a868(0x1af)]['logWhiteDomainError']('cointopay','/status',_0x31a868(0x19a)+_0x5c566d);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x5c566d);}if(!_0x5af9af[_0x31a868(0x1ea)]){console[_0x31a868(0x1d5)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error']('Missing\x20data\x20in\x20response'),loggerService_1[_0x31a868(0x1af)][_0x31a868(0x186)](_0x31a868(0x1c8),'/status',_0x31a868(0x1f2));throw new Error(_0x31a868(0x1ce));}let _0x41f693='PENDING';switch(_0x5af9af['data'][_0x31a868(0x1d3)]?.['toLowerCase']()){case _0x31a868(0x1e8):_0x41f693='PAID';break;case _0x31a868(0x1c6):case _0x31a868(0x195):case _0x31a868(0x1d5):_0x41f693=_0x31a868(0x18c);break;case _0x31a868(0x1cc):case _0x31a868(0x1c2):_0x41f693=_0x31a868(0x191);break;case _0x31a868(0x1d4):case _0x31a868(0x1f5):case _0x31a868(0x1f3):case _0x31a868(0x1d9):default:_0x41f693='PENDING';break;}let _0x2cfd23,_0x4f98fd;if(_0x5af9af[_0x31a868(0x1ea)]['PaymentDetail']){const _0x283969=_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1c4)];console[_0x31a868(0x1ff)](_0x31a868(0x1a7),_0x283969);const _0x250864=_0x283969[_0x31a868(0x1df)](/IBAN\s+([A-Z0-9]+)/i);_0x250864&&(_0x2cfd23=_0x250864[0x1],console['log'](_0x31a868(0x1da),_0x2cfd23)),_0x4f98fd=_0x283969;}const _0x2434dd={'iban':_0x2cfd23,'bankDetails':_0x4f98fd,'transactionId':_0x5af9af['data'][_0x31a868(0x18e)],'coinAddress':_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1c0)],'qrCodeUrl':_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1e7)],'expiryTime':_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x196)],'createdOn':_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1a9)],'confirmedOn':_0x5af9af['data'][_0x31a868(0x209)]};console[_0x31a868(0x1ff)](_0x31a868(0x1fe)),console[_0x31a868(0x1ff)]('Status:',_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1d3)],'->',_0x41f693),console[_0x31a868(0x1ff)](_0x31a868(0x203),_0x5af9af[_0x31a868(0x1ea)]['Amount'],_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1bd)]),console[_0x31a868(0x1ff)](_0x31a868(0x1e5),_0x5af9af[_0x31a868(0x1ea)]['TransactionID']),console[_0x31a868(0x1ff)]('IBAN:',_0x2cfd23||_0x31a868(0x1e6)),console[_0x31a868(0x1ff)](_0x31a868(0x1ae),_0x5af9af['data'][_0x31a868(0x1a9)]),console['log']('Confirmed\x20On:',_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x209)]||_0x31a868(0x1cf));if(_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1d3)]?.[_0x31a868(0x1ed)]()===_0x31a868(0x1f5))console[_0x31a868(0x1ff)](_0x31a868(0x199));else _0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1d3)]?.['toLowerCase']()===_0x31a868(0x1e8)&&console[_0x31a868(0x1ff)]('‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID');return{'status':_0x41f693,'amount':parseFloat(_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1be)])||undefined,'currency':_0x5af9af[_0x31a868(0x1ea)][_0x31a868(0x1bd)]||_0x31a868(0x192),'paymentDetails':_0x2434dd};}catch(_0x16c9ab){console[_0x31a868(0x1d5)]('CoinToPay\x20payment\x20status\x20check\x20error:',_0x16c9ab),loggerService_1[_0x31a868(0x1af)][_0x31a868(0x186)](_0x31a868(0x1c8),_0x31a868(0x197),_0x16c9ab);throw new Error('Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20'+(_0x16c9ab instanceof Error?_0x16c9ab['message']:'Unknown\x20error'));}}async[a49_0x55a0c3(0x1b4)](_0x4b4a36){const _0x199541=a49_0x55a0c3,_0x48ae9b=await this['checkPaymentStatus'](_0x4b4a36);return{'status':_0x48ae9b[_0x199541(0x1b6)],'amount':_0x48ae9b[_0x199541(0x1e2)],'currency':_0x48ae9b['currency']};}async[a49_0x55a0c3(0x204)](_0x4b3540){const _0x1cc961=a49_0x55a0c3;console['log'](_0x1cc961(0x1bb),_0x4b3540);let _0xfc1d25=_0x1cc961(0x18a);switch(_0x4b3540[_0x1cc961(0x1b6)]?.[_0x1cc961(0x1ed)]()){case _0x1cc961(0x1e8):_0xfc1d25=_0x1cc961(0x1f0);break;case'cancelled':case _0x1cc961(0x195):case _0x1cc961(0x1d5):_0xfc1d25=_0x1cc961(0x18c);break;case _0x1cc961(0x1cc):case'timeout':_0xfc1d25='EXPIRED';break;case _0x1cc961(0x1f3):case _0x1cc961(0x1d4):case _0x1cc961(0x1f5):case _0x1cc961(0x1d9):default:_0xfc1d25=_0x1cc961(0x18a);break;}return{'paymentId':_0x4b3540['order_id']||_0x4b3540[_0x1cc961(0x201)]||'','status':_0xfc1d25,'amount':_0x4b3540[_0x1cc961(0x1e2)],'currency':_0x4b3540[_0x1cc961(0x205)]||'EUR'};}}exports['CoinToPayService']=CoinToPayService;