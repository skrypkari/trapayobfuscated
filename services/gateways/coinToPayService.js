'use strict';const a38_0x5605fe=a38_0x9eec;(function(_0x1326ce,_0x583314){const _0x1d8c8c=a38_0x9eec,_0x13594f=_0x1326ce();while(!![]){try{const _0x4845fc=-parseInt(_0x1d8c8c(0x1c1))/0x1*(parseInt(_0x1d8c8c(0x1b7))/0x2)+parseInt(_0x1d8c8c(0x1a3))/0x3+-parseInt(_0x1d8c8c(0x169))/0x4+-parseInt(_0x1d8c8c(0x1a0))/0x5+-parseInt(_0x1d8c8c(0x18d))/0x6*(-parseInt(_0x1d8c8c(0x1b1))/0x7)+-parseInt(_0x1d8c8c(0x17e))/0x8*(parseInt(_0x1d8c8c(0x1bb))/0x9)+parseInt(_0x1d8c8c(0x14a))/0xa;if(_0x4845fc===_0x583314)break;else _0x13594f['push'](_0x13594f['shift']());}catch(_0x5917c3){_0x13594f['push'](_0x13594f['shift']());}}}(a38_0x2e1c,0x623f9));function a38_0x2e1c(){const _0x2909d1=['ExpiryTime','entries','PENDING','20tcYDOQ','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Business\x20Error:\x20','Result:','9oNyFnC','EXPIRED','apiUrl','===\x20COINTOPAY\x20SUCCESS\x20===','checkPaymentStatus','expired','69281IrTLDO','data','Currency:','Failed\x20to\x20parse\x20JSON\x20response:','TransactionConfirmedOn','Payment\x20URL:','logWhiteDomainError','Error\x20stack:','HTTP\x20error!\x20status:\x20','TransactionID','Transaction\x20ID:','Confirmed\x20On:','status_code','__esModule','CoinToPayService','timeout','logWhiteDomainRequest','14347150HTaNJS','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','stack','Error\x20details:','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','FAILED','https://tesoft.uk/gateway/cointopay/status.php','created','Amount','message','toLowerCase','not\x20confirmed','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','loggerService','Created\x20On:','/status','Response\x20Body:',',\x20body:\x20','status','coinAddress','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','parse','Status:','match','Response\x20data:','Incomplete\x20response:\x20missing\x20data','log','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','waiting','Request\x20Body:','3014840RbSybo','pending','error','Status','CoinToPay\x20API\x20error:\x20','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','ðŸ¦\x20Extracted\x20IBAN:','EUR','currency','createPaymentLink','text','merchant_reference_id','\x20EUR','CoinToPay\x20status\x20API\x20error:\x20','Amount:','Unknown\x20error','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','PAID','Status\x20API\x20Error:\x20','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','1809008mXHurh','result','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Payment\x20Status:','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','Gateway\x20Payment\x20ID:','Raw\x20Response\x20Body:','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','/create','success','paid','Status\x20Code:','statusText','amount','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','31722sJrtFy','awaiting\x20fiat','inputCurrency','now','ðŸ¦\x20Payment\x20Detail:','verifyPayment','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','IBAN:','application/json','TesSoft\x20Payment\x20System/1.0','cancelled','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','logWhiteDomainResponse','PaymentDetail','URL:','Response\x20Time:','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','statusUrl','defineProperty','654620sTRhVJ','cointopay','processWebhook','680157MvTHQb','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20','Status\x20Text:','ðŸ“Š\x20Status\x20check\x20URL:','order_id','failed','payment_url','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Parsed\x20Result:','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','Missing\x20data\x20in\x20response','CoinToPay\x20payment\x20status\x20check\x20error:','stringify','Error\x20Message:','721VBnRQM','POST','gateway_payment_id'];a38_0x2e1c=function(){return _0x2909d1;};return a38_0x2e1c();}function a38_0x9eec(_0x57adb7,_0x48c2fc){const _0x2e1c21=a38_0x2e1c();return a38_0x9eec=function(_0x9eec29,_0x34b81d){_0x9eec29=_0x9eec29-0x144;let _0x5490fb=_0x2e1c21[_0x9eec29];return _0x5490fb;},a38_0x9eec(_0x57adb7,_0x48c2fc);}Object[a38_0x5605fe(0x19f)](exports,a38_0x5605fe(0x146),{'value':!![]}),exports[a38_0x5605fe(0x147)]=void 0x0;const loggerService_1=require('../loggerService');class CoinToPayService{constructor(){const _0x26aa91=a38_0x5605fe;this[_0x26aa91(0x1bd)]='https://tesoft.uk/gateway/cointopay/',this[_0x26aa91(0x19e)]=_0x26aa91(0x150),console[_0x26aa91(0x165)](_0x26aa91(0x185)),console['log'](_0x26aa91(0x1a6),this['statusUrl']);}async[a38_0x5605fe(0x173)](_0x2ffcf9){const _0x13fe56=a38_0x5605fe,{orderId:_0x52a8a9,amount:_0x8d7c60}=_0x2ffcf9;console['log'](_0x13fe56(0x1ac)+_0x8d7c60+_0x13fe56(0x176));const _0x8475c5={'amount':_0x8d7c60},_0x3bd843=Date['now']();try{console[_0x13fe56(0x165)](_0x13fe56(0x193)),console[_0x13fe56(0x165)](_0x13fe56(0x19b),this['apiUrl']),console['log'](_0x13fe56(0x168),JSON[_0x13fe56(0x1af)](_0x8475c5,null,0x2)),console[_0x13fe56(0x165)](_0x13fe56(0x178),_0x8d7c60,_0x13fe56(0x1b8)),loggerService_1[_0x13fe56(0x158)][_0x13fe56(0x149)]('cointopay',_0x13fe56(0x186),_0x13fe56(0x1b2),_0x8475c5);const _0x2ef31f=await fetch(this[_0x13fe56(0x1bd)],{'method':'POST','headers':{'Content-Type':_0x13fe56(0x195),'Accept':'application/json','User-Agent':_0x13fe56(0x196)},'body':JSON[_0x13fe56(0x1af)](_0x8475c5)}),_0x5b3566=Date[_0x13fe56(0x190)]()-_0x3bd843;console['log']('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x13fe56(0x165)](_0x13fe56(0x161),_0x2ef31f[_0x13fe56(0x15d)]),console[_0x13fe56(0x165)](_0x13fe56(0x1a5),_0x2ef31f[_0x13fe56(0x18a)]),console['log']('Headers:',Object['fromEntries'](_0x2ef31f['headers'][_0x13fe56(0x1b5)]())),console['log'](_0x13fe56(0x19c),_0x5b3566+'ms');const _0x2a4d6b=await _0x2ef31f['text']();console[_0x13fe56(0x165)](_0x13fe56(0x184),_0x2a4d6b);if(!_0x2ef31f['ok']){console['error']('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x13fe56(0x16b)]('HTTP\x20Status:',_0x2ef31f[_0x13fe56(0x15d)]),console[_0x13fe56(0x16b)](_0x13fe56(0x15b),_0x2a4d6b),loggerService_1[_0x13fe56(0x158)][_0x13fe56(0x199)](_0x13fe56(0x1a1),'/create',_0x2ef31f[_0x13fe56(0x15d)],_0x2a4d6b,_0x5b3566),loggerService_1[_0x13fe56(0x158)]['logWhiteDomainError'](_0x13fe56(0x1a1),_0x13fe56(0x186),'HTTP\x20'+_0x2ef31f[_0x13fe56(0x15d)]+':\x20'+_0x2a4d6b);throw new Error(_0x13fe56(0x1c9)+_0x2ef31f['status']+_0x13fe56(0x15c)+_0x2a4d6b);}let _0x42d7e4;try{_0x42d7e4=JSON[_0x13fe56(0x160)](_0x2a4d6b);}catch(_0x527950){console[_0x13fe56(0x16b)](_0x13fe56(0x1c4),_0x527950),loggerService_1['loggerService'][_0x13fe56(0x1c7)]('cointopay',_0x13fe56(0x186),'JSON\x20Parse\x20Error:\x20'+_0x527950);throw new Error(_0x13fe56(0x17d)+_0x2a4d6b);}console[_0x13fe56(0x165)](_0x13fe56(0x157)),console[_0x13fe56(0x165)](_0x13fe56(0x1ab),JSON[_0x13fe56(0x1af)](_0x42d7e4,null,0x2)),loggerService_1['loggerService'][_0x13fe56(0x199)]('cointopay',_0x13fe56(0x186),_0x2ef31f[_0x13fe56(0x15d)],_0x42d7e4,_0x5b3566);if(_0x42d7e4['error']){const _0x537e9f=_0x42d7e4['message']||_0x42d7e4['error']||'Unknown\x20error\x20from\x20CoinToPay\x20API';console[_0x13fe56(0x16b)](_0x13fe56(0x166)),console[_0x13fe56(0x16b)](_0x13fe56(0x1b0),_0x537e9f),loggerService_1[_0x13fe56(0x158)][_0x13fe56(0x1c7)](_0x13fe56(0x1a1),_0x13fe56(0x186),_0x13fe56(0x1b9)+_0x537e9f);throw new Error(_0x13fe56(0x16d)+_0x537e9f);}if(!_0x42d7e4[_0x13fe56(0x1a9)]||!_0x42d7e4[_0x13fe56(0x1b3)]){console[_0x13fe56(0x16b)](_0x13fe56(0x14e)),console[_0x13fe56(0x16b)](_0x13fe56(0x180)),console['error'](_0x13fe56(0x163),_0x42d7e4),loggerService_1[_0x13fe56(0x158)]['logWhiteDomainError'](_0x13fe56(0x1a1),'/create',_0x13fe56(0x14b));throw new Error(_0x13fe56(0x16e));}return console[_0x13fe56(0x165)](_0x13fe56(0x1be)),console[_0x13fe56(0x165)](_0x13fe56(0x183),_0x42d7e4[_0x13fe56(0x1b3)]),console[_0x13fe56(0x165)](_0x13fe56(0x1c6),_0x42d7e4[_0x13fe56(0x1a9)]),console['log'](_0x13fe56(0x178),_0x8d7c60,_0x13fe56(0x171)),{'gateway_payment_id':_0x42d7e4['gateway_payment_id'],'payment_url':_0x42d7e4[_0x13fe56(0x1a9)]};}catch(_0x269e4e){console[_0x13fe56(0x16b)]('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x13fe56(0x16b)](_0x13fe56(0x14d),_0x269e4e),loggerService_1[_0x13fe56(0x158)][_0x13fe56(0x1c7)]('cointopay','/create',_0x269e4e);if(_0x269e4e instanceof Error){console[_0x13fe56(0x16b)]('Error\x20message:',_0x269e4e[_0x13fe56(0x153)]),console['error'](_0x13fe56(0x1c8),_0x269e4e[_0x13fe56(0x14c)]);throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20'+_0x269e4e[_0x13fe56(0x153)]);}throw new Error(_0x13fe56(0x19d));}}async['checkPaymentStatus'](_0x8df4a0){const _0x270217=a38_0x5605fe,_0x20ade3=Date[_0x270217(0x190)]();try{console['log']('ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20'+_0x8df4a0);const _0x39408d={'gatewayPaymentId':_0x8df4a0};loggerService_1[_0x270217(0x158)][_0x270217(0x149)](_0x270217(0x1a1),_0x270217(0x15a),'POST',_0x39408d);const _0x32bba6=await fetch(this['statusUrl'],{'method':_0x270217(0x1b2),'headers':{'Content-Type':'application/json','Accept':_0x270217(0x195),'User-Agent':_0x270217(0x196)},'body':JSON[_0x270217(0x1af)](_0x39408d)}),_0xb8a361=Date[_0x270217(0x190)]()-_0x20ade3;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x270217(0x165)]('Status:',_0x32bba6['status']),console['log'](_0x270217(0x19c),_0xb8a361+'ms');if(!_0x32bba6['ok']){const _0x35bac7=await _0x32bba6[_0x270217(0x174)]();console[_0x270217(0x16b)]('HTTP\x20Status:',_0x32bba6['status']),console[_0x270217(0x16b)](_0x270217(0x15b),_0x35bac7),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x270217(0x1a1),'/status',_0x32bba6[_0x270217(0x15d)],_0x35bac7,_0xb8a361),loggerService_1[_0x270217(0x158)]['logWhiteDomainError'](_0x270217(0x1a1),'/status','HTTP\x20'+_0x32bba6[_0x270217(0x15d)]+':\x20'+_0x35bac7);throw new Error(_0x270217(0x1c9)+_0x32bba6[_0x270217(0x15d)]);}const _0x1c47d6=await _0x32bba6[_0x270217(0x174)]();console[_0x270217(0x165)](_0x270217(0x184),_0x1c47d6);let _0x1c6965;try{_0x1c6965=JSON[_0x270217(0x160)](_0x1c47d6);}catch(_0x4315e2){console[_0x270217(0x16b)](_0x270217(0x1c4),_0x4315e2),loggerService_1['loggerService']['logWhiteDomainError'](_0x270217(0x1a1),_0x270217(0x15a),'JSON\x20Parse\x20Error:\x20'+_0x4315e2);throw new Error(_0x270217(0x1a4)+_0x1c47d6);}loggerService_1['loggerService'][_0x270217(0x199)](_0x270217(0x1a1),_0x270217(0x15a),_0x32bba6[_0x270217(0x15d)],_0x1c6965,_0xb8a361),console['log'](_0x270217(0x182)),console['log'](_0x270217(0x1ba),_0x1c6965[_0x270217(0x17f)]),console['log'](_0x270217(0x189),_0x1c6965[_0x270217(0x145)]),console[_0x270217(0x165)](_0x270217(0x181),_0x1c6965[_0x270217(0x1c2)]?.['Status']),console[_0x270217(0x165)]('Amount:',_0x1c6965[_0x270217(0x1c2)]?.[_0x270217(0x152)]),console['log'](_0x270217(0x1c3),_0x1c6965['data']?.[_0x270217(0x18f)]);if(_0x1c6965[_0x270217(0x17f)]!==_0x270217(0x187)||_0x1c6965[_0x270217(0x145)]!==0xc8){const _0x3a8e2c=_0x1c6965[_0x270217(0x153)]||_0x270217(0x15f);console[_0x270217(0x16b)](_0x270217(0x18c)),console['error'](_0x270217(0x1b0),_0x3a8e2c),loggerService_1['loggerService']['logWhiteDomainError'](_0x270217(0x1a1),_0x270217(0x15a),_0x270217(0x17c)+_0x3a8e2c);throw new Error(_0x270217(0x177)+_0x3a8e2c);}if(!_0x1c6965['data']){console[_0x270217(0x16b)](_0x270217(0x17a)),console['error'](_0x270217(0x1ad)),loggerService_1['loggerService'][_0x270217(0x1c7)]('cointopay','/status',_0x270217(0x164));throw new Error(_0x270217(0x198));}let _0x8ed96e=_0x270217(0x1b6);switch(_0x1c6965[_0x270217(0x1c2)]['Status']?.[_0x270217(0x154)]()){case _0x270217(0x188):_0x8ed96e=_0x270217(0x17b);break;case _0x270217(0x197):case _0x270217(0x1a8):case _0x270217(0x16b):_0x8ed96e=_0x270217(0x14f);break;case _0x270217(0x1c0):case _0x270217(0x148):_0x8ed96e=_0x270217(0x1bc);break;case _0x270217(0x167):case _0x270217(0x18e):case _0x270217(0x16a):case _0x270217(0x151):default:_0x8ed96e='PENDING';break;}let _0x2e0bbf,_0x2480d2;if(_0x1c6965[_0x270217(0x1c2)][_0x270217(0x19a)]){const _0x1fca7d=_0x1c6965[_0x270217(0x1c2)][_0x270217(0x19a)];console[_0x270217(0x165)](_0x270217(0x191),_0x1fca7d);const _0x526bb8=_0x1fca7d[_0x270217(0x162)](/IBAN\s+([A-Z0-9]+)/i);_0x526bb8&&(_0x2e0bbf=_0x526bb8[0x1],console[_0x270217(0x165)](_0x270217(0x170),_0x2e0bbf)),_0x2480d2=_0x1fca7d;}const _0x2bb627={'iban':_0x2e0bbf,'bankDetails':_0x2480d2,'transactionId':_0x1c6965[_0x270217(0x1c2)][_0x270217(0x1ca)],'coinAddress':_0x1c6965[_0x270217(0x1c2)][_0x270217(0x15e)],'qrCodeUrl':_0x1c6965[_0x270217(0x1c2)]['QRCodeURL'],'expiryTime':_0x1c6965['data'][_0x270217(0x1b4)],'createdOn':_0x1c6965['data']['CreatedOn'],'confirmedOn':_0x1c6965[_0x270217(0x1c2)][_0x270217(0x1c5)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x270217(0x165)](_0x270217(0x161),_0x1c6965['data'][_0x270217(0x16c)],'->',_0x8ed96e),console[_0x270217(0x165)]('Amount:',_0x1c6965[_0x270217(0x1c2)][_0x270217(0x152)],_0x1c6965[_0x270217(0x1c2)][_0x270217(0x18f)]),console[_0x270217(0x165)](_0x270217(0x1cb),_0x1c6965[_0x270217(0x1c2)][_0x270217(0x1ca)]),console[_0x270217(0x165)](_0x270217(0x194),_0x2e0bbf||'not\x20found'),console[_0x270217(0x165)](_0x270217(0x159),_0x1c6965[_0x270217(0x1c2)]['CreatedOn']),console['log'](_0x270217(0x144),_0x1c6965[_0x270217(0x1c2)]['TransactionConfirmedOn']||_0x270217(0x155));if(_0x1c6965[_0x270217(0x1c2)][_0x270217(0x16c)]?.['toLowerCase']()===_0x270217(0x18e))console[_0x270217(0x165)](_0x270217(0x156));else _0x1c6965[_0x270217(0x1c2)]['Status']?.[_0x270217(0x154)]()===_0x270217(0x188)&&console[_0x270217(0x165)](_0x270217(0x1aa));return{'status':_0x8ed96e,'amount':parseFloat(_0x1c6965['data'][_0x270217(0x152)])||undefined,'currency':_0x1c6965[_0x270217(0x1c2)][_0x270217(0x18f)]||_0x270217(0x171),'paymentDetails':_0x2bb627};}catch(_0x16fbd6){console[_0x270217(0x16b)](_0x270217(0x1ae),_0x16fbd6),loggerService_1[_0x270217(0x158)]['logWhiteDomainError'](_0x270217(0x1a1),_0x270217(0x15a),_0x16fbd6);throw new Error(_0x270217(0x16f)+(_0x16fbd6 instanceof Error?_0x16fbd6[_0x270217(0x153)]:_0x270217(0x179)));}}async[a38_0x5605fe(0x192)](_0x51338e){const _0x2b5cee=a38_0x5605fe,_0x1ff55b=await this[_0x2b5cee(0x1bf)](_0x51338e);return{'status':_0x1ff55b[_0x2b5cee(0x15d)],'amount':_0x1ff55b[_0x2b5cee(0x18b)],'currency':_0x1ff55b[_0x2b5cee(0x172)]};}async[a38_0x5605fe(0x1a2)](_0x1fb5e3){const _0x61039f=a38_0x5605fe;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x1fb5e3);let _0x191af9=_0x61039f(0x1b6);switch(_0x1fb5e3[_0x61039f(0x15d)]?.[_0x61039f(0x154)]()){case'paid':_0x191af9=_0x61039f(0x17b);break;case _0x61039f(0x197):case _0x61039f(0x1a8):case _0x61039f(0x16b):_0x191af9=_0x61039f(0x14f);break;case _0x61039f(0x1c0):case _0x61039f(0x148):_0x191af9=_0x61039f(0x1bc);break;case'pending':case _0x61039f(0x167):case _0x61039f(0x18e):case'created':default:_0x191af9='PENDING';break;}return{'paymentId':_0x1fb5e3[_0x61039f(0x1a7)]||_0x1fb5e3[_0x61039f(0x175)]||'','status':_0x191af9,'amount':_0x1fb5e3['amount'],'currency':_0x1fb5e3['currency']||_0x61039f(0x171)};}}exports[a38_0x5605fe(0x147)]=CoinToPayService;