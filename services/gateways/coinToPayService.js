'use strict';const a46_0xaa506f=a46_0x48e4;(function(_0x3336e7,_0x586d39){const _0x1afcd6=a46_0x48e4,_0x328cf9=_0x3336e7();while(!![]){try{const _0x4f7e62=parseInt(_0x1afcd6(0xee))/0x1*(parseInt(_0x1afcd6(0xcc))/0x2)+parseInt(_0x1afcd6(0x101))/0x3*(-parseInt(_0x1afcd6(0xfa))/0x4)+-parseInt(_0x1afcd6(0x11c))/0x5*(parseInt(_0x1afcd6(0xb2))/0x6)+parseInt(_0x1afcd6(0xeb))/0x7+-parseInt(_0x1afcd6(0x9f))/0x8*(parseInt(_0x1afcd6(0xbb))/0x9)+parseInt(_0x1afcd6(0x100))/0xa+parseInt(_0x1afcd6(0xce))/0xb*(parseInt(_0x1afcd6(0x97))/0xc);if(_0x4f7e62===_0x586d39)break;else _0x328cf9['push'](_0x328cf9['shift']());}catch(_0x234e4f){_0x328cf9['push'](_0x328cf9['shift']());}}}(a46_0xcea0,0x1f0f5));function a46_0x48e4(_0x5e81d6,_0x3a55c3){const _0xcea08f=a46_0xcea0();return a46_0x48e4=function(_0x48e43c,_0x29052e){_0x48e43c=_0x48e43c-0x97;let _0x4a26c2=_0xcea08f[_0x48e43c];return _0x4a26c2;},a46_0x48e4(_0x5e81d6,_0x3a55c3);}Object[a46_0xaa506f(0x10c)](exports,a46_0xaa506f(0xc3),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a46_0xaa506f(0xa9));class CoinToPayService{constructor(){const _0x324a7d=a46_0xaa506f;this[_0x324a7d(0x104)]=_0x324a7d(0xdd),this[_0x324a7d(0xd8)]='https://tesoft.uk/gateway/cointopay/status.php',console['log'](_0x324a7d(0x9e)),console[_0x324a7d(0x119)](_0x324a7d(0x112),this[_0x324a7d(0xd8)]);}async[a46_0xaa506f(0x122)](_0x5dec0f){const _0x275377=a46_0xaa506f,{orderId:_0x163e4e,amount:_0x31b132}=_0x5dec0f;console[_0x275377(0x119)](_0x275377(0xed)+_0x31b132+'\x20EUR');const _0x22cfe7={'amount':_0x31b132},_0x4306ae=Date[_0x275377(0xe3)]();try{console[_0x275377(0x119)](_0x275377(0xd1)),console['log'](_0x275377(0x10f),this[_0x275377(0x104)]),console[_0x275377(0x119)](_0x275377(0xf9),JSON[_0x275377(0xdc)](_0x22cfe7,null,0x2)),console[_0x275377(0x119)](_0x275377(0xf8),_0x31b132,_0x275377(0x109)),loggerService_1[_0x275377(0x111)]['logWhiteDomainRequest'](_0x275377(0x117),_0x275377(0xb1),_0x275377(0x105),_0x22cfe7);const _0x4a1853=await fetch(this[_0x275377(0x104)],{'method':_0x275377(0x105),'headers':{'Content-Type':_0x275377(0xb5),'Accept':_0x275377(0xb5),'User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON['stringify'](_0x22cfe7)}),_0x512d3a=Date['now']()-_0x4306ae;console[_0x275377(0x119)]('===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20==='),console[_0x275377(0x119)](_0x275377(0xb3),_0x4a1853[_0x275377(0xa2)]),console[_0x275377(0x119)](_0x275377(0xa1),_0x4a1853[_0x275377(0x9d)]),console[_0x275377(0x119)](_0x275377(0x10a),Object[_0x275377(0xcf)](_0x4a1853[_0x275377(0xc6)][_0x275377(0xd9)]())),console['log'](_0x275377(0xd7),_0x512d3a+'ms');const _0x4d8cd5=await _0x4a1853[_0x275377(0xbc)]();console[_0x275377(0x119)](_0x275377(0xf6),_0x4d8cd5);if(!_0x4a1853['ok']){console[_0x275377(0xc9)](_0x275377(0xb7)),console[_0x275377(0xc9)](_0x275377(0xca),_0x4a1853[_0x275377(0xa2)]),console[_0x275377(0xc9)](_0x275377(0xa7),_0x4d8cd5),loggerService_1['loggerService'][_0x275377(0x123)](_0x275377(0x117),'/create',_0x4a1853[_0x275377(0xa2)],_0x4d8cd5,_0x512d3a),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x275377(0xb1),_0x275377(0xc8)+_0x4a1853[_0x275377(0xa2)]+':\x20'+_0x4d8cd5);throw new Error(_0x275377(0x110)+_0x4a1853['status']+_0x275377(0xbd)+_0x4d8cd5);}let _0x52e2e2;try{_0x52e2e2=JSON['parse'](_0x4d8cd5);}catch(_0x114ffe){console[_0x275377(0xc9)]('Failed\x20to\x20parse\x20JSON\x20response:',_0x114ffe),loggerService_1[_0x275377(0x111)]['logWhiteDomainError'](_0x275377(0x117),_0x275377(0xb1),_0x275377(0xf0)+_0x114ffe);throw new Error(_0x275377(0xf5)+_0x4d8cd5);}console[_0x275377(0x119)](_0x275377(0xe6)),console['log']('Parsed\x20Result:',JSON[_0x275377(0xdc)](_0x52e2e2,null,0x2)),loggerService_1['loggerService'][_0x275377(0x123)]('cointopay',_0x275377(0xb1),_0x4a1853['status'],_0x52e2e2,_0x512d3a);if(_0x52e2e2[_0x275377(0xc9)]){const _0x41e6ce=_0x52e2e2[_0x275377(0xd3)]||_0x52e2e2['error']||_0x275377(0xae);console[_0x275377(0xc9)](_0x275377(0x9c)),console[_0x275377(0xc9)](_0x275377(0xec),_0x41e6ce),loggerService_1['loggerService'][_0x275377(0xe2)](_0x275377(0x117),_0x275377(0xb1),_0x275377(0xd5)+_0x41e6ce);throw new Error(_0x275377(0x121)+_0x41e6ce);}if(!_0x52e2e2[_0x275377(0xb8)]||!_0x52e2e2[_0x275377(0x102)]){console['error'](_0x275377(0xaf)),console[_0x275377(0xc9)](_0x275377(0xde)),console['error'](_0x275377(0x98),_0x52e2e2),loggerService_1[_0x275377(0x111)][_0x275377(0xe2)](_0x275377(0x117),'/create','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id');throw new Error(_0x275377(0xc1));}return console['log'](_0x275377(0x11d)),console[_0x275377(0x119)](_0x275377(0xd2),_0x52e2e2[_0x275377(0x102)]),console['log']('Payment\x20URL:',_0x52e2e2['payment_url']),console[_0x275377(0x119)](_0x275377(0xf8),_0x31b132,_0x275377(0x9b)),{'gateway_payment_id':_0x52e2e2[_0x275377(0x102)],'payment_url':_0x52e2e2[_0x275377(0xb8)]};}catch(_0x49f845){console[_0x275377(0xc9)](_0x275377(0xbf)),console['error'](_0x275377(0xbe),_0x49f845),loggerService_1[_0x275377(0x111)][_0x275377(0xe2)](_0x275377(0x117),_0x275377(0xb1),_0x49f845);if(_0x49f845 instanceof Error){console['error'](_0x275377(0x114),_0x49f845[_0x275377(0xd3)]),console[_0x275377(0xc9)](_0x275377(0xea),_0x49f845['stack']);throw new Error(_0x275377(0xf2)+_0x49f845[_0x275377(0xd3)]);}throw new Error(_0x275377(0xc4));}}async[a46_0xaa506f(0xe1)](_0x60c69a){const _0x5b3c97=a46_0xaa506f,_0x56d2a3=Date[_0x5b3c97(0xe3)]();try{console[_0x5b3c97(0x119)](_0x5b3c97(0xfe)+_0x60c69a);const _0x1a12ef={'gatewayPaymentId':_0x60c69a};loggerService_1[_0x5b3c97(0x111)][_0x5b3c97(0xa4)](_0x5b3c97(0x117),_0x5b3c97(0xe9),_0x5b3c97(0x105),_0x1a12ef);const _0x510f5a=await fetch(this['statusUrl'],{'method':_0x5b3c97(0x105),'headers':{'Content-Type':_0x5b3c97(0xb5),'Accept':'application/json','User-Agent':_0x5b3c97(0xdb)},'body':JSON[_0x5b3c97(0xdc)](_0x1a12ef)}),_0x4eca5c=Date[_0x5b3c97(0xe3)]()-_0x56d2a3;console[_0x5b3c97(0x119)](_0x5b3c97(0x120)),console[_0x5b3c97(0x119)](_0x5b3c97(0xb3),_0x510f5a[_0x5b3c97(0xa2)]),console[_0x5b3c97(0x119)](_0x5b3c97(0xd7),_0x4eca5c+'ms');if(!_0x510f5a['ok']){const _0x1de2d4=await _0x510f5a[_0x5b3c97(0xbc)]();console[_0x5b3c97(0xc9)](_0x5b3c97(0xca),_0x510f5a[_0x5b3c97(0xa2)]),console[_0x5b3c97(0xc9)](_0x5b3c97(0xa7),_0x1de2d4),loggerService_1['loggerService'][_0x5b3c97(0x123)]('cointopay',_0x5b3c97(0xe9),_0x510f5a[_0x5b3c97(0xa2)],_0x1de2d4,_0x4eca5c),loggerService_1['loggerService'][_0x5b3c97(0xe2)]('cointopay',_0x5b3c97(0xe9),_0x5b3c97(0xc8)+_0x510f5a['status']+':\x20'+_0x1de2d4);throw new Error(_0x5b3c97(0x110)+_0x510f5a['status']);}const _0x33d384=await _0x510f5a[_0x5b3c97(0xbc)]();console['log'](_0x5b3c97(0xf6),_0x33d384);let _0x2c2daa;try{_0x2c2daa=JSON['parse'](_0x33d384);}catch(_0x3a85b1){console[_0x5b3c97(0xc9)](_0x5b3c97(0xcb),_0x3a85b1),loggerService_1[_0x5b3c97(0x111)][_0x5b3c97(0xe2)]('cointopay','/status',_0x5b3c97(0xf0)+_0x3a85b1);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x33d384);}loggerService_1[_0x5b3c97(0x111)][_0x5b3c97(0x123)](_0x5b3c97(0x117),'/status',_0x510f5a[_0x5b3c97(0xa2)],_0x2c2daa,_0x4eca5c),console[_0x5b3c97(0x119)](_0x5b3c97(0x10d)),console['log'](_0x5b3c97(0x107),_0x2c2daa['result']),console[_0x5b3c97(0x119)](_0x5b3c97(0xc5),_0x2c2daa[_0x5b3c97(0x11b)]),console[_0x5b3c97(0x119)]('Payment\x20Status:',_0x2c2daa[_0x5b3c97(0xa6)]?.['Status']),console[_0x5b3c97(0x119)](_0x5b3c97(0xf8),_0x2c2daa[_0x5b3c97(0xa6)]?.[_0x5b3c97(0xa0)]),console[_0x5b3c97(0x119)](_0x5b3c97(0xcd),_0x2c2daa['data']?.[_0x5b3c97(0x10e)]);if(_0x2c2daa[_0x5b3c97(0xf4)]!==_0x5b3c97(0xa3)||_0x2c2daa[_0x5b3c97(0x11b)]!==0xc8){const _0x498997=_0x2c2daa[_0x5b3c97(0xd3)]||_0x5b3c97(0xd4);console[_0x5b3c97(0xc9)](_0x5b3c97(0xd6)),console['error']('Error\x20Message:',_0x498997),loggerService_1['loggerService'][_0x5b3c97(0xe2)](_0x5b3c97(0x117),_0x5b3c97(0xe9),_0x5b3c97(0x113)+_0x498997);throw new Error(_0x5b3c97(0xf1)+_0x498997);}if(!_0x2c2daa[_0x5b3c97(0xa6)]){console[_0x5b3c97(0xc9)](_0x5b3c97(0xe5)),console[_0x5b3c97(0xc9)](_0x5b3c97(0xb9)),loggerService_1[_0x5b3c97(0x111)][_0x5b3c97(0xe2)](_0x5b3c97(0x117),_0x5b3c97(0xe9),_0x5b3c97(0x9a));throw new Error(_0x5b3c97(0xba));}let _0x1314e1=_0x5b3c97(0xb4);switch(_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0xa8)]?.[_0x5b3c97(0xe0)]()){case'paid':_0x1314e1=_0x5b3c97(0xc0);break;case _0x5b3c97(0xff):case _0x5b3c97(0xc7):case _0x5b3c97(0xc9):_0x1314e1='FAILED';break;case'expired':case _0x5b3c97(0x108):_0x1314e1='EXPIRED';break;case _0x5b3c97(0x99):case _0x5b3c97(0x118):case'pending':case _0x5b3c97(0x116):default:_0x1314e1='PENDING';break;}let _0x575f49,_0x148165;if(_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0x11f)]){const _0x33ef13=_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0x11f)];console['log'](_0x5b3c97(0xe8),_0x33ef13);const _0x31582f=_0x33ef13[_0x5b3c97(0xf7)](/IBAN\s+([A-Z0-9]+)/i);_0x31582f&&(_0x575f49=_0x31582f[0x1],console[_0x5b3c97(0x119)](_0x5b3c97(0xac),_0x575f49)),_0x148165=_0x33ef13;}const _0x23c769={'iban':_0x575f49,'bankDetails':_0x148165,'transactionId':_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0xb6)],'coinAddress':_0x2c2daa[_0x5b3c97(0xa6)]['coinAddress'],'qrCodeUrl':_0x2c2daa['data'][_0x5b3c97(0xaa)],'expiryTime':_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0x11a)],'createdOn':_0x2c2daa['data'][_0x5b3c97(0xd0)],'confirmedOn':_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0xfd)]};console['log']('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x5b3c97(0x119)](_0x5b3c97(0xb3),_0x2c2daa['data']['Status'],'->',_0x1314e1),console[_0x5b3c97(0x119)](_0x5b3c97(0xf8),_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0xa0)],_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0x10e)]),console['log'](_0x5b3c97(0xa5),_0x2c2daa[_0x5b3c97(0xa6)]['TransactionID']),console[_0x5b3c97(0x119)](_0x5b3c97(0x11e),_0x575f49||_0x5b3c97(0xf3)),console[_0x5b3c97(0x119)]('Created\x20On:',_0x2c2daa[_0x5b3c97(0xa6)]['CreatedOn']),console['log'](_0x5b3c97(0xdf),_0x2c2daa['data']['TransactionConfirmedOn']||_0x5b3c97(0x103));if(_0x2c2daa['data'][_0x5b3c97(0xa8)]?.[_0x5b3c97(0xe0)]()==='awaiting\x20fiat')console[_0x5b3c97(0x119)](_0x5b3c97(0xef));else _0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0xa8)]?.[_0x5b3c97(0xe0)]()===_0x5b3c97(0xe7)&&console[_0x5b3c97(0x119)](_0x5b3c97(0xb0));return{'status':_0x1314e1,'amount':parseFloat(_0x2c2daa['data'][_0x5b3c97(0xa0)])||undefined,'currency':_0x2c2daa[_0x5b3c97(0xa6)][_0x5b3c97(0x10e)]||_0x5b3c97(0x9b),'paymentDetails':_0x23c769};}catch(_0x1753a2){console['error'](_0x5b3c97(0xe4),_0x1753a2),loggerService_1['loggerService']['logWhiteDomainError'](_0x5b3c97(0x117),'/status',_0x1753a2);throw new Error(_0x5b3c97(0xda)+(_0x1753a2 instanceof Error?_0x1753a2['message']:_0x5b3c97(0xc2)));}}async[a46_0xaa506f(0xab)](_0x40968a){const _0x4838c7=a46_0xaa506f,_0x5ce841=await this[_0x4838c7(0xe1)](_0x40968a);return{'status':_0x5ce841[_0x4838c7(0xa2)],'amount':_0x5ce841[_0x4838c7(0x106)],'currency':_0x5ce841['currency']};}async[a46_0xaa506f(0xfb)](_0x4b98ff){const _0xcf9b81=a46_0xaa506f;console['log']('Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):',_0x4b98ff);let _0x462f58=_0xcf9b81(0xb4);switch(_0x4b98ff['status']?.[_0xcf9b81(0xe0)]()){case _0xcf9b81(0xe7):_0x462f58=_0xcf9b81(0xc0);break;case'cancelled':case _0xcf9b81(0xc7):case _0xcf9b81(0xc9):_0x462f58='FAILED';break;case _0xcf9b81(0x10b):case _0xcf9b81(0x108):_0x462f58=_0xcf9b81(0xfc);break;case _0xcf9b81(0xad):case _0xcf9b81(0x99):case _0xcf9b81(0x118):case'created':default:_0x462f58=_0xcf9b81(0xb4);break;}return{'paymentId':_0x4b98ff['order_id']||_0x4b98ff['merchant_reference_id']||'','status':_0x462f58,'amount':_0x4b98ff['amount'],'currency':_0x4b98ff[_0xcf9b81(0x115)]||_0xcf9b81(0x9b)};}}exports['CoinToPayService']=CoinToPayService;function a46_0xcea0(){const _0x486960=['success','logWhiteDomainRequest','Transaction\x20ID:','data','Response\x20Body:','Status','../loggerService','QRCodeURL','verifyPayment','🏦\x20Extracted\x20IBAN:','pending','Unknown\x20error\x20from\x20CoinToPay\x20API','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','✅\x20\x22Paid\x22\x20mapped\x20to\x20PAID','/create','450cghqZI','Status:','PENDING','application/json','TransactionID','===\x20COINTOPAY\x20API\x20ERROR\x20===','payment_url','Missing\x20data\x20in\x20response','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','6687phwJnV','text',',\x20body:\x20','Error\x20details:','===\x20COINTOPAY\x20SERVICE\x20ERROR\x20===','PAID','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Unknown\x20error','__esModule','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Status\x20Code:','headers','failed','HTTP\x20','error','HTTP\x20Status:','Failed\x20to\x20parse\x20JSON\x20response:','2ZPgwog','Currency:','30943btEOpe','fromEntries','CreatedOn','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','Gateway\x20Payment\x20ID:','message','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','Business\x20Error:\x20','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','Response\x20Time:','statusUrl','entries','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','TesSoft\x20Payment\x20System/1.0','stringify','https://tesoft.uk/gateway/cointopay/','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Confirmed\x20On:','toLowerCase','checkPaymentStatus','logWhiteDomainError','now','CoinToPay\x20payment\x20status\x20check\x20error:','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','paid','🏦\x20Payment\x20Detail:','/status','Error\x20stack:','1128155jyyaYN','Error\x20Message:','🪙\x20Creating\x20CoinToPay\x20payment:\x20','140975giNJHW','💡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','JSON\x20Parse\x20Error:\x20','CoinToPay\x20status\x20API\x20error:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','not\x20found','result','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Raw\x20Response\x20Body:','match','Amount:','Request\x20Body:','138020XvCNmA','processWebhook','EXPIRED','TransactionConfirmedOn','📊\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cancelled','165930KQjjhY','9iZVDPy','gateway_payment_id','not\x20confirmed','apiUrl','POST','amount','Result:','timeout','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','Headers:','expired','defineProperty','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','inputCurrency','URL:','HTTP\x20error!\x20status:\x20','loggerService','📊\x20Status\x20check\x20URL:','Status\x20API\x20Error:\x20','Error\x20message:','currency','created','cointopay','awaiting\x20fiat','log','ExpiryTime','status_code','15faWnxD','===\x20COINTOPAY\x20SUCCESS\x20===','IBAN:','PaymentDetail','===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20===','CoinToPay\x20API\x20error:\x20','createPaymentLink','logWhiteDomainResponse','456SFRtVo','Response\x20data:','waiting','Incomplete\x20response:\x20missing\x20data','EUR','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','statusText','🪙\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','2096MYanZn','Amount','Status\x20Text:','status'];a46_0xcea0=function(){return _0x486960;};return a46_0xcea0();}