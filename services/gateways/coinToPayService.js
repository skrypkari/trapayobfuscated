'use strict';const a55_0x4f7f7b=a55_0x2c7a;(function(_0x25aa6c,_0x55bd1a){const _0x1e71cf=a55_0x2c7a,_0x5729d5=_0x25aa6c();while(!![]){try{const _0x19bce2=-parseInt(_0x1e71cf(0x14b))/0x1*(parseInt(_0x1e71cf(0x159))/0x2)+parseInt(_0x1e71cf(0x150))/0x3+parseInt(_0x1e71cf(0x17c))/0x4+parseInt(_0x1e71cf(0x127))/0x5*(parseInt(_0x1e71cf(0x14e))/0x6)+-parseInt(_0x1e71cf(0x139))/0x7*(parseInt(_0x1e71cf(0x16e))/0x8)+parseInt(_0x1e71cf(0x195))/0x9*(parseInt(_0x1e71cf(0x193))/0xa)+parseInt(_0x1e71cf(0x14a))/0xb*(-parseInt(_0x1e71cf(0x14c))/0xc);if(_0x19bce2===_0x55bd1a)break;else _0x5729d5['push'](_0x5729d5['shift']());}catch(_0x54a456){_0x5729d5['push'](_0x5729d5['shift']());}}}(a55_0x2ac1,0xb25db));Object['defineProperty'](exports,a55_0x4f7f7b(0x161),{'value':!![]}),exports['CoinToPayService']=void 0x0;const loggerService_1=require(a55_0x4f7f7b(0x12b));class CoinToPayService{constructor(){const _0xb1827=a55_0x4f7f7b;this[_0xb1827(0x184)]=_0xb1827(0x11c),this[_0xb1827(0x15d)]=_0xb1827(0x12a),console['log'](_0xb1827(0x15c)),console[_0xb1827(0x181)]('üìä\x20Status\x20check\x20URL:',this[_0xb1827(0x15d)]);}async[a55_0x4f7f7b(0x180)](_0xde1ae7){const _0x381d9a=a55_0x4f7f7b,{orderId:_0xab2ce8,amount:_0x2c44d7}=_0xde1ae7;console[_0x381d9a(0x181)](_0x381d9a(0x11e)+_0x2c44d7+_0x381d9a(0x17f));const _0x5d410d={'amount':_0x2c44d7},_0x38a954=Date[_0x381d9a(0x12f)]();try{console['log']('===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20==='),console[_0x381d9a(0x181)](_0x381d9a(0x199),this[_0x381d9a(0x184)]),console[_0x381d9a(0x181)](_0x381d9a(0x197),JSON[_0x381d9a(0x183)](_0x5d410d,null,0x2)),console[_0x381d9a(0x181)](_0x381d9a(0x15e),_0x2c44d7,_0x381d9a(0x11d)),loggerService_1[_0x381d9a(0x18b)]['logWhiteDomainRequest'](_0x381d9a(0x186),_0x381d9a(0x187),_0x381d9a(0x122),_0x5d410d);const _0x33d00e=await fetch(this[_0x381d9a(0x184)],{'method':_0x381d9a(0x122),'headers':{'Content-Type':'application/json','Accept':_0x381d9a(0x190),'User-Agent':'Payment\x20System/1.0'},'body':JSON[_0x381d9a(0x183)](_0x5d410d)}),_0x5f80c9=Date['now']()-_0x38a954;console[_0x381d9a(0x181)](_0x381d9a(0x166)),console['log'](_0x381d9a(0x17b),_0x33d00e[_0x381d9a(0x148)]),console[_0x381d9a(0x181)](_0x381d9a(0x136),_0x33d00e[_0x381d9a(0x118)]),console['log'](_0x381d9a(0x18d),Object['fromEntries'](_0x33d00e[_0x381d9a(0x177)]['entries']())),console['log']('Response\x20Time:',_0x5f80c9+'ms');const _0x26023f=await _0x33d00e[_0x381d9a(0x16a)]();console[_0x381d9a(0x181)](_0x381d9a(0x17e),_0x26023f);if(!_0x33d00e['ok']){console[_0x381d9a(0x121)]('===\x20COINTOPAY\x20API\x20ERROR\x20==='),console[_0x381d9a(0x121)](_0x381d9a(0x134),_0x33d00e[_0x381d9a(0x148)]),console[_0x381d9a(0x121)](_0x381d9a(0x145),_0x26023f),loggerService_1['loggerService'][_0x381d9a(0x16f)]('cointopay',_0x381d9a(0x187),_0x33d00e['status'],_0x26023f,_0x5f80c9),loggerService_1['loggerService'][_0x381d9a(0x133)](_0x381d9a(0x186),_0x381d9a(0x187),_0x381d9a(0x11a)+_0x33d00e[_0x381d9a(0x148)]+':\x20'+_0x26023f);throw new Error('HTTP\x20error!\x20status:\x20'+_0x33d00e['status']+',\x20body:\x20'+_0x26023f);}let _0x479494;try{_0x479494=JSON[_0x381d9a(0x16b)](_0x26023f);}catch(_0xd8b49a){console[_0x381d9a(0x121)](_0x381d9a(0x155),_0xd8b49a),loggerService_1[_0x381d9a(0x18b)][_0x381d9a(0x133)]('cointopay',_0x381d9a(0x187),_0x381d9a(0x13b)+_0xd8b49a);throw new Error(_0x381d9a(0x182)+_0x26023f);}console['log'](_0x381d9a(0x149)),console['log']('Parsed\x20Result:',JSON[_0x381d9a(0x183)](_0x479494,null,0x2)),loggerService_1[_0x381d9a(0x18b)][_0x381d9a(0x16f)]('cointopay',_0x381d9a(0x187),_0x33d00e['status'],_0x479494,_0x5f80c9);if(_0x479494['error']){const _0x93b7ed=_0x479494[_0x381d9a(0x124)]||_0x479494[_0x381d9a(0x121)]||_0x381d9a(0x13a);console[_0x381d9a(0x121)](_0x381d9a(0x120)),console[_0x381d9a(0x121)]('Error\x20Message:',_0x93b7ed),loggerService_1[_0x381d9a(0x18b)]['logWhiteDomainError'](_0x381d9a(0x186),_0x381d9a(0x187),_0x381d9a(0x132)+_0x93b7ed);throw new Error(_0x381d9a(0x15a)+_0x93b7ed);}if(!_0x479494[_0x381d9a(0x13e)]||!_0x479494[_0x381d9a(0x164)]){console[_0x381d9a(0x121)]('===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console['error'](_0x381d9a(0x16c)),console['error'](_0x381d9a(0x13d),_0x479494),loggerService_1[_0x381d9a(0x18b)][_0x381d9a(0x133)](_0x381d9a(0x186),_0x381d9a(0x187),_0x381d9a(0x189));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id');}console['log'](_0x381d9a(0x153)),console['log'](_0x381d9a(0x13c),_0x479494[_0x381d9a(0x164)]),console[_0x381d9a(0x181)](_0x381d9a(0x16d),_0x479494[_0x381d9a(0x13e)]);const _0x5440e3=_0x479494[_0x381d9a(0x13e)]+'&alternative=false';return console['log'](_0x381d9a(0x140),_0x5440e3),console[_0x381d9a(0x181)](_0x381d9a(0x15e),_0x2c44d7,_0x381d9a(0x18e)),{'gateway_payment_id':_0x479494['gateway_payment_id'],'payment_url':_0x5440e3};}catch(_0x4ce688){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x381d9a(0x121)](_0x381d9a(0x11b),_0x4ce688),loggerService_1[_0x381d9a(0x18b)][_0x381d9a(0x133)]('cointopay',_0x381d9a(0x187),_0x4ce688);if(_0x4ce688 instanceof Error){console[_0x381d9a(0x121)](_0x381d9a(0x138),_0x4ce688['message']),console[_0x381d9a(0x121)](_0x381d9a(0x18a),_0x4ce688[_0x381d9a(0x17d)]);throw new Error(_0x381d9a(0x13f)+_0x4ce688[_0x381d9a(0x124)]);}throw new Error(_0x381d9a(0x168));}}async[a55_0x4f7f7b(0x154)](_0x549c8f){const _0x41da97=a55_0x4f7f7b,_0x153be=Date[_0x41da97(0x12f)]();try{console['log'](_0x41da97(0x172)+_0x549c8f);const _0x24bde8={'gatewayPaymentId':_0x549c8f};loggerService_1[_0x41da97(0x18b)][_0x41da97(0x128)](_0x41da97(0x186),'/status','POST',_0x24bde8);const _0x912c0=await fetch(this[_0x41da97(0x15d)],{'method':_0x41da97(0x122),'headers':{'Content-Type':_0x41da97(0x190),'Accept':_0x41da97(0x190),'User-Agent':_0x41da97(0x169)},'body':JSON[_0x41da97(0x183)](_0x24bde8)}),_0x2587d3=Date[_0x41da97(0x12f)]()-_0x153be;console['log']('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x41da97(0x181)]('Status:',_0x912c0[_0x41da97(0x148)]),console['log'](_0x41da97(0x147),_0x2587d3+'ms');if(!_0x912c0['ok']){const _0x341347=await _0x912c0[_0x41da97(0x16a)]();console[_0x41da97(0x121)]('HTTP\x20Status:',_0x912c0['status']),console['error'](_0x41da97(0x145),_0x341347),loggerService_1['loggerService']['logWhiteDomainResponse']('cointopay','/status',_0x912c0[_0x41da97(0x148)],_0x341347,_0x2587d3),loggerService_1['loggerService'][_0x41da97(0x133)](_0x41da97(0x186),_0x41da97(0x129),'HTTP\x20'+_0x912c0['status']+':\x20'+_0x341347);throw new Error(_0x41da97(0x14f)+_0x912c0[_0x41da97(0x148)]);}const _0x384b64=await _0x912c0['text']();console['log']('Raw\x20Response\x20Body:',_0x384b64);let _0x28a49b;try{_0x28a49b=JSON['parse'](_0x384b64);}catch(_0x5e0e71){console['error']('Failed\x20to\x20parse\x20JSON\x20response:',_0x5e0e71),loggerService_1[_0x41da97(0x18b)][_0x41da97(0x133)](_0x41da97(0x186),'/status',_0x41da97(0x13b)+_0x5e0e71);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x384b64);}loggerService_1[_0x41da97(0x18b)][_0x41da97(0x16f)](_0x41da97(0x186),'/status',_0x912c0[_0x41da97(0x148)],_0x28a49b,_0x2587d3),console['log'](_0x41da97(0x178)),console[_0x41da97(0x181)](_0x41da97(0x152),_0x28a49b[_0x41da97(0x185)]),console['log'](_0x41da97(0x11f),_0x28a49b['status_code']),console[_0x41da97(0x181)](_0x41da97(0x151),_0x28a49b[_0x41da97(0x143)]?.[_0x41da97(0x123)]),console[_0x41da97(0x181)](_0x41da97(0x15e),_0x28a49b[_0x41da97(0x143)]?.[_0x41da97(0x196)]),console[_0x41da97(0x181)](_0x41da97(0x12e),_0x28a49b[_0x41da97(0x143)]?.[_0x41da97(0x15f)]);if(_0x28a49b[_0x41da97(0x185)]!==_0x41da97(0x17a)||_0x28a49b['status_code']!==0xc8){const _0x44a960=_0x28a49b['message']||'Unknown\x20error\x20from\x20CoinToPay\x20status\x20API';console[_0x41da97(0x121)](_0x41da97(0x194)),console[_0x41da97(0x121)]('Error\x20Message:',_0x44a960),loggerService_1[_0x41da97(0x18b)][_0x41da97(0x133)](_0x41da97(0x186),_0x41da97(0x129),_0x41da97(0x135)+_0x44a960);throw new Error('CoinToPay\x20status\x20API\x20error:\x20'+_0x44a960);}if(!_0x28a49b['data']){console[_0x41da97(0x121)](_0x41da97(0x119)),console['error'](_0x41da97(0x141)),loggerService_1['loggerService']['logWhiteDomainError'](_0x41da97(0x186),_0x41da97(0x129),'Incomplete\x20response:\x20missing\x20data');throw new Error(_0x41da97(0x170));}let _0xd36a1c=_0x41da97(0x160);switch(_0x28a49b[_0x41da97(0x143)][_0x41da97(0x123)]?.[_0x41da97(0x131)]()){case'paid':_0xd36a1c=_0x41da97(0x157);break;case _0x41da97(0x173):case _0x41da97(0x12c):case _0x41da97(0x121):_0xd36a1c=_0x41da97(0x144);break;case'expired':case _0x41da97(0x191):_0xd36a1c='EXPIRED';break;case'waiting':case _0x41da97(0x188):case _0x41da97(0x125):case _0x41da97(0x163):default:_0xd36a1c=_0x41da97(0x160);break;}let _0x1a99d0,_0x1cbb38;if(_0x28a49b['data'][_0x41da97(0x174)]){const _0x39abfd=_0x28a49b[_0x41da97(0x143)][_0x41da97(0x174)];console[_0x41da97(0x181)](_0x41da97(0x171),_0x39abfd);const _0x4a1ba3=_0x39abfd['match'](/IBAN\s+([A-Z0-9]+)/i);_0x4a1ba3&&(_0x1a99d0=_0x4a1ba3[0x1],console[_0x41da97(0x181)](_0x41da97(0x14d),_0x1a99d0)),_0x1cbb38=_0x39abfd;}const _0x288999={'iban':_0x1a99d0,'bankDetails':_0x1cbb38,'transactionId':_0x28a49b[_0x41da97(0x143)][_0x41da97(0x165)],'coinAddress':_0x28a49b['data'][_0x41da97(0x156)],'qrCodeUrl':_0x28a49b[_0x41da97(0x143)]['QRCodeURL'],'expiryTime':_0x28a49b[_0x41da97(0x143)]['ExpiryTime'],'createdOn':_0x28a49b['data'][_0x41da97(0x18f)],'confirmedOn':_0x28a49b[_0x41da97(0x143)][_0x41da97(0x137)]};console[_0x41da97(0x181)](_0x41da97(0x146)),console[_0x41da97(0x181)](_0x41da97(0x17b),_0x28a49b['data'][_0x41da97(0x123)],'->',_0xd36a1c),console['log']('Amount:',_0x28a49b[_0x41da97(0x143)][_0x41da97(0x196)],_0x28a49b[_0x41da97(0x143)][_0x41da97(0x15f)]),console[_0x41da97(0x181)]('Transaction\x20ID:',_0x28a49b[_0x41da97(0x143)]['TransactionID']),console[_0x41da97(0x181)](_0x41da97(0x179),_0x1a99d0||'not\x20found'),console[_0x41da97(0x181)]('Created\x20On:',_0x28a49b[_0x41da97(0x143)][_0x41da97(0x18f)]),console[_0x41da97(0x181)]('Confirmed\x20On:',_0x28a49b[_0x41da97(0x143)][_0x41da97(0x137)]||'not\x20confirmed');if(_0x28a49b[_0x41da97(0x143)][_0x41da97(0x123)]?.[_0x41da97(0x131)]()==='awaiting\x20fiat')console[_0x41da97(0x181)](_0x41da97(0x117));else _0x28a49b[_0x41da97(0x143)]['Status']?.[_0x41da97(0x131)]()===_0x41da97(0x162)&&console[_0x41da97(0x181)](_0x41da97(0x167));return{'status':_0xd36a1c,'amount':parseFloat(_0x28a49b[_0x41da97(0x143)][_0x41da97(0x196)])||undefined,'currency':_0x28a49b['data'][_0x41da97(0x15f)]||'EUR','paymentDetails':_0x288999};}catch(_0x275075){console[_0x41da97(0x121)](_0x41da97(0x126),_0x275075),loggerService_1[_0x41da97(0x18b)][_0x41da97(0x133)]('cointopay',_0x41da97(0x129),_0x275075);throw new Error(_0x41da97(0x115)+(_0x275075 instanceof Error?_0x275075[_0x41da97(0x124)]:_0x41da97(0x116)));}}async['verifyPayment'](_0x466421){const _0x47f785=a55_0x4f7f7b,_0x1a2160=await this[_0x47f785(0x154)](_0x466421);return{'status':_0x1a2160['status'],'amount':_0x1a2160['amount'],'currency':_0x1a2160[_0x47f785(0x198)]};}async[a55_0x4f7f7b(0x15b)](_0x34584e){const _0x1b4c5b=a55_0x4f7f7b;console['log'](_0x1b4c5b(0x12d),_0x34584e);let _0x2c8998=_0x1b4c5b(0x160);switch(_0x34584e[_0x1b4c5b(0x148)]?.[_0x1b4c5b(0x131)]()){case'paid':_0x2c8998=_0x1b4c5b(0x157);break;case _0x1b4c5b(0x173):case _0x1b4c5b(0x12c):case'error':_0x2c8998='FAILED';break;case _0x1b4c5b(0x142):case _0x1b4c5b(0x191):_0x2c8998=_0x1b4c5b(0x18c);break;case _0x1b4c5b(0x125):case _0x1b4c5b(0x192):case _0x1b4c5b(0x188):case'created':default:_0x2c8998=_0x1b4c5b(0x160);break;}return{'paymentId':_0x34584e[_0x1b4c5b(0x175)]||_0x34584e[_0x1b4c5b(0x130)]||'','status':_0x2c8998,'amount':_0x34584e[_0x1b4c5b(0x158)],'currency':_0x34584e[_0x1b4c5b(0x198)]||'EUR'};}}exports[a55_0x4f7f7b(0x176)]=CoinToPayService;function a55_0x2c7a(_0x28aab6,_0x425807){_0x28aab6=_0x28aab6-0x115;const _0x2ac19a=a55_0x2ac1();let _0x2c7a8a=_0x2ac19a[_0x28aab6];return _0x2c7a8a;}function a55_0x2ac1(){const _0x27789e=['Raw\x20Response\x20Body:','\x20EUR','createPaymentLink','log','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','stringify','apiUrl','result','cointopay','/create','awaiting\x20fiat','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','Error\x20stack:','loggerService','EXPIRED','Headers:','EUR','CreatedOn','application/json','timeout','waiting','6202190HANfSA','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','9NLCaEB','Amount','Request\x20Body:','currency','URL:','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','Unknown\x20error','üí°\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','statusText','===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20===','HTTP\x20','Error\x20details:','https://tesoft.uk/gateway/cointopay/','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','ü™ô\x20Creating\x20CoinToPay\x20payment:\x20','Status\x20Code:','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','error','POST','Status','message','pending','CoinToPay\x20payment\x20status\x20check\x20error:','510fXLmNN','logWhiteDomainRequest','/status','https://tesoft.uk/gateway/cointopay/status.php','../loggerService','failed','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','Currency:','now','merchant_reference_id','toLowerCase','Business\x20Error:\x20','logWhiteDomainError','HTTP\x20Status:','Status\x20API\x20Error:\x20','Status\x20Text:','TransactionConfirmedOn','Error\x20message:','7WkrLGJ','Unknown\x20error\x20from\x20CoinToPay\x20API','JSON\x20Parse\x20Error:\x20','Gateway\x20Payment\x20ID:','Response\x20data:','payment_url','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','Payment\x20URL\x20(modified):','Missing\x20data\x20in\x20response','expired','data','FAILED','Response\x20Body:','===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20===','Response\x20Time:','status','===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20===','253cuKsRK','1HxGKlC','1071444mRzfbS','üè¶\x20Extracted\x20IBAN:','75024rWWEbp','HTTP\x20error!\x20status:\x20','1484862FKYsTl','Payment\x20Status:','Result:','===\x20COINTOPAY\x20SUCCESS\x20===','checkPaymentStatus','Failed\x20to\x20parse\x20JSON\x20response:','coinAddress','PAID','amount','1752056lYfavx','CoinToPay\x20API\x20error:\x20','processWebhook','ü™ô\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','statusUrl','Amount:','inputCurrency','PENDING','__esModule','paid','created','gateway_payment_id','TransactionID','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','‚úÖ\x20\x22Paid\x22\x20mapped\x20to\x20PAID','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error','Payment\x20System/1.0','text','parse','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','Payment\x20URL\x20(original):','572488hRlCMK','logWhiteDomainResponse','Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data','üè¶\x20Payment\x20Detail:','üìä\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','cancelled','PaymentDetail','order_id','CoinToPayService','headers','===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20===','IBAN:','success','Status:','5364784sucDqH','stack'];a55_0x2ac1=function(){return _0x27789e;};return a55_0x2ac1();}