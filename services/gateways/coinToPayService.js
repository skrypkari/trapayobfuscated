'use strict';const a37_0x2b3fc4=a37_0x34bc;(function(_0x57f8c2,_0x17b8fa){const _0x5a7bb5=a37_0x34bc,_0x1a97c3=_0x57f8c2();while(!![]){try{const _0x542877=parseInt(_0x5a7bb5(0x11d))/0x1+parseInt(_0x5a7bb5(0x15f))/0x2+parseInt(_0x5a7bb5(0x171))/0x3*(-parseInt(_0x5a7bb5(0x136))/0x4)+-parseInt(_0x5a7bb5(0x119))/0x5+parseInt(_0x5a7bb5(0x11f))/0x6+parseInt(_0x5a7bb5(0x124))/0x7+-parseInt(_0x5a7bb5(0x144))/0x8;if(_0x542877===_0x17b8fa)break;else _0x1a97c3['push'](_0x1a97c3['shift']());}catch(_0x3f4235){_0x1a97c3['push'](_0x1a97c3['shift']());}}}(a37_0x471d,0xdd9dc));function a37_0x34bc(_0x59d532,_0x5213d2){const _0x471d78=a37_0x471d();return a37_0x34bc=function(_0x34bc4f,_0x27483e){_0x34bc4f=_0x34bc4f-0x114;let _0x1407ef=_0x471d78[_0x34bc4f];return _0x1407ef;},a37_0x34bc(_0x59d532,_0x5213d2);}Object[a37_0x2b3fc4(0x177)](exports,a37_0x2b3fc4(0x14c),{'value':!![]}),exports[a37_0x2b3fc4(0x138)]=void 0x0;const loggerService_1=require('../loggerService');function a37_0x471d(){const _0x3a4d34=['Response\x20Body:','ðŸ¦\x20Payment\x20Detail:','FAILED','HTTP\x20error!\x20status:\x20','POST','âœ…\x20\x22Paid\x22\x20mapped\x20to\x20PAID','__esModule','error','Request\x20Body:','awaiting\x20fiat','expired','created','TransactionID','===\x20COINTOPAY\x20API\x20BUSINESS\x20ERROR\x20===','not\x20confirmed','merchant_reference_id','pending','waiting','===\x20COINTOPAY\x20API\x20ERROR\x20===','===\x20COINTOPAY\x20API\x20RESPONSE\x20(White\x20Domain)\x20===','toLowerCase','ðŸ“Š\x20Checking\x20CoinToPay\x20payment\x20status\x20for:\x20','Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20','message','Response\x20Time:','1398238iQgHdo','paid','Processing\x20CoinToPay\x20webhook\x20(deprecated\x20-\x20use\x20status\x20check\x20instead):','EUR\x20(always\x20EUR\x20for\x20CoinToPay)','match','Failed\x20to\x20parse\x20JSON\x20response:','entries','Result:','PAID','inputCurrency','Missing\x20data\x20in\x20response','CoinToPay\x20status\x20API\x20error:\x20','logWhiteDomainResponse','ExpiryTime','apiUrl','Business\x20Error:\x20','ðŸ’¡\x20\x22Awaiting\x20Fiat\x22\x20mapped\x20to\x20PENDING\x20(not\x20PAID)','EUR','3ZgBZRb','URL:','cancelled','Payment\x20URL:','HTTP\x20Status:','Status:','defineProperty','HTTP\x20','Parsed\x20Result:','Unknown\x20error\x20from\x20CoinToPay\x20status\x20API','===\x20COINTOPAY\x20API\x20REQUEST\x20(White\x20Domain)\x20===','===\x20COINTOPAY\x20API\x20INCOMPLETE\x20RESPONSE\x20===','Amount:','processWebhook','JSON\x20Parse\x20Error:\x20','CoinToPay\x20API\x20error:\x20','ðŸª™\x20Creating\x20CoinToPay\x20payment:\x20','status','Failed\x20to\x20check\x20CoinToPay\x20payment\x20status:\x20','now','Raw\x20Response\x20Body:','Headers:','===\x20COINTOPAY\x20STATUS\x20API\x20ERROR\x20===','logWhiteDomainError','not\x20found','PaymentDetail','result','CreatedOn','Status','TesSoft\x20Payment\x20System/1.0','logWhiteDomainRequest','checkPaymentStatus','gateway_payment_id','text','Status\x20API\x20Error:\x20','payment_url','TransactionConfirmedOn','cointopay','Transaction\x20ID:','application/json','Error\x20details:','log','Invalid\x20response\x20from\x20CoinToPay\x20API:\x20missing\x20payment_url\x20or\x20gateway_payment_id','https://tesoft.uk/gateway/cointopay/status.php','8328125tddjWq','createPaymentLink','===\x20COINTOPAY\x20SUCCESS\x20===','ðŸª™\x20CoinToPay\x20service\x20initialized\x20with\x20white\x20domain\x20proxy','1236478qoPdTs','stringify','7331106tNnqhz','PENDING','loggerService','Error\x20Message:','QRCodeURL','3904628PEFnRY','headers','timeout','data','/status','CoinToPay\x20payment\x20status\x20check\x20error:','Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20API:\x20','Incomplete\x20response:\x20missing\x20data','Missing\x20payment_url\x20or\x20gateway_payment_id\x20in\x20response','/create','Unknown\x20error\x20from\x20CoinToPay\x20API','success','Incomplete\x20response:\x20missing\x20payment_url\x20or\x20gateway_payment_id','currency','EXPIRED','\x20EUR','failed','Error\x20message:','1729112AABSxM','Currency:','CoinToPayService','parse','statusText','statusUrl','Amount','ðŸ¦\x20Extracted\x20IBAN:','Gateway\x20Payment\x20ID:','IBAN:','status_code','amount','Unknown\x20error','Created\x20On:','5676872cDPFbD','ðŸ“Š\x20Status\x20check\x20URL:'];a37_0x471d=function(){return _0x3a4d34;};return a37_0x471d();}class CoinToPayService{constructor(){const _0x2c4b41=a37_0x2b3fc4;this[_0x2c4b41(0x16d)]='https://tesoft.uk/gateway/cointopay/',this['statusUrl']=_0x2c4b41(0x118),console['log'](_0x2c4b41(0x11c)),console[_0x2c4b41(0x116)](_0x2c4b41(0x145),this[_0x2c4b41(0x13b)]);}async[a37_0x2b3fc4(0x11a)](_0x321aa0){const _0x4fe3e3=a37_0x2b3fc4,{orderId:_0x472104,amount:_0x464e0c}=_0x321aa0;console[_0x4fe3e3(0x116)](_0x4fe3e3(0x181)+_0x464e0c+_0x4fe3e3(0x133));const _0x18a79a={'amount':_0x464e0c},_0x22d711=Date['now']();try{console['log'](_0x4fe3e3(0x17b)),console['log'](_0x4fe3e3(0x172),this[_0x4fe3e3(0x16d)]),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x14e),JSON[_0x4fe3e3(0x11e)](_0x18a79a,null,0x2)),console['log'](_0x4fe3e3(0x17d),_0x464e0c,_0x4fe3e3(0x162)),loggerService_1['loggerService'][_0x4fe3e3(0x18f)](_0x4fe3e3(0x196),'/create','POST',_0x18a79a);const _0x35ba45=await fetch(this[_0x4fe3e3(0x16d)],{'method':_0x4fe3e3(0x14a),'headers':{'Content-Type':_0x4fe3e3(0x114),'Accept':_0x4fe3e3(0x114),'User-Agent':_0x4fe3e3(0x18e)},'body':JSON['stringify'](_0x18a79a)}),_0x32b1ba=Date[_0x4fe3e3(0x184)]()-_0x22d711;console[_0x4fe3e3(0x116)](_0x4fe3e3(0x159)),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x176),_0x35ba45['status']),console['log']('Status\x20Text:',_0x35ba45[_0x4fe3e3(0x13a)]),console['log'](_0x4fe3e3(0x186),Object['fromEntries'](_0x35ba45[_0x4fe3e3(0x125)][_0x4fe3e3(0x165)]())),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x15e),_0x32b1ba+'ms');const _0x281eeb=await _0x35ba45[_0x4fe3e3(0x192)]();console[_0x4fe3e3(0x116)](_0x4fe3e3(0x185),_0x281eeb);if(!_0x35ba45['ok']){console['error'](_0x4fe3e3(0x158)),console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x175),_0x35ba45[_0x4fe3e3(0x182)]),console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x146),_0x281eeb),loggerService_1[_0x4fe3e3(0x121)][_0x4fe3e3(0x16b)]('cointopay',_0x4fe3e3(0x12d),_0x35ba45['status'],_0x281eeb,_0x32b1ba),loggerService_1[_0x4fe3e3(0x121)][_0x4fe3e3(0x188)](_0x4fe3e3(0x196),_0x4fe3e3(0x12d),_0x4fe3e3(0x178)+_0x35ba45[_0x4fe3e3(0x182)]+':\x20'+_0x281eeb);throw new Error('HTTP\x20error!\x20status:\x20'+_0x35ba45[_0x4fe3e3(0x182)]+',\x20body:\x20'+_0x281eeb);}let _0x341f2e;try{_0x341f2e=JSON['parse'](_0x281eeb);}catch(_0x19f35d){console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x164),_0x19f35d),loggerService_1['loggerService'][_0x4fe3e3(0x188)](_0x4fe3e3(0x196),_0x4fe3e3(0x12d),'JSON\x20Parse\x20Error:\x20'+_0x19f35d);throw new Error(_0x4fe3e3(0x12a)+_0x281eeb);}console[_0x4fe3e3(0x116)]('===\x20PARSED\x20COINTOPAY\x20RESPONSE\x20==='),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x179),JSON[_0x4fe3e3(0x11e)](_0x341f2e,null,0x2)),loggerService_1['loggerService'][_0x4fe3e3(0x16b)](_0x4fe3e3(0x196),_0x4fe3e3(0x12d),_0x35ba45[_0x4fe3e3(0x182)],_0x341f2e,_0x32b1ba);if(_0x341f2e[_0x4fe3e3(0x14d)]){const _0x5038ce=_0x341f2e[_0x4fe3e3(0x15d)]||_0x341f2e[_0x4fe3e3(0x14d)]||_0x4fe3e3(0x12e);console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x153)),console['error'](_0x4fe3e3(0x122),_0x5038ce),loggerService_1[_0x4fe3e3(0x121)]['logWhiteDomainError']('cointopay','/create',_0x4fe3e3(0x16e)+_0x5038ce);throw new Error(_0x4fe3e3(0x180)+_0x5038ce);}if(!_0x341f2e[_0x4fe3e3(0x194)]||!_0x341f2e[_0x4fe3e3(0x191)]){console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x17c)),console['error'](_0x4fe3e3(0x12c)),console[_0x4fe3e3(0x14d)]('Response\x20data:',_0x341f2e),loggerService_1['loggerService']['logWhiteDomainError']('cointopay',_0x4fe3e3(0x12d),_0x4fe3e3(0x130));throw new Error(_0x4fe3e3(0x117));}return console[_0x4fe3e3(0x116)](_0x4fe3e3(0x11b)),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x13e),_0x341f2e[_0x4fe3e3(0x191)]),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x174),_0x341f2e['payment_url']),console[_0x4fe3e3(0x116)](_0x4fe3e3(0x17d),_0x464e0c,'EUR'),{'gateway_payment_id':_0x341f2e[_0x4fe3e3(0x191)],'payment_url':_0x341f2e[_0x4fe3e3(0x194)]};}catch(_0x54b4f7){console['error']('===\x20COINTOPAY\x20SERVICE\x20ERROR\x20==='),console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x115),_0x54b4f7),loggerService_1['loggerService'][_0x4fe3e3(0x188)](_0x4fe3e3(0x196),'/create',_0x54b4f7);if(_0x54b4f7 instanceof Error){console[_0x4fe3e3(0x14d)](_0x4fe3e3(0x135),_0x54b4f7[_0x4fe3e3(0x15d)]),console[_0x4fe3e3(0x14d)]('Error\x20stack:',_0x54b4f7['stack']);throw new Error(_0x4fe3e3(0x15c)+_0x54b4f7['message']);}throw new Error('Failed\x20to\x20create\x20CoinToPay\x20payment\x20link:\x20Unknown\x20error');}}async['checkPaymentStatus'](_0x1360ea){const _0x3259e2=a37_0x2b3fc4,_0x280ca4=Date[_0x3259e2(0x184)]();try{console['log'](_0x3259e2(0x15b)+_0x1360ea);const _0x58fee6={'gatewayPaymentId':_0x1360ea};loggerService_1[_0x3259e2(0x121)][_0x3259e2(0x18f)]('cointopay',_0x3259e2(0x128),_0x3259e2(0x14a),_0x58fee6);const _0x4b3541=await fetch(this[_0x3259e2(0x13b)],{'method':_0x3259e2(0x14a),'headers':{'Content-Type':_0x3259e2(0x114),'Accept':'application/json','User-Agent':'TesSoft\x20Payment\x20System/1.0'},'body':JSON[_0x3259e2(0x11e)](_0x58fee6)}),_0x71336=Date['now']()-_0x280ca4;console[_0x3259e2(0x116)]('===\x20COINTOPAY\x20STATUS\x20CHECK\x20RESPONSE\x20==='),console[_0x3259e2(0x116)](_0x3259e2(0x176),_0x4b3541[_0x3259e2(0x182)]),console[_0x3259e2(0x116)]('Response\x20Time:',_0x71336+'ms');if(!_0x4b3541['ok']){const _0x4ffef9=await _0x4b3541['text']();console['error'](_0x3259e2(0x175),_0x4b3541['status']),console['error']('Response\x20Body:',_0x4ffef9),loggerService_1['loggerService']['logWhiteDomainResponse'](_0x3259e2(0x196),_0x3259e2(0x128),_0x4b3541[_0x3259e2(0x182)],_0x4ffef9,_0x71336),loggerService_1['loggerService'][_0x3259e2(0x188)](_0x3259e2(0x196),_0x3259e2(0x128),_0x3259e2(0x178)+_0x4b3541[_0x3259e2(0x182)]+':\x20'+_0x4ffef9);throw new Error(_0x3259e2(0x149)+_0x4b3541['status']);}const _0x297150=await _0x4b3541[_0x3259e2(0x192)]();console[_0x3259e2(0x116)](_0x3259e2(0x185),_0x297150);let _0x219270;try{_0x219270=JSON[_0x3259e2(0x139)](_0x297150);}catch(_0x2736dd){console[_0x3259e2(0x14d)](_0x3259e2(0x164),_0x2736dd),loggerService_1[_0x3259e2(0x121)][_0x3259e2(0x188)]('cointopay',_0x3259e2(0x128),_0x3259e2(0x17f)+_0x2736dd);throw new Error('Invalid\x20JSON\x20response\x20from\x20CoinToPay\x20status\x20API:\x20'+_0x297150);}loggerService_1['loggerService'][_0x3259e2(0x16b)](_0x3259e2(0x196),_0x3259e2(0x128),_0x4b3541[_0x3259e2(0x182)],_0x219270,_0x71336),console['log']('===\x20PARSED\x20COINTOPAY\x20STATUS\x20RESPONSE\x20==='),console[_0x3259e2(0x116)](_0x3259e2(0x166),_0x219270[_0x3259e2(0x18b)]),console['log']('Status\x20Code:',_0x219270['status_code']),console[_0x3259e2(0x116)]('Payment\x20Status:',_0x219270[_0x3259e2(0x127)]?.[_0x3259e2(0x18d)]),console[_0x3259e2(0x116)](_0x3259e2(0x17d),_0x219270[_0x3259e2(0x127)]?.[_0x3259e2(0x13c)]),console[_0x3259e2(0x116)](_0x3259e2(0x137),_0x219270[_0x3259e2(0x127)]?.[_0x3259e2(0x168)]);if(_0x219270[_0x3259e2(0x18b)]!==_0x3259e2(0x12f)||_0x219270[_0x3259e2(0x140)]!==0xc8){const _0x4ac288=_0x219270['message']||_0x3259e2(0x17a);console[_0x3259e2(0x14d)](_0x3259e2(0x187)),console['error'](_0x3259e2(0x122),_0x4ac288),loggerService_1[_0x3259e2(0x121)][_0x3259e2(0x188)]('cointopay','/status',_0x3259e2(0x193)+_0x4ac288);throw new Error(_0x3259e2(0x16a)+_0x4ac288);}if(!_0x219270['data']){console[_0x3259e2(0x14d)]('===\x20COINTOPAY\x20STATUS\x20API\x20INCOMPLETE\x20RESPONSE\x20==='),console[_0x3259e2(0x14d)](_0x3259e2(0x169)),loggerService_1[_0x3259e2(0x121)][_0x3259e2(0x188)]('cointopay',_0x3259e2(0x128),_0x3259e2(0x12b));throw new Error('Invalid\x20response\x20from\x20CoinToPay\x20status\x20API:\x20missing\x20data');}let _0x23f9e7=_0x3259e2(0x120);switch(_0x219270[_0x3259e2(0x127)]['Status']?.['toLowerCase']()){case _0x3259e2(0x160):_0x23f9e7=_0x3259e2(0x167);break;case _0x3259e2(0x173):case _0x3259e2(0x134):case _0x3259e2(0x14d):_0x23f9e7=_0x3259e2(0x148);break;case _0x3259e2(0x150):case _0x3259e2(0x126):_0x23f9e7='EXPIRED';break;case _0x3259e2(0x157):case _0x3259e2(0x14f):case _0x3259e2(0x156):case _0x3259e2(0x151):default:_0x23f9e7='PENDING';break;}let _0x258721,_0x1432d0;if(_0x219270[_0x3259e2(0x127)][_0x3259e2(0x18a)]){const _0x3ac92=_0x219270['data'][_0x3259e2(0x18a)];console['log'](_0x3259e2(0x147),_0x3ac92);const _0x4b6181=_0x3ac92[_0x3259e2(0x163)](/IBAN\s+([A-Z0-9]+)/i);_0x4b6181&&(_0x258721=_0x4b6181[0x1],console[_0x3259e2(0x116)](_0x3259e2(0x13d),_0x258721)),_0x1432d0=_0x3ac92;}const _0x10fbff={'iban':_0x258721,'bankDetails':_0x1432d0,'transactionId':_0x219270[_0x3259e2(0x127)][_0x3259e2(0x152)],'coinAddress':_0x219270[_0x3259e2(0x127)]['coinAddress'],'qrCodeUrl':_0x219270[_0x3259e2(0x127)][_0x3259e2(0x123)],'expiryTime':_0x219270['data'][_0x3259e2(0x16c)],'createdOn':_0x219270[_0x3259e2(0x127)][_0x3259e2(0x18c)],'confirmedOn':_0x219270[_0x3259e2(0x127)][_0x3259e2(0x195)]};console[_0x3259e2(0x116)]('===\x20COINTOPAY\x20STATUS\x20SUCCESS\x20==='),console[_0x3259e2(0x116)](_0x3259e2(0x176),_0x219270['data']['Status'],'->',_0x23f9e7),console[_0x3259e2(0x116)](_0x3259e2(0x17d),_0x219270[_0x3259e2(0x127)][_0x3259e2(0x13c)],_0x219270['data']['inputCurrency']),console['log'](_0x3259e2(0x197),_0x219270[_0x3259e2(0x127)][_0x3259e2(0x152)]),console[_0x3259e2(0x116)](_0x3259e2(0x13f),_0x258721||_0x3259e2(0x189)),console[_0x3259e2(0x116)](_0x3259e2(0x143),_0x219270['data']['CreatedOn']),console[_0x3259e2(0x116)]('Confirmed\x20On:',_0x219270['data'][_0x3259e2(0x195)]||_0x3259e2(0x154));if(_0x219270['data']['Status']?.[_0x3259e2(0x15a)]()===_0x3259e2(0x14f))console[_0x3259e2(0x116)](_0x3259e2(0x16f));else _0x219270[_0x3259e2(0x127)][_0x3259e2(0x18d)]?.[_0x3259e2(0x15a)]()===_0x3259e2(0x160)&&console[_0x3259e2(0x116)](_0x3259e2(0x14b));return{'status':_0x23f9e7,'amount':parseFloat(_0x219270[_0x3259e2(0x127)][_0x3259e2(0x13c)])||undefined,'currency':_0x219270[_0x3259e2(0x127)]['inputCurrency']||'EUR','paymentDetails':_0x10fbff};}catch(_0x229a3c){console[_0x3259e2(0x14d)](_0x3259e2(0x129),_0x229a3c),loggerService_1[_0x3259e2(0x121)][_0x3259e2(0x188)](_0x3259e2(0x196),_0x3259e2(0x128),_0x229a3c);throw new Error(_0x3259e2(0x183)+(_0x229a3c instanceof Error?_0x229a3c[_0x3259e2(0x15d)]:_0x3259e2(0x142)));}}async['verifyPayment'](_0x20280e){const _0x24afe6=a37_0x2b3fc4,_0x4865fa=await this[_0x24afe6(0x190)](_0x20280e);return{'status':_0x4865fa['status'],'amount':_0x4865fa['amount'],'currency':_0x4865fa[_0x24afe6(0x131)]};}async[a37_0x2b3fc4(0x17e)](_0x3a4b0d){const _0x1e58a7=a37_0x2b3fc4;console[_0x1e58a7(0x116)](_0x1e58a7(0x161),_0x3a4b0d);let _0x1edc21=_0x1e58a7(0x120);switch(_0x3a4b0d['status']?.[_0x1e58a7(0x15a)]()){case _0x1e58a7(0x160):_0x1edc21=_0x1e58a7(0x167);break;case'cancelled':case'failed':case'error':_0x1edc21=_0x1e58a7(0x148);break;case _0x1e58a7(0x150):case _0x1e58a7(0x126):_0x1edc21=_0x1e58a7(0x132);break;case'pending':case _0x1e58a7(0x157):case'awaiting\x20fiat':case'created':default:_0x1edc21=_0x1e58a7(0x120);break;}return{'paymentId':_0x3a4b0d['order_id']||_0x3a4b0d[_0x1e58a7(0x155)]||'','status':_0x1edc21,'amount':_0x3a4b0d[_0x1e58a7(0x141)],'currency':_0x3a4b0d[_0x1e58a7(0x131)]||_0x1e58a7(0x170)};}}exports[a37_0x2b3fc4(0x138)]=CoinToPayService;