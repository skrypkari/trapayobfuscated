'use strict';function a47_0x5543(){const _0x90dbbd=['GRC','COL','CHN','ZWE','Tracker\x20ID:','Customer:','‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','MOZ','3985629akifzx','4789708sFnYRj','__esModule','SVK','JOR','checkPaymentStatus','MYS','POL','waiting','FAILED','Email:','ARM','NPL','status','KWT','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','üìä\x20AmPay\x20TRY\x20parsed\x20response:','TrapayEnd/1.0','stringify','SUR','email','toLowerCase','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','BGR','MNE','BGD','API_PUBLIC_KEY','error','loggerService','completed','PHL','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','tracker_id','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','orderId','warn','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','OMN','2282777ovzqGt','client_transaction_id','‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20','PSE','SAU','apiUrl','NGA','SGP','ARE','logWebhookReceived','5918Rnylln','10361360FIBknD','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','MKD','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','USA','5394950PIxCmV','LIE','not\x20provided','117qoesjA','ESP','CAN','XKX','PAK','Customer\x20Country\x20(2-letter):','IRN','Customer\x20Country\x20(3-letter):','declined','log','TKM','application/json','ZMB','verifyWebhookSignature','processing','524710PluRnf','EGY','BRA','ISL','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','success','LAO','MMR','parse','RUS','system_id','MCO','System\x20ID:','CZE','Amount:','FLK','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','PENDING','IDN','ampay.php','processWebhook','MLT','createPayment','AZE','MUS','TRAFFER','NLD','SYR','UZB','TZA','text','CLIENT_MERCHANT_ID','AFG','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','pending','FRA','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','KAZ','Order\x20ID:','MDG','BLR','paid','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','toUpperCase','HUN','DEU','customerCountry','SWE','CHL','currency','paymentId','üìä\x20AmPay\x20TRY\x20response\x20data:','LTU','SRB','IND','ITA','AmPayTRYService','message','PRK','customerIp','LVA','TRY','TJK','/status','error_message','29MfFlWx','amount','GHA','failed','üì•\x20AmPay\x20TRY\x20raw\x20response:','POST','ampay-try','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','SVN','VNM','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','expired','LBN','VEN','https://traffer.uk/gateway/ampay-try/webhook.php','DNK','successUrl',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','lastName','logWebhookError','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','redirect_url','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','Phone:','TUR','GBR','ALB','LUX','createPaymentLink','Status:','timeout','PAID','NOR','UKR','THA','GEO','convert2LetterTo3LetterCountryCode','KOR','HRV','IRQ','AmPay\x20TRY\x20API\x20error:\x20','EXPIRED','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','GAM','24gqODaH','JPN','URY','UGA','AND','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet'];a47_0x5543=function(){return _0x90dbbd;};return a47_0x5543();}const a47_0x47da31=a47_0x103b;(function(_0x233d01,_0x424d82){const _0x116ddc=a47_0x103b,_0xa80394=_0x233d01();while(!![]){try{const _0x4d41f3=parseInt(_0x116ddc(0xab))/0x1*(parseInt(_0x116ddc(0x116))/0x2)+parseInt(_0x116ddc(0xe5))/0x3+parseInt(_0x116ddc(0xe6))/0x4+-parseInt(_0x116ddc(0x11c))/0x5+-parseInt(_0x116ddc(0xd7))/0x6*(-parseInt(_0x116ddc(0x10c))/0x7)+-parseInt(_0x116ddc(0x117))/0x8+parseInt(_0x116ddc(0x11f))/0x9*(-parseInt(_0x116ddc(0x6a))/0xa);if(_0x4d41f3===_0x424d82)break;else _0xa80394['push'](_0xa80394['shift']());}catch(_0x540318){_0xa80394['push'](_0xa80394['shift']());}}}(a47_0x5543,0xd1f26));Object['defineProperty'](exports,a47_0x47da31(0xe7),{'value':!![]}),exports[a47_0x47da31(0xa2)]=void 0x0;const loggerService_1=require('../loggerService');function a47_0x103b(_0x385fb7,_0x361873){const _0x554350=a47_0x5543();return a47_0x103b=function(_0x103b8a,_0x481a65){_0x103b8a=_0x103b8a-0x69;let _0x5cf110=_0x554350[_0x103b8a];return _0x5cf110;},a47_0x103b(_0x385fb7,_0x361873);}class AmPayTRYService{constructor(){const _0x5b0ed7=a47_0x47da31;this[_0x5b0ed7(0x89)]=_0x5b0ed7(0x83),this['API_PUBLIC_KEY']='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this['API_PRIVATE_KEY']=_0x5b0ed7(0xc1),this[_0x5b0ed7(0x111)]='https://traffer.uk/gateway/ampay-try/',console[_0x5b0ed7(0x128)]('üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing');}[a47_0x47da31(0xcf)](_0xfdf4ad){const _0x5b1e6a=a47_0x47da31,_0x35388a={'AD':_0x5b1e6a(0xdb),'AL':_0x5b1e6a(0xc5),'AT':'AUT','BA':'BIH','BE':'BEL','BG':_0x5b1e6a(0xfd),'BY':_0x5b1e6a(0x92),'CH':'CHE','CY':'CYP','CZ':_0x5b1e6a(0x77),'DE':_0x5b1e6a(0x97),'DK':_0x5b1e6a(0xba),'EE':'EST','ES':_0x5b1e6a(0x120),'FI':'FIN','FR':_0x5b1e6a(0x8d),'GB':_0x5b1e6a(0xc4),'GE':_0x5b1e6a(0xce),'GR':_0x5b1e6a(0xdd),'HR':_0x5b1e6a(0xd1),'HU':_0x5b1e6a(0x96),'IE':'IRL','IS':_0x5b1e6a(0x6d),'IT':_0x5b1e6a(0xa1),'LI':_0x5b1e6a(0x11d),'LT':_0x5b1e6a(0x9e),'LU':_0x5b1e6a(0xc6),'LV':_0x5b1e6a(0xa6),'MC':_0x5b1e6a(0x75),'MD':'MDA','ME':_0x5b1e6a(0xfe),'MK':_0x5b1e6a(0x119),'MT':_0x5b1e6a(0x7f),'NL':_0x5b1e6a(0x84),'NO':_0x5b1e6a(0xcb),'PL':_0x5b1e6a(0xec),'PT':'PRT','RO':'ROU','RS':_0x5b1e6a(0x9f),'RU':_0x5b1e6a(0x73),'SE':_0x5b1e6a(0x99),'SI':_0x5b1e6a(0xb3),'SK':_0x5b1e6a(0xe8),'SM':'SMR','UA':_0x5b1e6a(0xcc),'VA':'VAT','XK':_0x5b1e6a(0x122),'AM':_0x5b1e6a(0xf0),'AZ':_0x5b1e6a(0x81),'KZ':_0x5b1e6a(0x8f),'KG':'KGZ','TJ':_0x5b1e6a(0xa8),'TM':_0x5b1e6a(0x129),'UZ':_0x5b1e6a(0x86),'US':_0x5b1e6a(0x11b),'CA':_0x5b1e6a(0x121),'AU':'AUS','JP':_0x5b1e6a(0xd8),'CN':_0x5b1e6a(0xdf),'IN':_0x5b1e6a(0xa0),'BR':_0x5b1e6a(0x6c),'MX':'MEX','AR':'ARG','CL':_0x5b1e6a(0x9a),'PE':'PER','CO':_0x5b1e6a(0xde),'VE':_0x5b1e6a(0xb8),'EC':'ECU','BO':'BOL','PY':'PRY','UY':_0x5b1e6a(0xd9),'SR':_0x5b1e6a(0xf9),'GY':'GUY','FK':_0x5b1e6a(0x79),'ZA':'ZAF','EG':_0x5b1e6a(0x6b),'NG':_0x5b1e6a(0x112),'KE':'KEN','GH':_0x5b1e6a(0xad),'TZ':_0x5b1e6a(0x87),'UG':_0x5b1e6a(0xda),'ZW':_0x5b1e6a(0xe0),'ZM':_0x5b1e6a(0x12b),'MW':'MWI','MZ':_0x5b1e6a(0xe4),'MG':_0x5b1e6a(0x91),'MU':_0x5b1e6a(0x82),'SC':'SYC','RE':'REU','TR':_0x5b1e6a(0xc3),'IR':_0x5b1e6a(0x125),'IQ':_0x5b1e6a(0xd2),'SA':_0x5b1e6a(0x110),'AE':_0x5b1e6a(0x114),'KW':_0x5b1e6a(0xf3),'QA':'QAT','BH':'BHR','OM':_0x5b1e6a(0x10b),'YE':'YEM','JO':_0x5b1e6a(0xe9),'LB':_0x5b1e6a(0xb7),'SY':_0x5b1e6a(0x85),'IL':'ISR','PS':_0x5b1e6a(0x10f),'KR':_0x5b1e6a(0xd0),'KP':_0x5b1e6a(0xa4),'TH':_0x5b1e6a(0xcd),'VN':_0x5b1e6a(0xb4),'MY':_0x5b1e6a(0xeb),'SG':_0x5b1e6a(0x113),'ID':_0x5b1e6a(0x7c),'PH':_0x5b1e6a(0x104),'LA':_0x5b1e6a(0x70),'KH':'KHM','MM':_0x5b1e6a(0x71),'BD':_0x5b1e6a(0xff),'LK':'LKA','NP':_0x5b1e6a(0xf1),'BT':'BTN','MV':'MDV','AF':_0x5b1e6a(0x8a),'PK':_0x5b1e6a(0x123),'MN':'MNG'},_0x343d7f=_0x35388a[_0xfdf4ad[_0x5b1e6a(0x95)]()];if(!_0x343d7f)return console[_0x5b1e6a(0x109)](_0x5b1e6a(0x10e)+_0xfdf4ad+_0x5b1e6a(0xbc)),_0x5b1e6a(0xc3);return _0x343d7f;}async[a47_0x47da31(0x80)](_0x2a3097){const _0x3fdab0=a47_0x47da31;console['log'](_0x3fdab0(0x8b),{'paymentId':_0x2a3097[_0x3fdab0(0x9c)],'amount':_0x2a3097[_0x3fdab0(0xac)],'currency':_0x2a3097[_0x3fdab0(0x9b)],'customerCountry':_0x2a3097['customerCountry']});try{const _0x257658={'client_merchant_id':this[_0x3fdab0(0x89)],'payment_method':'Bank\x20Transfer\x20TR','client_transaction_id':_0x2a3097[_0x3fdab0(0x108)],'amount':_0x2a3097[_0x3fdab0(0xac)],'currency':_0x2a3097[_0x3fdab0(0x9b)],'callback_url':_0x3fdab0(0xb9),'tracker_id':_0x2a3097[_0x3fdab0(0x9c)],'redirect_url':_0x2a3097[_0x3fdab0(0xbb)],'failure_url':_0x2a3097['failureUrl'],'customer_first_name':_0x2a3097['firstName'],'customer_last_name':_0x2a3097[_0x3fdab0(0xbd)],'customer_email':_0x2a3097[_0x3fdab0(0xfa)],'customer_phone':_0x2a3097['phone']||'','customer_ip':_0x2a3097[_0x3fdab0(0xa5)],'customer_country':_0x2a3097[_0x3fdab0(0x98)],'api_public_key':this[_0x3fdab0(0x100)]};console[_0x3fdab0(0x128)]('üì§\x20AmPay\x20TRY\x20API\x20request\x20data:',JSON['stringify'](_0x257658,null,0x2));const _0x1fb5cb=await fetch(this[_0x3fdab0(0x111)],{'method':_0x3fdab0(0xb0),'headers':{'Content-Type':_0x3fdab0(0x12a),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x3fdab0(0xf8)](_0x257658)});console[_0x3fdab0(0x128)](_0x3fdab0(0xfc),_0x1fb5cb[_0x3fdab0(0xf2)]);const _0x1fff02=await _0x1fb5cb[_0x3fdab0(0x88)]();console[_0x3fdab0(0x128)](_0x3fdab0(0x11a),_0x1fff02);let _0x4af745;try{_0x4af745=JSON[_0x3fdab0(0x72)](_0x1fff02);}catch(_0x3cc075){console[_0x3fdab0(0x101)](_0x3fdab0(0x6e),_0x3cc075);throw new Error(_0x3fdab0(0x7a)+_0x1fff02);}console[_0x3fdab0(0x128)](_0x3fdab0(0xf6),JSON[_0x3fdab0(0xf8)](_0x4af745,null,0x2)),loggerService_1[_0x3fdab0(0x102)][_0x3fdab0(0x115)](_0x3fdab0(0xb1),_0x4af745,{});if(!_0x1fb5cb['ok']){const _0x34f9c2=_0x4af745[_0x3fdab0(0xaa)]||_0x4af745[_0x3fdab0(0xa3)]||'HTTP\x20'+_0x1fb5cb[_0x3fdab0(0xf2)];console[_0x3fdab0(0x101)]('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x34f9c2);throw new Error(_0x3fdab0(0xd3)+_0x34f9c2);}if(!_0x4af745[_0x3fdab0(0xc0)]){console['error']('‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:',_0x4af745);throw new Error(_0x3fdab0(0x105));}const _0x1cf6e8={'gateway_payment_id':_0x4af745[_0x3fdab0(0x74)]||_0x2a3097[_0x3fdab0(0x108)],'payment_url':_0x4af745['redirect_url'],'transaction_id':_0x4af745[_0x3fdab0(0x10d)]};return console['log'](_0x3fdab0(0xbf),_0x1cf6e8),_0x1cf6e8;}catch(_0x5a3eca){console[_0x3fdab0(0x101)]('‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:',_0x5a3eca),loggerService_1['loggerService'][_0x3fdab0(0xbe)](_0x3fdab0(0xb1),_0x5a3eca,_0x2a3097);throw _0x5a3eca;}}async[a47_0x47da31(0xc7)](_0x5be7e9){const _0x503701=a47_0x47da31;try{const {orderId:_0x12b2fd,amount:_0x2bec4d,currency:_0x14d8b0,firstName:_0x4ea90b,lastName:_0x2138c5,email:_0x147ff2,phone:_0xd9e95a,customerIp:_0x15dd99,customerCountry:_0x3ebef9,successUrl:_0x2ffb7b,failureUrl:_0x46bb3d}=_0x5be7e9;console[_0x503701(0x128)]('üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...'),console[_0x503701(0x128)](_0x503701(0x90),_0x12b2fd),console[_0x503701(0x128)](_0x503701(0x78),_0x2bec4d,_0x14d8b0),console[_0x503701(0x128)](_0x503701(0xe2),_0x4ea90b+'\x20'+_0x2138c5),console[_0x503701(0x128)](_0x503701(0xef),_0x147ff2),console[_0x503701(0x128)](_0x503701(0xc2),_0xd9e95a||_0x503701(0x11e)),console[_0x503701(0x128)]('Customer\x20IP:',_0x15dd99),console['log'](_0x503701(0x124),_0x3ebef9);const _0x2c453e=this[_0x503701(0xcf)](_0x3ebef9);console[_0x503701(0x128)](_0x503701(0x126),_0x2c453e);const _0x36a450={'sub_method':_0x503701(0xd6),'currency':_0x14d8b0[_0x503701(0x95)](),'amount':_0x2bec4d,'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','client_merchant_id':this[_0x503701(0x89)],'client_transaction_id':_0x12b2fd,'transaction_description':_0x12b2fd,'customer':{'ip':_0x15dd99,'email':_0x147ff2,'full_name':_0x4ea90b+'\x20'+_0x2138c5,'phone':_0xd9e95a||'','country':_0x2c453e},'success_redirect_url':_0x2ffb7b,'error_redirect_url':_0x46bb3d};console[_0x503701(0x128)]('üì§\x20AmPay\x20TRY\x20request\x20body:',JSON[_0x503701(0xf8)](_0x36a450,null,0x2));const _0x5ac40f=await fetch(this['apiUrl']+_0x503701(0x7d),{'method':'POST','headers':{'Content-Type':'application/json','User-Agent':'TrapayAPI/1.0'},'body':JSON[_0x503701(0xf8)](_0x36a450)}),_0x96f7eb=await _0x5ac40f[_0x503701(0x88)]();console['log'](_0x503701(0xaf),_0x96f7eb);if(!_0x5ac40f['ok'])throw new Error(_0x503701(0xf5)+_0x5ac40f[_0x503701(0xf2)]+'\x20-\x20'+_0x96f7eb);let _0x497a98;try{_0x497a98=JSON[_0x503701(0x72)](_0x96f7eb);}catch(_0x5f57ea){throw new Error(_0x503701(0x7a)+_0x96f7eb);}console['log'](_0x503701(0x9d),JSON[_0x503701(0xf8)](_0x497a98,null,0x2));if(!_0x497a98[_0x503701(0xc0)])throw new Error('AmPay\x20TRY\x20payment\x20creation\x20failed:\x20'+(_0x497a98['error_message']||_0x497a98[_0x503701(0xa3)]||'Unknown\x20error'));const _0x1a59c7=_0x497a98['redirect_url'],_0x138eb3=_0x497a98['system_id'],_0x5d3da4=_0x497a98[_0x503701(0x106)];return console[_0x503701(0x128)](_0x503701(0xe3)),console['log']('Payment\x20URL:',_0x1a59c7),console['log'](_0x503701(0x76),_0x138eb3),console[_0x503701(0x128)](_0x503701(0xe1),_0x5d3da4),console[_0x503701(0x128)](_0x503701(0xc8),_0x497a98[_0x503701(0xf2)]),console[_0x503701(0x128)](_0x503701(0x118)),{'gateway_payment_id':_0x138eb3||_0x5d3da4||_0x12b2fd,'payment_url':_0x1a59c7||'','transaction_id':_0x138eb3};}catch(_0x40e118){console[_0x503701(0x101)](_0x503701(0xd5),_0x40e118),console[_0x503701(0x128)]('üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...'),loggerService_1[_0x503701(0x102)]['logWebhookError'](_0x503701(0xb1),_0x40e118,_0x5be7e9);throw _0x40e118;}}async[a47_0x47da31(0xea)](_0x2238d1){const _0x113a90=a47_0x47da31;console['log'](_0x113a90(0xb2),_0x2238d1);try{const _0x34e67d={'client_merchant_id':this[_0x113a90(0x89)],'system_id':_0x2238d1,'api_public_key':this['API_PUBLIC_KEY']},_0x764ad3=await fetch(this[_0x113a90(0x111)]+_0x113a90(0xa9),{'method':'POST','headers':{'Content-Type':_0x113a90(0x12a),'User-Agent':_0x113a90(0xf7)},'body':JSON[_0x113a90(0xf8)](_0x34e67d)}),_0x164442=await _0x764ad3[_0x113a90(0x88)]();console['log'](_0x113a90(0xb5),_0x164442);let _0xf395af;try{_0xf395af=JSON[_0x113a90(0x72)](_0x164442);}catch(_0x4d2866){return console['error'](_0x113a90(0xf4),_0x4d2866),{'status':_0x113a90(0xee)};}console[_0x113a90(0x128)]('üìä\x20AmPay\x20TRY\x20status\x20response:',JSON[_0x113a90(0xf8)](_0xf395af,null,0x2));let _0x2eb0dd=_0x113a90(0x7b);if(_0xf395af['status'])switch(_0xf395af['status'][_0x113a90(0xfb)]()){case'success':case'completed':case _0x113a90(0x93):_0x2eb0dd=_0x113a90(0xca);break;case _0x113a90(0xae):case'error':case _0x113a90(0x127):_0x2eb0dd=_0x113a90(0xee);break;case _0x113a90(0xb6):case _0x113a90(0xc9):_0x2eb0dd=_0x113a90(0xd4);break;case _0x113a90(0x8c):case'processing':case'waiting':default:_0x2eb0dd='PENDING';break;}return{'status':_0x2eb0dd,'amount':_0xf395af['amount'],'currency':_0xf395af[_0x113a90(0x9b)]};}catch(_0x22d2b5){return console[_0x113a90(0x101)](_0x113a90(0x94),_0x22d2b5),{'status':'FAILED'};}}async[a47_0x47da31(0x7e)](_0x4938e3){const _0x546c9f=a47_0x47da31;console[_0x546c9f(0x128)](_0x546c9f(0x10a),JSON[_0x546c9f(0xf8)](_0x4938e3,null,0x2));try{const _0x392da2=_0x4938e3[_0x546c9f(0x106)]||_0x4938e3[_0x546c9f(0x10d)]||_0x4938e3[_0x546c9f(0x74)];if(!_0x392da2){console[_0x546c9f(0x101)](_0x546c9f(0x107));throw new Error('No\x20payment\x20ID\x20in\x20webhook\x20data');}let _0xda38b5=_0x546c9f(0x7b);if(_0x4938e3[_0x546c9f(0xf2)])switch(_0x4938e3['status'][_0x546c9f(0xfb)]()){case _0x546c9f(0x6f):case _0x546c9f(0x103):case _0x546c9f(0x93):_0xda38b5=_0x546c9f(0xca);break;case _0x546c9f(0xae):case _0x546c9f(0x101):case _0x546c9f(0x127):_0xda38b5=_0x546c9f(0xee);break;case _0x546c9f(0xb6):case'timeout':_0xda38b5=_0x546c9f(0xd4);break;case _0x546c9f(0x8c):case _0x546c9f(0x69):case _0x546c9f(0xed):default:_0xda38b5=_0x546c9f(0x7b);break;}return console['log']('üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0x392da2+'\x20->\x20'+_0xda38b5),{'paymentId':_0x392da2,'status':_0xda38b5,'amount':_0x4938e3[_0x546c9f(0xac)],'currency':_0x4938e3[_0x546c9f(0x9b)]||_0x546c9f(0xa7)};}catch(_0x454183){console[_0x546c9f(0x101)](_0x546c9f(0x8e),_0x454183);throw _0x454183;}}[a47_0x47da31(0x12c)](_0x1337f5,_0x17d30e){const _0x243e6b=a47_0x47da31;return console[_0x243e6b(0x128)](_0x243e6b(0xdc)),!![];}}exports[a47_0x47da31(0xa2)]=AmPayTRYService;