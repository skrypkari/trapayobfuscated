'use strict';const a55_0x22118f=a55_0x2445;function a55_0x2445(_0x1de4c5,_0x1cce6f){_0x1de4c5=_0x1de4c5-0xae;const _0x666c9=a55_0x666c();let _0x244581=_0x666c9[_0x1de4c5];return _0x244581;}(function(_0x559f1e,_0x460bca){const _0x1ea9e2=a55_0x2445,_0x54a135=_0x559f1e();while(!![]){try{const _0x1f660d=-parseInt(_0x1ea9e2(0x167))/0x1+-parseInt(_0x1ea9e2(0x13b))/0x2+-parseInt(_0x1ea9e2(0xea))/0x3*(-parseInt(_0x1ea9e2(0x145))/0x4)+-parseInt(_0x1ea9e2(0x158))/0x5+parseInt(_0x1ea9e2(0x10f))/0x6*(-parseInt(_0x1ea9e2(0xfd))/0x7)+parseInt(_0x1ea9e2(0xce))/0x8+parseInt(_0x1ea9e2(0x152))/0x9;if(_0x1f660d===_0x460bca)break;else _0x54a135['push'](_0x54a135['shift']());}catch(_0xe0bdc0){_0x54a135['push'](_0x54a135['shift']());}}}(a55_0x666c,0xc1031));Object[a55_0x22118f(0x106)](exports,a55_0x22118f(0x117),{'value':!![]}),exports[a55_0x22118f(0x151)]=void 0x0;const loggerService_1=require(a55_0x22118f(0x126));function a55_0x666c(){const _0x427b38=['error_message','verifyWebhookSignature','PSE','CZE','error','KEN','KHM','JOR','HUN','status','üì•\x20AmPay\x20TRY\x20raw\x20response:','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','FLK','BRA','MOZ','SGP','IRL','97473hxGkkk','SYC','GUY','firstName','COL','CHL','MNG','KGZ','processing','successUrl','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','LBN','client_transaction_id','58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda','XKX','parse','\x20-\x20','7IfGjlY','ALB','PAK','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','üìä\x20AmPay\x20TRY\x20response\x20data:','processWebhook','waiting','/status','KWT','defineProperty','HRV','Bank\x20Transfer\x20TR','SUR','BIH','MDG','pending','LTU','amount','328326opkFRx','system_id','ESP','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','GAM','URY','UKR','IND','__esModule','IDN','ZAF','MKD','Email:','UGA','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','BTN','GBR','ARE','PAID','TZA','MDA','Customer:','log','../loggerService','declined','GHA','Payment\x20URL:','ampay.php','CHN','timeout','üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','FAILED','MWI','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','No\x20payment\x20ID\x20in\x20webhook\x20data','createPaymentLink','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','TJK','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','Unknown\x20error','BEL','https://traffer.uk/gateway/ampay-try/webhook.php','DNK','96600mWQuWu','ROU','completed','CLIENT_MERCHANT_ID','message','CAN','checkPaymentStatus','NGA','AZE','orderId','4KWmuQh','PRT','failed','not\x20provided','redirect_url','logWebhookError','VNM','API_PRIVATE_KEY','MNE','success','THA','Amount:','AmPayTRYService','27699507pDkQyL','‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20','Order\x20ID:','FIN','GEO','loggerService','7313855aWdYco','Customer\x20Country\x20(2-letter):','MYS','toLowerCase','TRAFFER','POST','BHR','API_PUBLIC_KEY','AFG','PENDING','HTTP\x20','UZB','AND','LVA','warn','1069898NkNiCK','currency','Customer\x20Country\x20(3-letter):','ITA','AUT','PER','NLD','TUR','SYR','ARM',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','convert2LetterTo3LetterCountryCode','LAO','VAT','IRN','toUpperCase','LKA','BGD','POL','MLT','OMN','paid','üì§\x20AmPay\x20TRY\x20API\x20request\x20data:','text','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','ampay-try','email','VEN','failureUrl','TrapayEnd/1.0','paymentId','EXPIRED','MDV','ISR','REU','apiUrl','customerIp','YEM','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','SAU','PRK','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','application/json','ARG','LUX','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','Tracker\x20ID:','expired','2528424tuiyOu','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','FRA','MUS','System\x20ID:','tracker_id','MCO','BGR','stringify','AmPay\x20TRY\x20API\x20error:\x20','TKM'];a55_0x666c=function(){return _0x427b38;};return a55_0x666c();}class AmPayTRYService{constructor(){const _0x5ccc1b=a55_0x22118f;this[_0x5ccc1b(0x13e)]=_0x5ccc1b(0x15c),this[_0x5ccc1b(0x15f)]=_0x5ccc1b(0xf9),this[_0x5ccc1b(0x14c)]=_0x5ccc1b(0xcb),this[_0x5ccc1b(0xc1)]='https://traffer.uk/gateway/ampay-try/',console[_0x5ccc1b(0x125)](_0x5ccc1b(0xb6));}[a55_0x22118f(0x172)](_0xf1fdb1){const _0x5e3a48=a55_0x22118f,_0x346f31={'AD':_0x5e3a48(0x164),'AL':_0x5e3a48(0xfe),'AT':_0x5e3a48(0x16b),'BA':_0x5e3a48(0x10a),'BE':_0x5e3a48(0x138),'BG':_0x5e3a48(0xd5),'BY':'BLR','CH':'CHE','CY':'CYP','CZ':_0x5e3a48(0xdc),'DE':'DEU','DK':_0x5e3a48(0x13a),'EE':'EST','ES':_0x5e3a48(0x111),'FI':_0x5e3a48(0x155),'FR':_0x5e3a48(0xd0),'GB':_0x5e3a48(0x11f),'GE':_0x5e3a48(0x156),'GR':'GRC','HR':_0x5e3a48(0x107),'HU':_0x5e3a48(0xe1),'IE':_0x5e3a48(0xe9),'IS':'ISL','IT':_0x5e3a48(0x16a),'LI':'LIE','LT':_0x5e3a48(0x10d),'LU':_0x5e3a48(0xca),'LV':_0x5e3a48(0x165),'MC':_0x5e3a48(0xd4),'MD':_0x5e3a48(0x123),'ME':_0x5e3a48(0x14d),'MK':_0x5e3a48(0x11a),'MT':_0x5e3a48(0xb1),'NL':_0x5e3a48(0x16d),'NO':'NOR','PL':_0x5e3a48(0xb0),'PT':_0x5e3a48(0x146),'RO':_0x5e3a48(0x13c),'RS':'SRB','RU':'RUS','SE':'SWE','SI':'SVN','SK':'SVK','SM':'SMR','UA':_0x5e3a48(0x115),'VA':_0x5e3a48(0x174),'XK':_0x5e3a48(0xfa),'AM':_0x5e3a48(0x170),'AZ':_0x5e3a48(0x143),'KZ':'KAZ','KG':_0x5e3a48(0xf1),'TJ':_0x5e3a48(0x135),'TM':_0x5e3a48(0xd8),'UZ':_0x5e3a48(0x163),'US':'USA','CA':_0x5e3a48(0x140),'AU':'AUS','JP':'JPN','CN':_0x5e3a48(0x12b),'IN':_0x5e3a48(0x116),'BR':_0x5e3a48(0xe6),'MX':'MEX','AR':_0x5e3a48(0xc9),'CL':_0x5e3a48(0xef),'PE':_0x5e3a48(0x16c),'CO':_0x5e3a48(0xee),'VE':_0x5e3a48(0xb9),'EC':'ECU','BO':'BOL','PY':'PRY','UY':_0x5e3a48(0x114),'SR':_0x5e3a48(0x109),'GY':_0x5e3a48(0xec),'FK':_0x5e3a48(0xe5),'ZA':_0x5e3a48(0x119),'EG':'EGY','NG':_0x5e3a48(0x142),'KE':_0x5e3a48(0xde),'GH':_0x5e3a48(0x128),'TZ':_0x5e3a48(0x122),'UG':_0x5e3a48(0x11c),'ZW':'ZWE','ZM':'ZMB','MW':_0x5e3a48(0x130),'MZ':_0x5e3a48(0xe7),'MG':_0x5e3a48(0x10b),'MU':_0x5e3a48(0xd1),'SC':_0x5e3a48(0xeb),'RE':_0x5e3a48(0xc0),'TR':_0x5e3a48(0x16e),'IR':_0x5e3a48(0x175),'IQ':'IRQ','SA':_0x5e3a48(0xc5),'AE':_0x5e3a48(0x120),'KW':_0x5e3a48(0x105),'QA':'QAT','BH':_0x5e3a48(0x15e),'OM':_0x5e3a48(0xb2),'YE':_0x5e3a48(0xc3),'JO':_0x5e3a48(0xe0),'LB':_0x5e3a48(0xf7),'SY':_0x5e3a48(0x16f),'IL':_0x5e3a48(0xbf),'PS':_0x5e3a48(0xdb),'KR':'KOR','KP':_0x5e3a48(0xc6),'TH':_0x5e3a48(0x14f),'VN':_0x5e3a48(0x14b),'MY':_0x5e3a48(0x15a),'SG':_0x5e3a48(0xe8),'ID':_0x5e3a48(0x118),'PH':'PHL','LA':_0x5e3a48(0x173),'KH':_0x5e3a48(0xdf),'MM':'MMR','BD':_0x5e3a48(0xaf),'LK':_0x5e3a48(0xae),'NP':'NPL','BT':_0x5e3a48(0x11e),'MV':_0x5e3a48(0xbe),'AF':_0x5e3a48(0x160),'PK':_0x5e3a48(0xff),'MN':_0x5e3a48(0xf0)},_0x1865e2=_0x346f31[_0xf1fdb1[_0x5e3a48(0x176)]()];if(!_0x1865e2)return console[_0x5e3a48(0x166)](_0x5e3a48(0x153)+_0xf1fdb1+_0x5e3a48(0x171)),_0x5e3a48(0x16e);return _0x1865e2;}async['createPayment'](_0x44af32){const _0x24e616=a55_0x22118f;console[_0x24e616(0x125)](_0x24e616(0x134),{'paymentId':_0x44af32[_0x24e616(0xbc)],'amount':_0x44af32['amount'],'currency':_0x44af32[_0x24e616(0x168)],'customerCountry':_0x44af32['customerCountry']});try{const _0x362af3={'client_merchant_id':this[_0x24e616(0x13e)],'payment_method':_0x24e616(0x108),'client_transaction_id':_0x44af32[_0x24e616(0x144)],'amount':_0x44af32[_0x24e616(0x10e)],'currency':_0x44af32[_0x24e616(0x168)],'callback_url':_0x24e616(0x139),'tracker_id':_0x44af32[_0x24e616(0xbc)],'redirect_url':_0x44af32[_0x24e616(0xf3)],'failure_url':_0x44af32[_0x24e616(0xba)],'customer_first_name':_0x44af32[_0x24e616(0xed)],'customer_last_name':_0x44af32['lastName'],'customer_email':_0x44af32[_0x24e616(0xb8)],'customer_phone':_0x44af32['phone']||'','customer_ip':_0x44af32[_0x24e616(0xc2)],'customer_country':_0x44af32['customerCountry'],'api_public_key':this['API_PUBLIC_KEY']};console[_0x24e616(0x125)](_0x24e616(0xb4),JSON['stringify'](_0x362af3,null,0x2));const _0x2387fe=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x24e616(0xc8),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x24e616(0xd6)](_0x362af3)});console[_0x24e616(0x125)]('üì°\x20AmPay\x20TRY\x20API\x20response\x20status:',_0x2387fe[_0x24e616(0xe2)]);const _0x5276d0=await _0x2387fe[_0x24e616(0xb5)]();console[_0x24e616(0x125)]('üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:',_0x5276d0);let _0x3d1202;try{_0x3d1202=JSON[_0x24e616(0xfb)](_0x5276d0);}catch(_0x3c9c18){console['error'](_0x24e616(0x100),_0x3c9c18);throw new Error(_0x24e616(0xc4)+_0x5276d0);}console['log']('üìä\x20AmPay\x20TRY\x20parsed\x20response:',JSON[_0x24e616(0xd6)](_0x3d1202,null,0x2)),loggerService_1[_0x24e616(0x157)]['logWebhookReceived']('ampay-try',_0x3d1202,{});if(!_0x2387fe['ok']){const _0x48647c=_0x3d1202['error_message']||_0x3d1202['message']||_0x24e616(0x162)+_0x2387fe[_0x24e616(0xe2)];console[_0x24e616(0xdd)]('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x48647c);throw new Error(_0x24e616(0xd7)+_0x48647c);}if(!_0x3d1202['redirect_url']){console['error']('‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:',_0x3d1202);throw new Error('AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL');}const _0x454241={'gateway_payment_id':_0x3d1202['system_id']||_0x44af32[_0x24e616(0x144)],'payment_url':_0x3d1202[_0x24e616(0x149)],'transaction_id':_0x3d1202['client_transaction_id']};return console[_0x24e616(0x125)]('‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:',_0x454241),_0x454241;}catch(_0x188253){console[_0x24e616(0xdd)](_0x24e616(0xcf),_0x188253),loggerService_1['loggerService'][_0x24e616(0x14a)](_0x24e616(0xb7),_0x188253,_0x44af32);throw _0x188253;}}async[a55_0x22118f(0x133)](_0x413d7f){const _0x348bfa=a55_0x22118f;try{const {orderId:_0x4ede8c,amount:_0x4bdb2a,currency:_0x4762c7,firstName:_0x2c9805,lastName:_0xe8ca09,email:_0x3de8a9,phone:_0x548cd2,customerIp:_0x280427,customerCountry:_0x39b9a3,successUrl:_0x1f1808,failureUrl:_0x439365}=_0x413d7f;console['log']('üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...'),console[_0x348bfa(0x125)](_0x348bfa(0x154),_0x4ede8c),console[_0x348bfa(0x125)](_0x348bfa(0x150),_0x4bdb2a,_0x4762c7),console[_0x348bfa(0x125)](_0x348bfa(0x124),_0x2c9805+'\x20'+_0xe8ca09),console[_0x348bfa(0x125)](_0x348bfa(0x11b),_0x3de8a9),console['log']('Phone:',_0x548cd2||_0x348bfa(0x148)),console['log']('Customer\x20IP:',_0x280427),console['log'](_0x348bfa(0x159),_0x39b9a3);const _0x1b7314=this[_0x348bfa(0x172)](_0x39b9a3);console[_0x348bfa(0x125)](_0x348bfa(0x169),_0x1b7314);const _0x1af8d3={'sub_method':_0x348bfa(0x113),'currency':_0x4762c7[_0x348bfa(0x176)](),'amount':_0x4bdb2a,'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','client_merchant_id':this[_0x348bfa(0x13e)],'client_transaction_id':_0x4ede8c,'transaction_description':_0x4ede8c,'customer':{'ip':_0x280427,'email':_0x3de8a9,'full_name':_0x2c9805+'\x20'+_0xe8ca09,'phone':_0x548cd2||'','country':_0x1b7314},'success_redirect_url':_0x1f1808,'error_redirect_url':_0x439365};console[_0x348bfa(0x125)]('üì§\x20AmPay\x20TRY\x20request\x20body:',JSON[_0x348bfa(0xd6)](_0x1af8d3,null,0x2));const _0x432091=await fetch(this[_0x348bfa(0xc1)]+_0x348bfa(0x12a),{'method':_0x348bfa(0x15d),'headers':{'Content-Type':'application/json','User-Agent':'TrapayAPI/1.0'},'body':JSON[_0x348bfa(0xd6)](_0x1af8d3)}),_0x1583d9=await _0x432091[_0x348bfa(0xb5)]();console[_0x348bfa(0x125)](_0x348bfa(0xe3),_0x1583d9);if(!_0x432091['ok'])throw new Error(_0x348bfa(0x11d)+_0x432091[_0x348bfa(0xe2)]+_0x348bfa(0xfc)+_0x1583d9);let _0x3d9d14;try{_0x3d9d14=JSON['parse'](_0x1583d9);}catch(_0x46066c){throw new Error(_0x348bfa(0xc4)+_0x1583d9);}console[_0x348bfa(0x125)](_0x348bfa(0x101),JSON[_0x348bfa(0xd6)](_0x3d9d14,null,0x2));if(!_0x3d9d14[_0x348bfa(0x149)])throw new Error(_0x348bfa(0xe4)+(_0x3d9d14[_0x348bfa(0xd9)]||_0x3d9d14[_0x348bfa(0x13f)]||_0x348bfa(0x137)));const _0x462dc6=_0x3d9d14[_0x348bfa(0x149)],_0x51203e=_0x3d9d14[_0x348bfa(0x110)],_0xdb1764=_0x3d9d14[_0x348bfa(0xd3)];return console['log']('‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully'),console[_0x348bfa(0x125)](_0x348bfa(0x129),_0x462dc6),console[_0x348bfa(0x125)](_0x348bfa(0xd2),_0x51203e),console[_0x348bfa(0x125)](_0x348bfa(0xcc),_0xdb1764),console['log']('Status:',_0x3d9d14[_0x348bfa(0xe2)]),console[_0x348bfa(0x125)](_0x348bfa(0x136)),{'gateway_payment_id':_0x51203e||_0xdb1764||_0x4ede8c,'payment_url':_0x462dc6||'','transaction_id':_0x51203e};}catch(_0x3ffad1){console[_0x348bfa(0xdd)](_0x348bfa(0xcf),_0x3ffad1),console[_0x348bfa(0x125)](_0x348bfa(0xf4)),loggerService_1[_0x348bfa(0x157)]['logWebhookError'](_0x348bfa(0xb7),_0x3ffad1,_0x413d7f);throw _0x3ffad1;}}async[a55_0x22118f(0x141)](_0x4b88f9){const _0x27d703=a55_0x22118f;console[_0x27d703(0x125)]('üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:',_0x4b88f9);try{const _0x155d68={'client_merchant_id':this[_0x27d703(0x13e)],'system_id':_0x4b88f9,'api_public_key':this[_0x27d703(0x15f)]},_0x51bf79=await fetch(this['apiUrl']+_0x27d703(0x104),{'method':_0x27d703(0x15d),'headers':{'Content-Type':'application/json','User-Agent':_0x27d703(0xbb)},'body':JSON[_0x27d703(0xd6)](_0x155d68)}),_0x48edea=await _0x51bf79['text']();console[_0x27d703(0x125)](_0x27d703(0x131),_0x48edea);let _0x262aff;try{_0x262aff=JSON[_0x27d703(0xfb)](_0x48edea);}catch(_0x3d09b1){return console[_0x27d703(0xdd)](_0x27d703(0xf6),_0x3d09b1),{'status':'FAILED'};}console[_0x27d703(0x125)]('üìä\x20AmPay\x20TRY\x20status\x20response:',JSON[_0x27d703(0xd6)](_0x262aff,null,0x2));let _0x3d7786='PENDING';if(_0x262aff[_0x27d703(0xe2)])switch(_0x262aff[_0x27d703(0xe2)][_0x27d703(0x15b)]()){case _0x27d703(0x14e):case _0x27d703(0x13d):case _0x27d703(0xb3):_0x3d7786='PAID';break;case _0x27d703(0x147):case _0x27d703(0xdd):case _0x27d703(0x127):_0x3d7786=_0x27d703(0x12f);break;case _0x27d703(0xcd):case _0x27d703(0x12c):_0x3d7786=_0x27d703(0xbd);break;case _0x27d703(0x10c):case _0x27d703(0xf2):case _0x27d703(0x103):default:_0x3d7786=_0x27d703(0x161);break;}return{'status':_0x3d7786,'amount':_0x262aff[_0x27d703(0x10e)],'currency':_0x262aff['currency']};}catch(_0xbd4814){return console[_0x27d703(0xdd)](_0x27d703(0xc7),_0xbd4814),{'status':_0x27d703(0x12f)};}}async[a55_0x22118f(0x102)](_0x4bf545){const _0x5dd0be=a55_0x22118f;console[_0x5dd0be(0x125)](_0x5dd0be(0x12e),JSON['stringify'](_0x4bf545,null,0x2));try{const _0x3a1d91=_0x4bf545[_0x5dd0be(0xd3)]||_0x4bf545[_0x5dd0be(0xf8)]||_0x4bf545[_0x5dd0be(0x110)];if(!_0x3a1d91){console[_0x5dd0be(0xdd)](_0x5dd0be(0xf5));throw new Error(_0x5dd0be(0x132));}let _0x586889=_0x5dd0be(0x161);if(_0x4bf545['status'])switch(_0x4bf545[_0x5dd0be(0xe2)][_0x5dd0be(0x15b)]()){case _0x5dd0be(0x14e):case _0x5dd0be(0x13d):case _0x5dd0be(0xb3):_0x586889=_0x5dd0be(0x121);break;case'failed':case _0x5dd0be(0xdd):case _0x5dd0be(0x127):_0x586889=_0x5dd0be(0x12f);break;case _0x5dd0be(0xcd):case _0x5dd0be(0x12c):_0x586889=_0x5dd0be(0xbd);break;case _0x5dd0be(0x10c):case _0x5dd0be(0xf2):case'waiting':default:_0x586889='PENDING';break;}return console[_0x5dd0be(0x125)](_0x5dd0be(0x12d)+_0x3a1d91+'\x20->\x20'+_0x586889),{'paymentId':_0x3a1d91,'status':_0x586889,'amount':_0x4bf545[_0x5dd0be(0x10e)],'currency':_0x4bf545['currency']||'TRY'};}catch(_0x4d54b3){console['error'](_0x5dd0be(0x112),_0x4d54b3);throw _0x4d54b3;}}[a55_0x22118f(0xda)](_0x53c60d,_0x51aa31){const _0x7ca24=a55_0x22118f;return console[_0x7ca24(0x125)]('üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet'),!![];}}exports[a55_0x22118f(0x151)]=AmPayTRYService;