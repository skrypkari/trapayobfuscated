'use strict';function a45_0x14d1(){const _0xfa19cf=['NGA','LKA','‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20','Customer\x20Country\x20(2-letter):','KAZ','phone','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','KOR','ZAF','PER','TRAFFER','AFG','PRY','POST','toLowerCase','PSE','BHR','logWebhookReceived','log','GRC','Order\x20ID:','text','logWebhookError','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','completed','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','EGY','LTU','PAID','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','FAILED','paid','BRA','TRY','BGD','KEN','Customer\x20IP:','166446hjryUx','PHL','222416pBkreP','Bank\x20Transfer\x20TR','status','GHA','SYC','ROU','AmPayTRYService','pending','MDA','DNK','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','KWT','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','Payment\x20URL:','1735zaEDAP','GBR','TZA','MNE','VEN','MDG','EXPIRED','IDN','failureUrl','currency','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','System\x20ID:','üì§\x20AmPay\x20TRY\x20API\x20request\x20data:','Tracker\x20ID:','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','system_id','üì•\x20AmPay\x20TRY\x20raw\x20response:','IRQ','MLT','SVN','üì§\x20AmPay\x20TRY\x20request\x20body:','UKR','waiting','JPN','POL','expired','GEO','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','ARE','‚ùå\x20AmPay\x20TRY\x20API\x20error:','MYS','CHE','successUrl','6684XQstgF','SGP','MMR','BLR','VNM','API_PUBLIC_KEY','toUpperCase','\x20->\x20','TKM','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','FIN','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','LIE','üìä\x20AmPay\x20TRY\x20response\x20data:','GUY','failed','MNG','MCO','VAT','message','PRK','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','ampay.php','tracker_id','PAK','ARM','ZWE','Customer:','1978304PLvsoH','apiUrl','SMR','MKD','REU','MUS','error','üìä\x20AmPay\x20TRY\x20parsed\x20response:','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','customerIp','RUS','SUR','NLD','FRA','YEM','193359KZaYIE','1666746CstbEA','UGA','client_transaction_id','SYR','ZMB','LVA','lastName','ampay-try','ESP','application/json','NPL','https://traffer.uk/gateway/ampay-try/','customerCountry','redirect_url','XKX','MOZ','CYP','PENDING','4400DyPLad','‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','EST','stringify','BIH','parse','ITA','processing','firstName','TrapayEnd/1.0','Email:','CHN','FLK','BGR','DEU','warn','ALB','SAU','success','error_message','PRT','OMN','CZE','üìä\x20AmPay\x20TRY\x20status\x20response:','LUX','TUR','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','CHL','AmPay\x20TRY\x20API\x20error:\x20','LAO','MEX','AUT','CLIENT_MERCHANT_ID','TrapayAPI/1.0','Status:','IRN','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','loggerService','https://traffer.uk/webhook/gateway/ampay-try','Unknown\x20error','timeout','BOL','ECU','/status','URY','amount','convert2LetterTo3LetterCountryCode','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','__esModule','ISR','297wRFYgy','ARG','QAT',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','HTTP\x20','JOR','COL','API_PRIVATE_KEY'];a45_0x14d1=function(){return _0xfa19cf;};return a45_0x14d1();}const a45_0x4a74a8=a45_0x509f;(function(_0x2ee94c,_0x58fafc){const _0x515115=a45_0x509f,_0x5b38d9=_0x2ee94c();while(!![]){try{const _0x5b9f4d=-parseInt(_0x515115(0x1a1))/0x1+-parseInt(_0x515115(0x146))/0x2+parseInt(_0x515115(0x1a2))/0x3+parseInt(_0x515115(0x191))/0x4+parseInt(_0x515115(0x154))/0x5*(-parseInt(_0x515115(0x175))/0x6)+-parseInt(_0x515115(0x144))/0x7+-parseInt(_0x515115(0x1b4))/0x8*(parseInt(_0x515115(0x117))/0x9);if(_0x5b9f4d===_0x58fafc)break;else _0x5b38d9['push'](_0x5b38d9['shift']());}catch(_0x1e537f){_0x5b38d9['push'](_0x5b38d9['shift']());}}}(a45_0x14d1,0x4d6b1));function a45_0x509f(_0x927ed7,_0x5487c1){const _0x14d177=a45_0x14d1();return a45_0x509f=function(_0x509f2e,_0x468175){_0x509f2e=_0x509f2e-0xe9;let _0x700528=_0x14d177[_0x509f2e];return _0x700528;},a45_0x509f(_0x927ed7,_0x5487c1);}Object['defineProperty'](exports,a45_0x4a74a8(0x115),{'value':!![]}),exports[a45_0x4a74a8(0x14c)]=void 0x0;const loggerService_1=require('../loggerService');class AmPayTRYService{constructor(){const _0x2750c4=a45_0x4a74a8;this[_0x2750c4(0x105)]=_0x2750c4(0x129),this[_0x2750c4(0x17a)]='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this[_0x2750c4(0x11e)]=_0x2750c4(0x199),this[_0x2750c4(0x192)]=_0x2750c4(0x1ad),console['log']('üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing');}['convert2LetterTo3LetterCountryCode'](_0x2373f4){const _0xe9b8fd=a45_0x4a74a8,_0x3e1857={'AD':'AND','AL':_0xe9b8fd(0xf5),'AT':_0xe9b8fd(0x104),'BA':_0xe9b8fd(0xe9),'BE':'BEL','BG':_0xe9b8fd(0xf2),'BY':_0xe9b8fd(0x178),'CH':_0xe9b8fd(0x173),'CY':_0xe9b8fd(0x1b2),'CZ':_0xe9b8fd(0xfb),'DE':_0xe9b8fd(0xf3),'DK':_0xe9b8fd(0x14f),'EE':_0xe9b8fd(0x1b6),'ES':_0xe9b8fd(0x1aa),'FI':_0xe9b8fd(0x17f),'FR':_0xe9b8fd(0x19f),'GB':_0xe9b8fd(0x155),'GE':_0xe9b8fd(0x16e),'GR':_0xe9b8fd(0x132),'HR':'HRV','HU':'HUN','IE':'IRL','IS':'ISL','IT':_0xe9b8fd(0xeb),'LI':_0xe9b8fd(0x181),'LT':_0xe9b8fd(0x13a),'LU':_0xe9b8fd(0xfd),'LV':_0xe9b8fd(0x1a7),'MC':_0xe9b8fd(0x186),'MD':_0xe9b8fd(0x14e),'ME':_0xe9b8fd(0x157),'MK':_0xe9b8fd(0x194),'MT':_0xe9b8fd(0x166),'NL':_0xe9b8fd(0x19e),'NO':'NOR','PL':_0xe9b8fd(0x16c),'PT':_0xe9b8fd(0xf9),'RO':_0xe9b8fd(0x14b),'RS':'SRB','RU':_0xe9b8fd(0x19c),'SE':'SWE','SI':_0xe9b8fd(0x167),'SK':'SVK','SM':_0xe9b8fd(0x193),'UA':_0xe9b8fd(0x169),'VA':_0xe9b8fd(0x187),'XK':_0xe9b8fd(0x1b0),'AM':_0xe9b8fd(0x18e),'AZ':'AZE','KZ':_0xe9b8fd(0x123),'KG':'KGZ','TJ':'TJK','TM':_0xe9b8fd(0x17d),'UZ':'UZB','US':'USA','CA':'CAN','AU':'AUS','JP':_0xe9b8fd(0x16b),'CN':_0xe9b8fd(0xf0),'IN':'IND','BR':_0xe9b8fd(0x13f),'MX':_0xe9b8fd(0x103),'AR':_0xe9b8fd(0x118),'CL':_0xe9b8fd(0x100),'PE':_0xe9b8fd(0x128),'CO':_0xe9b8fd(0x11d),'VE':_0xe9b8fd(0x158),'EC':_0xe9b8fd(0x10f),'BO':_0xe9b8fd(0x10e),'PY':_0xe9b8fd(0x12b),'UY':_0xe9b8fd(0x111),'SR':_0xe9b8fd(0x19d),'GY':_0xe9b8fd(0x183),'FK':_0xe9b8fd(0xf1),'ZA':_0xe9b8fd(0x127),'EG':_0xe9b8fd(0x139),'NG':_0xe9b8fd(0x11f),'KE':_0xe9b8fd(0x142),'GH':_0xe9b8fd(0x149),'TZ':_0xe9b8fd(0x156),'UG':_0xe9b8fd(0x1a3),'ZW':_0xe9b8fd(0x18f),'ZM':_0xe9b8fd(0x1a6),'MW':'MWI','MZ':_0xe9b8fd(0x1b1),'MG':_0xe9b8fd(0x159),'MU':_0xe9b8fd(0x196),'SC':_0xe9b8fd(0x14a),'RE':_0xe9b8fd(0x195),'TR':_0xe9b8fd(0xfe),'IR':_0xe9b8fd(0x108),'IQ':_0xe9b8fd(0x165),'SA':_0xe9b8fd(0xf6),'AE':_0xe9b8fd(0x170),'KW':_0xe9b8fd(0x151),'QA':_0xe9b8fd(0x119),'BH':_0xe9b8fd(0x12f),'OM':_0xe9b8fd(0xfa),'YE':_0xe9b8fd(0x1a0),'JO':_0xe9b8fd(0x11c),'LB':'LBN','SY':_0xe9b8fd(0x1a5),'IL':_0xe9b8fd(0x116),'PS':_0xe9b8fd(0x12e),'KR':_0xe9b8fd(0x126),'KP':_0xe9b8fd(0x189),'TH':'THA','VN':_0xe9b8fd(0x179),'MY':_0xe9b8fd(0x172),'SG':_0xe9b8fd(0x176),'ID':_0xe9b8fd(0x15b),'PH':_0xe9b8fd(0x145),'LA':_0xe9b8fd(0x102),'KH':'KHM','MM':_0xe9b8fd(0x177),'BD':_0xe9b8fd(0x141),'LK':_0xe9b8fd(0x120),'NP':_0xe9b8fd(0x1ac),'BT':'BTN','MV':'MDV','AF':_0xe9b8fd(0x12a),'PK':_0xe9b8fd(0x18d),'MN':_0xe9b8fd(0x185)},_0x2573f8=_0x3e1857[_0x2373f4[_0xe9b8fd(0x17b)]()];if(!_0x2573f8)return console[_0xe9b8fd(0xf4)](_0xe9b8fd(0x121)+_0x2373f4+_0xe9b8fd(0x11a)),'TUR';return _0x2573f8;}async['createPayment'](_0x2edbd0){const _0x573008=a45_0x4a74a8;console[_0x573008(0x131)](_0x573008(0x150),{'paymentId':_0x2edbd0['paymentId'],'amount':_0x2edbd0[_0x573008(0x112)],'currency':_0x2edbd0['currency'],'customerCountry':_0x2edbd0[_0x573008(0x1ae)]});try{const _0x2e3b2a={'client_merchant_id':this[_0x573008(0x105)],'payment_method':_0x573008(0x147),'client_transaction_id':_0x2edbd0['orderId'],'amount':_0x2edbd0[_0x573008(0x112)],'currency':_0x2edbd0[_0x573008(0x15d)],'callback_url':_0x573008(0x10b),'tracker_id':_0x2edbd0['paymentId'],'redirect_url':_0x2edbd0[_0x573008(0x174)],'failure_url':_0x2edbd0[_0x573008(0x15c)],'customer_first_name':_0x2edbd0[_0x573008(0xed)],'customer_last_name':_0x2edbd0[_0x573008(0x1a8)],'customer_email':_0x2edbd0['email'],'customer_phone':_0x2edbd0[_0x573008(0x124)]||'','customer_ip':_0x2edbd0[_0x573008(0x19b)],'customer_country':_0x2edbd0[_0x573008(0x1ae)],'api_public_key':this['API_PUBLIC_KEY']};console[_0x573008(0x131)](_0x573008(0x160),JSON[_0x573008(0x1b7)](_0x2e3b2a,null,0x2));const _0xdfa7da=await fetch(this[_0x573008(0x192)],{'method':_0x573008(0x12c),'headers':{'Content-Type':_0x573008(0x1ab),'User-Agent':_0x573008(0xee)},'body':JSON[_0x573008(0x1b7)](_0x2e3b2a)});console[_0x573008(0x131)](_0x573008(0xff),_0xdfa7da['status']);const _0x38b647=await _0xdfa7da['text']();console['log'](_0x573008(0x16f),_0x38b647);let _0x1fcc98;try{_0x1fcc98=JSON[_0x573008(0xea)](_0x38b647);}catch(_0x191f76){console[_0x573008(0x197)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:',_0x191f76);throw new Error(_0x573008(0x152)+_0x38b647);}console[_0x573008(0x131)](_0x573008(0x198),JSON[_0x573008(0x1b7)](_0x1fcc98,null,0x2)),loggerService_1['loggerService'][_0x573008(0x130)](_0x573008(0x1a9),_0x1fcc98,{});if(!_0xdfa7da['ok']){const _0x3fa3a5=_0x1fcc98[_0x573008(0xf8)]||_0x1fcc98['message']||_0x573008(0x11b)+_0xdfa7da[_0x573008(0x148)];console['error'](_0x573008(0x171),_0x3fa3a5);throw new Error(_0x573008(0x101)+_0x3fa3a5);}if(!_0x1fcc98['redirect_url']){console[_0x573008(0x197)](_0x573008(0x138),_0x1fcc98);throw new Error(_0x573008(0x180));}const _0x4be9cc={'gateway_payment_id':_0x1fcc98['system_id']||_0x2edbd0['orderId'],'payment_url':_0x1fcc98[_0x573008(0x1af)],'transaction_id':_0x1fcc98[_0x573008(0x1a4)]};return console[_0x573008(0x131)](_0x573008(0x136),_0x4be9cc),_0x4be9cc;}catch(_0x3e87ef){console['error'](_0x573008(0x109),_0x3e87ef),loggerService_1[_0x573008(0x10a)][_0x573008(0x135)](_0x573008(0x1a9),_0x3e87ef,_0x2edbd0);throw _0x3e87ef;}}async['createPaymentLink'](_0x2e00b7){const _0x1227eb=a45_0x4a74a8;try{const {orderId:_0x181fe6,amount:_0x548534,currency:_0x4fab3b,firstName:_0x13d5bd,lastName:_0x2bc298,email:_0x3e188f,customerIp:_0x62a671,customerCountry:_0x185243,successUrl:_0x3bf7f7,failureUrl:_0x1646e5}=_0x2e00b7;console[_0x1227eb(0x131)]('üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...'),console['log'](_0x1227eb(0x133),_0x181fe6),console[_0x1227eb(0x131)]('Amount:',_0x548534,_0x4fab3b),console[_0x1227eb(0x131)](_0x1227eb(0x190),_0x13d5bd+'\x20'+_0x2bc298),console[_0x1227eb(0x131)](_0x1227eb(0xef),_0x3e188f),console[_0x1227eb(0x131)](_0x1227eb(0x143),_0x62a671),console[_0x1227eb(0x131)](_0x1227eb(0x122),_0x185243);const _0x37a58b=this[_0x1227eb(0x113)](_0x185243);console[_0x1227eb(0x131)]('Customer\x20Country\x20(3-letter):',_0x37a58b);const _0xe3455f={'sub_method':'GAM','currency':_0x4fab3b[_0x1227eb(0x17b)](),'amount':_0x548534,'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','client_merchant_id':this[_0x1227eb(0x105)],'client_transaction_id':_0x181fe6,'transaction_description':_0x181fe6,'customer':{'ip':_0x62a671,'email':_0x3e188f,'full_name':_0x13d5bd+'\x20'+_0x2bc298,'country':_0x37a58b},'success_redirect_url':_0x3bf7f7,'error_redirect_url':_0x1646e5};console['log'](_0x1227eb(0x168),JSON[_0x1227eb(0x1b7)](_0xe3455f,null,0x2));const _0x410c11=await fetch(this[_0x1227eb(0x192)]+_0x1227eb(0x18b),{'method':_0x1227eb(0x12c),'headers':{'Content-Type':_0x1227eb(0x1ab),'User-Agent':_0x1227eb(0x106)},'body':JSON[_0x1227eb(0x1b7)](_0xe3455f)}),_0x38f6e7=await _0x410c11[_0x1227eb(0x134)]();console[_0x1227eb(0x131)](_0x1227eb(0x164),_0x38f6e7);if(!_0x410c11['ok'])throw new Error('AmPay\x20TRY\x20API\x20error:\x20HTTP\x20'+_0x410c11[_0x1227eb(0x148)]+'\x20-\x20'+_0x38f6e7);let _0x694833;try{_0x694833=JSON[_0x1227eb(0xea)](_0x38f6e7);}catch(_0x388e07){throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x38f6e7);}console[_0x1227eb(0x131)](_0x1227eb(0x182),JSON['stringify'](_0x694833,null,0x2));if(!_0x694833[_0x1227eb(0x1af)])throw new Error(_0x1227eb(0x114)+(_0x694833[_0x1227eb(0xf8)]||_0x694833[_0x1227eb(0x188)]||_0x1227eb(0x10c)));const _0x4c168f=_0x694833[_0x1227eb(0x1af)],_0x5ca200=_0x694833[_0x1227eb(0x163)],_0x37e58d=_0x694833['tracker_id'];return console[_0x1227eb(0x131)](_0x1227eb(0x1b5)),console[_0x1227eb(0x131)](_0x1227eb(0x153),_0x4c168f),console[_0x1227eb(0x131)](_0x1227eb(0x15f),_0x5ca200),console[_0x1227eb(0x131)](_0x1227eb(0x161),_0x37e58d),console[_0x1227eb(0x131)](_0x1227eb(0x107),_0x694833['status']),console[_0x1227eb(0x131)](_0x1227eb(0x162)),{'gateway_payment_id':_0x5ca200||_0x37e58d||_0x181fe6,'payment_url':_0x4c168f||'','transaction_id':_0x5ca200};}catch(_0x22c52d){console[_0x1227eb(0x197)](_0x1227eb(0x109),_0x22c52d),console[_0x1227eb(0x131)](_0x1227eb(0x18a)),loggerService_1[_0x1227eb(0x10a)][_0x1227eb(0x135)](_0x1227eb(0x1a9),_0x22c52d,_0x2e00b7);throw _0x22c52d;}}async['checkPaymentStatus'](_0x20c926){const _0x444a12=a45_0x4a74a8;console['log']('üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:',_0x20c926);try{const _0x3b7b19={'client_merchant_id':this[_0x444a12(0x105)],'system_id':_0x20c926,'api_public_key':this['API_PUBLIC_KEY']},_0x479df0=await fetch(this[_0x444a12(0x192)]+_0x444a12(0x110),{'method':_0x444a12(0x12c),'headers':{'Content-Type':_0x444a12(0x1ab),'User-Agent':_0x444a12(0xee)},'body':JSON[_0x444a12(0x1b7)](_0x3b7b19)}),_0x47b737=await _0x479df0[_0x444a12(0x134)]();console[_0x444a12(0x131)](_0x444a12(0x19a),_0x47b737);let _0x50e317;try{_0x50e317=JSON['parse'](_0x47b737);}catch(_0x3896e3){return console[_0x444a12(0x197)](_0x444a12(0x15e),_0x3896e3),{'status':'FAILED'};}console['log'](_0x444a12(0xfc),JSON['stringify'](_0x50e317,null,0x2));let _0x316e04=_0x444a12(0x1b3);if(_0x50e317[_0x444a12(0x148)])switch(_0x50e317[_0x444a12(0x148)][_0x444a12(0x12d)]()){case _0x444a12(0xf7):case _0x444a12(0x137):case _0x444a12(0x13e):_0x316e04='PAID';break;case _0x444a12(0x184):case _0x444a12(0x197):case'declined':_0x316e04=_0x444a12(0x13d);break;case _0x444a12(0x16d):case _0x444a12(0x10d):_0x316e04=_0x444a12(0x15a);break;case'pending':case'processing':case _0x444a12(0x16a):default:_0x316e04='PENDING';break;}return{'status':_0x316e04,'amount':_0x50e317[_0x444a12(0x112)],'currency':_0x50e317[_0x444a12(0x15d)]};}catch(_0x3fbb88){return console['error'](_0x444a12(0x17e),_0x3fbb88),{'status':_0x444a12(0x13d)};}}async['processWebhook'](_0x19db2e){const _0x37527f=a45_0x4a74a8;console[_0x37527f(0x131)]('üì•\x20Processing\x20AmPay\x20TRY\x20webhook:',JSON[_0x37527f(0x1b7)](_0x19db2e,null,0x2));try{const _0x11e0f6=_0x19db2e[_0x37527f(0x18c)]||_0x19db2e[_0x37527f(0x1a4)]||_0x19db2e[_0x37527f(0x163)];if(!_0x11e0f6){console[_0x37527f(0x197)](_0x37527f(0x125));throw new Error('No\x20payment\x20ID\x20in\x20webhook\x20data');}let _0x2be0bb='PENDING';if(_0x19db2e['status'])switch(_0x19db2e[_0x37527f(0x148)][_0x37527f(0x12d)]()){case _0x37527f(0xf7):case _0x37527f(0x137):case'paid':_0x2be0bb=_0x37527f(0x13b);break;case'failed':case'error':case'declined':_0x2be0bb='FAILED';break;case'expired':case _0x37527f(0x10d):_0x2be0bb=_0x37527f(0x15a);break;case _0x37527f(0x14d):case _0x37527f(0xec):case'waiting':default:_0x2be0bb=_0x37527f(0x1b3);break;}return console['log']('üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0x11e0f6+_0x37527f(0x17c)+_0x2be0bb),{'paymentId':_0x11e0f6,'status':_0x2be0bb,'amount':_0x19db2e[_0x37527f(0x112)],'currency':_0x19db2e[_0x37527f(0x15d)]||_0x37527f(0x140)};}catch(_0x13c1a9){console[_0x37527f(0x197)]('‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:',_0x13c1a9);throw _0x13c1a9;}}['verifyWebhookSignature'](_0x504787,_0x1d8863){const _0x34448c=a45_0x4a74a8;return console[_0x34448c(0x131)](_0x34448c(0x13c)),!![];}}exports[a45_0x4a74a8(0x14c)]=AmPayTRYService;