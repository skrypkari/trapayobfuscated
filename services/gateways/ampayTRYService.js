'use strict';const a55_0x2ca618=a55_0x56a8;function a55_0x559e(){const _0x4fbeb6=['LAO','System\x20ID:','UZB','LKA','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','AND','ampay-try','OMN','FLK','logWebhookError','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','ZAF','KHM','YEM','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','BHR','SVN','LBN','6624126nURatB','CHE','CHL','status','DNK','Payment\x20URL:','TRY','5488360llFIob','AFG','EST','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','KOR','HUN','NPL','success','MLT','warn','phone','IRL','MKD','parse','Status:','error','\x20-\x20','logWebhookReceived','7zWlaon','NGA','VNM','TUR','TrapayEnd/1.0','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','CAN','No\x20payment\x20ID\x20in\x20webhook\x20data','Unknown\x20error','IRQ','declined','2391426WFzumi','ECU','LIE','BEL','PENDING','RUS','POST','ARG','USA','üìä\x20AmPay\x20TRY\x20response\x20data:','customerCountry','üìä\x20AmPay\x20TRY\x20parsed\x20response:','error_message','client_transaction_id','KAZ','convert2LetterTo3LetterCountryCode','lastName','ARM','CLIENT_MERCHANT_ID','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','GEO','tracker_id','GRC','Email:','HRV','GHA','currency','AUS','verifyWebhookSignature','application/json','SWE','POL','SAU','ROU','AUT','SGP','DEU','API_PRIVATE_KEY','amount','SVK','stringify','ampay.php','system_id','log','MDG','PRT','failed','TRAFFER','pending','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','checkPaymentStatus','156yUvJOL','defineProperty','\x20->\x20','2yRqqeD','firstName','Order\x20ID:','GAM','MDA','MYS','14165280JdWmoz','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','XKX','__esModule','QAT','createPaymentLink','timeout','AmPay\x20TRY\x20API\x20error:\x20','731846LnMTUQ','FIN','MEX','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','ARE','üì§\x20AmPay\x20TRY\x20API\x20request\x20data:','VAT','waiting','BGD','NOR','BIH','BRA','PRK','completed','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','SMR','FAILED','MNE','MDV','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','IND','ALB','API_PUBLIC_KEY','toUpperCase','not\x20provided','failureUrl','SYR','successUrl','MNG','AZE','IRN','ZMB','PRY','redirect_url','EXPIRED','orderId','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','MUS','processing','text','BLR','GBR','LUX','JOR','CYP','processWebhook','84970dKnlFy','PSE','KGZ','MMR','Amount:','MCO','AmPayTRYService','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','FRA','../loggerService','PHL','HTTP\x20','NLD','COL','paymentId','2722578tQQrXf','BTN','UKR','REU','KWT','CHN','apiUrl','loggerService','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','paid','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','Tracker\x20ID:','BOL','URY'];a55_0x559e=function(){return _0x4fbeb6;};return a55_0x559e();}(function(_0x32841e,_0x466c7c){const _0x219654=a55_0x56a8,_0x499bb4=_0x32841e();while(!![]){try{const _0x98672d=parseInt(_0x219654(0x13c))/0x1+parseInt(_0x219654(0x12e))/0x2*(parseInt(_0x219654(0x179))/0x3)+-parseInt(_0x219654(0x1f2))/0x4*(-parseInt(_0x219654(0x16a))/0x5)+parseInt(_0x219654(0x1be))/0x6*(-parseInt(_0x219654(0x1b2))/0x7)+-parseInt(_0x219654(0x1a0))/0x8+parseInt(_0x219654(0x199))/0x9+-parseInt(_0x219654(0x134))/0xa;if(_0x98672d===_0x466c7c)break;else _0x499bb4['push'](_0x499bb4['shift']());}catch(_0x5d88a5){_0x499bb4['push'](_0x499bb4['shift']());}}}(a55_0x559e,0x831b0));function a55_0x56a8(_0x2b8037,_0x543554){_0x2b8037=_0x2b8037-0x12e;const _0x559e8a=a55_0x559e();let _0x56a866=_0x559e8a[_0x2b8037];return _0x56a866;}Object[a55_0x2ca618(0x1f3)](exports,a55_0x2ca618(0x137),{'value':!![]}),exports[a55_0x2ca618(0x170)]=void 0x0;const loggerService_1=require(a55_0x2ca618(0x173));class AmPayTRYService{constructor(){const _0xfcd0c=a55_0x2ca618;this['CLIENT_MERCHANT_ID']=_0xfcd0c(0x1ed),this['API_PUBLIC_KEY']='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this[_0xfcd0c(0x1e3)]=_0xfcd0c(0x1ef),this['apiUrl']='https://traffer.uk/gateway/ampay-try/',console[_0xfcd0c(0x1e9)](_0xfcd0c(0x14f));}[a55_0x2ca618(0x1cd)](_0x5148d5){const _0x988c73=a55_0x2ca618,_0x50bb1b={'AD':_0x988c73(0x18c),'AL':_0x988c73(0x151),'AT':_0x988c73(0x1e0),'BA':_0x988c73(0x146),'BE':_0x988c73(0x1c1),'BG':'BGR','BY':_0x988c73(0x164),'CH':_0x988c73(0x19a),'CY':_0x988c73(0x168),'CZ':'CZE','DE':_0x988c73(0x1e2),'DK':_0x988c73(0x19d),'EE':_0x988c73(0x1a2),'ES':'ESP','FI':_0x988c73(0x13d),'FR':_0x988c73(0x172),'GB':_0x988c73(0x165),'GE':_0x988c73(0x1d2),'GR':_0x988c73(0x1d4),'HR':_0x988c73(0x1d6),'HU':_0x988c73(0x1a5),'IE':_0x988c73(0x1ab),'IS':'ISL','IT':'ITA','LI':_0x988c73(0x1c0),'LT':'LTU','LU':_0x988c73(0x166),'LV':'LVA','MC':_0x988c73(0x16f),'MD':_0x988c73(0x132),'ME':_0x988c73(0x14d),'MK':_0x988c73(0x1ac),'MT':_0x988c73(0x1a8),'NL':_0x988c73(0x176),'NO':_0x988c73(0x145),'PL':_0x988c73(0x1dd),'PT':_0x988c73(0x1eb),'RO':_0x988c73(0x1df),'RS':'SRB','RU':_0x988c73(0x1c3),'SE':_0x988c73(0x1dc),'SI':_0x988c73(0x197),'SK':_0x988c73(0x1e5),'SM':_0x988c73(0x14b),'UA':_0x988c73(0x17b),'VA':_0x988c73(0x142),'XK':_0x988c73(0x136),'AM':_0x988c73(0x1cf),'AZ':_0x988c73(0x159),'KZ':_0x988c73(0x1cc),'KG':_0x988c73(0x16c),'TJ':'TJK','TM':'TKM','UZ':_0x988c73(0x189),'US':_0x988c73(0x1c6),'CA':_0x988c73(0x1b9),'AU':_0x988c73(0x1d9),'JP':'JPN','CN':_0x988c73(0x17e),'IN':_0x988c73(0x150),'BR':_0x988c73(0x147),'MX':_0x988c73(0x13e),'AR':_0x988c73(0x1c5),'CL':_0x988c73(0x19b),'PE':'PER','CO':_0x988c73(0x177),'VE':'VEN','EC':_0x988c73(0x1bf),'BO':_0x988c73(0x185),'PY':_0x988c73(0x15c),'UY':_0x988c73(0x186),'SR':'SUR','GY':'GUY','FK':_0x988c73(0x18f),'ZA':_0x988c73(0x192),'EG':'EGY','NG':_0x988c73(0x1b3),'KE':'KEN','GH':_0x988c73(0x1d7),'TZ':'TZA','UG':'UGA','ZW':'ZWE','ZM':_0x988c73(0x15b),'MW':'MWI','MZ':'MOZ','MG':_0x988c73(0x1ea),'MU':_0x988c73(0x161),'SC':'SYC','RE':_0x988c73(0x17c),'TR':_0x988c73(0x1b5),'IR':_0x988c73(0x15a),'IQ':_0x988c73(0x1bc),'SA':_0x988c73(0x1de),'AE':_0x988c73(0x140),'KW':_0x988c73(0x17d),'QA':_0x988c73(0x138),'BH':_0x988c73(0x196),'OM':_0x988c73(0x18e),'YE':_0x988c73(0x194),'JO':_0x988c73(0x167),'LB':_0x988c73(0x198),'SY':_0x988c73(0x156),'IL':'ISR','PS':_0x988c73(0x16b),'KR':_0x988c73(0x1a4),'KP':_0x988c73(0x148),'TH':'THA','VN':_0x988c73(0x1b4),'MY':_0x988c73(0x133),'SG':_0x988c73(0x1e1),'ID':'IDN','PH':_0x988c73(0x174),'LA':_0x988c73(0x187),'KH':_0x988c73(0x193),'MM':_0x988c73(0x16d),'BD':_0x988c73(0x144),'LK':_0x988c73(0x18a),'NP':_0x988c73(0x1a6),'BT':_0x988c73(0x17a),'MV':_0x988c73(0x14e),'AF':_0x988c73(0x1a1),'PK':'PAK','MN':_0x988c73(0x158)},_0x53b351=_0x50bb1b[_0x5148d5['toUpperCase']()];if(!_0x53b351)return console[_0x988c73(0x1a9)]('‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20'+_0x5148d5+',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY'),_0x988c73(0x1b5);return _0x53b351;}async['createPayment'](_0x24ebfd){const _0xc56a26=a55_0x2ca618;console['log']('üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:',{'paymentId':_0x24ebfd[_0xc56a26(0x178)],'amount':_0x24ebfd[_0xc56a26(0x1e4)],'currency':_0x24ebfd[_0xc56a26(0x1d8)],'customerCountry':_0x24ebfd[_0xc56a26(0x1c8)]});try{const _0x295e3b={'client_merchant_id':this[_0xc56a26(0x1d0)],'payment_method':'Bank\x20Transfer\x20TR','client_transaction_id':_0x24ebfd[_0xc56a26(0x15f)],'amount':_0x24ebfd[_0xc56a26(0x1e4)],'currency':_0x24ebfd[_0xc56a26(0x1d8)],'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','tracker_id':_0x24ebfd['paymentId'],'redirect_url':_0x24ebfd[_0xc56a26(0x157)],'failure_url':_0x24ebfd[_0xc56a26(0x155)],'customer_first_name':_0x24ebfd[_0xc56a26(0x12f)],'customer_last_name':_0x24ebfd[_0xc56a26(0x1ce)],'customer_email':_0x24ebfd['email'],'customer_phone':_0x24ebfd[_0xc56a26(0x1aa)]||'','customer_ip':_0x24ebfd['customerIp'],'customer_country':_0x24ebfd[_0xc56a26(0x1c8)],'api_public_key':this[_0xc56a26(0x152)]};console[_0xc56a26(0x1e9)](_0xc56a26(0x141),JSON['stringify'](_0x295e3b,null,0x2));const _0x280889=await fetch(this[_0xc56a26(0x17f)],{'method':_0xc56a26(0x1c4),'headers':{'Content-Type':_0xc56a26(0x1db),'User-Agent':_0xc56a26(0x1b6)},'body':JSON[_0xc56a26(0x1e6)](_0x295e3b)});console['log'](_0xc56a26(0x1b8),_0x280889[_0xc56a26(0x19c)]);const _0x6eb990=await _0x280889[_0xc56a26(0x163)]();console[_0xc56a26(0x1e9)](_0xc56a26(0x1f0),_0x6eb990);let _0x1901f0;try{_0x1901f0=JSON['parse'](_0x6eb990);}catch(_0x3f49ab){console['error']('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:',_0x3f49ab);throw new Error(_0xc56a26(0x13f)+_0x6eb990);}console[_0xc56a26(0x1e9)](_0xc56a26(0x1c9),JSON[_0xc56a26(0x1e6)](_0x1901f0,null,0x2)),loggerService_1[_0xc56a26(0x180)][_0xc56a26(0x1b1)](_0xc56a26(0x18d),_0x1901f0,{});if(!_0x280889['ok']){const _0x358221=_0x1901f0[_0xc56a26(0x1ca)]||_0x1901f0['message']||_0xc56a26(0x175)+_0x280889[_0xc56a26(0x19c)];console[_0xc56a26(0x1af)]('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x358221);throw new Error(_0xc56a26(0x13b)+_0x358221);}if(!_0x1901f0[_0xc56a26(0x15d)]){console[_0xc56a26(0x1af)](_0xc56a26(0x14a),_0x1901f0);throw new Error('AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL');}const _0x254bd3={'gateway_payment_id':_0x1901f0['system_id']||_0x24ebfd[_0xc56a26(0x15f)],'payment_url':_0x1901f0[_0xc56a26(0x15d)],'transaction_id':_0x1901f0['client_transaction_id']};return console[_0xc56a26(0x1e9)](_0xc56a26(0x195),_0x254bd3),_0x254bd3;}catch(_0x34e465){console[_0xc56a26(0x1af)](_0xc56a26(0x191),_0x34e465),loggerService_1[_0xc56a26(0x180)][_0xc56a26(0x190)]('ampay-try',_0x34e465,_0x24ebfd);throw _0x34e465;}}async[a55_0x2ca618(0x139)](_0x5c8bfb){const _0x38a556=a55_0x2ca618;try{const {orderId:_0x3d430b,amount:_0x226b9c,currency:_0x1210ca,firstName:_0x2e0f51,lastName:_0x3a4156,email:_0x450035,phone:_0x5a9548,customerIp:_0x20c15d,customerCountry:_0x2fe334,successUrl:_0x183f41,failureUrl:_0x5b262a}=_0x5c8bfb;console[_0x38a556(0x1e9)](_0x38a556(0x1b7)),console['log'](_0x38a556(0x130),_0x3d430b),console['log'](_0x38a556(0x16e),_0x226b9c,_0x1210ca),console[_0x38a556(0x1e9)]('Customer:',_0x2e0f51+'\x20'+_0x3a4156),console[_0x38a556(0x1e9)](_0x38a556(0x1d5),_0x450035),console['log']('Phone:',_0x5a9548||_0x38a556(0x154)),console[_0x38a556(0x1e9)]('Customer\x20IP:',_0x20c15d),console[_0x38a556(0x1e9)]('Customer\x20Country\x20(2-letter):',_0x2fe334);const _0x47e928=this['convert2LetterTo3LetterCountryCode'](_0x2fe334);console[_0x38a556(0x1e9)]('Customer\x20Country\x20(3-letter):',_0x47e928);const _0xf2a91a={'sub_method':_0x38a556(0x131),'currency':_0x1210ca[_0x38a556(0x153)](),'amount':_0x226b9c,'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','client_merchant_id':this['CLIENT_MERCHANT_ID'],'client_transaction_id':_0x3d430b,'transaction_description':_0x3d430b,'customer':{'ip':_0x20c15d,'email':_0x450035,'full_name':_0x2e0f51+'\x20'+_0x3a4156,'phone':_0x5a9548||'','country':_0x47e928},'success_redirect_url':_0x183f41,'error_redirect_url':_0x5b262a};console[_0x38a556(0x1e9)]('üì§\x20AmPay\x20TRY\x20request\x20body:',JSON[_0x38a556(0x1e6)](_0xf2a91a,null,0x2));const _0x14a17a=await fetch(this[_0x38a556(0x17f)]+_0x38a556(0x1e7),{'method':_0x38a556(0x1c4),'headers':{'Content-Type':_0x38a556(0x1db),'User-Agent':'TrapayAPI/1.0'},'body':JSON[_0x38a556(0x1e6)](_0xf2a91a)}),_0x1cbd27=await _0x14a17a[_0x38a556(0x163)]();console[_0x38a556(0x1e9)]('üì•\x20AmPay\x20TRY\x20raw\x20response:',_0x1cbd27);if(!_0x14a17a['ok'])throw new Error(_0x38a556(0x183)+_0x14a17a[_0x38a556(0x19c)]+_0x38a556(0x1b0)+_0x1cbd27);let _0x3e50f2;try{_0x3e50f2=JSON['parse'](_0x1cbd27);}catch(_0x13439c){throw new Error(_0x38a556(0x13f)+_0x1cbd27);}console[_0x38a556(0x1e9)](_0x38a556(0x1c7),JSON[_0x38a556(0x1e6)](_0x3e50f2,null,0x2));if(!_0x3e50f2[_0x38a556(0x15d)])throw new Error(_0x38a556(0x1a3)+(_0x3e50f2[_0x38a556(0x1ca)]||_0x3e50f2['message']||_0x38a556(0x1bb)));const _0x105082=_0x3e50f2[_0x38a556(0x15d)],_0x1b8b64=_0x3e50f2[_0x38a556(0x1e8)],_0x3c1e25=_0x3e50f2[_0x38a556(0x1d3)];return console['log']('‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully'),console[_0x38a556(0x1e9)](_0x38a556(0x19e),_0x105082),console[_0x38a556(0x1e9)](_0x38a556(0x188),_0x1b8b64),console[_0x38a556(0x1e9)](_0x38a556(0x184),_0x3c1e25),console[_0x38a556(0x1e9)](_0x38a556(0x1ae),_0x3e50f2['status']),console[_0x38a556(0x1e9)](_0x38a556(0x160)),{'gateway_payment_id':_0x1b8b64||_0x3c1e25||_0x3d430b,'payment_url':_0x105082||'','transaction_id':_0x1b8b64};}catch(_0x49d84c){console[_0x38a556(0x1af)](_0x38a556(0x191),_0x49d84c),console[_0x38a556(0x1e9)](_0x38a556(0x135)),loggerService_1['loggerService'][_0x38a556(0x190)](_0x38a556(0x18d),_0x49d84c,_0x5c8bfb);throw _0x49d84c;}}async[a55_0x2ca618(0x1f1)](_0x38d8e1){const _0x7f1080=a55_0x2ca618;console[_0x7f1080(0x1e9)]('üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:',_0x38d8e1);try{const _0x139c65={'client_merchant_id':this[_0x7f1080(0x1d0)],'system_id':_0x38d8e1,'api_public_key':this[_0x7f1080(0x152)]},_0x2249e0=await fetch(this[_0x7f1080(0x17f)]+'/status',{'method':_0x7f1080(0x1c4),'headers':{'Content-Type':_0x7f1080(0x1db),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x7f1080(0x1e6)](_0x139c65)}),_0x5864ac=await _0x2249e0[_0x7f1080(0x163)]();console[_0x7f1080(0x1e9)]('üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:',_0x5864ac);let _0x1c46ef;try{_0x1c46ef=JSON[_0x7f1080(0x1ad)](_0x5864ac);}catch(_0xfbb24d){return console[_0x7f1080(0x1af)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:',_0xfbb24d),{'status':_0x7f1080(0x14c)};}console[_0x7f1080(0x1e9)]('üìä\x20AmPay\x20TRY\x20status\x20response:',JSON[_0x7f1080(0x1e6)](_0x1c46ef,null,0x2));let _0x113b7b=_0x7f1080(0x1c2);if(_0x1c46ef[_0x7f1080(0x19c)])switch(_0x1c46ef[_0x7f1080(0x19c)]['toLowerCase']()){case _0x7f1080(0x1a7):case _0x7f1080(0x149):case _0x7f1080(0x182):_0x113b7b='PAID';break;case _0x7f1080(0x1ec):case _0x7f1080(0x1af):case _0x7f1080(0x1bd):_0x113b7b=_0x7f1080(0x14c);break;case'expired':case _0x7f1080(0x13a):_0x113b7b=_0x7f1080(0x15e);break;case'pending':case _0x7f1080(0x162):case _0x7f1080(0x143):default:_0x113b7b=_0x7f1080(0x1c2);break;}return{'status':_0x113b7b,'amount':_0x1c46ef[_0x7f1080(0x1e4)],'currency':_0x1c46ef[_0x7f1080(0x1d8)]};}catch(_0x146643){return console[_0x7f1080(0x1af)](_0x7f1080(0x1d1),_0x146643),{'status':_0x7f1080(0x14c)};}}async[a55_0x2ca618(0x169)](_0x46a136){const _0x23a509=a55_0x2ca618;console[_0x23a509(0x1e9)](_0x23a509(0x18b),JSON[_0x23a509(0x1e6)](_0x46a136,null,0x2));try{const _0x66ab9=_0x46a136[_0x23a509(0x1d3)]||_0x46a136[_0x23a509(0x1cb)]||_0x46a136[_0x23a509(0x1e8)];if(!_0x66ab9){console['error'](_0x23a509(0x181));throw new Error(_0x23a509(0x1ba));}let _0x2f7065=_0x23a509(0x1c2);if(_0x46a136[_0x23a509(0x19c)])switch(_0x46a136['status']['toLowerCase']()){case _0x23a509(0x1a7):case _0x23a509(0x149):case _0x23a509(0x182):_0x2f7065='PAID';break;case'failed':case _0x23a509(0x1af):case _0x23a509(0x1bd):_0x2f7065=_0x23a509(0x14c);break;case'expired':case'timeout':_0x2f7065=_0x23a509(0x15e);break;case _0x23a509(0x1ee):case _0x23a509(0x162):case'waiting':default:_0x2f7065=_0x23a509(0x1c2);break;}return console[_0x23a509(0x1e9)]('üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0x66ab9+_0x23a509(0x1f4)+_0x2f7065),{'paymentId':_0x66ab9,'status':_0x2f7065,'amount':_0x46a136[_0x23a509(0x1e4)],'currency':_0x46a136[_0x23a509(0x1d8)]||_0x23a509(0x19f)};}catch(_0x54dff6){console[_0x23a509(0x1af)]('‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:',_0x54dff6);throw _0x54dff6;}}[a55_0x2ca618(0x1da)](_0x2cbfd8,_0x9fd29e){const _0x364c69=a55_0x2ca618;return console[_0x364c69(0x1e9)](_0x364c69(0x171)),!![];}}exports[a55_0x2ca618(0x170)]=AmPayTRYService;