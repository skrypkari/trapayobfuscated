'use strict';function a45_0x304d(){const _0x1538f6=['üì•\x20AmPay\x20TRY\x20raw\x20response:','Bank\x20Transfer\x20TR','MCO','error_message','CHN','PRK','MDG','warn','SVK','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','AZE','SYC','MMR','CHE','pending','paid','VEN','\x20-\x20','GBR','application/json','üìä\x20AmPay\x20TRY\x20parsed\x20response:','Email:','Order\x20ID:','BTN','customerCountry','CHL','712316YKTcqk','checkPaymentStatus','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','loggerService','TRAFFER','3992252OvfiVG','ARE','AND','successUrl','paymentId','IND','5483259jOZOUN','System\x20ID:','1119700qZNHlP','verifyWebhookSignature','Customer\x20Country\x20(2-letter):','ESP','API_PRIVATE_KEY','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','processing','JPN','No\x20payment\x20ID\x20in\x20webhook\x20data','message','AUS','SWE','Tracker\x20ID:','AmPay\x20TRY\x20API\x20error:\x20','IRN','IRL','defineProperty','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','üì§\x20AmPay\x20TRY\x20API\x20request\x20data:','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','PENDING','ALB',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','THA','3JRsdPv','system_id','MNG','PRY','tracker_id','__esModule','\x20->\x20','firstName','toLowerCase','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','logWebhookError','KEN','status','ZMB','BGD','SMR','‚ùå\x20AmPay\x20TRY\x20API\x20error:','QAT','3164GwwEvD','KGZ','https://traffer.uk/gateway/ampay-try/','ECU','PER','text','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','stringify','ARG','redirect_url','BRA','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','apiUrl','FIN','failureUrl','FAILED','AUT','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','LAO','MUS','CZE','JOR','error','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','POST','10640jguHWi','phone','TJK','SUR','customerIp','üì§\x20AmPay\x20TRY\x20request\x20body:','PHL','GRC','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','currency','Customer\x20Country\x20(3-letter):','TrapayEnd/1.0','BHR','BOL','LBN','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','DNK','BEL','MKD','PAK','HTTP\x20','SVN','LVA','SRB','3534430gckqOM','TUR','RUS','CLIENT_MERCHANT_ID','Payment\x20URL:','MDA','API_PUBLIC_KEY','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','LTU','convert2LetterTo3LetterCountryCode','LUX','ampay-try','PSE','40VGIlrK','TrapayAPI/1.0','Customer\x20IP:','AmPayTRYService','email','Unknown\x20error','DEU','4013688OFuYNA','../loggerService','failed','MOZ','OMN','completed','ISR','Status:','MNE','TRY','NPL','EST','createPaymentLink','KWT','log','UZB','ZAF','success','‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20','PRT','expired','GHA','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda','SGP','YEM','ZWE','üìä\x20AmPay\x20TRY\x20status\x20response:','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','https://traffer.uk/gateway/ampay-try/webhook.php','timeout','KHM','CAN','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','BIH','amount','BLR','logWebhookReceived','orderId','MLT','CYP','MEX','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','FRA','waiting','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:'];a45_0x304d=function(){return _0x1538f6;};return a45_0x304d();}function a45_0x5077(_0x3b0489,_0x573bb0){const _0x304d79=a45_0x304d();return a45_0x5077=function(_0x50774f,_0x1d4718){_0x50774f=_0x50774f-0x1e4;let _0xb68e5d=_0x304d79[_0x50774f];return _0xb68e5d;},a45_0x5077(_0x3b0489,_0x573bb0);}const a45_0x225410=a45_0x5077;(function(_0x191f7c,_0x137bbe){const _0x74be94=a45_0x5077,_0x1de2fb=_0x191f7c();while(!![]){try{const _0x259221=-parseInt(_0x74be94(0x24b))/0x1+parseInt(_0x74be94(0x258))/0x2+-parseInt(_0x74be94(0x270))/0x3*(parseInt(_0x74be94(0x250))/0x4)+-parseInt(_0x74be94(0x1ef))/0x5+-parseInt(_0x74be94(0x203))/0x6+-parseInt(_0x74be94(0x282))/0x7*(-parseInt(_0x74be94(0x29d))/0x8)+-parseInt(_0x74be94(0x256))/0x9*(-parseInt(_0x74be94(0x1fc))/0xa);if(_0x259221===_0x137bbe)break;else _0x1de2fb['push'](_0x1de2fb['shift']());}catch(_0x4ea55d){_0x1de2fb['push'](_0x1de2fb['shift']());}}}(a45_0x304d,0x7cf39));Object[a45_0x225410(0x268)](exports,a45_0x225410(0x275),{'value':!![]}),exports[a45_0x225410(0x1ff)]=void 0x0;const loggerService_1=require(a45_0x225410(0x204));class AmPayTRYService{constructor(){const _0x208364=a45_0x225410;this[_0x208364(0x1f2)]=_0x208364(0x24f),this['API_PUBLIC_KEY']=_0x208364(0x21a),this[_0x208364(0x25c)]=_0x208364(0x2a5),this[_0x208364(0x290)]=_0x208364(0x284),console[_0x208364(0x211)](_0x208364(0x24d));}[a45_0x225410(0x1f8)](_0x3bccbb){const _0x54b2ad=a45_0x225410,_0x39cf78={'AD':_0x54b2ad(0x252),'AL':_0x54b2ad(0x26d),'AT':_0x54b2ad(0x294),'BA':_0x54b2ad(0x225),'BE':_0x54b2ad(0x1e8),'BG':'BGR','BY':_0x54b2ad(0x227),'CH':_0x54b2ad(0x23e),'CY':_0x54b2ad(0x22b),'CZ':_0x54b2ad(0x298),'DE':_0x54b2ad(0x202),'DK':_0x54b2ad(0x1e7),'EE':_0x54b2ad(0x20e),'ES':_0x54b2ad(0x25b),'FI':_0x54b2ad(0x291),'FR':_0x54b2ad(0x22e),'GB':_0x54b2ad(0x243),'GE':'GEO','GR':_0x54b2ad(0x2a4),'HR':'HRV','HU':'HUN','IE':_0x54b2ad(0x267),'IS':'ISL','IT':'ITA','LI':'LIE','LT':_0x54b2ad(0x1f7),'LU':_0x54b2ad(0x1f9),'LV':_0x54b2ad(0x1ed),'MC':_0x54b2ad(0x233),'MD':_0x54b2ad(0x1f4),'ME':_0x54b2ad(0x20b),'MK':_0x54b2ad(0x1e9),'MT':_0x54b2ad(0x22a),'NL':'NLD','NO':'NOR','PL':'POL','PT':_0x54b2ad(0x216),'RO':'ROU','RS':_0x54b2ad(0x1ee),'RU':_0x54b2ad(0x1f1),'SE':_0x54b2ad(0x263),'SI':_0x54b2ad(0x1ec),'SK':_0x54b2ad(0x239),'SM':_0x54b2ad(0x27f),'UA':'UKR','VA':'VAT','XK':'XKX','AM':'ARM','AZ':_0x54b2ad(0x23b),'KZ':'KAZ','KG':_0x54b2ad(0x283),'TJ':_0x54b2ad(0x29f),'TM':'TKM','UZ':_0x54b2ad(0x212),'US':'USA','CA':_0x54b2ad(0x223),'AU':_0x54b2ad(0x262),'JP':_0x54b2ad(0x25f),'CN':_0x54b2ad(0x235),'IN':_0x54b2ad(0x255),'BR':_0x54b2ad(0x28d),'MX':_0x54b2ad(0x22c),'AR':_0x54b2ad(0x28b),'CL':_0x54b2ad(0x24a),'PE':_0x54b2ad(0x286),'CO':'COL','VE':_0x54b2ad(0x241),'EC':_0x54b2ad(0x285),'BO':_0x54b2ad(0x1e4),'PY':_0x54b2ad(0x273),'UY':'URY','SR':_0x54b2ad(0x2a0),'GY':'GUY','FK':'FLK','ZA':_0x54b2ad(0x213),'EG':'EGY','NG':'NGA','KE':_0x54b2ad(0x27b),'GH':_0x54b2ad(0x218),'TZ':'TZA','UG':'UGA','ZW':_0x54b2ad(0x21d),'ZM':_0x54b2ad(0x27d),'MW':'MWI','MZ':_0x54b2ad(0x206),'MG':_0x54b2ad(0x237),'MU':_0x54b2ad(0x297),'SC':_0x54b2ad(0x23c),'RE':'REU','TR':_0x54b2ad(0x1f0),'IR':_0x54b2ad(0x266),'IQ':'IRQ','SA':'SAU','AE':_0x54b2ad(0x251),'KW':_0x54b2ad(0x210),'QA':_0x54b2ad(0x281),'BH':_0x54b2ad(0x2a9),'OM':_0x54b2ad(0x207),'YE':_0x54b2ad(0x21c),'JO':_0x54b2ad(0x299),'LB':_0x54b2ad(0x1e5),'SY':'SYR','IL':_0x54b2ad(0x209),'PS':_0x54b2ad(0x1fb),'KR':'KOR','KP':_0x54b2ad(0x236),'TH':_0x54b2ad(0x26f),'VN':'VNM','MY':'MYS','SG':_0x54b2ad(0x21b),'ID':'IDN','PH':_0x54b2ad(0x2a3),'LA':_0x54b2ad(0x296),'KH':_0x54b2ad(0x222),'MM':_0x54b2ad(0x23d),'BD':_0x54b2ad(0x27e),'LK':'LKA','NP':_0x54b2ad(0x20d),'BT':_0x54b2ad(0x248),'MV':'MDV','AF':'AFG','PK':_0x54b2ad(0x1ea),'MN':_0x54b2ad(0x272)},_0x44e4d7=_0x39cf78[_0x3bccbb['toUpperCase']()];if(!_0x44e4d7)return console[_0x54b2ad(0x238)](_0x54b2ad(0x215)+_0x3bccbb+_0x54b2ad(0x26e)),'TUR';return _0x44e4d7;}async['createPayment'](_0xe47bb5){const _0x49ab07=a45_0x225410;console['log'](_0x49ab07(0x23a),{'paymentId':_0xe47bb5[_0x49ab07(0x254)],'amount':_0xe47bb5[_0x49ab07(0x226)],'currency':_0xe47bb5[_0x49ab07(0x2a6)],'customerCountry':_0xe47bb5['customerCountry']});try{const _0x213362={'client_merchant_id':this[_0x49ab07(0x1f2)],'payment_method':_0x49ab07(0x232),'client_transaction_id':_0xe47bb5[_0x49ab07(0x229)],'amount':_0xe47bb5[_0x49ab07(0x226)],'currency':_0xe47bb5[_0x49ab07(0x2a6)],'callback_url':'https://traffer.uk/webhook/gateway/ampay-try','tracker_id':_0xe47bb5[_0x49ab07(0x254)],'redirect_url':_0xe47bb5[_0x49ab07(0x253)],'failure_url':_0xe47bb5[_0x49ab07(0x292)],'customer_first_name':_0xe47bb5[_0x49ab07(0x277)],'customer_last_name':_0xe47bb5['lastName'],'customer_email':_0xe47bb5[_0x49ab07(0x200)],'customer_phone':_0xe47bb5[_0x49ab07(0x29e)]||'','customer_ip':_0xe47bb5[_0x49ab07(0x2a1)],'customer_country':_0xe47bb5[_0x49ab07(0x249)],'api_public_key':this['API_PUBLIC_KEY']};console[_0x49ab07(0x211)](_0x49ab07(0x26a),JSON['stringify'](_0x213362,null,0x2));const _0x1cd3ad=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x49ab07(0x244),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x49ab07(0x28a)](_0x213362)});console[_0x49ab07(0x211)](_0x49ab07(0x279),_0x1cd3ad[_0x49ab07(0x27c)]);const _0x5cf773=await _0x1cd3ad['text']();console['log'](_0x49ab07(0x230),_0x5cf773);let _0x513386;try{_0x513386=JSON['parse'](_0x5cf773);}catch(_0x2298ac){console[_0x49ab07(0x29a)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:',_0x2298ac);throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x5cf773);}console[_0x49ab07(0x211)](_0x49ab07(0x245),JSON[_0x49ab07(0x28a)](_0x513386,null,0x2)),loggerService_1[_0x49ab07(0x24e)][_0x49ab07(0x228)]('ampay-try',_0x513386,{});if(!_0x1cd3ad['ok']){const _0x1479f7=_0x513386[_0x49ab07(0x234)]||_0x513386[_0x49ab07(0x261)]||_0x49ab07(0x1eb)+_0x1cd3ad[_0x49ab07(0x27c)];console[_0x49ab07(0x29a)](_0x49ab07(0x280),_0x1479f7);throw new Error(_0x49ab07(0x265)+_0x1479f7);}if(!_0x513386[_0x49ab07(0x28c)]){console[_0x49ab07(0x29a)](_0x49ab07(0x28e),_0x513386);throw new Error(_0x49ab07(0x219));}const _0x4b8239={'gateway_payment_id':_0x513386[_0x49ab07(0x271)]||_0xe47bb5[_0x49ab07(0x229)],'payment_url':_0x513386[_0x49ab07(0x28c)],'transaction_id':_0x513386['client_transaction_id']};return console[_0x49ab07(0x211)](_0x49ab07(0x22d),_0x4b8239),_0x4b8239;}catch(_0xfa51b3){console[_0x49ab07(0x29a)](_0x49ab07(0x21f),_0xfa51b3),loggerService_1[_0x49ab07(0x24e)][_0x49ab07(0x27a)](_0x49ab07(0x1fa),_0xfa51b3,_0xe47bb5);throw _0xfa51b3;}}async[a45_0x225410(0x20f)](_0x1c0060){const _0x56721d=a45_0x225410;try{const {orderId:_0xa888b1,amount:_0x5c069b,currency:_0x49f8c9,firstName:_0xd7b304,lastName:_0x35288c,email:_0x3f4d95,customerIp:_0x56f55b,customerCountry:_0x385234,successUrl:_0x34577f,failureUrl:_0x12fc83}=_0x1c0060;console['log'](_0x56721d(0x1f6)),console[_0x56721d(0x211)](_0x56721d(0x247),_0xa888b1),console[_0x56721d(0x211)]('Amount:',_0x5c069b,_0x49f8c9),console[_0x56721d(0x211)]('Customer:',_0xd7b304+'\x20'+_0x35288c),console[_0x56721d(0x211)](_0x56721d(0x246),_0x3f4d95),console['log'](_0x56721d(0x1fe),_0x56f55b),console[_0x56721d(0x211)](_0x56721d(0x25a),_0x385234);const _0x36ee4d=this[_0x56721d(0x1f8)](_0x385234);console[_0x56721d(0x211)](_0x56721d(0x2a7),_0x36ee4d);const _0x26c3e1={'sub_method':'GAM','currency':_0x49f8c9['toUpperCase'](),'amount':_0x5c069b,'callback_url':_0x56721d(0x220),'client_merchant_id':this[_0x56721d(0x1f2)],'client_transaction_id':_0xa888b1,'transaction_description':_0xa888b1,'customer':{'ip':_0x56f55b,'email':_0x3f4d95,'full_name':_0xd7b304+'\x20'+_0x35288c,'country':_0x36ee4d},'success_redirect_url':_0x34577f,'error_redirect_url':_0x12fc83};console[_0x56721d(0x211)](_0x56721d(0x2a2),JSON[_0x56721d(0x28a)](_0x26c3e1,null,0x2));const _0x5dab7e=await fetch(this[_0x56721d(0x290)]+'ampay.php',{'method':_0x56721d(0x29c),'headers':{'Content-Type':_0x56721d(0x244),'User-Agent':_0x56721d(0x1fd)},'body':JSON[_0x56721d(0x28a)](_0x26c3e1)}),_0x3fe9ca=await _0x5dab7e['text']();console['log'](_0x56721d(0x231),_0x3fe9ca);if(!_0x5dab7e['ok'])throw new Error(_0x56721d(0x26b)+_0x5dab7e[_0x56721d(0x27c)]+_0x56721d(0x242)+_0x3fe9ca);let _0x3acab1;try{_0x3acab1=JSON['parse'](_0x3fe9ca);}catch(_0x451116){throw new Error(_0x56721d(0x25d)+_0x3fe9ca);}console[_0x56721d(0x211)]('üìä\x20AmPay\x20TRY\x20response\x20data:',JSON[_0x56721d(0x28a)](_0x3acab1,null,0x2));if(!_0x3acab1[_0x56721d(0x28c)])throw new Error(_0x56721d(0x224)+(_0x3acab1[_0x56721d(0x234)]||_0x3acab1['message']||_0x56721d(0x201)));const _0x12dc0f=_0x3acab1[_0x56721d(0x28c)],_0x2863ea=_0x3acab1['system_id'],_0x254172=_0x3acab1[_0x56721d(0x274)];return console[_0x56721d(0x211)]('‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully'),console[_0x56721d(0x211)](_0x56721d(0x1f3),_0x12dc0f),console[_0x56721d(0x211)](_0x56721d(0x257),_0x2863ea),console[_0x56721d(0x211)](_0x56721d(0x264),_0x254172),console[_0x56721d(0x211)](_0x56721d(0x20a),_0x3acab1[_0x56721d(0x27c)]),console['log'](_0x56721d(0x29b)),{'gateway_payment_id':_0x2863ea||_0x254172||_0xa888b1,'payment_url':_0x12dc0f||'','transaction_id':_0x2863ea};}catch(_0x4460ce){console[_0x56721d(0x29a)]('‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:',_0x4460ce),console[_0x56721d(0x211)]('üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...'),loggerService_1[_0x56721d(0x24e)][_0x56721d(0x27a)](_0x56721d(0x1fa),_0x4460ce,_0x1c0060);throw _0x4460ce;}}async[a45_0x225410(0x24c)](_0x1f19eb){const _0x4be7bc=a45_0x225410;console['log']('üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:',_0x1f19eb);try{const _0x5d2902={'client_merchant_id':this[_0x4be7bc(0x1f2)],'system_id':_0x1f19eb,'api_public_key':this[_0x4be7bc(0x1f5)]},_0x1855b7=await fetch(this[_0x4be7bc(0x290)]+'/status',{'method':_0x4be7bc(0x29c),'headers':{'Content-Type':_0x4be7bc(0x244),'User-Agent':_0x4be7bc(0x2a8)},'body':JSON['stringify'](_0x5d2902)}),_0x47ec0d=await _0x1855b7[_0x4be7bc(0x287)]();console[_0x4be7bc(0x211)](_0x4be7bc(0x288),_0x47ec0d);let _0x39f5a1;try{_0x39f5a1=JSON['parse'](_0x47ec0d);}catch(_0x545683){return console[_0x4be7bc(0x29a)](_0x4be7bc(0x295),_0x545683),{'status':_0x4be7bc(0x293)};}console[_0x4be7bc(0x211)](_0x4be7bc(0x21e),JSON[_0x4be7bc(0x28a)](_0x39f5a1,null,0x2));let _0x2f2326=_0x4be7bc(0x26c);if(_0x39f5a1[_0x4be7bc(0x27c)])switch(_0x39f5a1[_0x4be7bc(0x27c)][_0x4be7bc(0x278)]()){case _0x4be7bc(0x214):case _0x4be7bc(0x208):case _0x4be7bc(0x240):_0x2f2326='PAID';break;case'failed':case'error':case'declined':_0x2f2326=_0x4be7bc(0x293);break;case _0x4be7bc(0x217):case _0x4be7bc(0x221):_0x2f2326='EXPIRED';break;case _0x4be7bc(0x23f):case _0x4be7bc(0x25e):case _0x4be7bc(0x22f):default:_0x2f2326=_0x4be7bc(0x26c);break;}return{'status':_0x2f2326,'amount':_0x39f5a1[_0x4be7bc(0x226)],'currency':_0x39f5a1[_0x4be7bc(0x2a6)]};}catch(_0x28ddc5){return console['error']('‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:',_0x28ddc5),{'status':_0x4be7bc(0x293)};}}async['processWebhook'](_0x3356ae){const _0x177241=a45_0x225410;console['log'](_0x177241(0x289),JSON['stringify'](_0x3356ae,null,0x2));try{const _0x3e707c=_0x3356ae['tracker_id']||_0x3356ae['client_transaction_id']||_0x3356ae[_0x177241(0x271)];if(!_0x3e707c){console[_0x177241(0x29a)](_0x177241(0x28f));throw new Error(_0x177241(0x260));}let _0x3e835b=_0x177241(0x26c);if(_0x3356ae[_0x177241(0x27c)])switch(_0x3356ae[_0x177241(0x27c)]['toLowerCase']()){case _0x177241(0x214):case _0x177241(0x208):case _0x177241(0x240):_0x3e835b='PAID';break;case _0x177241(0x205):case _0x177241(0x29a):case'declined':_0x3e835b=_0x177241(0x293);break;case _0x177241(0x217):case _0x177241(0x221):_0x3e835b='EXPIRED';break;case'pending':case _0x177241(0x25e):case'waiting':default:_0x3e835b=_0x177241(0x26c);break;}return console[_0x177241(0x211)]('üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0x3e707c+_0x177241(0x276)+_0x3e835b),{'paymentId':_0x3e707c,'status':_0x3e835b,'amount':_0x3356ae['amount'],'currency':_0x3356ae[_0x177241(0x2a6)]||_0x177241(0x20c)};}catch(_0x1689ba){console[_0x177241(0x29a)](_0x177241(0x1e6),_0x1689ba);throw _0x1689ba;}}[a45_0x225410(0x259)](_0x187ac8,_0x4a84ab){const _0x403524=a45_0x225410;return console[_0x403524(0x211)](_0x403524(0x269)),!![];}}exports[a45_0x225410(0x1ff)]=AmPayTRYService;