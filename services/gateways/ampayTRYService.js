'use strict';const a45_0x28fb41=a45_0x1e42;function a45_0x36d7(){const _0x408e7c=['ZMB','LTU','üìä\x20AmPay\x20TRY\x20parsed\x20response:','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','\x20->\x20','58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda','MCO','POL','SUR','ARE','System\x20ID:','Status:','CZE','AFG','BTN','3429685KUsoXK','TRY','AUS','CAN','__esModule','Order\x20ID:','PAK','GAM','üì§\x20AmPay\x20TRY\x20API\x20request\x20data:','Tracker\x20ID:','MOZ','TZA','UKR','MYS','checkPaymentStatus','URY','pending','SYC','ESP','LUX','createPaymentLink','MWI','IRL','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','MMR','SVK','BHR','RUS','timeout','156evxQPY','IRQ','CYP','COL','KAZ','declined','BRA','SVN','currency','Email:','stringify','email','BEL','USA','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','TKM','ISR','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','error','toUpperCase','SRB','KHM','expired','https://traffer.uk/webhook/gateway/ampay-try','completed','TrapayEnd/1.0','createPayment','GUY','Bank\x20Transfer\x20TR','PRY','PSE','SYR','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','FAILED','verifyWebhookSignature','JPN','CHN','XKX','API_PRIVATE_KEY','parse','message','processWebhook','logWebhookError','\x20-\x20','application/json','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','üì§\x20AmPay\x20TRY\x20request\x20body:','44645JXayue','1166694kustCD','NOR','TRAFFER','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','orderId','firstName','toLowerCase','Payment\x20URL:','Customer\x20Country\x20(3-letter):','PHL','error_message','ZAF','system_id','691218NPJVyr','EST','NLD','ampay.php','Amount:','MNG','AND','SWE','client_transaction_id','VEN','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','https://traffer.uk/gateway/ampay-try/webhook.php','https://traffer.uk/gateway/ampay-try/','REU','GHA','LAO','paymentId','KOR','ISL','IND','ITA','MDA','Customer\x20IP:','KWT','../loggerService','AmPayTRYService','LVA','MKD','/status','warn','üìä\x20AmPay\x20TRY\x20status\x20response:','VNM','CHL','MUS','FRA','ampay-try','customerIp','TrapayAPI/1.0','GBR','TJK','VAT','text','log','‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','Customer\x20Country\x20(2-letter):','üì•\x20AmPay\x20TRY\x20raw\x20response:','SMR','convert2LetterTo3LetterCountryCode','BGR','OMN','31744oktXjJ','MDG','AUT','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','MEX','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','amount','2280905zkCWun','BOL','Unknown\x20error','ALB','status','apiUrl','phone','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','API_PUBLIC_KEY','GRC','customerCountry','JOR','MDV','NPL','HUN','redirect_url','HTTP\x20','failed','processing','ROU','ARM','paid','UZB','PENDING','üìä\x20AmPay\x20TRY\x20response\x20data:','PAID','successUrl','LKA','waiting','EXPIRED','loggerService','2397464TjMJML','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','KGZ','CLIENT_MERCHANT_ID','ZWE','PRK','PER','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...'];a45_0x36d7=function(){return _0x408e7c;};return a45_0x36d7();}function a45_0x1e42(_0x4836b9,_0x369c4c){const _0x36d7c6=a45_0x36d7();return a45_0x1e42=function(_0x1e42d6,_0x55c726){_0x1e42d6=_0x1e42d6-0x70;let _0x5aa9bc=_0x36d7c6[_0x1e42d6];return _0x5aa9bc;},a45_0x1e42(_0x4836b9,_0x369c4c);}(function(_0x444410,_0x228eb2){const _0xee9993=a45_0x1e42,_0xd5a504=_0x444410();while(!![]){try{const _0x3fa00f=-parseInt(_0xee9993(0x138))/0x1+-parseInt(_0xee9993(0x139))/0x2+parseInt(_0xee9993(0x108))/0x3*(-parseInt(_0xee9993(0xab))/0x4)+parseInt(_0xee9993(0xb4))/0x5+parseInt(_0xee9993(0x79))/0x6+parseInt(_0xee9993(0xeb))/0x7+parseInt(_0xee9993(0xd4))/0x8;if(_0x3fa00f===_0x228eb2)break;else _0xd5a504['push'](_0xd5a504['shift']());}catch(_0x3debbf){_0xd5a504['push'](_0xd5a504['shift']());}}}(a45_0x36d7,0x4e366));Object['defineProperty'](exports,a45_0x28fb41(0xef),{'value':!![]}),exports[a45_0x28fb41(0x92)]=void 0x0;const loggerService_1=require(a45_0x28fb41(0x91));class AmPayTRYService{constructor(){const _0x4e4017=a45_0x28fb41;this[_0x4e4017(0xd7)]=_0x4e4017(0x13b),this[_0x4e4017(0xbd)]=_0x4e4017(0xe1),this[_0x4e4017(0x12f)]='a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815',this[_0x4e4017(0xb9)]=_0x4e4017(0x85),console[_0x4e4017(0xa3)](_0x4e4017(0x83));}[a45_0x28fb41(0xa8)](_0x6e5b4d){const _0x573d50=a45_0x28fb41,_0x57b777={'AD':_0x573d50(0x7f),'AL':_0x573d50(0xb7),'AT':_0x573d50(0xad),'BA':'BIH','BE':_0x573d50(0x114),'BG':_0x573d50(0xa9),'BY':'BLR','CH':'CHE','CY':_0x573d50(0x10a),'CZ':_0x573d50(0xe8),'DE':'DEU','DK':'DNK','EE':_0x573d50(0x7a),'ES':_0x573d50(0xfd),'FI':'FIN','FR':_0x573d50(0x9b),'GB':_0x573d50(0x9f),'GE':'GEO','GR':_0x573d50(0xbe),'HR':'HRV','HU':_0x573d50(0xc3),'IE':_0x573d50(0x101),'IS':_0x573d50(0x8b),'IT':_0x573d50(0x8d),'LI':'LIE','LT':_0x573d50(0xdd),'LU':_0x573d50(0xfe),'LV':_0x573d50(0x93),'MC':_0x573d50(0xe2),'MD':_0x573d50(0x8e),'ME':'MNE','MK':_0x573d50(0x94),'MT':'MLT','NL':_0x573d50(0x7b),'NO':_0x573d50(0x13a),'PL':_0x573d50(0xe3),'PT':'PRT','RO':_0x573d50(0xc8),'RS':_0x573d50(0x11c),'RU':_0x573d50(0x106),'SE':_0x573d50(0x80),'SI':_0x573d50(0x10f),'SK':_0x573d50(0x104),'SM':_0x573d50(0xa7),'UA':_0x573d50(0xf7),'VA':_0x573d50(0xa1),'XK':_0x573d50(0x12e),'AM':_0x573d50(0xc9),'AZ':'AZE','KZ':_0x573d50(0x10c),'KG':_0x573d50(0xd6),'TJ':_0x573d50(0xa0),'TM':_0x573d50(0x117),'UZ':_0x573d50(0xcb),'US':_0x573d50(0x115),'CA':_0x573d50(0xee),'AU':_0x573d50(0xed),'JP':_0x573d50(0x12c),'CN':_0x573d50(0x12d),'IN':_0x573d50(0x8c),'BR':_0x573d50(0x10e),'MX':_0x573d50(0xb1),'AR':'ARG','CL':_0x573d50(0x99),'PE':_0x573d50(0xda),'CO':_0x573d50(0x10b),'VE':_0x573d50(0x82),'EC':'ECU','BO':_0x573d50(0xb5),'PY':_0x573d50(0x125),'UY':_0x573d50(0xfa),'SR':_0x573d50(0xe4),'GY':_0x573d50(0x123),'FK':'FLK','ZA':_0x573d50(0x77),'EG':'EGY','NG':'NGA','KE':'KEN','GH':_0x573d50(0x87),'TZ':_0x573d50(0xf6),'UG':'UGA','ZW':_0x573d50(0xd8),'ZM':_0x573d50(0xdc),'MW':_0x573d50(0x100),'MZ':_0x573d50(0xf5),'MG':_0x573d50(0xac),'MU':_0x573d50(0x9a),'SC':_0x573d50(0xfc),'RE':_0x573d50(0x86),'TR':'TUR','IR':'IRN','IQ':_0x573d50(0x109),'SA':'SAU','AE':_0x573d50(0xe5),'KW':_0x573d50(0x90),'QA':'QAT','BH':_0x573d50(0x105),'OM':_0x573d50(0xaa),'YE':'YEM','JO':_0x573d50(0xc0),'LB':'LBN','SY':_0x573d50(0x127),'IL':_0x573d50(0x118),'PS':_0x573d50(0x126),'KR':_0x573d50(0x8a),'KP':_0x573d50(0xd9),'TH':'THA','VN':_0x573d50(0x98),'MY':_0x573d50(0xf8),'SG':'SGP','ID':'IDN','PH':_0x573d50(0x75),'LA':_0x573d50(0x88),'KH':_0x573d50(0x11d),'MM':_0x573d50(0x103),'BD':'BGD','LK':_0x573d50(0xd0),'NP':_0x573d50(0xc2),'BT':_0x573d50(0xea),'MV':_0x573d50(0xc1),'AF':_0x573d50(0xe9),'PK':_0x573d50(0xf1),'MN':_0x573d50(0x7e)},_0x35b349=_0x57b777[_0x6e5b4d[_0x573d50(0x11b)]()];if(!_0x35b349)return console[_0x573d50(0x96)]('‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20'+_0x6e5b4d+_0x573d50(0x129)),'TUR';return _0x35b349;}async[a45_0x28fb41(0x122)](_0x5f4450){const _0x1dcf21=a45_0x28fb41;console[_0x1dcf21(0xa3)]('üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:',{'paymentId':_0x5f4450[_0x1dcf21(0x89)],'amount':_0x5f4450['amount'],'currency':_0x5f4450['currency'],'customerCountry':_0x5f4450[_0x1dcf21(0xbf)]});try{const _0x5f8ae8={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'payment_method':_0x1dcf21(0x124),'client_transaction_id':_0x5f4450['orderId'],'amount':_0x5f4450[_0x1dcf21(0xb3)],'currency':_0x5f4450[_0x1dcf21(0x110)],'callback_url':_0x1dcf21(0x11f),'tracker_id':_0x5f4450[_0x1dcf21(0x89)],'redirect_url':_0x5f4450[_0x1dcf21(0xcf)],'failure_url':_0x5f4450['failureUrl'],'customer_first_name':_0x5f4450[_0x1dcf21(0x71)],'customer_last_name':_0x5f4450['lastName'],'customer_email':_0x5f4450[_0x1dcf21(0x113)],'customer_phone':_0x5f4450[_0x1dcf21(0xba)]||'','customer_ip':_0x5f4450[_0x1dcf21(0x9d)],'customer_country':_0x5f4450[_0x1dcf21(0xbf)],'api_public_key':this[_0x1dcf21(0xbd)]};console[_0x1dcf21(0xa3)](_0x1dcf21(0xf3),JSON[_0x1dcf21(0x112)](_0x5f8ae8,null,0x2));const _0x4d4339=await fetch(this['apiUrl'],{'method':'POST','headers':{'Content-Type':_0x1dcf21(0x135),'User-Agent':_0x1dcf21(0x121)},'body':JSON[_0x1dcf21(0x112)](_0x5f8ae8)});console[_0x1dcf21(0xa3)]('üì°\x20AmPay\x20TRY\x20API\x20response\x20status:',_0x4d4339[_0x1dcf21(0xb8)]);const _0xaf4347=await _0x4d4339[_0x1dcf21(0xa2)]();console[_0x1dcf21(0xa3)]('üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:',_0xaf4347);let _0x5ca512;try{_0x5ca512=JSON[_0x1dcf21(0x130)](_0xaf4347);}catch(_0x5db1f5){console['error'](_0x1dcf21(0xbc),_0x5db1f5);throw new Error(_0x1dcf21(0xb0)+_0xaf4347);}console[_0x1dcf21(0xa3)](_0x1dcf21(0xde),JSON[_0x1dcf21(0x112)](_0x5ca512,null,0x2)),loggerService_1['loggerService']['logWebhookReceived']('ampay-try',_0x5ca512,{});if(!_0x4d4339['ok']){const _0x5bddca=_0x5ca512[_0x1dcf21(0x76)]||_0x5ca512[_0x1dcf21(0x131)]||_0x1dcf21(0xc5)+_0x4d4339['status'];console[_0x1dcf21(0x11a)]('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x5bddca);throw new Error('AmPay\x20TRY\x20API\x20error:\x20'+_0x5bddca);}if(!_0x5ca512[_0x1dcf21(0xc4)]){console[_0x1dcf21(0x11a)]('‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:',_0x5ca512);throw new Error('AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL');}const _0x273a25={'gateway_payment_id':_0x5ca512[_0x1dcf21(0x78)]||_0x5f4450[_0x1dcf21(0x70)],'payment_url':_0x5ca512['redirect_url'],'transaction_id':_0x5ca512['client_transaction_id']};return console[_0x1dcf21(0xa3)]('‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:',_0x273a25),_0x273a25;}catch(_0x42ba65){console[_0x1dcf21(0x11a)](_0x1dcf21(0x13c),_0x42ba65),loggerService_1['loggerService']['logWebhookError']('ampay-try',_0x42ba65,_0x5f4450);throw _0x42ba65;}}async[a45_0x28fb41(0xff)](_0xf4d487){const _0x15d41e=a45_0x28fb41;try{const {orderId:_0x283c5c,amount:_0x2ca7ff,currency:_0x4aca28,firstName:_0x4fc0c8,lastName:_0x3cb4ca,email:_0x599f52,customerIp:_0x4e5b22,customerCountry:_0x28d74b,successUrl:_0x1073f1,failureUrl:_0x1b9a71}=_0xf4d487;console[_0x15d41e(0xa3)]('üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...'),console[_0x15d41e(0xa3)](_0x15d41e(0xf0),_0x283c5c),console['log'](_0x15d41e(0x7d),_0x2ca7ff,_0x4aca28),console[_0x15d41e(0xa3)]('Customer:',_0x4fc0c8+'\x20'+_0x3cb4ca),console['log'](_0x15d41e(0x111),_0x599f52),console[_0x15d41e(0xa3)](_0x15d41e(0x8f),_0x4e5b22),console[_0x15d41e(0xa3)](_0x15d41e(0xa5),_0x28d74b);const _0x3f1372=this[_0x15d41e(0xa8)](_0x28d74b);console['log'](_0x15d41e(0x74),_0x3f1372);const _0x41381f={'sub_method':_0x15d41e(0xf2),'currency':_0x4aca28[_0x15d41e(0x11b)](),'amount':_0x2ca7ff,'callback_url':_0x15d41e(0x84),'client_merchant_id':this[_0x15d41e(0xd7)],'client_transaction_id':_0x283c5c,'transaction_description':_0x283c5c,'customer':{'ip':_0x4e5b22,'email':_0x599f52,'full_name':_0x4fc0c8+'\x20'+_0x3cb4ca,'country':_0x3f1372},'success_redirect_url':_0x1073f1,'error_redirect_url':_0x1b9a71};console[_0x15d41e(0xa3)](_0x15d41e(0x137),JSON[_0x15d41e(0x112)](_0x41381f,null,0x2));const _0x3d21db=await fetch(this[_0x15d41e(0xb9)]+_0x15d41e(0x7c),{'method':'POST','headers':{'Content-Type':_0x15d41e(0x135),'User-Agent':_0x15d41e(0x9e)},'body':JSON[_0x15d41e(0x112)](_0x41381f)}),_0x48ea48=await _0x3d21db[_0x15d41e(0xa2)]();console[_0x15d41e(0xa3)](_0x15d41e(0xa6),_0x48ea48);if(!_0x3d21db['ok'])throw new Error(_0x15d41e(0x102)+_0x3d21db[_0x15d41e(0xb8)]+_0x15d41e(0x134)+_0x48ea48);let _0x5daa6f;try{_0x5daa6f=JSON[_0x15d41e(0x130)](_0x48ea48);}catch(_0x4fc8dd){throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x48ea48);}console[_0x15d41e(0xa3)](_0x15d41e(0xcd),JSON[_0x15d41e(0x112)](_0x5daa6f,null,0x2));if(!_0x5daa6f[_0x15d41e(0xc4)])throw new Error(_0x15d41e(0x128)+(_0x5daa6f['error_message']||_0x5daa6f['message']||_0x15d41e(0xb6)));const _0x4175bc=_0x5daa6f[_0x15d41e(0xc4)],_0x1a5425=_0x5daa6f['system_id'],_0x4051a4=_0x5daa6f['tracker_id'];return console[_0x15d41e(0xa3)](_0x15d41e(0xa4)),console['log'](_0x15d41e(0x73),_0x4175bc),console['log'](_0x15d41e(0xe6),_0x1a5425),console[_0x15d41e(0xa3)](_0x15d41e(0xf4),_0x4051a4),console[_0x15d41e(0xa3)](_0x15d41e(0xe7),_0x5daa6f[_0x15d41e(0xb8)]),console['log'](_0x15d41e(0x116)),{'gateway_payment_id':_0x1a5425||_0x4051a4||_0x283c5c,'payment_url':_0x4175bc||'','transaction_id':_0x1a5425};}catch(_0x4f7d4f){console[_0x15d41e(0x11a)](_0x15d41e(0x13c),_0x4f7d4f),console[_0x15d41e(0xa3)](_0x15d41e(0xdb)),loggerService_1[_0x15d41e(0xd3)][_0x15d41e(0x133)](_0x15d41e(0x9c),_0x4f7d4f,_0xf4d487);throw _0x4f7d4f;}}async[a45_0x28fb41(0xf9)](_0x44049c){const _0x39a1f6=a45_0x28fb41;console[_0x39a1f6(0xa3)](_0x39a1f6(0xb2),_0x44049c);try{const _0x28ee54={'client_merchant_id':this[_0x39a1f6(0xd7)],'system_id':_0x44049c,'api_public_key':this[_0x39a1f6(0xbd)]},_0x2534e0=await fetch(this[_0x39a1f6(0xb9)]+_0x39a1f6(0x95),{'method':'POST','headers':{'Content-Type':_0x39a1f6(0x135),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x39a1f6(0x112)](_0x28ee54)}),_0x3ab4b1=await _0x2534e0[_0x39a1f6(0xa2)]();console['log'](_0x39a1f6(0xbb),_0x3ab4b1);let _0x3804f7;try{_0x3804f7=JSON[_0x39a1f6(0x130)](_0x3ab4b1);}catch(_0x4896f6){return console[_0x39a1f6(0x11a)](_0x39a1f6(0xdf),_0x4896f6),{'status':'FAILED'};}console[_0x39a1f6(0xa3)](_0x39a1f6(0x97),JSON[_0x39a1f6(0x112)](_0x3804f7,null,0x2));let _0x285882='PENDING';if(_0x3804f7[_0x39a1f6(0xb8)])switch(_0x3804f7[_0x39a1f6(0xb8)][_0x39a1f6(0x72)]()){case'success':case _0x39a1f6(0x120):case _0x39a1f6(0xca):_0x285882=_0x39a1f6(0xce);break;case _0x39a1f6(0xc6):case'error':case _0x39a1f6(0x10d):_0x285882=_0x39a1f6(0x12a);break;case _0x39a1f6(0x11e):case'timeout':_0x285882=_0x39a1f6(0xd2);break;case'pending':case _0x39a1f6(0xc7):case _0x39a1f6(0xd1):default:_0x285882=_0x39a1f6(0xcc);break;}return{'status':_0x285882,'amount':_0x3804f7[_0x39a1f6(0xb3)],'currency':_0x3804f7['currency']};}catch(_0x176734){return console[_0x39a1f6(0x11a)](_0x39a1f6(0x119),_0x176734),{'status':_0x39a1f6(0x12a)};}}async[a45_0x28fb41(0x132)](_0x21511c){const _0x3bd0ef=a45_0x28fb41;console[_0x3bd0ef(0xa3)]('üì•\x20Processing\x20AmPay\x20TRY\x20webhook:',JSON[_0x3bd0ef(0x112)](_0x21511c,null,0x2));try{const _0x48029b=_0x21511c['tracker_id']||_0x21511c[_0x3bd0ef(0x81)]||_0x21511c['system_id'];if(!_0x48029b){console[_0x3bd0ef(0x11a)](_0x3bd0ef(0xd5));throw new Error('No\x20payment\x20ID\x20in\x20webhook\x20data');}let _0x43ca4b=_0x3bd0ef(0xcc);if(_0x21511c[_0x3bd0ef(0xb8)])switch(_0x21511c[_0x3bd0ef(0xb8)][_0x3bd0ef(0x72)]()){case'success':case _0x3bd0ef(0x120):case'paid':_0x43ca4b='PAID';break;case _0x3bd0ef(0xc6):case _0x3bd0ef(0x11a):case _0x3bd0ef(0x10d):_0x43ca4b=_0x3bd0ef(0x12a);break;case _0x3bd0ef(0x11e):case _0x3bd0ef(0x107):_0x43ca4b=_0x3bd0ef(0xd2);break;case _0x3bd0ef(0xfb):case _0x3bd0ef(0xc7):case _0x3bd0ef(0xd1):default:_0x43ca4b=_0x3bd0ef(0xcc);break;}return console[_0x3bd0ef(0xa3)](_0x3bd0ef(0xaf)+_0x48029b+_0x3bd0ef(0xe0)+_0x43ca4b),{'paymentId':_0x48029b,'status':_0x43ca4b,'amount':_0x21511c[_0x3bd0ef(0xb3)],'currency':_0x21511c['currency']||_0x3bd0ef(0xec)};}catch(_0x4b5310){console[_0x3bd0ef(0x11a)](_0x3bd0ef(0xae),_0x4b5310);throw _0x4b5310;}}[a45_0x28fb41(0x12b)](_0x2124d4,_0x329dde){const _0x233a97=a45_0x28fb41;return console[_0x233a97(0xa3)](_0x233a97(0x136)),!![];}}exports[a45_0x28fb41(0x92)]=AmPayTRYService;