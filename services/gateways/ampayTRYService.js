'use strict';function a53_0x33f9(){const _0x1f4411=['RUS','application/json','system_id','2EbycQy','logWebhookReceived','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','AND','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','XKX','Unknown\x20error','DNK','TKM','EGY','CHN','VEN','declined','AFG','createPayment','IRN','BTN','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','https://traffer.uk/gateway/ampay-try/','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','AmPayTRYService','ZWE','https://traffer.uk/gateway/ampay-try/webhook.php','THA','ARE','KAZ','OMN','JPN','SUR','GEO','phone','MMR','KGZ','API_PUBLIC_KEY','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','615520VPqHhn','FLK','MWI','parse','paymentId','EXPIRED','TrapayEnd/1.0','147014QHuRsX','MNE','NOR','FAILED','BOL','\x20->\x20','CLIENT_MERCHANT_ID','90300dkMIMg','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','MYS','ESP','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','Email:','GUY','FRA','LKA','not\x20provided','TRY','success','timeout','KHM','IND','POST','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','stringify','processing','successUrl','PENDING','LTU','message','status','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','ITA','LAO','toLowerCase','920830vgCEWJ','expired','QAT','TUR','/status','3150468XzaTwY','verifyWebhookSignature','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','pending','SYR','ampay-try','AUT','MUS','processWebhook','üìä\x20AmPay\x20TRY\x20status\x20response:','SRB','API_PRIVATE_KEY','client_transaction_id','BLR','ZAF','NGA','LIE','GBR','PAK','LBN','tracker_id','20MhgHak','SWE','CZE','BGR','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','PER','11cBSNid','checkPaymentStatus','DEU','Payment\x20URL:','ISR','BEL','defineProperty','MLT','No\x20payment\x20ID\x20in\x20webhook\x20data','Customer\x20Country\x20(3-letter):','redirect_url','EST','HRV','üìä\x20AmPay\x20TRY\x20response\x20data:','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','log','CHE','paid','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','warn','BHR','../loggerService','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','SVK','loggerService','customerCountry','waiting','KWT','1274QWGXHP','MCO','failed','HTTP\x20','ARM','Customer\x20IP:','MKD','SMR','Customer\x20Country\x20(2-letter):','16UgnUuY','ECU','REU','üì•\x20AmPay\x20TRY\x20raw\x20response:','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','Status:','16gShaoL','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','ALB','MOZ','apiUrl','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','VNM','JOR','TrapayAPI/1.0','\x20-\x20','KOR','ROU','COL','ARG','ampay.php','IDN','SYC','firstName','FIN','text','Order\x20ID:','USA',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','AZE','POL','Amount:','IRQ','CYP','amount','Phone:','PAID','PRK','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','KEN','20415UTDvil','toUpperCase','Tracker\x20ID:','currency','error','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','üìä\x20AmPay\x20TRY\x20parsed\x20response:','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','GAM','UGA','MEX','113160hrvvhJ'];a53_0x33f9=function(){return _0x1f4411;};return a53_0x33f9();}const a53_0x22eb4b=a53_0x3934;(function(_0x5bcb75,_0x5c3041){const _0x448825=a53_0x3934,_0x40bc39=_0x5bcb75();while(!![]){try{const _0x4a19f8=parseInt(_0x448825(0x217))/0x1*(parseInt(_0x448825(0x23a))/0x2)+-parseInt(_0x448825(0x207))/0x3*(-parseInt(_0x448825(0x1e5))/0x4)+-parseInt(_0x448825(0x1b4))/0x5*(-parseInt(_0x448825(0x213))/0x6)+parseInt(_0x448825(0x177))/0x7*(-parseInt(_0x448825(0x1df))/0x8)+parseInt(_0x448825(0x19f))/0x9+-parseInt(_0x448825(0x19a))/0xa*(-parseInt(_0x448825(0x1ba))/0xb)+-parseInt(_0x448825(0x17e))/0xc*(parseInt(_0x448825(0x1d6))/0xd);if(_0x4a19f8===_0x5c3041)break;else _0x40bc39['push'](_0x40bc39['shift']());}catch(_0x5c0f82){_0x40bc39['push'](_0x40bc39['shift']());}}}(a53_0x33f9,0x5cfbd));Object[a53_0x22eb4b(0x1c0)](exports,'__esModule',{'value':!![]}),exports[a53_0x22eb4b(0x22b)]=void 0x0;const loggerService_1=require(a53_0x22eb4b(0x1cf));class AmPayTRYService{constructor(){const _0x22f2ce=a53_0x22eb4b;this[_0x22f2ce(0x17d)]='TRAFFER',this[_0x22f2ce(0x238)]='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this[_0x22f2ce(0x1aa)]=_0x22f2ce(0x219),this[_0x22f2ce(0x1e9)]=_0x22f2ce(0x229),console[_0x22f2ce(0x1c9)]('üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing');}['convert2LetterTo3LetterCountryCode'](_0x26e29e){const _0x15855c=a53_0x22eb4b,_0x36ef9e={'AD':_0x15855c(0x21a),'AL':_0x15855c(0x1e7),'AT':_0x15855c(0x1a5),'BA':'BIH','BE':_0x15855c(0x1bf),'BG':_0x15855c(0x1b7),'BY':_0x15855c(0x1ac),'CH':_0x15855c(0x1ca),'CY':_0x15855c(0x200),'CZ':_0x15855c(0x1b6),'DE':_0x15855c(0x1bc),'DK':_0x15855c(0x21e),'EE':_0x15855c(0x1c5),'ES':_0x15855c(0x181),'FI':_0x15855c(0x1f7),'FR':_0x15855c(0x185),'GB':_0x15855c(0x1b0),'GE':_0x15855c(0x234),'GR':'GRC','HR':_0x15855c(0x1c6),'HU':'HUN','IE':'IRL','IS':'ISL','IT':_0x15855c(0x197),'LI':_0x15855c(0x1af),'LT':_0x15855c(0x193),'LU':'LUX','LV':'LVA','MC':_0x15855c(0x1d7),'MD':'MDA','ME':_0x15855c(0x178),'MK':_0x15855c(0x1dc),'MT':_0x15855c(0x1c1),'NL':'NLD','NO':_0x15855c(0x179),'PL':_0x15855c(0x1fd),'PT':'PRT','RO':_0x15855c(0x1f0),'RS':_0x15855c(0x1a9),'RU':_0x15855c(0x214),'SE':_0x15855c(0x1b5),'SI':'SVN','SK':_0x15855c(0x1d1),'SM':_0x15855c(0x1dd),'UA':'UKR','VA':'VAT','XK':_0x15855c(0x21c),'AM':_0x15855c(0x1da),'AZ':_0x15855c(0x1fc),'KZ':_0x15855c(0x230),'KG':_0x15855c(0x237),'TJ':'TJK','TM':_0x15855c(0x21f),'UZ':'UZB','US':_0x15855c(0x1fa),'CA':'CAN','AU':'AUS','JP':_0x15855c(0x232),'CN':_0x15855c(0x221),'IN':_0x15855c(0x18c),'BR':'BRA','MX':_0x15855c(0x212),'AR':_0x15855c(0x1f2),'CL':'CHL','PE':_0x15855c(0x1b9),'CO':_0x15855c(0x1f1),'VE':_0x15855c(0x222),'EC':_0x15855c(0x1e0),'BO':_0x15855c(0x17b),'PY':'PRY','UY':'URY','SR':_0x15855c(0x233),'GY':_0x15855c(0x184),'FK':_0x15855c(0x23b),'ZA':_0x15855c(0x1ad),'EG':_0x15855c(0x220),'NG':_0x15855c(0x1ae),'KE':_0x15855c(0x206),'GH':'GHA','TZ':'TZA','UG':_0x15855c(0x211),'ZW':_0x15855c(0x22c),'ZM':'ZMB','MW':_0x15855c(0x23c),'MZ':_0x15855c(0x1e8),'MG':'MDG','MU':_0x15855c(0x1a6),'SC':_0x15855c(0x1f5),'RE':_0x15855c(0x1e1),'TR':_0x15855c(0x19d),'IR':_0x15855c(0x226),'IQ':_0x15855c(0x1ff),'SA':'SAU','AE':_0x15855c(0x22f),'KW':_0x15855c(0x1d5),'QA':_0x15855c(0x19c),'BH':_0x15855c(0x1ce),'OM':_0x15855c(0x231),'YE':'YEM','JO':_0x15855c(0x1ec),'LB':_0x15855c(0x1b2),'SY':_0x15855c(0x1a3),'IL':_0x15855c(0x1be),'PS':'PSE','KR':_0x15855c(0x1ef),'KP':_0x15855c(0x204),'TH':_0x15855c(0x22e),'VN':_0x15855c(0x1eb),'MY':_0x15855c(0x180),'SG':'SGP','ID':_0x15855c(0x1f4),'PH':'PHL','LA':_0x15855c(0x198),'KH':_0x15855c(0x18b),'MM':_0x15855c(0x236),'BD':'BGD','LK':_0x15855c(0x186),'NP':'NPL','BT':_0x15855c(0x227),'MV':'MDV','AF':_0x15855c(0x224),'PK':_0x15855c(0x1b1),'MN':'MNG'},_0x30145c=_0x36ef9e[_0x26e29e[_0x15855c(0x208)]()];if(!_0x30145c)return console[_0x15855c(0x1cd)]('‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20'+_0x26e29e+_0x15855c(0x1fb)),'TUR';return _0x30145c;}async[a53_0x22eb4b(0x225)](_0x4f0988){const _0x237417=a53_0x22eb4b;console[_0x237417(0x1c9)](_0x237417(0x239),{'paymentId':_0x4f0988[_0x237417(0x174)],'amount':_0x4f0988[_0x237417(0x201)],'currency':_0x4f0988[_0x237417(0x20a)],'customerCountry':_0x4f0988[_0x237417(0x1d3)]});try{const _0x5d3d29={'client_merchant_id':this[_0x237417(0x17d)],'payment_method':'Bank\x20Transfer\x20TR','client_transaction_id':_0x4f0988['orderId'],'amount':_0x4f0988['amount'],'currency':_0x4f0988[_0x237417(0x20a)],'callback_url':_0x237417(0x22d),'tracker_id':_0x4f0988[_0x237417(0x174)],'redirect_url':_0x4f0988[_0x237417(0x191)],'failure_url':_0x4f0988['failureUrl'],'customer_first_name':_0x4f0988[_0x237417(0x1f6)],'customer_last_name':_0x4f0988['lastName'],'customer_email':_0x4f0988['email'],'customer_phone':_0x4f0988[_0x237417(0x235)]||'','customer_ip':_0x4f0988['customerIp'],'customer_country':_0x4f0988[_0x237417(0x1d3)],'api_public_key':this[_0x237417(0x238)]};console[_0x237417(0x1c9)]('üì§\x20AmPay\x20TRY\x20API\x20request\x20data:',JSON[_0x237417(0x18f)](_0x5d3d29,null,0x2));const _0x448f3a=await fetch(this[_0x237417(0x1e9)],{'method':_0x237417(0x18d),'headers':{'Content-Type':'application/json','User-Agent':_0x237417(0x176)},'body':JSON[_0x237417(0x18f)](_0x5d3d29)});console[_0x237417(0x1c9)](_0x237417(0x17f),_0x448f3a[_0x237417(0x195)]);const _0x506564=await _0x448f3a['text']();console[_0x237417(0x1c9)](_0x237417(0x1a1),_0x506564);let _0x40c984;try{_0x40c984=JSON['parse'](_0x506564);}catch(_0x3d71a6){console[_0x237417(0x20b)](_0x237417(0x20e),_0x3d71a6);throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x506564);}console['log'](_0x237417(0x20d),JSON['stringify'](_0x40c984,null,0x2)),loggerService_1['loggerService'][_0x237417(0x218)]('ampay-try',_0x40c984,{});if(!_0x448f3a['ok']){const _0x31a9a5=_0x40c984['error_message']||_0x40c984[_0x237417(0x194)]||_0x237417(0x1d9)+_0x448f3a['status'];console['error']('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x31a9a5);throw new Error('AmPay\x20TRY\x20API\x20error:\x20'+_0x31a9a5);}if(!_0x40c984['redirect_url']){console[_0x237417(0x20b)](_0x237417(0x18e),_0x40c984);throw new Error(_0x237417(0x1e3));}const _0x1ed539={'gateway_payment_id':_0x40c984[_0x237417(0x216)]||_0x4f0988['orderId'],'payment_url':_0x40c984[_0x237417(0x1c4)],'transaction_id':_0x40c984[_0x237417(0x1ab)]};return console[_0x237417(0x1c9)](_0x237417(0x20f),_0x1ed539),_0x1ed539;}catch(_0x46bb61){console[_0x237417(0x20b)](_0x237417(0x205),_0x46bb61),loggerService_1['loggerService']['logWebhookError'](_0x237417(0x1a4),_0x46bb61,_0x4f0988);throw _0x46bb61;}}async['createPaymentLink'](_0x5609cc){const _0x14691e=a53_0x22eb4b;try{const {orderId:_0x193e78,amount:_0x4b4311,currency:_0x308f00,firstName:_0x20e963,lastName:_0x581de6,email:_0x4fc437,phone:_0x5f1ca8,customerIp:_0x4e0c86,customerCountry:_0x3c268b,successUrl:_0x475986,failureUrl:_0x4ae35f}=_0x5609cc;console['log'](_0x14691e(0x1ea)),console[_0x14691e(0x1c9)](_0x14691e(0x1f9),_0x193e78),console[_0x14691e(0x1c9)](_0x14691e(0x1fe),_0x4b4311,_0x308f00),console[_0x14691e(0x1c9)]('Customer:',_0x20e963+'\x20'+_0x581de6),console['log'](_0x14691e(0x183),_0x4fc437),console[_0x14691e(0x1c9)](_0x14691e(0x202),_0x5f1ca8||_0x14691e(0x187)),console[_0x14691e(0x1c9)](_0x14691e(0x1db),_0x4e0c86),console[_0x14691e(0x1c9)](_0x14691e(0x1de),_0x3c268b);const _0x4e0581=this['convert2LetterTo3LetterCountryCode'](_0x3c268b);console[_0x14691e(0x1c9)](_0x14691e(0x1c3),_0x4e0581);const _0x3113bf={'sub_method':_0x14691e(0x210),'currency':_0x308f00[_0x14691e(0x208)](),'amount':_0x4b4311,'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','client_merchant_id':this[_0x14691e(0x17d)],'client_transaction_id':_0x193e78,'transaction_description':_0x193e78,'customer':{'ip':_0x4e0c86,'email':_0x4fc437,'full_name':_0x20e963+'\x20'+_0x581de6,'phone':_0x5f1ca8||'','country':_0x4e0581},'success_redirect_url':_0x475986,'error_redirect_url':_0x4ae35f};console[_0x14691e(0x1c9)]('üì§\x20AmPay\x20TRY\x20request\x20body:',JSON[_0x14691e(0x18f)](_0x3113bf,null,0x2));const _0x585ede=await fetch(this[_0x14691e(0x1e9)]+_0x14691e(0x1f3),{'method':'POST','headers':{'Content-Type':_0x14691e(0x215),'User-Agent':_0x14691e(0x1ed)},'body':JSON[_0x14691e(0x18f)](_0x3113bf)}),_0x329202=await _0x585ede[_0x14691e(0x1f8)]();console[_0x14691e(0x1c9)](_0x14691e(0x1e2),_0x329202);if(!_0x585ede['ok'])throw new Error(_0x14691e(0x196)+_0x585ede[_0x14691e(0x195)]+_0x14691e(0x1ee)+_0x329202);let _0x2b659;try{_0x2b659=JSON[_0x14691e(0x23d)](_0x329202);}catch(_0x3a5860){throw new Error(_0x14691e(0x228)+_0x329202);}console['log'](_0x14691e(0x1c7),JSON[_0x14691e(0x18f)](_0x2b659,null,0x2));if(!_0x2b659[_0x14691e(0x1c4)])throw new Error(_0x14691e(0x1cc)+(_0x2b659['error_message']||_0x2b659['message']||_0x14691e(0x21d)));const _0x39f144=_0x2b659[_0x14691e(0x1c4)],_0x94a1f4=_0x2b659['system_id'],_0x17af1a=_0x2b659[_0x14691e(0x1b3)];return console[_0x14691e(0x1c9)]('‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully'),console[_0x14691e(0x1c9)](_0x14691e(0x1bd),_0x39f144),console['log']('System\x20ID:',_0x94a1f4),console[_0x14691e(0x1c9)](_0x14691e(0x209),_0x17af1a),console[_0x14691e(0x1c9)](_0x14691e(0x1e4),_0x2b659['status']),console[_0x14691e(0x1c9)](_0x14691e(0x1b8)),{'gateway_payment_id':_0x94a1f4||_0x17af1a||_0x193e78,'payment_url':_0x39f144||'','transaction_id':_0x94a1f4};}catch(_0x4e96f2){console['error'](_0x14691e(0x205),_0x4e96f2),console[_0x14691e(0x1c9)](_0x14691e(0x22a)),loggerService_1[_0x14691e(0x1d2)]['logWebhookError'](_0x14691e(0x1a4),_0x4e96f2,_0x5609cc);throw _0x4e96f2;}}async[a53_0x22eb4b(0x1bb)](_0x1f0f30){const _0x1f02aa=a53_0x22eb4b;console['log'](_0x1f02aa(0x21b),_0x1f0f30);try{const _0x16e15a={'client_merchant_id':this[_0x1f02aa(0x17d)],'system_id':_0x1f0f30,'api_public_key':this['API_PUBLIC_KEY']},_0xad542a=await fetch(this[_0x1f02aa(0x1e9)]+_0x1f02aa(0x19e),{'method':_0x1f02aa(0x18d),'headers':{'Content-Type':_0x1f02aa(0x215),'User-Agent':_0x1f02aa(0x176)},'body':JSON[_0x1f02aa(0x18f)](_0x16e15a)}),_0x15e244=await _0xad542a[_0x1f02aa(0x1f8)]();console[_0x1f02aa(0x1c9)](_0x1f02aa(0x1d0),_0x15e244);let _0x344368;try{_0x344368=JSON[_0x1f02aa(0x23d)](_0x15e244);}catch(_0xe5ce27){return console[_0x1f02aa(0x20b)](_0x1f02aa(0x1e6),_0xe5ce27),{'status':_0x1f02aa(0x17a)};}console['log'](_0x1f02aa(0x1a8),JSON[_0x1f02aa(0x18f)](_0x344368,null,0x2));let _0x20b2ea=_0x1f02aa(0x192);if(_0x344368['status'])switch(_0x344368['status'][_0x1f02aa(0x199)]()){case'success':case'completed':case _0x1f02aa(0x1cb):_0x20b2ea=_0x1f02aa(0x203);break;case'failed':case _0x1f02aa(0x20b):case _0x1f02aa(0x223):_0x20b2ea=_0x1f02aa(0x17a);break;case _0x1f02aa(0x19b):case _0x1f02aa(0x18a):_0x20b2ea=_0x1f02aa(0x175);break;case _0x1f02aa(0x1a2):case _0x1f02aa(0x190):case _0x1f02aa(0x1d4):default:_0x20b2ea=_0x1f02aa(0x192);break;}return{'status':_0x20b2ea,'amount':_0x344368['amount'],'currency':_0x344368['currency']};}catch(_0x3069eb){return console[_0x1f02aa(0x20b)]('‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:',_0x3069eb),{'status':_0x1f02aa(0x17a)};}}async[a53_0x22eb4b(0x1a7)](_0x4f3b01){const _0x163fa3=a53_0x22eb4b;console[_0x163fa3(0x1c9)]('üì•\x20Processing\x20AmPay\x20TRY\x20webhook:',JSON[_0x163fa3(0x18f)](_0x4f3b01,null,0x2));try{const _0x1aa953=_0x4f3b01[_0x163fa3(0x1b3)]||_0x4f3b01[_0x163fa3(0x1ab)]||_0x4f3b01[_0x163fa3(0x216)];if(!_0x1aa953){console[_0x163fa3(0x20b)](_0x163fa3(0x1c8));throw new Error(_0x163fa3(0x1c2));}let _0x16e7c0=_0x163fa3(0x192);if(_0x4f3b01[_0x163fa3(0x195)])switch(_0x4f3b01[_0x163fa3(0x195)]['toLowerCase']()){case _0x163fa3(0x189):case'completed':case _0x163fa3(0x1cb):_0x16e7c0=_0x163fa3(0x203);break;case _0x163fa3(0x1d8):case _0x163fa3(0x20b):case _0x163fa3(0x223):_0x16e7c0=_0x163fa3(0x17a);break;case'expired':case'timeout':_0x16e7c0=_0x163fa3(0x175);break;case _0x163fa3(0x1a2):case'processing':case _0x163fa3(0x1d4):default:_0x16e7c0=_0x163fa3(0x192);break;}return console['log']('üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0x1aa953+_0x163fa3(0x17c)+_0x16e7c0),{'paymentId':_0x1aa953,'status':_0x16e7c0,'amount':_0x4f3b01[_0x163fa3(0x201)],'currency':_0x4f3b01[_0x163fa3(0x20a)]||_0x163fa3(0x188)};}catch(_0x3252e7){console[_0x163fa3(0x20b)](_0x163fa3(0x182),_0x3252e7);throw _0x3252e7;}}[a53_0x22eb4b(0x1a0)](_0x174070,_0x3b1ab4){const _0x59af07=a53_0x22eb4b;return console[_0x59af07(0x1c9)](_0x59af07(0x20c)),!![];}}function a53_0x3934(_0x2902d5,_0x5aed18){_0x2902d5=_0x2902d5-0x174;const _0x33f926=a53_0x33f9();let _0x393433=_0x33f926[_0x2902d5];return _0x393433;}exports[a53_0x22eb4b(0x22b)]=AmPayTRYService;