'use strict';const a53_0x2280f4=a53_0xb257;(function(_0x2bb204,_0x516618){const _0x181ac7=a53_0xb257,_0x4eed2b=_0x2bb204();while(!![]){try{const _0x413ea6=parseInt(_0x181ac7(0x165))/0x1*(parseInt(_0x181ac7(0x115))/0x2)+parseInt(_0x181ac7(0x12b))/0x3+parseInt(_0x181ac7(0x183))/0x4*(-parseInt(_0x181ac7(0xfc))/0x5)+parseInt(_0x181ac7(0x192))/0x6*(-parseInt(_0x181ac7(0xfb))/0x7)+parseInt(_0x181ac7(0x158))/0x8*(parseInt(_0x181ac7(0x1b5))/0x9)+-parseInt(_0x181ac7(0x147))/0xa*(parseInt(_0x181ac7(0x13e))/0xb)+parseInt(_0x181ac7(0x104))/0xc;if(_0x413ea6===_0x516618)break;else _0x4eed2b['push'](_0x4eed2b['shift']());}catch(_0xaa2f02){_0x4eed2b['push'](_0x4eed2b['shift']());}}}(a53_0x56fc,0x59a8c));function a53_0x56fc(){const _0x3b1d9a=['DEU','apiUrl','POL','BLR','text','ARM','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','üì•\x20AmPay\x20TRY\x20raw\x20response:','TRAFFER','LIE','SUR','LAO','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','failed','ISL','VEN','TRY','PER','No\x20payment\x20ID\x20in\x20webhook\x20data','AUT','PRY','convert2LetterTo3LetterCountryCode','GHA','523084dqmoae','failureUrl','üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20','AUS','CAN','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','API_PRIVATE_KEY','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','MNE','https://traffer.uk/gateway/ampay-try/','Amount:','timeout','phone','TJK','ZWE','197706wbtJCS','PRT','Status:','TZA','VNM','system_id','GUY','BGD','ARG','pending','createPayment','BHR','FAILED','AFG','Phone:','API_PUBLIC_KEY','parse','amount','/status','HUN','LUX','not\x20provided',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','MWI','PENDING','GRC','IRN','SWE','SYC','TrapayEnd/1.0','declined','ZAF','client_transaction_id','üìä\x20AmPay\x20TRY\x20response\x20data:','message','9zbYLJh','üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:','YEM','FLK','error','completed','KWT','MKD','AmPayTRYService','REU','SGP','MMR','HRV','https://traffer.uk/gateway/ampay-try/webhook.php','tracker_id','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','application/json','Customer\x20Country\x20(3-letter):','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda','URY','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','91gtTAtm','20YDlHOO','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','LKA','BGR','SVK','JPN','NPL','Payment\x20URL:','3954492gbtGPO','log','SVN','KEN','GEO','ampay-try','paid','ALB','loggerService','ECU','IRQ','Customer:','LVA','CLIENT_MERCHANT_ID','BRA','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','LTU','4DGtmXg','customerCountry','‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','TrapayAPI/1.0','GAM','PAID','KAZ','PSE','EST','RUS','TKM','FIN','logWebhookReceived','verifyWebhookSignature','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','toUpperCase','stringify','NOR','paymentId','IRL','processing','USA','1117545VdwMNm','checkPaymentStatus','success','THA','GBR','CHL','currency','VAT','ITA','System\x20ID:','ampay.php','error_message','JOR','CYP','toLowerCase','SMR','logWebhookError','PRK','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','33yznWwJ','ROU','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','status','NLD','__esModule','expired','BIH','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','508040IbgZcR','KOR','MDA','MLT','QAT','IDN','TUR','OMN','Bank\x20Transfer\x20TR','waiting','warn','BOL','lastName','customerIp','orderId','POST','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','4272808DrGaMb','üì§\x20AmPay\x20TRY\x20request\x20body:','KGZ','NGA','MNG','EGY','EXPIRED','Customer\x20Country\x20(2-letter):','üìä\x20AmPay\x20TRY\x20status\x20response:','UGA','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','DNK','MCO','117473IdYuJj','MYS','MUS','redirect_url','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','AZE','MDV'];a53_0x56fc=function(){return _0x3b1d9a;};return a53_0x56fc();}function a53_0xb257(_0x5c464d,_0x5dc89e){_0x5c464d=_0x5c464d-0xe7;const _0x56fc20=a53_0x56fc();let _0xb25719=_0x56fc20[_0x5c464d];return _0xb25719;}Object['defineProperty'](exports,a53_0x2280f4(0x143),{'value':!![]}),exports['AmPayTRYService']=void 0x0;const loggerService_1=require('../loggerService');class AmPayTRYService{constructor(){const _0x3414b6=a53_0x2280f4;this[_0x3414b6(0x111)]=_0x3414b6(0x174),this['API_PUBLIC_KEY']=_0x3414b6(0xf8),this[_0x3414b6(0x189)]='a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815',this[_0x3414b6(0x16d)]=_0x3414b6(0x18c),console[_0x3414b6(0x105)]('üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing');}[a53_0x2280f4(0x181)](_0x4621cd){const _0x28266c=a53_0x2280f4,_0x3270f9={'AD':'AND','AL':_0x28266c(0x10b),'AT':_0x28266c(0x17f),'BA':_0x28266c(0x145),'BE':'BEL','BG':_0x28266c(0xff),'BY':_0x28266c(0x16f),'CH':'CHE','CY':_0x28266c(0x138),'CZ':'CZE','DE':_0x28266c(0x16c),'DK':_0x28266c(0x163),'EE':_0x28266c(0x11d),'ES':'ESP','FI':_0x28266c(0x120),'FR':'FRA','GB':_0x28266c(0x12f),'GE':_0x28266c(0x108),'GR':_0x28266c(0x1ab),'HR':_0x28266c(0xf1),'HU':_0x28266c(0x1a5),'IE':_0x28266c(0x128),'IS':_0x28266c(0x17a),'IT':_0x28266c(0x133),'LI':_0x28266c(0x175),'LT':_0x28266c(0x114),'LU':_0x28266c(0x1a6),'LV':_0x28266c(0x110),'MC':_0x28266c(0x164),'MD':_0x28266c(0x149),'ME':_0x28266c(0x18b),'MK':_0x28266c(0xec),'MT':_0x28266c(0x14a),'NL':_0x28266c(0x142),'NO':_0x28266c(0x126),'PL':_0x28266c(0x16e),'PT':_0x28266c(0x193),'RO':_0x28266c(0x13f),'RS':'SRB','RU':_0x28266c(0x11e),'SE':_0x28266c(0x1ad),'SI':_0x28266c(0x106),'SK':_0x28266c(0x100),'SM':_0x28266c(0x13a),'UA':'UKR','VA':_0x28266c(0x132),'XK':'XKX','AM':_0x28266c(0x171),'AZ':_0x28266c(0x16a),'KZ':_0x28266c(0x11b),'KG':_0x28266c(0x15a),'TJ':_0x28266c(0x190),'TM':_0x28266c(0x11f),'UZ':'UZB','US':_0x28266c(0x12a),'CA':_0x28266c(0x187),'AU':_0x28266c(0x186),'JP':_0x28266c(0x101),'CN':'CHN','IN':'IND','BR':_0x28266c(0x112),'MX':'MEX','AR':_0x28266c(0x19a),'CL':_0x28266c(0x130),'PE':_0x28266c(0x17d),'CO':'COL','VE':_0x28266c(0x17b),'EC':_0x28266c(0x10d),'BO':_0x28266c(0x152),'PY':_0x28266c(0x180),'UY':_0x28266c(0xf9),'SR':_0x28266c(0x176),'GY':_0x28266c(0x198),'FK':_0x28266c(0xe8),'ZA':_0x28266c(0x1b1),'EG':_0x28266c(0x15d),'NG':_0x28266c(0x15b),'KE':_0x28266c(0x107),'GH':_0x28266c(0x182),'TZ':_0x28266c(0x195),'UG':_0x28266c(0x161),'ZW':_0x28266c(0x191),'ZM':'ZMB','MW':_0x28266c(0x1a9),'MZ':'MOZ','MG':'MDG','MU':_0x28266c(0x167),'SC':_0x28266c(0x1ae),'RE':_0x28266c(0xee),'TR':_0x28266c(0x14d),'IR':_0x28266c(0x1ac),'IQ':_0x28266c(0x10e),'SA':'SAU','AE':'ARE','KW':_0x28266c(0xeb),'QA':_0x28266c(0x14b),'BH':_0x28266c(0x19d),'OM':_0x28266c(0x14e),'YE':_0x28266c(0xe7),'JO':_0x28266c(0x137),'LB':'LBN','SY':'SYR','IL':'ISR','PS':_0x28266c(0x11c),'KR':_0x28266c(0x148),'KP':_0x28266c(0x13c),'TH':_0x28266c(0x12e),'VN':_0x28266c(0x196),'MY':_0x28266c(0x166),'SG':_0x28266c(0xef),'ID':_0x28266c(0x14c),'PH':'PHL','LA':_0x28266c(0x177),'KH':'KHM','MM':_0x28266c(0xf0),'BD':_0x28266c(0x199),'LK':_0x28266c(0xfe),'NP':_0x28266c(0x102),'BT':'BTN','MV':_0x28266c(0x16b),'AF':_0x28266c(0x19f),'PK':'PAK','MN':_0x28266c(0x15c)},_0x2e8715=_0x3270f9[_0x4621cd[_0x28266c(0x124)]()];if(!_0x2e8715)return console[_0x28266c(0x151)]('‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20'+_0x4621cd+_0x28266c(0x1a8)),_0x28266c(0x14d);return _0x2e8715;}async[a53_0x2280f4(0x19c)](_0x36353f){const _0x4866b6=a53_0x2280f4;console[_0x4866b6(0x105)](_0x4866b6(0x157),{'paymentId':_0x36353f[_0x4866b6(0x127)],'amount':_0x36353f[_0x4866b6(0x1a3)],'currency':_0x36353f[_0x4866b6(0x131)],'customerCountry':_0x36353f[_0x4866b6(0x116)]});try{const _0x378492={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'payment_method':_0x4866b6(0x14f),'client_transaction_id':_0x36353f[_0x4866b6(0x155)],'amount':_0x36353f[_0x4866b6(0x1a3)],'currency':_0x36353f[_0x4866b6(0x131)],'callback_url':_0x4866b6(0xf2),'tracker_id':_0x36353f[_0x4866b6(0x127)],'redirect_url':_0x36353f['successUrl'],'failure_url':_0x36353f[_0x4866b6(0x184)],'customer_first_name':_0x36353f['firstName'],'customer_last_name':_0x36353f[_0x4866b6(0x153)],'customer_email':_0x36353f['email'],'customer_phone':_0x36353f[_0x4866b6(0x18f)]||'','customer_ip':_0x36353f[_0x4866b6(0x154)],'customer_country':_0x36353f[_0x4866b6(0x116)],'api_public_key':this[_0x4866b6(0x1a1)]};console[_0x4866b6(0x105)]('üì§\x20AmPay\x20TRY\x20API\x20request\x20data:',JSON[_0x4866b6(0x125)](_0x378492,null,0x2));const _0x1a1097=await fetch(this[_0x4866b6(0x16d)],{'method':_0x4866b6(0x156),'headers':{'Content-Type':_0x4866b6(0xf5),'User-Agent':'TrapayEnd/1.0'},'body':JSON[_0x4866b6(0x125)](_0x378492)});console['log'](_0x4866b6(0xfd),_0x1a1097[_0x4866b6(0x141)]);const _0x4197db=await _0x1a1097[_0x4866b6(0x170)]();console[_0x4866b6(0x105)](_0x4866b6(0x18a),_0x4197db);let _0xaff295;try{_0xaff295=JSON[_0x4866b6(0x1a2)](_0x4197db);}catch(_0x4024c3){console[_0x4866b6(0xe9)](_0x4866b6(0x123),_0x4024c3);throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x4197db);}console[_0x4866b6(0x105)]('üìä\x20AmPay\x20TRY\x20parsed\x20response:',JSON['stringify'](_0xaff295,null,0x2)),loggerService_1[_0x4866b6(0x10c)][_0x4866b6(0x121)](_0x4866b6(0x109),_0xaff295,{});if(!_0x1a1097['ok']){const _0x3e8efa=_0xaff295[_0x4866b6(0x136)]||_0xaff295[_0x4866b6(0x1b4)]||'HTTP\x20'+_0x1a1097[_0x4866b6(0x141)];console['error']('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x3e8efa);throw new Error('AmPay\x20TRY\x20API\x20error:\x20'+_0x3e8efa);}if(!_0xaff295[_0x4866b6(0x168)]){console[_0x4866b6(0xe9)]('‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:',_0xaff295);throw new Error(_0x4866b6(0x162));}const _0x28ece2={'gateway_payment_id':_0xaff295[_0x4866b6(0x197)]||_0x36353f['orderId'],'payment_url':_0xaff295[_0x4866b6(0x168)],'transaction_id':_0xaff295[_0x4866b6(0x1b2)]};return console[_0x4866b6(0x105)]('‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:',_0x28ece2),_0x28ece2;}catch(_0x4fc10d){console['error'](_0x4866b6(0x146),_0x4fc10d),loggerService_1[_0x4866b6(0x10c)][_0x4866b6(0x13b)]('ampay-try',_0x4fc10d,_0x36353f);throw _0x4fc10d;}}async['createPaymentLink'](_0x14ec90){const _0x21ccfb=a53_0x2280f4;try{const {orderId:_0x45c9ce,amount:_0x1aa54e,currency:_0x4c7c45,firstName:_0x54fb21,lastName:_0x54d063,email:_0x321f03,phone:_0xdeea0f,customerIp:_0xa4ae6c,customerCountry:_0x28a28a,successUrl:_0x1a6424,failureUrl:_0x369c4d}=_0x14ec90;console[_0x21ccfb(0x105)](_0x21ccfb(0x140)),console[_0x21ccfb(0x105)]('Order\x20ID:',_0x45c9ce),console[_0x21ccfb(0x105)](_0x21ccfb(0x18d),_0x1aa54e,_0x4c7c45),console[_0x21ccfb(0x105)](_0x21ccfb(0x10f),_0x54fb21+'\x20'+_0x54d063),console[_0x21ccfb(0x105)]('Email:',_0x321f03),console[_0x21ccfb(0x105)](_0x21ccfb(0x1a0),_0xdeea0f||_0x21ccfb(0x1a7)),console['log']('Customer\x20IP:',_0xa4ae6c),console[_0x21ccfb(0x105)](_0x21ccfb(0x15f),_0x28a28a);const _0x2cf9b8=this['convert2LetterTo3LetterCountryCode'](_0x28a28a);console['log'](_0x21ccfb(0xf6),_0x2cf9b8);const _0x3a8c22={'sub_method':_0x21ccfb(0x119),'currency':_0x4c7c45[_0x21ccfb(0x124)](),'amount':_0x1aa54e,'callback_url':_0x21ccfb(0xf2),'client_merchant_id':this['CLIENT_MERCHANT_ID'],'client_transaction_id':_0x45c9ce,'transaction_description':_0x45c9ce,'customer':{'ip':_0xa4ae6c,'email':_0x321f03,'full_name':_0x54fb21+'\x20'+_0x54d063,'phone':_0xdeea0f||'','country':_0x2cf9b8},'success_redirect_url':_0x1a6424,'error_redirect_url':_0x369c4d};console['log'](_0x21ccfb(0x159),JSON['stringify'](_0x3a8c22,null,0x2));const _0x36bafa=await fetch(this[_0x21ccfb(0x16d)]+_0x21ccfb(0x135),{'method':_0x21ccfb(0x156),'headers':{'Content-Type':_0x21ccfb(0xf5),'User-Agent':_0x21ccfb(0x118)},'body':JSON[_0x21ccfb(0x125)](_0x3a8c22)}),_0x43e493=await _0x36bafa[_0x21ccfb(0x170)]();console[_0x21ccfb(0x105)](_0x21ccfb(0x173),_0x43e493);if(!_0x36bafa['ok'])throw new Error(_0x21ccfb(0x188)+_0x36bafa[_0x21ccfb(0x141)]+'\x20-\x20'+_0x43e493);let _0x2ba9c3;try{_0x2ba9c3=JSON[_0x21ccfb(0x1a2)](_0x43e493);}catch(_0x532877){throw new Error(_0x21ccfb(0xfa)+_0x43e493);}console[_0x21ccfb(0x105)](_0x21ccfb(0x1b3),JSON[_0x21ccfb(0x125)](_0x2ba9c3,null,0x2));if(!_0x2ba9c3[_0x21ccfb(0x168)])throw new Error(_0x21ccfb(0xf7)+(_0x2ba9c3[_0x21ccfb(0x136)]||_0x2ba9c3[_0x21ccfb(0x1b4)]||'Unknown\x20error'));const _0x372bd3=_0x2ba9c3['redirect_url'],_0x2e76fa=_0x2ba9c3[_0x21ccfb(0x197)],_0x5847cf=_0x2ba9c3[_0x21ccfb(0xf3)];return console[_0x21ccfb(0x105)](_0x21ccfb(0x117)),console['log'](_0x21ccfb(0x103),_0x372bd3),console[_0x21ccfb(0x105)](_0x21ccfb(0x134),_0x2e76fa),console['log']('Tracker\x20ID:',_0x5847cf),console['log'](_0x21ccfb(0x194),_0x2ba9c3[_0x21ccfb(0x141)]),console['log']('üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...'),{'gateway_payment_id':_0x2e76fa||_0x5847cf||_0x45c9ce,'payment_url':_0x372bd3||'','transaction_id':_0x2e76fa};}catch(_0x3d09c6){console[_0x21ccfb(0xe9)](_0x21ccfb(0x146),_0x3d09c6),console[_0x21ccfb(0x105)](_0x21ccfb(0x169)),loggerService_1[_0x21ccfb(0x10c)][_0x21ccfb(0x13b)](_0x21ccfb(0x109),_0x3d09c6,_0x14ec90);throw _0x3d09c6;}}async[a53_0x2280f4(0x12c)](_0x1f16a2){const _0x279711=a53_0x2280f4;console[_0x279711(0x105)](_0x279711(0xf4),_0x1f16a2);try{const _0x300ef0={'client_merchant_id':this[_0x279711(0x111)],'system_id':_0x1f16a2,'api_public_key':this[_0x279711(0x1a1)]},_0x48b5cb=await fetch(this[_0x279711(0x16d)]+_0x279711(0x1a4),{'method':_0x279711(0x156),'headers':{'Content-Type':_0x279711(0xf5),'User-Agent':_0x279711(0x1af)},'body':JSON[_0x279711(0x125)](_0x300ef0)}),_0x3f19b4=await _0x48b5cb[_0x279711(0x170)]();console['log'](_0x279711(0x1b6),_0x3f19b4);let _0x2ce8a8;try{_0x2ce8a8=JSON[_0x279711(0x1a2)](_0x3f19b4);}catch(_0xcf6207){return console[_0x279711(0xe9)](_0x279711(0x178),_0xcf6207),{'status':_0x279711(0x19e)};}console[_0x279711(0x105)](_0x279711(0x160),JSON['stringify'](_0x2ce8a8,null,0x2));let _0xc6ea69=_0x279711(0x1aa);if(_0x2ce8a8['status'])switch(_0x2ce8a8[_0x279711(0x141)]['toLowerCase']()){case _0x279711(0x12d):case _0x279711(0xea):case'paid':_0xc6ea69=_0x279711(0x11a);break;case'failed':case'error':case'declined':_0xc6ea69=_0x279711(0x19e);break;case _0x279711(0x144):case _0x279711(0x18e):_0xc6ea69=_0x279711(0x15e);break;case _0x279711(0x19b):case _0x279711(0x129):case _0x279711(0x150):default:_0xc6ea69=_0x279711(0x1aa);break;}return{'status':_0xc6ea69,'amount':_0x2ce8a8['amount'],'currency':_0x2ce8a8[_0x279711(0x131)]};}catch(_0x4d9508){return console[_0x279711(0xe9)]('‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:',_0x4d9508),{'status':'FAILED'};}}async['processWebhook'](_0x4fe9bb){const _0x593208=a53_0x2280f4;console[_0x593208(0x105)](_0x593208(0x172),JSON['stringify'](_0x4fe9bb,null,0x2));try{const _0x2ec5f5=_0x4fe9bb[_0x593208(0xf3)]||_0x4fe9bb[_0x593208(0x1b2)]||_0x4fe9bb[_0x593208(0x197)];if(!_0x2ec5f5){console[_0x593208(0xe9)](_0x593208(0x113));throw new Error(_0x593208(0x17e));}let _0x1d467=_0x593208(0x1aa);if(_0x4fe9bb[_0x593208(0x141)])switch(_0x4fe9bb[_0x593208(0x141)][_0x593208(0x139)]()){case'success':case _0x593208(0xea):case _0x593208(0x10a):_0x1d467='PAID';break;case _0x593208(0x179):case _0x593208(0xe9):case _0x593208(0x1b0):_0x1d467=_0x593208(0x19e);break;case _0x593208(0x144):case _0x593208(0x18e):_0x1d467=_0x593208(0x15e);break;case _0x593208(0x19b):case _0x593208(0x129):case _0x593208(0x150):default:_0x1d467=_0x593208(0x1aa);break;}return console[_0x593208(0x105)](_0x593208(0x185)+_0x2ec5f5+'\x20->\x20'+_0x1d467),{'paymentId':_0x2ec5f5,'status':_0x1d467,'amount':_0x4fe9bb['amount'],'currency':_0x4fe9bb[_0x593208(0x131)]||_0x593208(0x17c)};}catch(_0x31e09d){console[_0x593208(0xe9)]('‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:',_0x31e09d);throw _0x31e09d;}}[a53_0x2280f4(0x122)](_0x5935eb,_0x59b676){const _0x450ed1=a53_0x2280f4;return console[_0x450ed1(0x105)](_0x450ed1(0x13d)),!![];}}exports[a53_0x2280f4(0xed)]=AmPayTRYService;