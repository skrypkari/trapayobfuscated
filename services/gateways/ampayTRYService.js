'use strict';const a45_0x315de1=a45_0x3af4;(function(_0x39c7b2,_0x1728d0){const _0x504a4d=a45_0x3af4,_0x268533=_0x39c7b2();while(!![]){try{const _0x20330b=parseInt(_0x504a4d(0x1cc))/0x1*(parseInt(_0x504a4d(0x26b))/0x2)+parseInt(_0x504a4d(0x1c7))/0x3*(parseInt(_0x504a4d(0x1cb))/0x4)+-parseInt(_0x504a4d(0x233))/0x5*(parseInt(_0x504a4d(0x1ce))/0x6)+parseInt(_0x504a4d(0x1dd))/0x7+-parseInt(_0x504a4d(0x1fc))/0x8*(parseInt(_0x504a4d(0x20c))/0x9)+-parseInt(_0x504a4d(0x1fb))/0xa+-parseInt(_0x504a4d(0x23c))/0xb*(-parseInt(_0x504a4d(0x239))/0xc);if(_0x20330b===_0x1728d0)break;else _0x268533['push'](_0x268533['shift']());}catch(_0x378c1c){_0x268533['push'](_0x268533['shift']());}}}(a45_0x42e4,0xe97fa));Object[a45_0x315de1(0x207)](exports,a45_0x315de1(0x258),{'value':!![]}),exports[a45_0x315de1(0x1cf)]=void 0x0;const loggerService_1=require('../loggerService');class AmPayTRYService{constructor(){const _0x278cfa=a45_0x315de1;this['CLIENT_MERCHANT_ID']=_0x278cfa(0x27d),this[_0x278cfa(0x21c)]='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this[_0x278cfa(0x1d0)]='a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815',this[_0x278cfa(0x249)]=_0x278cfa(0x1d2),console[_0x278cfa(0x280)](_0x278cfa(0x1f5));}['convert2LetterTo3LetterCountryCode'](_0xb0233){const _0x37068e=a45_0x315de1,_0x4d87da={'AD':'AND','AL':'ALB','AT':_0x37068e(0x287),'BA':_0x37068e(0x25f),'BE':_0x37068e(0x1fe),'BG':'BGR','BY':_0x37068e(0x21b),'CH':_0x37068e(0x234),'CY':'CYP','CZ':_0x37068e(0x216),'DE':_0x37068e(0x213),'DK':_0x37068e(0x22f),'EE':_0x37068e(0x20b),'ES':_0x37068e(0x254),'FI':'FIN','FR':_0x37068e(0x21d),'GB':_0x37068e(0x1fa),'GE':_0x37068e(0x224),'GR':_0x37068e(0x283),'HR':_0x37068e(0x285),'HU':_0x37068e(0x23e),'IE':_0x37068e(0x25a),'IS':'ISL','IT':'ITA','LI':_0x37068e(0x24e),'LT':_0x37068e(0x265),'LU':_0x37068e(0x27a),'LV':_0x37068e(0x203),'MC':_0x37068e(0x1bc),'MD':_0x37068e(0x1f2),'ME':'MNE','MK':_0x37068e(0x264),'MT':_0x37068e(0x22d),'NL':'NLD','NO':_0x37068e(0x232),'PL':'POL','PT':_0x37068e(0x1f4),'RO':_0x37068e(0x262),'RS':_0x37068e(0x205),'RU':_0x37068e(0x243),'SE':_0x37068e(0x218),'SI':_0x37068e(0x23f),'SK':_0x37068e(0x210),'SM':_0x37068e(0x229),'UA':_0x37068e(0x248),'VA':_0x37068e(0x237),'XK':_0x37068e(0x1c9),'AM':_0x37068e(0x244),'AZ':_0x37068e(0x252),'KZ':'KAZ','KG':_0x37068e(0x219),'TJ':_0x37068e(0x25d),'TM':_0x37068e(0x255),'UZ':_0x37068e(0x27b),'US':_0x37068e(0x24b),'CA':_0x37068e(0x206),'AU':_0x37068e(0x271),'JP':'JPN','CN':_0x37068e(0x26f),'IN':_0x37068e(0x27f),'BR':'BRA','MX':_0x37068e(0x26d),'AR':'ARG','CL':'CHL','PE':'PER','CO':'COL','VE':_0x37068e(0x1f9),'EC':'ECU','BO':_0x37068e(0x273),'PY':_0x37068e(0x22b),'UY':_0x37068e(0x1f1),'SR':_0x37068e(0x1e8),'GY':_0x37068e(0x1c1),'FK':_0x37068e(0x236),'ZA':_0x37068e(0x274),'EG':_0x37068e(0x269),'NG':_0x37068e(0x1d6),'KE':_0x37068e(0x1ec),'GH':_0x37068e(0x1eb),'TZ':_0x37068e(0x1ca),'UG':_0x37068e(0x275),'ZW':'ZWE','ZM':_0x37068e(0x286),'MW':'MWI','MZ':_0x37068e(0x23a),'MG':_0x37068e(0x1c6),'MU':_0x37068e(0x242),'SC':_0x37068e(0x222),'RE':_0x37068e(0x1e9),'TR':_0x37068e(0x1da),'IR':_0x37068e(0x25e),'IQ':'IRQ','SA':_0x37068e(0x1e6),'AE':_0x37068e(0x1c8),'KW':_0x37068e(0x247),'QA':'QAT','BH':_0x37068e(0x26e),'OM':_0x37068e(0x221),'YE':_0x37068e(0x1d8),'JO':_0x37068e(0x1d4),'LB':_0x37068e(0x22c),'SY':_0x37068e(0x260),'IL':_0x37068e(0x217),'PS':_0x37068e(0x223),'KR':_0x37068e(0x211),'KP':'PRK','TH':'THA','VN':_0x37068e(0x268),'MY':'MYS','SG':_0x37068e(0x1e3),'ID':_0x37068e(0x1f7),'PH':_0x37068e(0x245),'LA':_0x37068e(0x1f6),'KH':_0x37068e(0x238),'MM':_0x37068e(0x227),'BD':_0x37068e(0x20e),'LK':_0x37068e(0x1be),'NP':_0x37068e(0x26a),'BT':'BTN','MV':_0x37068e(0x1c4),'AF':_0x37068e(0x1db),'PK':'PAK','MN':_0x37068e(0x270)},_0x3770ba=_0x4d87da[_0xb0233[_0x37068e(0x215)]()];if(!_0x3770ba)return console['warn'](_0x37068e(0x1c2)+_0xb0233+',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY'),_0x37068e(0x1da);return _0x3770ba;}async[a45_0x315de1(0x257)](_0x2991d8){const _0x36b38a=a45_0x315de1;console[_0x36b38a(0x280)](_0x36b38a(0x261),{'paymentId':_0x2991d8['paymentId'],'amount':_0x2991d8[_0x36b38a(0x1f0)],'currency':_0x2991d8[_0x36b38a(0x1e1)],'customerCountry':_0x2991d8['customerCountry']});try{const _0x40f863={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'payment_method':_0x36b38a(0x209),'client_transaction_id':_0x2991d8['orderId'],'amount':_0x2991d8[_0x36b38a(0x1f0)],'currency':_0x2991d8['currency'],'callback_url':_0x36b38a(0x284),'tracker_id':_0x2991d8[_0x36b38a(0x230)],'redirect_url':_0x2991d8[_0x36b38a(0x25b)],'failure_url':_0x2991d8[_0x36b38a(0x26c)],'customer_first_name':_0x2991d8[_0x36b38a(0x20f)],'customer_last_name':_0x2991d8[_0x36b38a(0x240)],'customer_email':_0x2991d8[_0x36b38a(0x1e2)],'customer_phone':_0x2991d8['phone']||'','customer_ip':_0x2991d8[_0x36b38a(0x281)],'customer_country':_0x2991d8['customerCountry'],'api_public_key':this[_0x36b38a(0x21c)]};console[_0x36b38a(0x280)]('üì§\x20AmPay\x20TRY\x20API\x20request\x20data:',JSON[_0x36b38a(0x1f8)](_0x40f863,null,0x2));const _0x27ff07=await fetch(this[_0x36b38a(0x249)],{'method':'POST','headers':{'Content-Type':_0x36b38a(0x1ee),'User-Agent':_0x36b38a(0x1c5)},'body':JSON[_0x36b38a(0x1f8)](_0x40f863)});console[_0x36b38a(0x280)]('üì°\x20AmPay\x20TRY\x20API\x20response\x20status:',_0x27ff07['status']);const _0x4fd985=await _0x27ff07['text']();console['log'](_0x36b38a(0x24d),_0x4fd985);let _0x4edcfe;try{_0x4edcfe=JSON['parse'](_0x4fd985);}catch(_0x4e86f9){console[_0x36b38a(0x1ff)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:',_0x4e86f9);throw new Error(_0x36b38a(0x21e)+_0x4fd985);}console['log'](_0x36b38a(0x278),JSON['stringify'](_0x4edcfe,null,0x2)),loggerService_1[_0x36b38a(0x22e)][_0x36b38a(0x21f)](_0x36b38a(0x276),_0x4edcfe,{});if(!_0x27ff07['ok']){const _0x56bf2b=_0x4edcfe['error_message']||_0x4edcfe[_0x36b38a(0x241)]||_0x36b38a(0x1d3)+_0x27ff07[_0x36b38a(0x208)];console[_0x36b38a(0x1ff)]('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x56bf2b);throw new Error(_0x36b38a(0x266)+_0x56bf2b);}if(!_0x4edcfe[_0x36b38a(0x1e5)]){console['error'](_0x36b38a(0x1f3),_0x4edcfe);throw new Error('AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL');}const _0x1d4f1c={'gateway_payment_id':_0x4edcfe[_0x36b38a(0x250)]||_0x2991d8[_0x36b38a(0x220)],'payment_url':_0x4edcfe[_0x36b38a(0x1e5)],'transaction_id':_0x4edcfe[_0x36b38a(0x1cd)]};return console[_0x36b38a(0x280)](_0x36b38a(0x1c3),_0x1d4f1c),_0x1d4f1c;}catch(_0x1c04df){console[_0x36b38a(0x1ff)](_0x36b38a(0x1ef),_0x1c04df),loggerService_1[_0x36b38a(0x22e)][_0x36b38a(0x1d9)](_0x36b38a(0x276),_0x1c04df,_0x2991d8);throw _0x1c04df;}}async['createPaymentLink'](_0x43e0d5){const _0x336f5f=a45_0x315de1;try{const {orderId:_0x220af5,amount:_0x14aa9f,currency:_0x3512ac,firstName:_0xf7d752,lastName:_0x434470,email:_0x5befee,customerIp:_0x52ad33,customerCountry:_0x5c98b5,successUrl:_0x43cf06,failureUrl:_0xec6f9b}=_0x43e0d5;console['log'](_0x336f5f(0x1bf)),console[_0x336f5f(0x280)](_0x336f5f(0x24a),_0x220af5),console[_0x336f5f(0x280)](_0x336f5f(0x1dc),_0x14aa9f,_0x3512ac),console[_0x336f5f(0x280)]('Customer:',_0xf7d752+'\x20'+_0x434470),console['log'](_0x336f5f(0x24f),_0x5befee),console['log'](_0x336f5f(0x1d1),_0x52ad33),console['log']('Customer\x20Country\x20(2-letter):',_0x5c98b5);const _0xa7991f=this['convert2LetterTo3LetterCountryCode'](_0x5c98b5);console[_0x336f5f(0x280)](_0x336f5f(0x1ea),_0xa7991f);const _0x95848d={'sub_method':_0x336f5f(0x1ba),'currency':_0x3512ac[_0x336f5f(0x215)](),'amount':_0x14aa9f,'callback_url':_0x336f5f(0x1b9),'client_merchant_id':this[_0x336f5f(0x253)],'client_transaction_id':_0x220af5,'transaction_description':_0x220af5,'customer':{'ip':_0x52ad33,'email':_0x5befee,'full_name':_0xf7d752+'\x20'+_0x434470,'country':_0xa7991f},'success_redirect_url':_0x43cf06,'error_redirect_url':_0xec6f9b};console[_0x336f5f(0x280)](_0x336f5f(0x1ed),JSON[_0x336f5f(0x1f8)](_0x95848d,null,0x2));const _0x166416=await fetch(this[_0x336f5f(0x249)]+'ampay.php',{'method':_0x336f5f(0x282),'headers':{'Content-Type':_0x336f5f(0x1ee),'User-Agent':_0x336f5f(0x231)},'body':JSON['stringify'](_0x95848d)}),_0x2f3f76=await _0x166416[_0x336f5f(0x1de)]();console[_0x336f5f(0x280)]('üì•\x20AmPay\x20TRY\x20raw\x20response:',_0x2f3f76);if(!_0x166416['ok'])throw new Error(_0x336f5f(0x20a)+_0x166416[_0x336f5f(0x208)]+_0x336f5f(0x246)+_0x2f3f76);let _0x29a94c;try{_0x29a94c=JSON[_0x336f5f(0x22a)](_0x2f3f76);}catch(_0x4360a2){throw new Error(_0x336f5f(0x21e)+_0x2f3f76);}console[_0x336f5f(0x280)](_0x336f5f(0x259),JSON[_0x336f5f(0x1f8)](_0x29a94c,null,0x2));if(!_0x29a94c[_0x336f5f(0x1e5)])throw new Error(_0x336f5f(0x1d7)+(_0x29a94c[_0x336f5f(0x235)]||_0x29a94c['message']||_0x336f5f(0x1df)));const _0x4cfa68=_0x29a94c[_0x336f5f(0x1e5)],_0x2b588e=_0x29a94c[_0x336f5f(0x250)],_0xf581bc=_0x29a94c[_0x336f5f(0x204)];return console[_0x336f5f(0x280)](_0x336f5f(0x1c0)),console[_0x336f5f(0x280)](_0x336f5f(0x23d),_0x4cfa68),console[_0x336f5f(0x280)](_0x336f5f(0x277),_0x2b588e),console[_0x336f5f(0x280)](_0x336f5f(0x267),_0xf581bc),console[_0x336f5f(0x280)]('Status:',_0x29a94c[_0x336f5f(0x208)]),console[_0x336f5f(0x280)]('üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...'),{'gateway_payment_id':_0x2b588e||_0xf581bc||_0x220af5,'payment_url':_0x4cfa68||'','transaction_id':_0x2b588e};}catch(_0x1017c9){console[_0x336f5f(0x1ff)](_0x336f5f(0x1ef),_0x1017c9),console['log'](_0x336f5f(0x27e)),loggerService_1[_0x336f5f(0x22e)][_0x336f5f(0x1d9)](_0x336f5f(0x276),_0x1017c9,_0x43e0d5);throw _0x1017c9;}}async[a45_0x315de1(0x201)](_0x4014aa){const _0x1cb1a2=a45_0x315de1;console[_0x1cb1a2(0x280)](_0x1cb1a2(0x256),_0x4014aa);try{const _0x2f6714={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'system_id':_0x4014aa,'api_public_key':this[_0x1cb1a2(0x21c)]},_0x26bb86=await fetch(this['apiUrl']+_0x1cb1a2(0x1e4),{'method':_0x1cb1a2(0x282),'headers':{'Content-Type':'application/json','User-Agent':_0x1cb1a2(0x1c5)},'body':JSON[_0x1cb1a2(0x1f8)](_0x2f6714)}),_0x57260b=await _0x26bb86[_0x1cb1a2(0x1de)]();console[_0x1cb1a2(0x280)]('üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:',_0x57260b);let _0x28026c;try{_0x28026c=JSON[_0x1cb1a2(0x22a)](_0x57260b);}catch(_0x10be98){return console[_0x1cb1a2(0x1ff)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:',_0x10be98),{'status':_0x1cb1a2(0x200)};}console[_0x1cb1a2(0x280)]('üìä\x20AmPay\x20TRY\x20status\x20response:',JSON[_0x1cb1a2(0x1f8)](_0x28026c,null,0x2));let _0x5daa32=_0x1cb1a2(0x20d);if(_0x28026c['status'])switch(_0x28026c[_0x1cb1a2(0x208)][_0x1cb1a2(0x251)]()){case _0x1cb1a2(0x1bb):case _0x1cb1a2(0x202):case _0x1cb1a2(0x212):_0x5daa32=_0x1cb1a2(0x1bd);break;case _0x1cb1a2(0x21a):case'error':case _0x1cb1a2(0x1e7):_0x5daa32=_0x1cb1a2(0x200);break;case'expired':case'timeout':_0x5daa32=_0x1cb1a2(0x272);break;case _0x1cb1a2(0x279):case'processing':case _0x1cb1a2(0x226):default:_0x5daa32='PENDING';break;}return{'status':_0x5daa32,'amount':_0x28026c['amount'],'currency':_0x28026c[_0x1cb1a2(0x1e1)]};}catch(_0xfc0edc){return console[_0x1cb1a2(0x1ff)](_0x1cb1a2(0x24c),_0xfc0edc),{'status':_0x1cb1a2(0x200)};}}async['processWebhook'](_0x974649){const _0x345d48=a45_0x315de1;console[_0x345d48(0x280)](_0x345d48(0x225),JSON[_0x345d48(0x1f8)](_0x974649,null,0x2));try{const _0x27d61f=_0x974649['tracker_id']||_0x974649[_0x345d48(0x1cd)]||_0x974649[_0x345d48(0x250)];if(!_0x27d61f){console[_0x345d48(0x1ff)]('‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data');throw new Error(_0x345d48(0x228));}let _0x2d9daf='PENDING';if(_0x974649[_0x345d48(0x208)])switch(_0x974649['status']['toLowerCase']()){case _0x345d48(0x1bb):case _0x345d48(0x202):case'paid':_0x2d9daf=_0x345d48(0x1bd);break;case _0x345d48(0x21a):case _0x345d48(0x1ff):case _0x345d48(0x1e7):_0x2d9daf='FAILED';break;case'expired':case _0x345d48(0x214):_0x2d9daf='EXPIRED';break;case _0x345d48(0x279):case _0x345d48(0x1fd):case'waiting':default:_0x2d9daf=_0x345d48(0x20d);break;}return console['log'](_0x345d48(0x27c)+_0x27d61f+_0x345d48(0x1e0)+_0x2d9daf),{'paymentId':_0x27d61f,'status':_0x2d9daf,'amount':_0x974649[_0x345d48(0x1f0)],'currency':_0x974649[_0x345d48(0x1e1)]||_0x345d48(0x25c)};}catch(_0x2e2320){console['error'](_0x345d48(0x1d5),_0x2e2320);throw _0x2e2320;}}[a45_0x315de1(0x23b)](_0xccc1d4,_0x4c7df2){const _0x57db17=a45_0x315de1;return console[_0x57db17(0x280)](_0x57db17(0x263)),!![];}}function a45_0x3af4(_0x5a0321,_0xead65c){const _0x42e400=a45_0x42e4();return a45_0x3af4=function(_0x3af413,_0x466626){_0x3af413=_0x3af413-0x1b9;let _0xcb9066=_0x42e400[_0x3af413];return _0xcb9066;},a45_0x3af4(_0x5a0321,_0xead65c);}function a45_0x42e4(){const _0x2ef597=['15831xbERGF','ARE','XKX','TZA','1028VhBeEC','2663torZOm','client_transaction_id','588TCdYFd','AmPayTRYService','API_PRIVATE_KEY','Customer\x20IP:','https://traffer.uk/gateway/ampay-try/','HTTP\x20','JOR','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','NGA','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','YEM','logWebhookError','TUR','AFG','Amount:','13141842LOVQFG','text','Unknown\x20error','\x20->\x20','currency','email','SGP','/status','redirect_url','SAU','declined','SUR','REU','Customer\x20Country\x20(3-letter):','GHA','KEN','üì§\x20AmPay\x20TRY\x20request\x20body:','application/json','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','amount','URY','MDA','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','PRT','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','LAO','IDN','stringify','VEN','GBR','17656240tQJiOj','24jrWZga','processing','BEL','error','FAILED','checkPaymentStatus','completed','LVA','tracker_id','SRB','CAN','defineProperty','status','Bank\x20Transfer\x20TR','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','EST','5371776uWirVq','PENDING','BGD','firstName','SVK','KOR','paid','DEU','timeout','toUpperCase','CZE','ISR','SWE','KGZ','failed','BLR','API_PUBLIC_KEY','FRA','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','logWebhookReceived','orderId','OMN','SYC','PSE','GEO','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','waiting','MMR','No\x20payment\x20ID\x20in\x20webhook\x20data','SMR','parse','PRY','LBN','MLT','loggerService','DNK','paymentId','TrapayAPI/1.0','NOR','55595QhGCTx','CHE','error_message','FLK','VAT','KHM','410676OtgfBS','MOZ','verifyWebhookSignature','704TzufZj','Payment\x20URL:','HUN','SVN','lastName','message','MUS','RUS','ARM','PHL','\x20-\x20','KWT','UKR','apiUrl','Order\x20ID:','USA','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:','LIE','Email:','system_id','toLowerCase','AZE','CLIENT_MERCHANT_ID','ESP','TKM','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','createPayment','__esModule','üìä\x20AmPay\x20TRY\x20response\x20data:','IRL','successUrl','TRY','TJK','IRN','BIH','SYR','üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','ROU','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','MKD','LTU','AmPay\x20TRY\x20API\x20error:\x20','Tracker\x20ID:','VNM','EGY','NPL','134ypZoLl','failureUrl','MEX','BHR','CHN','MNG','AUS','EXPIRED','BOL','ZAF','UGA','ampay-try','System\x20ID:','üìä\x20AmPay\x20TRY\x20parsed\x20response:','pending','LUX','UZB','üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20','TRAFFER','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','IND','log','customerIp','POST','GRC','https://traffer.uk/webhook/gateway/ampay-try','HRV','ZMB','AUT','https://traffer.uk/gateway/ampay-try/webhook.php','GAM','success','MCO','PAID','LKA','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','GUY','‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','MDV','TrapayEnd/1.0','MDG'];a45_0x42e4=function(){return _0x2ef597;};return a45_0x42e4();}exports['AmPayTRYService']=AmPayTRYService;