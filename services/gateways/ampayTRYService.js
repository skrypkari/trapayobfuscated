'use strict';function a57_0x2b13(_0x332c46,_0x4c41fb){_0x332c46=_0x332c46-0xc6;const _0xc4bdf=a57_0xc4bd();let _0x2b1370=_0xc4bdf[_0x332c46];return _0x2b1370;}const a57_0x29986f=a57_0x2b13;(function(_0x272b44,_0x269e6e){const _0x29d483=a57_0x2b13,_0x6263ce=_0x272b44();while(!![]){try{const _0xb447da=-parseInt(_0x29d483(0x148))/0x1*(-parseInt(_0x29d483(0x151))/0x2)+parseInt(_0x29d483(0x12a))/0x3+-parseInt(_0x29d483(0x109))/0x4*(-parseInt(_0x29d483(0x170))/0x5)+parseInt(_0x29d483(0x105))/0x6+parseInt(_0x29d483(0xce))/0x7+parseInt(_0x29d483(0x14f))/0x8+parseInt(_0x29d483(0x12f))/0x9*(-parseInt(_0x29d483(0x163))/0xa);if(_0xb447da===_0x269e6e)break;else _0x6263ce['push'](_0x6263ce['shift']());}catch(_0x4f98b3){_0x6263ce['push'](_0x6263ce['shift']());}}}(a57_0xc4bd,0xab5b6));Object[a57_0x29986f(0x16e)](exports,a57_0x29986f(0x158),{'value':!![]}),exports['AmPayTRYService']=void 0x0;const loggerService_1=require(a57_0x29986f(0x129));function a57_0xc4bd(){const _0x513714=['BRA','createPayment','SWE','âŒ\x20AmPay\x20TRY\x20status\x20check\x20failed:','AUS','/status','KOR','TJK','VAT','BIH','timeout','âŒ\x20AmPay\x20TRY\x20API\x20error:','âŒ\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','loggerService','BGR','toLowerCase','POL','DEU','JOR','LUX','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','QAT','UGA','1300263BDzWvS','error_message','tracker_id','AUT','logWebhookReceived','TRY','ITA','1851000KnBTeJ','ECU','2COGHtH','currency','Customer\x20IP:','verifyWebhookSignature','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','Tracker\x20ID:','TRAFFER','__esModule','API_PUBLIC_KEY','MNG','failureUrl','ðŸ“¥\x20Processing\x20AmPay\x20TRY\x20webhook:','Unknown\x20error','LKA','AND','parse','UKR','a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815','1794080UOnIWN','ZWE','ðŸ“\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...','lastName','failed','KHM','AZE','paid','âŒ\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','NGA','amount','defineProperty','System\x20ID:','630245ZJxjUS','KAZ','ZAF','TrapayEnd/1.0','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','client_transaction_id','CHN','IDN','ISL','URY','text','convert2LetterTo3LetterCountryCode','SGP','checkPaymentStatus','MDV','LVA','ðŸš€\x20Creating\x20AmPay\x20TRY\x20payment\x20request:','GHA','IRL','MCO','ARE','SAU','Customer\x20Country\x20(2-letter):','paymentId','SMR','6375593vNtCbG','âœ…\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully','ðŸ“¤\x20AmPay\x20TRY\x20request\x20body:','PENDING','âŒ\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:','COL','ðŸ”\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','AmPayTRYService','status','HTTP\x20','message','JPN','success','CZE','error','application/json','ðŸ“\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','completed','XKX','ðŸ“\x20AmPay\x20TRY\x20API\x20raw\x20response:','redirect_url','PAID','SVN','AmPay\x20TRY\x20API\x20error:\x20','TUR','\x20-\x20','processWebhook','LAO','CLIENT_MERCHANT_ID','customerIp','DNK','toUpperCase','createPaymentLink','Email:','NLD','Amount:','CYP','firstName','LBN','ALB','KWT','MUS','FAILED','Customer\x20Country\x20(3-letter):','IND','log','CAN','âŒ\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','ESP','declined','TKM','EXPIRED','ðŸ“¤\x20AmPay\x20TRY\x20API\x20request\x20data:','No\x20payment\x20ID\x20in\x20webhook\x20data','2956140Elkvkv','IRQ','MMR','MEX','20bZfizc','ðŸ‡¹ðŸ‡·\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','SVK','POST','EST','stringify','not\x20provided','KEN','FIN','ARM','ðŸ“\x20AmPay\x20TRY\x20status\x20raw\x20response:','SYR','USA','LIE','customerCountry','HUN','GEO','ðŸ“¡\x20AmPay\x20TRY\x20API\x20response\x20status:','PSE','MYS','apiUrl','EGY','BLR','CHL','GUY','SUR','YEM','warn','NPL','ðŸ“Š\x20AmPay\x20TRY\x20response\x20data:','KGZ','https://traffer.uk/gateway/ampay-try/webhook.php','../loggerService','3788670VLXdPM','AFG','Order\x20ID:','FLK','pending','207ZvdqBw','SRB'];a57_0xc4bd=function(){return _0x513714;};return a57_0xc4bd();}class AmPayTRYService{constructor(){const _0x5d40d6=a57_0x29986f;this[_0x5d40d6(0xeb)]=_0x5d40d6(0x157),this['API_PUBLIC_KEY']='58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda',this['API_PRIVATE_KEY']=_0x5d40d6(0x162),this['apiUrl']='https://traffer.uk/gateway/ampay-try/',console[_0x5d40d6(0xfc)](_0x5d40d6(0x10a));}[a57_0x29986f(0x17b)](_0x3439b1){const _0x23abee=a57_0x29986f,_0x39d67d={'AD':_0x23abee(0x15f),'AL':_0x23abee(0xf6),'AT':_0x23abee(0x14b),'BA':_0x23abee(0x13a),'BE':'BEL','BG':_0x23abee(0x13f),'BY':_0x23abee(0x11f),'CH':'CHE','CY':_0x23abee(0xf3),'CZ':_0x23abee(0xdb),'DE':_0x23abee(0x142),'DK':_0x23abee(0xed),'EE':_0x23abee(0x10d),'ES':_0x23abee(0xff),'FI':_0x23abee(0x111),'FR':'FRA','GB':'GBR','GE':_0x23abee(0x119),'GR':'GRC','HR':'HRV','HU':_0x23abee(0x118),'IE':_0x23abee(0xc7),'IS':_0x23abee(0x178),'IT':_0x23abee(0x14e),'LI':_0x23abee(0x116),'LT':'LTU','LU':_0x23abee(0x144),'LV':_0x23abee(0x17f),'MC':_0x23abee(0xc8),'MD':'MDA','ME':'MNE','MK':'MKD','MT':'MLT','NL':_0x23abee(0xf1),'NO':'NOR','PL':_0x23abee(0x141),'PT':'PRT','RO':'ROU','RS':_0x23abee(0x130),'RU':'RUS','SE':_0x23abee(0x133),'SI':_0x23abee(0xe5),'SK':_0x23abee(0x10b),'SM':_0x23abee(0xcd),'UA':_0x23abee(0x161),'VA':_0x23abee(0x139),'XK':_0x23abee(0xe1),'AM':_0x23abee(0x112),'AZ':_0x23abee(0x169),'KZ':_0x23abee(0x171),'KG':_0x23abee(0x127),'TJ':_0x23abee(0x138),'TM':_0x23abee(0x101),'UZ':'UZB','US':_0x23abee(0x115),'CA':_0x23abee(0xfd),'AU':_0x23abee(0x135),'JP':_0x23abee(0xd9),'CN':_0x23abee(0x176),'IN':_0x23abee(0xfb),'BR':_0x23abee(0x131),'MX':_0x23abee(0x108),'AR':'ARG','CL':_0x23abee(0x120),'PE':'PER','CO':_0x23abee(0xd3),'VE':'VEN','EC':_0x23abee(0x150),'BO':'BOL','PY':'PRY','UY':_0x23abee(0x179),'SR':_0x23abee(0x122),'GY':_0x23abee(0x121),'FK':_0x23abee(0x12d),'ZA':_0x23abee(0x172),'EG':_0x23abee(0x11e),'NG':_0x23abee(0x16c),'KE':_0x23abee(0x110),'GH':_0x23abee(0xc6),'TZ':'TZA','UG':_0x23abee(0x147),'ZW':_0x23abee(0x164),'ZM':'ZMB','MW':'MWI','MZ':'MOZ','MG':'MDG','MU':_0x23abee(0xf8),'SC':'SYC','RE':'REU','TR':_0x23abee(0xe7),'IR':'IRN','IQ':_0x23abee(0x106),'SA':_0x23abee(0xca),'AE':_0x23abee(0xc9),'KW':_0x23abee(0xf7),'QA':_0x23abee(0x146),'BH':'BHR','OM':'OMN','YE':_0x23abee(0x123),'JO':_0x23abee(0x143),'LB':_0x23abee(0xf5),'SY':_0x23abee(0x114),'IL':'ISR','PS':_0x23abee(0x11b),'KR':_0x23abee(0x137),'KP':'PRK','TH':'THA','VN':'VNM','MY':_0x23abee(0x11c),'SG':_0x23abee(0x17c),'ID':_0x23abee(0x177),'PH':'PHL','LA':_0x23abee(0xea),'KH':_0x23abee(0x168),'MM':_0x23abee(0x107),'BD':'BGD','LK':_0x23abee(0x15e),'NP':_0x23abee(0x125),'BT':'BTN','MV':_0x23abee(0x17e),'AF':_0x23abee(0x12b),'PK':'PAK','MN':_0x23abee(0x15a)},_0x260deb=_0x39d67d[_0x3439b1[_0x23abee(0xee)]()];if(!_0x260deb)return console[_0x23abee(0x124)]('âš ï¸\x20Unknown\x20country\x20code:\x20'+_0x3439b1+_0x23abee(0xdf)),'TUR';return _0x260deb;}async[a57_0x29986f(0x132)](_0x45b4b2){const _0x54b668=a57_0x29986f;console[_0x54b668(0xfc)](_0x54b668(0x180),{'paymentId':_0x45b4b2[_0x54b668(0xcc)],'amount':_0x45b4b2[_0x54b668(0x16d)],'currency':_0x45b4b2['currency'],'customerCountry':_0x45b4b2[_0x54b668(0x117)]});try{const _0x194a5a={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'payment_method':'Bank\x20Transfer\x20TR','client_transaction_id':_0x45b4b2['orderId'],'amount':_0x45b4b2[_0x54b668(0x16d)],'currency':_0x45b4b2[_0x54b668(0x152)],'callback_url':_0x54b668(0x128),'tracker_id':_0x45b4b2[_0x54b668(0xcc)],'redirect_url':_0x45b4b2['successUrl'],'failure_url':_0x45b4b2[_0x54b668(0x15b)],'customer_first_name':_0x45b4b2[_0x54b668(0xf4)],'customer_last_name':_0x45b4b2[_0x54b668(0x166)],'customer_email':_0x45b4b2['email'],'customer_phone':_0x45b4b2['phone']||'','customer_ip':_0x45b4b2[_0x54b668(0xec)],'customer_country':_0x45b4b2[_0x54b668(0x117)],'api_public_key':this[_0x54b668(0x159)]};console[_0x54b668(0xfc)](_0x54b668(0x103),JSON[_0x54b668(0x10e)](_0x194a5a,null,0x2));const _0x16f355=await fetch(this[_0x54b668(0x11d)],{'method':'POST','headers':{'Content-Type':_0x54b668(0xdd),'User-Agent':_0x54b668(0x173)},'body':JSON['stringify'](_0x194a5a)});console[_0x54b668(0xfc)](_0x54b668(0x11a),_0x16f355[_0x54b668(0xd6)]);const _0x51d34b=await _0x16f355[_0x54b668(0x17a)]();console[_0x54b668(0xfc)](_0x54b668(0xe2),_0x51d34b);let _0x304987;try{_0x304987=JSON[_0x54b668(0x160)](_0x51d34b);}catch(_0x14cccc){console['error']('âŒ\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:',_0x14cccc);throw new Error(_0x54b668(0x174)+_0x51d34b);}console[_0x54b668(0xfc)]('ðŸ“Š\x20AmPay\x20TRY\x20parsed\x20response:',JSON[_0x54b668(0x10e)](_0x304987,null,0x2)),loggerService_1[_0x54b668(0x13e)][_0x54b668(0x14c)]('ampay-try',_0x304987,{});if(!_0x16f355['ok']){const _0xe6e8c9=_0x304987[_0x54b668(0x149)]||_0x304987[_0x54b668(0xd8)]||_0x54b668(0xd7)+_0x16f355['status'];console[_0x54b668(0xdc)](_0x54b668(0x13c),_0xe6e8c9);throw new Error(_0x54b668(0xe6)+_0xe6e8c9);}if(!_0x304987[_0x54b668(0xe3)]){console[_0x54b668(0xdc)]('âŒ\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:',_0x304987);throw new Error(_0x54b668(0x145));}const _0x22700f={'gateway_payment_id':_0x304987['system_id']||_0x45b4b2['orderId'],'payment_url':_0x304987['redirect_url'],'transaction_id':_0x304987['client_transaction_id']};return console[_0x54b668(0xfc)]('âœ…\x20AmPay\x20TRY\x20payment\x20created\x20successfully:',_0x22700f),_0x22700f;}catch(_0x571749){console[_0x54b668(0xdc)]('âŒ\x20AmPay\x20TRY\x20payment\x20creation\x20failed:',_0x571749),loggerService_1[_0x54b668(0x13e)]['logWebhookError']('ampay-try',_0x571749,_0x45b4b2);throw _0x571749;}}async[a57_0x29986f(0xef)](_0x33a681){const _0x469b27=a57_0x29986f;try{const {orderId:_0x4db898,amount:_0x278085,currency:_0x400eb6,firstName:_0x3d4c2b,lastName:_0x250e2a,email:_0x2e4349,phone:_0x10b6fb,customerIp:_0x11e1c4,customerCountry:_0x22e376,successUrl:_0x15fc97,failureUrl:_0x1722c2}=_0x33a681;console['log']('ðŸ‡¹ðŸ‡·\x20Creating\x20AmPay\x20TRY\x20payment\x20link...'),console[_0x469b27(0xfc)](_0x469b27(0x12c),_0x4db898),console[_0x469b27(0xfc)](_0x469b27(0xf2),_0x278085,_0x400eb6),console[_0x469b27(0xfc)]('Customer:',_0x3d4c2b+'\x20'+_0x250e2a),console['log'](_0x469b27(0xf0),_0x2e4349),console[_0x469b27(0xfc)]('Phone:',_0x10b6fb||_0x469b27(0x10f)),console['log'](_0x469b27(0x153),_0x11e1c4),console[_0x469b27(0xfc)](_0x469b27(0xcb),_0x22e376);const _0x56881a=this[_0x469b27(0x17b)](_0x22e376);console[_0x469b27(0xfc)](_0x469b27(0xfa),_0x56881a);const _0x35263f={'sub_method':'GAM','currency':_0x400eb6[_0x469b27(0xee)](),'amount':_0x278085,'callback_url':_0x469b27(0x128),'client_merchant_id':this[_0x469b27(0xeb)],'client_transaction_id':_0x4db898,'transaction_description':_0x4db898,'customer':{'ip':_0x11e1c4,'email':_0x2e4349,'full_name':_0x3d4c2b+'\x20'+_0x250e2a,'phone':_0x10b6fb||'','country':_0x56881a},'success_redirect_url':_0x15fc97,'error_redirect_url':_0x1722c2};console[_0x469b27(0xfc)](_0x469b27(0xd0),JSON[_0x469b27(0x10e)](_0x35263f,null,0x2));const _0x1f76c9=await fetch(this[_0x469b27(0x11d)]+'ampay.php',{'method':_0x469b27(0x10c),'headers':{'Content-Type':'application/json','User-Agent':'TrapayAPI/1.0'},'body':JSON[_0x469b27(0x10e)](_0x35263f)}),_0x474f9d=await _0x1f76c9[_0x469b27(0x17a)]();console['log']('ðŸ“¥\x20AmPay\x20TRY\x20raw\x20response:',_0x474f9d);if(!_0x1f76c9['ok'])throw new Error(_0x469b27(0x155)+_0x1f76c9[_0x469b27(0xd6)]+_0x469b27(0xe8)+_0x474f9d);let _0x44a8f8;try{_0x44a8f8=JSON[_0x469b27(0x160)](_0x474f9d);}catch(_0x534947){throw new Error(_0x469b27(0x174)+_0x474f9d);}console['log'](_0x469b27(0x126),JSON['stringify'](_0x44a8f8,null,0x2));if(!_0x44a8f8['redirect_url'])throw new Error('AmPay\x20TRY\x20payment\x20creation\x20failed:\x20'+(_0x44a8f8[_0x469b27(0x149)]||_0x44a8f8[_0x469b27(0xd8)]||_0x469b27(0x15d)));const _0x28a1a7=_0x44a8f8[_0x469b27(0xe3)],_0x7bdb81=_0x44a8f8['system_id'],_0x27c8bd=_0x44a8f8[_0x469b27(0x14a)];return console[_0x469b27(0xfc)](_0x469b27(0xcf)),console[_0x469b27(0xfc)]('Payment\x20URL:',_0x28a1a7),console[_0x469b27(0xfc)](_0x469b27(0x16f),_0x7bdb81),console['log'](_0x469b27(0x156),_0x27c8bd),console[_0x469b27(0xfc)]('Status:',_0x44a8f8['status']),console['log'](_0x469b27(0x165)),{'gateway_payment_id':_0x7bdb81||_0x27c8bd||_0x4db898,'payment_url':_0x28a1a7||'','transaction_id':_0x7bdb81};}catch(_0x324041){console['error'](_0x469b27(0xfe),_0x324041),console[_0x469b27(0xfc)](_0x469b27(0xde)),loggerService_1[_0x469b27(0x13e)]['logWebhookError']('ampay-try',_0x324041,_0x33a681);throw _0x324041;}}async[a57_0x29986f(0x17d)](_0xc2c235){const _0x32dcb3=a57_0x29986f;console[_0x32dcb3(0xfc)]('ðŸ”\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:',_0xc2c235);try{const _0x11bce={'client_merchant_id':this['CLIENT_MERCHANT_ID'],'system_id':_0xc2c235,'api_public_key':this[_0x32dcb3(0x159)]},_0x2f0c16=await fetch(this['apiUrl']+_0x32dcb3(0x136),{'method':_0x32dcb3(0x10c),'headers':{'Content-Type':_0x32dcb3(0xdd),'User-Agent':_0x32dcb3(0x173)},'body':JSON['stringify'](_0x11bce)}),_0x4c7ed8=await _0x2f0c16[_0x32dcb3(0x17a)]();console[_0x32dcb3(0xfc)](_0x32dcb3(0x113),_0x4c7ed8);let _0x47493a;try{_0x47493a=JSON[_0x32dcb3(0x160)](_0x4c7ed8);}catch(_0x450dcb){return console[_0x32dcb3(0xdc)](_0x32dcb3(0xd2),_0x450dcb),{'status':_0x32dcb3(0xf9)};}console['log']('ðŸ“Š\x20AmPay\x20TRY\x20status\x20response:',JSON[_0x32dcb3(0x10e)](_0x47493a,null,0x2));let _0x23bd0d=_0x32dcb3(0xd1);if(_0x47493a['status'])switch(_0x47493a[_0x32dcb3(0xd6)]['toLowerCase']()){case _0x32dcb3(0xda):case _0x32dcb3(0xe0):case'paid':_0x23bd0d=_0x32dcb3(0xe4);break;case'failed':case _0x32dcb3(0xdc):case _0x32dcb3(0x100):_0x23bd0d=_0x32dcb3(0xf9);break;case'expired':case _0x32dcb3(0x13b):_0x23bd0d=_0x32dcb3(0x102);break;case _0x32dcb3(0x12e):case'processing':case'waiting':default:_0x23bd0d=_0x32dcb3(0xd1);break;}return{'status':_0x23bd0d,'amount':_0x47493a[_0x32dcb3(0x16d)],'currency':_0x47493a['currency']};}catch(_0x218269){return console['error'](_0x32dcb3(0x134),_0x218269),{'status':_0x32dcb3(0xf9)};}}async[a57_0x29986f(0xe9)](_0x2f95d4){const _0x28432f=a57_0x29986f;console[_0x28432f(0xfc)](_0x28432f(0x15c),JSON['stringify'](_0x2f95d4,null,0x2));try{const _0xfeed80=_0x2f95d4[_0x28432f(0x14a)]||_0x2f95d4[_0x28432f(0x175)]||_0x2f95d4['system_id'];if(!_0xfeed80){console[_0x28432f(0xdc)](_0x28432f(0x16b));throw new Error(_0x28432f(0x104));}let _0x44d766=_0x28432f(0xd1);if(_0x2f95d4[_0x28432f(0xd6)])switch(_0x2f95d4[_0x28432f(0xd6)][_0x28432f(0x140)]()){case _0x28432f(0xda):case'completed':case _0x28432f(0x16a):_0x44d766=_0x28432f(0xe4);break;case _0x28432f(0x167):case _0x28432f(0xdc):case'declined':_0x44d766=_0x28432f(0xf9);break;case'expired':case _0x28432f(0x13b):_0x44d766=_0x28432f(0x102);break;case _0x28432f(0x12e):case'processing':case'waiting':default:_0x44d766='PENDING';break;}return console['log']('ðŸ“Š\x20AmPay\x20TRY\x20webhook\x20processed:\x20'+_0xfeed80+'\x20->\x20'+_0x44d766),{'paymentId':_0xfeed80,'status':_0x44d766,'amount':_0x2f95d4[_0x28432f(0x16d)],'currency':_0x2f95d4[_0x28432f(0x152)]||_0x28432f(0x14d)};}catch(_0x4a9a50){console[_0x28432f(0xdc)](_0x28432f(0x13d),_0x4a9a50);throw _0x4a9a50;}}[a57_0x29986f(0x154)](_0x993309,_0x3085ec){const _0x35f9ae=a57_0x29986f;return console['log'](_0x35f9ae(0xd4)),!![];}}exports[a57_0x29986f(0xd5)]=AmPayTRYService;