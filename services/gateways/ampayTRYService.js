'use strict';function a47_0x3007(_0x37b698,_0x20bc81){const _0x44f550=a47_0x44f5();return a47_0x3007=function(_0x3007a1,_0x7128){_0x3007a1=_0x3007a1-0x148;let _0x1e3eec=_0x44f550[_0x3007a1];return _0x1e3eec;},a47_0x3007(_0x37b698,_0x20bc81);}const a47_0x564056=a47_0x3007;(function(_0x4580d8,_0x142ea7){const _0x109c1f=a47_0x3007,_0x1fa5cb=_0x4580d8();while(!![]){try{const _0xee12bf=-parseInt(_0x109c1f(0x186))/0x1+parseInt(_0x109c1f(0x1ae))/0x2*(-parseInt(_0x109c1f(0x20d))/0x3)+-parseInt(_0x109c1f(0x1ad))/0x4+-parseInt(_0x109c1f(0x1c5))/0x5+parseInt(_0x109c1f(0x1d0))/0x6*(parseInt(_0x109c1f(0x1e6))/0x7)+parseInt(_0x109c1f(0x194))/0x8+parseInt(_0x109c1f(0x14f))/0x9;if(_0xee12bf===_0x142ea7)break;else _0x1fa5cb['push'](_0x1fa5cb['shift']());}catch(_0x344b42){_0x1fa5cb['push'](_0x1fa5cb['shift']());}}}(a47_0x44f5,0x2ef93));Object[a47_0x564056(0x201)](exports,a47_0x564056(0x1b8),{'value':!![]}),exports['AmPayTRYService']=void 0x0;const loggerService_1=require('../loggerService');class AmPayTRYService{constructor(){const _0x2b0a8f=a47_0x564056;this[_0x2b0a8f(0x16b)]='TRAFFER',this['API_PUBLIC_KEY']=_0x2b0a8f(0x1a2),this['API_PRIVATE_KEY']='a5a059aa63392e571341bddc5148a5db66643722e9a6bf16a9395fb690a80288931d5a1180a85a28eb9f6516cf61dfc1bf4e37898f3a35261cd2db88888d3815',this[_0x2b0a8f(0x204)]=_0x2b0a8f(0x16f),console[_0x2b0a8f(0x148)](_0x2b0a8f(0x1e7));}[a47_0x564056(0x1c4)](_0xaecbcd){const _0x345fb2=a47_0x564056,_0x4f7ab8={'AD':_0x345fb2(0x14b),'AL':_0x345fb2(0x200),'AT':_0x345fb2(0x183),'BA':_0x345fb2(0x1e2),'BE':'BEL','BG':'BGR','BY':'BLR','CH':_0x345fb2(0x14c),'CY':_0x345fb2(0x20e),'CZ':_0x345fb2(0x1a0),'DE':_0x345fb2(0x1ed),'DK':_0x345fb2(0x1bb),'EE':'EST','ES':_0x345fb2(0x1a3),'FI':_0x345fb2(0x1f1),'FR':_0x345fb2(0x1a5),'GB':_0x345fb2(0x15c),'GE':_0x345fb2(0x195),'GR':_0x345fb2(0x152),'HR':_0x345fb2(0x165),'HU':_0x345fb2(0x158),'IE':_0x345fb2(0x188),'IS':_0x345fb2(0x169),'IT':'ITA','LI':_0x345fb2(0x16c),'LT':'LTU','LU':'LUX','LV':_0x345fb2(0x17c),'MC':_0x345fb2(0x1ba),'MD':'MDA','ME':_0x345fb2(0x17a),'MK':_0x345fb2(0x16e),'MT':_0x345fb2(0x182),'NL':_0x345fb2(0x170),'NO':_0x345fb2(0x209),'PL':_0x345fb2(0x1d4),'PT':_0x345fb2(0x15b),'RO':'ROU','RS':_0x345fb2(0x192),'RU':_0x345fb2(0x1ce),'SE':_0x345fb2(0x17b),'SI':_0x345fb2(0x149),'SK':'SVK','SM':_0x345fb2(0x205),'UA':_0x345fb2(0x15e),'VA':_0x345fb2(0x171),'XK':_0x345fb2(0x1c2),'AM':_0x345fb2(0x179),'AZ':'AZE','KZ':_0x345fb2(0x1a4),'KG':_0x345fb2(0x1c6),'TJ':_0x345fb2(0x1a7),'TM':_0x345fb2(0x1bf),'UZ':'UZB','US':_0x345fb2(0x215),'CA':_0x345fb2(0x1ec),'AU':'AUS','JP':_0x345fb2(0x14d),'CN':_0x345fb2(0x14a),'IN':_0x345fb2(0x19f),'BR':_0x345fb2(0x1fa),'MX':'MEX','AR':_0x345fb2(0x153),'CL':_0x345fb2(0x1b1),'PE':_0x345fb2(0x1c7),'CO':_0x345fb2(0x19e),'VE':_0x345fb2(0x1d8),'EC':_0x345fb2(0x1a8),'BO':_0x345fb2(0x172),'PY':_0x345fb2(0x212),'UY':_0x345fb2(0x151),'SR':'SUR','GY':_0x345fb2(0x1db),'FK':'FLK','ZA':'ZAF','EG':_0x345fb2(0x156),'NG':_0x345fb2(0x1af),'KE':_0x345fb2(0x1e0),'GH':'GHA','TZ':'TZA','UG':_0x345fb2(0x19b),'ZW':'ZWE','ZM':_0x345fb2(0x18d),'MW':_0x345fb2(0x1cf),'MZ':_0x345fb2(0x166),'MG':'MDG','MU':_0x345fb2(0x157),'SC':_0x345fb2(0x1cd),'RE':'REU','TR':_0x345fb2(0x210),'IR':_0x345fb2(0x1ef),'IQ':_0x345fb2(0x1ea),'SA':_0x345fb2(0x213),'AE':_0x345fb2(0x1f2),'KW':_0x345fb2(0x189),'QA':_0x345fb2(0x160),'BH':'BHR','OM':_0x345fb2(0x154),'YE':_0x345fb2(0x1fd),'JO':_0x345fb2(0x168),'LB':_0x345fb2(0x1d6),'SY':_0x345fb2(0x1c9),'IL':'ISR','PS':_0x345fb2(0x1c3),'KR':_0x345fb2(0x1a1),'KP':_0x345fb2(0x1aa),'TH':_0x345fb2(0x1b4),'VN':_0x345fb2(0x1e4),'MY':_0x345fb2(0x17d),'SG':_0x345fb2(0x16a),'ID':'IDN','PH':_0x345fb2(0x198),'LA':_0x345fb2(0x19c),'KH':_0x345fb2(0x1c8),'MM':_0x345fb2(0x163),'BD':_0x345fb2(0x1f6),'LK':_0x345fb2(0x161),'NP':'NPL','BT':_0x345fb2(0x1f4),'MV':_0x345fb2(0x1f5),'AF':_0x345fb2(0x20b),'PK':_0x345fb2(0x1e9),'MN':_0x345fb2(0x1b6)},_0x942428=_0x4f7ab8[_0xaecbcd['toUpperCase']()];if(!_0x942428)return console[_0x345fb2(0x1e5)]('‚ö†Ô∏è\x20Unknown\x20country\x20code:\x20'+_0xaecbcd+_0x345fb2(0x1ab)),_0x345fb2(0x210);return _0x942428;}async['createPayment'](_0x11faa8){const _0x2a97be=a47_0x564056;console[_0x2a97be(0x148)]('üöÄ\x20Creating\x20AmPay\x20TRY\x20payment\x20request:',{'paymentId':_0x11faa8[_0x2a97be(0x191)],'amount':_0x11faa8[_0x2a97be(0x193)],'currency':_0x11faa8[_0x2a97be(0x14e)],'customerCountry':_0x11faa8[_0x2a97be(0x20a)]});try{const _0x47a0e1={'client_merchant_id':this[_0x2a97be(0x16b)],'payment_method':_0x2a97be(0x1eb),'client_transaction_id':_0x11faa8[_0x2a97be(0x1cc)],'amount':_0x11faa8[_0x2a97be(0x193)],'currency':_0x11faa8[_0x2a97be(0x14e)],'callback_url':'https://traffer.uk/gateway/ampay-try/webhook.php','tracker_id':_0x11faa8[_0x2a97be(0x191)],'redirect_url':_0x11faa8['successUrl'],'failure_url':_0x11faa8[_0x2a97be(0x20c)],'customer_first_name':_0x11faa8['firstName'],'customer_last_name':_0x11faa8['lastName'],'customer_email':_0x11faa8[_0x2a97be(0x176)],'customer_phone':_0x11faa8['phone']||'','customer_ip':_0x11faa8[_0x2a97be(0x208)],'customer_country':_0x11faa8['customerCountry'],'api_public_key':this[_0x2a97be(0x1a6)]};console['log']('üì§\x20AmPay\x20TRY\x20API\x20request\x20data:',JSON[_0x2a97be(0x164)](_0x47a0e1,null,0x2));const _0x4b7934=await fetch(this['apiUrl'],{'method':_0x2a97be(0x203),'headers':{'Content-Type':_0x2a97be(0x1ac),'User-Agent':_0x2a97be(0x1f8)},'body':JSON[_0x2a97be(0x164)](_0x47a0e1)});console[_0x2a97be(0x148)](_0x2a97be(0x155),_0x4b7934['status']);const _0x324827=await _0x4b7934[_0x2a97be(0x159)]();console[_0x2a97be(0x148)]('üìù\x20AmPay\x20TRY\x20API\x20raw\x20response:',_0x324827);let _0x260f1f;try{_0x260f1f=JSON[_0x2a97be(0x174)](_0x324827);}catch(_0x1ec472){console[_0x2a97be(0x1b3)](_0x2a97be(0x1ff),_0x1ec472);throw new Error('Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20'+_0x324827);}console['log'](_0x2a97be(0x1fb),JSON['stringify'](_0x260f1f,null,0x2)),loggerService_1[_0x2a97be(0x199)]['logWebhookReceived'](_0x2a97be(0x19d),_0x260f1f,{});if(!_0x4b7934['ok']){const _0x413824=_0x260f1f[_0x2a97be(0x1be)]||_0x260f1f[_0x2a97be(0x1d9)]||_0x2a97be(0x214)+_0x4b7934['status'];console['error']('‚ùå\x20AmPay\x20TRY\x20API\x20error:',_0x413824);throw new Error(_0x2a97be(0x1d3)+_0x413824);}if(!_0x260f1f[_0x2a97be(0x206)]){console[_0x2a97be(0x1b3)](_0x2a97be(0x216),_0x260f1f);throw new Error(_0x2a97be(0x18b));}const _0x477899={'gateway_payment_id':_0x260f1f[_0x2a97be(0x207)]||_0x11faa8[_0x2a97be(0x1cc)],'payment_url':_0x260f1f['redirect_url'],'transaction_id':_0x260f1f[_0x2a97be(0x1da)]};return console[_0x2a97be(0x148)](_0x2a97be(0x180),_0x477899),_0x477899;}catch(_0x55fa4f){console[_0x2a97be(0x1b3)]('‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:',_0x55fa4f),loggerService_1['loggerService'][_0x2a97be(0x1e1)](_0x2a97be(0x19d),_0x55fa4f,_0x11faa8);throw _0x55fa4f;}}async[a47_0x564056(0x19a)](_0x345139){const _0x588b8c=a47_0x564056;try{const {orderId:_0x147f87,amount:_0x23578a,currency:_0x13074d,firstName:_0xbe3179,lastName:_0x517695,email:_0x102fa8,phone:_0x17824e,customerIp:_0xcf4b63,customerCountry:_0x59241e,successUrl:_0x4ded11,failureUrl:_0xd1d271}=_0x345139;console['log'](_0x588b8c(0x1f7)),console[_0x588b8c(0x148)](_0x588b8c(0x178),_0x147f87),console[_0x588b8c(0x148)](_0x588b8c(0x15d),_0x23578a,_0x13074d),console[_0x588b8c(0x148)](_0x588b8c(0x1b7),_0xbe3179+'\x20'+_0x517695),console['log'](_0x588b8c(0x1dd),_0x102fa8),console['log'](_0x588b8c(0x185),_0x17824e||_0x588b8c(0x187)),console[_0x588b8c(0x148)](_0x588b8c(0x1fe),_0xcf4b63),console[_0x588b8c(0x148)](_0x588b8c(0x1a9),_0x59241e);const _0x5bcb24=this['convert2LetterTo3LetterCountryCode'](_0x59241e);console['log']('Customer\x20Country\x20(3-letter):',_0x5bcb24);const _0x4b9d05={'sub_method':_0x588b8c(0x18f),'currency':_0x13074d[_0x588b8c(0x1c1)](),'amount':_0x23578a,'callback_url':_0x588b8c(0x1b5),'client_merchant_id':this['CLIENT_MERCHANT_ID'],'client_transaction_id':_0x147f87,'transaction_description':_0x147f87,'customer':{'ip':_0xcf4b63,'email':_0x102fa8,'full_name':_0xbe3179+'\x20'+_0x517695,'phone':_0x17824e||'','country':_0x5bcb24},'success_redirect_url':_0x4ded11,'error_redirect_url':_0xd1d271};console['log']('üì§\x20AmPay\x20TRY\x20request\x20body:',JSON[_0x588b8c(0x164)](_0x4b9d05,null,0x2));const _0x270404=await fetch(this[_0x588b8c(0x204)]+_0x588b8c(0x150),{'method':_0x588b8c(0x203),'headers':{'Content-Type':_0x588b8c(0x1ac),'User-Agent':_0x588b8c(0x18a)},'body':JSON['stringify'](_0x4b9d05)}),_0x5d7982=await _0x270404['text']();console[_0x588b8c(0x148)](_0x588b8c(0x17e),_0x5d7982);if(!_0x270404['ok'])throw new Error(_0x588b8c(0x184)+_0x270404[_0x588b8c(0x1d7)]+_0x588b8c(0x162)+_0x5d7982);let _0x39c511;try{_0x39c511=JSON[_0x588b8c(0x174)](_0x5d7982);}catch(_0x56aad8){throw new Error(_0x588b8c(0x1d5)+_0x5d7982);}console[_0x588b8c(0x148)]('üìä\x20AmPay\x20TRY\x20response\x20data:',JSON[_0x588b8c(0x164)](_0x39c511,null,0x2));if(!_0x39c511[_0x588b8c(0x206)])throw new Error(_0x588b8c(0x202)+(_0x39c511[_0x588b8c(0x1be)]||_0x39c511[_0x588b8c(0x1d9)]||_0x588b8c(0x1bc)));const _0x2cdbd6=_0x39c511[_0x588b8c(0x206)],_0xdfbef5=_0x39c511[_0x588b8c(0x207)],_0x3a54b3=_0x39c511[_0x588b8c(0x1d2)];return console['log']('‚úÖ\x20AmPay\x20TRY\x20payment\x20link\x20created\x20successfully'),console[_0x588b8c(0x148)](_0x588b8c(0x1f9),_0x2cdbd6),console[_0x588b8c(0x148)](_0x588b8c(0x1b9),_0xdfbef5),console['log'](_0x588b8c(0x1fc),_0x3a54b3),console['log'](_0x588b8c(0x1b2),_0x39c511[_0x588b8c(0x1d7)]),console['log']('üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20event...'),{'gateway_payment_id':_0xdfbef5||_0x3a54b3||_0x147f87,'payment_url':_0x2cdbd6||'','transaction_id':_0xdfbef5};}catch(_0x1dabc4){console[_0x588b8c(0x1b3)](_0x588b8c(0x167),_0x1dabc4),console['log'](_0x588b8c(0x177)),loggerService_1[_0x588b8c(0x199)][_0x588b8c(0x1e1)](_0x588b8c(0x19d),_0x1dabc4,_0x345139);throw _0x1dabc4;}}async['checkPaymentStatus'](_0x555893){const _0x404e21=a47_0x564056;console[_0x404e21(0x148)](_0x404e21(0x190),_0x555893);try{const _0x282d48={'client_merchant_id':this[_0x404e21(0x16b)],'system_id':_0x555893,'api_public_key':this[_0x404e21(0x1a6)]},_0x456a0f=await fetch(this[_0x404e21(0x204)]+_0x404e21(0x1df),{'method':_0x404e21(0x203),'headers':{'Content-Type':_0x404e21(0x1ac),'User-Agent':_0x404e21(0x1f8)},'body':JSON[_0x404e21(0x164)](_0x282d48)}),_0xfacd9a=await _0x456a0f[_0x404e21(0x159)]();console[_0x404e21(0x148)]('üìù\x20AmPay\x20TRY\x20status\x20raw\x20response:',_0xfacd9a);let _0x23e4e0;try{_0x23e4e0=JSON[_0x404e21(0x174)](_0xfacd9a);}catch(_0x2550eb){return console[_0x404e21(0x1b3)]('‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20status\x20response:',_0x2550eb),{'status':_0x404e21(0x1bd)};}console[_0x404e21(0x148)](_0x404e21(0x175),JSON['stringify'](_0x23e4e0,null,0x2));let _0x23243c=_0x404e21(0x1cb);if(_0x23e4e0['status'])switch(_0x23e4e0['status'][_0x404e21(0x1f3)]()){case _0x404e21(0x1ee):case _0x404e21(0x1de):case _0x404e21(0x16d):_0x23243c=_0x404e21(0x1f0);break;case'failed':case _0x404e21(0x1b3):case _0x404e21(0x18c):_0x23243c=_0x404e21(0x1bd);break;case _0x404e21(0x18e):case'timeout':_0x23243c='EXPIRED';break;case _0x404e21(0x196):case'processing':case _0x404e21(0x17f):default:_0x23243c=_0x404e21(0x1cb);break;}return{'status':_0x23243c,'amount':_0x23e4e0[_0x404e21(0x193)],'currency':_0x23e4e0[_0x404e21(0x14e)]};}catch(_0x316910){return console['error'](_0x404e21(0x20f),_0x316910),{'status':_0x404e21(0x1bd)};}}async[a47_0x564056(0x1e3)](_0x59fa62){const _0x3055f3=a47_0x564056;console[_0x3055f3(0x148)](_0x3055f3(0x1d1),JSON[_0x3055f3(0x164)](_0x59fa62,null,0x2));try{const _0xfe7138=_0x59fa62[_0x3055f3(0x1d2)]||_0x59fa62[_0x3055f3(0x1da)]||_0x59fa62['system_id'];if(!_0xfe7138){console['error'](_0x3055f3(0x15a));throw new Error('No\x20payment\x20ID\x20in\x20webhook\x20data');}let _0x22e1f9='PENDING';if(_0x59fa62['status'])switch(_0x59fa62[_0x3055f3(0x1d7)][_0x3055f3(0x1f3)]()){case'success':case _0x3055f3(0x1de):case _0x3055f3(0x16d):_0x22e1f9=_0x3055f3(0x1f0);break;case _0x3055f3(0x1c0):case'error':case'declined':_0x22e1f9=_0x3055f3(0x1bd);break;case'expired':case _0x3055f3(0x181):_0x22e1f9=_0x3055f3(0x1b0);break;case _0x3055f3(0x196):case'processing':case _0x3055f3(0x17f):default:_0x22e1f9='PENDING';break;}return console[_0x3055f3(0x148)](_0x3055f3(0x173)+_0xfe7138+_0x3055f3(0x197)+_0x22e1f9),{'paymentId':_0xfe7138,'status':_0x22e1f9,'amount':_0x59fa62['amount'],'currency':_0x59fa62[_0x3055f3(0x14e)]||_0x3055f3(0x15f)};}catch(_0x4722bd){console['error'](_0x3055f3(0x211),_0x4722bd);throw _0x4722bd;}}[a47_0x564056(0x1e8)](_0x14d5ea,_0x4951c2){const _0x1eaae5=a47_0x564056;return console['log'](_0x1eaae5(0x1dc)),!![];}}exports[a47_0x564056(0x1ca)]=AmPayTRYService;function a47_0x44f5(){const _0x16b9d4=['apiUrl','SMR','redirect_url','system_id','customerIp','NOR','customerCountry','AFG','failureUrl','258228gZNXvV','CYP','‚ùå\x20AmPay\x20TRY\x20status\x20check\x20failed:','TUR','‚ùå\x20AmPay\x20TRY\x20webhook\x20processing\x20failed:','PRY','SAU','HTTP\x20','USA','‚ùå\x20No\x20redirect_url\x20in\x20AmPay\x20TRY\x20response:','log','SVN','CHN','AND','CHE','JPN','currency','3684195PLCuoz','ampay.php','URY','GRC','ARG','OMN','üì°\x20AmPay\x20TRY\x20API\x20response\x20status:','EGY','MUS','HUN','text','‚ùå\x20No\x20payment\x20ID\x20found\x20in\x20AmPay\x20TRY\x20webhook\x20data','PRT','GBR','Amount:','UKR','TRY','QAT','LKA','\x20-\x20','MMR','stringify','HRV','MOZ','‚ùå\x20AmPay\x20TRY\x20payment\x20creation\x20failed:','JOR','ISL','SGP','CLIENT_MERCHANT_ID','LIE','paid','MKD','https://traffer.uk/gateway/ampay-try/','NLD','VAT','BOL','üìä\x20AmPay\x20TRY\x20webhook\x20processed:\x20','parse','üìä\x20AmPay\x20TRY\x20status\x20response:','email','üìù\x20Logging\x20AmPay\x20TRY\x20payment\x20creation\x20failure...','Order\x20ID:','ARM','MNE','SWE','LVA','MYS','üì•\x20AmPay\x20TRY\x20raw\x20response:','waiting','‚úÖ\x20AmPay\x20TRY\x20payment\x20created\x20successfully:','timeout','MLT','AUT','AmPay\x20TRY\x20API\x20error:\x20HTTP\x20','Phone:','4142rgzvSD','not\x20provided','IRL','KWT','TrapayAPI/1.0','AmPay\x20TRY\x20did\x20not\x20return\x20a\x20payment\x20URL','declined','ZMB','expired','GAM','üîç\x20Checking\x20AmPay\x20TRY\x20payment\x20status\x20for:','paymentId','SRB','amount','295720JXXYur','GEO','pending','\x20->\x20','PHL','loggerService','createPaymentLink','UGA','LAO','ampay-try','COL','IND','CZE','KOR','58b59ccbc03dcdcfc20d830edfba765dbf9f3531c692533d84b17938e9c40bda','ESP','KAZ','FRA','API_PUBLIC_KEY','TJK','ECU','Customer\x20Country\x20(2-letter):','PRK',',\x20using\x20TUR\x20as\x20fallback\x20for\x20AmPay\x20TRY','application/json','269520WQoePj','4slDSov','NGA','EXPIRED','CHL','Status:','error','THA','https://traffer.uk/gateway/ampay-try/webhook.php','MNG','Customer:','__esModule','System\x20ID:','MCO','DNK','Unknown\x20error','FAILED','error_message','TKM','failed','toUpperCase','XKX','PSE','convert2LetterTo3LetterCountryCode','1368305wVLEDy','KGZ','PER','KHM','SYR','AmPayTRYService','PENDING','orderId','SYC','RUS','MWI','18DvQQNs','üì•\x20Processing\x20AmPay\x20TRY\x20webhook:','tracker_id','AmPay\x20TRY\x20API\x20error:\x20','POL','Invalid\x20JSON\x20response\x20from\x20AmPay\x20TRY:\x20','LBN','status','VEN','message','client_transaction_id','GUY','üîê\x20AmPay\x20TRY\x20webhook\x20signature\x20verification\x20not\x20implemented\x20yet','Email:','completed','/status','KEN','logWebhookError','BIH','processWebhook','VNM','warn','614642cffxWA','üáπüá∑\x20AmPay\x20TRY\x20service\x20initialized\x20with\x20IBAN\x20Bank\x20Transfer\x20TR\x20processing','verifyWebhookSignature','PAK','IRQ','Bank\x20Transfer\x20TR','CAN','DEU','success','IRN','PAID','FIN','ARE','toLowerCase','BTN','MDV','BGD','üáπüá∑\x20Creating\x20AmPay\x20TRY\x20payment\x20link...','TrapayEnd/1.0','Payment\x20URL:','BRA','üìä\x20AmPay\x20TRY\x20parsed\x20response:','Tracker\x20ID:','YEM','Customer\x20IP:','‚ùå\x20Failed\x20to\x20parse\x20AmPay\x20TRY\x20API\x20response:','ALB','defineProperty','AmPay\x20TRY\x20payment\x20creation\x20failed:\x20','POST'];a47_0x44f5=function(){return _0x16b9d4;};return a47_0x44f5();}