'use strict';const a47_0x23640a=a47_0x5c6a;(function(_0x21f000,_0x3068d8){const _0x5e00cf=a47_0x5c6a,_0x36441a=_0x21f000();while(!![]){try{const _0x405684=-parseInt(_0x5e00cf(0x120))/0x1+-parseInt(_0x5e00cf(0x129))/0x2+-parseInt(_0x5e00cf(0x12d))/0x3*(parseInt(_0x5e00cf(0x127))/0x4)+-parseInt(_0x5e00cf(0x122))/0x5+parseInt(_0x5e00cf(0x136))/0x6+parseInt(_0x5e00cf(0x132))/0x7+-parseInt(_0x5e00cf(0x124))/0x8*(-parseInt(_0x5e00cf(0x130))/0x9);if(_0x405684===_0x3068d8)break;else _0x36441a['push'](_0x36441a['shift']());}catch(_0x1dbdd7){_0x36441a['push'](_0x36441a['shift']());}}}(a47_0x19b3,0xeda29));function a47_0x19b3(){const _0x1b2145=['parseWebhookEvents','defineProperty','1126686PFDZRQ','default','3488735sRVqmz','isArray','536iHgmdD','Shop\x20settings\x20not\x20found','update','56788lHLuYf','webhookUrl','1830192GsRulC','IntegrationsService','updateWebhookSettings','string','207oAKVYi','../config/database','__importDefault','315009cnyszr','webhookEvents','4936904nvmUix','ensureSettingsExist','__esModule','findUnique','9852816EuLOBw','getIntegrations'];a47_0x19b3=function(){return _0x1b2145;};return a47_0x19b3();}var __importDefault=this&&this[a47_0x23640a(0x12f)]||function(_0x13fecc){const _0x12ce4c=a47_0x23640a;return _0x13fecc&&_0x13fecc[_0x12ce4c(0x134)]?_0x13fecc:{'default':_0x13fecc};};Object[a47_0x23640a(0x11f)](exports,a47_0x23640a(0x134),{'value':!![]}),exports[a47_0x23640a(0x12a)]=void 0x0;function a47_0x5c6a(_0xee75cd,_0x58fbe3){const _0x19b368=a47_0x19b3();return a47_0x5c6a=function(_0x5c6ac4,_0x5501da){_0x5c6ac4=_0x5c6ac4-0x11d;let _0xc31f18=_0x19b368[_0x5c6ac4];return _0xc31f18;},a47_0x5c6a(_0xee75cd,_0x58fbe3);}const database_1=__importDefault(require(a47_0x23640a(0x12e)));class IntegrationsService{[a47_0x23640a(0x11e)](_0x4be155){const _0x575edb=a47_0x23640a;if(!_0x4be155)return[];if(Array['isArray'](_0x4be155))return _0x4be155;if(typeof _0x4be155===_0x575edb(0x12c))try{const _0x4b2f81=JSON['parse'](_0x4be155);return Array[_0x575edb(0x123)](_0x4b2f81)?_0x4b2f81:[];}catch{return[];}return[];}async[a47_0x23640a(0x11d)](_0x4c92ec){const _0x3a8d54=a47_0x23640a;await this[_0x3a8d54(0x133)](_0x4c92ec);const _0x32ffb0=await database_1['default']['shopSettings'][_0x3a8d54(0x135)]({'where':{'shopId':_0x4c92ec},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x32ffb0)throw new Error(_0x3a8d54(0x125));return{'webhook':{'url':_0x32ffb0[_0x3a8d54(0x128)],'events':this[_0x3a8d54(0x11e)](_0x32ffb0[_0x3a8d54(0x131)])}};}async[a47_0x23640a(0x12b)](_0x3809da,_0x20d078){const _0x19d0dd=a47_0x23640a;await this['ensureSettingsExist'](_0x3809da);const _0x325c0b={};_0x20d078[_0x19d0dd(0x128)]!==undefined&&(_0x325c0b[_0x19d0dd(0x128)]=_0x20d078[_0x19d0dd(0x128)]||null),_0x20d078[_0x19d0dd(0x131)]!==undefined&&(_0x325c0b['webhookEvents']=_0x20d078['webhookEvents']||[]),await database_1[_0x19d0dd(0x121)]['shopSettings'][_0x19d0dd(0x126)]({'where':{'shopId':_0x3809da},'data':_0x325c0b});}async['ensureSettingsExist'](_0x2b1bda){const _0x27bfd7=a47_0x23640a,_0x4465cf=await database_1[_0x27bfd7(0x121)]['shopSettings'][_0x27bfd7(0x135)]({'where':{'shopId':_0x2b1bda}});!_0x4465cf&&await database_1[_0x27bfd7(0x121)]['shopSettings']['create']({'data':{'shopId':_0x2b1bda}});}}exports[a47_0x23640a(0x12a)]=IntegrationsService;