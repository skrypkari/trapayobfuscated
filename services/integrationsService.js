'use strict';const a43_0x3ce8b4=a43_0x4bcf;(function(_0x2cfe1b,_0x1888d0){const _0x5b7473=a43_0x4bcf,_0x3faab9=_0x2cfe1b();while(!![]){try{const _0x33cc26=-parseInt(_0x5b7473(0x10e))/0x1+-parseInt(_0x5b7473(0x108))/0x2*(parseInt(_0x5b7473(0x11a))/0x3)+-parseInt(_0x5b7473(0x117))/0x4+parseInt(_0x5b7473(0x113))/0x5*(parseInt(_0x5b7473(0x11b))/0x6)+-parseInt(_0x5b7473(0x10b))/0x7+parseInt(_0x5b7473(0x10a))/0x8+parseInt(_0x5b7473(0x102))/0x9*(parseInt(_0x5b7473(0x118))/0xa);if(_0x33cc26===_0x1888d0)break;else _0x3faab9['push'](_0x3faab9['shift']());}catch(_0x169989){_0x3faab9['push'](_0x3faab9['shift']());}}}(a43_0x1057,0x55652));var __importDefault=this&&this[a43_0x3ce8b4(0x107)]||function(_0xbc9607){const _0x1d32b4=a43_0x3ce8b4;return _0xbc9607&&_0xbc9607[_0x1d32b4(0x10f)]?_0xbc9607:{'default':_0xbc9607};};function a43_0x4bcf(_0xcb5f4e,_0x7a5ff2){const _0x10577c=a43_0x1057();return a43_0x4bcf=function(_0x4bcf68,_0x2ff4ce){_0x4bcf68=_0x4bcf68-0x102;let _0x30a347=_0x10577c[_0x4bcf68];return _0x30a347;},a43_0x4bcf(_0xcb5f4e,_0x7a5ff2);}Object[a43_0x3ce8b4(0x109)](exports,a43_0x3ce8b4(0x10f),{'value':!![]}),exports[a43_0x3ce8b4(0x11c)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a43_0x1057(){const _0x5bf455=['IntegrationsService','10425249dklCoP','string','create','isArray','shopSettings','__importDefault','2678hKAiYo','defineProperty','1794456kLTLsT','2096829YltxpO','webhookUrl','getIntegrations','503899kxcKkL','__esModule','parse','default','parseWebhookEvents','1437220REIrss','webhookEvents','Shop\x20settings\x20not\x20found','findUnique','1251676GUZyJi','10OYWMKf','ensureSettingsExist','1101oogZKL','12GhaHfZ'];a43_0x1057=function(){return _0x5bf455;};return a43_0x1057();}class IntegrationsService{[a43_0x3ce8b4(0x112)](_0x5e95d6){const _0x2cfb25=a43_0x3ce8b4;if(!_0x5e95d6)return[];if(Array[_0x2cfb25(0x105)](_0x5e95d6))return _0x5e95d6;if(typeof _0x5e95d6===_0x2cfb25(0x103))try{const _0x45965f=JSON[_0x2cfb25(0x110)](_0x5e95d6);return Array[_0x2cfb25(0x105)](_0x45965f)?_0x45965f:[];}catch{return[];}return[];}async[a43_0x3ce8b4(0x10d)](_0x1f6ded){const _0x349b22=a43_0x3ce8b4;await this[_0x349b22(0x119)](_0x1f6ded);const _0x17445a=await database_1[_0x349b22(0x111)][_0x349b22(0x106)][_0x349b22(0x116)]({'where':{'shopId':_0x1f6ded},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x17445a)throw new Error(_0x349b22(0x115));return{'webhook':{'url':_0x17445a['webhookUrl'],'events':this[_0x349b22(0x112)](_0x17445a[_0x349b22(0x114)])}};}async['updateWebhookSettings'](_0x36fcc9,_0x5286e0){const _0x1f0eec=a43_0x3ce8b4;await this[_0x1f0eec(0x119)](_0x36fcc9);const _0x16d104={};_0x5286e0[_0x1f0eec(0x10c)]!==undefined&&(_0x16d104[_0x1f0eec(0x10c)]=_0x5286e0[_0x1f0eec(0x10c)]||null),_0x5286e0['webhookEvents']!==undefined&&(_0x16d104[_0x1f0eec(0x114)]=_0x5286e0[_0x1f0eec(0x114)]||[]),await database_1[_0x1f0eec(0x111)]['shopSettings']['update']({'where':{'shopId':_0x36fcc9},'data':_0x16d104});}async[a43_0x3ce8b4(0x119)](_0x357d7b){const _0xf6f087=a43_0x3ce8b4,_0x152c5e=await database_1[_0xf6f087(0x111)][_0xf6f087(0x106)]['findUnique']({'where':{'shopId':_0x357d7b}});!_0x152c5e&&await database_1['default'][_0xf6f087(0x106)][_0xf6f087(0x104)]({'data':{'shopId':_0x357d7b}});}}exports[a43_0x3ce8b4(0x11c)]=IntegrationsService;