'use strict';const a47_0x56d4b0=a47_0x44cd;function a47_0x44cd(_0xb9b21a,_0x13ec4c){const _0x5094e0=a47_0x5094();return a47_0x44cd=function(_0x44cdf0,_0x153968){_0x44cdf0=_0x44cdf0-0xd1;let _0x278c26=_0x5094e0[_0x44cdf0];return _0x278c26;},a47_0x44cd(_0xb9b21a,_0x13ec4c);}(function(_0x56e996,_0x17ba84){const _0x2e325b=a47_0x44cd,_0x2bac86=_0x56e996();while(!![]){try{const _0x5b8e19=parseInt(_0x2e325b(0xd7))/0x1+-parseInt(_0x2e325b(0xd1))/0x2+parseInt(_0x2e325b(0xe2))/0x3+parseInt(_0x2e325b(0xde))/0x4*(parseInt(_0x2e325b(0xe8))/0x5)+parseInt(_0x2e325b(0xe1))/0x6+-parseInt(_0x2e325b(0xe7))/0x7*(-parseInt(_0x2e325b(0xdf))/0x8)+parseInt(_0x2e325b(0xd3))/0x9*(-parseInt(_0x2e325b(0xdd))/0xa);if(_0x5b8e19===_0x17ba84)break;else _0x2bac86['push'](_0x2bac86['shift']());}catch(_0x4019dd){_0x2bac86['push'](_0x2bac86['shift']());}}}(a47_0x5094,0x8d7d5));var __importDefault=this&&this['__importDefault']||function(_0x15f23a){const _0x28e08c=a47_0x44cd;return _0x15f23a&&_0x15f23a[_0x28e08c(0xd5)]?_0x15f23a:{'default':_0x15f23a};};Object[a47_0x56d4b0(0xe3)](exports,a47_0x56d4b0(0xd5),{'value':!![]}),exports[a47_0x56d4b0(0xd4)]=void 0x0;function a47_0x5094(){const _0x1d820a=['getIntegrations','4743431qleBTc','5VvdMxB','isArray','parse','2294190EUYsAr','Shop\x20settings\x20not\x20found','2693403NNYDkp','IntegrationsService','__esModule','ensureSettingsExist','757537XctVxY','update','findUnique','parseWebhookEvents','create','shopSettings','20JaezsU','2002004WdsLVH','8IpMWuW','webhookUrl','203124WFqSpy','1066935JZCUav','defineProperty','default','webhookEvents'];a47_0x5094=function(){return _0x1d820a;};return a47_0x5094();}const database_1=__importDefault(require('../config/database'));class IntegrationsService{[a47_0x56d4b0(0xda)](_0x38cd0d){const _0x4a1443=a47_0x56d4b0;if(!_0x38cd0d)return[];if(Array[_0x4a1443(0xe9)](_0x38cd0d))return _0x38cd0d;if(typeof _0x38cd0d==='string')try{const _0x28911b=JSON[_0x4a1443(0xea)](_0x38cd0d);return Array['isArray'](_0x28911b)?_0x28911b:[];}catch{return[];}return[];}async[a47_0x56d4b0(0xe6)](_0x4dbbb5){const _0x4cfc33=a47_0x56d4b0;await this[_0x4cfc33(0xd6)](_0x4dbbb5);const _0x233de1=await database_1['default']['shopSettings'][_0x4cfc33(0xd9)]({'where':{'shopId':_0x4dbbb5},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x233de1)throw new Error(_0x4cfc33(0xd2));return{'webhook':{'url':_0x233de1['webhookUrl'],'events':this[_0x4cfc33(0xda)](_0x233de1[_0x4cfc33(0xe5)])}};}async['updateWebhookSettings'](_0xb54750,_0x309869){const _0x1f3ba7=a47_0x56d4b0;await this['ensureSettingsExist'](_0xb54750);const _0x18156c={};_0x309869[_0x1f3ba7(0xe0)]!==undefined&&(_0x18156c[_0x1f3ba7(0xe0)]=_0x309869['webhookUrl']||null),_0x309869['webhookEvents']!==undefined&&(_0x18156c[_0x1f3ba7(0xe5)]=_0x309869[_0x1f3ba7(0xe5)]||[]),await database_1['default'][_0x1f3ba7(0xdc)][_0x1f3ba7(0xd8)]({'where':{'shopId':_0xb54750},'data':_0x18156c});}async[a47_0x56d4b0(0xd6)](_0x5b3397){const _0x4d3f28=a47_0x56d4b0,_0x279ead=await database_1['default'][_0x4d3f28(0xdc)][_0x4d3f28(0xd9)]({'where':{'shopId':_0x5b3397}});!_0x279ead&&await database_1[_0x4d3f28(0xe4)][_0x4d3f28(0xdc)][_0x4d3f28(0xdb)]({'data':{'shopId':_0x5b3397}});}}exports[a47_0x56d4b0(0xd4)]=IntegrationsService;