'use strict';const a47_0x477be1=a47_0x38e6;function a47_0x38e6(_0x1f25e5,_0x2ea15d){const _0x485843=a47_0x4858();return a47_0x38e6=function(_0x38e666,_0x233eec){_0x38e666=_0x38e666-0x17b;let _0x10c93a=_0x485843[_0x38e666];return _0x10c93a;},a47_0x38e6(_0x1f25e5,_0x2ea15d);}(function(_0xd0c7c3,_0x49075e){const _0xdfb849=a47_0x38e6,_0x126ba9=_0xd0c7c3();while(!![]){try{const _0x1afb4d=parseInt(_0xdfb849(0x180))/0x1+-parseInt(_0xdfb849(0x183))/0x2*(parseInt(_0xdfb849(0x17e))/0x3)+parseInt(_0xdfb849(0x189))/0x4+parseInt(_0xdfb849(0x181))/0x5*(parseInt(_0xdfb849(0x18e))/0x6)+-parseInt(_0xdfb849(0x18f))/0x7*(-parseInt(_0xdfb849(0x182))/0x8)+-parseInt(_0xdfb849(0x185))/0x9+-parseInt(_0xdfb849(0x184))/0xa;if(_0x1afb4d===_0x49075e)break;else _0x126ba9['push'](_0x126ba9['shift']());}catch(_0x3b16ea){_0x126ba9['push'](_0x126ba9['shift']());}}}(a47_0x4858,0x7dc4c));var __importDefault=this&&this[a47_0x477be1(0x193)]||function(_0xb1d48b){const _0x52088b=a47_0x477be1;return _0xb1d48b&&_0xb1d48b[_0x52088b(0x17b)]?_0xb1d48b:{'default':_0xb1d48b};};Object[a47_0x477be1(0x18a)](exports,a47_0x477be1(0x17b),{'value':!![]}),exports[a47_0x477be1(0x18c)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a47_0x4858(){const _0x51b0aa=['parse','string','4030100QOrCeR','defineProperty','shopSettings','IntegrationsService','parseWebhookEvents','36gmzjjH','634564WzaaBi','webhookUrl','isArray','findUnique','__importDefault','__esModule','update','default','3yKosNe','getIntegrations','780642CxFJmv','75690woxxYb','64dPEiAT','63634PmyJLw','17432320WAdZZV','2826126AWEFpo','webhookEvents'];a47_0x4858=function(){return _0x51b0aa;};return a47_0x4858();}class IntegrationsService{[a47_0x477be1(0x18d)](_0x1a34a7){const _0xac8749=a47_0x477be1;if(!_0x1a34a7)return[];if(Array['isArray'](_0x1a34a7))return _0x1a34a7;if(typeof _0x1a34a7===_0xac8749(0x188))try{const _0x26c09a=JSON[_0xac8749(0x187)](_0x1a34a7);return Array[_0xac8749(0x191)](_0x26c09a)?_0x26c09a:[];}catch{return[];}return[];}async[a47_0x477be1(0x17f)](_0x3084f6){const _0x44f9ae=a47_0x477be1;await this['ensureSettingsExist'](_0x3084f6);const _0x23ec07=await database_1['default'][_0x44f9ae(0x18b)]['findUnique']({'where':{'shopId':_0x3084f6},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x23ec07)throw new Error('Shop\x20settings\x20not\x20found');return{'webhook':{'url':_0x23ec07[_0x44f9ae(0x190)],'events':this[_0x44f9ae(0x18d)](_0x23ec07[_0x44f9ae(0x186)])}};}async['updateWebhookSettings'](_0x6f8cbb,_0x12c72a){const _0x3a0af1=a47_0x477be1;await this['ensureSettingsExist'](_0x6f8cbb);const _0x248e0c={};_0x12c72a[_0x3a0af1(0x190)]!==undefined&&(_0x248e0c[_0x3a0af1(0x190)]=_0x12c72a[_0x3a0af1(0x190)]||null),_0x12c72a['webhookEvents']!==undefined&&(_0x248e0c[_0x3a0af1(0x186)]=_0x12c72a[_0x3a0af1(0x186)]||[]),await database_1[_0x3a0af1(0x17d)][_0x3a0af1(0x18b)][_0x3a0af1(0x17c)]({'where':{'shopId':_0x6f8cbb},'data':_0x248e0c});}async['ensureSettingsExist'](_0x182d5c){const _0x58a90a=a47_0x477be1,_0x297198=await database_1[_0x58a90a(0x17d)][_0x58a90a(0x18b)][_0x58a90a(0x192)]({'where':{'shopId':_0x182d5c}});!_0x297198&&await database_1[_0x58a90a(0x17d)][_0x58a90a(0x18b)]['create']({'data':{'shopId':_0x182d5c}});}}exports[a47_0x477be1(0x18c)]=IntegrationsService;