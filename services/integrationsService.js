'use strict';const a47_0x4b9f1d=a47_0x5758;function a47_0x5758(_0x2249c9,_0x2c2b23){const _0x5c2435=a47_0x5c24();return a47_0x5758=function(_0x575869,_0x2e1cca){_0x575869=_0x575869-0xb0;let _0x3854e7=_0x5c2435[_0x575869];return _0x3854e7;},a47_0x5758(_0x2249c9,_0x2c2b23);}(function(_0x354882,_0x557ca2){const _0x2fe52c=a47_0x5758,_0x166c91=_0x354882();while(!![]){try{const _0x34d445=-parseInt(_0x2fe52c(0xb6))/0x1+-parseInt(_0x2fe52c(0xc3))/0x2*(-parseInt(_0x2fe52c(0xb7))/0x3)+-parseInt(_0x2fe52c(0xc0))/0x4+parseInt(_0x2fe52c(0xc4))/0x5+-parseInt(_0x2fe52c(0xc5))/0x6*(-parseInt(_0x2fe52c(0xbf))/0x7)+-parseInt(_0x2fe52c(0xb2))/0x8*(parseInt(_0x2fe52c(0xb9))/0x9)+-parseInt(_0x2fe52c(0xbe))/0xa*(-parseInt(_0x2fe52c(0xc6))/0xb);if(_0x34d445===_0x557ca2)break;else _0x166c91['push'](_0x166c91['shift']());}catch(_0x4d5fab){_0x166c91['push'](_0x166c91['shift']());}}}(a47_0x5c24,0x8f7b8));var __importDefault=this&&this[a47_0x4b9f1d(0xba)]||function(_0x537522){return _0x537522&&_0x537522['__esModule']?_0x537522:{'default':_0x537522};};Object['defineProperty'](exports,a47_0x4b9f1d(0xb5),{'value':!![]}),exports['IntegrationsService']=void 0x0;const database_1=__importDefault(require('../config/database'));function a47_0x5c24(){const _0xeacfec=['369iCZnPk','__importDefault','update','findUnique','isArray','4742500DKrORx','28hxmiwu','1683332psjjss','Shop\x20settings\x20not\x20found','ensureSettingsExist','626GPSQRz','949215NLWgtg','1360986DqwoMX','11pUebAf','webhookEvents','default','shopSettings','177856ShpbIx','IntegrationsService','getIntegrations','__esModule','406637pcjNJG','7239XbmboI','webhookUrl'];a47_0x5c24=function(){return _0xeacfec;};return a47_0x5c24();}class IntegrationsService{['parseWebhookEvents'](_0x1ff93b){const _0x1e043f=a47_0x4b9f1d;if(!_0x1ff93b)return[];if(Array[_0x1e043f(0xbd)](_0x1ff93b))return _0x1ff93b;if(typeof _0x1ff93b==='string')try{const _0x55d70b=JSON['parse'](_0x1ff93b);return Array[_0x1e043f(0xbd)](_0x55d70b)?_0x55d70b:[];}catch{return[];}return[];}async[a47_0x4b9f1d(0xb4)](_0x29245b){const _0x4809c5=a47_0x4b9f1d;await this[_0x4809c5(0xc2)](_0x29245b);const _0x340f8a=await database_1[_0x4809c5(0xb0)][_0x4809c5(0xb1)][_0x4809c5(0xbc)]({'where':{'shopId':_0x29245b},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x340f8a)throw new Error(_0x4809c5(0xc1));return{'webhook':{'url':_0x340f8a[_0x4809c5(0xb8)],'events':this['parseWebhookEvents'](_0x340f8a[_0x4809c5(0xc7)])}};}async['updateWebhookSettings'](_0x4e3f0e,_0x13a246){const _0x1a9cea=a47_0x4b9f1d;await this[_0x1a9cea(0xc2)](_0x4e3f0e);const _0x312031={};_0x13a246[_0x1a9cea(0xb8)]!==undefined&&(_0x312031[_0x1a9cea(0xb8)]=_0x13a246['webhookUrl']||null),_0x13a246[_0x1a9cea(0xc7)]!==undefined&&(_0x312031[_0x1a9cea(0xc7)]=_0x13a246[_0x1a9cea(0xc7)]||[]),await database_1[_0x1a9cea(0xb0)][_0x1a9cea(0xb1)][_0x1a9cea(0xbb)]({'where':{'shopId':_0x4e3f0e},'data':_0x312031});}async['ensureSettingsExist'](_0x32bc4f){const _0x38ed41=a47_0x4b9f1d,_0x4f1506=await database_1[_0x38ed41(0xb0)][_0x38ed41(0xb1)][_0x38ed41(0xbc)]({'where':{'shopId':_0x32bc4f}});!_0x4f1506&&await database_1[_0x38ed41(0xb0)][_0x38ed41(0xb1)]['create']({'data':{'shopId':_0x32bc4f}});}}exports[a47_0x4b9f1d(0xb3)]=IntegrationsService;