'use strict';const a47_0x80683=a47_0x3b49;(function(_0x193b69,_0x496a0b){const _0x466f01=a47_0x3b49,_0x4a68db=_0x193b69();while(!![]){try{const _0x23a868=parseInt(_0x466f01(0xe4))/0x1+parseInt(_0x466f01(0xec))/0x2+-parseInt(_0x466f01(0xdc))/0x3+parseInt(_0x466f01(0xee))/0x4*(-parseInt(_0x466f01(0xe5))/0x5)+-parseInt(_0x466f01(0xea))/0x6*(-parseInt(_0x466f01(0xe0))/0x7)+-parseInt(_0x466f01(0xe2))/0x8+parseInt(_0x466f01(0xe1))/0x9;if(_0x23a868===_0x496a0b)break;else _0x4a68db['push'](_0x4a68db['shift']());}catch(_0x5d2780){_0x4a68db['push'](_0x4a68db['shift']());}}}(a47_0xe102,0x93099));var __importDefault=this&&this[a47_0x80683(0xe8)]||function(_0x58c0a0){const _0x1a1200=a47_0x80683;return _0x58c0a0&&_0x58c0a0[_0x1a1200(0xd9)]?_0x58c0a0:{'default':_0x58c0a0};};function a47_0xe102(){const _0x139a4b=['IntegrationsService','17224UfMVDh','parseWebhookEvents','getIntegrations','webhookEvents','ensureSettingsExist','__esModule','../config/database','create','3060951uKulEU','Shop\x20settings\x20not\x20found','webhookUrl','findUnique','14puXHTD','9682173MrOfMo','2390344JIybgk','isArray','459143KgcpGo','905PJYvcU','default','parse','__importDefault','shopSettings','1106106uSeCeP','update','1594238CyDgQm'];a47_0xe102=function(){return _0x139a4b;};return a47_0xe102();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['IntegrationsService']=void 0x0;function a47_0x3b49(_0x2c570c,_0x3c5a43){const _0xe1022=a47_0xe102();return a47_0x3b49=function(_0x3b494a,_0x5befc6){_0x3b494a=_0x3b494a-0xd7;let _0x507e16=_0xe1022[_0x3b494a];return _0x507e16;},a47_0x3b49(_0x2c570c,_0x3c5a43);}const database_1=__importDefault(require(a47_0x80683(0xda)));class IntegrationsService{[a47_0x80683(0xef)](_0x552c7f){const _0x5bccd0=a47_0x80683;if(!_0x552c7f)return[];if(Array['isArray'](_0x552c7f))return _0x552c7f;if(typeof _0x552c7f==='string')try{const _0x3a3472=JSON[_0x5bccd0(0xe7)](_0x552c7f);return Array[_0x5bccd0(0xe3)](_0x3a3472)?_0x3a3472:[];}catch{return[];}return[];}async[a47_0x80683(0xf0)](_0x1f12e6){const _0x50316a=a47_0x80683;await this[_0x50316a(0xd8)](_0x1f12e6);const _0x25b378=await database_1[_0x50316a(0xe6)][_0x50316a(0xe9)][_0x50316a(0xdf)]({'where':{'shopId':_0x1f12e6},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x25b378)throw new Error(_0x50316a(0xdd));return{'webhook':{'url':_0x25b378['webhookUrl'],'events':this[_0x50316a(0xef)](_0x25b378[_0x50316a(0xd7)])}};}async['updateWebhookSettings'](_0xc597b3,_0x56608c){const _0x3e1e05=a47_0x80683;await this[_0x3e1e05(0xd8)](_0xc597b3);const _0x176b5a={};_0x56608c[_0x3e1e05(0xde)]!==undefined&&(_0x176b5a[_0x3e1e05(0xde)]=_0x56608c[_0x3e1e05(0xde)]||null),_0x56608c['webhookEvents']!==undefined&&(_0x176b5a[_0x3e1e05(0xd7)]=_0x56608c[_0x3e1e05(0xd7)]||[]),await database_1[_0x3e1e05(0xe6)][_0x3e1e05(0xe9)][_0x3e1e05(0xeb)]({'where':{'shopId':_0xc597b3},'data':_0x176b5a});}async[a47_0x80683(0xd8)](_0x4179a8){const _0x4ab4c8=a47_0x80683,_0x259a69=await database_1[_0x4ab4c8(0xe6)]['shopSettings'][_0x4ab4c8(0xdf)]({'where':{'shopId':_0x4179a8}});!_0x259a69&&await database_1[_0x4ab4c8(0xe6)][_0x4ab4c8(0xe9)][_0x4ab4c8(0xdb)]({'data':{'shopId':_0x4179a8}});}}exports[a47_0x80683(0xed)]=IntegrationsService;