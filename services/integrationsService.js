'use strict';const a43_0x5869cd=a43_0xcdc0;(function(_0x2ffd2d,_0x1c3e27){const _0x586bd7=a43_0xcdc0,_0x5bf051=_0x2ffd2d();while(!![]){try{const _0xaea950=-parseInt(_0x586bd7(0xd9))/0x1*(-parseInt(_0x586bd7(0xdb))/0x2)+-parseInt(_0x586bd7(0xf0))/0x3*(-parseInt(_0x586bd7(0xdd))/0x4)+-parseInt(_0x586bd7(0xeb))/0x5*(parseInt(_0x586bd7(0xe1))/0x6)+parseInt(_0x586bd7(0xdc))/0x7*(parseInt(_0x586bd7(0xec))/0x8)+parseInt(_0x586bd7(0xe0))/0x9*(-parseInt(_0x586bd7(0xef))/0xa)+-parseInt(_0x586bd7(0xe6))/0xb*(parseInt(_0x586bd7(0xe5))/0xc)+-parseInt(_0x586bd7(0xe7))/0xd*(-parseInt(_0x586bd7(0xdf))/0xe);if(_0xaea950===_0x1c3e27)break;else _0x5bf051['push'](_0x5bf051['shift']());}catch(_0x1530b3){_0x5bf051['push'](_0x5bf051['shift']());}}}(a43_0x3cbe,0x436ab));var __importDefault=this&&this[a43_0x5869cd(0xed)]||function(_0x9055e6){const _0x364675=a43_0x5869cd;return _0x9055e6&&_0x9055e6[_0x364675(0xe3)]?_0x9055e6:{'default':_0x9055e6};};Object['defineProperty'](exports,a43_0x5869cd(0xe3),{'value':!![]}),exports[a43_0x5869cd(0xda)]=void 0x0;const database_1=__importDefault(require(a43_0x5869cd(0xea)));function a43_0x3cbe(){const _0xffc58a=['16440uYzDVV','webhookEvents','__esModule','Shop\x20settings\x20not\x20found','84GiliEt','277057SRbotP','10386857DcUhWJ','ensureSettingsExist','update','../config/database','775VKGAsN','30664vcOuJt','__importDefault','getIntegrations','4558330jfkdzO','27KhUIbP','shopSettings','parseWebhookEvents','findUnique','default','53945PaOarB','IntegrationsService','10Ugqriu','126mMrCqa','86788vslQeE','webhookUrl','14fAwzLd','9awRoKS'];a43_0x3cbe=function(){return _0xffc58a;};return a43_0x3cbe();}function a43_0xcdc0(_0x1307ca,_0xcbd397){const _0x3cbe74=a43_0x3cbe();return a43_0xcdc0=function(_0xcdc00c,_0x4190b4){_0xcdc00c=_0xcdc00c-0xd8;let _0x4be320=_0x3cbe74[_0xcdc00c];return _0x4be320;},a43_0xcdc0(_0x1307ca,_0xcbd397);}class IntegrationsService{['parseWebhookEvents'](_0x3d9c72){if(!_0x3d9c72)return[];if(Array['isArray'](_0x3d9c72))return _0x3d9c72;if(typeof _0x3d9c72==='string')try{const _0x371198=JSON['parse'](_0x3d9c72);return Array['isArray'](_0x371198)?_0x371198:[];}catch{return[];}return[];}async[a43_0x5869cd(0xee)](_0x4cf39d){const _0x521346=a43_0x5869cd;await this[_0x521346(0xe8)](_0x4cf39d);const _0x1fb77c=await database_1[_0x521346(0xd8)][_0x521346(0xf1)][_0x521346(0xf3)]({'where':{'shopId':_0x4cf39d},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x1fb77c)throw new Error(_0x521346(0xe4));return{'webhook':{'url':_0x1fb77c[_0x521346(0xde)],'events':this[_0x521346(0xf2)](_0x1fb77c['webhookEvents'])}};}async['updateWebhookSettings'](_0x41f559,_0x2858c3){const _0x47a084=a43_0x5869cd;await this['ensureSettingsExist'](_0x41f559);const _0x3d6a8e={};_0x2858c3[_0x47a084(0xde)]!==undefined&&(_0x3d6a8e[_0x47a084(0xde)]=_0x2858c3[_0x47a084(0xde)]||null),_0x2858c3[_0x47a084(0xe2)]!==undefined&&(_0x3d6a8e['webhookEvents']=_0x2858c3[_0x47a084(0xe2)]||[]),await database_1['default'][_0x47a084(0xf1)][_0x47a084(0xe9)]({'where':{'shopId':_0x41f559},'data':_0x3d6a8e});}async[a43_0x5869cd(0xe8)](_0x356ba0){const _0x8b1e01=a43_0x5869cd,_0x1520a9=await database_1[_0x8b1e01(0xd8)]['shopSettings'][_0x8b1e01(0xf3)]({'where':{'shopId':_0x356ba0}});!_0x1520a9&&await database_1['default'][_0x8b1e01(0xf1)]['create']({'data':{'shopId':_0x356ba0}});}}exports[a43_0x5869cd(0xda)]=IntegrationsService;