'use strict';const a47_0x5e2ac6=a47_0x2fb5;function a47_0x1d4b(){const _0x2511f7=['1305NirKIT','default','findUnique','210753UGLZON','IntegrationsService','4609073VFiEwJ','create','defineProperty','shopSettings','string','6ytbrSA','parseWebhookEvents','226950MdRmOv','../config/database','__esModule','webhookEvents','2682042QurPZg','getIntegrations','2373365Ksmcbd','webhookUrl','ensureSettingsExist','4952Exlvwr','20ucWfhr','2UvWNdV','update','4808976GkYCCU','isArray'];a47_0x1d4b=function(){return _0x2511f7;};return a47_0x1d4b();}function a47_0x2fb5(_0x139499,_0x184464){const _0x1d4b50=a47_0x1d4b();return a47_0x2fb5=function(_0x2fb5a2,_0x37e017){_0x2fb5a2=_0x2fb5a2-0x17f;let _0x388e80=_0x1d4b50[_0x2fb5a2];return _0x388e80;},a47_0x2fb5(_0x139499,_0x184464);}(function(_0x2081ec,_0x2a71bc){const _0x1552fc=a47_0x2fb5,_0x135efe=_0x2081ec();while(!![]){try{const _0x529f66=-parseInt(_0x1552fc(0x180))/0x1*(parseInt(_0x1552fc(0x190))/0x2)+-parseInt(_0x1552fc(0x184))/0x3*(-parseInt(_0x1552fc(0x199))/0x4)+parseInt(_0x1552fc(0x196))/0x5+parseInt(_0x1552fc(0x18e))/0x6*(parseInt(_0x1552fc(0x189))/0x7)+-parseInt(_0x1552fc(0x182))/0x8+parseInt(_0x1552fc(0x187))/0x9+-parseInt(_0x1552fc(0x17f))/0xa*(parseInt(_0x1552fc(0x194))/0xb);if(_0x529f66===_0x2a71bc)break;else _0x135efe['push'](_0x135efe['shift']());}catch(_0x5f27b2){_0x135efe['push'](_0x135efe['shift']());}}}(a47_0x1d4b,0x5c9cf));var __importDefault=this&&this['__importDefault']||function(_0x1e165a){const _0x51da9a=a47_0x2fb5;return _0x1e165a&&_0x1e165a[_0x51da9a(0x192)]?_0x1e165a:{'default':_0x1e165a};};Object[a47_0x5e2ac6(0x18b)](exports,a47_0x5e2ac6(0x192),{'value':!![]}),exports['IntegrationsService']=void 0x0;const database_1=__importDefault(require(a47_0x5e2ac6(0x191)));class IntegrationsService{['parseWebhookEvents'](_0x418a7c){const _0x255246=a47_0x5e2ac6;if(!_0x418a7c)return[];if(Array[_0x255246(0x183)](_0x418a7c))return _0x418a7c;if(typeof _0x418a7c===_0x255246(0x18d))try{const _0x79f068=JSON['parse'](_0x418a7c);return Array[_0x255246(0x183)](_0x79f068)?_0x79f068:[];}catch{return[];}return[];}async[a47_0x5e2ac6(0x195)](_0x55321f){const _0x54e42c=a47_0x5e2ac6;await this[_0x54e42c(0x198)](_0x55321f);const _0x1da43c=await database_1[_0x54e42c(0x185)][_0x54e42c(0x18c)][_0x54e42c(0x186)]({'where':{'shopId':_0x55321f},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x1da43c)throw new Error('Shop\x20settings\x20not\x20found');return{'webhook':{'url':_0x1da43c[_0x54e42c(0x197)],'events':this[_0x54e42c(0x18f)](_0x1da43c[_0x54e42c(0x193)])}};}async['updateWebhookSettings'](_0x566bfc,_0x2242b9){const _0x28cdec=a47_0x5e2ac6;await this['ensureSettingsExist'](_0x566bfc);const _0x195b4c={};_0x2242b9['webhookUrl']!==undefined&&(_0x195b4c['webhookUrl']=_0x2242b9[_0x28cdec(0x197)]||null),_0x2242b9['webhookEvents']!==undefined&&(_0x195b4c['webhookEvents']=_0x2242b9['webhookEvents']||[]),await database_1[_0x28cdec(0x185)][_0x28cdec(0x18c)][_0x28cdec(0x181)]({'where':{'shopId':_0x566bfc},'data':_0x195b4c});}async['ensureSettingsExist'](_0x441f0d){const _0x4bb0f5=a47_0x5e2ac6,_0x50ba16=await database_1[_0x4bb0f5(0x185)]['shopSettings'][_0x4bb0f5(0x186)]({'where':{'shopId':_0x441f0d}});!_0x50ba16&&await database_1['default'][_0x4bb0f5(0x18c)][_0x4bb0f5(0x18a)]({'data':{'shopId':_0x441f0d}});}}exports[a47_0x5e2ac6(0x188)]=IntegrationsService;