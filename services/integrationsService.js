'use strict';const a52_0x475c2a=a52_0x3b7c;(function(_0x5c8c47,_0x1db70f){const _0x605dd3=a52_0x3b7c,_0x223794=_0x5c8c47();while(!![]){try{const _0xd17bca=-parseInt(_0x605dd3(0x7c))/0x1*(parseInt(_0x605dd3(0x87))/0x2)+-parseInt(_0x605dd3(0x81))/0x3*(parseInt(_0x605dd3(0x86))/0x4)+-parseInt(_0x605dd3(0x85))/0x5+parseInt(_0x605dd3(0x79))/0x6+parseInt(_0x605dd3(0x7d))/0x7*(parseInt(_0x605dd3(0x76))/0x8)+-parseInt(_0x605dd3(0x73))/0x9*(-parseInt(_0x605dd3(0x80))/0xa)+-parseInt(_0x605dd3(0x7e))/0xb*(-parseInt(_0x605dd3(0x6f))/0xc);if(_0xd17bca===_0x1db70f)break;else _0x223794['push'](_0x223794['shift']());}catch(_0x50d0a3){_0x223794['push'](_0x223794['shift']());}}}(a52_0x42e6,0xd9468));var __importDefault=this&&this[a52_0x475c2a(0x82)]||function(_0x5a2ec){const _0x29e041=a52_0x475c2a;return _0x5a2ec&&_0x5a2ec[_0x29e041(0x74)]?_0x5a2ec:{'default':_0x5a2ec};};function a52_0x42e6(){const _0x1927d5=['ensureSettingsExist','IntegrationsService','1671320VbQpEU','21544PxFkTp','2HfwRac','updateWebhookSettings','5636988ZDPFdW','webhookUrl','parseWebhookEvents','defineProperty','1494lNkHIS','__esModule','webhookEvents','1803784jvRTzk','parse','shopSettings','3218844VtVIWv','default','isArray','704279NNlQsK','7bEbIhR','44BBtLuu','findUnique','18080LiQtcU','564vvOsTG','__importDefault'];a52_0x42e6=function(){return _0x1927d5;};return a52_0x42e6();}function a52_0x3b7c(_0x5ce8c4,_0x3cdc33){const _0x42e637=a52_0x42e6();return a52_0x3b7c=function(_0x3b7cb6,_0x418ee4){_0x3b7cb6=_0x3b7cb6-0x6f;let _0x20de51=_0x42e637[_0x3b7cb6];return _0x20de51;},a52_0x3b7c(_0x5ce8c4,_0x3cdc33);}Object[a52_0x475c2a(0x72)](exports,a52_0x475c2a(0x74),{'value':!![]}),exports[a52_0x475c2a(0x84)]=void 0x0;const database_1=__importDefault(require('../config/database'));class IntegrationsService{[a52_0x475c2a(0x71)](_0x5e298e){const _0x3f148e=a52_0x475c2a;if(!_0x5e298e)return[];if(Array[_0x3f148e(0x7b)](_0x5e298e))return _0x5e298e;if(typeof _0x5e298e==='string')try{const _0x3fd07a=JSON[_0x3f148e(0x77)](_0x5e298e);return Array[_0x3f148e(0x7b)](_0x3fd07a)?_0x3fd07a:[];}catch{return[];}return[];}async['getIntegrations'](_0x26c3b0){const _0x12481a=a52_0x475c2a;await this['ensureSettingsExist'](_0x26c3b0);const _0x4d8315=await database_1['default'][_0x12481a(0x78)][_0x12481a(0x7f)]({'where':{'shopId':_0x26c3b0},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x4d8315)throw new Error('Shop\x20settings\x20not\x20found');return{'webhook':{'url':_0x4d8315[_0x12481a(0x70)],'events':this[_0x12481a(0x71)](_0x4d8315[_0x12481a(0x75)])}};}async[a52_0x475c2a(0x88)](_0x65ccbe,_0x75b1c2){const _0x425449=a52_0x475c2a;await this[_0x425449(0x83)](_0x65ccbe);const _0x15dd06={};_0x75b1c2[_0x425449(0x70)]!==undefined&&(_0x15dd06[_0x425449(0x70)]=_0x75b1c2[_0x425449(0x70)]||null),_0x75b1c2[_0x425449(0x75)]!==undefined&&(_0x15dd06[_0x425449(0x75)]=_0x75b1c2['webhookEvents']||[]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x65ccbe},'data':_0x15dd06});}async[a52_0x475c2a(0x83)](_0x31f2bc){const _0x316789=a52_0x475c2a,_0x132fd9=await database_1[_0x316789(0x7a)]['shopSettings'][_0x316789(0x7f)]({'where':{'shopId':_0x31f2bc}});!_0x132fd9&&await database_1['default']['shopSettings']['create']({'data':{'shopId':_0x31f2bc}});}}exports[a52_0x475c2a(0x84)]=IntegrationsService;