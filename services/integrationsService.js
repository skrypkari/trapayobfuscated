'use strict';function a51_0xaa29(){const _0x5b8503=['findUnique','webhookEvents','updateWebhookSettings','76338AoWxCL','IntegrationsService','defineProperty','1860936kmZNlX','ensureSettingsExist','6OPteui','update','60vOkJPP','1197gLuuHe','6612936bSCZuu','parse','webhookUrl','51109EYwRTg','2986112rJoySR','498iRtEon','getIntegrations','default','parseWebhookEvents','__importDefault','35180tfmZsF','6124svnxLa','isArray','shopSettings','__esModule'];a51_0xaa29=function(){return _0x5b8503;};return a51_0xaa29();}const a51_0x3eaab7=a51_0x2842;function a51_0x2842(_0xe1c804,_0x4bc4fd){const _0xaa2913=a51_0xaa29();return a51_0x2842=function(_0x28425f,_0x321e93){_0x28425f=_0x28425f-0x1e7;let _0x19e15b=_0xaa2913[_0x28425f];return _0x19e15b;},a51_0x2842(_0xe1c804,_0x4bc4fd);}(function(_0x4a1d4a,_0x30df38){const _0x2abc54=a51_0x2842,_0x5ab1d8=_0x4a1d4a();while(!![]){try{const _0x5564d2=parseInt(_0x2abc54(0x1f4))/0x1*(-parseInt(_0x2abc54(0x1ed))/0x2)+-parseInt(_0x2abc54(0x1f6))/0x3*(-parseInt(_0x2abc54(0x1fc))/0x4)+parseInt(_0x2abc54(0x1ef))/0x5*(parseInt(_0x2abc54(0x1e8))/0x6)+parseInt(_0x2abc54(0x1eb))/0x7+-parseInt(_0x2abc54(0x1f5))/0x8+-parseInt(_0x2abc54(0x1f0))/0x9*(parseInt(_0x2abc54(0x1fb))/0xa)+parseInt(_0x2abc54(0x1f1))/0xb;if(_0x5564d2===_0x30df38)break;else _0x5ab1d8['push'](_0x5ab1d8['shift']());}catch(_0x25a25a){_0x5ab1d8['push'](_0x5ab1d8['shift']());}}}(a51_0xaa29,0x44341));var __importDefault=this&&this[a51_0x3eaab7(0x1fa)]||function(_0x50f853){const _0x15ee6e=a51_0x3eaab7;return _0x50f853&&_0x50f853[_0x15ee6e(0x1ff)]?_0x50f853:{'default':_0x50f853};};Object[a51_0x3eaab7(0x1ea)](exports,'__esModule',{'value':!![]}),exports[a51_0x3eaab7(0x1e9)]=void 0x0;const database_1=__importDefault(require('../config/database'));class IntegrationsService{['parseWebhookEvents'](_0x1c21db){const _0x27b204=a51_0x3eaab7;if(!_0x1c21db)return[];if(Array['isArray'](_0x1c21db))return _0x1c21db;if(typeof _0x1c21db==='string')try{const _0x33c688=JSON[_0x27b204(0x1f2)](_0x1c21db);return Array[_0x27b204(0x1fd)](_0x33c688)?_0x33c688:[];}catch{return[];}return[];}async[a51_0x3eaab7(0x1f7)](_0xd14716){const _0x416249=a51_0x3eaab7;await this[_0x416249(0x1ec)](_0xd14716);const _0x4bff9a=await database_1['default'][_0x416249(0x1fe)][_0x416249(0x200)]({'where':{'shopId':_0xd14716},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x4bff9a)throw new Error('Shop\x20settings\x20not\x20found');return{'webhook':{'url':_0x4bff9a[_0x416249(0x1f3)],'events':this[_0x416249(0x1f9)](_0x4bff9a[_0x416249(0x201)])}};}async[a51_0x3eaab7(0x1e7)](_0x1d1f55,_0x4b33df){const _0x2c3435=a51_0x3eaab7;await this[_0x2c3435(0x1ec)](_0x1d1f55);const _0x582896={};_0x4b33df['webhookUrl']!==undefined&&(_0x582896[_0x2c3435(0x1f3)]=_0x4b33df['webhookUrl']||null),_0x4b33df[_0x2c3435(0x201)]!==undefined&&(_0x582896['webhookEvents']=_0x4b33df[_0x2c3435(0x201)]||[]),await database_1[_0x2c3435(0x1f8)][_0x2c3435(0x1fe)][_0x2c3435(0x1ee)]({'where':{'shopId':_0x1d1f55},'data':_0x582896});}async[a51_0x3eaab7(0x1ec)](_0x6b7c72){const _0x3e8779=a51_0x3eaab7,_0x406988=await database_1[_0x3e8779(0x1f8)][_0x3e8779(0x1fe)][_0x3e8779(0x200)]({'where':{'shopId':_0x6b7c72}});!_0x406988&&await database_1[_0x3e8779(0x1f8)][_0x3e8779(0x1fe)]['create']({'data':{'shopId':_0x6b7c72}});}}exports[a51_0x3eaab7(0x1e9)]=IntegrationsService;