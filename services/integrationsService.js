'use strict';const a47_0x470be7=a47_0x27bd;function a47_0x596a(){const _0x19ba3d=['shopSettings','528taqtZo','616961oRNFWq','1532MuulWG','parse','ensureSettingsExist','7210ifgRMB','../config/database','3054104AKMBpJ','Shop\x20settings\x20not\x20found','96390xihRfE','string','getIntegrations','16075895xUPKWQ','defineProperty','954XlCKxw','default','14882QFZocg','50342LoCdqj','IntegrationsService','webhookEvents','findUnique','updateWebhookSettings','__esModule','141AQQESS','webhookUrl'];a47_0x596a=function(){return _0x19ba3d;};return a47_0x596a();}(function(_0x2f732c,_0xe0eee2){const _0x380b55=a47_0x27bd,_0xec59d3=_0x2f732c();while(!![]){try{const _0x3d342d=-parseInt(_0x380b55(0x99))/0x1+-parseInt(_0x380b55(0x8f))/0x2*(-parseInt(_0x380b55(0x95))/0x3)+-parseInt(_0x380b55(0x9a))/0x4*(parseInt(_0x380b55(0x83))/0x5)+-parseInt(_0x380b55(0x98))/0x6*(parseInt(_0x380b55(0x8e))/0x7)+parseInt(_0x380b55(0x85))/0x8+parseInt(_0x380b55(0x8c))/0x9*(-parseInt(_0x380b55(0x87))/0xa)+parseInt(_0x380b55(0x8a))/0xb;if(_0x3d342d===_0xe0eee2)break;else _0xec59d3['push'](_0xec59d3['shift']());}catch(_0x43833b){_0xec59d3['push'](_0xec59d3['shift']());}}}(a47_0x596a,0x9e3f0));var __importDefault=this&&this['__importDefault']||function(_0x32d37a){const _0x5d6db7=a47_0x27bd;return _0x32d37a&&_0x32d37a[_0x5d6db7(0x94)]?_0x32d37a:{'default':_0x32d37a};};Object[a47_0x470be7(0x8b)](exports,'__esModule',{'value':!![]}),exports[a47_0x470be7(0x90)]=void 0x0;const database_1=__importDefault(require(a47_0x470be7(0x84)));class IntegrationsService{['parseWebhookEvents'](_0x28b30e){const _0x2b5315=a47_0x470be7;if(!_0x28b30e)return[];if(Array['isArray'](_0x28b30e))return _0x28b30e;if(typeof _0x28b30e===_0x2b5315(0x88))try{const _0x57e42b=JSON[_0x2b5315(0x9b)](_0x28b30e);return Array['isArray'](_0x57e42b)?_0x57e42b:[];}catch{return[];}return[];}async[a47_0x470be7(0x89)](_0x349a0c){const _0x142062=a47_0x470be7;await this[_0x142062(0x82)](_0x349a0c);const _0x39d402=await database_1['default']['shopSettings'][_0x142062(0x92)]({'where':{'shopId':_0x349a0c},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x39d402)throw new Error(_0x142062(0x86));return{'webhook':{'url':_0x39d402[_0x142062(0x96)],'events':this['parseWebhookEvents'](_0x39d402[_0x142062(0x91)])}};}async[a47_0x470be7(0x93)](_0x661ac4,_0x277564){const _0x5da392=a47_0x470be7;await this['ensureSettingsExist'](_0x661ac4);const _0x2906ab={};_0x277564[_0x5da392(0x96)]!==undefined&&(_0x2906ab['webhookUrl']=_0x277564[_0x5da392(0x96)]||null),_0x277564[_0x5da392(0x91)]!==undefined&&(_0x2906ab[_0x5da392(0x91)]=_0x277564[_0x5da392(0x91)]||[]),await database_1[_0x5da392(0x8d)][_0x5da392(0x97)]['update']({'where':{'shopId':_0x661ac4},'data':_0x2906ab});}async[a47_0x470be7(0x82)](_0x3f2b21){const _0x31c9f5=a47_0x470be7,_0x19b8ec=await database_1[_0x31c9f5(0x8d)][_0x31c9f5(0x97)]['findUnique']({'where':{'shopId':_0x3f2b21}});!_0x19b8ec&&await database_1[_0x31c9f5(0x8d)]['shopSettings']['create']({'data':{'shopId':_0x3f2b21}});}}function a47_0x27bd(_0x3cb487,_0x481873){const _0x596aaf=a47_0x596a();return a47_0x27bd=function(_0x27bd6e,_0x3f0fb1){_0x27bd6e=_0x27bd6e-0x82;let _0x53a3f0=_0x596aaf[_0x27bd6e];return _0x53a3f0;},a47_0x27bd(_0x3cb487,_0x481873);}exports[a47_0x470be7(0x90)]=IntegrationsService;