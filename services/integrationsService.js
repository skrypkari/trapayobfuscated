'use strict';const a47_0x5f37d9=a47_0x300b;(function(_0x471638,_0x49c268){const _0x3af3c7=a47_0x300b,_0x43951b=_0x471638();while(!![]){try{const _0x2da12f=parseInt(_0x3af3c7(0x127))/0x1+parseInt(_0x3af3c7(0x13b))/0x2*(parseInt(_0x3af3c7(0x13a))/0x3)+parseInt(_0x3af3c7(0x125))/0x4*(parseInt(_0x3af3c7(0x13c))/0x5)+-parseInt(_0x3af3c7(0x138))/0x6+-parseInt(_0x3af3c7(0x132))/0x7*(-parseInt(_0x3af3c7(0x12a))/0x8)+parseInt(_0x3af3c7(0x134))/0x9+-parseInt(_0x3af3c7(0x136))/0xa*(parseInt(_0x3af3c7(0x139))/0xb);if(_0x2da12f===_0x49c268)break;else _0x43951b['push'](_0x43951b['shift']());}catch(_0x573888){_0x43951b['push'](_0x43951b['shift']());}}}(a47_0x4836,0xbee07));function a47_0x300b(_0x327fca,_0x15195b){const _0x483609=a47_0x4836();return a47_0x300b=function(_0x300bad,_0x1458f4){_0x300bad=_0x300bad-0x125;let _0x5cd504=_0x483609[_0x300bad];return _0x5cd504;},a47_0x300b(_0x327fca,_0x15195b);}var __importDefault=this&&this[a47_0x5f37d9(0x131)]||function(_0x5b48c2){return _0x5b48c2&&_0x5b48c2['__esModule']?_0x5b48c2:{'default':_0x5b48c2};};Object[a47_0x5f37d9(0x12f)](exports,'__esModule',{'value':!![]}),exports[a47_0x5f37d9(0x137)]=void 0x0;const database_1=__importDefault(require('../config/database'));function a47_0x4836(){const _0x400bce=['getIntegrations','ensureSettingsExist','defineProperty','webhookUrl','__importDefault','61747OWTqfG','parse','12461202HjFCzE','shopSettings','45251260qQZnpH','IntegrationsService','1848918seZkyb','11GGTkoq','21cifKlN','101746oeIWEd','3616135WdYstK','default','8vTRWYK','Shop\x20settings\x20not\x20found','1263595OHMuch','parseWebhookEvents','findUnique','1056gvbRMF','webhookEvents','string'];a47_0x4836=function(){return _0x400bce;};return a47_0x4836();}class IntegrationsService{[a47_0x5f37d9(0x128)](_0x357e40){const _0x2d2b9f=a47_0x5f37d9;if(!_0x357e40)return[];if(Array['isArray'](_0x357e40))return _0x357e40;if(typeof _0x357e40===_0x2d2b9f(0x12c))try{const _0x15144b=JSON[_0x2d2b9f(0x133)](_0x357e40);return Array['isArray'](_0x15144b)?_0x15144b:[];}catch{return[];}return[];}async[a47_0x5f37d9(0x12d)](_0x432c03){const _0x3aa722=a47_0x5f37d9;await this[_0x3aa722(0x12e)](_0x432c03);const _0x31e2b4=await database_1[_0x3aa722(0x13d)][_0x3aa722(0x135)][_0x3aa722(0x129)]({'where':{'shopId':_0x432c03},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x31e2b4)throw new Error(_0x3aa722(0x126));return{'webhook':{'url':_0x31e2b4[_0x3aa722(0x130)],'events':this[_0x3aa722(0x128)](_0x31e2b4[_0x3aa722(0x12b)])}};}async['updateWebhookSettings'](_0x41ae9c,_0x2c68cd){const _0x3a6c98=a47_0x5f37d9;await this[_0x3a6c98(0x12e)](_0x41ae9c);const _0x1d8c92={};_0x2c68cd['webhookUrl']!==undefined&&(_0x1d8c92['webhookUrl']=_0x2c68cd[_0x3a6c98(0x130)]||null),_0x2c68cd[_0x3a6c98(0x12b)]!==undefined&&(_0x1d8c92[_0x3a6c98(0x12b)]=_0x2c68cd[_0x3a6c98(0x12b)]||[]),await database_1['default']['shopSettings']['update']({'where':{'shopId':_0x41ae9c},'data':_0x1d8c92});}async[a47_0x5f37d9(0x12e)](_0x57b907){const _0x4cd15d=a47_0x5f37d9,_0x9ff6bc=await database_1[_0x4cd15d(0x13d)][_0x4cd15d(0x135)][_0x4cd15d(0x129)]({'where':{'shopId':_0x57b907}});!_0x9ff6bc&&await database_1[_0x4cd15d(0x13d)][_0x4cd15d(0x135)]['create']({'data':{'shopId':_0x57b907}});}}exports['IntegrationsService']=IntegrationsService;