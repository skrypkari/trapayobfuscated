'use strict';const a51_0x3293df=a51_0x43aa;(function(_0x24a2e0,_0x7665e3){const _0x55b488=a51_0x43aa,_0x5f0e79=_0x24a2e0();while(!![]){try{const _0x4dd983=parseInt(_0x55b488(0x78))/0x1+parseInt(_0x55b488(0x74))/0x2+-parseInt(_0x55b488(0x6a))/0x3+parseInt(_0x55b488(0x68))/0x4+-parseInt(_0x55b488(0x71))/0x5*(parseInt(_0x55b488(0x76))/0x6)+-parseInt(_0x55b488(0x66))/0x7+parseInt(_0x55b488(0x79))/0x8;if(_0x4dd983===_0x7665e3)break;else _0x5f0e79['push'](_0x5f0e79['shift']());}catch(_0xcefac1){_0x5f0e79['push'](_0x5f0e79['shift']());}}}(a51_0x5ea1,0xe1932));function a51_0x5ea1(){const _0x5cce74=['__importDefault','findUnique','../config/database','ensureSettingsExist','189065hqSPOi','webhookUrl','getIntegrations','973862vrjaAJ','default','84FsRdWh','updateWebhookSettings','843300EYDPSY','8267384UBEusJ','webhookEvents','IntegrationsService','defineProperty','6540702wVrHRZ','isArray','2104812AnpViH','shopSettings','1506405XERHwv','Shop\x20settings\x20not\x20found','__esModule'];a51_0x5ea1=function(){return _0x5cce74;};return a51_0x5ea1();}var __importDefault=this&&this[a51_0x3293df(0x6d)]||function(_0x2b86af){const _0x39ea9e=a51_0x3293df;return _0x2b86af&&_0x2b86af[_0x39ea9e(0x6c)]?_0x2b86af:{'default':_0x2b86af};};Object[a51_0x3293df(0x65)](exports,a51_0x3293df(0x6c),{'value':!![]}),exports[a51_0x3293df(0x64)]=void 0x0;const database_1=__importDefault(require(a51_0x3293df(0x6f)));function a51_0x43aa(_0x460a53,_0x1bfea5){const _0x5ea182=a51_0x5ea1();return a51_0x43aa=function(_0x43aab1,_0x4e0823){_0x43aab1=_0x43aab1-0x64;let _0x221554=_0x5ea182[_0x43aab1];return _0x221554;},a51_0x43aa(_0x460a53,_0x1bfea5);}class IntegrationsService{['parseWebhookEvents'](_0x4251aa){const _0x94c989=a51_0x3293df;if(!_0x4251aa)return[];if(Array['isArray'](_0x4251aa))return _0x4251aa;if(typeof _0x4251aa==='string')try{const _0x523eb2=JSON['parse'](_0x4251aa);return Array[_0x94c989(0x67)](_0x523eb2)?_0x523eb2:[];}catch{return[];}return[];}async[a51_0x3293df(0x73)](_0x5d5612){const _0x4dc699=a51_0x3293df;await this[_0x4dc699(0x70)](_0x5d5612);const _0x279e05=await database_1[_0x4dc699(0x75)][_0x4dc699(0x69)][_0x4dc699(0x6e)]({'where':{'shopId':_0x5d5612},'select':{'webhookUrl':!![],'webhookEvents':!![]}});if(!_0x279e05)throw new Error(_0x4dc699(0x6b));return{'webhook':{'url':_0x279e05[_0x4dc699(0x72)],'events':this['parseWebhookEvents'](_0x279e05[_0x4dc699(0x7a)])}};}async[a51_0x3293df(0x77)](_0x4da495,_0xc083dd){const _0xbbe1b5=a51_0x3293df;await this[_0xbbe1b5(0x70)](_0x4da495);const _0x18b662={};_0xc083dd[_0xbbe1b5(0x72)]!==undefined&&(_0x18b662['webhookUrl']=_0xc083dd['webhookUrl']||null),_0xc083dd[_0xbbe1b5(0x7a)]!==undefined&&(_0x18b662[_0xbbe1b5(0x7a)]=_0xc083dd[_0xbbe1b5(0x7a)]||[]),await database_1[_0xbbe1b5(0x75)][_0xbbe1b5(0x69)]['update']({'where':{'shopId':_0x4da495},'data':_0x18b662});}async[a51_0x3293df(0x70)](_0x478c95){const _0x550191=a51_0x3293df,_0x50ee10=await database_1[_0x550191(0x75)]['shopSettings'][_0x550191(0x6e)]({'where':{'shopId':_0x478c95}});!_0x50ee10&&await database_1[_0x550191(0x75)][_0x550191(0x69)]['create']({'data':{'shopId':_0x478c95}});}}exports['IntegrationsService']=IntegrationsService;