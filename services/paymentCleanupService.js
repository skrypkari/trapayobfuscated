'use strict';const a72_0x17b424=a72_0x284b;(function(_0x55d422,_0x4afb00){const _0x37f16c=a72_0x284b,_0xd4ecbd=_0x55d422();while(!![]){try{const _0x153121=-parseInt(_0x37f16c(0x1d3))/0x1*(-parseInt(_0x37f16c(0x1f8))/0x2)+parseInt(_0x37f16c(0x238))/0x3+parseInt(_0x37f16c(0x232))/0x4*(-parseInt(_0x37f16c(0x21f))/0x5)+parseInt(_0x37f16c(0x245))/0x6+-parseInt(_0x37f16c(0x1db))/0x7+-parseInt(_0x37f16c(0x1e1))/0x8+parseInt(_0x37f16c(0x21e))/0x9;if(_0x153121===_0x4afb00)break;else _0xd4ecbd['push'](_0xd4ecbd['shift']());}catch(_0x2aa946){_0xd4ecbd['push'](_0xd4ecbd['shift']());}}}(a72_0x43b0,0xc7db4));function a72_0x284b(_0x571306,_0x10d714){_0x571306=_0x571306-0x1d1;const _0x43b0f9=a72_0x43b0();let _0x284be5=_0x43b0f9[_0x571306];return _0x284be5;}var __importDefault=this&&this[a72_0x17b424(0x22b)]||function(_0x57d974){return _0x57d974&&_0x57d974['__esModule']?_0x57d974:{'default':_0x57d974};};function a72_0x43b0(){const _0x118dbd=['7678233NeIKMs','7747645cObLIb','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','findMany','\x20\x20\x20\x20\x20\x20','\x20days','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','currency','\x20payments\x20updated\x20to\x20EXPIRED,\x20','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','payments','__importDefault','loggerService','Failed\x20to\x20update\x20PENDING\x20payment\x20','__esModule','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','\x20minutes)','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','4yBBGhh','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','PENDING','pending_payment_cleanup','byStatus','name','4266951uExGYi','Unknown\x20error','payment_cleanup','logWebhookError','mastercard','‚úÖ\x20PENDING\x20payments\x20processed:\x20','runCleanupWithReport','FAILED','amount','@prisma/client','\x20failed\x20to\x20update','\x20stale\x20PENDING\x20payments','oxapay','4749156DCpwmD','desc','payment','expired','logWebhookProcessed','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','\x20\x20\x20Age:\x20','üìä\x20','getDate','cleanupStalePendingPayments','Cleanup\x20service\x20error:\x20','length','setDate','logApiCall','\x20(gateway:\x20','system','üîç\x20Found\x20','\x20\x20\x20By\x20gateway:','EXPIRED','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','Failed\x20to\x20update\x20payment\x20','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','PENDING_TIMEOUT_DAYS','paymentLink','fresh','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','Link\x20expiration\x20service\x20error:\x20','PENDING\x20cleanup\x20completed:\x20','rapyd','155OzwFwY','POST','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','expireSinglePaymentLinks','recent','PROCESSING','\x20active\x20SINGLE\x20links\x20to\x20check','update','7983409UOPNcU','runProcessingCleanupOnly','getProcessingPaymentsStats','message','floor','PaymentCleanupService','7456936xQfiqz','\x20\x20\x20Shop:\x20','cleanupStaleProcessingPayments','üèÅ\x20PROCESSING\x20cleanup\x20completed','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','‚úÖ\x20Updated\x20payment\x20','processed','gateway','‚è∞\x20Expired\x20link\x20','username','errors','PROCESSING_TIMEOUT_DAYS','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','shop','\x20links\x20expired','stale','admin','now','üìÖ\x20Looking\x20for\x20PENDING\x20payments\x20older\x20than:\x20','runPendingCleanupOnly','PaymentStatus','\x20\x20\x20Stale\x20(3-5\x20days):\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','17726BNyrdy','PENDING\x20cleanup\x20service\x20error:\x20','includes','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','getTime','auto_timeout_pending','toISOString','\x20\x20\x20Total:\x20','createdAt','Failed\x20to\x20get\x20processing\x20payments\x20stats:','üí•\x20','total','üèÅ\x20PENDING\x20cleanup\x20completed','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','\x20from\x20PENDING\x20to\x20EXPIRED','üìä\x20Expiration\x20completed:\x20','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','\x20stale\x20PROCESSING\x20payments','SINGLE','\x20\x20\x20By\x20status:','log','./loggerService','error','byGateway','defineProperty','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','ACTIVE',',\x20payment\x20age:\x20','push','visa/mastercard','status','default','byAge','\x20\x20\x20Created:\x20','\x0aüìà\x20Cleanup\x20Summary:','paymentCleanupService','failed'];a72_0x43b0=function(){return _0x118dbd;};return a72_0x43b0();}Object[a72_0x17b424(0x210)](exports,a72_0x17b424(0x22e),{'value':!![]}),exports[a72_0x17b424(0x21c)]=exports[a72_0x17b424(0x1e0)]=void 0x0;const database_1=__importDefault(require('../config/database')),client_1=require(a72_0x17b424(0x241)),loggerService_1=require(a72_0x17b424(0x20d));class PaymentCleanupService{constructor(){const _0x17c177=a72_0x17b424;this['PROCESSING_TIMEOUT_DAYS']=0x5,this[_0x17c177(0x25b)]=0x5;}async[a72_0x17b424(0x1e3)](){const _0x3b83c3=a72_0x17b424,_0x2c643a=[];let _0x430de0=0x0,_0x31c808=0x0;try{console['log'](_0x3b83c3(0x211));const _0x53e318=new Date();_0x53e318[_0x3b83c3(0x251)](_0x53e318['getDate']()-this[_0x3b83c3(0x1ec)]),console[_0x3b83c3(0x20c)](_0x3b83c3(0x228)+_0x53e318[_0x3b83c3(0x1fe)]());const _0x1fd32f=await database_1[_0x3b83c3(0x218)][_0x3b83c3(0x247)][_0x3b83c3(0x222)]({'where':{'status':client_1[_0x3b83c3(0x1f5)][_0x3b83c3(0x1d8)],'createdAt':{'lt':_0x53e318}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x3b83c3(0x20c)](_0x3b83c3(0x255)+_0x1fd32f['length']+_0x3b83c3(0x209));if(_0x1fd32f[_0x3b83c3(0x250)]===0x0)return console[_0x3b83c3(0x20c)]('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2b88b1 of _0x1fd32f){try{console[_0x3b83c3(0x20c)](_0x3b83c3(0x220)+_0x2b88b1['id']+'\x20('+_0x2b88b1['gateway']+',\x20'+_0x2b88b1[_0x3b83c3(0x240)]+'\x20'+_0x2b88b1[_0x3b83c3(0x226)]+')'),console[_0x3b83c3(0x20c)](_0x3b83c3(0x1e2)+_0x2b88b1[_0x3b83c3(0x1ee)][_0x3b83c3(0x237)]+'\x20('+_0x2b88b1[_0x3b83c3(0x1ee)][_0x3b83c3(0x1ea)]+')'),console[_0x3b83c3(0x20c)](_0x3b83c3(0x21a)+_0x2b88b1[_0x3b83c3(0x200)]['toISOString']()),console['log']('\x20\x20\x20Age:\x20'+Math[_0x3b83c3(0x1df)]((Date[_0x3b83c3(0x1f2)]()-_0x2b88b1[_0x3b83c3(0x200)][_0x3b83c3(0x1fc)]())/(0x3e8*0x3c*0x3c*0x18))+_0x3b83c3(0x224));const _0x19917a=await database_1[_0x3b83c3(0x218)][_0x3b83c3(0x247)][_0x3b83c3(0x1da)]({'where':{'id':_0x2b88b1['id']},'data':{'status':client_1[_0x3b83c3(0x1f5)][_0x3b83c3(0x23f)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x3b83c3(0x1d5)+this[_0x3b83c3(0x1ec)]+_0x3b83c3(0x224)}});console[_0x3b83c3(0x20c)](_0x3b83c3(0x1e6)+_0x2b88b1['id']+'\x20from\x20PROCESSING\x20to\x20FAILED'),loggerService_1['loggerService'][_0x3b83c3(0x249)](_0x2b88b1[_0x3b83c3(0x1e8)],_0x2b88b1['id'],'PROCESSING',_0x3b83c3(0x23f),{'reason':'auto_timeout','timeoutDays':this[_0x3b83c3(0x1ec)]}),_0x430de0++;}catch(_0x11895f){const _0x4773f4=_0x3b83c3(0x259)+_0x2b88b1['id']+':\x20'+(_0x11895f instanceof Error?_0x11895f[_0x3b83c3(0x1de)]:_0x3b83c3(0x239));console[_0x3b83c3(0x20e)]('‚ùå\x20'+_0x4773f4),_0x2c643a[_0x3b83c3(0x215)](_0x4773f4),_0x31c808++;}}const _0x1a5a54='Cleanup\x20completed:\x20'+_0x430de0+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0x31c808+'\x20failed\x20to\x20update';return console['log'](_0x3b83c3(0x24c)+_0x1a5a54),loggerService_1[_0x3b83c3(0x22c)][_0x3b83c3(0x252)]('payment_cleanup','POST',_0x3b83c3(0x254),'admin',{'processed':_0x430de0,'failed':_0x31c808,'errors':_0x2c643a,'timeoutDays':this[_0x3b83c3(0x1ec)]}),{'processed':_0x430de0,'failed':_0x31c808,'errors':_0x2c643a};}catch(_0x5024ff){const _0x2a6629=_0x3b83c3(0x24f)+(_0x5024ff instanceof Error?_0x5024ff[_0x3b83c3(0x1de)]:_0x3b83c3(0x239));return console['error']('üí•\x20'+_0x2a6629),_0x2c643a[_0x3b83c3(0x215)](_0x2a6629),loggerService_1[_0x3b83c3(0x22c)]['logWebhookError'](_0x3b83c3(0x23a),_0x2a6629,{'timeoutDays':this[_0x3b83c3(0x1ec)]}),{'processed':_0x430de0,'failed':_0x31c808,'errors':_0x2c643a};}}async[a72_0x17b424(0x24e)](){const _0x1ad0b5=a72_0x17b424,_0x20c4dc=[];let _0x189f3c=0x0,_0x10f06c=0x0;try{console[_0x1ad0b5(0x20c)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0x1def51=new Date();_0x1def51[_0x1ad0b5(0x251)](_0x1def51[_0x1ad0b5(0x24d)]()-this[_0x1ad0b5(0x25b)]),console[_0x1ad0b5(0x20c)](_0x1ad0b5(0x1f3)+_0x1def51[_0x1ad0b5(0x1fe)]());const _0x1f5078=await database_1[_0x1ad0b5(0x218)]['payment'][_0x1ad0b5(0x222)]({'where':{'status':client_1['PaymentStatus'][_0x1ad0b5(0x234)],'createdAt':{'lt':_0x1def51}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log']('üîç\x20Found\x20'+_0x1f5078[_0x1ad0b5(0x250)]+_0x1ad0b5(0x243));if(_0x1f5078['length']===0x0)return console[_0x1ad0b5(0x20c)](_0x1ad0b5(0x1e5)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2356b7 of _0x1f5078){try{console['log'](_0x1ad0b5(0x258)+_0x2356b7['id']+'\x20('+_0x2356b7[_0x1ad0b5(0x1e8)]+',\x20'+_0x2356b7[_0x1ad0b5(0x240)]+'\x20'+_0x2356b7[_0x1ad0b5(0x226)]+')'),console[_0x1ad0b5(0x20c)](_0x1ad0b5(0x1e2)+_0x2356b7['shop']['name']+'\x20('+_0x2356b7[_0x1ad0b5(0x1ee)][_0x1ad0b5(0x1ea)]+')'),console[_0x1ad0b5(0x20c)]('\x20\x20\x20Created:\x20'+_0x2356b7['createdAt'][_0x1ad0b5(0x1fe)]()),console[_0x1ad0b5(0x20c)](_0x1ad0b5(0x24b)+Math[_0x1ad0b5(0x1df)]((Date[_0x1ad0b5(0x1f2)]()-_0x2356b7[_0x1ad0b5(0x200)][_0x1ad0b5(0x1fc)]())/(0x3e8*0x3c*0x3c*0x18))+_0x1ad0b5(0x224));const _0x13df72=await database_1[_0x1ad0b5(0x218)][_0x1ad0b5(0x247)][_0x1ad0b5(0x1da)]({'where':{'id':_0x2356b7['id']},'data':{'status':client_1[_0x1ad0b5(0x1f5)][_0x1ad0b5(0x257)],'statusChangedBy':_0x1ad0b5(0x254),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20for\x20'+this[_0x1ad0b5(0x25b)]+_0x1ad0b5(0x224)}});console[_0x1ad0b5(0x20c)](_0x1ad0b5(0x1e6)+_0x2356b7['id']+_0x1ad0b5(0x206)),loggerService_1['loggerService'][_0x1ad0b5(0x249)](_0x2356b7[_0x1ad0b5(0x1e8)],_0x2356b7['id'],'PENDING',_0x1ad0b5(0x257),{'reason':_0x1ad0b5(0x1fd),'timeoutDays':this[_0x1ad0b5(0x25b)]}),_0x189f3c++;}catch(_0x2d4b87){const _0x1aa077=_0x1ad0b5(0x22d)+_0x2356b7['id']+':\x20'+(_0x2d4b87 instanceof Error?_0x2d4b87[_0x1ad0b5(0x1de)]:'Unknown\x20error');console[_0x1ad0b5(0x20e)]('‚ùå\x20'+_0x1aa077),_0x20c4dc[_0x1ad0b5(0x215)](_0x1aa077),_0x10f06c++;}}const _0x24d4ef=_0x1ad0b5(0x1d1)+_0x189f3c+_0x1ad0b5(0x227)+_0x10f06c+_0x1ad0b5(0x242);return console['log'](_0x1ad0b5(0x24c)+_0x24d4ef),loggerService_1['loggerService']['logApiCall'](_0x1ad0b5(0x235),_0x1ad0b5(0x1d4),_0x1ad0b5(0x254),_0x1ad0b5(0x1f1),{'processed':_0x189f3c,'failed':_0x10f06c,'errors':_0x20c4dc,'timeoutDays':this[_0x1ad0b5(0x25b)]}),{'processed':_0x189f3c,'failed':_0x10f06c,'errors':_0x20c4dc};}catch(_0x455854){const _0x3ab73f=_0x1ad0b5(0x1f9)+(_0x455854 instanceof Error?_0x455854['message']:_0x1ad0b5(0x239));return console[_0x1ad0b5(0x20e)](_0x1ad0b5(0x202)+_0x3ab73f),_0x20c4dc['push'](_0x3ab73f),loggerService_1['loggerService'][_0x1ad0b5(0x23b)](_0x1ad0b5(0x235),_0x3ab73f,{'timeoutDays':this[_0x1ad0b5(0x25b)]}),{'processed':_0x189f3c,'failed':_0x10f06c,'errors':_0x20c4dc};}}async[a72_0x17b424(0x1dd)](){const _0xa6a921=a72_0x17b424;try{const _0x39bbbc=new Date(),_0x23611c=new Date(_0x39bbbc[_0xa6a921(0x1fc)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x139f5a=new Date(_0x39bbbc[_0xa6a921(0x1fc)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x26fa57=new Date(_0x39bbbc[_0xa6a921(0x1fc)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x3df418=await database_1[_0xa6a921(0x218)][_0xa6a921(0x247)]['findMany']({'where':{'status':{'in':[client_1[_0xa6a921(0x1f5)][_0xa6a921(0x1d8)],client_1[_0xa6a921(0x1f5)][_0xa6a921(0x234)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x1a5ca6={'total':_0x3df418['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x10a8f5 of _0x3df418){if(_0x10a8f5['createdAt']>_0x23611c)_0x1a5ca6[_0xa6a921(0x219)]['fresh']++;else{if(_0x10a8f5[_0xa6a921(0x200)]>_0x139f5a)_0x1a5ca6['byAge'][_0xa6a921(0x1d7)]++;else _0x10a8f5[_0xa6a921(0x200)]>_0x26fa57?_0x1a5ca6[_0xa6a921(0x219)][_0xa6a921(0x1f0)]++:_0x1a5ca6['byAge'][_0xa6a921(0x248)]++;}!_0x1a5ca6['byGateway'][_0x10a8f5[_0xa6a921(0x1e8)]]&&(_0x1a5ca6[_0xa6a921(0x20f)][_0x10a8f5['gateway']]=0x0);_0x1a5ca6[_0xa6a921(0x20f)][_0x10a8f5[_0xa6a921(0x1e8)]]++;const _0x2214c9=_0x10a8f5[_0xa6a921(0x217)];!_0x1a5ca6[_0xa6a921(0x236)][_0x2214c9]&&(_0x1a5ca6[_0xa6a921(0x236)][_0x2214c9]=0x0),_0x1a5ca6[_0xa6a921(0x236)][_0x2214c9]++;}return _0x1a5ca6;}catch(_0x1f2dab){console[_0xa6a921(0x20e)](_0xa6a921(0x201),_0x1f2dab);throw new Error(_0xa6a921(0x1f7)+(_0x1f2dab instanceof Error?_0x1f2dab[_0xa6a921(0x1de)]:_0xa6a921(0x239)));}}async[a72_0x17b424(0x23e)](){const _0x52fa11=a72_0x17b424;console['log'](_0x52fa11(0x25a));const _0x2212dd=await this[_0x52fa11(0x1dd)]();console['log'](_0x52fa11(0x1ed)),console['log'](_0x52fa11(0x1ff)+_0x2212dd['total']),console[_0x52fa11(0x20c)]('\x20\x20\x20Fresh\x20(<\x201\x20day):\x20'+_0x2212dd[_0x52fa11(0x219)][_0x52fa11(0x25d)]),console[_0x52fa11(0x20c)]('\x20\x20\x20Recent\x20(1-3\x20days):\x20'+_0x2212dd[_0x52fa11(0x219)]['recent']),console[_0x52fa11(0x20c)](_0x52fa11(0x1f6)+_0x2212dd['byAge']['stale']),console['log']('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x2212dd[_0x52fa11(0x219)][_0x52fa11(0x248)]),console[_0x52fa11(0x20c)](_0x52fa11(0x256),_0x2212dd[_0x52fa11(0x20f)]),console['log'](_0x52fa11(0x20b),_0x2212dd[_0x52fa11(0x236)]),console[_0x52fa11(0x20c)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x47290a=await this[_0x52fa11(0x1e3)]();console[_0x52fa11(0x20c)](_0x52fa11(0x1fb));const _0x2cc7e6=await this['cleanupStalePendingPayments'](),_0x51414c=await this['getProcessingPaymentsStats']();console[_0x52fa11(0x20c)]('\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console['log'](_0x52fa11(0x1ff)+_0x51414c['total']),console[_0x52fa11(0x20c)](_0x52fa11(0x205)+_0x51414c['byAge'][_0x52fa11(0x248)]),console[_0x52fa11(0x20c)](_0x52fa11(0x20b),_0x51414c[_0x52fa11(0x236)]);const _0xb313fd=_0x47290a['processed']+_0x2cc7e6[_0x52fa11(0x1e7)],_0x3ffba7=_0x47290a[_0x52fa11(0x21d)]+_0x2cc7e6[_0x52fa11(0x21d)],_0x2d1421=[..._0x47290a[_0x52fa11(0x1eb)],..._0x2cc7e6[_0x52fa11(0x1eb)]];console[_0x52fa11(0x20c)](_0x52fa11(0x21b)),console['log'](_0x52fa11(0x229)+_0x47290a[_0x52fa11(0x1e7)]),console[_0x52fa11(0x20c)]('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x2cc7e6[_0x52fa11(0x1e7)]),console[_0x52fa11(0x20c)](_0x52fa11(0x225)+_0xb313fd),console['log'](_0x52fa11(0x22f)+_0x3ffba7),console[_0x52fa11(0x20c)]('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x2212dd[_0x52fa11(0x203)]-_0x51414c[_0x52fa11(0x203)])),_0x2d1421[_0x52fa11(0x250)]>0x0&&(console[_0x52fa11(0x20c)](_0x52fa11(0x24a)),_0x2d1421['forEach']((_0x4e199a,_0x1f1b97)=>{const _0x51da6d=_0x52fa11;console[_0x51da6d(0x20c)](_0x51da6d(0x223)+(_0x1f1b97+0x1)+'.\x20'+_0x4e199a);})),console[_0x52fa11(0x20c)]('üèÅ\x20Payment\x20cleanup\x20service\x20completed');}async[a72_0x17b424(0x1dc)](){const _0x22abf9=a72_0x17b424;console[_0x22abf9(0x20c)](_0x22abf9(0x208));const _0x51f751=await this[_0x22abf9(0x1dd)](),_0x82b946=_0x51f751[_0x22abf9(0x236)][_0x22abf9(0x1d8)]||0x0;console[_0x22abf9(0x20c)](_0x22abf9(0x231)+_0x82b946);const _0x1cdace=await this[_0x22abf9(0x1e3)](),_0x2094e4=await this['getProcessingPaymentsStats'](),_0x378f4a=_0x2094e4[_0x22abf9(0x236)][_0x22abf9(0x1d8)]||0x0;console[_0x22abf9(0x20c)]('üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20'+_0x378f4a),console['log'](_0x22abf9(0x233)+_0x1cdace[_0x22abf9(0x1e7)]),console[_0x22abf9(0x20c)](_0x22abf9(0x1e4));}async[a72_0x17b424(0x1f4)](){const _0x26523f=a72_0x17b424;console[_0x26523f(0x20c)]('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x31a515=await this[_0x26523f(0x1dd)](),_0x11f17b=_0x31a515[_0x26523f(0x236)][_0x26523f(0x234)]||0x0;console[_0x26523f(0x20c)](_0x26523f(0x212)+_0x11f17b);const _0x46d9a6=await this[_0x26523f(0x24e)](),_0x1bb7ed=await this['getProcessingPaymentsStats'](),_0x365f0c=_0x1bb7ed[_0x26523f(0x236)][_0x26523f(0x234)]||0x0;console[_0x26523f(0x20c)](_0x26523f(0x25e)+_0x365f0c),console[_0x26523f(0x20c)](_0x26523f(0x23d)+_0x46d9a6[_0x26523f(0x1e7)]),console[_0x26523f(0x20c)](_0x26523f(0x204));}async[a72_0x17b424(0x1d6)](){const _0x625b2c=a72_0x17b424,_0x2195ef=[];let _0x49d5d6=0x0;try{console['log'](_0x625b2c(0x221));const _0x3765c0=new Date(),_0xb5a0cb=[_0x625b2c(0x244),'plisio'],_0x59d4c2=['squirrelpay',_0x625b2c(0x1d2),_0x625b2c(0x216),_0x625b2c(0x23c)],_0x8bbeec=await database_1['default'][_0x625b2c(0x25c)][_0x625b2c(0x222)]({'where':{'type':_0x625b2c(0x20a),'status':_0x625b2c(0x213)},'include':{'payments':{'orderBy':{'createdAt':_0x625b2c(0x246)},'take':0x1}}});console[_0x625b2c(0x20c)](_0x625b2c(0x255)+_0x8bbeec['length']+_0x625b2c(0x1d9));for(const _0xe9bcd9 of _0x8bbeec){try{if(_0xe9bcd9[_0x625b2c(0x22a)]['length']===0x0)continue;const _0x27e6ad=_0xe9bcd9[_0x625b2c(0x22a)][0x0];if(_0x27e6ad['status']==='PAID')continue;const _0x566e5f=_0x3765c0[_0x625b2c(0x1fc)]()-_0x27e6ad[_0x625b2c(0x200)]['getTime']();let _0x55d38a;_0xb5a0cb[_0x625b2c(0x1fa)](_0xe9bcd9['gateway'])||_0x59d4c2[_0x625b2c(0x1fa)](_0xe9bcd9[_0x625b2c(0x1e8)])?_0x55d38a=0x1e*0x3c*0x3e8:_0x55d38a=0x3*0x18*0x3c*0x3c*0x3e8,_0x566e5f>_0x55d38a&&(await database_1[_0x625b2c(0x218)]['paymentLink'][_0x625b2c(0x1da)]({'where':{'id':_0xe9bcd9['id']},'data':{'status':_0x625b2c(0x257)}}),console['log'](_0x625b2c(0x1e9)+_0xe9bcd9['id']+_0x625b2c(0x253)+_0xe9bcd9[_0x625b2c(0x1e8)]+_0x625b2c(0x214)+Math['round'](_0x566e5f/0x3e8/0x3c)+_0x625b2c(0x230)),_0x49d5d6++);}catch(_0x1d178e){const _0x74a173='Failed\x20to\x20expire\x20link\x20'+_0xe9bcd9['id']+':\x20'+(_0x1d178e instanceof Error?_0x1d178e[_0x625b2c(0x1de)]:_0x625b2c(0x239));console['error']('‚ùå\x20'+_0x74a173),_0x2195ef[_0x625b2c(0x215)](_0x74a173);}}return console[_0x625b2c(0x20c)](_0x625b2c(0x207)+_0x49d5d6+_0x625b2c(0x1ef)),{'expired':_0x49d5d6,'errors':_0x2195ef};}catch(_0x25f411){const _0x29060a=_0x625b2c(0x25f)+(_0x25f411 instanceof Error?_0x25f411[_0x625b2c(0x1de)]:_0x625b2c(0x239));return console[_0x625b2c(0x20e)](_0x625b2c(0x202)+_0x29060a),_0x2195ef[_0x625b2c(0x215)](_0x29060a),{'expired':_0x49d5d6,'errors':_0x2195ef};}}}exports[a72_0x17b424(0x1e0)]=PaymentCleanupService,exports[a72_0x17b424(0x21c)]=new PaymentCleanupService();