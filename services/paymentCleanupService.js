'use strict';const a80_0x39efb=a80_0x43d8;(function(_0x55f312,_0x31d456){const _0x25d4e9=a80_0x43d8,_0x32b79c=_0x55f312();while(!![]){try{const _0x13f090=-parseInt(_0x25d4e9(0x142))/0x1+-parseInt(_0x25d4e9(0xf5))/0x2*(parseInt(_0x25d4e9(0x170))/0x3)+-parseInt(_0x25d4e9(0x167))/0x4+-parseInt(_0x25d4e9(0xfc))/0x5*(-parseInt(_0x25d4e9(0x10c))/0x6)+-parseInt(_0x25d4e9(0x12d))/0x7*(-parseInt(_0x25d4e9(0x122))/0x8)+-parseInt(_0x25d4e9(0xe3))/0x9+parseInt(_0x25d4e9(0xe2))/0xa;if(_0x13f090===_0x31d456)break;else _0x32b79c['push'](_0x32b79c['shift']());}catch(_0x3cedaa){_0x32b79c['push'](_0x32b79c['shift']());}}}(a80_0x42bc,0x89f6a));var __importDefault=this&&this[a80_0x39efb(0x13c)]||function(_0x10548b){const _0x30fe39=a80_0x39efb;return _0x10548b&&_0x10548b[_0x30fe39(0xf0)]?_0x10548b:{'default':_0x10548b};};function a80_0x42bc(){const _0x26e6f8=['../config/database','Failed\x20to\x20update\x20PENDING\x20payment\x20','22535350pTGFNZ','3777156oTbktU','loggerService','PROCESSING','message','join','getDate','\x20\x20\x20Created:\x20','getTime','\x20stale\x20PROCESSING\x20payments','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','üèÅ\x20PENDING\x20cleanup\x20completed','recent','Cleanup\x20completed:\x20','__esModule','\x20active\x20SINGLE\x20links\x20to\x20check','payment_cleanup','paymentCleanupService','\x0aüìà\x20Cleanup\x20Summary:','1712dAyCoU','setDate','amount','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','Failed\x20to\x20update\x20payment\x20','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','cleanupStalePendingPayments','1595wPZCdW','\x20\x20\x20Shop:\x20','logWebhookProcessed','length','getProcessingPaymentsStats','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','gateway','üìä\x20','FAILED','oxapay','PaymentStatus','FAST_TIMEOUT_MINUTES','\x20\x20\x20By\x20gateway:','expireSinglePaymentLinks','‚úÖ\x20PENDING\x20payments\x20processed:\x20','name','5142wShsSL','runPendingCleanupOnly','EXPIRED','SINGLE','defineProperty','\x20(gateway:\x20','shop','FAST_TIMEOUT_GATEWAYS','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','status','stale','rapyd','payment','cleanupStaleProcessingPayments','errors','now','\x20minutes)','fresh','auto_timeout','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','Unknown\x20error','PENDING\x20cleanup\x20service\x20error:\x20','166856OvJJNp','default','üìä\x20Expiration\x20completed:\x20','\x20payments\x20updated\x20to\x20EXPIRED,\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','createdAt','visa/mastercard','‚úÖ\x20Updated\x20payment\x20','expired','\x20from\x20PROCESSING\x20to\x20FAILED','byAge','224CtSCJy','processed','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','forEach','username','\x20\x20\x20By\x20status:','total','./loggerService','byGateway','\x20from\x20PENDING\x20to\x20EXPIRED','POST','‚è∞\x20Expired\x20link\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','pending_payment_cleanup','__importDefault','floor','error','PAID','toISOString','\x20\x20\x20Gateway:\x20','615179RRBSkk','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','üèÅ\x20PROCESSING\x20cleanup\x20completed','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','payments','\x20\x20\x20Stale\x20(3-5\x20days):\x20','log','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','\x20\x20\x20Age:\x20','@prisma/client','Failed\x20to\x20get\x20processing\x20payments\x20stats:','byStatus','auto_timeout_pending','desc','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','\x20links\x20expired','\x20\x20\x20\x20\x20\x20','\x20\x20\x20Total:\x20','logApiCall','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','PROCESSING_TIMEOUT_DAYS','mastercard','PENDING','plisio','PENDING\x20cleanup\x20completed:\x20','SLOW_TIMEOUT_DAYS','admin',',\x20payment\x20age:\x20','\x20\x20\x20Amount:\x20','\x20failed\x20to\x20update','\x20\x20\x20Recent\x20(1-3\x20days):\x20','\x20payments\x20updated\x20to\x20FAILED,\x20','logWebhookError','\x20days','squirrel-pay','üîç\x20Found\x20','push','3316468iiOBTR','failed','findMany','üìã\x20Fast\x20timeout\x20gateways:\x20','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','runCleanupWithReport','round','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','2682UOekwL','system','includes','PENDING_TIMEOUT_DAYS','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','runProcessingCleanupOnly','update','üèÅ\x20Payment\x20cleanup\x20service\x20completed','30\x20minutes','\x20minutes','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','currency'];a80_0x42bc=function(){return _0x26e6f8;};return a80_0x42bc();}Object[a80_0x39efb(0x110)](exports,a80_0x39efb(0xf0),{'value':!![]}),exports[a80_0x39efb(0xf3)]=exports['PaymentCleanupService']=void 0x0;function a80_0x43d8(_0x4fa77e,_0x15a2d3){_0x4fa77e=_0x4fa77e-0xda;const _0x42bc13=a80_0x42bc();let _0x43d85e=_0x42bc13[_0x4fa77e];return _0x43d85e;}const database_1=__importDefault(require(a80_0x39efb(0xe0))),client_1=require(a80_0x39efb(0x14b)),loggerService_1=require(a80_0x39efb(0x135));class PaymentCleanupService{constructor(){const _0x45574f=a80_0x39efb;this[_0x45574f(0x156)]=0x5,this[_0x45574f(0x173)]=0x5,this[_0x45574f(0x107)]=0x1e,this[_0x45574f(0x15b)]=0x3,this[_0x45574f(0x113)]=['squirrelpay',_0x45574f(0x164),'rapyd',_0x45574f(0x128),_0x45574f(0x159),_0x45574f(0x105)];}async[a80_0x39efb(0x119)](){const _0x378b30=a80_0x39efb,_0x12a86e=[];let _0x1d3bbe=0x0,_0x9dc4=0x0;try{console['log'](_0x378b30(0x145));const _0x157ff0=new Date();_0x157ff0[_0x378b30(0xf6)](_0x157ff0[_0x378b30(0xe8)]()-this['PROCESSING_TIMEOUT_DAYS']),console['log'](_0x378b30(0x12f)+_0x157ff0[_0x378b30(0x140)]());const _0x45908d=await database_1[_0x378b30(0x123)]['payment'][_0x378b30(0x169)]({'where':{'status':client_1['PaymentStatus'][_0x378b30(0xe5)],'createdAt':{'lt':_0x157ff0}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x378b30(0x148)]('üîç\x20Found\x20'+_0x45908d[_0x378b30(0xff)]+_0x378b30(0xeb));if(_0x45908d['length']===0x0)return console['log']('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2ca6e5 of _0x45908d){try{console[_0x378b30(0x148)](_0x378b30(0x101)+_0x2ca6e5['id']+'\x20('+_0x2ca6e5[_0x378b30(0x102)]+',\x20'+_0x2ca6e5[_0x378b30(0xf7)]+'\x20'+_0x2ca6e5[_0x378b30(0xdf)]+')'),console[_0x378b30(0x148)](_0x378b30(0xfd)+_0x2ca6e5[_0x378b30(0x112)][_0x378b30(0x10b)]+'\x20('+_0x2ca6e5[_0x378b30(0x112)][_0x378b30(0x132)]+')'),console[_0x378b30(0x148)](_0x378b30(0xe9)+_0x2ca6e5[_0x378b30(0x127)][_0x378b30(0x140)]()),console[_0x378b30(0x148)](_0x378b30(0x14a)+Math['floor']((Date[_0x378b30(0x11b)]()-_0x2ca6e5[_0x378b30(0x127)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))+_0x378b30(0x163));const _0x351203=await database_1[_0x378b30(0x123)][_0x378b30(0x118)][_0x378b30(0xda)]({'where':{'id':_0x2ca6e5['id']},'data':{'status':client_1[_0x378b30(0x106)][_0x378b30(0x104)],'statusChangedBy':_0x378b30(0x171),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this[_0x378b30(0x156)]+'\x20days'}});console[_0x378b30(0x148)]('‚úÖ\x20Updated\x20payment\x20'+_0x2ca6e5['id']+_0x378b30(0x12b)),loggerService_1[_0x378b30(0xe4)][_0x378b30(0xfe)](_0x2ca6e5['gateway'],_0x2ca6e5['id'],'PROCESSING',_0x378b30(0x104),{'reason':_0x378b30(0x11e),'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),_0x1d3bbe++;}catch(_0x3235e1){const _0x4354d3=_0x378b30(0xf9)+_0x2ca6e5['id']+':\x20'+(_0x3235e1 instanceof Error?_0x3235e1['message']:_0x378b30(0x120));console[_0x378b30(0x13e)]('‚ùå\x20'+_0x4354d3),_0x12a86e[_0x378b30(0x166)](_0x4354d3),_0x9dc4++;}}const _0x2dd170=_0x378b30(0xef)+_0x1d3bbe+_0x378b30(0x161)+_0x9dc4+_0x378b30(0x15f);return console[_0x378b30(0x148)](_0x378b30(0x103)+_0x2dd170),loggerService_1[_0x378b30(0xe4)]['logApiCall'](_0x378b30(0xf2),_0x378b30(0x138),_0x378b30(0x171),_0x378b30(0x15c),{'processed':_0x1d3bbe,'failed':_0x9dc4,'errors':_0x12a86e,'timeoutDays':this[_0x378b30(0x156)]}),{'processed':_0x1d3bbe,'failed':_0x9dc4,'errors':_0x12a86e};}catch(_0x3d1f2e){const _0x590778='Cleanup\x20service\x20error:\x20'+(_0x3d1f2e instanceof Error?_0x3d1f2e[_0x378b30(0xe6)]:_0x378b30(0x120));return console[_0x378b30(0x13e)]('üí•\x20'+_0x590778),_0x12a86e[_0x378b30(0x166)](_0x590778),loggerService_1['loggerService']['logWebhookError'](_0x378b30(0xf2),_0x590778,{'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x1d3bbe,'failed':_0x9dc4,'errors':_0x12a86e};}}async[a80_0x39efb(0xfb)](){const _0x255332=a80_0x39efb,_0x5e049e=[];let _0x495bf2=0x0,_0xc51fd7=0x0;try{console['log']('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0x1d5df1=new Date(),_0x37efb6=new Date(_0x1d5df1['getTime']()-this[_0x255332(0x107)]*0x3c*0x3e8),_0x4edab4=new Date();_0x4edab4[_0x255332(0xf6)](_0x4edab4[_0x255332(0xe8)]()-this[_0x255332(0x15b)]),console[_0x255332(0x148)](_0x255332(0xfa)+_0x37efb6['toISOString']()),console[_0x255332(0x148)](_0x255332(0x149)+_0x4edab4[_0x255332(0x140)]()),console[_0x255332(0x148)](_0x255332(0x16a)+this[_0x255332(0x113)][_0x255332(0xe7)](',\x20'));const _0x74282d=await database_1['default']['payment']['findMany']({'where':{'status':client_1['PaymentStatus']['PENDING'],'OR':[{'gateway':{'in':this[_0x255332(0x113)]},'createdAt':{'lt':_0x37efb6}},{'gateway':{'notIn':this[_0x255332(0x113)]},'createdAt':{'lt':_0x4edab4}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log'](_0x255332(0x165)+_0x74282d['length']+'\x20stale\x20PENDING\x20payments');if(_0x74282d[_0x255332(0xff)]===0x0)return console[_0x255332(0x148)](_0x255332(0x174)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x3b257f of _0x74282d){try{const _0x3e68af=this[_0x255332(0x113)][_0x255332(0x172)](_0x3b257f['gateway']),_0x17e305=_0x3e68af?_0x255332(0xdc):'3\x20days',_0x46c82a=Math[_0x255332(0x13d)]((Date[_0x255332(0x11b)]()-_0x3b257f[_0x255332(0x127)]['getTime']())/(0x3e8*0x3c));console[_0x255332(0x148)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x3b257f['id']),console[_0x255332(0x148)](_0x255332(0x141)+_0x3b257f[_0x255332(0x102)]+'\x20('+_0x17e305+'\x20timeout)'),console[_0x255332(0x148)](_0x255332(0x15e)+_0x3b257f['amount']+'\x20'+_0x3b257f['currency']),console[_0x255332(0x148)](_0x255332(0xfd)+_0x3b257f[_0x255332(0x112)][_0x255332(0x10b)]+'\x20('+_0x3b257f[_0x255332(0x112)]['username']+')'),console[_0x255332(0x148)]('\x20\x20\x20Created:\x20'+_0x3b257f[_0x255332(0x127)][_0x255332(0x140)]()),console[_0x255332(0x148)](_0x255332(0x14a)+_0x46c82a+_0x255332(0xdd));const _0x190941=await database_1[_0x255332(0x123)][_0x255332(0x118)][_0x255332(0xda)]({'where':{'id':_0x3b257f['id']},'data':{'status':client_1['PaymentStatus'][_0x255332(0x10e)],'statusChangedBy':_0x255332(0x171),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20'+_0x17e305}});console['log'](_0x255332(0x129)+_0x3b257f['id']+_0x255332(0x137)),loggerService_1[_0x255332(0xe4)][_0x255332(0xfe)](_0x3b257f[_0x255332(0x102)],_0x3b257f['id'],'PENDING',_0x255332(0x10e),{'reason':_0x255332(0x14e),'timeout':_0x17e305,'ageMinutes':_0x46c82a}),_0x495bf2++;}catch(_0x5e8460){const _0x1d243e=_0x255332(0xe1)+_0x3b257f['id']+':\x20'+(_0x5e8460 instanceof Error?_0x5e8460['message']:_0x255332(0x120));console[_0x255332(0x13e)]('‚ùå\x20'+_0x1d243e),_0x5e049e[_0x255332(0x166)](_0x1d243e),_0xc51fd7++;}}const _0x2e0180=_0x255332(0x15a)+_0x495bf2+_0x255332(0x125)+_0xc51fd7+_0x255332(0x15f);return console['log'](_0x255332(0x103)+_0x2e0180),loggerService_1[_0x255332(0xe4)][_0x255332(0x154)](_0x255332(0x13b),_0x255332(0x138),_0x255332(0x171),_0x255332(0x15c),{'processed':_0x495bf2,'failed':_0xc51fd7,'errors':_0x5e049e,'fastTimeoutMinutes':this[_0x255332(0x107)],'slowTimeoutDays':this[_0x255332(0x15b)]}),{'processed':_0x495bf2,'failed':_0xc51fd7,'errors':_0x5e049e};}catch(_0x1972cd){const _0x50f774=_0x255332(0x121)+(_0x1972cd instanceof Error?_0x1972cd[_0x255332(0xe6)]:_0x255332(0x120));return console[_0x255332(0x13e)]('üí•\x20'+_0x50f774),_0x5e049e['push'](_0x50f774),loggerService_1[_0x255332(0xe4)][_0x255332(0x162)](_0x255332(0x13b),_0x50f774,{'timeoutDays':this[_0x255332(0x173)]}),{'processed':_0x495bf2,'failed':_0xc51fd7,'errors':_0x5e049e};}}async[a80_0x39efb(0x100)](){const _0x39a993=a80_0x39efb;try{const _0x1a8190=new Date(),_0x374d6c=new Date(_0x1a8190[_0x39a993(0xea)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x200547=new Date(_0x1a8190[_0x39a993(0xea)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x14eaae=new Date(_0x1a8190[_0x39a993(0xea)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x44fc19=await database_1['default'][_0x39a993(0x118)][_0x39a993(0x169)]({'where':{'status':{'in':[client_1['PaymentStatus']['PROCESSING'],client_1[_0x39a993(0x106)][_0x39a993(0x158)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0xc99d7d={'total':_0x44fc19[_0x39a993(0xff)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x49897d of _0x44fc19){if(_0x49897d[_0x39a993(0x127)]>_0x374d6c)_0xc99d7d[_0x39a993(0x12c)]['fresh']++;else{if(_0x49897d[_0x39a993(0x127)]>_0x200547)_0xc99d7d[_0x39a993(0x12c)][_0x39a993(0xee)]++;else _0x49897d[_0x39a993(0x127)]>_0x14eaae?_0xc99d7d[_0x39a993(0x12c)]['stale']++:_0xc99d7d[_0x39a993(0x12c)][_0x39a993(0x12a)]++;}!_0xc99d7d['byGateway'][_0x49897d[_0x39a993(0x102)]]&&(_0xc99d7d[_0x39a993(0x136)][_0x49897d[_0x39a993(0x102)]]=0x0);_0xc99d7d[_0x39a993(0x136)][_0x49897d[_0x39a993(0x102)]]++;const _0x22f570=_0x49897d[_0x39a993(0x115)];!_0xc99d7d['byStatus'][_0x22f570]&&(_0xc99d7d[_0x39a993(0x14d)][_0x22f570]=0x0),_0xc99d7d[_0x39a993(0x14d)][_0x22f570]++;}return _0xc99d7d;}catch(_0x54fe32){console[_0x39a993(0x13e)](_0x39a993(0x14c),_0x54fe32);throw new Error(_0x39a993(0x126)+(_0x54fe32 instanceof Error?_0x54fe32[_0x39a993(0xe6)]:'Unknown\x20error'));}}async[a80_0x39efb(0x16c)](){const _0x4083ca=a80_0x39efb;console['log'](_0x4083ca(0xde));const _0x10888b=await this[_0x4083ca(0x100)]();console[_0x4083ca(0x148)](_0x4083ca(0x143)),console[_0x4083ca(0x148)](_0x4083ca(0x153)+_0x10888b[_0x4083ca(0x134)]),console[_0x4083ca(0x148)](_0x4083ca(0x13a)+_0x10888b[_0x4083ca(0x12c)][_0x4083ca(0x11d)]),console[_0x4083ca(0x148)](_0x4083ca(0x160)+_0x10888b[_0x4083ca(0x12c)][_0x4083ca(0xee)]),console['log'](_0x4083ca(0x147)+_0x10888b[_0x4083ca(0x12c)][_0x4083ca(0x116)]),console[_0x4083ca(0x148)](_0x4083ca(0xec)+_0x10888b['byAge'][_0x4083ca(0x12a)]),console[_0x4083ca(0x148)](_0x4083ca(0x108),_0x10888b[_0x4083ca(0x136)]),console[_0x4083ca(0x148)](_0x4083ca(0x133),_0x10888b['byStatus']),console[_0x4083ca(0x148)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x3ab2ad=await this[_0x4083ca(0x119)]();console[_0x4083ca(0x148)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x2628b8=await this['cleanupStalePendingPayments'](),_0x329502=await this['getProcessingPaymentsStats']();console[_0x4083ca(0x148)](_0x4083ca(0x16b)),console[_0x4083ca(0x148)](_0x4083ca(0x153)+_0x329502[_0x4083ca(0x134)]),console['log'](_0x4083ca(0xec)+_0x329502[_0x4083ca(0x12c)]['expired']),console['log'](_0x4083ca(0x133),_0x329502[_0x4083ca(0x14d)]);const _0x38edb4=_0x3ab2ad[_0x4083ca(0x12e)]+_0x2628b8[_0x4083ca(0x12e)],_0x343d7a=_0x3ab2ad[_0x4083ca(0x168)]+_0x2628b8[_0x4083ca(0x168)],_0x35e481=[..._0x3ab2ad[_0x4083ca(0x11a)],..._0x2628b8['errors']];console['log'](_0x4083ca(0xf4)),console[_0x4083ca(0x148)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x3ab2ad[_0x4083ca(0x12e)]),console[_0x4083ca(0x148)](_0x4083ca(0x114)+_0x2628b8[_0x4083ca(0x12e)]),console['log']('\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20'+_0x38edb4),console[_0x4083ca(0x148)](_0x4083ca(0x16e)+_0x343d7a),console[_0x4083ca(0x148)]('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x10888b['total']-_0x329502[_0x4083ca(0x134)])),_0x35e481[_0x4083ca(0xff)]>0x0&&(console[_0x4083ca(0x148)](_0x4083ca(0x130)),_0x35e481[_0x4083ca(0x131)]((_0xc33d7e,_0x1f7ff5)=>{const _0x35801a=_0x4083ca;console[_0x35801a(0x148)](_0x35801a(0x152)+(_0x1f7ff5+0x1)+'.\x20'+_0xc33d7e);})),console['log'](_0x4083ca(0xdb));}async[a80_0x39efb(0x176)](){const _0x1ab66d=a80_0x39efb;console[_0x1ab66d(0x148)](_0x1ab66d(0xf8));const _0x13381f=await this[_0x1ab66d(0x100)](),_0x5173ba=_0x13381f[_0x1ab66d(0x14d)][_0x1ab66d(0xe5)]||0x0;console['log']('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x5173ba);const _0x280a71=await this[_0x1ab66d(0x119)](),_0x231ac2=await this[_0x1ab66d(0x100)](),_0x3b618d=_0x231ac2[_0x1ab66d(0x14d)][_0x1ab66d(0xe5)]||0x0;console[_0x1ab66d(0x148)](_0x1ab66d(0x155)+_0x3b618d),console[_0x1ab66d(0x148)](_0x1ab66d(0x150)+_0x280a71['processed']),console[_0x1ab66d(0x148)](_0x1ab66d(0x144));}async[a80_0x39efb(0x10d)](){const _0x50ae5b=a80_0x39efb;console[_0x50ae5b(0x148)](_0x50ae5b(0x175));const _0x182ad3=await this[_0x50ae5b(0x100)](),_0x473c62=_0x182ad3[_0x50ae5b(0x14d)][_0x50ae5b(0x158)]||0x0;console['log']('üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20'+_0x473c62);const _0x3e221d=await this[_0x50ae5b(0xfb)](),_0x4623b3=await this['getProcessingPaymentsStats'](),_0x566b37=_0x4623b3[_0x50ae5b(0x14d)][_0x50ae5b(0x158)]||0x0;console[_0x50ae5b(0x148)](_0x50ae5b(0x11f)+_0x566b37),console[_0x50ae5b(0x148)](_0x50ae5b(0x10a)+_0x3e221d[_0x50ae5b(0x12e)]),console['log'](_0x50ae5b(0xed));}async[a80_0x39efb(0x109)](){const _0x56f917=a80_0x39efb,_0x5176b8=[];let _0x586d77=0x0;try{console[_0x56f917(0x148)](_0x56f917(0x16f));const _0x18b05c=new Date(),_0x4b7022=[_0x56f917(0x105),_0x56f917(0x159)],_0x5361d1=['squirrelpay',_0x56f917(0x117),_0x56f917(0x128),_0x56f917(0x157)],_0x4155f0=await database_1['default']['paymentLink']['findMany']({'where':{'type':_0x56f917(0x10f),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':_0x56f917(0x14f)},'take':0x1}}});console[_0x56f917(0x148)]('üîç\x20Found\x20'+_0x4155f0[_0x56f917(0xff)]+_0x56f917(0xf1));for(const _0x2fc45f of _0x4155f0){try{if(_0x2fc45f[_0x56f917(0x146)][_0x56f917(0xff)]===0x0)continue;const _0x5ea4a0=_0x2fc45f[_0x56f917(0x146)][0x0];if(_0x5ea4a0[_0x56f917(0x115)]===_0x56f917(0x13f))continue;const _0x56ab98=_0x18b05c[_0x56f917(0xea)]()-_0x5ea4a0[_0x56f917(0x127)][_0x56f917(0xea)]();let _0x52370e;_0x4b7022['includes'](_0x2fc45f[_0x56f917(0x102)])||_0x5361d1['includes'](_0x2fc45f[_0x56f917(0x102)])?_0x52370e=0x1e*0x3c*0x3e8:_0x52370e=0x3*0x18*0x3c*0x3c*0x3e8,_0x56ab98>_0x52370e&&(await database_1[_0x56f917(0x123)]['paymentLink']['update']({'where':{'id':_0x2fc45f['id']},'data':{'status':_0x56f917(0x10e)}}),console['log'](_0x56f917(0x139)+_0x2fc45f['id']+_0x56f917(0x111)+_0x2fc45f['gateway']+_0x56f917(0x15d)+Math[_0x56f917(0x16d)](_0x56ab98/0x3e8/0x3c)+_0x56f917(0x11c)),_0x586d77++);}catch(_0x376e7c){const _0x9e38c3='Failed\x20to\x20expire\x20link\x20'+_0x2fc45f['id']+':\x20'+(_0x376e7c instanceof Error?_0x376e7c[_0x56f917(0xe6)]:'Unknown\x20error');console[_0x56f917(0x13e)]('‚ùå\x20'+_0x9e38c3),_0x5176b8[_0x56f917(0x166)](_0x9e38c3);}}return console[_0x56f917(0x148)](_0x56f917(0x124)+_0x586d77+_0x56f917(0x151)),{'expired':_0x586d77,'errors':_0x5176b8};}catch(_0x57338b){const _0x39fd26='Link\x20expiration\x20service\x20error:\x20'+(_0x57338b instanceof Error?_0x57338b[_0x56f917(0xe6)]:_0x56f917(0x120));return console[_0x56f917(0x13e)]('üí•\x20'+_0x39fd26),_0x5176b8['push'](_0x39fd26),{'expired':_0x586d77,'errors':_0x5176b8};}}}exports['PaymentCleanupService']=PaymentCleanupService,exports[a80_0x39efb(0xf3)]=new PaymentCleanupService();