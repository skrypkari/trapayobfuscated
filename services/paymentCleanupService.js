'use strict';const a80_0x43566c=a80_0x14f9;(function(_0x8dfda8,_0x4a94a5){const _0x4e13ce=a80_0x14f9,_0x12ffbe=_0x8dfda8();while(!![]){try{const _0x56dbc5=-parseInt(_0x4e13ce(0x24f))/0x1*(-parseInt(_0x4e13ce(0x217))/0x2)+-parseInt(_0x4e13ce(0x248))/0x3*(parseInt(_0x4e13ce(0x224))/0x4)+parseInt(_0x4e13ce(0x26a))/0x5+-parseInt(_0x4e13ce(0x287))/0x6*(-parseInt(_0x4e13ce(0x254))/0x7)+parseInt(_0x4e13ce(0x21a))/0x8*(-parseInt(_0x4e13ce(0x21f))/0x9)+-parseInt(_0x4e13ce(0x206))/0xa*(-parseInt(_0x4e13ce(0x1fd))/0xb)+-parseInt(_0x4e13ce(0x253))/0xc;if(_0x56dbc5===_0x4a94a5)break;else _0x12ffbe['push'](_0x12ffbe['shift']());}catch(_0x1f715c){_0x12ffbe['push'](_0x12ffbe['shift']());}}}(a80_0x58f6,0x47a40));function a80_0x14f9(_0x39dd57,_0xa18968){_0x39dd57=_0x39dd57-0x1ed;const _0x58f6a5=a80_0x58f6();let _0x14f958=_0x58f6a5[_0x39dd57];return _0x14f958;}function a80_0x58f6(){const _0x2dc7ff=['FAST_TIMEOUT_GATEWAYS','byStatus','\x20minutes)','update','payments','stale','ACTIVE','now','paymentCleanupService','ğŸ“Š\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','ğŸ“Š\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','status','toISOString','logWebhookProcessed','cleanupStalePendingPayments','default','expired','__importDefault','squirrelpay','ğŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','\x0ağŸ”„\x20Running\x20PENDING\x20payments\x20cleanup...','\x0ağŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','ğŸš€\x20Starting\x20payment\x20cleanup\x20service...','\x20minutes','desc','ğŸ\x20PENDING\x20cleanup\x20completed','\x20\x20\x20By\x20status:','\x20\x20\x20ğŸ“‰\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','name','PROCESSING','\x20active\x20SINGLE\x20links\x20to\x20check','processed','186KbolIz','PaymentCleanupService','ğŸ“Š\x20PENDING\x20payments\x20before\x20cleanup:\x20','SLOW_TIMEOUT_DAYS','squirrel-pay','admin','oxapay','3PJWJGK','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','\x20\x20\x20âœ…\x20Total\x20successfully\x20processed:\x20','PENDING','7687992SKuCXz','25487lggzff','cleanupStaleProcessingPayments','setDate','logWebhookError','system','PENDING\x20cleanup\x20completed:\x20','â°\x20Expired\x20link\x20','forEach','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','\x20payments\x20updated\x20to\x20FAILED,\x20','paymentLink','currency','\x20\x20\x20By\x20gateway:','message','â°\x20Processing\x20stale\x20PENDING\x20payment:\x20','failed','EXPIRED','\x20timeout)','byGateway','shop','fresh','total','2360435goSwGN','floor','\x20payments\x20updated\x20to\x20EXPIRED,\x20','FAST_TIMEOUT_MINUTES','gateway','\x20\x20\x20Total:\x20','PENDING_TIMEOUT_DAYS','./loggerService','POST','\x0ağŸ”„\x20Running\x20PROCESSING\x20payments\x20cleanup...','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','PaymentStatus','ğŸ“Š\x20PENDING\x20payments\x20after\x20cleanup:\x20','Unknown\x20error','âœ…\x20PENDING\x20payments\x20processed:\x20','\x20\x20\x20âš ï¸\x20Errors\x20encountered:','PROCESSING_TIMEOUT_DAYS','Failed\x20to\x20update\x20payment\x20','ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','runCleanupWithReport','\x20failed\x20to\x20update','getProcessingPaymentsStats','recent','FAILED','ğŸ“Š\x20','rapyd','3\x20days','getTime','\x20stale\x20PENDING\x20payments','438QWXGLl','ğŸ’¥\x20','\x20days','\x20\x20\x20Gateway:\x20','âœ…\x20No\x20stale\x20PROCESSING\x20payments\x20found','âœ…\x20Updated\x20payment\x20','ğŸ“‹\x20Fast\x20timeout\x20gateways:\x20','getDate','ğŸš€\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','plisio','\x20\x20\x20Age:\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','logApiCall','join','Failed\x20to\x20expire\x20link\x20','ğŸ“…\x20Slow\x20timeout\x20(3\x20days):\x20','__esModule','expireSinglePaymentLinks','error','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','3905209nBvURn','@prisma/client','SINGLE','ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','log','findMany','runProcessingCleanupOnly','ğŸš€\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','length','10GsajnQ','\x20\x20\x20Created:\x20','\x20links\x20expired','\x20\x20\x20\x20\x20\x20','\x20\x20\x20âŒ\x20Total\x20failed\x20to\x20process:\x20','\x20\x20\x20ğŸ”„\x20PROCESSING\x20â†’\x20FAILED:\x20','\x20\x20\x20Amount:\x20','ğŸ”\x20Found\x20','\x20\x20\x20Shop:\x20','username','payment','includes','loggerService','Cleanup\x20completed:\x20','amount','ğŸ\x20PROCESSING\x20cleanup\x20completed','âœ…\x20PROCESSING\x20payments\x20processed:\x20','266182gaAuhH','byAge','auto_timeout','80VImqmi','ğŸ“…\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','â°\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','createdAt','Failed\x20to\x20update\x20PENDING\x20payment\x20','205236YdbCuf','visa/mastercard','â±ï¸\x20Processing\x20stale\x20payment:\x20','\x20from\x20PENDING\x20to\x20EXPIRED','ğŸ“Š\x20Expiration\x20completed:\x20','21292HtLpgS','ğŸ“…\x20Fast\x20timeout\x20(30\x20min):\x20','payment_cleanup','push'];a80_0x58f6=function(){return _0x2dc7ff;};return a80_0x58f6();}var __importDefault=this&&this[a80_0x43566c(0x239)]||function(_0x10a527){const _0x27b958=a80_0x43566c;return _0x10a527&&_0x10a527[_0x27b958(0x1f9)]?_0x10a527:{'default':_0x10a527};};Object['defineProperty'](exports,a80_0x43566c(0x1f9),{'value':!![]}),exports[a80_0x43566c(0x230)]=exports[a80_0x43566c(0x249)]=void 0x0;const database_1=__importDefault(require('../config/database')),client_1=require(a80_0x43566c(0x1fe)),loggerService_1=require(a80_0x43566c(0x271));class PaymentCleanupService{constructor(){const _0x2d83fb=a80_0x43566c;this[_0x2d83fb(0x27a)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x2d83fb(0x26d)]=0x1e,this[_0x2d83fb(0x24b)]=0x3,this[_0x2d83fb(0x228)]=[_0x2d83fb(0x23a),_0x2d83fb(0x24c),_0x2d83fb(0x283),_0x2d83fb(0x220),_0x2d83fb(0x1f2),_0x2d83fb(0x24e)];}async[a80_0x43566c(0x255)](){const _0xb0b51b=a80_0x43566c,_0x63d839=[];let _0x328fb4=0x0,_0x12d90d=0x0;try{console[_0xb0b51b(0x201)](_0xb0b51b(0x27c));const _0x10359f=new Date();_0x10359f[_0xb0b51b(0x256)](_0x10359f[_0xb0b51b(0x1f0)]()-this[_0xb0b51b(0x27a)]),console[_0xb0b51b(0x201)](_0xb0b51b(0x21b)+_0x10359f[_0xb0b51b(0x234)]());const _0x18bbd9=await database_1[_0xb0b51b(0x237)][_0xb0b51b(0x210)][_0xb0b51b(0x202)]({'where':{'status':client_1[_0xb0b51b(0x275)][_0xb0b51b(0x245)],'createdAt':{'lt':_0x10359f}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0xb0b51b(0x201)](_0xb0b51b(0x20d)+_0x18bbd9[_0xb0b51b(0x205)]+'\x20stale\x20PROCESSING\x20payments');if(_0x18bbd9[_0xb0b51b(0x205)]===0x0)return console[_0xb0b51b(0x201)](_0xb0b51b(0x1ed)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x4d979d of _0x18bbd9){try{console[_0xb0b51b(0x201)](_0xb0b51b(0x221)+_0x4d979d['id']+'\x20('+_0x4d979d[_0xb0b51b(0x26e)]+',\x20'+_0x4d979d[_0xb0b51b(0x214)]+'\x20'+_0x4d979d[_0xb0b51b(0x25f)]+')'),console[_0xb0b51b(0x201)](_0xb0b51b(0x20e)+_0x4d979d[_0xb0b51b(0x267)][_0xb0b51b(0x244)]+'\x20('+_0x4d979d[_0xb0b51b(0x267)][_0xb0b51b(0x20f)]+')'),console['log'](_0xb0b51b(0x207)+_0x4d979d['createdAt'][_0xb0b51b(0x234)]()),console[_0xb0b51b(0x201)](_0xb0b51b(0x1f3)+Math['floor']((Date['now']()-_0x4d979d[_0xb0b51b(0x21d)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x35a9f5=await database_1[_0xb0b51b(0x237)][_0xb0b51b(0x210)][_0xb0b51b(0x22b)]({'where':{'id':_0x4d979d['id']},'data':{'status':client_1['PaymentStatus']['FAILED'],'statusChangedBy':_0xb0b51b(0x258),'statusChangedAt':new Date(),'failureMessage':_0xb0b51b(0x274)+this['PROCESSING_TIMEOUT_DAYS']+_0xb0b51b(0x289)}});console['log'](_0xb0b51b(0x1ee)+_0x4d979d['id']+'\x20from\x20PROCESSING\x20to\x20FAILED'),loggerService_1['loggerService'][_0xb0b51b(0x235)](_0x4d979d['gateway'],_0x4d979d['id'],_0xb0b51b(0x245),_0xb0b51b(0x281),{'reason':_0xb0b51b(0x219),'timeoutDays':this[_0xb0b51b(0x27a)]}),_0x328fb4++;}catch(_0xcb72a9){const _0x119894=_0xb0b51b(0x27b)+_0x4d979d['id']+':\x20'+(_0xcb72a9 instanceof Error?_0xcb72a9[_0xb0b51b(0x261)]:_0xb0b51b(0x277));console[_0xb0b51b(0x1fb)]('âŒ\x20'+_0x119894),_0x63d839[_0xb0b51b(0x227)](_0x119894),_0x12d90d++;}}const _0x3bc5d1=_0xb0b51b(0x213)+_0x328fb4+_0xb0b51b(0x25d)+_0x12d90d+_0xb0b51b(0x27e);return console[_0xb0b51b(0x201)](_0xb0b51b(0x282)+_0x3bc5d1),loggerService_1[_0xb0b51b(0x212)][_0xb0b51b(0x1f5)](_0xb0b51b(0x226),_0xb0b51b(0x272),'system',_0xb0b51b(0x24d),{'processed':_0x328fb4,'failed':_0x12d90d,'errors':_0x63d839,'timeoutDays':this[_0xb0b51b(0x27a)]}),{'processed':_0x328fb4,'failed':_0x12d90d,'errors':_0x63d839};}catch(_0x2bbc07){const _0x2b593a='Cleanup\x20service\x20error:\x20'+(_0x2bbc07 instanceof Error?_0x2bbc07[_0xb0b51b(0x261)]:_0xb0b51b(0x277));return console[_0xb0b51b(0x1fb)](_0xb0b51b(0x288)+_0x2b593a),_0x63d839['push'](_0x2b593a),loggerService_1['loggerService'][_0xb0b51b(0x257)]('payment_cleanup',_0x2b593a,{'timeoutDays':this[_0xb0b51b(0x27a)]}),{'processed':_0x328fb4,'failed':_0x12d90d,'errors':_0x63d839};}}async[a80_0x43566c(0x236)](){const _0x2fbcae=a80_0x43566c,_0x551425=[];let _0x3e89d1=0x0,_0x184a01=0x0;try{console['log'](_0x2fbcae(0x200));const _0x245e23=new Date(),_0x86dbe4=new Date(_0x245e23[_0x2fbcae(0x285)]()-this['FAST_TIMEOUT_MINUTES']*0x3c*0x3e8),_0x470382=new Date();_0x470382[_0x2fbcae(0x256)](_0x470382[_0x2fbcae(0x1f0)]()-this[_0x2fbcae(0x24b)]),console[_0x2fbcae(0x201)](_0x2fbcae(0x225)+_0x86dbe4['toISOString']()),console[_0x2fbcae(0x201)](_0x2fbcae(0x1f8)+_0x470382[_0x2fbcae(0x234)]()),console[_0x2fbcae(0x201)](_0x2fbcae(0x1ef)+this[_0x2fbcae(0x228)][_0x2fbcae(0x1f6)](',\x20'));const _0x1a46c8=await database_1['default'][_0x2fbcae(0x210)][_0x2fbcae(0x202)]({'where':{'status':client_1['PaymentStatus'][_0x2fbcae(0x252)],'OR':[{'gateway':{'in':this[_0x2fbcae(0x228)]},'createdAt':{'lt':_0x86dbe4}},{'gateway':{'notIn':this[_0x2fbcae(0x228)]},'createdAt':{'lt':_0x470382}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2fbcae(0x201)]('ğŸ”\x20Found\x20'+_0x1a46c8[_0x2fbcae(0x205)]+_0x2fbcae(0x286));if(_0x1a46c8[_0x2fbcae(0x205)]===0x0)return console['log']('âœ…\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x3aabb6 of _0x1a46c8){try{const _0x575ba0=this['FAST_TIMEOUT_GATEWAYS'][_0x2fbcae(0x211)](_0x3aabb6[_0x2fbcae(0x26e)]),_0x4409d9=_0x575ba0?'30\x20minutes':_0x2fbcae(0x284),_0x2da5da=Math[_0x2fbcae(0x26b)]((Date[_0x2fbcae(0x22f)]()-_0x3aabb6['createdAt'][_0x2fbcae(0x285)]())/(0x3e8*0x3c));console['log'](_0x2fbcae(0x262)+_0x3aabb6['id']),console[_0x2fbcae(0x201)](_0x2fbcae(0x28a)+_0x3aabb6[_0x2fbcae(0x26e)]+'\x20('+_0x4409d9+_0x2fbcae(0x265)),console['log'](_0x2fbcae(0x20c)+_0x3aabb6[_0x2fbcae(0x214)]+'\x20'+_0x3aabb6[_0x2fbcae(0x25f)]),console[_0x2fbcae(0x201)](_0x2fbcae(0x20e)+_0x3aabb6['shop'][_0x2fbcae(0x244)]+'\x20('+_0x3aabb6[_0x2fbcae(0x267)][_0x2fbcae(0x20f)]+')'),console[_0x2fbcae(0x201)](_0x2fbcae(0x207)+_0x3aabb6['createdAt'][_0x2fbcae(0x234)]()),console[_0x2fbcae(0x201)]('\x20\x20\x20Age:\x20'+_0x2da5da+_0x2fbcae(0x23f));const _0xc35f2e=await database_1[_0x2fbcae(0x237)][_0x2fbcae(0x210)][_0x2fbcae(0x22b)]({'where':{'id':_0x3aabb6['id']},'data':{'status':client_1[_0x2fbcae(0x275)][_0x2fbcae(0x264)],'statusChangedBy':_0x2fbcae(0x258),'statusChangedAt':new Date(),'failureMessage':_0x2fbcae(0x1fc)+_0x4409d9}});console[_0x2fbcae(0x201)](_0x2fbcae(0x1ee)+_0x3aabb6['id']+_0x2fbcae(0x222)),loggerService_1[_0x2fbcae(0x212)][_0x2fbcae(0x235)](_0x3aabb6['gateway'],_0x3aabb6['id'],_0x2fbcae(0x252),'EXPIRED',{'reason':'auto_timeout_pending','timeout':_0x4409d9,'ageMinutes':_0x2da5da}),_0x3e89d1++;}catch(_0x51ba47){const _0x52168f=_0x2fbcae(0x21e)+_0x3aabb6['id']+':\x20'+(_0x51ba47 instanceof Error?_0x51ba47[_0x2fbcae(0x261)]:_0x2fbcae(0x277));console[_0x2fbcae(0x1fb)]('âŒ\x20'+_0x52168f),_0x551425['push'](_0x52168f),_0x184a01++;}}const _0x40e4b3=_0x2fbcae(0x259)+_0x3e89d1+_0x2fbcae(0x26c)+_0x184a01+_0x2fbcae(0x27e);return console[_0x2fbcae(0x201)]('ğŸ“Š\x20'+_0x40e4b3),loggerService_1[_0x2fbcae(0x212)]['logApiCall']('pending_payment_cleanup','POST','system',_0x2fbcae(0x24d),{'processed':_0x3e89d1,'failed':_0x184a01,'errors':_0x551425,'fastTimeoutMinutes':this[_0x2fbcae(0x26d)],'slowTimeoutDays':this[_0x2fbcae(0x24b)]}),{'processed':_0x3e89d1,'failed':_0x184a01,'errors':_0x551425};}catch(_0x4b48f2){const _0x2977bb='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x4b48f2 instanceof Error?_0x4b48f2[_0x2fbcae(0x261)]:_0x2fbcae(0x277));return console[_0x2fbcae(0x1fb)](_0x2fbcae(0x288)+_0x2977bb),_0x551425[_0x2fbcae(0x227)](_0x2977bb),loggerService_1[_0x2fbcae(0x212)][_0x2fbcae(0x257)]('pending_payment_cleanup',_0x2977bb,{'timeoutDays':this[_0x2fbcae(0x270)]}),{'processed':_0x3e89d1,'failed':_0x184a01,'errors':_0x551425};}}async[a80_0x43566c(0x27f)](){const _0x53cc72=a80_0x43566c;try{const _0xd951cd=new Date(),_0x497b8d=new Date(_0xd951cd[_0x53cc72(0x285)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x2e8880=new Date(_0xd951cd[_0x53cc72(0x285)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x3c4747=new Date(_0xd951cd[_0x53cc72(0x285)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x175b14=await database_1[_0x53cc72(0x237)][_0x53cc72(0x210)][_0x53cc72(0x202)]({'where':{'status':{'in':[client_1['PaymentStatus'][_0x53cc72(0x245)],client_1[_0x53cc72(0x275)][_0x53cc72(0x252)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x5de016={'total':_0x175b14[_0x53cc72(0x205)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x5653ea of _0x175b14){if(_0x5653ea[_0x53cc72(0x21d)]>_0x497b8d)_0x5de016[_0x53cc72(0x218)]['fresh']++;else{if(_0x5653ea[_0x53cc72(0x21d)]>_0x2e8880)_0x5de016[_0x53cc72(0x218)]['recent']++;else _0x5653ea[_0x53cc72(0x21d)]>_0x3c4747?_0x5de016[_0x53cc72(0x218)][_0x53cc72(0x22d)]++:_0x5de016[_0x53cc72(0x218)][_0x53cc72(0x238)]++;}!_0x5de016['byGateway'][_0x5653ea[_0x53cc72(0x26e)]]&&(_0x5de016['byGateway'][_0x5653ea[_0x53cc72(0x26e)]]=0x0);_0x5de016['byGateway'][_0x5653ea[_0x53cc72(0x26e)]]++;const _0x48e569=_0x5653ea[_0x53cc72(0x233)];!_0x5de016[_0x53cc72(0x229)][_0x48e569]&&(_0x5de016['byStatus'][_0x48e569]=0x0),_0x5de016[_0x53cc72(0x229)][_0x48e569]++;}return _0x5de016;}catch(_0x53cec2){console[_0x53cc72(0x1fb)]('Failed\x20to\x20get\x20processing\x20payments\x20stats:',_0x53cec2);throw new Error(_0x53cc72(0x1f4)+(_0x53cec2 instanceof Error?_0x53cec2['message']:_0x53cc72(0x277)));}}async[a80_0x43566c(0x27d)](){const _0x4c729f=a80_0x43566c;console[_0x4c729f(0x201)](_0x4c729f(0x23e));const _0x36c208=await this[_0x4c729f(0x27f)]();console[_0x4c729f(0x201)](_0x4c729f(0x23b)),console['log'](_0x4c729f(0x26f)+_0x36c208['total']),console['log'](_0x4c729f(0x250)+_0x36c208[_0x4c729f(0x218)][_0x4c729f(0x268)]),console[_0x4c729f(0x201)]('\x20\x20\x20Recent\x20(1-3\x20days):\x20'+_0x36c208[_0x4c729f(0x218)][_0x4c729f(0x280)]),console[_0x4c729f(0x201)]('\x20\x20\x20Stale\x20(3-5\x20days):\x20'+_0x36c208[_0x4c729f(0x218)]['stale']),console[_0x4c729f(0x201)](_0x4c729f(0x25c)+_0x36c208[_0x4c729f(0x218)][_0x4c729f(0x238)]),console['log'](_0x4c729f(0x260),_0x36c208[_0x4c729f(0x266)]),console[_0x4c729f(0x201)](_0x4c729f(0x242),_0x36c208[_0x4c729f(0x229)]),console[_0x4c729f(0x201)](_0x4c729f(0x273));const _0x2c5a29=await this[_0x4c729f(0x255)]();console[_0x4c729f(0x201)](_0x4c729f(0x23c));const _0x2ae3ef=await this[_0x4c729f(0x236)](),_0x21ea55=await this['getProcessingPaymentsStats']();console[_0x4c729f(0x201)](_0x4c729f(0x23d)),console[_0x4c729f(0x201)](_0x4c729f(0x26f)+_0x21ea55[_0x4c729f(0x269)]),console['log'](_0x4c729f(0x25c)+_0x21ea55['byAge']['expired']),console[_0x4c729f(0x201)]('\x20\x20\x20By\x20status:',_0x21ea55[_0x4c729f(0x229)]);const _0x1df51e=_0x2c5a29[_0x4c729f(0x247)]+_0x2ae3ef['processed'],_0x33da7c=_0x2c5a29['failed']+_0x2ae3ef[_0x4c729f(0x263)],_0x1e7bd7=[..._0x2c5a29['errors'],..._0x2ae3ef['errors']];console['log']('\x0ağŸ“ˆ\x20Cleanup\x20Summary:'),console[_0x4c729f(0x201)](_0x4c729f(0x20b)+_0x2c5a29[_0x4c729f(0x247)]),console['log']('\x20\x20\x20â°\x20PENDING\x20â†’\x20EXPIRED:\x20'+_0x2ae3ef[_0x4c729f(0x247)]),console[_0x4c729f(0x201)](_0x4c729f(0x251)+_0x1df51e),console[_0x4c729f(0x201)](_0x4c729f(0x20a)+_0x33da7c),console[_0x4c729f(0x201)](_0x4c729f(0x243)+(_0x36c208[_0x4c729f(0x269)]-_0x21ea55[_0x4c729f(0x269)])),_0x1e7bd7[_0x4c729f(0x205)]>0x0&&(console[_0x4c729f(0x201)](_0x4c729f(0x279)),_0x1e7bd7[_0x4c729f(0x25b)]((_0x285878,_0x2ef83b)=>{const _0x4233d9=_0x4c729f;console[_0x4233d9(0x201)](_0x4233d9(0x209)+(_0x2ef83b+0x1)+'.\x20'+_0x285878);})),console[_0x4c729f(0x201)]('ğŸ\x20Payment\x20cleanup\x20service\x20completed');}async[a80_0x43566c(0x203)](){const _0x5c6ee9=a80_0x43566c;console['log'](_0x5c6ee9(0x1f1));const _0x2bc8c2=await this['getProcessingPaymentsStats'](),_0x38d949=_0x2bc8c2['byStatus'][_0x5c6ee9(0x245)]||0x0;console[_0x5c6ee9(0x201)](_0x5c6ee9(0x232)+_0x38d949);const _0x57d9dc=await this[_0x5c6ee9(0x255)](),_0x52f63f=await this[_0x5c6ee9(0x27f)](),_0x134850=_0x52f63f[_0x5c6ee9(0x229)][_0x5c6ee9(0x245)]||0x0;console[_0x5c6ee9(0x201)](_0x5c6ee9(0x231)+_0x134850),console[_0x5c6ee9(0x201)](_0x5c6ee9(0x216)+_0x57d9dc[_0x5c6ee9(0x247)]),console['log'](_0x5c6ee9(0x215));}async['runPendingCleanupOnly'](){const _0xf60a6d=a80_0x43566c;console[_0xf60a6d(0x201)](_0xf60a6d(0x204));const _0x204d68=await this['getProcessingPaymentsStats'](),_0x4eb35a=_0x204d68[_0xf60a6d(0x229)][_0xf60a6d(0x252)]||0x0;console[_0xf60a6d(0x201)](_0xf60a6d(0x24a)+_0x4eb35a);const _0x263821=await this[_0xf60a6d(0x236)](),_0x6d0b81=await this['getProcessingPaymentsStats'](),_0x7bda77=_0x6d0b81[_0xf60a6d(0x229)][_0xf60a6d(0x252)]||0x0;console['log'](_0xf60a6d(0x276)+_0x7bda77),console[_0xf60a6d(0x201)](_0xf60a6d(0x278)+_0x263821[_0xf60a6d(0x247)]),console[_0xf60a6d(0x201)](_0xf60a6d(0x241));}async[a80_0x43566c(0x1fa)](){const _0x584fe4=a80_0x43566c,_0x23b235=[];let _0x586da4=0x0;try{console[_0x584fe4(0x201)](_0x584fe4(0x21c));const _0x2c402a=new Date(),_0x32a7ea=[_0x584fe4(0x24e),_0x584fe4(0x1f2)],_0x20d885=['squirrelpay',_0x584fe4(0x283),_0x584fe4(0x220),'mastercard'],_0x4379af=await database_1[_0x584fe4(0x237)][_0x584fe4(0x25e)][_0x584fe4(0x202)]({'where':{'type':_0x584fe4(0x1ff),'status':_0x584fe4(0x22e)},'include':{'payments':{'orderBy':{'createdAt':_0x584fe4(0x240)},'take':0x1}}});console[_0x584fe4(0x201)]('ğŸ”\x20Found\x20'+_0x4379af[_0x584fe4(0x205)]+_0x584fe4(0x246));for(const _0x5a7743 of _0x4379af){try{if(_0x5a7743[_0x584fe4(0x22c)][_0x584fe4(0x205)]===0x0)continue;const _0x4059fc=_0x5a7743[_0x584fe4(0x22c)][0x0];if(_0x4059fc[_0x584fe4(0x233)]==='PAID')continue;const _0x9eb2fe=_0x2c402a['getTime']()-_0x4059fc[_0x584fe4(0x21d)]['getTime']();let _0x234cc5;_0x32a7ea[_0x584fe4(0x211)](_0x5a7743[_0x584fe4(0x26e)])||_0x20d885[_0x584fe4(0x211)](_0x5a7743[_0x584fe4(0x26e)])?_0x234cc5=0x1e*0x3c*0x3e8:_0x234cc5=0x3*0x18*0x3c*0x3c*0x3e8,_0x9eb2fe>_0x234cc5&&(await database_1[_0x584fe4(0x237)][_0x584fe4(0x25e)][_0x584fe4(0x22b)]({'where':{'id':_0x5a7743['id']},'data':{'status':_0x584fe4(0x264)}}),console[_0x584fe4(0x201)](_0x584fe4(0x25a)+_0x5a7743['id']+'\x20(gateway:\x20'+_0x5a7743['gateway']+',\x20payment\x20age:\x20'+Math['round'](_0x9eb2fe/0x3e8/0x3c)+_0x584fe4(0x22a)),_0x586da4++);}catch(_0x57c761){const _0x1e05e0=_0x584fe4(0x1f7)+_0x5a7743['id']+':\x20'+(_0x57c761 instanceof Error?_0x57c761['message']:'Unknown\x20error');console[_0x584fe4(0x1fb)]('âŒ\x20'+_0x1e05e0),_0x23b235['push'](_0x1e05e0);}}return console['log'](_0x584fe4(0x223)+_0x586da4+_0x584fe4(0x208)),{'expired':_0x586da4,'errors':_0x23b235};}catch(_0x130181){const _0x3c0f9b='Link\x20expiration\x20service\x20error:\x20'+(_0x130181 instanceof Error?_0x130181['message']:'Unknown\x20error');return console[_0x584fe4(0x1fb)](_0x584fe4(0x288)+_0x3c0f9b),_0x23b235[_0x584fe4(0x227)](_0x3c0f9b),{'expired':_0x586da4,'errors':_0x23b235};}}}exports[a80_0x43566c(0x249)]=PaymentCleanupService,exports['paymentCleanupService']=new PaymentCleanupService();