'use strict';const a80_0x7aac7c=a80_0x4bab;(function(_0x5356f8,_0x34bfd1){const _0x3a013c=a80_0x4bab,_0x1b2726=_0x5356f8();while(!![]){try{const _0x574625=parseInt(_0x3a013c(0xbc))/0x1*(-parseInt(_0x3a013c(0x108))/0x2)+-parseInt(_0x3a013c(0xd8))/0x3*(-parseInt(_0x3a013c(0xbb))/0x4)+parseInt(_0x3a013c(0x10a))/0x5+-parseInt(_0x3a013c(0xa9))/0x6+-parseInt(_0x3a013c(0xfe))/0x7+-parseInt(_0x3a013c(0x101))/0x8*(-parseInt(_0x3a013c(0x94))/0x9)+-parseInt(_0x3a013c(0x82))/0xa*(-parseInt(_0x3a013c(0xad))/0xb);if(_0x574625===_0x34bfd1)break;else _0x1b2726['push'](_0x1b2726['shift']());}catch(_0x2f13d5){_0x1b2726['push'](_0x1b2726['shift']());}}}(a80_0x4ac5,0xa210a));var __importDefault=this&&this['__importDefault']||function(_0x212167){const _0x832cc8=a80_0x4bab;return _0x212167&&_0x212167[_0x832cc8(0x83)]?_0x212167:{'default':_0x212167};};Object[a80_0x7aac7c(0x93)](exports,'__esModule',{'value':!![]}),exports[a80_0x7aac7c(0x116)]=exports[a80_0x7aac7c(0xcd)]=void 0x0;const database_1=__importDefault(require(a80_0x7aac7c(0x85))),client_1=require(a80_0x7aac7c(0xc3)),loggerService_1=require(a80_0x7aac7c(0xc4));function a80_0x4ac5(){const _0x1298b4=['toISOString','Cleanup\x20completed:\x20','6VrJgNL','byStatus','status','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','üèÅ\x20PENDING\x20cleanup\x20completed','Link\x20expiration\x20service\x20error:\x20','PENDING\x20cleanup\x20service\x20error:\x20','üí•\x20','Failed\x20to\x20update\x20PENDING\x20payment\x20','auto_timeout','PENDING\x20cleanup\x20completed:\x20','join','payment_cleanup','logApiCall','expired','PAID','recent','\x20links\x20expired','‚úÖ\x20Updated\x20payment\x20','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','cleanupStalePendingPayments','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','FAILED','pending_payment_cleanup','currency','\x20\x20\x20\x20\x20\x20','username','fresh','name','FAST_TIMEOUT_GATEWAYS','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','üîç\x20Found\x20','EXPIRED','loggerService','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','\x20minutes','getTime','\x20\x20\x20By\x20status:','4737579XGWwQZ','findMany','paymentLink','8DysGVp','\x20stale\x20PROCESSING\x20payments','auto_timeout_pending','message','Failed\x20to\x20expire\x20link\x20','system','expireSinglePaymentLinks','2IAioCi','logWebhookProcessed','4261645SWPHhs','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','getProcessingPaymentsStats','FAST_TIMEOUT_MINUTES','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','update','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','PROCESSING','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','\x20failed\x20to\x20update','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','\x20days','paymentCleanupService','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','includes','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','üèÅ\x20Payment\x20cleanup\x20service\x20completed','byGateway','length','cleanupStaleProcessingPayments','Cleanup\x20service\x20error:\x20','6213790HXEPTt','__esModule','PENDING_TIMEOUT_DAYS','../config/database','\x20(gateway:\x20','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','PROCESSING_TIMEOUT_DAYS','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:','errors','forEach','now','\x20\x20\x20By\x20gateway:','getDate','floor','stale','runPendingCleanupOnly','defineProperty','8676720yoOJuk','üèÅ\x20PROCESSING\x20cleanup\x20completed','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','log','default','\x20\x20\x20Gateway:\x20','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','payments','\x20stale\x20PENDING\x20payments','squirrelpay','\x20from\x20PENDING\x20to\x20EXPIRED','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','processed','admin','\x20minutes)','POST','Failed\x20to\x20update\x20payment\x20','\x20\x20\x20Stale\x20(3-5\x20days):\x20','mastercard','payment','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','7500660GeInij','ACTIVE','\x20\x20\x20Created:\x20','shop','33nwksaK','push','Unknown\x20error','‚è∞\x20Expired\x20link\x20','PENDING','gateway','setDate','failed','\x20\x20\x20Total:\x20','error','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','\x20\x20\x20Shop:\x20','PaymentStatus','oxapay','358384OsyLjy','1269013UNQWAg','byAge','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','30\x20minutes','\x20\x20\x20Age:\x20','3\x20days','üìä\x20','@prisma/client','./loggerService','üìã\x20Fast\x20timeout\x20gateways:\x20','\x20\x20\x20Recent\x20(1-3\x20days):\x20','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20',',\x20payment\x20age:\x20','rapyd','desc','logWebhookError','PaymentCleanupService','createdAt','\x20payments\x20updated\x20to\x20FAILED,\x20','SLOW_TIMEOUT_DAYS','SINGLE','runCleanupWithReport','total','amount','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...'];a80_0x4ac5=function(){return _0x1298b4;};return a80_0x4ac5();}class PaymentCleanupService{constructor(){const _0x58b344=a80_0x7aac7c;this[_0x58b344(0x88)]=0x5,this[_0x58b344(0x84)]=0x5,this['FAST_TIMEOUT_MINUTES']=0x1e,this['SLOW_TIMEOUT_DAYS']=0x3,this['FAST_TIMEOUT_GATEWAYS']=[_0x58b344(0x9d),'squirrel-pay','rapyd','visa/mastercard','plisio',_0x58b344(0xba)];}async[a80_0x7aac7c(0x80)](){const _0x15d71b=a80_0x7aac7c,_0x497fb0=[];let _0x15d86f=0x0,_0x5c2a95=0x0;try{console[_0x15d71b(0x97)](_0x15d71b(0x112));const _0xbd7fc1=new Date();_0xbd7fc1[_0x15d71b(0xb3)](_0xbd7fc1[_0x15d71b(0x8f)]()-this[_0x15d71b(0x88)]),console[_0x15d71b(0x97)]('üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20'+_0xbd7fc1[_0x15d71b(0xd6)]());const _0x27ca6c=await database_1[_0x15d71b(0x98)][_0x15d71b(0xa7)][_0x15d71b(0xff)]({'where':{'status':client_1[_0x15d71b(0xb9)][_0x15d71b(0x111)],'createdAt':{'lt':_0xbd7fc1}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x15d71b(0x97)](_0x15d71b(0xf7)+_0x27ca6c[_0x15d71b(0x7f)]+_0x15d71b(0x102));if(_0x27ca6c[_0x15d71b(0x7f)]===0x0)return console[_0x15d71b(0x97)](_0x15d71b(0xc7)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2a9ca6 of _0x27ca6c){try{console[_0x15d71b(0x97)]('‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20'+_0x2a9ca6['id']+'\x20('+_0x2a9ca6[_0x15d71b(0xb2)]+',\x20'+_0x2a9ca6['amount']+'\x20'+_0x2a9ca6[_0x15d71b(0xf0)]+')'),console[_0x15d71b(0x97)](_0x15d71b(0xb8)+_0x2a9ca6['shop'][_0x15d71b(0xf4)]+'\x20('+_0x2a9ca6[_0x15d71b(0xac)]['username']+')'),console[_0x15d71b(0x97)](_0x15d71b(0xab)+_0x2a9ca6['createdAt']['toISOString']()),console[_0x15d71b(0x97)](_0x15d71b(0xc0)+Math[_0x15d71b(0x90)]((Date[_0x15d71b(0x8d)]()-_0x2a9ca6[_0x15d71b(0xce)][_0x15d71b(0xfc)]())/(0x3e8*0x3c*0x3c*0x18))+_0x15d71b(0x115));const _0x9d6984=await database_1['default'][_0x15d71b(0xa7)][_0x15d71b(0x10f)]({'where':{'id':_0x2a9ca6['id']},'data':{'status':client_1['PaymentStatus'][_0x15d71b(0xee)],'statusChangedBy':_0x15d71b(0x106),'statusChangedAt':new Date(),'failureMessage':_0x15d71b(0x110)+this[_0x15d71b(0x88)]+_0x15d71b(0x115)}});console['log'](_0x15d71b(0xea)+_0x2a9ca6['id']+'\x20from\x20PROCESSING\x20to\x20FAILED'),loggerService_1[_0x15d71b(0xf9)][_0x15d71b(0x109)](_0x2a9ca6[_0x15d71b(0xb2)],_0x2a9ca6['id'],_0x15d71b(0x111),_0x15d71b(0xee),{'reason':_0x15d71b(0xe1),'timeoutDays':this[_0x15d71b(0x88)]}),_0x15d86f++;}catch(_0x4c3fea){const _0x412d9c=_0x15d71b(0xa4)+_0x2a9ca6['id']+':\x20'+(_0x4c3fea instanceof Error?_0x4c3fea['message']:_0x15d71b(0xaf));console[_0x15d71b(0xb6)]('‚ùå\x20'+_0x412d9c),_0x497fb0[_0x15d71b(0xae)](_0x412d9c),_0x5c2a95++;}}const _0x572c3c=_0x15d71b(0xd7)+_0x15d86f+_0x15d71b(0xcf)+_0x5c2a95+_0x15d71b(0x113);return console[_0x15d71b(0x97)](_0x15d71b(0xc2)+_0x572c3c),loggerService_1[_0x15d71b(0xf9)][_0x15d71b(0xe5)](_0x15d71b(0xe4),'POST',_0x15d71b(0x106),_0x15d71b(0xa1),{'processed':_0x15d86f,'failed':_0x5c2a95,'errors':_0x497fb0,'timeoutDays':this[_0x15d71b(0x88)]}),{'processed':_0x15d86f,'failed':_0x5c2a95,'errors':_0x497fb0};}catch(_0x5c1698){const _0x3c1336=_0x15d71b(0x81)+(_0x5c1698 instanceof Error?_0x5c1698[_0x15d71b(0x104)]:_0x15d71b(0xaf));return console['error'](_0x15d71b(0xdf)+_0x3c1336),_0x497fb0[_0x15d71b(0xae)](_0x3c1336),loggerService_1['loggerService'][_0x15d71b(0xcc)]('payment_cleanup',_0x3c1336,{'timeoutDays':this[_0x15d71b(0x88)]}),{'processed':_0x15d86f,'failed':_0x5c2a95,'errors':_0x497fb0};}}async[a80_0x7aac7c(0xec)](){const _0x2f8071=a80_0x7aac7c,_0x26bcf4=[];let _0x52e419=0x0,_0x367540=0x0;try{console[_0x2f8071(0x97)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0x5004b6=new Date(),_0x4606d0=new Date(_0x5004b6['getTime']()-this[_0x2f8071(0x10d)]*0x3c*0x3e8),_0x1c0db2=new Date();_0x1c0db2[_0x2f8071(0xb3)](_0x1c0db2[_0x2f8071(0x8f)]()-this[_0x2f8071(0xd0)]),console['log']('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x4606d0[_0x2f8071(0xd6)]()),console['log'](_0x2f8071(0xed)+_0x1c0db2['toISOString']()),console[_0x2f8071(0x97)](_0x2f8071(0xc5)+this[_0x2f8071(0xf5)][_0x2f8071(0xe3)](',\x20'));const _0x3cc20a=await database_1[_0x2f8071(0x98)][_0x2f8071(0xa7)][_0x2f8071(0xff)]({'where':{'status':client_1[_0x2f8071(0xb9)][_0x2f8071(0xb1)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x4606d0}},{'gateway':{'notIn':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x1c0db2}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2f8071(0x97)]('üîç\x20Found\x20'+_0x3cc20a[_0x2f8071(0x7f)]+_0x2f8071(0x9c));if(_0x3cc20a[_0x2f8071(0x7f)]===0x0)return console['log']('‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x4c8b45 of _0x3cc20a){try{const _0x2b1168=this[_0x2f8071(0xf5)][_0x2f8071(0x118)](_0x4c8b45[_0x2f8071(0xb2)]),_0x351b36=_0x2b1168?_0x2f8071(0xbf):_0x2f8071(0xc1),_0x25bff3=Math[_0x2f8071(0x90)]((Date[_0x2f8071(0x8d)]()-_0x4c8b45[_0x2f8071(0xce)]['getTime']())/(0x3e8*0x3c));console[_0x2f8071(0x97)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x4c8b45['id']),console['log'](_0x2f8071(0x99)+_0x4c8b45[_0x2f8071(0xb2)]+'\x20('+_0x351b36+'\x20timeout)'),console[_0x2f8071(0x97)]('\x20\x20\x20Amount:\x20'+_0x4c8b45[_0x2f8071(0xd4)]+'\x20'+_0x4c8b45['currency']),console[_0x2f8071(0x97)]('\x20\x20\x20Shop:\x20'+_0x4c8b45[_0x2f8071(0xac)][_0x2f8071(0xf4)]+'\x20('+_0x4c8b45[_0x2f8071(0xac)][_0x2f8071(0xf2)]+')'),console['log'](_0x2f8071(0xab)+_0x4c8b45[_0x2f8071(0xce)]['toISOString']()),console[_0x2f8071(0x97)]('\x20\x20\x20Age:\x20'+_0x25bff3+_0x2f8071(0xfb));const _0x1103ee=await database_1['default']['payment'][_0x2f8071(0x10f)]({'where':{'id':_0x4c8b45['id']},'data':{'status':client_1[_0x2f8071(0xb9)][_0x2f8071(0xf8)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x2f8071(0x96)+_0x351b36}});console[_0x2f8071(0x97)](_0x2f8071(0xea)+_0x4c8b45['id']+_0x2f8071(0x9e)),loggerService_1[_0x2f8071(0xf9)][_0x2f8071(0x109)](_0x4c8b45['gateway'],_0x4c8b45['id'],'PENDING',_0x2f8071(0xf8),{'reason':_0x2f8071(0x103),'timeout':_0x351b36,'ageMinutes':_0x25bff3}),_0x52e419++;}catch(_0x589462){const _0x484428=_0x2f8071(0xe0)+_0x4c8b45['id']+':\x20'+(_0x589462 instanceof Error?_0x589462[_0x2f8071(0x104)]:_0x2f8071(0xaf));console[_0x2f8071(0xb6)]('‚ùå\x20'+_0x484428),_0x26bcf4['push'](_0x484428),_0x367540++;}}const _0x3d998b=_0x2f8071(0xe2)+_0x52e419+'\x20payments\x20updated\x20to\x20EXPIRED,\x20'+_0x367540+_0x2f8071(0x113);return console[_0x2f8071(0x97)](_0x2f8071(0xc2)+_0x3d998b),loggerService_1[_0x2f8071(0xf9)][_0x2f8071(0xe5)]('pending_payment_cleanup',_0x2f8071(0xa3),_0x2f8071(0x106),_0x2f8071(0xa1),{'processed':_0x52e419,'failed':_0x367540,'errors':_0x26bcf4,'fastTimeoutMinutes':this[_0x2f8071(0x10d)],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0x52e419,'failed':_0x367540,'errors':_0x26bcf4};}catch(_0x5cc2cd){const _0x1be8cc=_0x2f8071(0xde)+(_0x5cc2cd instanceof Error?_0x5cc2cd[_0x2f8071(0x104)]:_0x2f8071(0xaf));return console['error']('üí•\x20'+_0x1be8cc),_0x26bcf4['push'](_0x1be8cc),loggerService_1[_0x2f8071(0xf9)][_0x2f8071(0xcc)](_0x2f8071(0xef),_0x1be8cc,{'timeoutDays':this[_0x2f8071(0x84)]}),{'processed':_0x52e419,'failed':_0x367540,'errors':_0x26bcf4};}}async[a80_0x7aac7c(0x10c)](){const _0x3056e9=a80_0x7aac7c;try{const _0x28385d=new Date(),_0x35a8e3=new Date(_0x28385d[_0x3056e9(0xfc)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x2d0371=new Date(_0x28385d[_0x3056e9(0xfc)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x52db5b=new Date(_0x28385d[_0x3056e9(0xfc)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x1d3995=await database_1[_0x3056e9(0x98)]['payment']['findMany']({'where':{'status':{'in':[client_1['PaymentStatus'][_0x3056e9(0x111)],client_1[_0x3056e9(0xb9)][_0x3056e9(0xb1)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x21da8e={'total':_0x1d3995[_0x3056e9(0x7f)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x3f97d5 of _0x1d3995){if(_0x3f97d5[_0x3056e9(0xce)]>_0x35a8e3)_0x21da8e['byAge']['fresh']++;else{if(_0x3f97d5[_0x3056e9(0xce)]>_0x2d0371)_0x21da8e['byAge'][_0x3056e9(0xe8)]++;else _0x3f97d5[_0x3056e9(0xce)]>_0x52db5b?_0x21da8e[_0x3056e9(0xbd)][_0x3056e9(0x91)]++:_0x21da8e['byAge'][_0x3056e9(0xe6)]++;}!_0x21da8e[_0x3056e9(0x7e)][_0x3f97d5['gateway']]&&(_0x21da8e[_0x3056e9(0x7e)][_0x3f97d5[_0x3056e9(0xb2)]]=0x0);_0x21da8e[_0x3056e9(0x7e)][_0x3f97d5['gateway']]++;const _0x525ae0=_0x3f97d5[_0x3056e9(0xda)];!_0x21da8e[_0x3056e9(0xd9)][_0x525ae0]&&(_0x21da8e['byStatus'][_0x525ae0]=0x0),_0x21da8e[_0x3056e9(0xd9)][_0x525ae0]++;}return _0x21da8e;}catch(_0xd3d2f){console[_0x3056e9(0xb6)](_0x3056e9(0x8a),_0xd3d2f);throw new Error(_0x3056e9(0x117)+(_0xd3d2f instanceof Error?_0xd3d2f['message']:_0x3056e9(0xaf)));}}async[a80_0x7aac7c(0xd2)](){const _0x45edc3=a80_0x7aac7c;console[_0x45edc3(0x97)](_0x45edc3(0xdb));const _0x3883c4=await this[_0x45edc3(0x10c)]();console[_0x45edc3(0x97)](_0x45edc3(0x10b)),console[_0x45edc3(0x97)](_0x45edc3(0xb5)+_0x3883c4['total']),console[_0x45edc3(0x97)](_0x45edc3(0x9f)+_0x3883c4[_0x45edc3(0xbd)][_0x45edc3(0xf3)]),console['log'](_0x45edc3(0xc6)+_0x3883c4['byAge']['recent']),console[_0x45edc3(0x97)](_0x45edc3(0xa5)+_0x3883c4[_0x45edc3(0xbd)][_0x45edc3(0x91)]),console[_0x45edc3(0x97)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x3883c4[_0x45edc3(0xbd)][_0x45edc3(0xe6)]),console[_0x45edc3(0x97)](_0x45edc3(0x8e),_0x3883c4[_0x45edc3(0x7e)]),console[_0x45edc3(0x97)](_0x45edc3(0xfd),_0x3883c4['byStatus']),console[_0x45edc3(0x97)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x4ad743=await this[_0x45edc3(0x80)]();console[_0x45edc3(0x97)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x700afd=await this['cleanupStalePendingPayments'](),_0xa51507=await this['getProcessingPaymentsStats']();console[_0x45edc3(0x97)](_0x45edc3(0xeb)),console[_0x45edc3(0x97)]('\x20\x20\x20Total:\x20'+_0xa51507[_0x45edc3(0xd3)]),console[_0x45edc3(0x97)](_0x45edc3(0x89)+_0xa51507[_0x45edc3(0xbd)][_0x45edc3(0xe6)]),console[_0x45edc3(0x97)](_0x45edc3(0xfd),_0xa51507[_0x45edc3(0xd9)]);const _0x439920=_0x4ad743[_0x45edc3(0xa0)]+_0x700afd[_0x45edc3(0xa0)],_0x38c1f3=_0x4ad743[_0x45edc3(0xb4)]+_0x700afd[_0x45edc3(0xb4)],_0x525025=[..._0x4ad743['errors'],..._0x700afd[_0x45edc3(0x8b)]];console['log']('\x0aüìà\x20Cleanup\x20Summary:'),console[_0x45edc3(0x97)](_0x45edc3(0xa8)+_0x4ad743[_0x45edc3(0xa0)]),console['log']('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x700afd[_0x45edc3(0xa0)]),console[_0x45edc3(0x97)](_0x45edc3(0xfa)+_0x439920),console['log'](_0x45edc3(0xf6)+_0x38c1f3),console[_0x45edc3(0x97)](_0x45edc3(0x10e)+(_0x3883c4[_0x45edc3(0xd3)]-_0xa51507[_0x45edc3(0xd3)])),_0x525025[_0x45edc3(0x7f)]>0x0&&(console[_0x45edc3(0x97)](_0x45edc3(0xb7)),_0x525025[_0x45edc3(0x8c)]((_0x2446cf,_0x3ac8ed)=>{const _0x12a261=_0x45edc3;console[_0x12a261(0x97)](_0x12a261(0xf1)+(_0x3ac8ed+0x1)+'.\x20'+_0x2446cf);})),console['log'](_0x45edc3(0x7d));}async['runProcessingCleanupOnly'](){const _0x5b2fe5=a80_0x7aac7c;console[_0x5b2fe5(0x97)](_0x5b2fe5(0x114));const _0x3152ee=await this[_0x5b2fe5(0x10c)](),_0x551f87=_0x3152ee[_0x5b2fe5(0xd9)][_0x5b2fe5(0x111)]||0x0;console['log']('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x551f87);const _0x47ad75=await this[_0x5b2fe5(0x80)](),_0x332a3a=await this[_0x5b2fe5(0x10c)](),_0xe7ec11=_0x332a3a[_0x5b2fe5(0xd9)]['PROCESSING']||0x0;console[_0x5b2fe5(0x97)](_0x5b2fe5(0x87)+_0xe7ec11),console[_0x5b2fe5(0x97)](_0x5b2fe5(0x7c)+_0x47ad75[_0x5b2fe5(0xa0)]),console[_0x5b2fe5(0x97)](_0x5b2fe5(0x95));}async[a80_0x7aac7c(0x92)](){const _0x4f988a=a80_0x7aac7c;console['log'](_0x4f988a(0xd5));const _0x18e5dc=await this[_0x4f988a(0x10c)](),_0x2aac6d=_0x18e5dc[_0x4f988a(0xd9)][_0x4f988a(0xb1)]||0x0;console[_0x4f988a(0x97)](_0x4f988a(0xc8)+_0x2aac6d);const _0x54a60c=await this[_0x4f988a(0xec)](),_0x3091b6=await this[_0x4f988a(0x10c)](),_0x2fb21e=_0x3091b6[_0x4f988a(0xd9)][_0x4f988a(0xb1)]||0x0;console['log'](_0x4f988a(0x9a)+_0x2fb21e),console['log']('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x54a60c[_0x4f988a(0xa0)]),console[_0x4f988a(0x97)](_0x4f988a(0xdc));}async[a80_0x7aac7c(0x107)](){const _0x2caa12=a80_0x7aac7c,_0xdf58=[];let _0x59744c=0x0;try{console[_0x2caa12(0x97)](_0x2caa12(0xbe));const _0x2b72e3=new Date(),_0x28e735=[_0x2caa12(0xba),'plisio'],_0x5173b7=[_0x2caa12(0x9d),_0x2caa12(0xca),'visa/mastercard',_0x2caa12(0xa6)],_0x3efa84=await database_1[_0x2caa12(0x98)][_0x2caa12(0x100)][_0x2caa12(0xff)]({'where':{'type':_0x2caa12(0xd1),'status':_0x2caa12(0xaa)},'include':{'payments':{'orderBy':{'createdAt':_0x2caa12(0xcb)},'take':0x1}}});console[_0x2caa12(0x97)](_0x2caa12(0xf7)+_0x3efa84[_0x2caa12(0x7f)]+'\x20active\x20SINGLE\x20links\x20to\x20check');for(const _0x12f591 of _0x3efa84){try{if(_0x12f591[_0x2caa12(0x9b)][_0x2caa12(0x7f)]===0x0)continue;const _0x186f77=_0x12f591[_0x2caa12(0x9b)][0x0];if(_0x186f77[_0x2caa12(0xda)]===_0x2caa12(0xe7))continue;const _0x6189de=_0x2b72e3[_0x2caa12(0xfc)]()-_0x186f77[_0x2caa12(0xce)]['getTime']();let _0x2cf530;_0x28e735['includes'](_0x12f591[_0x2caa12(0xb2)])||_0x5173b7['includes'](_0x12f591[_0x2caa12(0xb2)])?_0x2cf530=0x1e*0x3c*0x3e8:_0x2cf530=0x3*0x18*0x3c*0x3c*0x3e8,_0x6189de>_0x2cf530&&(await database_1[_0x2caa12(0x98)][_0x2caa12(0x100)]['update']({'where':{'id':_0x12f591['id']},'data':{'status':_0x2caa12(0xf8)}}),console[_0x2caa12(0x97)](_0x2caa12(0xb0)+_0x12f591['id']+_0x2caa12(0x86)+_0x12f591['gateway']+_0x2caa12(0xc9)+Math['round'](_0x6189de/0x3e8/0x3c)+_0x2caa12(0xa2)),_0x59744c++);}catch(_0x5445ce){const _0x51294e=_0x2caa12(0x105)+_0x12f591['id']+':\x20'+(_0x5445ce instanceof Error?_0x5445ce[_0x2caa12(0x104)]:_0x2caa12(0xaf));console['error']('‚ùå\x20'+_0x51294e),_0xdf58[_0x2caa12(0xae)](_0x51294e);}}return console[_0x2caa12(0x97)]('üìä\x20Expiration\x20completed:\x20'+_0x59744c+_0x2caa12(0xe9)),{'expired':_0x59744c,'errors':_0xdf58};}catch(_0x5103fd){const _0x13d366=_0x2caa12(0xdd)+(_0x5103fd instanceof Error?_0x5103fd[_0x2caa12(0x104)]:_0x2caa12(0xaf));return console['error'](_0x2caa12(0xdf)+_0x13d366),_0xdf58['push'](_0x13d366),{'expired':_0x59744c,'errors':_0xdf58};}}}function a80_0x4bab(_0xb2228c,_0x4ac4dc){_0xb2228c=_0xb2228c-0x7c;const _0x4ac544=a80_0x4ac5();let _0x4babe0=_0x4ac544[_0xb2228c];return _0x4babe0;}exports[a80_0x7aac7c(0xcd)]=PaymentCleanupService,exports[a80_0x7aac7c(0x116)]=new PaymentCleanupService();