'use strict';function a74_0x3faf(){const _0x253c7a=['üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','findMany','\x0aüìà\x20Cleanup\x20Summary:','username','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','\x20\x20\x20Stale\x20(3-5\x20days):\x20','payment_cleanup','üèÅ\x20Payment\x20cleanup\x20service\x20completed','414YHbgzj','Unknown\x20error','PROCESSING_TIMEOUT_DAYS','payment','expired','PaymentCleanupService','squirrel-pay','update','name','901029KvBVfj','expireSinglePaymentLinks','log','loggerService','üîç\x20Found\x20','PAID','SINGLE','toISOString','error','byStatus','üìã\x20Fast\x20timeout\x20gateways:\x20','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','Failed\x20to\x20get\x20processing\x20payments\x20stats:','runPendingCleanupOnly','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','üìä\x20Expiration\x20completed:\x20','setDate','108416IUGBNw','stale','length','\x20failed\x20to\x20update','mastercard','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','3\x20days','paymentLink','auto_timeout','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','POST','üí•\x20','__importDefault','recent','total','shop','üèÅ\x20PENDING\x20cleanup\x20completed','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','defineProperty','\x20\x20\x20Age:\x20','\x20stale\x20PROCESSING\x20payments','byAge','\x20stale\x20PENDING\x20payments','getProcessingPaymentsStats','\x20from\x20PENDING\x20to\x20EXPIRED','3140552ynYvDV','__esModule','PaymentStatus','FAST_TIMEOUT_MINUTES','\x20\x20\x20Recent\x20(1-3\x20days):\x20','logWebhookProcessed','getTime','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','processed','default','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','\x20\x20\x20Shop:\x20','plisio','errors','Failed\x20to\x20expire\x20link\x20','status','PENDING\x20cleanup\x20completed:\x20','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','19790jGPpIH','\x20\x20\x20Created:\x20','pending_payment_cleanup','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','squirrelpay','amount','logApiCall','üèÅ\x20PROCESSING\x20cleanup\x20completed','\x20\x20\x20Total:\x20','30\x20minutes','cleanupStalePendingPayments','FAILED','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','rapyd','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','join','payments','\x20\x20\x20Amount:\x20','system','\x20\x20\x20By\x20status:','3310832HYWwnY','admin','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','SLOW_TIMEOUT_DAYS','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','‚úÖ\x20Updated\x20payment\x20','10XBCKqf','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','oxapay','now','floor','gateway','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','paymentCleanupService','PENDING','\x20from\x20PROCESSING\x20to\x20FAILED','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','PROCESSING','Failed\x20to\x20update\x20payment\x20','@prisma/client','cleanupStaleProcessingPayments','4gnXZaB','‚è∞\x20Expired\x20link\x20','message','failed','\x20(gateway:\x20','visa/mastercard','runCleanupWithReport','auto_timeout_pending','1576296NnUZsB','createdAt','Failed\x20to\x20update\x20PENDING\x20payment\x20','\x20\x20\x20By\x20gateway:','17853687alWDdf','byGateway','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','currency','includes','EXPIRED','fresh','./loggerService','Cleanup\x20service\x20error:\x20','push','getDate','\x20\x20\x20Gateway:\x20','Link\x20expiration\x20service\x20error:\x20','runProcessingCleanupOnly','üìä\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','FAST_TIMEOUT_GATEWAYS','\x20payments\x20updated\x20to\x20FAILED,\x20','\x20minutes)'];a74_0x3faf=function(){return _0x253c7a;};return a74_0x3faf();}const a74_0x9883f0=a74_0xa003;(function(_0x1b734a,_0x3567b0){const _0xde6bf3=a74_0xa003,_0x4cbe50=_0x1b734a();while(!![]){try{const _0x30fc9f=parseInt(_0xde6bf3(0xfb))/0x1+-parseInt(_0xde6bf3(0xb9))/0x2*(-parseInt(_0xde6bf3(0xea))/0x3)+parseInt(_0xde6bf3(0x114))/0x4+parseInt(_0xde6bf3(0x89))/0x5*(parseInt(_0xde6bf3(0xe1))/0x6)+parseInt(_0xde6bf3(0xa0))/0x7+parseInt(_0xde6bf3(0xc1))/0x8+-parseInt(_0xde6bf3(0xc5))/0x9*(parseInt(_0xde6bf3(0xa7))/0xa);if(_0x30fc9f===_0x3567b0)break;else _0x4cbe50['push'](_0x4cbe50['shift']());}catch(_0x440da2){_0x4cbe50['push'](_0x4cbe50['shift']());}}}(a74_0x3faf,0x6ebec));var __importDefault=this&&this[a74_0x9883f0(0x107)]||function(_0xeed25d){const _0x584012=a74_0x9883f0;return _0xeed25d&&_0xeed25d[_0x584012(0x78)]?_0xeed25d:{'default':_0xeed25d};};function a74_0xa003(_0xbccc7b,_0x2cb0e2){_0xbccc7b=_0xbccc7b-0x78;const _0x3faf84=a74_0x3faf();let _0xa0038b=_0x3faf84[_0xbccc7b];return _0xa0038b;}Object[a74_0x9883f0(0x10d)](exports,a74_0x9883f0(0x78),{'value':!![]}),exports[a74_0x9883f0(0xae)]=exports[a74_0x9883f0(0xe6)]=void 0x0;const database_1=__importDefault(require('../config/database')),client_1=require(a74_0x9883f0(0xb7)),loggerService_1=require(a74_0x9883f0(0xcd));class PaymentCleanupService{constructor(){const _0x5e06ac=a74_0x9883f0;this[_0x5e06ac(0xe3)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x5e06ac(0x7a)]=0x1e,this[_0x5e06ac(0xa4)]=0x3,this['FAST_TIMEOUT_GATEWAYS']=['squirrelpay',_0x5e06ac(0xe7),'rapyd','visa/mastercard',_0x5e06ac(0x83),_0x5e06ac(0xa9)];}async['cleanupStaleProcessingPayments'](){const _0x371dcb=a74_0x9883f0,_0x3e914e=[];let _0x4b8323=0x0,_0x3481d9=0x0;try{console[_0x371dcb(0xec)](_0x371dcb(0xb4));const _0x43cbf9=new Date();_0x43cbf9[_0x371dcb(0xfa)](_0x43cbf9['getDate']()-this[_0x371dcb(0xe3)]),console[_0x371dcb(0xec)](_0x371dcb(0x9a)+_0x43cbf9[_0x371dcb(0xf1)]());const _0x5a9015=await database_1['default'][_0x371dcb(0xe4)][_0x371dcb(0xda)]({'where':{'status':client_1['PaymentStatus']['PROCESSING'],'createdAt':{'lt':_0x43cbf9}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x371dcb(0xec)](_0x371dcb(0xee)+_0x5a9015['length']+_0x371dcb(0x10f));if(_0x5a9015['length']===0x0)return console[_0x371dcb(0xec)](_0x371dcb(0xf5)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x36fd48 of _0x5a9015){try{console[_0x371dcb(0xec)](_0x371dcb(0xa5)+_0x36fd48['id']+'\x20('+_0x36fd48[_0x371dcb(0xac)]+',\x20'+_0x36fd48['amount']+'\x20'+_0x36fd48[_0x371dcb(0xc9)]+')'),console[_0x371dcb(0xec)](_0x371dcb(0x82)+_0x36fd48[_0x371dcb(0x10a)]['name']+'\x20('+_0x36fd48[_0x371dcb(0x10a)][_0x371dcb(0xdc)]+')'),console['log'](_0x371dcb(0x8a)+_0x36fd48[_0x371dcb(0xc2)][_0x371dcb(0xf1)]()),console[_0x371dcb(0xec)](_0x371dcb(0x10e)+Math[_0x371dcb(0xab)]((Date[_0x371dcb(0xaa)]()-_0x36fd48[_0x371dcb(0xc2)][_0x371dcb(0x7d)]())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x24328b=await database_1[_0x371dcb(0x80)][_0x371dcb(0xe4)]['update']({'where':{'id':_0x36fd48['id']},'data':{'status':client_1['PaymentStatus']['FAILED'],'statusChangedBy':_0x371dcb(0x9e),'statusChangedAt':new Date(),'failureMessage':_0x371dcb(0x100)+this[_0x371dcb(0xe3)]+'\x20days'}});console['log'](_0x371dcb(0xa6)+_0x36fd48['id']+_0x371dcb(0xb0)),loggerService_1[_0x371dcb(0xed)][_0x371dcb(0x7c)](_0x36fd48[_0x371dcb(0xac)],_0x36fd48['id'],_0x371dcb(0xb5),_0x371dcb(0x96),{'reason':_0x371dcb(0x103),'timeoutDays':this[_0x371dcb(0xe3)]}),_0x4b8323++;}catch(_0x4241e0){const _0x2ddd8c=_0x371dcb(0xb6)+_0x36fd48['id']+':\x20'+(_0x4241e0 instanceof Error?_0x4241e0[_0x371dcb(0xbb)]:_0x371dcb(0xe2));console[_0x371dcb(0xf2)]('‚ùå\x20'+_0x2ddd8c),_0x3e914e[_0x371dcb(0xcf)](_0x2ddd8c),_0x3481d9++;}}const _0x565f4c='Cleanup\x20completed:\x20'+_0x4b8323+_0x371dcb(0xd7)+_0x3481d9+_0x371dcb(0xfe);return console[_0x371dcb(0xec)](_0x371dcb(0xd4)+_0x565f4c),loggerService_1[_0x371dcb(0xed)][_0x371dcb(0x91)]('payment_cleanup',_0x371dcb(0x105),_0x371dcb(0x9e),_0x371dcb(0xa1),{'processed':_0x4b8323,'failed':_0x3481d9,'errors':_0x3e914e,'timeoutDays':this[_0x371dcb(0xe3)]}),{'processed':_0x4b8323,'failed':_0x3481d9,'errors':_0x3e914e};}catch(_0x5c5e91){const _0x1c4d2f=_0x371dcb(0xce)+(_0x5c5e91 instanceof Error?_0x5c5e91[_0x371dcb(0xbb)]:_0x371dcb(0xe2));return console[_0x371dcb(0xf2)](_0x371dcb(0x106)+_0x1c4d2f),_0x3e914e[_0x371dcb(0xcf)](_0x1c4d2f),loggerService_1[_0x371dcb(0xed)]['logWebhookError'](_0x371dcb(0xdf),_0x1c4d2f,{'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x4b8323,'failed':_0x3481d9,'errors':_0x3e914e};}}async[a74_0x9883f0(0x95)](){const _0x148932=a74_0x9883f0,_0x1ccfdd=[];let _0x16d387=0x0,_0x224a79=0x0;try{console[_0x148932(0xec)](_0x148932(0xb1));const _0x516c75=new Date(),_0x39b737=new Date(_0x516c75['getTime']()-this[_0x148932(0x7a)]*0x3c*0x3e8),_0x4b527d=new Date();_0x4b527d[_0x148932(0xfa)](_0x4b527d[_0x148932(0xd0)]()-this[_0x148932(0xa4)]),console[_0x148932(0xec)]('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x39b737[_0x148932(0xf1)]()),console[_0x148932(0xec)]('üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20'+_0x4b527d[_0x148932(0xf1)]()),console[_0x148932(0xec)](_0x148932(0xf4)+this[_0x148932(0xd6)][_0x148932(0x9b)](',\x20'));const _0x40e69e=await database_1[_0x148932(0x80)][_0x148932(0xe4)][_0x148932(0xda)]({'where':{'status':client_1[_0x148932(0x79)][_0x148932(0xaf)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x39b737}},{'gateway':{'notIn':this[_0x148932(0xd6)]},'createdAt':{'lt':_0x4b527d}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log'](_0x148932(0xee)+_0x40e69e[_0x148932(0xfd)]+_0x148932(0x111));if(_0x40e69e[_0x148932(0xfd)]===0x0)return console['log'](_0x148932(0x7e)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x1dfd17 of _0x40e69e){try{const _0x1e1c59=this[_0x148932(0xd6)][_0x148932(0xca)](_0x1dfd17[_0x148932(0xac)]),_0x4816f5=_0x1e1c59?_0x148932(0x94):_0x148932(0x101),_0x2c0599=Math[_0x148932(0xab)]((Date[_0x148932(0xaa)]()-_0x1dfd17[_0x148932(0xc2)][_0x148932(0x7d)]())/(0x3e8*0x3c));console[_0x148932(0xec)](_0x148932(0xc8)+_0x1dfd17['id']),console['log'](_0x148932(0xd1)+_0x1dfd17['gateway']+'\x20('+_0x4816f5+'\x20timeout)'),console['log'](_0x148932(0x9d)+_0x1dfd17[_0x148932(0x90)]+'\x20'+_0x1dfd17[_0x148932(0xc9)]),console['log']('\x20\x20\x20Shop:\x20'+_0x1dfd17[_0x148932(0x10a)][_0x148932(0xe9)]+'\x20('+_0x1dfd17[_0x148932(0x10a)][_0x148932(0xdc)]+')'),console[_0x148932(0xec)](_0x148932(0x8a)+_0x1dfd17[_0x148932(0xc2)]['toISOString']()),console[_0x148932(0xec)](_0x148932(0x10e)+_0x2c0599+'\x20minutes');const _0x3ded2c=await database_1[_0x148932(0x80)][_0x148932(0xe4)]['update']({'where':{'id':_0x1dfd17['id']},'data':{'status':client_1[_0x148932(0x79)][_0x148932(0xcb)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x148932(0xa2)+_0x4816f5}});console[_0x148932(0xec)]('‚úÖ\x20Updated\x20payment\x20'+_0x1dfd17['id']+_0x148932(0x113)),loggerService_1['loggerService'][_0x148932(0x7c)](_0x1dfd17['gateway'],_0x1dfd17['id'],'PENDING',_0x148932(0xcb),{'reason':_0x148932(0xc0),'timeout':_0x4816f5,'ageMinutes':_0x2c0599}),_0x16d387++;}catch(_0x371b47){const _0x54e79b=_0x148932(0xc3)+_0x1dfd17['id']+':\x20'+(_0x371b47 instanceof Error?_0x371b47[_0x148932(0xbb)]:'Unknown\x20error');console['error']('‚ùå\x20'+_0x54e79b),_0x1ccfdd[_0x148932(0xcf)](_0x54e79b),_0x224a79++;}}const _0x30668f=_0x148932(0x87)+_0x16d387+'\x20payments\x20updated\x20to\x20EXPIRED,\x20'+_0x224a79+'\x20failed\x20to\x20update';return console[_0x148932(0xec)](_0x148932(0xd4)+_0x30668f),loggerService_1['loggerService']['logApiCall'](_0x148932(0x8b),'POST',_0x148932(0x9e),_0x148932(0xa1),{'processed':_0x16d387,'failed':_0x224a79,'errors':_0x1ccfdd,'fastTimeoutMinutes':this['FAST_TIMEOUT_MINUTES'],'slowTimeoutDays':this[_0x148932(0xa4)]}),{'processed':_0x16d387,'failed':_0x224a79,'errors':_0x1ccfdd};}catch(_0x3eaef3){const _0x5350ef='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x3eaef3 instanceof Error?_0x3eaef3[_0x148932(0xbb)]:'Unknown\x20error');return console[_0x148932(0xf2)](_0x148932(0x106)+_0x5350ef),_0x1ccfdd[_0x148932(0xcf)](_0x5350ef),loggerService_1[_0x148932(0xed)]['logWebhookError'](_0x148932(0x8b),_0x5350ef,{'timeoutDays':this['PENDING_TIMEOUT_DAYS']}),{'processed':_0x16d387,'failed':_0x224a79,'errors':_0x1ccfdd};}}async[a74_0x9883f0(0x112)](){const _0x29f362=a74_0x9883f0;try{const _0x420d88=new Date(),_0x2c86bf=new Date(_0x420d88[_0x29f362(0x7d)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x2de58b=new Date(_0x420d88['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x2ada1d=new Date(_0x420d88['getTime']()-0x5*0x18*0x3c*0x3c*0x3e8),_0xa501b8=await database_1[_0x29f362(0x80)]['payment'][_0x29f362(0xda)]({'where':{'status':{'in':[client_1[_0x29f362(0x79)]['PROCESSING'],client_1[_0x29f362(0x79)][_0x29f362(0xaf)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x18a18f={'total':_0xa501b8[_0x29f362(0xfd)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0xbbd066 of _0xa501b8){if(_0xbbd066['createdAt']>_0x2c86bf)_0x18a18f[_0x29f362(0x110)][_0x29f362(0xcc)]++;else{if(_0xbbd066[_0x29f362(0xc2)]>_0x2de58b)_0x18a18f[_0x29f362(0x110)][_0x29f362(0x108)]++;else _0xbbd066[_0x29f362(0xc2)]>_0x2ada1d?_0x18a18f[_0x29f362(0x110)]['stale']++:_0x18a18f['byAge'][_0x29f362(0xe5)]++;}!_0x18a18f['byGateway'][_0xbbd066['gateway']]&&(_0x18a18f[_0x29f362(0xc6)][_0xbbd066[_0x29f362(0xac)]]=0x0);_0x18a18f[_0x29f362(0xc6)][_0xbbd066[_0x29f362(0xac)]]++;const _0x2cde4c=_0xbbd066[_0x29f362(0x86)];!_0x18a18f[_0x29f362(0xf3)][_0x2cde4c]&&(_0x18a18f[_0x29f362(0xf3)][_0x2cde4c]=0x0),_0x18a18f[_0x29f362(0xf3)][_0x2cde4c]++;}return _0x18a18f;}catch(_0x437b16){console[_0x29f362(0xf2)](_0x29f362(0xf6),_0x437b16);throw new Error(_0x29f362(0xb2)+(_0x437b16 instanceof Error?_0x437b16[_0x29f362(0xbb)]:_0x29f362(0xe2)));}}async[a74_0x9883f0(0xbf)](){const _0x2cb765=a74_0x9883f0;console['log'](_0x2cb765(0xf8));const _0x3f9c69=await this['getProcessingPaymentsStats']();console[_0x2cb765(0xec)](_0x2cb765(0x8e)),console[_0x2cb765(0xec)](_0x2cb765(0x93)+_0x3f9c69[_0x2cb765(0x109)]),console[_0x2cb765(0xec)](_0x2cb765(0xd5)+_0x3f9c69[_0x2cb765(0x110)][_0x2cb765(0xcc)]),console[_0x2cb765(0xec)](_0x2cb765(0x7b)+_0x3f9c69[_0x2cb765(0x110)][_0x2cb765(0x108)]),console['log'](_0x2cb765(0xde)+_0x3f9c69[_0x2cb765(0x110)][_0x2cb765(0xfc)]),console[_0x2cb765(0xec)](_0x2cb765(0x98)+_0x3f9c69['byAge'][_0x2cb765(0xe5)]),console[_0x2cb765(0xec)](_0x2cb765(0xc4),_0x3f9c69[_0x2cb765(0xc6)]),console[_0x2cb765(0xec)](_0x2cb765(0x9f),_0x3f9c69[_0x2cb765(0xf3)]),console[_0x2cb765(0xec)](_0x2cb765(0xb3));const _0x35bb2c=await this[_0x2cb765(0xb8)]();console[_0x2cb765(0xec)](_0x2cb765(0x97));const _0x4fcc4e=await this[_0x2cb765(0x95)](),_0x5826c2=await this[_0x2cb765(0x112)]();console[_0x2cb765(0xec)](_0x2cb765(0x81)),console[_0x2cb765(0xec)](_0x2cb765(0x93)+_0x5826c2[_0x2cb765(0x109)]),console[_0x2cb765(0xec)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x5826c2[_0x2cb765(0x110)][_0x2cb765(0xe5)]),console[_0x2cb765(0xec)](_0x2cb765(0x9f),_0x5826c2[_0x2cb765(0xf3)]);const _0x2f6d56=_0x35bb2c[_0x2cb765(0x7f)]+_0x4fcc4e['processed'],_0x1bc9cc=_0x35bb2c['failed']+_0x4fcc4e[_0x2cb765(0xbc)],_0x11a91d=[..._0x35bb2c[_0x2cb765(0x84)],..._0x4fcc4e[_0x2cb765(0x84)]];console[_0x2cb765(0xec)](_0x2cb765(0xdb)),console[_0x2cb765(0xec)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x35bb2c[_0x2cb765(0x7f)]),console[_0x2cb765(0xec)](_0x2cb765(0x104)+_0x4fcc4e['processed']),console[_0x2cb765(0xec)](_0x2cb765(0xad)+_0x2f6d56),console[_0x2cb765(0xec)](_0x2cb765(0xa3)+_0x1bc9cc),console[_0x2cb765(0xec)](_0x2cb765(0xdd)+(_0x3f9c69[_0x2cb765(0x109)]-_0x5826c2[_0x2cb765(0x109)])),_0x11a91d[_0x2cb765(0xfd)]>0x0&&(console[_0x2cb765(0xec)](_0x2cb765(0x8c)),_0x11a91d['forEach']((_0x2307b7,_0xbb12d8)=>{const _0x3924b9=_0x2cb765;console[_0x3924b9(0xec)]('\x20\x20\x20\x20\x20\x20'+(_0xbb12d8+0x1)+'.\x20'+_0x2307b7);})),console[_0x2cb765(0xec)](_0x2cb765(0xe0));}async[a74_0x9883f0(0xd3)](){const _0x4a81e0=a74_0x9883f0;console[_0x4a81e0(0xec)](_0x4a81e0(0x10c));const _0x2e4c61=await this['getProcessingPaymentsStats'](),_0x64eaed=_0x2e4c61[_0x4a81e0(0xf3)][_0x4a81e0(0xb5)]||0x0;console[_0x4a81e0(0xec)](_0x4a81e0(0x88)+_0x64eaed);const _0xbe638a=await this[_0x4a81e0(0xb8)](),_0x32c312=await this[_0x4a81e0(0x112)](),_0x42caba=_0x32c312[_0x4a81e0(0xf3)][_0x4a81e0(0xb5)]||0x0;console[_0x4a81e0(0xec)](_0x4a81e0(0xd9)+_0x42caba),console[_0x4a81e0(0xec)](_0x4a81e0(0x8d)+_0xbe638a['processed']),console['log'](_0x4a81e0(0x92));}async[a74_0x9883f0(0xf7)](){const _0x5ba9ba=a74_0x9883f0;console[_0x5ba9ba(0xec)]('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x3305a6=await this[_0x5ba9ba(0x112)](),_0xa27984=_0x3305a6['byStatus'][_0x5ba9ba(0xaf)]||0x0;console[_0x5ba9ba(0xec)](_0x5ba9ba(0xc7)+_0xa27984);const _0x549c52=await this[_0x5ba9ba(0x95)](),_0x36e8d1=await this[_0x5ba9ba(0x112)](),_0x4659c2=_0x36e8d1[_0x5ba9ba(0xf3)][_0x5ba9ba(0xaf)]||0x0;console['log'](_0x5ba9ba(0xa8)+_0x4659c2),console[_0x5ba9ba(0xec)]('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x549c52[_0x5ba9ba(0x7f)]),console[_0x5ba9ba(0xec)](_0x5ba9ba(0x10b));}async[a74_0x9883f0(0xeb)](){const _0x441a02=a74_0x9883f0,_0x34d68d=[];let _0x3de6df=0x0;try{console['log']('‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x1008db=new Date(),_0x78a1fe=[_0x441a02(0xa9),_0x441a02(0x83)],_0x5784b3=[_0x441a02(0x8f),_0x441a02(0x99),_0x441a02(0xbe),_0x441a02(0xff)],_0x15e7d6=await database_1['default'][_0x441a02(0x102)][_0x441a02(0xda)]({'where':{'type':_0x441a02(0xf0),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x441a02(0xec)](_0x441a02(0xee)+_0x15e7d6[_0x441a02(0xfd)]+'\x20active\x20SINGLE\x20links\x20to\x20check');for(const _0x4a4e2e of _0x15e7d6){try{if(_0x4a4e2e[_0x441a02(0x9c)][_0x441a02(0xfd)]===0x0)continue;const _0x54faa4=_0x4a4e2e[_0x441a02(0x9c)][0x0];if(_0x54faa4['status']===_0x441a02(0xef))continue;const _0x42b567=_0x1008db[_0x441a02(0x7d)]()-_0x54faa4['createdAt'][_0x441a02(0x7d)]();let _0x545bf0;_0x78a1fe[_0x441a02(0xca)](_0x4a4e2e[_0x441a02(0xac)])||_0x5784b3[_0x441a02(0xca)](_0x4a4e2e[_0x441a02(0xac)])?_0x545bf0=0x1e*0x3c*0x3e8:_0x545bf0=0x3*0x18*0x3c*0x3c*0x3e8,_0x42b567>_0x545bf0&&(await database_1[_0x441a02(0x80)][_0x441a02(0x102)][_0x441a02(0xe8)]({'where':{'id':_0x4a4e2e['id']},'data':{'status':'EXPIRED'}}),console[_0x441a02(0xec)](_0x441a02(0xba)+_0x4a4e2e['id']+_0x441a02(0xbd)+_0x4a4e2e[_0x441a02(0xac)]+',\x20payment\x20age:\x20'+Math['round'](_0x42b567/0x3e8/0x3c)+_0x441a02(0xd8)),_0x3de6df++);}catch(_0x30046f){const _0x2c8d9b=_0x441a02(0x85)+_0x4a4e2e['id']+':\x20'+(_0x30046f instanceof Error?_0x30046f[_0x441a02(0xbb)]:_0x441a02(0xe2));console[_0x441a02(0xf2)]('‚ùå\x20'+_0x2c8d9b),_0x34d68d['push'](_0x2c8d9b);}}return console['log'](_0x441a02(0xf9)+_0x3de6df+'\x20links\x20expired'),{'expired':_0x3de6df,'errors':_0x34d68d};}catch(_0x310602){const _0x1f782d=_0x441a02(0xd2)+(_0x310602 instanceof Error?_0x310602[_0x441a02(0xbb)]:_0x441a02(0xe2));return console[_0x441a02(0xf2)](_0x441a02(0x106)+_0x1f782d),_0x34d68d['push'](_0x1f782d),{'expired':_0x3de6df,'errors':_0x34d68d};}}}exports[a74_0x9883f0(0xe6)]=PaymentCleanupService,exports[a74_0x9883f0(0xae)]=new PaymentCleanupService();