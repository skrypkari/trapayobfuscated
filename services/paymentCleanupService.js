'use strict';const a80_0x43114f=a80_0x2bad;(function(_0x4a25ad,_0x306d67){const _0xb5d12b=a80_0x2bad,_0x439126=_0x4a25ad();while(!![]){try{const _0x1bbb4b=-parseInt(_0xb5d12b(0x105))/0x1*(-parseInt(_0xb5d12b(0xd9))/0x2)+-parseInt(_0xb5d12b(0xe6))/0x3+parseInt(_0xb5d12b(0xbe))/0x4*(parseInt(_0xb5d12b(0x137))/0x5)+parseInt(_0xb5d12b(0xed))/0x6*(parseInt(_0xb5d12b(0x145))/0x7)+parseInt(_0xb5d12b(0x142))/0x8*(parseInt(_0xb5d12b(0x101))/0x9)+-parseInt(_0xb5d12b(0xeb))/0xa*(-parseInt(_0xb5d12b(0x120))/0xb)+parseInt(_0xb5d12b(0xf3))/0xc*(-parseInt(_0xb5d12b(0xc5))/0xd);if(_0x1bbb4b===_0x306d67)break;else _0x439126['push'](_0x439126['shift']());}catch(_0x274963){_0x439126['push'](_0x439126['shift']());}}}(a80_0x34bb,0xf27d5));function a80_0x34bb(){const _0xefc270=['39469608ntbiZx','\x20stale\x20PENDING\x20payments','paymentLink','‚úÖ\x20PENDING\x20payments\x20processed:\x20','\x20\x20\x20Recent\x20(1-3\x20days):\x20','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','Unknown\x20error','\x20(gateway:\x20','fresh','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','loggerService','üìä\x20','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','15584301lkuVch','shop','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','recent','995msexxp','runPendingCleanupOnly','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','Link\x20expiration\x20service\x20error:\x20','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','üèÅ\x20PROCESSING\x20cleanup\x20completed','logWebhookError','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','expireSinglePaymentLinks','üìä\x20Expiration\x20completed:\x20','\x20\x20\x20Age:\x20','expired','errors','__esModule','now','default','Failed\x20to\x20get\x20processing\x20payments\x20stats:','includes','status','\x20\x20\x20Shop:\x20','PENDING_TIMEOUT_DAYS','\x20\x20\x20By\x20gateway:','\x20from\x20PROCESSING\x20to\x20FAILED','üìã\x20Fast\x20timeout\x20gateways:\x20','plisio','rapyd','20654579omzKQf','PaymentCleanupService','3\x20days','\x20days','squirrelpay','log','Failed\x20to\x20expire\x20link\x20','\x20payments\x20updated\x20to\x20FAILED,\x20','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','ACTIVE','\x20\x20\x20By\x20status:','length','\x20payments\x20updated\x20to\x20EXPIRED,\x20','PENDING\x20cleanup\x20completed:\x20','POST','‚úÖ\x20Updated\x20payment\x20','push','paymentCleanupService','getTime','currency','cleanupStalePendingPayments','üèÅ\x20PENDING\x20cleanup\x20completed','EXPIRED','5YajKAR','PROCESSING','floor','üèÅ\x20Payment\x20cleanup\x20service\x20completed','mastercard','PaymentStatus','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','message','byAge','FAST_TIMEOUT_MINUTES','getProcessingPaymentsStats','8YBswYb','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','\x20\x20\x20\x20\x20\x20','371UYAGKH','byGateway','\x20timeout)','logApiCall','payment','oxapay','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','toISOString','system','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','FAST_TIMEOUT_GATEWAYS','‚è∞\x20Expired\x20link\x20','gateway','createdAt','username','30\x20minutes','auto_timeout_pending','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','\x20failed\x20to\x20update','failed','getDate','pending_payment_cleanup','\x20minutes','runProcessingCleanupOnly','699236PJpzzT','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','payment_cleanup','Failed\x20to\x20update\x20PENDING\x20payment\x20','amount','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','\x20active\x20SINGLE\x20links\x20to\x20check','13mnoafI','processed','squirrel-pay','payments','@prisma/client','__importDefault','SLOW_TIMEOUT_DAYS','\x20\x20\x20Stale\x20(3-5\x20days):\x20','logWebhookProcessed','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','PENDING\x20cleanup\x20service\x20error:\x20','desc','error','PAID','Failed\x20to\x20update\x20payment\x20','admin','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','PROCESSING_TIMEOUT_DAYS','\x20\x20\x20Total:\x20','total','1478gLHlKB','setDate','\x20minutes)','auto_timeout','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','join','findMany','update','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','üîç\x20Found\x20','PENDING','üí•\x20','2571522owSsOo','\x20\x20\x20Gateway:\x20','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','visa/mastercard','10KdDoVA','\x20\x20\x20Amount:\x20','70206JSWuvA','stale','./loggerService','SINGLE','name','byStatus'];a80_0x34bb=function(){return _0xefc270;};return a80_0x34bb();}function a80_0x2bad(_0x260829,_0x39a57a){_0x260829=_0x260829-0xb5;const _0x34bb6a=a80_0x34bb();let _0x2badd3=_0x34bb6a[_0x260829];return _0x2badd3;}var __importDefault=this&&this[a80_0x43114f(0xca)]||function(_0x16af1e){const _0x45db23=a80_0x43114f;return _0x16af1e&&_0x16af1e[_0x45db23(0x113)]?_0x16af1e:{'default':_0x16af1e};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a80_0x43114f(0x131)]=exports[a80_0x43114f(0x121)]=void 0x0;const database_1=__importDefault(require('../config/database')),client_1=require(a80_0x43114f(0xc9)),loggerService_1=require(a80_0x43114f(0xef));class PaymentCleanupService{constructor(){const _0x284ac2=a80_0x43114f;this[_0x284ac2(0xd6)]=0x5,this[_0x284ac2(0x11a)]=0x5,this[_0x284ac2(0x140)]=0x1e,this[_0x284ac2(0xcb)]=0x3,this['FAST_TIMEOUT_GATEWAYS']=['squirrelpay',_0x284ac2(0xc7),_0x284ac2(0x11f),_0x284ac2(0xea),_0x284ac2(0x11e),'oxapay'];}async['cleanupStaleProcessingPayments'](){const _0x3c67b7=a80_0x43114f,_0x3620f1=[];let _0x3ad5f7=0x0,_0x2487ba=0x0;try{console[_0x3c67b7(0x125)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x41accc=new Date();_0x41accc[_0x3c67b7(0xda)](_0x41accc[_0x3c67b7(0xba)]()-this['PROCESSING_TIMEOUT_DAYS']),console['log'](_0x3c67b7(0x107)+_0x41accc[_0x3c67b7(0x14c)]());const _0x59f581=await database_1[_0x3c67b7(0x115)][_0x3c67b7(0x149)]['findMany']({'where':{'status':client_1[_0x3c67b7(0x13c)][_0x3c67b7(0x138)],'createdAt':{'lt':_0x41accc}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x3c67b7(0x125)](_0x3c67b7(0xe3)+_0x59f581['length']+'\x20stale\x20PROCESSING\x20payments');if(_0x59f581[_0x3c67b7(0x12b)]===0x0)return console[_0x3c67b7(0x125)](_0x3c67b7(0x13d)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x587ae5 of _0x59f581){try{console[_0x3c67b7(0x125)](_0x3c67b7(0x14e)+_0x587ae5['id']+'\x20('+_0x587ae5[_0x3c67b7(0x151)]+',\x20'+_0x587ae5['amount']+'\x20'+_0x587ae5[_0x3c67b7(0x133)]+')'),console[_0x3c67b7(0x125)](_0x3c67b7(0x119)+_0x587ae5[_0x3c67b7(0x102)][_0x3c67b7(0xf1)]+'\x20('+_0x587ae5[_0x3c67b7(0x102)][_0x3c67b7(0x153)]+')'),console['log']('\x20\x20\x20Created:\x20'+_0x587ae5['createdAt'][_0x3c67b7(0x14c)]()),console['log'](_0x3c67b7(0x110)+Math['floor']((Date['now']()-_0x587ae5['createdAt'][_0x3c67b7(0x132)]())/(0x3e8*0x3c*0x3c*0x18))+_0x3c67b7(0x123));const _0x754108=await database_1[_0x3c67b7(0x115)]['payment'][_0x3c67b7(0xe1)]({'where':{'id':_0x587ae5['id']},'data':{'status':client_1['PaymentStatus']['FAILED'],'statusChangedBy':_0x3c67b7(0x14d),'statusChangedAt':new Date(),'failureMessage':_0x3c67b7(0xde)+this[_0x3c67b7(0xd6)]+'\x20days'}});console[_0x3c67b7(0x125)]('‚úÖ\x20Updated\x20payment\x20'+_0x587ae5['id']+_0x3c67b7(0x11c)),loggerService_1[_0x3c67b7(0xfd)][_0x3c67b7(0xcd)](_0x587ae5[_0x3c67b7(0x151)],_0x587ae5['id'],_0x3c67b7(0x138),'FAILED',{'reason':_0x3c67b7(0xdc),'timeoutDays':this[_0x3c67b7(0xd6)]}),_0x3ad5f7++;}catch(_0x5658de){const _0xe1af69=_0x3c67b7(0xd3)+_0x587ae5['id']+':\x20'+(_0x5658de instanceof Error?_0x5658de[_0x3c67b7(0x13e)]:_0x3c67b7(0xf9));console['error']('‚ùå\x20'+_0xe1af69),_0x3620f1[_0x3c67b7(0x130)](_0xe1af69),_0x2487ba++;}}const _0x486efc='Cleanup\x20completed:\x20'+_0x3ad5f7+_0x3c67b7(0x127)+_0x2487ba+_0x3c67b7(0xb8);return console[_0x3c67b7(0x125)](_0x3c67b7(0xfe)+_0x486efc),loggerService_1['loggerService'][_0x3c67b7(0x148)](_0x3c67b7(0xc0),_0x3c67b7(0x12e),_0x3c67b7(0x14d),_0x3c67b7(0xd4),{'processed':_0x3ad5f7,'failed':_0x2487ba,'errors':_0x3620f1,'timeoutDays':this[_0x3c67b7(0xd6)]}),{'processed':_0x3ad5f7,'failed':_0x2487ba,'errors':_0x3620f1};}catch(_0x2ca396){const _0x44e67d='Cleanup\x20service\x20error:\x20'+(_0x2ca396 instanceof Error?_0x2ca396[_0x3c67b7(0x13e)]:_0x3c67b7(0xf9));return console[_0x3c67b7(0xd1)]('üí•\x20'+_0x44e67d),_0x3620f1[_0x3c67b7(0x130)](_0x44e67d),loggerService_1[_0x3c67b7(0xfd)][_0x3c67b7(0x10b)](_0x3c67b7(0xc0),_0x44e67d,{'timeoutDays':this[_0x3c67b7(0xd6)]}),{'processed':_0x3ad5f7,'failed':_0x2487ba,'errors':_0x3620f1};}}async[a80_0x43114f(0x134)](){const _0x2f11cf=a80_0x43114f,_0x55e100=[];let _0x1135b0=0x0,_0x3ac0a7=0x0;try{console[_0x2f11cf(0x125)](_0x2f11cf(0x10c));const _0x542a91=new Date(),_0x5a7afe=new Date(_0x542a91[_0x2f11cf(0x132)]()-this[_0x2f11cf(0x140)]*0x3c*0x3e8),_0xf74b40=new Date();_0xf74b40[_0x2f11cf(0xda)](_0xf74b40[_0x2f11cf(0xba)]()-this['SLOW_TIMEOUT_DAYS']),console[_0x2f11cf(0x125)](_0x2f11cf(0xdd)+_0x5a7afe[_0x2f11cf(0x14c)]()),console['log']('üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20'+_0xf74b40[_0x2f11cf(0x14c)]()),console[_0x2f11cf(0x125)](_0x2f11cf(0x11d)+this[_0x2f11cf(0x14f)][_0x2f11cf(0xdf)](',\x20'));const _0x5e8d32=await database_1['default'][_0x2f11cf(0x149)][_0x2f11cf(0xe0)]({'where':{'status':client_1[_0x2f11cf(0x13c)]['PENDING'],'OR':[{'gateway':{'in':this[_0x2f11cf(0x14f)]},'createdAt':{'lt':_0x5a7afe}},{'gateway':{'notIn':this[_0x2f11cf(0x14f)]},'createdAt':{'lt':_0xf74b40}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2f11cf(0x125)](_0x2f11cf(0xe3)+_0x5e8d32[_0x2f11cf(0x12b)]+_0x2f11cf(0xf4));if(_0x5e8d32[_0x2f11cf(0x12b)]===0x0)return console[_0x2f11cf(0x125)](_0x2f11cf(0xb7)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x4e219c of _0x5e8d32){try{const _0x393ad1=this[_0x2f11cf(0x14f)][_0x2f11cf(0x117)](_0x4e219c[_0x2f11cf(0x151)]),_0x54b7ce=_0x393ad1?_0x2f11cf(0xb5):_0x2f11cf(0x122),_0x3f801f=Math[_0x2f11cf(0x139)]((Date[_0x2f11cf(0x114)]()-_0x4e219c['createdAt'][_0x2f11cf(0x132)]())/(0x3e8*0x3c));console[_0x2f11cf(0x125)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x4e219c['id']),console[_0x2f11cf(0x125)](_0x2f11cf(0xe7)+_0x4e219c[_0x2f11cf(0x151)]+'\x20('+_0x54b7ce+_0x2f11cf(0x147)),console[_0x2f11cf(0x125)](_0x2f11cf(0xec)+_0x4e219c[_0x2f11cf(0xc2)]+'\x20'+_0x4e219c[_0x2f11cf(0x133)]),console[_0x2f11cf(0x125)](_0x2f11cf(0x119)+_0x4e219c[_0x2f11cf(0x102)][_0x2f11cf(0xf1)]+'\x20('+_0x4e219c[_0x2f11cf(0x102)]['username']+')'),console[_0x2f11cf(0x125)]('\x20\x20\x20Created:\x20'+_0x4e219c[_0x2f11cf(0x152)][_0x2f11cf(0x14c)]()),console[_0x2f11cf(0x125)](_0x2f11cf(0x110)+_0x3f801f+_0x2f11cf(0xbc));const _0x128338=await database_1[_0x2f11cf(0x115)][_0x2f11cf(0x149)]['update']({'where':{'id':_0x4e219c['id']},'data':{'status':client_1[_0x2f11cf(0x13c)][_0x2f11cf(0x136)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x2f11cf(0xe8)+_0x54b7ce}});console[_0x2f11cf(0x125)](_0x2f11cf(0x12f)+_0x4e219c['id']+'\x20from\x20PENDING\x20to\x20EXPIRED'),loggerService_1['loggerService'][_0x2f11cf(0xcd)](_0x4e219c[_0x2f11cf(0x151)],_0x4e219c['id'],'PENDING',_0x2f11cf(0x136),{'reason':_0x2f11cf(0xb6),'timeout':_0x54b7ce,'ageMinutes':_0x3f801f}),_0x1135b0++;}catch(_0xa6bce7){const _0x5409e2=_0x2f11cf(0xc1)+_0x4e219c['id']+':\x20'+(_0xa6bce7 instanceof Error?_0xa6bce7[_0x2f11cf(0x13e)]:_0x2f11cf(0xf9));console[_0x2f11cf(0xd1)]('‚ùå\x20'+_0x5409e2),_0x55e100['push'](_0x5409e2),_0x3ac0a7++;}}const _0x3a2588=_0x2f11cf(0x12d)+_0x1135b0+_0x2f11cf(0x12c)+_0x3ac0a7+_0x2f11cf(0xb8);return console[_0x2f11cf(0x125)](_0x2f11cf(0xfe)+_0x3a2588),loggerService_1[_0x2f11cf(0xfd)][_0x2f11cf(0x148)](_0x2f11cf(0xbb),_0x2f11cf(0x12e),'system',_0x2f11cf(0xd4),{'processed':_0x1135b0,'failed':_0x3ac0a7,'errors':_0x55e100,'fastTimeoutMinutes':this[_0x2f11cf(0x140)],'slowTimeoutDays':this[_0x2f11cf(0xcb)]}),{'processed':_0x1135b0,'failed':_0x3ac0a7,'errors':_0x55e100};}catch(_0x1c6146){const _0x587547=_0x2f11cf(0xcf)+(_0x1c6146 instanceof Error?_0x1c6146['message']:_0x2f11cf(0xf9));return console[_0x2f11cf(0xd1)](_0x2f11cf(0xe5)+_0x587547),_0x55e100[_0x2f11cf(0x130)](_0x587547),loggerService_1[_0x2f11cf(0xfd)][_0x2f11cf(0x10b)]('pending_payment_cleanup',_0x587547,{'timeoutDays':this[_0x2f11cf(0x11a)]}),{'processed':_0x1135b0,'failed':_0x3ac0a7,'errors':_0x55e100};}}async['getProcessingPaymentsStats'](){const _0x58610f=a80_0x43114f;try{const _0x262527=new Date(),_0x1252a6=new Date(_0x262527[_0x58610f(0x132)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x32b0b7=new Date(_0x262527['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x40a049=new Date(_0x262527[_0x58610f(0x132)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x383aff=await database_1[_0x58610f(0x115)][_0x58610f(0x149)]['findMany']({'where':{'status':{'in':[client_1['PaymentStatus']['PROCESSING'],client_1[_0x58610f(0x13c)][_0x58610f(0xe4)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x4cd05e={'total':_0x383aff[_0x58610f(0x12b)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0xa5bda4 of _0x383aff){if(_0xa5bda4[_0x58610f(0x152)]>_0x1252a6)_0x4cd05e[_0x58610f(0x13f)][_0x58610f(0xfb)]++;else{if(_0xa5bda4[_0x58610f(0x152)]>_0x32b0b7)_0x4cd05e[_0x58610f(0x13f)][_0x58610f(0x104)]++;else _0xa5bda4[_0x58610f(0x152)]>_0x40a049?_0x4cd05e[_0x58610f(0x13f)]['stale']++:_0x4cd05e[_0x58610f(0x13f)][_0x58610f(0x111)]++;}!_0x4cd05e[_0x58610f(0x146)][_0xa5bda4[_0x58610f(0x151)]]&&(_0x4cd05e['byGateway'][_0xa5bda4[_0x58610f(0x151)]]=0x0);_0x4cd05e[_0x58610f(0x146)][_0xa5bda4[_0x58610f(0x151)]]++;const _0xef51f7=_0xa5bda4[_0x58610f(0x118)];!_0x4cd05e[_0x58610f(0xf2)][_0xef51f7]&&(_0x4cd05e['byStatus'][_0xef51f7]=0x0),_0x4cd05e[_0x58610f(0xf2)][_0xef51f7]++;}return _0x4cd05e;}catch(_0x119b5b){console[_0x58610f(0xd1)](_0x58610f(0x116),_0x119b5b);throw new Error(_0x58610f(0xe9)+(_0x119b5b instanceof Error?_0x119b5b[_0x58610f(0x13e)]:_0x58610f(0xf9)));}}async['runCleanupWithReport'](){const _0x3870dd=a80_0x43114f;console['log']('üöÄ\x20Starting\x20payment\x20cleanup\x20service...');const _0x5626d9=await this[_0x3870dd(0x141)]();console[_0x3870dd(0x125)](_0x3870dd(0x100)),console[_0x3870dd(0x125)](_0x3870dd(0xd7)+_0x5626d9[_0x3870dd(0xd8)]),console[_0x3870dd(0x125)]('\x20\x20\x20Fresh\x20(<\x201\x20day):\x20'+_0x5626d9[_0x3870dd(0x13f)][_0x3870dd(0xfb)]),console[_0x3870dd(0x125)](_0x3870dd(0xf7)+_0x5626d9['byAge'][_0x3870dd(0x104)]),console[_0x3870dd(0x125)](_0x3870dd(0xcc)+_0x5626d9['byAge'][_0x3870dd(0xee)]),console[_0x3870dd(0x125)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x5626d9[_0x3870dd(0x13f)][_0x3870dd(0x111)]),console[_0x3870dd(0x125)](_0x3870dd(0x11b),_0x5626d9[_0x3870dd(0x146)]),console[_0x3870dd(0x125)](_0x3870dd(0x12a),_0x5626d9[_0x3870dd(0xf2)]),console[_0x3870dd(0x125)](_0x3870dd(0xce));const _0x3b0605=await this['cleanupStaleProcessingPayments']();console[_0x3870dd(0x125)](_0x3870dd(0xc3));const _0x19a1fb=await this[_0x3870dd(0x134)](),_0x4317f8=await this[_0x3870dd(0x141)]();console[_0x3870dd(0x125)]('\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console['log'](_0x3870dd(0xd7)+_0x4317f8[_0x3870dd(0xd8)]),console[_0x3870dd(0x125)](_0x3870dd(0x10d)+_0x4317f8['byAge']['expired']),console['log'](_0x3870dd(0x12a),_0x4317f8[_0x3870dd(0xf2)]);const _0x1832fe=_0x3b0605[_0x3870dd(0xc6)]+_0x19a1fb['processed'],_0x1bf9b1=_0x3b0605[_0x3870dd(0xb9)]+_0x19a1fb[_0x3870dd(0xb9)],_0x322b10=[..._0x3b0605[_0x3870dd(0x112)],..._0x19a1fb['errors']];console[_0x3870dd(0x125)]('\x0aüìà\x20Cleanup\x20Summary:'),console[_0x3870dd(0x125)](_0x3870dd(0xfc)+_0x3b0605[_0x3870dd(0xc6)]),console[_0x3870dd(0x125)](_0x3870dd(0x14b)+_0x19a1fb['processed']),console['log'](_0x3870dd(0x143)+_0x1832fe),console['log']('\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20'+_0x1bf9b1),console['log'](_0x3870dd(0x109)+(_0x5626d9['total']-_0x4317f8[_0x3870dd(0xd8)])),_0x322b10[_0x3870dd(0x12b)]>0x0&&(console[_0x3870dd(0x125)](_0x3870dd(0xe2)),_0x322b10['forEach']((_0x3e55a0,_0x4af3c7)=>{const _0x3491f8=_0x3870dd;console[_0x3491f8(0x125)](_0x3491f8(0x144)+(_0x4af3c7+0x1)+'.\x20'+_0x3e55a0);})),console['log'](_0x3870dd(0x13a));}async[a80_0x43114f(0xbd)](){const _0x555b91=a80_0x43114f;console['log'](_0x555b91(0x128));const _0x3e8e66=await this[_0x555b91(0x141)](),_0x403744=_0x3e8e66[_0x555b91(0xf2)][_0x555b91(0x138)]||0x0;console[_0x555b91(0x125)](_0x555b91(0x103)+_0x403744);const _0x58b4b2=await this['cleanupStaleProcessingPayments'](),_0x478043=await this[_0x555b91(0x141)](),_0x31d5e2=_0x478043['byStatus'][_0x555b91(0x138)]||0x0;console[_0x555b91(0x125)](_0x555b91(0xff)+_0x31d5e2),console[_0x555b91(0x125)](_0x555b91(0xbf)+_0x58b4b2['processed']),console[_0x555b91(0x125)](_0x555b91(0x10a));}async[a80_0x43114f(0x106)](){const _0x5982c0=a80_0x43114f;console[_0x5982c0(0x125)](_0x5982c0(0xf8));const _0x5830ea=await this[_0x5982c0(0x141)](),_0x36da59=_0x5830ea[_0x5982c0(0xf2)][_0x5982c0(0xe4)]||0x0;console[_0x5982c0(0x125)]('üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20'+_0x36da59);const _0x54fb13=await this[_0x5982c0(0x134)](),_0xe282ed=await this[_0x5982c0(0x141)](),_0x22fdab=_0xe282ed[_0x5982c0(0xf2)][_0x5982c0(0xe4)]||0x0;console[_0x5982c0(0x125)](_0x5982c0(0xd5)+_0x22fdab),console[_0x5982c0(0x125)](_0x5982c0(0xf6)+_0x54fb13[_0x5982c0(0xc6)]),console[_0x5982c0(0x125)](_0x5982c0(0x135));}async[a80_0x43114f(0x10e)](){const _0xb7e2b9=a80_0x43114f,_0x3b0b21=[];let _0x44ae41=0x0;try{console[_0xb7e2b9(0x125)]('‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x53f2b9=new Date(),_0x3a496c=[_0xb7e2b9(0x14a),_0xb7e2b9(0x11e)],_0x1b957c=[_0xb7e2b9(0x124),'rapyd',_0xb7e2b9(0xea),_0xb7e2b9(0x13b)],_0x1afec2=await database_1[_0xb7e2b9(0x115)][_0xb7e2b9(0xf5)][_0xb7e2b9(0xe0)]({'where':{'type':_0xb7e2b9(0xf0),'status':_0xb7e2b9(0x129)},'include':{'payments':{'orderBy':{'createdAt':_0xb7e2b9(0xd0)},'take':0x1}}});console[_0xb7e2b9(0x125)](_0xb7e2b9(0xe3)+_0x1afec2[_0xb7e2b9(0x12b)]+_0xb7e2b9(0xc4));for(const _0x408fda of _0x1afec2){try{if(_0x408fda[_0xb7e2b9(0xc8)][_0xb7e2b9(0x12b)]===0x0)continue;const _0x383c5f=_0x408fda[_0xb7e2b9(0xc8)][0x0];if(_0x383c5f['status']===_0xb7e2b9(0xd2))continue;const _0x1670ab=_0x53f2b9['getTime']()-_0x383c5f[_0xb7e2b9(0x152)][_0xb7e2b9(0x132)]();let _0x36e83c;_0x3a496c[_0xb7e2b9(0x117)](_0x408fda[_0xb7e2b9(0x151)])||_0x1b957c['includes'](_0x408fda['gateway'])?_0x36e83c=0x1e*0x3c*0x3e8:_0x36e83c=0x3*0x18*0x3c*0x3c*0x3e8,_0x1670ab>_0x36e83c&&(await database_1[_0xb7e2b9(0x115)][_0xb7e2b9(0xf5)]['update']({'where':{'id':_0x408fda['id']},'data':{'status':'EXPIRED'}}),console[_0xb7e2b9(0x125)](_0xb7e2b9(0x150)+_0x408fda['id']+_0xb7e2b9(0xfa)+_0x408fda[_0xb7e2b9(0x151)]+',\x20payment\x20age:\x20'+Math['round'](_0x1670ab/0x3e8/0x3c)+_0xb7e2b9(0xdb)),_0x44ae41++);}catch(_0x3f06d5){const _0x45742c=_0xb7e2b9(0x126)+_0x408fda['id']+':\x20'+(_0x3f06d5 instanceof Error?_0x3f06d5[_0xb7e2b9(0x13e)]:_0xb7e2b9(0xf9));console[_0xb7e2b9(0xd1)]('‚ùå\x20'+_0x45742c),_0x3b0b21[_0xb7e2b9(0x130)](_0x45742c);}}return console[_0xb7e2b9(0x125)](_0xb7e2b9(0x10f)+_0x44ae41+'\x20links\x20expired'),{'expired':_0x44ae41,'errors':_0x3b0b21};}catch(_0x310c86){const _0x2dce6d=_0xb7e2b9(0x108)+(_0x310c86 instanceof Error?_0x310c86['message']:_0xb7e2b9(0xf9));return console[_0xb7e2b9(0xd1)](_0xb7e2b9(0xe5)+_0x2dce6d),_0x3b0b21[_0xb7e2b9(0x130)](_0x2dce6d),{'expired':_0x44ae41,'errors':_0x3b0b21};}}}exports[a80_0x43114f(0x121)]=PaymentCleanupService,exports[a80_0x43114f(0x131)]=new PaymentCleanupService();