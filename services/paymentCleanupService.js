'use strict';const a80_0x1bd788=a80_0x1725;function a80_0x1725(_0x31d2bf,_0x4c7874){_0x31d2bf=_0x31d2bf-0x189;const _0x232377=a80_0x2323();let _0x1725cb=_0x232377[_0x31d2bf];return _0x1725cb;}(function(_0x197f54,_0x56455c){const _0x2f3e32=a80_0x1725,_0x1e6b99=_0x197f54();while(!![]){try{const _0x4eb025=-parseInt(_0x2f3e32(0x212))/0x1*(-parseInt(_0x2f3e32(0x20c))/0x2)+parseInt(_0x2f3e32(0x1ad))/0x3+parseInt(_0x2f3e32(0x1dc))/0x4+parseInt(_0x2f3e32(0x203))/0x5*(parseInt(_0x2f3e32(0x20e))/0x6)+parseInt(_0x2f3e32(0x1a6))/0x7+parseInt(_0x2f3e32(0x1e0))/0x8*(-parseInt(_0x2f3e32(0x1e6))/0x9)+parseInt(_0x2f3e32(0x1a8))/0xa*(-parseInt(_0x2f3e32(0x1d2))/0xb);if(_0x4eb025===_0x56455c)break;else _0x1e6b99['push'](_0x1e6b99['shift']());}catch(_0x34eef6){_0x1e6b99['push'](_0x1e6b99['shift']());}}}(a80_0x2323,0xaadde));var __importDefault=this&&this[a80_0x1bd788(0x1e2)]||function(_0x26c390){const _0x4e35b0=a80_0x1bd788;return _0x26c390&&_0x26c390[_0x4e35b0(0x213)]?_0x26c390:{'default':_0x26c390};};function a80_0x2323(){const _0x3530b2=['PAID','ACTIVE','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','./loggerService','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','\x20\x20\x20Age:\x20','stale','payment_cleanup','../config/database','\x20\x20\x20Shop:\x20','Cleanup\x20completed:\x20','visa/mastercard','expired','logWebhookProcessed','failed','\x20payments\x20updated\x20to\x20EXPIRED,\x20','rapyd','\x20days','SLOW_TIMEOUT_DAYS','@prisma/client','runProcessingCleanupOnly','PENDING','loggerService','PENDING\x20cleanup\x20completed:\x20','\x20timeout)','payment','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','33CnhJNU','30\x20minutes','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','logWebhookError','Link\x20expiration\x20service\x20error:\x20','payments','cleanupStalePendingPayments','\x20stale\x20PROCESSING\x20payments','paymentLink','Failed\x20to\x20expire\x20link\x20','2724124PmJqQy','defineProperty','PROCESSING','plisio','2082040xQkWFG','gateway','__importDefault','recent','\x20\x20\x20Recent\x20(1-3\x20days):\x20','mastercard','9Viokqa','\x20\x20\x20Created:\x20','cleanupStaleProcessingPayments','expireSinglePaymentLinks','system','error','\x20(gateway:\x20','floor','default','üìã\x20Fast\x20timeout\x20gateways:\x20','\x20from\x20PROCESSING\x20to\x20FAILED','üèÅ\x20Payment\x20cleanup\x20service\x20completed','FAST_TIMEOUT_GATEWAYS','push','username','runCleanupWithReport','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','oxapay','Cleanup\x20service\x20error:\x20','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','now','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','message','byStatus','Failed\x20to\x20update\x20payment\x20','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','setDate','\x20active\x20SINGLE\x20links\x20to\x20check','6549425ugwWAk','Unknown\x20error','\x20\x20\x20By\x20gateway:','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','\x20\x20\x20Amount:\x20','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','squirrelpay','‚úÖ\x20Updated\x20payment\x20','\x20minutes)','3946lBEEpu','\x20\x20\x20Gateway:\x20','6LAnFVc','update','includes','join','11lrfsEb','__esModule','üí•\x20','Failed\x20to\x20update\x20PENDING\x20payment\x20','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','forEach','status','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','\x0aüìà\x20Cleanup\x20Summary:','\x20\x20\x20\x20\x20\x20','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:','amount','total','\x20\x20\x20Stale\x20(3-5\x20days):\x20','fresh','logApiCall','üìä\x20Expiration\x20completed:\x20','byGateway','errors','findMany','log','PENDING\x20cleanup\x20service\x20error:\x20','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','name','getProcessingPaymentsStats','getTime','EXPIRED','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','pending_payment_cleanup','\x20\x20\x20By\x20status:','auto_timeout','createdAt','üîç\x20Found\x20','PENDING_TIMEOUT_DAYS','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','paymentCleanupService','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','\x20failed\x20to\x20update','FAILED','PROCESSING_TIMEOUT_DAYS','PaymentStatus','8362977xNiyAC','length','7994890TutCIA','FAST_TIMEOUT_MINUTES','shop',',\x20payment\x20age:\x20','byAge','453786BDwdJv','runPendingCleanupOnly','toISOString','PaymentCleanupService','getDate','processed','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','POST','\x20links\x20expired'];a80_0x2323=function(){return _0x3530b2;};return a80_0x2323();}Object[a80_0x1bd788(0x1dd)](exports,a80_0x1bd788(0x213),{'value':!![]}),exports[a80_0x1bd788(0x1a0)]=exports[a80_0x1bd788(0x1b0)]=void 0x0;const database_1=__importDefault(require(a80_0x1bd788(0x1bf))),client_1=require(a80_0x1bd788(0x1ca)),loggerService_1=require(a80_0x1bd788(0x1b9));class PaymentCleanupService{constructor(){const _0x940bec=a80_0x1bd788;this[_0x940bec(0x1a4)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this['FAST_TIMEOUT_MINUTES']=0x1e,this[_0x940bec(0x1c9)]=0x3,this['FAST_TIMEOUT_GATEWAYS']=[_0x940bec(0x209),'squirrel-pay',_0x940bec(0x1c7),_0x940bec(0x1c2),_0x940bec(0x1df),'oxapay'];}async[a80_0x1bd788(0x1e8)](){const _0x48f908=a80_0x1bd788,_0x3c5521=[];let _0x1713ad=0x0,_0x23414a=0x0;try{console[_0x48f908(0x191)](_0x48f908(0x1d4));const _0x14d662=new Date();_0x14d662[_0x48f908(0x201)](_0x14d662[_0x48f908(0x1b1)]()-this['PROCESSING_TIMEOUT_DAYS']),console[_0x48f908(0x191)](_0x48f908(0x19f)+_0x14d662[_0x48f908(0x1af)]());const _0x3ad6b3=await database_1['default'][_0x48f908(0x1d0)]['findMany']({'where':{'status':client_1[_0x48f908(0x1a5)]['PROCESSING'],'createdAt':{'lt':_0x14d662}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x48f908(0x191)](_0x48f908(0x19d)+_0x3ad6b3['length']+_0x48f908(0x1d9));if(_0x3ad6b3[_0x48f908(0x1a7)]===0x0)return console['log']('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x252c39 of _0x3ad6b3){try{console[_0x48f908(0x191)](_0x48f908(0x1ba)+_0x252c39['id']+'\x20('+_0x252c39[_0x48f908(0x1e1)]+',\x20'+_0x252c39[_0x48f908(0x21e)]+'\x20'+_0x252c39['currency']+')'),console[_0x48f908(0x191)](_0x48f908(0x1c0)+_0x252c39[_0x48f908(0x1aa)][_0x48f908(0x194)]+'\x20('+_0x252c39[_0x48f908(0x1aa)]['username']+')'),console['log'](_0x48f908(0x1e7)+_0x252c39[_0x48f908(0x19c)][_0x48f908(0x1af)]()),console[_0x48f908(0x191)](_0x48f908(0x1bc)+Math[_0x48f908(0x1ed)]((Date[_0x48f908(0x1fb)]()-_0x252c39[_0x48f908(0x19c)][_0x48f908(0x196)]())/(0x3e8*0x3c*0x3c*0x18))+_0x48f908(0x1c8));const _0x5a8ae8=await database_1[_0x48f908(0x1ee)]['payment']['update']({'where':{'id':_0x252c39['id']},'data':{'status':client_1['PaymentStatus']['FAILED'],'statusChangedBy':_0x48f908(0x1ea),'statusChangedAt':new Date(),'failureMessage':_0x48f908(0x200)+this['PROCESSING_TIMEOUT_DAYS']+_0x48f908(0x1c8)}});console['log'](_0x48f908(0x20a)+_0x252c39['id']+_0x48f908(0x1f0)),loggerService_1[_0x48f908(0x1cd)][_0x48f908(0x1c4)](_0x252c39[_0x48f908(0x1e1)],_0x252c39['id'],_0x48f908(0x1de),_0x48f908(0x1a3),{'reason':_0x48f908(0x19b),'timeoutDays':this[_0x48f908(0x1a4)]}),_0x1713ad++;}catch(_0x262afc){const _0x5bcd7a=_0x48f908(0x1ff)+_0x252c39['id']+':\x20'+(_0x262afc instanceof Error?_0x262afc[_0x48f908(0x1fd)]:'Unknown\x20error');console[_0x48f908(0x1eb)]('‚ùå\x20'+_0x5bcd7a),_0x3c5521[_0x48f908(0x1f3)](_0x5bcd7a),_0x23414a++;}}const _0x180e20=_0x48f908(0x1c1)+_0x1713ad+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0x23414a+_0x48f908(0x1a2);return console[_0x48f908(0x191)]('üìä\x20'+_0x180e20),loggerService_1[_0x48f908(0x1cd)]['logApiCall']('payment_cleanup',_0x48f908(0x1b4),'system','admin',{'processed':_0x1713ad,'failed':_0x23414a,'errors':_0x3c5521,'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x1713ad,'failed':_0x23414a,'errors':_0x3c5521};}catch(_0x2cde4f){const _0x34bac5=_0x48f908(0x1f8)+(_0x2cde4f instanceof Error?_0x2cde4f['message']:'Unknown\x20error');return console[_0x48f908(0x1eb)](_0x48f908(0x214)+_0x34bac5),_0x3c5521[_0x48f908(0x1f3)](_0x34bac5),loggerService_1[_0x48f908(0x1cd)][_0x48f908(0x1d5)](_0x48f908(0x1be),_0x34bac5,{'timeoutDays':this[_0x48f908(0x1a4)]}),{'processed':_0x1713ad,'failed':_0x23414a,'errors':_0x3c5521};}}async['cleanupStalePendingPayments'](){const _0x27fda5=a80_0x1bd788,_0x8c683c=[];let _0x5ec668=0x0,_0x1a6955=0x0;try{console['log'](_0x27fda5(0x1d1));const _0x225c0e=new Date(),_0x3236f6=new Date(_0x225c0e[_0x27fda5(0x196)]()-this[_0x27fda5(0x1a9)]*0x3c*0x3e8),_0xc7e4e=new Date();_0xc7e4e[_0x27fda5(0x201)](_0xc7e4e[_0x27fda5(0x1b1)]()-this['SLOW_TIMEOUT_DAYS']),console[_0x27fda5(0x191)](_0x27fda5(0x1f9)+_0x3236f6[_0x27fda5(0x1af)]()),console[_0x27fda5(0x191)]('üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20'+_0xc7e4e[_0x27fda5(0x1af)]()),console[_0x27fda5(0x191)](_0x27fda5(0x1ef)+this[_0x27fda5(0x1f2)][_0x27fda5(0x211)](',\x20'));const _0xe41570=await database_1[_0x27fda5(0x1ee)][_0x27fda5(0x1d0)][_0x27fda5(0x190)]({'where':{'status':client_1[_0x27fda5(0x1a5)][_0x27fda5(0x1cc)],'OR':[{'gateway':{'in':this[_0x27fda5(0x1f2)]},'createdAt':{'lt':_0x3236f6}},{'gateway':{'notIn':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0xc7e4e}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x27fda5(0x191)]('üîç\x20Found\x20'+_0xe41570[_0x27fda5(0x1a7)]+'\x20stale\x20PENDING\x20payments');if(_0xe41570[_0x27fda5(0x1a7)]===0x0)return console[_0x27fda5(0x191)]('‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x306c13 of _0xe41570){try{const _0x18c9d5=this[_0x27fda5(0x1f2)][_0x27fda5(0x210)](_0x306c13[_0x27fda5(0x1e1)]),_0x466d1b=_0x18c9d5?_0x27fda5(0x1d3):'3\x20days',_0x516d3d=Math['floor']((Date[_0x27fda5(0x1fb)]()-_0x306c13[_0x27fda5(0x19c)]['getTime']())/(0x3e8*0x3c));console[_0x27fda5(0x191)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x306c13['id']),console[_0x27fda5(0x191)](_0x27fda5(0x20d)+_0x306c13[_0x27fda5(0x1e1)]+'\x20('+_0x466d1b+_0x27fda5(0x1cf)),console[_0x27fda5(0x191)](_0x27fda5(0x207)+_0x306c13[_0x27fda5(0x21e)]+'\x20'+_0x306c13['currency']),console[_0x27fda5(0x191)]('\x20\x20\x20Shop:\x20'+_0x306c13[_0x27fda5(0x1aa)][_0x27fda5(0x194)]+'\x20('+_0x306c13[_0x27fda5(0x1aa)][_0x27fda5(0x1f4)]+')'),console[_0x27fda5(0x191)](_0x27fda5(0x1e7)+_0x306c13['createdAt'][_0x27fda5(0x1af)]()),console[_0x27fda5(0x191)]('\x20\x20\x20Age:\x20'+_0x516d3d+'\x20minutes');const _0x1962a3=await database_1[_0x27fda5(0x1ee)][_0x27fda5(0x1d0)][_0x27fda5(0x20f)]({'where':{'id':_0x306c13['id']},'data':{'status':client_1['PaymentStatus'][_0x27fda5(0x197)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x27fda5(0x208)+_0x466d1b}});console[_0x27fda5(0x191)](_0x27fda5(0x20a)+_0x306c13['id']+'\x20from\x20PENDING\x20to\x20EXPIRED'),loggerService_1[_0x27fda5(0x1cd)][_0x27fda5(0x1c4)](_0x306c13['gateway'],_0x306c13['id'],_0x27fda5(0x1cc),'EXPIRED',{'reason':'auto_timeout_pending','timeout':_0x466d1b,'ageMinutes':_0x516d3d}),_0x5ec668++;}catch(_0x1c6bb1){const _0x2a1b9a=_0x27fda5(0x215)+_0x306c13['id']+':\x20'+(_0x1c6bb1 instanceof Error?_0x1c6bb1[_0x27fda5(0x1fd)]:_0x27fda5(0x204));console['error']('‚ùå\x20'+_0x2a1b9a),_0x8c683c[_0x27fda5(0x1f3)](_0x2a1b9a),_0x1a6955++;}}const _0x513bbb=_0x27fda5(0x1ce)+_0x5ec668+_0x27fda5(0x1c6)+_0x1a6955+'\x20failed\x20to\x20update';return console['log']('üìä\x20'+_0x513bbb),loggerService_1['loggerService'][_0x27fda5(0x18c)](_0x27fda5(0x199),'POST','system','admin',{'processed':_0x5ec668,'failed':_0x1a6955,'errors':_0x8c683c,'fastTimeoutMinutes':this[_0x27fda5(0x1a9)],'slowTimeoutDays':this[_0x27fda5(0x1c9)]}),{'processed':_0x5ec668,'failed':_0x1a6955,'errors':_0x8c683c};}catch(_0x70a9db){const _0x45ba83=_0x27fda5(0x192)+(_0x70a9db instanceof Error?_0x70a9db[_0x27fda5(0x1fd)]:_0x27fda5(0x204));return console[_0x27fda5(0x1eb)](_0x27fda5(0x214)+_0x45ba83),_0x8c683c[_0x27fda5(0x1f3)](_0x45ba83),loggerService_1[_0x27fda5(0x1cd)][_0x27fda5(0x1d5)]('pending_payment_cleanup',_0x45ba83,{'timeoutDays':this[_0x27fda5(0x19e)]}),{'processed':_0x5ec668,'failed':_0x1a6955,'errors':_0x8c683c};}}async[a80_0x1bd788(0x195)](){const _0xffcff=a80_0x1bd788;try{const _0x1c2947=new Date(),_0x2b4da1=new Date(_0x1c2947[_0xffcff(0x196)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x1edd86=new Date(_0x1c2947[_0xffcff(0x196)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x16629c=new Date(_0x1c2947[_0xffcff(0x196)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x3cf92e=await database_1['default'][_0xffcff(0x1d0)][_0xffcff(0x190)]({'where':{'status':{'in':[client_1[_0xffcff(0x1a5)][_0xffcff(0x1de)],client_1[_0xffcff(0x1a5)][_0xffcff(0x1cc)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x4741ec={'total':_0x3cf92e['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x47ca24 of _0x3cf92e){if(_0x47ca24['createdAt']>_0x2b4da1)_0x4741ec[_0xffcff(0x1ac)][_0xffcff(0x18b)]++;else{if(_0x47ca24[_0xffcff(0x19c)]>_0x1edd86)_0x4741ec['byAge'][_0xffcff(0x1e3)]++;else _0x47ca24[_0xffcff(0x19c)]>_0x16629c?_0x4741ec[_0xffcff(0x1ac)][_0xffcff(0x1bd)]++:_0x4741ec[_0xffcff(0x1ac)][_0xffcff(0x1c3)]++;}!_0x4741ec[_0xffcff(0x18e)][_0x47ca24[_0xffcff(0x1e1)]]&&(_0x4741ec[_0xffcff(0x18e)][_0x47ca24[_0xffcff(0x1e1)]]=0x0);_0x4741ec['byGateway'][_0x47ca24[_0xffcff(0x1e1)]]++;const _0x2bf339=_0x47ca24[_0xffcff(0x218)];!_0x4741ec[_0xffcff(0x1fe)][_0x2bf339]&&(_0x4741ec['byStatus'][_0x2bf339]=0x0),_0x4741ec[_0xffcff(0x1fe)][_0x2bf339]++;}return _0x4741ec;}catch(_0x2a3c1e){console['error'](_0xffcff(0x21d),_0x2a3c1e);throw new Error(_0xffcff(0x198)+(_0x2a3c1e instanceof Error?_0x2a3c1e[_0xffcff(0x1fd)]:_0xffcff(0x204)));}}async[a80_0x1bd788(0x1f5)](){const _0x585ea4=a80_0x1bd788;console[_0x585ea4(0x191)](_0x585ea4(0x1f6));const _0x2511d3=await this[_0x585ea4(0x195)]();console['log']('üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:'),console[_0x585ea4(0x191)]('\x20\x20\x20Total:\x20'+_0x2511d3['total']),console['log'](_0x585ea4(0x1b8)+_0x2511d3[_0x585ea4(0x1ac)]['fresh']),console[_0x585ea4(0x191)](_0x585ea4(0x1e4)+_0x2511d3['byAge'][_0x585ea4(0x1e3)]),console[_0x585ea4(0x191)](_0x585ea4(0x18a)+_0x2511d3[_0x585ea4(0x1ac)][_0x585ea4(0x1bd)]),console[_0x585ea4(0x191)](_0x585ea4(0x21c)+_0x2511d3[_0x585ea4(0x1ac)][_0x585ea4(0x1c3)]),console[_0x585ea4(0x191)](_0x585ea4(0x205),_0x2511d3[_0x585ea4(0x18e)]),console[_0x585ea4(0x191)](_0x585ea4(0x19a),_0x2511d3['byStatus']),console[_0x585ea4(0x191)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x1e37bd=await this[_0x585ea4(0x1e8)]();console[_0x585ea4(0x191)](_0x585ea4(0x193));const _0x5131bd=await this[_0x585ea4(0x1d8)](),_0x4e98db=await this['getProcessingPaymentsStats']();console['log'](_0x585ea4(0x1b3)),console[_0x585ea4(0x191)]('\x20\x20\x20Total:\x20'+_0x4e98db['total']),console[_0x585ea4(0x191)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x4e98db['byAge']['expired']),console['log']('\x20\x20\x20By\x20status:',_0x4e98db[_0x585ea4(0x1fe)]);const _0x9a9ad8=_0x1e37bd['processed']+_0x5131bd[_0x585ea4(0x1b2)],_0x19963c=_0x1e37bd[_0x585ea4(0x1c5)]+_0x5131bd[_0x585ea4(0x1c5)],_0x112cbc=[..._0x1e37bd['errors'],..._0x5131bd[_0x585ea4(0x18f)]];console[_0x585ea4(0x191)](_0x585ea4(0x21a)),console[_0x585ea4(0x191)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x1e37bd[_0x585ea4(0x1b2)]),console[_0x585ea4(0x191)]('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x5131bd['processed']),console[_0x585ea4(0x191)](_0x585ea4(0x216)+_0x9a9ad8),console['log'](_0x585ea4(0x1bb)+_0x19963c),console['log']('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x2511d3[_0x585ea4(0x189)]-_0x4e98db['total'])),_0x112cbc[_0x585ea4(0x1a7)]>0x0&&(console[_0x585ea4(0x191)]('\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:'),_0x112cbc[_0x585ea4(0x217)]((_0x25dc91,_0x3c3104)=>{const _0x1f0164=_0x585ea4;console[_0x1f0164(0x191)](_0x1f0164(0x21b)+(_0x3c3104+0x1)+'.\x20'+_0x25dc91);})),console[_0x585ea4(0x191)](_0x585ea4(0x1f1));}async[a80_0x1bd788(0x1cb)](){const _0x270ce0=a80_0x1bd788;console[_0x270ce0(0x191)]('üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...');const _0x3ca997=await this[_0x270ce0(0x195)](),_0x1ddbda=_0x3ca997[_0x270ce0(0x1fe)]['PROCESSING']||0x0;console[_0x270ce0(0x191)](_0x270ce0(0x206)+_0x1ddbda);const _0x43e70d=await this[_0x270ce0(0x1e8)](),_0x4b5035=await this['getProcessingPaymentsStats'](),_0x320a40=_0x4b5035[_0x270ce0(0x1fe)][_0x270ce0(0x1de)]||0x0;console[_0x270ce0(0x191)](_0x270ce0(0x1fa)+_0x320a40),console[_0x270ce0(0x191)]('‚úÖ\x20PROCESSING\x20payments\x20processed:\x20'+_0x43e70d[_0x270ce0(0x1b2)]),console[_0x270ce0(0x191)]('üèÅ\x20PROCESSING\x20cleanup\x20completed');}async[a80_0x1bd788(0x1ae)](){const _0xf681a0=a80_0x1bd788;console[_0xf681a0(0x191)](_0xf681a0(0x1fc));const _0x597c3b=await this['getProcessingPaymentsStats'](),_0x33cbfe=_0x597c3b[_0xf681a0(0x1fe)]['PENDING']||0x0;console[_0xf681a0(0x191)](_0xf681a0(0x219)+_0x33cbfe);const _0x3e592d=await this[_0xf681a0(0x1d8)](),_0x1ff9b8=await this['getProcessingPaymentsStats'](),_0x566604=_0x1ff9b8[_0xf681a0(0x1fe)][_0xf681a0(0x1cc)]||0x0;console[_0xf681a0(0x191)](_0xf681a0(0x1a1)+_0x566604),console['log']('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x3e592d[_0xf681a0(0x1b2)]),console[_0xf681a0(0x191)]('üèÅ\x20PENDING\x20cleanup\x20completed');}async[a80_0x1bd788(0x1e9)](){const _0x4e0700=a80_0x1bd788,_0x4542ab=[];let _0x3fdb15=0x0;try{console[_0x4e0700(0x191)]('‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x1eb2fd=new Date(),_0x3e0461=[_0x4e0700(0x1f7),_0x4e0700(0x1df)],_0x591643=[_0x4e0700(0x209),_0x4e0700(0x1c7),_0x4e0700(0x1c2),_0x4e0700(0x1e5)],_0x5b5373=await database_1[_0x4e0700(0x1ee)][_0x4e0700(0x1da)][_0x4e0700(0x190)]({'where':{'type':'SINGLE','status':_0x4e0700(0x1b7)},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x4e0700(0x191)](_0x4e0700(0x19d)+_0x5b5373[_0x4e0700(0x1a7)]+_0x4e0700(0x202));for(const _0x272893 of _0x5b5373){try{if(_0x272893[_0x4e0700(0x1d7)][_0x4e0700(0x1a7)]===0x0)continue;const _0x5399f2=_0x272893[_0x4e0700(0x1d7)][0x0];if(_0x5399f2['status']===_0x4e0700(0x1b6))continue;const _0x3e3618=_0x1eb2fd[_0x4e0700(0x196)]()-_0x5399f2[_0x4e0700(0x19c)][_0x4e0700(0x196)]();let _0x125033;_0x3e0461[_0x4e0700(0x210)](_0x272893[_0x4e0700(0x1e1)])||_0x591643[_0x4e0700(0x210)](_0x272893[_0x4e0700(0x1e1)])?_0x125033=0x1e*0x3c*0x3e8:_0x125033=0x3*0x18*0x3c*0x3c*0x3e8,_0x3e3618>_0x125033&&(await database_1[_0x4e0700(0x1ee)][_0x4e0700(0x1da)][_0x4e0700(0x20f)]({'where':{'id':_0x272893['id']},'data':{'status':'EXPIRED'}}),console[_0x4e0700(0x191)]('‚è∞\x20Expired\x20link\x20'+_0x272893['id']+_0x4e0700(0x1ec)+_0x272893[_0x4e0700(0x1e1)]+_0x4e0700(0x1ab)+Math['round'](_0x3e3618/0x3e8/0x3c)+_0x4e0700(0x20b)),_0x3fdb15++);}catch(_0x211a38){const _0x520954=_0x4e0700(0x1db)+_0x272893['id']+':\x20'+(_0x211a38 instanceof Error?_0x211a38[_0x4e0700(0x1fd)]:'Unknown\x20error');console['error']('‚ùå\x20'+_0x520954),_0x4542ab[_0x4e0700(0x1f3)](_0x520954);}}return console['log'](_0x4e0700(0x18d)+_0x3fdb15+_0x4e0700(0x1b5)),{'expired':_0x3fdb15,'errors':_0x4542ab};}catch(_0x2eb938){const _0x16e787=_0x4e0700(0x1d6)+(_0x2eb938 instanceof Error?_0x2eb938[_0x4e0700(0x1fd)]:_0x4e0700(0x204));return console['error'](_0x4e0700(0x214)+_0x16e787),_0x4542ab[_0x4e0700(0x1f3)](_0x16e787),{'expired':_0x3fdb15,'errors':_0x4542ab};}}}exports[a80_0x1bd788(0x1b0)]=PaymentCleanupService,exports[a80_0x1bd788(0x1a0)]=new PaymentCleanupService();