'use strict';const a80_0x289c9c=a80_0x2b1c;function a80_0x47b0(){const _0x5bd5e2=['plisio','recent','rapyd','üìä\x20','PENDING_TIMEOUT_DAYS','system','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','cleanupStaleProcessingPayments','push','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','20055FavKti','__esModule','\x20\x20\x20Amount:\x20','gateway','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','30\x20minutes','admin','üèÅ\x20PENDING\x20cleanup\x20completed','ACTIVE','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','update','153mvgkoZ','‚è∞\x20Expired\x20link\x20','paymentCleanupService','createdAt','auto_timeout','amount','\x20failed\x20to\x20update','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','\x20stale\x20PROCESSING\x20payments','expired','üí•\x20','byAge','squirrelpay','436264aEcPaq','runProcessingCleanupOnly','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','\x20\x20\x20\x20\x20\x20','logWebhookProcessed','\x20payments\x20updated\x20to\x20EXPIRED,\x20','\x20\x20\x20Gateway:\x20','status','logWebhookError','üìã\x20Fast\x20timeout\x20gateways:\x20','getTime','squirrel-pay','Failed\x20to\x20expire\x20link\x20','currency','\x20active\x20SINGLE\x20links\x20to\x20check','Unknown\x20error','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','PENDING\x20cleanup\x20completed:\x20','SLOW_TIMEOUT_DAYS','PaymentCleanupService','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','üìä\x20Expiration\x20completed:\x20','now','PROCESSING_TIMEOUT_DAYS','\x20days','../config/database','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','loggerService','\x20payments\x20updated\x20to\x20FAILED,\x20','failed','expireSinglePaymentLinks','Cleanup\x20service\x20error:\x20','\x20\x20\x20Age:\x20','FAST_TIMEOUT_GATEWAYS','__importDefault','desc',',\x20payment\x20age:\x20','floor','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','runCleanupWithReport','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','FAST_TIMEOUT_MINUTES','byGateway','10qKWKuY','\x20\x20\x20Shop:\x20','PENDING','./loggerService','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','default','message','\x20\x20\x20Stale\x20(3-5\x20days):\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','total','pending_payment_cleanup','\x20from\x20PENDING\x20to\x20EXPIRED','SINGLE','1201165UYxrBp','paymentLink','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','stale','\x20from\x20PROCESSING\x20to\x20FAILED','Failed\x20to\x20get\x20processing\x20payments\x20stats:','includes','338888ypqZwN','logApiCall','length','name','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','Cleanup\x20completed:\x20','PaymentStatus','cleanupStalePendingPayments','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','\x20\x20\x20Total:\x20','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','errors','1937562nmaeMh','POST','payment','visa/mastercard','\x20\x20\x20Created:\x20','PROCESSING','FAILED','oxapay','mastercard','\x20links\x20expired','setDate','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','payments','getProcessingPaymentsStats','getDate','byStatus','1342945mtlBhC','log','\x20\x20\x20By\x20status:','12PLqiOH','fresh','‚úÖ\x20Updated\x20payment\x20','\x20\x20\x20By\x20gateway:','EXPIRED','findMany','payment_cleanup','auto_timeout_pending','8194410FAaEnj','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','processed','\x20(gateway:\x20','\x0aüìà\x20Cleanup\x20Summary:','‚úÖ\x20PENDING\x20payments\x20processed:\x20','username','toISOString','Failed\x20to\x20update\x20payment\x20','üîç\x20Found\x20','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','error','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','\x20timeout)'];a80_0x47b0=function(){return _0x5bd5e2;};return a80_0x47b0();}(function(_0x54529a,_0x5dd1e6){const _0x18464d=a80_0x2b1c,_0x4cf842=_0x54529a();while(!![]){try{const _0x418397=-parseInt(_0x18464d(0x1df))/0x1*(parseInt(_0x18464d(0x18b))/0x2)+parseInt(_0x18464d(0x1ab))/0x3+parseInt(_0x18464d(0x160))/0x4+parseInt(_0x18464d(0x1bb))/0x5+parseInt(_0x18464d(0x1be))/0x6*(-parseInt(_0x18464d(0x198))/0x7)+-parseInt(_0x18464d(0x19f))/0x8*(-parseInt(_0x18464d(0x153))/0x9)+-parseInt(_0x18464d(0x1c6))/0xa;if(_0x418397===_0x5dd1e6)break;else _0x4cf842['push'](_0x4cf842['shift']());}catch(_0x6892b5){_0x4cf842['push'](_0x4cf842['shift']());}}}(a80_0x47b0,0x755e4));var __importDefault=this&&this[a80_0x289c9c(0x182)]||function(_0x33a777){const _0xc313f6=a80_0x289c9c;return _0x33a777&&_0x33a777[_0xc313f6(0x1e0)]?_0x33a777:{'default':_0x33a777};};Object['defineProperty'](exports,a80_0x289c9c(0x1e0),{'value':!![]}),exports[a80_0x289c9c(0x155)]=exports[a80_0x289c9c(0x173)]=void 0x0;const database_1=__importDefault(require(a80_0x289c9c(0x179))),client_1=require('@prisma/client'),loggerService_1=require(a80_0x289c9c(0x18e));function a80_0x2b1c(_0xb2c92b,_0x40b7b9){_0xb2c92b=_0xb2c92b-0x14a;const _0x47b09d=a80_0x47b0();let _0x2b1cf4=_0x47b09d[_0xb2c92b];return _0x2b1cf4;}class PaymentCleanupService{constructor(){const _0x1d796c=a80_0x289c9c;this[_0x1d796c(0x177)]=0x5,this[_0x1d796c(0x1d8)]=0x5,this['FAST_TIMEOUT_MINUTES']=0x1e,this[_0x1d796c(0x172)]=0x3,this[_0x1d796c(0x181)]=[_0x1d796c(0x15f),_0x1d796c(0x16b),_0x1d796c(0x1d6),'visa/mastercard',_0x1d796c(0x1d4),_0x1d796c(0x1b2)];}async[a80_0x289c9c(0x1dc)](){const _0x5e33c2=a80_0x289c9c,_0x40ba4b=[];let _0x146911=0x0,_0x541eed=0x0;try{console[_0x5e33c2(0x1bc)](_0x5e33c2(0x1b6));const _0x36eb9e=new Date();_0x36eb9e[_0x5e33c2(0x1b5)](_0x36eb9e[_0x5e33c2(0x1b9)]()-this[_0x5e33c2(0x177)]),console[_0x5e33c2(0x1bc)]('üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20'+_0x36eb9e[_0x5e33c2(0x1cd)]());const _0x9690db=await database_1[_0x5e33c2(0x190)][_0x5e33c2(0x1ad)][_0x5e33c2(0x1c3)]({'where':{'status':client_1[_0x5e33c2(0x1a5)]['PROCESSING'],'createdAt':{'lt':_0x36eb9e}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x5e33c2(0x1bc)](_0x5e33c2(0x1cf)+_0x9690db[_0x5e33c2(0x1a1)]+_0x5e33c2(0x15b));if(_0x9690db['length']===0x0)return console[_0x5e33c2(0x1bc)](_0x5e33c2(0x1a9)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x5d1889 of _0x9690db){try{console[_0x5e33c2(0x1bc)](_0x5e33c2(0x1de)+_0x5d1889['id']+'\x20('+_0x5d1889['gateway']+',\x20'+_0x5d1889['amount']+'\x20'+_0x5d1889['currency']+')'),console['log']('\x20\x20\x20Shop:\x20'+_0x5d1889['shop'][_0x5e33c2(0x1a2)]+'\x20('+_0x5d1889['shop'][_0x5e33c2(0x1cc)]+')'),console['log'](_0x5e33c2(0x1af)+_0x5d1889[_0x5e33c2(0x156)][_0x5e33c2(0x1cd)]()),console['log'](_0x5e33c2(0x180)+Math[_0x5e33c2(0x185)]((Date[_0x5e33c2(0x176)]()-_0x5d1889[_0x5e33c2(0x156)][_0x5e33c2(0x16a)]())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x1ecf89=await database_1['default'][_0x5e33c2(0x1ad)][_0x5e33c2(0x152)]({'where':{'id':_0x5d1889['id']},'data':{'status':client_1[_0x5e33c2(0x1a5)][_0x5e33c2(0x1b1)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0x5e33c2(0x1d0)+this[_0x5e33c2(0x177)]+_0x5e33c2(0x178)}});console['log'](_0x5e33c2(0x1c0)+_0x5d1889['id']+_0x5e33c2(0x19c)),loggerService_1[_0x5e33c2(0x17b)]['logWebhookProcessed'](_0x5d1889[_0x5e33c2(0x14b)],_0x5d1889['id'],_0x5e33c2(0x1b0),'FAILED',{'reason':_0x5e33c2(0x157),'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),_0x146911++;}catch(_0x39ed06){const _0x163b9c=_0x5e33c2(0x1ce)+_0x5d1889['id']+':\x20'+(_0x39ed06 instanceof Error?_0x39ed06[_0x5e33c2(0x191)]:'Unknown\x20error');console[_0x5e33c2(0x1d1)]('‚ùå\x20'+_0x163b9c),_0x40ba4b[_0x5e33c2(0x1dd)](_0x163b9c),_0x541eed++;}}const _0x374826=_0x5e33c2(0x1a4)+_0x146911+_0x5e33c2(0x17c)+_0x541eed+_0x5e33c2(0x159);return console['log']('üìä\x20'+_0x374826),loggerService_1[_0x5e33c2(0x17b)][_0x5e33c2(0x1a0)]('payment_cleanup',_0x5e33c2(0x1ac),_0x5e33c2(0x1d9),_0x5e33c2(0x14e),{'processed':_0x146911,'failed':_0x541eed,'errors':_0x40ba4b,'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x146911,'failed':_0x541eed,'errors':_0x40ba4b};}catch(_0x11edc1){const _0x2016ac=_0x5e33c2(0x17f)+(_0x11edc1 instanceof Error?_0x11edc1['message']:_0x5e33c2(0x16f));return console[_0x5e33c2(0x1d1)](_0x5e33c2(0x15d)+_0x2016ac),_0x40ba4b[_0x5e33c2(0x1dd)](_0x2016ac),loggerService_1[_0x5e33c2(0x17b)][_0x5e33c2(0x168)](_0x5e33c2(0x1c4),_0x2016ac,{'timeoutDays':this[_0x5e33c2(0x177)]}),{'processed':_0x146911,'failed':_0x541eed,'errors':_0x40ba4b};}}async['cleanupStalePendingPayments'](){const _0x57c502=a80_0x289c9c,_0x1a31de=[];let _0xf565c8=0x0,_0x5b6890=0x0;try{console[_0x57c502(0x1bc)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0x33d81f=new Date(),_0x42eb46=new Date(_0x33d81f[_0x57c502(0x16a)]()-this[_0x57c502(0x189)]*0x3c*0x3e8),_0x80f62f=new Date();_0x80f62f[_0x57c502(0x1b5)](_0x80f62f[_0x57c502(0x1b9)]()-this[_0x57c502(0x172)]),console[_0x57c502(0x1bc)](_0x57c502(0x18f)+_0x42eb46[_0x57c502(0x1cd)]()),console[_0x57c502(0x1bc)](_0x57c502(0x170)+_0x80f62f['toISOString']()),console['log'](_0x57c502(0x169)+this[_0x57c502(0x181)]['join'](',\x20'));const _0x4db6df=await database_1['default']['payment'][_0x57c502(0x1c3)]({'where':{'status':client_1['PaymentStatus'][_0x57c502(0x18d)],'OR':[{'gateway':{'in':this[_0x57c502(0x181)]},'createdAt':{'lt':_0x42eb46}},{'gateway':{'notIn':this[_0x57c502(0x181)]},'createdAt':{'lt':_0x80f62f}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x57c502(0x1bc)](_0x57c502(0x1cf)+_0x4db6df['length']+'\x20stale\x20PENDING\x20payments');if(_0x4db6df[_0x57c502(0x1a1)]===0x0)return console[_0x57c502(0x1bc)]('‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0xc116e7 of _0x4db6df){try{const _0x2f2fae=this['FAST_TIMEOUT_GATEWAYS'][_0x57c502(0x19e)](_0xc116e7[_0x57c502(0x14b)]),_0x225cd3=_0x2f2fae?_0x57c502(0x14d):'3\x20days',_0x2dde80=Math['floor']((Date[_0x57c502(0x176)]()-_0xc116e7[_0x57c502(0x156)]['getTime']())/(0x3e8*0x3c));console[_0x57c502(0x1bc)](_0x57c502(0x1d2)+_0xc116e7['id']),console['log'](_0x57c502(0x166)+_0xc116e7[_0x57c502(0x14b)]+'\x20('+_0x225cd3+_0x57c502(0x1d3)),console['log'](_0x57c502(0x14a)+_0xc116e7[_0x57c502(0x158)]+'\x20'+_0xc116e7[_0x57c502(0x16d)]),console[_0x57c502(0x1bc)](_0x57c502(0x18c)+_0xc116e7['shop'][_0x57c502(0x1a2)]+'\x20('+_0xc116e7['shop'][_0x57c502(0x1cc)]+')'),console['log'](_0x57c502(0x1af)+_0xc116e7[_0x57c502(0x156)][_0x57c502(0x1cd)]()),console[_0x57c502(0x1bc)](_0x57c502(0x180)+_0x2dde80+'\x20minutes');const _0x58e518=await database_1[_0x57c502(0x190)][_0x57c502(0x1ad)]['update']({'where':{'id':_0xc116e7['id']},'data':{'status':client_1[_0x57c502(0x1a5)][_0x57c502(0x1c2)],'statusChangedBy':_0x57c502(0x1d9),'statusChangedAt':new Date(),'failureMessage':_0x57c502(0x1db)+_0x225cd3}});console[_0x57c502(0x1bc)](_0x57c502(0x1c0)+_0xc116e7['id']+_0x57c502(0x196)),loggerService_1[_0x57c502(0x17b)][_0x57c502(0x164)](_0xc116e7['gateway'],_0xc116e7['id'],_0x57c502(0x18d),_0x57c502(0x1c2),{'reason':_0x57c502(0x1c5),'timeout':_0x225cd3,'ageMinutes':_0x2dde80}),_0xf565c8++;}catch(_0x490a4f){const _0x2c8f35='Failed\x20to\x20update\x20PENDING\x20payment\x20'+_0xc116e7['id']+':\x20'+(_0x490a4f instanceof Error?_0x490a4f[_0x57c502(0x191)]:_0x57c502(0x16f));console[_0x57c502(0x1d1)]('‚ùå\x20'+_0x2c8f35),_0x1a31de[_0x57c502(0x1dd)](_0x2c8f35),_0x5b6890++;}}const _0xdd3fab=_0x57c502(0x171)+_0xf565c8+_0x57c502(0x165)+_0x5b6890+_0x57c502(0x159);return console['log'](_0x57c502(0x1d7)+_0xdd3fab),loggerService_1[_0x57c502(0x17b)][_0x57c502(0x1a0)]('pending_payment_cleanup',_0x57c502(0x1ac),_0x57c502(0x1d9),_0x57c502(0x14e),{'processed':_0xf565c8,'failed':_0x5b6890,'errors':_0x1a31de,'fastTimeoutMinutes':this[_0x57c502(0x189)],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0xf565c8,'failed':_0x5b6890,'errors':_0x1a31de};}catch(_0x4eeb23){const _0x4c8987='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x4eeb23 instanceof Error?_0x4eeb23['message']:_0x57c502(0x16f));return console[_0x57c502(0x1d1)](_0x57c502(0x15d)+_0x4c8987),_0x1a31de[_0x57c502(0x1dd)](_0x4c8987),loggerService_1['loggerService'][_0x57c502(0x168)](_0x57c502(0x195),_0x4c8987,{'timeoutDays':this[_0x57c502(0x1d8)]}),{'processed':_0xf565c8,'failed':_0x5b6890,'errors':_0x1a31de};}}async[a80_0x289c9c(0x1b8)](){const _0x40c2d3=a80_0x289c9c;try{const _0x1fc3d1=new Date(),_0x6d73c3=new Date(_0x1fc3d1[_0x40c2d3(0x16a)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x5357ff=new Date(_0x1fc3d1[_0x40c2d3(0x16a)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x3e65a5=new Date(_0x1fc3d1[_0x40c2d3(0x16a)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x153db1=await database_1[_0x40c2d3(0x190)][_0x40c2d3(0x1ad)][_0x40c2d3(0x1c3)]({'where':{'status':{'in':[client_1[_0x40c2d3(0x1a5)][_0x40c2d3(0x1b0)],client_1['PaymentStatus'][_0x40c2d3(0x18d)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x3f9011={'total':_0x153db1[_0x40c2d3(0x1a1)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x42aad2 of _0x153db1){if(_0x42aad2['createdAt']>_0x6d73c3)_0x3f9011[_0x40c2d3(0x15e)][_0x40c2d3(0x1bf)]++;else{if(_0x42aad2[_0x40c2d3(0x156)]>_0x5357ff)_0x3f9011[_0x40c2d3(0x15e)][_0x40c2d3(0x1d5)]++;else _0x42aad2[_0x40c2d3(0x156)]>_0x3e65a5?_0x3f9011[_0x40c2d3(0x15e)][_0x40c2d3(0x19b)]++:_0x3f9011[_0x40c2d3(0x15e)][_0x40c2d3(0x15c)]++;}!_0x3f9011[_0x40c2d3(0x18a)][_0x42aad2[_0x40c2d3(0x14b)]]&&(_0x3f9011[_0x40c2d3(0x18a)][_0x42aad2['gateway']]=0x0);_0x3f9011[_0x40c2d3(0x18a)][_0x42aad2[_0x40c2d3(0x14b)]]++;const _0x1f0197=_0x42aad2[_0x40c2d3(0x167)];!_0x3f9011[_0x40c2d3(0x1ba)][_0x1f0197]&&(_0x3f9011['byStatus'][_0x1f0197]=0x0),_0x3f9011['byStatus'][_0x1f0197]++;}return _0x3f9011;}catch(_0x2d4c1e){console[_0x40c2d3(0x1d1)](_0x40c2d3(0x19d),_0x2d4c1e);throw new Error(_0x40c2d3(0x151)+(_0x2d4c1e instanceof Error?_0x2d4c1e[_0x40c2d3(0x191)]:_0x40c2d3(0x16f)));}}async[a80_0x289c9c(0x187)](){const _0x594eda=a80_0x289c9c;console['log']('üöÄ\x20Starting\x20payment\x20cleanup\x20service...');const _0x17dc78=await this['getProcessingPaymentsStats']();console[_0x594eda(0x1bc)](_0x594eda(0x17a)),console[_0x594eda(0x1bc)](_0x594eda(0x1a8)+_0x17dc78['total']),console[_0x594eda(0x1bc)](_0x594eda(0x193)+_0x17dc78[_0x594eda(0x15e)][_0x594eda(0x1bf)]),console[_0x594eda(0x1bc)]('\x20\x20\x20Recent\x20(1-3\x20days):\x20'+_0x17dc78['byAge']['recent']),console[_0x594eda(0x1bc)](_0x594eda(0x192)+_0x17dc78[_0x594eda(0x15e)][_0x594eda(0x19b)]),console[_0x594eda(0x1bc)](_0x594eda(0x1c7)+_0x17dc78['byAge']['expired']),console['log'](_0x594eda(0x1c1),_0x17dc78['byGateway']),console[_0x594eda(0x1bc)](_0x594eda(0x1bd),_0x17dc78[_0x594eda(0x1ba)]),console[_0x594eda(0x1bc)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x21be44=await this[_0x594eda(0x1dc)]();console['log'](_0x594eda(0x19a));const _0x43a728=await this['cleanupStalePendingPayments'](),_0x36b4db=await this[_0x594eda(0x1b8)]();console['log'](_0x594eda(0x174)),console['log'](_0x594eda(0x1a8)+_0x36b4db[_0x594eda(0x194)]),console[_0x594eda(0x1bc)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x36b4db[_0x594eda(0x15e)][_0x594eda(0x15c)]),console['log']('\x20\x20\x20By\x20status:',_0x36b4db[_0x594eda(0x1ba)]);const _0x5e28a2=_0x21be44[_0x594eda(0x1c8)]+_0x43a728['processed'],_0x381350=_0x21be44[_0x594eda(0x17d)]+_0x43a728[_0x594eda(0x17d)],_0x2908ad=[..._0x21be44[_0x594eda(0x1aa)],..._0x43a728['errors']];console[_0x594eda(0x1bc)](_0x594eda(0x1ca)),console['log'](_0x594eda(0x15a)+_0x21be44[_0x594eda(0x1c8)]),console[_0x594eda(0x1bc)](_0x594eda(0x186)+_0x43a728['processed']),console['log'](_0x594eda(0x188)+_0x5e28a2),console['log'](_0x594eda(0x14c)+_0x381350),console[_0x594eda(0x1bc)]('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x17dc78[_0x594eda(0x194)]-_0x36b4db[_0x594eda(0x194)])),_0x2908ad[_0x594eda(0x1a1)]>0x0&&(console[_0x594eda(0x1bc)]('\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:'),_0x2908ad['forEach']((_0x5d34b8,_0xd4c733)=>{const _0x33f2d9=_0x594eda;console[_0x33f2d9(0x1bc)](_0x33f2d9(0x163)+(_0xd4c733+0x1)+'.\x20'+_0x5d34b8);})),console[_0x594eda(0x1bc)]('üèÅ\x20Payment\x20cleanup\x20service\x20completed');}async[a80_0x289c9c(0x161)](){const _0x19ab9b=a80_0x289c9c;console['log']('üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...');const _0x16974d=await this['getProcessingPaymentsStats'](),_0x182b11=_0x16974d[_0x19ab9b(0x1ba)]['PROCESSING']||0x0;console['log'](_0x19ab9b(0x1a3)+_0x182b11);const _0x192ee8=await this[_0x19ab9b(0x1dc)](),_0x4b1d4d=await this['getProcessingPaymentsStats'](),_0x7368b2=_0x4b1d4d[_0x19ab9b(0x1ba)][_0x19ab9b(0x1b0)]||0x0;console[_0x19ab9b(0x1bc)](_0x19ab9b(0x162)+_0x7368b2),console[_0x19ab9b(0x1bc)](_0x19ab9b(0x1da)+_0x192ee8[_0x19ab9b(0x1c8)]),console[_0x19ab9b(0x1bc)]('üèÅ\x20PROCESSING\x20cleanup\x20completed');}async['runPendingCleanupOnly'](){const _0x24cdf4=a80_0x289c9c;console['log'](_0x24cdf4(0x1a7));const _0x1cda40=await this[_0x24cdf4(0x1b8)](),_0x5750f0=_0x1cda40[_0x24cdf4(0x1ba)][_0x24cdf4(0x18d)]||0x0;console[_0x24cdf4(0x1bc)]('üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20'+_0x5750f0);const _0x320915=await this[_0x24cdf4(0x1a6)](),_0x407d13=await this[_0x24cdf4(0x1b8)](),_0x1b588=_0x407d13['byStatus'][_0x24cdf4(0x18d)]||0x0;console['log']('üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20'+_0x1b588),console[_0x24cdf4(0x1bc)](_0x24cdf4(0x1cb)+_0x320915[_0x24cdf4(0x1c8)]),console[_0x24cdf4(0x1bc)](_0x24cdf4(0x14f));}async[a80_0x289c9c(0x17e)](){const _0x27121b=a80_0x289c9c,_0x1ebdfa=[];let _0x1223c1=0x0;try{console[_0x27121b(0x1bc)]('‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x3f22a8=new Date(),_0x5d2906=[_0x27121b(0x1b2),_0x27121b(0x1d4)],_0x2ed606=[_0x27121b(0x15f),_0x27121b(0x1d6),_0x27121b(0x1ae),_0x27121b(0x1b3)],_0x1629fc=await database_1[_0x27121b(0x190)]['paymentLink'][_0x27121b(0x1c3)]({'where':{'type':_0x27121b(0x197),'status':_0x27121b(0x150)},'include':{'payments':{'orderBy':{'createdAt':_0x27121b(0x183)},'take':0x1}}});console[_0x27121b(0x1bc)](_0x27121b(0x1cf)+_0x1629fc[_0x27121b(0x1a1)]+_0x27121b(0x16e));for(const _0x15610b of _0x1629fc){try{if(_0x15610b[_0x27121b(0x1b7)][_0x27121b(0x1a1)]===0x0)continue;const _0x578d16=_0x15610b[_0x27121b(0x1b7)][0x0];if(_0x578d16['status']==='PAID')continue;const _0x8a2155=_0x3f22a8[_0x27121b(0x16a)]()-_0x578d16[_0x27121b(0x156)]['getTime']();let _0x1cd4cc;_0x5d2906[_0x27121b(0x19e)](_0x15610b[_0x27121b(0x14b)])||_0x2ed606[_0x27121b(0x19e)](_0x15610b[_0x27121b(0x14b)])?_0x1cd4cc=0x1e*0x3c*0x3e8:_0x1cd4cc=0x3*0x18*0x3c*0x3c*0x3e8,_0x8a2155>_0x1cd4cc&&(await database_1[_0x27121b(0x190)][_0x27121b(0x199)][_0x27121b(0x152)]({'where':{'id':_0x15610b['id']},'data':{'status':_0x27121b(0x1c2)}}),console[_0x27121b(0x1bc)](_0x27121b(0x154)+_0x15610b['id']+_0x27121b(0x1c9)+_0x15610b[_0x27121b(0x14b)]+_0x27121b(0x184)+Math['round'](_0x8a2155/0x3e8/0x3c)+'\x20minutes)'),_0x1223c1++);}catch(_0x255a38){const _0x32aec0=_0x27121b(0x16c)+_0x15610b['id']+':\x20'+(_0x255a38 instanceof Error?_0x255a38[_0x27121b(0x191)]:_0x27121b(0x16f));console[_0x27121b(0x1d1)]('‚ùå\x20'+_0x32aec0),_0x1ebdfa[_0x27121b(0x1dd)](_0x32aec0);}}return console[_0x27121b(0x1bc)](_0x27121b(0x175)+_0x1223c1+_0x27121b(0x1b4)),{'expired':_0x1223c1,'errors':_0x1ebdfa};}catch(_0x8ed58a){const _0x476dca='Link\x20expiration\x20service\x20error:\x20'+(_0x8ed58a instanceof Error?_0x8ed58a[_0x27121b(0x191)]:_0x27121b(0x16f));return console['error'](_0x27121b(0x15d)+_0x476dca),_0x1ebdfa[_0x27121b(0x1dd)](_0x476dca),{'expired':_0x1223c1,'errors':_0x1ebdfa};}}}exports['PaymentCleanupService']=PaymentCleanupService,exports['paymentCleanupService']=new PaymentCleanupService();