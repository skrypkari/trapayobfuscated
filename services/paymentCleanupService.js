'use strict';const a80_0x381869=a80_0x5860;(function(_0x1c80df,_0x4a2399){const _0x420d2a=a80_0x5860,_0x34a8f4=_0x1c80df();while(!![]){try{const _0x42e6f4=-parseInt(_0x420d2a(0x171))/0x1+-parseInt(_0x420d2a(0x163))/0x2+parseInt(_0x420d2a(0x19e))/0x3+-parseInt(_0x420d2a(0x1ca))/0x4*(parseInt(_0x420d2a(0x17d))/0x5)+-parseInt(_0x420d2a(0x1e2))/0x6*(-parseInt(_0x420d2a(0x1d8))/0x7)+-parseInt(_0x420d2a(0x1e1))/0x8+-parseInt(_0x420d2a(0x1f3))/0x9*(-parseInt(_0x420d2a(0x1cf))/0xa);if(_0x42e6f4===_0x4a2399)break;else _0x34a8f4['push'](_0x34a8f4['shift']());}catch(_0x26e4d6){_0x34a8f4['push'](_0x34a8f4['shift']());}}}(a80_0x5eb8,0xdf376));function a80_0x5eb8(){const _0x2395b4=['\x20payments\x20updated\x20to\x20EXPIRED,\x20','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','3527314fhLcpc','stale','length','\x20payments\x20updated\x20to\x20FAILED,\x20','byGateway','plisio','getTime','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','floor','49880zdXMFE','18EHZcZL','processed','expireSinglePaymentLinks','expired','\x20\x20\x20\x20\x20\x20','join','default','payment_cleanup','PROCESSING','üèÅ\x20Payment\x20cleanup\x20service\x20completed','\x20\x20\x20Total:\x20','\x20\x20\x20Stale\x20(3-5\x20days):\x20','recent','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','../config/database','log','FAILED','2542329OzNGOS','payment','payments','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','\x20days','__importDefault','2713806UlvPxX','Failed\x20to\x20get\x20processing\x20payments\x20stats:','runProcessingCleanupOnly','byStatus','errors','PENDING\x20cleanup\x20completed:\x20','logWebhookError','name','\x20\x20\x20By\x20status:','error','üîç\x20Found\x20','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','üí•\x20','\x20\x20\x20Age:\x20','1667248DCaoAD','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','runCleanupWithReport','üèÅ\x20PENDING\x20cleanup\x20completed','admin','FAST_TIMEOUT_MINUTES','\x20\x20\x20Gateway:\x20','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','\x20stale\x20PENDING\x20payments','\x20\x20\x20Shop:\x20','@prisma/client','üìä\x20','1121335LTroip','30\x20minutes','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','\x20from\x20PENDING\x20to\x20EXPIRED','__esModule','üìä\x20Expiration\x20completed:\x20','findMany','now','total','PENDING_TIMEOUT_DAYS','message',',\x20payment\x20age:\x20','includes','squirrel-pay','Failed\x20to\x20expire\x20link\x20','logApiCall','system','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','runPendingCleanupOnly','cleanupStalePendingPayments','\x20timeout)','PROCESSING_TIMEOUT_DAYS','SLOW_TIMEOUT_DAYS','byAge','auto_timeout_pending','Unknown\x20error','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','status','\x20links\x20expired','FAST_TIMEOUT_GATEWAYS','failed','\x20\x20\x20By\x20gateway:','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','3708741wGvVKB','oxapay','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','PENDING','ACTIVE','visa/mastercard','amount','loggerService','üìã\x20Fast\x20timeout\x20gateways:\x20','Failed\x20to\x20update\x20payment\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','Cleanup\x20service\x20error:\x20','rapyd','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','round','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','gateway','squirrelpay','getProcessingPaymentsStats','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','toISOString','./loggerService','auto_timeout','\x20from\x20PROCESSING\x20to\x20FAILED','\x20failed\x20to\x20update','EXPIRED','username','\x20\x20\x20Created:\x20','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','\x0aüìà\x20Cleanup\x20Summary:','\x20minutes)','paymentCleanupService','push','getDate','setDate','‚úÖ\x20Updated\x20payment\x20','createdAt','\x20\x20\x20Amount:\x20','paymentLink','update','Link\x20expiration\x20service\x20error:\x20','3\x20days','Cleanup\x20completed:\x20','PaymentCleanupService','24IyvzPr','pending_payment_cleanup','currency','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','90btOuki','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','shop','SINGLE','PaymentStatus','cleanupStaleProcessingPayments','PAID'];a80_0x5eb8=function(){return _0x2395b4;};return a80_0x5eb8();}var __importDefault=this&&this[a80_0x381869(0x1f8)]||function(_0x29271a){return _0x29271a&&_0x29271a['__esModule']?_0x29271a:{'default':_0x29271a};};Object['defineProperty'](exports,a80_0x381869(0x181),{'value':!![]}),exports[a80_0x381869(0x1bd)]=exports[a80_0x381869(0x1c9)]=void 0x0;const database_1=__importDefault(require(a80_0x381869(0x1f0))),client_1=require(a80_0x381869(0x17b)),loggerService_1=require(a80_0x381869(0x1b3));class PaymentCleanupService{constructor(){const _0x16f41e=a80_0x381869;this[_0x16f41e(0x192)]=0x5,this[_0x16f41e(0x186)]=0x5,this[_0x16f41e(0x176)]=0x1e,this[_0x16f41e(0x193)]=0x3,this[_0x16f41e(0x19a)]=[_0x16f41e(0x1af),_0x16f41e(0x18a),_0x16f41e(0x1aa),'visa/mastercard','plisio',_0x16f41e(0x19f)];}async[a80_0x381869(0x1d4)](){const _0xf43e0b=a80_0x381869,_0xe8dfb1=[];let _0x1c7bec=0x0,_0x19d85b=0x0;try{console[_0xf43e0b(0x1f1)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x4bfe6d=new Date();_0x4bfe6d['setDate'](_0x4bfe6d['getDate']()-this[_0xf43e0b(0x192)]),console['log']('üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20'+_0x4bfe6d[_0xf43e0b(0x1b2)]());const _0x2f5a84=await database_1[_0xf43e0b(0x1e8)][_0xf43e0b(0x1f4)][_0xf43e0b(0x183)]({'where':{'status':client_1[_0xf43e0b(0x1d3)]['PROCESSING'],'createdAt':{'lt':_0x4bfe6d}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0xf43e0b(0x1f1)]('üîç\x20Found\x20'+_0x2f5a84[_0xf43e0b(0x1da)]+'\x20stale\x20PROCESSING\x20payments');if(_0x2f5a84[_0xf43e0b(0x1da)]===0x0)return console[_0xf43e0b(0x1f1)]('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2fff2e of _0x2f5a84){try{console['log'](_0xf43e0b(0x1b1)+_0x2fff2e['id']+'\x20('+_0x2fff2e[_0xf43e0b(0x1ae)]+',\x20'+_0x2fff2e['amount']+'\x20'+_0x2fff2e[_0xf43e0b(0x1cc)]+')'),console[_0xf43e0b(0x1f1)](_0xf43e0b(0x17a)+_0x2fff2e['shop'][_0xf43e0b(0x16a)]+'\x20('+_0x2fff2e[_0xf43e0b(0x1d1)][_0xf43e0b(0x1b8)]+')'),console['log'](_0xf43e0b(0x1b9)+_0x2fff2e['createdAt'][_0xf43e0b(0x1b2)]()),console[_0xf43e0b(0x1f1)](_0xf43e0b(0x170)+Math['floor']((Date[_0xf43e0b(0x184)]()-_0x2fff2e[_0xf43e0b(0x1c2)][_0xf43e0b(0x1de)]())/(0x3e8*0x3c*0x3c*0x18))+_0xf43e0b(0x1f7));const _0x5a57bd=await database_1[_0xf43e0b(0x1e8)][_0xf43e0b(0x1f4)][_0xf43e0b(0x1c5)]({'where':{'id':_0x2fff2e['id']},'data':{'status':client_1[_0xf43e0b(0x1d3)][_0xf43e0b(0x1f2)],'statusChangedBy':'system','statusChangedAt':new Date(),'failureMessage':_0xf43e0b(0x178)+this['PROCESSING_TIMEOUT_DAYS']+'\x20days'}});console[_0xf43e0b(0x1f1)](_0xf43e0b(0x1c1)+_0x2fff2e['id']+_0xf43e0b(0x1b5)),loggerService_1[_0xf43e0b(0x1a5)]['logWebhookProcessed'](_0x2fff2e[_0xf43e0b(0x1ae)],_0x2fff2e['id'],_0xf43e0b(0x1ea),_0xf43e0b(0x1f2),{'reason':_0xf43e0b(0x1b4),'timeoutDays':this[_0xf43e0b(0x192)]}),_0x1c7bec++;}catch(_0x1e60ea){const _0x48488b=_0xf43e0b(0x1a7)+_0x2fff2e['id']+':\x20'+(_0x1e60ea instanceof Error?_0x1e60ea[_0xf43e0b(0x187)]:_0xf43e0b(0x196));console[_0xf43e0b(0x16c)]('‚ùå\x20'+_0x48488b),_0xe8dfb1[_0xf43e0b(0x1be)](_0x48488b),_0x19d85b++;}}const _0x20bb63=_0xf43e0b(0x1c8)+_0x1c7bec+_0xf43e0b(0x1db)+_0x19d85b+'\x20failed\x20to\x20update';return console[_0xf43e0b(0x1f1)](_0xf43e0b(0x17c)+_0x20bb63),loggerService_1[_0xf43e0b(0x1a5)][_0xf43e0b(0x18c)](_0xf43e0b(0x1e9),'POST',_0xf43e0b(0x18d),'admin',{'processed':_0x1c7bec,'failed':_0x19d85b,'errors':_0xe8dfb1,'timeoutDays':this[_0xf43e0b(0x192)]}),{'processed':_0x1c7bec,'failed':_0x19d85b,'errors':_0xe8dfb1};}catch(_0x17cfe5){const _0x5aa889=_0xf43e0b(0x1a9)+(_0x17cfe5 instanceof Error?_0x17cfe5[_0xf43e0b(0x187)]:_0xf43e0b(0x196));return console[_0xf43e0b(0x16c)](_0xf43e0b(0x16f)+_0x5aa889),_0xe8dfb1['push'](_0x5aa889),loggerService_1[_0xf43e0b(0x1a5)]['logWebhookError'](_0xf43e0b(0x1e9),_0x5aa889,{'timeoutDays':this[_0xf43e0b(0x192)]}),{'processed':_0x1c7bec,'failed':_0x19d85b,'errors':_0xe8dfb1};}}async['cleanupStalePendingPayments'](){const _0x44c6a9=a80_0x381869,_0x481bae=[];let _0x3ec65b=0x0,_0x281267=0x0;try{console[_0x44c6a9(0x1f1)](_0x44c6a9(0x17f));const _0x13f6f0=new Date(),_0x31b8a7=new Date(_0x13f6f0[_0x44c6a9(0x1de)]()-this[_0x44c6a9(0x176)]*0x3c*0x3e8),_0x35816c=new Date();_0x35816c[_0x44c6a9(0x1c0)](_0x35816c[_0x44c6a9(0x1bf)]()-this[_0x44c6a9(0x193)]),console[_0x44c6a9(0x1f1)]('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x31b8a7[_0x44c6a9(0x1b2)]()),console['log'](_0x44c6a9(0x1a0)+_0x35816c['toISOString']()),console[_0x44c6a9(0x1f1)](_0x44c6a9(0x1a6)+this[_0x44c6a9(0x19a)][_0x44c6a9(0x1e7)](',\x20'));const _0x18c667=await database_1[_0x44c6a9(0x1e8)][_0x44c6a9(0x1f4)][_0x44c6a9(0x183)]({'where':{'status':client_1[_0x44c6a9(0x1d3)][_0x44c6a9(0x1a1)],'OR':[{'gateway':{'in':this[_0x44c6a9(0x19a)]},'createdAt':{'lt':_0x31b8a7}},{'gateway':{'notIn':this[_0x44c6a9(0x19a)]},'createdAt':{'lt':_0x35816c}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log'](_0x44c6a9(0x16d)+_0x18c667[_0x44c6a9(0x1da)]+_0x44c6a9(0x179));if(_0x18c667['length']===0x0)return console[_0x44c6a9(0x1f1)]('‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x21c888 of _0x18c667){try{const _0x8c06cc=this['FAST_TIMEOUT_GATEWAYS'][_0x44c6a9(0x189)](_0x21c888['gateway']),_0x54bd74=_0x8c06cc?_0x44c6a9(0x17e):_0x44c6a9(0x1c7),_0x4ddad7=Math[_0x44c6a9(0x1e0)]((Date[_0x44c6a9(0x184)]()-_0x21c888[_0x44c6a9(0x1c2)]['getTime']())/(0x3e8*0x3c));console[_0x44c6a9(0x1f1)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x21c888['id']),console['log'](_0x44c6a9(0x177)+_0x21c888[_0x44c6a9(0x1ae)]+'\x20('+_0x54bd74+_0x44c6a9(0x191)),console['log'](_0x44c6a9(0x1c3)+_0x21c888[_0x44c6a9(0x1a4)]+'\x20'+_0x21c888['currency']),console['log'](_0x44c6a9(0x17a)+_0x21c888[_0x44c6a9(0x1d1)][_0x44c6a9(0x16a)]+'\x20('+_0x21c888[_0x44c6a9(0x1d1)][_0x44c6a9(0x1b8)]+')'),console[_0x44c6a9(0x1f1)](_0x44c6a9(0x1b9)+_0x21c888[_0x44c6a9(0x1c2)][_0x44c6a9(0x1b2)]()),console['log'](_0x44c6a9(0x170)+_0x4ddad7+'\x20minutes');const _0x22b079=await database_1[_0x44c6a9(0x1e8)]['payment'][_0x44c6a9(0x1c5)]({'where':{'id':_0x21c888['id']},'data':{'status':client_1[_0x44c6a9(0x1d3)][_0x44c6a9(0x1b7)],'statusChangedBy':_0x44c6a9(0x18d),'statusChangedAt':new Date(),'failureMessage':_0x44c6a9(0x1ba)+_0x54bd74}});console[_0x44c6a9(0x1f1)]('‚úÖ\x20Updated\x20payment\x20'+_0x21c888['id']+_0x44c6a9(0x180)),loggerService_1[_0x44c6a9(0x1a5)]['logWebhookProcessed'](_0x21c888['gateway'],_0x21c888['id'],_0x44c6a9(0x1a1),_0x44c6a9(0x1b7),{'reason':_0x44c6a9(0x195),'timeout':_0x54bd74,'ageMinutes':_0x4ddad7}),_0x3ec65b++;}catch(_0x14deaa){const _0xc63e19='Failed\x20to\x20update\x20PENDING\x20payment\x20'+_0x21c888['id']+':\x20'+(_0x14deaa instanceof Error?_0x14deaa[_0x44c6a9(0x187)]:_0x44c6a9(0x196));console[_0x44c6a9(0x16c)]('‚ùå\x20'+_0xc63e19),_0x481bae[_0x44c6a9(0x1be)](_0xc63e19),_0x281267++;}}const _0x435fec=_0x44c6a9(0x168)+_0x3ec65b+_0x44c6a9(0x1d6)+_0x281267+_0x44c6a9(0x1b6);return console[_0x44c6a9(0x1f1)](_0x44c6a9(0x17c)+_0x435fec),loggerService_1[_0x44c6a9(0x1a5)][_0x44c6a9(0x18c)](_0x44c6a9(0x1cb),'POST',_0x44c6a9(0x18d),_0x44c6a9(0x175),{'processed':_0x3ec65b,'failed':_0x281267,'errors':_0x481bae,'fastTimeoutMinutes':this[_0x44c6a9(0x176)],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0x3ec65b,'failed':_0x281267,'errors':_0x481bae};}catch(_0x12d29a){const _0x2560ea='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x12d29a instanceof Error?_0x12d29a[_0x44c6a9(0x187)]:_0x44c6a9(0x196));return console[_0x44c6a9(0x16c)]('üí•\x20'+_0x2560ea),_0x481bae[_0x44c6a9(0x1be)](_0x2560ea),loggerService_1['loggerService'][_0x44c6a9(0x169)](_0x44c6a9(0x1cb),_0x2560ea,{'timeoutDays':this[_0x44c6a9(0x186)]}),{'processed':_0x3ec65b,'failed':_0x281267,'errors':_0x481bae};}}async[a80_0x381869(0x1b0)](){const _0x191929=a80_0x381869;try{const _0x4af88e=new Date(),_0x381b4d=new Date(_0x4af88e[_0x191929(0x1de)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x1fae8a=new Date(_0x4af88e['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x99cc8c=new Date(_0x4af88e[_0x191929(0x1de)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x7dd8e3=await database_1['default']['payment'][_0x191929(0x183)]({'where':{'status':{'in':[client_1[_0x191929(0x1d3)][_0x191929(0x1ea)],client_1[_0x191929(0x1d3)]['PENDING']]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x59669d={'total':_0x7dd8e3['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x23462a of _0x7dd8e3){if(_0x23462a[_0x191929(0x1c2)]>_0x381b4d)_0x59669d[_0x191929(0x194)]['fresh']++;else{if(_0x23462a[_0x191929(0x1c2)]>_0x1fae8a)_0x59669d[_0x191929(0x194)][_0x191929(0x1ee)]++;else _0x23462a[_0x191929(0x1c2)]>_0x99cc8c?_0x59669d[_0x191929(0x194)][_0x191929(0x1d9)]++:_0x59669d[_0x191929(0x194)]['expired']++;}!_0x59669d[_0x191929(0x1dc)][_0x23462a[_0x191929(0x1ae)]]&&(_0x59669d[_0x191929(0x1dc)][_0x23462a[_0x191929(0x1ae)]]=0x0);_0x59669d[_0x191929(0x1dc)][_0x23462a[_0x191929(0x1ae)]]++;const _0x177475=_0x23462a[_0x191929(0x198)];!_0x59669d[_0x191929(0x166)][_0x177475]&&(_0x59669d[_0x191929(0x166)][_0x177475]=0x0),_0x59669d['byStatus'][_0x177475]++;}return _0x59669d;}catch(_0x199b7b){console[_0x191929(0x16c)](_0x191929(0x164),_0x199b7b);throw new Error(_0x191929(0x1ab)+(_0x199b7b instanceof Error?_0x199b7b[_0x191929(0x187)]:_0x191929(0x196)));}}async[a80_0x381869(0x173)](){const _0x5682b1=a80_0x381869;console[_0x5682b1(0x1f1)]('üöÄ\x20Starting\x20payment\x20cleanup\x20service...');const _0x273ef3=await this['getProcessingPaymentsStats']();console['log']('üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:'),console[_0x5682b1(0x1f1)](_0x5682b1(0x1ec)+_0x273ef3[_0x5682b1(0x185)]),console[_0x5682b1(0x1f1)](_0x5682b1(0x1ef)+_0x273ef3[_0x5682b1(0x194)]['fresh']),console['log']('\x20\x20\x20Recent\x20(1-3\x20days):\x20'+_0x273ef3['byAge'][_0x5682b1(0x1ee)]),console[_0x5682b1(0x1f1)](_0x5682b1(0x1ed)+_0x273ef3[_0x5682b1(0x194)][_0x5682b1(0x1d9)]),console[_0x5682b1(0x1f1)](_0x5682b1(0x1ad)+_0x273ef3[_0x5682b1(0x194)][_0x5682b1(0x1e5)]),console[_0x5682b1(0x1f1)](_0x5682b1(0x19c),_0x273ef3[_0x5682b1(0x1dc)]),console[_0x5682b1(0x1f1)](_0x5682b1(0x16b),_0x273ef3['byStatus']),console[_0x5682b1(0x1f1)](_0x5682b1(0x1d0));const _0x55199e=await this[_0x5682b1(0x1d4)]();console['log'](_0x5682b1(0x1cd));const _0x432471=await this[_0x5682b1(0x190)](),_0x4f4cfb=await this[_0x5682b1(0x1b0)]();console['log'](_0x5682b1(0x18e)),console['log']('\x20\x20\x20Total:\x20'+_0x4f4cfb['total']),console[_0x5682b1(0x1f1)](_0x5682b1(0x1ad)+_0x4f4cfb[_0x5682b1(0x194)][_0x5682b1(0x1e5)]),console['log']('\x20\x20\x20By\x20status:',_0x4f4cfb[_0x5682b1(0x166)]);const _0x52baf8=_0x55199e[_0x5682b1(0x1e3)]+_0x432471[_0x5682b1(0x1e3)],_0x14b4f4=_0x55199e[_0x5682b1(0x19b)]+_0x432471[_0x5682b1(0x19b)],_0x30dc2d=[..._0x55199e[_0x5682b1(0x167)],..._0x432471[_0x5682b1(0x167)]];console['log'](_0x5682b1(0x1bb)),console[_0x5682b1(0x1f1)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x55199e['processed']),console[_0x5682b1(0x1f1)]('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x432471['processed']),console[_0x5682b1(0x1f1)]('\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20'+_0x52baf8),console[_0x5682b1(0x1f1)]('\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20'+_0x14b4f4),console[_0x5682b1(0x1f1)](_0x5682b1(0x197)+(_0x273ef3[_0x5682b1(0x185)]-_0x4f4cfb[_0x5682b1(0x185)])),_0x30dc2d[_0x5682b1(0x1da)]>0x0&&(console[_0x5682b1(0x1f1)](_0x5682b1(0x1ce)),_0x30dc2d['forEach']((_0x4a617d,_0x14dbc0)=>{const _0x3ddf66=_0x5682b1;console[_0x3ddf66(0x1f1)](_0x3ddf66(0x1e6)+(_0x14dbc0+0x1)+'.\x20'+_0x4a617d);})),console['log'](_0x5682b1(0x1eb));}async[a80_0x381869(0x165)](){const _0xb72368=a80_0x381869;console[_0xb72368(0x1f1)](_0xb72368(0x1f6));const _0x49684c=await this['getProcessingPaymentsStats'](),_0x1613f5=_0x49684c[_0xb72368(0x166)][_0xb72368(0x1ea)]||0x0;console[_0xb72368(0x1f1)]('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x1613f5);const _0x327fc5=await this['cleanupStaleProcessingPayments'](),_0x3f2fa5=await this[_0xb72368(0x1b0)](),_0xb06fdc=_0x3f2fa5[_0xb72368(0x166)]['PROCESSING']||0x0;console[_0xb72368(0x1f1)](_0xb72368(0x16e)+_0xb06fdc),console[_0xb72368(0x1f1)](_0xb72368(0x172)+_0x327fc5['processed']),console['log']('üèÅ\x20PROCESSING\x20cleanup\x20completed');}async[a80_0x381869(0x18f)](){const _0x5b3a4b=a80_0x381869;console[_0x5b3a4b(0x1f1)](_0x5b3a4b(0x1df));const _0x2656bc=await this[_0x5b3a4b(0x1b0)](),_0x2c2b18=_0x2656bc['byStatus'][_0x5b3a4b(0x1a1)]||0x0;console['log'](_0x5b3a4b(0x1d7)+_0x2c2b18);const _0x17c25e=await this[_0x5b3a4b(0x190)](),_0x63aea=await this['getProcessingPaymentsStats'](),_0x4ffb9e=_0x63aea[_0x5b3a4b(0x166)][_0x5b3a4b(0x1a1)]||0x0;console[_0x5b3a4b(0x1f1)](_0x5b3a4b(0x19d)+_0x4ffb9e),console['log']('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x17c25e[_0x5b3a4b(0x1e3)]),console[_0x5b3a4b(0x1f1)](_0x5b3a4b(0x174));}async[a80_0x381869(0x1e4)](){const _0x171e48=a80_0x381869,_0x59045c=[];let _0x212c1e=0x0;try{console[_0x171e48(0x1f1)](_0x171e48(0x1a8));const _0x431ed3=new Date(),_0x18310b=[_0x171e48(0x19f),_0x171e48(0x1dd)],_0xcf27cf=[_0x171e48(0x1af),_0x171e48(0x1aa),_0x171e48(0x1a3),'mastercard'],_0x5ee886=await database_1['default'][_0x171e48(0x1c4)][_0x171e48(0x183)]({'where':{'type':_0x171e48(0x1d2),'status':_0x171e48(0x1a2)},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x171e48(0x1f1)](_0x171e48(0x16d)+_0x5ee886[_0x171e48(0x1da)]+'\x20active\x20SINGLE\x20links\x20to\x20check');for(const _0x2290f0 of _0x5ee886){try{if(_0x2290f0[_0x171e48(0x1f5)][_0x171e48(0x1da)]===0x0)continue;const _0x4551b8=_0x2290f0[_0x171e48(0x1f5)][0x0];if(_0x4551b8['status']===_0x171e48(0x1d5))continue;const _0x54c0c6=_0x431ed3[_0x171e48(0x1de)]()-_0x4551b8['createdAt'][_0x171e48(0x1de)]();let _0x14c6e3;_0x18310b['includes'](_0x2290f0[_0x171e48(0x1ae)])||_0xcf27cf['includes'](_0x2290f0[_0x171e48(0x1ae)])?_0x14c6e3=0x1e*0x3c*0x3e8:_0x14c6e3=0x3*0x18*0x3c*0x3c*0x3e8,_0x54c0c6>_0x14c6e3&&(await database_1['default'][_0x171e48(0x1c4)][_0x171e48(0x1c5)]({'where':{'id':_0x2290f0['id']},'data':{'status':_0x171e48(0x1b7)}}),console[_0x171e48(0x1f1)]('‚è∞\x20Expired\x20link\x20'+_0x2290f0['id']+'\x20(gateway:\x20'+_0x2290f0[_0x171e48(0x1ae)]+_0x171e48(0x188)+Math[_0x171e48(0x1ac)](_0x54c0c6/0x3e8/0x3c)+_0x171e48(0x1bc)),_0x212c1e++);}catch(_0x3c287e){const _0x5ab500=_0x171e48(0x18b)+_0x2290f0['id']+':\x20'+(_0x3c287e instanceof Error?_0x3c287e[_0x171e48(0x187)]:_0x171e48(0x196));console['error']('‚ùå\x20'+_0x5ab500),_0x59045c[_0x171e48(0x1be)](_0x5ab500);}}return console[_0x171e48(0x1f1)](_0x171e48(0x182)+_0x212c1e+_0x171e48(0x199)),{'expired':_0x212c1e,'errors':_0x59045c};}catch(_0x5c8fa6){const _0x14291d=_0x171e48(0x1c6)+(_0x5c8fa6 instanceof Error?_0x5c8fa6[_0x171e48(0x187)]:'Unknown\x20error');return console[_0x171e48(0x16c)](_0x171e48(0x16f)+_0x14291d),_0x59045c[_0x171e48(0x1be)](_0x14291d),{'expired':_0x212c1e,'errors':_0x59045c};}}}function a80_0x5860(_0x5ab7c4,_0x4c891f){_0x5ab7c4=_0x5ab7c4-0x163;const _0x5eb851=a80_0x5eb8();let _0x58600e=_0x5eb851[_0x5ab7c4];return _0x58600e;}exports[a80_0x381869(0x1c9)]=PaymentCleanupService,exports[a80_0x381869(0x1bd)]=new PaymentCleanupService();