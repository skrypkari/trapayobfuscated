'use strict';function a80_0x2cfa(_0x1477f7,_0x107a8c){_0x1477f7=_0x1477f7-0xc9;const _0x4f074e=a80_0x4f07();let _0x2cfa8b=_0x4f074e[_0x1477f7];return _0x2cfa8b;}const a80_0x432164=a80_0x2cfa;(function(_0x3778a1,_0x351fa8){const _0x597d3a=a80_0x2cfa,_0x3cfd31=_0x3778a1();while(!![]){try{const _0x3b56d6=-parseInt(_0x597d3a(0xd9))/0x1*(parseInt(_0x597d3a(0x168))/0x2)+-parseInt(_0x597d3a(0xca))/0x3*(-parseInt(_0x597d3a(0x14b))/0x4)+parseInt(_0x597d3a(0x115))/0x5+-parseInt(_0x597d3a(0x106))/0x6+-parseInt(_0x597d3a(0x167))/0x7+-parseInt(_0x597d3a(0xf0))/0x8+-parseInt(_0x597d3a(0x11d))/0x9*(-parseInt(_0x597d3a(0x135))/0xa);if(_0x3b56d6===_0x351fa8)break;else _0x3cfd31['push'](_0x3cfd31['shift']());}catch(_0x80478a){_0x3cfd31['push'](_0x3cfd31['shift']());}}}(a80_0x4f07,0xed513));function a80_0x4f07(){const _0x2bc40c=['runCleanupWithReport','now','setDate','shop','\x20\x20\x20Amount:\x20','getTime','üèÅ\x20PROCESSING\x20cleanup\x20completed','\x20days','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','byAge','FAILED','10CLmJoE','\x20failed\x20to\x20update','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','PENDING','PENDING_TIMEOUT_DAYS','system','createdAt','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','PaymentStatus','Unknown\x20error','‚úÖ\x20Updated\x20payment\x20','username','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','\x0aüìà\x20Cleanup\x20Summary:','cleanupStalePendingPayments','\x20stale\x20PROCESSING\x20payments','3\x20days','__importDefault','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','plisio','SLOW_TIMEOUT_DAYS','desc','4LrexGJ','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','PROCESSING','PENDING\x20cleanup\x20service\x20error:\x20','includes','PAID','\x20minutes)','payment_cleanup','üèÅ\x20Payment\x20cleanup\x20service\x20completed','POST','push','getProcessingPaymentsStats','failed','Link\x20expiration\x20service\x20error:\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','Failed\x20to\x20expire\x20link\x20','üîç\x20Found\x20','processed','EXPIRED','currency','FAST_TIMEOUT_MINUTES','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','expireSinglePaymentLinks','payment','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','\x20stale\x20PENDING\x20payments','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','logApiCall','12704853tinFRt','4694wKzNaZ','\x20\x20\x20By\x20gateway:','3333945BKHXud','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','\x20timeout)','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','length','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','\x20minutes','__esModule','\x20\x20\x20Gateway:\x20','paymentLink','Failed\x20to\x20get\x20processing\x20payments\x20stats:','floor','total','error','loggerService','53DXrVbl','fresh','\x20\x20\x20Age:\x20','log','\x20from\x20PENDING\x20to\x20EXPIRED','stale','amount','update','../config/database','errors','Cleanup\x20service\x20error:\x20','getDate','\x20(gateway:\x20','\x20\x20\x20Created:\x20','toISOString','payments','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','auto_timeout_pending','FAST_TIMEOUT_GATEWAYS','squirrelpay','cleanupStaleProcessingPayments','findMany','7389464hDDyVe','status','gateway','join','logWebhookProcessed','Failed\x20to\x20update\x20payment\x20','defineProperty','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','byGateway','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','expired','\x20\x20\x20Recent\x20(1-3\x20days):\x20','byStatus','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','runPendingCleanupOnly','logWebhookError','30\x20minutes','\x20from\x20PROCESSING\x20to\x20FAILED','name','\x20\x20\x20Shop:\x20','squirrel-pay','8724222SYcfqE','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','pending_payment_cleanup','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','üí•\x20','‚è∞\x20Expired\x20link\x20','default','PROCESSING_TIMEOUT_DAYS','\x20active\x20SINGLE\x20links\x20to\x20check','\x20\x20\x20Total:\x20','runProcessingCleanupOnly','\x20\x20\x20By\x20status:','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','1267785pKiUlw','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','visa/mastercard','\x20\x20\x20Stale\x20(3-5\x20days):\x20','\x20payments\x20updated\x20to\x20EXPIRED,\x20','PaymentCleanupService','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','35318421KDRuyF','üìä\x20Expiration\x20completed:\x20','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','admin',',\x20payment\x20age:\x20','Cleanup\x20completed:\x20','message','‚úÖ\x20PENDING\x20payments\x20processed:\x20','rapyd','recent','./loggerService','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'];a80_0x4f07=function(){return _0x2bc40c;};return a80_0x4f07();}var __importDefault=this&&this[a80_0x432164(0x146)]||function(_0x1cd50d){return _0x1cd50d&&_0x1cd50d['__esModule']?_0x1cd50d:{'default':_0x1cd50d};};Object[a80_0x432164(0xf6)](exports,a80_0x432164(0xd1),{'value':!![]}),exports['paymentCleanupService']=exports[a80_0x432164(0x11a)]=void 0x0;const database_1=__importDefault(require(a80_0x432164(0xe1))),client_1=require('@prisma/client'),loggerService_1=require(a80_0x432164(0x127));class PaymentCleanupService{constructor(){const _0x27c75b=a80_0x432164;this['PROCESSING_TIMEOUT_DAYS']=0x5,this[_0x27c75b(0x139)]=0x5,this[_0x27c75b(0x15f)]=0x1e,this[_0x27c75b(0x149)]=0x3,this[_0x27c75b(0xec)]=[_0x27c75b(0xed),_0x27c75b(0x105),_0x27c75b(0x125),_0x27c75b(0x117),_0x27c75b(0x148),'oxapay'];}async[a80_0x432164(0xee)](){const _0x52d472=a80_0x432164,_0x3d656a=[];let _0x67418=0x0,_0xb86e61=0x0;try{console[_0x52d472(0xdc)](_0x52d472(0x113));const _0x560961=new Date();_0x560961[_0x52d472(0x12b)](_0x560961[_0x52d472(0xe4)]()-this[_0x52d472(0x10d)]),console[_0x52d472(0xdc)](_0x52d472(0xf7)+_0x560961['toISOString']());const _0x19f7a8=await database_1['default'][_0x52d472(0x162)][_0x52d472(0xef)]({'where':{'status':client_1[_0x52d472(0x13d)]['PROCESSING'],'createdAt':{'lt':_0x560961}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x52d472(0xdc)](_0x52d472(0x15b)+_0x19f7a8[_0x52d472(0xce)]+_0x52d472(0x144));if(_0x19f7a8[_0x52d472(0xce)]===0x0)return console[_0x52d472(0xdc)]('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x1759c3 of _0x19f7a8){try{console[_0x52d472(0xdc)]('‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20'+_0x1759c3['id']+'\x20('+_0x1759c3['gateway']+',\x20'+_0x1759c3[_0x52d472(0xdf)]+'\x20'+_0x1759c3[_0x52d472(0x15e)]+')'),console[_0x52d472(0xdc)](_0x52d472(0x104)+_0x1759c3[_0x52d472(0x12c)]['name']+'\x20('+_0x1759c3[_0x52d472(0x12c)][_0x52d472(0x140)]+')'),console[_0x52d472(0xdc)]('\x20\x20\x20Created:\x20'+_0x1759c3[_0x52d472(0x13b)][_0x52d472(0xe7)]()),console[_0x52d472(0xdc)](_0x52d472(0xdb)+Math[_0x52d472(0xd5)]((Date[_0x52d472(0x12a)]()-_0x1759c3[_0x52d472(0x13b)][_0x52d472(0x12e)]())/(0x3e8*0x3c*0x3c*0x18))+_0x52d472(0x130));const _0x56069b=await database_1[_0x52d472(0x10c)][_0x52d472(0x162)][_0x52d472(0xe0)]({'where':{'id':_0x1759c3['id']},'data':{'status':client_1[_0x52d472(0x13d)][_0x52d472(0x134)],'statusChangedBy':_0x52d472(0x13a),'statusChangedAt':new Date(),'failureMessage':_0x52d472(0x11f)+this[_0x52d472(0x10d)]+_0x52d472(0x130)}});console['log'](_0x52d472(0x13f)+_0x1759c3['id']+_0x52d472(0x102)),loggerService_1[_0x52d472(0xd8)]['logWebhookProcessed'](_0x1759c3[_0x52d472(0xf2)],_0x1759c3['id'],'PROCESSING',_0x52d472(0x134),{'reason':'auto_timeout','timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),_0x67418++;}catch(_0xa93d4d){const _0x93608a=_0x52d472(0xf5)+_0x1759c3['id']+':\x20'+(_0xa93d4d instanceof Error?_0xa93d4d[_0x52d472(0x123)]:_0x52d472(0x13e));console['error']('‚ùå\x20'+_0x93608a),_0x3d656a[_0x52d472(0x155)](_0x93608a),_0xb86e61++;}}const _0x33a0fd=_0x52d472(0x122)+_0x67418+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0xb86e61+_0x52d472(0x136);return console[_0x52d472(0xdc)]('üìä\x20'+_0x33a0fd),loggerService_1[_0x52d472(0xd8)][_0x52d472(0x166)](_0x52d472(0x152),_0x52d472(0x154),_0x52d472(0x13a),'admin',{'processed':_0x67418,'failed':_0xb86e61,'errors':_0x3d656a,'timeoutDays':this[_0x52d472(0x10d)]}),{'processed':_0x67418,'failed':_0xb86e61,'errors':_0x3d656a};}catch(_0xd2e344){const _0x30f655=_0x52d472(0xe3)+(_0xd2e344 instanceof Error?_0xd2e344[_0x52d472(0x123)]:'Unknown\x20error');return console['error'](_0x52d472(0x10a)+_0x30f655),_0x3d656a[_0x52d472(0x155)](_0x30f655),loggerService_1[_0x52d472(0xd8)][_0x52d472(0x100)]('payment_cleanup',_0x30f655,{'timeoutDays':this[_0x52d472(0x10d)]}),{'processed':_0x67418,'failed':_0xb86e61,'errors':_0x3d656a};}}async[a80_0x432164(0x143)](){const _0x180fc5=a80_0x432164,_0x289c61=[];let _0xc49bd5=0x0,_0x1b4451=0x0;try{console[_0x180fc5(0xdc)](_0x180fc5(0x165));const _0x1aa868=new Date(),_0x527690=new Date(_0x1aa868['getTime']()-this['FAST_TIMEOUT_MINUTES']*0x3c*0x3e8),_0x34998e=new Date();_0x34998e[_0x180fc5(0x12b)](_0x34998e[_0x180fc5(0xe4)]()-this[_0x180fc5(0x149)]),console[_0x180fc5(0xdc)](_0x180fc5(0x128)+_0x527690[_0x180fc5(0xe7)]()),console[_0x180fc5(0xdc)](_0x180fc5(0xe9)+_0x34998e[_0x180fc5(0xe7)]()),console['log']('üìã\x20Fast\x20timeout\x20gateways:\x20'+this[_0x180fc5(0xec)][_0x180fc5(0xf3)](',\x20'));const _0x373fc3=await database_1[_0x180fc5(0x10c)][_0x180fc5(0x162)][_0x180fc5(0xef)]({'where':{'status':client_1['PaymentStatus'][_0x180fc5(0x138)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x527690}},{'gateway':{'notIn':this[_0x180fc5(0xec)]},'createdAt':{'lt':_0x34998e}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x180fc5(0xdc)](_0x180fc5(0x15b)+_0x373fc3[_0x180fc5(0xce)]+_0x180fc5(0x164));if(_0x373fc3[_0x180fc5(0xce)]===0x0)return console[_0x180fc5(0xdc)](_0x180fc5(0xfa)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x303ccf of _0x373fc3){try{const _0x9f7c9d=this[_0x180fc5(0xec)][_0x180fc5(0x14f)](_0x303ccf[_0x180fc5(0xf2)]),_0x23bce6=_0x9f7c9d?_0x180fc5(0x101):_0x180fc5(0x145),_0x48d242=Math[_0x180fc5(0xd5)]((Date[_0x180fc5(0x12a)]()-_0x303ccf[_0x180fc5(0x13b)]['getTime']())/(0x3e8*0x3c));console[_0x180fc5(0xdc)](_0x180fc5(0xcb)+_0x303ccf['id']),console['log'](_0x180fc5(0xd2)+_0x303ccf['gateway']+'\x20('+_0x23bce6+_0x180fc5(0xcc)),console[_0x180fc5(0xdc)](_0x180fc5(0x12d)+_0x303ccf['amount']+'\x20'+_0x303ccf[_0x180fc5(0x15e)]),console['log'](_0x180fc5(0x104)+_0x303ccf[_0x180fc5(0x12c)][_0x180fc5(0x103)]+'\x20('+_0x303ccf[_0x180fc5(0x12c)]['username']+')'),console[_0x180fc5(0xdc)](_0x180fc5(0xe6)+_0x303ccf[_0x180fc5(0x13b)]['toISOString']()),console[_0x180fc5(0xdc)](_0x180fc5(0xdb)+_0x48d242+_0x180fc5(0xd0));const _0x58061e=await database_1['default'][_0x180fc5(0x162)][_0x180fc5(0xe0)]({'where':{'id':_0x303ccf['id']},'data':{'status':client_1['PaymentStatus'][_0x180fc5(0x15d)],'statusChangedBy':_0x180fc5(0x13a),'statusChangedAt':new Date(),'failureMessage':_0x180fc5(0x11b)+_0x23bce6}});console[_0x180fc5(0xdc)](_0x180fc5(0x13f)+_0x303ccf['id']+_0x180fc5(0xdd)),loggerService_1[_0x180fc5(0xd8)][_0x180fc5(0xf4)](_0x303ccf[_0x180fc5(0xf2)],_0x303ccf['id'],_0x180fc5(0x138),_0x180fc5(0x15d),{'reason':_0x180fc5(0xeb),'timeout':_0x23bce6,'ageMinutes':_0x48d242}),_0xc49bd5++;}catch(_0x1e5a35){const _0x23bfb4='Failed\x20to\x20update\x20PENDING\x20payment\x20'+_0x303ccf['id']+':\x20'+(_0x1e5a35 instanceof Error?_0x1e5a35[_0x180fc5(0x123)]:'Unknown\x20error');console[_0x180fc5(0xd7)]('‚ùå\x20'+_0x23bfb4),_0x289c61['push'](_0x23bfb4),_0x1b4451++;}}const _0x2c34d0='PENDING\x20cleanup\x20completed:\x20'+_0xc49bd5+_0x180fc5(0x119)+_0x1b4451+_0x180fc5(0x136);return console[_0x180fc5(0xdc)]('üìä\x20'+_0x2c34d0),loggerService_1['loggerService'][_0x180fc5(0x166)]('pending_payment_cleanup',_0x180fc5(0x154),_0x180fc5(0x13a),_0x180fc5(0x120),{'processed':_0xc49bd5,'failed':_0x1b4451,'errors':_0x289c61,'fastTimeoutMinutes':this[_0x180fc5(0x15f)],'slowTimeoutDays':this[_0x180fc5(0x149)]}),{'processed':_0xc49bd5,'failed':_0x1b4451,'errors':_0x289c61};}catch(_0x4517a4){const _0xf94a2f=_0x180fc5(0x14e)+(_0x4517a4 instanceof Error?_0x4517a4[_0x180fc5(0x123)]:_0x180fc5(0x13e));return console[_0x180fc5(0xd7)](_0x180fc5(0x10a)+_0xf94a2f),_0x289c61[_0x180fc5(0x155)](_0xf94a2f),loggerService_1[_0x180fc5(0xd8)]['logWebhookError'](_0x180fc5(0x108),_0xf94a2f,{'timeoutDays':this[_0x180fc5(0x139)]}),{'processed':_0xc49bd5,'failed':_0x1b4451,'errors':_0x289c61};}}async[a80_0x432164(0x156)](){const _0x822a6e=a80_0x432164;try{const _0x10af67=new Date(),_0x5c6302=new Date(_0x10af67[_0x822a6e(0x12e)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x22cd48=new Date(_0x10af67[_0x822a6e(0x12e)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x224278=new Date(_0x10af67[_0x822a6e(0x12e)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x50405a=await database_1[_0x822a6e(0x10c)][_0x822a6e(0x162)][_0x822a6e(0xef)]({'where':{'status':{'in':[client_1[_0x822a6e(0x13d)]['PROCESSING'],client_1[_0x822a6e(0x13d)]['PENDING']]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x406583={'total':_0x50405a['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x576cd4 of _0x50405a){if(_0x576cd4['createdAt']>_0x5c6302)_0x406583[_0x822a6e(0x133)][_0x822a6e(0xda)]++;else{if(_0x576cd4[_0x822a6e(0x13b)]>_0x22cd48)_0x406583[_0x822a6e(0x133)][_0x822a6e(0x126)]++;else _0x576cd4[_0x822a6e(0x13b)]>_0x224278?_0x406583[_0x822a6e(0x133)][_0x822a6e(0xde)]++:_0x406583[_0x822a6e(0x133)][_0x822a6e(0xfb)]++;}!_0x406583['byGateway'][_0x576cd4[_0x822a6e(0xf2)]]&&(_0x406583[_0x822a6e(0xf8)][_0x576cd4[_0x822a6e(0xf2)]]=0x0);_0x406583[_0x822a6e(0xf8)][_0x576cd4[_0x822a6e(0xf2)]]++;const _0x47bffe=_0x576cd4[_0x822a6e(0xf1)];!_0x406583['byStatus'][_0x47bffe]&&(_0x406583['byStatus'][_0x47bffe]=0x0),_0x406583[_0x822a6e(0xfd)][_0x47bffe]++;}return _0x406583;}catch(_0x282d7c){console[_0x822a6e(0xd7)](_0x822a6e(0xd4),_0x282d7c);throw new Error(_0x822a6e(0x112)+(_0x282d7c instanceof Error?_0x282d7c[_0x822a6e(0x123)]:'Unknown\x20error'));}}async[a80_0x432164(0x129)](){const _0x3af999=a80_0x432164;console[_0x3af999(0xdc)](_0x3af999(0x131));const _0x48f29e=await this['getProcessingPaymentsStats']();console[_0x3af999(0xdc)](_0x3af999(0x114)),console[_0x3af999(0xdc)](_0x3af999(0x10f)+_0x48f29e[_0x3af999(0xd6)]),console[_0x3af999(0xdc)](_0x3af999(0x141)+_0x48f29e['byAge'][_0x3af999(0xda)]),console['log'](_0x3af999(0xfc)+_0x48f29e[_0x3af999(0x133)][_0x3af999(0x126)]),console[_0x3af999(0xdc)](_0x3af999(0x118)+_0x48f29e[_0x3af999(0x133)][_0x3af999(0xde)]),console[_0x3af999(0xdc)](_0x3af999(0xcf)+_0x48f29e[_0x3af999(0x133)][_0x3af999(0xfb)]),console[_0x3af999(0xdc)](_0x3af999(0xc9),_0x48f29e[_0x3af999(0xf8)]),console[_0x3af999(0xdc)](_0x3af999(0x111),_0x48f29e[_0x3af999(0xfd)]),console[_0x3af999(0xdc)](_0x3af999(0x109));const _0xd501eb=await this['cleanupStaleProcessingPayments']();console[_0x3af999(0xdc)](_0x3af999(0x116));const _0xff16e9=await this[_0x3af999(0x143)](),_0x204e98=await this[_0x3af999(0x156)]();console['log'](_0x3af999(0xcd)),console['log']('\x20\x20\x20Total:\x20'+_0x204e98['total']),console['log'](_0x3af999(0xcf)+_0x204e98['byAge'][_0x3af999(0xfb)]),console[_0x3af999(0xdc)]('\x20\x20\x20By\x20status:',_0x204e98['byStatus']);const _0x2920c6=_0xd501eb['processed']+_0xff16e9[_0x3af999(0x15c)],_0xa2be86=_0xd501eb['failed']+_0xff16e9[_0x3af999(0x157)],_0x5f235c=[..._0xd501eb[_0x3af999(0xe2)],..._0xff16e9[_0x3af999(0xe2)]];console[_0x3af999(0xdc)](_0x3af999(0x142)),console[_0x3af999(0xdc)](_0x3af999(0xf9)+_0xd501eb[_0x3af999(0x15c)]),console[_0x3af999(0xdc)](_0x3af999(0x107)+_0xff16e9[_0x3af999(0x15c)]),console['log'](_0x3af999(0x13c)+_0x2920c6),console['log'](_0x3af999(0xea)+_0xa2be86),console[_0x3af999(0xdc)](_0x3af999(0x137)+(_0x48f29e[_0x3af999(0xd6)]-_0x204e98[_0x3af999(0xd6)])),_0x5f235c[_0x3af999(0xce)]>0x0&&(console[_0x3af999(0xdc)](_0x3af999(0x163)),_0x5f235c['forEach']((_0x2f53a4,_0x4963c9)=>{const _0x3cfe92=_0x3af999;console[_0x3cfe92(0xdc)]('\x20\x20\x20\x20\x20\x20'+(_0x4963c9+0x1)+'.\x20'+_0x2f53a4);})),console[_0x3af999(0xdc)](_0x3af999(0x153));}async[a80_0x432164(0x110)](){const _0x415884=a80_0x432164;console[_0x415884(0xdc)](_0x415884(0x160));const _0x3aa651=await this[_0x415884(0x156)](),_0x42d0d0=_0x3aa651[_0x415884(0xfd)][_0x415884(0x14d)]||0x0;console['log']('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x42d0d0);const _0x40960d=await this['cleanupStaleProcessingPayments'](),_0x3cce09=await this[_0x415884(0x156)](),_0x418d03=_0x3cce09[_0x415884(0xfd)][_0x415884(0x14d)]||0x0;console[_0x415884(0xdc)](_0x415884(0x11c)+_0x418d03),console[_0x415884(0xdc)](_0x415884(0x132)+_0x40960d['processed']),console[_0x415884(0xdc)](_0x415884(0x12f));}async[a80_0x432164(0xff)](){const _0x5670d3=a80_0x432164;console['log'](_0x5670d3(0x147));const _0x595815=await this[_0x5670d3(0x156)](),_0x4af75c=_0x595815['byStatus']['PENDING']||0x0;console[_0x5670d3(0xdc)](_0x5670d3(0xfe)+_0x4af75c);const _0x3a85d8=await this[_0x5670d3(0x143)](),_0x39202f=await this[_0x5670d3(0x156)](),_0x5c20b5=_0x39202f[_0x5670d3(0xfd)][_0x5670d3(0x138)]||0x0;console[_0x5670d3(0xdc)](_0x5670d3(0x14c)+_0x5c20b5),console[_0x5670d3(0xdc)](_0x5670d3(0x124)+_0x3a85d8[_0x5670d3(0x15c)]),console[_0x5670d3(0xdc)]('üèÅ\x20PENDING\x20cleanup\x20completed');}async[a80_0x432164(0x161)](){const _0x21d2d0=a80_0x432164,_0x37ab12=[];let _0xcf489f=0x0;try{console[_0x21d2d0(0xdc)](_0x21d2d0(0x159));const _0xa02f24=new Date(),_0x3171fe=['oxapay',_0x21d2d0(0x148)],_0x82a59e=[_0x21d2d0(0xed),'rapyd',_0x21d2d0(0x117),'mastercard'],_0x4609c1=await database_1[_0x21d2d0(0x10c)][_0x21d2d0(0xd3)][_0x21d2d0(0xef)]({'where':{'type':'SINGLE','status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':_0x21d2d0(0x14a)},'take':0x1}}});console[_0x21d2d0(0xdc)](_0x21d2d0(0x15b)+_0x4609c1[_0x21d2d0(0xce)]+_0x21d2d0(0x10e));for(const _0x4dad3c of _0x4609c1){try{if(_0x4dad3c[_0x21d2d0(0xe8)]['length']===0x0)continue;const _0x4cce6f=_0x4dad3c['payments'][0x0];if(_0x4cce6f[_0x21d2d0(0xf1)]===_0x21d2d0(0x150))continue;const _0x55f197=_0xa02f24[_0x21d2d0(0x12e)]()-_0x4cce6f[_0x21d2d0(0x13b)][_0x21d2d0(0x12e)]();let _0x5f16c3;_0x3171fe[_0x21d2d0(0x14f)](_0x4dad3c[_0x21d2d0(0xf2)])||_0x82a59e['includes'](_0x4dad3c[_0x21d2d0(0xf2)])?_0x5f16c3=0x1e*0x3c*0x3e8:_0x5f16c3=0x3*0x18*0x3c*0x3c*0x3e8,_0x55f197>_0x5f16c3&&(await database_1['default'][_0x21d2d0(0xd3)][_0x21d2d0(0xe0)]({'where':{'id':_0x4dad3c['id']},'data':{'status':_0x21d2d0(0x15d)}}),console[_0x21d2d0(0xdc)](_0x21d2d0(0x10b)+_0x4dad3c['id']+_0x21d2d0(0xe5)+_0x4dad3c[_0x21d2d0(0xf2)]+_0x21d2d0(0x121)+Math['round'](_0x55f197/0x3e8/0x3c)+_0x21d2d0(0x151)),_0xcf489f++);}catch(_0x1ceb3a){const _0x6d936=_0x21d2d0(0x15a)+_0x4dad3c['id']+':\x20'+(_0x1ceb3a instanceof Error?_0x1ceb3a[_0x21d2d0(0x123)]:'Unknown\x20error');console[_0x21d2d0(0xd7)]('‚ùå\x20'+_0x6d936),_0x37ab12[_0x21d2d0(0x155)](_0x6d936);}}return console['log'](_0x21d2d0(0x11e)+_0xcf489f+'\x20links\x20expired'),{'expired':_0xcf489f,'errors':_0x37ab12};}catch(_0x52d358){const _0x5c9ac5=_0x21d2d0(0x158)+(_0x52d358 instanceof Error?_0x52d358[_0x21d2d0(0x123)]:_0x21d2d0(0x13e));return console[_0x21d2d0(0xd7)](_0x21d2d0(0x10a)+_0x5c9ac5),_0x37ab12['push'](_0x5c9ac5),{'expired':_0xcf489f,'errors':_0x37ab12};}}}exports[a80_0x432164(0x11a)]=PaymentCleanupService,exports['paymentCleanupService']=new PaymentCleanupService();