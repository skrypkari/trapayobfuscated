'use strict';const a72_0x1b4aa2=a72_0xddca;(function(_0x2e682c,_0x3fde1f){const _0x309c6f=a72_0xddca,_0xac931b=_0x2e682c();while(!![]){try{const _0x8831dd=-parseInt(_0x309c6f(0xd9))/0x1+-parseInt(_0x309c6f(0x102))/0x2+-parseInt(_0x309c6f(0x11e))/0x3+-parseInt(_0x309c6f(0xf3))/0x4+-parseInt(_0x309c6f(0x120))/0x5+-parseInt(_0x309c6f(0x10e))/0x6+-parseInt(_0x309c6f(0xdc))/0x7*(-parseInt(_0x309c6f(0x106))/0x8);if(_0x8831dd===_0x3fde1f)break;else _0xac931b['push'](_0xac931b['shift']());}catch(_0x11e366){_0xac931b['push'](_0xac931b['shift']());}}}(a72_0x2e40,0x668dd));var __importDefault=this&&this[a72_0x1b4aa2(0x10f)]||function(_0x56c390){const _0xc9d197=a72_0x1b4aa2;return _0x56c390&&_0x56c390[_0xc9d197(0x11c)]?_0x56c390:{'default':_0x56c390};};function a72_0x2e40(){const _0x54181f=['Failed\x20to\x20expire\x20link\x20','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20for\x20','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','838428aErTvI','\x20\x20\x20Shop:\x20','runProcessingCleanupOnly','14pTAabm','defineProperty','length','\x20\x20\x20Total:\x20','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','üìÖ\x20Looking\x20for\x20PENDING\x20payments\x20older\x20than:\x20','\x20\x20\x20\x20\x20\x20','getDate','\x20minutes)','payment','Failed\x20to\x20update\x20PENDING\x20payment\x20','includes','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','PENDING_TIMEOUT_DAYS','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','squirrelpay','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','PaymentStatus','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','createdAt','./loggerService','459020oTfATs','desc','\x20from\x20PENDING\x20to\x20EXPIRED','\x20from\x20PROCESSING\x20to\x20FAILED','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','Cleanup\x20service\x20error:\x20','\x20stale\x20PENDING\x20payments','POST','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','Unknown\x20error','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','üìä\x20Expiration\x20completed:\x20','\x20\x20\x20Age:\x20','amount','EXPIRED','1014272rceuKl','paymentCleanupService','PaymentCleanupService','üèÅ\x20PENDING\x20cleanup\x20completed','12635192oNWZue','system','floor','failed','SINGLE','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','üèÅ\x20Payment\x20cleanup\x20service\x20completed','2451354NSgpPN','__importDefault','name','expireSinglePaymentLinks','plisio','cleanupStalePendingPayments','gateway','update','logApiCall','logWebhookError','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','getTime','recent','__esModule','PROCESSING','475221iNwXtv','payment_cleanup','3557260IPmPOl','PENDING','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','total','üí•\x20','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','Failed\x20to\x20update\x20payment\x20','\x20\x20\x20By\x20status:','error','byAge','PROCESSING_TIMEOUT_DAYS','‚úÖ\x20Updated\x20payment\x20','üîç\x20Found\x20','byGateway','message','mastercard','visa/mastercard','\x20failed\x20to\x20update','\x20payments\x20updated\x20to\x20EXPIRED,\x20','getProcessingPaymentsStats','\x20(gateway:\x20','payments','username','runPendingCleanupOnly','default','PENDING\x20cleanup\x20service\x20error:\x20','loggerService','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','\x20days','\x20links\x20expired','auto_timeout_pending','forEach','admin','logWebhookProcessed','errors','PAID','log','expired','\x20stale\x20PROCESSING\x20payments','\x20\x20\x20Recent\x20(1-3\x20days):\x20','setDate','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','paymentLink','toISOString','FAILED','‚úÖ\x20PENDING\x20payments\x20processed:\x20','findMany','@prisma/client','üìä\x20','byStatus','üèÅ\x20PROCESSING\x20cleanup\x20completed','cleanupStaleProcessingPayments','currency','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','‚è∞\x20Expired\x20link\x20','processed','status','push','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','pending_payment_cleanup','auto_timeout','now','fresh'];a72_0x2e40=function(){return _0x54181f;};return a72_0x2e40();}function a72_0xddca(_0x50f7af,_0x2a6e93){_0x50f7af=_0x50f7af-0xd0;const _0x2e40ac=a72_0x2e40();let _0xddca5c=_0x2e40ac[_0x50f7af];return _0xddca5c;}Object[a72_0x1b4aa2(0xdd)](exports,a72_0x1b4aa2(0x11c),{'value':!![]}),exports[a72_0x1b4aa2(0x103)]=exports[a72_0x1b4aa2(0x104)]=void 0x0;const database_1=__importDefault(require('../config/database')),client_1=require(a72_0x1b4aa2(0x150)),loggerService_1=require(a72_0x1b4aa2(0xf2));class PaymentCleanupService{constructor(){const _0x3590bf=a72_0x1b4aa2;this['PROCESSING_TIMEOUT_DAYS']=0x5,this[_0x3590bf(0xea)]=0x5;}async[a72_0x1b4aa2(0x154)](){const _0x1835bc=a72_0x1b4aa2,_0x599aec=[];let _0x2235d6=0x0,_0x4cc281=0x0;try{console[_0x1835bc(0x145)](_0x1835bc(0xf7));const _0x367fb3=new Date();_0x367fb3['setDate'](_0x367fb3['getDate']()-this[_0x1835bc(0x12b)]),console[_0x1835bc(0x145)]('üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20'+_0x367fb3[_0x1835bc(0x14c)]());const _0x1a77d5=await database_1[_0x1835bc(0x139)][_0x1835bc(0xe6)]['findMany']({'where':{'status':client_1[_0x1835bc(0xef)][_0x1835bc(0x11d)],'createdAt':{'lt':_0x367fb3}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x1835bc(0x145)](_0x1835bc(0x12d)+_0x1a77d5[_0x1835bc(0xde)]+_0x1835bc(0x147));if(_0x1a77d5[_0x1835bc(0xde)]===0x0)return console[_0x1835bc(0x145)](_0x1835bc(0x10c)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x166282 of _0x1a77d5){try{console[_0x1835bc(0x145)](_0x1835bc(0x13c)+_0x166282['id']+'\x20('+_0x166282[_0x1835bc(0x114)]+',\x20'+_0x166282[_0x1835bc(0x100)]+'\x20'+_0x166282[_0x1835bc(0x155)]+')'),console[_0x1835bc(0x145)](_0x1835bc(0xda)+_0x166282['shop'][_0x1835bc(0x110)]+'\x20('+_0x166282['shop'][_0x1835bc(0x137)]+')'),console[_0x1835bc(0x145)]('\x20\x20\x20Created:\x20'+_0x166282[_0x1835bc(0xf1)][_0x1835bc(0x14c)]()),console[_0x1835bc(0x145)](_0x1835bc(0xff)+Math[_0x1835bc(0x108)]((Date[_0x1835bc(0xd4)]()-_0x166282[_0x1835bc(0xf1)][_0x1835bc(0x11a)]())/(0x3e8*0x3c*0x3c*0x18))+_0x1835bc(0x13d));const _0x1a942c=await database_1['default'][_0x1835bc(0xe6)][_0x1835bc(0x115)]({'where':{'id':_0x166282['id']},'data':{'status':client_1[_0x1835bc(0xef)][_0x1835bc(0x14d)],'statusChangedBy':_0x1835bc(0x107),'statusChangedAt':new Date(),'failureMessage':_0x1835bc(0xd1)+this[_0x1835bc(0x12b)]+'\x20days'}});console['log'](_0x1835bc(0x12c)+_0x166282['id']+_0x1835bc(0xf6)),loggerService_1['loggerService'][_0x1835bc(0x142)](_0x166282[_0x1835bc(0x114)],_0x166282['id'],_0x1835bc(0x11d),_0x1835bc(0x14d),{'reason':_0x1835bc(0xd3),'timeoutDays':this[_0x1835bc(0x12b)]}),_0x2235d6++;}catch(_0x3c8438){const _0x2555bf=_0x1835bc(0x127)+_0x166282['id']+':\x20'+(_0x3c8438 instanceof Error?_0x3c8438[_0x1835bc(0x12f)]:_0x1835bc(0xfc));console[_0x1835bc(0x129)]('‚ùå\x20'+_0x2555bf),_0x599aec['push'](_0x2555bf),_0x4cc281++;}}const _0x461131='Cleanup\x20completed:\x20'+_0x2235d6+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0x4cc281+_0x1835bc(0x132);return console[_0x1835bc(0x145)](_0x1835bc(0x151)+_0x461131),loggerService_1[_0x1835bc(0x13b)][_0x1835bc(0x116)]('payment_cleanup','POST','system',_0x1835bc(0x141),{'processed':_0x2235d6,'failed':_0x4cc281,'errors':_0x599aec,'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x2235d6,'failed':_0x4cc281,'errors':_0x599aec};}catch(_0x307498){const _0x17e240=_0x1835bc(0xf8)+(_0x307498 instanceof Error?_0x307498[_0x1835bc(0x12f)]:_0x1835bc(0xfc));return console[_0x1835bc(0x129)]('üí•\x20'+_0x17e240),_0x599aec['push'](_0x17e240),loggerService_1['loggerService'][_0x1835bc(0x117)](_0x1835bc(0x11f),_0x17e240,{'timeoutDays':this[_0x1835bc(0x12b)]}),{'processed':_0x2235d6,'failed':_0x4cc281,'errors':_0x599aec};}}async[a72_0x1b4aa2(0x113)](){const _0x339a21=a72_0x1b4aa2,_0x265a95=[];let _0x42c041=0x0,_0x5742f2=0x0;try{console[_0x339a21(0x145)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0xb68a9b=new Date();_0xb68a9b[_0x339a21(0x149)](_0xb68a9b[_0x339a21(0xe4)]()-this[_0x339a21(0xea)]),console[_0x339a21(0x145)](_0x339a21(0xe2)+_0xb68a9b['toISOString']());const _0x2ef330=await database_1['default'][_0x339a21(0xe6)][_0x339a21(0x14f)]({'where':{'status':client_1[_0x339a21(0xef)]['PENDING'],'createdAt':{'lt':_0xb68a9b}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x339a21(0x145)](_0x339a21(0x12d)+_0x2ef330[_0x339a21(0xde)]+_0x339a21(0xf9));if(_0x2ef330[_0x339a21(0xde)]===0x0)return console['log'](_0x339a21(0xe9)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x38cfcb of _0x2ef330){try{console[_0x339a21(0x145)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x38cfcb['id']+'\x20('+_0x38cfcb[_0x339a21(0x114)]+',\x20'+_0x38cfcb[_0x339a21(0x100)]+'\x20'+_0x38cfcb[_0x339a21(0x155)]+')'),console[_0x339a21(0x145)]('\x20\x20\x20Shop:\x20'+_0x38cfcb['shop'][_0x339a21(0x110)]+'\x20('+_0x38cfcb['shop'][_0x339a21(0x137)]+')'),console[_0x339a21(0x145)]('\x20\x20\x20Created:\x20'+_0x38cfcb[_0x339a21(0xf1)][_0x339a21(0x14c)]()),console[_0x339a21(0x145)](_0x339a21(0xff)+Math[_0x339a21(0x108)]((Date[_0x339a21(0xd4)]()-_0x38cfcb[_0x339a21(0xf1)][_0x339a21(0x11a)]())/(0x3e8*0x3c*0x3c*0x18))+_0x339a21(0x13d));const _0x27986f=await database_1[_0x339a21(0x139)][_0x339a21(0xe6)][_0x339a21(0x115)]({'where':{'id':_0x38cfcb['id']},'data':{'status':client_1['PaymentStatus']['EXPIRED'],'statusChangedBy':_0x339a21(0x107),'statusChangedAt':new Date(),'failureMessage':_0x339a21(0xd7)+this[_0x339a21(0xea)]+_0x339a21(0x13d)}});console[_0x339a21(0x145)](_0x339a21(0x12c)+_0x38cfcb['id']+_0x339a21(0xf5)),loggerService_1[_0x339a21(0x13b)][_0x339a21(0x142)](_0x38cfcb[_0x339a21(0x114)],_0x38cfcb['id'],_0x339a21(0x121),_0x339a21(0x101),{'reason':_0x339a21(0x13f),'timeoutDays':this[_0x339a21(0xea)]}),_0x42c041++;}catch(_0x75d57d){const _0x5b3e28=_0x339a21(0xe7)+_0x38cfcb['id']+':\x20'+(_0x75d57d instanceof Error?_0x75d57d[_0x339a21(0x12f)]:_0x339a21(0xfc));console[_0x339a21(0x129)]('‚ùå\x20'+_0x5b3e28),_0x265a95[_0x339a21(0xd0)](_0x5b3e28),_0x5742f2++;}}const _0x58c7e1='PENDING\x20cleanup\x20completed:\x20'+_0x42c041+_0x339a21(0x133)+_0x5742f2+_0x339a21(0x132);return console[_0x339a21(0x145)]('üìä\x20'+_0x58c7e1),loggerService_1['loggerService'][_0x339a21(0x116)](_0x339a21(0xd2),_0x339a21(0xfa),_0x339a21(0x107),_0x339a21(0x141),{'processed':_0x42c041,'failed':_0x5742f2,'errors':_0x265a95,'timeoutDays':this[_0x339a21(0xea)]}),{'processed':_0x42c041,'failed':_0x5742f2,'errors':_0x265a95};}catch(_0x323b81){const _0x5a026a=_0x339a21(0x13a)+(_0x323b81 instanceof Error?_0x323b81[_0x339a21(0x12f)]:_0x339a21(0xfc));return console[_0x339a21(0x129)](_0x339a21(0x124)+_0x5a026a),_0x265a95[_0x339a21(0xd0)](_0x5a026a),loggerService_1[_0x339a21(0x13b)]['logWebhookError'](_0x339a21(0xd2),_0x5a026a,{'timeoutDays':this[_0x339a21(0xea)]}),{'processed':_0x42c041,'failed':_0x5742f2,'errors':_0x265a95};}}async[a72_0x1b4aa2(0x134)](){const _0x22410e=a72_0x1b4aa2;try{const _0x3d80b4=new Date(),_0x428279=new Date(_0x3d80b4[_0x22410e(0x11a)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x22a2a0=new Date(_0x3d80b4['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x4853ce=new Date(_0x3d80b4[_0x22410e(0x11a)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x59095f=await database_1['default'][_0x22410e(0xe6)][_0x22410e(0x14f)]({'where':{'status':{'in':[client_1[_0x22410e(0xef)][_0x22410e(0x11d)],client_1[_0x22410e(0xef)][_0x22410e(0x121)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x2bd520={'total':_0x59095f[_0x22410e(0xde)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x50d3b4 of _0x59095f){if(_0x50d3b4['createdAt']>_0x428279)_0x2bd520[_0x22410e(0x12a)][_0x22410e(0xd5)]++;else{if(_0x50d3b4['createdAt']>_0x22a2a0)_0x2bd520['byAge'][_0x22410e(0x11b)]++;else _0x50d3b4[_0x22410e(0xf1)]>_0x4853ce?_0x2bd520[_0x22410e(0x12a)]['stale']++:_0x2bd520[_0x22410e(0x12a)][_0x22410e(0x146)]++;}!_0x2bd520[_0x22410e(0x12e)][_0x50d3b4[_0x22410e(0x114)]]&&(_0x2bd520[_0x22410e(0x12e)][_0x50d3b4[_0x22410e(0x114)]]=0x0);_0x2bd520['byGateway'][_0x50d3b4[_0x22410e(0x114)]]++;const _0x18a784=_0x50d3b4[_0x22410e(0x159)];!_0x2bd520[_0x22410e(0x152)][_0x18a784]&&(_0x2bd520['byStatus'][_0x18a784]=0x0),_0x2bd520['byStatus'][_0x18a784]++;}return _0x2bd520;}catch(_0x59dba9){console[_0x22410e(0x129)]('Failed\x20to\x20get\x20processing\x20payments\x20stats:',_0x59dba9);throw new Error(_0x22410e(0xeb)+(_0x59dba9 instanceof Error?_0x59dba9['message']:_0x22410e(0xfc)));}}async['runCleanupWithReport'](){const _0x484b2c=a72_0x1b4aa2;console['log'](_0x484b2c(0xe0));const _0x16f121=await this[_0x484b2c(0x134)]();console[_0x484b2c(0x145)]('üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:'),console['log'](_0x484b2c(0xdf)+_0x16f121[_0x484b2c(0x123)]),console[_0x484b2c(0x145)](_0x484b2c(0x119)+_0x16f121['byAge'][_0x484b2c(0xd5)]),console[_0x484b2c(0x145)](_0x484b2c(0x148)+_0x16f121[_0x484b2c(0x12a)]['recent']),console[_0x484b2c(0x145)]('\x20\x20\x20Stale\x20(3-5\x20days):\x20'+_0x16f121[_0x484b2c(0x12a)]['stale']),console['log'](_0x484b2c(0x10b)+_0x16f121[_0x484b2c(0x12a)][_0x484b2c(0x146)]),console[_0x484b2c(0x145)]('\x20\x20\x20By\x20gateway:',_0x16f121[_0x484b2c(0x12e)]),console[_0x484b2c(0x145)](_0x484b2c(0x128),_0x16f121[_0x484b2c(0x152)]),console[_0x484b2c(0x145)](_0x484b2c(0xee));const _0x1bf342=await this[_0x484b2c(0x154)]();console[_0x484b2c(0x145)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x4d0657=await this[_0x484b2c(0x113)](),_0x3fc3fa=await this['getProcessingPaymentsStats']();console[_0x484b2c(0x145)]('\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console[_0x484b2c(0x145)](_0x484b2c(0xdf)+_0x3fc3fa[_0x484b2c(0x123)]),console[_0x484b2c(0x145)](_0x484b2c(0x10b)+_0x3fc3fa[_0x484b2c(0x12a)][_0x484b2c(0x146)]),console[_0x484b2c(0x145)](_0x484b2c(0x128),_0x3fc3fa[_0x484b2c(0x152)]);const _0x4dfb3d=_0x1bf342['processed']+_0x4d0657[_0x484b2c(0x158)],_0x457fc4=_0x1bf342[_0x484b2c(0x109)]+_0x4d0657[_0x484b2c(0x109)],_0x52290b=[..._0x1bf342[_0x484b2c(0x143)],..._0x4d0657[_0x484b2c(0x143)]];console[_0x484b2c(0x145)]('\x0aüìà\x20Cleanup\x20Summary:'),console[_0x484b2c(0x145)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x1bf342[_0x484b2c(0x158)]),console['log'](_0x484b2c(0xed)+_0x4d0657[_0x484b2c(0x158)]),console[_0x484b2c(0x145)](_0x484b2c(0x125)+_0x4dfb3d),console[_0x484b2c(0x145)](_0x484b2c(0x126)+_0x457fc4),console['log'](_0x484b2c(0x156)+(_0x16f121['total']-_0x3fc3fa['total'])),_0x52290b[_0x484b2c(0xde)]>0x0&&(console[_0x484b2c(0x145)](_0x484b2c(0xd8)),_0x52290b[_0x484b2c(0x140)]((_0x3bbf84,_0x5b764c)=>{const _0x567620=_0x484b2c;console['log'](_0x567620(0xe3)+(_0x5b764c+0x1)+'.\x20'+_0x3bbf84);})),console['log'](_0x484b2c(0x10d));}async[a72_0x1b4aa2(0xdb)](){const _0x15011b=a72_0x1b4aa2;console[_0x15011b(0x145)](_0x15011b(0xe1));const _0x8a36c1=await this[_0x15011b(0x134)](),_0x4c40fc=_0x8a36c1[_0x15011b(0x152)][_0x15011b(0x11d)]||0x0;console[_0x15011b(0x145)](_0x15011b(0xfd)+_0x4c40fc);const _0x5ee0b8=await this[_0x15011b(0x154)](),_0x545f5d=await this[_0x15011b(0x134)](),_0x35baad=_0x545f5d[_0x15011b(0x152)][_0x15011b(0x11d)]||0x0;console[_0x15011b(0x145)](_0x15011b(0xfb)+_0x35baad),console[_0x15011b(0x145)](_0x15011b(0x118)+_0x5ee0b8[_0x15011b(0x158)]),console[_0x15011b(0x145)](_0x15011b(0x153));}async[a72_0x1b4aa2(0x138)](){const _0x1dc4a5=a72_0x1b4aa2;console['log']('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x10c285=await this[_0x1dc4a5(0x134)](),_0x39cb8a=_0x10c285['byStatus'][_0x1dc4a5(0x121)]||0x0;console[_0x1dc4a5(0x145)](_0x1dc4a5(0x14a)+_0x39cb8a);const _0x25f9c6=await this[_0x1dc4a5(0x113)](),_0x28b6bf=await this[_0x1dc4a5(0x134)](),_0x4ab993=_0x28b6bf['byStatus'][_0x1dc4a5(0x121)]||0x0;console['log'](_0x1dc4a5(0x122)+_0x4ab993),console[_0x1dc4a5(0x145)](_0x1dc4a5(0x14e)+_0x25f9c6[_0x1dc4a5(0x158)]),console[_0x1dc4a5(0x145)](_0x1dc4a5(0x105));}async[a72_0x1b4aa2(0x111)](){const _0x5a894f=a72_0x1b4aa2,_0x440ce7=[];let _0x30dc8d=0x0;try{console[_0x5a894f(0x145)](_0x5a894f(0xf0));const _0x44b9d2=new Date(),_0x2d9bce=['oxapay',_0x5a894f(0x112)],_0x2c9f25=[_0x5a894f(0xec),'rapyd',_0x5a894f(0x131),_0x5a894f(0x130)],_0xf29755=await database_1['default'][_0x5a894f(0x14b)][_0x5a894f(0x14f)]({'where':{'type':_0x5a894f(0x10a),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':_0x5a894f(0xf4)},'take':0x1}}});console[_0x5a894f(0x145)](_0x5a894f(0x12d)+_0xf29755[_0x5a894f(0xde)]+'\x20active\x20SINGLE\x20links\x20to\x20check');for(const _0x40c05b of _0xf29755){try{if(_0x40c05b[_0x5a894f(0x136)][_0x5a894f(0xde)]===0x0)continue;const _0x4fc77a=_0x40c05b['payments'][0x0];if(_0x4fc77a['status']===_0x5a894f(0x144))continue;const _0x5eeb18=_0x44b9d2[_0x5a894f(0x11a)]()-_0x4fc77a[_0x5a894f(0xf1)]['getTime']();let _0x37409e;_0x2d9bce[_0x5a894f(0xe8)](_0x40c05b[_0x5a894f(0x114)])||_0x2c9f25[_0x5a894f(0xe8)](_0x40c05b[_0x5a894f(0x114)])?_0x37409e=0x1e*0x3c*0x3e8:_0x37409e=0x3*0x18*0x3c*0x3c*0x3e8,_0x5eeb18>_0x37409e&&(await database_1['default'][_0x5a894f(0x14b)][_0x5a894f(0x115)]({'where':{'id':_0x40c05b['id']},'data':{'status':_0x5a894f(0x101)}}),console[_0x5a894f(0x145)](_0x5a894f(0x157)+_0x40c05b['id']+_0x5a894f(0x135)+_0x40c05b[_0x5a894f(0x114)]+',\x20payment\x20age:\x20'+Math['round'](_0x5eeb18/0x3e8/0x3c)+_0x5a894f(0xe5)),_0x30dc8d++);}catch(_0x49f304){const _0x50368b=_0x5a894f(0xd6)+_0x40c05b['id']+':\x20'+(_0x49f304 instanceof Error?_0x49f304[_0x5a894f(0x12f)]:_0x5a894f(0xfc));console[_0x5a894f(0x129)]('‚ùå\x20'+_0x50368b),_0x440ce7['push'](_0x50368b);}}return console['log'](_0x5a894f(0xfe)+_0x30dc8d+_0x5a894f(0x13e)),{'expired':_0x30dc8d,'errors':_0x440ce7};}catch(_0x1e6d6c){const _0x2bd0e6='Link\x20expiration\x20service\x20error:\x20'+(_0x1e6d6c instanceof Error?_0x1e6d6c[_0x5a894f(0x12f)]:_0x5a894f(0xfc));return console[_0x5a894f(0x129)](_0x5a894f(0x124)+_0x2bd0e6),_0x440ce7[_0x5a894f(0xd0)](_0x2bd0e6),{'expired':_0x30dc8d,'errors':_0x440ce7};}}}exports[a72_0x1b4aa2(0x104)]=PaymentCleanupService,exports[a72_0x1b4aa2(0x103)]=new PaymentCleanupService();