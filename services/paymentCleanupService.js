'use strict';const a74_0x51adec=a74_0x5453;(function(_0x1843fa,_0x2c5517){const _0x45bfb4=a74_0x5453,_0x28642b=_0x1843fa();while(!![]){try{const _0x12124d=parseInt(_0x45bfb4(0x14b))/0x1+-parseInt(_0x45bfb4(0x150))/0x2*(parseInt(_0x45bfb4(0x170))/0x3)+-parseInt(_0x45bfb4(0x168))/0x4+-parseInt(_0x45bfb4(0x155))/0x5*(-parseInt(_0x45bfb4(0x172))/0x6)+parseInt(_0x45bfb4(0x199))/0x7+parseInt(_0x45bfb4(0x17f))/0x8*(-parseInt(_0x45bfb4(0x122))/0x9)+-parseInt(_0x45bfb4(0x195))/0xa*(-parseInt(_0x45bfb4(0x153))/0xb);if(_0x12124d===_0x2c5517)break;else _0x28642b['push'](_0x28642b['shift']());}catch(_0x4dfb6e){_0x28642b['push'](_0x28642b['shift']());}}}(a74_0x3858,0xbb1d0));function a74_0x3858(){const _0x5a924e=['payment_cleanup','status','currency','\x20from\x20PROCESSING\x20to\x20FAILED','rapyd','payments','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','Link\x20expiration\x20service\x20error:\x20','now','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20',',\x20payment\x20age:\x20','\x0aüìà\x20Cleanup\x20Summary:','FAILED','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','includes','POST','FAST_TIMEOUT_MINUTES','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','5859lGAWjo','logApiCall','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','\x20\x20\x20Amount:\x20','shop','Cleanup\x20completed:\x20','createdAt','findMany','ACTIVE','Unknown\x20error','PaymentStatus','\x20\x20\x20Created:\x20','FAST_TIMEOUT_GATEWAYS','errors','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','getTime','loggerService','visa/mastercard','byAge','oxapay','cleanupStalePendingPayments','total','__importDefault','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','Cleanup\x20service\x20error:\x20','getDate','logWebhookError','Failed\x20to\x20expire\x20link\x20','toISOString','expired','log','cleanupStaleProcessingPayments','\x20\x20\x20Gateway:\x20','floor','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','stale','üí•\x20','name','error','\x20\x20\x20Shop:\x20','334048avexxZ','PENDING','üìä\x20','üìã\x20Fast\x20timeout\x20gateways:\x20','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','606QKRxCu','logWebhookProcessed','‚úÖ\x20PENDING\x20payments\x20processed:\x20','55sbHfHX','\x20from\x20PENDING\x20to\x20EXPIRED','241065qBNIMK','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','fresh','../config/database','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','\x20minutes)','runCleanupWithReport','Failed\x20to\x20get\x20processing\x20payments\x20stats:','failed','SLOW_TIMEOUT_DAYS','admin','Failed\x20to\x20update\x20PENDING\x20payment\x20','PAID','getProcessingPaymentsStats','update','username','Failed\x20to\x20update\x20payment\x20','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','\x20\x20\x20Age:\x20','4842328YIxrCM','\x20stale\x20PENDING\x20payments','\x20\x20\x20By\x20status:','PROCESSING','\x20stale\x20PROCESSING\x20payments','üèÅ\x20PROCESSING\x20cleanup\x20completed','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','pending_payment_cleanup','123wwysER','processed','54MOBezk','byGateway','expireSinglePaymentLinks','auto_timeout_pending','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','üèÅ\x20PENDING\x20cleanup\x20completed','squirrel-pay','squirrelpay','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','amount','PENDING\x20cleanup\x20completed:\x20','forEach','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','11080gQHrQu','üèÅ\x20Payment\x20cleanup\x20service\x20completed','push','mastercard','gateway','system','\x20days','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','\x20timeout)','üîç\x20Found\x20','payment','PROCESSING_TIMEOUT_DAYS','@prisma/client','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','\x20minutes','length','message','plisio','EXPIRED','setDate','PaymentCleanupService','3889610xTYTzu','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','\x20\x20\x20Recent\x20(1-3\x20days):\x20','__esModule','1248002CXSgUi','\x20failed\x20to\x20update','\x20payments\x20updated\x20to\x20FAILED,\x20','byStatus','default','\x20\x20\x20By\x20gateway:','\x20\x20\x20\x20\x20\x20','defineProperty','3\x20days','round','runPendingCleanupOnly','paymentCleanupService','‚úÖ\x20Updated\x20payment\x20','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','PENDING_TIMEOUT_DAYS','runProcessingCleanupOnly','\x20active\x20SINGLE\x20links\x20to\x20check','\x20(gateway:\x20','üöÄ\x20Starting\x20payment\x20cleanup\x20service...'];a74_0x3858=function(){return _0x5a924e;};return a74_0x3858();}var __importDefault=this&&this[a74_0x51adec(0x139)]||function(_0x57cb87){const _0x5020e5=a74_0x51adec;return _0x57cb87&&_0x57cb87[_0x5020e5(0x198)]?_0x57cb87:{'default':_0x57cb87};};Object[a74_0x51adec(0x1a0)](exports,a74_0x51adec(0x198),{'value':!![]}),exports[a74_0x51adec(0x1a4)]=exports[a74_0x51adec(0x194)]=void 0x0;const database_1=__importDefault(require(a74_0x51adec(0x158))),client_1=require(a74_0x51adec(0x18c)),loggerService_1=require('./loggerService');function a74_0x5453(_0x33f563,_0x3d84fb){_0x33f563=_0x33f563-0x120;const _0x38580b=a74_0x3858();let _0x54532c=_0x38580b[_0x33f563];return _0x54532c;}class PaymentCleanupService{constructor(){const _0x1c6737=a74_0x51adec;this[_0x1c6737(0x18b)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x1c6737(0x120)]=0x1e,this[_0x1c6737(0x15e)]=0x3,this[_0x1c6737(0x12e)]=[_0x1c6737(0x179),_0x1c6737(0x178),'rapyd',_0x1c6737(0x134),_0x1c6737(0x191),'oxapay'];}async[a74_0x51adec(0x142)](){const _0x40705c=a74_0x51adec,_0x3288f5=[];let _0x1af4f6=0x0,_0x1233cd=0x0;try{console[_0x40705c(0x141)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x980d0f=new Date();_0x980d0f['setDate'](_0x980d0f[_0x40705c(0x13c)]()-this[_0x40705c(0x18b)]),console[_0x40705c(0x141)](_0x40705c(0x13a)+_0x980d0f[_0x40705c(0x13f)]());const _0x693c=await database_1[_0x40705c(0x19d)][_0x40705c(0x18a)][_0x40705c(0x129)]({'where':{'status':client_1[_0x40705c(0x12c)][_0x40705c(0x16b)],'createdAt':{'lt':_0x980d0f}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x40705c(0x141)](_0x40705c(0x189)+_0x693c[_0x40705c(0x18f)]+_0x40705c(0x16c));if(_0x693c[_0x40705c(0x18f)]===0x0)return console['log'](_0x40705c(0x17a)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x4c95e4 of _0x693c){try{console[_0x40705c(0x141)](_0x40705c(0x176)+_0x4c95e4['id']+'\x20('+_0x4c95e4['gateway']+',\x20'+_0x4c95e4[_0x40705c(0x17b)]+'\x20'+_0x4c95e4[_0x40705c(0x1ae)]+')'),console['log'](_0x40705c(0x14a)+_0x4c95e4[_0x40705c(0x126)][_0x40705c(0x148)]+'\x20('+_0x4c95e4[_0x40705c(0x126)][_0x40705c(0x164)]+')'),console[_0x40705c(0x141)]('\x20\x20\x20Created:\x20'+_0x4c95e4['createdAt'][_0x40705c(0x13f)]()),console[_0x40705c(0x141)](_0x40705c(0x167)+Math['floor']((Date[_0x40705c(0x1b4)]()-_0x4c95e4[_0x40705c(0x128)][_0x40705c(0x132)]())/(0x3e8*0x3c*0x3c*0x18))+_0x40705c(0x185));const _0x496765=await database_1['default'][_0x40705c(0x18a)]['update']({'where':{'id':_0x4c95e4['id']},'data':{'status':client_1[_0x40705c(0x12c)][_0x40705c(0x1b9)],'statusChangedBy':_0x40705c(0x184),'statusChangedAt':new Date(),'failureMessage':_0x40705c(0x130)+this[_0x40705c(0x18b)]+_0x40705c(0x185)}});console[_0x40705c(0x141)](_0x40705c(0x1a5)+_0x4c95e4['id']+_0x40705c(0x1af)),loggerService_1['loggerService']['logWebhookProcessed'](_0x4c95e4[_0x40705c(0x183)],_0x4c95e4['id'],_0x40705c(0x16b),_0x40705c(0x1b9),{'reason':'auto_timeout','timeoutDays':this[_0x40705c(0x18b)]}),_0x1af4f6++;}catch(_0x1aba96){const _0x3a909b=_0x40705c(0x165)+_0x4c95e4['id']+':\x20'+(_0x1aba96 instanceof Error?_0x1aba96['message']:_0x40705c(0x12b));console[_0x40705c(0x149)]('‚ùå\x20'+_0x3a909b),_0x3288f5[_0x40705c(0x181)](_0x3a909b),_0x1233cd++;}}const _0x48e3a8=_0x40705c(0x127)+_0x1af4f6+_0x40705c(0x19b)+_0x1233cd+_0x40705c(0x19a);return console[_0x40705c(0x141)](_0x40705c(0x14d)+_0x48e3a8),loggerService_1[_0x40705c(0x133)][_0x40705c(0x123)](_0x40705c(0x1ac),_0x40705c(0x1bd),_0x40705c(0x184),_0x40705c(0x15f),{'processed':_0x1af4f6,'failed':_0x1233cd,'errors':_0x3288f5,'timeoutDays':this[_0x40705c(0x18b)]}),{'processed':_0x1af4f6,'failed':_0x1233cd,'errors':_0x3288f5};}catch(_0x161bf3){const _0x26042c=_0x40705c(0x13b)+(_0x161bf3 instanceof Error?_0x161bf3[_0x40705c(0x190)]:_0x40705c(0x12b));return console[_0x40705c(0x149)](_0x40705c(0x147)+_0x26042c),_0x3288f5[_0x40705c(0x181)](_0x26042c),loggerService_1[_0x40705c(0x133)][_0x40705c(0x13d)](_0x40705c(0x1ac),_0x26042c,{'timeoutDays':this[_0x40705c(0x18b)]}),{'processed':_0x1af4f6,'failed':_0x1233cd,'errors':_0x3288f5};}}async[a74_0x51adec(0x137)](){const _0x6cd763=a74_0x51adec,_0x46328e=[];let _0x1ca07d=0x0,_0x26a31c=0x0;try{console[_0x6cd763(0x141)](_0x6cd763(0x1b5));const _0x3ab33e=new Date(),_0x210fbf=new Date(_0x3ab33e[_0x6cd763(0x132)]()-this[_0x6cd763(0x120)]*0x3c*0x3e8),_0x2fc768=new Date();_0x2fc768[_0x6cd763(0x193)](_0x2fc768[_0x6cd763(0x13c)]()-this[_0x6cd763(0x15e)]),console[_0x6cd763(0x141)]('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x210fbf[_0x6cd763(0x13f)]()),console['log'](_0x6cd763(0x186)+_0x2fc768[_0x6cd763(0x13f)]()),console[_0x6cd763(0x141)](_0x6cd763(0x14e)+this[_0x6cd763(0x12e)]['join'](',\x20'));const _0x4ceaea=await database_1[_0x6cd763(0x19d)][_0x6cd763(0x18a)][_0x6cd763(0x129)]({'where':{'status':client_1[_0x6cd763(0x12c)][_0x6cd763(0x14c)],'OR':[{'gateway':{'in':this[_0x6cd763(0x12e)]},'createdAt':{'lt':_0x210fbf}},{'gateway':{'notIn':this[_0x6cd763(0x12e)]},'createdAt':{'lt':_0x2fc768}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x6cd763(0x141)](_0x6cd763(0x189)+_0x4ceaea[_0x6cd763(0x18f)]+_0x6cd763(0x169));if(_0x4ceaea[_0x6cd763(0x18f)]===0x0)return console['log']('‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x3a2a33 of _0x4ceaea){try{const _0x18620e=this[_0x6cd763(0x12e)][_0x6cd763(0x1bc)](_0x3a2a33[_0x6cd763(0x183)]),_0x5530b1=_0x18620e?'30\x20minutes':_0x6cd763(0x1a1),_0x697aa6=Math[_0x6cd763(0x144)]((Date[_0x6cd763(0x1b4)]()-_0x3a2a33[_0x6cd763(0x128)][_0x6cd763(0x132)]())/(0x3e8*0x3c));console['log'](_0x6cd763(0x1bb)+_0x3a2a33['id']),console[_0x6cd763(0x141)](_0x6cd763(0x143)+_0x3a2a33[_0x6cd763(0x183)]+'\x20('+_0x5530b1+_0x6cd763(0x188)),console[_0x6cd763(0x141)](_0x6cd763(0x125)+_0x3a2a33[_0x6cd763(0x17b)]+'\x20'+_0x3a2a33[_0x6cd763(0x1ae)]),console['log'](_0x6cd763(0x14a)+_0x3a2a33['shop'][_0x6cd763(0x148)]+'\x20('+_0x3a2a33[_0x6cd763(0x126)]['username']+')'),console[_0x6cd763(0x141)](_0x6cd763(0x12d)+_0x3a2a33[_0x6cd763(0x128)][_0x6cd763(0x13f)]()),console['log'](_0x6cd763(0x167)+_0x697aa6+_0x6cd763(0x18e));const _0x34843e=await database_1[_0x6cd763(0x19d)][_0x6cd763(0x18a)][_0x6cd763(0x163)]({'where':{'id':_0x3a2a33['id']},'data':{'status':client_1[_0x6cd763(0x12c)]['EXPIRED'],'statusChangedBy':_0x6cd763(0x184),'statusChangedAt':new Date(),'failureMessage':_0x6cd763(0x1b6)+_0x5530b1}});console[_0x6cd763(0x141)](_0x6cd763(0x1a5)+_0x3a2a33['id']+_0x6cd763(0x154)),loggerService_1[_0x6cd763(0x133)][_0x6cd763(0x151)](_0x3a2a33['gateway'],_0x3a2a33['id'],_0x6cd763(0x14c),'EXPIRED',{'reason':_0x6cd763(0x175),'timeout':_0x5530b1,'ageMinutes':_0x697aa6}),_0x1ca07d++;}catch(_0x4c2368){const _0x4f4bfd=_0x6cd763(0x160)+_0x3a2a33['id']+':\x20'+(_0x4c2368 instanceof Error?_0x4c2368['message']:'Unknown\x20error');console[_0x6cd763(0x149)]('‚ùå\x20'+_0x4f4bfd),_0x46328e[_0x6cd763(0x181)](_0x4f4bfd),_0x26a31c++;}}const _0x31b267=_0x6cd763(0x17c)+_0x1ca07d+'\x20payments\x20updated\x20to\x20EXPIRED,\x20'+_0x26a31c+_0x6cd763(0x19a);return console[_0x6cd763(0x141)](_0x6cd763(0x14d)+_0x31b267),loggerService_1[_0x6cd763(0x133)][_0x6cd763(0x123)](_0x6cd763(0x16f),_0x6cd763(0x1bd),_0x6cd763(0x184),'admin',{'processed':_0x1ca07d,'failed':_0x26a31c,'errors':_0x46328e,'fastTimeoutMinutes':this[_0x6cd763(0x120)],'slowTimeoutDays':this[_0x6cd763(0x15e)]}),{'processed':_0x1ca07d,'failed':_0x26a31c,'errors':_0x46328e};}catch(_0xb52cd8){const _0x521d18='PENDING\x20cleanup\x20service\x20error:\x20'+(_0xb52cd8 instanceof Error?_0xb52cd8[_0x6cd763(0x190)]:_0x6cd763(0x12b));return console['error'](_0x6cd763(0x147)+_0x521d18),_0x46328e['push'](_0x521d18),loggerService_1['loggerService'][_0x6cd763(0x13d)](_0x6cd763(0x16f),_0x521d18,{'timeoutDays':this[_0x6cd763(0x1a7)]}),{'processed':_0x1ca07d,'failed':_0x26a31c,'errors':_0x46328e};}}async[a74_0x51adec(0x162)](){const _0x4759cf=a74_0x51adec;try{const _0x224523=new Date(),_0x492935=new Date(_0x224523[_0x4759cf(0x132)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x41d601=new Date(_0x224523['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x4cb6da=new Date(_0x224523['getTime']()-0x5*0x18*0x3c*0x3c*0x3e8),_0x3de125=await database_1[_0x4759cf(0x19d)][_0x4759cf(0x18a)]['findMany']({'where':{'status':{'in':[client_1[_0x4759cf(0x12c)][_0x4759cf(0x16b)],client_1['PaymentStatus'][_0x4759cf(0x14c)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x3af245={'total':_0x3de125['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x3c28c1 of _0x3de125){if(_0x3c28c1[_0x4759cf(0x128)]>_0x492935)_0x3af245[_0x4759cf(0x135)][_0x4759cf(0x157)]++;else{if(_0x3c28c1[_0x4759cf(0x128)]>_0x41d601)_0x3af245['byAge']['recent']++;else _0x3c28c1[_0x4759cf(0x128)]>_0x4cb6da?_0x3af245[_0x4759cf(0x135)][_0x4759cf(0x146)]++:_0x3af245[_0x4759cf(0x135)][_0x4759cf(0x140)]++;}!_0x3af245[_0x4759cf(0x173)][_0x3c28c1[_0x4759cf(0x183)]]&&(_0x3af245[_0x4759cf(0x173)][_0x3c28c1[_0x4759cf(0x183)]]=0x0);_0x3af245[_0x4759cf(0x173)][_0x3c28c1[_0x4759cf(0x183)]]++;const _0x5d08c6=_0x3c28c1[_0x4759cf(0x1ad)];!_0x3af245[_0x4759cf(0x19c)][_0x5d08c6]&&(_0x3af245[_0x4759cf(0x19c)][_0x5d08c6]=0x0),_0x3af245['byStatus'][_0x5d08c6]++;}return _0x3af245;}catch(_0x384933){console[_0x4759cf(0x149)](_0x4759cf(0x15c),_0x384933);throw new Error('Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20'+(_0x384933 instanceof Error?_0x384933[_0x4759cf(0x190)]:_0x4759cf(0x12b)));}}async[a74_0x51adec(0x15b)](){const _0xe93f1b=a74_0x51adec;console[_0xe93f1b(0x141)](_0xe93f1b(0x1ab));const _0x8c216e=await this[_0xe93f1b(0x162)]();console[_0xe93f1b(0x141)](_0xe93f1b(0x17e)),console[_0xe93f1b(0x141)]('\x20\x20\x20Total:\x20'+_0x8c216e['total']),console[_0xe93f1b(0x141)](_0xe93f1b(0x124)+_0x8c216e[_0xe93f1b(0x135)][_0xe93f1b(0x157)]),console['log'](_0xe93f1b(0x197)+_0x8c216e[_0xe93f1b(0x135)]['recent']),console[_0xe93f1b(0x141)]('\x20\x20\x20Stale\x20(3-5\x20days):\x20'+_0x8c216e['byAge']['stale']),console[_0xe93f1b(0x141)](_0xe93f1b(0x16e)+_0x8c216e[_0xe93f1b(0x135)][_0xe93f1b(0x140)]),console['log'](_0xe93f1b(0x19e),_0x8c216e[_0xe93f1b(0x173)]),console[_0xe93f1b(0x141)](_0xe93f1b(0x16a),_0x8c216e[_0xe93f1b(0x19c)]),console[_0xe93f1b(0x141)](_0xe93f1b(0x1b2));const _0x4b96da=await this[_0xe93f1b(0x142)]();console[_0xe93f1b(0x141)](_0xe93f1b(0x196));const _0x174dc8=await this[_0xe93f1b(0x137)](),_0x32d855=await this['getProcessingPaymentsStats']();console[_0xe93f1b(0x141)](_0xe93f1b(0x131)),console[_0xe93f1b(0x141)]('\x20\x20\x20Total:\x20'+_0x32d855['total']),console['log'](_0xe93f1b(0x16e)+_0x32d855[_0xe93f1b(0x135)]['expired']),console[_0xe93f1b(0x141)](_0xe93f1b(0x16a),_0x32d855[_0xe93f1b(0x19c)]);const _0x2494a9=_0x4b96da[_0xe93f1b(0x171)]+_0x174dc8[_0xe93f1b(0x171)],_0x403412=_0x4b96da[_0xe93f1b(0x15d)]+_0x174dc8[_0xe93f1b(0x15d)],_0x104721=[..._0x4b96da[_0xe93f1b(0x12f)],..._0x174dc8[_0xe93f1b(0x12f)]];console[_0xe93f1b(0x141)](_0xe93f1b(0x1b8)),console[_0xe93f1b(0x141)](_0xe93f1b(0x187)+_0x4b96da[_0xe93f1b(0x171)]),console[_0xe93f1b(0x141)](_0xe93f1b(0x1a6)+_0x174dc8[_0xe93f1b(0x171)]),console['log'](_0xe93f1b(0x156)+_0x2494a9),console['log'](_0xe93f1b(0x159)+_0x403412),console[_0xe93f1b(0x141)]('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x8c216e[_0xe93f1b(0x138)]-_0x32d855[_0xe93f1b(0x138)])),_0x104721[_0xe93f1b(0x18f)]>0x0&&(console[_0xe93f1b(0x141)](_0xe93f1b(0x121)),_0x104721[_0xe93f1b(0x17d)]((_0x52b8bc,_0x6e9ad1)=>{const _0x5d15f3=_0xe93f1b;console[_0x5d15f3(0x141)](_0x5d15f3(0x19f)+(_0x6e9ad1+0x1)+'.\x20'+_0x52b8bc);})),console[_0xe93f1b(0x141)](_0xe93f1b(0x180));}async[a74_0x51adec(0x1a8)](){const _0xe6c59=a74_0x51adec;console['log']('üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...');const _0x377990=await this[_0xe6c59(0x162)](),_0x432a4f=_0x377990['byStatus'][_0xe6c59(0x16b)]||0x0;console['log'](_0xe6c59(0x18d)+_0x432a4f);const _0xea9762=await this['cleanupStaleProcessingPayments'](),_0x45bfa3=await this['getProcessingPaymentsStats'](),_0x3b0c78=_0x45bfa3[_0xe6c59(0x19c)][_0xe6c59(0x16b)]||0x0;console[_0xe6c59(0x141)]('üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20'+_0x3b0c78),console[_0xe6c59(0x141)](_0xe6c59(0x14f)+_0xea9762['processed']),console[_0xe6c59(0x141)](_0xe6c59(0x16d));}async[a74_0x51adec(0x1a3)](){const _0x41ecd9=a74_0x51adec;console[_0x41ecd9(0x141)]('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x4291b9=await this[_0x41ecd9(0x162)](),_0x55685f=_0x4291b9[_0x41ecd9(0x19c)][_0x41ecd9(0x14c)]||0x0;console[_0x41ecd9(0x141)](_0x41ecd9(0x145)+_0x55685f);const _0x10fb40=await this[_0x41ecd9(0x137)](),_0x1a01ef=await this[_0x41ecd9(0x162)](),_0x317576=_0x1a01ef[_0x41ecd9(0x19c)][_0x41ecd9(0x14c)]||0x0;console[_0x41ecd9(0x141)](_0x41ecd9(0x166)+_0x317576),console[_0x41ecd9(0x141)](_0x41ecd9(0x152)+_0x10fb40[_0x41ecd9(0x171)]),console['log'](_0x41ecd9(0x177));}async[a74_0x51adec(0x174)](){const _0x19f1c1=a74_0x51adec,_0x385b9c=[];let _0x5185de=0x0;try{console['log'](_0x19f1c1(0x1ba));const _0x3522b9=new Date(),_0x3705fa=[_0x19f1c1(0x136),_0x19f1c1(0x191)],_0x3be7e8=[_0x19f1c1(0x179),_0x19f1c1(0x1b0),_0x19f1c1(0x134),_0x19f1c1(0x182)],_0x6617ce=await database_1[_0x19f1c1(0x19d)]['paymentLink'][_0x19f1c1(0x129)]({'where':{'type':'SINGLE','status':_0x19f1c1(0x12a)},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x19f1c1(0x141)](_0x19f1c1(0x189)+_0x6617ce['length']+_0x19f1c1(0x1a9));for(const _0x5ccf71 of _0x6617ce){try{if(_0x5ccf71[_0x19f1c1(0x1b1)][_0x19f1c1(0x18f)]===0x0)continue;const _0x2999fa=_0x5ccf71[_0x19f1c1(0x1b1)][0x0];if(_0x2999fa[_0x19f1c1(0x1ad)]===_0x19f1c1(0x161))continue;const _0x5542d7=_0x3522b9[_0x19f1c1(0x132)]()-_0x2999fa[_0x19f1c1(0x128)][_0x19f1c1(0x132)]();let _0x162573;_0x3705fa[_0x19f1c1(0x1bc)](_0x5ccf71[_0x19f1c1(0x183)])||_0x3be7e8[_0x19f1c1(0x1bc)](_0x5ccf71[_0x19f1c1(0x183)])?_0x162573=0x1e*0x3c*0x3e8:_0x162573=0x3*0x18*0x3c*0x3c*0x3e8,_0x5542d7>_0x162573&&(await database_1['default']['paymentLink'][_0x19f1c1(0x163)]({'where':{'id':_0x5ccf71['id']},'data':{'status':_0x19f1c1(0x192)}}),console[_0x19f1c1(0x141)]('‚è∞\x20Expired\x20link\x20'+_0x5ccf71['id']+_0x19f1c1(0x1aa)+_0x5ccf71[_0x19f1c1(0x183)]+_0x19f1c1(0x1b7)+Math[_0x19f1c1(0x1a2)](_0x5542d7/0x3e8/0x3c)+_0x19f1c1(0x15a)),_0x5185de++);}catch(_0x5aed4f){const _0x5b0b69=_0x19f1c1(0x13e)+_0x5ccf71['id']+':\x20'+(_0x5aed4f instanceof Error?_0x5aed4f[_0x19f1c1(0x190)]:_0x19f1c1(0x12b));console[_0x19f1c1(0x149)]('‚ùå\x20'+_0x5b0b69),_0x385b9c[_0x19f1c1(0x181)](_0x5b0b69);}}return console[_0x19f1c1(0x141)]('üìä\x20Expiration\x20completed:\x20'+_0x5185de+'\x20links\x20expired'),{'expired':_0x5185de,'errors':_0x385b9c};}catch(_0x3cb7d9){const _0x242cb2=_0x19f1c1(0x1b3)+(_0x3cb7d9 instanceof Error?_0x3cb7d9[_0x19f1c1(0x190)]:_0x19f1c1(0x12b));return console[_0x19f1c1(0x149)](_0x19f1c1(0x147)+_0x242cb2),_0x385b9c[_0x19f1c1(0x181)](_0x242cb2),{'expired':_0x5185de,'errors':_0x385b9c};}}}exports['PaymentCleanupService']=PaymentCleanupService,exports[a74_0x51adec(0x1a4)]=new PaymentCleanupService();