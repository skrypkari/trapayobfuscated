'use strict';const a76_0x3614da=a76_0x5068;function a76_0x5068(_0x1c8b54,_0x4174fb){_0x1c8b54=_0x1c8b54-0xb8;const _0x19dd98=a76_0x19dd();let _0x506802=_0x19dd98[_0x1c8b54];return _0x506802;}function a76_0x19dd(){const _0x15f67c=['gateway','ğŸš€\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','total','Unknown\x20error','\x20days','PENDING_TIMEOUT_DAYS','__esModule','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','failed','setDate','ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','loggerService','includes','mastercard','689106tgwzZc','PROCESSING_TIMEOUT_DAYS','length','\x20from\x20PENDING\x20to\x20EXPIRED','\x20active\x20SINGLE\x20links\x20to\x20check','logWebhookProcessed','status','ğŸ’¥\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','getProcessingPaymentsStats','\x20from\x20PROCESSING\x20to\x20FAILED','desc','1793856TagyDR','\x20minutes','\x20(gateway:\x20','oxapay','squirrelpay','\x20\x20\x20By\x20gateway:','ğŸ“…\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','ğŸ\x20Payment\x20cleanup\x20service\x20completed','\x20\x20\x20Age:\x20','ğŸ\x20PROCESSING\x20cleanup\x20completed','\x20failed\x20to\x20update','8omFvTH','plisio','\x20\x20\x20Recent\x20(1-3\x20days):\x20','\x20\x20\x20Total:\x20','ğŸ“Š\x20','EXPIRED','10739349neYBUM','byAge','shop','PROCESSING','\x20\x20\x20Gateway:\x20','\x20\x20\x20âœ…\x20Total\x20successfully\x20processed:\x20','\x20stale\x20PENDING\x20payments','98icQWWC','auto_timeout_pending','\x20\x20\x20ğŸ“‰\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','processed','rapyd','system','\x20\x20\x20By\x20status:','PENDING\x20cleanup\x20service\x20error:\x20','getTime','ğŸ“Š\x20PENDING\x20payments\x20before\x20cleanup:\x20','ğŸ“…\x20Fast\x20timeout\x20(30\x20min):\x20','expireSinglePaymentLinks','FAILED','PaymentStatus','â°\x20Expired\x20link\x20','âœ…\x20PROCESSING\x20payments\x20processed:\x20','error','âœ…\x20PENDING\x20payments\x20processed:\x20','ğŸ“Š\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','PENDING','â°\x20Processing\x20stale\x20PENDING\x20payment:\x20','ğŸ”\x20Found\x20','payment','2799567WVKcwE','SLOW_TIMEOUT_DAYS','ğŸ\x20PENDING\x20cleanup\x20completed','findMany','expired','errors','toISOString','../config/database','PaymentCleanupService','./loggerService','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','paymentLink','fresh','logWebhookError','ğŸ“‹\x20Fast\x20timeout\x20gateways:\x20','name','\x20payments\x20updated\x20to\x20EXPIRED,\x20','\x0ağŸ“ˆ\x20Cleanup\x20Summary:','update','now','\x20\x20\x20Stale\x20(3-5\x20days):\x20','FAST_TIMEOUT_GATEWAYS','admin','3963582GnEYYr','450215ZYZWJD','message','Failed\x20to\x20update\x20payment\x20','\x20\x20\x20âŒ\x20Total\x20failed\x20to\x20process:\x20','\x20\x20\x20Created:\x20','\x20\x20\x20\x20\x20\x20','floor','username','Cleanup\x20completed:\x20','âœ…\x20No\x20stale\x20PROCESSING\x20payments\x20found','currency','log','amount','ğŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','join','SINGLE','payment_cleanup','byGateway','\x20minutes)','ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','visa/mastercard','PENDING\x20cleanup\x20completed:\x20','FAST_TIMEOUT_MINUTES','default','âœ…\x20Updated\x20payment\x20','@prisma/client','stale','defineProperty','ğŸ“Š\x20PENDING\x20payments\x20after\x20cleanup:\x20','Link\x20expiration\x20service\x20error:\x20','\x0ağŸ”„\x20Running\x20PROCESSING\x20payments\x20cleanup...','byStatus','30\x20minutes','â±ï¸\x20Processing\x20stale\x20payment:\x20','Failed\x20to\x20update\x20PENDING\x20payment\x20','logApiCall','createdAt','\x20payments\x20updated\x20to\x20FAILED,\x20',',\x20payment\x20age:\x20','Cleanup\x20service\x20error:\x20','getDate','runProcessingCleanupOnly','runPendingCleanupOnly','cleanupStaleProcessingPayments','push','\x20timeout)','23848EeGBJR','POST','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','âœ…\x20No\x20stale\x20PENDING\x20payments\x20found','recent','\x20\x20\x20Shop:\x20','cleanupStalePendingPayments'];a76_0x19dd=function(){return _0x15f67c;};return a76_0x19dd();}(function(_0x5abcf2,_0xe1a100){const _0x4bb4b5=a76_0x5068,_0x59646c=_0x5abcf2();while(!![]){try{const _0x17a73d=-parseInt(_0x4bb4b5(0xbb))/0x1+parseInt(_0x4bb4b5(0xc7))/0x2+-parseInt(_0x4bb4b5(0xf6))/0x3+-parseInt(_0x4bb4b5(0xd2))/0x4*(parseInt(_0x4bb4b5(0x10e))/0x5)+parseInt(_0x4bb4b5(0x10d))/0x6+parseInt(_0x4bb4b5(0xdf))/0x7*(-parseInt(_0x4bb4b5(0x13c))/0x8)+parseInt(_0x4bb4b5(0xd8))/0x9;if(_0x17a73d===_0xe1a100)break;else _0x59646c['push'](_0x59646c['shift']());}catch(_0x214b56){_0x59646c['push'](_0x59646c['shift']());}}}(a76_0x19dd,0xdd5af));var __importDefault=this&&this['__importDefault']||function(_0x4ac4ba){return _0x4ac4ba&&_0x4ac4ba['__esModule']?_0x4ac4ba:{'default':_0x4ac4ba};};Object[a76_0x3614da(0x129)](exports,a76_0x3614da(0x149),{'value':!![]}),exports['paymentCleanupService']=exports[a76_0x3614da(0xfe)]=void 0x0;const database_1=__importDefault(require(a76_0x3614da(0xfd))),client_1=require(a76_0x3614da(0x127)),loggerService_1=require(a76_0x3614da(0xff));class PaymentCleanupService{constructor(){const _0x43e334=a76_0x3614da;this[_0x43e334(0xbc)]=0x5,this[_0x43e334(0x148)]=0x5,this['FAST_TIMEOUT_MINUTES']=0x1e,this[_0x43e334(0xf7)]=0x3,this[_0x43e334(0x10b)]=[_0x43e334(0xcb),'squirrel-pay',_0x43e334(0xe3),_0x43e334(0x122),_0x43e334(0xd3),_0x43e334(0xca)];}async[a76_0x3614da(0x139)](){const _0x71be2e=a76_0x3614da,_0x5dc99c=[];let _0x25608c=0x0,_0x62bab=0x0;try{console[_0x71be2e(0x119)](_0x71be2e(0x14d));const _0x2bcae6=new Date();_0x2bcae6['setDate'](_0x2bcae6[_0x71be2e(0x136)]()-this[_0x71be2e(0xbc)]),console[_0x71be2e(0x119)](_0x71be2e(0xcd)+_0x2bcae6['toISOString']());const _0x2322b7=await database_1[_0x71be2e(0x125)][_0x71be2e(0xf5)][_0x71be2e(0xf9)]({'where':{'status':client_1[_0x71be2e(0xec)][_0x71be2e(0xdb)],'createdAt':{'lt':_0x2bcae6}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x71be2e(0x119)](_0x71be2e(0xf4)+_0x2322b7[_0x71be2e(0xbd)]+'\x20stale\x20PROCESSING\x20payments');if(_0x2322b7[_0x71be2e(0xbd)]===0x0)return console[_0x71be2e(0x119)](_0x71be2e(0x117)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x1aee47 of _0x2322b7){try{console[_0x71be2e(0x119)](_0x71be2e(0x12f)+_0x1aee47['id']+'\x20('+_0x1aee47[_0x71be2e(0x143)]+',\x20'+_0x1aee47[_0x71be2e(0x11a)]+'\x20'+_0x1aee47[_0x71be2e(0x118)]+')'),console[_0x71be2e(0x119)](_0x71be2e(0x141)+_0x1aee47[_0x71be2e(0xda)][_0x71be2e(0x105)]+'\x20('+_0x1aee47['shop']['username']+')'),console[_0x71be2e(0x119)](_0x71be2e(0x112)+_0x1aee47[_0x71be2e(0x132)]['toISOString']()),console[_0x71be2e(0x119)](_0x71be2e(0xcf)+Math[_0x71be2e(0x114)]((Date[_0x71be2e(0x109)]()-_0x1aee47[_0x71be2e(0x132)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))+_0x71be2e(0x147));const _0x4008f0=await database_1[_0x71be2e(0x125)][_0x71be2e(0xf5)]['update']({'where':{'id':_0x1aee47['id']},'data':{'status':client_1['PaymentStatus'][_0x71be2e(0xeb)],'statusChangedBy':_0x71be2e(0xe4),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this[_0x71be2e(0xbc)]+_0x71be2e(0x147)}});console[_0x71be2e(0x119)](_0x71be2e(0x126)+_0x1aee47['id']+_0x71be2e(0xc5)),loggerService_1['loggerService'][_0x71be2e(0xc0)](_0x1aee47[_0x71be2e(0x143)],_0x1aee47['id'],_0x71be2e(0xdb),_0x71be2e(0xeb),{'reason':'auto_timeout','timeoutDays':this[_0x71be2e(0xbc)]}),_0x25608c++;}catch(_0x3d5382){const _0x25bffa=_0x71be2e(0x110)+_0x1aee47['id']+':\x20'+(_0x3d5382 instanceof Error?_0x3d5382[_0x71be2e(0x10f)]:_0x71be2e(0x146));console[_0x71be2e(0xef)]('âŒ\x20'+_0x25bffa),_0x5dc99c[_0x71be2e(0x13a)](_0x25bffa),_0x62bab++;}}const _0x242c21=_0x71be2e(0x116)+_0x25608c+_0x71be2e(0x133)+_0x62bab+_0x71be2e(0xd1);return console['log']('ğŸ“Š\x20'+_0x242c21),loggerService_1['loggerService'][_0x71be2e(0x131)](_0x71be2e(0x11e),_0x71be2e(0x13d),_0x71be2e(0xe4),_0x71be2e(0x10c),{'processed':_0x25608c,'failed':_0x62bab,'errors':_0x5dc99c,'timeoutDays':this[_0x71be2e(0xbc)]}),{'processed':_0x25608c,'failed':_0x62bab,'errors':_0x5dc99c};}catch(_0x4abf76){const _0x82b561=_0x71be2e(0x135)+(_0x4abf76 instanceof Error?_0x4abf76[_0x71be2e(0x10f)]:'Unknown\x20error');return console['error'](_0x71be2e(0xc2)+_0x82b561),_0x5dc99c[_0x71be2e(0x13a)](_0x82b561),loggerService_1[_0x71be2e(0xb8)]['logWebhookError'](_0x71be2e(0x11e),_0x82b561,{'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x25608c,'failed':_0x62bab,'errors':_0x5dc99c};}}async['cleanupStalePendingPayments'](){const _0x2fa670=a76_0x3614da,_0x2f5e74=[];let _0x54b804=0x0,_0x4a6bcf=0x0;try{console[_0x2fa670(0x119)](_0x2fa670(0x121));const _0x24016a=new Date(),_0x44be0e=new Date(_0x24016a['getTime']()-this[_0x2fa670(0x124)]*0x3c*0x3e8),_0xb1525f=new Date();_0xb1525f[_0x2fa670(0x14c)](_0xb1525f[_0x2fa670(0x136)]()-this[_0x2fa670(0xf7)]),console['log'](_0x2fa670(0xe9)+_0x44be0e[_0x2fa670(0xfc)]()),console[_0x2fa670(0x119)]('ğŸ“…\x20Slow\x20timeout\x20(3\x20days):\x20'+_0xb1525f[_0x2fa670(0xfc)]()),console[_0x2fa670(0x119)](_0x2fa670(0x104)+this[_0x2fa670(0x10b)][_0x2fa670(0x11c)](',\x20'));const _0x40d787=await database_1[_0x2fa670(0x125)][_0x2fa670(0xf5)][_0x2fa670(0xf9)]({'where':{'status':client_1[_0x2fa670(0xec)][_0x2fa670(0xf2)],'OR':[{'gateway':{'in':this[_0x2fa670(0x10b)]},'createdAt':{'lt':_0x44be0e}},{'gateway':{'notIn':this[_0x2fa670(0x10b)]},'createdAt':{'lt':_0xb1525f}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2fa670(0x119)](_0x2fa670(0xf4)+_0x40d787[_0x2fa670(0xbd)]+_0x2fa670(0xde));if(_0x40d787[_0x2fa670(0xbd)]===0x0)return console[_0x2fa670(0x119)](_0x2fa670(0x13f)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x5387ec of _0x40d787){try{const _0x2fd0a5=this[_0x2fa670(0x10b)]['includes'](_0x5387ec[_0x2fa670(0x143)]),_0x3777cb=_0x2fd0a5?_0x2fa670(0x12e):'3\x20days',_0x54d38d=Math[_0x2fa670(0x114)]((Date['now']()-_0x5387ec[_0x2fa670(0x132)][_0x2fa670(0xe7)]())/(0x3e8*0x3c));console[_0x2fa670(0x119)](_0x2fa670(0xf3)+_0x5387ec['id']),console[_0x2fa670(0x119)](_0x2fa670(0xdc)+_0x5387ec[_0x2fa670(0x143)]+'\x20('+_0x3777cb+_0x2fa670(0x13b)),console[_0x2fa670(0x119)]('\x20\x20\x20Amount:\x20'+_0x5387ec[_0x2fa670(0x11a)]+'\x20'+_0x5387ec[_0x2fa670(0x118)]),console[_0x2fa670(0x119)](_0x2fa670(0x141)+_0x5387ec[_0x2fa670(0xda)][_0x2fa670(0x105)]+'\x20('+_0x5387ec[_0x2fa670(0xda)][_0x2fa670(0x115)]+')'),console[_0x2fa670(0x119)]('\x20\x20\x20Created:\x20'+_0x5387ec[_0x2fa670(0x132)][_0x2fa670(0xfc)]()),console[_0x2fa670(0x119)](_0x2fa670(0xcf)+_0x54d38d+_0x2fa670(0xc8));const _0x2ab4a8=await database_1[_0x2fa670(0x125)][_0x2fa670(0xf5)][_0x2fa670(0x108)]({'where':{'id':_0x5387ec['id']},'data':{'status':client_1[_0x2fa670(0xec)][_0x2fa670(0xd7)],'statusChangedBy':_0x2fa670(0xe4),'statusChangedAt':new Date(),'failureMessage':_0x2fa670(0x100)+_0x3777cb}});console[_0x2fa670(0x119)](_0x2fa670(0x126)+_0x5387ec['id']+_0x2fa670(0xbe)),loggerService_1[_0x2fa670(0xb8)][_0x2fa670(0xc0)](_0x5387ec[_0x2fa670(0x143)],_0x5387ec['id'],_0x2fa670(0xf2),_0x2fa670(0xd7),{'reason':_0x2fa670(0xe0),'timeout':_0x3777cb,'ageMinutes':_0x54d38d}),_0x54b804++;}catch(_0x1418f7){const _0x1c26af=_0x2fa670(0x130)+_0x5387ec['id']+':\x20'+(_0x1418f7 instanceof Error?_0x1418f7[_0x2fa670(0x10f)]:_0x2fa670(0x146));console[_0x2fa670(0xef)]('âŒ\x20'+_0x1c26af),_0x2f5e74['push'](_0x1c26af),_0x4a6bcf++;}}const _0x11ee40=_0x2fa670(0x123)+_0x54b804+_0x2fa670(0x106)+_0x4a6bcf+'\x20failed\x20to\x20update';return console['log'](_0x2fa670(0xd6)+_0x11ee40),loggerService_1['loggerService'][_0x2fa670(0x131)]('pending_payment_cleanup',_0x2fa670(0x13d),'system',_0x2fa670(0x10c),{'processed':_0x54b804,'failed':_0x4a6bcf,'errors':_0x2f5e74,'fastTimeoutMinutes':this[_0x2fa670(0x124)],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0x54b804,'failed':_0x4a6bcf,'errors':_0x2f5e74};}catch(_0x2ab17c){const _0x2dced4=_0x2fa670(0xe6)+(_0x2ab17c instanceof Error?_0x2ab17c[_0x2fa670(0x10f)]:_0x2fa670(0x146));return console[_0x2fa670(0xef)]('ğŸ’¥\x20'+_0x2dced4),_0x2f5e74[_0x2fa670(0x13a)](_0x2dced4),loggerService_1[_0x2fa670(0xb8)][_0x2fa670(0x103)]('pending_payment_cleanup',_0x2dced4,{'timeoutDays':this[_0x2fa670(0x148)]}),{'processed':_0x54b804,'failed':_0x4a6bcf,'errors':_0x2f5e74};}}async[a76_0x3614da(0xc4)](){const _0xb84b9a=a76_0x3614da;try{const _0x652d3=new Date(),_0x41ae6c=new Date(_0x652d3[_0xb84b9a(0xe7)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x241dbd=new Date(_0x652d3[_0xb84b9a(0xe7)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x39dd36=new Date(_0x652d3[_0xb84b9a(0xe7)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x2fd7b4=await database_1[_0xb84b9a(0x125)][_0xb84b9a(0xf5)]['findMany']({'where':{'status':{'in':[client_1[_0xb84b9a(0xec)]['PROCESSING'],client_1['PaymentStatus'][_0xb84b9a(0xf2)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x5a2a6d={'total':_0x2fd7b4[_0xb84b9a(0xbd)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0xf0000a of _0x2fd7b4){if(_0xf0000a[_0xb84b9a(0x132)]>_0x41ae6c)_0x5a2a6d['byAge']['fresh']++;else{if(_0xf0000a[_0xb84b9a(0x132)]>_0x241dbd)_0x5a2a6d['byAge'][_0xb84b9a(0x140)]++;else _0xf0000a['createdAt']>_0x39dd36?_0x5a2a6d['byAge'][_0xb84b9a(0x128)]++:_0x5a2a6d['byAge']['expired']++;}!_0x5a2a6d[_0xb84b9a(0x11f)][_0xf0000a[_0xb84b9a(0x143)]]&&(_0x5a2a6d[_0xb84b9a(0x11f)][_0xf0000a[_0xb84b9a(0x143)]]=0x0);_0x5a2a6d['byGateway'][_0xf0000a[_0xb84b9a(0x143)]]++;const _0x5f40fb=_0xf0000a[_0xb84b9a(0xc1)];!_0x5a2a6d['byStatus'][_0x5f40fb]&&(_0x5a2a6d[_0xb84b9a(0x12d)][_0x5f40fb]=0x0),_0x5a2a6d['byStatus'][_0x5f40fb]++;}return _0x5a2a6d;}catch(_0x35d195){console[_0xb84b9a(0xef)]('Failed\x20to\x20get\x20processing\x20payments\x20stats:',_0x35d195);throw new Error(_0xb84b9a(0xc3)+(_0x35d195 instanceof Error?_0x35d195[_0xb84b9a(0x10f)]:_0xb84b9a(0x146)));}}async['runCleanupWithReport'](){const _0x5b4523=a76_0x3614da;console['log']('ğŸš€\x20Starting\x20payment\x20cleanup\x20service...');const _0xbe7db4=await this[_0x5b4523(0xc4)]();console[_0x5b4523(0x119)](_0x5b4523(0x11b)),console['log'](_0x5b4523(0xd5)+_0xbe7db4[_0x5b4523(0x145)]),console[_0x5b4523(0x119)](_0x5b4523(0x13e)+_0xbe7db4[_0x5b4523(0xd9)][_0x5b4523(0x102)]),console[_0x5b4523(0x119)](_0x5b4523(0xd4)+_0xbe7db4['byAge'][_0x5b4523(0x140)]),console[_0x5b4523(0x119)](_0x5b4523(0x10a)+_0xbe7db4['byAge'][_0x5b4523(0x128)]),console['log'](_0x5b4523(0x14a)+_0xbe7db4['byAge'][_0x5b4523(0xfa)]),console[_0x5b4523(0x119)](_0x5b4523(0xcc),_0xbe7db4[_0x5b4523(0x11f)]),console[_0x5b4523(0x119)](_0x5b4523(0xe5),_0xbe7db4[_0x5b4523(0x12d)]),console[_0x5b4523(0x119)](_0x5b4523(0x12c));const _0x358644=await this[_0x5b4523(0x139)]();console['log']('\x0ağŸ”„\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x223f64=await this[_0x5b4523(0x142)](),_0x3da02b=await this[_0x5b4523(0xc4)]();console[_0x5b4523(0x119)]('\x0ağŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console['log'](_0x5b4523(0xd5)+_0x3da02b[_0x5b4523(0x145)]),console[_0x5b4523(0x119)](_0x5b4523(0x14a)+_0x3da02b[_0x5b4523(0xd9)][_0x5b4523(0xfa)]),console[_0x5b4523(0x119)]('\x20\x20\x20By\x20status:',_0x3da02b[_0x5b4523(0x12d)]);const _0x47ac69=_0x358644['processed']+_0x223f64['processed'],_0x181167=_0x358644[_0x5b4523(0x14b)]+_0x223f64['failed'],_0x1d30cd=[..._0x358644[_0x5b4523(0xfb)],..._0x223f64[_0x5b4523(0xfb)]];console[_0x5b4523(0x119)](_0x5b4523(0x107)),console[_0x5b4523(0x119)]('\x20\x20\x20ğŸ”„\x20PROCESSING\x20â†’\x20FAILED:\x20'+_0x358644['processed']),console[_0x5b4523(0x119)]('\x20\x20\x20â°\x20PENDING\x20â†’\x20EXPIRED:\x20'+_0x223f64['processed']),console[_0x5b4523(0x119)](_0x5b4523(0xdd)+_0x47ac69),console[_0x5b4523(0x119)](_0x5b4523(0x111)+_0x181167),console[_0x5b4523(0x119)](_0x5b4523(0xe1)+(_0xbe7db4[_0x5b4523(0x145)]-_0x3da02b['total'])),_0x1d30cd[_0x5b4523(0xbd)]>0x0&&(console[_0x5b4523(0x119)]('\x20\x20\x20âš ï¸\x20Errors\x20encountered:'),_0x1d30cd['forEach']((_0x4ac8aa,_0x421c55)=>{const _0x1ccdb7=_0x5b4523;console[_0x1ccdb7(0x119)](_0x1ccdb7(0x113)+(_0x421c55+0x1)+'.\x20'+_0x4ac8aa);})),console[_0x5b4523(0x119)](_0x5b4523(0xce));}async[a76_0x3614da(0x137)](){const _0x52fc21=a76_0x3614da;console[_0x52fc21(0x119)]('ğŸš€\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...');const _0x4dda06=await this['getProcessingPaymentsStats'](),_0x155332=_0x4dda06[_0x52fc21(0x12d)]['PROCESSING']||0x0;console[_0x52fc21(0x119)]('ğŸ“Š\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x155332);const _0x5aa2b0=await this['cleanupStaleProcessingPayments'](),_0x89d761=await this['getProcessingPaymentsStats'](),_0x1c4549=_0x89d761[_0x52fc21(0x12d)][_0x52fc21(0xdb)]||0x0;console[_0x52fc21(0x119)](_0x52fc21(0xf1)+_0x1c4549),console[_0x52fc21(0x119)](_0x52fc21(0xee)+_0x5aa2b0[_0x52fc21(0xe2)]),console[_0x52fc21(0x119)](_0x52fc21(0xd0));}async[a76_0x3614da(0x138)](){const _0x58c633=a76_0x3614da;console[_0x58c633(0x119)](_0x58c633(0x144));const _0x4a1986=await this[_0x58c633(0xc4)](),_0x5afa7e=_0x4a1986[_0x58c633(0x12d)][_0x58c633(0xf2)]||0x0;console[_0x58c633(0x119)](_0x58c633(0xe8)+_0x5afa7e);const _0x50fb91=await this[_0x58c633(0x142)](),_0x1c681c=await this['getProcessingPaymentsStats'](),_0x2b02a6=_0x1c681c['byStatus']['PENDING']||0x0;console[_0x58c633(0x119)](_0x58c633(0x12a)+_0x2b02a6),console[_0x58c633(0x119)](_0x58c633(0xf0)+_0x50fb91['processed']),console['log'](_0x58c633(0xf8));}async[a76_0x3614da(0xea)](){const _0x48217b=a76_0x3614da,_0x5b1a42=[];let _0x43f1ad=0x0;try{console[_0x48217b(0x119)]('â°\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x1fdae0=new Date(),_0x1a81d1=[_0x48217b(0xca),_0x48217b(0xd3)],_0xf7cc5=[_0x48217b(0xcb),'rapyd',_0x48217b(0x122),_0x48217b(0xba)],_0x53f984=await database_1['default']['paymentLink'][_0x48217b(0xf9)]({'where':{'type':_0x48217b(0x11d),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':_0x48217b(0xc6)},'take':0x1}}});console[_0x48217b(0x119)]('ğŸ”\x20Found\x20'+_0x53f984[_0x48217b(0xbd)]+_0x48217b(0xbf));for(const _0xc5161f of _0x53f984){try{if(_0xc5161f['payments'][_0x48217b(0xbd)]===0x0)continue;const _0x45ad5c=_0xc5161f['payments'][0x0];if(_0x45ad5c[_0x48217b(0xc1)]==='PAID')continue;const _0x4149a0=_0x1fdae0[_0x48217b(0xe7)]()-_0x45ad5c[_0x48217b(0x132)][_0x48217b(0xe7)]();let _0x512bf2;_0x1a81d1[_0x48217b(0xb9)](_0xc5161f['gateway'])||_0xf7cc5[_0x48217b(0xb9)](_0xc5161f['gateway'])?_0x512bf2=0x1e*0x3c*0x3e8:_0x512bf2=0x3*0x18*0x3c*0x3c*0x3e8,_0x4149a0>_0x512bf2&&(await database_1[_0x48217b(0x125)][_0x48217b(0x101)][_0x48217b(0x108)]({'where':{'id':_0xc5161f['id']},'data':{'status':_0x48217b(0xd7)}}),console[_0x48217b(0x119)](_0x48217b(0xed)+_0xc5161f['id']+_0x48217b(0xc9)+_0xc5161f[_0x48217b(0x143)]+_0x48217b(0x134)+Math['round'](_0x4149a0/0x3e8/0x3c)+_0x48217b(0x120)),_0x43f1ad++);}catch(_0x54aa62){const _0x5b8857='Failed\x20to\x20expire\x20link\x20'+_0xc5161f['id']+':\x20'+(_0x54aa62 instanceof Error?_0x54aa62[_0x48217b(0x10f)]:'Unknown\x20error');console[_0x48217b(0xef)]('âŒ\x20'+_0x5b8857),_0x5b1a42[_0x48217b(0x13a)](_0x5b8857);}}return console['log']('ğŸ“Š\x20Expiration\x20completed:\x20'+_0x43f1ad+'\x20links\x20expired'),{'expired':_0x43f1ad,'errors':_0x5b1a42};}catch(_0x31d2f2){const _0x51df8b=_0x48217b(0x12b)+(_0x31d2f2 instanceof Error?_0x31d2f2[_0x48217b(0x10f)]:'Unknown\x20error');return console[_0x48217b(0xef)](_0x48217b(0xc2)+_0x51df8b),_0x5b1a42['push'](_0x51df8b),{'expired':_0x43f1ad,'errors':_0x5b1a42};}}}exports[a76_0x3614da(0xfe)]=PaymentCleanupService,exports['paymentCleanupService']=new PaymentCleanupService();