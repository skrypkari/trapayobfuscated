'use strict';const a80_0x290538=a80_0x23bc;(function(_0x46f7dd,_0x4685ed){const _0x3e489e=a80_0x23bc,_0x2cc822=_0x46f7dd();while(!![]){try{const _0x384d40=-parseInt(_0x3e489e(0x1fe))/0x1+-parseInt(_0x3e489e(0x213))/0x2+-parseInt(_0x3e489e(0x203))/0x3*(-parseInt(_0x3e489e(0x1ec))/0x4)+-parseInt(_0x3e489e(0x212))/0x5*(parseInt(_0x3e489e(0x1c3))/0x6)+parseInt(_0x3e489e(0x222))/0x7*(-parseInt(_0x3e489e(0x1b7))/0x8)+-parseInt(_0x3e489e(0x1e0))/0x9+parseInt(_0x3e489e(0x21c))/0xa;if(_0x384d40===_0x4685ed)break;else _0x2cc822['push'](_0x2cc822['shift']());}catch(_0x37d416){_0x2cc822['push'](_0x2cc822['shift']());}}}(a80_0x4bd5,0x64bef));function a80_0x23bc(_0x4b3ee,_0x1cc2ab){_0x4b3ee=_0x4b3ee-0x1b3;const _0x4bd5e5=a80_0x4bd5();let _0x23bcc5=_0x4bd5e5[_0x4b3ee];return _0x23bcc5;}var __importDefault=this&&this['__importDefault']||function(_0x595079){const _0x4964d6=a80_0x23bc;return _0x595079&&_0x595079[_0x4964d6(0x1d5)]?_0x595079:{'default':_0x595079};};function a80_0x4bd5(){const _0x203840=['\x20from\x20PROCESSING\x20to\x20FAILED','PENDING_TIMEOUT_DAYS','runCleanupWithReport','cleanupStaleProcessingPayments','\x20\x20\x20Created:\x20','PaymentCleanupService','\x20\x20\x20By\x20status:','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','\x20\x20\x20Shop:\x20','2106630zsrZhu','fresh','cleanupStalePendingPayments','‚è∞\x20Expired\x20link\x20','rapyd','\x20links\x20expired','expired','\x0aüìà\x20Cleanup\x20Summary:','defineProperty','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','recent','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','36AxaWwu','join','forEach','paymentLink','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','default','gateway','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','createdAt','\x20\x20\x20Age:\x20','getProcessingPaymentsStats','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','FAST_TIMEOUT_MINUTES','PENDING','Failed\x20to\x20expire\x20link\x20','\x20minutes','errors','PaymentStatus','422498UeQXro','squirrelpay','toISOString','logWebhookProcessed','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','192795vljmPd','message','log','byStatus','amount','üìä\x20','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','expireSinglePaymentLinks','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','admin','failed',',\x20payment\x20age:\x20','@prisma/client','Cleanup\x20completed:\x20','runProcessingCleanupOnly','379965ycEmjL','334782WwxtJK','stale','Link\x20expiration\x20service\x20error:\x20','visa/mastercard','status','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','../config/database','SINGLE','update','12798420YkpjAb','paymentCleanupService','getDate','üìã\x20Fast\x20timeout\x20gateways:\x20','loggerService','includes','889oUmUoo','mastercard','payment','üèÅ\x20Payment\x20cleanup\x20service\x20completed','3\x20days','\x20\x20\x20\x20\x20\x20','total','PROCESSING','PAID','üìä\x20Expiration\x20completed:\x20','logApiCall','now','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','PROCESSING_TIMEOUT_DAYS','byGateway','shop','currency','squirrel-pay','byAge','30\x20minutes','oxapay','üîç\x20Found\x20','username','Failed\x20to\x20update\x20PENDING\x20payment\x20','SLOW_TIMEOUT_DAYS','error','PENDING\x20cleanup\x20completed:\x20','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','\x20\x20\x20Gateway:\x20','FAST_TIMEOUT_GATEWAYS','‚úÖ\x20Updated\x20payment\x20','üèÅ\x20PENDING\x20cleanup\x20completed','\x20minutes)','\x20\x20\x20Stale\x20(3-5\x20days):\x20','\x20days','POST','payments','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','setDate','floor','logWebhookError','name','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','length','üí•\x20','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','5648uoewQL','plisio','Unknown\x20error','getTime','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','\x20\x20\x20Total:\x20','pending_payment_cleanup','system','push','EXPIRED','42HfOaOZ','\x20stale\x20PROCESSING\x20payments','findMany','\x20\x20\x20Recent\x20(1-3\x20days):\x20','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','\x20\x20\x20Amount:\x20','\x20stale\x20PENDING\x20payments','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','processed','\x20\x20\x20By\x20gateway:','Failed\x20to\x20update\x20payment\x20','Failed\x20to\x20get\x20processing\x20payments\x20stats:','FAILED','\x20payments\x20updated\x20to\x20EXPIRED,\x20','payment_cleanup','__esModule'];a80_0x4bd5=function(){return _0x203840;};return a80_0x4bd5();}Object[a80_0x290538(0x1e8)](exports,a80_0x290538(0x1d5),{'value':!![]}),exports[a80_0x290538(0x21d)]=exports['PaymentCleanupService']=void 0x0;const database_1=__importDefault(require(a80_0x290538(0x219))),client_1=require(a80_0x290538(0x20f)),loggerService_1=require('./loggerService');class PaymentCleanupService{constructor(){const _0x342663=a80_0x290538;this[_0x342663(0x22f)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x342663(0x1f8)]=0x1e,this[_0x342663(0x23a)]=0x3,this[_0x342663(0x23f)]=[_0x342663(0x1ff),_0x342663(0x233),_0x342663(0x1e4),_0x342663(0x216),_0x342663(0x1b8),_0x342663(0x236)];}async['cleanupStaleProcessingPayments'](){const _0x174f3d=a80_0x290538,_0x4bbe16=[];let _0x3aabf0=0x0,_0x29d029=0x0;try{console[_0x174f3d(0x205)](_0x174f3d(0x1de));const _0x24cac1=new Date();_0x24cac1[_0x174f3d(0x248)](_0x24cac1[_0x174f3d(0x21e)]()-this['PROCESSING_TIMEOUT_DAYS']),console[_0x174f3d(0x205)]('üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20'+_0x24cac1[_0x174f3d(0x200)]());const _0x41f202=await database_1[_0x174f3d(0x1f1)][_0x174f3d(0x224)][_0x174f3d(0x1c5)]({'where':{'status':client_1[_0x174f3d(0x1fd)][_0x174f3d(0x229)],'createdAt':{'lt':_0x24cac1}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x174f3d(0x205)](_0x174f3d(0x237)+_0x41f202[_0x174f3d(0x1b4)]+_0x174f3d(0x1c4));if(_0x41f202[_0x174f3d(0x1b4)]===0x0)return console['log'](_0x174f3d(0x1f7)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x2510de of _0x41f202){try{console[_0x174f3d(0x205)](_0x174f3d(0x1c7)+_0x2510de['id']+'\x20('+_0x2510de[_0x174f3d(0x1f2)]+',\x20'+_0x2510de['amount']+'\x20'+_0x2510de[_0x174f3d(0x232)]+')'),console[_0x174f3d(0x205)]('\x20\x20\x20Shop:\x20'+_0x2510de['shop'][_0x174f3d(0x24b)]+'\x20('+_0x2510de['shop'][_0x174f3d(0x238)]+')'),console['log']('\x20\x20\x20Created:\x20'+_0x2510de[_0x174f3d(0x1f4)]['toISOString']()),console[_0x174f3d(0x205)](_0x174f3d(0x1f5)+Math[_0x174f3d(0x249)]((Date[_0x174f3d(0x22d)]()-_0x2510de['createdAt']['getTime']())/(0x3e8*0x3c*0x3c*0x18))+_0x174f3d(0x244));const _0x462f3b=await database_1[_0x174f3d(0x1f1)]['payment']['update']({'where':{'id':_0x2510de['id']},'data':{'status':client_1['PaymentStatus']['FAILED'],'statusChangedBy':_0x174f3d(0x1c0),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this['PROCESSING_TIMEOUT_DAYS']+_0x174f3d(0x244)}});console[_0x174f3d(0x205)](_0x174f3d(0x240)+_0x2510de['id']+_0x174f3d(0x1d6)),loggerService_1[_0x174f3d(0x220)][_0x174f3d(0x201)](_0x2510de['gateway'],_0x2510de['id'],_0x174f3d(0x229),_0x174f3d(0x1d2),{'reason':'auto_timeout','timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),_0x3aabf0++;}catch(_0x5247f5){const _0x2151c5=_0x174f3d(0x1d0)+_0x2510de['id']+':\x20'+(_0x5247f5 instanceof Error?_0x5247f5['message']:_0x174f3d(0x1b9));console[_0x174f3d(0x23b)]('‚ùå\x20'+_0x2151c5),_0x4bbe16['push'](_0x2151c5),_0x29d029++;}}const _0x203159=_0x174f3d(0x210)+_0x3aabf0+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0x29d029+'\x20failed\x20to\x20update';return console['log'](_0x174f3d(0x208)+_0x203159),loggerService_1[_0x174f3d(0x220)][_0x174f3d(0x22c)](_0x174f3d(0x1d4),'POST',_0x174f3d(0x1c0),_0x174f3d(0x20c),{'processed':_0x3aabf0,'failed':_0x29d029,'errors':_0x4bbe16,'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x3aabf0,'failed':_0x29d029,'errors':_0x4bbe16};}catch(_0x4e27d9){const _0x2c9501='Cleanup\x20service\x20error:\x20'+(_0x4e27d9 instanceof Error?_0x4e27d9[_0x174f3d(0x204)]:_0x174f3d(0x1b9));return console[_0x174f3d(0x23b)]('üí•\x20'+_0x2c9501),_0x4bbe16['push'](_0x2c9501),loggerService_1[_0x174f3d(0x220)]['logWebhookError'](_0x174f3d(0x1d4),_0x2c9501,{'timeoutDays':this[_0x174f3d(0x22f)]}),{'processed':_0x3aabf0,'failed':_0x29d029,'errors':_0x4bbe16};}}async[a80_0x290538(0x1e2)](){const _0x38f7e2=a80_0x290538,_0x3ac6d1=[];let _0x18d058=0x0,_0x5bda72=0x0;try{console[_0x38f7e2(0x205)](_0x38f7e2(0x1c8));const _0x1f1165=new Date(),_0x484caf=new Date(_0x1f1165[_0x38f7e2(0x1ba)]()-this['FAST_TIMEOUT_MINUTES']*0x3c*0x3e8),_0x1108e8=new Date();_0x1108e8[_0x38f7e2(0x248)](_0x1108e8[_0x38f7e2(0x21e)]()-this['SLOW_TIMEOUT_DAYS']),console['log']('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x484caf[_0x38f7e2(0x200)]()),console[_0x38f7e2(0x205)](_0x38f7e2(0x209)+_0x1108e8['toISOString']()),console[_0x38f7e2(0x205)](_0x38f7e2(0x21f)+this[_0x38f7e2(0x23f)][_0x38f7e2(0x1ed)](',\x20'));const _0x1d9850=await database_1[_0x38f7e2(0x1f1)][_0x38f7e2(0x224)][_0x38f7e2(0x1c5)]({'where':{'status':client_1[_0x38f7e2(0x1fd)]['PENDING'],'OR':[{'gateway':{'in':this[_0x38f7e2(0x23f)]},'createdAt':{'lt':_0x484caf}},{'gateway':{'notIn':this[_0x38f7e2(0x23f)]},'createdAt':{'lt':_0x1108e8}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x38f7e2(0x205)](_0x38f7e2(0x237)+_0x1d9850[_0x38f7e2(0x1b4)]+_0x38f7e2(0x1ca));if(_0x1d9850[_0x38f7e2(0x1b4)]===0x0)return console['log'](_0x38f7e2(0x1b6)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x29b8f4 of _0x1d9850){try{const _0xa890af=this[_0x38f7e2(0x23f)][_0x38f7e2(0x221)](_0x29b8f4[_0x38f7e2(0x1f2)]),_0x385dfb=_0xa890af?_0x38f7e2(0x235):_0x38f7e2(0x226),_0x13e307=Math['floor']((Date[_0x38f7e2(0x22d)]()-_0x29b8f4[_0x38f7e2(0x1f4)][_0x38f7e2(0x1ba)]())/(0x3e8*0x3c));console[_0x38f7e2(0x205)]('‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20'+_0x29b8f4['id']),console[_0x38f7e2(0x205)](_0x38f7e2(0x23e)+_0x29b8f4['gateway']+'\x20('+_0x385dfb+'\x20timeout)'),console[_0x38f7e2(0x205)](_0x38f7e2(0x1c9)+_0x29b8f4[_0x38f7e2(0x207)]+'\x20'+_0x29b8f4[_0x38f7e2(0x232)]),console[_0x38f7e2(0x205)](_0x38f7e2(0x1df)+_0x29b8f4['shop'][_0x38f7e2(0x24b)]+'\x20('+_0x29b8f4[_0x38f7e2(0x231)]['username']+')'),console['log'](_0x38f7e2(0x1da)+_0x29b8f4[_0x38f7e2(0x1f4)]['toISOString']()),console[_0x38f7e2(0x205)]('\x20\x20\x20Age:\x20'+_0x13e307+_0x38f7e2(0x1fb));const _0x1cb4cc=await database_1[_0x38f7e2(0x1f1)][_0x38f7e2(0x224)][_0x38f7e2(0x21b)]({'where':{'id':_0x29b8f4['id']},'data':{'status':client_1[_0x38f7e2(0x1fd)][_0x38f7e2(0x1c2)],'statusChangedBy':_0x38f7e2(0x1c0),'statusChangedAt':new Date(),'failureMessage':_0x38f7e2(0x1b3)+_0x385dfb}});console['log'](_0x38f7e2(0x240)+_0x29b8f4['id']+'\x20from\x20PENDING\x20to\x20EXPIRED'),loggerService_1[_0x38f7e2(0x220)][_0x38f7e2(0x201)](_0x29b8f4['gateway'],_0x29b8f4['id'],_0x38f7e2(0x1f9),_0x38f7e2(0x1c2),{'reason':'auto_timeout_pending','timeout':_0x385dfb,'ageMinutes':_0x13e307}),_0x18d058++;}catch(_0x10aed0){const _0x2d26ab=_0x38f7e2(0x239)+_0x29b8f4['id']+':\x20'+(_0x10aed0 instanceof Error?_0x10aed0['message']:_0x38f7e2(0x1b9));console[_0x38f7e2(0x23b)]('‚ùå\x20'+_0x2d26ab),_0x3ac6d1['push'](_0x2d26ab),_0x5bda72++;}}const _0x2abf67=_0x38f7e2(0x23c)+_0x18d058+_0x38f7e2(0x1d3)+_0x5bda72+'\x20failed\x20to\x20update';return console[_0x38f7e2(0x205)](_0x38f7e2(0x208)+_0x2abf67),loggerService_1[_0x38f7e2(0x220)]['logApiCall'](_0x38f7e2(0x1bf),_0x38f7e2(0x245),_0x38f7e2(0x1c0),'admin',{'processed':_0x18d058,'failed':_0x5bda72,'errors':_0x3ac6d1,'fastTimeoutMinutes':this['FAST_TIMEOUT_MINUTES'],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0x18d058,'failed':_0x5bda72,'errors':_0x3ac6d1};}catch(_0x1f4089){const _0x3d62af='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x1f4089 instanceof Error?_0x1f4089[_0x38f7e2(0x204)]:'Unknown\x20error');return console['error'](_0x38f7e2(0x1b5)+_0x3d62af),_0x3ac6d1['push'](_0x3d62af),loggerService_1[_0x38f7e2(0x220)][_0x38f7e2(0x24a)](_0x38f7e2(0x1bf),_0x3d62af,{'timeoutDays':this[_0x38f7e2(0x1d7)]}),{'processed':_0x18d058,'failed':_0x5bda72,'errors':_0x3ac6d1};}}async[a80_0x290538(0x1f6)](){const _0x5afaa4=a80_0x290538;try{const _0x2edbb8=new Date(),_0x1b9a9f=new Date(_0x2edbb8[_0x5afaa4(0x1ba)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x3c2f7b=new Date(_0x2edbb8[_0x5afaa4(0x1ba)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x4a6946=new Date(_0x2edbb8[_0x5afaa4(0x1ba)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x2e050b=await database_1[_0x5afaa4(0x1f1)][_0x5afaa4(0x224)][_0x5afaa4(0x1c5)]({'where':{'status':{'in':[client_1[_0x5afaa4(0x1fd)][_0x5afaa4(0x229)],client_1[_0x5afaa4(0x1fd)]['PENDING']]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x2df014={'total':_0x2e050b[_0x5afaa4(0x1b4)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x13ebc4 of _0x2e050b){if(_0x13ebc4[_0x5afaa4(0x1f4)]>_0x1b9a9f)_0x2df014['byAge'][_0x5afaa4(0x1e1)]++;else{if(_0x13ebc4[_0x5afaa4(0x1f4)]>_0x3c2f7b)_0x2df014[_0x5afaa4(0x234)]['recent']++;else _0x13ebc4['createdAt']>_0x4a6946?_0x2df014[_0x5afaa4(0x234)]['stale']++:_0x2df014[_0x5afaa4(0x234)][_0x5afaa4(0x1e6)]++;}!_0x2df014['byGateway'][_0x13ebc4[_0x5afaa4(0x1f2)]]&&(_0x2df014[_0x5afaa4(0x230)][_0x13ebc4['gateway']]=0x0);_0x2df014['byGateway'][_0x13ebc4[_0x5afaa4(0x1f2)]]++;const _0xa06055=_0x13ebc4[_0x5afaa4(0x217)];!_0x2df014[_0x5afaa4(0x206)][_0xa06055]&&(_0x2df014[_0x5afaa4(0x206)][_0xa06055]=0x0),_0x2df014[_0x5afaa4(0x206)][_0xa06055]++;}return _0x2df014;}catch(_0x5d680c){console[_0x5afaa4(0x23b)](_0x5afaa4(0x1d1),_0x5d680c);throw new Error(_0x5afaa4(0x202)+(_0x5d680c instanceof Error?_0x5d680c[_0x5afaa4(0x204)]:'Unknown\x20error'));}}async[a80_0x290538(0x1d8)](){const _0x4e3743=a80_0x290538;console[_0x4e3743(0x205)](_0x4e3743(0x22e));const _0x12e5bc=await this[_0x4e3743(0x1f6)]();console['log']('üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:'),console[_0x4e3743(0x205)](_0x4e3743(0x1be)+_0x12e5bc[_0x4e3743(0x228)]),console[_0x4e3743(0x205)](_0x4e3743(0x1eb)+_0x12e5bc['byAge'][_0x4e3743(0x1e1)]),console[_0x4e3743(0x205)](_0x4e3743(0x1c6)+_0x12e5bc[_0x4e3743(0x234)][_0x4e3743(0x1ea)]),console[_0x4e3743(0x205)](_0x4e3743(0x243)+_0x12e5bc[_0x4e3743(0x234)][_0x4e3743(0x214)]),console[_0x4e3743(0x205)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0x12e5bc[_0x4e3743(0x234)]['expired']),console[_0x4e3743(0x205)](_0x4e3743(0x1cf),_0x12e5bc['byGateway']),console['log'](_0x4e3743(0x1dc),_0x12e5bc[_0x4e3743(0x206)]),console[_0x4e3743(0x205)](_0x4e3743(0x1cd));const _0x471b87=await this['cleanupStaleProcessingPayments']();console[_0x4e3743(0x205)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x91d286=await this[_0x4e3743(0x1e2)](),_0x15b854=await this[_0x4e3743(0x1f6)]();console[_0x4e3743(0x205)]('\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console[_0x4e3743(0x205)](_0x4e3743(0x1be)+_0x15b854[_0x4e3743(0x228)]),console[_0x4e3743(0x205)](_0x4e3743(0x1cc)+_0x15b854[_0x4e3743(0x234)][_0x4e3743(0x1e6)]),console[_0x4e3743(0x205)]('\x20\x20\x20By\x20status:',_0x15b854[_0x4e3743(0x206)]);const _0x430d85=_0x471b87[_0x4e3743(0x1ce)]+_0x91d286[_0x4e3743(0x1ce)],_0xc05377=_0x471b87[_0x4e3743(0x20d)]+_0x91d286[_0x4e3743(0x20d)],_0x15b56d=[..._0x471b87[_0x4e3743(0x1fc)],..._0x91d286['errors']];console[_0x4e3743(0x205)](_0x4e3743(0x1e7)),console[_0x4e3743(0x205)](_0x4e3743(0x218)+_0x471b87[_0x4e3743(0x1ce)]),console[_0x4e3743(0x205)](_0x4e3743(0x1bd)+_0x91d286[_0x4e3743(0x1ce)]),console['log'](_0x4e3743(0x1dd)+_0x430d85),console[_0x4e3743(0x205)]('\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20'+_0xc05377),console[_0x4e3743(0x205)](_0x4e3743(0x20b)+(_0x12e5bc[_0x4e3743(0x228)]-_0x15b854[_0x4e3743(0x228)])),_0x15b56d[_0x4e3743(0x1b4)]>0x0&&(console[_0x4e3743(0x205)](_0x4e3743(0x1e9)),_0x15b56d[_0x4e3743(0x1ee)]((_0x24eec5,_0x33b823)=>{const _0x28f1ee=_0x4e3743;console[_0x28f1ee(0x205)](_0x28f1ee(0x227)+(_0x33b823+0x1)+'.\x20'+_0x24eec5);})),console['log'](_0x4e3743(0x225));}async[a80_0x290538(0x211)](){const _0x5f52d0=a80_0x290538;console['log'](_0x5f52d0(0x23d));const _0x447819=await this[_0x5f52d0(0x1f6)](),_0x436493=_0x447819[_0x5f52d0(0x206)]['PROCESSING']||0x0;console[_0x5f52d0(0x205)](_0x5f52d0(0x1bc)+_0x436493);const _0x42741a=await this[_0x5f52d0(0x1d9)](),_0x1bfaa2=await this['getProcessingPaymentsStats'](),_0x159e21=_0x1bfaa2['byStatus']['PROCESSING']||0x0;console[_0x5f52d0(0x205)](_0x5f52d0(0x1f3)+_0x159e21),console['log']('‚úÖ\x20PROCESSING\x20payments\x20processed:\x20'+_0x42741a['processed']),console[_0x5f52d0(0x205)]('üèÅ\x20PROCESSING\x20cleanup\x20completed');}async['runPendingCleanupOnly'](){const _0x208098=a80_0x290538;console[_0x208098(0x205)](_0x208098(0x1bb));const _0x4d55d3=await this[_0x208098(0x1f6)](),_0x5dda86=_0x4d55d3[_0x208098(0x206)][_0x208098(0x1f9)]||0x0;console[_0x208098(0x205)](_0x208098(0x1cb)+_0x5dda86);const _0x523843=await this[_0x208098(0x1e2)](),_0x4be961=await this[_0x208098(0x1f6)](),_0x53962c=_0x4be961[_0x208098(0x206)][_0x208098(0x1f9)]||0x0;console['log'](_0x208098(0x1f0)+_0x53962c),console['log']('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x523843[_0x208098(0x1ce)]),console[_0x208098(0x205)](_0x208098(0x241));}async[a80_0x290538(0x20a)](){const _0x1a09c7=a80_0x290538,_0x2a487f=[];let _0x4b0e9a=0x0;try{console[_0x1a09c7(0x205)](_0x1a09c7(0x247));const _0x1082af=new Date(),_0x4c245a=[_0x1a09c7(0x236),_0x1a09c7(0x1b8)],_0x389ddd=['squirrelpay',_0x1a09c7(0x1e4),'visa/mastercard',_0x1a09c7(0x223)],_0x530444=await database_1[_0x1a09c7(0x1f1)][_0x1a09c7(0x1ef)]['findMany']({'where':{'type':_0x1a09c7(0x21a),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x1a09c7(0x205)](_0x1a09c7(0x237)+_0x530444[_0x1a09c7(0x1b4)]+'\x20active\x20SINGLE\x20links\x20to\x20check');for(const _0xc66097 of _0x530444){try{if(_0xc66097[_0x1a09c7(0x246)]['length']===0x0)continue;const _0x22cb73=_0xc66097['payments'][0x0];if(_0x22cb73['status']===_0x1a09c7(0x22a))continue;const _0x5de435=_0x1082af[_0x1a09c7(0x1ba)]()-_0x22cb73[_0x1a09c7(0x1f4)][_0x1a09c7(0x1ba)]();let _0x542d25;_0x4c245a['includes'](_0xc66097[_0x1a09c7(0x1f2)])||_0x389ddd['includes'](_0xc66097[_0x1a09c7(0x1f2)])?_0x542d25=0x1e*0x3c*0x3e8:_0x542d25=0x3*0x18*0x3c*0x3c*0x3e8,_0x5de435>_0x542d25&&(await database_1[_0x1a09c7(0x1f1)][_0x1a09c7(0x1ef)][_0x1a09c7(0x21b)]({'where':{'id':_0xc66097['id']},'data':{'status':_0x1a09c7(0x1c2)}}),console['log'](_0x1a09c7(0x1e3)+_0xc66097['id']+'\x20(gateway:\x20'+_0xc66097[_0x1a09c7(0x1f2)]+_0x1a09c7(0x20e)+Math['round'](_0x5de435/0x3e8/0x3c)+_0x1a09c7(0x242)),_0x4b0e9a++);}catch(_0x351e3e){const _0x1edc62=_0x1a09c7(0x1fa)+_0xc66097['id']+':\x20'+(_0x351e3e instanceof Error?_0x351e3e['message']:_0x1a09c7(0x1b9));console[_0x1a09c7(0x23b)]('‚ùå\x20'+_0x1edc62),_0x2a487f[_0x1a09c7(0x1c1)](_0x1edc62);}}return console['log'](_0x1a09c7(0x22b)+_0x4b0e9a+_0x1a09c7(0x1e5)),{'expired':_0x4b0e9a,'errors':_0x2a487f};}catch(_0x356f58){const _0x5be6c2=_0x1a09c7(0x215)+(_0x356f58 instanceof Error?_0x356f58['message']:_0x1a09c7(0x1b9));return console[_0x1a09c7(0x23b)](_0x1a09c7(0x1b5)+_0x5be6c2),_0x2a487f[_0x1a09c7(0x1c1)](_0x5be6c2),{'expired':_0x4b0e9a,'errors':_0x2a487f};}}}exports[a80_0x290538(0x1db)]=PaymentCleanupService,exports[a80_0x290538(0x21d)]=new PaymentCleanupService();