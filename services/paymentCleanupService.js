'use strict';const a72_0x1979dc=a72_0x3b16;function a72_0x3b16(_0x42f398,_0x1452f6){_0x42f398=_0x42f398-0x113;const _0x1eaeaf=a72_0x1eae();let _0x3b1632=_0x1eaeaf[_0x42f398];return _0x3b1632;}function a72_0x1eae(){const _0x1ae39e=['PaymentStatus','FAST_TIMEOUT_MINUTES','createdAt','pending_payment_cleanup','5189408BPqaMh','‚úÖ\x20Updated\x20payment\x20','PENDING\x20cleanup\x20completed:\x20','loggerService','cleanupStalePendingPayments','PENDING_TIMEOUT_DAYS','‚úÖ\x20PENDING\x20payments\x20processed:\x20','üèÅ\x20Payment\x20cleanup\x20service\x20completed','\x20payments\x20updated\x20to\x20FAILED,\x20','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','\x20from\x20PROCESSING\x20to\x20FAILED','Failed\x20to\x20expire\x20link\x20','\x20\x20\x20By\x20status:','expired','system','byGateway','PROCESSING_TIMEOUT_DAYS','\x0aüìà\x20Cleanup\x20Summary:','shop','oxapay','errors','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','paymentCleanupService','119439mCSvCr','runPendingCleanupOnly','Failed\x20to\x20update\x20PENDING\x20payment\x20','üèÅ\x20PENDING\x20cleanup\x20completed','\x20\x20\x20Stale\x20(3-5\x20days):\x20','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','\x20from\x20PENDING\x20to\x20EXPIRED','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','Cleanup\x20service\x20error:\x20','fresh','__esModule','status','join','total','\x20timeout)','3\x20days','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','byStatus','\x20failed\x20to\x20update','PENDING','logWebhookError','../config/database','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','\x20days','message','1444974AkxfJC','üìä\x20','processed','\x20\x20\x20By\x20gateway:','getDate','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','defineProperty','\x20\x20\x20Age:\x20','setDate','PAID','includes','length','toISOString','‚è∞\x20Expired\x20link\x20','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','name','üîç\x20Found\x20','FAILED','getProcessingPaymentsStats','getTime','auto_timeout','payments','logWebhookProcessed','__importDefault','amount','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','byAge','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','Cleanup\x20completed:\x20','recent','runProcessingCleanupOnly','\x20minutes','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','POST','squirrelpay','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20',',\x20payment\x20age:\x20','failed','\x20stale\x20PROCESSING\x20payments','plisio','rapyd','currency','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','round','üìä\x20Expiration\x20completed:\x20','log','error','\x20minutes)','PENDING\x20cleanup\x20service\x20error:\x20','squirrel-pay','Failed\x20to\x20get\x20processing\x20payments\x20stats:','mastercard','floor','gateway','push','username','üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','now','\x20\x20\x20Gateway:\x20','SLOW_TIMEOUT_DAYS','auto_timeout_pending','üìã\x20Fast\x20timeout\x20gateways:\x20','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','üí•\x20','default','admin','stale','\x20active\x20SINGLE\x20links\x20to\x20check','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','3095130jRIqjD','\x20\x20\x20\x20\x20\x20','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','cleanupStaleProcessingPayments','\x20links\x20expired','SINGLE','paymentLink','payment_cleanup','Failed\x20to\x20update\x20payment\x20','870489XtlPGw','\x20\x20\x20Shop:\x20','logApiCall','3794605fxRSiF','\x20\x20\x20Total:\x20','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','\x20\x20\x20Amount:\x20','visa/mastercard','üèÅ\x20PROCESSING\x20cleanup\x20completed','\x20\x20\x20Recent\x20(1-3\x20days):\x20','EXPIRED','4956892umoqph','PaymentCleanupService','Unknown\x20error','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','update','1432rDlIzd','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','PROCESSING','findMany','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','FAST_TIMEOUT_GATEWAYS','payment','6AyHSYx'];a72_0x1eae=function(){return _0x1ae39e;};return a72_0x1eae();}(function(_0x37fb5c,_0x3f5a1e){const _0x366c14=a72_0x3b16,_0x569e8c=_0x37fb5c();while(!![]){try{const _0x81c71d=-parseInt(_0x366c14(0x17d))/0x1+-parseInt(_0x366c14(0x127))/0x2+parseInt(_0x366c14(0x130))/0x3+parseInt(_0x366c14(0x13b))/0x4+-parseInt(_0x366c14(0x133))/0x5*(parseInt(_0x366c14(0x148))/0x6)+parseInt(_0x366c14(0x14d))/0x7+parseInt(_0x366c14(0x140))/0x8*(parseInt(_0x366c14(0x164))/0x9);if(_0x81c71d===_0x3f5a1e)break;else _0x569e8c['push'](_0x569e8c['shift']());}catch(_0x184ae7){_0x569e8c['push'](_0x569e8c['shift']());}}}(a72_0x1eae,0xda73b));var __importDefault=this&&this[a72_0x1979dc(0x194)]||function(_0x3609d5){const _0x3dda0b=a72_0x1979dc;return _0x3609d5&&_0x3609d5[_0x3dda0b(0x16e)]?_0x3609d5:{'default':_0x3609d5};};Object[a72_0x1979dc(0x183)](exports,'__esModule',{'value':!![]}),exports[a72_0x1979dc(0x163)]=exports[a72_0x1979dc(0x13c)]=void 0x0;const database_1=__importDefault(require(a72_0x1979dc(0x179))),client_1=require('@prisma/client'),loggerService_1=require('./loggerService');class PaymentCleanupService{constructor(){const _0x519840=a72_0x1979dc;this[_0x519840(0x15d)]=0x5,this[_0x519840(0x152)]=0x5,this[_0x519840(0x14a)]=0x1e,this[_0x519840(0x11b)]=0x3,this[_0x519840(0x146)]=[_0x519840(0x19f),_0x519840(0x1af),_0x519840(0x1a6),_0x519840(0x137),_0x519840(0x1a5),_0x519840(0x160)];}async[a72_0x1979dc(0x12a)](){const _0x401354=a72_0x1979dc,_0x59c46a=[];let _0x274d0b=0x0,_0x42eafa=0x0;try{console[_0x401354(0x1ab)](_0x401354(0x1a8));const _0x318b86=new Date();_0x318b86[_0x401354(0x185)](_0x318b86[_0x401354(0x181)]()-this['PROCESSING_TIMEOUT_DAYS']),console['log'](_0x401354(0x19d)+_0x318b86[_0x401354(0x189)]());const _0x29c1fd=await database_1[_0x401354(0x121)][_0x401354(0x147)][_0x401354(0x143)]({'where':{'status':client_1[_0x401354(0x149)]['PROCESSING'],'createdAt':{'lt':_0x318b86}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x401354(0x1ab)](_0x401354(0x18d)+_0x29c1fd['length']+_0x401354(0x1a4));if(_0x29c1fd[_0x401354(0x188)]===0x0)return console[_0x401354(0x1ab)](_0x401354(0x16b)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x627f0a of _0x29c1fd){try{console['log']('‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20'+_0x627f0a['id']+'\x20('+_0x627f0a[_0x401354(0x115)]+',\x20'+_0x627f0a[_0x401354(0x195)]+'\x20'+_0x627f0a[_0x401354(0x1a7)]+')'),console['log']('\x20\x20\x20Shop:\x20'+_0x627f0a[_0x401354(0x15f)][_0x401354(0x18c)]+'\x20('+_0x627f0a['shop']['username']+')'),console[_0x401354(0x1ab)]('\x20\x20\x20Created:\x20'+_0x627f0a[_0x401354(0x14b)]['toISOString']()),console['log'](_0x401354(0x184)+Math[_0x401354(0x114)]((Date[_0x401354(0x119)]()-_0x627f0a['createdAt'][_0x401354(0x190)]())/(0x3e8*0x3c*0x3c*0x18))+_0x401354(0x17b));const _0x2b191e=await database_1['default'][_0x401354(0x147)][_0x401354(0x13f)]({'where':{'id':_0x627f0a['id']},'data':{'status':client_1[_0x401354(0x149)][_0x401354(0x18e)],'statusChangedBy':_0x401354(0x15b),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this['PROCESSING_TIMEOUT_DAYS']+_0x401354(0x17b)}});console[_0x401354(0x1ab)](_0x401354(0x14e)+_0x627f0a['id']+_0x401354(0x157)),loggerService_1[_0x401354(0x150)][_0x401354(0x193)](_0x627f0a[_0x401354(0x115)],_0x627f0a['id'],'PROCESSING',_0x401354(0x18e),{'reason':_0x401354(0x191),'timeoutDays':this[_0x401354(0x15d)]}),_0x274d0b++;}catch(_0x1103bb){const _0x303b1d=_0x401354(0x12f)+_0x627f0a['id']+':\x20'+(_0x1103bb instanceof Error?_0x1103bb[_0x401354(0x17c)]:_0x401354(0x13d));console[_0x401354(0x1ac)]('‚ùå\x20'+_0x303b1d),_0x59c46a['push'](_0x303b1d),_0x42eafa++;}}const _0x1d93dd=_0x401354(0x199)+_0x274d0b+_0x401354(0x155)+_0x42eafa+_0x401354(0x176);return console[_0x401354(0x1ab)](_0x401354(0x17e)+_0x1d93dd),loggerService_1['loggerService']['logApiCall'](_0x401354(0x12e),_0x401354(0x19e),'system',_0x401354(0x122),{'processed':_0x274d0b,'failed':_0x42eafa,'errors':_0x59c46a,'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x274d0b,'failed':_0x42eafa,'errors':_0x59c46a};}catch(_0x23197c){const _0xa9db2a=_0x401354(0x16c)+(_0x23197c instanceof Error?_0x23197c[_0x401354(0x17c)]:_0x401354(0x13d));return console[_0x401354(0x1ac)]('üí•\x20'+_0xa9db2a),_0x59c46a['push'](_0xa9db2a),loggerService_1[_0x401354(0x150)][_0x401354(0x178)](_0x401354(0x12e),_0xa9db2a,{'timeoutDays':this[_0x401354(0x15d)]}),{'processed':_0x274d0b,'failed':_0x42eafa,'errors':_0x59c46a};}}async[a72_0x1979dc(0x151)](){const _0x1be3c6=a72_0x1979dc,_0x576df0=[];let _0x4c3ea8=0x0,_0x527f26=0x0;try{console[_0x1be3c6(0x1ab)](_0x1be3c6(0x125));const _0x4f11c7=new Date(),_0x418681=new Date(_0x4f11c7['getTime']()-this['FAST_TIMEOUT_MINUTES']*0x3c*0x3e8),_0x8b48e6=new Date();_0x8b48e6[_0x1be3c6(0x185)](_0x8b48e6['getDate']()-this[_0x1be3c6(0x11b)]),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x1a1)+_0x418681[_0x1be3c6(0x189)]()),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x169)+_0x8b48e6['toISOString']()),console['log'](_0x1be3c6(0x11d)+this[_0x1be3c6(0x146)][_0x1be3c6(0x170)](',\x20'));const _0xafe762=await database_1[_0x1be3c6(0x121)]['payment'][_0x1be3c6(0x143)]({'where':{'status':client_1[_0x1be3c6(0x149)][_0x1be3c6(0x177)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x418681}},{'gateway':{'notIn':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x8b48e6}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log'](_0x1be3c6(0x18d)+_0xafe762[_0x1be3c6(0x188)]+'\x20stale\x20PENDING\x20payments');if(_0xafe762[_0x1be3c6(0x188)]===0x0)return console['log'](_0x1be3c6(0x156)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x5e26d4 of _0xafe762){try{const _0x1d2d7f=this[_0x1be3c6(0x146)][_0x1be3c6(0x187)](_0x5e26d4[_0x1be3c6(0x115)]),_0x3aa88b=_0x1d2d7f?'30\x20minutes':_0x1be3c6(0x173),_0x5c1a6d=Math[_0x1be3c6(0x114)]((Date[_0x1be3c6(0x119)]()-_0x5e26d4[_0x1be3c6(0x14b)]['getTime']())/(0x3e8*0x3c));console[_0x1be3c6(0x1ab)](_0x1be3c6(0x11e)+_0x5e26d4['id']),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x11a)+_0x5e26d4[_0x1be3c6(0x115)]+'\x20('+_0x3aa88b+_0x1be3c6(0x172)),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x136)+_0x5e26d4['amount']+'\x20'+_0x5e26d4['currency']),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x131)+_0x5e26d4[_0x1be3c6(0x15f)][_0x1be3c6(0x18c)]+'\x20('+_0x5e26d4[_0x1be3c6(0x15f)][_0x1be3c6(0x117)]+')'),console[_0x1be3c6(0x1ab)]('\x20\x20\x20Created:\x20'+_0x5e26d4[_0x1be3c6(0x14b)][_0x1be3c6(0x189)]()),console[_0x1be3c6(0x1ab)](_0x1be3c6(0x184)+_0x5c1a6d+_0x1be3c6(0x19c));const _0x5dc74c=await database_1[_0x1be3c6(0x121)][_0x1be3c6(0x147)]['update']({'where':{'id':_0x5e26d4['id']},'data':{'status':client_1[_0x1be3c6(0x149)][_0x1be3c6(0x13a)],'statusChangedBy':_0x1be3c6(0x15b),'statusChangedAt':new Date(),'failureMessage':_0x1be3c6(0x17a)+_0x3aa88b}});console[_0x1be3c6(0x1ab)](_0x1be3c6(0x14e)+_0x5e26d4['id']+_0x1be3c6(0x16a)),loggerService_1['loggerService'][_0x1be3c6(0x193)](_0x5e26d4[_0x1be3c6(0x115)],_0x5e26d4['id'],_0x1be3c6(0x177),_0x1be3c6(0x13a),{'reason':_0x1be3c6(0x11c),'timeout':_0x3aa88b,'ageMinutes':_0x5c1a6d}),_0x4c3ea8++;}catch(_0x20955e){const _0x38bcf4=_0x1be3c6(0x166)+_0x5e26d4['id']+':\x20'+(_0x20955e instanceof Error?_0x20955e[_0x1be3c6(0x17c)]:_0x1be3c6(0x13d));console[_0x1be3c6(0x1ac)]('‚ùå\x20'+_0x38bcf4),_0x576df0[_0x1be3c6(0x116)](_0x38bcf4),_0x527f26++;}}const _0x483404=_0x1be3c6(0x14f)+_0x4c3ea8+'\x20payments\x20updated\x20to\x20EXPIRED,\x20'+_0x527f26+_0x1be3c6(0x176);return console[_0x1be3c6(0x1ab)](_0x1be3c6(0x17e)+_0x483404),loggerService_1[_0x1be3c6(0x150)][_0x1be3c6(0x132)](_0x1be3c6(0x14c),_0x1be3c6(0x19e),_0x1be3c6(0x15b),_0x1be3c6(0x122),{'processed':_0x4c3ea8,'failed':_0x527f26,'errors':_0x576df0,'fastTimeoutMinutes':this[_0x1be3c6(0x14a)],'slowTimeoutDays':this[_0x1be3c6(0x11b)]}),{'processed':_0x4c3ea8,'failed':_0x527f26,'errors':_0x576df0};}catch(_0x4dfe3c){const _0x4f334d=_0x1be3c6(0x1ae)+(_0x4dfe3c instanceof Error?_0x4dfe3c[_0x1be3c6(0x17c)]:_0x1be3c6(0x13d));return console['error']('üí•\x20'+_0x4f334d),_0x576df0[_0x1be3c6(0x116)](_0x4f334d),loggerService_1[_0x1be3c6(0x150)][_0x1be3c6(0x178)](_0x1be3c6(0x14c),_0x4f334d,{'timeoutDays':this[_0x1be3c6(0x152)]}),{'processed':_0x4c3ea8,'failed':_0x527f26,'errors':_0x576df0};}}async[a72_0x1979dc(0x18f)](){const _0x11bdab=a72_0x1979dc;try{const _0xa992fb=new Date(),_0x61cb7b=new Date(_0xa992fb[_0x11bdab(0x190)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x46791d=new Date(_0xa992fb[_0x11bdab(0x190)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x3e5ca8=new Date(_0xa992fb[_0x11bdab(0x190)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x3da448=await database_1[_0x11bdab(0x121)][_0x11bdab(0x147)][_0x11bdab(0x143)]({'where':{'status':{'in':[client_1['PaymentStatus']['PROCESSING'],client_1[_0x11bdab(0x149)][_0x11bdab(0x177)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x27e5e2={'total':_0x3da448['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x3763de of _0x3da448){if(_0x3763de[_0x11bdab(0x14b)]>_0x61cb7b)_0x27e5e2[_0x11bdab(0x197)][_0x11bdab(0x16d)]++;else{if(_0x3763de['createdAt']>_0x46791d)_0x27e5e2[_0x11bdab(0x197)][_0x11bdab(0x19a)]++;else _0x3763de[_0x11bdab(0x14b)]>_0x3e5ca8?_0x27e5e2[_0x11bdab(0x197)][_0x11bdab(0x123)]++:_0x27e5e2[_0x11bdab(0x197)]['expired']++;}!_0x27e5e2['byGateway'][_0x3763de['gateway']]&&(_0x27e5e2['byGateway'][_0x3763de[_0x11bdab(0x115)]]=0x0);_0x27e5e2[_0x11bdab(0x15c)][_0x3763de[_0x11bdab(0x115)]]++;const _0x615fd7=_0x3763de[_0x11bdab(0x16f)];!_0x27e5e2[_0x11bdab(0x175)][_0x615fd7]&&(_0x27e5e2[_0x11bdab(0x175)][_0x615fd7]=0x0),_0x27e5e2[_0x11bdab(0x175)][_0x615fd7]++;}return _0x27e5e2;}catch(_0x4dca6a){console[_0x11bdab(0x1ac)](_0x11bdab(0x1b0),_0x4dca6a);throw new Error(_0x11bdab(0x141)+(_0x4dca6a instanceof Error?_0x4dca6a[_0x11bdab(0x17c)]:_0x11bdab(0x13d)));}}async['runCleanupWithReport'](){const _0xea5468=a72_0x1979dc;console[_0xea5468(0x1ab)](_0xea5468(0x144));const _0x3f988d=await this[_0xea5468(0x18f)]();console[_0xea5468(0x1ab)](_0xea5468(0x182)),console['log']('\x20\x20\x20Total:\x20'+_0x3f988d[_0xea5468(0x171)]),console['log'](_0xea5468(0x1a0)+_0x3f988d[_0xea5468(0x197)][_0xea5468(0x16d)]),console[_0xea5468(0x1ab)](_0xea5468(0x139)+_0x3f988d[_0xea5468(0x197)][_0xea5468(0x19a)]),console[_0xea5468(0x1ab)](_0xea5468(0x168)+_0x3f988d[_0xea5468(0x197)][_0xea5468(0x123)]),console[_0xea5468(0x1ab)](_0xea5468(0x174)+_0x3f988d[_0xea5468(0x197)][_0xea5468(0x15a)]),console[_0xea5468(0x1ab)](_0xea5468(0x180),_0x3f988d[_0xea5468(0x15c)]),console[_0xea5468(0x1ab)](_0xea5468(0x159),_0x3f988d[_0xea5468(0x175)]),console[_0xea5468(0x1ab)](_0xea5468(0x18b));const _0x22f75c=await this['cleanupStaleProcessingPayments']();console[_0xea5468(0x1ab)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x28eefc=await this[_0xea5468(0x151)](),_0x4c1276=await this[_0xea5468(0x18f)]();console[_0xea5468(0x1ab)](_0xea5468(0x129)),console[_0xea5468(0x1ab)](_0xea5468(0x134)+_0x4c1276[_0xea5468(0x171)]),console[_0xea5468(0x1ab)](_0xea5468(0x174)+_0x4c1276[_0xea5468(0x197)][_0xea5468(0x15a)]),console[_0xea5468(0x1ab)](_0xea5468(0x159),_0x4c1276['byStatus']);const _0x4d2a2f=_0x22f75c[_0xea5468(0x17f)]+_0x28eefc[_0xea5468(0x17f)],_0x47003f=_0x22f75c[_0xea5468(0x1a3)]+_0x28eefc[_0xea5468(0x1a3)],_0x1d5906=[..._0x22f75c[_0xea5468(0x161)],..._0x28eefc['errors']];console[_0xea5468(0x1ab)](_0xea5468(0x15e)),console[_0xea5468(0x1ab)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x22f75c[_0xea5468(0x17f)]),console[_0xea5468(0x1ab)]('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x28eefc[_0xea5468(0x17f)]),console['log'](_0xea5468(0x11f)+_0x4d2a2f),console[_0xea5468(0x1ab)](_0xea5468(0x198)+_0x47003f),console['log'](_0xea5468(0x162)+(_0x3f988d['total']-_0x4c1276[_0xea5468(0x171)])),_0x1d5906['length']>0x0&&(console[_0xea5468(0x1ab)](_0xea5468(0x126)),_0x1d5906['forEach']((_0x2df443,_0x1566f1)=>{const _0x1ce777=_0xea5468;console[_0x1ce777(0x1ab)](_0x1ce777(0x128)+(_0x1566f1+0x1)+'.\x20'+_0x2df443);})),console[_0xea5468(0x1ab)](_0xea5468(0x154));}async[a72_0x1979dc(0x19b)](){const _0x1fa41f=a72_0x1979dc;console[_0x1fa41f(0x1ab)](_0x1fa41f(0x135));const _0x5d353e=await this[_0x1fa41f(0x18f)](),_0x3be434=_0x5d353e[_0x1fa41f(0x175)]['PROCESSING']||0x0;console['log']('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x3be434);const _0x286d19=await this[_0x1fa41f(0x12a)](),_0xc9029f=await this[_0x1fa41f(0x18f)](),_0x5016ac=_0xc9029f[_0x1fa41f(0x175)][_0x1fa41f(0x142)]||0x0;console[_0x1fa41f(0x1ab)](_0x1fa41f(0x196)+_0x5016ac),console[_0x1fa41f(0x1ab)](_0x1fa41f(0x145)+_0x286d19['processed']),console[_0x1fa41f(0x1ab)](_0x1fa41f(0x138));}async[a72_0x1979dc(0x165)](){const _0x7ba6b1=a72_0x1979dc;console['log'](_0x7ba6b1(0x118));const _0x9c77ec=await this[_0x7ba6b1(0x18f)](),_0x5e2004=_0x9c77ec[_0x7ba6b1(0x175)][_0x7ba6b1(0x177)]||0x0;console[_0x7ba6b1(0x1ab)](_0x7ba6b1(0x13e)+_0x5e2004);const _0x242f62=await this[_0x7ba6b1(0x151)](),_0xe795f6=await this['getProcessingPaymentsStats'](),_0x324ef4=_0xe795f6[_0x7ba6b1(0x175)][_0x7ba6b1(0x177)]||0x0;console['log']('üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20'+_0x324ef4),console[_0x7ba6b1(0x1ab)](_0x7ba6b1(0x153)+_0x242f62[_0x7ba6b1(0x17f)]),console[_0x7ba6b1(0x1ab)](_0x7ba6b1(0x167));}async['expireSinglePaymentLinks'](){const _0x29f72d=a72_0x1979dc,_0x36ae13=[];let _0x404a93=0x0;try{console[_0x29f72d(0x1ab)]('‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...');const _0x19ae05=new Date(),_0x1c787d=[_0x29f72d(0x160),'plisio'],_0x354a6f=[_0x29f72d(0x19f),_0x29f72d(0x1a6),'visa/mastercard',_0x29f72d(0x113)],_0x14c3d9=await database_1[_0x29f72d(0x121)][_0x29f72d(0x12d)][_0x29f72d(0x143)]({'where':{'type':_0x29f72d(0x12c),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x29f72d(0x1ab)](_0x29f72d(0x18d)+_0x14c3d9[_0x29f72d(0x188)]+_0x29f72d(0x124));for(const _0x1203d7 of _0x14c3d9){try{if(_0x1203d7[_0x29f72d(0x192)][_0x29f72d(0x188)]===0x0)continue;const _0x2845fd=_0x1203d7[_0x29f72d(0x192)][0x0];if(_0x2845fd[_0x29f72d(0x16f)]===_0x29f72d(0x186))continue;const _0x1631cd=_0x19ae05[_0x29f72d(0x190)]()-_0x2845fd[_0x29f72d(0x14b)][_0x29f72d(0x190)]();let _0x13e4d4;_0x1c787d['includes'](_0x1203d7['gateway'])||_0x354a6f['includes'](_0x1203d7[_0x29f72d(0x115)])?_0x13e4d4=0x1e*0x3c*0x3e8:_0x13e4d4=0x3*0x18*0x3c*0x3c*0x3e8,_0x1631cd>_0x13e4d4&&(await database_1[_0x29f72d(0x121)][_0x29f72d(0x12d)][_0x29f72d(0x13f)]({'where':{'id':_0x1203d7['id']},'data':{'status':_0x29f72d(0x13a)}}),console['log'](_0x29f72d(0x18a)+_0x1203d7['id']+'\x20(gateway:\x20'+_0x1203d7['gateway']+_0x29f72d(0x1a2)+Math[_0x29f72d(0x1a9)](_0x1631cd/0x3e8/0x3c)+_0x29f72d(0x1ad)),_0x404a93++);}catch(_0x4587bb){const _0x5111a6=_0x29f72d(0x158)+_0x1203d7['id']+':\x20'+(_0x4587bb instanceof Error?_0x4587bb[_0x29f72d(0x17c)]:_0x29f72d(0x13d));console[_0x29f72d(0x1ac)]('‚ùå\x20'+_0x5111a6),_0x36ae13[_0x29f72d(0x116)](_0x5111a6);}}return console['log'](_0x29f72d(0x1aa)+_0x404a93+_0x29f72d(0x12b)),{'expired':_0x404a93,'errors':_0x36ae13};}catch(_0x5679bb){const _0x29af69='Link\x20expiration\x20service\x20error:\x20'+(_0x5679bb instanceof Error?_0x5679bb[_0x29f72d(0x17c)]:'Unknown\x20error');return console[_0x29f72d(0x1ac)](_0x29f72d(0x120)+_0x29af69),_0x36ae13[_0x29f72d(0x116)](_0x29af69),{'expired':_0x404a93,'errors':_0x36ae13};}}}exports[a72_0x1979dc(0x13c)]=PaymentCleanupService,exports[a72_0x1979dc(0x163)]=new PaymentCleanupService();