'use strict';const a80_0x27e340=a80_0x4bec;(function(_0x20c285,_0x2f33cb){const _0x33b4a9=a80_0x4bec,_0x19a806=_0x20c285();while(!![]){try{const _0x248b35=-parseInt(_0x33b4a9(0x111))/0x1+parseInt(_0x33b4a9(0xcb))/0x2+-parseInt(_0x33b4a9(0x108))/0x3*(parseInt(_0x33b4a9(0xa4))/0x4)+-parseInt(_0x33b4a9(0xe6))/0x5+parseInt(_0x33b4a9(0xd2))/0x6+parseInt(_0x33b4a9(0xd5))/0x7+-parseInt(_0x33b4a9(0xea))/0x8*(-parseInt(_0x33b4a9(0x117))/0x9);if(_0x248b35===_0x2f33cb)break;else _0x19a806['push'](_0x19a806['shift']());}catch(_0x53fb8b){_0x19a806['push'](_0x19a806['shift']());}}}(a80_0x22db,0xe3e33));function a80_0x4bec(_0x5751ea,_0x58c18f){_0x5751ea=_0x5751ea-0x85;const _0x22db1c=a80_0x22db();let _0x4becd3=_0x22db1c[_0x5751ea];return _0x4becd3;}var __importDefault=this&&this[a80_0x27e340(0x9a)]||function(_0x4f83cf){return _0x4f83cf&&_0x4f83cf['__esModule']?_0x4f83cf:{'default':_0x4f83cf};};Object[a80_0x27e340(0x91)](exports,a80_0x27e340(0xbd),{'value':!![]}),exports[a80_0x27e340(0x112)]=exports[a80_0x27e340(0x8e)]=void 0x0;function a80_0x22db(){const _0x1338cb=['loggerService','\x20\x20\x20Gateway:\x20','\x20\x20\x20Stale\x20(3-5\x20days):\x20','__importDefault','includes','\x20from\x20PENDING\x20to\x20EXPIRED','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','\x20\x20\x20Recent\x20(1-3\x20days):\x20','\x20payments\x20updated\x20to\x20FAILED,\x20','rapyd','floor','logWebhookProcessed','\x20\x20\x20By\x20gateway:','48icOpqO','\x20stale\x20PROCESSING\x20payments','\x20(gateway:\x20','byStatus','visa/mastercard','expired','auto_timeout_pending','SINGLE','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','default','name','payment_cleanup','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','now','üîç\x20Found\x20','status','Failed\x20to\x20get\x20processing\x20payments\x20stats:','admin','\x20\x20\x20By\x20status:','üèÅ\x20PENDING\x20cleanup\x20completed','\x20minutes)','paymentLink','processed','getTime','Failed\x20to\x20expire\x20link\x20','__esModule','\x20\x20\x20Age:\x20','\x20\x20\x20Created:\x20','createdAt','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','expireSinglePaymentLinks','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','stale','byGateway','FAST_TIMEOUT_MINUTES','recent','join','cleanupStalePendingPayments','1754178Bsxjlb','SLOW_TIMEOUT_DAYS','update','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','@prisma/client','Failed\x20to\x20update\x20payment\x20','\x20\x20\x20Amount:\x20','593298bbaRLt','üèÅ\x20Payment\x20cleanup\x20service\x20completed','PROCESSING','297584fyURkS','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','FAILED','üìä\x20Expiration\x20completed:\x20','message','POST','Failed\x20to\x20update\x20PENDING\x20payment\x20','amount','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','../config/database','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','PENDING\x20cleanup\x20completed:\x20','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','system','cleanupStaleProcessingPayments','üí•\x20','8804345YKJSlh','FAST_TIMEOUT_GATEWAYS','\x20active\x20SINGLE\x20links\x20to\x20check','\x20payments\x20updated\x20to\x20EXPIRED,\x20','31561704EtMarz','PaymentStatus','\x0aüìà\x20Cleanup\x20Summary:','PENDING','length','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','setDate','findMany','toISOString','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','PROCESSING_TIMEOUT_DAYS','auto_timeout','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','log','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','oxapay','30\x20minutes','\x20timeout)','squirrelpay','shop','\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','getDate','\x20\x20\x20Shop:\x20','byAge','getProcessingPaymentsStats','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','fresh','367707PwcOJH','EXPIRED','desc','push','gateway','üìã\x20Fast\x20timeout\x20gateways:\x20','Unknown\x20error','errors','3\x20days','798573uVDRzz','paymentCleanupService','üèÅ\x20PROCESSING\x20cleanup\x20completed','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','\x20failed\x20to\x20update','plisio','9AjLYrl','\x20from\x20PROCESSING\x20to\x20FAILED','\x20days','round','logApiCall','username','PENDING_TIMEOUT_DAYS','Cleanup\x20service\x20error:\x20','total','\x20\x20\x20Total:\x20','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','Cleanup\x20completed:\x20','currency','PAID','error','logWebhookError','mastercard','failed','PaymentCleanupService','üìä\x20','./loggerService','defineProperty','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','runCleanupWithReport','pending_payment_cleanup','payments','payment'];a80_0x22db=function(){return _0x1338cb;};return a80_0x22db();}const database_1=__importDefault(require(a80_0x27e340(0xdf))),client_1=require(a80_0x27e340(0xcf)),loggerService_1=require(a80_0x27e340(0x90));class PaymentCleanupService{constructor(){const _0x2c5e91=a80_0x27e340;this[_0x2c5e91(0xf4)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x2c5e91(0xc7)]=0x1e,this[_0x2c5e91(0xcc)]=0x3,this[_0x2c5e91(0xe7)]=[_0x2c5e91(0xfe),'squirrel-pay',_0x2c5e91(0xa0),_0x2c5e91(0xa8),'plisio',_0x2c5e91(0xfb)];}async[a80_0x27e340(0xe4)](){const _0x3b28dd=a80_0x27e340,_0x2e9087=[];let _0x244a50=0x0,_0x383c55=0x0;try{console[_0x3b28dd(0xf8)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x464a66=new Date();_0x464a66['setDate'](_0x464a66['getDate']()-this[_0x3b28dd(0xf4)]),console['log'](_0x3b28dd(0xc1)+_0x464a66[_0x3b28dd(0xf2)]());const _0xfefa6e=await database_1[_0x3b28dd(0xad)][_0x3b28dd(0x96)]['findMany']({'where':{'status':client_1['PaymentStatus'][_0x3b28dd(0xd4)],'createdAt':{'lt':_0x464a66}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console['log'](_0x3b28dd(0xb2)+_0xfefa6e[_0x3b28dd(0xee)]+_0x3b28dd(0xa5));if(_0xfefa6e[_0x3b28dd(0xee)]===0x0)return console[_0x3b28dd(0xf8)]('‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found'),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x52b304 of _0xfefa6e){try{console[_0x3b28dd(0xf8)](_0x3b28dd(0xce)+_0x52b304['id']+'\x20('+_0x52b304[_0x3b28dd(0x10c)]+',\x20'+_0x52b304[_0x3b28dd(0xdd)]+'\x20'+_0x52b304[_0x3b28dd(0x88)]+')'),console[_0x3b28dd(0xf8)](_0x3b28dd(0x103)+_0x52b304[_0x3b28dd(0xff)][_0x3b28dd(0xae)]+'\x20('+_0x52b304[_0x3b28dd(0xff)][_0x3b28dd(0x11c)]+')'),console[_0x3b28dd(0xf8)](_0x3b28dd(0xbf)+_0x52b304[_0x3b28dd(0xc0)][_0x3b28dd(0xf2)]()),console['log']('\x20\x20\x20Age:\x20'+Math[_0x3b28dd(0xa1)]((Date['now']()-_0x52b304[_0x3b28dd(0xc0)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x194ef1=await database_1[_0x3b28dd(0xad)]['payment']['update']({'where':{'id':_0x52b304['id']},'data':{'status':client_1['PaymentStatus'][_0x3b28dd(0xd8)],'statusChangedBy':_0x3b28dd(0xe3),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this['PROCESSING_TIMEOUT_DAYS']+_0x3b28dd(0x119)}});console[_0x3b28dd(0xf8)]('‚úÖ\x20Updated\x20payment\x20'+_0x52b304['id']+_0x3b28dd(0x118)),loggerService_1['loggerService'][_0x3b28dd(0xa2)](_0x52b304['gateway'],_0x52b304['id'],_0x3b28dd(0xd4),_0x3b28dd(0xd8),{'reason':_0x3b28dd(0xf5),'timeoutDays':this[_0x3b28dd(0xf4)]}),_0x244a50++;}catch(_0x2840b5){const _0x16f66f=_0x3b28dd(0xd0)+_0x52b304['id']+':\x20'+(_0x2840b5 instanceof Error?_0x2840b5[_0x3b28dd(0xda)]:'Unknown\x20error');console[_0x3b28dd(0x8a)]('‚ùå\x20'+_0x16f66f),_0x2e9087[_0x3b28dd(0x10b)](_0x16f66f),_0x383c55++;}}const _0x300434=_0x3b28dd(0x87)+_0x244a50+_0x3b28dd(0x9f)+_0x383c55+_0x3b28dd(0x115);return console[_0x3b28dd(0xf8)](_0x3b28dd(0x8f)+_0x300434),loggerService_1[_0x3b28dd(0x97)]['logApiCall']('payment_cleanup',_0x3b28dd(0xdb),_0x3b28dd(0xe3),_0x3b28dd(0xb5),{'processed':_0x244a50,'failed':_0x383c55,'errors':_0x2e9087,'timeoutDays':this[_0x3b28dd(0xf4)]}),{'processed':_0x244a50,'failed':_0x383c55,'errors':_0x2e9087};}catch(_0x1f9056){const _0x2b6506=_0x3b28dd(0x11e)+(_0x1f9056 instanceof Error?_0x1f9056['message']:_0x3b28dd(0x10e));return console[_0x3b28dd(0x8a)](_0x3b28dd(0xe5)+_0x2b6506),_0x2e9087[_0x3b28dd(0x10b)](_0x2b6506),loggerService_1['loggerService'][_0x3b28dd(0x8b)](_0x3b28dd(0xaf),_0x2b6506,{'timeoutDays':this[_0x3b28dd(0xf4)]}),{'processed':_0x244a50,'failed':_0x383c55,'errors':_0x2e9087};}}async['cleanupStalePendingPayments'](){const _0x27d559=a80_0x27e340,_0x12aa3d=[];let _0x509ec7=0x0,_0x36ba70=0x0;try{console[_0x27d559(0xf8)](_0x27d559(0xf7));const _0x23944f=new Date(),_0x15ae27=new Date(_0x23944f[_0x27d559(0xbb)]()-this[_0x27d559(0xc7)]*0x3c*0x3e8),_0x49d64e=new Date();_0x49d64e[_0x27d559(0xf0)](_0x49d64e[_0x27d559(0x102)]()-this[_0x27d559(0xcc)]),console['log'](_0x27d559(0xe2)+_0x15ae27[_0x27d559(0xf2)]()),console[_0x27d559(0xf8)](_0x27d559(0x9d)+_0x49d64e['toISOString']()),console['log'](_0x27d559(0x10d)+this['FAST_TIMEOUT_GATEWAYS'][_0x27d559(0xc9)](',\x20'));const _0x213f93=await database_1['default']['payment']['findMany']({'where':{'status':client_1[_0x27d559(0xeb)][_0x27d559(0xed)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x15ae27}},{'gateway':{'notIn':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x49d64e}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x27d559(0xf8)](_0x27d559(0xb2)+_0x213f93['length']+'\x20stale\x20PENDING\x20payments');if(_0x213f93['length']===0x0)return console[_0x27d559(0xf8)](_0x27d559(0xfa)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x57e48a of _0x213f93){try{const _0x1b817a=this[_0x27d559(0xe7)]['includes'](_0x57e48a[_0x27d559(0x10c)]),_0x3046a9=_0x1b817a?_0x27d559(0xfc):_0x27d559(0x110),_0x107fe8=Math[_0x27d559(0xa1)]((Date[_0x27d559(0xb1)]()-_0x57e48a['createdAt'][_0x27d559(0xbb)]())/(0x3e8*0x3c));console[_0x27d559(0xf8)](_0x27d559(0xef)+_0x57e48a['id']),console['log'](_0x27d559(0x98)+_0x57e48a[_0x27d559(0x10c)]+'\x20('+_0x3046a9+_0x27d559(0xfd)),console['log'](_0x27d559(0xd1)+_0x57e48a[_0x27d559(0xdd)]+'\x20'+_0x57e48a[_0x27d559(0x88)]),console[_0x27d559(0xf8)]('\x20\x20\x20Shop:\x20'+_0x57e48a['shop'][_0x27d559(0xae)]+'\x20('+_0x57e48a[_0x27d559(0xff)][_0x27d559(0x11c)]+')'),console['log'](_0x27d559(0xbf)+_0x57e48a['createdAt'][_0x27d559(0xf2)]()),console['log'](_0x27d559(0xbe)+_0x107fe8+'\x20minutes');const _0x750984=await database_1[_0x27d559(0xad)][_0x27d559(0x96)][_0x27d559(0xcd)]({'where':{'id':_0x57e48a['id']},'data':{'status':client_1[_0x27d559(0xeb)][_0x27d559(0x109)],'statusChangedBy':_0x27d559(0xe3),'statusChangedAt':new Date(),'failureMessage':_0x27d559(0x92)+_0x3046a9}});console[_0x27d559(0xf8)]('‚úÖ\x20Updated\x20payment\x20'+_0x57e48a['id']+_0x27d559(0x9c)),loggerService_1['loggerService'][_0x27d559(0xa2)](_0x57e48a[_0x27d559(0x10c)],_0x57e48a['id'],_0x27d559(0xed),'EXPIRED',{'reason':_0x27d559(0xaa),'timeout':_0x3046a9,'ageMinutes':_0x107fe8}),_0x509ec7++;}catch(_0x9e010b){const _0x49ebdd=_0x27d559(0xdc)+_0x57e48a['id']+':\x20'+(_0x9e010b instanceof Error?_0x9e010b[_0x27d559(0xda)]:_0x27d559(0x10e));console[_0x27d559(0x8a)]('‚ùå\x20'+_0x49ebdd),_0x12aa3d[_0x27d559(0x10b)](_0x49ebdd),_0x36ba70++;}}const _0x347619=_0x27d559(0xe1)+_0x509ec7+_0x27d559(0xe9)+_0x36ba70+_0x27d559(0x115);return console['log'](_0x27d559(0x8f)+_0x347619),loggerService_1[_0x27d559(0x97)][_0x27d559(0x11b)](_0x27d559(0x94),'POST',_0x27d559(0xe3),'admin',{'processed':_0x509ec7,'failed':_0x36ba70,'errors':_0x12aa3d,'fastTimeoutMinutes':this[_0x27d559(0xc7)],'slowTimeoutDays':this[_0x27d559(0xcc)]}),{'processed':_0x509ec7,'failed':_0x36ba70,'errors':_0x12aa3d};}catch(_0x199010){const _0x22f14='PENDING\x20cleanup\x20service\x20error:\x20'+(_0x199010 instanceof Error?_0x199010[_0x27d559(0xda)]:_0x27d559(0x10e));return console[_0x27d559(0x8a)](_0x27d559(0xe5)+_0x22f14),_0x12aa3d[_0x27d559(0x10b)](_0x22f14),loggerService_1['loggerService'][_0x27d559(0x8b)]('pending_payment_cleanup',_0x22f14,{'timeoutDays':this[_0x27d559(0x11d)]}),{'processed':_0x509ec7,'failed':_0x36ba70,'errors':_0x12aa3d};}}async[a80_0x27e340(0x105)](){const _0x2014ce=a80_0x27e340;try{const _0x3f012a=new Date(),_0x3fe7e8=new Date(_0x3f012a[_0x2014ce(0xbb)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0xa4b90c=new Date(_0x3f012a[_0x2014ce(0xbb)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x3da109=new Date(_0x3f012a[_0x2014ce(0xbb)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x3dc598=await database_1[_0x2014ce(0xad)][_0x2014ce(0x96)][_0x2014ce(0xf1)]({'where':{'status':{'in':[client_1[_0x2014ce(0xeb)]['PROCESSING'],client_1[_0x2014ce(0xeb)]['PENDING']]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x14107e={'total':_0x3dc598['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x373a2c of _0x3dc598){if(_0x373a2c['createdAt']>_0x3fe7e8)_0x14107e['byAge'][_0x2014ce(0x107)]++;else{if(_0x373a2c[_0x2014ce(0xc0)]>_0xa4b90c)_0x14107e[_0x2014ce(0x104)][_0x2014ce(0xc8)]++;else _0x373a2c['createdAt']>_0x3da109?_0x14107e[_0x2014ce(0x104)][_0x2014ce(0xc5)]++:_0x14107e['byAge'][_0x2014ce(0xa9)]++;}!_0x14107e[_0x2014ce(0xc6)][_0x373a2c[_0x2014ce(0x10c)]]&&(_0x14107e[_0x2014ce(0xc6)][_0x373a2c[_0x2014ce(0x10c)]]=0x0);_0x14107e['byGateway'][_0x373a2c[_0x2014ce(0x10c)]]++;const _0x40d1d7=_0x373a2c[_0x2014ce(0xb3)];!_0x14107e[_0x2014ce(0xa7)][_0x40d1d7]&&(_0x14107e['byStatus'][_0x40d1d7]=0x0),_0x14107e['byStatus'][_0x40d1d7]++;}return _0x14107e;}catch(_0x1b0414){console['error'](_0x2014ce(0xb4),_0x1b0414);throw new Error(_0x2014ce(0xc3)+(_0x1b0414 instanceof Error?_0x1b0414[_0x2014ce(0xda)]:_0x2014ce(0x10e)));}}async[a80_0x27e340(0x93)](){const _0x20c55f=a80_0x27e340;console[_0x20c55f(0xf8)](_0x20c55f(0xb0));const _0xe5a4fa=await this[_0x20c55f(0x105)]();console['log'](_0x20c55f(0x114)),console[_0x20c55f(0xf8)](_0x20c55f(0x85)+_0xe5a4fa[_0x20c55f(0x11f)]),console[_0x20c55f(0xf8)]('\x20\x20\x20Fresh\x20(<\x201\x20day):\x20'+_0xe5a4fa['byAge']['fresh']),console['log'](_0x20c55f(0x9e)+_0xe5a4fa[_0x20c55f(0x104)][_0x20c55f(0xc8)]),console[_0x20c55f(0xf8)](_0x20c55f(0x99)+_0xe5a4fa['byAge'][_0x20c55f(0xc5)]),console[_0x20c55f(0xf8)]('\x20\x20\x20Expired\x20(>\x205\x20days):\x20'+_0xe5a4fa[_0x20c55f(0x104)]['expired']),console[_0x20c55f(0xf8)](_0x20c55f(0xa3),_0xe5a4fa['byGateway']),console[_0x20c55f(0xf8)]('\x20\x20\x20By\x20status:',_0xe5a4fa['byStatus']),console['log'](_0x20c55f(0xc4));const _0x122899=await this[_0x20c55f(0xe4)]();console[_0x20c55f(0xf8)](_0x20c55f(0xac));const _0x4d4044=await this[_0x20c55f(0xca)](),_0x52008c=await this[_0x20c55f(0x105)]();console[_0x20c55f(0xf8)](_0x20c55f(0xe0)),console[_0x20c55f(0xf8)](_0x20c55f(0x85)+_0x52008c[_0x20c55f(0x11f)]),console['log'](_0x20c55f(0xde)+_0x52008c[_0x20c55f(0x104)][_0x20c55f(0xa9)]),console[_0x20c55f(0xf8)](_0x20c55f(0xb6),_0x52008c[_0x20c55f(0xa7)]);const _0x4d19b2=_0x122899[_0x20c55f(0xba)]+_0x4d4044['processed'],_0x52bd8b=_0x122899[_0x20c55f(0x8d)]+_0x4d4044[_0x20c55f(0x8d)],_0x325090=[..._0x122899[_0x20c55f(0x10f)],..._0x4d4044[_0x20c55f(0x10f)]];console['log'](_0x20c55f(0xec)),console[_0x20c55f(0xf8)]('\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20'+_0x122899[_0x20c55f(0xba)]),console['log']('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x4d4044[_0x20c55f(0xba)]),console[_0x20c55f(0xf8)](_0x20c55f(0xf3)+_0x4d19b2),console[_0x20c55f(0xf8)](_0x20c55f(0x100)+_0x52bd8b),console['log']('\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0xe5a4fa[_0x20c55f(0x11f)]-_0x52008c['total'])),_0x325090['length']>0x0&&(console[_0x20c55f(0xf8)](_0x20c55f(0x106)),_0x325090['forEach']((_0x588eb1,_0x1a8f68)=>{const _0x379f03=_0x20c55f;console[_0x379f03(0xf8)]('\x20\x20\x20\x20\x20\x20'+(_0x1a8f68+0x1)+'.\x20'+_0x588eb1);})),console[_0x20c55f(0xf8)](_0x20c55f(0xd3));}async['runProcessingCleanupOnly'](){const _0x12e698=a80_0x27e340;console[_0x12e698(0xf8)](_0x12e698(0xf6));const _0x1b5529=await this[_0x12e698(0x105)](),_0x519523=_0x1b5529[_0x12e698(0xa7)][_0x12e698(0xd4)]||0x0;console[_0x12e698(0xf8)]('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x519523);const _0x2038b1=await this[_0x12e698(0xe4)](),_0x490d0e=await this[_0x12e698(0x105)](),_0x431e9c=_0x490d0e[_0x12e698(0xa7)]['PROCESSING']||0x0;console[_0x12e698(0xf8)](_0x12e698(0xf9)+_0x431e9c),console['log'](_0x12e698(0xd6)+_0x2038b1[_0x12e698(0xba)]),console[_0x12e698(0xf8)](_0x12e698(0x113));}async['runPendingCleanupOnly'](){const _0x5107f3=a80_0x27e340;console[_0x5107f3(0xf8)]('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x14fc18=await this[_0x5107f3(0x105)](),_0x3368e4=_0x14fc18[_0x5107f3(0xa7)]['PENDING']||0x0;console[_0x5107f3(0xf8)](_0x5107f3(0x86)+_0x3368e4);const _0x318220=await this['cleanupStalePendingPayments'](),_0x179060=await this['getProcessingPaymentsStats'](),_0x185a01=_0x179060[_0x5107f3(0xa7)][_0x5107f3(0xed)]||0x0;console['log'](_0x5107f3(0x101)+_0x185a01),console[_0x5107f3(0xf8)]('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x318220[_0x5107f3(0xba)]),console['log'](_0x5107f3(0xb7));}async[a80_0x27e340(0xc2)](){const _0x2d1d2b=a80_0x27e340,_0x4df87a=[];let _0x20ab94=0x0;try{console[_0x2d1d2b(0xf8)](_0x2d1d2b(0xd7));const _0xdc0a36=new Date(),_0x1d18a3=[_0x2d1d2b(0xfb),_0x2d1d2b(0x116)],_0x39f84f=[_0x2d1d2b(0xfe),_0x2d1d2b(0xa0),_0x2d1d2b(0xa8),_0x2d1d2b(0x8c)],_0x374ba2=await database_1[_0x2d1d2b(0xad)][_0x2d1d2b(0xb9)][_0x2d1d2b(0xf1)]({'where':{'type':_0x2d1d2b(0xab),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':_0x2d1d2b(0x10a)},'take':0x1}}});console['log'](_0x2d1d2b(0xb2)+_0x374ba2[_0x2d1d2b(0xee)]+_0x2d1d2b(0xe8));for(const _0x4c62e6 of _0x374ba2){try{if(_0x4c62e6[_0x2d1d2b(0x95)]['length']===0x0)continue;const _0x4b9598=_0x4c62e6[_0x2d1d2b(0x95)][0x0];if(_0x4b9598['status']===_0x2d1d2b(0x89))continue;const _0x2c453e=_0xdc0a36[_0x2d1d2b(0xbb)]()-_0x4b9598[_0x2d1d2b(0xc0)]['getTime']();let _0x399b83;_0x1d18a3[_0x2d1d2b(0x9b)](_0x4c62e6[_0x2d1d2b(0x10c)])||_0x39f84f[_0x2d1d2b(0x9b)](_0x4c62e6[_0x2d1d2b(0x10c)])?_0x399b83=0x1e*0x3c*0x3e8:_0x399b83=0x3*0x18*0x3c*0x3c*0x3e8,_0x2c453e>_0x399b83&&(await database_1[_0x2d1d2b(0xad)]['paymentLink']['update']({'where':{'id':_0x4c62e6['id']},'data':{'status':_0x2d1d2b(0x109)}}),console[_0x2d1d2b(0xf8)]('‚è∞\x20Expired\x20link\x20'+_0x4c62e6['id']+_0x2d1d2b(0xa6)+_0x4c62e6[_0x2d1d2b(0x10c)]+',\x20payment\x20age:\x20'+Math[_0x2d1d2b(0x11a)](_0x2c453e/0x3e8/0x3c)+_0x2d1d2b(0xb8)),_0x20ab94++);}catch(_0x216f2c){const _0x496d5f=_0x2d1d2b(0xbc)+_0x4c62e6['id']+':\x20'+(_0x216f2c instanceof Error?_0x216f2c['message']:'Unknown\x20error');console['error']('‚ùå\x20'+_0x496d5f),_0x4df87a[_0x2d1d2b(0x10b)](_0x496d5f);}}return console['log'](_0x2d1d2b(0xd9)+_0x20ab94+'\x20links\x20expired'),{'expired':_0x20ab94,'errors':_0x4df87a};}catch(_0xfa2c0f){const _0xb1ccfa='Link\x20expiration\x20service\x20error:\x20'+(_0xfa2c0f instanceof Error?_0xfa2c0f['message']:'Unknown\x20error');return console[_0x2d1d2b(0x8a)](_0x2d1d2b(0xe5)+_0xb1ccfa),_0x4df87a[_0x2d1d2b(0x10b)](_0xb1ccfa),{'expired':_0x20ab94,'errors':_0x4df87a};}}}exports['PaymentCleanupService']=PaymentCleanupService,exports[a80_0x27e340(0x112)]=new PaymentCleanupService();