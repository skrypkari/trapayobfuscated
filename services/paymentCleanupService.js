'use strict';const a72_0x150b9c=a72_0x9e40;(function(_0x1fb17e,_0x3e8a46){const _0x4c8b38=a72_0x9e40,_0x4f3469=_0x1fb17e();while(!![]){try{const _0x52220e=-parseInt(_0x4c8b38(0x1dc))/0x1*(-parseInt(_0x4c8b38(0x1b7))/0x2)+parseInt(_0x4c8b38(0x1d0))/0x3+-parseInt(_0x4c8b38(0x1de))/0x4+-parseInt(_0x4c8b38(0x1ba))/0x5+parseInt(_0x4c8b38(0x1d4))/0x6+-parseInt(_0x4c8b38(0x1e4))/0x7+parseInt(_0x4c8b38(0x180))/0x8;if(_0x52220e===_0x3e8a46)break;else _0x4f3469['push'](_0x4f3469['shift']());}catch(_0x38d3c8){_0x4f3469['push'](_0x4f3469['shift']());}}}(a72_0x1dc8,0xb5f04));function a72_0x9e40(_0x16b20e,_0x2e89da){_0x16b20e=_0x16b20e-0x167;const _0x1dc8ad=a72_0x1dc8();let _0x9e40aa=_0x1dc8ad[_0x16b20e];return _0x9e40aa;}var __importDefault=this&&this['__importDefault']||function(_0x3b6d10){const _0x623612=a72_0x9e40;return _0x3b6d10&&_0x3b6d10[_0x623612(0x1cb)]?_0x3b6d10:{'default':_0x3b6d10};};function a72_0x1dc8(){const _0x507a85=['üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','\x20\x20\x20By\x20gateway:','payment','\x0aüìà\x20Cleanup\x20Summary:','createdAt','getDate','getProcessingPaymentsStats','4651600yQDapM','30\x20minutes','üí•\x20','logWebhookError','mastercard','pending_payment_cleanup','SINGLE','‚úÖ\x20PENDING\x20payments\x20processed:\x20','\x20\x20\x20Stale\x20(3-5\x20days):\x20','FAST_TIMEOUT_GATEWAYS','\x20\x20\x20Gateway:\x20','FAST_TIMEOUT_MINUTES','Failed\x20to\x20update\x20payment\x20','\x20\x20\x20Recent\x20(1-3\x20days):\x20','\x20\x20\x20\x20\x20\x20','logApiCall','log','EXPIRED','amount','username','loggerService','error','setDate','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','../config/database','\x20from\x20PROCESSING\x20to\x20FAILED','admin','\x20active\x20SINGLE\x20links\x20to\x20check','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','PROCESSING_TIMEOUT_DAYS','Unknown\x20error','failed','squirrelpay','now',',\x20payment\x20age:\x20','üèÅ\x20PENDING\x20cleanup\x20completed','processed','PENDING\x20cleanup\x20completed:\x20','update','\x20\x20\x20Amount:\x20','Failed\x20to\x20update\x20PENDING\x20payment\x20','rapyd','status','\x20failed\x20to\x20update','PROCESSING','\x20(gateway:\x20','findMany','POST','system','auto_timeout','üîç\x20Found\x20','length','expired','byGateway','4276TBWkhx','\x20payments\x20updated\x20to\x20EXPIRED,\x20','forEach','3914370mcftky','Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20','visa/mastercard','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','PENDING','gateway','\x20stale\x20PENDING\x20payments','cleanupStaleProcessingPayments','Link\x20expiration\x20service\x20error:\x20','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','join','total','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','@prisma/client','byStatus','squirrel-pay','__esModule','\x20payments\x20updated\x20to\x20FAILED,\x20','payments','paymentCleanupService','runCleanupWithReport','2022363PiwvyK','toISOString','‚úÖ\x20Updated\x20payment\x20','‚è∞\x20Expired\x20link\x20','6791634LeZZme','\x20\x20\x20Total:\x20','paymentLink','push','üìã\x20Fast\x20timeout\x20gateways:\x20','\x20days','\x20\x20\x20By\x20status:','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','173Lhzubj','\x20\x20\x20Age:\x20','263768CdzaWG','runPendingCleanupOnly','Cleanup\x20completed:\x20','\x20\x20\x20Created:\x20','byAge','üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','8143436DIrrea','üèÅ\x20Payment\x20cleanup\x20service\x20completed','getTime','stale','FAILED','oxapay','currency','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','name','cleanupStalePendingPayments','./loggerService','shop','üìä\x20','defineProperty','üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','floor','\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20','‚úÖ\x20PROCESSING\x20payments\x20processed:\x20','üìä\x20Expiration\x20completed:\x20','includes','PaymentCleanupService','PaymentStatus','\x20stale\x20PROCESSING\x20payments','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','SLOW_TIMEOUT_DAYS','plisio','runProcessingCleanupOnly','message','\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','default','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','errors','PENDING_TIMEOUT_DAYS','payment_cleanup','auto_timeout_pending','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','fresh','expireSinglePaymentLinks','\x20minutes','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','PENDING\x20cleanup\x20service\x20error:\x20'];a72_0x1dc8=function(){return _0x507a85;};return a72_0x1dc8();}Object[a72_0x150b9c(0x1f1)](exports,a72_0x150b9c(0x1cb),{'value':!![]}),exports['paymentCleanupService']=exports[a72_0x150b9c(0x1f8)]=void 0x0;const database_1=__importDefault(require(a72_0x150b9c(0x199))),client_1=require(a72_0x150b9c(0x1c8)),loggerService_1=require(a72_0x150b9c(0x1ee));class PaymentCleanupService{constructor(){const _0x532b0c=a72_0x150b9c;this[_0x532b0c(0x19e)]=0x5,this[_0x532b0c(0x170)]=0x5,this[_0x532b0c(0x18b)]=0x1e,this[_0x532b0c(0x168)]=0x3,this[_0x532b0c(0x189)]=[_0x532b0c(0x1a1),_0x532b0c(0x1ca),_0x532b0c(0x1aa),'visa/mastercard',_0x532b0c(0x169),_0x532b0c(0x1e9)];}async[a72_0x150b9c(0x1c2)](){const _0x445b25=a72_0x150b9c,_0x32d57c=[];let _0x55ca2d=0x0,_0x2f213f=0x0;try{console[_0x445b25(0x190)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x46a9a9=new Date();_0x46a9a9[_0x445b25(0x196)](_0x46a9a9[_0x445b25(0x17e)]()-this[_0x445b25(0x19e)]),console[_0x445b25(0x190)](_0x445b25(0x177)+_0x46a9a9[_0x445b25(0x1d1)]());const _0x59f97b=await database_1[_0x445b25(0x16d)][_0x445b25(0x17b)]['findMany']({'where':{'status':client_1['PaymentStatus']['PROCESSING'],'createdAt':{'lt':_0x46a9a9}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x445b25(0x190)](_0x445b25(0x1b3)+_0x59f97b[_0x445b25(0x1b4)]+_0x445b25(0x1fa));if(_0x59f97b[_0x445b25(0x1b4)]===0x0)return console[_0x445b25(0x190)](_0x445b25(0x19d)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x8039d2 of _0x59f97b){try{console[_0x445b25(0x190)]('‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20'+_0x8039d2['id']+'\x20('+_0x8039d2['gateway']+',\x20'+_0x8039d2[_0x445b25(0x192)]+'\x20'+_0x8039d2['currency']+')'),console[_0x445b25(0x190)]('\x20\x20\x20Shop:\x20'+_0x8039d2[_0x445b25(0x1ef)][_0x445b25(0x1ec)]+'\x20('+_0x8039d2['shop']['username']+')'),console['log'](_0x445b25(0x1e1)+_0x8039d2['createdAt']['toISOString']()),console['log']('\x20\x20\x20Age:\x20'+Math[_0x445b25(0x1f3)]((Date[_0x445b25(0x1a2)]()-_0x8039d2[_0x445b25(0x17d)][_0x445b25(0x1e6)]())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x2a48b7=await database_1[_0x445b25(0x16d)][_0x445b25(0x17b)][_0x445b25(0x1a7)]({'where':{'id':_0x8039d2['id']},'data':{'status':client_1[_0x445b25(0x1f9)][_0x445b25(0x1e8)],'statusChangedBy':_0x445b25(0x1b1),'statusChangedAt':new Date(),'failureMessage':_0x445b25(0x197)+this['PROCESSING_TIMEOUT_DAYS']+_0x445b25(0x1d9)}});console[_0x445b25(0x190)]('‚úÖ\x20Updated\x20payment\x20'+_0x8039d2['id']+_0x445b25(0x19a)),loggerService_1[_0x445b25(0x194)]['logWebhookProcessed'](_0x8039d2['gateway'],_0x8039d2['id'],_0x445b25(0x1ad),_0x445b25(0x1e8),{'reason':_0x445b25(0x1b2),'timeoutDays':this[_0x445b25(0x19e)]}),_0x55ca2d++;}catch(_0x5307ce){const _0x39e944=_0x445b25(0x18c)+_0x8039d2['id']+':\x20'+(_0x5307ce instanceof Error?_0x5307ce[_0x445b25(0x16b)]:_0x445b25(0x19f));console[_0x445b25(0x195)]('‚ùå\x20'+_0x39e944),_0x32d57c[_0x445b25(0x1d7)](_0x39e944),_0x2f213f++;}}const _0x16dfb3=_0x445b25(0x1e0)+_0x55ca2d+_0x445b25(0x1cc)+_0x2f213f+_0x445b25(0x1ac);return console['log'](_0x445b25(0x1f0)+_0x16dfb3),loggerService_1[_0x445b25(0x194)][_0x445b25(0x18f)](_0x445b25(0x171),_0x445b25(0x1b0),_0x445b25(0x1b1),_0x445b25(0x19b),{'processed':_0x55ca2d,'failed':_0x2f213f,'errors':_0x32d57c,'timeoutDays':this[_0x445b25(0x19e)]}),{'processed':_0x55ca2d,'failed':_0x2f213f,'errors':_0x32d57c};}catch(_0x5e9bea){const _0x4630ab='Cleanup\x20service\x20error:\x20'+(_0x5e9bea instanceof Error?_0x5e9bea[_0x445b25(0x16b)]:_0x445b25(0x19f));return console['error'](_0x445b25(0x182)+_0x4630ab),_0x32d57c['push'](_0x4630ab),loggerService_1['loggerService']['logWebhookError'](_0x445b25(0x171),_0x4630ab,{'timeoutDays':this[_0x445b25(0x19e)]}),{'processed':_0x55ca2d,'failed':_0x2f213f,'errors':_0x32d57c};}}async['cleanupStalePendingPayments'](){const _0x2d753e=a72_0x150b9c,_0x38d5b3=[];let _0x35fe8c=0x0,_0x5a6cf2=0x0;try{console[_0x2d753e(0x190)]('üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...');const _0x271a11=new Date(),_0x1dfefd=new Date(_0x271a11[_0x2d753e(0x1e6)]()-this[_0x2d753e(0x18b)]*0x3c*0x3e8),_0x4a1545=new Date();_0x4a1545[_0x2d753e(0x196)](_0x4a1545[_0x2d753e(0x17e)]()-this[_0x2d753e(0x168)]),console[_0x2d753e(0x190)]('üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20'+_0x1dfefd[_0x2d753e(0x1d1)]()),console[_0x2d753e(0x190)]('üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20'+_0x4a1545[_0x2d753e(0x1d1)]()),console['log'](_0x2d753e(0x1d8)+this[_0x2d753e(0x189)][_0x2d753e(0x1c5)](',\x20'));const _0x2af87b=await database_1['default'][_0x2d753e(0x17b)][_0x2d753e(0x1af)]({'where':{'status':client_1[_0x2d753e(0x1f9)][_0x2d753e(0x1bf)],'OR':[{'gateway':{'in':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x1dfefd}},{'gateway':{'notIn':this['FAST_TIMEOUT_GATEWAYS']},'createdAt':{'lt':_0x4a1545}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2d753e(0x190)](_0x2d753e(0x1b3)+_0x2af87b['length']+_0x2d753e(0x1c1));if(_0x2af87b[_0x2d753e(0x1b4)]===0x0)return console[_0x2d753e(0x190)](_0x2d753e(0x167)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x1155ed of _0x2af87b){try{const _0x10a4a0=this[_0x2d753e(0x189)][_0x2d753e(0x1f7)](_0x1155ed[_0x2d753e(0x1c0)]),_0x38a7c5=_0x10a4a0?_0x2d753e(0x181):'3\x20days',_0x1b1e08=Math[_0x2d753e(0x1f3)]((Date[_0x2d753e(0x1a2)]()-_0x1155ed[_0x2d753e(0x17d)][_0x2d753e(0x1e6)]())/(0x3e8*0x3c));console[_0x2d753e(0x190)](_0x2d753e(0x1bd)+_0x1155ed['id']),console[_0x2d753e(0x190)](_0x2d753e(0x18a)+_0x1155ed[_0x2d753e(0x1c0)]+'\x20('+_0x38a7c5+'\x20timeout)'),console[_0x2d753e(0x190)](_0x2d753e(0x1a8)+_0x1155ed[_0x2d753e(0x192)]+'\x20'+_0x1155ed[_0x2d753e(0x1ea)]),console[_0x2d753e(0x190)]('\x20\x20\x20Shop:\x20'+_0x1155ed[_0x2d753e(0x1ef)][_0x2d753e(0x1ec)]+'\x20('+_0x1155ed[_0x2d753e(0x1ef)][_0x2d753e(0x193)]+')'),console[_0x2d753e(0x190)]('\x20\x20\x20Created:\x20'+_0x1155ed[_0x2d753e(0x17d)][_0x2d753e(0x1d1)]()),console['log'](_0x2d753e(0x1dd)+_0x1b1e08+_0x2d753e(0x176));const _0x150806=await database_1[_0x2d753e(0x16d)][_0x2d753e(0x17b)][_0x2d753e(0x1a7)]({'where':{'id':_0x1155ed['id']},'data':{'status':client_1[_0x2d753e(0x1f9)][_0x2d753e(0x191)],'statusChangedBy':_0x2d753e(0x1b1),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20'+_0x38a7c5}});console[_0x2d753e(0x190)](_0x2d753e(0x1d2)+_0x1155ed['id']+'\x20from\x20PENDING\x20to\x20EXPIRED'),loggerService_1['loggerService']['logWebhookProcessed'](_0x1155ed[_0x2d753e(0x1c0)],_0x1155ed['id'],_0x2d753e(0x1bf),_0x2d753e(0x191),{'reason':_0x2d753e(0x172),'timeout':_0x38a7c5,'ageMinutes':_0x1b1e08}),_0x35fe8c++;}catch(_0x1110c9){const _0x4e56ad=_0x2d753e(0x1a9)+_0x1155ed['id']+':\x20'+(_0x1110c9 instanceof Error?_0x1110c9[_0x2d753e(0x16b)]:_0x2d753e(0x19f));console[_0x2d753e(0x195)]('‚ùå\x20'+_0x4e56ad),_0x38d5b3[_0x2d753e(0x1d7)](_0x4e56ad),_0x5a6cf2++;}}const _0x3ff48b=_0x2d753e(0x1a6)+_0x35fe8c+_0x2d753e(0x1b8)+_0x5a6cf2+_0x2d753e(0x1ac);return console['log']('üìä\x20'+_0x3ff48b),loggerService_1[_0x2d753e(0x194)][_0x2d753e(0x18f)](_0x2d753e(0x185),'POST','system',_0x2d753e(0x19b),{'processed':_0x35fe8c,'failed':_0x5a6cf2,'errors':_0x38d5b3,'fastTimeoutMinutes':this[_0x2d753e(0x18b)],'slowTimeoutDays':this[_0x2d753e(0x168)]}),{'processed':_0x35fe8c,'failed':_0x5a6cf2,'errors':_0x38d5b3};}catch(_0x29454d){const _0x4e63f2=_0x2d753e(0x178)+(_0x29454d instanceof Error?_0x29454d['message']:_0x2d753e(0x19f));return console['error'](_0x2d753e(0x182)+_0x4e63f2),_0x38d5b3[_0x2d753e(0x1d7)](_0x4e63f2),loggerService_1['loggerService'][_0x2d753e(0x183)](_0x2d753e(0x185),_0x4e63f2,{'timeoutDays':this[_0x2d753e(0x170)]}),{'processed':_0x35fe8c,'failed':_0x5a6cf2,'errors':_0x38d5b3};}}async[a72_0x150b9c(0x17f)](){const _0x84f3dd=a72_0x150b9c;try{const _0x4bb71a=new Date(),_0x164fd4=new Date(_0x4bb71a[_0x84f3dd(0x1e6)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0xd0c3ae=new Date(_0x4bb71a[_0x84f3dd(0x1e6)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x17af05=new Date(_0x4bb71a['getTime']()-0x5*0x18*0x3c*0x3c*0x3e8),_0x52269d=await database_1[_0x84f3dd(0x16d)][_0x84f3dd(0x17b)][_0x84f3dd(0x1af)]({'where':{'status':{'in':[client_1['PaymentStatus']['PROCESSING'],client_1['PaymentStatus'][_0x84f3dd(0x1bf)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x32bccd={'total':_0x52269d[_0x84f3dd(0x1b4)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x150346 of _0x52269d){if(_0x150346[_0x84f3dd(0x17d)]>_0x164fd4)_0x32bccd['byAge'][_0x84f3dd(0x174)]++;else{if(_0x150346[_0x84f3dd(0x17d)]>_0xd0c3ae)_0x32bccd[_0x84f3dd(0x1e2)]['recent']++;else _0x150346[_0x84f3dd(0x17d)]>_0x17af05?_0x32bccd['byAge'][_0x84f3dd(0x1e7)]++:_0x32bccd['byAge'][_0x84f3dd(0x1b5)]++;}!_0x32bccd[_0x84f3dd(0x1b6)][_0x150346[_0x84f3dd(0x1c0)]]&&(_0x32bccd[_0x84f3dd(0x1b6)][_0x150346['gateway']]=0x0);_0x32bccd['byGateway'][_0x150346[_0x84f3dd(0x1c0)]]++;const _0x27e289=_0x150346[_0x84f3dd(0x1ab)];!_0x32bccd[_0x84f3dd(0x1c9)][_0x27e289]&&(_0x32bccd['byStatus'][_0x27e289]=0x0),_0x32bccd[_0x84f3dd(0x1c9)][_0x27e289]++;}return _0x32bccd;}catch(_0x37a861){console[_0x84f3dd(0x195)]('Failed\x20to\x20get\x20processing\x20payments\x20stats:',_0x37a861);throw new Error(_0x84f3dd(0x1bb)+(_0x37a861 instanceof Error?_0x37a861[_0x84f3dd(0x16b)]:_0x84f3dd(0x19f)));}}async[a72_0x150b9c(0x1cf)](){const _0x19cee6=a72_0x150b9c;console[_0x19cee6(0x190)]('üöÄ\x20Starting\x20payment\x20cleanup\x20service...');const _0x4ca43c=await this['getProcessingPaymentsStats']();console[_0x19cee6(0x190)](_0x19cee6(0x179)),console[_0x19cee6(0x190)](_0x19cee6(0x1d5)+_0x4ca43c[_0x19cee6(0x1c6)]),console[_0x19cee6(0x190)](_0x19cee6(0x198)+_0x4ca43c[_0x19cee6(0x1e2)][_0x19cee6(0x174)]),console[_0x19cee6(0x190)](_0x19cee6(0x18d)+_0x4ca43c['byAge']['recent']),console[_0x19cee6(0x190)](_0x19cee6(0x188)+_0x4ca43c['byAge'][_0x19cee6(0x1e7)]),console[_0x19cee6(0x190)](_0x19cee6(0x1c7)+_0x4ca43c['byAge'][_0x19cee6(0x1b5)]),console[_0x19cee6(0x190)](_0x19cee6(0x17a),_0x4ca43c[_0x19cee6(0x1b6)]),console[_0x19cee6(0x190)]('\x20\x20\x20By\x20status:',_0x4ca43c['byStatus']),console[_0x19cee6(0x190)]('\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x46ae48=await this['cleanupStaleProcessingPayments']();console[_0x19cee6(0x190)]('\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...');const _0x22ec79=await this[_0x19cee6(0x1ed)](),_0x2e5ea8=await this[_0x19cee6(0x17f)]();console['log'](_0x19cee6(0x16c)),console['log']('\x20\x20\x20Total:\x20'+_0x2e5ea8[_0x19cee6(0x1c6)]),console['log'](_0x19cee6(0x1c7)+_0x2e5ea8[_0x19cee6(0x1e2)]['expired']),console[_0x19cee6(0x190)](_0x19cee6(0x1da),_0x2e5ea8[_0x19cee6(0x1c9)]);const _0x4e1fc3=_0x46ae48['processed']+_0x22ec79[_0x19cee6(0x1a5)],_0x42ab04=_0x46ae48[_0x19cee6(0x1a0)]+_0x22ec79[_0x19cee6(0x1a0)],_0x2468dd=[..._0x46ae48[_0x19cee6(0x16f)],..._0x22ec79[_0x19cee6(0x16f)]];console[_0x19cee6(0x190)](_0x19cee6(0x17c)),console[_0x19cee6(0x190)](_0x19cee6(0x1db)+_0x46ae48[_0x19cee6(0x1a5)]),console[_0x19cee6(0x190)](_0x19cee6(0x1f4)+_0x22ec79[_0x19cee6(0x1a5)]),console[_0x19cee6(0x190)](_0x19cee6(0x16e)+_0x4e1fc3),console[_0x19cee6(0x190)]('\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20'+_0x42ab04),console['log'](_0x19cee6(0x173)+(_0x4ca43c[_0x19cee6(0x1c6)]-_0x2e5ea8[_0x19cee6(0x1c6)])),_0x2468dd['length']>0x0&&(console[_0x19cee6(0x190)]('\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:'),_0x2468dd[_0x19cee6(0x1b9)]((_0x3875e7,_0x2fd84e)=>{const _0x5cf846=_0x19cee6;console['log'](_0x5cf846(0x18e)+(_0x2fd84e+0x1)+'.\x20'+_0x3875e7);})),console[_0x19cee6(0x190)](_0x19cee6(0x1e5));}async[a72_0x150b9c(0x16a)](){const _0x4e3d6a=a72_0x150b9c;console[_0x4e3d6a(0x190)](_0x4e3d6a(0x1e3));const _0x3ecc33=await this[_0x4e3d6a(0x17f)](),_0x20c59f=_0x3ecc33[_0x4e3d6a(0x1c9)][_0x4e3d6a(0x1ad)]||0x0;console[_0x4e3d6a(0x190)]('üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20'+_0x20c59f);const _0x5d0343=await this[_0x4e3d6a(0x1c2)](),_0x5d40ed=await this[_0x4e3d6a(0x17f)](),_0x13e2ca=_0x5d40ed[_0x4e3d6a(0x1c9)][_0x4e3d6a(0x1ad)]||0x0;console['log'](_0x4e3d6a(0x1f2)+_0x13e2ca),console['log'](_0x4e3d6a(0x1f5)+_0x5d0343['processed']),console[_0x4e3d6a(0x190)]('üèÅ\x20PROCESSING\x20cleanup\x20completed');}async[a72_0x150b9c(0x1df)](){const _0x38887f=a72_0x150b9c;console['log']('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x397aa7=await this[_0x38887f(0x17f)](),_0x159d90=_0x397aa7[_0x38887f(0x1c9)][_0x38887f(0x1bf)]||0x0;console[_0x38887f(0x190)](_0x38887f(0x1c4)+_0x159d90);const _0x4ea67e=await this[_0x38887f(0x1ed)](),_0x3f4d51=await this[_0x38887f(0x17f)](),_0x1113e0=_0x3f4d51[_0x38887f(0x1c9)][_0x38887f(0x1bf)]||0x0;console[_0x38887f(0x190)](_0x38887f(0x1eb)+_0x1113e0),console[_0x38887f(0x190)](_0x38887f(0x187)+_0x4ea67e['processed']),console['log'](_0x38887f(0x1a4));}async[a72_0x150b9c(0x175)](){const _0xfb5d49=a72_0x150b9c,_0x379352=[];let _0x1878a5=0x0;try{console[_0xfb5d49(0x190)](_0xfb5d49(0x1be));const _0x312dd9=new Date(),_0xc09330=[_0xfb5d49(0x1e9),_0xfb5d49(0x169)],_0xc8f6bc=[_0xfb5d49(0x1a1),_0xfb5d49(0x1aa),_0xfb5d49(0x1bc),_0xfb5d49(0x184)],_0x3c7577=await database_1[_0xfb5d49(0x16d)][_0xfb5d49(0x1d6)]['findMany']({'where':{'type':_0xfb5d49(0x186),'status':'ACTIVE'},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0xfb5d49(0x190)](_0xfb5d49(0x1b3)+_0x3c7577[_0xfb5d49(0x1b4)]+_0xfb5d49(0x19c));for(const _0x25aebc of _0x3c7577){try{if(_0x25aebc[_0xfb5d49(0x1cd)]['length']===0x0)continue;const _0x27627a=_0x25aebc[_0xfb5d49(0x1cd)][0x0];if(_0x27627a['status']==='PAID')continue;const _0x33b60e=_0x312dd9[_0xfb5d49(0x1e6)]()-_0x27627a['createdAt'][_0xfb5d49(0x1e6)]();let _0x5353c9;_0xc09330[_0xfb5d49(0x1f7)](_0x25aebc[_0xfb5d49(0x1c0)])||_0xc8f6bc[_0xfb5d49(0x1f7)](_0x25aebc[_0xfb5d49(0x1c0)])?_0x5353c9=0x1e*0x3c*0x3e8:_0x5353c9=0x3*0x18*0x3c*0x3c*0x3e8,_0x33b60e>_0x5353c9&&(await database_1[_0xfb5d49(0x16d)][_0xfb5d49(0x1d6)][_0xfb5d49(0x1a7)]({'where':{'id':_0x25aebc['id']},'data':{'status':_0xfb5d49(0x191)}}),console[_0xfb5d49(0x190)](_0xfb5d49(0x1d3)+_0x25aebc['id']+_0xfb5d49(0x1ae)+_0x25aebc[_0xfb5d49(0x1c0)]+_0xfb5d49(0x1a3)+Math['round'](_0x33b60e/0x3e8/0x3c)+'\x20minutes)'),_0x1878a5++);}catch(_0x48a0f5){const _0x168f98='Failed\x20to\x20expire\x20link\x20'+_0x25aebc['id']+':\x20'+(_0x48a0f5 instanceof Error?_0x48a0f5[_0xfb5d49(0x16b)]:_0xfb5d49(0x19f));console[_0xfb5d49(0x195)]('‚ùå\x20'+_0x168f98),_0x379352[_0xfb5d49(0x1d7)](_0x168f98);}}return console[_0xfb5d49(0x190)](_0xfb5d49(0x1f6)+_0x1878a5+'\x20links\x20expired'),{'expired':_0x1878a5,'errors':_0x379352};}catch(_0x115cc2){const _0x231af9=_0xfb5d49(0x1c3)+(_0x115cc2 instanceof Error?_0x115cc2[_0xfb5d49(0x16b)]:'Unknown\x20error');return console[_0xfb5d49(0x195)](_0xfb5d49(0x182)+_0x231af9),_0x379352[_0xfb5d49(0x1d7)](_0x231af9),{'expired':_0x1878a5,'errors':_0x379352};}}}exports[a72_0x150b9c(0x1f8)]=PaymentCleanupService,exports[a72_0x150b9c(0x1ce)]=new PaymentCleanupService();