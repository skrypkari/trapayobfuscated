'use strict';const a72_0x237ece=a72_0xe9ca;(function(_0x410231,_0x25397a){const _0x589f06=a72_0xe9ca,_0x37b57a=_0x410231();while(!![]){try{const _0x2ae07a=-parseInt(_0x589f06(0x1ec))/0x1*(-parseInt(_0x589f06(0x19c))/0x2)+-parseInt(_0x589f06(0x1b7))/0x3*(-parseInt(_0x589f06(0x19f))/0x4)+parseInt(_0x589f06(0x165))/0x5*(parseInt(_0x589f06(0x173))/0x6)+parseInt(_0x589f06(0x1a5))/0x7+-parseInt(_0x589f06(0x1a4))/0x8*(parseInt(_0x589f06(0x1a2))/0x9)+-parseInt(_0x589f06(0x1e7))/0xa*(-parseInt(_0x589f06(0x197))/0xb)+-parseInt(_0x589f06(0x1ba))/0xc;if(_0x2ae07a===_0x25397a)break;else _0x37b57a['push'](_0x37b57a['shift']());}catch(_0x5e0740){_0x37b57a['push'](_0x37b57a['shift']());}}}(a72_0x493c,0x6251b));var __importDefault=this&&this[a72_0x237ece(0x1cd)]||function(_0x16f53e){const _0x36b8e8=a72_0x237ece;return _0x16f53e&&_0x16f53e[_0x36b8e8(0x1ac)]?_0x16f53e:{'default':_0x16f53e};};Object[a72_0x237ece(0x166)](exports,a72_0x237ece(0x1ac),{'value':!![]}),exports[a72_0x237ece(0x1cb)]=exports[a72_0x237ece(0x155)]=void 0x0;function a72_0x493c(){const _0x173998=['setDate','14524992qvneJG','PaymentStatus','ACTIVE','\x0aüîÑ\x20Running\x20PROCESSING\x20payments\x20cleanup...','processed','\x20minutes)','üìä\x20Expiration\x20completed:\x20','‚úÖ\x20No\x20stale\x20PROCESSING\x20payments\x20found','Cleanup\x20service\x20error:\x20','oxapay','üí•\x20','message','‚è∞\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','paymentLink','../config/database','SINGLE','runPendingCleanupOnly','paymentCleanupService','\x20\x20\x20\x20\x20\x20','__importDefault','push','FAST_TIMEOUT_GATEWAYS','getProcessingPaymentsStats','FAILED','rapyd','\x20stale\x20PROCESSING\x20payments','squirrel-pay','failed','runProcessingCleanupOnly','includes','expireSinglePaymentLinks','payment_cleanup','\x20timeout)','\x20links\x20expired','üèÅ\x20PROCESSING\x20cleanup\x20completed','getTime','\x20\x20\x20Age:\x20','length','squirrelpay','getDate','Unknown\x20error','now','visa/mastercard','toISOString','üìã\x20Fast\x20timeout\x20gateways:\x20','118690qtVWMb','\x20payments\x20updated\x20to\x20EXPIRED,\x20','update','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...','üìÖ\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','47yrpPTa','log','\x20failed\x20to\x20update','\x20\x20\x20Shop:\x20','\x20(gateway:\x20','logWebhookError','PaymentCleanupService','Failed\x20to\x20update\x20payment\x20','\x20from\x20PENDING\x20to\x20EXPIRED','\x20\x20\x20‚úÖ\x20Total\x20successfully\x20processed:\x20','system','auto_timeout_pending','name','\x20\x20\x20‚ö†Ô∏è\x20Errors\x20encountered:','findMany','\x20\x20\x20üìâ\x20Total\x20stale\x20payments\x20reduced\x20by:\x20','\x20\x20\x20Created:\x20','admin','fresh','üìä\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','byStatus','Failed\x20to\x20get\x20processing\x20payments\x20stats:','57455uYkEKq','defineProperty','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','plisio','üìä\x20PENDING\x20payments\x20before\x20cleanup:\x20','\x0aüìà\x20Cleanup\x20Summary:','30\x20minutes','round','logWebhookProcessed','errors','\x20\x20\x20Gateway:\x20','EXPIRED','‚úÖ\x20No\x20stale\x20PENDING\x20payments\x20found','üìÖ\x20Fast\x20timeout\x20(30\x20min):\x20','144HniKGI','payment','Cleanup\x20completed:\x20','byGateway',',\x20payment\x20age:\x20','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','\x20\x20\x20üîÑ\x20PROCESSING\x20‚Üí\x20FAILED:\x20','PENDING_TIMEOUT_DAYS','üìä\x20','\x20\x20\x20Amount:\x20','\x20minutes','\x20\x20\x20By\x20status:','\x20active\x20SINGLE\x20links\x20to\x20check','gateway','./loggerService','‚è±Ô∏è\x20Processing\x20stale\x20payment:\x20','cleanupStaleProcessingPayments','amount','PAID','PROCESSING','‚è∞\x20Processing\x20stale\x20PENDING\x20payment:\x20','shop','expired','\x0aüîÑ\x20Running\x20PENDING\x20payments\x20cleanup...','forEach','FAST_TIMEOUT_MINUTES','recent','POST','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','total','pending_payment_cleanup','username','payments','\x20\x20\x20Stale\x20(3-5\x20days):\x20','PENDING\x20cleanup\x20service\x20error:\x20','default','187glNlvd','SLOW_TIMEOUT_DAYS','üöÄ\x20Starting\x20payment\x20cleanup\x20service...','\x20days','‚è∞\x20Expired\x20link\x20','30938lqwJFw','\x20\x20\x20By\x20gateway:','createdAt','1293884jOhlJE','loggerService','auto_timeout','2367eZFezh','status','5464UIBFgh','1852823KTcmpS','\x20stale\x20PENDING\x20payments','floor','üìä\x20PENDING\x20payments\x20after\x20cleanup:\x20','PENDING','üìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','\x20from\x20PROCESSING\x20to\x20FAILED','__esModule','stale','üîç\x20Found\x20','üßπ\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20','byAge','error','logApiCall','üìÖ\x20Slow\x20timeout\x20(3\x20days):\x20','currency','cleanupStalePendingPayments','3SvJNMr','PROCESSING_TIMEOUT_DAYS'];a72_0x493c=function(){return _0x173998;};return a72_0x493c();}const database_1=__importDefault(require(a72_0x237ece(0x1c8))),client_1=require('@prisma/client'),loggerService_1=require(a72_0x237ece(0x181));class PaymentCleanupService{constructor(){const _0x49cb87=a72_0x237ece;this[_0x49cb87(0x1b8)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this[_0x49cb87(0x18c)]=0x1e,this[_0x49cb87(0x198)]=0x3,this[_0x49cb87(0x1cf)]=[_0x49cb87(0x1e0),_0x49cb87(0x1d4),_0x49cb87(0x1d2),_0x49cb87(0x1e4),_0x49cb87(0x168),_0x49cb87(0x1c3)];}async[a72_0x237ece(0x183)](){const _0x85d123=a72_0x237ece,_0x4cd651=[];let _0x1fa810=0x0,_0x54d2a3=0x0;try{console[_0x85d123(0x1ed)](_0x85d123(0x1ea));const _0x54c2bb=new Date();_0x54c2bb['setDate'](_0x54c2bb['getDate']()-this[_0x85d123(0x1b8)]),console[_0x85d123(0x1ed)](_0x85d123(0x1eb)+_0x54c2bb[_0x85d123(0x1e5)]());const _0x4ff20f=await database_1[_0x85d123(0x196)][_0x85d123(0x174)][_0x85d123(0x15d)]({'where':{'status':client_1[_0x85d123(0x1bb)]['PROCESSING'],'createdAt':{'lt':_0x54c2bb}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x85d123(0x1ed)]('üîç\x20Found\x20'+_0x4ff20f[_0x85d123(0x1df)]+_0x85d123(0x1d3));if(_0x4ff20f['length']===0x0)return console[_0x85d123(0x1ed)](_0x85d123(0x1c1)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x346ba0 of _0x4ff20f){try{console['log'](_0x85d123(0x182)+_0x346ba0['id']+'\x20('+_0x346ba0['gateway']+',\x20'+_0x346ba0[_0x85d123(0x184)]+'\x20'+_0x346ba0['currency']+')'),console[_0x85d123(0x1ed)]('\x20\x20\x20Shop:\x20'+_0x346ba0['shop'][_0x85d123(0x15b)]+'\x20('+_0x346ba0[_0x85d123(0x188)][_0x85d123(0x192)]+')'),console[_0x85d123(0x1ed)](_0x85d123(0x15f)+_0x346ba0[_0x85d123(0x19e)][_0x85d123(0x1e5)]()),console[_0x85d123(0x1ed)](_0x85d123(0x1de)+Math[_0x85d123(0x1a7)]((Date[_0x85d123(0x1e3)]()-_0x346ba0[_0x85d123(0x19e)]['getTime']())/(0x3e8*0x3c*0x3c*0x18))+_0x85d123(0x19a));const _0x3bd052=await database_1[_0x85d123(0x196)][_0x85d123(0x174)]['update']({'where':{'id':_0x346ba0['id']},'data':{'status':client_1[_0x85d123(0x1bb)][_0x85d123(0x1d1)],'statusChangedBy':_0x85d123(0x159),'statusChangedAt':new Date(),'failureMessage':_0x85d123(0x1b0)+this[_0x85d123(0x1b8)]+_0x85d123(0x19a)}});console[_0x85d123(0x1ed)]('‚úÖ\x20Updated\x20payment\x20'+_0x346ba0['id']+_0x85d123(0x1ab)),loggerService_1[_0x85d123(0x1a0)][_0x85d123(0x16d)](_0x346ba0['gateway'],_0x346ba0['id'],_0x85d123(0x186),_0x85d123(0x1d1),{'reason':_0x85d123(0x1a1),'timeoutDays':this[_0x85d123(0x1b8)]}),_0x1fa810++;}catch(_0x1c8889){const _0x342c2a=_0x85d123(0x156)+_0x346ba0['id']+':\x20'+(_0x1c8889 instanceof Error?_0x1c8889[_0x85d123(0x1c5)]:_0x85d123(0x1e2));console[_0x85d123(0x1b2)]('‚ùå\x20'+_0x342c2a),_0x4cd651[_0x85d123(0x1ce)](_0x342c2a),_0x54d2a3++;}}const _0x39848c=_0x85d123(0x175)+_0x1fa810+'\x20payments\x20updated\x20to\x20FAILED,\x20'+_0x54d2a3+_0x85d123(0x1ee);return console[_0x85d123(0x1ed)](_0x85d123(0x17b)+_0x39848c),loggerService_1[_0x85d123(0x1a0)]['logApiCall'](_0x85d123(0x1d9),_0x85d123(0x18e),_0x85d123(0x159),_0x85d123(0x160),{'processed':_0x1fa810,'failed':_0x54d2a3,'errors':_0x4cd651,'timeoutDays':this[_0x85d123(0x1b8)]}),{'processed':_0x1fa810,'failed':_0x54d2a3,'errors':_0x4cd651};}catch(_0x46be10){const _0x1c108d=_0x85d123(0x1c2)+(_0x46be10 instanceof Error?_0x46be10[_0x85d123(0x1c5)]:'Unknown\x20error');return console['error'](_0x85d123(0x1c4)+_0x1c108d),_0x4cd651[_0x85d123(0x1ce)](_0x1c108d),loggerService_1[_0x85d123(0x1a0)][_0x85d123(0x154)](_0x85d123(0x1d9),_0x1c108d,{'timeoutDays':this[_0x85d123(0x1b8)]}),{'processed':_0x1fa810,'failed':_0x54d2a3,'errors':_0x4cd651};}}async['cleanupStalePendingPayments'](){const _0x4f0fd2=a72_0x237ece,_0x13fdee=[];let _0x3e2a00=0x0,_0x1f09c1=0x0;try{console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1af));const _0x1000db=new Date(),_0x378ccf=new Date(_0x1000db[_0x4f0fd2(0x1dd)]()-this[_0x4f0fd2(0x18c)]*0x3c*0x3e8),_0x30f26c=new Date();_0x30f26c[_0x4f0fd2(0x1b9)](_0x30f26c[_0x4f0fd2(0x1e1)]()-this[_0x4f0fd2(0x198)]),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x172)+_0x378ccf[_0x4f0fd2(0x1e5)]()),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1b4)+_0x30f26c[_0x4f0fd2(0x1e5)]()),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1e6)+this[_0x4f0fd2(0x1cf)]['join'](',\x20'));const _0x228ccf=await database_1[_0x4f0fd2(0x196)]['payment'][_0x4f0fd2(0x15d)]({'where':{'status':client_1[_0x4f0fd2(0x1bb)]['PENDING'],'OR':[{'gateway':{'in':this[_0x4f0fd2(0x1cf)]},'createdAt':{'lt':_0x378ccf}},{'gateway':{'notIn':this[_0x4f0fd2(0x1cf)]},'createdAt':{'lt':_0x30f26c}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1ae)+_0x228ccf[_0x4f0fd2(0x1df)]+_0x4f0fd2(0x1a6));if(_0x228ccf[_0x4f0fd2(0x1df)]===0x0)return console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x171)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x1ddefb of _0x228ccf){try{const _0x176595=this[_0x4f0fd2(0x1cf)][_0x4f0fd2(0x1d7)](_0x1ddefb['gateway']),_0x58845f=_0x176595?_0x4f0fd2(0x16b):'3\x20days',_0x369aaa=Math[_0x4f0fd2(0x1a7)]((Date[_0x4f0fd2(0x1e3)]()-_0x1ddefb[_0x4f0fd2(0x19e)][_0x4f0fd2(0x1dd)]())/(0x3e8*0x3c));console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x187)+_0x1ddefb['id']),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x16f)+_0x1ddefb['gateway']+'\x20('+_0x58845f+_0x4f0fd2(0x1da)),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x17c)+_0x1ddefb[_0x4f0fd2(0x184)]+'\x20'+_0x1ddefb[_0x4f0fd2(0x1b5)]),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1ef)+_0x1ddefb[_0x4f0fd2(0x188)][_0x4f0fd2(0x15b)]+'\x20('+_0x1ddefb[_0x4f0fd2(0x188)][_0x4f0fd2(0x192)]+')'),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x15f)+_0x1ddefb[_0x4f0fd2(0x19e)][_0x4f0fd2(0x1e5)]()),console[_0x4f0fd2(0x1ed)](_0x4f0fd2(0x1de)+_0x369aaa+_0x4f0fd2(0x17d));const _0x441894=await database_1[_0x4f0fd2(0x196)][_0x4f0fd2(0x174)]['update']({'where':{'id':_0x1ddefb['id']},'data':{'status':client_1[_0x4f0fd2(0x1bb)][_0x4f0fd2(0x170)],'statusChangedBy':_0x4f0fd2(0x159),'statusChangedAt':new Date(),'failureMessage':_0x4f0fd2(0x18f)+_0x58845f}});console[_0x4f0fd2(0x1ed)]('‚úÖ\x20Updated\x20payment\x20'+_0x1ddefb['id']+_0x4f0fd2(0x157)),loggerService_1['loggerService']['logWebhookProcessed'](_0x1ddefb[_0x4f0fd2(0x180)],_0x1ddefb['id'],_0x4f0fd2(0x1a9),_0x4f0fd2(0x170),{'reason':_0x4f0fd2(0x15a),'timeout':_0x58845f,'ageMinutes':_0x369aaa}),_0x3e2a00++;}catch(_0x17908c){const _0x55736e='Failed\x20to\x20update\x20PENDING\x20payment\x20'+_0x1ddefb['id']+':\x20'+(_0x17908c instanceof Error?_0x17908c[_0x4f0fd2(0x1c5)]:_0x4f0fd2(0x1e2));console[_0x4f0fd2(0x1b2)]('‚ùå\x20'+_0x55736e),_0x13fdee[_0x4f0fd2(0x1ce)](_0x55736e),_0x1f09c1++;}}const _0x3748d9='PENDING\x20cleanup\x20completed:\x20'+_0x3e2a00+_0x4f0fd2(0x1e8)+_0x1f09c1+'\x20failed\x20to\x20update';return console[_0x4f0fd2(0x1ed)]('üìä\x20'+_0x3748d9),loggerService_1['loggerService'][_0x4f0fd2(0x1b3)](_0x4f0fd2(0x191),_0x4f0fd2(0x18e),_0x4f0fd2(0x159),'admin',{'processed':_0x3e2a00,'failed':_0x1f09c1,'errors':_0x13fdee,'fastTimeoutMinutes':this[_0x4f0fd2(0x18c)],'slowTimeoutDays':this['SLOW_TIMEOUT_DAYS']}),{'processed':_0x3e2a00,'failed':_0x1f09c1,'errors':_0x13fdee};}catch(_0x24fb77){const _0xa0e1f6=_0x4f0fd2(0x195)+(_0x24fb77 instanceof Error?_0x24fb77[_0x4f0fd2(0x1c5)]:_0x4f0fd2(0x1e2));return console[_0x4f0fd2(0x1b2)](_0x4f0fd2(0x1c4)+_0xa0e1f6),_0x13fdee[_0x4f0fd2(0x1ce)](_0xa0e1f6),loggerService_1[_0x4f0fd2(0x1a0)][_0x4f0fd2(0x154)](_0x4f0fd2(0x191),_0xa0e1f6,{'timeoutDays':this[_0x4f0fd2(0x17a)]}),{'processed':_0x3e2a00,'failed':_0x1f09c1,'errors':_0x13fdee};}}async[a72_0x237ece(0x1d0)](){const _0x164df4=a72_0x237ece;try{const _0x53bd10=new Date(),_0x10dfcd=new Date(_0x53bd10[_0x164df4(0x1dd)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x57497a=new Date(_0x53bd10['getTime']()-0x3*0x18*0x3c*0x3c*0x3e8),_0x1d1d21=new Date(_0x53bd10[_0x164df4(0x1dd)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x5db8f2=await database_1[_0x164df4(0x196)][_0x164df4(0x174)]['findMany']({'where':{'status':{'in':[client_1[_0x164df4(0x1bb)][_0x164df4(0x186)],client_1[_0x164df4(0x1bb)]['PENDING']]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x1cfbe8={'total':_0x5db8f2[_0x164df4(0x1df)],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x329fc2 of _0x5db8f2){if(_0x329fc2['createdAt']>_0x10dfcd)_0x1cfbe8[_0x164df4(0x1b1)][_0x164df4(0x161)]++;else{if(_0x329fc2['createdAt']>_0x57497a)_0x1cfbe8[_0x164df4(0x1b1)][_0x164df4(0x18d)]++;else _0x329fc2[_0x164df4(0x19e)]>_0x1d1d21?_0x1cfbe8[_0x164df4(0x1b1)][_0x164df4(0x1ad)]++:_0x1cfbe8[_0x164df4(0x1b1)][_0x164df4(0x189)]++;}!_0x1cfbe8[_0x164df4(0x176)][_0x329fc2[_0x164df4(0x180)]]&&(_0x1cfbe8[_0x164df4(0x176)][_0x329fc2[_0x164df4(0x180)]]=0x0);_0x1cfbe8[_0x164df4(0x176)][_0x329fc2[_0x164df4(0x180)]]++;const _0x43f900=_0x329fc2['status'];!_0x1cfbe8[_0x164df4(0x163)][_0x43f900]&&(_0x1cfbe8[_0x164df4(0x163)][_0x43f900]=0x0),_0x1cfbe8['byStatus'][_0x43f900]++;}return _0x1cfbe8;}catch(_0x390d42){console['error'](_0x164df4(0x164),_0x390d42);throw new Error('Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20'+(_0x390d42 instanceof Error?_0x390d42['message']:_0x164df4(0x1e2)));}}async['runCleanupWithReport'](){const _0x1cbfbc=a72_0x237ece;console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x199));const _0x216523=await this['getProcessingPaymentsStats']();console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x1aa)),console[_0x1cbfbc(0x1ed)]('\x20\x20\x20Total:\x20'+_0x216523[_0x1cbfbc(0x190)]),console['log'](_0x1cbfbc(0x178)+_0x216523[_0x1cbfbc(0x1b1)]['fresh']),console['log']('\x20\x20\x20Recent\x20(1-3\x20days):\x20'+_0x216523[_0x1cbfbc(0x1b1)][_0x1cbfbc(0x18d)]),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x194)+_0x216523[_0x1cbfbc(0x1b1)][_0x1cbfbc(0x1ad)]),console['log'](_0x1cbfbc(0x167)+_0x216523[_0x1cbfbc(0x1b1)]['expired']),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x19d),_0x216523[_0x1cbfbc(0x176)]),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x17e),_0x216523[_0x1cbfbc(0x163)]),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x1bd));const _0x13de32=await this['cleanupStaleProcessingPayments']();console['log'](_0x1cbfbc(0x18a));const _0x32e2f5=await this[_0x1cbfbc(0x1b6)](),_0x481825=await this['getProcessingPaymentsStats']();console[_0x1cbfbc(0x1ed)]('\x0aüìä\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:'),console[_0x1cbfbc(0x1ed)]('\x20\x20\x20Total:\x20'+_0x481825['total']),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x167)+_0x481825[_0x1cbfbc(0x1b1)][_0x1cbfbc(0x189)]),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x17e),_0x481825[_0x1cbfbc(0x163)]);const _0x51406f=_0x13de32[_0x1cbfbc(0x1be)]+_0x32e2f5[_0x1cbfbc(0x1be)],_0x396b08=_0x13de32[_0x1cbfbc(0x1d5)]+_0x32e2f5[_0x1cbfbc(0x1d5)],_0x43dfeb=[..._0x13de32['errors'],..._0x32e2f5[_0x1cbfbc(0x16e)]];console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x16a)),console['log'](_0x1cbfbc(0x179)+_0x13de32[_0x1cbfbc(0x1be)]),console[_0x1cbfbc(0x1ed)]('\x20\x20\x20‚è∞\x20PENDING\x20‚Üí\x20EXPIRED:\x20'+_0x32e2f5[_0x1cbfbc(0x1be)]),console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x158)+_0x51406f),console[_0x1cbfbc(0x1ed)]('\x20\x20\x20‚ùå\x20Total\x20failed\x20to\x20process:\x20'+_0x396b08),console['log'](_0x1cbfbc(0x15e)+(_0x216523[_0x1cbfbc(0x190)]-_0x481825['total'])),_0x43dfeb[_0x1cbfbc(0x1df)]>0x0&&(console[_0x1cbfbc(0x1ed)](_0x1cbfbc(0x15c)),_0x43dfeb[_0x1cbfbc(0x18b)]((_0x5ea5ae,_0x1c1881)=>{const _0x253783=_0x1cbfbc;console[_0x253783(0x1ed)](_0x253783(0x1cc)+(_0x1c1881+0x1)+'.\x20'+_0x5ea5ae);})),console[_0x1cbfbc(0x1ed)]('üèÅ\x20Payment\x20cleanup\x20service\x20completed');}async[a72_0x237ece(0x1d6)](){const _0x408217=a72_0x237ece;console[_0x408217(0x1ed)]('üöÄ\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...');const _0x25fedc=await this[_0x408217(0x1d0)](),_0x1851c1=_0x25fedc[_0x408217(0x163)][_0x408217(0x186)]||0x0;console[_0x408217(0x1ed)](_0x408217(0x162)+_0x1851c1);const _0x1e5cfa=await this['cleanupStaleProcessingPayments'](),_0x49fe3e=await this[_0x408217(0x1d0)](),_0x1d9cd4=_0x49fe3e['byStatus']['PROCESSING']||0x0;console[_0x408217(0x1ed)]('üìä\x20PROCESSING\x20payments\x20after\x20cleanup:\x20'+_0x1d9cd4),console[_0x408217(0x1ed)]('‚úÖ\x20PROCESSING\x20payments\x20processed:\x20'+_0x1e5cfa['processed']),console['log'](_0x408217(0x1dc));}async[a72_0x237ece(0x1ca)](){const _0x112981=a72_0x237ece;console['log']('üöÄ\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...');const _0x2aba8e=await this['getProcessingPaymentsStats'](),_0x3300fe=_0x2aba8e[_0x112981(0x163)]['PENDING']||0x0;console[_0x112981(0x1ed)](_0x112981(0x169)+_0x3300fe);const _0x4db919=await this['cleanupStalePendingPayments'](),_0x591691=await this[_0x112981(0x1d0)](),_0x34f44d=_0x591691[_0x112981(0x163)][_0x112981(0x1a9)]||0x0;console[_0x112981(0x1ed)](_0x112981(0x1a8)+_0x34f44d),console[_0x112981(0x1ed)]('‚úÖ\x20PENDING\x20payments\x20processed:\x20'+_0x4db919['processed']),console[_0x112981(0x1ed)]('üèÅ\x20PENDING\x20cleanup\x20completed');}async[a72_0x237ece(0x1d8)](){const _0x36a339=a72_0x237ece,_0x4ab19e=[];let _0x5aa8e4=0x0;try{console[_0x36a339(0x1ed)](_0x36a339(0x1c6));const _0x35b198=new Date(),_0x3c074b=[_0x36a339(0x1c3),_0x36a339(0x168)],_0xbf078c=['squirrelpay',_0x36a339(0x1d2),'visa/mastercard','mastercard'],_0x58ef28=await database_1['default'][_0x36a339(0x1c7)][_0x36a339(0x15d)]({'where':{'type':_0x36a339(0x1c9),'status':_0x36a339(0x1bc)},'include':{'payments':{'orderBy':{'createdAt':'desc'},'take':0x1}}});console[_0x36a339(0x1ed)]('üîç\x20Found\x20'+_0x58ef28[_0x36a339(0x1df)]+_0x36a339(0x17f));for(const _0x25f008 of _0x58ef28){try{if(_0x25f008[_0x36a339(0x193)][_0x36a339(0x1df)]===0x0)continue;const _0x4ea536=_0x25f008[_0x36a339(0x193)][0x0];if(_0x4ea536[_0x36a339(0x1a3)]===_0x36a339(0x185))continue;const _0x401253=_0x35b198['getTime']()-_0x4ea536[_0x36a339(0x19e)]['getTime']();let _0x53b468;_0x3c074b['includes'](_0x25f008[_0x36a339(0x180)])||_0xbf078c['includes'](_0x25f008[_0x36a339(0x180)])?_0x53b468=0x1e*0x3c*0x3e8:_0x53b468=0x3*0x18*0x3c*0x3c*0x3e8,_0x401253>_0x53b468&&(await database_1[_0x36a339(0x196)]['paymentLink'][_0x36a339(0x1e9)]({'where':{'id':_0x25f008['id']},'data':{'status':_0x36a339(0x170)}}),console[_0x36a339(0x1ed)](_0x36a339(0x19b)+_0x25f008['id']+_0x36a339(0x153)+_0x25f008[_0x36a339(0x180)]+_0x36a339(0x177)+Math[_0x36a339(0x16c)](_0x401253/0x3e8/0x3c)+_0x36a339(0x1bf)),_0x5aa8e4++);}catch(_0x419df2){const _0x328e74='Failed\x20to\x20expire\x20link\x20'+_0x25f008['id']+':\x20'+(_0x419df2 instanceof Error?_0x419df2[_0x36a339(0x1c5)]:_0x36a339(0x1e2));console['error']('‚ùå\x20'+_0x328e74),_0x4ab19e[_0x36a339(0x1ce)](_0x328e74);}}return console['log'](_0x36a339(0x1c0)+_0x5aa8e4+_0x36a339(0x1db)),{'expired':_0x5aa8e4,'errors':_0x4ab19e};}catch(_0xca1ddf){const _0x1e4e61='Link\x20expiration\x20service\x20error:\x20'+(_0xca1ddf instanceof Error?_0xca1ddf['message']:_0x36a339(0x1e2));return console[_0x36a339(0x1b2)](_0x36a339(0x1c4)+_0x1e4e61),_0x4ab19e[_0x36a339(0x1ce)](_0x1e4e61),{'expired':_0x5aa8e4,'errors':_0x4ab19e};}}}function a72_0xe9ca(_0x50933,_0x4f7cf7){_0x50933=_0x50933-0x153;const _0x493c66=a72_0x493c();let _0xe9ca25=_0x493c66[_0x50933];return _0xe9ca25;}exports[a72_0x237ece(0x155)]=PaymentCleanupService,exports['paymentCleanupService']=new PaymentCleanupService();