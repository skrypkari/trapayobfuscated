'use strict';const a72_0x302342=a72_0x5c7e;function a72_0x1489(){const _0x4c7b7a=['ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PENDING\x20payments...','PAID','byAge','expireSinglePaymentLinks','â°\x20Processing\x20stale\x20PENDING\x20payment:\x20','Unknown\x20error','\x20stale\x20PROCESSING\x20payments','shop','getTime','\x20\x20\x20ğŸ”„\x20PROCESSING\x20â†’\x20FAILED:\x20','\x20\x20\x20Amount:\x20','setDate','findMany','ğŸš€\x20Starting\x20payment\x20cleanup\x20service...',',\x20payment\x20age:\x20','\x20timeout)','currency','\x20\x20\x20Age:\x20','FAILED','ğŸš€\x20Starting\x20PROCESSING\x20payments\x20cleanup\x20only...','SINGLE','processed','POST','byGateway','createdAt','message','ğŸ“Š\x20PROCESSING\x20payments\x20after\x20cleanup:\x20','squirrelpay','PROCESSING','\x20\x20\x20Fresh\x20(<\x201\x20day):\x20','oxapay','FAST_TIMEOUT_GATEWAYS','\x20\x20\x20Expired\x20(>\x205\x20days):\x20','ACTIVE','payment_cleanup','\x20(gateway:\x20','log','Failed\x20to\x20update\x20PENDING\x20payment\x20','desc','now','ğŸ’¥\x20','SLOW_TIMEOUT_DAYS','\x20\x20\x20Total:\x20','PROCESSING_TIMEOUT_DAYS','\x20\x20\x20Shop:\x20','âœ…\x20No\x20stale\x20PROCESSING\x20payments\x20found','default','3\x20days','âœ…\x20No\x20stale\x20PENDING\x20payments\x20found','Cleanup\x20completed:\x20','ğŸ\x20PROCESSING\x20cleanup\x20completed','\x20days','plisio','payment','\x20\x20\x20âœ…\x20Total\x20successfully\x20processed:\x20','2892KGtcgc','mastercard','cleanupStalePendingPayments','push','getDate','EXPIRED','total','2lOfXPQ','status','visa/mastercard','logWebhookError','39doqKPC','8vcahyo','ğŸ“‹\x20Fast\x20timeout\x20gateways:\x20','__importDefault','auto_timeout_pending','868803wJDHaj','toISOString','includes','loggerService','runCleanupWithReport','4DQQUzZ','stale','\x20\x20\x20By\x20gateway:','\x20\x20\x20Stale\x20(3-5\x20days):\x20','\x20minutes)','name','length','564370BQTtmU','Failed\x20to\x20expire\x20link\x20','Failed\x20to\x20update\x20payment\x20','\x0ağŸ“ˆ\x20Cleanup\x20Summary:','expired','ğŸ“…\x20Fast\x20timeout\x20(30\x20min):\x20','logApiCall','1895080cJsvhi','runPendingCleanupOnly','ğŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20before\x20cleanup:','\x20\x20\x20âš ï¸\x20Errors\x20encountered:','1345200UgqJKi','\x20\x20\x20Created:\x20','paymentCleanupService','\x20\x20\x20By\x20status:','11pRsWus','PENDING_TIMEOUT_DAYS','\x20\x20\x20â°\x20PENDING\x20â†’\x20EXPIRED:\x20','system','byStatus','PaymentStatus','fresh','\x20from\x20PROCESSING\x20to\x20FAILED','ğŸ“Š\x20PROCESSING\x20payments\x20before\x20cleanup:\x20','â°\x20Starting\x20expiration\x20check\x20for\x20SINGLE\x20payment\x20links...','\x20payments\x20updated\x20to\x20FAILED,\x20','rapyd','recent','\x20minutes','update','\x20\x20\x20Recent\x20(1-3\x20days):\x20','username','ğŸ\x20PENDING\x20cleanup\x20completed','\x20\x20\x20\x20\x20\x20','runProcessingCleanupOnly','6466419WrVoSM','../config/database','ğŸ“…\x20Slow\x20timeout\x20(3\x20days):\x20','cleanupStaleProcessingPayments','30\x20minutes','getProcessingPaymentsStats','\x20\x20\x20âŒ\x20Total\x20failed\x20to\x20process:\x20','ğŸ“Š\x20','\x20failed\x20to\x20update','Payment\x20timeout:\x20No\x20payment\x20action\x20received\x20within\x20','\x20links\x20expired','\x0ağŸ”„\x20Running\x20PENDING\x20payments\x20cleanup...','ğŸ“Š\x20PENDING\x20payments\x20before\x20cleanup:\x20','error','\x0ağŸ“Š\x20Stale\x20payments\x20(PROCESSING\x20+\x20PENDING)\x20after\x20cleanup:','\x20\x20\x20Gateway:\x20','\x20active\x20SINGLE\x20links\x20to\x20check','admin','ğŸ”\x20Found\x20','FAST_TIMEOUT_MINUTES','payments','floor','failed','squirrel-pay','errors','PENDING\x20cleanup\x20service\x20error:\x20','PENDING','forEach','amount','gateway','93421RrRPUJ','pending_payment_cleanup','ğŸš€\x20Starting\x20PENDING\x20payments\x20cleanup\x20only...','ğŸ“…\x20Looking\x20for\x20PROCESSING\x20payments\x20older\x20than:\x20','logWebhookProcessed','Cleanup\x20service\x20error:\x20','1435ZIAaKq','__esModule'];a72_0x1489=function(){return _0x4c7b7a;};return a72_0x1489();}(function(_0x3acff2,_0x5e0f47){const _0x49079f=a72_0x5c7e,_0x2c4924=_0x3acff2();while(!![]){try{const _0x4bcfd6=parseInt(_0x49079f(0xc6))/0x1*(parseInt(_0x49079f(0x10c))/0x2)+-parseInt(_0x49079f(0x115))/0x3*(parseInt(_0x49079f(0x7e))/0x4)+parseInt(_0x49079f(0x8c))/0x5+-parseInt(_0x49079f(0x105))/0x6*(parseInt(_0x49079f(0xcc))/0x7)+parseInt(_0x49079f(0x111))/0x8*(parseInt(_0x49079f(0xa8))/0x9)+parseInt(_0x49079f(0x85))/0xa*(-parseInt(_0x49079f(0x94))/0xb)+-parseInt(_0x49079f(0x90))/0xc*(parseInt(_0x49079f(0x110))/0xd);if(_0x4bcfd6===_0x5e0f47)break;else _0x2c4924['push'](_0x2c4924['shift']());}catch(_0x1a4b85){_0x2c4924['push'](_0x2c4924['shift']());}}}(a72_0x1489,0x640b4));function a72_0x5c7e(_0x26f09d,_0x1661b7){_0x26f09d=_0x26f09d-0x7e;const _0x1489ad=a72_0x1489();let _0x5c7ea3=_0x1489ad[_0x26f09d];return _0x5c7ea3;}var __importDefault=this&&this[a72_0x302342(0x113)]||function(_0x2e7279){const _0x510cac=a72_0x302342;return _0x2e7279&&_0x2e7279[_0x510cac(0xcd)]?_0x2e7279:{'default':_0x2e7279};};Object['defineProperty'](exports,a72_0x302342(0xcd),{'value':!![]}),exports[a72_0x302342(0x92)]=exports['PaymentCleanupService']=void 0x0;const database_1=__importDefault(require(a72_0x302342(0xa9))),client_1=require('@prisma/client'),loggerService_1=require('./loggerService');class PaymentCleanupService{constructor(){const _0x481ff5=a72_0x302342;this[_0x481ff5(0xf9)]=0x5,this['PENDING_TIMEOUT_DAYS']=0x5,this['FAST_TIMEOUT_MINUTES']=0x1e,this['SLOW_TIMEOUT_DAYS']=0x3,this[_0x481ff5(0xed)]=['squirrelpay',_0x481ff5(0xbf),_0x481ff5(0x9f),_0x481ff5(0x10e),'plisio',_0x481ff5(0xec)];}async[a72_0x302342(0xab)](){const _0x2fe21f=a72_0x302342,_0x5bad8e=[];let _0x399f56=0x0,_0x145cd3=0x0;try{console['log']('ğŸ§¹\x20Starting\x20cleanup\x20of\x20stale\x20PROCESSING\x20payments...');const _0x5c42b3=new Date();_0x5c42b3[_0x2fe21f(0xd9)](_0x5c42b3['getDate']()-this['PROCESSING_TIMEOUT_DAYS']),console[_0x2fe21f(0xf2)](_0x2fe21f(0xc9)+_0x5c42b3[_0x2fe21f(0x116)]());const _0x51990a=await database_1[_0x2fe21f(0xfc)][_0x2fe21f(0x103)][_0x2fe21f(0xda)]({'where':{'status':client_1[_0x2fe21f(0x99)][_0x2fe21f(0xea)],'createdAt':{'lt':_0x5c42b3}},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2fe21f(0xf2)](_0x2fe21f(0xba)+_0x51990a[_0x2fe21f(0x84)]+_0x2fe21f(0xd4));if(_0x51990a['length']===0x0)return console['log'](_0x2fe21f(0xfb)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x16a29f of _0x51990a){try{console[_0x2fe21f(0xf2)]('â±ï¸\x20Processing\x20stale\x20payment:\x20'+_0x16a29f['id']+'\x20('+_0x16a29f[_0x2fe21f(0xc5)]+',\x20'+_0x16a29f[_0x2fe21f(0xc4)]+'\x20'+_0x16a29f[_0x2fe21f(0xde)]+')'),console[_0x2fe21f(0xf2)](_0x2fe21f(0xfa)+_0x16a29f[_0x2fe21f(0xd5)][_0x2fe21f(0x83)]+'\x20('+_0x16a29f[_0x2fe21f(0xd5)][_0x2fe21f(0xa4)]+')'),console[_0x2fe21f(0xf2)](_0x2fe21f(0x91)+_0x16a29f[_0x2fe21f(0xe6)][_0x2fe21f(0x116)]()),console[_0x2fe21f(0xf2)]('\x20\x20\x20Age:\x20'+Math['floor']((Date['now']()-_0x16a29f[_0x2fe21f(0xe6)][_0x2fe21f(0xd6)]())/(0x3e8*0x3c*0x3c*0x18))+'\x20days');const _0x25a582=await database_1['default'][_0x2fe21f(0x103)]['update']({'where':{'id':_0x16a29f['id']},'data':{'status':client_1[_0x2fe21f(0x99)][_0x2fe21f(0xe0)],'statusChangedBy':_0x2fe21f(0x97),'statusChangedAt':new Date(),'failureMessage':'Payment\x20timeout:\x20No\x20status\x20update\x20received\x20for\x20'+this[_0x2fe21f(0xf9)]+_0x2fe21f(0x101)}});console[_0x2fe21f(0xf2)]('âœ…\x20Updated\x20payment\x20'+_0x16a29f['id']+_0x2fe21f(0x9b)),loggerService_1[_0x2fe21f(0x118)][_0x2fe21f(0xca)](_0x16a29f[_0x2fe21f(0xc5)],_0x16a29f['id'],_0x2fe21f(0xea),_0x2fe21f(0xe0),{'reason':'auto_timeout','timeoutDays':this[_0x2fe21f(0xf9)]}),_0x399f56++;}catch(_0x16bde5){const _0x162ad6=_0x2fe21f(0x87)+_0x16a29f['id']+':\x20'+(_0x16bde5 instanceof Error?_0x16bde5[_0x2fe21f(0xe7)]:_0x2fe21f(0xd3));console[_0x2fe21f(0xb5)]('âŒ\x20'+_0x162ad6),_0x5bad8e[_0x2fe21f(0x108)](_0x162ad6),_0x145cd3++;}}const _0x2b87a7=_0x2fe21f(0xff)+_0x399f56+_0x2fe21f(0x9e)+_0x145cd3+_0x2fe21f(0xb0);return console[_0x2fe21f(0xf2)]('ğŸ“Š\x20'+_0x2b87a7),loggerService_1[_0x2fe21f(0x118)][_0x2fe21f(0x8b)](_0x2fe21f(0xf0),_0x2fe21f(0xe4),_0x2fe21f(0x97),_0x2fe21f(0xb9),{'processed':_0x399f56,'failed':_0x145cd3,'errors':_0x5bad8e,'timeoutDays':this[_0x2fe21f(0xf9)]}),{'processed':_0x399f56,'failed':_0x145cd3,'errors':_0x5bad8e};}catch(_0x206f9d){const _0x172d06=_0x2fe21f(0xcb)+(_0x206f9d instanceof Error?_0x206f9d['message']:_0x2fe21f(0xd3));return console[_0x2fe21f(0xb5)](_0x2fe21f(0xf6)+_0x172d06),_0x5bad8e[_0x2fe21f(0x108)](_0x172d06),loggerService_1[_0x2fe21f(0x118)][_0x2fe21f(0x10f)](_0x2fe21f(0xf0),_0x172d06,{'timeoutDays':this['PROCESSING_TIMEOUT_DAYS']}),{'processed':_0x399f56,'failed':_0x145cd3,'errors':_0x5bad8e};}}async['cleanupStalePendingPayments'](){const _0x2d3e90=a72_0x302342,_0x19521a=[];let _0x5567de=0x0,_0x2bc70f=0x0;try{console[_0x2d3e90(0xf2)](_0x2d3e90(0xce));const _0x3970f2=new Date(),_0x2133c9=new Date(_0x3970f2['getTime']()-this[_0x2d3e90(0xbb)]*0x3c*0x3e8),_0x502ef6=new Date();_0x502ef6[_0x2d3e90(0xd9)](_0x502ef6[_0x2d3e90(0x109)]()-this[_0x2d3e90(0xf7)]),console[_0x2d3e90(0xf2)](_0x2d3e90(0x8a)+_0x2133c9[_0x2d3e90(0x116)]()),console['log'](_0x2d3e90(0xaa)+_0x502ef6[_0x2d3e90(0x116)]()),console[_0x2d3e90(0xf2)](_0x2d3e90(0x112)+this[_0x2d3e90(0xed)]['join'](',\x20'));const _0x3e0ee6=await database_1[_0x2d3e90(0xfc)][_0x2d3e90(0x103)]['findMany']({'where':{'status':client_1[_0x2d3e90(0x99)]['PENDING'],'OR':[{'gateway':{'in':this[_0x2d3e90(0xed)]},'createdAt':{'lt':_0x2133c9}},{'gateway':{'notIn':this[_0x2d3e90(0xed)]},'createdAt':{'lt':_0x502ef6}}]},'include':{'shop':{'select':{'id':!![],'name':!![],'username':!![]}}}});console[_0x2d3e90(0xf2)](_0x2d3e90(0xba)+_0x3e0ee6[_0x2d3e90(0x84)]+'\x20stale\x20PENDING\x20payments');if(_0x3e0ee6[_0x2d3e90(0x84)]===0x0)return console[_0x2d3e90(0xf2)](_0x2d3e90(0xfe)),{'processed':0x0,'failed':0x0,'errors':[]};for(const _0x3e2376 of _0x3e0ee6){try{const _0x59e4b9=this['FAST_TIMEOUT_GATEWAYS'][_0x2d3e90(0x117)](_0x3e2376[_0x2d3e90(0xc5)]),_0xef0222=_0x59e4b9?_0x2d3e90(0xac):_0x2d3e90(0xfd),_0x3b0dea=Math[_0x2d3e90(0xbd)]((Date[_0x2d3e90(0xf5)]()-_0x3e2376[_0x2d3e90(0xe6)][_0x2d3e90(0xd6)]())/(0x3e8*0x3c));console[_0x2d3e90(0xf2)](_0x2d3e90(0xd2)+_0x3e2376['id']),console[_0x2d3e90(0xf2)](_0x2d3e90(0xb7)+_0x3e2376['gateway']+'\x20('+_0xef0222+_0x2d3e90(0xdd)),console[_0x2d3e90(0xf2)](_0x2d3e90(0xd8)+_0x3e2376['amount']+'\x20'+_0x3e2376[_0x2d3e90(0xde)]),console[_0x2d3e90(0xf2)](_0x2d3e90(0xfa)+_0x3e2376['shop']['name']+'\x20('+_0x3e2376[_0x2d3e90(0xd5)][_0x2d3e90(0xa4)]+')'),console[_0x2d3e90(0xf2)](_0x2d3e90(0x91)+_0x3e2376[_0x2d3e90(0xe6)][_0x2d3e90(0x116)]()),console[_0x2d3e90(0xf2)](_0x2d3e90(0xdf)+_0x3b0dea+_0x2d3e90(0xa1));const _0x4c4421=await database_1['default'][_0x2d3e90(0x103)][_0x2d3e90(0xa2)]({'where':{'id':_0x3e2376['id']},'data':{'status':client_1[_0x2d3e90(0x99)][_0x2d3e90(0x10a)],'statusChangedBy':_0x2d3e90(0x97),'statusChangedAt':new Date(),'failureMessage':_0x2d3e90(0xb1)+_0xef0222}});console['log']('âœ…\x20Updated\x20payment\x20'+_0x3e2376['id']+'\x20from\x20PENDING\x20to\x20EXPIRED'),loggerService_1[_0x2d3e90(0x118)]['logWebhookProcessed'](_0x3e2376['gateway'],_0x3e2376['id'],_0x2d3e90(0xc2),'EXPIRED',{'reason':_0x2d3e90(0x114),'timeout':_0xef0222,'ageMinutes':_0x3b0dea}),_0x5567de++;}catch(_0x14b5e8){const _0x53f954=_0x2d3e90(0xf3)+_0x3e2376['id']+':\x20'+(_0x14b5e8 instanceof Error?_0x14b5e8[_0x2d3e90(0xe7)]:_0x2d3e90(0xd3));console[_0x2d3e90(0xb5)]('âŒ\x20'+_0x53f954),_0x19521a[_0x2d3e90(0x108)](_0x53f954),_0x2bc70f++;}}const _0x44391c='PENDING\x20cleanup\x20completed:\x20'+_0x5567de+'\x20payments\x20updated\x20to\x20EXPIRED,\x20'+_0x2bc70f+_0x2d3e90(0xb0);return console[_0x2d3e90(0xf2)](_0x2d3e90(0xaf)+_0x44391c),loggerService_1[_0x2d3e90(0x118)]['logApiCall'](_0x2d3e90(0xc7),_0x2d3e90(0xe4),_0x2d3e90(0x97),'admin',{'processed':_0x5567de,'failed':_0x2bc70f,'errors':_0x19521a,'fastTimeoutMinutes':this[_0x2d3e90(0xbb)],'slowTimeoutDays':this[_0x2d3e90(0xf7)]}),{'processed':_0x5567de,'failed':_0x2bc70f,'errors':_0x19521a};}catch(_0x242d35){const _0x1c12a2=_0x2d3e90(0xc1)+(_0x242d35 instanceof Error?_0x242d35[_0x2d3e90(0xe7)]:'Unknown\x20error');return console[_0x2d3e90(0xb5)](_0x2d3e90(0xf6)+_0x1c12a2),_0x19521a[_0x2d3e90(0x108)](_0x1c12a2),loggerService_1[_0x2d3e90(0x118)][_0x2d3e90(0x10f)](_0x2d3e90(0xc7),_0x1c12a2,{'timeoutDays':this[_0x2d3e90(0x95)]}),{'processed':_0x5567de,'failed':_0x2bc70f,'errors':_0x19521a};}}async[a72_0x302342(0xad)](){const _0x1de602=a72_0x302342;try{const _0xb4e561=new Date(),_0x4d67d7=new Date(_0xb4e561[_0x1de602(0xd6)]()-0x1*0x18*0x3c*0x3c*0x3e8),_0x119e3f=new Date(_0xb4e561[_0x1de602(0xd6)]()-0x3*0x18*0x3c*0x3c*0x3e8),_0x5f288f=new Date(_0xb4e561[_0x1de602(0xd6)]()-0x5*0x18*0x3c*0x3c*0x3e8),_0x292569=await database_1[_0x1de602(0xfc)][_0x1de602(0x103)][_0x1de602(0xda)]({'where':{'status':{'in':[client_1[_0x1de602(0x99)][_0x1de602(0xea)],client_1['PaymentStatus'][_0x1de602(0xc2)]]}},'select':{'id':!![],'gateway':!![],'status':!![],'createdAt':!![]}}),_0x2b6664={'total':_0x292569['length'],'byAge':{'fresh':0x0,'recent':0x0,'stale':0x0,'expired':0x0},'byGateway':{},'byStatus':{}};for(const _0x3ef6f1 of _0x292569){if(_0x3ef6f1[_0x1de602(0xe6)]>_0x4d67d7)_0x2b6664[_0x1de602(0xd0)][_0x1de602(0x9a)]++;else{if(_0x3ef6f1[_0x1de602(0xe6)]>_0x119e3f)_0x2b6664[_0x1de602(0xd0)][_0x1de602(0xa0)]++;else _0x3ef6f1[_0x1de602(0xe6)]>_0x5f288f?_0x2b6664[_0x1de602(0xd0)]['stale']++:_0x2b6664[_0x1de602(0xd0)][_0x1de602(0x89)]++;}!_0x2b6664[_0x1de602(0xe5)][_0x3ef6f1[_0x1de602(0xc5)]]&&(_0x2b6664[_0x1de602(0xe5)][_0x3ef6f1[_0x1de602(0xc5)]]=0x0);_0x2b6664['byGateway'][_0x3ef6f1[_0x1de602(0xc5)]]++;const _0x41f062=_0x3ef6f1['status'];!_0x2b6664[_0x1de602(0x98)][_0x41f062]&&(_0x2b6664[_0x1de602(0x98)][_0x41f062]=0x0),_0x2b6664[_0x1de602(0x98)][_0x41f062]++;}return _0x2b6664;}catch(_0x23d4d8){console[_0x1de602(0xb5)]('Failed\x20to\x20get\x20processing\x20payments\x20stats:',_0x23d4d8);throw new Error('Failed\x20to\x20get\x20processing\x20payments\x20stats:\x20'+(_0x23d4d8 instanceof Error?_0x23d4d8[_0x1de602(0xe7)]:_0x1de602(0xd3)));}}async[a72_0x302342(0x119)](){const _0x9ed009=a72_0x302342;console[_0x9ed009(0xf2)](_0x9ed009(0xdb));const _0x2e1b68=await this[_0x9ed009(0xad)]();console[_0x9ed009(0xf2)](_0x9ed009(0x8e)),console['log']('\x20\x20\x20Total:\x20'+_0x2e1b68[_0x9ed009(0x10b)]),console['log'](_0x9ed009(0xeb)+_0x2e1b68[_0x9ed009(0xd0)][_0x9ed009(0x9a)]),console['log'](_0x9ed009(0xa3)+_0x2e1b68[_0x9ed009(0xd0)][_0x9ed009(0xa0)]),console['log'](_0x9ed009(0x81)+_0x2e1b68[_0x9ed009(0xd0)][_0x9ed009(0x7f)]),console[_0x9ed009(0xf2)](_0x9ed009(0xee)+_0x2e1b68[_0x9ed009(0xd0)][_0x9ed009(0x89)]),console[_0x9ed009(0xf2)](_0x9ed009(0x80),_0x2e1b68[_0x9ed009(0xe5)]),console[_0x9ed009(0xf2)](_0x9ed009(0x93),_0x2e1b68['byStatus']),console[_0x9ed009(0xf2)]('\x0ağŸ”„\x20Running\x20PROCESSING\x20payments\x20cleanup...');const _0x409b82=await this['cleanupStaleProcessingPayments']();console['log'](_0x9ed009(0xb3));const _0x537201=await this[_0x9ed009(0x107)](),_0x2dc9fb=await this[_0x9ed009(0xad)]();console[_0x9ed009(0xf2)](_0x9ed009(0xb6)),console[_0x9ed009(0xf2)](_0x9ed009(0xf8)+_0x2dc9fb[_0x9ed009(0x10b)]),console[_0x9ed009(0xf2)](_0x9ed009(0xee)+_0x2dc9fb[_0x9ed009(0xd0)]['expired']),console['log'](_0x9ed009(0x93),_0x2dc9fb[_0x9ed009(0x98)]);const _0x1da011=_0x409b82[_0x9ed009(0xe3)]+_0x537201[_0x9ed009(0xe3)],_0x43e049=_0x409b82[_0x9ed009(0xbe)]+_0x537201[_0x9ed009(0xbe)],_0x199315=[..._0x409b82[_0x9ed009(0xc0)],..._0x537201[_0x9ed009(0xc0)]];console[_0x9ed009(0xf2)](_0x9ed009(0x88)),console['log'](_0x9ed009(0xd7)+_0x409b82[_0x9ed009(0xe3)]),console['log'](_0x9ed009(0x96)+_0x537201[_0x9ed009(0xe3)]),console['log'](_0x9ed009(0x104)+_0x1da011),console[_0x9ed009(0xf2)](_0x9ed009(0xae)+_0x43e049),console[_0x9ed009(0xf2)]('\x20\x20\x20ğŸ“‰\x20Total\x20stale\x20payments\x20reduced\x20by:\x20'+(_0x2e1b68['total']-_0x2dc9fb[_0x9ed009(0x10b)])),_0x199315['length']>0x0&&(console[_0x9ed009(0xf2)](_0x9ed009(0x8f)),_0x199315[_0x9ed009(0xc3)]((_0x5743dc,_0x420e8f)=>{const _0x501f4a=_0x9ed009;console[_0x501f4a(0xf2)](_0x501f4a(0xa6)+(_0x420e8f+0x1)+'.\x20'+_0x5743dc);})),console[_0x9ed009(0xf2)]('ğŸ\x20Payment\x20cleanup\x20service\x20completed');}async[a72_0x302342(0xa7)](){const _0x2f5e1c=a72_0x302342;console[_0x2f5e1c(0xf2)](_0x2f5e1c(0xe1));const _0x597469=await this[_0x2f5e1c(0xad)](),_0x315b69=_0x597469[_0x2f5e1c(0x98)]['PROCESSING']||0x0;console['log'](_0x2f5e1c(0x9c)+_0x315b69);const _0x4aab90=await this['cleanupStaleProcessingPayments'](),_0x4c10a9=await this[_0x2f5e1c(0xad)](),_0x4debb6=_0x4c10a9['byStatus'][_0x2f5e1c(0xea)]||0x0;console[_0x2f5e1c(0xf2)](_0x2f5e1c(0xe8)+_0x4debb6),console[_0x2f5e1c(0xf2)]('âœ…\x20PROCESSING\x20payments\x20processed:\x20'+_0x4aab90[_0x2f5e1c(0xe3)]),console['log'](_0x2f5e1c(0x100));}async[a72_0x302342(0x8d)](){const _0x3e87f8=a72_0x302342;console[_0x3e87f8(0xf2)](_0x3e87f8(0xc8));const _0x1ad9f2=await this[_0x3e87f8(0xad)](),_0x2e9054=_0x1ad9f2[_0x3e87f8(0x98)][_0x3e87f8(0xc2)]||0x0;console[_0x3e87f8(0xf2)](_0x3e87f8(0xb4)+_0x2e9054);const _0x3dfac7=await this[_0x3e87f8(0x107)](),_0x129838=await this[_0x3e87f8(0xad)](),_0x17d460=_0x129838[_0x3e87f8(0x98)]['PENDING']||0x0;console[_0x3e87f8(0xf2)]('ğŸ“Š\x20PENDING\x20payments\x20after\x20cleanup:\x20'+_0x17d460),console['log']('âœ…\x20PENDING\x20payments\x20processed:\x20'+_0x3dfac7[_0x3e87f8(0xe3)]),console[_0x3e87f8(0xf2)](_0x3e87f8(0xa5));}async[a72_0x302342(0xd1)](){const _0x9acd2a=a72_0x302342,_0x56cdd8=[];let _0x44eddc=0x0;try{console[_0x9acd2a(0xf2)](_0x9acd2a(0x9d));const _0x49fe7a=new Date(),_0x5d4982=[_0x9acd2a(0xec),_0x9acd2a(0x102)],_0x4a2084=[_0x9acd2a(0xe9),_0x9acd2a(0x9f),_0x9acd2a(0x10e),_0x9acd2a(0x106)],_0x3527fd=await database_1['default']['paymentLink'][_0x9acd2a(0xda)]({'where':{'type':_0x9acd2a(0xe2),'status':_0x9acd2a(0xef)},'include':{'payments':{'orderBy':{'createdAt':_0x9acd2a(0xf4)},'take':0x1}}});console['log'](_0x9acd2a(0xba)+_0x3527fd[_0x9acd2a(0x84)]+_0x9acd2a(0xb8));for(const _0x163f6e of _0x3527fd){try{if(_0x163f6e[_0x9acd2a(0xbc)]['length']===0x0)continue;const _0x502258=_0x163f6e[_0x9acd2a(0xbc)][0x0];if(_0x502258[_0x9acd2a(0x10d)]===_0x9acd2a(0xcf))continue;const _0x4615a0=_0x49fe7a[_0x9acd2a(0xd6)]()-_0x502258[_0x9acd2a(0xe6)][_0x9acd2a(0xd6)]();let _0x95ebb1;_0x5d4982['includes'](_0x163f6e[_0x9acd2a(0xc5)])||_0x4a2084[_0x9acd2a(0x117)](_0x163f6e[_0x9acd2a(0xc5)])?_0x95ebb1=0x1e*0x3c*0x3e8:_0x95ebb1=0x3*0x18*0x3c*0x3c*0x3e8,_0x4615a0>_0x95ebb1&&(await database_1['default']['paymentLink'][_0x9acd2a(0xa2)]({'where':{'id':_0x163f6e['id']},'data':{'status':_0x9acd2a(0x10a)}}),console[_0x9acd2a(0xf2)]('â°\x20Expired\x20link\x20'+_0x163f6e['id']+_0x9acd2a(0xf1)+_0x163f6e[_0x9acd2a(0xc5)]+_0x9acd2a(0xdc)+Math['round'](_0x4615a0/0x3e8/0x3c)+_0x9acd2a(0x82)),_0x44eddc++);}catch(_0x3e6a29){const _0x53343b=_0x9acd2a(0x86)+_0x163f6e['id']+':\x20'+(_0x3e6a29 instanceof Error?_0x3e6a29[_0x9acd2a(0xe7)]:_0x9acd2a(0xd3));console[_0x9acd2a(0xb5)]('âŒ\x20'+_0x53343b),_0x56cdd8[_0x9acd2a(0x108)](_0x53343b);}}return console[_0x9acd2a(0xf2)]('ğŸ“Š\x20Expiration\x20completed:\x20'+_0x44eddc+_0x9acd2a(0xb2)),{'expired':_0x44eddc,'errors':_0x56cdd8};}catch(_0x33ab43){const _0x57a0f6='Link\x20expiration\x20service\x20error:\x20'+(_0x33ab43 instanceof Error?_0x33ab43[_0x9acd2a(0xe7)]:_0x9acd2a(0xd3));return console['error']('ğŸ’¥\x20'+_0x57a0f6),_0x56cdd8[_0x9acd2a(0x108)](_0x57a0f6),{'expired':_0x44eddc,'errors':_0x56cdd8};}}}exports['PaymentCleanupService']=PaymentCleanupService,exports[a72_0x302342(0x92)]=new PaymentCleanupService();